# 修正内容の確認 (Walkthrough)

## 変更の概要
AI（CPU）およびリモート対戦相手の進化アニメーションが正しく再生されるように修正しました。また、ゲームバランス維持のため手札上限を9枚に設定し、超過分の処理（墓地送り）を実装しました。UI面では、カード使用（Play）ボタンのデザインを刷新しました。

## 変更点詳細

### 1. AI進化アニメーションの修正
- **GameScreen.tsx**:
    - `runAiTurn` 関数内で、`EVOLVE` アクションを即座に発行するのではなく、`setEvolveAnimation` を呼び出してアニメーションを開始するように変更しました。
    - アニメーション状態 (`evolveAnimation`) に `sourcePlayerId` プロパティを追加し、誰が進化を行っているかを追跡できるようにしました。
    - `pendingEvolveRef` に `playerId` を追加し、アニメーションコールバック (`handleEvolvePhaseChange`) でこのIDを正しく伝搬させることで、完了時に正しいプレイヤーIDで `EVOLVE` アクションが発行されるようにしました。
    - `useEffect` フックを修正し、`pendingEvolveRef` 内の `playerId` を使用してアクションを発行するようにしました（以前は `currentPlayerId` に固定されていたため、AIの進化がプレイヤーの行動として扱われるバグがありました）。

### 2. 手札上限の実装 (Engine)
- **engine.ts**:
    - `DRAW`、`GENERATE_CARD`、`RETURN_TO_HAND` の各エフェクトにおいて、手札枚数が9枚以上になる場合のチェックを追加しました。
    - 上限を超える場合、対象のカードを直接墓地 (`graveyard`) に送り、ログにその旨を出力するようにしました。これにより、カードが虚空に消えるのではなく、ゲームルールとして正しく処理されます。

### 3. Playボタンの刷新
- **GameScreen.tsx**:
    - カード選択時に表示される「使用」ボタンのデザインを変更しました。
        - グラデーション背景 (`linear-gradient`)
        - 影付き (`boxShadow`)
        - 配置調整（手札の上に重ならないように位置を変更）

## 確認方法
1. **AI対戦**:
    - シングルプレイヤーモードでゲームを開始し、6ターン目以降まで進行。
    - CPUが進化権を持っている場合、進化を行う際にプレイヤー同様のカットインアニメーションが再生されることを確認。
2. **手札溢れ**:
    - 手札を9枚まで溜め（カードを使わずにターンを経過させる等）、次のドローでカードが燃える（墓地に行き、ログが出る）ことを確認。
