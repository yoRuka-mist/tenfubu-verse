# Walkthrough - 2025-12-18

## 実施した修正内容

### 1. カードデータの整理と強化 (engine.ts)
- **SARAの重複削除**: ID `c_sara` のコスト4版（大文字表記）を削除し、コスト7版のみに統一しました。
- **Monoの進化時効果**: 進化時に「相手のフォロワー1体に5ダメージ」を与える効果を追加しました。
- **攻撃エフェクト指定**: Monoの `attackEffectType` を `'SHOT'` に設定しました。

### 2. エンジンロジックの改善 (engine.ts)
- **効果の条件チェック**: `PLAY_CARD` および `EVOLVE` 時に、効果の `conditions` (`minTurn`) を評価するようにしました。これにより、`sara` のトークン入手演出が11ターン目以降のみに正しく制限されます。

### 3. ビジュアル・インターフェースの修正## カード画像表示の修正
- **パスの正規化**: `engine.ts` 内の `imageUrl` をすべて `/cards/` で始まる絶対パスに統一しました。これにより、Viteの開発サーバー経由で確実にアセットが参照されるようになります。
- **レイアウトの安定化**: `Card.tsx` のルート要素に `card` クラスが欠けていたため追加しました。これによりCSSの基本サイズ（140x200）が適用されます。
- **ブラウザ互換性**: `inset: 0` スタイルを `top, left, right, bottom: 0` に書き換え、古い/特定のブラウザ環境での表示崩れを防ぎました。
- **領域確保**: 画像を包むコンテナに `minHeight: 0` を追加し、Flexbox内で潰れないようにしました。

## カードデータとエンジンの修正
- **Mono (修正)**: 画像パスを `/cards/Mono.jpg` に修正。
- **青ツバキ (修正)**: コストを 2 -> 4、ステータスを 2/2 -> 4/3 に更新しました。
- **バリア処理の強化**: 攻撃側のフォロワーがバリアを持っている場合、反撃ダメージを無効化しつつバリアを消費する処理を `engine.ts` の `ATTACK` ケースに追加しました。

## AIロジックの改善
- **進化対象の選定**: AIが既に進化済みのフォロワーを重ねて進化させようとしないよう、未進化状態を確認するフィルタを追加しました。
- **ターゲット指定**: AIが進化時やプレイ時にターゲットが必要な効果を持つカードを扱う際、相手のフォロワーをターゲットとして正しく渡す処理を維持・確認しました。
- **思考・行動タイミングの調整**: AIがカードをプレイ、進化、攻撃する際に、前の行動のアニメーションや効果処理（`pendingEffects`）が完全に終了するまで待機するように修正しました。これに加えて、ユーザーが状況を把握しやすいよう、処理完了後に1〜2秒の「間」を確保しています。
- **攻撃演出の追加**: AIの攻撃時にも、プレイヤー同様に `playEffect` を呼び出し、攻撃エフェクト（SLASH等）を表示するようにしました。
- **突進(RUSH)ロジックの修正**: AIが突進持ちフォロワーでリーダーを攻撃しようとする問題と、プレイヤーが突進状態でリーダーを攻撃した際に無効判定にも関わらずアニメーションが再生されてしまう問題を修正しました。

- **突進(RUSH)ロジックの修正**: AIが突進持ちフォロワーでリーダーを攻撃しようとする問題と、プレイヤーが突進状態でリーダーを攻撃した際に無効判定にも関わらずアニメーションが再生されてしまう問題を修正しました。

## UI・演出改善
- **バトルログの実装**: 何が起きているか把握しやすくするため、画面右側の盤面エリア内の左端にバトルログを表示するようにしました。カード詳細エリアとは被らないように配置しています。
- **リーダー位置の微調整**: 自分と相手のリーダー表示位置を全体的に10px下げ、バランスを調整しました。
- **SEP演出の色変更**: 超進化ポイント（SEP）を使用した進化操作時のドラッグ矢印や予測線、および超進化アニメーション完了時のエフェクトの色を、進化（黄色）と区別して紫色（#9f7aea）に変更しました。
- **テキスト修正**: Saraの効果テキストを「ソリィ…The end.」から「すみませんが、これで終わりです。」に修正しました。
- **演出タイミングの改善**: 相手リーダーへの攻撃時、攻撃アニメーションの終了に合わせてダメージが反映されるようにしました。
- **バトルログ拡充**: カードプレイ時、攻撃時、および破壊効果発生時に、どのカードが何をしたかログに残るようにしました。破壊効果で除去された場合はダメージテキストを表示しないようにしました。


## 動作確認の推奨事項
- ゲームを開始し、手札および場のカードに画像が表示されているか確認してください。
- カードをクリックした際の左パネル詳細画面でも正しく画像が表示されるか確認してください。
- **SHOTエフェクトの実装**: `GameScreen.tsx` の `AttackEffect` に、IMPACT等と同様のスプライトアニメーション形式で `'SHOT'` を追加しました。
- **相手デッキの整列**: 相手のデッキが左下方向に向かって重なるようにスタイルを修正しました。

## 確認事項
- [x] Monoの攻撃および効果で 'SHOT' アニメーションが出るか
- [x] saraのトークン獲得演出が11ターン目以降のみか
- [x] 守護等のエフェクトがカードからはみ出して見えるか
- [x] SEPの予測線が紫色になっているか
- [x] 相手デッキが自分と同じ方向（左下）にズレているか
