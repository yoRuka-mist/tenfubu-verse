# Implementation Plan - 05_DigitalCardGame

## 今回の修正 (2024-12-18)

### 1. Git定期コミットルール
- `.agent/workflows/project-rules.md` にプロジェクトルールを追加 (完了)

### 2. レイアウトと座標の修正
- **X座標のズレ修正**: `playEffect`と`playingCardAnim`のX座標計算で、左サイドバー(340px)を考慮するように修正
- **レイアウト構造の修正**: 右側のControls(150px)がFlexレイアウトの中央揃えをずらしていたため、Controlsを`position: absolute`に変更してフィールドが正確に中央に来るように修正
- **Y座標の崩れ修正**: ボードの行コンテナに`minHeight: 130`を追加
- **スロット表示**: 相手ボードが空でもプレースホルダーが表示されるようにUI描画ロジックを調整
- **全体位置調整**: フィールドのpaddingを調整して少し上に移動、プレイヤーHPを5px下に移動 (完了)
- **デッキ表示**: 相手デッキの位置と角度をプレイヤー側と点対称になるように修正 (完了)

### 3. ダメージタイミングの調整
- ダメージ/AOEエフェクトの場合は1200ms待機してからダメージを適用 (完了)

### 4. 機能・ビジュアル修正 (2024-12-18 追加)
- **予測線のズレ**: SVGオーバーレイを`position: fixed`に変更し、描画座標のズレを解消 (完了)
- **守護エフェクト**: `zIndex: 50`を設定し、カードからはみ出るように修正 (完了)
- **コスト軽減**: 「せんか」が場にいる間、手札の「ナックラー」カードのコストを2軽減するロジックを実装。`gameReducer`に手札コスト再計算処理を追加 (完了)
- **SARA攻撃エフェクト**: 'SHOT'エフェクトを3連撃（左下・右上・中央）のアニメーションに変更 (完了)
- ダメージ/AOEエフェクトの場合は1200ms待機してからダメージを適用 (完了)

### 4. カードエフェクトの改善 (Card.tsx)
- **はみ出し表示**: `overflow: visible`でカード外側にエフェクトを表示
- **バリア改善**:
  - ループ時間を3.5秒に変更
  - ピーク時でもぼかし(`blur(2px)`)を維持
  - 内側に青いパルスを追加
- **オーラ改善**:
  - ループ時間を3.0秒に変更 (守護2.5s, バリア3.5sとずらす)
  - `isOnBoard`チェックを追加し、場でのみ表示
  - 十字架を大きく表示(`width: 100%`)
- **守護改善**:
  - ループ時間は2.5秒のまま維持

### 5. 進化時の体力増加
- 緑文字を表示しないように修正 (完了)

---

## 過去の修正

### JSX構造エラーの修正
- `GameScreen.tsx`の1956行目にあった余分な`</div>`タグを削除
- コンポーネント構造を正常化

### 文字化けの修正
- 日本語テキストのエンコーディング問題を修正
