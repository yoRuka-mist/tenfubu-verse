var OI=Object.defineProperty;var LI=t=>{throw TypeError(t)};var DI=(t,e,n)=>e in t?OI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var ln=(t,e,n)=>DI(t,typeof e!="symbol"?e+"":e,n);var va=(t,e,n)=>e.has(t)?LI("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n);function MI(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in t)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function U_(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var B_={exports:{}},_u={},z_={exports:{}},dt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $l=Symbol.for("react.element"),NI=Symbol.for("react.portal"),jI=Symbol.for("react.fragment"),$I=Symbol.for("react.strict_mode"),FI=Symbol.for("react.profiler"),UI=Symbol.for("react.provider"),BI=Symbol.for("react.context"),zI=Symbol.for("react.forward_ref"),HI=Symbol.for("react.suspense"),WI=Symbol.for("react.memo"),GI=Symbol.for("react.lazy"),Wm=Symbol.iterator;function VI(t){return t===null||typeof t!="object"?null:(t=Wm&&t[Wm]||t["@@iterator"],typeof t=="function"?t:null)}var H_={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},W_=Object.assign,G_={};function Ko(t,e,n){this.props=t,this.context=e,this.refs=G_,this.updater=n||H_}Ko.prototype.isReactComponent={};Ko.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Ko.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function V_(){}V_.prototype=Ko.prototype;function eg(t,e,n){this.props=t,this.context=e,this.refs=G_,this.updater=n||H_}var tg=eg.prototype=new V_;tg.constructor=eg;W_(tg,Ko.prototype);tg.isPureReactComponent=!0;var Gm=Array.isArray,Y_=Object.prototype.hasOwnProperty,ng={current:null},K_={key:!0,ref:!0,__self:!0,__source:!0};function X_(t,e,n){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)Y_.call(e,r)&&!K_.hasOwnProperty(r)&&(s[r]=e[r]);var l=arguments.length-2;if(l===1)s.children=n;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];s.children=c}if(t&&t.defaultProps)for(r in l=t.defaultProps,l)s[r]===void 0&&(s[r]=l[r]);return{$$typeof:$l,type:t,key:i,ref:o,props:s,_owner:ng.current}}function YI(t,e){return{$$typeof:$l,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function rg(t){return typeof t=="object"&&t!==null&&t.$$typeof===$l}function KI(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Vm=/\/+/g;function $f(t,e){return typeof t=="object"&&t!==null&&t.key!=null?KI(""+t.key):e.toString(36)}function qc(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case $l:case NI:o=!0}}if(o)return o=t,s=s(o),t=r===""?"."+$f(o,0):r,Gm(s)?(n="",t!=null&&(n=t.replace(Vm,"$&/")+"/"),qc(s,e,n,"",function(d){return d})):s!=null&&(rg(s)&&(s=YI(s,n+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(Vm,"$&/")+"/")+t)),e.push(s)),1;if(o=0,r=r===""?".":r+":",Gm(t))for(var l=0;l<t.length;l++){i=t[l];var c=r+$f(i,l);o+=qc(i,e,n,c,s)}else if(c=VI(t),typeof c=="function")for(t=c.call(t),l=0;!(i=t.next()).done;)i=i.value,c=r+$f(i,l++),o+=qc(i,e,n,c,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function wc(t,e,n){if(t==null)return t;var r=[],s=0;return qc(t,r,"","",function(i){return e.call(n,i,s++)}),r}function XI(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var An={current:null},Zc={transition:null},QI={ReactCurrentDispatcher:An,ReactCurrentBatchConfig:Zc,ReactCurrentOwner:ng};function Q_(){throw Error("act(...) is not supported in production builds of React.")}dt.Children={map:wc,forEach:function(t,e,n){wc(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return wc(t,function(){e++}),e},toArray:function(t){return wc(t,function(e){return e})||[]},only:function(t){if(!rg(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};dt.Component=Ko;dt.Fragment=jI;dt.Profiler=FI;dt.PureComponent=eg;dt.StrictMode=$I;dt.Suspense=HI;dt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=QI;dt.act=Q_;dt.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=W_({},t.props),s=t.key,i=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=ng.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(c in e)Y_.call(e,c)&&!K_.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&l!==void 0?l[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];r.children=l}return{$$typeof:$l,type:t.type,key:s,ref:i,props:r,_owner:o}};dt.createContext=function(t){return t={$$typeof:BI,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:UI,_context:t},t.Consumer=t};dt.createElement=X_;dt.createFactory=function(t){var e=X_.bind(null,t);return e.type=t,e};dt.createRef=function(){return{current:null}};dt.forwardRef=function(t){return{$$typeof:zI,render:t}};dt.isValidElement=rg;dt.lazy=function(t){return{$$typeof:GI,_payload:{_status:-1,_result:t},_init:XI}};dt.memo=function(t,e){return{$$typeof:WI,type:t,compare:e===void 0?null:e}};dt.startTransition=function(t){var e=Zc.transition;Zc.transition={};try{t()}finally{Zc.transition=e}};dt.unstable_act=Q_;dt.useCallback=function(t,e){return An.current.useCallback(t,e)};dt.useContext=function(t){return An.current.useContext(t)};dt.useDebugValue=function(){};dt.useDeferredValue=function(t){return An.current.useDeferredValue(t)};dt.useEffect=function(t,e){return An.current.useEffect(t,e)};dt.useId=function(){return An.current.useId()};dt.useImperativeHandle=function(t,e,n){return An.current.useImperativeHandle(t,e,n)};dt.useInsertionEffect=function(t,e){return An.current.useInsertionEffect(t,e)};dt.useLayoutEffect=function(t,e){return An.current.useLayoutEffect(t,e)};dt.useMemo=function(t,e){return An.current.useMemo(t,e)};dt.useReducer=function(t,e,n){return An.current.useReducer(t,e,n)};dt.useRef=function(t){return An.current.useRef(t)};dt.useState=function(t){return An.current.useState(t)};dt.useSyncExternalStore=function(t,e,n){return An.current.useSyncExternalStore(t,e,n)};dt.useTransition=function(){return An.current.useTransition()};dt.version="18.3.1";z_.exports=dt;var O=z_.exports;const N=U_(O);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var JI=O,qI=Symbol.for("react.element"),ZI=Symbol.for("react.fragment"),eT=Object.prototype.hasOwnProperty,tT=JI.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,nT={key:!0,ref:!0,__self:!0,__source:!0};function J_(t,e,n){var r,s={},i=null,o=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)eT.call(e,r)&&!nT.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:qI,type:t,key:i,ref:o,props:s,_owner:tT.current}}_u.Fragment=ZI;_u.jsx=J_;_u.jsxs=J_;B_.exports=_u;var a=B_.exports,Ch={},q_={exports:{}},Kn={},Z_={exports:{}},ex={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(y,g){var I=y.length;y.push(g);e:for(;0<I;){var A=I-1>>>1,D=y[A];if(0<s(D,g))y[A]=g,y[I]=D,I=A;else break e}}function n(y){return y.length===0?null:y[0]}function r(y){if(y.length===0)return null;var g=y[0],I=y.pop();if(I!==g){y[0]=I;e:for(var A=0,D=y.length,J=D>>>1;A<J;){var U=2*(A+1)-1,ge=y[U],G=U+1,Ie=y[G];if(0>s(ge,I))G<D&&0>s(Ie,ge)?(y[A]=Ie,y[G]=I,A=G):(y[A]=ge,y[U]=I,A=U);else if(G<D&&0>s(Ie,I))y[A]=Ie,y[G]=I,A=G;else break e}}return g}function s(y,g){var I=y.sortIndex-g.sortIndex;return I!==0?I:y.id-g.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],d=[],u=1,h=null,f=3,x=!1,k=!1,T=!1,j=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function S(y){for(var g=n(d);g!==null;){if(g.callback===null)r(d);else if(g.startTime<=y)r(d),g.sortIndex=g.expirationTime,e(c,g);else break;g=n(d)}}function p(y){if(T=!1,S(y),!k)if(n(c)!==null)k=!0,C(F);else{var g=n(d);g!==null&&R(p,g.startTime-y)}}function F(y,g){k=!1,T&&(T=!1,b(W),W=-1),x=!0;var I=f;try{for(S(g),h=n(c);h!==null&&(!(h.expirationTime>g)||y&&!ve());){var A=h.callback;if(typeof A=="function"){h.callback=null,f=h.priorityLevel;var D=A(h.expirationTime<=g);g=t.unstable_now(),typeof D=="function"?h.callback=D:h===n(c)&&r(c),S(g)}else r(c);h=n(c)}if(h!==null)var J=!0;else{var U=n(d);U!==null&&R(p,U.startTime-g),J=!1}return J}finally{h=null,f=I,x=!1}}var H=!1,z=null,W=-1,q=5,de=-1;function ve(){return!(t.unstable_now()-de<q)}function Ne(){if(z!==null){var y=t.unstable_now();de=y;var g=!0;try{g=z(!0,y)}finally{g?ue():(H=!1,z=null)}}else H=!1}var ue;if(typeof v=="function")ue=function(){v(Ne)};else if(typeof MessageChannel<"u"){var w=new MessageChannel,L=w.port2;w.port1.onmessage=Ne,ue=function(){L.postMessage(null)}}else ue=function(){j(Ne,0)};function C(y){z=y,H||(H=!0,ue())}function R(y,g){W=j(function(){y(t.unstable_now())},g)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(y){y.callback=null},t.unstable_continueExecution=function(){k||x||(k=!0,C(F))},t.unstable_forceFrameRate=function(y){0>y||125<y?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):q=0<y?Math.floor(1e3/y):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(y){switch(f){case 1:case 2:case 3:var g=3;break;default:g=f}var I=f;f=g;try{return y()}finally{f=I}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(y,g){switch(y){case 1:case 2:case 3:case 4:case 5:break;default:y=3}var I=f;f=y;try{return g()}finally{f=I}},t.unstable_scheduleCallback=function(y,g,I){var A=t.unstable_now();switch(typeof I=="object"&&I!==null?(I=I.delay,I=typeof I=="number"&&0<I?A+I:A):I=A,y){case 1:var D=-1;break;case 2:D=250;break;case 5:D=1073741823;break;case 4:D=1e4;break;default:D=5e3}return D=I+D,y={id:u++,callback:g,priorityLevel:y,startTime:I,expirationTime:D,sortIndex:-1},I>A?(y.sortIndex=I,e(d,y),n(c)===null&&y===n(d)&&(T?(b(W),W=-1):T=!0,R(p,I-A))):(y.sortIndex=D,e(c,y),k||x||(k=!0,C(F))),y},t.unstable_shouldYield=ve,t.unstable_wrapCallback=function(y){var g=f;return function(){var I=f;f=g;try{return y.apply(this,arguments)}finally{f=I}}}})(ex);Z_.exports=ex;var rT=Z_.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sT=O,Vn=rT;function ce(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var tx=new Set,al={};function Mi(t,e){Lo(t,e),Lo(t+"Capture",e)}function Lo(t,e){for(al[t]=e,t=0;t<e.length;t++)tx.add(e[t])}var rs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),kh=Object.prototype.hasOwnProperty,iT=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Ym={},Km={};function oT(t){return kh.call(Km,t)?!0:kh.call(Ym,t)?!1:iT.test(t)?Km[t]=!0:(Ym[t]=!0,!1)}function aT(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function lT(t,e,n,r){if(e===null||typeof e>"u"||aT(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Pn(t,e,n,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var fn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){fn[t]=new Pn(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];fn[e]=new Pn(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){fn[t]=new Pn(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){fn[t]=new Pn(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){fn[t]=new Pn(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){fn[t]=new Pn(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){fn[t]=new Pn(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){fn[t]=new Pn(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){fn[t]=new Pn(t,5,!1,t.toLowerCase(),null,!1,!1)});var sg=/[\-:]([a-z])/g;function ig(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(sg,ig);fn[e]=new Pn(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(sg,ig);fn[e]=new Pn(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(sg,ig);fn[e]=new Pn(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){fn[t]=new Pn(t,1,!1,t.toLowerCase(),null,!1,!1)});fn.xlinkHref=new Pn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){fn[t]=new Pn(t,1,!1,t.toLowerCase(),null,!0,!0)});function og(t,e,n,r){var s=fn.hasOwnProperty(e)?fn[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(lT(e,n,s,r)&&(n=null),r||s===null?oT(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var ds=sT.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Cc=Symbol.for("react.element"),io=Symbol.for("react.portal"),oo=Symbol.for("react.fragment"),ag=Symbol.for("react.strict_mode"),Rh=Symbol.for("react.profiler"),nx=Symbol.for("react.provider"),rx=Symbol.for("react.context"),lg=Symbol.for("react.forward_ref"),Ah=Symbol.for("react.suspense"),Ph=Symbol.for("react.suspense_list"),cg=Symbol.for("react.memo"),bs=Symbol.for("react.lazy"),sx=Symbol.for("react.offscreen"),Xm=Symbol.iterator;function _a(t){return t===null||typeof t!="object"?null:(t=Xm&&t[Xm]||t["@@iterator"],typeof t=="function"?t:null)}var Ut=Object.assign,Ff;function Da(t){if(Ff===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Ff=e&&e[1]||""}return`
`+Ff+t}var Uf=!1;function Bf(t,e){if(!t||Uf)return"";Uf=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var r=d}Reflect.construct(t,[],e)}else{try{e.call()}catch(d){r=d}t.call(e.prototype)}else{try{throw Error()}catch(d){r=d}t()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var s=d.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,l=i.length-1;1<=o&&0<=l&&s[o]!==i[l];)l--;for(;1<=o&&0<=l;o--,l--)if(s[o]!==i[l]){if(o!==1||l!==1)do if(o--,l--,0>l||s[o]!==i[l]){var c=`
`+s[o].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=o&&0<=l);break}}}finally{Uf=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Da(t):""}function cT(t){switch(t.tag){case 5:return Da(t.type);case 16:return Da("Lazy");case 13:return Da("Suspense");case 19:return Da("SuspenseList");case 0:case 2:case 15:return t=Bf(t.type,!1),t;case 11:return t=Bf(t.type.render,!1),t;case 1:return t=Bf(t.type,!0),t;default:return""}}function Oh(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case oo:return"Fragment";case io:return"Portal";case Rh:return"Profiler";case ag:return"StrictMode";case Ah:return"Suspense";case Ph:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case rx:return(t.displayName||"Context")+".Consumer";case nx:return(t._context.displayName||"Context")+".Provider";case lg:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case cg:return e=t.displayName||null,e!==null?e:Oh(t.type)||"Memo";case bs:e=t._payload,t=t._init;try{return Oh(t(e))}catch{}}return null}function dT(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Oh(e);case 8:return e===ag?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Ks(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function ix(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function uT(t){var e=ix(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function kc(t){t._valueTracker||(t._valueTracker=uT(t))}function ox(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=ix(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Sd(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Lh(t,e){var n=e.checked;return Ut({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Qm(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Ks(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function ax(t,e){e=e.checked,e!=null&&og(t,"checked",e,!1)}function Dh(t,e){ax(t,e);var n=Ks(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Mh(t,e.type,n):e.hasOwnProperty("defaultValue")&&Mh(t,e.type,Ks(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Jm(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Mh(t,e,n){(e!=="number"||Sd(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Ma=Array.isArray;function xo(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Ks(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function Nh(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ce(91));return Ut({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function qm(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(ce(92));if(Ma(n)){if(1<n.length)throw Error(ce(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Ks(n)}}function lx(t,e){var n=Ks(e.value),r=Ks(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function Zm(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function cx(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function jh(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?cx(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Rc,dx=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Rc=Rc||document.createElement("div"),Rc.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Rc.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function ll(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Ba={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},fT=["Webkit","ms","Moz","O"];Object.keys(Ba).forEach(function(t){fT.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Ba[e]=Ba[t]})});function ux(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Ba.hasOwnProperty(t)&&Ba[t]?(""+e).trim():e+"px"}function fx(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=ux(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var hT=Ut({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function $h(t,e){if(e){if(hT[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ce(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ce(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ce(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ce(62))}}function Fh(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Uh=null;function dg(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Bh=null,bo=null,Eo=null;function ey(t){if(t=Bl(t)){if(typeof Bh!="function")throw Error(ce(280));var e=t.stateNode;e&&(e=Iu(e),Bh(t.stateNode,t.type,e))}}function hx(t){bo?Eo?Eo.push(t):Eo=[t]:bo=t}function px(){if(bo){var t=bo,e=Eo;if(Eo=bo=null,ey(t),e)for(t=0;t<e.length;t++)ey(e[t])}}function gx(t,e){return t(e)}function mx(){}var zf=!1;function yx(t,e,n){if(zf)return t(e,n);zf=!0;try{return gx(t,e,n)}finally{zf=!1,(bo!==null||Eo!==null)&&(mx(),px())}}function cl(t,e){var n=t.stateNode;if(n===null)return null;var r=Iu(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(ce(231,e,typeof n));return n}var zh=!1;if(rs)try{var xa={};Object.defineProperty(xa,"passive",{get:function(){zh=!0}}),window.addEventListener("test",xa,xa),window.removeEventListener("test",xa,xa)}catch{zh=!1}function pT(t,e,n,r,s,i,o,l,c){var d=Array.prototype.slice.call(arguments,3);try{e.apply(n,d)}catch(u){this.onError(u)}}var za=!1,Id=null,Td=!1,Hh=null,gT={onError:function(t){za=!0,Id=t}};function mT(t,e,n,r,s,i,o,l,c){za=!1,Id=null,pT.apply(gT,arguments)}function yT(t,e,n,r,s,i,o,l,c){if(mT.apply(this,arguments),za){if(za){var d=Id;za=!1,Id=null}else throw Error(ce(198));Td||(Td=!0,Hh=d)}}function Ni(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function vx(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function ty(t){if(Ni(t)!==t)throw Error(ce(188))}function vT(t){var e=t.alternate;if(!e){if(e=Ni(t),e===null)throw Error(ce(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return ty(s),t;if(i===r)return ty(s),e;i=i.sibling}throw Error(ce(188))}if(n.return!==r.return)n=s,r=i;else{for(var o=!1,l=s.child;l;){if(l===n){o=!0,n=s,r=i;break}if(l===r){o=!0,r=s,n=i;break}l=l.sibling}if(!o){for(l=i.child;l;){if(l===n){o=!0,n=i,r=s;break}if(l===r){o=!0,r=i,n=s;break}l=l.sibling}if(!o)throw Error(ce(189))}}if(n.alternate!==r)throw Error(ce(190))}if(n.tag!==3)throw Error(ce(188));return n.stateNode.current===n?t:e}function _x(t){return t=vT(t),t!==null?xx(t):null}function xx(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=xx(t);if(e!==null)return e;t=t.sibling}return null}var bx=Vn.unstable_scheduleCallback,ny=Vn.unstable_cancelCallback,_T=Vn.unstable_shouldYield,xT=Vn.unstable_requestPaint,Ht=Vn.unstable_now,bT=Vn.unstable_getCurrentPriorityLevel,ug=Vn.unstable_ImmediatePriority,Ex=Vn.unstable_UserBlockingPriority,wd=Vn.unstable_NormalPriority,ET=Vn.unstable_LowPriority,Sx=Vn.unstable_IdlePriority,xu=null,Nr=null;function ST(t){if(Nr&&typeof Nr.onCommitFiberRoot=="function")try{Nr.onCommitFiberRoot(xu,t,void 0,(t.current.flags&128)===128)}catch{}}var vr=Math.clz32?Math.clz32:wT,IT=Math.log,TT=Math.LN2;function wT(t){return t>>>=0,t===0?32:31-(IT(t)/TT|0)|0}var Ac=64,Pc=4194304;function Na(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Cd(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,o=n&268435455;if(o!==0){var l=o&~s;l!==0?r=Na(l):(i&=o,i!==0&&(r=Na(i)))}else o=n&~s,o!==0?r=Na(o):i!==0&&(r=Na(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-vr(e),s=1<<n,r|=t[n],e&=~s;return r}function CT(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function kT(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var o=31-vr(i),l=1<<o,c=s[o];c===-1?(!(l&n)||l&r)&&(s[o]=CT(l,e)):c<=e&&(t.expiredLanes|=l),i&=~l}}function Wh(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Ix(){var t=Ac;return Ac<<=1,!(Ac&4194240)&&(Ac=64),t}function Hf(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Fl(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-vr(e),t[e]=n}function RT(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-vr(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function fg(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-vr(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var bt=0;function Tx(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var wx,hg,Cx,kx,Rx,Gh=!1,Oc=[],Ds=null,Ms=null,Ns=null,dl=new Map,ul=new Map,Ss=[],AT="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ry(t,e){switch(t){case"focusin":case"focusout":Ds=null;break;case"dragenter":case"dragleave":Ms=null;break;case"mouseover":case"mouseout":Ns=null;break;case"pointerover":case"pointerout":dl.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ul.delete(e.pointerId)}}function ba(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=Bl(e),e!==null&&hg(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function PT(t,e,n,r,s){switch(e){case"focusin":return Ds=ba(Ds,t,e,n,r,s),!0;case"dragenter":return Ms=ba(Ms,t,e,n,r,s),!0;case"mouseover":return Ns=ba(Ns,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return dl.set(i,ba(dl.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,ul.set(i,ba(ul.get(i)||null,t,e,n,r,s)),!0}return!1}function Ax(t){var e=yi(t.target);if(e!==null){var n=Ni(e);if(n!==null){if(e=n.tag,e===13){if(e=vx(n),e!==null){t.blockedOn=e,Rx(t.priority,function(){Cx(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function ed(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Vh(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);Uh=r,n.target.dispatchEvent(r),Uh=null}else return e=Bl(n),e!==null&&hg(e),t.blockedOn=n,!1;e.shift()}return!0}function sy(t,e,n){ed(t)&&n.delete(e)}function OT(){Gh=!1,Ds!==null&&ed(Ds)&&(Ds=null),Ms!==null&&ed(Ms)&&(Ms=null),Ns!==null&&ed(Ns)&&(Ns=null),dl.forEach(sy),ul.forEach(sy)}function Ea(t,e){t.blockedOn===e&&(t.blockedOn=null,Gh||(Gh=!0,Vn.unstable_scheduleCallback(Vn.unstable_NormalPriority,OT)))}function fl(t){function e(s){return Ea(s,t)}if(0<Oc.length){Ea(Oc[0],t);for(var n=1;n<Oc.length;n++){var r=Oc[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Ds!==null&&Ea(Ds,t),Ms!==null&&Ea(Ms,t),Ns!==null&&Ea(Ns,t),dl.forEach(e),ul.forEach(e),n=0;n<Ss.length;n++)r=Ss[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Ss.length&&(n=Ss[0],n.blockedOn===null);)Ax(n),n.blockedOn===null&&Ss.shift()}var So=ds.ReactCurrentBatchConfig,kd=!0;function LT(t,e,n,r){var s=bt,i=So.transition;So.transition=null;try{bt=1,pg(t,e,n,r)}finally{bt=s,So.transition=i}}function DT(t,e,n,r){var s=bt,i=So.transition;So.transition=null;try{bt=4,pg(t,e,n,r)}finally{bt=s,So.transition=i}}function pg(t,e,n,r){if(kd){var s=Vh(t,e,n,r);if(s===null)Zf(t,e,r,Rd,n),ry(t,r);else if(PT(s,t,e,n,r))r.stopPropagation();else if(ry(t,r),e&4&&-1<AT.indexOf(t)){for(;s!==null;){var i=Bl(s);if(i!==null&&wx(i),i=Vh(t,e,n,r),i===null&&Zf(t,e,r,Rd,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else Zf(t,e,r,null,n)}}var Rd=null;function Vh(t,e,n,r){if(Rd=null,t=dg(r),t=yi(t),t!==null)if(e=Ni(t),e===null)t=null;else if(n=e.tag,n===13){if(t=vx(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Rd=t,null}function Px(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(bT()){case ug:return 1;case Ex:return 4;case wd:case ET:return 16;case Sx:return 536870912;default:return 16}default:return 16}}var Rs=null,gg=null,td=null;function Ox(){if(td)return td;var t,e=gg,n=e.length,r,s="value"in Rs?Rs.value:Rs.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===s[i-r];r++);return td=s.slice(t,1<r?1-r:void 0)}function nd(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Lc(){return!0}function iy(){return!1}function Xn(t){function e(n,r,s,i,o){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(i):i[l]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Lc:iy,this.isPropagationStopped=iy,this}return Ut(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Lc)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Lc)},persist:function(){},isPersistent:Lc}),e}var Xo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},mg=Xn(Xo),Ul=Ut({},Xo,{view:0,detail:0}),MT=Xn(Ul),Wf,Gf,Sa,bu=Ut({},Ul,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:yg,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Sa&&(Sa&&t.type==="mousemove"?(Wf=t.screenX-Sa.screenX,Gf=t.screenY-Sa.screenY):Gf=Wf=0,Sa=t),Wf)},movementY:function(t){return"movementY"in t?t.movementY:Gf}}),oy=Xn(bu),NT=Ut({},bu,{dataTransfer:0}),jT=Xn(NT),$T=Ut({},Ul,{relatedTarget:0}),Vf=Xn($T),FT=Ut({},Xo,{animationName:0,elapsedTime:0,pseudoElement:0}),UT=Xn(FT),BT=Ut({},Xo,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),zT=Xn(BT),HT=Ut({},Xo,{data:0}),ay=Xn(HT),WT={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},GT={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},VT={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function YT(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=VT[t])?!!e[t]:!1}function yg(){return YT}var KT=Ut({},Ul,{key:function(t){if(t.key){var e=WT[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=nd(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?GT[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:yg,charCode:function(t){return t.type==="keypress"?nd(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?nd(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),XT=Xn(KT),QT=Ut({},bu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ly=Xn(QT),JT=Ut({},Ul,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:yg}),qT=Xn(JT),ZT=Ut({},Xo,{propertyName:0,elapsedTime:0,pseudoElement:0}),ew=Xn(ZT),tw=Ut({},bu,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),nw=Xn(tw),rw=[9,13,27,32],vg=rs&&"CompositionEvent"in window,Ha=null;rs&&"documentMode"in document&&(Ha=document.documentMode);var sw=rs&&"TextEvent"in window&&!Ha,Lx=rs&&(!vg||Ha&&8<Ha&&11>=Ha),cy=" ",dy=!1;function Dx(t,e){switch(t){case"keyup":return rw.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Mx(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var ao=!1;function iw(t,e){switch(t){case"compositionend":return Mx(e);case"keypress":return e.which!==32?null:(dy=!0,cy);case"textInput":return t=e.data,t===cy&&dy?null:t;default:return null}}function ow(t,e){if(ao)return t==="compositionend"||!vg&&Dx(t,e)?(t=Ox(),td=gg=Rs=null,ao=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Lx&&e.locale!=="ko"?null:e.data;default:return null}}var aw={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function uy(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!aw[t.type]:e==="textarea"}function Nx(t,e,n,r){hx(r),e=Ad(e,"onChange"),0<e.length&&(n=new mg("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Wa=null,hl=null;function lw(t){Yx(t,0)}function Eu(t){var e=uo(t);if(ox(e))return t}function cw(t,e){if(t==="change")return e}var jx=!1;if(rs){var Yf;if(rs){var Kf="oninput"in document;if(!Kf){var fy=document.createElement("div");fy.setAttribute("oninput","return;"),Kf=typeof fy.oninput=="function"}Yf=Kf}else Yf=!1;jx=Yf&&(!document.documentMode||9<document.documentMode)}function hy(){Wa&&(Wa.detachEvent("onpropertychange",$x),hl=Wa=null)}function $x(t){if(t.propertyName==="value"&&Eu(hl)){var e=[];Nx(e,hl,t,dg(t)),yx(lw,e)}}function dw(t,e,n){t==="focusin"?(hy(),Wa=e,hl=n,Wa.attachEvent("onpropertychange",$x)):t==="focusout"&&hy()}function uw(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Eu(hl)}function fw(t,e){if(t==="click")return Eu(e)}function hw(t,e){if(t==="input"||t==="change")return Eu(e)}function pw(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var br=typeof Object.is=="function"?Object.is:pw;function pl(t,e){if(br(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!kh.call(e,s)||!br(t[s],e[s]))return!1}return!0}function py(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function gy(t,e){var n=py(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=py(n)}}function Fx(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?Fx(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Ux(){for(var t=window,e=Sd();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Sd(t.document)}return e}function _g(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function gw(t){var e=Ux(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&Fx(n.ownerDocument.documentElement,n)){if(r!==null&&_g(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=gy(n,i);var o=gy(n,r);s&&o&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var mw=rs&&"documentMode"in document&&11>=document.documentMode,lo=null,Yh=null,Ga=null,Kh=!1;function my(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Kh||lo==null||lo!==Sd(r)||(r=lo,"selectionStart"in r&&_g(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Ga&&pl(Ga,r)||(Ga=r,r=Ad(Yh,"onSelect"),0<r.length&&(e=new mg("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=lo)))}function Dc(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var co={animationend:Dc("Animation","AnimationEnd"),animationiteration:Dc("Animation","AnimationIteration"),animationstart:Dc("Animation","AnimationStart"),transitionend:Dc("Transition","TransitionEnd")},Xf={},Bx={};rs&&(Bx=document.createElement("div").style,"AnimationEvent"in window||(delete co.animationend.animation,delete co.animationiteration.animation,delete co.animationstart.animation),"TransitionEvent"in window||delete co.transitionend.transition);function Su(t){if(Xf[t])return Xf[t];if(!co[t])return t;var e=co[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in Bx)return Xf[t]=e[n];return t}var zx=Su("animationend"),Hx=Su("animationiteration"),Wx=Su("animationstart"),Gx=Su("transitionend"),Vx=new Map,yy="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ti(t,e){Vx.set(t,e),Mi(e,[t])}for(var Qf=0;Qf<yy.length;Qf++){var Jf=yy[Qf],yw=Jf.toLowerCase(),vw=Jf[0].toUpperCase()+Jf.slice(1);ti(yw,"on"+vw)}ti(zx,"onAnimationEnd");ti(Hx,"onAnimationIteration");ti(Wx,"onAnimationStart");ti("dblclick","onDoubleClick");ti("focusin","onFocus");ti("focusout","onBlur");ti(Gx,"onTransitionEnd");Lo("onMouseEnter",["mouseout","mouseover"]);Lo("onMouseLeave",["mouseout","mouseover"]);Lo("onPointerEnter",["pointerout","pointerover"]);Lo("onPointerLeave",["pointerout","pointerover"]);Mi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Mi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Mi("onBeforeInput",["compositionend","keypress","textInput","paste"]);Mi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Mi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Mi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ja="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),_w=new Set("cancel close invalid load scroll toggle".split(" ").concat(ja));function vy(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,yT(r,e,void 0,t),t.currentTarget=null}function Yx(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var l=r[o],c=l.instance,d=l.currentTarget;if(l=l.listener,c!==i&&s.isPropagationStopped())break e;vy(s,l,d),i=c}else for(o=0;o<r.length;o++){if(l=r[o],c=l.instance,d=l.currentTarget,l=l.listener,c!==i&&s.isPropagationStopped())break e;vy(s,l,d),i=c}}}if(Td)throw t=Hh,Td=!1,Hh=null,t}function At(t,e){var n=e[Zh];n===void 0&&(n=e[Zh]=new Set);var r=t+"__bubble";n.has(r)||(Kx(e,t,2,!1),n.add(r))}function qf(t,e,n){var r=0;e&&(r|=4),Kx(n,t,r,e)}var Mc="_reactListening"+Math.random().toString(36).slice(2);function gl(t){if(!t[Mc]){t[Mc]=!0,tx.forEach(function(n){n!=="selectionchange"&&(_w.has(n)||qf(n,!1,t),qf(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Mc]||(e[Mc]=!0,qf("selectionchange",!1,e))}}function Kx(t,e,n,r){switch(Px(e)){case 1:var s=LT;break;case 4:s=DT;break;default:s=pg}n=s.bind(null,e,n,t),s=void 0,!zh||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function Zf(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var l=r.stateNode.containerInfo;if(l===s||l.nodeType===8&&l.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===s||c.nodeType===8&&c.parentNode===s))return;o=o.return}for(;l!==null;){if(o=yi(l),o===null)return;if(c=o.tag,c===5||c===6){r=i=o;continue e}l=l.parentNode}}r=r.return}yx(function(){var d=i,u=dg(n),h=[];e:{var f=Vx.get(t);if(f!==void 0){var x=mg,k=t;switch(t){case"keypress":if(nd(n)===0)break e;case"keydown":case"keyup":x=XT;break;case"focusin":k="focus",x=Vf;break;case"focusout":k="blur",x=Vf;break;case"beforeblur":case"afterblur":x=Vf;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":x=oy;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":x=jT;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":x=qT;break;case zx:case Hx:case Wx:x=UT;break;case Gx:x=ew;break;case"scroll":x=MT;break;case"wheel":x=nw;break;case"copy":case"cut":case"paste":x=zT;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":x=ly}var T=(e&4)!==0,j=!T&&t==="scroll",b=T?f!==null?f+"Capture":null:f;T=[];for(var v=d,S;v!==null;){S=v;var p=S.stateNode;if(S.tag===5&&p!==null&&(S=p,b!==null&&(p=cl(v,b),p!=null&&T.push(ml(v,p,S)))),j)break;v=v.return}0<T.length&&(f=new x(f,k,null,n,u),h.push({event:f,listeners:T}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",x=t==="mouseout"||t==="pointerout",f&&n!==Uh&&(k=n.relatedTarget||n.fromElement)&&(yi(k)||k[ss]))break e;if((x||f)&&(f=u.window===u?u:(f=u.ownerDocument)?f.defaultView||f.parentWindow:window,x?(k=n.relatedTarget||n.toElement,x=d,k=k?yi(k):null,k!==null&&(j=Ni(k),k!==j||k.tag!==5&&k.tag!==6)&&(k=null)):(x=null,k=d),x!==k)){if(T=oy,p="onMouseLeave",b="onMouseEnter",v="mouse",(t==="pointerout"||t==="pointerover")&&(T=ly,p="onPointerLeave",b="onPointerEnter",v="pointer"),j=x==null?f:uo(x),S=k==null?f:uo(k),f=new T(p,v+"leave",x,n,u),f.target=j,f.relatedTarget=S,p=null,yi(u)===d&&(T=new T(b,v+"enter",k,n,u),T.target=S,T.relatedTarget=j,p=T),j=p,x&&k)t:{for(T=x,b=k,v=0,S=T;S;S=to(S))v++;for(S=0,p=b;p;p=to(p))S++;for(;0<v-S;)T=to(T),v--;for(;0<S-v;)b=to(b),S--;for(;v--;){if(T===b||b!==null&&T===b.alternate)break t;T=to(T),b=to(b)}T=null}else T=null;x!==null&&_y(h,f,x,T,!1),k!==null&&j!==null&&_y(h,j,k,T,!0)}}e:{if(f=d?uo(d):window,x=f.nodeName&&f.nodeName.toLowerCase(),x==="select"||x==="input"&&f.type==="file")var F=cw;else if(uy(f))if(jx)F=hw;else{F=uw;var H=dw}else(x=f.nodeName)&&x.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(F=fw);if(F&&(F=F(t,d))){Nx(h,F,n,u);break e}H&&H(t,f,d),t==="focusout"&&(H=f._wrapperState)&&H.controlled&&f.type==="number"&&Mh(f,"number",f.value)}switch(H=d?uo(d):window,t){case"focusin":(uy(H)||H.contentEditable==="true")&&(lo=H,Yh=d,Ga=null);break;case"focusout":Ga=Yh=lo=null;break;case"mousedown":Kh=!0;break;case"contextmenu":case"mouseup":case"dragend":Kh=!1,my(h,n,u);break;case"selectionchange":if(mw)break;case"keydown":case"keyup":my(h,n,u)}var z;if(vg)e:{switch(t){case"compositionstart":var W="onCompositionStart";break e;case"compositionend":W="onCompositionEnd";break e;case"compositionupdate":W="onCompositionUpdate";break e}W=void 0}else ao?Dx(t,n)&&(W="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(W="onCompositionStart");W&&(Lx&&n.locale!=="ko"&&(ao||W!=="onCompositionStart"?W==="onCompositionEnd"&&ao&&(z=Ox()):(Rs=u,gg="value"in Rs?Rs.value:Rs.textContent,ao=!0)),H=Ad(d,W),0<H.length&&(W=new ay(W,t,null,n,u),h.push({event:W,listeners:H}),z?W.data=z:(z=Mx(n),z!==null&&(W.data=z)))),(z=sw?iw(t,n):ow(t,n))&&(d=Ad(d,"onBeforeInput"),0<d.length&&(u=new ay("onBeforeInput","beforeinput",null,n,u),h.push({event:u,listeners:d}),u.data=z))}Yx(h,e)})}function ml(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Ad(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=cl(t,n),i!=null&&r.unshift(ml(t,i,s)),i=cl(t,e),i!=null&&r.push(ml(t,i,s))),t=t.return}return r}function to(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function _y(t,e,n,r,s){for(var i=e._reactName,o=[];n!==null&&n!==r;){var l=n,c=l.alternate,d=l.stateNode;if(c!==null&&c===r)break;l.tag===5&&d!==null&&(l=d,s?(c=cl(n,i),c!=null&&o.unshift(ml(n,c,l))):s||(c=cl(n,i),c!=null&&o.push(ml(n,c,l)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var xw=/\r\n?/g,bw=/\u0000|\uFFFD/g;function xy(t){return(typeof t=="string"?t:""+t).replace(xw,`
`).replace(bw,"")}function Nc(t,e,n){if(e=xy(e),xy(t)!==e&&n)throw Error(ce(425))}function Pd(){}var Xh=null,Qh=null;function Jh(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var qh=typeof setTimeout=="function"?setTimeout:void 0,Ew=typeof clearTimeout=="function"?clearTimeout:void 0,by=typeof Promise=="function"?Promise:void 0,Sw=typeof queueMicrotask=="function"?queueMicrotask:typeof by<"u"?function(t){return by.resolve(null).then(t).catch(Iw)}:qh;function Iw(t){setTimeout(function(){throw t})}function eh(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),fl(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);fl(e)}function js(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Ey(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Qo=Math.random().toString(36).slice(2),Or="__reactFiber$"+Qo,yl="__reactProps$"+Qo,ss="__reactContainer$"+Qo,Zh="__reactEvents$"+Qo,Tw="__reactListeners$"+Qo,ww="__reactHandles$"+Qo;function yi(t){var e=t[Or];if(e)return e;for(var n=t.parentNode;n;){if(e=n[ss]||n[Or]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Ey(t);t!==null;){if(n=t[Or])return n;t=Ey(t)}return e}t=n,n=t.parentNode}return null}function Bl(t){return t=t[Or]||t[ss],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function uo(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(ce(33))}function Iu(t){return t[yl]||null}var ep=[],fo=-1;function ni(t){return{current:t}}function Pt(t){0>fo||(t.current=ep[fo],ep[fo]=null,fo--)}function Rt(t,e){fo++,ep[fo]=t.current,t.current=e}var Xs={},_n=ni(Xs),jn=ni(!1),Si=Xs;function Do(t,e){var n=t.type.contextTypes;if(!n)return Xs;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function $n(t){return t=t.childContextTypes,t!=null}function Od(){Pt(jn),Pt(_n)}function Sy(t,e,n){if(_n.current!==Xs)throw Error(ce(168));Rt(_n,e),Rt(jn,n)}function Xx(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(ce(108,dT(t)||"Unknown",s));return Ut({},n,r)}function Ld(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Xs,Si=_n.current,Rt(_n,t),Rt(jn,jn.current),!0}function Iy(t,e,n){var r=t.stateNode;if(!r)throw Error(ce(169));n?(t=Xx(t,e,Si),r.__reactInternalMemoizedMergedChildContext=t,Pt(jn),Pt(_n),Rt(_n,t)):Pt(jn),Rt(jn,n)}var Yr=null,Tu=!1,th=!1;function Qx(t){Yr===null?Yr=[t]:Yr.push(t)}function Cw(t){Tu=!0,Qx(t)}function ri(){if(!th&&Yr!==null){th=!0;var t=0,e=bt;try{var n=Yr;for(bt=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}Yr=null,Tu=!1}catch(s){throw Yr!==null&&(Yr=Yr.slice(t+1)),bx(ug,ri),s}finally{bt=e,th=!1}}return null}var ho=[],po=0,Dd=null,Md=0,qn=[],Zn=0,Ii=null,Xr=1,Qr="";function fi(t,e){ho[po++]=Md,ho[po++]=Dd,Dd=t,Md=e}function Jx(t,e,n){qn[Zn++]=Xr,qn[Zn++]=Qr,qn[Zn++]=Ii,Ii=t;var r=Xr;t=Qr;var s=32-vr(r)-1;r&=~(1<<s),n+=1;var i=32-vr(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,Xr=1<<32-vr(e)+s|n<<s|r,Qr=i+t}else Xr=1<<i|n<<s|r,Qr=t}function xg(t){t.return!==null&&(fi(t,1),Jx(t,1,0))}function bg(t){for(;t===Dd;)Dd=ho[--po],ho[po]=null,Md=ho[--po],ho[po]=null;for(;t===Ii;)Ii=qn[--Zn],qn[Zn]=null,Qr=qn[--Zn],qn[Zn]=null,Xr=qn[--Zn],qn[Zn]=null}var Gn=null,Wn=null,Dt=!1,hr=null;function qx(t,e){var n=nr(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Ty(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Gn=t,Wn=js(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Gn=t,Wn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Ii!==null?{id:Xr,overflow:Qr}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=nr(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Gn=t,Wn=null,!0):!1;default:return!1}}function tp(t){return(t.mode&1)!==0&&(t.flags&128)===0}function np(t){if(Dt){var e=Wn;if(e){var n=e;if(!Ty(t,e)){if(tp(t))throw Error(ce(418));e=js(n.nextSibling);var r=Gn;e&&Ty(t,e)?qx(r,n):(t.flags=t.flags&-4097|2,Dt=!1,Gn=t)}}else{if(tp(t))throw Error(ce(418));t.flags=t.flags&-4097|2,Dt=!1,Gn=t}}}function wy(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Gn=t}function jc(t){if(t!==Gn)return!1;if(!Dt)return wy(t),Dt=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Jh(t.type,t.memoizedProps)),e&&(e=Wn)){if(tp(t))throw Zx(),Error(ce(418));for(;e;)qx(t,e),e=js(e.nextSibling)}if(wy(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(ce(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Wn=js(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Wn=null}}else Wn=Gn?js(t.stateNode.nextSibling):null;return!0}function Zx(){for(var t=Wn;t;)t=js(t.nextSibling)}function Mo(){Wn=Gn=null,Dt=!1}function Eg(t){hr===null?hr=[t]:hr.push(t)}var kw=ds.ReactCurrentBatchConfig;function Ia(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(ce(309));var r=n.stateNode}if(!r)throw Error(ce(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var l=s.refs;o===null?delete l[i]:l[i]=o},e._stringRef=i,e)}if(typeof t!="string")throw Error(ce(284));if(!n._owner)throw Error(ce(290,t))}return t}function $c(t,e){throw t=Object.prototype.toString.call(e),Error(ce(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Cy(t){var e=t._init;return e(t._payload)}function e1(t){function e(b,v){if(t){var S=b.deletions;S===null?(b.deletions=[v],b.flags|=16):S.push(v)}}function n(b,v){if(!t)return null;for(;v!==null;)e(b,v),v=v.sibling;return null}function r(b,v){for(b=new Map;v!==null;)v.key!==null?b.set(v.key,v):b.set(v.index,v),v=v.sibling;return b}function s(b,v){return b=Bs(b,v),b.index=0,b.sibling=null,b}function i(b,v,S){return b.index=S,t?(S=b.alternate,S!==null?(S=S.index,S<v?(b.flags|=2,v):S):(b.flags|=2,v)):(b.flags|=1048576,v)}function o(b){return t&&b.alternate===null&&(b.flags|=2),b}function l(b,v,S,p){return v===null||v.tag!==6?(v=lh(S,b.mode,p),v.return=b,v):(v=s(v,S),v.return=b,v)}function c(b,v,S,p){var F=S.type;return F===oo?u(b,v,S.props.children,p,S.key):v!==null&&(v.elementType===F||typeof F=="object"&&F!==null&&F.$$typeof===bs&&Cy(F)===v.type)?(p=s(v,S.props),p.ref=Ia(b,v,S),p.return=b,p):(p=cd(S.type,S.key,S.props,null,b.mode,p),p.ref=Ia(b,v,S),p.return=b,p)}function d(b,v,S,p){return v===null||v.tag!==4||v.stateNode.containerInfo!==S.containerInfo||v.stateNode.implementation!==S.implementation?(v=ch(S,b.mode,p),v.return=b,v):(v=s(v,S.children||[]),v.return=b,v)}function u(b,v,S,p,F){return v===null||v.tag!==7?(v=Ei(S,b.mode,p,F),v.return=b,v):(v=s(v,S),v.return=b,v)}function h(b,v,S){if(typeof v=="string"&&v!==""||typeof v=="number")return v=lh(""+v,b.mode,S),v.return=b,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Cc:return S=cd(v.type,v.key,v.props,null,b.mode,S),S.ref=Ia(b,null,v),S.return=b,S;case io:return v=ch(v,b.mode,S),v.return=b,v;case bs:var p=v._init;return h(b,p(v._payload),S)}if(Ma(v)||_a(v))return v=Ei(v,b.mode,S,null),v.return=b,v;$c(b,v)}return null}function f(b,v,S,p){var F=v!==null?v.key:null;if(typeof S=="string"&&S!==""||typeof S=="number")return F!==null?null:l(b,v,""+S,p);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case Cc:return S.key===F?c(b,v,S,p):null;case io:return S.key===F?d(b,v,S,p):null;case bs:return F=S._init,f(b,v,F(S._payload),p)}if(Ma(S)||_a(S))return F!==null?null:u(b,v,S,p,null);$c(b,S)}return null}function x(b,v,S,p,F){if(typeof p=="string"&&p!==""||typeof p=="number")return b=b.get(S)||null,l(v,b,""+p,F);if(typeof p=="object"&&p!==null){switch(p.$$typeof){case Cc:return b=b.get(p.key===null?S:p.key)||null,c(v,b,p,F);case io:return b=b.get(p.key===null?S:p.key)||null,d(v,b,p,F);case bs:var H=p._init;return x(b,v,S,H(p._payload),F)}if(Ma(p)||_a(p))return b=b.get(S)||null,u(v,b,p,F,null);$c(v,p)}return null}function k(b,v,S,p){for(var F=null,H=null,z=v,W=v=0,q=null;z!==null&&W<S.length;W++){z.index>W?(q=z,z=null):q=z.sibling;var de=f(b,z,S[W],p);if(de===null){z===null&&(z=q);break}t&&z&&de.alternate===null&&e(b,z),v=i(de,v,W),H===null?F=de:H.sibling=de,H=de,z=q}if(W===S.length)return n(b,z),Dt&&fi(b,W),F;if(z===null){for(;W<S.length;W++)z=h(b,S[W],p),z!==null&&(v=i(z,v,W),H===null?F=z:H.sibling=z,H=z);return Dt&&fi(b,W),F}for(z=r(b,z);W<S.length;W++)q=x(z,b,W,S[W],p),q!==null&&(t&&q.alternate!==null&&z.delete(q.key===null?W:q.key),v=i(q,v,W),H===null?F=q:H.sibling=q,H=q);return t&&z.forEach(function(ve){return e(b,ve)}),Dt&&fi(b,W),F}function T(b,v,S,p){var F=_a(S);if(typeof F!="function")throw Error(ce(150));if(S=F.call(S),S==null)throw Error(ce(151));for(var H=F=null,z=v,W=v=0,q=null,de=S.next();z!==null&&!de.done;W++,de=S.next()){z.index>W?(q=z,z=null):q=z.sibling;var ve=f(b,z,de.value,p);if(ve===null){z===null&&(z=q);break}t&&z&&ve.alternate===null&&e(b,z),v=i(ve,v,W),H===null?F=ve:H.sibling=ve,H=ve,z=q}if(de.done)return n(b,z),Dt&&fi(b,W),F;if(z===null){for(;!de.done;W++,de=S.next())de=h(b,de.value,p),de!==null&&(v=i(de,v,W),H===null?F=de:H.sibling=de,H=de);return Dt&&fi(b,W),F}for(z=r(b,z);!de.done;W++,de=S.next())de=x(z,b,W,de.value,p),de!==null&&(t&&de.alternate!==null&&z.delete(de.key===null?W:de.key),v=i(de,v,W),H===null?F=de:H.sibling=de,H=de);return t&&z.forEach(function(Ne){return e(b,Ne)}),Dt&&fi(b,W),F}function j(b,v,S,p){if(typeof S=="object"&&S!==null&&S.type===oo&&S.key===null&&(S=S.props.children),typeof S=="object"&&S!==null){switch(S.$$typeof){case Cc:e:{for(var F=S.key,H=v;H!==null;){if(H.key===F){if(F=S.type,F===oo){if(H.tag===7){n(b,H.sibling),v=s(H,S.props.children),v.return=b,b=v;break e}}else if(H.elementType===F||typeof F=="object"&&F!==null&&F.$$typeof===bs&&Cy(F)===H.type){n(b,H.sibling),v=s(H,S.props),v.ref=Ia(b,H,S),v.return=b,b=v;break e}n(b,H);break}else e(b,H);H=H.sibling}S.type===oo?(v=Ei(S.props.children,b.mode,p,S.key),v.return=b,b=v):(p=cd(S.type,S.key,S.props,null,b.mode,p),p.ref=Ia(b,v,S),p.return=b,b=p)}return o(b);case io:e:{for(H=S.key;v!==null;){if(v.key===H)if(v.tag===4&&v.stateNode.containerInfo===S.containerInfo&&v.stateNode.implementation===S.implementation){n(b,v.sibling),v=s(v,S.children||[]),v.return=b,b=v;break e}else{n(b,v);break}else e(b,v);v=v.sibling}v=ch(S,b.mode,p),v.return=b,b=v}return o(b);case bs:return H=S._init,j(b,v,H(S._payload),p)}if(Ma(S))return k(b,v,S,p);if(_a(S))return T(b,v,S,p);$c(b,S)}return typeof S=="string"&&S!==""||typeof S=="number"?(S=""+S,v!==null&&v.tag===6?(n(b,v.sibling),v=s(v,S),v.return=b,b=v):(n(b,v),v=lh(S,b.mode,p),v.return=b,b=v),o(b)):n(b,v)}return j}var No=e1(!0),t1=e1(!1),Nd=ni(null),jd=null,go=null,Sg=null;function Ig(){Sg=go=jd=null}function Tg(t){var e=Nd.current;Pt(Nd),t._currentValue=e}function rp(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function Io(t,e){jd=t,Sg=go=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Mn=!0),t.firstContext=null)}function ir(t){var e=t._currentValue;if(Sg!==t)if(t={context:t,memoizedValue:e,next:null},go===null){if(jd===null)throw Error(ce(308));go=t,jd.dependencies={lanes:0,firstContext:t}}else go=go.next=t;return e}var vi=null;function wg(t){vi===null?vi=[t]:vi.push(t)}function n1(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,wg(e)):(n.next=s.next,s.next=n),e.interleaved=n,is(t,r)}function is(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Es=!1;function Cg(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function r1(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function es(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function $s(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,pt&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,is(t,n)}return s=r.interleaved,s===null?(e.next=e,wg(r)):(e.next=s.next,s.next=e),r.interleaved=e,is(t,n)}function rd(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,fg(t,n)}}function ky(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=o:i=i.next=o,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function $d(t,e,n,r){var s=t.updateQueue;Es=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,l=s.shared.pending;if(l!==null){s.shared.pending=null;var c=l,d=c.next;c.next=null,o===null?i=d:o.next=d,o=c;var u=t.alternate;u!==null&&(u=u.updateQueue,l=u.lastBaseUpdate,l!==o&&(l===null?u.firstBaseUpdate=d:l.next=d,u.lastBaseUpdate=c))}if(i!==null){var h=s.baseState;o=0,u=d=c=null,l=i;do{var f=l.lane,x=l.eventTime;if((r&f)===f){u!==null&&(u=u.next={eventTime:x,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var k=t,T=l;switch(f=e,x=n,T.tag){case 1:if(k=T.payload,typeof k=="function"){h=k.call(x,h,f);break e}h=k;break e;case 3:k.flags=k.flags&-65537|128;case 0:if(k=T.payload,f=typeof k=="function"?k.call(x,h,f):k,f==null)break e;h=Ut({},h,f);break e;case 2:Es=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,f=s.effects,f===null?s.effects=[l]:f.push(l))}else x={eventTime:x,lane:f,tag:l.tag,payload:l.payload,callback:l.callback,next:null},u===null?(d=u=x,c=h):u=u.next=x,o|=f;if(l=l.next,l===null){if(l=s.shared.pending,l===null)break;f=l,l=f.next,f.next=null,s.lastBaseUpdate=f,s.shared.pending=null}}while(!0);if(u===null&&(c=h),s.baseState=c,s.firstBaseUpdate=d,s.lastBaseUpdate=u,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);wi|=o,t.lanes=o,t.memoizedState=h}}function Ry(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(ce(191,s));s.call(r)}}}var zl={},jr=ni(zl),vl=ni(zl),_l=ni(zl);function _i(t){if(t===zl)throw Error(ce(174));return t}function kg(t,e){switch(Rt(_l,e),Rt(vl,t),Rt(jr,zl),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:jh(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=jh(e,t)}Pt(jr),Rt(jr,e)}function jo(){Pt(jr),Pt(vl),Pt(_l)}function s1(t){_i(_l.current);var e=_i(jr.current),n=jh(e,t.type);e!==n&&(Rt(vl,t),Rt(jr,n))}function Rg(t){vl.current===t&&(Pt(jr),Pt(vl))}var Nt=ni(0);function Fd(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var nh=[];function Ag(){for(var t=0;t<nh.length;t++)nh[t]._workInProgressVersionPrimary=null;nh.length=0}var sd=ds.ReactCurrentDispatcher,rh=ds.ReactCurrentBatchConfig,Ti=0,Ft=null,Kt=null,en=null,Ud=!1,Va=!1,xl=0,Rw=0;function gn(){throw Error(ce(321))}function Pg(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!br(t[n],e[n]))return!1;return!0}function Og(t,e,n,r,s,i){if(Ti=i,Ft=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,sd.current=t===null||t.memoizedState===null?Lw:Dw,t=n(r,s),Va){i=0;do{if(Va=!1,xl=0,25<=i)throw Error(ce(301));i+=1,en=Kt=null,e.updateQueue=null,sd.current=Mw,t=n(r,s)}while(Va)}if(sd.current=Bd,e=Kt!==null&&Kt.next!==null,Ti=0,en=Kt=Ft=null,Ud=!1,e)throw Error(ce(300));return t}function Lg(){var t=xl!==0;return xl=0,t}function Pr(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return en===null?Ft.memoizedState=en=t:en=en.next=t,en}function or(){if(Kt===null){var t=Ft.alternate;t=t!==null?t.memoizedState:null}else t=Kt.next;var e=en===null?Ft.memoizedState:en.next;if(e!==null)en=e,Kt=t;else{if(t===null)throw Error(ce(310));Kt=t,t={memoizedState:Kt.memoizedState,baseState:Kt.baseState,baseQueue:Kt.baseQueue,queue:Kt.queue,next:null},en===null?Ft.memoizedState=en=t:en=en.next=t}return en}function bl(t,e){return typeof e=="function"?e(t):e}function sh(t){var e=or(),n=e.queue;if(n===null)throw Error(ce(311));n.lastRenderedReducer=t;var r=Kt,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var l=o=null,c=null,d=i;do{var u=d.lane;if((Ti&u)===u)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:t(r,d.action);else{var h={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(l=c=h,o=r):c=c.next=h,Ft.lanes|=u,wi|=u}d=d.next}while(d!==null&&d!==i);c===null?o=r:c.next=l,br(r,e.memoizedState)||(Mn=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=c,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,Ft.lanes|=i,wi|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function ih(t){var e=or(),n=e.queue;if(n===null)throw Error(ce(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var o=s=s.next;do i=t(i,o.action),o=o.next;while(o!==s);br(i,e.memoizedState)||(Mn=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function i1(){}function o1(t,e){var n=Ft,r=or(),s=e(),i=!br(r.memoizedState,s);if(i&&(r.memoizedState=s,Mn=!0),r=r.queue,Dg(c1.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||en!==null&&en.memoizedState.tag&1){if(n.flags|=2048,El(9,l1.bind(null,n,r,s,e),void 0,null),rn===null)throw Error(ce(349));Ti&30||a1(n,e,s)}return s}function a1(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Ft.updateQueue,e===null?(e={lastEffect:null,stores:null},Ft.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function l1(t,e,n,r){e.value=n,e.getSnapshot=r,d1(e)&&u1(t)}function c1(t,e,n){return n(function(){d1(e)&&u1(t)})}function d1(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!br(t,n)}catch{return!0}}function u1(t){var e=is(t,1);e!==null&&_r(e,t,1,-1)}function Ay(t){var e=Pr();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:bl,lastRenderedState:t},e.queue=t,t=t.dispatch=Ow.bind(null,Ft,t),[e.memoizedState,t]}function El(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=Ft.updateQueue,e===null?(e={lastEffect:null,stores:null},Ft.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function f1(){return or().memoizedState}function id(t,e,n,r){var s=Pr();Ft.flags|=t,s.memoizedState=El(1|e,n,void 0,r===void 0?null:r)}function wu(t,e,n,r){var s=or();r=r===void 0?null:r;var i=void 0;if(Kt!==null){var o=Kt.memoizedState;if(i=o.destroy,r!==null&&Pg(r,o.deps)){s.memoizedState=El(e,n,i,r);return}}Ft.flags|=t,s.memoizedState=El(1|e,n,i,r)}function Py(t,e){return id(8390656,8,t,e)}function Dg(t,e){return wu(2048,8,t,e)}function h1(t,e){return wu(4,2,t,e)}function p1(t,e){return wu(4,4,t,e)}function g1(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function m1(t,e,n){return n=n!=null?n.concat([t]):null,wu(4,4,g1.bind(null,e,t),n)}function Mg(){}function y1(t,e){var n=or();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Pg(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function v1(t,e){var n=or();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Pg(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function _1(t,e,n){return Ti&21?(br(n,e)||(n=Ix(),Ft.lanes|=n,wi|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Mn=!0),t.memoizedState=n)}function Aw(t,e){var n=bt;bt=n!==0&&4>n?n:4,t(!0);var r=rh.transition;rh.transition={};try{t(!1),e()}finally{bt=n,rh.transition=r}}function x1(){return or().memoizedState}function Pw(t,e,n){var r=Us(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},b1(t))E1(e,n);else if(n=n1(t,e,n,r),n!==null){var s=wn();_r(n,t,r,s),S1(n,e,r)}}function Ow(t,e,n){var r=Us(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(b1(t))E1(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,l=i(o,n);if(s.hasEagerState=!0,s.eagerState=l,br(l,o)){var c=e.interleaved;c===null?(s.next=s,wg(e)):(s.next=c.next,c.next=s),e.interleaved=s;return}}catch{}finally{}n=n1(t,e,s,r),n!==null&&(s=wn(),_r(n,t,r,s),S1(n,e,r))}}function b1(t){var e=t.alternate;return t===Ft||e!==null&&e===Ft}function E1(t,e){Va=Ud=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function S1(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,fg(t,n)}}var Bd={readContext:ir,useCallback:gn,useContext:gn,useEffect:gn,useImperativeHandle:gn,useInsertionEffect:gn,useLayoutEffect:gn,useMemo:gn,useReducer:gn,useRef:gn,useState:gn,useDebugValue:gn,useDeferredValue:gn,useTransition:gn,useMutableSource:gn,useSyncExternalStore:gn,useId:gn,unstable_isNewReconciler:!1},Lw={readContext:ir,useCallback:function(t,e){return Pr().memoizedState=[t,e===void 0?null:e],t},useContext:ir,useEffect:Py,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,id(4194308,4,g1.bind(null,e,t),n)},useLayoutEffect:function(t,e){return id(4194308,4,t,e)},useInsertionEffect:function(t,e){return id(4,2,t,e)},useMemo:function(t,e){var n=Pr();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Pr();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=Pw.bind(null,Ft,t),[r.memoizedState,t]},useRef:function(t){var e=Pr();return t={current:t},e.memoizedState=t},useState:Ay,useDebugValue:Mg,useDeferredValue:function(t){return Pr().memoizedState=t},useTransition:function(){var t=Ay(!1),e=t[0];return t=Aw.bind(null,t[1]),Pr().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=Ft,s=Pr();if(Dt){if(n===void 0)throw Error(ce(407));n=n()}else{if(n=e(),rn===null)throw Error(ce(349));Ti&30||a1(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,Py(c1.bind(null,r,i,t),[t]),r.flags|=2048,El(9,l1.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=Pr(),e=rn.identifierPrefix;if(Dt){var n=Qr,r=Xr;n=(r&~(1<<32-vr(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=xl++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=Rw++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},Dw={readContext:ir,useCallback:y1,useContext:ir,useEffect:Dg,useImperativeHandle:m1,useInsertionEffect:h1,useLayoutEffect:p1,useMemo:v1,useReducer:sh,useRef:f1,useState:function(){return sh(bl)},useDebugValue:Mg,useDeferredValue:function(t){var e=or();return _1(e,Kt.memoizedState,t)},useTransition:function(){var t=sh(bl)[0],e=or().memoizedState;return[t,e]},useMutableSource:i1,useSyncExternalStore:o1,useId:x1,unstable_isNewReconciler:!1},Mw={readContext:ir,useCallback:y1,useContext:ir,useEffect:Dg,useImperativeHandle:m1,useInsertionEffect:h1,useLayoutEffect:p1,useMemo:v1,useReducer:ih,useRef:f1,useState:function(){return ih(bl)},useDebugValue:Mg,useDeferredValue:function(t){var e=or();return Kt===null?e.memoizedState=t:_1(e,Kt.memoizedState,t)},useTransition:function(){var t=ih(bl)[0],e=or().memoizedState;return[t,e]},useMutableSource:i1,useSyncExternalStore:o1,useId:x1,unstable_isNewReconciler:!1};function ur(t,e){if(t&&t.defaultProps){e=Ut({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function sp(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:Ut({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Cu={isMounted:function(t){return(t=t._reactInternals)?Ni(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=wn(),s=Us(t),i=es(r,s);i.payload=e,n!=null&&(i.callback=n),e=$s(t,i,s),e!==null&&(_r(e,t,s,r),rd(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=wn(),s=Us(t),i=es(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=$s(t,i,s),e!==null&&(_r(e,t,s,r),rd(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=wn(),r=Us(t),s=es(n,r);s.tag=2,e!=null&&(s.callback=e),e=$s(t,s,r),e!==null&&(_r(e,t,r,n),rd(e,t,r))}};function Oy(t,e,n,r,s,i,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!pl(n,r)||!pl(s,i):!0}function I1(t,e,n){var r=!1,s=Xs,i=e.contextType;return typeof i=="object"&&i!==null?i=ir(i):(s=$n(e)?Si:_n.current,r=e.contextTypes,i=(r=r!=null)?Do(t,s):Xs),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Cu,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function Ly(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&Cu.enqueueReplaceState(e,e.state,null)}function ip(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},Cg(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=ir(i):(i=$n(e)?Si:_n.current,s.context=Do(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(sp(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&Cu.enqueueReplaceState(s,s.state,null),$d(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function $o(t,e){try{var n="",r=e;do n+=cT(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function oh(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function op(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var Nw=typeof WeakMap=="function"?WeakMap:Map;function T1(t,e,n){n=es(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Hd||(Hd=!0,mp=r),op(t,e)},n}function w1(t,e,n){n=es(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){op(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){op(t,e),typeof r!="function"&&(Fs===null?Fs=new Set([this]):Fs.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function Dy(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new Nw;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=Qw.bind(null,t,e,n),e.then(t,t))}function My(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Ny(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=es(-1,1),e.tag=2,$s(n,e,1))),n.lanes|=1),t)}var jw=ds.ReactCurrentOwner,Mn=!1;function In(t,e,n,r){e.child=t===null?t1(e,null,n,r):No(e,t.child,n,r)}function jy(t,e,n,r,s){n=n.render;var i=e.ref;return Io(e,s),r=Og(t,e,n,r,i,s),n=Lg(),t!==null&&!Mn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,os(t,e,s)):(Dt&&n&&xg(e),e.flags|=1,In(t,e,r,s),e.child)}function $y(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!Hg(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,C1(t,e,i,r,s)):(t=cd(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var o=i.memoizedProps;if(n=n.compare,n=n!==null?n:pl,n(o,r)&&t.ref===e.ref)return os(t,e,s)}return e.flags|=1,t=Bs(i,r),t.ref=e.ref,t.return=e,e.child=t}function C1(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(pl(i,r)&&t.ref===e.ref)if(Mn=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(Mn=!0);else return e.lanes=t.lanes,os(t,e,s)}return ap(t,e,n,r,s)}function k1(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Rt(yo,Hn),Hn|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Rt(yo,Hn),Hn|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,Rt(yo,Hn),Hn|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,Rt(yo,Hn),Hn|=r;return In(t,e,s,n),e.child}function R1(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function ap(t,e,n,r,s){var i=$n(n)?Si:_n.current;return i=Do(e,i),Io(e,s),n=Og(t,e,n,r,i,s),r=Lg(),t!==null&&!Mn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,os(t,e,s)):(Dt&&r&&xg(e),e.flags|=1,In(t,e,n,s),e.child)}function Fy(t,e,n,r,s){if($n(n)){var i=!0;Ld(e)}else i=!1;if(Io(e,s),e.stateNode===null)od(t,e),I1(e,n,r),ip(e,n,r,s),r=!0;else if(t===null){var o=e.stateNode,l=e.memoizedProps;o.props=l;var c=o.context,d=n.contextType;typeof d=="object"&&d!==null?d=ir(d):(d=$n(n)?Si:_n.current,d=Do(e,d));var u=n.getDerivedStateFromProps,h=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==r||c!==d)&&Ly(e,o,r,d),Es=!1;var f=e.memoizedState;o.state=f,$d(e,r,o,s),c=e.memoizedState,l!==r||f!==c||jn.current||Es?(typeof u=="function"&&(sp(e,n,u,r),c=e.memoizedState),(l=Es||Oy(e,n,l,r,f,c,d))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),o.props=r,o.state=c,o.context=d,r=l):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,r1(t,e),l=e.memoizedProps,d=e.type===e.elementType?l:ur(e.type,l),o.props=d,h=e.pendingProps,f=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=ir(c):(c=$n(n)?Si:_n.current,c=Do(e,c));var x=n.getDerivedStateFromProps;(u=typeof x=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==h||f!==c)&&Ly(e,o,r,c),Es=!1,f=e.memoizedState,o.state=f,$d(e,r,o,s);var k=e.memoizedState;l!==h||f!==k||jn.current||Es?(typeof x=="function"&&(sp(e,n,x,r),k=e.memoizedState),(d=Es||Oy(e,n,d,r,f,k,c)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,k,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,k,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=k),o.props=r,o.state=k,o.context=c,r=d):(typeof o.componentDidUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),r=!1)}return lp(t,e,n,r,i,s)}function lp(t,e,n,r,s,i){R1(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&Iy(e,n,!1),os(t,e,i);r=e.stateNode,jw.current=e;var l=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=No(e,t.child,null,i),e.child=No(e,null,l,i)):In(t,e,l,i),e.memoizedState=r.state,s&&Iy(e,n,!0),e.child}function A1(t){var e=t.stateNode;e.pendingContext?Sy(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Sy(t,e.context,!1),kg(t,e.containerInfo)}function Uy(t,e,n,r,s){return Mo(),Eg(s),e.flags|=256,In(t,e,n,r),e.child}var cp={dehydrated:null,treeContext:null,retryLane:0};function dp(t){return{baseLanes:t,cachePool:null,transitions:null}}function P1(t,e,n){var r=e.pendingProps,s=Nt.current,i=!1,o=(e.flags&128)!==0,l;if((l=o)||(l=t!==null&&t.memoizedState===null?!1:(s&2)!==0),l?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),Rt(Nt,s&1),t===null)return np(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=Au(o,r,0,null),t=Ei(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=dp(n),e.memoizedState=cp,t):Ng(e,o));if(s=t.memoizedState,s!==null&&(l=s.dehydrated,l!==null))return $w(t,e,o,r,l,s,n);if(i){i=r.fallback,o=e.mode,s=t.child,l=s.sibling;var c={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=Bs(s,c),r.subtreeFlags=s.subtreeFlags&14680064),l!==null?i=Bs(l,i):(i=Ei(i,o,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=t.child.memoizedState,o=o===null?dp(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=t.childLanes&~n,e.memoizedState=cp,r}return i=t.child,t=i.sibling,r=Bs(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function Ng(t,e){return e=Au({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Fc(t,e,n,r){return r!==null&&Eg(r),No(e,t.child,null,n),t=Ng(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function $w(t,e,n,r,s,i,o){if(n)return e.flags&256?(e.flags&=-257,r=oh(Error(ce(422))),Fc(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=Au({mode:"visible",children:r.children},s,0,null),i=Ei(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&No(e,t.child,null,o),e.child.memoizedState=dp(o),e.memoizedState=cp,i);if(!(e.mode&1))return Fc(t,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var l=r.dgst;return r=l,i=Error(ce(419)),r=oh(i,r,void 0),Fc(t,e,o,r)}if(l=(o&t.childLanes)!==0,Mn||l){if(r=rn,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,is(t,s),_r(r,t,s,-1))}return zg(),r=oh(Error(ce(421))),Fc(t,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=Jw.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,Wn=js(s.nextSibling),Gn=e,Dt=!0,hr=null,t!==null&&(qn[Zn++]=Xr,qn[Zn++]=Qr,qn[Zn++]=Ii,Xr=t.id,Qr=t.overflow,Ii=e),e=Ng(e,r.children),e.flags|=4096,e)}function By(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),rp(t.return,e,n)}function ah(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function O1(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(In(t,e,r.children,n),r=Nt.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&By(t,n,e);else if(t.tag===19)By(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(Rt(Nt,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&Fd(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),ah(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&Fd(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}ah(e,!0,n,null,i);break;case"together":ah(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function od(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function os(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),wi|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(ce(153));if(e.child!==null){for(t=e.child,n=Bs(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Bs(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function Fw(t,e,n){switch(e.tag){case 3:A1(e),Mo();break;case 5:s1(e);break;case 1:$n(e.type)&&Ld(e);break;case 4:kg(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;Rt(Nd,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Rt(Nt,Nt.current&1),e.flags|=128,null):n&e.child.childLanes?P1(t,e,n):(Rt(Nt,Nt.current&1),t=os(t,e,n),t!==null?t.sibling:null);Rt(Nt,Nt.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return O1(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Rt(Nt,Nt.current),r)break;return null;case 22:case 23:return e.lanes=0,k1(t,e,n)}return os(t,e,n)}var L1,up,D1,M1;L1=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};up=function(){};D1=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,_i(jr.current);var i=null;switch(n){case"input":s=Lh(t,s),r=Lh(t,r),i=[];break;case"select":s=Ut({},s,{value:void 0}),r=Ut({},r,{value:void 0}),i=[];break;case"textarea":s=Nh(t,s),r=Nh(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Pd)}$h(n,r);var o;n=null;for(d in s)if(!r.hasOwnProperty(d)&&s.hasOwnProperty(d)&&s[d]!=null)if(d==="style"){var l=s[d];for(o in l)l.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(al.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in r){var c=r[d];if(l=s!=null?s[d]:void 0,r.hasOwnProperty(d)&&c!==l&&(c!=null||l!=null))if(d==="style")if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(i||(i=[]),i.push(d,n)),n=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(i=i||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(al.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&At("scroll",t),i||l===c||(i=[])):(i=i||[]).push(d,c))}n&&(i=i||[]).push("style",n);var d=i;(e.updateQueue=d)&&(e.flags|=4)}};M1=function(t,e,n,r){n!==r&&(e.flags|=4)};function Ta(t,e){if(!Dt)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function mn(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function Uw(t,e,n){var r=e.pendingProps;switch(bg(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return mn(e),null;case 1:return $n(e.type)&&Od(),mn(e),null;case 3:return r=e.stateNode,jo(),Pt(jn),Pt(_n),Ag(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(jc(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,hr!==null&&(_p(hr),hr=null))),up(t,e),mn(e),null;case 5:Rg(e);var s=_i(_l.current);if(n=e.type,t!==null&&e.stateNode!=null)D1(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(ce(166));return mn(e),null}if(t=_i(jr.current),jc(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[Or]=e,r[yl]=i,t=(e.mode&1)!==0,n){case"dialog":At("cancel",r),At("close",r);break;case"iframe":case"object":case"embed":At("load",r);break;case"video":case"audio":for(s=0;s<ja.length;s++)At(ja[s],r);break;case"source":At("error",r);break;case"img":case"image":case"link":At("error",r),At("load",r);break;case"details":At("toggle",r);break;case"input":Qm(r,i),At("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},At("invalid",r);break;case"textarea":qm(r,i),At("invalid",r)}$h(n,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var l=i[o];o==="children"?typeof l=="string"?r.textContent!==l&&(i.suppressHydrationWarning!==!0&&Nc(r.textContent,l,t),s=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(i.suppressHydrationWarning!==!0&&Nc(r.textContent,l,t),s=["children",""+l]):al.hasOwnProperty(o)&&l!=null&&o==="onScroll"&&At("scroll",r)}switch(n){case"input":kc(r),Jm(r,i,!0);break;case"textarea":kc(r),Zm(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=Pd)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=cx(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[Or]=e,t[yl]=r,L1(t,e,!1,!1),e.stateNode=t;e:{switch(o=Fh(n,r),n){case"dialog":At("cancel",t),At("close",t),s=r;break;case"iframe":case"object":case"embed":At("load",t),s=r;break;case"video":case"audio":for(s=0;s<ja.length;s++)At(ja[s],t);s=r;break;case"source":At("error",t),s=r;break;case"img":case"image":case"link":At("error",t),At("load",t),s=r;break;case"details":At("toggle",t),s=r;break;case"input":Qm(t,r),s=Lh(t,r),At("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=Ut({},r,{value:void 0}),At("invalid",t);break;case"textarea":qm(t,r),s=Nh(t,r),At("invalid",t);break;default:s=r}$h(n,s),l=s;for(i in l)if(l.hasOwnProperty(i)){var c=l[i];i==="style"?fx(t,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&dx(t,c)):i==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&ll(t,c):typeof c=="number"&&ll(t,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(al.hasOwnProperty(i)?c!=null&&i==="onScroll"&&At("scroll",t):c!=null&&og(t,i,c,o))}switch(n){case"input":kc(t),Jm(t,r,!1);break;case"textarea":kc(t),Zm(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Ks(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?xo(t,!!r.multiple,i,!1):r.defaultValue!=null&&xo(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=Pd)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return mn(e),null;case 6:if(t&&e.stateNode!=null)M1(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(ce(166));if(n=_i(_l.current),_i(jr.current),jc(e)){if(r=e.stateNode,n=e.memoizedProps,r[Or]=e,(i=r.nodeValue!==n)&&(t=Gn,t!==null))switch(t.tag){case 3:Nc(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Nc(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Or]=e,e.stateNode=r}return mn(e),null;case 13:if(Pt(Nt),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Dt&&Wn!==null&&e.mode&1&&!(e.flags&128))Zx(),Mo(),e.flags|=98560,i=!1;else if(i=jc(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(ce(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(ce(317));i[Or]=e}else Mo(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;mn(e),i=!1}else hr!==null&&(_p(hr),hr=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||Nt.current&1?Qt===0&&(Qt=3):zg())),e.updateQueue!==null&&(e.flags|=4),mn(e),null);case 4:return jo(),up(t,e),t===null&&gl(e.stateNode.containerInfo),mn(e),null;case 10:return Tg(e.type._context),mn(e),null;case 17:return $n(e.type)&&Od(),mn(e),null;case 19:if(Pt(Nt),i=e.memoizedState,i===null)return mn(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)Ta(i,!1);else{if(Qt!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=Fd(t),o!==null){for(e.flags|=128,Ta(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,t=o.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Rt(Nt,Nt.current&1|2),e.child}t=t.sibling}i.tail!==null&&Ht()>Fo&&(e.flags|=128,r=!0,Ta(i,!1),e.lanes=4194304)}else{if(!r)if(t=Fd(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Ta(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!Dt)return mn(e),null}else 2*Ht()-i.renderingStartTime>Fo&&n!==1073741824&&(e.flags|=128,r=!0,Ta(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(n=i.last,n!==null?n.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Ht(),e.sibling=null,n=Nt.current,Rt(Nt,r?n&1|2:n&1),e):(mn(e),null);case 22:case 23:return Bg(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Hn&1073741824&&(mn(e),e.subtreeFlags&6&&(e.flags|=8192)):mn(e),null;case 24:return null;case 25:return null}throw Error(ce(156,e.tag))}function Bw(t,e){switch(bg(e),e.tag){case 1:return $n(e.type)&&Od(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return jo(),Pt(jn),Pt(_n),Ag(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Rg(e),null;case 13:if(Pt(Nt),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(ce(340));Mo()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Pt(Nt),null;case 4:return jo(),null;case 10:return Tg(e.type._context),null;case 22:case 23:return Bg(),null;case 24:return null;default:return null}}var Uc=!1,vn=!1,zw=typeof WeakSet=="function"?WeakSet:Set,be=null;function mo(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){Bt(t,e,r)}else n.current=null}function fp(t,e,n){try{n()}catch(r){Bt(t,e,r)}}var zy=!1;function Hw(t,e){if(Xh=kd,t=Ux(),_g(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var o=0,l=-1,c=-1,d=0,u=0,h=t,f=null;t:for(;;){for(var x;h!==n||s!==0&&h.nodeType!==3||(l=o+s),h!==i||r!==0&&h.nodeType!==3||(c=o+r),h.nodeType===3&&(o+=h.nodeValue.length),(x=h.firstChild)!==null;)f=h,h=x;for(;;){if(h===t)break t;if(f===n&&++d===s&&(l=o),f===i&&++u===r&&(c=o),(x=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=x}n=l===-1||c===-1?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Qh={focusedElem:t,selectionRange:n},kd=!1,be=e;be!==null;)if(e=be,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,be=t;else for(;be!==null;){e=be;try{var k=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(k!==null){var T=k.memoizedProps,j=k.memoizedState,b=e.stateNode,v=b.getSnapshotBeforeUpdate(e.elementType===e.type?T:ur(e.type,T),j);b.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var S=e.stateNode.containerInfo;S.nodeType===1?S.textContent="":S.nodeType===9&&S.documentElement&&S.removeChild(S.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ce(163))}}catch(p){Bt(e,e.return,p)}if(t=e.sibling,t!==null){t.return=e.return,be=t;break}be=e.return}return k=zy,zy=!1,k}function Ya(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&fp(e,n,i)}s=s.next}while(s!==r)}}function ku(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function hp(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function N1(t){var e=t.alternate;e!==null&&(t.alternate=null,N1(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Or],delete e[yl],delete e[Zh],delete e[Tw],delete e[ww])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function j1(t){return t.tag===5||t.tag===3||t.tag===4}function Hy(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||j1(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function pp(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Pd));else if(r!==4&&(t=t.child,t!==null))for(pp(t,e,n),t=t.sibling;t!==null;)pp(t,e,n),t=t.sibling}function gp(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(gp(t,e,n),t=t.sibling;t!==null;)gp(t,e,n),t=t.sibling}var dn=null,fr=!1;function _s(t,e,n){for(n=n.child;n!==null;)$1(t,e,n),n=n.sibling}function $1(t,e,n){if(Nr&&typeof Nr.onCommitFiberUnmount=="function")try{Nr.onCommitFiberUnmount(xu,n)}catch{}switch(n.tag){case 5:vn||mo(n,e);case 6:var r=dn,s=fr;dn=null,_s(t,e,n),dn=r,fr=s,dn!==null&&(fr?(t=dn,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):dn.removeChild(n.stateNode));break;case 18:dn!==null&&(fr?(t=dn,n=n.stateNode,t.nodeType===8?eh(t.parentNode,n):t.nodeType===1&&eh(t,n),fl(t)):eh(dn,n.stateNode));break;case 4:r=dn,s=fr,dn=n.stateNode.containerInfo,fr=!0,_s(t,e,n),dn=r,fr=s;break;case 0:case 11:case 14:case 15:if(!vn&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&fp(n,e,o),s=s.next}while(s!==r)}_s(t,e,n);break;case 1:if(!vn&&(mo(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(l){Bt(n,e,l)}_s(t,e,n);break;case 21:_s(t,e,n);break;case 22:n.mode&1?(vn=(r=vn)||n.memoizedState!==null,_s(t,e,n),vn=r):_s(t,e,n);break;default:_s(t,e,n)}}function Wy(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new zw),e.forEach(function(r){var s=qw.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function dr(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,o=e,l=o;e:for(;l!==null;){switch(l.tag){case 5:dn=l.stateNode,fr=!1;break e;case 3:dn=l.stateNode.containerInfo,fr=!0;break e;case 4:dn=l.stateNode.containerInfo,fr=!0;break e}l=l.return}if(dn===null)throw Error(ce(160));$1(i,o,s),dn=null,fr=!1;var c=s.alternate;c!==null&&(c.return=null),s.return=null}catch(d){Bt(s,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)F1(e,t),e=e.sibling}function F1(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(dr(e,t),Ar(t),r&4){try{Ya(3,t,t.return),ku(3,t)}catch(T){Bt(t,t.return,T)}try{Ya(5,t,t.return)}catch(T){Bt(t,t.return,T)}}break;case 1:dr(e,t),Ar(t),r&512&&n!==null&&mo(n,n.return);break;case 5:if(dr(e,t),Ar(t),r&512&&n!==null&&mo(n,n.return),t.flags&32){var s=t.stateNode;try{ll(s,"")}catch(T){Bt(t,t.return,T)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,o=n!==null?n.memoizedProps:i,l=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{l==="input"&&i.type==="radio"&&i.name!=null&&ax(s,i),Fh(l,o);var d=Fh(l,i);for(o=0;o<c.length;o+=2){var u=c[o],h=c[o+1];u==="style"?fx(s,h):u==="dangerouslySetInnerHTML"?dx(s,h):u==="children"?ll(s,h):og(s,u,h,d)}switch(l){case"input":Dh(s,i);break;case"textarea":lx(s,i);break;case"select":var f=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var x=i.value;x!=null?xo(s,!!i.multiple,x,!1):f!==!!i.multiple&&(i.defaultValue!=null?xo(s,!!i.multiple,i.defaultValue,!0):xo(s,!!i.multiple,i.multiple?[]:"",!1))}s[yl]=i}catch(T){Bt(t,t.return,T)}}break;case 6:if(dr(e,t),Ar(t),r&4){if(t.stateNode===null)throw Error(ce(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(T){Bt(t,t.return,T)}}break;case 3:if(dr(e,t),Ar(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{fl(e.containerInfo)}catch(T){Bt(t,t.return,T)}break;case 4:dr(e,t),Ar(t);break;case 13:dr(e,t),Ar(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(Fg=Ht())),r&4&&Wy(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(vn=(d=vn)||u,dr(e,t),vn=d):dr(e,t),Ar(t),r&8192){if(d=t.memoizedState!==null,(t.stateNode.isHidden=d)&&!u&&t.mode&1)for(be=t,u=t.child;u!==null;){for(h=be=u;be!==null;){switch(f=be,x=f.child,f.tag){case 0:case 11:case 14:case 15:Ya(4,f,f.return);break;case 1:mo(f,f.return);var k=f.stateNode;if(typeof k.componentWillUnmount=="function"){r=f,n=f.return;try{e=r,k.props=e.memoizedProps,k.state=e.memoizedState,k.componentWillUnmount()}catch(T){Bt(r,n,T)}}break;case 5:mo(f,f.return);break;case 22:if(f.memoizedState!==null){Vy(h);continue}}x!==null?(x.return=f,be=x):Vy(h)}u=u.sibling}e:for(u=null,h=t;;){if(h.tag===5){if(u===null){u=h;try{s=h.stateNode,d?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(l=h.stateNode,c=h.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=ux("display",o))}catch(T){Bt(t,t.return,T)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=d?"":h.memoizedProps}catch(T){Bt(t,t.return,T)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===t)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===t)break e;for(;h.sibling===null;){if(h.return===null||h.return===t)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:dr(e,t),Ar(t),r&4&&Wy(t);break;case 21:break;default:dr(e,t),Ar(t)}}function Ar(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(j1(n)){var r=n;break e}n=n.return}throw Error(ce(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(ll(s,""),r.flags&=-33);var i=Hy(t);gp(t,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,l=Hy(t);pp(t,l,o);break;default:throw Error(ce(161))}}catch(c){Bt(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function Ww(t,e,n){be=t,U1(t)}function U1(t,e,n){for(var r=(t.mode&1)!==0;be!==null;){var s=be,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||Uc;if(!o){var l=s.alternate,c=l!==null&&l.memoizedState!==null||vn;l=Uc;var d=vn;if(Uc=o,(vn=c)&&!d)for(be=s;be!==null;)o=be,c=o.child,o.tag===22&&o.memoizedState!==null?Yy(s):c!==null?(c.return=o,be=c):Yy(s);for(;i!==null;)be=i,U1(i),i=i.sibling;be=s,Uc=l,vn=d}Gy(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,be=i):Gy(t)}}function Gy(t){for(;be!==null;){var e=be;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:vn||ku(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!vn)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:ur(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&Ry(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Ry(e,o,n)}break;case 5:var l=e.stateNode;if(n===null&&e.flags&4){n=l;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var u=d.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&fl(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ce(163))}vn||e.flags&512&&hp(e)}catch(f){Bt(e,e.return,f)}}if(e===t){be=null;break}if(n=e.sibling,n!==null){n.return=e.return,be=n;break}be=e.return}}function Vy(t){for(;be!==null;){var e=be;if(e===t){be=null;break}var n=e.sibling;if(n!==null){n.return=e.return,be=n;break}be=e.return}}function Yy(t){for(;be!==null;){var e=be;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{ku(4,e)}catch(c){Bt(e,n,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(c){Bt(e,s,c)}}var i=e.return;try{hp(e)}catch(c){Bt(e,i,c)}break;case 5:var o=e.return;try{hp(e)}catch(c){Bt(e,o,c)}}}catch(c){Bt(e,e.return,c)}if(e===t){be=null;break}var l=e.sibling;if(l!==null){l.return=e.return,be=l;break}be=e.return}}var Gw=Math.ceil,zd=ds.ReactCurrentDispatcher,jg=ds.ReactCurrentOwner,sr=ds.ReactCurrentBatchConfig,pt=0,rn=null,Vt=null,un=0,Hn=0,yo=ni(0),Qt=0,Sl=null,wi=0,Ru=0,$g=0,Ka=null,Dn=null,Fg=0,Fo=1/0,Vr=null,Hd=!1,mp=null,Fs=null,Bc=!1,As=null,Wd=0,Xa=0,yp=null,ad=-1,ld=0;function wn(){return pt&6?Ht():ad!==-1?ad:ad=Ht()}function Us(t){return t.mode&1?pt&2&&un!==0?un&-un:kw.transition!==null?(ld===0&&(ld=Ix()),ld):(t=bt,t!==0||(t=window.event,t=t===void 0?16:Px(t.type)),t):1}function _r(t,e,n,r){if(50<Xa)throw Xa=0,yp=null,Error(ce(185));Fl(t,n,r),(!(pt&2)||t!==rn)&&(t===rn&&(!(pt&2)&&(Ru|=n),Qt===4&&Is(t,un)),Fn(t,r),n===1&&pt===0&&!(e.mode&1)&&(Fo=Ht()+500,Tu&&ri()))}function Fn(t,e){var n=t.callbackNode;kT(t,e);var r=Cd(t,t===rn?un:0);if(r===0)n!==null&&ny(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&ny(n),e===1)t.tag===0?Cw(Ky.bind(null,t)):Qx(Ky.bind(null,t)),Sw(function(){!(pt&6)&&ri()}),n=null;else{switch(Tx(r)){case 1:n=ug;break;case 4:n=Ex;break;case 16:n=wd;break;case 536870912:n=Sx;break;default:n=wd}n=K1(n,B1.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function B1(t,e){if(ad=-1,ld=0,pt&6)throw Error(ce(327));var n=t.callbackNode;if(To()&&t.callbackNode!==n)return null;var r=Cd(t,t===rn?un:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=Gd(t,r);else{e=r;var s=pt;pt|=2;var i=H1();(rn!==t||un!==e)&&(Vr=null,Fo=Ht()+500,bi(t,e));do try{Kw();break}catch(l){z1(t,l)}while(!0);Ig(),zd.current=i,pt=s,Vt!==null?e=0:(rn=null,un=0,e=Qt)}if(e!==0){if(e===2&&(s=Wh(t),s!==0&&(r=s,e=vp(t,s))),e===1)throw n=Sl,bi(t,0),Is(t,r),Fn(t,Ht()),n;if(e===6)Is(t,r);else{if(s=t.current.alternate,!(r&30)&&!Vw(s)&&(e=Gd(t,r),e===2&&(i=Wh(t),i!==0&&(r=i,e=vp(t,i))),e===1))throw n=Sl,bi(t,0),Is(t,r),Fn(t,Ht()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(ce(345));case 2:hi(t,Dn,Vr);break;case 3:if(Is(t,r),(r&130023424)===r&&(e=Fg+500-Ht(),10<e)){if(Cd(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){wn(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=qh(hi.bind(null,t,Dn,Vr),e);break}hi(t,Dn,Vr);break;case 4:if(Is(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var o=31-vr(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=Ht()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Gw(r/1960))-r,10<r){t.timeoutHandle=qh(hi.bind(null,t,Dn,Vr),r);break}hi(t,Dn,Vr);break;case 5:hi(t,Dn,Vr);break;default:throw Error(ce(329))}}}return Fn(t,Ht()),t.callbackNode===n?B1.bind(null,t):null}function vp(t,e){var n=Ka;return t.current.memoizedState.isDehydrated&&(bi(t,e).flags|=256),t=Gd(t,e),t!==2&&(e=Dn,Dn=n,e!==null&&_p(e)),t}function _p(t){Dn===null?Dn=t:Dn.push.apply(Dn,t)}function Vw(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!br(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Is(t,e){for(e&=~$g,e&=~Ru,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-vr(e),r=1<<n;t[n]=-1,e&=~r}}function Ky(t){if(pt&6)throw Error(ce(327));To();var e=Cd(t,0);if(!(e&1))return Fn(t,Ht()),null;var n=Gd(t,e);if(t.tag!==0&&n===2){var r=Wh(t);r!==0&&(e=r,n=vp(t,r))}if(n===1)throw n=Sl,bi(t,0),Is(t,e),Fn(t,Ht()),n;if(n===6)throw Error(ce(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,hi(t,Dn,Vr),Fn(t,Ht()),null}function Ug(t,e){var n=pt;pt|=1;try{return t(e)}finally{pt=n,pt===0&&(Fo=Ht()+500,Tu&&ri())}}function Ci(t){As!==null&&As.tag===0&&!(pt&6)&&To();var e=pt;pt|=1;var n=sr.transition,r=bt;try{if(sr.transition=null,bt=1,t)return t()}finally{bt=r,sr.transition=n,pt=e,!(pt&6)&&ri()}}function Bg(){Hn=yo.current,Pt(yo)}function bi(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,Ew(n)),Vt!==null)for(n=Vt.return;n!==null;){var r=n;switch(bg(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Od();break;case 3:jo(),Pt(jn),Pt(_n),Ag();break;case 5:Rg(r);break;case 4:jo();break;case 13:Pt(Nt);break;case 19:Pt(Nt);break;case 10:Tg(r.type._context);break;case 22:case 23:Bg()}n=n.return}if(rn=t,Vt=t=Bs(t.current,null),un=Hn=e,Qt=0,Sl=null,$g=Ru=wi=0,Dn=Ka=null,vi!==null){for(e=0;e<vi.length;e++)if(n=vi[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}n.pending=r}vi=null}return t}function z1(t,e){do{var n=Vt;try{if(Ig(),sd.current=Bd,Ud){for(var r=Ft.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Ud=!1}if(Ti=0,en=Kt=Ft=null,Va=!1,xl=0,jg.current=null,n===null||n.return===null){Qt=1,Sl=e,Vt=null;break}e:{var i=t,o=n.return,l=n,c=e;if(e=un,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,u=l,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var f=u.alternate;f?(u.updateQueue=f.updateQueue,u.memoizedState=f.memoizedState,u.lanes=f.lanes):(u.updateQueue=null,u.memoizedState=null)}var x=My(o);if(x!==null){x.flags&=-257,Ny(x,o,l,i,e),x.mode&1&&Dy(i,d,e),e=x,c=d;var k=e.updateQueue;if(k===null){var T=new Set;T.add(c),e.updateQueue=T}else k.add(c);break e}else{if(!(e&1)){Dy(i,d,e),zg();break e}c=Error(ce(426))}}else if(Dt&&l.mode&1){var j=My(o);if(j!==null){!(j.flags&65536)&&(j.flags|=256),Ny(j,o,l,i,e),Eg($o(c,l));break e}}i=c=$o(c,l),Qt!==4&&(Qt=2),Ka===null?Ka=[i]:Ka.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var b=T1(i,c,e);ky(i,b);break e;case 1:l=c;var v=i.type,S=i.stateNode;if(!(i.flags&128)&&(typeof v.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(Fs===null||!Fs.has(S)))){i.flags|=65536,e&=-e,i.lanes|=e;var p=w1(i,l,e);ky(i,p);break e}}i=i.return}while(i!==null)}G1(n)}catch(F){e=F,Vt===n&&n!==null&&(Vt=n=n.return);continue}break}while(!0)}function H1(){var t=zd.current;return zd.current=Bd,t===null?Bd:t}function zg(){(Qt===0||Qt===3||Qt===2)&&(Qt=4),rn===null||!(wi&268435455)&&!(Ru&268435455)||Is(rn,un)}function Gd(t,e){var n=pt;pt|=2;var r=H1();(rn!==t||un!==e)&&(Vr=null,bi(t,e));do try{Yw();break}catch(s){z1(t,s)}while(!0);if(Ig(),pt=n,zd.current=r,Vt!==null)throw Error(ce(261));return rn=null,un=0,Qt}function Yw(){for(;Vt!==null;)W1(Vt)}function Kw(){for(;Vt!==null&&!_T();)W1(Vt)}function W1(t){var e=Y1(t.alternate,t,Hn);t.memoizedProps=t.pendingProps,e===null?G1(t):Vt=e,jg.current=null}function G1(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=Bw(n,e),n!==null){n.flags&=32767,Vt=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Qt=6,Vt=null;return}}else if(n=Uw(n,e,Hn),n!==null){Vt=n;return}if(e=e.sibling,e!==null){Vt=e;return}Vt=e=t}while(e!==null);Qt===0&&(Qt=5)}function hi(t,e,n){var r=bt,s=sr.transition;try{sr.transition=null,bt=1,Xw(t,e,n,r)}finally{sr.transition=s,bt=r}return null}function Xw(t,e,n,r){do To();while(As!==null);if(pt&6)throw Error(ce(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(ce(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(RT(t,i),t===rn&&(Vt=rn=null,un=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Bc||(Bc=!0,K1(wd,function(){return To(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=sr.transition,sr.transition=null;var o=bt;bt=1;var l=pt;pt|=4,jg.current=null,Hw(t,n),F1(n,t),gw(Qh),kd=!!Xh,Qh=Xh=null,t.current=n,Ww(n),xT(),pt=l,bt=o,sr.transition=i}else t.current=n;if(Bc&&(Bc=!1,As=t,Wd=s),i=t.pendingLanes,i===0&&(Fs=null),ST(n.stateNode),Fn(t,Ht()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(Hd)throw Hd=!1,t=mp,mp=null,t;return Wd&1&&t.tag!==0&&To(),i=t.pendingLanes,i&1?t===yp?Xa++:(Xa=0,yp=t):Xa=0,ri(),null}function To(){if(As!==null){var t=Tx(Wd),e=sr.transition,n=bt;try{if(sr.transition=null,bt=16>t?16:t,As===null)var r=!1;else{if(t=As,As=null,Wd=0,pt&6)throw Error(ce(331));var s=pt;for(pt|=4,be=t.current;be!==null;){var i=be,o=i.child;if(be.flags&16){var l=i.deletions;if(l!==null){for(var c=0;c<l.length;c++){var d=l[c];for(be=d;be!==null;){var u=be;switch(u.tag){case 0:case 11:case 15:Ya(8,u,i)}var h=u.child;if(h!==null)h.return=u,be=h;else for(;be!==null;){u=be;var f=u.sibling,x=u.return;if(N1(u),u===d){be=null;break}if(f!==null){f.return=x,be=f;break}be=x}}}var k=i.alternate;if(k!==null){var T=k.child;if(T!==null){k.child=null;do{var j=T.sibling;T.sibling=null,T=j}while(T!==null)}}be=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,be=o;else e:for(;be!==null;){if(i=be,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Ya(9,i,i.return)}var b=i.sibling;if(b!==null){b.return=i.return,be=b;break e}be=i.return}}var v=t.current;for(be=v;be!==null;){o=be;var S=o.child;if(o.subtreeFlags&2064&&S!==null)S.return=o,be=S;else e:for(o=v;be!==null;){if(l=be,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:ku(9,l)}}catch(F){Bt(l,l.return,F)}if(l===o){be=null;break e}var p=l.sibling;if(p!==null){p.return=l.return,be=p;break e}be=l.return}}if(pt=s,ri(),Nr&&typeof Nr.onPostCommitFiberRoot=="function")try{Nr.onPostCommitFiberRoot(xu,t)}catch{}r=!0}return r}finally{bt=n,sr.transition=e}}return!1}function Xy(t,e,n){e=$o(n,e),e=T1(t,e,1),t=$s(t,e,1),e=wn(),t!==null&&(Fl(t,1,e),Fn(t,e))}function Bt(t,e,n){if(t.tag===3)Xy(t,t,n);else for(;e!==null;){if(e.tag===3){Xy(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Fs===null||!Fs.has(r))){t=$o(n,t),t=w1(e,t,1),e=$s(e,t,1),t=wn(),e!==null&&(Fl(e,1,t),Fn(e,t));break}}e=e.return}}function Qw(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=wn(),t.pingedLanes|=t.suspendedLanes&n,rn===t&&(un&n)===n&&(Qt===4||Qt===3&&(un&130023424)===un&&500>Ht()-Fg?bi(t,0):$g|=n),Fn(t,e)}function V1(t,e){e===0&&(t.mode&1?(e=Pc,Pc<<=1,!(Pc&130023424)&&(Pc=4194304)):e=1);var n=wn();t=is(t,e),t!==null&&(Fl(t,e,n),Fn(t,n))}function Jw(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),V1(t,n)}function qw(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(ce(314))}r!==null&&r.delete(e),V1(t,n)}var Y1;Y1=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||jn.current)Mn=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Mn=!1,Fw(t,e,n);Mn=!!(t.flags&131072)}else Mn=!1,Dt&&e.flags&1048576&&Jx(e,Md,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;od(t,e),t=e.pendingProps;var s=Do(e,_n.current);Io(e,n),s=Og(null,e,r,t,s,n);var i=Lg();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,$n(r)?(i=!0,Ld(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Cg(e),s.updater=Cu,e.stateNode=s,s._reactInternals=e,ip(e,r,t,n),e=lp(null,e,r,!0,i,n)):(e.tag=0,Dt&&i&&xg(e),In(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(od(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=e2(r),t=ur(r,t),s){case 0:e=ap(null,e,r,t,n);break e;case 1:e=Fy(null,e,r,t,n);break e;case 11:e=jy(null,e,r,t,n);break e;case 14:e=$y(null,e,r,ur(r.type,t),n);break e}throw Error(ce(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:ur(r,s),ap(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:ur(r,s),Fy(t,e,r,s,n);case 3:e:{if(A1(e),t===null)throw Error(ce(387));r=e.pendingProps,i=e.memoizedState,s=i.element,r1(t,e),$d(e,r,null,n);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=$o(Error(ce(423)),e),e=Uy(t,e,r,n,s);break e}else if(r!==s){s=$o(Error(ce(424)),e),e=Uy(t,e,r,n,s);break e}else for(Wn=js(e.stateNode.containerInfo.firstChild),Gn=e,Dt=!0,hr=null,n=t1(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Mo(),r===s){e=os(t,e,n);break e}In(t,e,r,n)}e=e.child}return e;case 5:return s1(e),t===null&&np(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,o=s.children,Jh(r,s)?o=null:i!==null&&Jh(r,i)&&(e.flags|=32),R1(t,e),In(t,e,o,n),e.child;case 6:return t===null&&np(e),null;case 13:return P1(t,e,n);case 4:return kg(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=No(e,null,r,n):In(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:ur(r,s),jy(t,e,r,s,n);case 7:return In(t,e,e.pendingProps,n),e.child;case 8:return In(t,e,e.pendingProps.children,n),e.child;case 12:return In(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,Rt(Nd,r._currentValue),r._currentValue=o,i!==null)if(br(i.value,o)){if(i.children===s.children&&!jn.current){e=os(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var l=i.dependencies;if(l!==null){o=i.child;for(var c=l.firstContext;c!==null;){if(c.context===r){if(i.tag===1){c=es(-1,n&-n),c.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var u=d.pending;u===null?c.next=c:(c.next=u.next,u.next=c),d.pending=c}}i.lanes|=n,c=i.alternate,c!==null&&(c.lanes|=n),rp(i.return,n,e),l.lanes|=n;break}c=c.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(ce(341));o.lanes|=n,l=o.alternate,l!==null&&(l.lanes|=n),rp(o,n,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}In(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,Io(e,n),s=ir(s),r=r(s),e.flags|=1,In(t,e,r,n),e.child;case 14:return r=e.type,s=ur(r,e.pendingProps),s=ur(r.type,s),$y(t,e,r,s,n);case 15:return C1(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:ur(r,s),od(t,e),e.tag=1,$n(r)?(t=!0,Ld(e)):t=!1,Io(e,n),I1(e,r,s),ip(e,r,s,n),lp(null,e,r,!0,t,n);case 19:return O1(t,e,n);case 22:return k1(t,e,n)}throw Error(ce(156,e.tag))};function K1(t,e){return bx(t,e)}function Zw(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function nr(t,e,n,r){return new Zw(t,e,n,r)}function Hg(t){return t=t.prototype,!(!t||!t.isReactComponent)}function e2(t){if(typeof t=="function")return Hg(t)?1:0;if(t!=null){if(t=t.$$typeof,t===lg)return 11;if(t===cg)return 14}return 2}function Bs(t,e){var n=t.alternate;return n===null?(n=nr(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function cd(t,e,n,r,s,i){var o=2;if(r=t,typeof t=="function")Hg(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case oo:return Ei(n.children,s,i,e);case ag:o=8,s|=8;break;case Rh:return t=nr(12,n,e,s|2),t.elementType=Rh,t.lanes=i,t;case Ah:return t=nr(13,n,e,s),t.elementType=Ah,t.lanes=i,t;case Ph:return t=nr(19,n,e,s),t.elementType=Ph,t.lanes=i,t;case sx:return Au(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case nx:o=10;break e;case rx:o=9;break e;case lg:o=11;break e;case cg:o=14;break e;case bs:o=16,r=null;break e}throw Error(ce(130,t==null?t:typeof t,""))}return e=nr(o,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function Ei(t,e,n,r){return t=nr(7,t,r,e),t.lanes=n,t}function Au(t,e,n,r){return t=nr(22,t,r,e),t.elementType=sx,t.lanes=n,t.stateNode={isHidden:!1},t}function lh(t,e,n){return t=nr(6,t,null,e),t.lanes=n,t}function ch(t,e,n){return e=nr(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function t2(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Hf(0),this.expirationTimes=Hf(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Hf(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Wg(t,e,n,r,s,i,o,l,c){return t=new t2(t,e,n,l,c),e===1?(e=1,i===!0&&(e|=8)):e=0,i=nr(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Cg(i),t}function n2(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:io,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function X1(t){if(!t)return Xs;t=t._reactInternals;e:{if(Ni(t)!==t||t.tag!==1)throw Error(ce(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if($n(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ce(171))}if(t.tag===1){var n=t.type;if($n(n))return Xx(t,n,e)}return e}function Q1(t,e,n,r,s,i,o,l,c){return t=Wg(n,r,!0,t,s,i,o,l,c),t.context=X1(null),n=t.current,r=wn(),s=Us(n),i=es(r,s),i.callback=e??null,$s(n,i,s),t.current.lanes=s,Fl(t,s,r),Fn(t,r),t}function Pu(t,e,n,r){var s=e.current,i=wn(),o=Us(s);return n=X1(n),e.context===null?e.context=n:e.pendingContext=n,e=es(i,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=$s(s,e,o),t!==null&&(_r(t,s,o,i),rd(t,s,o)),o}function Vd(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Qy(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Gg(t,e){Qy(t,e),(t=t.alternate)&&Qy(t,e)}function r2(){return null}var J1=typeof reportError=="function"?reportError:function(t){console.error(t)};function Vg(t){this._internalRoot=t}Ou.prototype.render=Vg.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(ce(409));Pu(t,e,null,null)};Ou.prototype.unmount=Vg.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Ci(function(){Pu(null,t,null,null)}),e[ss]=null}};function Ou(t){this._internalRoot=t}Ou.prototype.unstable_scheduleHydration=function(t){if(t){var e=kx();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Ss.length&&e!==0&&e<Ss[n].priority;n++);Ss.splice(n,0,t),n===0&&Ax(t)}};function Yg(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Lu(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Jy(){}function s2(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var d=Vd(o);i.call(d)}}var o=Q1(e,r,t,0,null,!1,!1,"",Jy);return t._reactRootContainer=o,t[ss]=o.current,gl(t.nodeType===8?t.parentNode:t),Ci(),o}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var l=r;r=function(){var d=Vd(c);l.call(d)}}var c=Wg(t,0,!1,null,null,!1,!1,"",Jy);return t._reactRootContainer=c,t[ss]=c.current,gl(t.nodeType===8?t.parentNode:t),Ci(function(){Pu(e,c,n,r)}),c}function Du(t,e,n,r,s){var i=n._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var l=s;s=function(){var c=Vd(o);l.call(c)}}Pu(e,o,t,s)}else o=s2(n,e,t,s,r);return Vd(o)}wx=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Na(e.pendingLanes);n!==0&&(fg(e,n|1),Fn(e,Ht()),!(pt&6)&&(Fo=Ht()+500,ri()))}break;case 13:Ci(function(){var r=is(t,1);if(r!==null){var s=wn();_r(r,t,1,s)}}),Gg(t,1)}};hg=function(t){if(t.tag===13){var e=is(t,134217728);if(e!==null){var n=wn();_r(e,t,134217728,n)}Gg(t,134217728)}};Cx=function(t){if(t.tag===13){var e=Us(t),n=is(t,e);if(n!==null){var r=wn();_r(n,t,e,r)}Gg(t,e)}};kx=function(){return bt};Rx=function(t,e){var n=bt;try{return bt=t,e()}finally{bt=n}};Bh=function(t,e,n){switch(e){case"input":if(Dh(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=Iu(r);if(!s)throw Error(ce(90));ox(r),Dh(r,s)}}}break;case"textarea":lx(t,n);break;case"select":e=n.value,e!=null&&xo(t,!!n.multiple,e,!1)}};gx=Ug;mx=Ci;var i2={usingClientEntryPoint:!1,Events:[Bl,uo,Iu,hx,px,Ug]},wa={findFiberByHostInstance:yi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},o2={bundleType:wa.bundleType,version:wa.version,rendererPackageName:wa.rendererPackageName,rendererConfig:wa.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ds.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=_x(t),t===null?null:t.stateNode},findFiberByHostInstance:wa.findFiberByHostInstance||r2,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var zc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!zc.isDisabled&&zc.supportsFiber)try{xu=zc.inject(o2),Nr=zc}catch{}}Kn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=i2;Kn.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Yg(e))throw Error(ce(200));return n2(t,e,null,n)};Kn.createRoot=function(t,e){if(!Yg(t))throw Error(ce(299));var n=!1,r="",s=J1;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=Wg(t,1,!1,null,null,n,!1,r,s),t[ss]=e.current,gl(t.nodeType===8?t.parentNode:t),new Vg(e)};Kn.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(ce(188)):(t=Object.keys(t).join(","),Error(ce(268,t)));return t=_x(e),t=t===null?null:t.stateNode,t};Kn.flushSync=function(t){return Ci(t)};Kn.hydrate=function(t,e,n){if(!Lu(e))throw Error(ce(200));return Du(null,t,e,!0,n)};Kn.hydrateRoot=function(t,e,n){if(!Yg(t))throw Error(ce(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",o=J1;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=Q1(e,null,t,1,n??null,s,!1,i,o),t[ss]=e.current,gl(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new Ou(e)};Kn.render=function(t,e,n){if(!Lu(e))throw Error(ce(200));return Du(null,t,e,!1,n)};Kn.unmountComponentAtNode=function(t){if(!Lu(t))throw Error(ce(40));return t._reactRootContainer?(Ci(function(){Du(null,null,t,!1,function(){t._reactRootContainer=null,t[ss]=null})}),!0):!1};Kn.unstable_batchedUpdates=Ug;Kn.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Lu(n))throw Error(ce(200));if(t==null||t._reactInternals===void 0)throw Error(ce(38));return Du(t,e,n,!1,r)};Kn.version="18.3.1-next-f1338f8080-20240426";function q1(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(q1)}catch(t){console.error(t)}}q1(),q_.exports=Kn;var a2=q_.exports,qy=a2;Ch.createRoot=qy.createRoot,Ch.hydrateRoot=qy.hydrateRoot;const Ca=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},l2=1280,c2=720,d2=({onStartConfig:t,audioSettings:e,onAudioSettingsChange:n,playerId:r,onGalleryStart:s,isAnonymous:i=!0,userId:o=null,onNavigateToRegister:l,onNavigateToLogin:c,onNavigateToProfile:d,onLogout:u})=>{const[h,f]=O.useState("title"),[x,k]=O.useState(!1);O.useEffect(()=>{console.log(" TitleScreen auth state:",{isAnonymous:i,userId:o})},[i,o]);const[T,j]=O.useState("home"),[b,v]=O.useState(!1),[S,p]=O.useState(""),[F,H]=O.useState(!1),[z]=O.useState(()=>localStorage.getItem("homeCardId")),[W,q]=O.useState(25),[de,ve]=O.useState(!1),Ne=O.useRef(0),ue=O.useRef(0),[w,L]=O.useState(1);O.useEffect(()=>{const G=()=>{const Ie=window.innerWidth/l2,ne=window.innerHeight/c2;L(Math.min(Ie,ne))};return G(),window.addEventListener("resize",G),()=>window.removeEventListener("resize",G)},[]);const C=()=>{k(!0),setTimeout(()=>{f("home"),k(!1)},600)},R=G=>{ve(!0),Ne.current=G.clientX,ue.current=W},y=G=>{if(!de)return;const Ie=G.clientX-Ne.current,ne=ue.current+Ie*.5;q(Math.max(-180,Math.min(180,ne)))},g=()=>{ve(!1)},I=G=>{t(G==="casual"?"CASUAL_MATCH":"RANKED_MATCH")},A=()=>{H(!0)},D=()=>{H(!1),u&&u()},J=()=>{H(!1)},U=9*w;if(h==="title")return a.jsxs("div",{className:"screen title-screen",onClick:C,style:{height:"100dvh",width:"100vw",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative",overflow:"hidden",color:"white",cursor:"pointer"},children:[a.jsx("div",{style:{position:"absolute",inset:0,backgroundImage:`url(${Ca("/title/background.png")})`,backgroundSize:"cover",backgroundPosition:"center",zIndex:0}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",zIndex:-1}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(0, 0, 0, 0.3)",zIndex:1}}),a.jsxs("div",{style:{position:"relative",zIndex:2,display:"flex",flexDirection:"column",alignItems:"center",transform:x?"translateY(-100vh)":"translateY(0)",transition:x?"transform 0.6s ease-in":"none"},children:[a.jsx("div",{style:{fontFamily:"Tamanegi, sans-serif",fontSize:`${U}rem`,color:"#fff",textShadow:"0 0 30px rgba(233, 69, 96, 0.9), 0 0 60px rgba(233, 69, 96, 0.5), 3px 3px 6px rgba(0,0,0,0.9)",letterSpacing:`${.5*w}rem`,whiteSpace:"nowrap",marginBottom:`${2*w}rem`},children:""}),a.jsx("div",{style:{fontSize:`${2*w}rem`,color:"#fff",fontWeight:"bold",letterSpacing:`${.3*w}rem`,animation:"blink 1.5s ease-in-out infinite",textShadow:"0 0 10px rgba(255, 255, 255, 0.8)"},children:"GAME START"})]}),a.jsx("p",{style:{position:"absolute",bottom:20*w,opacity:.5,fontSize:`${.8*w}rem`,zIndex:2},children:"Ver 1.04 Beta"}),a.jsx("style",{children:`
                    @keyframes blink {
                        0%, 100% { opacity: 1; }
                        50% { opacity: 0.3; }
                    }
                `})]});const ge=[{id:"solo",label:"",color:"#e94560"},{id:"room",label:"",color:"#60a5fa"},{id:"random",label:"",color:"#4ade80"},{id:"home",label:"",color:"#f59e0b"},{id:"ranking",label:"",color:"#a855f7"},{id:"gallery",label:"",color:"#ec4899"},{id:"settings",label:"",color:"#6b7280"}];return a.jsxs("div",{className:"screen home-screen",style:{height:"100dvh",width:"100vw",display:"flex",flexDirection:"column",position:"relative",overflow:"hidden",color:"white"},onMouseMove:y,onMouseUp:g,onMouseLeave:g,children:[a.jsx("div",{style:{position:"absolute",inset:0,backgroundImage:`url(${Ca("/title/background.png")})`,backgroundSize:"cover",backgroundPosition:"center",zIndex:0}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",zIndex:-1}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(0, 0, 0, 0.5)",zIndex:1}}),a.jsx("div",{style:{position:"absolute",top:20*w,left:"50%",transform:"translateX(-50%)",fontFamily:"Tamanegi, sans-serif",fontSize:`${2.5*w}rem`,color:"#fff",textShadow:"0 0 15px rgba(233, 69, 96, 0.7)",letterSpacing:`${.2*w}rem`,zIndex:10},children:""}),a.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",paddingBottom:80*w,position:"relative",zIndex:2},children:[T==="home"&&a.jsxs("div",{style:{position:"absolute",left:50*w,top:"50%",transform:"translateY(-50%)",perspective:1e3},children:[a.jsxs("div",{onMouseDown:R,style:{width:200*w,height:280*w,transformStyle:"preserve-3d",transform:`rotateY(${W}deg)`,transition:de?"none":"transform 0.3s ease-out",cursor:de?"grabbing":"grab"},children:[a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",borderRadius:12*w,background:z?`url(${Ca(`/cards/${z}.png`)})`:"linear-gradient(135deg, #2d3748 0%, #1a202c 100%)",backgroundSize:"cover",backgroundPosition:"center",border:`3px solid ${z?"#e94560":"#4a5568"}`,boxShadow:"0 10px 30px rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center"},children:!z&&a.jsxs("span",{style:{fontSize:`${.9*w}rem`,color:"#718096",textAlign:"center",padding:20*w},children:["",a.jsx("br",{}),"",a.jsx("br",{}),""]})}),a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",transform:"rotateY(180deg)",borderRadius:12*w,background:z?`url(${Ca(`/cards/${z}_evolved.png`)})`:`url(${Ca("/cards/sleeve_default.png")})`,backgroundSize:"cover",backgroundPosition:"center",border:`3px solid ${z?"#a855f7":"#4a5568"}`,boxShadow:"0 10px 30px rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center"},children:!z&&a.jsx("span",{style:{fontSize:`${.8*w}rem`,color:"#718096"},children:""})})]}),a.jsx("p",{style:{textAlign:"center",marginTop:10*w,fontSize:`${.75*w}rem`,color:"#888"},children:""})]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",maxWidth:600*w},children:[T==="home"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*w}rem`,marginBottom:`${1*w}rem`},children:""}),a.jsx("p",{style:{fontSize:`${1*w}rem`,color:"#aaa"},children:""})]}),T==="solo"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*w}rem`,marginBottom:`${1*w}rem`,color:"#e94560"},children:""}),a.jsx("button",{onClick:()=>t("CPU"),style:{padding:`${1*w}rem ${3*w}rem`,fontSize:`${1.2*w}rem`,background:"#e94560",border:"none",borderRadius:8*w,color:"white",cursor:"pointer",fontWeight:"bold"},children:"CPU"})]}),T==="room"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*w}rem`,marginBottom:`${1.5*w}rem`,color:"#60a5fa"},children:""}),b?a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:`${1*w}rem`,alignItems:"center"},children:[a.jsx("input",{type:"text",placeholder:"ID",value:S,onChange:G=>p(G.target.value),style:{padding:`${.8*w}rem`,fontSize:`${1*w}rem`,width:250*w,background:"rgba(255,255,255,0.1)",border:"2px solid #a855f7",borderRadius:8*w,color:"white",textAlign:"center"}}),a.jsxs("div",{style:{display:"flex",gap:`${.5*w}rem`},children:[a.jsx("button",{onClick:()=>v(!1),style:{padding:`${.6*w}rem ${1.5*w}rem`,fontSize:`${1*w}rem`,background:"transparent",border:"1px solid #666",borderRadius:6*w,color:"#888",cursor:"pointer"},children:""}),a.jsx("button",{onClick:()=>t("JOIN",S),disabled:!S,style:{padding:`${.6*w}rem ${1.5*w}rem`,fontSize:`${1*w}rem`,background:S?"#a855f7":"#333",border:"none",borderRadius:6*w,color:"white",cursor:S?"pointer":"not-allowed",opacity:S?1:.5},children:""})]})]}):a.jsxs("div",{style:{display:"flex",gap:`${3*w}rem`,perspective:1200},children:[a.jsxs("div",{onClick:()=>t("HOST"),style:{width:200*w,height:280*w,background:"linear-gradient(135deg, #1a2a3a 0%, #0d1a2a 100%)",border:"3px solid #60a5fa",borderRadius:16*w,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(96, 165, 250, 0.3)"},onMouseOver:G=>{G.currentTarget.style.transform="rotateY(0deg) scale(1.05)",G.currentTarget.style.boxShadow="0 15px 40px rgba(96, 165, 250, 0.5)"},onMouseOut:G=>{G.currentTarget.style.transform="rotateY(15deg)",G.currentTarget.style.boxShadow="0 10px 30px rgba(96, 165, 250, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*w}rem`,marginBottom:`${.5*w}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*w}rem`,color:"#60a5fa",margin:0,marginBottom:`${.5*w}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*w}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*w}rem`},children:["ID",a.jsx("br",{}),""]})]}),a.jsxs("div",{onClick:()=>v(!0),style:{width:200*w,height:280*w,background:"linear-gradient(135deg, #2a1a3a 0%, #1a0d2a 100%)",border:"3px solid #a855f7",borderRadius:16*w,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(-15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(168, 85, 247, 0.3)"},onMouseOver:G=>{G.currentTarget.style.transform="rotateY(0deg) scale(1.05)",G.currentTarget.style.boxShadow="0 15px 40px rgba(168, 85, 247, 0.5)"},onMouseOut:G=>{G.currentTarget.style.transform="rotateY(-15deg)",G.currentTarget.style.boxShadow="0 10px 30px rgba(168, 85, 247, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*w}rem`,marginBottom:`${.5*w}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*w}rem`,color:"#a855f7",margin:0,marginBottom:`${.5*w}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*w}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*w}rem`},children:["ID",a.jsx("br",{}),""]})]})]})]}),T==="random"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*w}rem`,marginBottom:`${1.5*w}rem`,color:"#4ade80"},children:""}),a.jsxs("div",{style:{display:"flex",gap:`${3*w}rem`,perspective:1200},children:[a.jsxs("div",{onClick:()=>I("casual"),style:{width:200*w,height:280*w,background:"linear-gradient(135deg, #1a3a1a 0%, #0d2d0d 100%)",border:"3px solid #4ade80",borderRadius:16*w,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(74, 222, 128, 0.3)"},onMouseOver:G=>{G.currentTarget.style.transform="rotateY(0deg) scale(1.05)",G.currentTarget.style.boxShadow="0 15px 40px rgba(74, 222, 128, 0.5)"},onMouseOut:G=>{G.currentTarget.style.transform="rotateY(15deg)",G.currentTarget.style.boxShadow="0 10px 30px rgba(74, 222, 128, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*w}rem`,marginBottom:`${.5*w}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*w}rem`,color:"#4ade80",margin:0,marginBottom:`${.5*w}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*w}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*w}rem`},children:["",a.jsx("br",{}),""]})]}),a.jsxs("div",{onClick:()=>I("ranked"),style:{width:200*w,height:280*w,background:"linear-gradient(135deg, #3a1a1a 0%, #2d0d0d 100%)",border:"3px solid #e94560",borderRadius:16*w,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(-15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(233, 69, 96, 0.3)"},onMouseOver:G=>{G.currentTarget.style.transform="rotateY(0deg) scale(1.05)",G.currentTarget.style.boxShadow="0 15px 40px rgba(233, 69, 96, 0.5)"},onMouseOut:G=>{G.currentTarget.style.transform="rotateY(-15deg)",G.currentTarget.style.boxShadow="0 10px 30px rgba(233, 69, 96, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*w}rem`,marginBottom:`${.5*w}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*w}rem`,color:"#e94560",margin:0,marginBottom:`${.5*w}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*w}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*w}rem`},children:["",a.jsx("br",{}),""]})]})]})]}),T==="ranking"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*w}rem`,marginBottom:`${1*w}rem`,color:"#a855f7"},children:""}),a.jsx("p",{style:{fontSize:`${1*w}rem`,color:"#888"},children:"Coming Soon..."})]}),T==="settings"&&a.jsxs("div",{style:{background:"rgba(0, 0, 0, 0.3)",borderRadius:12*w,padding:`${2*w}rem`,minWidth:400*w},children:[a.jsx("h2",{style:{fontSize:`${1.8*w}rem`,marginBottom:`${1.5*w}rem`,color:"#6b7280",textAlign:"center"},children:""}),a.jsxs("div",{style:{marginBottom:`${1.5*w}rem`},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:`${.5*w}rem`},children:[a.jsx("span",{style:{fontSize:`${1*w}rem`},children:"BGM"}),a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8*w,cursor:"pointer"},children:[a.jsx("input",{type:"checkbox",checked:e.bgmEnabled,onChange:G=>n({bgmEnabled:G.target.checked}),style:{width:18*w,height:18*w}}),a.jsx("span",{style:{color:e.bgmEnabled?"#4ade80":"#888",fontSize:`${.9*w}rem`},children:e.bgmEnabled?"ON":"OFF"})]})]}),a.jsx("input",{type:"range",min:0,max:1,step:.05,value:e.bgm,onChange:G=>n({bgm:parseFloat(G.target.value)}),disabled:!e.bgmEnabled,style:{width:"100%",opacity:e.bgmEnabled?1:.5}})]}),a.jsxs("div",{style:{marginBottom:`${1.5*w}rem`},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:`${.5*w}rem`},children:[a.jsx("span",{style:{fontSize:`${1*w}rem`},children:""}),a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8*w,cursor:"pointer"},children:[a.jsx("input",{type:"checkbox",checked:e.seEnabled,onChange:G=>n({seEnabled:G.target.checked}),style:{width:18*w,height:18*w}}),a.jsx("span",{style:{color:e.seEnabled?"#4ade80":"#888",fontSize:`${.9*w}rem`},children:e.seEnabled?"ON":"OFF"})]})]}),a.jsx("input",{type:"range",min:0,max:1,step:.05,value:e.se,onChange:G=>n({se:parseFloat(G.target.value)}),disabled:!e.seEnabled,style:{width:"100%",opacity:e.seEnabled?1:.5}})]}),a.jsxs("div",{style:{borderTop:"1px solid rgba(255, 255, 255, 0.1)",paddingTop:`${1.5*w}rem`,marginTop:`${1*w}rem`,marginBottom:`${1.5*w}rem`},children:[a.jsx("h3",{style:{fontSize:`${1.2*w}rem`,marginBottom:`${1*w}rem`,color:"#fff"},children:""}),a.jsx("button",{onClick:d,style:{width:"100%",padding:`${.6*w}rem ${1*w}rem`,fontSize:`${.9*w}rem`,background:"linear-gradient(135deg, #a855f7 0%, #7c3aed 100%)",border:"none",borderRadius:6*w,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s"},onMouseEnter:G=>G.currentTarget.style.transform="scale(1.05)",onMouseLeave:G=>G.currentTarget.style.transform="scale(1)",children:""})]}),a.jsxs("div",{style:{borderTop:"1px solid rgba(255, 255, 255, 0.1)",paddingTop:`${1.5*w}rem`,marginTop:`${1*w}rem`},children:[a.jsx("h3",{style:{fontSize:`${1.2*w}rem`,marginBottom:`${1*w}rem`,color:"#fff"},children:""}),i?a.jsxs("div",{children:[a.jsx("p",{style:{fontSize:`${.9*w}rem`,color:"#aaa",marginBottom:`${1*w}rem`},children:""}),a.jsxs("div",{style:{display:"flex",gap:10*w,marginBottom:`${1*w}rem`},children:[a.jsx("button",{onClick:l,style:{flex:1,padding:`${.6*w}rem ${1*w}rem`,fontSize:`${.9*w}rem`,background:"linear-gradient(135deg, #4a9eff 0%, #357abd 100%)",border:"none",borderRadius:6*w,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s"},onMouseEnter:G=>G.currentTarget.style.transform="scale(1.05)",onMouseLeave:G=>G.currentTarget.style.transform="scale(1)",children:""}),a.jsx("button",{onClick:c,style:{flex:1,padding:`${.6*w}rem ${1*w}rem`,fontSize:`${.9*w}rem`,background:"#555",border:"none",borderRadius:6*w,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s"},onMouseEnter:G=>G.currentTarget.style.background="#666",onMouseLeave:G=>G.currentTarget.style.background="#555",children:""})]}),a.jsx("p",{style:{fontSize:`${.75*w}rem`,color:"#888",textAlign:"center",lineHeight:1.4},children:""})]}):a.jsxs("div",{children:[a.jsx("p",{style:{fontSize:`${.9*w}rem`,color:"#4ade80",marginBottom:`${.5*w}rem`,fontWeight:"bold"},children:""}),a.jsxs("p",{style:{fontSize:`${.85*w}rem`,color:"#fff",marginBottom:`${.3*w}rem`},children:["ID: ",a.jsx("span",{style:{color:"#4a9eff",fontWeight:"bold"},children:o||""})]}),a.jsx("button",{onClick:A,style:{width:"100%",padding:`${.6*w}rem ${1*w}rem`,fontSize:`${.9*w}rem`,background:"#d32f2f",border:"none",borderRadius:6*w,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s",marginTop:`${.5*w}rem`},onMouseEnter:G=>G.currentTarget.style.background="#b71c1c",onMouseLeave:G=>G.currentTarget.style.background="#d32f2f",children:""})]})]})]})]})]}),a.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:70*w,background:"rgba(0, 0, 0, 0.8)",borderTop:"2px solid rgba(255, 255, 255, 0.1)",display:"flex",justifyContent:"center",alignItems:"center",gap:`${.5*w}rem`,padding:`0 ${1*w}rem`,zIndex:3},children:ge.map(G=>a.jsx("button",{onClick:()=>{G.id==="gallery"?s():j(G.id)},style:{flex:1,maxWidth:140*w,padding:`${.6*w}rem ${.5*w}rem`,fontSize:`${.85*w}rem`,background:T===G.id?G.color:"transparent",border:T===G.id?"none":`2px solid ${G.color}`,borderRadius:8*w,color:T===G.id?"white":G.color,cursor:"pointer",transition:"all 0.2s",fontWeight:T===G.id?"bold":"normal"},children:G.label},G.id))}),a.jsx("p",{style:{position:"absolute",bottom:75*w,right:20*w,opacity:.5,fontSize:`${.7*w}rem`,zIndex:2},children:"Ver 1.04 Beta"}),F&&a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0, 0, 0, 0.7)",zIndex:100},children:a.jsxs("div",{style:{background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",borderRadius:12*w,padding:`${2*w}rem`,minWidth:300*w,border:"2px solid rgba(255, 255, 255, 0.2)",boxShadow:"0 10px 30px rgba(0, 0, 0, 0.5)"},children:[a.jsx("h3",{style:{fontSize:`${1.2*w}rem`,marginBottom:`${1*w}rem`,color:"#fff",textAlign:"center"},children:""}),a.jsxs("div",{style:{display:"flex",gap:10*w,marginTop:`${1.5*w}rem`},children:[a.jsx("button",{onClick:J,style:{flex:1,padding:`${.6*w}rem ${1*w}rem`,fontSize:`${.9*w}rem`,background:"#555",border:"none",borderRadius:6*w,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s"},onMouseEnter:G=>G.currentTarget.style.background="#666",onMouseLeave:G=>G.currentTarget.style.background="#555",children:""}),a.jsx("button",{onClick:D,style:{flex:1,padding:`${.6*w}rem ${1*w}rem`,fontSize:`${.9*w}rem`,background:"#d32f2f",border:"none",borderRadius:6*w,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s"},onMouseEnter:G=>G.currentTarget.style.background="#b71c1c",onMouseLeave:G=>G.currentTarget.style.background="#d32f2f",children:""})]})]})})]})},u2=()=>{};var Zy={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z1={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fe=function(t,e){if(!t)throw Jo(e)},Jo=function(t){return new Error("Firebase Database ("+Z1.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eb=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},f2=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=t[n++],o=t[n++],l=t[n++],c=((s&7)<<18|(i&63)<<12|(o&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{const i=t[n++],o=t[n++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},Kg={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<t.length;s+=3){const i=t[s],o=s+1<t.length,l=o?t[s+1]:0,c=s+2<t.length,d=c?t[s+2]:0,u=i>>2,h=(i&3)<<4|l>>4;let f=(l&15)<<2|d>>6,x=d&63;c||(x=64,o||(f=64)),r.push(n[u],n[h],n[f],n[x])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(eb(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):f2(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<t.length;){const i=n[t.charAt(s++)],l=s<t.length?n[t.charAt(s)]:0;++s;const d=s<t.length?n[t.charAt(s)]:64;++s;const h=s<t.length?n[t.charAt(s)]:64;if(++s,i==null||l==null||d==null||h==null)throw new h2;const f=i<<2|l>>4;if(r.push(f),d!==64){const x=l<<4&240|d>>2;if(r.push(x),h!==64){const k=d<<6&192|h;r.push(k)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class h2 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const tb=function(t){const e=eb(t);return Kg.encodeByteArray(e,!0)},Yd=function(t){return tb(t).replace(/\./g,"")},Kd=function(t){try{return Kg.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p2(t){return nb(void 0,t)}function nb(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const n=e;return new Date(n.getTime());case Object:t===void 0&&(t={});break;case Array:t=[];break;default:return e}for(const n in e)!e.hasOwnProperty(n)||!g2(n)||(t[n]=nb(t[n],e[n]));return t}function g2(t){return t!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m2(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y2=()=>m2().__FIREBASE_DEFAULTS__,v2=()=>{if(typeof process>"u"||typeof Zy>"u")return;const t=Zy.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},_2=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&Kd(t[1]);return e&&JSON.parse(e)},Xg=()=>{try{return u2()||y2()||v2()||_2()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},rb=t=>{var e,n;return(n=(e=Xg())==null?void 0:e.emulatorHosts)==null?void 0:n[t]},x2=t=>{const e=rb(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},sb=()=>{var t;return(t=Xg())==null?void 0:t.config},ib=t=>{var e;return(e=Xg())==null?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pr{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qo(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function ob(t){return(await fetch(t,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function b2(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",s=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...t};return[Yd(JSON.stringify(n)),Yd(JSON.stringify(o)),""].join(".")}const Qa={};function E2(){const t={prod:[],emulator:[]};for(const e of Object.keys(Qa))Qa[e]?t.emulator.push(e):t.prod.push(e);return t}function S2(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let ev=!1;function ab(t,e){if(typeof window>"u"||typeof document>"u"||!qo(window.location.host)||Qa[t]===e||Qa[t]||ev)return;Qa[t]=e;function n(f){return`__firebase__banner__${f}`}const r="__firebase__banner",i=E2().prod.length>0;function o(){const f=document.getElementById(r);f&&f.remove()}function l(f){f.style.display="flex",f.style.background="#7faaf0",f.style.position="fixed",f.style.bottom="5px",f.style.left="5px",f.style.padding=".5em",f.style.borderRadius="5px",f.style.alignItems="center"}function c(f,x){f.setAttribute("width","24"),f.setAttribute("id",x),f.setAttribute("height","24"),f.setAttribute("viewBox","0 0 24 24"),f.setAttribute("fill","none"),f.style.marginLeft="-6px"}function d(){const f=document.createElement("span");return f.style.cursor="pointer",f.style.marginLeft="16px",f.style.fontSize="24px",f.innerHTML=" &times;",f.onclick=()=>{ev=!0,o()},f}function u(f,x){f.setAttribute("id",x),f.innerText="Learn more",f.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",f.setAttribute("target","__blank"),f.style.paddingLeft="5px",f.style.textDecoration="underline"}function h(){const f=S2(r),x=n("text"),k=document.getElementById(x)||document.createElement("span"),T=n("learnmore"),j=document.getElementById(T)||document.createElement("a"),b=n("preprendIcon"),v=document.getElementById(b)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(f.created){const S=f.element;l(S),u(j,T);const p=d();c(v,b),S.append(v,k,j,p),document.body.appendChild(S)}i?(k.innerText="Preview backend disconnected.",v.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(v.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,k.innerText="Preview backend running in this workspace."),k.setAttribute("id",x)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",h):h()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Qg(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(kn())}function I2(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function T2(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function lb(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function w2(){const t=kn();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function C2(){return Z1.NODE_ADMIN===!0}function k2(){try{return typeof indexedDB=="object"}catch{return!1}}function R2(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var i;e(((i=s.error)==null?void 0:i.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A2="FirebaseError";class si extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=A2,Object.setPrototypeOf(this,si.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Hl.prototype.create)}}class Hl{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?P2(i,r):"Error",l=`${this.serviceName}: ${o} (${s}).`;return new si(s,l,r)}}function P2(t,e){return t.replace(O2,(n,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const O2=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Il(t){return JSON.parse(t)}function Xt(t){return JSON.stringify(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cb=function(t){let e={},n={},r={},s="";try{const i=t.split(".");e=Il(Kd(i[0])||""),n=Il(Kd(i[1])||""),s=i[2],r=n.d||{},delete n.d}catch{}return{header:e,claims:n,data:r,signature:s}},L2=function(t){const e=cb(t),n=e.claims;return!!n&&typeof n=="object"&&n.hasOwnProperty("iat")},D2=function(t){const e=cb(t).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sr(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function ki(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}function Xd(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Qd(t,e,n){const r={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(r[s]=e.call(n,t[s],s,t));return r}function Ri(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const i=t[s],o=e[s];if(tv(i)&&tv(o)){if(!Ri(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function tv(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zo(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function $a(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Fa(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M2{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,n){n||(n=0);const r=this.W_;if(typeof e=="string")for(let h=0;h<16;h++)r[h]=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),n+=4;else for(let h=0;h<16;h++)r[h]=e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3],n+=4;for(let h=16;h<80;h++){const f=r[h-3]^r[h-8]^r[h-14]^r[h-16];r[h]=(f<<1|f>>>31)&4294967295}let s=this.chain_[0],i=this.chain_[1],o=this.chain_[2],l=this.chain_[3],c=this.chain_[4],d,u;for(let h=0;h<80;h++){h<40?h<20?(d=l^i&(o^l),u=1518500249):(d=i^o^l,u=1859775393):h<60?(d=i&o|l&(i|o),u=2400959708):(d=i^o^l,u=3395469782);const f=(s<<5|s>>>27)+d+c+u+r[h]&4294967295;c=l,l=o,o=(i<<30|i>>>2)&4294967295,i=s,s=f}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+i&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,n){if(e==null)return;n===void 0&&(n=e.length);const r=n-this.blockSize;let s=0;const i=this.buf_;let o=this.inbuf_;for(;s<n;){if(o===0)for(;s<=r;)this.compress_(e,s),s+=this.blockSize;if(typeof e=="string"){for(;s<n;)if(i[o]=e.charCodeAt(s),++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}else for(;s<n;)if(i[o]=e[s],++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=n}digest(){const e=[];let n=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=n&255,n/=256;this.compress_(this.buf_);let r=0;for(let s=0;s<5;s++)for(let i=24;i>=0;i-=8)e[r]=this.chain_[s]>>i&255,++r;return e}}function N2(t,e){const n=new j2(t,e);return n.subscribe.bind(n)}class j2{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let s;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");$2(e,["next","error","complete"])?s=e:s={next:e,error:n,complete:r},s.next===void 0&&(s.next=dh),s.error===void 0&&(s.error=dh),s.complete===void 0&&(s.complete=dh);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function $2(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function dh(){}function Uo(t,e){return`${t} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F2=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);if(s>=55296&&s<=56319){const i=s-55296;r++,fe(r<t.length,"Surrogate pair missing trail surrogate.");const o=t.charCodeAt(r)-56320;s=65536+(i<<10)+o}s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):s<65536?(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},Mu=function(t){let e=0;for(let n=0;n<t.length;n++){const r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,n++):e+=3}return e};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jt(t){return t&&t._delegate?t._delegate:t}class Ai{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pi="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U2{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new pr;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:n});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(z2(e))try{this.getOrInitializeService({instanceIdentifier:pi})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(n);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=pi){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=pi){return this.instances.has(e)}getOptions(e=pi){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[i,o]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);r===l&&o.resolve(s)}return s}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const s of r)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:B2(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=pi){return this.component?this.component.multipleInstances?e:pi:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function B2(t){return t===pi?void 0:t}function z2(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H2{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new U2(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var It;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(It||(It={}));const W2={debug:It.DEBUG,verbose:It.VERBOSE,info:It.INFO,warn:It.WARN,error:It.ERROR,silent:It.SILENT},G2=It.INFO,V2={[It.DEBUG]:"log",[It.VERBOSE]:"log",[It.INFO]:"info",[It.WARN]:"warn",[It.ERROR]:"error"},Y2=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),s=V2[e];if(s)console[s](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Jg{constructor(e){this.name=e,this._logLevel=G2,this._logHandler=Y2,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in It))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?W2[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,It.DEBUG,...e),this._logHandler(this,It.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,It.VERBOSE,...e),this._logHandler(this,It.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,It.INFO,...e),this._logHandler(this,It.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,It.WARN,...e),this._logHandler(this,It.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,It.ERROR,...e),this._logHandler(this,It.ERROR,...e)}}const K2=(t,e)=>e.some(n=>t instanceof n);let nv,rv;function X2(){return nv||(nv=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Q2(){return rv||(rv=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const db=new WeakMap,xp=new WeakMap,ub=new WeakMap,uh=new WeakMap,qg=new WeakMap;function J2(t){const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("success",i),t.removeEventListener("error",o)},i=()=>{n(zs(t.result)),s()},o=()=>{r(t.error),s()};t.addEventListener("success",i),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&db.set(n,t)}).catch(()=>{}),qg.set(e,t),e}function q2(t){if(xp.has(t))return;const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",o),t.removeEventListener("abort",o)},i=()=>{n(),s()},o=()=>{r(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",i),t.addEventListener("error",o),t.addEventListener("abort",o)});xp.set(t,e)}let bp={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return xp.get(t);if(e==="objectStoreNames")return t.objectStoreNames||ub.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return zs(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function Z2(t){bp=t(bp)}function eC(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(fh(this),e,...n);return ub.set(r,e.sort?e.sort():[e]),zs(r)}:Q2().includes(t)?function(...e){return t.apply(fh(this),e),zs(db.get(this))}:function(...e){return zs(t.apply(fh(this),e))}}function tC(t){return typeof t=="function"?eC(t):(t instanceof IDBTransaction&&q2(t),K2(t,X2())?new Proxy(t,bp):t)}function zs(t){if(t instanceof IDBRequest)return J2(t);if(uh.has(t))return uh.get(t);const e=tC(t);return e!==t&&(uh.set(t,e),qg.set(e,t)),e}const fh=t=>qg.get(t);function nC(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(t,e),l=zs(o);return r&&o.addEventListener("upgradeneeded",c=>{r(zs(o.result),c.oldVersion,c.newVersion,zs(o.transaction),c)}),n&&o.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),l.then(c=>{i&&c.addEventListener("close",()=>i()),s&&c.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),l}const rC=["get","getKey","getAll","getAllKeys","count"],sC=["put","add","delete","clear"],hh=new Map;function sv(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(hh.get(e))return hh.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=sC.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||rC.includes(n)))return;const i=async function(o,...l){const c=this.transaction(o,s?"readwrite":"readonly");let d=c.store;return r&&(d=d.index(l.shift())),(await Promise.all([d[n](...l),s&&c.done]))[0]};return hh.set(e,i),i}Z2(t=>({...t,get:(e,n,r)=>sv(e,n)||t.get(e,n,r),has:(e,n)=>!!sv(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iC{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(oC(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function oC(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Ep="@firebase/app",iv="0.14.6";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const as=new Jg("@firebase/app"),aC="@firebase/app-compat",lC="@firebase/analytics-compat",cC="@firebase/analytics",dC="@firebase/app-check-compat",uC="@firebase/app-check",fC="@firebase/auth",hC="@firebase/auth-compat",pC="@firebase/database",gC="@firebase/data-connect",mC="@firebase/database-compat",yC="@firebase/functions",vC="@firebase/functions-compat",_C="@firebase/installations",xC="@firebase/installations-compat",bC="@firebase/messaging",EC="@firebase/messaging-compat",SC="@firebase/performance",IC="@firebase/performance-compat",TC="@firebase/remote-config",wC="@firebase/remote-config-compat",CC="@firebase/storage",kC="@firebase/storage-compat",RC="@firebase/firestore",AC="@firebase/ai",PC="@firebase/firestore-compat",OC="firebase",LC="12.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sp="[DEFAULT]",DC={[Ep]:"fire-core",[aC]:"fire-core-compat",[cC]:"fire-analytics",[lC]:"fire-analytics-compat",[uC]:"fire-app-check",[dC]:"fire-app-check-compat",[fC]:"fire-auth",[hC]:"fire-auth-compat",[pC]:"fire-rtdb",[gC]:"fire-data-connect",[mC]:"fire-rtdb-compat",[yC]:"fire-fn",[vC]:"fire-fn-compat",[_C]:"fire-iid",[xC]:"fire-iid-compat",[bC]:"fire-fcm",[EC]:"fire-fcm-compat",[SC]:"fire-perf",[IC]:"fire-perf-compat",[TC]:"fire-rc",[wC]:"fire-rc-compat",[CC]:"fire-gcs",[kC]:"fire-gcs-compat",[RC]:"fire-fst",[PC]:"fire-fst-compat",[AC]:"fire-vertex","fire-js":"fire-js",[OC]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jd=new Map,MC=new Map,Ip=new Map;function ov(t,e){try{t.container.addComponent(e)}catch(n){as.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Bo(t){const e=t.name;if(Ip.has(e))return as.debug(`There were multiple attempts to register component ${e}.`),!1;Ip.set(e,t);for(const n of Jd.values())ov(n,t);for(const n of MC.values())ov(n,t);return!0}function Zg(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function er(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NC={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Hs=new Hl("app","Firebase",NC);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jC{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Ai("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Hs.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ea=LC;function fb(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:Sp,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw Hs.create("bad-app-name",{appName:String(s)});if(n||(n=sb()),!n)throw Hs.create("no-options");const i=Jd.get(s);if(i){if(Ri(n,i.options)&&Ri(r,i.config))return i;throw Hs.create("duplicate-app",{appName:s})}const o=new H2(s);for(const c of Ip.values())o.addComponent(c);const l=new jC(n,r,o);return Jd.set(s,l),l}function hb(t=Sp){const e=Jd.get(t);if(!e&&t===Sp&&sb())return fb();if(!e)throw Hs.create("no-app",{appName:t});return e}function Ws(t,e,n){let r=DC[t]??t;n&&(r+=`-${n}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const o=[`Unable to register library "${r}" with version "${e}":`];s&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),as.warn(o.join(" "));return}Bo(new Ai(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $C="firebase-heartbeat-database",FC=1,Tl="firebase-heartbeat-store";let ph=null;function pb(){return ph||(ph=nC($C,FC,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Tl)}catch(n){console.warn(n)}}}}).catch(t=>{throw Hs.create("idb-open",{originalErrorMessage:t.message})})),ph}async function UC(t){try{const n=(await pb()).transaction(Tl),r=await n.objectStore(Tl).get(gb(t));return await n.done,r}catch(e){if(e instanceof si)as.warn(e.message);else{const n=Hs.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});as.warn(n.message)}}}async function av(t,e){try{const r=(await pb()).transaction(Tl,"readwrite");await r.objectStore(Tl).put(e,gb(t)),await r.done}catch(n){if(n instanceof si)as.warn(n.message);else{const r=Hs.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});as.warn(r.message)}}}function gb(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BC=1024,zC=30;class HC{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new GC(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=lv();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)==null?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats.length>zC){const o=VC(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){as.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=lv(),{heartbeatsToSend:r,unsentEntries:s}=WC(this._heartbeatsCache.heartbeats),i=Yd(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(n){return as.warn(n),""}}}function lv(){return new Date().toISOString().substring(0,10)}function WC(t,e=BC){const n=[];let r=t.slice();for(const s of t){const i=n.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),cv(n)>e){i.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),cv(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class GC{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return k2()?R2().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await UC(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return av(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return av(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function cv(t){return Yd(JSON.stringify({version:2,heartbeats:t})).length}function VC(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YC(t){Bo(new Ai("platform-logger",e=>new iC(e),"PRIVATE")),Bo(new Ai("heartbeat",e=>new HC(e),"PRIVATE")),Ws(Ep,iv,t),Ws(Ep,iv,"esm2020"),Ws("fire-js","")}YC("");var KC="firebase",XC="12.7.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ws(KC,XC,"app");var dv={};const uv="@firebase/database",fv="1.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let mb="";function QC(t){mb=t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JC{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,n){n==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Xt(n))}get(e){const n=this.domStorage_.getItem(this.prefixedName_(e));return n==null?null:Il(n)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qC{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,n){n==null?delete this.cache_[e]:this.cache_[e]=n}get(e){return Sr(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yb=function(t){try{if(typeof window<"u"&&typeof window[t]<"u"){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new JC(e)}}catch{}return new qC},xi=yb("localStorage"),ZC=yb("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wo=new Jg("@firebase/database"),vb=function(){let t=1;return function(){return t++}}(),_b=function(t){const e=F2(t),n=new M2;n.update(e);const r=n.digest();return Kg.encodeByteArray(r)},Wl=function(...t){let e="";for(let n=0;n<t.length;n++){const r=t[n];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=Wl.apply(null,r):typeof r=="object"?e+=Xt(r):e+=r,e+=" "}return e};let Ja=null,hv=!0;const ek=function(t,e){fe(!0,"Can't turn on custom loggers persistently."),wo.logLevel=It.VERBOSE,Ja=wo.log.bind(wo)},nn=function(...t){if(hv===!0&&(hv=!1,Ja===null&&ZC.get("logging_enabled")===!0&&ek()),Ja){const e=Wl.apply(null,t);Ja(e)}},Gl=function(t){return function(...e){nn(t,...e)}},Tp=function(...t){const e="FIREBASE INTERNAL ERROR: "+Wl(...t);wo.error(e)},ls=function(...t){const e=`FIREBASE FATAL ERROR: ${Wl(...t)}`;throw wo.error(e),new Error(e)},Cn=function(...t){const e="FIREBASE WARNING: "+Wl(...t);wo.warn(e)},tk=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Cn("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Nu=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},nk=function(t){if(document.readyState==="complete")t();else{let e=!1;const n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&n()}),window.attachEvent("onload",n))}},zo="[MIN_NAME]",Pi="[MAX_NAME]",ji=function(t,e){if(t===e)return 0;if(t===zo||e===Pi)return-1;if(e===zo||t===Pi)return 1;{const n=pv(t),r=pv(e);return n!==null?r!==null?n-r===0?t.length-e.length:n-r:-1:r!==null?1:t<e?-1:1}},rk=function(t,e){return t===e?0:t<e?-1:1},ka=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+Xt(e))},e0=function(t){if(typeof t!="object"||t===null)return Xt(t);const e=[];for(const r in t)e.push(r);e.sort();let n="{";for(let r=0;r<e.length;r++)r!==0&&(n+=","),n+=Xt(e[r]),n+=":",n+=e0(t[e[r]]);return n+="}",n},xb=function(t,e){const n=t.length;if(n<=e)return[t];const r=[];for(let s=0;s<n;s+=e)s+e>n?r.push(t.substring(s,n)):r.push(t.substring(s,s+e));return r};function sn(t,e){for(const n in t)t.hasOwnProperty(n)&&e(n,t[n])}const bb=function(t){fe(!Nu(t),"Invalid JSON number");const e=11,n=52,r=(1<<e-1)-1;let s,i,o,l,c;t===0?(i=0,o=0,s=1/t===-1/0?1:0):(s=t<0,t=Math.abs(t),t>=Math.pow(2,1-r)?(l=Math.min(Math.floor(Math.log(t)/Math.LN2),r),i=l+r,o=Math.round(t*Math.pow(2,n-l)-Math.pow(2,n))):(i=0,o=Math.round(t/Math.pow(2,1-r-n))));const d=[];for(c=n;c;c-=1)d.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)d.push(i%2?1:0),i=Math.floor(i/2);d.push(s?1:0),d.reverse();const u=d.join("");let h="";for(c=0;c<64;c+=8){let f=parseInt(u.substr(c,8),2).toString(16);f.length===1&&(f="0"+f),h=h+f}return h.toLowerCase()},sk=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},ik=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function ok(t,e){let n="Unknown Error";t==="too_big"?n="The data requested exceeds the maximum size that can be accessed with a single request.":t==="permission_denied"?n="Client doesn't have permission to access the desired data.":t==="unavailable"&&(n="The service is unavailable");const r=new Error(t+" at "+e._path.toString()+": "+n);return r.code=t.toUpperCase(),r}const ak=new RegExp("^-?(0*)\\d{1,10}$"),lk=-2147483648,ck=2147483647,pv=function(t){if(ak.test(t)){const e=Number(t);if(e>=lk&&e<=ck)return e}return null},ta=function(t){try{t()}catch(e){setTimeout(()=>{const n=e.stack||"";throw Cn("Exception was thrown by user callback.",n),e},Math.floor(0))}},dk=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},qa=function(t,e){const n=setTimeout(t,e);return typeof n=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(n):typeof n=="object"&&n.unref&&n.unref(),n};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uk{constructor(e,n){this.appCheckProvider=n,this.appName=e.name,er(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=n==null?void 0:n.getImmediate({optional:!0}),this.appCheck||n==null||n.get().then(r=>this.appCheck=r)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((n,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(n,r):n(null)},0)})}addTokenChangeListener(e){var n;(n=this.appCheckProvider)==null||n.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){Cn(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fk{constructor(e,n,r){this.appName_=e,this.firebaseOptions_=n,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(n=>n&&n.code==="auth/token-not-initialized"?(nn("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(n)):new Promise((n,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(n,r):n(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(n=>n.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(n=>n.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Cn(e)}}class dd{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}dd.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t0="5",Eb="v",Sb="s",Ib="r",Tb="f",wb=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Cb="ls",kb="p",wp="ac",Rb="websocket",Ab="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pb{constructor(e,n,r,s,i=!1,o="",l=!1,c=!1,d=null){this.secure=n,this.namespace=r,this.webSocketOnly=s,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=l,this.isUsingEmulator=c,this.emulatorOptions=d,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=xi.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&xi.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",n=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${n}`}}function hk(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function Ob(t,e,n){fe(typeof e=="string","typeof type must == string"),fe(typeof n=="object","typeof params must == object");let r;if(e===Rb)r=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===Ab)r=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);hk(t)&&(n.ns=t.namespace);const s=[];return sn(n,(i,o)=>{s.push(i+"="+o)}),r+s.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pk{constructor(){this.counters_={}}incrementCounter(e,n=1){Sr(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=n}get(){return p2(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gh={},mh={};function n0(t){const e=t.toString();return gh[e]||(gh[e]=new pk),gh[e]}function gk(t,e){const n=t.toString();return mh[n]||(mh[n]=e()),mh[n]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mk{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,n){this.closeAfterResponse=e,this.onClose=n,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,n){for(this.pendingResponses[e]=n;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<r.length;++s)r[s]&&ta(()=>{this.onMessage_(r[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gv="start",yk="close",vk="pLPCommand",_k="pRTLPCB",Lb="id",Db="pw",Mb="ser",xk="cb",bk="seg",Ek="ts",Sk="d",Ik="dframe",Nb=1870,jb=30,Tk=Nb-jb,wk=25e3,Ck=3e4;class vo{constructor(e,n,r,s,i,o,l){this.connId=e,this.repoInfo=n,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.transportSessionId=o,this.lastSessionId=l,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Gl(e),this.stats_=n0(n),this.urlFn=c=>(this.appCheckToken&&(c[wp]=this.appCheckToken),Ob(n,Ab,c))}open(e,n){this.curSegmentNum=0,this.onDisconnect_=n,this.myPacketOrderer=new mk(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(Ck)),nk(()=>{if(this.isClosed_)return;this.scriptTagHolder=new r0((...i)=>{const[o,l,c,d,u]=i;if(this.incrementIncomingBytes_(i),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===gv)this.id=l,this.password=c;else if(o===yk)l?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(l,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...i)=>{const[o,l]=i;this.incrementIncomingBytes_(i),this.myPacketOrderer.handleResponse(o,l)},()=>{this.onClosed_()},this.urlFn);const r={};r[gv]="t",r[Mb]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[xk]=this.scriptTagHolder.uniqueCallbackIdentifier),r[Eb]=t0,this.transportSessionId&&(r[Sb]=this.transportSessionId),this.lastSessionId&&(r[Cb]=this.lastSessionId),this.applicationId&&(r[kb]=this.applicationId),this.appCheckToken&&(r[wp]=this.appCheckToken),typeof location<"u"&&location.hostname&&wb.test(location.hostname)&&(r[Ib]=Tb);const s=this.urlFn(r);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){vo.forceAllow_=!0}static forceDisallow(){vo.forceDisallow_=!0}static isAvailable(){return vo.forceAllow_?!0:!vo.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!sk()&&!ik()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const n=Xt(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const r=tb(n),s=xb(r,Tk);for(let i=0;i<s.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[i]),this.curSegmentNum++}addDisconnectPingFrame(e,n){this.myDisconnFrame=document.createElement("iframe");const r={};r[Ik]="t",r[Lb]=e,r[Db]=n,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const n=Xt(e).length;this.bytesReceived+=n,this.stats_.incrementCounter("bytes_received",n)}}class r0{constructor(e,n,r,s){this.onDisconnect=r,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=vb(),window[vk+this.uniqueCallbackIdentifier]=e,window[_k+this.uniqueCallbackIdentifier]=n,this.myIFrame=r0.createIFrame_();let i="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(i='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(l){nn("frame writing exception"),l.stack&&nn(l.stack),nn(l)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||nn("No IE domain setting required")}catch{const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,n){for(this.myID=e,this.myPW=n,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[Lb]=this.myID,e[Db]=this.myPW,e[Mb]=this.currentSerial;let n=this.urlFn(e),r="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+jb+r.length<=Nb;){const o=this.pendingSegs.shift();r=r+"&"+bk+s+"="+o.seg+"&"+Ek+s+"="+o.ts+"&"+Sk+s+"="+o.d,s++}return n=n+r,this.addLongPollTag_(n,this.currentSerial),!0}else return!1}enqueueSegment(e,n,r){this.pendingSegs.push({seg:e,ts:n,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,n){this.outstandingRequests.add(n);const r=()=>{this.outstandingRequests.delete(n),this.newRequest_()},s=setTimeout(r,Math.floor(wk)),i=()=>{clearTimeout(s),r()};this.addTag(e,i)}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const s=r.readyState;(!s||s==="loaded"||s==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),n())},r.onerror=()=>{nn("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kk=16384,Rk=45e3;let qd=null;typeof MozWebSocket<"u"?qd=MozWebSocket:typeof WebSocket<"u"&&(qd=WebSocket);class gr{constructor(e,n,r,s,i,o,l){this.connId=e,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Gl(this.connId),this.stats_=n0(n),this.connURL=gr.connectionURL_(n,o,l,s,r),this.nodeAdmin=n.nodeAdmin}static connectionURL_(e,n,r,s,i){const o={};return o[Eb]=t0,typeof location<"u"&&location.hostname&&wb.test(location.hostname)&&(o[Ib]=Tb),n&&(o[Sb]=n),r&&(o[Cb]=r),s&&(o[wp]=s),i&&(o[kb]=i),Ob(e,Rb,o)}open(e,n){this.onDisconnect=n,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,xi.set("previous_websocket_failure",!0);try{let r;C2(),this.mySock=new qd(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){gr.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const n=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(n);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&qd!==null&&!gr.forceDisallow_}static previouslyFailed(){return xi.isInMemoryStorage||xi.get("previous_websocket_failure")===!0}markConnectionHealthy(){xi.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const n=this.frames.join("");this.frames=null;const r=Il(n);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(fe(this.frames===null,"We already have a frame buffer"),e.length<=6){const n=Number(e);if(!isNaN(n))return this.handleNewFrameCount_(n),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const n=e.data;if(this.bytesReceived+=n.length,this.stats_.incrementCounter("bytes_received",n.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(n);else{const r=this.extractFrameCount_(n);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();const n=Xt(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const r=xb(n,kk);r.length>1&&this.sendString_(String(r.length));for(let s=0;s<r.length;s++)this.sendString_(r[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(Rk))}sendString_(e){try{this.mySock.send(e)}catch(n){this.log_("Exception thrown from WebSocket.send():",n.message||n.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}gr.responsesRequiredToBeHealthy=2;gr.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wl{static get ALL_TRANSPORTS(){return[vo,gr]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const n=gr&&gr.isAvailable();let r=n&&!gr.previouslyFailed();if(e.webSocketOnly&&(n||Cn("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[gr];else{const s=this.transports_=[];for(const i of wl.ALL_TRANSPORTS)i&&i.isAvailable()&&s.push(i);wl.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}wl.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ak=6e4,Pk=5e3,Ok=10*1024,Lk=100*1024,yh="t",mv="d",Dk="s",yv="r",Mk="e",vv="o",_v="a",xv="n",bv="p",Nk="h";class jk{constructor(e,n,r,s,i,o,l,c,d,u){this.id=e,this.repoInfo_=n,this.applicationId_=r,this.appCheckToken_=s,this.authToken_=i,this.onMessage_=o,this.onReady_=l,this.onDisconnect_=c,this.onKill_=d,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Gl("c:"+this.id+":"),this.transportManager_=new wl(n),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(n,r)},Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=qa(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>Lk?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>Ok?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return n=>{e===this.conn_?this.onConnectionLost_(n):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return n=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(n):e===this.secondaryConn_?this.onSecondaryMessageReceived_(n):this.log_("message on old connection"))}}sendRequest(e){const n={t:"d",d:e};this.sendData_(n)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(yh in e){const n=e[yh];n===_v?this.upgradeIfSecondaryHealthy_():n===yv?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):n===vv&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const n=ka("t",e),r=ka("d",e);if(n==="c")this.onSecondaryControl_(r);else if(n==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+n)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:bv,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:_v,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:xv,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const n=ka("t",e),r=ka("d",e);n==="c"?this.onControl_(r):n==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const n=ka(yh,e);if(mv in e){const r=e[mv];if(n===Nk){const s={...r};this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(n===xv){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else n===Dk?this.onConnectionShutdown_(r):n===yv?this.onReset_(r):n===Mk?Tp("Server Error: "+r):n===vv?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Tp("Unknown control packet command: "+n)}}onHandshake_(e){const n=e.ts,r=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,n),t0!==r&&Cn("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),qa(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(Ak))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,n){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(n,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):qa(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(Pk))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:bv,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(xi.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $b{put(e,n,r,s){}merge(e,n,r,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,n,r){}onDisconnectMerge(e,n,r){}onDisconnectCancel(e,n){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fb{constructor(e){this.allowedEvents_=e,this.listeners_={},fe(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...n){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let s=0;s<r.length;s++)r[s].callback.apply(r[s].context,n)}}on(e,n,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:n,context:r});const s=this.getInitialEvent(e);s&&n.apply(r,s)}off(e,n,r){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let i=0;i<s.length;i++)if(s[i].callback===n&&(!r||r===s[i].context)){s.splice(i,1);return}}validateEventType_(e){fe(this.allowedEvents_.find(n=>n===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zd extends Fb{static getInstance(){return new Zd}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Qg()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return fe(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ev=32,Sv=768;class Et{constructor(e,n){if(n===void 0){this.pieces_=e.split("/");let r=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[r]=this.pieces_[s],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=n}toString(){let e="";for(let n=this.pieceNum_;n<this.pieces_.length;n++)this.pieces_[n]!==""&&(e+="/"+this.pieces_[n]);return e||"/"}}function mt(){return new Et("")}function it(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function Qs(t){return t.pieces_.length-t.pieceNum_}function wt(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new Et(t.pieces_,e)}function s0(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function $k(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)t.pieces_[n]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}function Cl(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function Ub(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new Et(e,0)}function $t(t,e){const n=[];for(let r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);if(e instanceof Et)for(let r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);else{const r=e.split("/");for(let s=0;s<r.length;s++)r[s].length>0&&n.push(r[s])}return new Et(n,0)}function at(t){return t.pieceNum_>=t.pieces_.length}function Tn(t,e){const n=it(t),r=it(e);if(n===null)return e;if(n===r)return Tn(wt(t),wt(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function Fk(t,e){const n=Cl(t,0),r=Cl(e,0);for(let s=0;s<n.length&&s<r.length;s++){const i=ji(n[s],r[s]);if(i!==0)return i}return n.length===r.length?0:n.length<r.length?-1:1}function i0(t,e){if(Qs(t)!==Qs(e))return!1;for(let n=t.pieceNum_,r=e.pieceNum_;n<=t.pieces_.length;n++,r++)if(t.pieces_[n]!==e.pieces_[r])return!1;return!0}function rr(t,e){let n=t.pieceNum_,r=e.pieceNum_;if(Qs(t)>Qs(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[r])return!1;++n,++r}return!0}class Uk{constructor(e,n){this.errorPrefix_=n,this.parts_=Cl(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=Mu(this.parts_[r]);Bb(this)}}function Bk(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=Mu(e),Bb(t)}function zk(t){const e=t.parts_.pop();t.byteLength_-=Mu(e),t.parts_.length>0&&(t.byteLength_-=1)}function Bb(t){if(t.byteLength_>Sv)throw new Error(t.errorPrefix_+"has a key path longer than "+Sv+" bytes ("+t.byteLength_+").");if(t.parts_.length>Ev)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Ev+") or object contains a cycle "+gi(t))}function gi(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o0 extends Fb{static getInstance(){return new o0}constructor(){super(["visible"]);let e,n;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(n="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(n="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(n="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(n="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,n&&document.addEventListener(n,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}getInitialEvent(e){return fe(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ra=1e3,Hk=60*5*1e3,Iv=30*1e3,Wk=1.3,Gk=3e4,Vk="server_kill",Tv=3;class ts extends $b{constructor(e,n,r,s,i,o,l,c){if(super(),this.repoInfo_=e,this.applicationId_=n,this.onDataUpdate_=r,this.onConnectStatus_=s,this.onServerInfoUpdate_=i,this.authTokenProvider_=o,this.appCheckTokenProvider_=l,this.authOverride_=c,this.id=ts.nextPersistentConnectionId_++,this.log_=Gl("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Ra,this.maxReconnectDelay_=Hk,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");o0.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&Zd.getInstance().on("online",this.onOnline_,this)}sendRequest(e,n,r){const s=++this.requestNumber_,i={r:s,a:e,b:n};this.log_(Xt(i)),fe(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),r&&(this.requestCBHash_[s]=r)}get(e){this.initConnection_();const n=new pr,s={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const l=o.d;o.s==="ok"?n.resolve(l):n.reject(l)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),n.promise}listen(e,n,r,s){this.initConnection_();const i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),fe(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),fe(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");const l={onComplete:s,hashFn:n,query:e,tag:r};this.listens.get(o).set(i,l),this.connected_&&this.sendListen_(l)}sendGet_(e){const n=this.outstandingGets_[e];this.sendRequest("g",n.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(r)})}sendListen_(e){const n=e.query,r=n._path.toString(),s=n._queryIdentifier;this.log_("Listen on "+r+" for "+s);const i={p:r},o="q";e.tag&&(i.q=n._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest(o,i,l=>{const c=l.d,d=l.s;ts.warnOnListenWarnings_(c,n),(this.listens.get(r)&&this.listens.get(r).get(s))===e&&(this.log_("listen response",l),d!=="ok"&&this.removeListen_(r,s),e.onComplete&&e.onComplete(d,c))})}static warnOnListenWarnings_(e,n){if(e&&typeof e=="object"&&Sr(e,"w")){const r=ki(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const s='".indexOn": "'+n._queryParams.getIndex().toString()+'"',i=n._path.toString();Cn(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${i} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||D2(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Iv)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,n=L2(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(n,r,s=>{const i=s.s,o=s.d||"error";this.authToken_===e&&(i==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(i,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const n=e.s,r=e.d||"error";n==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(n,r)})}unlisten(e,n){const r=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+s),fe(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,s)&&this.connected_&&this.sendUnlisten_(r,s,e._queryObject,n)}sendUnlisten_(e,n,r,s){this.log_("Unlisten on "+e+" for "+n);const i={p:e},o="n";s&&(i.q=r,i.t=s),this.sendRequest(o,i)}onDisconnectPut(e,n,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,n,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:n,onComplete:r})}onDisconnectMerge(e,n,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,n,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:n,onComplete:r})}onDisconnectCancel(e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:n})}sendOnDisconnect_(e,n,r,s){const i={p:n,d:r};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,o=>{s&&setTimeout(()=>{s(o.s,o.d)},Math.floor(0))})}put(e,n,r,s){this.putInternal("p",e,n,r,s)}merge(e,n,r,s){this.putInternal("m",e,n,r,s)}putInternal(e,n,r,s,i){this.initConnection_();const o={p:n,d:r};i!==void 0&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:s}),this.outstandingPutCount_++;const l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+n)}sendPut_(e){const n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,s=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,i=>{this.log_(n+" response",i),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(i.s,i.d)})}reportStats(e){if(this.connected_){const n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,r=>{if(r.s!=="ok"){const i=r.d;this.log_("reportStats","Error sending stats: "+i)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Xt(e));const n=e.r,r=this.requestCBHash_[n];r&&(delete this.requestCBHash_[n],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,n){this.log_("handleServerMessage",e,n),e==="d"?this.onDataUpdate_(n.p,n.d,!1,n.t):e==="m"?this.onDataUpdate_(n.p,n.d,!0,n.t):e==="c"?this.onListenRevoked_(n.p,n.q):e==="ac"?this.onAuthRevoked_(n.s,n.d):e==="apc"?this.onAppCheckRevoked_(n.s,n.d):e==="sd"?this.onSecurityDebugPacket_(n):Tp("Unrecognized action received from server: "+Xt(e)+`
Are you using the latest client?`)}onReady_(e,n){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=n,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){fe(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Ra,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Ra,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>Gk&&(this.reconnectDelay_=Ra),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let n=Math.max(0,this.reconnectDelay_-e);n=Math.random()*n,this.log_("Trying to reconnect in "+n+"ms"),this.scheduleConnect_(n),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Wk)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+ts.nextConnectionId_++,i=this.lastSessionId;let o=!1,l=null;const c=function(){l?l.close():(o=!0,r())},d=function(h){fe(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(h)};this.realtime_={close:c,sendRequest:d};const u=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[h,f]=await Promise.all([this.authTokenProvider_.getToken(u),this.appCheckTokenProvider_.getToken(u)]);o?nn("getToken() completed but was canceled"):(nn("getToken() completed. Creating connection."),this.authToken_=h&&h.accessToken,this.appCheckToken_=f&&f.token,l=new jk(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,r,x=>{Cn(x+" ("+this.repoInfo_.toString()+")"),this.interrupt(Vk)},i))}catch(h){this.log_("Failed to get token: "+h),o||(this.repoInfo_.nodeAdmin&&Cn(h),c())}}}interrupt(e){nn("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){nn("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Xd(this.interruptReasons_)&&(this.reconnectDelay_=Ra,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const n=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:n})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const n=this.outstandingPuts_[e];n&&"h"in n.request&&n.queued&&(n.onComplete&&n.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,n){let r;n?r=n.map(i=>e0(i)).join("$"):r="default";const s=this.removeListen_(e,r);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(e,n){const r=new Et(e).toString();let s;if(this.listens.has(r)){const i=this.listens.get(r);s=i.get(n),i.delete(n),i.size===0&&this.listens.delete(r)}else s=void 0;return s}onAuthRevoked_(e,n){nn("Auth token revoked: "+e+"/"+n),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Tv&&(this.reconnectDelay_=Iv,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,n){nn("App check token revoked: "+e+"/"+n),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Tv&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const n of e.values())this.sendListen_(n);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let n="js";e["sdk."+n+"."+mb.replace(/\./g,"-")]=1,Qg()?e["framework.cordova"]=1:lb()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Zd.getInstance().currentlyOnline();return Xd(this.interruptReasons_)&&e}}ts.nextPersistentConnectionId_=0;ts.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lt{constructor(e,n){this.name=e,this.node=n}static Wrap(e,n){return new lt(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ju{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,n){const r=new lt(zo,e),s=new lt(zo,n);return this.compare(r,s)!==0}minPost(){return lt.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Hc;class zb extends ju{static get __EMPTY_NODE(){return Hc}static set __EMPTY_NODE(e){Hc=e}compare(e,n){return ji(e.name,n.name)}isDefinedOn(e){throw Jo("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,n){return!1}minPost(){return lt.MIN}maxPost(){return new lt(Pi,Hc)}makePost(e,n){return fe(typeof e=="string","KeyIndex indexValue must always be a string."),new lt(e,Hc)}toString(){return".key"}}const Co=new zb;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wc{constructor(e,n,r,s,i=null){this.isReverse_=s,this.resultGenerator_=i,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=n?r(e.key,n):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),n;if(this.resultGenerator_?n=this.resultGenerator_(e.key,e.value):n={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return n}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class tn{constructor(e,n,r,s,i){this.key=e,this.value=n,this.color=r??tn.RED,this.left=s??Nn.EMPTY_NODE,this.right=i??Nn.EMPTY_NODE}copy(e,n,r,s,i){return new tn(e??this.key,n??this.value,r??this.color,s??this.left,i??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let s=this;const i=r(e,s.key);return i<0?s=s.copy(null,null,null,s.left.insert(e,n,r),null):i===0?s=s.copy(null,n,null,null,null):s=s.copy(null,null,null,null,s.right.insert(e,n,r)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return Nn.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,n){let r,s;if(r=this,n(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,n),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),n(e,r.key)===0){if(r.right.isEmpty())return Nn.EMPTY_NODE;s=r.right.min_(),r=r.copy(s.key,s.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,n))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,tn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,tn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}tn.RED=!0;tn.BLACK=!1;class Yk{copy(e,n,r,s,i){return this}insert(e,n,r){return new tn(e,n,null)}remove(e,n){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class Nn{constructor(e,n=Nn.EMPTY_NODE){this.comparator_=e,this.root_=n}insert(e,n){return new Nn(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,tn.BLACK,null,null))}remove(e){return new Nn(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,tn.BLACK,null,null))}get(e){let n,r=this.root_;for(;!r.isEmpty();){if(n=this.comparator_(e,r.key),n===0)return r.value;n<0?r=r.left:n>0&&(r=r.right)}return null}getPredecessorKey(e){let n,r=this.root_,s=null;for(;!r.isEmpty();)if(n=this.comparator_(e,r.key),n===0){if(r.left.isEmpty())return s?s.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else n<0?r=r.left:n>0&&(s=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Wc(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,n){return new Wc(this.root_,e,this.comparator_,!1,n)}getReverseIteratorFrom(e,n){return new Wc(this.root_,e,this.comparator_,!0,n)}getReverseIterator(e){return new Wc(this.root_,null,this.comparator_,!0,e)}}Nn.EMPTY_NODE=new Yk;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kk(t,e){return ji(t.name,e.name)}function a0(t,e){return ji(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Cp;function Xk(t){Cp=t}const Hb=function(t){return typeof t=="number"?"number:"+bb(t):"string:"+t},Wb=function(t){if(t.isLeafNode()){const e=t.val();fe(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Sr(e,".sv"),"Priority must be a string or number.")}else fe(t===Cp||t.isEmpty(),"priority of unexpected type.");fe(t===Cp||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let wv;class Zt{static set __childrenNodeConstructor(e){wv=e}static get __childrenNodeConstructor(){return wv}constructor(e,n=Zt.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=n,this.lazyHash_=null,fe(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),Wb(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Zt(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:Zt.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return at(e)?this:it(e)===".priority"?this.priorityNode_:Zt.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,n){return null}updateImmediateChild(e,n){return e===".priority"?this.updatePriority(n):n.isEmpty()&&e!==".priority"?this:Zt.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)}updateChild(e,n){const r=it(e);return r===null?n:n.isEmpty()&&r!==".priority"?this:(fe(r!==".priority"||Qs(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,Zt.__childrenNodeConstructor.EMPTY_NODE.updateChild(wt(e),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,n){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Hb(this.priorityNode_.val())+":");const n=typeof this.value_;e+=n+":",n==="number"?e+=bb(this.value_):e+=this.value_,this.lazyHash_=_b(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Zt.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Zt.__childrenNodeConstructor?-1:(fe(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const n=typeof e.value_,r=typeof this.value_,s=Zt.VALUE_TYPE_ORDER.indexOf(n),i=Zt.VALUE_TYPE_ORDER.indexOf(r);return fe(s>=0,"Unknown leaf type: "+n),fe(i>=0,"Unknown leaf type: "+r),s===i?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const n=e;return this.value_===n.value_&&this.priorityNode_.equals(n.priorityNode_)}else return!1}}Zt.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Gb,Vb;function Qk(t){Gb=t}function Jk(t){Vb=t}class qk extends ju{compare(e,n){const r=e.node.getPriority(),s=n.node.getPriority(),i=r.compareTo(s);return i===0?ji(e.name,n.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,n){return!e.getPriority().equals(n.getPriority())}minPost(){return lt.MIN}maxPost(){return new lt(Pi,new Zt("[PRIORITY-POST]",Vb))}makePost(e,n){const r=Gb(e);return new lt(n,new Zt("[PRIORITY-POST]",r))}toString(){return".priority"}}const Mt=new qk;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zk=Math.log(2);class e5{constructor(e){const n=i=>parseInt(Math.log(i)/Zk,10),r=i=>parseInt(Array(i+1).join("1"),2);this.count=n(e+1),this.current_=this.count-1;const s=r(this.count);this.bits_=e+1&s}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const eu=function(t,e,n,r){t.sort(e);const s=function(c,d){const u=d-c;let h,f;if(u===0)return null;if(u===1)return h=t[c],f=n?n(h):h,new tn(f,h.node,tn.BLACK,null,null);{const x=parseInt(u/2,10)+c,k=s(c,x),T=s(x+1,d);return h=t[x],f=n?n(h):h,new tn(f,h.node,tn.BLACK,k,T)}},i=function(c){let d=null,u=null,h=t.length;const f=function(k,T){const j=h-k,b=h;h-=k;const v=s(j+1,b),S=t[j],p=n?n(S):S;x(new tn(p,S.node,T,null,v))},x=function(k){d?(d.left=k,d=k):(u=k,d=k)};for(let k=0;k<c.count;++k){const T=c.nextBitIsOne(),j=Math.pow(2,c.count-(k+1));T?f(j,tn.BLACK):(f(j,tn.BLACK),f(j,tn.RED))}return u},o=new e5(t.length),l=i(o);return new Nn(r||e,l)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vh;const no={};class Jr{static get Default(){return fe(no&&Mt,"ChildrenNode.ts has not been loaded"),vh=vh||new Jr({".priority":no},{".priority":Mt}),vh}constructor(e,n){this.indexes_=e,this.indexSet_=n}get(e){const n=ki(this.indexes_,e);if(!n)throw new Error("No index defined for "+e);return n instanceof Nn?n:null}hasIndex(e){return Sr(this.indexSet_,e.toString())}addIndex(e,n){fe(e!==Co,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let s=!1;const i=n.getIterator(lt.Wrap);let o=i.getNext();for(;o;)s=s||e.isDefinedOn(o.node),r.push(o),o=i.getNext();let l;s?l=eu(r,e.getCompare()):l=no;const c=e.toString(),d={...this.indexSet_};d[c]=e;const u={...this.indexes_};return u[c]=l,new Jr(u,d)}addToIndexes(e,n){const r=Qd(this.indexes_,(s,i)=>{const o=ki(this.indexSet_,i);if(fe(o,"Missing index implementation for "+i),s===no)if(o.isDefinedOn(e.node)){const l=[],c=n.getIterator(lt.Wrap);let d=c.getNext();for(;d;)d.name!==e.name&&l.push(d),d=c.getNext();return l.push(e),eu(l,o.getCompare())}else return no;else{const l=n.get(e.name);let c=s;return l&&(c=c.remove(new lt(e.name,l))),c.insert(e,e.node)}});return new Jr(r,this.indexSet_)}removeFromIndexes(e,n){const r=Qd(this.indexes_,s=>{if(s===no)return s;{const i=n.get(e.name);return i?s.remove(new lt(e.name,i)):s}});return new Jr(r,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Aa;class Be{static get EMPTY_NODE(){return Aa||(Aa=new Be(new Nn(a0),null,Jr.Default))}constructor(e,n,r){this.children_=e,this.priorityNode_=n,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&Wb(this.priorityNode_),this.children_.isEmpty()&&fe(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Aa}updatePriority(e){return this.children_.isEmpty()?this:new Be(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const n=this.children_.get(e);return n===null?Aa:n}}getChild(e){const n=it(e);return n===null?this:this.getImmediateChild(n).getChild(wt(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,n){if(fe(n,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(n);{const r=new lt(e,n);let s,i;n.isEmpty()?(s=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(r,this.children_)):(s=this.children_.insert(e,n),i=this.indexMap_.addToIndexes(r,this.children_));const o=s.isEmpty()?Aa:this.priorityNode_;return new Be(s,o,i)}}updateChild(e,n){const r=it(e);if(r===null)return n;{fe(it(e)!==".priority"||Qs(e)===1,".priority must be the last token in a path");const s=this.getImmediateChild(r).updateChild(wt(e),n);return this.updateImmediateChild(r,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const n={};let r=0,s=0,i=!0;if(this.forEachChild(Mt,(o,l)=>{n[o]=l.val(e),r++,i&&Be.INTEGER_REGEXP_.test(o)?s=Math.max(s,Number(o)):i=!1}),!e&&i&&s<2*r){const o=[];for(const l in n)o[l]=n[l];return o}else return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+Hb(this.getPriority().val())+":"),this.forEachChild(Mt,(n,r)=>{const s=r.hash();s!==""&&(e+=":"+n+":"+s)}),this.lazyHash_=e===""?"":_b(e)}return this.lazyHash_}getPredecessorChildName(e,n,r){const s=this.resolveIndex_(r);if(s){const i=s.getPredecessorKey(new lt(e,n));return i?i.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const n=this.resolveIndex_(e);if(n){const r=n.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){const n=this.getFirstChildName(e);return n?new lt(n,this.children_.get(n)):null}getLastChildName(e){const n=this.resolveIndex_(e);if(n){const r=n.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){const n=this.getLastChildName(e);return n?new lt(n,this.children_.get(n)):null}forEachChild(e,n){const r=this.resolveIndex_(e);return r?r.inorderTraversal(s=>n(s.name,s.node)):this.children_.inorderTraversal(n)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,n){const r=this.resolveIndex_(n);if(r)return r.getIteratorFrom(e,s=>s);{const s=this.children_.getIteratorFrom(e.name,lt.Wrap);let i=s.peek();for(;i!=null&&n.compare(i,e)<0;)s.getNext(),i=s.peek();return s}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,n){const r=this.resolveIndex_(n);if(r)return r.getReverseIteratorFrom(e,s=>s);{const s=this.children_.getReverseIteratorFrom(e.name,lt.Wrap);let i=s.peek();for(;i!=null&&n.compare(i,e)>0;)s.getNext(),i=s.peek();return s}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Vl?-1:0}withIndex(e){if(e===Co||this.indexMap_.hasIndex(e))return this;{const n=this.indexMap_.addIndex(e,this.children_);return new Be(this.children_,this.priorityNode_,n)}}isIndexed(e){return e===Co||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority()))if(this.children_.count()===n.children_.count()){const r=this.getIterator(Mt),s=n.getIterator(Mt);let i=r.getNext(),o=s.getNext();for(;i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=r.getNext(),o=s.getNext()}return i===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===Co?null:this.indexMap_.get(e.toString())}}Be.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class t5 extends Be{constructor(){super(new Nn(a0),Be.EMPTY_NODE,Jr.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Be.EMPTY_NODE}isEmpty(){return!1}}const Vl=new t5;Object.defineProperties(lt,{MIN:{value:new lt(zo,Be.EMPTY_NODE)},MAX:{value:new lt(Pi,Vl)}});zb.__EMPTY_NODE=Be.EMPTY_NODE;Zt.__childrenNodeConstructor=Be;Xk(Vl);Jk(Vl);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n5=!0;function jt(t,e=null){if(t===null)return Be.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),fe(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){const n=t;return new Zt(n,jt(e))}if(!(t instanceof Array)&&n5){const n=[];let r=!1;if(sn(t,(o,l)=>{if(o.substring(0,1)!=="."){const c=jt(l);c.isEmpty()||(r=r||!c.getPriority().isEmpty(),n.push(new lt(o,c)))}}),n.length===0)return Be.EMPTY_NODE;const i=eu(n,Kk,o=>o.name,a0);if(r){const o=eu(n,Mt.getCompare());return new Be(i,jt(e),new Jr({".priority":o},{".priority":Mt}))}else return new Be(i,jt(e),Jr.Default)}else{let n=Be.EMPTY_NODE;return sn(t,(r,s)=>{if(Sr(t,r)&&r.substring(0,1)!=="."){const i=jt(s);(i.isLeafNode()||!i.isEmpty())&&(n=n.updateImmediateChild(r,i))}}),n.updatePriority(jt(e))}}Qk(jt);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r5 extends ju{constructor(e){super(),this.indexPath_=e,fe(!at(e)&&it(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,n){const r=this.extractChild(e.node),s=this.extractChild(n.node),i=r.compareTo(s);return i===0?ji(e.name,n.name):i}makePost(e,n){const r=jt(e),s=Be.EMPTY_NODE.updateChild(this.indexPath_,r);return new lt(n,s)}maxPost(){const e=Be.EMPTY_NODE.updateChild(this.indexPath_,Vl);return new lt(Pi,e)}toString(){return Cl(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s5 extends ju{compare(e,n){const r=e.node.compareTo(n.node);return r===0?ji(e.name,n.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,n){return!e.equals(n)}minPost(){return lt.MIN}maxPost(){return lt.MAX}makePost(e,n){const r=jt(e);return new lt(n,r)}toString(){return".value"}}const i5=new s5;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yb(t){return{type:"value",snapshotNode:t}}function Ho(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function kl(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function Rl(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}function o5(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l0{constructor(e){this.index_=e}updateChild(e,n,r,s,i,o){fe(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const l=e.getImmediateChild(n);return l.getChild(s).equals(r.getChild(s))&&l.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(n)?o.trackChildChange(kl(n,l)):fe(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):l.isEmpty()?o.trackChildChange(Ho(n,r)):o.trackChildChange(Rl(n,r,l))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(n,r).withIndex(this.index_)}updateFullNode(e,n,r){return r!=null&&(e.isLeafNode()||e.forEachChild(Mt,(s,i)=>{n.hasChild(s)||r.trackChildChange(kl(s,i))}),n.isLeafNode()||n.forEachChild(Mt,(s,i)=>{if(e.hasChild(s)){const o=e.getImmediateChild(s);o.equals(i)||r.trackChildChange(Rl(s,i,o))}else r.trackChildChange(Ho(s,i))})),n.withIndex(this.index_)}updatePriority(e,n){return e.isEmpty()?Be.EMPTY_NODE:e.updatePriority(n)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Al{constructor(e){this.indexedFilter_=new l0(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Al.getStartPost_(e),this.endPost_=Al.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const n=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return n&&r}updateChild(e,n,r,s,i,o){return this.matches(new lt(n,r))||(r=Be.EMPTY_NODE),this.indexedFilter_.updateChild(e,n,r,s,i,o)}updateFullNode(e,n,r){n.isLeafNode()&&(n=Be.EMPTY_NODE);let s=n.withIndex(this.index_);s=s.updatePriority(Be.EMPTY_NODE);const i=this;return n.forEachChild(Mt,(o,l)=>{i.matches(new lt(o,l))||(s=s.updateImmediateChild(o,Be.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,r)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const n=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),n)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const n=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),n)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a5{constructor(e){this.withinDirectionalStart=n=>this.reverse_?this.withinEndPost(n):this.withinStartPost(n),this.withinDirectionalEnd=n=>this.reverse_?this.withinStartPost(n):this.withinEndPost(n),this.withinStartPost=n=>{const r=this.index_.compare(this.rangedFilter_.getStartPost(),n);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=n=>{const r=this.index_.compare(n,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new Al(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,n,r,s,i,o){return this.rangedFilter_.matches(new lt(n,r))||(r=Be.EMPTY_NODE),e.getImmediateChild(n).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,n,r,s,i,o):this.fullLimitUpdateChild_(e,n,r,i,o)}updateFullNode(e,n,r){let s;if(n.isLeafNode()||n.isEmpty())s=Be.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<n.numChildren()&&n.isIndexed(this.index_)){s=Be.EMPTY_NODE.withIndex(this.index_);let i;this.reverse_?i=n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):i=n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;i.hasNext()&&o<this.limit_;){const l=i.getNext();if(this.withinDirectionalStart(l))if(this.withinDirectionalEnd(l))s=s.updateImmediateChild(l.name,l.node),o++;else break;else continue}}else{s=n.withIndex(this.index_),s=s.updatePriority(Be.EMPTY_NODE);let i;this.reverse_?i=s.getReverseIterator(this.index_):i=s.getIterator(this.index_);let o=0;for(;i.hasNext();){const l=i.getNext();o<this.limit_&&this.withinDirectionalStart(l)&&this.withinDirectionalEnd(l)?o++:s=s.updateImmediateChild(l.name,Be.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,r)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,n,r,s,i){let o;if(this.reverse_){const h=this.index_.getCompare();o=(f,x)=>h(x,f)}else o=this.index_.getCompare();const l=e;fe(l.numChildren()===this.limit_,"");const c=new lt(n,r),d=this.reverse_?l.getFirstChild(this.index_):l.getLastChild(this.index_),u=this.rangedFilter_.matches(c);if(l.hasChild(n)){const h=l.getImmediateChild(n);let f=s.getChildAfterChild(this.index_,d,this.reverse_);for(;f!=null&&(f.name===n||l.hasChild(f.name));)f=s.getChildAfterChild(this.index_,f,this.reverse_);const x=f==null?1:o(f,c);if(u&&!r.isEmpty()&&x>=0)return i!=null&&i.trackChildChange(Rl(n,r,h)),l.updateImmediateChild(n,r);{i!=null&&i.trackChildChange(kl(n,h));const T=l.updateImmediateChild(n,Be.EMPTY_NODE);return f!=null&&this.rangedFilter_.matches(f)?(i!=null&&i.trackChildChange(Ho(f.name,f.node)),T.updateImmediateChild(f.name,f.node)):T}}else return r.isEmpty()?e:u&&o(d,c)>=0?(i!=null&&(i.trackChildChange(kl(d.name,d.node)),i.trackChildChange(Ho(n,r))),l.updateImmediateChild(n,r).updateImmediateChild(d.name,Be.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c0{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Mt}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return fe(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return fe(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:zo}hasEnd(){return this.endSet_}getIndexEndValue(){return fe(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return fe(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Pi}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return fe(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Mt}copy(){const e=new c0;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function l5(t){return t.loadsAllData()?new l0(t.getIndex()):t.hasLimit()?new a5(t):new Al(t)}function Cv(t){const e={};if(t.isDefault())return e;let n;if(t.index_===Mt?n="$priority":t.index_===i5?n="$value":t.index_===Co?n="$key":(fe(t.index_ instanceof r5,"Unrecognized index type!"),n=t.index_.toString()),e.orderBy=Xt(n),t.startSet_){const r=t.startAfterSet_?"startAfter":"startAt";e[r]=Xt(t.indexStartValue_),t.startNameSet_&&(e[r]+=","+Xt(t.indexStartName_))}if(t.endSet_){const r=t.endBeforeSet_?"endBefore":"endAt";e[r]=Xt(t.indexEndValue_),t.endNameSet_&&(e[r]+=","+Xt(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function kv(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;n===""&&(t.isViewFromLeft()?n="l":n="r"),e.vf=n}return t.index_!==Mt&&(e.i=t.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tu extends $b{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,n){return n!==void 0?"tag$"+n:(fe(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,n,r,s){super(),this.repoInfo_=e,this.onDataUpdate_=n,this.authTokenProvider_=r,this.appCheckTokenProvider_=s,this.log_=Gl("p:rest:"),this.listens_={}}listen(e,n,r,s){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const o=tu.getListenId_(e,r),l={};this.listens_[o]=l;const c=Cv(e._queryParams);this.restRequest_(i+".json",c,(d,u)=>{let h=u;if(d===404&&(h=null,d=null),d===null&&this.onDataUpdate_(i,h,!1,r),ki(this.listens_,o)===l){let f;d?d===401?f="permission_denied":f="rest_error:"+d:f="ok",s(f,null)}})}unlisten(e,n){const r=tu.getListenId_(e,n);delete this.listens_[r]}get(e){const n=Cv(e._queryParams),r=e._path.toString(),s=new pr;return this.restRequest_(r+".json",n,(i,o)=>{let l=o;i===404&&(l=null,i=null),i===null?(this.onDataUpdate_(r,l,!1,null),s.resolve(l)):s.reject(new Error(l))}),s.promise}refreshAuthToken(e){}restRequest_(e,n={},r){return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,i])=>{s&&s.accessToken&&(n.auth=s.accessToken),i&&i.token&&(n.ac=i.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Zo(n);this.log_("Sending REST request for "+o);const l=new XMLHttpRequest;l.onreadystatechange=()=>{if(r&&l.readyState===4){this.log_("REST Response for "+o+" received. status:",l.status,"response:",l.responseText);let c=null;if(l.status>=200&&l.status<300){try{c=Il(l.responseText)}catch{Cn("Failed to parse JSON response for "+o+": "+l.responseText)}r(null,c)}else l.status!==401&&l.status!==404&&Cn("Got unsuccessful REST response for "+o+" Status: "+l.status),r(l.status);r=null}},l.open("GET",o,!0),l.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c5{constructor(){this.rootNode_=Be.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,n){this.rootNode_=this.rootNode_.updateChild(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nu(){return{value:null,children:new Map}}function na(t,e,n){if(at(e))t.value=n,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,n);else{const r=it(e);t.children.has(r)||t.children.set(r,nu());const s=t.children.get(r);e=wt(e),na(s,e,n)}}function kp(t,e){if(at(e))return t.value=null,t.children.clear(),!0;if(t.value!==null){if(t.value.isLeafNode())return!1;{const n=t.value;return t.value=null,n.forEachChild(Mt,(r,s)=>{na(t,new Et(r),s)}),kp(t,e)}}else if(t.children.size>0){const n=it(e);return e=wt(e),t.children.has(n)&&kp(t.children.get(n),e)&&t.children.delete(n),t.children.size===0}else return!0}function Rp(t,e,n){t.value!==null?n(e,t.value):d5(t,(r,s)=>{const i=new Et(e.toString()+"/"+r);Rp(s,i,n)})}function d5(t,e){t.children.forEach((n,r)=>{e(r,n)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u5{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),n={...e};return this.last_&&sn(this.last_,(r,s)=>{n[r]=n[r]-s}),this.last_=e,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rv=10*1e3,f5=30*1e3,h5=5*60*1e3;class p5{constructor(e,n){this.server_=n,this.statsToReport_={},this.statsListener_=new u5(e);const r=Rv+(f5-Rv)*Math.random();qa(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),n={};let r=!1;sn(e,(s,i)=>{i>0&&Sr(this.statsToReport_,s)&&(n[s]=i,r=!0)}),r&&this.server_.reportStats(n),qa(this.reportStats_.bind(this),Math.floor(Math.random()*2*h5))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var mr;(function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(mr||(mr={}));function d0(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function u0(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function f0(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ru{constructor(e,n,r){this.path=e,this.affectedTree=n,this.revert=r,this.type=mr.ACK_USER_WRITE,this.source=d0()}operationForChild(e){if(at(this.path)){if(this.affectedTree.value!=null)return fe(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const n=this.affectedTree.subtree(new Et(e));return new ru(mt(),n,this.revert)}}else return fe(it(this.path)===e,"operationForChild called for unrelated child."),new ru(wt(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pl{constructor(e,n){this.source=e,this.path=n,this.type=mr.LISTEN_COMPLETE}operationForChild(e){return at(this.path)?new Pl(this.source,mt()):new Pl(this.source,wt(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oi{constructor(e,n,r){this.source=e,this.path=n,this.snap=r,this.type=mr.OVERWRITE}operationForChild(e){return at(this.path)?new Oi(this.source,mt(),this.snap.getImmediateChild(e)):new Oi(this.source,wt(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wo{constructor(e,n,r){this.source=e,this.path=n,this.children=r,this.type=mr.MERGE}operationForChild(e){if(at(this.path)){const n=this.children.subtree(new Et(e));return n.isEmpty()?null:n.value?new Oi(this.source,mt(),n.value):new Wo(this.source,mt(),n)}else return fe(it(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Wo(this.source,wt(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Js{constructor(e,n,r){this.node_=e,this.fullyInitialized_=n,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(at(e))return this.isFullyInitialized()&&!this.filtered_;const n=it(e);return this.isCompleteForChild(n)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g5{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function m5(t,e,n,r){const s=[],i=[];return e.forEach(o=>{o.type==="child_changed"&&t.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&i.push(o5(o.childName,o.snapshotNode))}),Pa(t,s,"child_removed",e,r,n),Pa(t,s,"child_added",e,r,n),Pa(t,s,"child_moved",i,r,n),Pa(t,s,"child_changed",e,r,n),Pa(t,s,"value",e,r,n),s}function Pa(t,e,n,r,s,i){const o=r.filter(l=>l.type===n);o.sort((l,c)=>v5(t,l,c)),o.forEach(l=>{const c=y5(t,l,i);s.forEach(d=>{d.respondsTo(l.type)&&e.push(d.createEvent(c,t.query_))})})}function y5(t,e,n){return e.type==="value"||e.type==="child_removed"||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function v5(t,e,n){if(e.childName==null||n.childName==null)throw Jo("Should only compare child_ events.");const r=new lt(e.childName,e.snapshotNode),s=new lt(n.childName,n.snapshotNode);return t.index_.compare(r,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $u(t,e){return{eventCache:t,serverCache:e}}function Za(t,e,n,r){return $u(new Js(e,n,r),t.serverCache)}function Kb(t,e,n,r){return $u(t.eventCache,new Js(e,n,r))}function su(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function Li(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _h;const _5=()=>(_h||(_h=new Nn(rk)),_h);class kt{static fromObject(e){let n=new kt(null);return sn(e,(r,s)=>{n=n.set(new Et(r),s)}),n}constructor(e,n=_5()){this.value=e,this.children=n}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,n){if(this.value!=null&&n(this.value))return{path:mt(),value:this.value};if(at(e))return null;{const r=it(e),s=this.children.get(r);if(s!==null){const i=s.findRootMostMatchingPathAndValue(wt(e),n);return i!=null?{path:$t(new Et(r),i.path),value:i.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(at(e))return this;{const n=it(e),r=this.children.get(n);return r!==null?r.subtree(wt(e)):new kt(null)}}set(e,n){if(at(e))return new kt(n,this.children);{const r=it(e),i=(this.children.get(r)||new kt(null)).set(wt(e),n),o=this.children.insert(r,i);return new kt(this.value,o)}}remove(e){if(at(e))return this.children.isEmpty()?new kt(null):new kt(null,this.children);{const n=it(e),r=this.children.get(n);if(r){const s=r.remove(wt(e));let i;return s.isEmpty()?i=this.children.remove(n):i=this.children.insert(n,s),this.value===null&&i.isEmpty()?new kt(null):new kt(this.value,i)}else return this}}get(e){if(at(e))return this.value;{const n=it(e),r=this.children.get(n);return r?r.get(wt(e)):null}}setTree(e,n){if(at(e))return n;{const r=it(e),i=(this.children.get(r)||new kt(null)).setTree(wt(e),n);let o;return i.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,i),new kt(this.value,o)}}fold(e){return this.fold_(mt(),e)}fold_(e,n){const r={};return this.children.inorderTraversal((s,i)=>{r[s]=i.fold_($t(e,s),n)}),n(e,this.value,r)}findOnPath(e,n){return this.findOnPath_(e,mt(),n)}findOnPath_(e,n,r){const s=this.value?r(n,this.value):!1;if(s)return s;if(at(e))return null;{const i=it(e),o=this.children.get(i);return o?o.findOnPath_(wt(e),$t(n,i),r):null}}foreachOnPath(e,n){return this.foreachOnPath_(e,mt(),n)}foreachOnPath_(e,n,r){if(at(e))return this;{this.value&&r(n,this.value);const s=it(e),i=this.children.get(s);return i?i.foreachOnPath_(wt(e),$t(n,s),r):new kt(null)}}foreach(e){this.foreach_(mt(),e)}foreach_(e,n){this.children.inorderTraversal((r,s)=>{s.foreach_($t(e,r),n)}),this.value&&n(e,this.value)}foreachChild(e){this.children.inorderTraversal((n,r)=>{r.value&&e(n,r.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xr{constructor(e){this.writeTree_=e}static empty(){return new xr(new kt(null))}}function el(t,e,n){if(at(e))return new xr(new kt(n));{const r=t.writeTree_.findRootMostValueAndPath(e);if(r!=null){const s=r.path;let i=r.value;const o=Tn(s,e);return i=i.updateChild(o,n),new xr(t.writeTree_.set(s,i))}else{const s=new kt(n),i=t.writeTree_.setTree(e,s);return new xr(i)}}}function Ap(t,e,n){let r=t;return sn(n,(s,i)=>{r=el(r,$t(e,s),i)}),r}function Av(t,e){if(at(e))return xr.empty();{const n=t.writeTree_.setTree(e,new kt(null));return new xr(n)}}function Pp(t,e){return $i(t,e)!=null}function $i(t,e){const n=t.writeTree_.findRootMostValueAndPath(e);return n!=null?t.writeTree_.get(n.path).getChild(Tn(n.path,e)):null}function Pv(t){const e=[],n=t.writeTree_.value;return n!=null?n.isLeafNode()||n.forEachChild(Mt,(r,s)=>{e.push(new lt(r,s))}):t.writeTree_.children.inorderTraversal((r,s)=>{s.value!=null&&e.push(new lt(r,s.value))}),e}function Gs(t,e){if(at(e))return t;{const n=$i(t,e);return n!=null?new xr(new kt(n)):new xr(t.writeTree_.subtree(e))}}function Op(t){return t.writeTree_.isEmpty()}function Go(t,e){return Xb(mt(),t.writeTree_,e)}function Xb(t,e,n){if(e.value!=null)return n.updateChild(t,e.value);{let r=null;return e.children.inorderTraversal((s,i)=>{s===".priority"?(fe(i.value!==null,"Priority writes must always be leaf nodes"),r=i.value):n=Xb($t(t,s),i,n)}),!n.getChild(t).isEmpty()&&r!==null&&(n=n.updateChild($t(t,".priority"),r)),n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fu(t,e){return Zb(e,t)}function x5(t,e,n,r,s){fe(r>t.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),t.allWrites.push({path:e,snap:n,writeId:r,visible:s}),s&&(t.visibleWrites=el(t.visibleWrites,e,n)),t.lastWriteId=r}function b5(t,e,n,r){fe(r>t.lastWriteId,"Stacking an older merge on top of newer ones"),t.allWrites.push({path:e,children:n,writeId:r,visible:!0}),t.visibleWrites=Ap(t.visibleWrites,e,n),t.lastWriteId=r}function E5(t,e){for(let n=0;n<t.allWrites.length;n++){const r=t.allWrites[n];if(r.writeId===e)return r}return null}function S5(t,e){const n=t.allWrites.findIndex(l=>l.writeId===e);fe(n>=0,"removeWrite called with nonexistent writeId.");const r=t.allWrites[n];t.allWrites.splice(n,1);let s=r.visible,i=!1,o=t.allWrites.length-1;for(;s&&o>=0;){const l=t.allWrites[o];l.visible&&(o>=n&&I5(l,r.path)?s=!1:rr(r.path,l.path)&&(i=!0)),o--}if(s){if(i)return T5(t),!0;if(r.snap)t.visibleWrites=Av(t.visibleWrites,r.path);else{const l=r.children;sn(l,c=>{t.visibleWrites=Av(t.visibleWrites,$t(r.path,c))})}return!0}else return!1}function I5(t,e){if(t.snap)return rr(t.path,e);for(const n in t.children)if(t.children.hasOwnProperty(n)&&rr($t(t.path,n),e))return!0;return!1}function T5(t){t.visibleWrites=Qb(t.allWrites,w5,mt()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function w5(t){return t.visible}function Qb(t,e,n){let r=xr.empty();for(let s=0;s<t.length;++s){const i=t[s];if(e(i)){const o=i.path;let l;if(i.snap)rr(n,o)?(l=Tn(n,o),r=el(r,l,i.snap)):rr(o,n)&&(l=Tn(o,n),r=el(r,mt(),i.snap.getChild(l)));else if(i.children){if(rr(n,o))l=Tn(n,o),r=Ap(r,l,i.children);else if(rr(o,n))if(l=Tn(o,n),at(l))r=Ap(r,mt(),i.children);else{const c=ki(i.children,it(l));if(c){const d=c.getChild(wt(l));r=el(r,mt(),d)}}}else throw Jo("WriteRecord should have .snap or .children")}}return r}function Jb(t,e,n,r,s){if(!r&&!s){const i=$i(t.visibleWrites,e);if(i!=null)return i;{const o=Gs(t.visibleWrites,e);if(Op(o))return n;if(n==null&&!Pp(o,mt()))return null;{const l=n||Be.EMPTY_NODE;return Go(o,l)}}}else{const i=Gs(t.visibleWrites,e);if(!s&&Op(i))return n;if(!s&&n==null&&!Pp(i,mt()))return null;{const o=function(d){return(d.visible||s)&&(!r||!~r.indexOf(d.writeId))&&(rr(d.path,e)||rr(e,d.path))},l=Qb(t.allWrites,o,e),c=n||Be.EMPTY_NODE;return Go(l,c)}}}function C5(t,e,n){let r=Be.EMPTY_NODE;const s=$i(t.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(Mt,(i,o)=>{r=r.updateImmediateChild(i,o)}),r;if(n){const i=Gs(t.visibleWrites,e);return n.forEachChild(Mt,(o,l)=>{const c=Go(Gs(i,new Et(o)),l);r=r.updateImmediateChild(o,c)}),Pv(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{const i=Gs(t.visibleWrites,e);return Pv(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function k5(t,e,n,r,s){fe(r||s,"Either existingEventSnap or existingServerSnap must exist");const i=$t(e,n);if(Pp(t.visibleWrites,i))return null;{const o=Gs(t.visibleWrites,i);return Op(o)?s.getChild(n):Go(o,s.getChild(n))}}function R5(t,e,n,r){const s=$t(e,n),i=$i(t.visibleWrites,s);if(i!=null)return i;if(r.isCompleteForChild(n)){const o=Gs(t.visibleWrites,s);return Go(o,r.getNode().getImmediateChild(n))}else return null}function A5(t,e){return $i(t.visibleWrites,e)}function P5(t,e,n,r,s,i,o){let l;const c=Gs(t.visibleWrites,e),d=$i(c,mt());if(d!=null)l=d;else if(n!=null)l=Go(c,n);else return[];if(l=l.withIndex(o),!l.isEmpty()&&!l.isLeafNode()){const u=[],h=o.getCompare(),f=i?l.getReverseIteratorFrom(r,o):l.getIteratorFrom(r,o);let x=f.getNext();for(;x&&u.length<s;)h(x,r)!==0&&u.push(x),x=f.getNext();return u}else return[]}function O5(){return{visibleWrites:xr.empty(),allWrites:[],lastWriteId:-1}}function iu(t,e,n,r){return Jb(t.writeTree,t.treePath,e,n,r)}function h0(t,e){return C5(t.writeTree,t.treePath,e)}function Ov(t,e,n,r){return k5(t.writeTree,t.treePath,e,n,r)}function ou(t,e){return A5(t.writeTree,$t(t.treePath,e))}function L5(t,e,n,r,s,i){return P5(t.writeTree,t.treePath,e,n,r,s,i)}function p0(t,e,n){return R5(t.writeTree,t.treePath,e,n)}function qb(t,e){return Zb($t(t.treePath,e),t.writeTree)}function Zb(t,e){return{treePath:t,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D5{constructor(){this.changeMap=new Map}trackChildChange(e){const n=e.type,r=e.childName;fe(n==="child_added"||n==="child_changed"||n==="child_removed","Only child changes supported for tracking"),fe(r!==".priority","Only non-priority child changes can be tracked.");const s=this.changeMap.get(r);if(s){const i=s.type;if(n==="child_added"&&i==="child_removed")this.changeMap.set(r,Rl(r,e.snapshotNode,s.snapshotNode));else if(n==="child_removed"&&i==="child_added")this.changeMap.delete(r);else if(n==="child_removed"&&i==="child_changed")this.changeMap.set(r,kl(r,s.oldSnap));else if(n==="child_changed"&&i==="child_added")this.changeMap.set(r,Ho(r,e.snapshotNode));else if(n==="child_changed"&&i==="child_changed")this.changeMap.set(r,Rl(r,e.snapshotNode,s.oldSnap));else throw Jo("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M5{getCompleteChild(e){return null}getChildAfterChild(e,n,r){return null}}const eE=new M5;class g0{constructor(e,n,r=null){this.writes_=e,this.viewCache_=n,this.optCompleteServerCache_=r}getCompleteChild(e){const n=this.viewCache_.eventCache;if(n.isCompleteForChild(e))return n.getNode().getImmediateChild(e);{const r=this.optCompleteServerCache_!=null?new Js(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return p0(this.writes_,e,r)}}getChildAfterChild(e,n,r){const s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Li(this.viewCache_),i=L5(this.writes_,s,n,1,r,e);return i.length===0?null:i[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function N5(t){return{filter:t}}function j5(t,e){fe(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),fe(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function $5(t,e,n,r,s){const i=new D5;let o,l;if(n.type===mr.OVERWRITE){const d=n;d.source.fromUser?o=Lp(t,e,d.path,d.snap,r,s,i):(fe(d.source.fromServer,"Unknown source."),l=d.source.tagged||e.serverCache.isFiltered()&&!at(d.path),o=au(t,e,d.path,d.snap,r,s,l,i))}else if(n.type===mr.MERGE){const d=n;d.source.fromUser?o=U5(t,e,d.path,d.children,r,s,i):(fe(d.source.fromServer,"Unknown source."),l=d.source.tagged||e.serverCache.isFiltered(),o=Dp(t,e,d.path,d.children,r,s,l,i))}else if(n.type===mr.ACK_USER_WRITE){const d=n;d.revert?o=H5(t,e,d.path,r,s,i):o=B5(t,e,d.path,d.affectedTree,r,s,i)}else if(n.type===mr.LISTEN_COMPLETE)o=z5(t,e,n.path,r,i);else throw Jo("Unknown operation type: "+n.type);const c=i.getChanges();return F5(e,o,c),{viewCache:o,changes:c}}function F5(t,e,n){const r=e.eventCache;if(r.isFullyInitialized()){const s=r.getNode().isLeafNode()||r.getNode().isEmpty(),i=su(t);(n.length>0||!t.eventCache.isFullyInitialized()||s&&!r.getNode().equals(i)||!r.getNode().getPriority().equals(i.getPriority()))&&n.push(Yb(su(e)))}}function tE(t,e,n,r,s,i){const o=e.eventCache;if(ou(r,n)!=null)return e;{let l,c;if(at(n))if(fe(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const d=Li(e),u=d instanceof Be?d:Be.EMPTY_NODE,h=h0(r,u);l=t.filter.updateFullNode(e.eventCache.getNode(),h,i)}else{const d=iu(r,Li(e));l=t.filter.updateFullNode(e.eventCache.getNode(),d,i)}else{const d=it(n);if(d===".priority"){fe(Qs(n)===1,"Can't have a priority with additional path components");const u=o.getNode();c=e.serverCache.getNode();const h=Ov(r,n,u,c);h!=null?l=t.filter.updatePriority(u,h):l=o.getNode()}else{const u=wt(n);let h;if(o.isCompleteForChild(d)){c=e.serverCache.getNode();const f=Ov(r,n,o.getNode(),c);f!=null?h=o.getNode().getImmediateChild(d).updateChild(u,f):h=o.getNode().getImmediateChild(d)}else h=p0(r,d,e.serverCache);h!=null?l=t.filter.updateChild(o.getNode(),d,h,u,s,i):l=o.getNode()}}return Za(e,l,o.isFullyInitialized()||at(n),t.filter.filtersNodes())}}function au(t,e,n,r,s,i,o,l){const c=e.serverCache;let d;const u=o?t.filter:t.filter.getIndexedFilter();if(at(n))d=u.updateFullNode(c.getNode(),r,null);else if(u.filtersNodes()&&!c.isFiltered()){const x=c.getNode().updateChild(n,r);d=u.updateFullNode(c.getNode(),x,null)}else{const x=it(n);if(!c.isCompleteForPath(n)&&Qs(n)>1)return e;const k=wt(n),j=c.getNode().getImmediateChild(x).updateChild(k,r);x===".priority"?d=u.updatePriority(c.getNode(),j):d=u.updateChild(c.getNode(),x,j,k,eE,null)}const h=Kb(e,d,c.isFullyInitialized()||at(n),u.filtersNodes()),f=new g0(s,h,i);return tE(t,h,n,s,f,l)}function Lp(t,e,n,r,s,i,o){const l=e.eventCache;let c,d;const u=new g0(s,e,i);if(at(n))d=t.filter.updateFullNode(e.eventCache.getNode(),r,o),c=Za(e,d,!0,t.filter.filtersNodes());else{const h=it(n);if(h===".priority")d=t.filter.updatePriority(e.eventCache.getNode(),r),c=Za(e,d,l.isFullyInitialized(),l.isFiltered());else{const f=wt(n),x=l.getNode().getImmediateChild(h);let k;if(at(f))k=r;else{const T=u.getCompleteChild(h);T!=null?s0(f)===".priority"&&T.getChild(Ub(f)).isEmpty()?k=T:k=T.updateChild(f,r):k=Be.EMPTY_NODE}if(x.equals(k))c=e;else{const T=t.filter.updateChild(l.getNode(),h,k,f,u,o);c=Za(e,T,l.isFullyInitialized(),t.filter.filtersNodes())}}}return c}function Lv(t,e){return t.eventCache.isCompleteForChild(e)}function U5(t,e,n,r,s,i,o){let l=e;return r.foreach((c,d)=>{const u=$t(n,c);Lv(e,it(u))&&(l=Lp(t,l,u,d,s,i,o))}),r.foreach((c,d)=>{const u=$t(n,c);Lv(e,it(u))||(l=Lp(t,l,u,d,s,i,o))}),l}function Dv(t,e,n){return n.foreach((r,s)=>{e=e.updateChild(r,s)}),e}function Dp(t,e,n,r,s,i,o,l){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,d;at(n)?d=r:d=new kt(null).setTree(n,r);const u=e.serverCache.getNode();return d.children.inorderTraversal((h,f)=>{if(u.hasChild(h)){const x=e.serverCache.getNode().getImmediateChild(h),k=Dv(t,x,f);c=au(t,c,new Et(h),k,s,i,o,l)}}),d.children.inorderTraversal((h,f)=>{const x=!e.serverCache.isCompleteForChild(h)&&f.value===null;if(!u.hasChild(h)&&!x){const k=e.serverCache.getNode().getImmediateChild(h),T=Dv(t,k,f);c=au(t,c,new Et(h),T,s,i,o,l)}}),c}function B5(t,e,n,r,s,i,o){if(ou(s,n)!=null)return e;const l=e.serverCache.isFiltered(),c=e.serverCache;if(r.value!=null){if(at(n)&&c.isFullyInitialized()||c.isCompleteForPath(n))return au(t,e,n,c.getNode().getChild(n),s,i,l,o);if(at(n)){let d=new kt(null);return c.getNode().forEachChild(Co,(u,h)=>{d=d.set(new Et(u),h)}),Dp(t,e,n,d,s,i,l,o)}else return e}else{let d=new kt(null);return r.foreach((u,h)=>{const f=$t(n,u);c.isCompleteForPath(f)&&(d=d.set(u,c.getNode().getChild(f)))}),Dp(t,e,n,d,s,i,l,o)}}function z5(t,e,n,r,s){const i=e.serverCache,o=Kb(e,i.getNode(),i.isFullyInitialized()||at(n),i.isFiltered());return tE(t,o,n,r,eE,s)}function H5(t,e,n,r,s,i){let o;if(ou(r,n)!=null)return e;{const l=new g0(r,e,s),c=e.eventCache.getNode();let d;if(at(n)||it(n)===".priority"){let u;if(e.serverCache.isFullyInitialized())u=iu(r,Li(e));else{const h=e.serverCache.getNode();fe(h instanceof Be,"serverChildren would be complete if leaf node"),u=h0(r,h)}u=u,d=t.filter.updateFullNode(c,u,i)}else{const u=it(n);let h=p0(r,u,e.serverCache);h==null&&e.serverCache.isCompleteForChild(u)&&(h=c.getImmediateChild(u)),h!=null?d=t.filter.updateChild(c,u,h,wt(n),l,i):e.eventCache.getNode().hasChild(u)?d=t.filter.updateChild(c,u,Be.EMPTY_NODE,wt(n),l,i):d=c,d.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=iu(r,Li(e)),o.isLeafNode()&&(d=t.filter.updateFullNode(d,o,i)))}return o=e.serverCache.isFullyInitialized()||ou(r,mt())!=null,Za(e,d,o,t.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W5{constructor(e,n){this.query_=e,this.eventRegistrations_=[];const r=this.query_._queryParams,s=new l0(r.getIndex()),i=l5(r);this.processor_=N5(i);const o=n.serverCache,l=n.eventCache,c=s.updateFullNode(Be.EMPTY_NODE,o.getNode(),null),d=i.updateFullNode(Be.EMPTY_NODE,l.getNode(),null),u=new Js(c,o.isFullyInitialized(),s.filtersNodes()),h=new Js(d,l.isFullyInitialized(),i.filtersNodes());this.viewCache_=$u(h,u),this.eventGenerator_=new g5(this.query_)}get query(){return this.query_}}function G5(t){return t.viewCache_.serverCache.getNode()}function V5(t){return su(t.viewCache_)}function Y5(t,e){const n=Li(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!at(e)&&!n.getImmediateChild(it(e)).isEmpty())?n.getChild(e):null}function Mv(t){return t.eventRegistrations_.length===0}function K5(t,e){t.eventRegistrations_.push(e)}function Nv(t,e,n){const r=[];if(n){fe(e==null,"A cancel should cancel all event registrations.");const s=t.query._path;t.eventRegistrations_.forEach(i=>{const o=i.createCancelEvent(n,s);o&&r.push(o)})}if(e){let s=[];for(let i=0;i<t.eventRegistrations_.length;++i){const o=t.eventRegistrations_[i];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(t.eventRegistrations_.slice(i+1));break}}t.eventRegistrations_=s}else t.eventRegistrations_=[];return r}function jv(t,e,n,r){e.type===mr.MERGE&&e.source.queryId!==null&&(fe(Li(t.viewCache_),"We should always have a full cache before handling merges"),fe(su(t.viewCache_),"Missing event cache, even though we have a server cache"));const s=t.viewCache_,i=$5(t.processor_,s,e,n,r);return j5(t.processor_,i.viewCache),fe(i.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=i.viewCache,nE(t,i.changes,i.viewCache.eventCache.getNode(),null)}function X5(t,e){const n=t.viewCache_.eventCache,r=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(Mt,(i,o)=>{r.push(Ho(i,o))}),n.isFullyInitialized()&&r.push(Yb(n.getNode())),nE(t,r,n.getNode(),e)}function nE(t,e,n,r){const s=r?[r]:t.eventRegistrations_;return m5(t.eventGenerator_,e,n,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let lu;class rE{constructor(){this.views=new Map}}function Q5(t){fe(!lu,"__referenceConstructor has already been defined"),lu=t}function J5(){return fe(lu,"Reference.ts has not been loaded"),lu}function q5(t){return t.views.size===0}function m0(t,e,n,r){const s=e.source.queryId;if(s!==null){const i=t.views.get(s);return fe(i!=null,"SyncTree gave us an op for an invalid query."),jv(i,e,n,r)}else{let i=[];for(const o of t.views.values())i=i.concat(jv(o,e,n,r));return i}}function sE(t,e,n,r,s){const i=e._queryIdentifier,o=t.views.get(i);if(!o){let l=iu(n,s?r:null),c=!1;l?c=!0:r instanceof Be?(l=h0(n,r),c=!1):(l=Be.EMPTY_NODE,c=!1);const d=$u(new Js(l,c,!1),new Js(r,s,!1));return new W5(e,d)}return o}function Z5(t,e,n,r,s,i){const o=sE(t,e,r,s,i);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,o),K5(o,n),X5(o,n)}function eR(t,e,n,r){const s=e._queryIdentifier,i=[];let o=[];const l=qs(t);if(s==="default")for(const[c,d]of t.views.entries())o=o.concat(Nv(d,n,r)),Mv(d)&&(t.views.delete(c),d.query._queryParams.loadsAllData()||i.push(d.query));else{const c=t.views.get(s);c&&(o=o.concat(Nv(c,n,r)),Mv(c)&&(t.views.delete(s),c.query._queryParams.loadsAllData()||i.push(c.query)))}return l&&!qs(t)&&i.push(new(J5())(e._repo,e._path)),{removed:i,events:o}}function iE(t){const e=[];for(const n of t.views.values())n.query._queryParams.loadsAllData()||e.push(n);return e}function Vs(t,e){let n=null;for(const r of t.views.values())n=n||Y5(r,e);return n}function oE(t,e){if(e._queryParams.loadsAllData())return Uu(t);{const r=e._queryIdentifier;return t.views.get(r)}}function aE(t,e){return oE(t,e)!=null}function qs(t){return Uu(t)!=null}function Uu(t){for(const e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let cu;function tR(t){fe(!cu,"__referenceConstructor has already been defined"),cu=t}function nR(){return fe(cu,"Reference.ts has not been loaded"),cu}let rR=1;class $v{constructor(e){this.listenProvider_=e,this.syncPointTree_=new kt(null),this.pendingWriteTree_=O5(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function y0(t,e,n,r,s){return x5(t.pendingWriteTree_,e,n,r,s),s?ra(t,new Oi(d0(),e,n)):[]}function sR(t,e,n,r){b5(t.pendingWriteTree_,e,n,r);const s=kt.fromObject(n);return ra(t,new Wo(d0(),e,s))}function Ps(t,e,n=!1){const r=E5(t.pendingWriteTree_,e);if(S5(t.pendingWriteTree_,e)){let i=new kt(null);return r.snap!=null?i=i.set(mt(),!0):sn(r.children,o=>{i=i.set(new Et(o),!0)}),ra(t,new ru(r.path,i,n))}else return[]}function Yl(t,e,n){return ra(t,new Oi(u0(),e,n))}function iR(t,e,n){const r=kt.fromObject(n);return ra(t,new Wo(u0(),e,r))}function oR(t,e){return ra(t,new Pl(u0(),e))}function aR(t,e,n){const r=v0(t,n);if(r){const s=_0(r),i=s.path,o=s.queryId,l=Tn(i,e),c=new Pl(f0(o),l);return x0(t,i,c)}else return[]}function du(t,e,n,r,s=!1){const i=e._path,o=t.syncPointTree_.get(i);let l=[];if(o&&(e._queryIdentifier==="default"||aE(o,e))){const c=eR(o,e,n,r);q5(o)&&(t.syncPointTree_=t.syncPointTree_.remove(i));const d=c.removed;if(l=c.events,!s){const u=d.findIndex(f=>f._queryParams.loadsAllData())!==-1,h=t.syncPointTree_.findOnPath(i,(f,x)=>qs(x));if(u&&!h){const f=t.syncPointTree_.subtree(i);if(!f.isEmpty()){const x=dR(f);for(let k=0;k<x.length;++k){const T=x[k],j=T.query,b=uE(t,T);t.listenProvider_.startListening(tl(j),Ol(t,j),b.hashFn,b.onComplete)}}}!h&&d.length>0&&!r&&(u?t.listenProvider_.stopListening(tl(e),null):d.forEach(f=>{const x=t.queryToTagMap.get(zu(f));t.listenProvider_.stopListening(tl(f),x)}))}uR(t,d)}return l}function lE(t,e,n,r){const s=v0(t,r);if(s!=null){const i=_0(s),o=i.path,l=i.queryId,c=Tn(o,e),d=new Oi(f0(l),c,n);return x0(t,o,d)}else return[]}function lR(t,e,n,r){const s=v0(t,r);if(s){const i=_0(s),o=i.path,l=i.queryId,c=Tn(o,e),d=kt.fromObject(n),u=new Wo(f0(l),c,d);return x0(t,o,u)}else return[]}function Mp(t,e,n,r=!1){const s=e._path;let i=null,o=!1;t.syncPointTree_.foreachOnPath(s,(f,x)=>{const k=Tn(f,s);i=i||Vs(x,k),o=o||qs(x)});let l=t.syncPointTree_.get(s);l?(o=o||qs(l),i=i||Vs(l,mt())):(l=new rE,t.syncPointTree_=t.syncPointTree_.set(s,l));let c;i!=null?c=!0:(c=!1,i=Be.EMPTY_NODE,t.syncPointTree_.subtree(s).foreachChild((x,k)=>{const T=Vs(k,mt());T&&(i=i.updateImmediateChild(x,T))}));const d=aE(l,e);if(!d&&!e._queryParams.loadsAllData()){const f=zu(e);fe(!t.queryToTagMap.has(f),"View does not exist, but we have a tag");const x=fR();t.queryToTagMap.set(f,x),t.tagToQueryMap.set(x,f)}const u=Fu(t.pendingWriteTree_,s);let h=Z5(l,e,n,u,i,c);if(!d&&!o&&!r){const f=oE(l,e);h=h.concat(hR(t,e,f))}return h}function Bu(t,e,n){const s=t.pendingWriteTree_,i=t.syncPointTree_.findOnPath(e,(o,l)=>{const c=Tn(o,e),d=Vs(l,c);if(d)return d});return Jb(s,e,i,n,!0)}function cR(t,e){const n=e._path;let r=null;t.syncPointTree_.foreachOnPath(n,(d,u)=>{const h=Tn(d,n);r=r||Vs(u,h)});let s=t.syncPointTree_.get(n);s?r=r||Vs(s,mt()):(s=new rE,t.syncPointTree_=t.syncPointTree_.set(n,s));const i=r!=null,o=i?new Js(r,!0,!1):null,l=Fu(t.pendingWriteTree_,e._path),c=sE(s,e,l,i?o.getNode():Be.EMPTY_NODE,i);return V5(c)}function ra(t,e){return cE(e,t.syncPointTree_,null,Fu(t.pendingWriteTree_,mt()))}function cE(t,e,n,r){if(at(t.path))return dE(t,e,n,r);{const s=e.get(mt());n==null&&s!=null&&(n=Vs(s,mt()));let i=[];const o=it(t.path),l=t.operationForChild(o),c=e.children.get(o);if(c&&l){const d=n?n.getImmediateChild(o):null,u=qb(r,o);i=i.concat(cE(l,c,d,u))}return s&&(i=i.concat(m0(s,t,r,n))),i}}function dE(t,e,n,r){const s=e.get(mt());n==null&&s!=null&&(n=Vs(s,mt()));let i=[];return e.children.inorderTraversal((o,l)=>{const c=n?n.getImmediateChild(o):null,d=qb(r,o),u=t.operationForChild(o);u&&(i=i.concat(dE(u,l,c,d)))}),s&&(i=i.concat(m0(s,t,r,n))),i}function uE(t,e){const n=e.query,r=Ol(t,n);return{hashFn:()=>(G5(e)||Be.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return r?aR(t,n._path,r):oR(t,n._path);{const i=ok(s,n);return du(t,n,null,i)}}}}function Ol(t,e){const n=zu(e);return t.queryToTagMap.get(n)}function zu(t){return t._path.toString()+"$"+t._queryIdentifier}function v0(t,e){return t.tagToQueryMap.get(e)}function _0(t){const e=t.indexOf("$");return fe(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new Et(t.substr(0,e))}}function x0(t,e,n){const r=t.syncPointTree_.get(e);fe(r,"Missing sync point for query tag that we're tracking");const s=Fu(t.pendingWriteTree_,e);return m0(r,n,s,null)}function dR(t){return t.fold((e,n,r)=>{if(n&&qs(n))return[Uu(n)];{let s=[];return n&&(s=iE(n)),sn(r,(i,o)=>{s=s.concat(o)}),s}})}function tl(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(nR())(t._repo,t._path):t}function uR(t,e){for(let n=0;n<e.length;++n){const r=e[n];if(!r._queryParams.loadsAllData()){const s=zu(r),i=t.queryToTagMap.get(s);t.queryToTagMap.delete(s),t.tagToQueryMap.delete(i)}}}function fR(){return rR++}function hR(t,e,n){const r=e._path,s=Ol(t,e),i=uE(t,n),o=t.listenProvider_.startListening(tl(e),s,i.hashFn,i.onComplete),l=t.syncPointTree_.subtree(r);if(s)fe(!qs(l.value),"If we're adding a query, it shouldn't be shadowed");else{const c=l.fold((d,u,h)=>{if(!at(d)&&u&&qs(u))return[Uu(u).query];{let f=[];return u&&(f=f.concat(iE(u).map(x=>x.query))),sn(h,(x,k)=>{f=f.concat(k)}),f}});for(let d=0;d<c.length;++d){const u=c[d];t.listenProvider_.stopListening(tl(u),Ol(t,u))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b0{constructor(e){this.node_=e}getImmediateChild(e){const n=this.node_.getImmediateChild(e);return new b0(n)}node(){return this.node_}}class E0{constructor(e,n){this.syncTree_=e,this.path_=n}getImmediateChild(e){const n=$t(this.path_,e);return new E0(this.syncTree_,n)}node(){return Bu(this.syncTree_,this.path_)}}const pR=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},Fv=function(t,e,n){if(!t||typeof t!="object")return t;if(fe(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return gR(t[".sv"],e,n);if(typeof t[".sv"]=="object")return mR(t[".sv"],e);fe(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},gR=function(t,e,n){switch(t){case"timestamp":return n.timestamp;default:fe(!1,"Unexpected server value: "+t)}},mR=function(t,e,n){t.hasOwnProperty("increment")||fe(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const r=t.increment;typeof r!="number"&&fe(!1,"Unexpected increment value: "+r);const s=e.node();if(fe(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return r;const o=s.getValue();return typeof o!="number"?r:o+r},fE=function(t,e,n,r){return I0(e,new E0(n,t),r)},S0=function(t,e,n){return I0(t,new b0(e),n)};function I0(t,e,n){const r=t.getPriority().val(),s=Fv(r,e.getImmediateChild(".priority"),n);let i;if(t.isLeafNode()){const o=t,l=Fv(o.getValue(),e,n);return l!==o.getValue()||s!==o.getPriority().val()?new Zt(l,jt(s)):t}else{const o=t;return i=o,s!==o.getPriority().val()&&(i=i.updatePriority(new Zt(s))),o.forEachChild(Mt,(l,c)=>{const d=I0(c,e.getImmediateChild(l),n);d!==c&&(i=i.updateImmediateChild(l,d))}),i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T0{constructor(e="",n=null,r={children:{},childCount:0}){this.name=e,this.parent=n,this.node=r}}function Hu(t,e){let n=e instanceof Et?e:new Et(e),r=t,s=it(n);for(;s!==null;){const i=ki(r.node.children,s)||{children:{},childCount:0};r=new T0(s,r,i),n=wt(n),s=it(n)}return r}function Fi(t){return t.node.value}function w0(t,e){t.node.value=e,Np(t)}function hE(t){return t.node.childCount>0}function yR(t){return Fi(t)===void 0&&!hE(t)}function Wu(t,e){sn(t.node.children,(n,r)=>{e(new T0(n,t,r))})}function pE(t,e,n,r){n&&e(t),Wu(t,s=>{pE(s,e,!0)})}function vR(t,e,n){let r=t.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function Kl(t){return new Et(t.parent===null?t.name:Kl(t.parent)+"/"+t.name)}function Np(t){t.parent!==null&&_R(t.parent,t.name,t)}function _R(t,e,n){const r=yR(n),s=Sr(t.node.children,e);r&&s?(delete t.node.children[e],t.node.childCount--,Np(t)):!r&&!s&&(t.node.children[e]=n.node,t.node.childCount++,Np(t))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xR=/[\[\].#$\/\u0000-\u001F\u007F]/,bR=/[\[\].#$\u0000-\u001F\u007F]/,xh=10*1024*1024,C0=function(t){return typeof t=="string"&&t.length!==0&&!xR.test(t)},gE=function(t){return typeof t=="string"&&t.length!==0&&!bR.test(t)},ER=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),gE(t)},k0=function(t){return t===null||typeof t=="string"||typeof t=="number"&&!Nu(t)||t&&typeof t=="object"&&Sr(t,".sv")},uu=function(t,e,n,r){r&&e===void 0||Xl(Uo(t,"value"),e,n)},Xl=function(t,e,n){const r=n instanceof Et?new Uk(n,t):n;if(e===void 0)throw new Error(t+"contains undefined "+gi(r));if(typeof e=="function")throw new Error(t+"contains a function "+gi(r)+" with contents = "+e.toString());if(Nu(e))throw new Error(t+"contains "+e.toString()+" "+gi(r));if(typeof e=="string"&&e.length>xh/3&&Mu(e)>xh)throw new Error(t+"contains a string greater than "+xh+" utf8 bytes "+gi(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,i=!1;if(sn(e,(o,l)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(i=!0,!C0(o)))throw new Error(t+" contains an invalid key ("+o+") "+gi(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);Bk(r,o),Xl(t,l,r),zk(r)}),s&&i)throw new Error(t+' contains ".value" child '+gi(r)+" in addition to actual children.")}},SR=function(t,e){let n,r;for(n=0;n<e.length;n++){r=e[n];const i=Cl(r);for(let o=0;o<i.length;o++)if(!(i[o]===".priority"&&o===i.length-1)){if(!C0(i[o]))throw new Error(t+"contains an invalid key ("+i[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(Fk);let s=null;for(n=0;n<e.length;n++){if(r=e[n],s!==null&&rr(s,r))throw new Error(t+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}},mE=function(t,e,n,r){const s=Uo(t,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");const i=[];sn(e,(o,l)=>{const c=new Et(o);if(Xl(s,l,$t(n,c)),s0(c)===".priority"&&!k0(l))throw new Error(s+"contains an invalid value for '"+c.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");i.push(c)}),SR(s,i)},IR=function(t,e,n){if(Nu(e))throw new Error(Uo(t,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!k0(e))throw new Error(Uo(t,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")},yE=function(t,e,n,r){if(!gE(n))throw new Error(Uo(t,e)+'was an invalid path = "'+n+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},TR=function(t,e,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),yE(t,e,n)},Os=function(t,e){if(it(e)===".info")throw new Error(t+" failed = Can't modify data under /.info/")},wR=function(t,e){const n=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!C0(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||n.length!==0&&!ER(n))throw new Error(Uo(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CR{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Gu(t,e){let n=null;for(let r=0;r<e.length;r++){const s=e[r],i=s.getPath();n!==null&&!i0(i,n.path)&&(t.eventLists_.push(n),n=null),n===null&&(n={events:[],path:i}),n.events.push(s)}n&&t.eventLists_.push(n)}function vE(t,e,n){Gu(t,n),_E(t,r=>i0(r,e))}function Yn(t,e,n){Gu(t,n),_E(t,r=>rr(r,e)||rr(e,r))}function _E(t,e){t.recursionDepth_++;let n=!0;for(let r=0;r<t.eventLists_.length;r++){const s=t.eventLists_[r];if(s){const i=s.path;e(i)?(kR(t.eventLists_[r]),t.eventLists_[r]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function kR(t){for(let e=0;e<t.events.length;e++){const n=t.events[e];if(n!==null){t.events[e]=null;const r=n.getEventRunner();Ja&&nn("event: "+n.toString()),ta(r)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RR="repo_interrupt",AR=25;class PR{constructor(e,n,r,s){this.repoInfo_=e,this.forceRestClient_=n,this.authTokenProvider_=r,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new CR,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=nu(),this.transactionQueueTree_=new T0,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function OR(t,e,n){if(t.stats_=n0(t.repoInfo_),t.forceRestClient_||dk())t.server_=new tu(t.repoInfo_,(r,s,i,o)=>{Uv(t,r,s,i,o)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>Bv(t,!0),0);else{if(typeof n<"u"&&n!==null){if(typeof n!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Xt(n)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}t.persistentConnection_=new ts(t.repoInfo_,e,(r,s,i,o)=>{Uv(t,r,s,i,o)},r=>{Bv(t,r)},r=>{LR(t,r)},t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(r=>{t.server_.refreshAuthToken(r)}),t.appCheckProvider_.addTokenChangeListener(r=>{t.server_.refreshAppCheckToken(r.token)}),t.statsReporter_=gk(t.repoInfo_,()=>new p5(t.stats_,t.server_)),t.infoData_=new c5,t.infoSyncTree_=new $v({startListening:(r,s,i,o)=>{let l=[];const c=t.infoData_.getNode(r._path);return c.isEmpty()||(l=Yl(t.infoSyncTree_,r._path,c),setTimeout(()=>{o("ok")},0)),l},stopListening:()=>{}}),R0(t,"connected",!1),t.serverSyncTree_=new $v({startListening:(r,s,i,o)=>(t.server_.listen(r,i,s,(l,c)=>{const d=o(l,c);Yn(t.eventQueue_,r._path,d)}),[]),stopListening:(r,s)=>{t.server_.unlisten(r,s)}})}function xE(t){const n=t.infoData_.getNode(new Et(".info/serverTimeOffset")).val()||0;return new Date().getTime()+n}function Ql(t){return pR({timestamp:xE(t)})}function Uv(t,e,n,r,s){t.dataUpdateCount++;const i=new Et(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let o=[];if(s)if(r){const c=Qd(n,d=>jt(d));o=lR(t.serverSyncTree_,i,c,s)}else{const c=jt(n);o=lE(t.serverSyncTree_,i,c,s)}else if(r){const c=Qd(n,d=>jt(d));o=iR(t.serverSyncTree_,i,c)}else{const c=jt(n);o=Yl(t.serverSyncTree_,i,c)}let l=i;o.length>0&&(l=Vo(t,i)),Yn(t.eventQueue_,l,o)}function Bv(t,e){R0(t,"connected",e),e===!1&&jR(t)}function LR(t,e){sn(e,(n,r)=>{R0(t,n,r)})}function R0(t,e,n){const r=new Et("/.info/"+e),s=jt(n);t.infoData_.updateSnapshot(r,s);const i=Yl(t.infoSyncTree_,r,s);Yn(t.eventQueue_,r,i)}function Vu(t){return t.nextWriteId_++}function DR(t,e,n){const r=cR(t.serverSyncTree_,e);return r!=null?Promise.resolve(r):t.server_.get(e).then(s=>{const i=jt(s).withIndex(e._queryParams.getIndex());Mp(t.serverSyncTree_,e,n,!0);let o;if(e._queryParams.loadsAllData())o=Yl(t.serverSyncTree_,e._path,i);else{const l=Ol(t.serverSyncTree_,e);o=lE(t.serverSyncTree_,e._path,i,l)}return Yn(t.eventQueue_,e._path,o),du(t.serverSyncTree_,e,n,null,!0),i},s=>(sa(t,"get for query "+Xt(e)+" failed: "+s),Promise.reject(new Error(s))))}function MR(t,e,n,r,s){sa(t,"set",{path:e.toString(),value:n,priority:r});const i=Ql(t),o=jt(n,r),l=Bu(t.serverSyncTree_,e),c=S0(o,l,i),d=Vu(t),u=y0(t.serverSyncTree_,e,c,d,!0);Gu(t.eventQueue_,u),t.server_.put(e.toString(),o.val(!0),(f,x)=>{const k=f==="ok";k||Cn("set at "+e+" failed: "+f);const T=Ps(t.serverSyncTree_,d,!k);Yn(t.eventQueue_,e,T),Zs(t,s,f,x)});const h=P0(t,e);Vo(t,h),Yn(t.eventQueue_,h,[])}function NR(t,e,n,r){sa(t,"update",{path:e.toString(),value:n});let s=!0;const i=Ql(t),o={};if(sn(n,(l,c)=>{s=!1,o[l]=fE($t(e,l),jt(c),t.serverSyncTree_,i)}),s)nn("update() called with empty data.  Don't do anything."),Zs(t,r,"ok",void 0);else{const l=Vu(t),c=sR(t.serverSyncTree_,e,o,l);Gu(t.eventQueue_,c),t.server_.merge(e.toString(),n,(d,u)=>{const h=d==="ok";h||Cn("update at "+e+" failed: "+d);const f=Ps(t.serverSyncTree_,l,!h),x=f.length>0?Vo(t,e):e;Yn(t.eventQueue_,x,f),Zs(t,r,d,u)}),sn(n,d=>{const u=P0(t,$t(e,d));Vo(t,u)}),Yn(t.eventQueue_,e,[])}}function jR(t){sa(t,"onDisconnectEvents");const e=Ql(t),n=nu();Rp(t.onDisconnect_,mt(),(s,i)=>{const o=fE(s,i,t.serverSyncTree_,e);na(n,s,o)});let r=[];Rp(n,mt(),(s,i)=>{r=r.concat(Yl(t.serverSyncTree_,s,i));const o=P0(t,s);Vo(t,o)}),t.onDisconnect_=nu(),Yn(t.eventQueue_,mt(),r)}function $R(t,e,n){t.server_.onDisconnectCancel(e.toString(),(r,s)=>{r==="ok"&&kp(t.onDisconnect_,e),Zs(t,n,r,s)})}function zv(t,e,n,r){const s=jt(n);t.server_.onDisconnectPut(e.toString(),s.val(!0),(i,o)=>{i==="ok"&&na(t.onDisconnect_,e,s),Zs(t,r,i,o)})}function FR(t,e,n,r,s){const i=jt(n,r);t.server_.onDisconnectPut(e.toString(),i.val(!0),(o,l)=>{o==="ok"&&na(t.onDisconnect_,e,i),Zs(t,s,o,l)})}function UR(t,e,n,r){if(Xd(n)){nn("onDisconnect().update() called with empty data.  Don't do anything."),Zs(t,r,"ok",void 0);return}t.server_.onDisconnectMerge(e.toString(),n,(s,i)=>{s==="ok"&&sn(n,(o,l)=>{const c=jt(l);na(t.onDisconnect_,$t(e,o),c)}),Zs(t,r,s,i)})}function BR(t,e,n){let r;it(e._path)===".info"?r=Mp(t.infoSyncTree_,e,n):r=Mp(t.serverSyncTree_,e,n),vE(t.eventQueue_,e._path,r)}function zR(t,e,n){let r;it(e._path)===".info"?r=du(t.infoSyncTree_,e,n):r=du(t.serverSyncTree_,e,n),vE(t.eventQueue_,e._path,r)}function HR(t){t.persistentConnection_&&t.persistentConnection_.interrupt(RR)}function sa(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),nn(n,...e)}function Zs(t,e,n,r){e&&ta(()=>{if(n==="ok")e(null);else{const s=(n||"error").toUpperCase();let i=s;r&&(i+=": "+r);const o=new Error(i);o.code=s,e(o)}})}function WR(t,e,n,r,s,i){sa(t,"transaction on "+e);const o={path:e,update:n,onComplete:r,status:null,order:vb(),applyLocally:i,retryCount:0,unwatcher:s,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},l=A0(t,e,void 0);o.currentInputSnapshot=l;const c=o.update(l.val());if(c===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{Xl("transaction failed: Data returned ",c,o.path),o.status=0;const d=Hu(t.transactionQueueTree_,e),u=Fi(d)||[];u.push(o),w0(d,u);let h;typeof c=="object"&&c!==null&&Sr(c,".priority")?(h=ki(c,".priority"),fe(k0(h),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):h=(Bu(t.serverSyncTree_,e)||Be.EMPTY_NODE).getPriority().val();const f=Ql(t),x=jt(c,h),k=S0(x,l,f);o.currentOutputSnapshotRaw=x,o.currentOutputSnapshotResolved=k,o.currentWriteId=Vu(t);const T=y0(t.serverSyncTree_,e,k,o.currentWriteId,o.applyLocally);Yn(t.eventQueue_,e,T),Yu(t,t.transactionQueueTree_)}}function A0(t,e,n){return Bu(t.serverSyncTree_,e,n)||Be.EMPTY_NODE}function Yu(t,e=t.transactionQueueTree_){if(e||Ku(t,e),Fi(e)){const n=EE(t,e);fe(n.length>0,"Sending zero length transaction queue"),n.every(s=>s.status===0)&&GR(t,Kl(e),n)}else hE(e)&&Wu(e,n=>{Yu(t,n)})}function GR(t,e,n){const r=n.map(d=>d.currentWriteId),s=A0(t,e,r);let i=s;const o=s.hash();for(let d=0;d<n.length;d++){const u=n[d];fe(u.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;const h=Tn(e,u.path);i=i.updateChild(h,u.currentOutputSnapshotRaw)}const l=i.val(!0),c=e;t.server_.put(c.toString(),l,d=>{sa(t,"transaction put response",{path:c.toString(),status:d});let u=[];if(d==="ok"){const h=[];for(let f=0;f<n.length;f++)n[f].status=2,u=u.concat(Ps(t.serverSyncTree_,n[f].currentWriteId)),n[f].onComplete&&h.push(()=>n[f].onComplete(null,!0,n[f].currentOutputSnapshotResolved)),n[f].unwatcher();Ku(t,Hu(t.transactionQueueTree_,e)),Yu(t,t.transactionQueueTree_),Yn(t.eventQueue_,e,u);for(let f=0;f<h.length;f++)ta(h[f])}else{if(d==="datastale")for(let h=0;h<n.length;h++)n[h].status===3?n[h].status=4:n[h].status=0;else{Cn("transaction at "+c.toString()+" failed: "+d);for(let h=0;h<n.length;h++)n[h].status=4,n[h].abortReason=d}Vo(t,e)}},o)}function Vo(t,e){const n=bE(t,e),r=Kl(n),s=EE(t,n);return VR(t,s,r),r}function VR(t,e,n){if(e.length===0)return;const r=[];let s=[];const o=e.filter(l=>l.status===0).map(l=>l.currentWriteId);for(let l=0;l<e.length;l++){const c=e[l],d=Tn(n,c.path);let u=!1,h;if(fe(d!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)u=!0,h=c.abortReason,s=s.concat(Ps(t.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=AR)u=!0,h="maxretry",s=s.concat(Ps(t.serverSyncTree_,c.currentWriteId,!0));else{const f=A0(t,c.path,o);c.currentInputSnapshot=f;const x=e[l].update(f.val());if(x!==void 0){Xl("transaction failed: Data returned ",x,c.path);let k=jt(x);typeof x=="object"&&x!=null&&Sr(x,".priority")||(k=k.updatePriority(f.getPriority()));const j=c.currentWriteId,b=Ql(t),v=S0(k,f,b);c.currentOutputSnapshotRaw=k,c.currentOutputSnapshotResolved=v,c.currentWriteId=Vu(t),o.splice(o.indexOf(j),1),s=s.concat(y0(t.serverSyncTree_,c.path,v,c.currentWriteId,c.applyLocally)),s=s.concat(Ps(t.serverSyncTree_,j,!0))}else u=!0,h="nodata",s=s.concat(Ps(t.serverSyncTree_,c.currentWriteId,!0))}Yn(t.eventQueue_,n,s),s=[],u&&(e[l].status=2,function(f){setTimeout(f,Math.floor(0))}(e[l].unwatcher),e[l].onComplete&&(h==="nodata"?r.push(()=>e[l].onComplete(null,!1,e[l].currentInputSnapshot)):r.push(()=>e[l].onComplete(new Error(h),!1,null))))}Ku(t,t.transactionQueueTree_);for(let l=0;l<r.length;l++)ta(r[l]);Yu(t,t.transactionQueueTree_)}function bE(t,e){let n,r=t.transactionQueueTree_;for(n=it(e);n!==null&&Fi(r)===void 0;)r=Hu(r,n),e=wt(e),n=it(e);return r}function EE(t,e){const n=[];return SE(t,e,n),n.sort((r,s)=>r.order-s.order),n}function SE(t,e,n){const r=Fi(e);if(r)for(let s=0;s<r.length;s++)n.push(r[s]);Wu(e,s=>{SE(t,s,n)})}function Ku(t,e){const n=Fi(e);if(n){let r=0;for(let s=0;s<n.length;s++)n[s].status!==2&&(n[r]=n[s],r++);n.length=r,w0(e,n.length>0?n:void 0)}Wu(e,r=>{Ku(t,r)})}function P0(t,e){const n=Kl(bE(t,e)),r=Hu(t.transactionQueueTree_,e);return vR(r,s=>{bh(t,s)}),bh(t,r),pE(r,s=>{bh(t,s)}),n}function bh(t,e){const n=Fi(e);if(n){const r=[];let s=[],i=-1;for(let o=0;o<n.length;o++)n[o].status===3||(n[o].status===1?(fe(i===o-1,"All SENT items should be at beginning of queue."),i=o,n[o].status=3,n[o].abortReason="set"):(fe(n[o].status===0,"Unexpected transaction status in abort"),n[o].unwatcher(),s=s.concat(Ps(t.serverSyncTree_,n[o].currentWriteId,!0)),n[o].onComplete&&r.push(n[o].onComplete.bind(null,new Error("set"),!1,null))));i===-1?w0(e,void 0):n.length=i+1,Yn(t.eventQueue_,Kl(e),s);for(let o=0;o<r.length;o++)ta(r[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YR(t){let e="";const n=t.split("/");for(let r=0;r<n.length;r++)if(n[r].length>0){let s=n[r];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function KR(t){const e={};t.charAt(0)==="?"&&(t=t.substring(1));for(const n of t.split("&")){if(n.length===0)continue;const r=n.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):Cn(`Invalid query segment '${n}' in query '${t}'`)}return e}const Hv=function(t,e){const n=XR(t),r=n.namespace;n.domain==="firebase.com"&&ls(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&n.domain!=="localhost"&&ls("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||tk();const s=n.scheme==="ws"||n.scheme==="wss";return{repoInfo:new Pb(n.host,n.secure,r,s,e,"",r!==n.subdomain),path:new Et(n.pathString)}},XR=function(t){let e="",n="",r="",s="",i="",o=!0,l="https",c=443;if(typeof t=="string"){let d=t.indexOf("//");d>=0&&(l=t.substring(0,d-1),t=t.substring(d+2));let u=t.indexOf("/");u===-1&&(u=t.length);let h=t.indexOf("?");h===-1&&(h=t.length),e=t.substring(0,Math.min(u,h)),u<h&&(s=YR(t.substring(u,h)));const f=KR(t.substring(Math.min(t.length,h)));d=e.indexOf(":"),d>=0?(o=l==="https"||l==="wss",c=parseInt(e.substring(d+1),10)):d=e.length;const x=e.slice(0,d);if(x.toLowerCase()==="localhost")n="localhost";else if(x.split(".").length<=2)n=x;else{const k=e.indexOf(".");r=e.substring(0,k).toLowerCase(),n=e.substring(k+1),i=r}"ns"in f&&(i=f.ns)}return{host:e,port:c,domain:n,subdomain:r,secure:o,scheme:l,pathString:s,namespace:i}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wv="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",QR=function(){let t=0;const e=[];return function(n){const r=n===t;t=n;let s;const i=new Array(8);for(s=7;s>=0;s--)i[s]=Wv.charAt(n%64),n=Math.floor(n/64);fe(n===0,"Cannot push at time == 0");let o=i.join("");if(r){for(s=11;s>=0&&e[s]===63;s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)o+=Wv.charAt(e[s]);return fe(o.length===20,"nextPushId: Length should be 20."),o}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JR{constructor(e,n,r,s){this.eventType=e,this.eventRegistration=n,this.snapshot=r,this.prevName=s}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Xt(this.snapshot.exportVal())}}class qR{constructor(e,n,r){this.eventRegistration=e,this.error=n,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IE{constructor(e,n){this.snapshotCallback=e,this.cancelCallback=n}onValue(e,n){this.snapshotCallback.call(null,e,n)}onCancel(e){return fe(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZR{constructor(e,n){this._repo=e,this._path=n}cancel(){const e=new pr;return $R(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Os("OnDisconnect.remove",this._path);const e=new pr;return zv(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Os("OnDisconnect.set",this._path),uu("OnDisconnect.set",e,this._path,!1);const n=new pr;return zv(this._repo,this._path,e,n.wrapCallback(()=>{})),n.promise}setWithPriority(e,n){Os("OnDisconnect.setWithPriority",this._path),uu("OnDisconnect.setWithPriority",e,this._path,!1),IR("OnDisconnect.setWithPriority",n);const r=new pr;return FR(this._repo,this._path,e,n,r.wrapCallback(()=>{})),r.promise}update(e){Os("OnDisconnect.update",this._path),mE("OnDisconnect.update",e,this._path);const n=new pr;return UR(this._repo,this._path,e,n.wrapCallback(()=>{})),n.promise}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O0{constructor(e,n,r,s){this._repo=e,this._path=n,this._queryParams=r,this._orderByCalled=s}get key(){return at(this._path)?null:s0(this._path)}get ref(){return new Ur(this._repo,this._path)}get _queryIdentifier(){const e=kv(this._queryParams),n=e0(e);return n==="{}"?"default":n}get _queryObject(){return kv(this._queryParams)}isEqual(e){if(e=Jt(e),!(e instanceof O0))return!1;const n=this._repo===e._repo,r=i0(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return n&&r&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+$k(this._path)}}class Ur extends O0{constructor(e,n){super(e,n,new c0,!1)}get parent(){const e=Ub(this._path);return e===null?null:new Ur(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class Yo{constructor(e,n,r){this._node=e,this.ref=n,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const n=new Et(e),r=Ll(this.ref,e);return new Yo(this._node.getChild(n),r,Mt)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,s)=>e(new Yo(s,Ll(this.ref,r),Mt)))}hasChild(e){const n=new Et(e);return!this._node.getChild(n).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Lr(t,e){return t=Jt(t),t._checkNotDeleted("ref"),e!==void 0?Ll(t._root,e):t._root}function Ll(t,e){return t=Jt(t),it(t._path)===null?TR("child","path",e):yE("child","path",e),new Ur(t._repo,$t(t._path,e))}function eA(t){return t=Jt(t),new ZR(t._repo,t._path)}function tA(t,e){t=Jt(t),Os("push",t._path),uu("push",e,t._path,!0);const n=xE(t._repo),r=QR(n),s=Ll(t,r),i=Ll(t,r);let o;return o=Promise.resolve(i),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function Gc(t){return Os("remove",t._path),Xu(t,null)}function Xu(t,e){t=Jt(t),Os("set",t._path),uu("set",e,t._path,!1);const n=new pr;return MR(t._repo,t._path,e,null,n.wrapCallback(()=>{})),n.promise}function L0(t,e){mE("update",e,t._path);const n=new pr;return NR(t._repo,t._path,e,n.wrapCallback(()=>{})),n.promise}function Qu(t){t=Jt(t);const e=new IE(()=>{}),n=new Ju(e);return DR(t._repo,t,n).then(r=>new Yo(r,new Ur(t._repo,t._path),t._queryParams.getIndex()))}class Ju{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,n){const r=n._queryParams.getIndex();return new JR("value",this,new Yo(e.snapshotNode,new Ur(n._repo,n._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new qR(this,e,n):null}matches(e){return e instanceof Ju?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function nA(t,e,n,r,s){const i=new IE(n,void 0),o=new Ju(i);return BR(t._repo,t,o),()=>zR(t._repo,t,o)}function TE(t,e,n,r){return nA(t,"value",e)}Q5(Ur);tR(Ur);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rA="FIREBASE_DATABASE_EMULATOR_HOST",jp={};let sA=!1;function iA(t,e,n,r){const s=e.lastIndexOf(":"),i=e.substring(0,s),o=qo(i);t.repoInfo_=new Pb(e,o,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0,n),r&&(t.authTokenProvider_=r)}function oA(t,e,n,r,s){let i=r||t.options.databaseURL;i===void 0&&(t.options.projectId||ls("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),nn("Using default host for project ",t.options.projectId),i=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o=Hv(i,s),l=o.repoInfo,c;typeof process<"u"&&dv&&(c=dv[rA]),c?(i=`http://${c}?ns=${l.namespace}`,o=Hv(i,s),l=o.repoInfo):o.repoInfo.secure;const d=new fk(t.name,t.options,e);wR("Invalid Firebase Database URL",o),at(o.path)||ls("Database URL must point to the root of a Firebase Database (not including a child path).");const u=lA(l,t,d,new uk(t,n));return new cA(u,t)}function aA(t,e){const n=jp[e];(!n||n[t.key]!==t)&&ls(`Database ${e}(${t.repoInfo_}) has already been deleted.`),HR(t),delete n[t.key]}function lA(t,e,n,r){let s=jp[e.name];s||(s={},jp[e.name]=s);let i=s[t.toURLString()];return i&&ls("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new PR(t,sA,n,r),s[t.toURLString()]=i,i}class cA{constructor(e,n){this._repoInternal=e,this.app=n,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(OR(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Ur(this._repo,mt())),this._rootInternal}_delete(){return this._rootInternal!==null&&(aA(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&ls("Cannot call "+e+" on a deleted database.")}}function dA(t=hb(),e){const n=Zg(t,"database").getImmediate({identifier:e});if(!n._instanceStarted){const r=x2("database");r&&uA(n,...r)}return n}function uA(t,e,n,r={}){t=Jt(t),t._checkNotDeleted("useEmulator");const s=`${e}:${n}`,i=t._repoInternal;if(t._instanceStarted){if(s===t._repoInternal.repoInfo_.host&&Ri(r,i.repoInfo_.emulatorOptions))return;ls("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&ls('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new dd(dd.OWNER);else if(r.mockUserToken){const l=typeof r.mockUserToken=="string"?r.mockUserToken:b2(r.mockUserToken,t.app.options.projectId);o=new dd(l)}qo(e)&&(ob(e),ab("Database",!0)),iA(i,s,r,o)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fA(t){QC(ea),Bo(new Ai("database",(e,{instanceIdentifier:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return oA(r,s,i,n)},"PUBLIC").setMultipleInstances(!0)),Ws(uv,fv,t),Ws(uv,fv,"esm2020")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hA{constructor(e,n){this.committed=e,this.snapshot=n}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function pA(t,e,n){if(t=Jt(t),Os("Reference.transaction",t._path),t.key===".length"||t.key===".keys")throw"Reference.transaction failed: "+t.key+" is a read-only object.";const r=!0,s=new pr,i=(l,c,d)=>{let u=null;l?s.reject(l):(u=new Yo(d,new Ur(t._repo,t._path),Mt),s.resolve(new hA(c,u)))},o=TE(t,()=>{});return WR(t._repo,t._path,e,i,o,r),s.promise}ts.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};ts.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};fA();function wE(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const gA=wE,CE=new Hl("auth","Firebase",wE());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fu=new Jg("@firebase/auth");function mA(t,...e){fu.logLevel<=It.WARN&&fu.warn(`Auth (${ea}): ${t}`,...e)}function ud(t,...e){fu.logLevel<=It.ERROR&&fu.error(`Auth (${ea}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Er(t,...e){throw D0(t,...e)}function $r(t,...e){return D0(t,...e)}function kE(t,e,n){const r={...gA(),[e]:n};return new Hl("auth","Firebase",r).create(e,{appName:t.name})}function ns(t){return kE(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function D0(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return CE.create(t,...e)}function Ue(t,e,...n){if(!t)throw D0(e,...n)}function qr(t){const e="INTERNAL ASSERTION FAILED: "+t;throw ud(e),new Error(e)}function cs(t,e){t||qr(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $p(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.href)||""}function yA(){return Gv()==="http:"||Gv()==="https:"}function Gv(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vA(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(yA()||T2()||"connection"in navigator)?navigator.onLine:!0}function _A(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jl{constructor(e,n){this.shortDelay=e,this.longDelay=n,cs(n>e,"Short delay should be less than long delay!"),this.isMobile=Qg()||lb()}get(){return vA()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M0(t,e){cs(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RE{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;qr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;qr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;qr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xA={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bA=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],EA=new Jl(3e4,6e4);function ii(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function oi(t,e,n,r,s={}){return AE(t,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const l=Zo({key:t.config.apiKey,...o}).slice(1),c=await t._getAdditionalHeaders();c["Content-Type"]="application/json",t.languageCode&&(c["X-Firebase-Locale"]=t.languageCode);const d={method:e,headers:c,...i};return I2()||(d.referrerPolicy="no-referrer"),t.emulatorConfig&&qo(t.emulatorConfig.host)&&(d.credentials="include"),RE.fetch()(await PE(t,t.config.apiHost,n,l),d)})}async function AE(t,e,n){t._canInitEmulator=!1;const r={...xA,...e};try{const s=new IA(t),i=await Promise.race([n(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Vc(t,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const l=i.ok?o.errorMessage:o.error.message,[c,d]=l.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw Vc(t,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw Vc(t,"email-already-in-use",o);if(c==="USER_DISABLED")throw Vc(t,"user-disabled",o);const u=r[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw kE(t,u,d);Er(t,u)}}catch(s){if(s instanceof si)throw s;Er(t,"network-request-failed",{message:String(s)})}}async function ql(t,e,n,r,s={}){const i=await oi(t,e,n,r,s);return"mfaPendingCredential"in i&&Er(t,"multi-factor-auth-required",{_serverResponse:i}),i}async function PE(t,e,n,r){const s=`${e}${n}?${r}`,i=t,o=i.config.emulator?M0(t.config,s):`${t.config.apiScheme}://${s}`;return bA.includes(n)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(o).toString():o}function SA(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class IA{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r($r(this.auth,"network-request-failed")),EA.get())})}}function Vc(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=$r(t,e,r);return s.customData._tokenResponse=n,s}function Vv(t){return t!==void 0&&t.enterprise!==void 0}class TA{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return SA(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function wA(t,e){return oi(t,"GET","/v2/recaptchaConfig",ii(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function CA(t,e){return oi(t,"POST","/v1/accounts:delete",e)}async function hu(t,e){return oi(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nl(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function kA(t,e=!1){const n=Jt(t),r=await n.getIdToken(e),s=N0(r);Ue(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:nl(Eh(s.auth_time)),issuedAtTime:nl(Eh(s.iat)),expirationTime:nl(Eh(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Eh(t){return Number(t)*1e3}function N0(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return ud("JWT malformed, contained fewer than 3 sections"),null;try{const s=Kd(n);return s?JSON.parse(s):(ud("Failed to decode base64 JWT payload"),null)}catch(s){return ud("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function Yv(t){const e=N0(t);return Ue(e,"internal-error"),Ue(typeof e.exp<"u","internal-error"),Ue(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Dl(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof si&&RA(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function RA({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AA{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fp{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=nl(this.lastLoginAt),this.creationTime=nl(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ml(t){var h;const e=t.auth,n=await t.getIdToken(),r=await Dl(t,hu(e,{idToken:n}));Ue(r==null?void 0:r.users.length,e,"internal-error");const s=r.users[0];t._notifyReloadListener(s);const i=(h=s.providerUserInfo)!=null&&h.length?OE(s.providerUserInfo):[],o=OA(t.providerData,i),l=t.isAnonymous,c=!(t.email&&s.passwordHash)&&!(o!=null&&o.length),d=l?c:!1,u={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new Fp(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(t,u)}async function PA(t){const e=Jt(t);await Ml(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function OA(t,e){return[...t.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function OE(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function LA(t,e){const n=await AE(t,{},async()=>{const r=Zo({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=t.config,o=await PE(t,s,"/v1/token",`key=${i}`),l=await t._getAdditionalHeaders();l["Content-Type"]="application/x-www-form-urlencoded";const c={method:"POST",headers:l,body:r};return t.emulatorConfig&&qo(t.emulatorConfig.host)&&(c.credentials="include"),RE.fetch()(o,c)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function DA(t,e){return oi(t,"POST","/v2/accounts:revokeToken",ii(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ko{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ue(e.idToken,"internal-error"),Ue(typeof e.idToken<"u","internal-error"),Ue(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Yv(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){Ue(e.length!==0,"internal-error");const n=Yv(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(Ue(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:s,expiresIn:i}=await LA(e,n);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:s,expirationTime:i}=n,o=new ko;return r&&(Ue(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(Ue(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(Ue(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ko,this.toJSON())}_performRefresh(){return qr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xs(t,e){Ue(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class yr{constructor({uid:e,auth:n,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new AA(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Fp(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const n=await Dl(this,this.stsTokenManager.getToken(this.auth,e));return Ue(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return kA(this,e)}reload(){return PA(this)}_assign(e){this!==e&&(Ue(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new yr({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){Ue(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await Ml(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(er(this.auth.app))return Promise.reject(ns(this.auth));const e=await this.getIdToken();return await Dl(this,CA(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const r=n.displayName??void 0,s=n.email??void 0,i=n.phoneNumber??void 0,o=n.photoURL??void 0,l=n.tenantId??void 0,c=n._redirectEventId??void 0,d=n.createdAt??void 0,u=n.lastLoginAt??void 0,{uid:h,emailVerified:f,isAnonymous:x,providerData:k,stsTokenManager:T}=n;Ue(h&&T,e,"internal-error");const j=ko.fromJSON(this.name,T);Ue(typeof h=="string",e,"internal-error"),xs(r,e.name),xs(s,e.name),Ue(typeof f=="boolean",e,"internal-error"),Ue(typeof x=="boolean",e,"internal-error"),xs(i,e.name),xs(o,e.name),xs(l,e.name),xs(c,e.name),xs(d,e.name),xs(u,e.name);const b=new yr({uid:h,auth:e,email:s,emailVerified:f,displayName:r,isAnonymous:x,photoURL:o,phoneNumber:i,tenantId:l,stsTokenManager:j,createdAt:d,lastLoginAt:u});return k&&Array.isArray(k)&&(b.providerData=k.map(v=>({...v}))),c&&(b._redirectEventId=c),b}static async _fromIdTokenResponse(e,n,r=!1){const s=new ko;s.updateFromServerResponse(n);const i=new yr({uid:n.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Ml(i),i}static async _fromGetAccountInfoResponse(e,n,r){const s=n.users[0];Ue(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?OE(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),l=new ko;l.updateFromIdToken(r);const c=new yr({uid:s.localId,auth:e,stsTokenManager:l,isAnonymous:o}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Fp(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(c,d),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kv=new Map;function Zr(t){cs(t instanceof Function,"Expected a class definition");let e=Kv.get(t);return e?(cs(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,Kv.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LE{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}LE.type="NONE";const Xv=LE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fd(t,e,n){return`firebase:${t}:${e}:${n}`}class Ro{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=fd(this.userKey,s.apiKey,i),this.fullPersistenceKey=fd("persistence",s.apiKey,i),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await hu(this.auth,{idToken:e}).catch(()=>{});return n?yr._fromGetAccountInfoResponse(this.auth,n,e):null}return yr._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new Ro(Zr(Xv),e,r);const s=(await Promise.all(n.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let i=s[0]||Zr(Xv);const o=fd(r,e.config.apiKey,e.name);let l=null;for(const d of n)try{const u=await d._get(o);if(u){let h;if(typeof u=="string"){const f=await hu(e,{idToken:u}).catch(()=>{});if(!f)break;h=await yr._fromGetAccountInfoResponse(e,f,u)}else h=yr._fromJSON(e,u);d!==i&&(l=h),i=d;break}}catch{}const c=s.filter(d=>d._shouldAllowMigration);return!i._shouldAllowMigration||!c.length?new Ro(i,e,r):(i=c[0],l&&await i._set(o,l.toJSON()),await Promise.all(n.map(async d=>{if(d!==i)try{await d._remove(o)}catch{}})),new Ro(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qv(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(jE(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(DE(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(FE(e))return"Blackberry";if(UE(e))return"Webos";if(ME(e))return"Safari";if((e.includes("chrome/")||NE(e))&&!e.includes("edge/"))return"Chrome";if($E(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function DE(t=kn()){return/firefox\//i.test(t)}function ME(t=kn()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function NE(t=kn()){return/crios\//i.test(t)}function jE(t=kn()){return/iemobile/i.test(t)}function $E(t=kn()){return/android/i.test(t)}function FE(t=kn()){return/blackberry/i.test(t)}function UE(t=kn()){return/webos/i.test(t)}function j0(t=kn()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function MA(t=kn()){var e;return j0(t)&&!!((e=window.navigator)!=null&&e.standalone)}function NA(){return w2()&&document.documentMode===10}function BE(t=kn()){return j0(t)||$E(t)||UE(t)||FE(t)||/windows phone/i.test(t)||jE(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zE(t,e=[]){let n;switch(t){case"Browser":n=Qv(kn());break;case"Worker":n=`${Qv(kn())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${ea}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jA{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=i=>new Promise((o,l)=>{try{const c=e(i);o(c)}catch(c){l(c)}});r.onAbort=n,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const s of n)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $A(t,e={}){return oi(t,"GET","/v2/passwordPolicy",ii(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FA=6;class UA{constructor(e){var r;const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??FA,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((r=e.allowedNonAlphanumericCharacters)==null?void 0:r.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),s&&(n.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BA{constructor(e,n,r,s){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Jv(this),this.idTokenSubscription=new Jv(this),this.beforeStateQueue=new jA(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=CE,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=Zr(n)),this._initializationPromise=this.queue(async()=>{var r,s,i;if(!this._deleted&&(this.persistenceManager=await Ro.create(this,e),(r=this._resolvePersistenceManagerAvailable)==null||r.call(this),!this._deleted)){if((s=this._popupRedirectResolver)!=null&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((i=this.currentUser)==null?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await hu(this,{idToken:e}),r=await yr._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(er(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(l,l))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(i=this.redirectUser)==null?void 0:i._redirectEventId,l=r==null?void 0:r._redirectEventId,c=await this.tryRedirectSignIn(e);(!o||o===l)&&(c!=null&&c.user)&&(r=c.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Ue(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await Ml(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=_A()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(er(this.app))return Promise.reject(ns(this));const n=e?Jt(e):null;return n&&Ue(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&Ue(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return er(this.app)?Promise.reject(ns(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return er(this.app)?Promise.reject(ns(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Zr(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await $A(this),n=new UA(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Hl("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await DA(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&Zr(e)||this._popupRedirectResolver;Ue(n,this,"argument-error"),this.redirectPersistenceManager=await Ro.create(this,[Zr(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)==null?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)==null?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((n=this.currentUser)==null?void 0:n.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,s){if(this._deleted)return()=>{};const i=typeof n=="function"?n:n.next.bind(n);let o=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ue(l,this,"internal-error"),l.then(()=>{o||i(this.currentUser)}),typeof n=="function"){const c=e.addObserver(n,r,s);return()=>{o=!0,c()}}else{const c=e.addObserver(n);return()=>{o=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ue(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=zE(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var s;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await((s=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getHeartbeatsHeader());n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var n;if(er(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((n=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:n.getToken());return e!=null&&e.error&&mA(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function Ui(t){return Jt(t)}class Jv{constructor(e){this.auth=e,this.observer=null,this.addObserver=N2(n=>this.observer=n)}get next(){return Ue(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let qu={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function zA(t){qu=t}function HE(t){return qu.loadJS(t)}function HA(){return qu.recaptchaEnterpriseScript}function WA(){return qu.gapiScript}function GA(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class VA{constructor(){this.enterprise=new YA}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class YA{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const KA="recaptcha-enterprise",WE="NO_RECAPTCHA";class XA{constructor(e){this.type=KA,this.auth=Ui(e)}async verify(e="verify",n=!1){async function r(i){if(!n){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,l)=>{wA(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const d=new TA(c);return i.tenantId==null?i._agentRecaptchaConfig=d:i._tenantRecaptchaConfigs[i.tenantId]=d,o(d.siteKey)}}).catch(c=>{l(c)})})}function s(i,o,l){const c=window.grecaptcha;Vv(c)?c.enterprise.ready(()=>{c.enterprise.execute(i,{action:e}).then(d=>{o(d)}).catch(()=>{o(WE)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new VA().execute("siteKey",{action:"verify"}):new Promise((i,o)=>{r(this.auth).then(l=>{if(!n&&Vv(window.grecaptcha))s(l,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let c=HA();c.length!==0&&(c+=l),HE(c).then(()=>{s(l,i,o)}).catch(d=>{o(d)})}}).catch(l=>{o(l)})})}}async function qv(t,e,n,r=!1,s=!1){const i=new XA(t);let o;if(s)o=WE;else try{o=await i.verify(n)}catch{o=await i.verify(n,!0)}const l={...e};if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in l){const c=l.phoneEnrollmentInfo.phoneNumber,d=l.phoneEnrollmentInfo.recaptchaToken;Object.assign(l,{phoneEnrollmentInfo:{phoneNumber:c,recaptchaToken:d,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in l){const c=l.phoneSignInInfo.recaptchaToken;Object.assign(l,{phoneSignInInfo:{recaptchaToken:c,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return l}return r?Object.assign(l,{captchaResp:o}):Object.assign(l,{captchaResponse:o}),Object.assign(l,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(l,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),l}async function Zv(t,e,n,r,s){var i;if((i=t._getRecaptchaConfig())!=null&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await qv(t,e,n,n==="getOobCode");return r(t,o)}else return r(t,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await qv(t,e,n,n==="getOobCode");return r(t,l)}else return Promise.reject(o)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QA(t,e){const n=Zg(t,"auth");if(n.isInitialized()){const s=n.getImmediate(),i=n.getOptions();if(Ri(i,e??{}))return s;Er(s,"already-initialized")}return n.initialize({options:e})}function JA(t,e){const n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(Zr);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function qA(t,e,n){const r=Ui(t);Ue(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,i=GE(e),{host:o,port:l}=ZA(e),c=l===null?"":`:${l}`,d={url:`${i}//${o}${c}/`},u=Object.freeze({host:o,port:l,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){Ue(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),Ue(Ri(d,r.config.emulator)&&Ri(u,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=d,r.emulatorConfig=u,r.settings.appVerificationDisabledForTesting=!0,qo(o)?(ob(`${i}//${o}${c}`),ab("Auth",!0)):eP()}function GE(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function ZA(t){const e=GE(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:e_(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:e_(o)}}}function e_(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function eP(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $0{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return qr("not implemented")}_getIdTokenResponse(e){return qr("not implemented")}_linkToIdToken(e,n){return qr("not implemented")}_getReauthenticationResolver(e){return qr("not implemented")}}async function tP(t,e){return oi(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nP(t,e){return ql(t,"POST","/v1/accounts:signInWithPassword",ii(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rP(t,e){return ql(t,"POST","/v1/accounts:signInWithEmailLink",ii(t,e))}async function sP(t,e){return ql(t,"POST","/v1/accounts:signInWithEmailLink",ii(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nl extends $0{constructor(e,n,r,s=null){super("password",r),this._email=e,this._password=n,this._tenantId=s}static _fromEmailAndPassword(e,n){return new Nl(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new Nl(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Zv(e,n,"signInWithPassword",nP);case"emailLink":return rP(e,{email:this._email,oobCode:this._password});default:Er(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Zv(e,r,"signUpPassword",tP);case"emailLink":return sP(e,{idToken:n,email:this._email,oobCode:this._password});default:Er(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ao(t,e){return ql(t,"POST","/v1/accounts:signInWithIdp",ii(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iP="http://localhost";class Di extends $0{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Di(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):Er("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=n;if(!r||!s)return null;const o=new Di(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const n=this.buildRequest();return Ao(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,Ao(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,Ao(e,n)}buildRequest(){const e={requestUri:iP,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=Zo(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oP(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function aP(t){const e=$a(Fa(t)).link,n=e?$a(Fa(e)).deep_link_id:null,r=$a(Fa(t)).deep_link_id;return(r?$a(Fa(r)).link:null)||r||n||e||t}class F0{constructor(e){const n=$a(Fa(e)),r=n.apiKey??null,s=n.oobCode??null,i=oP(n.mode??null);Ue(r&&s&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=s,this.continueUrl=n.continueUrl??null,this.languageCode=n.lang??null,this.tenantId=n.tenantId??null}static parseLink(e){const n=aP(e);try{return new F0(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bi{constructor(){this.providerId=Bi.PROVIDER_ID}static credential(e,n){return Nl._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=F0.parseLink(n);return Ue(r,"argument-error"),Nl._fromEmailAndCode(e,r.code,r.tenantId)}}Bi.PROVIDER_ID="password";Bi.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Bi.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VE{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zl extends VE{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ts extends Zl{constructor(){super("facebook.com")}static credential(e){return Di._fromParams({providerId:Ts.PROVIDER_ID,signInMethod:Ts.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ts.credentialFromTaggedObject(e)}static credentialFromError(e){return Ts.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ts.credential(e.oauthAccessToken)}catch{return null}}}Ts.FACEBOOK_SIGN_IN_METHOD="facebook.com";Ts.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ws extends Zl{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Di._fromParams({providerId:ws.PROVIDER_ID,signInMethod:ws.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return ws.credentialFromTaggedObject(e)}static credentialFromError(e){return ws.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return ws.credential(n,r)}catch{return null}}}ws.GOOGLE_SIGN_IN_METHOD="google.com";ws.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cs extends Zl{constructor(){super("github.com")}static credential(e){return Di._fromParams({providerId:Cs.PROVIDER_ID,signInMethod:Cs.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Cs.credentialFromTaggedObject(e)}static credentialFromError(e){return Cs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Cs.credential(e.oauthAccessToken)}catch{return null}}}Cs.GITHUB_SIGN_IN_METHOD="github.com";Cs.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ks extends Zl{constructor(){super("twitter.com")}static credential(e,n){return Di._fromParams({providerId:ks.PROVIDER_ID,signInMethod:ks.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return ks.credentialFromTaggedObject(e)}static credentialFromError(e){return ks.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return ks.credential(n,r)}catch{return null}}}ks.TWITTER_SIGN_IN_METHOD="twitter.com";ks.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lP(t,e){return ql(t,"POST","/v1/accounts:signUp",ii(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ei{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,s=!1){const i=await yr._fromIdTokenResponse(e,r,s),o=t_(r);return new ei({user:i,providerId:o,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const s=t_(r);return new ei({user:e,providerId:s,_tokenResponse:r,operationType:n})}}function t_(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cP(t){var s;if(er(t.app))return Promise.reject(ns(t));const e=Ui(t);if(await e._initializationPromise,(s=e.currentUser)!=null&&s.isAnonymous)return new ei({user:e.currentUser,providerId:null,operationType:"signIn"});const n=await lP(e,{returnSecureToken:!0}),r=await ei._fromIdTokenResponse(e,"signIn",n,!0);return await e._updateCurrentUser(r.user),r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pu extends si{constructor(e,n,r,s){super(n.code,n.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,pu.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,s){return new pu(e,n,r,s)}}function YE(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?pu._fromErrorAndOperation(t,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dP(t){return new Set(t.map(({providerId:e})=>e).filter(e=>!!e))}async function KE(t,e,n=!1){const r=await Dl(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return ei._forOperation(t,"link",r)}async function uP(t,e,n){await Ml(e);const r=dP(e.providerData);Ue(r.has(n)===t,e.auth,"provider-already-linked")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fP(t,e,n=!1){const{auth:r}=t;if(er(r.app))return Promise.reject(ns(r));const s="reauthenticate";try{const i=await Dl(t,YE(r,s,e,t),n);Ue(i.idToken,r,"internal-error");const o=N0(i.idToken);Ue(o,r,"internal-error");const{sub:l}=o;return Ue(t.uid===l,r,"user-mismatch"),ei._forOperation(t,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Er(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function XE(t,e,n=!1){if(er(t.app))return Promise.reject(ns(t));const r="signIn",s=await YE(t,r,e),i=await ei._fromIdTokenResponse(t,r,s);return n||await t._updateCurrentUser(i.user),i}async function hP(t,e){return XE(Ui(t),e)}async function pP(t,e){const n=Jt(t);return await uP(!1,n,e.providerId),KE(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gP(t){const e=Ui(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}function mP(t,e,n){return er(t.app)?Promise.reject(ns(t)):hP(Jt(t),Bi.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&gP(t),r})}function yP(t,e,n,r){return Jt(t).onIdTokenChanged(e,n,r)}function vP(t,e,n){return Jt(t).beforeAuthStateChanged(e,n)}function _P(t,e,n,r){return Jt(t).onAuthStateChanged(e,n,r)}function xP(t){return Jt(t).signOut()}const gu="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QE{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(gu,"1"),this.storage.removeItem(gu),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bP=1e3,EP=10;class JE extends QE{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=BE(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),s=this.localCache[n];r!==s&&e(n,s,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((o,l,c)=>{this.notifyListeners(o,c)});return}const r=e.key;n?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!n&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);NA()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,EP):s()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},bP)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}JE.type="LOCAL";const SP=JE;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qE extends QE{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}qE.type="SESSION";const ZE=qE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IP(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zu{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(s=>s.isListeningto(e));if(n)return n;const r=new Zu(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:s,data:i}=n.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const l=Array.from(o).map(async d=>d(n.origin,i)),c=await IP(l);n.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:c})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Zu.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function U0(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TP{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((l,c)=>{const d=U0("",20);s.port1.start();const u=setTimeout(()=>{c(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(h){const f=h;if(f.data.eventId===d)switch(f.data.status){case"ack":clearTimeout(u),i=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),l(f.data.response);break;default:clearTimeout(u),clearTimeout(i),c(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:d,data:n},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fr(){return window}function wP(t){Fr().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eS(){return typeof Fr().WorkerGlobalScope<"u"&&typeof Fr().importScripts=="function"}async function CP(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function kP(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)==null?void 0:t.controller)||null}function RP(){return eS()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tS="firebaseLocalStorageDb",AP=1,mu="firebaseLocalStorage",nS="fbase_key";class ec{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function ef(t,e){return t.transaction([mu],e?"readwrite":"readonly").objectStore(mu)}function PP(){const t=indexedDB.deleteDatabase(tS);return new ec(t).toPromise()}function Up(){const t=indexedDB.open(tS,AP);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(mu,{keyPath:nS})}catch(s){n(s)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(mu)?e(r):(r.close(),await PP(),e(await Up()))})})}async function n_(t,e,n){const r=ef(t,!0).put({[nS]:e,value:n});return new ec(r).toPromise()}async function OP(t,e){const n=ef(t,!1).get(e),r=await new ec(n).toPromise();return r===void 0?null:r.value}function r_(t,e){const n=ef(t,!0).delete(e);return new ec(n).toPromise()}const LP=800,DP=3;class rS{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Up(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>DP)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return eS()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Zu._getInstance(RP()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var n,r;if(this.activeServiceWorker=await CP(),!this.activeServiceWorker)return;this.sender=new TP(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(n=e[0])!=null&&n.fulfilled&&(r=e[0])!=null&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||kP()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Up();return await n_(e,gu,"1"),await r_(e,gu),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>n_(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>OP(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>r_(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=ef(s,!1).getAll();return new ec(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),n.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),n.push(s));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),LP)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}rS.type="LOCAL";const MP=rS;new Jl(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NP(t,e){return e?Zr(e):(Ue(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B0 extends $0{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ao(e,this._buildIdpRequest())}_linkToIdToken(e,n){return Ao(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return Ao(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function jP(t){return XE(t.auth,new B0(t),t.bypassAuthState)}function $P(t){const{auth:e,user:n}=t;return Ue(n,e,"internal-error"),fP(n,new B0(t),t.bypassAuthState)}async function FP(t){const{auth:e,user:n}=t;return Ue(n,e,"internal-error"),KE(n,new B0(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sS{constructor(e,n,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:s,tenantId:i,error:o,type:l}=e;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:n,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(c))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return jP;case"linkViaPopup":case"linkViaRedirect":return FP;case"reauthViaPopup":case"reauthViaRedirect":return $P;default:Er(this.auth,"internal-error")}}resolve(e){cs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){cs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UP=new Jl(2e3,1e4);class _o extends sS{constructor(e,n,r,s,i){super(e,n,s,i),this.provider=r,this.authWindow=null,this.pollId=null,_o.currentPopupAction&&_o.currentPopupAction.cancel(),_o.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ue(e,this.auth,"internal-error"),e}async onExecution(){cs(this.filter.length===1,"Popup operations only handle one event");const e=U0();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject($r(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject($r(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,_o.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if((r=(n=this.authWindow)==null?void 0:n.window)!=null&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject($r(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,UP.get())};e()}}_o.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BP="pendingRedirect",hd=new Map;class zP extends sS{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=hd.get(this.auth._key());if(!e){try{const r=await HP(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}hd.set(this.auth._key(),e)}return this.bypassAuthState||hd.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function HP(t,e){const n=VP(e),r=GP(t);if(!await r._isAvailable())return!1;const s=await r._get(n)==="true";return await r._remove(n),s}function WP(t,e){hd.set(t._key(),e)}function GP(t){return Zr(t._redirectPersistence)}function VP(t){return fd(BP,t.config.apiKey,t.name)}async function YP(t,e,n=!1){if(er(t.app))return Promise.reject(ns(t));const r=Ui(t),s=NP(r,e),o=await new zP(r,s,n).execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KP=10*60*1e3;class XP{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!QP(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!iS(e)){const s=((r=e.error.code)==null?void 0:r.split("auth/")[1])||"internal-error";n.onError($r(this.auth,s))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=KP&&this.cachedEventUids.clear(),this.cachedEventUids.has(s_(e))}saveEventToCache(e){this.cachedEventUids.add(s_(e)),this.lastProcessedEventTime=Date.now()}}function s_(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function iS({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function QP(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return iS(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function JP(t,e={}){return oi(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qP=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,ZP=/^https?/;async function eO(t){if(t.config.emulator)return;const{authorizedDomains:e}=await JP(t);for(const n of e)try{if(tO(n))return}catch{}Er(t,"unauthorized-domain")}function tO(t){const e=$p(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const o=new URL(t);return o.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&o.hostname===r}if(!ZP.test(n))return!1;if(qP.test(t))return r===t;const s=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nO=new Jl(3e4,6e4);function i_(){const t=Fr().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function rO(t){return new Promise((e,n)=>{var s,i,o;function r(){i_(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{i_(),n($r(t,"network-request-failed"))},timeout:nO.get()})}if((i=(s=Fr().gapi)==null?void 0:s.iframes)!=null&&i.Iframe)e(gapi.iframes.getContext());else if((o=Fr().gapi)!=null&&o.load)r();else{const l=GA("iframefcb");return Fr()[l]=()=>{gapi.load?r():n($r(t,"network-request-failed"))},HE(`${WA()}?onload=${l}`).catch(c=>n(c))}}).catch(e=>{throw pd=null,e})}let pd=null;function sO(t){return pd=pd||rO(t),pd}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iO=new Jl(5e3,15e3),oO="__/auth/iframe",aO="emulator/auth/iframe",lO={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},cO=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function dO(t){const e=t.config;Ue(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?M0(e,aO):`https://${t.config.authDomain}/${oO}`,r={apiKey:e.apiKey,appName:t.name,v:ea},s=cO.get(t.config.apiHost);s&&(r.eid=s);const i=t._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${Zo(r).slice(1)}`}async function uO(t){const e=await sO(t),n=Fr().gapi;return Ue(n,t,"internal-error"),e.open({where:document.body,url:dO(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:lO,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=$r(t,"network-request-failed"),l=Fr().setTimeout(()=>{i(o)},iO.get());function c(){Fr().clearTimeout(l),s(r)}r.ping(c).then(c,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fO={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},hO=500,pO=600,gO="_blank",mO="http://localhost";class o_{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function yO(t,e,n,r=hO,s=pO){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const c={...fO,width:r.toString(),height:s.toString(),top:i,left:o},d=kn().toLowerCase();n&&(l=NE(d)?gO:n),DE(d)&&(e=e||mO,c.scrollbars="yes");const u=Object.entries(c).reduce((f,[x,k])=>`${f}${x}=${k},`,"");if(MA(d)&&l!=="_self")return vO(e||"",l),new o_(null);const h=window.open(e||"",l,u);Ue(h,t,"popup-blocked");try{h.focus()}catch{}return new o_(h)}function vO(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _O="__/auth/handler",xO="emulator/auth/handler",bO=encodeURIComponent("fac");async function a_(t,e,n,r,s,i){Ue(t.config.authDomain,t,"auth-domain-config-required"),Ue(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:ea,eventId:s};if(e instanceof VE){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",Xd(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[u,h]of Object.entries({}))o[u]=h}if(e instanceof Zl){const u=e.getScopes().filter(h=>h!=="");u.length>0&&(o.scopes=u.join(","))}t.tenantId&&(o.tid=t.tenantId);const l=o;for(const u of Object.keys(l))l[u]===void 0&&delete l[u];const c=await t._getAppCheckToken(),d=c?`#${bO}=${encodeURIComponent(c)}`:"";return`${EO(t)}?${Zo(l).slice(1)}${d}`}function EO({config:t}){return t.emulator?M0(t,xO):`https://${t.authDomain}/${_O}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sh="webStorageSupport";class SO{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=ZE,this._completeRedirectFn=YP,this._overrideRedirectResult=WP}async _openPopup(e,n,r,s){var o;cs((o=this.eventManagers[e._key()])==null?void 0:o.manager,"_initialize() not called before _openPopup()");const i=await a_(e,n,r,$p(),s);return yO(e,i,U0())}async _openRedirect(e,n,r,s){await this._originValidation(e);const i=await a_(e,n,r,$p(),s);return wP(i),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:s,promise:i}=this.eventManagers[n];return s?Promise.resolve(s):(cs(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await uO(e),r=new XP(e);return n.register("authEvent",s=>(Ue(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(Sh,{type:Sh},s=>{var o;const i=(o=s==null?void 0:s[0])==null?void 0:o[Sh];i!==void 0&&n(!!i),Er(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=eO(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return BE()||ME()||j0()}}const IO=SO;var l_="@firebase/auth",c_="1.12.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TO{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){Ue(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wO(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function CO(t){Bo(new Ai("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:l}=r.options;Ue(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:o,authDomain:l,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:zE(t)},d=new BA(r,s,i,c);return JA(d,n),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),Bo(new Ai("auth-internal",e=>{const n=Ui(e.getProvider("auth").getImmediate());return(r=>new TO(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ws(l_,c_,wO(t)),Ws(l_,c_,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kO=5*60,RO=ib("authIdTokenMaxAge")||kO;let d_=null;const AO=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>RO)return;const s=n==null?void 0:n.token;d_!==s&&(d_=s,await fetch(t,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function PO(t=hb()){const e=Zg(t,"auth");if(e.isInitialized())return e.getImmediate();const n=QA(t,{popupRedirectResolver:IO,persistence:[MP,SP,ZE]}),r=ib("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=AO(i.toString());vP(n,o,()=>o(n.currentUser)),yP(n,l=>o(l))}}const s=rb("auth");return s&&qA(n,`http://${s}`),n}function OO(){var t;return((t=document.getElementsByTagName("head"))==null?void 0:t[0])??document}zA({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=s=>{const i=$r("internal-error");i.customData=s,n(i)},r.type="text/javascript",r.charset="UTF-8",OO().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});CO("Browser");const LO={apiKey:"AIzaSyCqXssa5oOaWY3CiN7ti53Qt1F_AGpBrVE",authDomain:"tenfubu-verse.firebaseapp.com",databaseURL:"https://tenfubu-verse-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"tenfubu-verse",storageBucket:"tenfubu-verse.firebasestorage.app",messagingSenderId:"1047996014362",appId:"1:1047996014362:web:729f6b715d929087e296a3"},oS=fb(LO),Dr=dA(oS),tc=PO(oS),z0=[{rank:"BRONZE",min:0,max:2e3,lossPoints:0},{rank:"SILVER",min:2001,max:4e3,lossPoints:20},{rank:"GOLD",min:4001,max:6e3,lossPoints:40},{rank:"PLATINUM",min:6001,max:8e3,lossPoints:60},{rank:"DIAMOND",min:8001,max:1e4,lossPoints:80},{rank:"MASTER",min:10001,max:1/0,lossPoints:100}],Po={BRONZE:"",SILVER:"",GOLD:"",PLATINUM:"",DIAMOND:"",MASTER:""},Mr=t=>{for(const e of z0)if(t>=e.min&&t<=e.max)return e.rank;return"BRONZE"},rl=t=>z0.findIndex(e=>e.rank===t),aS=()=>({rating:0,winStreak:0,totalMatches:0,wins:0,losses:0}),Yc=200,u_=100,DO=10,MO=20,NO=(t,e,n)=>{const r=Mr(t),s=Mr(n),i=rl(r),o=rl(s),l=e+1,c=Math.min((l-1)*DO,u_),d=Math.max(0,o-i),u=Math.min(d*MO,u_),h=100+c+u,f=Math.floor(Yc*h/100),x=t+f,k=Mr(x),T=rl(k);return{newRating:x,ratingChange:f,newWinStreak:l,newRank:k,oldRank:r,isRankUp:T>i,isRankDown:!1,bonusBreakdown:{base:Yc,winStreakBonus:Math.floor(Yc*c/100),rankDiffBonus:Math.floor(Yc*u/100),total:f}}},jO=t=>{const e=Mr(t),r=-z0.find(c=>c.rank===e).lossPoints,s=Math.max(0,t+r),i=Mr(s),o=rl(e),l=rl(i);return{newRating:s,ratingChange:r,newWinStreak:0,newRank:i,oldRank:e,isRankUp:!1,isRankDown:l<o,bonusBreakdown:{base:r,winStreakBonus:0,rankDiffBonus:0,total:r}}},f_=async(t,e,n)=>{const r=Lr(Dr,`players/${t}`),s=await Qu(r);if(s.exists()){const o=s.val();return o.userId||(await L0(r,{userId:e}),o.userId=e),o}const i={userId:e,playerName:n||"",createdAt:Date.now(),lastMatchAt:Date.now(),ratings:{}};return await Xu(r,i),i},lS=async(t,e)=>{const n=Lr(Dr,`players/${t}/ratings/${e}`),r=await Qu(n);if(r.exists())return r.val();const s=aS();return await Xu(n,s),s},$O=async t=>{const e=Lr(Dr,`players/${t}/ratings`),n=await Qu(e);return n.exists()?n.val():{}},FO=async(t,e,n,r)=>{const s=Lr(Dr,`players/${t}/ratings/${e}`),i=Lr(Dr,`players/${t}`);await pA(s,o=>{const l=o||aS();return{rating:n.newRating,winStreak:n.newWinStreak,totalMatches:l.totalMatches+1,wins:l.wins+(r?1:0),losses:l.losses+(r?0:1)}}),await L0(i,{lastMatchAt:Date.now()})},UO=async(t,e)=>{const n=Lr(Dr,`players/${t}`);await L0(n,{playerName:e})},H0=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},BO=H0("/leaders/azya_leader.png"),zO=H0("/leaders/senka_leader.png"),HO=H0("/leaders/yoRuka_leader.png"),WO=1280,GO=720,VO={BRONZE:"#cd7f32",SILVER:"#c0c0c0",GOLD:"#ffd700",PLATINUM:"#e5e4e2",DIAMOND:"#b9f2ff",MASTER:"#ff4500"},YO=({onSelectClass:t,onBack:e,gameMode:n="CPU",aiDifficulty:r="NORMAL",onDifficultyChange:s,playerName:i,onPlayerNameChange:o,timerEnabled:l=!0,onTimerEnabledChange:c,playerId:d})=>{const[u,h]=O.useState(1),[f,x]=O.useState({}),[k,T]=O.useState(!1);O.useEffect(()=>{const q=()=>{const de=window.innerWidth/WO,ve=window.innerHeight/GO;h(Math.min(de,ve))};return q(),window.addEventListener("resize",q),()=>window.removeEventListener("resize",q)},[]),O.useEffect(()=>{(async()=>{if(!d){T(!1);return}T(!0);try{const de=await $O(d);x(de)}catch(de){console.error("Failed to fetch class ratings:",de)}finally{T(!1)}})()},[d]);const j=200*u,b=280*u,v=2*u,S=1.4*u,p=.75*u,F=.65*u,H=1.2*u,z=`${8*u}px ${16*u}px`,W=q=>{if(n!=="RANKED_MATCH"||!d||k)return null;const de=f[q];if(!de)return null;const ve=Mr(de.rating),Ne=Po[ve],ue=VO[ve];return a.jsxs("div",{style:{marginTop:`${4*u}px`,padding:`${4*u}px ${8*u}px`,background:"rgba(0, 0, 0, 0.3)",borderRadius:4*u,display:"flex",alignItems:"center",gap:`${6*u}px`},children:[a.jsx("span",{style:{fontSize:`${.7*u}rem`,fontWeight:"bold",color:ue,fontFamily:"Tamanegi, sans-serif"},children:Ne}),a.jsx("span",{style:{fontSize:`${.75*u}rem`,color:"#fff",fontFamily:"Tamanegi, sans-serif"},children:de.rating})]})};return a.jsxs("div",{className:"screen",style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"#1a1a2e",color:"white"},children:[a.jsx("h2",{style:{fontSize:`${v}rem`,marginBottom:`${.5*u}rem`,marginTop:0},children:""}),a.jsxs("div",{style:{marginBottom:`${.8*u}rem`,display:"flex",flexDirection:"column",alignItems:"center",gap:`${.3*u}rem`},children:[a.jsx("label",{style:{fontSize:`${.9*u}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif"},children:""}),a.jsx("input",{type:"text",value:i,onChange:q=>o(q.target.value),maxLength:12,placeholder:"",style:{padding:`${6*u}px ${12*u}px`,fontSize:`${.9*u}rem`,background:"#2d3748",border:"2px solid #4a5568",borderRadius:6*u,color:"white",outline:"none",width:180*u,textAlign:"center",fontFamily:"Tamanegi, sans-serif"},onFocus:q=>q.target.style.borderColor="#63b3ed",onBlur:q=>q.target.style.borderColor="#4a5568"})]}),a.jsxs("div",{style:{display:"flex",gap:`${H}rem`,marginBottom:`${1*u}rem`},children:[a.jsxs("div",{onClick:()=>t("SENKA"),style:{width:j,height:b,border:"1px solid #444",borderRadius:10*u,background:"linear-gradient(180deg, #2c0b0e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s",boxShadow:"0 4px 20px rgba(233, 69, 96, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:q=>q.currentTarget.style.transform="scale(1.05)",onMouseOut:q=>q.currentTarget.style.transform="scale(1)",children:[a.jsx("img",{src:zO,alt:"Senka",style:{width:"100%",height:"60%",objectFit:"cover"}}),a.jsxs("div",{style:{padding:`${6*u}px`,display:"flex",flexDirection:"column",alignItems:"center"},children:[a.jsx("h3",{style:{fontSize:`${S}rem`,color:"#e94560",margin:0},children:""}),a.jsx("p",{style:{color:"#aaa",margin:`${3*u}px 0`,fontSize:`${p}rem`,fontFamily:"Tamanegi, sans-serif"},children:" / "}),a.jsxs("p",{style:{padding:`0 ${.5*u}rem`,textAlign:"center",fontSize:`${F}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",lineHeight:1.3},children:["",a.jsx("br",{}),""]}),W("SENKA")]})]}),a.jsxs("div",{onClick:()=>t("AJA"),style:{width:j,height:b,border:"1px solid #444",borderRadius:10*u,background:"linear-gradient(180deg, #0f1c2e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s",boxShadow:"0 4px 20px rgba(69, 162, 233, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:q=>q.currentTarget.style.transform="scale(1.05)",onMouseOut:q=>q.currentTarget.style.transform="scale(1)",children:[a.jsx("img",{src:BO,alt:"Azya",style:{width:"100%",height:"60%",objectFit:"cover",objectPosition:"center top"}}),a.jsxs("div",{style:{padding:`${6*u}px`,display:"flex",flexDirection:"column",alignItems:"center"},children:[a.jsx("h3",{style:{fontSize:`${S}rem`,color:"#45a2e9",margin:0},children:""}),a.jsx("p",{style:{color:"#aaa",margin:`${3*u}px 0`,fontSize:`${p}rem`,fontFamily:"Tamanegi, sans-serif"},children:" / "}),a.jsxs("p",{style:{padding:`${.5*u}rem`,textAlign:"center",fontSize:`${F}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",lineHeight:1.3},children:["",a.jsx("br",{}),""]}),W("AJA")]})]}),a.jsxs("div",{onClick:()=>t("YORUKA"),style:{width:j,height:b,border:"1px solid #444",borderRadius:10*u,background:"linear-gradient(180deg, #1a0f2e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s",boxShadow:"0 4px 20px rgba(168, 85, 247, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:q=>q.currentTarget.style.transform="scale(1.05)",onMouseOut:q=>q.currentTarget.style.transform="scale(1)",children:[a.jsx("img",{src:HO,alt:"Yoruka",style:{width:"100%",height:"60%",objectFit:"cover"}}),a.jsxs("div",{style:{padding:`${6*u}px`,display:"flex",flexDirection:"column",alignItems:"center"},children:[a.jsx("h3",{style:{fontSize:`${S}rem`,color:"#a855f7",margin:0},children:"Y"}),a.jsx("p",{style:{color:"#aaa",margin:`${3*u}px 0`,fontSize:`${p}rem`,fontFamily:"Tamanegi, sans-serif"},children:" / "}),a.jsxs("p",{style:{padding:`0 ${.5*u}rem`,textAlign:"center",fontSize:`${F}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",lineHeight:1.3},children:["",a.jsx("br",{}),""]}),W("YORUKA")]})]})]}),n==="CPU"&&s&&a.jsxs("div",{style:{marginBottom:`${.6*u}rem`,display:"flex",flexDirection:"column",alignItems:"center",gap:`${.3*u}rem`},children:[a.jsx("p",{style:{fontSize:`${.85*u}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",margin:0},children:""}),a.jsx("div",{style:{display:"flex",gap:`${.6*u}rem`},children:["EASY","NORMAL","HARD"].map(q=>a.jsx("button",{onClick:()=>s(q),style:{padding:`${6*u}px ${14*u}px`,fontSize:`${.8*u}rem`,background:r===q?q==="EASY"?"#48bb78":q==="NORMAL"?"#e94560":"#9f7aea":"transparent",border:`2px solid ${q==="EASY"?"#48bb78":q==="NORMAL"?"#e94560":"#9f7aea"}`,color:"#fff",cursor:"pointer",borderRadius:4*u,fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s"},children:q==="EASY"?"":q==="NORMAL"?"":""},q))}),a.jsxs("p",{style:{fontSize:`${.65*u}rem`,opacity:.6,fontFamily:"Tamanegi, sans-serif",margin:0},children:[r==="EASY"&&"CPU",r==="NORMAL"&&"CPU",r==="HARD"&&"CPU"]})]}),c&&a.jsxs("div",{style:{marginBottom:`${.6*u}rem`,display:"flex",flexDirection:"column",alignItems:"center",gap:`${.3*u}rem`},children:[a.jsx("p",{style:{fontSize:`${.85*u}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",margin:0},children:""}),a.jsxs("div",{style:{display:"flex",gap:`${.6*u}rem`},children:[a.jsx("button",{onClick:()=>c(!0),style:{padding:`${6*u}px ${14*u}px`,fontSize:`${.8*u}rem`,background:l?"#3182ce":"transparent",border:"2px solid #3182ce",color:"#fff",cursor:"pointer",borderRadius:4*u,fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s"},children:"ON (60)"}),a.jsx("button",{onClick:()=>c(!1),style:{padding:`${6*u}px ${14*u}px`,fontSize:`${.8*u}rem`,background:l?"transparent":"#718096",border:"2px solid #718096",color:"#fff",cursor:"pointer",borderRadius:4*u,fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s"},children:"OFF"})]}),a.jsx("p",{style:{fontSize:`${.65*u}rem`,opacity:.6,fontFamily:"Tamanegi, sans-serif",margin:0},children:l?"600":""})]}),a.jsx("button",{onClick:e,style:{background:"#333",padding:z,fontSize:`${.9*u}rem`,marginBottom:`${.5*u}rem`},children:""})]})};class KO{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(e){this.flush(),this._parts.push(e)}append(e){this._pieces.push(e)}flush(){if(this._pieces.length>0){const e=new Uint8Array(this._pieces);this._parts.push(e),this._pieces=[]}}toArrayBuffer(){const e=[];for(const n of this._parts)e.push(n);return XO(e).buffer}}function XO(t){let e=0;for(const s of t)e+=s.byteLength;const n=new Uint8Array(e);let r=0;for(const s of t){const i=new Uint8Array(s.buffer,s.byteOffset,s.byteLength);n.set(i,r),r+=s.byteLength}return n}function cS(t){return new QO(t).unpack()}function dS(t){const e=new JO,n=e.pack(t);return n instanceof Promise?n.then(()=>e.getBuffer()):e.getBuffer()}class QO{constructor(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){const e=this.unpack_uint8();if(e<128)return e;if((e^224)<32)return(e^224)-32;let n;if((n=e^160)<=15)return this.unpack_raw(n);if((n=e^176)<=15)return this.unpack_string(n);if((n=e^144)<=15)return this.unpack_array(n);if((n=e^128)<=15)return this.unpack_map(n);switch(e){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return n=this.unpack_uint16(),this.unpack_string(n);case 217:return n=this.unpack_uint32(),this.unpack_string(n);case 218:return n=this.unpack_uint16(),this.unpack_raw(n);case 219:return n=this.unpack_uint32(),this.unpack_raw(n);case 220:return n=this.unpack_uint16(),this.unpack_array(n);case 221:return n=this.unpack_uint32(),this.unpack_array(n);case 222:return n=this.unpack_uint16(),this.unpack_map(n);case 223:return n=this.unpack_uint32(),this.unpack_map(n)}}unpack_uint8(){const e=this.dataView[this.index]&255;return this.index++,e}unpack_uint16(){const e=this.read(2),n=(e[0]&255)*256+(e[1]&255);return this.index+=2,n}unpack_uint32(){const e=this.read(4),n=((e[0]*256+e[1])*256+e[2])*256+e[3];return this.index+=4,n}unpack_uint64(){const e=this.read(8),n=((((((e[0]*256+e[1])*256+e[2])*256+e[3])*256+e[4])*256+e[5])*256+e[6])*256+e[7];return this.index+=8,n}unpack_int8(){const e=this.unpack_uint8();return e<128?e:e-256}unpack_int16(){const e=this.unpack_uint16();return e<32768?e:e-65536}unpack_int32(){const e=this.unpack_uint32();return e<2**31?e:e-2**32}unpack_int64(){const e=this.unpack_uint64();return e<2**63?e:e-2**64}unpack_raw(e){if(this.length<this.index+e)throw new Error(`BinaryPackFailure: index is out of range ${this.index} ${e} ${this.length}`);const n=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,n}unpack_string(e){const n=this.read(e);let r=0,s="",i,o;for(;r<e;)i=n[r],i<160?(o=i,r++):(i^192)<32?(o=(i&31)<<6|n[r+1]&63,r+=2):(i^224)<16?(o=(i&15)<<12|(n[r+1]&63)<<6|n[r+2]&63,r+=3):(o=(i&7)<<18|(n[r+1]&63)<<12|(n[r+2]&63)<<6|n[r+3]&63,r+=4),s+=String.fromCodePoint(o);return this.index+=e,s}unpack_array(e){const n=new Array(e);for(let r=0;r<e;r++)n[r]=this.unpack();return n}unpack_map(e){const n={};for(let r=0;r<e;r++){const s=this.unpack();n[s]=this.unpack()}return n}unpack_float(){const e=this.unpack_uint32(),n=e>>31,r=(e>>23&255)-127,s=e&8388607|8388608;return(n===0?1:-1)*s*2**(r-23)}unpack_double(){const e=this.unpack_uint32(),n=this.unpack_uint32(),r=e>>31,s=(e>>20&2047)-1023,o=(e&1048575|1048576)*2**(s-20)+n*2**(s-52);return(r===0?1:-1)*o}read(e){const n=this.index;if(n+e<=this.length)return this.dataView.subarray(n,n+e);throw new Error("BinaryPackFailure: read index out of range")}}class JO{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(e){if(typeof e=="string")this.pack_string(e);else if(typeof e=="number")Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if(typeof e=="boolean")e===!0?this._bufferBuilder.append(195):e===!1&&this._bufferBuilder.append(194);else if(e===void 0)this._bufferBuilder.append(192);else if(typeof e=="object")if(e===null)this._bufferBuilder.append(192);else{const n=e.constructor;if(e instanceof Array){const r=this.pack_array(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else if(e instanceof ArrayBuffer)this.pack_bin(new Uint8Array(e));else if("BYTES_PER_ELEMENT"in e){const r=e;this.pack_bin(new Uint8Array(r.buffer,r.byteOffset,r.byteLength))}else if(e instanceof Date)this.pack_string(e.toString());else{if(e instanceof Blob)return e.arrayBuffer().then(r=>{this.pack_bin(new Uint8Array(r)),this._bufferBuilder.flush()});if(n==Object||n.toString().startsWith("class")){const r=this.pack_object(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else throw new Error(`Type "${n.toString()}" not yet supported`)}}else throw new Error(`Type "${typeof e}" not yet supported`);this._bufferBuilder.flush()}pack_bin(e){const n=e.length;if(n<=15)this.pack_uint8(160+n);else if(n<=65535)this._bufferBuilder.append(218),this.pack_uint16(n);else if(n<=4294967295)this._bufferBuilder.append(219),this.pack_uint32(n);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(e)}pack_string(e){const n=this._textEncoder.encode(e),r=n.length;if(r<=15)this.pack_uint8(176+r);else if(r<=65535)this._bufferBuilder.append(216),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(217),this.pack_uint32(r);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(n)}pack_array(e){const n=e.length;if(n<=15)this.pack_uint8(144+n);else if(n<=65535)this._bufferBuilder.append(220),this.pack_uint16(n);else if(n<=4294967295)this._bufferBuilder.append(221),this.pack_uint32(n);else throw new Error("Invalid length");const r=s=>{if(s<n){const i=this.pack(e[s]);return i instanceof Promise?i.then(()=>r(s+1)):r(s+1)}};return r(0)}pack_integer(e){if(e>=-32&&e<=127)this._bufferBuilder.append(e&255);else if(e>=0&&e<=255)this._bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&e<=127)this._bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&e<=65535)this._bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&e<=32767)this._bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&e<=4294967295)this._bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-2147483648&&e<=2147483647)this._bufferBuilder.append(210),this.pack_int32(e);else if(e>=-9223372036854776e3&&e<=9223372036854776e3)this._bufferBuilder.append(211),this.pack_int64(e);else if(e>=0&&e<=18446744073709552e3)this._bufferBuilder.append(207),this.pack_uint64(e);else throw new Error("Invalid integer")}pack_double(e){let n=0;e<0&&(n=1,e=-e);const r=Math.floor(Math.log(e)/Math.LN2),s=e/2**r-1,i=Math.floor(s*2**52),o=2**32,l=n<<31|r+1023<<20|i/o&1048575,c=i%o;this._bufferBuilder.append(203),this.pack_int32(l),this.pack_int32(c)}pack_object(e){const n=Object.keys(e),r=n.length;if(r<=15)this.pack_uint8(128+r);else if(r<=65535)this._bufferBuilder.append(222),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(223),this.pack_uint32(r);else throw new Error("Invalid length");const s=i=>{if(i<n.length){const o=n[i];if(e.hasOwnProperty(o)){this.pack(o);const l=this.pack(e[o]);if(l instanceof Promise)return l.then(()=>s(i+1))}return s(i+1)}};return s(0)}pack_uint8(e){this._bufferBuilder.append(e)}pack_uint16(e){this._bufferBuilder.append(e>>8),this._bufferBuilder.append(e&255)}pack_uint32(e){const n=e&4294967295;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255)}pack_uint64(e){const n=e/4294967296,r=e%2**32;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}pack_int8(e){this._bufferBuilder.append(e&255)}pack_int16(e){this._bufferBuilder.append((e&65280)>>8),this._bufferBuilder.append(e&255)}pack_int32(e){this._bufferBuilder.append(e>>>24&255),this._bufferBuilder.append((e&16711680)>>>16),this._bufferBuilder.append((e&65280)>>>8),this._bufferBuilder.append(e&255)}pack_int64(e){const n=Math.floor(e/4294967296),r=e%2**32;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}constructor(){this._bufferBuilder=new KO,this._textEncoder=new TextEncoder}}let uS=!0,fS=!0;function Ua(t,e,n){const r=t.match(e);return r&&r.length>=n&&parseFloat(r[n],10)}function zi(t,e,n){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,s=r.addEventListener;r.addEventListener=function(o,l){if(o!==e)return s.apply(this,arguments);const c=d=>{const u=n(d);u&&(l.handleEvent?l.handleEvent(u):l(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(l,c),s.apply(this,[o,c])};const i=r.removeEventListener;r.removeEventListener=function(o,l){if(o!==e||!this._eventMap||!this._eventMap[e])return i.apply(this,arguments);if(!this._eventMap[e].has(l))return i.apply(this,arguments);const c=this._eventMap[e].get(l);return this._eventMap[e].delete(l),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,i.apply(this,[o,c])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function qO(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(uS=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function ZO(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(fS=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function hS(){if(typeof window=="object"){if(uS)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function W0(t,e){fS&&console.warn(t+" is deprecated, please use "+e+" instead.")}function eL(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const r=n.userAgentData.brands.find(s=>s.brand==="Chromium");if(r)return{browser:"chrome",version:parseInt(r.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(Ua(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(Ua(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(Ua(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=Ua(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function h_(t){return Object.prototype.toString.call(t)==="[object Object]"}function pS(t){return h_(t)?Object.keys(t).reduce(function(e,n){const r=h_(t[n]),s=r?pS(t[n]):t[n],i=r&&!Object.keys(s).length;return s===void 0||i?e:Object.assign(e,{[n]:s})},{}):t}function Bp(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?Bp(t,t.get(e[r]),n):r.endsWith("Ids")&&e[r].forEach(s=>{Bp(t,t.get(s),n)})}))}function p_(t,e,n){const r=n?"outbound-rtp":"inbound-rtp",s=new Map;if(e===null)return s;const i=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&i.push(o)}),i.forEach(o=>{t.forEach(l=>{l.type===r&&l.trackId===o.id&&Bp(t,l,s)})}),s}const g_=hS;function gS(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const r=function(l){if(typeof l!="object"||l.mandatory||l.optional)return l;const c={};return Object.keys(l).forEach(d=>{if(d==="require"||d==="advanced"||d==="mediaSource")return;const u=typeof l[d]=="object"?l[d]:{ideal:l[d]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const h=function(f,x){return f?f+x.charAt(0).toUpperCase()+x.slice(1):x==="deviceId"?"sourceId":x};if(u.ideal!==void 0){c.optional=c.optional||[];let f={};typeof u.ideal=="number"?(f[h("min",d)]=u.ideal,c.optional.push(f),f={},f[h("max",d)]=u.ideal,c.optional.push(f)):(f[h("",d)]=u.ideal,c.optional.push(f))}u.exact!==void 0&&typeof u.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[h("",d)]=u.exact):["min","max"].forEach(f=>{u[f]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[h(f,d)]=u[f])})}),l.advanced&&(c.optional=(c.optional||[]).concat(l.advanced)),c},s=function(l,c){if(e.version>=61)return c(l);if(l=JSON.parse(JSON.stringify(l)),l&&typeof l.audio=="object"){const d=function(u,h,f){h in u&&!(f in u)&&(u[f]=u[h],delete u[h])};l=JSON.parse(JSON.stringify(l)),d(l.audio,"autoGainControl","googAutoGainControl"),d(l.audio,"noiseSuppression","googNoiseSuppression"),l.audio=r(l.audio)}if(l&&typeof l.video=="object"){let d=l.video.facingMode;d=d&&(typeof d=="object"?d:{ideal:d});const u=e.version<66;if(d&&(d.exact==="user"||d.exact==="environment"||d.ideal==="user"||d.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete l.video.facingMode;let h;if(d.exact==="environment"||d.ideal==="environment"?h=["back","rear"]:(d.exact==="user"||d.ideal==="user")&&(h=["front"]),h)return n.mediaDevices.enumerateDevices().then(f=>{f=f.filter(k=>k.kind==="videoinput");let x=f.find(k=>h.some(T=>k.label.toLowerCase().includes(T)));return!x&&f.length&&h.includes("back")&&(x=f[f.length-1]),x&&(l.video.deviceId=d.exact?{exact:x.deviceId}:{ideal:x.deviceId}),l.video=r(l.video),g_("chrome: "+JSON.stringify(l)),c(l)})}l.video=r(l.video)}return g_("chrome: "+JSON.stringify(l)),c(l)},i=function(l){return e.version>=64?l:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[l.name]||l.name,message:l.message,constraint:l.constraint||l.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(l,c,d){s(l,u=>{n.webkitGetUserMedia(u,c,h=>{d&&d(i(h))})})};if(n.getUserMedia=o.bind(n),n.mediaDevices.getUserMedia){const l=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return s(c,d=>l(d).then(u=>{if(d.audio&&!u.getAudioTracks().length||d.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(h=>{h.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(i(u))))}}}function mS(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function yS(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",s=>{let i;t.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(l=>l.track&&l.track.id===s.track.id):i={track:s.track};const o=new Event("track");o.track=s.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[r.stream],this.dispatchEvent(o)}),r.stream.getTracks().forEach(s=>{let i;t.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(l=>l.track&&l.track.id===s.id):i={track:s};const o=new Event("track");o.track=s,o.receiver=i,o.transceiver={receiver:i},o.streams=[r.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else zi(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function vS(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(s,i){return{track:i,get dtmf(){return this._dtmf===void 0&&(i.kind==="audio"?this._dtmf=s.createDTMFSender(i):this._dtmf=null),this._dtmf},_pc:s}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const s=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(l,c){let d=s.apply(this,arguments);return d||(d=e(this,l),this._senders.push(d)),d};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(l){i.apply(this,arguments);const c=this._senders.indexOf(l);c!==-1&&this._senders.splice(c,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],n.apply(this,[i]),i.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach(o=>{const l=this._senders.find(c=>c.track===o);l&&this._senders.splice(this._senders.indexOf(l),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function _S(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=n.apply(this,[]);return i.forEach(o=>o._pc=this),i});const r=t.RTCPeerConnection.prototype.addTrack;r&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=r.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){const i=this;return this._pc.getStats().then(o=>p_(o,i.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const s=n.apply(this,[]);return s.forEach(i=>i._pc=this),s}),zi(t,"track",r=>(r.receiver._pc=r.srcElement,r)),t.RTCRtpReceiver.prototype.getStats=function(){const s=this;return this._pc.getStats().then(i=>p_(i,s.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const r=arguments[0];let s,i,o;return this.getSenders().forEach(l=>{l.track===r&&(s?o=!0:s=l)}),this.getReceivers().forEach(l=>(l.track===r&&(i?o=!0:i=l),l.track===r)),o||s&&i?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function xS(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,l){if(!l)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[l.id]?this._shimmedLocalStreams[l.id].indexOf(c)===-1&&this._shimmedLocalStreams[l.id].push(c):this._shimmedLocalStreams[l.id]=[l,c],c};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(d=>{if(this.getSenders().find(h=>h.track===d))throw new DOMException("Track already exists.","InvalidAccessError")});const l=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(d=>l.indexOf(d)===-1);this._shimmedLocalStreams[o.id]=[o].concat(c)};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],r.apply(this,arguments)};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(l=>{const c=this._shimmedLocalStreams[l].indexOf(o);c!==-1&&this._shimmedLocalStreams[l].splice(c,1),this._shimmedLocalStreams[l].length===1&&delete this._shimmedLocalStreams[l]}),s.apply(this,arguments)}}function bS(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return xS(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const u=n.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(h=>this._reverseStreams[h.id])};const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(h=>{if(this.getSenders().find(x=>x.track===h))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const h=new t.MediaStream(u.getTracks());this._streams[u.id]=h,this._reverseStreams[h.id]=u,u=h}r.apply(this,[u])};const s=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},t.RTCPeerConnection.prototype.addTrack=function(u,h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const f=[].slice.call(arguments,1);if(f.length!==1||!f[0].getTracks().find(T=>T===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(T=>T.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const k=this._streams[h.id];if(k)k.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const T=new t.MediaStream([u]);this._streams[h.id]=T,this._reverseStreams[T.id]=h,this.addStream(T)}return this.getSenders().find(T=>T.track===u)};function i(d,u){let h=u.sdp;return Object.keys(d._reverseStreams||[]).forEach(f=>{const x=d._reverseStreams[f],k=d._streams[x.id];h=h.replace(new RegExp(k.id,"g"),x.id)}),new RTCSessionDescription({type:u.type,sdp:h})}function o(d,u){let h=u.sdp;return Object.keys(d._reverseStreams||[]).forEach(f=>{const x=d._reverseStreams[f],k=d._streams[x.id];h=h.replace(new RegExp(x.id,"g"),k.id)}),new RTCSessionDescription({type:u.type,sdp:h})}["createOffer","createAnswer"].forEach(function(d){const u=t.RTCPeerConnection.prototype[d],h={[d](){const f=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[k=>{const T=i(this,k);f[0].apply(null,[T])},k=>{f[1]&&f[1].apply(null,k)},arguments[2]]):u.apply(this,arguments).then(k=>i(this,k))}};t.RTCPeerConnection.prototype[d]=h[d]});const l=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?l.apply(this,arguments):(arguments[0]=o(this,arguments[0]),l.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const d=c.get.apply(this);return d.type===""?d:i(this,d)}}),t.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let f;Object.keys(this._streams).forEach(x=>{this._streams[x].getTracks().find(T=>u.track===T)&&(f=this._streams[x])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function zp(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=t.RTCPeerConnection.prototype[n],s={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=s[n]})}function ES(t,e){zi(t,"negotiationneeded",n=>{const r=n.target;if(!((e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return n})}const m_=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:ES,shimAddTrackRemoveTrack:bS,shimAddTrackRemoveTrackWithNative:xS,shimGetSendersWithDtmf:vS,shimGetUserMedia:gS,shimMediaStream:mS,shimOnTrack:yS,shimPeerConnection:zp,shimSenderReceiverGetStats:_S},Symbol.toStringTag,{value:"Module"}));function SS(t,e){const n=t&&t.navigator,r=t&&t.MediaStreamTrack;if(n.getUserMedia=function(s,i,o){W0("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(s).then(i,o)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const s=function(o,l,c){l in o&&!(c in o)&&(o[c]=o[l],delete o[l])},i=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),s(o.audio,"autoGainControl","mozAutoGainControl"),s(o.audio,"noiseSuppression","mozNoiseSuppression")),i(o)},r&&r.prototype.getSettings){const o=r.prototype.getSettings;r.prototype.getSettings=function(){const l=o.apply(this,arguments);return s(l,"mozAutoGainControl","autoGainControl"),s(l,"mozNoiseSuppression","noiseSuppression"),l}}if(r&&r.prototype.applyConstraints){const o=r.prototype.applyConstraints;r.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),s(l,"autoGainControl","mozAutoGainControl"),s(l,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[l])}}}}function tL(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,Promise.reject(s)}return r.video===!0?r.video={mediaSource:e}:r.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(r)})}function IS(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Hp(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const i=t.RTCPeerConnection.prototype[s],o={[s](){return arguments[0]=new(s==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[s]=o[s]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[i,o,l]=arguments;return r.apply(this,[i||null]).then(c=>{if(e.version<53&&!o)try{c.forEach(d=>{d.type=n[d.type]||d.type})}catch(d){if(d.name!=="TypeError")throw d;c.forEach((u,h)=>{c.set(h,Object.assign({},u,{type:n[u.type]||u.type}))})}return c}).then(o,l)}}function TS(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=e.apply(this,[]);return s.forEach(i=>i._pc=this),s});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=n.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function wS(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r}),zi(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function CS(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){W0("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&n.getTracks().includes(r.track)&&this.removeTrack(r)})})}function kS(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function RS(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const s=r.length>0;s&&r.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=e.apply(this,arguments);if(s){const{sender:o}=i,l=o.getParameters();(!("encodings"in l)||l.encodings.length===1&&Object.keys(l.encodings[0]).length===0)&&(l.encodings=r,o.sendEncodings=r,this.setParametersPromises.push(o.setParameters(l).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return i})}function AS(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const r=e.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function PS(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function OS(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}const y_=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:RS,shimCreateAnswer:OS,shimCreateOffer:PS,shimGetDisplayMedia:tL,shimGetParameters:AS,shimGetUserMedia:SS,shimOnTrack:IS,shimPeerConnection:Hp,shimRTCDataChannel:kS,shimReceiverGetStats:wS,shimRemoveStream:CS,shimSenderGetStats:TS},Symbol.toStringTag,{value:"Module"}));function LS(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(s=>e.call(this,s,r)),r.getVideoTracks().forEach(s=>e.call(this,s,r))},t.RTCPeerConnection.prototype.addTrack=function(r,...s){return s&&s.forEach(i=>{this._localStreams?this._localStreams.includes(i)||this._localStreams.push(i):this._localStreams=[i]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(n);if(r===-1)return;this._localStreams.splice(r,1);const s=n.getTracks();this.getSenders().forEach(i=>{s.includes(i.track)&&this.removeTrack(i)})})}}function DS(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(s=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(s))return;this._remoteStreams.push(s);const i=new Event("addstream");i.stream=s,this.dispatchEvent(i)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){s.streams.forEach(i=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(i)>=0)return;r._remoteStreams.push(i);const o=new Event("addstream");o.stream=i,r.dispatchEvent(o)})}),e.apply(r,arguments)}}}function MS(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,r=e.createAnswer,s=e.setLocalDescription,i=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(d,u){const h=arguments.length>=2?arguments[2]:arguments[0],f=n.apply(this,[h]);return u?(f.then(d,u),Promise.resolve()):f},e.createAnswer=function(d,u){const h=arguments.length>=2?arguments[2]:arguments[0],f=r.apply(this,[h]);return u?(f.then(d,u),Promise.resolve()):f};let l=function(c,d,u){const h=s.apply(this,[c]);return u?(h.then(d,u),Promise.resolve()):h};e.setLocalDescription=l,l=function(c,d,u){const h=i.apply(this,[c]);return u?(h.then(d,u),Promise.resolve()):h},e.setRemoteDescription=l,l=function(c,d,u){const h=o.apply(this,[c]);return u?(h.then(d,u),Promise.resolve()):h},e.addIceCandidate=l}function NS(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,r=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=s=>r(jS(s))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(r,s,i){e.mediaDevices.getUserMedia(r).then(s,i)}).bind(e))}function jS(t){return t&&t.video!==void 0?Object.assign({},t,{video:pS(t.video)}):t}function $S(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(r,s){if(r&&r.iceServers){const i=[];for(let o=0;o<r.iceServers.length;o++){let l=r.iceServers[o];l.urls===void 0&&l.url?(W0("RTCIceServer.url","RTCIceServer.urls"),l=JSON.parse(JSON.stringify(l)),l.urls=l.url,delete l.url,i.push(l)):i.push(r.iceServers[o])}r.iceServers=i}return new e(r,s)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function FS(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function US(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):r.offerToReceiveAudio===!0&&!s&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const i=this.getTransceivers().find(o=>o.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveVideo===!0&&!i&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function BS(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}const v_=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:BS,shimCallbacksAPI:MS,shimConstraints:jS,shimCreateOfferLegacy:US,shimGetUserMedia:NS,shimLocalStreamsAPI:LS,shimRTCIceServerUrls:$S,shimRemoteStreamsAPI:DS,shimTrackEventTransceiver:FS},Symbol.toStringTag,{value:"Module"}));var zS={exports:{}};(function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},e.splitSections=function(n){return n.split(`
m=`).map((s,i)=>(i>0?"m="+s:s).trim()+`\r
`)},e.getDescription=function(n){const r=e.splitSections(n);return r&&r[0]},e.getMediaSections=function(n){const r=e.splitSections(n);return r.shift(),r},e.matchPrefix=function(n,r){return e.splitLines(n).filter(s=>s.indexOf(r)===0)},e.parseCandidate=function(n){let r;n.indexOf("a=candidate:")===0?r=n.substring(12).split(" "):r=n.substring(10).split(" ");const s={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let i=8;i<r.length;i+=2)switch(r[i]){case"raddr":s.relatedAddress=r[i+1];break;case"rport":s.relatedPort=parseInt(r[i+1],10);break;case"tcptype":s.tcpType=r[i+1];break;case"ufrag":s.ufrag=r[i+1],s.usernameFragment=r[i+1];break;default:s[r[i]]===void 0&&(s[r[i]]=r[i+1]);break}return s},e.writeCandidate=function(n){const r=[];r.push(n.foundation);const s=n.component;s==="rtp"?r.push(1):s==="rtcp"?r.push(2):r.push(s),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const i=n.type;return r.push("typ"),r.push(i),i!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let r=n.substring(9).split(" ");const s={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),s.name=r[0],s.clockRate=parseInt(r[1],10),s.channels=r.length===3?parseInt(r[2],10):1,s.numChannels=s.channels,s},e.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const s=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(s!==1?"/"+s:"")+`\r
`},e.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const r={};let s;const i=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<i.length;o++)s=i[o].trim().split("="),r[s[0].trim()]=s[1];return r},e.writeFmtp=function(n){let r="",s=n.payloadType;if(n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const i=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?i.push(o+"="+n.parameters[o]):i.push(o)}),r+="a=fmtp:"+s+" "+i.join(";")+`\r
`}return r},e.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},e.writeRtcpFb=function(n){let r="",s=n.payloadType;return n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(i=>{r+="a=rtcp-fb:"+s+" "+i.type+(i.parameter&&i.parameter.length?" "+i.parameter:"")+`\r
`}),r},e.parseSsrcMedia=function(n){const r=n.indexOf(" "),s={ssrc:parseInt(n.substring(7,r),10)},i=n.indexOf(":",r);return i>-1?(s.attribute=n.substring(r+1,i),s.value=n.substring(i+1)):s.attribute=n.substring(r+1),s},e.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(s=>parseInt(s,10))}},e.getMid=function(n){const r=e.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},e.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:e.matchPrefix(n+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,r){let s="a=setup:"+r+`\r
`;return n.fingerprints.forEach(i=>{s+="a=fingerprint:"+i.algorithm+" "+i.value+`\r
`}),s},e.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,r){return e.matchPrefix(n+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,r){const s=e.matchPrefix(n+r,"a=ice-ufrag:")[0],i=e.matchPrefix(n+r,"a=ice-pwd:")[0];return s&&i?{usernameFragment:s.substring(12),password:i.substring(10)}:null},e.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},e.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=e.splitLines(n)[0].split(" ");r.profile=i[2];for(let l=3;l<i.length;l++){const c=i[l],d=e.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(d){const u=e.parseRtpMap(d),h=e.matchPrefix(n,"a=fmtp:"+c+" ");switch(u.parameters=h.length?e.parseFmtp(h[0]):{},u.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),r.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(l=>{r.headerExtensions.push(e.parseExtmap(l))});const o=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(l=>{o.forEach(c=>{l.rtcpFeedback.find(u=>u.type===c.type&&u.parameter===c.parameter)||l.rtcpFeedback.push(c)})}),r},e.writeRtpDescription=function(n,r){let s="";s+="m="+n+" ",s+=r.codecs.length>0?"9":"0",s+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",s+=r.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,s+=`c=IN IP4 0.0.0.0\r
`,s+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(o=>{s+=e.writeRtpMap(o),s+=e.writeFmtp(o),s+=e.writeRtcpFb(o)});let i=0;return r.codecs.forEach(o=>{o.maxptime>i&&(i=o.maxptime)}),i>0&&(s+="a=maxptime:"+i+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(o=>{s+=e.writeExtmap(o)}),s},e.parseRtpEncodingParameters=function(n){const r=[],s=e.parseRtpParameters(n),i=s.fecMechanisms.indexOf("RED")!==-1,o=s.fecMechanisms.indexOf("ULPFEC")!==-1,l=e.matchPrefix(n,"a=ssrc:").map(f=>e.parseSsrcMedia(f)).filter(f=>f.attribute==="cname"),c=l.length>0&&l[0].ssrc;let d;const u=e.matchPrefix(n,"a=ssrc-group:FID").map(f=>f.substring(17).split(" ").map(k=>parseInt(k,10)));u.length>0&&u[0].length>1&&u[0][0]===c&&(d=u[0][1]),s.codecs.forEach(f=>{if(f.name.toUpperCase()==="RTX"&&f.parameters.apt){let x={ssrc:c,codecPayloadType:parseInt(f.parameters.apt,10)};c&&d&&(x.rtx={ssrc:d}),r.push(x),i&&(x=JSON.parse(JSON.stringify(x)),x.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},r.push(x))}}),r.length===0&&c&&r.push({ssrc:c});let h=e.matchPrefix(n,"b=");return h.length&&(h[0].indexOf("b=TIAS:")===0?h=parseInt(h[0].substring(7),10):h[0].indexOf("b=AS:")===0?h=parseInt(h[0].substring(5),10)*1e3*.95-50*40*8:h=void 0,r.forEach(f=>{f.maxBitrate=h})),r},e.parseRtcpParameters=function(n){const r={},s=e.matchPrefix(n,"a=ssrc:").map(l=>e.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];s&&(r.cname=s.value,r.ssrc=s.ssrc);const i=e.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=i.length>0,r.compound=i.length===0;const o=e.matchPrefix(n,"a=rtcp-mux");return r.mux=o.length>0,r},e.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},e.parseMsid=function(n){let r;const s=e.matchPrefix(n,"a=msid:");if(s.length===1)return r=s[0].substring(7).split(" "),{stream:r[0],track:r[1]};const i=e.matchPrefix(n,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(i.length>0)return r=i[0].value.split(" "),{stream:r[0],track:r[1]}},e.parseSctpDescription=function(n){const r=e.parseMLine(n),s=e.matchPrefix(n,"a=max-message-size:");let i;s.length>0&&(i=parseInt(s[0].substring(19),10)),isNaN(i)&&(i=65536);const o=e.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:r.fmt,maxMessageSize:i};const l=e.matchPrefix(n,"a=sctpmap:");if(l.length>0){const c=l[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:i}}},e.writeSctpDescription=function(n,r){let s=[];return n.protocol!=="DTLS/SCTP"?s=["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:s=["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&s.push("a=max-message-size:"+r.maxMessageSize+`\r
`),s.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,r,s){let i;const o=r!==void 0?r:2;return n?i=n:i=e.generateSessionId(),`v=0\r
o=`+(s||"thisisadapterortc")+" "+i+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,r){const s=e.splitLines(n);for(let i=0;i<s.length;i++)switch(s[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[i].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const s=e.splitLines(n)[0].substring(2).split(" ");return{kind:s[0],port:parseInt(s[1],10),protocol:s[2],fmt:s.slice(3).join(" ")}},e.parseOLine=function(n){const s=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:s[0],sessionId:s[1],sessionVersion:parseInt(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=e.splitLines(n);for(let s=0;s<r.length;s++)if(r[s].length<2||r[s].charAt(1)!=="=")return!1;return!0},t.exports=e})(zS);var HS=zS.exports;const Oo=U_(HS),nL=MI({__proto__:null,default:Oo},[HS]);function gd(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const s=new e(r),i=Oo.parseCandidate(r.candidate);for(const o in i)o in s||Object.defineProperty(s,o,{value:i[o]});return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new e(r)},t.RTCIceCandidate.prototype=e.prototype,zi(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function Wp(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||zi(t,"icecandidate",e=>{if(e.candidate){const n=Oo.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function md(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(l){if(!l||!l.sdp)return!1;const c=Oo.splitSections(l.sdp);return c.shift(),c.some(d=>{const u=Oo.parseMLine(d);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},r=function(l){const c=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const d=parseInt(c[1],10);return d!==d?-1:d},s=function(l){let c=65536;return e.browser==="firefox"&&(e.version<57?l===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},i=function(l,c){let d=65536;e.browser==="firefox"&&e.version===57&&(d=65535);const u=Oo.matchPrefix(l.sdp,"a=max-message-size:");return u.length>0?d=parseInt(u[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(d=2147483637),d},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=r(arguments[0]),d=s(c),u=i(arguments[0],c);let h;d===0&&u===0?h=Number.POSITIVE_INFINITY:d===0||u===0?h=Math.max(d,u):h=Math.min(d,u);const f={};Object.defineProperty(f,"maxMessageSize",{get(){return h}}),this._sctp=f}return o.apply(this,arguments)}}function yd(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(r,s){const i=r.send;r.send=function(){const l=arguments[0],c=l.length||l.size||l.byteLength;if(r.readyState==="open"&&s.sctp&&c>s.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+s.sctp.maxMessageSize+" bytes)");return i.apply(r,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const s=n.apply(this,arguments);return e(s,this),s},zi(t,"datachannel",r=>(e(r.channel,r.target),r))}function Gp(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=s=>{const i=s.target;if(i._lastConnectionState!==i.connectionState){i._lastConnectionState=i.connectionState;const o=new Event("connectionstatechange",s);i.dispatchEvent(o)}return s},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function Vp(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(s){if(s&&s.sdp&&s.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i=s.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&s instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:s.type,sdp:i}):s.sdp=i}return n.apply(this,arguments)}}function vd(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function _d(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let s=arguments[0]||{};if(typeof s!="object"||s.type&&s.sdp)return n.apply(this,arguments);if(s={type:s.type,sdp:s.sdp},!s.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":s.type="offer";break;default:s.type="answer";break}return s.sdp||s.type!=="offer"&&s.type!=="answer"?n.apply(this,[s]):(s.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}const rL=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:Vp,shimAddIceCandidateNullOrEmpty:vd,shimConnectionState:Gp,shimMaxMessageSize:md,shimParameterlessSetLocalDescription:_d,shimRTCIceCandidate:gd,shimRTCIceCandidateRelayProtocol:Wp,shimSendThrowTypeError:yd},Symbol.toStringTag,{value:"Module"}));function sL({window:t}={},e={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const n=hS,r=eL(t),s={browserDetails:r,commonShim:rL,extractVersion:Ua,disableLog:qO,disableWarnings:ZO,sdp:nL};switch(r.browser){case"chrome":if(!m_||!zp||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),s;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),s;n("adapter.js shimming chrome."),s.browserShim=m_,vd(t,r),_d(t),gS(t,r),mS(t),zp(t,r),yS(t),bS(t,r),vS(t),_S(t),ES(t,r),gd(t),Wp(t),Gp(t),md(t,r),yd(t),Vp(t,r);break;case"firefox":if(!y_||!Hp||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),s;n("adapter.js shimming firefox."),s.browserShim=y_,vd(t,r),_d(t),SS(t,r),Hp(t,r),IS(t),CS(t),TS(t),wS(t),kS(t),RS(t),AS(t),PS(t),OS(t),gd(t),Gp(t),md(t,r),yd(t);break;case"safari":if(!v_||!e.shimSafari)return n("Safari shim is not included in this adapter release."),s;n("adapter.js shimming safari."),s.browserShim=v_,vd(t,r),_d(t),$S(t),US(t),MS(t),LS(t),DS(t),FS(t),NS(t),BS(t),gd(t),Wp(t),md(t,r),yd(t),Vp(t,r);break;default:n("Unsupported browser!");break}return s}const __=sL({window:typeof window>"u"?void 0:window});function Hi(t,e,n,r){Object.defineProperty(t,e,{get:n,set:r,enumerable:!0,configurable:!0})}class WS{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=e=>{const n=[],r=e.byteLength,s=Math.ceil(r/this.chunkedMTU);let i=0,o=0;for(;o<r;){const l=Math.min(r,o+this.chunkedMTU),c=e.slice(o,l),d={__peerData:this._dataCount,n:i,data:c,total:s};n.push(d),o=l,i++}return this._dataCount++,n}}}function iL(t){let e=0;for(const s of t)e+=s.byteLength;const n=new Uint8Array(e);let r=0;for(const s of t)n.set(s,r),r+=s.byteLength;return n}const Ih=__.default||__,Oa=new class{isWebRTCSupported(){return typeof RTCPeerConnection<"u"}isBrowserSupported(){const t=this.getBrowser(),e=this.getVersion();return this.supportedBrowsers.includes(t)?t==="chrome"?e>=this.minChromeVersion:t==="firefox"?e>=this.minFirefoxVersion:t==="safari"?!this.isIOS&&e>=this.minSafariVersion:!1:!1}getBrowser(){return Ih.browserDetails.browser}getVersion(){return Ih.browserDetails.version||0}isUnifiedPlanSupported(){const t=this.getBrowser(),e=Ih.browserDetails.version||0;if(t==="chrome"&&e<this.minChromeVersion)return!1;if(t==="firefox"&&e>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let n,r=!1;try{n=new RTCPeerConnection,n.addTransceiver("audio"),r=!0}catch{}finally{n&&n.close()}return r}toString(){return`Supports:
    browser:${this.getBrowser()}
    version:${this.getVersion()}
    isIOS:${this.isIOS}
    isWebRTCSupported:${this.isWebRTCSupported()}
    isBrowserSupported:${this.isBrowserSupported()}
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS=typeof navigator<"u"?["iPad","iPhone","iPod"].includes(navigator.platform):!1,this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},oL=t=>!t||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(t),GS=()=>Math.random().toString(36).slice(2),x_={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};class aL extends WS{noop(){}blobToArrayBuffer(e,n){const r=new FileReader;return r.onload=function(s){s.target&&n(s.target.result)},r.readAsArrayBuffer(e),r}binaryStringToArrayBuffer(e){const n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r)&255;return n.buffer}isSecure(){return location.protocol==="https:"}constructor(...e){super(...e),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=x_,this.browser=Oa.getBrowser(),this.browserVersion=Oa.getVersion(),this.pack=dS,this.unpack=cS,this.supports=function(){const n={browser:Oa.isBrowserSupported(),webRTC:Oa.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!n.webRTC)return n;let r;try{r=new RTCPeerConnection(x_),n.audioVideo=!0;let s;try{s=r.createDataChannel("_PEERJSTEST",{ordered:!0}),n.data=!0,n.reliable=!!s.ordered;try{s.binaryType="blob",n.binaryBlob=!Oa.isIOS}catch{}}catch{}finally{s&&s.close()}}catch{}finally{r&&r.close()}return n}(),this.validateId=oL,this.randomToken=GS}}const Ln=new aL,lL="PeerJS: ";class cL{get logLevel(){return this._logLevel}set logLevel(e){this._logLevel=e}log(...e){this._logLevel>=3&&this._print(3,...e)}warn(...e){this._logLevel>=2&&this._print(2,...e)}error(...e){this._logLevel>=1&&this._print(1,...e)}setLogFunction(e){this._print=e}_print(e,...n){const r=[lL,...n];for(const s in r)r[s]instanceof Error&&(r[s]="("+r[s].name+") "+r[s].message);e>=3?console.log(...r):e>=2?console.warn("WARNING",...r):e>=1&&console.error("ERROR",...r)}constructor(){this._logLevel=0}}var Te=new cL,G0={},dL=Object.prototype.hasOwnProperty,Rn="~";function jl(){}Object.create&&(jl.prototype=Object.create(null),new jl().__proto__||(Rn=!1));function uL(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function VS(t,e,n,r,s){if(typeof n!="function")throw new TypeError("The listener must be a function");var i=new uL(n,r||t,s),o=Rn?Rn+e:e;return t._events[o]?t._events[o].fn?t._events[o]=[t._events[o],i]:t._events[o].push(i):(t._events[o]=i,t._eventsCount++),t}function xd(t,e){--t._eventsCount===0?t._events=new jl:delete t._events[e]}function xn(){this._events=new jl,this._eventsCount=0}xn.prototype.eventNames=function(){var e=[],n,r;if(this._eventsCount===0)return e;for(r in n=this._events)dL.call(n,r)&&e.push(Rn?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(n)):e};xn.prototype.listeners=function(e){var n=Rn?Rn+e:e,r=this._events[n];if(!r)return[];if(r.fn)return[r.fn];for(var s=0,i=r.length,o=new Array(i);s<i;s++)o[s]=r[s].fn;return o};xn.prototype.listenerCount=function(e){var n=Rn?Rn+e:e,r=this._events[n];return r?r.fn?1:r.length:0};xn.prototype.emit=function(e,n,r,s,i,o){var l=Rn?Rn+e:e;if(!this._events[l])return!1;var c=this._events[l],d=arguments.length,u,h;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,n),!0;case 3:return c.fn.call(c.context,n,r),!0;case 4:return c.fn.call(c.context,n,r,s),!0;case 5:return c.fn.call(c.context,n,r,s,i),!0;case 6:return c.fn.call(c.context,n,r,s,i,o),!0}for(h=1,u=new Array(d-1);h<d;h++)u[h-1]=arguments[h];c.fn.apply(c.context,u)}else{var f=c.length,x;for(h=0;h<f;h++)switch(c[h].once&&this.removeListener(e,c[h].fn,void 0,!0),d){case 1:c[h].fn.call(c[h].context);break;case 2:c[h].fn.call(c[h].context,n);break;case 3:c[h].fn.call(c[h].context,n,r);break;case 4:c[h].fn.call(c[h].context,n,r,s);break;default:if(!u)for(x=1,u=new Array(d-1);x<d;x++)u[x-1]=arguments[x];c[h].fn.apply(c[h].context,u)}}return!0};xn.prototype.on=function(e,n,r){return VS(this,e,n,r,!1)};xn.prototype.once=function(e,n,r){return VS(this,e,n,r,!0)};xn.prototype.removeListener=function(e,n,r,s){var i=Rn?Rn+e:e;if(!this._events[i])return this;if(!n)return xd(this,i),this;var o=this._events[i];if(o.fn)o.fn===n&&(!s||o.once)&&(!r||o.context===r)&&xd(this,i);else{for(var l=0,c=[],d=o.length;l<d;l++)(o[l].fn!==n||s&&!o[l].once||r&&o[l].context!==r)&&c.push(o[l]);c.length?this._events[i]=c.length===1?c[0]:c:xd(this,i)}return this};xn.prototype.removeAllListeners=function(e){var n;return e?(n=Rn?Rn+e:e,this._events[n]&&xd(this,n)):(this._events=new jl,this._eventsCount=0),this};xn.prototype.off=xn.prototype.removeListener;xn.prototype.addListener=xn.prototype.on;xn.prefixed=Rn;xn.EventEmitter=xn;G0=xn;var Wi={};Hi(Wi,"ConnectionType",()=>Ys);Hi(Wi,"PeerErrorType",()=>Gt);Hi(Wi,"BaseConnectionErrorType",()=>Yp);Hi(Wi,"DataConnectionErrorType",()=>V0);Hi(Wi,"SerializationType",()=>tf);Hi(Wi,"SocketEventType",()=>Ls);Hi(Wi,"ServerMessageType",()=>yn);var Ys=function(t){return t.Data="data",t.Media="media",t}({}),Gt=function(t){return t.BrowserIncompatible="browser-incompatible",t.Disconnected="disconnected",t.InvalidID="invalid-id",t.InvalidKey="invalid-key",t.Network="network",t.PeerUnavailable="peer-unavailable",t.SslUnavailable="ssl-unavailable",t.ServerError="server-error",t.SocketError="socket-error",t.SocketClosed="socket-closed",t.UnavailableID="unavailable-id",t.WebRTC="webrtc",t}({}),Yp=function(t){return t.NegotiationFailed="negotiation-failed",t.ConnectionClosed="connection-closed",t}({}),V0=function(t){return t.NotOpenYet="not-open-yet",t.MessageToBig="message-too-big",t}({}),tf=function(t){return t.Binary="binary",t.BinaryUTF8="binary-utf8",t.JSON="json",t.None="raw",t}({}),Ls=function(t){return t.Message="message",t.Disconnected="disconnected",t.Error="error",t.Close="close",t}({}),yn=function(t){return t.Heartbeat="HEARTBEAT",t.Candidate="CANDIDATE",t.Offer="OFFER",t.Answer="ANSWER",t.Open="OPEN",t.Error="ERROR",t.IdTaken="ID-TAKEN",t.InvalidKey="INVALID-KEY",t.Leave="LEAVE",t.Expire="EXPIRE",t}({});const YS="1.5.5";class fL extends G0.EventEmitter{constructor(e,n,r,s,i,o=5e3){super(),this.pingInterval=o,this._disconnected=!0,this._messagesQueue=[];const l=e?"wss://":"ws://";this._baseUrl=l+n+":"+r+s+"peerjs?key="+i}start(e,n){this._id=e;const r=`${this._baseUrl}&id=${e}&token=${n}`;this._socket||!this._disconnected||(this._socket=new WebSocket(r+"&version="+YS),this._disconnected=!1,this._socket.onmessage=s=>{let i;try{i=JSON.parse(s.data),Te.log("Server message received:",i)}catch{Te.log("Invalid server message",s.data);return}this.emit(Ls.Message,i)},this._socket.onclose=s=>{this._disconnected||(Te.log("Socket closed.",s),this._cleanup(),this._disconnected=!0,this.emit(Ls.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),Te.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen()){Te.log("Cannot send heartbeat, because socket closed");return}const e=JSON.stringify({type:yn.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&this._socket.readyState===1}_sendQueuedMessages(){const e=[...this._messagesQueue];this._messagesQueue=[];for(const n of e)this.send(n)}send(e){if(this._disconnected)return;if(!this._id){this._messagesQueue.push(e);return}if(!e.type){this.emit(Ls.Error,"Invalid message");return}if(!this._wsOpen())return;const n=JSON.stringify(e);this._socket.send(n)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}class KS{constructor(e){this.connection=e}startConnection(e){const n=this._startPeerConnection();if(this.connection.peerConnection=n,this.connection.type===Ys.Media&&e._stream&&this._addTracksToConnection(e._stream,n),e.originator){const r=this.connection,s={ordered:!!e.reliable},i=n.createDataChannel(r.label,s);r._initializeDataChannel(i),this._makeOffer()}else this.handleSDP("OFFER",e.sdp)}_startPeerConnection(){Te.log("Creating RTCPeerConnection.");const e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e}_setupListeners(e){const n=this.connection.peer,r=this.connection.connectionId,s=this.connection.type,i=this.connection.provider;Te.log("Listening for ICE candidates."),e.onicecandidate=o=>{!o.candidate||!o.candidate.candidate||(Te.log(`Received ICE candidates for ${n}:`,o.candidate),i.socket.send({type:yn.Candidate,payload:{candidate:o.candidate,type:s,connectionId:r},dst:n}))},e.oniceconnectionstatechange=()=>{switch(e.iceConnectionState){case"failed":Te.log("iceConnectionState is failed, closing connections to "+n),this.connection.emitError(Yp.NegotiationFailed,"Negotiation of connection to "+n+" failed."),this.connection.close();break;case"closed":Te.log("iceConnectionState is closed, closing connections to "+n),this.connection.emitError(Yp.ConnectionClosed,"Connection to "+n+" closed."),this.connection.close();break;case"disconnected":Te.log("iceConnectionState changed to disconnected on the connection with "+n);break;case"completed":e.onicecandidate=()=>{};break}this.connection.emit("iceStateChanged",e.iceConnectionState)},Te.log("Listening for data channel"),e.ondatachannel=o=>{Te.log("Received data channel");const l=o.channel;i.getConnection(n,r)._initializeDataChannel(l)},Te.log("Listening for remote stream"),e.ontrack=o=>{Te.log("Received remote stream");const l=o.streams[0],c=i.getConnection(n,r);if(c.type===Ys.Media){const d=c;this._addStreamToMediaConnection(l,d)}}}cleanup(){Te.log("Cleaning up PeerConnection to "+this.connection.peer);const e=this.connection.peerConnection;if(!e)return;this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=()=>{};const n=e.signalingState!=="closed";let r=!1;const s=this.connection.dataChannel;s&&(r=!!s.readyState&&s.readyState!=="closed"),(n||r)&&e.close()}async _makeOffer(){const e=this.connection.peerConnection,n=this.connection.provider;try{const r=await e.createOffer(this.connection.options.constraints);Te.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),Te.log("Set localDescription:",r,`for:${this.connection.peer}`);let s={sdp:r,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===Ys.Data){const i=this.connection;s={...s,label:i.label,reliable:i.reliable,serialization:i.serialization}}n.socket.send({type:yn.Offer,payload:s,dst:this.connection.peer})}catch(s){s!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(n.emitError(Gt.WebRTC,s),Te.log("Failed to setLocalDescription, ",s))}}catch(r){n.emitError(Gt.WebRTC,r),Te.log("Failed to createOffer, ",r)}}async _makeAnswer(){const e=this.connection.peerConnection,n=this.connection.provider;try{const r=await e.createAnswer();Te.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),Te.log("Set localDescription:",r,`for:${this.connection.peer}`),n.socket.send({type:yn.Answer,payload:{sdp:r,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(s){n.emitError(Gt.WebRTC,s),Te.log("Failed to setLocalDescription, ",s)}}catch(r){n.emitError(Gt.WebRTC,r),Te.log("Failed to create answer, ",r)}}async handleSDP(e,n){n=new RTCSessionDescription(n);const r=this.connection.peerConnection,s=this.connection.provider;Te.log("Setting remote description",n);const i=this;try{await r.setRemoteDescription(n),Te.log(`Set remoteDescription:${e} for:${this.connection.peer}`),e==="OFFER"&&await i._makeAnswer()}catch(o){s.emitError(Gt.WebRTC,o),Te.log("Failed to setRemoteDescription, ",o)}}async handleCandidate(e){Te.log("handleCandidate:",e);try{await this.connection.peerConnection.addIceCandidate(e),Te.log(`Added ICE candidate for:${this.connection.peer}`)}catch(n){this.connection.provider.emitError(Gt.WebRTC,n),Te.log("Failed to handleCandidate, ",n)}}_addTracksToConnection(e,n){if(Te.log(`add tracks from stream ${e.id} to peer connection`),!n.addTrack)return Te.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(r=>{n.addTrack(r,e)})}_addStreamToMediaConnection(e,n){Te.log(`add stream ${e.id} to media connection ${n.connectionId}`),n.addStream(e)}}class XS extends G0.EventEmitter{emitError(e,n){Te.error("Error:",n),this.emit("error",new hL(`${e}`,n))}}class hL extends Error{constructor(e,n){typeof n=="string"?super(n):(super(),Object.assign(this,n)),this.type=e}}class QS extends XS{get open(){return this._open}constructor(e,n,r){super(),this.peer=e,this.provider=n,this.options=r,this._open=!1,this.metadata=r.metadata}}var Qp;const il=class il extends QS{get type(){return Ys.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(e,n,r){super(e,n,r),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||il.ID_PREFIX+Ln.randomToken(),this._negotiator=new KS(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{Te.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{Te.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(e){Te.log("Receiving stream",e),this._remoteStream=e,super.emit("stream",e)}handleMessage(e){const n=e.type,r=e.payload;switch(e.type){case yn.Answer:this._negotiator.handleSDP(n,r.sdp),this._open=!0;break;case yn.Candidate:this._negotiator.handleCandidate(r.candidate);break;default:Te.warn(`Unrecognized message type:${n} from peer:${this.peer}`);break}}answer(e,n={}){if(this._localStream){Te.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=e,n&&n.sdpTransform&&(this.options.sdpTransform=n.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:e});const r=this.provider._getMessages(this.connectionId);for(const s of r)this.handleMessage(s);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit("close"))}};Qp=new WeakMap,va(il,Qp,il.ID_PREFIX="mc_");let yu=il;class pL{constructor(e){this._options=e}_buildRequest(e){const n=this._options.secure?"https":"http",{host:r,port:s,path:i,key:o}=this._options,l=new URL(`${n}://${r}:${s}${i}${o}/${e}`);return l.searchParams.set("ts",`${Date.now()}${Math.random()}`),l.searchParams.set("version",YS),fetch(l.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{const e=await this._buildRequest("id");if(e.status!==200)throw new Error(`Error. Status:${e.status}`);return e.text()}catch(e){Te.error("Error retrieving ID",e);let n="";throw this._options.path==="/"&&this._options.host!==Ln.CLOUD_HOST&&(n=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+n)}}async listAllPeers(){try{const e=await this._buildRequest("peers");if(e.status!==200){if(e.status===401){let n="";throw this._options.host===Ln.CLOUD_HOST?n="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":n="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+n)}throw new Error(`Error. Status:${e.status}`)}return e.json()}catch(e){throw Te.error("Error retrieving list peers",e),new Error("Could not get list peers from the server."+e)}}}var Jp,qp;const mi=class mi extends QS{get type(){return Ys.Data}constructor(e,n,r){super(e,n,r),this.connectionId=this.options.connectionId||mi.ID_PREFIX+GS(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new KS(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{Te.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=n=>{Te.log(`DC#${this.connectionId} dc onmessage:`,n.data)},this.dataChannel.onclose=()=>{Te.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(e){if(e!=null&&e.flush){this.send({__peerData:{type:"close"}});return}this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null),this.open&&(this._open=!1,super.emit("close"))}send(e,n=!1){if(!this.open){this.emitError(V0.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.");return}return this._send(e,n)}async handleMessage(e){const n=e.payload;switch(e.type){case yn.Answer:await this._negotiator.handleSDP(e.type,n.sdp);break;case yn.Candidate:await this._negotiator.handleCandidate(n.candidate);break;default:Te.warn("Unrecognized message type:",e.type,"from peer:",this.peer);break}}};Jp=new WeakMap,qp=new WeakMap,va(mi,Jp,mi.ID_PREFIX="dc_"),va(mi,qp,mi.MAX_BUFFERED_AMOUNT=8388608);let vu=mi;class Y0 extends vu{get bufferSize(){return this._bufferSize}_initializeDataChannel(e){super._initializeDataChannel(e),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",n=>this._handleDataMessage(n))}_bufferedSend(e){(this._buffering||!this._trySend(e))&&(this._buffer.push(e),this._bufferSize=this._buffer.length)}_trySend(e){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>vu.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(e)}catch(n){return Te.error(`DC#:${this.connectionId} Error when sending:`,n),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open||this._buffer.length===0)return;const e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(e){if(e!=null&&e.flush){this.send({__peerData:{type:"close"}});return}this._buffer=[],this._bufferSize=0,super.close()}constructor(...e){super(...e),this._buffer=[],this._bufferSize=0,this._buffering=!1}}class Th extends Y0{close(e){super.close(e),this._chunkedData={}}constructor(e,n,r){super(e,n,r),this.chunker=new WS,this.serialization=tf.Binary,this._chunkedData={}}_handleDataMessage({data:e}){const n=cS(e),r=n.__peerData;if(r){if(r.type==="close"){this.close();return}this._handleChunk(n);return}this.emit("data",n)}_handleChunk(e){const n=e.__peerData,r=this._chunkedData[n]||{data:[],count:0,total:e.total};if(r.data[e.n]=new Uint8Array(e.data),r.count++,this._chunkedData[n]=r,r.total===r.count){delete this._chunkedData[n];const s=iL(r.data);this._handleDataMessage({data:s})}}_send(e,n){const r=dS(e);if(r instanceof Promise)return this._send_blob(r);if(!n&&r.byteLength>this.chunker.chunkedMTU){this._sendChunks(r);return}this._bufferedSend(r)}async _send_blob(e){const n=await e;if(n.byteLength>this.chunker.chunkedMTU){this._sendChunks(n);return}this._bufferedSend(n)}_sendChunks(e){const n=this.chunker.chunk(e);Te.log(`DC#${this.connectionId} Try to send ${n.length} chunks...`);for(const r of n)this.send(r,!0)}}class gL extends Y0{_handleDataMessage({data:e}){super.emit("data",e)}_send(e,n){this._bufferedSend(e)}constructor(...e){super(...e),this.serialization=tf.None}}class mL extends Y0{_handleDataMessage({data:e}){const n=this.parse(this.decoder.decode(e)),r=n.__peerData;if(r&&r.type==="close"){this.close();return}this.emit("data",n)}_send(e,n){const r=this.encoder.encode(this.stringify(e));if(r.byteLength>=Ln.chunkedMTU){this.emitError(V0.MessageToBig,"Message too big for JSON channel");return}this._bufferedSend(r)}constructor(...e){super(...e),this.serialization=tf.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}var Zp;const ol=class ol extends XS{get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){const e=Object.create(null);for(const[n,r]of this._connections)e[n]=r;return e}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(e,n){super(),this._serializers={raw:gL,json:mL,binary:Th,"binary-utf8":Th,default:Th},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map;let r;if(e&&e.constructor==Object?n=e:e&&(r=e.toString()),n={debug:0,host:Ln.CLOUD_HOST,port:Ln.CLOUD_PORT,path:"/",key:ol.DEFAULT_KEY,token:Ln.randomToken(),config:Ln.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...n},this._options=n,this._serializers={...this._serializers,...this.options.serializers},this._options.host==="/"&&(this._options.host=window.location.hostname),this._options.path&&(this._options.path[0]!=="/"&&(this._options.path="/"+this._options.path),this._options.path[this._options.path.length-1]!=="/"&&(this._options.path+="/")),this._options.secure===void 0&&this._options.host!==Ln.CLOUD_HOST?this._options.secure=Ln.isSecure():this._options.host==Ln.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&Te.setLogFunction(this._options.logFunction),Te.logLevel=this._options.debug||0,this._api=new pL(n),this._socket=this._createServerConnection(),!Ln.supports.audioVideo&&!Ln.supports.data){this._delayedAbort(Gt.BrowserIncompatible,"The current browser does not support WebRTC");return}if(r&&!Ln.validateId(r)){this._delayedAbort(Gt.InvalidID,`ID "${r}" is invalid`);return}r?this._initialize(r):this._api.retrieveId().then(s=>this._initialize(s)).catch(s=>this._abort(Gt.ServerError,s))}_createServerConnection(){const e=new fL(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return e.on(Ls.Message,n=>{this._handleMessage(n)}),e.on(Ls.Error,n=>{this._abort(Gt.SocketError,n)}),e.on(Ls.Disconnected,()=>{this.disconnected||(this.emitError(Gt.Network,"Lost connection to server."),this.disconnect())}),e.on(Ls.Close,()=>{this.disconnected||this._abort(Gt.SocketClosed,"Underlying socket is already closed.")}),e}_initialize(e){this._id=e,this.socket.start(e,this._options.token)}_handleMessage(e){const n=e.type,r=e.payload,s=e.src;switch(n){case yn.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case yn.Error:this._abort(Gt.ServerError,r.msg);break;case yn.IdTaken:this._abort(Gt.UnavailableID,`ID "${this.id}" is taken`);break;case yn.InvalidKey:this._abort(Gt.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case yn.Leave:Te.log(`Received leave message from ${s}`),this._cleanupPeer(s),this._connections.delete(s);break;case yn.Expire:this.emitError(Gt.PeerUnavailable,`Could not connect to peer ${s}`);break;case yn.Offer:{const i=r.connectionId;let o=this.getConnection(s,i);if(o&&(o.close(),Te.warn(`Offer received for existing Connection ID:${i}`)),r.type===Ys.Media){const c=new yu(s,this,{connectionId:i,_payload:r,metadata:r.metadata});o=c,this._addConnection(s,o),this.emit("call",c)}else if(r.type===Ys.Data){const c=new this._serializers[r.serialization](s,this,{connectionId:i,_payload:r,metadata:r.metadata,label:r.label,serialization:r.serialization,reliable:r.reliable});o=c,this._addConnection(s,o),this.emit("connection",c)}else{Te.warn(`Received malformed connection type:${r.type}`);return}const l=this._getMessages(i);for(const c of l)o.handleMessage(c);break}default:{if(!r){Te.warn(`You received a malformed message from ${s} of type ${n}`);return}const i=r.connectionId,o=this.getConnection(s,i);o&&o.peerConnection?o.handleMessage(e):i?this._storeMessage(i,e):Te.warn("You received an unrecognized message:",e);break}}}_storeMessage(e,n){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(n)}_getMessages(e){const n=this._lostMessages.get(e);return n?(this._lostMessages.delete(e),n):[]}connect(e,n={}){if(n={serialization:"default",...n},this.disconnected){Te.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(Gt.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}const r=new this._serializers[n.serialization](e,this,n);return this._addConnection(e,r),r}call(e,n,r={}){if(this.disconnected){Te.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(Gt.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!n){Te.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}const s=new yu(e,this,{...r,_stream:n});return this._addConnection(e,s),s}_addConnection(e,n){Te.log(`add connection ${n.type}:${n.connectionId} to peerId:${e}`),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(n)}_removeConnection(e){const n=this._connections.get(e.peer);if(n){const r=n.indexOf(e);r!==-1&&n.splice(r,1)}this._lostMessages.delete(e.connectionId)}getConnection(e,n){const r=this._connections.get(e);if(!r)return null;for(const s of r)if(s.connectionId===n)return s;return null}_delayedAbort(e,n){setTimeout(()=>{this._abort(e,n)},0)}_abort(e,n){Te.error("Aborting!"),this.emitError(e,n),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||(Te.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))}_cleanup(){for(const e of this._connections.keys())this._cleanupPeer(e),this._connections.delete(e);this.socket.removeAllListeners()}_cleanupPeer(e){const n=this._connections.get(e);if(n)for(const r of n)r.close()}disconnect(){if(this.disconnected)return;const e=this.id;Te.log(`Disconnect peer with ID:${e}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit("disconnected",e)}reconnect(){if(this.disconnected&&!this.destroyed)Te.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)Te.error("In a hurry? We're still trying to make the initial connection!");else throw new Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`)}}listAllPeers(e=n=>{}){this._api.listAllPeers().then(n=>e(n)).catch(n=>this._abort(Gt.ServerError,n))}};Zp=new WeakMap,va(ol,Zp,ol.DEFAULT_KEY="peerjs");let Kp=ol;var JS=Kp;class qS{constructor(){ln(this,"peer",null);ln(this,"conn",null);ln(this,"isHost",!1);ln(this,"messageCallback",null);ln(this,"connectionCallback",null);ln(this,"closeCallback",null)}async connect(e){return this.peer=new JS,new Promise((n,r)=>{if(!this.peer)return r("Peer not initialized");this.peer.on("open",s=>{console.log("My Peer ID is:",s),e?(this.isHost=!1,this.connectToPeer(e),n(s)):(this.isHost=!0,this.peer.on("connection",i=>{console.log("Incoming connection..."),this.setupConnection(i)}),n(s))}),this.peer.on("error",s=>{console.error(s),r(s)})})}connectToPeer(e){if(!this.peer)return;const n=this.peer.connect(e);this.setupConnection(n)}setupConnection(e){this.conn=e,e.on("open",()=>{console.log("Connection established!"),this.connectionCallback&&this.connectionCallback()}),e.on("data",n=>{this.messageCallback&&this.messageCallback(n)}),e.on("close",()=>{console.log("Connection closed"),this.closeCallback&&this.closeCallback()}),e.on("error",n=>console.error("Connection Error:",n))}onConnection(e){this.connectionCallback=e}onClose(e){this.closeCallback=e}isConnected(){return this.conn!==null&&this.conn.open}send(e){this.conn&&this.conn.open?this.conn.send(e):console.warn("Connection not open, cannot send message")}onMessage(e){this.messageCallback=e}disconnect(){var e,n;(e=this.conn)==null||e.close(),(n=this.peer)==null||n.destroy()}}const yL=({gameMode:t,targetRoomId:e,playerClass:n,onGameStart:r,onBack:s})=>{const[i,o]=O.useState(""),[l,c]=O.useState(!1),[d,u]=O.useState(!0),[h,f]=O.useState(null),[x,k]=O.useState(!1),[T,j]=O.useState(null),[b,v]=O.useState(!1),S=O.useRef(null);O.useEffect(()=>{const H=new qS;return S.current=H,(async()=>{try{const W=await H.connect(t==="JOIN"?e:void 0);o(W),u(!1),H.onMessage(q=>{console.log("[LobbyScreen] Received message:",q),q.type==="CLASS_INFO"&&(console.log("[LobbyScreen] Received opponent class:",q.playerClass),j(q.playerClass))}),H.onConnection(()=>{console.log("[LobbyScreen] Connection established!"),c(!0)})}catch(W){console.error("[LobbyScreen] Connection error:",W),f(W.toString()),u(!1)}})(),()=>{var W;(W=S.current)!=null&&W.isConnected()||H.disconnect()}},[t,e]),O.useEffect(()=>{l&&S.current&&!b&&(console.log("[LobbyScreen] Sending class info:",n),setTimeout(()=>{var H;(H=S.current)==null||H.send({type:"CLASS_INFO",playerClass:n}),v(!0)},100))},[l,n,b]),O.useEffect(()=>{if(l&&S.current&&T){const H=setTimeout(()=>{console.log("[LobbyScreen] Starting game with opponent class:",T),r(S.current,T)},500);return()=>clearTimeout(H)}},[l,r,T]);const p=async()=>{if(i)try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(i);else{const H=document.createElement("textarea");H.value=i,H.style.position="fixed",H.style.left="-999999px",H.style.top="-999999px",document.body.appendChild(H),H.focus(),H.select(),document.execCommand("copy"),document.body.removeChild(H)}k(!0),setTimeout(()=>k(!1),2e3)}catch(H){console.error("Failed to copy:",H),alert(`Room ID: ${i}

()`)}},F=()=>{S.current&&(S.current.disconnect(),S.current=null),s()};return a.jsxs("div",{className:"screen lobby-screen",style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",gap:"2rem"},children:[a.jsx("h1",{style:{fontSize:"2.5rem",marginBottom:"1rem",textShadow:"0 0 10px #e94560",fontFamily:"Tamanegi, sans-serif",letterSpacing:"2px"},children:t==="HOST"?"":"..."}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1.5rem",padding:"2rem",background:"rgba(0,0,0,0.3)",borderRadius:"10px",minWidth:"400px"},children:[h&&a.jsxs("div",{style:{color:"#ff6b6b",fontSize:"1.2rem",textAlign:"center",fontFamily:"Tamanegi, sans-serif"},children:[a.jsx("p",{children:""}),a.jsx("p",{style:{fontSize:"0.9rem",opacity:.7},children:h})]}),d&&!h&&a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1rem"},children:[a.jsx("div",{className:"loading-spinner",style:{width:"50px",height:"50px",border:"4px solid rgba(233, 69, 96, 0.3)",borderTop:"4px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),a.jsx("p",{style:{opacity:.8,fontFamily:"Tamanegi, sans-serif"},children:t==="HOST"?"...":"..."})]}),t==="HOST"&&i&&!d&&!l&&!h&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.5rem"},children:[a.jsx("p",{style:{fontSize:"1rem",opacity:.7,fontFamily:"Tamanegi, sans-serif"},children:"ID:"}),a.jsx("div",{style:{fontSize:"2rem",fontFamily:"monospace",fontWeight:"bold",padding:"0.5rem 1rem",background:"rgba(233, 69, 96, 0.2)",borderRadius:"8px",border:"1px solid #e94560",letterSpacing:"2px"},children:i})]}),a.jsx("button",{onClick:p,style:{fontSize:"1rem",padding:"0.8rem 2rem",background:x?"#48bb78":"transparent",border:"2px solid "+(x?"#48bb78":"#e94560"),color:"#fff",cursor:"pointer",transition:"all 0.3s",borderRadius:"4px",fontWeight:"bold",fontFamily:"Tamanegi, sans-serif"},children:x?" ":"ID"}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginTop:"1rem",opacity:.7},children:[a.jsx("div",{className:"loading-spinner",style:{width:"20px",height:"20px",border:"2px solid rgba(233, 69, 96, 0.3)",borderTop:"2px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),a.jsx("span",{style:{fontFamily:"Tamanegi, sans-serif"},children:"..."})]})]}),t==="JOIN"&&!d&&!l&&!h&&a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[a.jsx("div",{className:"loading-spinner",style:{width:"20px",height:"20px",border:"2px solid rgba(233, 69, 96, 0.3)",borderTop:"2px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),a.jsxs("span",{style:{fontFamily:"Tamanegi, sans-serif"},children:[" ",e," ..."]})]}),l&&a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1rem"},children:[a.jsx("p",{style:{fontSize:"1.5rem",color:"#48bb78",fontFamily:"Tamanegi, sans-serif"},children:" "}),a.jsx("p",{style:{fontFamily:"Tamanegi, sans-serif"},children:"..."})]}),a.jsxs("div",{style:{marginTop:"1rem",padding:"0.5rem 1rem",background:"rgba(255,255,255,0.1)",borderRadius:"4px",fontSize:"0.9rem",opacity:.7,fontFamily:"Tamanegi, sans-serif"},children:[": ",n==="SENKA"?"":n==="AJA"?"":"yoRuka"]})]}),a.jsx("button",{onClick:F,style:{fontSize:"1rem",padding:"0.8rem 2rem",background:"transparent",border:"1px solid #888",color:"#888",cursor:"pointer",transition:"all 0.3s",borderRadius:"4px",marginTop:"1rem",fontFamily:"Tamanegi, sans-serif"},onMouseOver:H=>{H.currentTarget.style.color="#fff",H.currentTarget.style.borderColor="#fff"},onMouseOut:H=>{H.currentTarget.style.color="#888",H.currentTarget.style.borderColor="#888"},children:" "}),a.jsx("style",{children:`
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `})]})};class vL{constructor(){ln(this,"myEntryRef",null);ln(this,"listenerUnsubscribe",null);ln(this,"myId","");ln(this,"myPeerId","");ln(this,"hasMatched",!1)}async startMatchmaking(e,n,r,s,i,o,l,c){this.myPeerId=e,this.hasMatched=!1;const d=Lr(Dr,`matchmaking/${s}`);try{const u=await Qu(d),h=[];if(u.exists()&&u.forEach(T=>{const j=T.val(),b=Date.now()-j.timestamp<5*60*1e3;j.peerId!==e&&b&&h.push({key:T.key,data:j})}),h.length>0){const T=h.sort((j,b)=>j.data.timestamp-b.data.timestamp)[0];await Gc(Lr(Dr,`matchmaking/${s}/${T.key}`)),i("matched"),o({peerId:T.data.peerId,playerName:T.data.playerName,playerClass:T.data.playerClass,isHost:!1,playerId:T.data.playerId,rating:T.data.rating});return}i("searching");const f=tA(d);this.myEntryRef=f,this.myId=f.key;const x={id:this.myId,peerId:e,playerName:n,playerClass:r,matchType:s,...l!=null&&{playerId:l},...c!=null&&{rating:c},timestamp:Date.now()};await Xu(f,x),eA(f).remove();const k=s;this.listenerUnsubscribe=TE(d,async T=>{if(this.hasMatched||!T.exists())return;let j=!1,b=null;if(T.forEach(v=>{const S=v.val();v.key===this.myId?j=!0:S.peerId!==this.myPeerId&&(!b||S.timestamp>b.data.timestamp)&&(b={key:v.key,data:S})}),!j&&this.myEntryRef){if(this.hasMatched)return;this.hasMatched=!0,i("matched"),this.cleanup();return}if(b!==null&&j){const v=T.child(this.myId).val(),S=b;if(v&&v.timestamp<S.data.timestamp){if(this.hasMatched)return;this.hasMatched=!0,await Gc(Lr(Dr,`matchmaking/${k}/${S.key}`)),await Gc(Lr(Dr,`matchmaking/${k}/${this.myId}`)),this.cleanup(),i("matched"),o({peerId:S.data.peerId,playerName:S.data.playerName,playerClass:S.data.playerClass,isHost:!0,playerId:S.data.playerId,rating:S.data.rating})}}})}catch(u){console.error("[Matchmaking] Error:",u),i("error"),this.cleanup()}}async cancelMatchmaking(){if(this.myEntryRef)try{await Gc(this.myEntryRef)}catch(e){console.error("[Matchmaking] Error removing entry:",e)}this.cleanup()}cleanup(){this.listenerUnsubscribe&&(this.listenerUnsubscribe(),this.listenerUnsubscribe=null),this.myEntryRef=null,this.myId=""}}const Kc=new vL;class b_{constructor(e,n,r=!1){ln(this,"peer");ln(this,"conn");ln(this,"isHost",!1);ln(this,"messageCallback",null);ln(this,"closeCallback",null);this.peer=e,this.conn=n,this.isHost=r,n.on("data",s=>{this.messageCallback&&this.messageCallback(s)}),n.on("close",()=>{console.log("[PeerJSAdapter] Connection closed"),this.closeCallback&&this.closeCallback()}),n.on("error",s=>console.error("[PeerJSAdapter] Connection Error:",s))}async connect(e){return this.peer.id}onConnection(e){}onClose(e){this.closeCallback=e}isConnected(){return this.conn!==null&&this.conn.open}send(e){this.conn&&this.conn.open?this.conn.send(e):console.warn("[PeerJSAdapter] Connection not open, cannot send message")}onMessage(e){this.messageCallback=e}disconnect(){var e,n;(e=this.conn)==null||e.close(),(n=this.peer)==null||n.destroy()}}const _L=1280,xL=720,E_={BRONZE:"#cd7f32",SILVER:"#c0c0c0",GOLD:"#ffd700",PLATINUM:"#e5e4e2",DIAMOND:"#b9f2ff",MASTER:"#ff4500"},bL=({matchType:t,playerClass:e,playerName:n,playerId:r,onGameStart:s,onCancel:i})=>{const[o,l]=O.useState("idle"),[c,d]=O.useState("..."),[u,h]=O.useState(0),f=O.useRef(null),x=O.useRef(null),k=O.useRef(null),T=O.useRef(!1),j=O.useRef(!1),[b,v]=O.useState(0),[S,p]=O.useState(void 0),[F,H]=O.useState(1);O.useEffect(()=>{const q=()=>{const de=window.innerWidth/_L,ve=window.innerHeight/xL;H(Math.min(de,ve))};return q(),window.addEventListener("resize",q),()=>window.removeEventListener("resize",q)},[]),O.useEffect(()=>{if(o!=="searching")return;const q=setInterval(()=>{h(de=>{const ve=de+1;return ve>=60&&(l("error"),d(""),Kc.cancelMatchmaking(),x.current&&x.current.close(),f.current&&f.current.destroy()),ve})},1e3);return()=>clearInterval(q)},[o]),O.useEffect(()=>{let q=!0,de=0;return(async()=>{try{if(t==="ranked"&&r)try{de=(await lS(r,e)).rating,v(de)}catch(w){console.error("[Matchmaking] Failed to get rating:",w)}const Ne=new JS({debug:1,config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]}});if(f.current=Ne,await new Promise((w,L)=>{Ne.on("open",()=>w()),Ne.on("error",C=>L(C))}),!q)return;const ue=Ne.id;console.log("[Matchmaking] My PeerJS ID:",ue),Ne.on("connection",w=>{console.log("[Matchmaking] Incoming connection from:",w.peer),x.current=w,w.on("open",()=>{console.log("[Matchmaking] Connection opened (as HOST)"),w.on("data",L=>{if(L.type==="PLAYER_INFO"){console.log("[Matchmaking] Received player info:",L),w.send({type:"PLAYER_INFO",playerName:n,playerClass:e,playerId:t==="ranked"?r:void 0,rating:t==="ranked"?de:void 0}),q&&t==="ranked"&&p(L.rating),j.current=!0;const C=new b_(Ne,w,!0);s(C,L.playerClass,!0,L.playerId,L.rating)}})})}),Kc.startMatchmaking(ue,n,e,t,w=>{if(q)switch(l(w),w){case"searching":d("...");break;case"matched":d("...");break;case"error":d("");break}},async w=>{if(q)if(console.log("[Matchmaking] Match found:",w),k.current=w,T.current=w.isHost,w.isHost)d("...");else{d("...");const L=Ne.connect(w.peerId,{reliable:!0});x.current=L,L.on("open",()=>{console.log("[Matchmaking] Connection opened (as JOIN)"),L.send({type:"PLAYER_INFO",playerName:n,playerClass:e,playerId:t==="ranked"?r:void 0,rating:t==="ranked"?de:void 0}),L.on("data",C=>{if(C.type==="PLAYER_INFO"){console.log("[Matchmaking] Received player info:",C),q&&t==="ranked"&&p(C.rating),j.current=!0;const R=new b_(Ne,L,!1);s(R,C.playerClass,!1,C.playerId,C.rating)}})}),L.on("error",C=>{console.error("[Matchmaking] Connection error:",C),l("error"),d("")})}},t==="ranked"&&r?r:void 0,t==="ranked"?de:void 0)}catch(Ne){console.error("[Matchmaking] Init error:",Ne),q&&(l("error"),d(""))}})(),()=>{q=!1,Kc.cancelMatchmaking(),j.current||(x.current&&x.current.close(),f.current&&f.current.destroy())}},[t,e,n,r,s]);const z=async()=>{await Kc.cancelMatchmaking(),x.current&&x.current.close(),f.current&&f.current.destroy(),i()},W=q=>{const de=Math.floor(q/60),ve=q%60;return`${de}:${ve.toString().padStart(2,"0")}`};return a.jsxs("div",{className:"screen",style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white"},children:[a.jsx("div",{style:{fontSize:`${1.2*F}rem`,color:"#4ade80",marginBottom:`${1*F}rem`,fontWeight:"bold"},children:t==="casual"?"":""}),a.jsx("div",{style:{fontSize:`${2*F}rem`,fontWeight:"bold",marginBottom:`${1*F}rem`,textAlign:"center"},children:c}),o==="searching"&&a.jsxs("div",{style:{fontSize:`${1.5*F}rem`,color:"#888",marginBottom:`${2*F}rem`},children:[": ",W(u)]}),(o==="searching"||o==="matched")&&a.jsx("div",{style:{width:80*F,height:80*F,border:"4px solid rgba(255,255,255,0.2)",borderTop:"4px solid #4ade80",borderRadius:"50%",animation:"spin 1s linear infinite",marginBottom:`${2*F}rem`}}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*F}rem`,marginBottom:`${2*F}rem`,padding:`${1*F}rem`,background:"rgba(255,255,255,0.1)",borderRadius:8*F},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:`${1*F}rem`},children:[a.jsx("div",{style:{fontSize:`${1*F}rem`},children:n||""}),a.jsx("div",{style:{fontSize:`${.9*F}rem`,color:e==="SENKA"?"#e94560":e==="AJA"?"#45a2e9":"#a855f7"},children:e==="SENKA"?"":e==="AJA"?"":"Y"})]}),t==="ranked"&&b>0&&a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:`${.5*F}rem`,fontSize:`${.85*F}rem`,color:"#aaa"},children:[a.jsx("span",{style:{fontWeight:"bold",color:E_[Mr(b)],fontFamily:"Tamanegi, sans-serif"},children:Po[Mr(b)]}),a.jsx("span",{style:{fontFamily:"Tamanegi, sans-serif"},children:b})]}),t==="ranked"&&o==="matched"&&S!==void 0&&a.jsxs("div",{style:{marginTop:`${.5*F}rem`,padding:`${.5*F}rem ${1*F}rem`,background:"rgba(0, 0, 0, 0.3)",borderRadius:4*F,fontSize:`${.8*F}rem`,color:"#aaa"},children:[": ",a.jsx("span",{style:{fontWeight:"bold",color:E_[Mr(S)],fontFamily:"Tamanegi, sans-serif"},children:Po[Mr(S)]})," ",S]})]}),o!=="error"&&a.jsx("button",{onClick:z,style:{padding:`${.8*F}rem ${2*F}rem`,fontSize:`${1*F}rem`,background:"transparent",border:"2px solid #e94560",color:"#e94560",borderRadius:8*F,cursor:"pointer",transition:"all 0.2s"},onMouseOver:q=>{q.currentTarget.style.background="#e94560",q.currentTarget.style.color="white"},onMouseOut:q=>{q.currentTarget.style.background="transparent",q.currentTarget.style.color="#e94560"},children:""}),o==="error"&&a.jsx("button",{onClick:i,style:{padding:`${.8*F}rem ${2*F}rem`,fontSize:`${1*F}rem`,background:"#e94560",border:"none",color:"white",borderRadius:8*F,cursor:"pointer"},children:""}),a.jsx("style",{children:`
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `})]})},S_=20,K0=[{id:1,filename:"1_yoroshiku.png",label:"",se:"pa.mp3"},{id:2,filename:"2_nandato.png",label:"",se:"shock.mp3"},{id:3,filename:"3_thank.png",label:"",se:"thanks.mp3"},{id:4,filename:"4_willwin.png",label:"",se:"nt.mp3"},{id:5,filename:"5_dontmind.png",label:"",se:"boyon.mp3"},{id:6,filename:"6_thinking.png",label:"",se:"thinking.mp3"},{id:7,filename:"7_gg.png",label:"GG",se:"kiri.mp3"},{id:8,filename:"8_sorry.png",label:"",se:"gomen.mp3"}],I_=(t,e)=>{const n=K0.find(s=>s.id===t);return n?`/stamps/${e==="AJA"?"azya":e.toLowerCase()}/${n.filename}`:""},T_=t=>{const e=K0.find(n=>n.id===t);return(e==null?void 0:e.se)||null},tr=[{id:"s_3cats",name:"",cost:2,type:"SPELL",description:"1",flavorText:"",imageUrl:"/cards/chatora_three_cats.png",triggers:[{trigger:"FANFARE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_CHATORA"},{type:"GENERATE_CARD",targetCardId:"TOKEN_SABATORA"},{type:"GENERATE_CARD",targetCardId:"TOKEN_KIJITORA"}]}]},{id:"s_final_cannon",name:"",cost:10,type:"SPELL",description:"1",flavorText:'""""',imageUrl:"/cards/final_cannon.png",triggers:[{trigger:"FANFARE",effects:[{type:"SET_MAX_HP",value:1,targetType:"OPPONENT"}]}]},{id:"c_senka_knuckler",name:"",cost:8,type:"FOLLOWER",attack:3,health:5,description:`[] []
2
[]
1`,flavorText:`

`,imageUrl:"/cards/senka.png",evolvedImageUrl:"/cards/senka_2.png",tags:["Knuckler"],passiveAbilities:["STORM","DOUBLE_ATTACK"],attackEffectType:"IMPACT",triggers:[{trigger:"SUPER_EVOLVE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_FLICKER_JAB"},{type:"GENERATE_CARD",targetCardId:"TOKEN_QUAKE_HOWLING"},{type:"GENERATE_CARD",targetCardId:"TOKEN_BACKHAND_SMASH"}]}]},{id:"c_ruiyu",name:"",cost:7,type:"FOLLOWER",attack:5,health:5,description:`4cyoriena
14`,flavorText:`
`,imageUrl:"/cards/ruiyu.png",evolvedImageUrl:"/cards/ruiyu_2.png",attackEffectType:"BLUE_FIRE",relatedCards:["c_cyoriena"],triggers:[{trigger:"FANFARE",effects:[{type:"HEAL_LEADER",value:4,targetType:"SELF"},{type:"SUMMON_CARD",targetCardId:"c_cyoriena"}]},{trigger:"EVOLVE",effects:[{type:"DESTROY",targetType:"SELECT_FOLLOWER"},{type:"HEAL_LEADER",value:4,targetType:"SELF"}]}]},{id:"c_y",name:"Y",cost:6,type:"FOLLOWER",attack:3,health:3,description:`[]
142
3`,flavorText:"",imageUrl:"/cards/y.png",evolvedImageUrl:"/cards/y_2.png",passiveAbilities:["STEALTH"],attackEffectType:"SUMI",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:4,targetType:"SELECT_FOLLOWER"},{type:"AOE_DAMAGE",value:2,targetType:"ALL_FOLLOWERS"}]},{trigger:"EVOLVE",effects:[{type:"AOE_DAMAGE",value:3,targetType:"ALL_FOLLOWERS"}]}]},{id:"c_tsubumaru",name:"",cost:2,type:"FOLLOWER",attack:1,health:3,description:`[]
1
1`,flavorText:`

`,imageUrl:"/cards/tsubumaru.png",evolvedImageUrl:"/cards/tsubumaru_2.png",passiveAbilities:["WARD"],attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"GENERATE_CARD",targetCardId:"s_resignation_proxy"}]}]},{id:"c_barura",name:"",cost:4,type:"FOLLOWER",attack:3,health:4,description:`1
13`,flavorText:`

`,imageUrl:"/cards/barura.png",evolvedImageUrl:"/cards/barura_2.png",attackEffectType:"FIRE",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:3,targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_CHATORA",name:"",cost:0,type:"FOLLOWER",attack:1,health:1,description:"",flavorText:"",imageUrl:"/cards/chatora.png",attackEffectType:"SLASH"},{id:"TOKEN_SABATORA",name:"",cost:1,type:"FOLLOWER",attack:1,health:2,description:"[]",flavorText:"",passiveAbilities:["RUSH"],imageUrl:"/cards/sabatora.png",attackEffectType:"SLASH"},{id:"TOKEN_KIJITORA",name:"",cost:3,type:"FOLLOWER",attack:2,health:3,description:"[]",flavorText:"",passiveAbilities:["WARD"],imageUrl:"/cards/kijitora.png",attackEffectType:"SLASH"},{id:"TOKEN_RICE",name:"",cost:0,type:"SPELL",description:"1",flavorText:" ",imageUrl:"/cards/rice.png",triggers:[{trigger:"FANFARE",effects:[{type:"HEAL_LEADER",value:1,targetType:"SELF"}]}]},{id:"c_yunagi",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:`1
11`,flavorText:`


`,imageUrl:"/cards/yunagi.png",evolvedImageUrl:"/cards/yunagi_2.png",attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:1,targetType:"SELECT_FOLLOWER"},{type:"GENERATE_CARD",targetCardId:"TOKEN_OOMORI_RICE"}]}]},{id:"TOKEN_OOMORI_RICE",name:"",cost:1,type:"SPELL",description:"3",flavorText:"",imageUrl:"/cards/oomoririce.png",tags:["Token"],triggers:[{trigger:"FANFARE",effects:[{type:"HEAL_LEADER",value:3,targetType:"SELF"}]}]},{id:"c_nayuta",name:"",cost:4,type:"FOLLOWER",attack:3,health:3,description:`[]
1
1`,flavorText:"",imageUrl:"/cards/nayuta.png",evolvedImageUrl:"/cards/nayuta_2.png",attackEffectType:"RAY",passiveAbilities:["WARD"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]},{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]}]},{id:"c_yunagi_ward",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:`[]
1`,imageUrl:"/cards/yunagi.png",evolvedImageUrl:"/cards/yunagi_2.png",passiveAbilities:["WARD"],triggers:[{trigger:"FANFARE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_RICE"}]}]},{id:"c_nayuta_ward",name:"",cost:4,type:"FOLLOWER",attack:3,health:3,description:`[]
1
1`,imageUrl:"/cards/nayuta.png",evolvedImageUrl:"/cards/nayuta_2.png",passiveAbilities:["WARD"],attackEffectType:"RAY",triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]},{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]}]},{id:"c_azya",name:"",cost:8,type:"FOLLOWER",attack:4,health:4,description:`[]
3211-2
1+1/+2[][]0`,flavorText:`
&&`,imageUrl:"/cards/azya.png",evolvedImageUrl:"/cards/azya_2.png",attackEffectType:"THUNDER",passiveAbilities:["AURA"],relatedCards:["c_tsubumaru","c_yunagi","c_nayuta"],triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:3,targetType:"OPPONENT"},{type:"HEAL_LEADER",value:2,targetType:"SELF"},{type:"RANDOM_DESTROY",value:1},{type:"RANDOM_BOUNCE",value:1},{type:"REDUCE_HAND_COST",value:2,conditions:{nameIn:["","",""]}}]},{trigger:"SUPER_EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_tsubumaru"},{type:"SUMMON_CARD",targetCardId:"c_yunagi"},{type:"SUMMON_CARD",targetCardId:"c_nayuta"},{type:"BUFF_STATS",value:1,value2:2,targetType:"ALL_OTHER_FOLLOWERS"},{type:"GRANT_PASSIVE",targetPassive:"WARD",targetType:"ALL_OTHER_FOLLOWERS"},{type:"GRANT_PASSIVE",targetPassive:"RUSH",targetType:"ALL_OTHER_FOLLOWERS"},{type:"GENERATE_CARD",targetCardId:"s_yucho_of_the_abyss"},{type:"GENERATE_CARD",targetCardId:"s_thats_mine"},{type:"GRANT_LEADER_DAMAGE_SHIELD"}]}]},{id:"c_yuki",name:"",cost:3,type:"FOLLOWER",attack:3,health:2,description:`[]
+1/+1`,flavorText:"",imageUrl:"/cards/yuki.png",evolvedImageUrl:"/cards/yuki_2.png",tags:["Knuckler"],passiveAbilities:["RUSH"],attackEffectType:"IMPACT",triggers:[{trigger:"EVOLVE",effects:[{type:"BUFF_STATS",value:1,value2:1,targetType:"ALL_FOLLOWERS"}]}]},{id:"c_white_tsubaki",name:"",cost:4,type:"FOLLOWER",attack:4,health:3,description:`[]

01
1`,flavorText:`
`,imageUrl:"/cards/white_tsubaki.png",evolvedImageUrl:"/cards/white_tsubaki_2.png",tags:["Knuckler"],passiveAbilities:["RUSH","IMMUNE_TO_FOLLOWER_DAMAGE","GUTS_MY_TURN"],attackEffectType:"ICE",relatedCards:["c_shieko"],triggers:[{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_shieko"}]}]},{id:"c_shieko",name:"",cost:2,type:"FOLLOWER",attack:2,health:1,description:`[]
1+2/+2`,flavorText:`
`,imageUrl:"/cards/shieko.png",evolvedImageUrl:"/cards/shieko_2.png",tags:["Knuckler"],passiveAbilities:["RUSH"],attackEffectType:"IMPACT",triggers:[{trigger:"EVOLVE",effects:[{type:"BUFF_STATS",value:2,value2:2,targetType:"SELECT_OTHER_ALLY_FOLLOWER"}]}]},{id:"c_urara",name:"",cost:3,type:"FOLLOWER",attack:2,health:2,description:`[] []
2`,flavorText:`
`,imageUrl:"/cards/urara.png",evolvedImageUrl:"/cards/urara_2.png",passiveAbilities:["WARD","BARRIER"],attackEffectType:"WATER",triggers:[{trigger:"EVOLVE",effects:[{type:"HEAL_LEADER",value:2}]}]},{id:"c_kasuga",name:"",cost:10,type:"FOLLOWER",attack:8,health:8,description:"",flavorText:`

`,imageUrl:"/cards/kasuga.png",evolvedImageUrl:"/cards/kasuga_2.png",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY",targetType:"ALL_OTHER_FOLLOWERS"}]}],attackEffectType:"SLASH"},{id:"c_kyokune",name:"",cost:4,type:"FOLLOWER",attack:4,health:4,description:"1",imageUrl:"/cards/kyokune.jpg",relatedCards:["c_sia"],triggers:[{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_sia"}]}],attackEffectType:"SLASH"},{id:"c_sia",name:"",cost:2,type:"FOLLOWER",attack:2,health:1,description:"21",flavorText:"",imageUrl:"/cards/sia.png",evolvedImageUrl:"/cards/sia_2.png",attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DAMAGE",value:1,value2:2,targetType:"OPPONENT"}]}]},{id:"TOKEN_BACKHAND_SMASH",name:"",cost:0,type:"SPELL",description:"16",flavorText:`10
`,imageUrl:"/cards/BackhandSmash.jpg",tags:["Token"],attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:6,targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_QUAKE_HOWLING",name:"",cost:0,type:"SPELL",description:"2",flavorText:"",imageUrl:"/cards/QuakeHowling.png",tags:["Token"],attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"AOE_DAMAGE",value:2,targetType:"ALL_FOLLOWERS"}]}]},{id:"TOKEN_FLICKER_JAB",name:"",cost:0,type:"SPELL",description:"12",flavorText:`
BHS
`,imageUrl:"/cards/FlickerJab.png",tags:["Token"],attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:2,targetType:"SELECT_FOLLOWER"}]}]},{id:"c_bucchi",name:"",cost:5,type:"FOLLOWER",attack:1,health:3,description:"3",flavorText:`
`,imageUrl:"/cards/bucchi.png",evolvedImageUrl:"/cards/bucchi_2.png",attackEffectType:"SLASH",relatedCards:["c_manary"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_manary"},{type:"SUMMON_CARD",targetCardId:"c_manary"},{type:"SUMMON_CARD",targetCardId:"c_manary"}]}]},{id:"c_valkyrie",name:"",cost:6,type:"FOLLOWER",attack:6,health:6,description:`[] [] []
[]`,flavorText:"",imageUrl:"/cards/valkyrie.png",evolvedImageUrl:"/cards/valkyrie_2.png",passiveAbilities:["WARD","BARRIER","AURA"],attackEffectType:"RAY",triggers:[{trigger:"END_OF_TURN",effects:[{type:"GRANT_PASSIVE",targetPassive:"BARRIER",targetType:"SELF"}]}]},{id:"c_manary",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:"[]",flavorText:"^^",imageUrl:"/cards/manary.png",evolvedImageUrl:"/cards/manary_2.png",tags:["Token"],passiveAbilities:["WARD"],attackEffectType:"WATER"},{id:"c_potechi",name:"",cost:3,type:"FOLLOWER",attack:2,health:3,description:`[]
1`,flavorText:"",imageUrl:"/cards/potechi.png",evolvedImageUrl:"/cards/potechi_2.png",passiveAbilities:["WARD"],attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]}]},{id:"c_mono",name:"Mono",cost:3,type:"FOLLOWER",attack:2,health:1,description:`15
15`,flavorText:"",imageUrl:"/cards/Mono.png",evolvedImageUrl:"/cards/Mono_2.png",attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:5,targetType:"SELECT_FOLLOWER"}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:5,targetType:"SELECT_FOLLOWER"}]}]},{id:"c_sara",name:"sara",cost:7,type:"FOLLOWER",attack:4,health:6,description:`2111
1`,flavorText:"w",imageUrl:"/cards/sara.png",evolvedImageUrl:"/cards/sara_2.png",attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DESTROY",value:2,targetType:"OPPONENT"},{type:"GENERATE_CARD",targetCardId:"TOKEN_SORRY_THE_END",conditions:{minTurn:11}}]},{trigger:"SUPER_EVOLVE",effects:[{type:"DESTROY",targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_SORRY_THE_END",name:"",cost:3,type:"SPELL",description:"553sara1",flavorText:'""',imageUrl:"/cards/sorryTheEnd.png",tags:["Token"],attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"AOE_DAMAGE",value:5,targetType:"ALL_FOLLOWERS"},{type:"DAMAGE",value:5,targetType:"OPPONENT"},{type:"DRAW",value:3},{type:"SUMMON_CARD",targetCardId:"c_sara"}]}]},{id:"c_blue_tsubaki",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:`1
1`,flavorText:"",imageUrl:"/cards/blue_tsubaki.png",evolvedImageUrl:"/cards/blue_tsubaki_2.png",attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"RANDOM_DESTROY",value:1,targetType:"OPPONENT"}]}]},{id:"s_resignation_proxy",name:"",cost:0,type:"SPELL",description:"11",flavorText:"1",imageUrl:"/cards/taisyokudaiko.png",tags:["Token"],attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DESTROY",targetType:"OPPONENT",value:1},{type:"DRAW",value:1}]}]},{id:"s_yucho_of_the_abyss",name:"",cost:0,type:"SPELL",description:"11",flavorText:"",imageUrl:"/cards/yuchooftheabyss.png",tags:["Token"],attackEffectType:"THUNDER",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DAMAGE_BY_TURN",value:1,targetType:"OPPONENT"}]}]},{id:"s_thats_mine",name:"",cost:2,type:"SPELL",description:"1",flavorText:"",imageUrl:"/cards/thatsmine.png",tags:["Token"],attackEffectType:"ICE",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY_AND_GENERATE",value:0,targetType:"SELECT_FOLLOWER"}]}]},{id:"s_tenfubu_yabe_hutari",name:"2",cost:4,type:"SPELL",description:"11",flavorText:"",imageUrl:"/cards/tenfubuyabehutari.png",relatedCards:["c_yuki","c_potechi"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_yuki"},{type:"SUMMON_CARD",targetCardId:"c_potechi"}]}]},{id:"s_samurai_tea",name:"",cost:2,type:"SPELL",description:"1+1/+1",flavorText:'""""',imageUrl:"/cards/samuraitea.png",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1},{type:"BUFF_STATS",value:1,value2:1,targetType:"ALL_FOLLOWERS"}]}]},{id:"s_crazy_knucklers",name:"",cost:5,type:"SPELL",description:"+1/+11",flavorText:`
www www`,imageUrl:"/cards/crazy_knucklers.png",relatedCards:["c_white_tsubaki","c_shieko"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD_BUFFED",targetCardId:"c_white_tsubaki",value:1,value2:1},{type:"SUMMON_CARD_BUFFED",targetCardId:"c_shieko",value:1,value2:1},{type:"DRAW",value:1}]}]},{id:"s_knuckle_four",name:"",cost:10,type:"SPELL",description:"444",flavorText:"",imageUrl:"/cards/knucklefour.png",attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DESTROY",value:4,targetType:"OPPONENT"},{type:"DRAW",value:4},{type:"HEAL_LEADER",value:4,targetType:"SELF"}]}]},{id:"c_amandava",name:"amandava",cost:5,attack:2,health:3,type:"FOLLOWER",description:`21
1`,flavorText:"",imageUrl:"/cards/amandava.png",evolvedImageUrl:"/cards/amandava_2.png",attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_SET_HP",value:2,value2:1,targetType:"OPPONENT"}]},{trigger:"EVOLVE",effects:[{type:"AOE_DAMAGE",value:1,targetType:"ALL_FOLLOWERS"}]}]},{id:"c_alice",name:"",cost:3,attack:1,health:1,type:"FOLLOWER",description:`22
22`,flavorText:"",imageUrl:"/cards/alice.png",evolvedImageUrl:"/cards/alice_2.png",attackEffectType:"FIRE",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DAMAGE",value:2,value2:2,targetType:"OPPONENT"}]},{trigger:"EVOLVE",effects:[{type:"RANDOM_DAMAGE",value:2,value2:2,targetType:"OPPONENT"}]}]},{id:"c_yuri",name:"",cost:5,type:"FOLLOWER",attack:3,health:3,description:`1
13`,flavorText:`
`,imageUrl:"/cards/yuri.png",evolvedImageUrl:"/cards/yuri_2.png",attackEffectType:"WATER",relatedCards:["TOKEN_SUIHYORYU"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"TOKEN_SUIHYORYU"}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:3,targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_SUIHYORYU",name:"",cost:5,type:"FOLLOWER",attack:4,health:4,description:`[] []
`,flavorText:"",imageUrl:"/cards/suihyoryu.png",evolvedImageUrl:"/cards/suihyoryu.png",tags:["Token"],passiveAbilities:["RUSH","WARD"],attackEffectType:"ICE",triggers:[{trigger:"START_OF_TURN",effects:[{type:"DESTROY_SELF"}]}]},{id:"c_cyoriena",name:"cyoriena",cost:2,type:"FOLLOWER",attack:1,health:2,description:`[] []
HP2
`,flavorText:"7",imageUrl:"/cards/cyoriena.png",evolvedImageUrl:"/cards/cyoriena_2.png",tags:["Token"],passiveAbilities:["WARD","BARRIER"],attackEffectType:"RAY",triggers:[{trigger:"END_OF_TURN",effects:[{type:"HEAL_LEADER",value:2,targetType:"SELF"}]},{trigger:"EVOLVE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_TSUBASA"}]}]},{id:"TOKEN_TSUBASA",name:"",cost:1,type:"SPELL",description:"1[]",flavorText:"",imageUrl:"/cards/tsubasa.png",tags:["Token"],triggers:[{trigger:"FANFARE",effects:[{type:"GRANT_PASSIVE",targetPassive:"STORM",targetType:"SELECT_ALLY_FOLLOWER"}]}]},{id:"c_yamato",name:"",cost:5,type:"FOLLOWER",attack:5,health:1,description:"[]",imageUrl:"/cards/yamato.jpg",passiveAbilities:["STORM"],attackEffectType:"SLASH"},{id:"c_yoruka",name:"yoRuka",cost:8,type:"FOLLOWER",attack:5,health:5,description:`1
 8yoRuka1
2`,flavorText:"Y",imageUrl:"/cards/yoRuka.png",evolvedImageUrl:"/cards/yoRuka_2.png",attackEffectType:"SUMI",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY",targetType:"SELECT_FOLLOWER"}]},{trigger:"LAST_WORD",effects:[{type:"SUMMON_CARD",targetCardId:"c_yoruka",necromance:8}]},{trigger:"SUPER_EVOLVE",effects:[{type:"RANDOM_DESTROY",value:2,targetType:"OPPONENT"}]}]},{id:"c_haruka",name:"",cost:7,type:"FOLLOWER",attack:2,health:3,description:`[]
[]1
4
1 4+2/+0`,flavorText:"",imageUrl:"/cards/haruka.png",evolvedImageUrl:"/cards/haruka_2.png",passiveAbilities:["STEALTH"],attackEffectType:"SLASH",relatedCards:["c_yuka","c_setsuna"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD_RUSH",targetCardId:"c_yuka"},{type:"SUMMON_CARD",targetCardId:"c_setsuna"}]},{trigger:"LAST_WORD",effects:[{type:"ADD_GRAVEYARD",value:4}]},{trigger:"SUPER_EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_setsuna"},{type:"BUFF_STATS",value:2,value2:0,targetType:"ALL_OTHER_FOLLOWERS",necromance:4}]}]},{id:"c_setsuna",name:"",cost:3,type:"FOLLOWER",attack:1,health:1,description:`[] []
-12`,flavorText:"",imageUrl:"/cards/setsuna.png",evolvedImageUrl:"/cards/setsuna_2.png",passiveAbilities:["STORM","BANE"],attackEffectType:"SUMI",triggers:[{trigger:"LAST_WORD",effects:[{type:"BUFF_STATS",value:-1,value2:0,targetType:"RANDOM_FOLLOWER"},{type:"ADD_GRAVEYARD",value:2}]}]},{id:"c_yuka",name:"",cost:5,type:"FOLLOWER",attack:1,health:6,description:`[] []
1
3
132`,flavorText:"",imageUrl:"/cards/yuka.png",evolvedImageUrl:"/cards/yuka_2.png",passiveAbilities:["WARD","AURA"],attackEffectType:"SHOT",relatedCards:["c_setsuna"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_setsuna"}]},{trigger:"LAST_WORD",effects:[{type:"ADD_GRAVEYARD",value:3}]},{trigger:"EVOLVE",effects:[{type:"RANDOM_DAMAGE",value:3,value2:1,targetType:"OPPONENT"},{type:"RANDOM_DAMAGE",value:3,value2:1,targetType:"OPPONENT"}]}]},{id:"s_hayakikoto",name:"",cost:4,type:"SPELL",description:"21",flavorText:"",imageUrl:"/cards/hayakikoto.png",relatedCards:["c_setsuna"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_setsuna"},{type:"SUMMON_CARD",targetCardId:"c_setsuna"},{type:"DRAW",value:1}]}]},{id:"s_keishou",name:"",cost:9,type:"SPELL",description:"1-9",flavorText:`
`,imageUrl:"/cards/keisyopower.png",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY_AND_GENERATE",targetType:"RANDOM_ENEMY_FOLLOWER",value:-9}]}]},{id:"s_night_parade",name:"",cost:10,type:"SPELL",description:` 41
+1/+0`,flavorText:"",imageUrl:"/cards/nightparade.png",relatedCards:["c_setsuna"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD_FILL_BOARD",targetCardId:"c_setsuna",necromance:4},{type:"BUFF_STATS",value:1,value2:0,targetType:"ALL_FOLLOWERS"}]}]}];function X0(t){let e=t;return()=>(e=(e*1664525+1013904223)%4294967296,e/4294967296)}function EL(t,e){let n=t.length,r;for(;n!=0;)r=Math.floor(e()*n),n--,[t[n],t[r]]=[t[r],t[n]];return t}function SL(t){var s;const e=t.players.p1,n=t.players.p2;return[t.turnCount,t.activePlayerId,e.hp,e.maxHp,e.pp,e.maxPp,e.sep,e.evolutionsUsed,n.hp,n.maxHp,n.pp,n.maxPp,n.sep,n.evolutionsUsed,e.board.map(i=>i?`${i.id}_${i.instanceId}_${i.currentHealth}_${i.hasBarrier?"B":""}`:"null").join(","),n.board.map(i=>i?`${i.id}_${i.instanceId}_${i.currentHealth}_${i.hasBarrier?"B":""}`:"null").join(","),e.hand.length,n.hand.length,((s=t.pendingEffects)==null?void 0:s.length)||0,t.rngSeed].join("|")}const ZS=[{cardId:"c_senka_knuckler",count:3},{cardId:"c_yuki",count:3},{cardId:"c_white_tsubaki",count:3},{cardId:"c_shieko",count:3},{cardId:"s_samurai_tea",count:3},{cardId:"c_bucchi",count:2},{cardId:"c_valkyrie",count:1},{cardId:"c_potechi",count:3},{cardId:"s_tenfubu_yabe_hutari",count:3},{cardId:"s_crazy_knucklers",count:2},{cardId:"c_sia",count:2},{cardId:"c_mono",count:3},{cardId:"c_ruiyu",count:1},{cardId:"c_kasuga",count:1},{cardId:"c_y",count:2},{cardId:"c_sara",count:1},{cardId:"s_knuckle_four",count:1},{cardId:"c_blue_tsubaki",count:3}],eI=[{cardId:"c_azya",count:3},{cardId:"c_ruiyu",count:2},{cardId:"c_y",count:2},{cardId:"c_sara",count:2},{cardId:"c_urara",count:3},{cardId:"c_yunagi",count:3},{cardId:"c_tsubumaru",count:3},{cardId:"c_nayuta",count:3},{cardId:"c_yuri",count:2},{cardId:"c_alice",count:3},{cardId:"c_kasuga",count:1},{cardId:"c_barura",count:3},{cardId:"c_valkyrie",count:3},{cardId:"s_3cats",count:2},{cardId:"s_final_cannon",count:1},{cardId:"c_amandava",count:2},{cardId:"c_mono",count:2}],tI=[{cardId:"c_yoruka",count:3},{cardId:"c_y",count:3},{cardId:"c_haruka",count:3},{cardId:"c_yuka",count:3},{cardId:"c_setsuna",count:3},{cardId:"s_hayakikoto",count:3},{cardId:"s_night_parade",count:1},{cardId:"c_kasuga",count:1},{cardId:"c_yunagi",count:3},{cardId:"c_tsubumaru",count:3},{cardId:"c_nayuta",count:3},{cardId:"c_mono",count:3},{cardId:"c_ruiyu",count:1},{cardId:"c_sara",count:1},{cardId:"s_3cats",count:2},{cardId:"c_yuri",count:2},{cardId:"c_sia",count:2}];function Kr(t){const e=tr.find(n=>n.id===t);return e||tr.find(n=>n.name===t)}function nI(){return tr.map(t=>t.name).sort((t,e)=>e.length-t.length)}function Xc(t){return{STORM:"",RUSH:"",WARD:"",BARRIER:"",AURA:"",STEALTH:"",BANE:"",DOUBLE_ATTACK:"",IMMUNE_TO_FOLLOWER_DAMAGE:"",GUTS_MY_TURN:""}[t]||t}function IL(t,e){const n=[];let r=0;return t.forEach(s=>{const i=Kr(s.cardId);if(i)for(let o=0;o<s.count;o++)n.push({...i,id:`${e}_c${r}`,instanceId:`inst_${e}_c${r}`}),r++;else console.warn(`Card definition not found: ${s.cardId}`)}),n}function w_(t,e,n,r){const i=IL(n==="SENKA"?ZS:n==="AJA"?eI:tI,t);return{id:t,name:e,class:n,hp:S_,maxHp:S_,pp:0,maxPp:0,sep:2,deck:EL(i,r),hand:[],graveyard:[],board:[],evolutionsUsed:0,canEvolveThisTurn:!1,extraPpUsedEarly:!1,extraPpUsedLate:!1,extraPpActive:!1}}function bd(t,e,n,r,s,i=!0){const o=Math.floor(Math.random()*1e6),l=X0(o),c=w_("p1",t,e,l),d=w_("p2",n,r,l);c.hand=c.deck.splice(0,4),d.hand=d.deck.splice(0,4);let u,h;return i?(u="p1",h=t,c.maxPp=1,c.pp=1,d.maxPp=0,d.pp=0):(u="p2",h=n,c.maxPp=0,c.pp=0,d.maxPp=1,d.pp=1),{phase:"INIT",rngSeed:Math.floor(l()*1e6),activePlayerId:u,firstPlayerId:u,players:{p1:c,p2:d},turnCount:1,pendingEffects:[],logs:[` 1 - ${h} `],winnerId:void 0}}function Xp(t){return t==="p1"?"p2":"p1"}function TL(t,e,n,r,s,i){var h,f,x,k,T,j,b,v,S,p,F,H,z,W,q,de,ve,Ne,ue,w,L;let o={...t,players:{p1:{...t.players.p1,hand:[...t.players.p1.hand],deck:[...t.players.p1.deck],board:t.players.p1.board.map(C=>C?{...C,passiveAbilities:C.passiveAbilities?[...C.passiveAbilities]:[]}:null),graveyard:[...t.players.p1.graveyard]},p2:{...t.players.p2,hand:[...t.players.p2.hand],deck:[...t.players.p2.deck],board:t.players.p2.board.map(C=>C?{...C,passiveAbilities:C.passiveAbilities?[...C.passiveAbilities]:[]}:null),graveyard:[...t.players.p2.graveyard]}},logs:[...t.logs||[]]};const l=X0(o.rngSeed||999);o.rngSeed=Math.floor(l()*1e6);const c=Xp(e),d=C=>{for(const R of["p1","p2"]){const y=o.players[R].board.findIndex(g=>(g==null?void 0:g.instanceId)===C);if(y!==-1&&o.players[R].board[y])return{card:o.players[R].board[y],player:o.players[R],index:y}}return null};if(r.necromance!==void 0&&r.necromance>0&&r.type!=="SUMMON_CARD_FILL_BOARD"){const C=o.players[e];if(C.graveyard.length<r.necromance)return console.log(`[Engine] : ${C.graveyard.length} < ${r.necromance}`),o;const R=C.graveyard.splice(-r.necromance,r.necromance);o.logs.push(`${C.name}  ${r.necromance} `),console.log(`[Engine] : ${R.map(y=>y.name).join(", ")} `)}const u=(C,R)=>{var g;const y=(g=C.triggers)==null?void 0:g.find(I=>I.trigger==="LAST_WORD");if(y){const I=y.effects.map(A=>({sourceCard:C,effect:A,sourcePlayerId:R}));o.pendingEffects=[...o.pendingEffects||[],...I],o.logs.push(`${C.name} `),console.log(`[Engine] processSingleEffect: Last Word triggered for ${C.name}. pendingEffects count: ${o.pendingEffects.length}`)}};switch(r.type){case"DAMAGE":{const C=r.value||0;if(r.targetType==="SELECT_FOLLOWER"&&s){const R=d(s);if(R){const{card:y,player:g,index:I}=R;if(y.hasBarrier)y.hasBarrier=!1,o.logs.push(`${y.name} `);else if(y.currentHealth-=C,o.logs.push(`${n.name}  ${y.name}  ${C} `),y.currentHealth<=0){y.currentHealth=Math.min(0,y.currentHealth);const A=Object.keys(o.players).find(D=>o.players[D]===g)||c;u(y,A),g.graveyard.push(y),g.board[I]=null,o.logs.push(`${y.name} `)}}}else if(r.targetType==="OPPONENT"){const R=o.players[c];if(R.leaderDamageShield)R.leaderDamageShield=!1,o.logs.push(`${n.name}  ${C} `);else{const y=R.board.some(I=>{var A;return(A=I==null?void 0:I.passiveAbilities)==null?void 0:A.includes("LEADER_DAMAGE_CAP")}),g=y?Math.min(C,1):C;R.hp-=g,y&&C>1?o.logs.push(`${n.name}  ${C} 1`):o.logs.push(`${n.name}  ${g} `),R.hp<=0&&(o.winnerId=e,o.logs.push(`${R.name} `))}}break}case"AOE_DAMAGE":{const C=r.value||0;if(r.targetType==="ALL_FOLLOWERS"){const R=o.players[c].board,y=i&&i.length>0?new Set(i):null;R.forEach(I=>{if(I){if(y&&!y.has(I.instanceId))return;I.hasBarrier?(I.hasBarrier=!1,o.logs.push(`${I.name} `)):I.currentHealth-=C}}),R.filter(I=>I&&I.currentHealth<=0).forEach(I=>{I&&(I.currentHealth=Math.min(0,I.currentHealth),u(I,c),o.players[c].graveyard.push(I),o.logs.push(`${I.name} `))}),o.logs.push(`${n.name}  ${C} `),R.forEach((I,A)=>{I&&I.currentHealth<=0&&(R[A]=null)})}break}case"DRAW":{const C=r.value||1,R=o.players[e];for(let y=0;y<C;y++)if(R.deck.length>0){const g=R.deck.pop();g&&(R.hand.length<9?R.hand.push(g):(R.graveyard.push(g),o.logs.push(`${R.name}${g.name}`)))}o.logs.push(`${R.name}  ${C} `);break}case"ADD_GRAVEYARD":{const C=r.value||1,R=o.players[e];for(let y=0;y<C;y++){const g={...n,instanceId:`grave_${o.rngSeed}_${Math.floor(l()*1e3)}_${y}`};R.graveyard.push(g)}o.logs.push(`${R.name}  ${C} `);break}case"HEAL_LEADER":{const C=r.value||0,R=o.players[e];R.hp=Math.min(R.maxHp,R.hp+C),o.logs.push(`${R.name}  ${C} HP`);break}case"DESTROY":{const C=(R,y)=>{var g;return((g=R.passiveAbilities)==null?void 0:g.includes("IMMUNE_TO_DAMAGE_MY_TURN"))===!0&&o.activePlayerId===y};if(r.targetType==="ALL_OTHER_FOLLOWERS"){const R=o.players[c].board,y=[];R.forEach(D=>{D&&(C(D,c)?(y.push(D),o.logs.push(`${D.name} `)):(u(D,c),o.players[c].graveyard.push(D)))}),o.players[c].board=y;const g=o.players[e].board,I=[],A=n.instanceId;g.forEach(D=>{D&&(A&&D.instanceId===A?I.push(D):C(D,e)?(I.push(D),o.logs.push(`${D.name} `)):(u(D,e),o.players[e].graveyard.push(D)))}),o.players[e].board=I,o.logs.push(`${n.name} `)}else if((r.targetType==="SELECT_FOLLOWER"||r.targetType==="SELECT_ALLY_FOLLOWER")&&s){const R=d(s);if(R){const{card:y,player:g,index:I}=R,A=Object.keys(o.players).find(D=>o.players[D].board.includes(y))||"";C(y,A)?o.logs.push(`${y.name} `):(y.currentHealth=1,u(y,A),g.graveyard.push(y),g.board[I]=null,o.logs.push(`${y.name}  ${n.name} `))}}break}case"GENERATE_CARD":{if((h=r.conditions)!=null&&h.minTurn&&t.turnCount<r.conditions.minTurn)break;const C=r.targetCardId,R=tr.find(y=>y.id===C);if(R){const y=o.players[e],g=`gen_${o.rngSeed}_${Date.now()}_${Math.floor(l()*1e4)}`,I={...R,id:`token_${o.rngSeed}_${Math.floor(l()*1e3)}`,instanceId:g};y.hand.length<9?(y.hand.push(I),o.logs.push(`${y.name}  ${R.name} `)):(y.graveyard.push(I),o.logs.push(`${y.name}${R.name}`))}break}case"REDUCE_HAND_COST":{const C=r.value||0,R=((f=r.conditions)==null?void 0:f.nameIn)||[],y=o.players[e];let g=0;y.hand.forEach(I=>{if(R.includes(I.name)){const A=I.cost,D=Math.max(0,A-C);D!==A&&(I.cost=D,I.baseCost=D,g++)}}),g>0&&o.logs.push(`${n.name} -${C}`);break}case"GRANT_LEADER_DAMAGE_SHIELD":{const C=o.players[e];C.leaderDamageShield=!0,o.logs.push(`${C.name} 0`);break}case"RANDOM_DESTROY":{const C=(I,A)=>{var D;return((D=I.passiveAbilities)==null?void 0:D.includes("IMMUNE_TO_DAMAGE_MY_TURN"))===!0&&o.activePlayerId===A},R=r.value||1,y=r.targetType==="SELF"?e:c,g=o.players[y].board;if(i&&i.length>0)i.forEach(I=>{const A=g.findIndex(D=>(D==null?void 0:D.instanceId)===I);if(A!==-1&&g[A]){const D=g[A];C(D,y)?o.logs.push(`${D.name} `):(D.currentHealth=1,u(D,y),o.players[y].graveyard.push(D),g[A]=null,o.logs.push(`${D.name}  ${n.name} `))}});else{const I=g.map((D,J)=>!D||C(D,y)?-1:J).filter(D=>D!==-1);for(let D=I.length-1;D>0;D--){const J=Math.floor(l()*(D+1));[I[D],I[J]]=[I[J],I[D]]}I.slice(0,R).forEach(D=>{const J=g[D];J&&(J.currentHealth=1,u(J,y),o.players[y].graveyard.push(J),g[D]=null,o.logs.push(`${J.name}  ${n.name} `))})}break}case"RANDOM_SET_HP":{const C=r.value||1,R=r.value2||1,y=r.targetType==="SELF"?e:c,g=o.players[y].board;if(i&&i.length>0)i.forEach(I=>{const A=g.findIndex(D=>(D==null?void 0:D.instanceId)===I);A!==-1&&g[A]&&(g[A].currentHealth=R,o.logs.push(`${g[A].name} HP ${R} `))});else{const I=g.map((D,J)=>D?J:-1).filter(D=>D!==-1);for(let D=I.length-1;D>0;D--){const J=Math.floor(l()*(D+1));[I[D],I[J]]=[I[J],I[D]]}I.slice(0,C).forEach(D=>{const J=g[D];J&&(J.currentHealth=R,o.logs.push(`${J.name} HP ${R} `))})}break}case"RANDOM_DAMAGE":{const C=r.value2||1,R=r.value||0,y=r.targetType==="SELF"?e:c,g=o.players[y].board,I=D=>{const J=g[D];J&&(J.hasBarrier?(J.hasBarrier=!1,o.logs.push(`${J.name} `)):(J.currentHealth-=R,o.logs.push(`${n.name}  ${J.name}  ${R} `)),J.currentHealth<=0&&(J.currentHealth=0,u(J,y),o.players[y].graveyard.push(J),g[D]=null,o.logs.push(`${J.name} `)))},A=new Set;if(i&&i.length>0)i.forEach(D=>{const J=g.findIndex(U=>(U==null?void 0:U.instanceId)===D);if(J!==-1&&g[J])A.add(D),I(J);else{const U=g.map((ge,G)=>ge&&!A.has(ge.instanceId)?G:-1).filter(ge=>ge!==-1);if(U.length>0){const ge=Math.floor(l()*U.length),G=U[ge],Ie=g[G];A.add(Ie.instanceId),I(G)}}});else{const D=g.map((U,ge)=>U?ge:-1).filter(U=>U!==-1);for(let U=D.length-1;U>0;U--){const ge=Math.floor(l()*(U+1));[D[U],D[ge]]=[D[ge],D[U]]}D.slice(0,C).forEach(U=>{I(U)})}break}case"RANDOM_DAMAGE_BY_TURN":{const C=r.value||1,R=o.turnCount,y=r.targetType==="SELF"?e:c,g=o.players[y].board,I=A=>{var J;const D=g[A];if(!D)return!1;if(D.hasBarrier)return D.hasBarrier=!1,o.logs.push(`${D.name} `),!0;if(D.currentHealth-=C,o.logs.push(`${n.name}  ${D.name}  ${C} `),D.currentHealth<=0){D.currentHealth=0;const U=Object.keys(o.players).find(G=>o.players[G]===o.players[y])||y,ge=(J=D.triggers)==null?void 0:J.find(G=>G.trigger==="LASTWORD");return ge&&ge.effects.forEach(G=>{o.pendingEffects.push({sourceCard:D,effect:G,sourcePlayerId:U})}),o.players[y].graveyard.push(D),g[A]=null,o.logs.push(`${D.name} `),!1}return!0};if(i&&i.length>0)for(let A=0;A<i.length;A++){const D=i[A],J=g.findIndex(U=>(U==null?void 0:U.instanceId)===D);if(J!==-1&&g[J])I(J);else{const U=g.map((ge,G)=>ge?G:-1).filter(ge=>ge!==-1);if(U.length>0){const ge=Math.floor(l()*U.length);I(U[ge])}}}else for(let A=0;A<R;A++){const D=g.map((U,ge)=>U?ge:-1).filter(U=>U!==-1);if(D.length===0)break;const J=Math.floor(l()*D.length);I(D[J])}break}case"SET_MAX_HP":{const C=r.value||20;if(r.targetType==="OPPONENT"){const R=o.players[c];R.maxHp=C,R.hp>C&&(R.hp=C)}break}case"SUMMON_CARD":{const C=r.targetCardId,R=tr.find(y=>y.id===C);if(R){const y=o.players[e];if(y.board.filter(I=>I!==null).length<5){const I={...R,instanceId:`token_${o.rngSeed}_${Math.floor(l()*1e3)}`,canAttack:((x=R.passiveAbilities)==null?void 0:x.includes("STORM"))||((k=R.passiveAbilities)==null?void 0:k.includes("RUSH"))||!1,currentHealth:R.health||1,maxHealth:R.health||1,attack:R.attack||0,currentAttack:R.attack||0,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((T=R.passiveAbilities)==null?void 0:T.includes("BARRIER"))??!1,passiveAbilities:R.passiveAbilities?[...R.passiveAbilities]:[],hadStealth:((j=R.passiveAbilities)==null?void 0:j.includes("STEALTH"))??!1};(b=R.tags)!=null&&b.includes("Knuckler")&&!I.passiveAbilities.includes("STORM")&&y.board.some(D=>(D==null?void 0:D.name)==="")&&(I.passiveAbilities.push("STORM"),I.canAttack=!0,o.logs.push(`${R.name}   `)),y.board.push(I),o.logs.push(`${y.name}  ${R.name} `)}}break}case"SUMMON_CARD_RUSH":{const C=r.targetCardId,R=tr.find(y=>y.id===C);if(R){const y=o.players[e];if(y.board.filter(I=>I!==null).length<5){const I={...R,instanceId:`token_${o.rngSeed}_${Math.floor(l()*1e3)}`,canAttack:!0,currentHealth:R.health||1,maxHealth:R.health||1,attack:R.attack||0,currentAttack:R.attack||0,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((v=R.passiveAbilities)==null?void 0:v.includes("BARRIER"))??!1,passiveAbilities:R.passiveAbilities?[...R.passiveAbilities]:[],hadStealth:((S=R.passiveAbilities)==null?void 0:S.includes("STEALTH"))??!1};let A=!1;(p=R.tags)!=null&&p.includes("Knuckler")&&!I.passiveAbilities.includes("STORM")&&y.board.some(J=>(J==null?void 0:J.name)==="")&&(I.passiveAbilities.push("STORM"),A=!0,o.logs.push(`${R.name}   `)),!A&&!I.passiveAbilities.includes("RUSH")&&I.passiveAbilities.push("RUSH"),y.board.push(I),o.logs.push(`${y.name}  ${R.name} ${A?"":""}`)}}break}case"SUMMON_CARD_BUFFED":{const C=r.targetCardId,R=tr.find(I=>I.id===C),y=r.value||0,g=r.value2||0;if(R){const I=o.players[e];if(I.board.filter(D=>D!==null).length<5){const D=R.attack||0,J=R.health||1,U=D+y,ge=J+g,G={...R,instanceId:`token_${o.rngSeed}_${Math.floor(l()*1e3)}`,canAttack:!1,currentHealth:ge,maxHealth:ge,health:ge,attack:U,currentAttack:U,baseAttack:D,baseHealth:J,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((F=R.passiveAbilities)==null?void 0:F.includes("BARRIER"))??!1,passiveAbilities:R.passiveAbilities?[...R.passiveAbilities]:[],hadStealth:((H=R.passiveAbilities)==null?void 0:H.includes("STEALTH"))??!1};(z=R.tags)!=null&&z.includes("Knuckler")&&!G.passiveAbilities.includes("STORM")&&I.board.some(ne=>(ne==null?void 0:ne.name)==="")&&(G.passiveAbilities.push("STORM"),G.canAttack=!0,o.logs.push(`${R.name}   `)),((W=G.passiveAbilities)!=null&&W.includes("RUSH")||(q=G.passiveAbilities)!=null&&q.includes("STORM"))&&(G.canAttack=!0),I.board.push(G),o.logs.push(`${I.name}  ${R.name} +${y}/+${g}`),o.pendingEffects=[...o.pendingEffects||[],{sourceCard:G,effect:{type:"VISUAL_BUFF_ONLY",value:y,value2:g},sourcePlayerId:e}]}}break}case"SUMMON_CARD_FILL_BOARD":{const C=r.targetCardId,R=tr.find(g=>g.id===C),y=r.necromance||0;if(R){const g=o.players[e];let I=0;for(;!(g.board.filter(J=>J!==null).length>=5);){if(y>0&&g.graveyard.length<y){I===0&&o.logs.push(` ${R.name} `);break}if(y>0){const J=g.graveyard.splice(-y,y);o.logs.push(` ${y} ${J.map(U=>U.name).join(", ")} `)}const D={...R,instanceId:`token_${o.rngSeed}_${Math.floor(l()*1e3)}_${I}`,canAttack:((de=R.passiveAbilities)==null?void 0:de.includes("STORM"))||((ve=R.passiveAbilities)==null?void 0:ve.includes("RUSH"))||!1,currentHealth:R.health||1,maxHealth:R.health||1,attack:R.attack||0,currentAttack:R.attack||0,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((Ne=R.passiveAbilities)==null?void 0:Ne.includes("BARRIER"))??!1,passiveAbilities:R.passiveAbilities?[...R.passiveAbilities]:[],hadStealth:((ue=R.passiveAbilities)==null?void 0:ue.includes("STEALTH"))??!1};(w=R.tags)!=null&&w.includes("Knuckler")&&!D.passiveAbilities.includes("STORM")&&g.board.some(U=>(U==null?void 0:U.name)==="")&&(D.passiveAbilities.push("STORM"),D.canAttack=!0,o.logs.push(`${R.name}   `)),g.board.push(D),I++,o.logs.push(`${g.name}  ${R.name} `)}I>0&&o.logs.push(` ${I}  ${R.name} `)}break}case"DESTROY_AND_STEAL":{if(r.targetType==="SELECT_FOLLOWER"&&s){const C=d(s);if(C){const{card:R,player:y,index:g}=C,I=Object.keys(o.players).find(J=>o.players[J]===y)||c,A=o.players[e];if(A.board.filter(J=>J!==null).length<5){y.board[g]=null,o.logs.push(`${R.name}  ${n.name} `);const J={...R,instanceId:`stolen_${o.rngSeed}_${Math.floor(l()*1e3)}`,canAttack:!1,currentHealth:R.health||R.currentHealth,maxHealth:R.health||R.maxHealth,currentAttack:R.attack||R.currentAttack,attacksMade:0,turnPlayed:o.turnCount,hasEvolved:!1};A.board.push(J),o.logs.push(`${A.name}  ${J.name} `)}else u(R,I),y.graveyard.push(R),y.board[g]=null,o.logs.push(`${R.name}  ${n.name} `)}}break}case"DESTROY_AND_GENERATE":{let C=null;if(r.targetType==="SELECT_FOLLOWER"&&s)C=d(s);else if(r.targetType==="RANDOM_ENEMY_FOLLOWER"){const y=o.players[c].board.map((g,I)=>({card:g,index:I})).filter(g=>g.card!==null);if(y.length>0){const g=Math.floor(l()*y.length),I=y[g];C={card:I.card,player:o.players[c],index:I.index}}}if(C){const{card:R,player:y,index:g}=C,I=Object.keys(o.players).find(J=>o.players[J]===y)||c;u(R,I),y.graveyard.push(R),y.board[g]=null,o.logs.push(`${R.name}  ${n.name} `);const A=o.players[e],D=Kr(R.name);if(D){const J=Math.max(0,D.cost+(r.value||0)),U={...D,instanceId:`generated_${o.rngSeed}_${Math.floor(l()*1e3)}`,baseCost:J,cost:J,attackEffectType:D.attackEffectType};A.hand.push(U);const ge=r.value||0;o.logs.push(`${A.name}  ${U.name} ${ge>=0?"+":""}${ge}`)}}break}case"RETURN_TO_HAND":{const C=o.players[c].board;let R=-1;if(r.targetType==="SELECT_FOLLOWER"&&s?R=C.findIndex(y=>(y==null?void 0:y.instanceId)===s):(r.targetType==="RANDOM_FOLLOWER"||!s)&&C.length>0&&(R=Math.floor(l()*C.length)),R!==-1&&C[R]){const y=C[R];o.players[c].board[R]=null;const g=o.players[c],I=Kr(y.id)||Kr(y.name),{currentHealth:A,maxHealth:D,canAttack:J,attacksMade:U,hasEvolved:ge,baseAttack:G,baseHealth:Ie,turnPlayed:ne,hasBarrier:Q,attack:Pe,health:xe,...ze}=y,we={...ze,attack:(I==null?void 0:I.attack)??Pe,health:(I==null?void 0:I.health)??xe};g.hand.length<9?(g.hand.push(we),o.logs.push(`${y.name} `)):(g.graveyard.push(we),o.logs.push(`${y.name} `))}break}case"RANDOM_BOUNCE":{const C=r.value||1,R=o.players[c].board;for(let y=0;y<C;y++){const g=R.map((ct,qe)=>ct?qe:-1).filter(ct=>ct!==-1);if(g.length===0)break;const I=g[Math.floor(l()*g.length)],A=R[I];R[I]=null;const D=o.players[c],J=Kr(A.id)||Kr(A.name),{currentHealth:U,maxHealth:ge,canAttack:G,attacksMade:Ie,hasEvolved:ne,baseAttack:Q,baseHealth:Pe,turnPlayed:xe,hasBarrier:ze,attack:we,health:je,...ht}=A,nt={...ht,attack:(J==null?void 0:J.attack)??we,health:(J==null?void 0:J.health)??je};D.hand.length<9?(D.hand.push(nt),o.logs.push(`${A.name} `)):(D.graveyard.push(nt),o.logs.push(`${A.name} `))}break}case"GRANT_PASSIVE":{const C=r.targetPassive;if(!C)break;if(r.targetType==="SELF"){const R=n;if(R.instanceId){const g=o.players[e].board.find(I=>(I==null?void 0:I.instanceId)===R.instanceId);g&&(C==="BARRIER"?(g.hasBarrier=!0,o.logs.push(`${g.name} `)):(g.passiveAbilities||(g.passiveAbilities=[]),g.passiveAbilities.includes(C)||(g.passiveAbilities.push(C),o.logs.push(`${g.name}  ${Xc(C)} `)),(C==="STORM"||C==="RUSH")&&(g.canAttack=!0)))}}else if((r.targetType==="SELECT_FOLLOWER"||r.targetType==="SELECT_ALLY_FOLLOWER")&&s){const R=d(s);if(R){const{card:y}=R;C==="BARRIER"?(y.hasBarrier=!0,o.logs.push(`${y.name} `)):(y.passiveAbilities||(y.passiveAbilities=[]),y.passiveAbilities.includes(C)||(y.passiveAbilities.push(C),o.logs.push(`${y.name}  ${Xc(C)} `)),(C==="STORM"||C==="RUSH")&&(y.canAttack=!0))}}else if(r.targetType==="ALL_FOLLOWERS"){const R=o.players[e];let y=0;console.log(`[GRANT_PASSIVE] ALL_FOLLOWERS: Player board has ${R.board.filter(g=>g).length} units, condition tag=${(L=r.conditions)==null?void 0:L.tag}`),R.board.forEach(g=>{var I,A,D;if(g){if(console.log(`[GRANT_PASSIVE] Checking: ${g.name}, tags=${g.tags}, passives=${g.passiveAbilities}`),(I=r.conditions)!=null&&I.tag&&!((A=g.tags)!=null&&A.includes(r.conditions.tag))){console.log(`[GRANT_PASSIVE] Skipped ${g.name}: no matching tag`);return}if((D=r.conditions)!=null&&D.nameIn&&!r.conditions.nameIn.includes(g.name)){console.log(`[GRANT_PASSIVE] Skipped ${g.name}: no matching nameIn`);return}C==="BARRIER"?(g.hasBarrier=!0,y++):(g.passiveAbilities||(g.passiveAbilities=[]),g.passiveAbilities.includes(C)||(g.passiveAbilities.push(C),y++,console.log(`[GRANT_PASSIVE] Granted ${C} to ${g.name}`),(C==="STORM"||C==="RUSH")&&(g.canAttack=!0)))}}),y>0&&o.logs.push(`${y} ${Xc(C)} `),console.log(`[GRANT_PASSIVE] Total granted: ${y}`)}else if(r.targetType==="ALL_OTHER_FOLLOWERS"){const R=o.players[e];let y=0;R.board.forEach(g=>{var I,A,D;if(g&&g.instanceId!==n.instanceId){if((I=r.conditions)!=null&&I.tag&&!((A=g.tags)!=null&&A.includes(r.conditions.tag))||(D=r.conditions)!=null&&D.nameIn&&!r.conditions.nameIn.includes(g.name))return;C==="BARRIER"?(g.hasBarrier=!0,y++):(g.passiveAbilities||(g.passiveAbilities=[]),g.passiveAbilities.includes(C)||(g.passiveAbilities.push(C),y++,(C==="STORM"||C==="RUSH")&&(g.canAttack=!0)))}}),y>0&&o.logs.push(`${y} ${Xc(C)} `)}break}case"BUFF_STATS":{const C=r.value||0,R=r.value2||0;if(r.targetType==="ALL_FOLLOWERS")o.players[e].board.forEach(g=>{var I,A,D;if(g){if((I=r.conditions)!=null&&I.tag&&!((A=g.tags)!=null&&A.includes(r.conditions.tag))||(D=r.conditions)!=null&&D.nameIn&&!r.conditions.nameIn.includes(g.name))return;g.baseAttack||(g.baseAttack=g.attack||0),g.baseHealth||(g.baseHealth=g.health||0),g.attack=(g.attack||0)+C,g.currentAttack=(g.currentAttack||0)+C,g.health=(g.health||0)+R,g.maxHealth=(g.maxHealth||0)+R,g.currentHealth=(g.currentHealth||0)+R,o.logs.push(`${g.name}  +${C}/+${R} `)}});else if(r.targetType==="ALL_OTHER_FOLLOWERS")o.players[e].board.forEach(g=>{var I,A,D;if(g&&g.instanceId!==n.instanceId){if((I=r.conditions)!=null&&I.tag&&!((A=g.tags)!=null&&A.includes(r.conditions.tag))||(D=r.conditions)!=null&&D.nameIn&&!r.conditions.nameIn.includes(g.name))return;g.baseAttack||(g.baseAttack=g.attack||0),g.baseHealth||(g.baseHealth=g.health||0),g.attack=(g.attack||0)+C,g.currentAttack=(g.currentAttack||0)+C,g.health=(g.health||0)+R,g.maxHealth=(g.maxHealth||0)+R,g.currentHealth=(g.currentHealth||0)+R,o.logs.push(`${g.name}  +${C}/+${R} `)}});else if((r.targetType==="SELECT_FOLLOWER"||r.targetType==="SELECT_ALLY_FOLLOWER"||r.targetType==="SELECT_OTHER_ALLY_FOLLOWER")&&s){const y=d(s);if(y){const{card:g}=y;g.baseAttack||(g.baseAttack=g.attack||0),g.baseHealth||(g.baseHealth=g.health||0),g.attack=(g.attack||0)+C,g.currentAttack=(g.currentAttack||0)+C,g.health=(g.health||0)+R,g.maxHealth=(g.maxHealth||0)+R,g.currentHealth=(g.currentHealth||0)+R,o.logs.push(`${g.name}  +${C}/+${R} `)}}else if(r.targetType==="RANDOM_FOLLOWER"){const y=o.players[c].board,g=y.map((I,A)=>I?A:-1).filter(I=>I!==-1);if(g.length>0){const I=g[Math.floor(l()*g.length)],A=y[I];A.baseAttack||(A.baseAttack=A.attack||0),A.baseHealth||(A.baseHealth=A.health||0),A.attack=(A.attack||0)+C,A.currentAttack=(A.currentAttack||0)+C,A.health=(A.health||0)+R,A.maxHealth=(A.maxHealth||0)+R,A.currentHealth=(A.currentHealth||0)+R,A.currentAttack<0&&(A.currentAttack=0),A.attack&&A.attack<0&&(A.attack=0);const D=C>=0?`+${C}`:`${C}`,J=R>=0?`+${R}`:`${R}`;o.logs.push(`${A.name}  ${D}/${J} `)}else o.logs.push("")}break}}return o}const wL=t=>{const e=n=>{const r=n.board.some(i=>i&&i.name.includes("")),s=n.hand.map(i=>{var c;const o=i.baseCost!==void 0?i.baseCost:i.cost;let l=o;return r&&((c=i.tags)!=null&&c.includes("Knuckler"))&&(l=Math.max(0,o-2)),i.cost!==l?{...i,cost:l,baseCost:o}:i});return{...n,hand:s}};return{...t,players:{p1:e(t.players.p1),p2:e(t.players.p2)}}},CL=(t,e)=>{let n=kL(t,e);return n=wL(n),n.lastHash=SL(n),n},kL=(t,e)=>{var s,i,o,l,c,d,u,h,f,x,k,T,j,b,v,S,p,F,H,z,W,q,de,ve,Ne;console.log(`[Reducer] Action: ${e.type}, isRemote: ${e.isRemote}`);let n={...t,players:{p1:{...t.players.p1,hand:[...t.players.p1.hand],deck:[...t.players.p1.deck],board:t.players.p1.board.map(ue=>ue?{...ue,passiveAbilities:ue.passiveAbilities?[...ue.passiveAbilities]:[]}:null),graveyard:[...t.players.p1.graveyard]},p2:{...t.players.p2,hand:[...t.players.p2.hand],deck:[...t.players.p2.deck],board:t.players.p2.board.map(ue=>ue?{...ue,passiveAbilities:ue.passiveAbilities?[...ue.passiveAbilities]:[]}:null),graveyard:[...t.players.p2.graveyard]}},logs:[...t.logs||[]]};const r=X0(n.rngSeed||999);switch(n.rngSeed=Math.floor(r()*1e6),e.type){case"START_GAME":return t;case"END_TURN":{const ue=t.activePlayerId,w=n.players[ue];w.extraPpActive&&(w.id!==t.firstPlayerId&&(n.turnCount<=5?w.extraPpUsedEarly=!0:w.extraPpUsedLate=!0),w.extraPpActive=!1);const L=[...n.pendingEffects||[]];w.board.forEach(y=>{y&&y.triggers&&y.triggers.filter(g=>g.trigger==="END_OF_TURN").forEach(g=>{g.effects.forEach(I=>{L.push({sourceCard:y,effect:I,sourcePlayerId:ue})})})});const C=Xp(ue),R=n.players[C];if(R.board.forEach((y,g)=>{y&&y.triggers&&y.triggers.filter(I=>I.trigger==="START_OF_TURN").forEach(I=>{I.effects.forEach(A=>{A.type==="DESTROY_SELF"?y&&(n.players[C].graveyard.push(y),n.players[C].board[g]=null,n.logs.push(`${y.name} `)):L.push({sourceCard:y,effect:A,sourcePlayerId:C})})})}),n.players[C].board=n.players[C].board.filter(Boolean),R.maxPp=Math.min(10,R.maxPp+1),R.pp=R.maxPp,R.deck.length>0){const y=R.deck.pop();y&&(R.hand.length<9?R.hand.push(y):(R.graveyard.push(y),n.logs.push(`${R.name}${y.name}`)))}return R.board=R.board.filter(Boolean),R.board.forEach(y=>{y&&(y.canAttack=!0,y.attacksMade=0,y.turnPlayed=-1)}),R.canEvolveThisTurn=!0,n.activePlayerId=C,n.pendingEffects=L,C===t.firstPlayerId&&(n.turnCount+=1),n.logs.push(` ${n.turnCount} - ${R.name} `),n}case"CONCEDE":{const ue=e.playerId,w=n.players[ue];if(!w)return console.warn(`[Engine] CONCEDE: Unknown playerId: ${ue}. Ignoring.`),t;if(t.phase==="GAME_OVER")return console.warn("[Engine] CONCEDE: Game already over. Ignoring."),t;const L=Xp(ue);return n.phase="GAME_OVER",n.winnerId=L,n.logs.push(`${w.name} `),console.log(`[Engine] CONCEDE: ${ue} surrendered. Winner: ${L}`),n}case"RESOLVE_EFFECT":{if(!n.pendingEffects||n.pendingEffects.length===0)return n;const[ue,...w]=n.pendingEffects;console.log(`[Engine] RESOLVE_EFFECT: Processing ${ue.effect.type} from ${ue.sourceCard.name}. Remaining: ${w.length}`);const L=((s=e.payload)==null?void 0:s.targetId)||ue.targetId;let C=TL(n,ue.sourcePlayerId,ue.sourceCard,ue.effect,L,ue.targetIds);const R=(C.pendingEffects||[]).filter(g=>{var I;return!((I=n.pendingEffects)!=null&&I.includes(g))}),y=[...w,...R];return console.log(`[Engine] RESOLVE_EFFECT done. Remaining: ${w.length}, NewlyAdded: ${R.length}, Final: ${y.length}`),y.length===0&&Object.values(C.players).forEach(g=>{g.board=g.board.filter(Boolean)}),{...C,pendingEffects:y}}case"PLAY_CARD":{if(!e.isRemote&&n.activePlayerId!==e.playerId)return n;const{cardIndex:ue,targetId:w,instanceId:L}=e.payload,C={...n.players.p1,hand:[...n.players.p1.hand],deck:[...n.players.p1.deck],board:[...n.players.p1.board],graveyard:[...n.players.p1.graveyard]},R={...n.players.p2,hand:[...n.players.p2.hand],deck:[...n.players.p2.deck],board:[...n.players.p2.board],graveyard:[...n.players.p2.graveyard]},y=e.playerId==="p1"?C:R;console.log(`[Engine] PLAY_CARD: playerId=${e.playerId}, cardIndex=${ue}, instanceId=${L}, handLength=${y.hand.length}, isRemote=${e.isRemote}`),console.log("[Engine] PLAY_CARD: hand cards:",y.hand.map(ne=>`${ne.name}(${ne.instanceId})`));let g=ue;if(L){const ne=y.hand.findIndex(Q=>Q.instanceId===L);if(ne>=0)g=ne,console.log(`[Engine] PLAY_CARD: Using instanceId ${L}, found at index ${ne} (was ${ue})`);else return console.log(`[Engine] PLAY_CARD: instanceId ${L} not found in hand!`),n}if(g<0||g>=y.hand.length)return console.log("[Engine] PLAY_CARD: Invalid cardIndex! Returning unchanged state."),n;const I=y.hand[g];let A="";if(w){const Q=(e.playerId==="p1"?R:C).board.find(Pe=>(Pe==null?void 0:Pe.instanceId)===w);Q&&(A=` (: ${Q.name})`)}if(n.logs.push(`${y.name}  ${I.name} ${A}`),y.pp<I.cost)return n;const D=y.board.filter(ne=>ne!==null).length;if(I.type==="FOLLOWER"&&D>=5)return n;const J=y.pp;y.pp-=I.cost,y.extraPpActive&&J-1<I.cost&&(y.id!==t.firstPlayerId&&(n.turnCount<=5?y.extraPpUsedEarly=!0:y.extraPpUsedLate=!0),y.extraPpActive=!1,y.pp<0&&(y.pp=0),console.log("[Engine] PLAY_CARD: Extra PP consumed, marked as used"),n.logs.push(`${y.name} PP`)),y.hand.splice(g,1);let U=I;if(I.type==="FOLLOWER"){const ne={...I,instanceId:e.payload.instanceId||`inst_${n.rngSeed}_${Math.floor(r()*1e3)}`,currentAttack:I.attack||0,currentHealth:I.health||0,maxHealth:I.health||0,canAttack:!1,hasEvolved:!1,attacksMade:0,turnPlayed:n.turnCount,hasBarrier:((i=I.passiveAbilities)==null?void 0:i.includes("BARRIER"))??!1,passiveAbilities:I.passiveAbilities?[...I.passiveAbilities]:[],hadStealth:((o=I.passiveAbilities)==null?void 0:o.includes("STEALTH"))??!1};((l=I.passiveAbilities)!=null&&l.includes("STORM")||(c=I.passiveAbilities)!=null&&c.includes("RUSH"))&&(ne.canAttack=!0),(d=ne.tags)!=null&&d.includes("Knuckler")&&!ne.passiveAbilities.includes("STORM")&&y.board.some(Pe=>(Pe==null?void 0:Pe.name)==="")&&(ne.passiveAbilities.push("STORM"),ne.canAttack=!0,n.logs.push(`${ne.name}   `)),y.board.push(ne),U=ne,ne.name===""&&y.board.forEach(Q=>{var Pe,xe;Q&&((Pe=Q.tags)!=null&&Pe.includes("Knuckler"))&&Q.instanceId!==ne.instanceId&&((xe=Q.passiveAbilities)!=null&&xe.includes("STORM")||(Q.passiveAbilities||(Q.passiveAbilities=[]),Q.passiveAbilities.push("STORM"),Q.canAttack=!0,n.logs.push(`${Q.name}   `)))})}else y.graveyard.push({...I,instanceId:`spell_${n.rngSeed}_${Math.floor(r()*1e3)}`});const ge=[];(u=I.triggers)==null||u.filter(ne=>ne.trigger==="FANFARE").forEach(ne=>ge.push(...ne.effects)),(h=I.triggerAbilities)!=null&&h.FANFARE&&ge.push(I.triggerAbilities.FANFARE);let G=[...n.pendingEffects||[]];return ge.forEach(ne=>{if(ne.conditions&&ne.conditions.minTurn&&n.turnCount<ne.conditions.minTurn)return;let Q;if(ne.targetType==="OPPONENT"||ne.targetType==="SELF"||ne.targetType==="ALL_FOLLOWERS"||ne.targetType==="ALL_OTHER_FOLLOWERS"||ne.type==="RANDOM_DESTROY"||ne.type==="RANDOM_SET_HP"||ne.type==="AOE_DAMAGE"||ne.type==="RANDOM_DAMAGE"||ne.type==="RANDOM_DAMAGE_BY_TURN"){const xe=e.playerId==="p1"?"p2":"p1",ze=e.playerId;if(ne.type==="RANDOM_DAMAGE_BY_TURN"){const we=ne.targetType==="SELF"?ze:xe,je=n.players[we].board,ht=n.turnCount;Q=[];for(let nt=0;nt<ht;nt++){const ct=je.map((Me,rt)=>Me?rt:-1).filter(Me=>Me!==-1);if(ct.length===0)break;const qe=Math.floor(r()*ct.length);Q.push(je[ct[qe]].instanceId)}}else if(ne.type==="RANDOM_DESTROY"||ne.type==="RANDOM_SET_HP"||ne.type==="RANDOM_DAMAGE"){const we=ne.targetType==="SELF"?ze:xe,je=n.players[we].board,ht=ne.type==="RANDOM_DAMAGE"?ne.value2||1:ne.value||1,nt=je.map((qe,Me)=>qe?Me:-1).filter(qe=>qe!==-1);for(let qe=nt.length-1;qe>0;qe--){const Me=Math.floor(r()*(qe+1));[nt[qe],nt[Me]]=[nt[Me],nt[qe]]}Q=nt.slice(0,ht).map(qe=>je[qe].instanceId)}else if(ne.targetType==="ALL_FOLLOWERS"||ne.type==="AOE_DAMAGE"){const we=ne.type==="GRANT_PASSIVE"||ne.type==="BUFF_STATS",je=we?ze:xe;Q=n.players[je].board.filter(nt=>nt!==null).map(nt=>nt.instanceId),console.log(`[Engine] Pre-calculated ALL_FOLLOWERS targets (${we?"ally":"enemy"}): ${Q.length} units`)}else ne.targetType==="ALL_OTHER_FOLLOWERS"&&(Q=n.players[ze].board.filter(je=>je!==null&&je.instanceId!==U.instanceId).map(je=>je.instanceId))}const Pe=ne.targetType==="SELECT_FOLLOWER"||ne.targetType==="SELECT_ALLY_FOLLOWER"||ne.targetType==="SELECT_OTHER_ALLY_FOLLOWER";G.push({sourceCard:U,effect:ne,sourcePlayerId:e.playerId,targetId:Pe?w:void 0,targetIds:Q})}),console.log(`[Engine] PLAY_CARD: Queued ${ge.length} effects. Total pending: ${G.length}`),{...n,players:{p1:C,p2:R},pendingEffects:G}}case"EVOLVE":{const{followerIndex:ue,targetId:w,useSep:L}=e.payload,C={...n.players.p1,hand:[...n.players.p1.hand],deck:[...n.players.p1.deck],board:n.players.p1.board.map(U=>U?{...U,passiveAbilities:U.passiveAbilities?[...U.passiveAbilities]:void 0}:null),graveyard:[...n.players.p1.graveyard]},R={...n.players.p2,hand:[...n.players.p2.hand],deck:[...n.players.p2.deck],board:n.players.p2.board.map(U=>U?{...U,passiveAbilities:U.passiveAbilities?[...U.passiveAbilities]:void 0}:null),graveyard:[...n.players.p2.graveyard]},y=e.playerId==="p1"?C:R,g=y.board[ue];if(!g||g.hasEvolved)return n;const I=e.isRemote;if(console.log(`[Engine] EVOLVE Logic: name=${g.name}, useSep=${L}, isRemote=${I}, turn=${t.turnCount}`),n.logs.push(`${y.name}  ${g.name} ${L?"":""}`),L){if(!I){if(t.turnCount<6)return console.log(`[Engine] Cannot Super Evolve: Turn ${t.turnCount} < 6`),n;if(y.sep<=0)return console.log("[Engine] Cannot Super Evolve: No SEP"),n;if(!y.canEvolveThisTurn)return console.log("[Engine] Cannot Super Evolve: Already evolved this turn"),n}y.sep=Math.max(0,y.sep-1),y.canEvolveThisTurn=!1,g.hasEvolved=!0,g.currentAttack+=3,g.currentHealth+=3,g.maxHealth+=3,g.canAttack=!0;const U=[...g.passiveAbilities||[]];U.includes("IMMUNE_TO_DAMAGE_MY_TURN")||U.push("IMMUNE_TO_DAMAGE_MY_TURN"),!U.includes("STORM")&&!U.includes("RUSH")&&U.push("RUSH"),g.passiveAbilities=U,console.log(`[Engine] Super Evolved ${g.name}! SEP remaining: ${y.sep}`)}else{if(!I){const G=e.playerId===t.firstPlayerId?5:4;if(t.turnCount<G)return console.log(`[Engine] Cannot Evolve: Turn ${t.turnCount} < ${G}`),n;if(y.evolutionsUsed>=2)return console.log("[Engine] Cannot Evolve: Limit reached"),n;if(!y.canEvolveThisTurn)return console.log("[Engine] Cannot Evolve: Already evolved this turn"),n}y.evolutionsUsed+=1,y.canEvolveThisTurn=!1,g.hasEvolved=!0,g.currentAttack+=2,g.currentHealth+=2,g.maxHealth+=2,g.canAttack=!0;const U=[...g.passiveAbilities||[]];!U.includes("STORM")&&!U.includes("RUSH")&&U.push("RUSH"),g.passiveAbilities=U}const A=[];(f=g.triggers)==null||f.filter(U=>U.trigger==="EVOLVE").forEach(U=>A.push(...U.effects)),(x=g.triggerAbilities)!=null&&x.EVOLVE&&A.push(g.triggerAbilities.EVOLVE),L&&((k=g.triggers)==null||k.filter(U=>U.trigger==="SUPER_EVOLVE").forEach(U=>A.push(...U.effects)));let D=[...n.pendingEffects||[]];return A.forEach(U=>{if(U.conditions&&U.conditions.minTurn&&n.turnCount<U.conditions.minTurn)return;let ge;const G=e.playerId==="p1"?"p2":"p1",Ie=e.playerId;if(U.type==="RANDOM_DESTROY"||U.type==="RANDOM_SET_HP"||U.type==="RANDOM_DAMAGE"){const ne=U.targetType==="SELF"?Ie:G,Q=n.players[ne].board,Pe=U.type==="RANDOM_DAMAGE"?U.value2||1:U.value||1,xe=Q.map((we,je)=>we?je:-1).filter(we=>we!==-1);for(let we=xe.length-1;we>0;we--){const je=Math.floor(r()*(we+1));[xe[we],xe[je]]=[xe[je],xe[we]]}ge=xe.slice(0,Pe).map(we=>Q[we].instanceId)}else U.targetType==="ALL_FOLLOWERS"||U.type==="AOE_DAMAGE"?(ge=n.players[G].board.filter(Q=>Q!==null).map(Q=>Q.instanceId),console.log(`[Engine EVOLVE] Pre-calculated ALL_FOLLOWERS targets: ${ge.length} units`)):U.targetType==="ALL_OTHER_FOLLOWERS"&&(ge=n.players[Ie].board.filter(Q=>Q!==null&&Q.instanceId!==g.instanceId).map(Q=>Q.instanceId));D.push({sourceCard:g,effect:U,sourcePlayerId:e.playerId,targetId:w,targetIds:ge})}),console.log(`[Engine] EVOLVE: Queued ${A.length} effects. Total pending: ${D.length}`),{...n,players:{p1:C,p2:R},pendingEffects:D}}case"ATTACK":{console.log(`[Engine] ATTACK received. Incoming state P1 HP: ${t.players.p1.hp}, P2 HP: ${t.players.p2.hp}`);const{attackerIndex:ue,targetIndex:w,targetIsLeader:L}=e.payload,C={...n.players.p1,board:n.players.p1.board.map(Q=>Q?{...Q,passiveAbilities:Q.passiveAbilities?[...Q.passiveAbilities]:void 0}:null),graveyard:[...n.players.p1.graveyard]},R={...n.players.p2,board:n.players.p2.board.map(Q=>Q?{...Q,passiveAbilities:Q.passiveAbilities?[...Q.passiveAbilities]:void 0}:null),graveyard:[...n.players.p2.graveyard]},y=e.playerId==="p1",g=y?C:R,I=y?R:C,A=g.board[ue];if(!A||!A.canAttack)return n;const D=I.board.filter(Q=>{var Pe,xe;return Q&&((Pe=Q.passiveAbilities)==null?void 0:Pe.includes("WARD"))&&!((xe=Q.passiveAbilities)!=null&&xe.includes("STEALTH"))}),J=((T=A.passiveAbilities)==null?void 0:T.includes("STEALTH"))||A.hadStealth;if(D.length>0&&!J){if(L)return console.log("[Engine] Attack blocked: Must attack Ward unit first."),n;const Q=I.board[w];if(Q&&!((j=Q.passiveAbilities)!=null&&j.includes("WARD")))return console.log("[Engine] Attack blocked: Must attack Ward unit first."),n}if(L===!1){const Q=I.board[w];if(Q&&((b=Q.passiveAbilities)!=null&&b.includes("STEALTH")))return console.log("[Engine] ATTACK blocked: Target has STEALTH"),n}const U=(v=A.passiveAbilities)==null?void 0:v.includes("RUSH"),ge=(S=A.passiveAbilities)==null?void 0:S.includes("STORM");if(U&&!ge&&L&&A.turnPlayed===n.turnCount)return console.log("[Engine] ATTACK blocked: RUSH unit cannot attack leader on the turn it was played"),n;(p=A.passiveAbilities)!=null&&p.includes("STEALTH")&&(A.passiveAbilities=A.passiveAbilities.filter(Q=>Q!=="STEALTH"),n.logs.push(`${A.name} `)),A.canAttack=!1,A.attacksMade=(A.attacksMade||0)+1,(F=A.passiveAbilities)!=null&&F.includes("DOUBLE_ATTACK")&&A.attacksMade<2&&(A.canAttack=!0);const G=A.currentAttack;console.log(`[Engine] Attack: ${A.name} (${G}) -> Target (Leader? ${L}). DefHP before: ${I.hp}`);const Ie=(Q,Pe)=>{var ze;const xe=(ze=Q.triggers)==null?void 0:ze.find(we=>we.trigger==="LAST_WORD");if(xe){const we=xe.effects.map(je=>({sourceCard:Q,effect:je,sourcePlayerId:Pe}));n.pendingEffects=[...n.pendingEffects||[],...we],n.logs.push(`${Q.name} `),console.log(`[Engine] Last Word triggered for ${Q.name}. pendingEffects count: ${n.pendingEffects.length}`)}};if(L){const Q="";if(n.logs.push(`${A.name}  ${Q} `),I.leaderDamageShield)I.leaderDamageShield=!1,n.logs.push(`${A.name}  ${Q}  ${G} `);else{const Pe=I.board.some(ze=>{var we;return(we=ze==null?void 0:ze.passiveAbilities)==null?void 0:we.includes("LEADER_DAMAGE_CAP")}),xe=Pe?Math.min(G,1):G;I.hp-=xe,Pe&&G>1?n.logs.push(`${A.name}  ${Q}  ${G} 1`):n.logs.push(`${A.name}  ${Q}  ${xe} `),I.hp<=0&&(n.winnerId=e.playerId)}}else{const Q=I.board[w];if(!Q)return console.log(`[Engine] Attack target at index ${w} no longer exists. Skipping.`),n;n.logs.push(`${A.name}  ${Q.name} `);let Pe=G;(H=Q.passiveAbilities)!=null&&H.includes("IMMUNE_TO_FOLLOWER_DAMAGE")?(Pe=0,n.logs.push(`${Q.name} `)):Q.hasBarrier&&Pe>0?(Pe=0,Q.hasBarrier=!1,n.logs.push(`${Q.name} `)):n.logs.push(`${A.name}  ${Q.name}  ${Pe} `),Q.currentHealth-=Pe;const xe=y?"p2":"p1",ze=((z=Q.passiveAbilities)==null?void 0:z.includes("IMMUNE_TO_DAMAGE_MY_TURN"))&&n.activePlayerId===xe;(W=A.passiveAbilities)!=null&&W.includes("BANE")&&Q.currentHealth>0&&(ze?n.logs.push(`${Q.name} `):(Q.currentHealth=0,Q.killedByBane=!0,n.logs.push(`${A.name}  ${Q.name} `)));let we=Q.currentAttack;(q=A.passiveAbilities)!=null&&q.includes("IMMUNE_TO_DAMAGE_MY_TURN")&&(we=0,n.logs.push(`${A.name} `)),A.hasBarrier&&we>0?(we=0,A.hasBarrier=!1,n.logs.push(`${A.name} `)):we>0&&n.logs.push(`${Q.name}  ${A.name}  ${we} `),A.currentHealth-=we;const je=y?"p1":"p2";A.currentHealth<=0&&((de=A.passiveAbilities)!=null&&de.includes("GUTS_MY_TURN"))&&n.activePlayerId===je&&(A.currentHealth=1,n.logs.push(`${A.name} 1`));const ht=((ve=A.passiveAbilities)==null?void 0:ve.includes("IMMUNE_TO_DAMAGE_MY_TURN"))&&n.activePlayerId===je;(Ne=Q.passiveAbilities)!=null&&Ne.includes("BANE")&&A.currentHealth>0&&(ht?n.logs.push(`${A.name} `):(A.currentHealth=0,A.killedByBane=!0,n.logs.push(`${Q.name}  ${A.name} `)));const nt=Q.currentHealth<=0,ct=A.currentHealth<=0;nt&&(Q.currentHealth=Math.min(0,Q.currentHealth),I.graveyard.push(Q),I.board[w]=null,n.logs.push(`${Q.name} `)),ct&&(A.currentHealth=Math.min(0,A.currentHealth),g.graveyard.push(A),g.board[ue]=null,n.logs.push(`${A.name} `)),nt&&Ie(Q,y?"p2":"p1"),ct&&Ie(A,y?"p1":"p2")}console.log(`[Engine] Committing state. P1 HP: ${C.hp}, P2 HP: ${R.hp}`);const ne={...n,players:{p1:C,p2:R}};return console.log(`[Engine] After commit. finalState.players.p1.hp: ${ne.players.p1.hp}, finalState.players.p2.hp: ${ne.players.p2.hp}`),ne}case"REINIT_GAME":{const{p1Class:ue,p2Class:w}=e.payload;return console.log(`[Engine] REINIT_GAME: p1=${ue}, p2=${w}`),bd("Player 1",ue,"Player 2",w)}case"SYNC_STATE":return console.log("[Engine] SYNC_STATE received"),e.payload;case"UPDATE_PLAYER_NAME":{const{playerId:ue,name:w}=e.payload;return console.log("[Engine] UPDATE_PLAYER_NAME:",ue,w),t.players[ue]?{...t,players:{...t.players,[ue]:{...t.players[ue],name:w}}}:(console.warn("[Engine] UPDATE_PLAYER_NAME: Unknown playerId:",ue),t)}case"TOGGLE_EXTRA_PP":{const ue=e.playerId,w=n.players[ue];if(!(ue!==t.firstPlayerId))return console.log("[Engine] TOGGLE_EXTRA_PP: Only second player can use Extra PP"),t;if(t.activePlayerId!==ue)return console.log("[Engine] TOGGLE_EXTRA_PP: Can only toggle on your turn"),t;if(w.extraPpActive)return w.extraPpActive=!1,w.pp=Math.max(0,w.pp-1),console.log("[Engine] TOGGLE_EXTRA_PP: Deactivated, PP now",w.pp),n;if(n.turnCount<=5){if(w.extraPpUsedEarly)return console.log("[Engine] TOGGLE_EXTRA_PP: Already used in early turns"),t}else if(w.extraPpUsedLate)return console.log("[Engine] TOGGLE_EXTRA_PP: Already used in late turns"),t;return w.extraPpActive=!0,w.pp+=1,console.log("[Engine] TOGGLE_EXTRA_PP: Activated, PP now",w.pp),n}default:return t}},RL=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},ro=({card:t,onClick:e,style:n,isSelected:r,isPlayable:s,variant:i="normal",turnCount:o,isOnBoard:l,isSpecialSummoning:c,className:d,suppressPassives:u,isMyTurn:h,scale:f=1})=>{const x="currentAttack"in t?t.currentAttack:t.attack,k="currentHealth"in t?t.currentHealth:t.health,T="maxHealth"in t?t.maxHealth:t.health,j="canAttack"in t?t.canAttack:!1,b="turnPlayed"in t?t.turnPlayed:void 0,[v,S]=N.useState(!1);N.useEffect(()=>{if(c&&l){S(!0);const D=setTimeout(()=>S(!1),800);return()=>clearTimeout(D)}},[c,l]);const p="baseAttack"in t?t.baseAttack:void 0,F="baseHealth"in t?t.baseHealth:void 0,H=p!==void 0&&x>p,z=F!==void 0&&(k>F||T>F),W="hasEvolved"in t?t.hasEvolved:!1,q="evolvedImageUrl"in t?t.evolvedImageUrl:void 0,de=W&&q?q:t.imageUrl,ve=de?RL(de):void 0;let Ne=n==null?void 0:n.boxShadow,ue;const w=t.passiveAbilities||t.abilities||[],L=w.includes("WARD"),C=w.includes("AURA"),R=w.includes("STEALTH"),y=t.hasBarrier===!0||w.includes("BARRIER")&&t.hasBarrier!==!1;if(r)Ne="0 0 15px rgba(255, 255, 255, 0.8)";else if(s)Ne="0 0 10px #48bb78",ue="2px solid #48bb78";else if(j&&h){const D=w.includes("STORM"),J=w.includes("RUSH"),U=o!==void 0&&b!==void 0&&b===o;let ge=!1;D||(U?ge=!0:(o===void 0||b===void 0)&&(ge=J)),ge?Ne="0 0 10px #f6e05e":Ne="0 0 10px #48bb78"}const g=k<T;if(i==="art-only")return a.jsx("div",{className:"card art-only",style:{width:140,height:200,...n,borderRadius:8,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",background:"#2d3748",position:"relative",boxShadow:"0 4px 6px rgba(0,0,0,0.3)"},children:ve?a.jsx("img",{src:ve,alt:t.name,draggable:!1,style:{width:"100%",height:"100%",objectFit:"cover"}}):a.jsx("div",{style:{fontSize:"1.5rem",opacity:.5,color:"white",fontWeight:"bold"},children:t.type})});if(i==="mobile-hand"){const J=t.type==="SPELL"?16:6,U=28*f,ge=.85*f;return a.jsxs("div",{className:`card mobile-hand ${d||""}`,style:{width:80,height:115,...n,position:"relative",cursor:e?"pointer":"default",transform:r?"translateY(-8px)":n==null?void 0:n.transform,boxShadow:Ne||(n==null?void 0:n.boxShadow),border:ue||(s?"2px solid #48bb78":void 0),transition:"transform 0.2s, box-shadow 0.2s",background:"#1a202c",overflow:"hidden",borderRadius:`${J}px ${J}px 6px 6px`,backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},onClick:e,children:[a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"hidden",borderRadius:`${J}px ${J}px 6px 6px`},children:ve?a.jsx("img",{src:ve,alt:t.name,draggable:!1,style:{width:"100%",height:"100%",objectFit:"cover"}}):a.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"#4a5568",color:"#a0aec0",fontSize:"0.6rem"},children:t.type})}),a.jsxs("div",{style:{position:"absolute",top:3,left:4,display:"flex",flexDirection:"column",gap:2,zIndex:10},children:[a.jsx("div",{style:{width:U,height:U,borderRadius:"50%",background:"#48bb78",border:"1px solid rgba(255,255,255,0.8)",color:"white",fontSize:`${ge}rem`,fontWeight:900,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.6)"},children:t.cost}),t.type==="FOLLOWER"&&a.jsxs("div",{style:{width:U,height:U,display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[a.jsx("svg",{width:U,height:U,viewBox:"0 0 24 24",fill:"none",style:{position:"absolute",filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.8))"},children:a.jsx("polygon",{points:"12,2 22,22 2,22",fill:"#4299e1",stroke:"rgba(255,255,255,0.8)",strokeWidth:"1",strokeLinejoin:"round"})}),a.jsx("span",{style:{zIndex:1,color:H?"#faf089":"white",fontWeight:"bold",fontSize:`${ge}rem`,textShadow:"0 1px 2px black"},children:x})]}),t.type==="FOLLOWER"&&a.jsxs("div",{style:{width:U,height:U,display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[a.jsx("svg",{width:U,height:U,viewBox:"0 0 24 24",style:{position:"absolute",filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.8))"},children:a.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z",fill:"#c53030",stroke:"rgba(255,255,255,0.8)",strokeWidth:"1"})}),a.jsx("span",{style:{zIndex:1,color:z?"#faf089":g?"#fc8181":"white",fontWeight:"bold",fontSize:`${ge}rem`,textShadow:"0 1px 2px black"},children:k})]})]})]})}const I=t.type==="SPELL"&&!l,A=I?20:8;return a.jsxs("div",{className:`card card-container ${j?"ready":""} ${l?"on-board":""} ${d||""}`,style:{width:140,height:200,...n,position:"relative",cursor:e?"pointer":"default",transform:r?"translateY(-10px)":n==null?void 0:n.transform,boxShadow:Ne||(j?"0 0 10px #f6e05e":n==null?void 0:n.boxShadow),border:ue||(s?"2px solid #48bb78":void 0),transition:"transform 0.2s, box-shadow 0.2s",display:"flex",flexDirection:"column",background:"#1a202c",overflow:"visible",animation:v?"cardSummonAppear 0.8s cubic-bezier(0.22, 1, 0.36, 1) forwards":n==null?void 0:n.animation,backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",borderRadius:I?`${A}px ${A}px 8px 8px`:"8px"},onClick:e,children:[!l&&a.jsx("div",{style:{height:20,background:"rgba(0,0,0,0.8)",color:"#e2e8f0",fontSize:t.name.length>10?"0.6rem":"0.7rem",fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid rgba(255,255,255,0.2)",zIndex:2,transform:t.name.length>15?"scaleX(0.9)":"none",borderRadius:I?`${A}px ${A}px 0 0`:"8px 8px 0 0"},children:t.name}),a.jsxs("div",{style:{flex:1,position:"relative",width:"100%",background:"#2d3748",borderRadius:l?"8px":"0 0 8px 8px",minHeight:0},children:[a.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"hidden",borderRadius:l?"8px":"0 0 8px 8px",zIndex:1},children:[ve?a.jsx("img",{src:ve,alt:t.name,draggable:!1,style:{width:"100%",height:"100%",objectFit:"cover",display:"block"}}):a.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"#4a5568",color:"#a0aec0",fontSize:"0.8rem"},children:t.type}),a.jsx("div",{style:{position:"absolute",bottom:0,left:0,width:"100%",height:40,background:"linear-gradient(to top, rgba(0,0,0,0.8), transparent)",pointerEvents:"none",zIndex:3}})]}),!l&&a.jsx("div",{style:{position:"absolute",top:2*f,left:2*f,width:24*f,height:24*f,borderRadius:"50%",background:"#48bb78",border:`${Math.max(1,2*f)}px solid #fff`,color:"white",fontSize:`${.9*f}rem`,fontWeight:900,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 2px 4px rgba(0,0,0,0.5), inset 0 2px 5px rgba(255,255,255,0.3)",zIndex:10},children:t.cost}),t.type==="FOLLOWER"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{position:"absolute",bottom:l?2*f:40*f,left:2*f,width:32*f,height:32*f,zIndex:10,display:"flex",alignItems:"center",justifyContent:"center"},children:[a.jsxs("svg",{width:40*f,height:40*f,viewBox:"0 0 24 24",fill:"none",style:{position:"absolute",filter:"drop-shadow(0 2px 2px rgba(0,0,0,0.8))"},children:[a.jsx("defs",{children:a.jsxs("linearGradient",{id:"blueGrad",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[a.jsx("stop",{offset:"0%",stopColor:"#63b3ed"}),a.jsx("stop",{offset:"100%",stopColor:"#4299e1"})]})}),a.jsx("polygon",{points:"12,2 22,22 2,22",fill:"url(#blueGrad)",stroke:"white",strokeWidth:"1",strokeLinejoin:"round"})]}),a.jsx("span",{style:{zIndex:11,color:H?"#faf089":"white",fontWeight:"bold",fontSize:`${1.2*f}rem`,textShadow:"0 2px 2px black"},children:x})]}),a.jsxs("div",{style:{position:"absolute",bottom:2*f,right:l?2*f:"auto",left:l?"auto":2*f,width:32*f,height:32*f,zIndex:10,display:"flex",alignItems:"center",justifyContent:"center"},children:[a.jsxs("svg",{width:36*f,height:36*f,viewBox:"0 0 24 24",style:{position:"absolute",filter:"drop-shadow(0 2px 2px rgba(0,0,0,0.8))"},children:[a.jsx("defs",{children:a.jsxs("linearGradient",{id:"redGrad",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[a.jsx("stop",{offset:"0%",stopColor:"#f56565"}),a.jsx("stop",{offset:"100%",stopColor:"#c53030"})]})}),a.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z",fill:"url(#redGrad)",stroke:"white",strokeWidth:"1.5"})]}),a.jsx("span",{style:{zIndex:11,color:z?"#faf089":g?"#fc8181":"white",fontWeight:"bold",fontSize:`${1.2*f}rem`,textShadow:"0 2px 2px black"},children:k})]})]}),l&&a.jsx("div",{style:{position:"absolute",top:-6*f,left:-6*f,right:-6*f,bottom:-6*f,zIndex:50,pointerEvents:"none",opacity:L&&!u?1:0,transition:"opacity 0.2s ease-in-out"},children:a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,animation:"wardPulseLoop 2.5s infinite ease-in-out"},children:a.jsxs("svg",{viewBox:"0 0 100 120",preserveAspectRatio:"none",style:{width:"100%",height:"100%"},children:[a.jsx("defs",{children:a.jsxs("filter",{id:"wardGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{stdDeviation:"2",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsx("path",{d:"M50 2 L96 20 V60 C96 90 50 116 50 116 C50 116 4 90 4 60 V20 Z",fill:"rgba(255, 255, 255, 0.12)",stroke:"#ECC94B",strokeWidth:"3",filter:"url(#wardGlow)"})]})})}),l&&a.jsxs("div",{style:{position:"absolute",top:-5*f,left:-5*f,right:-5*f,bottom:-5*f,zIndex:21,pointerEvents:"none",opacity:y&&!v&&!u?1:0,transition:"opacity 0.2s ease-in-out"},children:[a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,borderRadius:"50%",background:"radial-gradient(ellipse at center, rgba(99, 179, 237, 0.12) 0%, transparent 60%)",animation:"barrierGlowLoop 3s infinite ease-in-out"}}),a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,borderRadius:"50%",border:`${Math.max(1.5,2*f)}px solid rgba(99, 179, 237, 0.9)`,boxShadow:"0 0 6px rgba(66, 153, 225, 0.5), inset 0 0 8px rgba(99, 179, 237, 0.15)",animation:"barrierPulseLoop 3s infinite ease-in-out"}})]}),l&&a.jsx("div",{style:{position:"absolute",top:-6*f,left:-6*f,right:-6*f,bottom:-6*f,zIndex:22,pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center",opacity:C&&!v&&!u?1:0,transition:"opacity 0.2s ease-in-out"},children:a.jsx("div",{style:{width:"100%",height:"100%",position:"relative",animation:"auraPulseLoop 3s infinite ease-in-out"},children:a.jsxs("svg",{viewBox:"0 0 100 100",style:{width:"100%",height:"100%"},children:[a.jsx("defs",{children:a.jsxs("filter",{id:"auraGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{stdDeviation:"1.5",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsx("path",{d:"M40 5 L60 5 L60 30 L95 30 L95 45 L60 45 L60 95 L40 95 L40 45 L5 45 L5 30 L40 30 Z",fill:"rgba(255, 204, 0, 0.2)",stroke:"#f6ad55",strokeWidth:"2.5",filter:"url(#auraGlow)"})]})})}),l&&a.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:13,pointerEvents:"none",overflow:"hidden",borderRadius:"0 0 8px 8px",opacity:R&&!v&&!u?1:0,transition:"opacity 0.2s ease-in-out"},children:[a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:"120%",height:"120%",transform:"translate(-50%, -50%)",background:"radial-gradient(circle, rgba(0, 0, 0, 0.9) 0%, rgba(0, 0, 0, 0.6) 30%, rgba(0, 0, 0, 0.2) 60%, transparent 80%)",filter:"blur(10px)",animation:"stealthInkMove 3s infinite ease-in-out",mixBlendMode:"multiply"}}),a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:"100%",height:"100%",transform:"translate(-50%, -50%)",background:"radial-gradient(circle, rgba(20, 20, 30, 0.85) 0%, rgba(10, 10, 20, 0.4) 40%, transparent 70%)",filter:"blur(8px)",animation:"stealthInkPulse 1.5s infinite ease-in-out",mixBlendMode:"multiply"}}),a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:"70%",height:"70%",transform:"translate(-50%, -50%)",background:"radial-gradient(circle, rgba(255, 255, 255, 0.4) 0%, rgba(200, 200, 200, 0.25) 30%, transparent 60%)",filter:"blur(8px)",animation:"stealthMistMove 4s infinite ease-in-out",mixBlendMode:"screen"}}),a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,boxShadow:"inset 0 0 30px rgba(0, 0, 0, 0.85), 0 0 20px rgba(0, 0, 0, 0.6)",animation:"stealthPulse 1.5s infinite ease-in-out"}})]})]}),v&&a.jsx("div",{style:{position:"absolute",inset:0,borderRadius:8,background:"radial-gradient(circle, rgba(255,255,255,0.8) 0%, transparent 70%)",mixBlendMode:"overlay",animation:"cardSummonFlash 0.8s ease-out forwards",pointerEvents:"none",zIndex:100}}),a.jsx("style",{children:`
                @keyframes cardSummonAppear {
                    0% { opacity: 0; transform: scale(1.5); filter: brightness(2) blur(4px); }
                    100% { opacity: 1; transform: scale(1); filter: brightness(1) blur(0px); }
                }
                @keyframes cardSummonFlash {
                    0% { opacity: 0.8; transform: scale(1.2); }
                    100% { opacity: 0; transform: scale(1); }
                }
                @keyframes wardPulseLoop {
                    0% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(255, 255, 255, 0.5)); }
                    50% { transform: scale(1.08); opacity: 0.5; filter: blur(3px) drop-shadow(0 0 15px rgba(255, 255, 255, 0.8)); }
                    100% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(255, 255, 255, 0.5)); }
                }
                @keyframes barrierPulseLoop {
                    0% { transform: scale(1); opacity: 1; box-shadow: 0 0 8px rgba(66, 153, 225, 0.6), inset 0 0 10px rgba(99, 179, 237, 0.2); }
                    50% { transform: scale(1.03); opacity: 0.85; box-shadow: 0 0 12px rgba(99, 179, 237, 0.8), inset 0 0 15px rgba(99, 179, 237, 0.3); }
                    100% { transform: scale(1); opacity: 1; box-shadow: 0 0 8px rgba(66, 153, 225, 0.6), inset 0 0 10px rgba(99, 179, 237, 0.2); }
                }
                @keyframes barrierGlowLoop {
                    0% { transform: scale(1); opacity: 0.6; }
                    50% { transform: scale(1.05); opacity: 0.4; }
                    100% { transform: scale(1); opacity: 0.6; }
                }
                @keyframes auraPulseLoop {
                    0% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(246, 173, 85, 0.5)); }
                    50% { transform: scale(1.12); opacity: 0.4; filter: blur(4px) drop-shadow(0 0 20px rgba(255, 204, 0, 0.8)); }
                    100% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(246, 173, 85, 0.5)); }
                }
                @keyframes stealthInkMove {
                    0%, 100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 0.7; }
                    25% { transform: translate(-45%, -55%) scale(1.15) rotate(3deg); opacity: 1; }
                    50% { transform: translate(-50%, -50%) scale(0.95) rotate(0deg); opacity: 0.5; }
                    75% { transform: translate(-55%, -45%) scale(1.1) rotate(-3deg); opacity: 0.9; }
                }
                @keyframes stealthInkPulse {
                    0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.8; }
                    50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.4; }
                }
                @keyframes stealthMistMove {
                    0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.5; }
                    25% { transform: translate(-48%, -52%) scale(1.1); opacity: 0.8; }
                    50% { transform: translate(-52%, -48%) scale(1.2); opacity: 0.3; }
                    75% { transform: translate(-50%, -50%) scale(0.9); opacity: 0.7; }
                }
                @keyframes stealthPulse {
                    0%, 100% { opacity: 0.6; box-shadow: inset 0 0 50px rgba(0, 0, 0, 0.9), 0 0 30px rgba(0, 0, 0, 0.7); }
                    50% { opacity: 1; box-shadow: inset 0 0 70px rgba(0, 0, 0, 1), 0 0 40px rgba(0, 0, 0, 0.9); }
                }
                /* 3D flip support - ensure all child elements inherit backface-visibility */
                .card, .card * {
                    backface-visibility: hidden !important;
                    -webkit-backface-visibility: hidden !important;
                }
            `})]})},AL=35e5;function rI(){const[t,e]=O.useState(()=>C_());return O.useEffect(()=>{const n=()=>{e(C_())};return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),t}function C_(){const t=window.innerWidth*window.devicePixelRatio,e=window.innerHeight*window.devicePixelRatio,n=t*e,r=n>AL;let s="HD";return n>8e6?s="4K":n>35e5?s="1440p":n>2e6&&(s="1080p"),{isHighRes:r,isLightMode:r,pixelCount:n,resolution:s}}function PL(t){return t?{glowShadow:(e,n)=>`0 0 ${10*n}px ${e}`,blurAmount:4,enableGlowPulse:!1,dropShadow:e=>`drop-shadow(0 0 ${10*e}px rgba(255,255,255,0.6))`}:{glowShadow:(e,n)=>`
            0 0 ${15*n}px ${e},
            0 0 ${30*n}px ${e}80,
            0 0 ${60*n}px ${e}50
        `,blurAmount:8,enableGlowPulse:!0,dropShadow:e=>`drop-shadow(0 0 ${20*e}px rgba(255,255,255,0.8)) drop-shadow(0 0 ${40*e}px rgba(255,255,255,0.6))`}}const Ed=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},Qc=t=>Ed(t==="YORUKA"?"/leaders/yoRuka_leader.png":t==="AJA"?"/leaders/azya_leader.png":"/leaders/senka_leader.png"),OL=Ed("/assets/VS.png"),Jn=8,wh=240,LL=({myPlayer:t,opponentPlayer:e,isFirstPlayer:n,onComplete:r,scale:s=1,onVsImpact:i,onCoinToss:o,onImpact:l,onOrbLand:c,onFadeInBoard:d,isMobile:u=!1})=>{const[h,f]=O.useState("fade-in"),[x,k]=O.useState(!1),{isLightMode:T}=rI(),j=PL(T),[b,v]=O.useState(1),[S,p]=O.useState(1),[F,H]=O.useState(0),[z,W]=O.useState(0),[q,de]=O.useState(1),[ve,Ne]=O.useState({myX:0,myY:0,opX:0,opY:0}),[ue,w]=O.useState(0),[L,C]=O.useState(0),[R,y]=O.useState([]),g=O.useMemo(()=>{const Q=window.innerWidth,Pe=window.innerHeight,xe=s,ze=(u?280:340)*xe,we=Q-ze,je=ze+we/2,ht=je,nt=Pe- -20*xe-wh*xe/2,ct=je,qe=-20*xe+wh*xe/2;return{player:{x:ht,y:nt},opponent:{x:ct,y:qe},leaderSize:wh*xe}},[u,s]),I=O.useMemo(()=>{const Q=window.innerWidth,Pe=window.innerHeight,xe=Q*.25,ze=Pe*.5,we=Q*.75,je=Pe*.5;return{myX:xe,myY:ze,opX:we,opY:je}},[]),A=T?`0 0 ${10*s}px rgba(103, 232, 249, 0.8)`:`0 0 ${15*s}px rgba(103, 232, 249, 1), 0 0 ${30*s}px rgba(34, 211, 238, 0.8), 0 0 ${60*s}px rgba(6, 182, 212, 0.5)`,D=T?`0 0 ${10*s}px rgba(249, 168, 212, 0.8)`:`0 0 ${15*s}px rgba(249, 168, 212, 1), 0 0 ${30*s}px rgba(244, 114, 182, 0.8), 0 0 ${60*s}px rgba(236, 72, 153, 0.5)`,J=j.enableGlowPulse?"glowPulse 2s ease-in-out infinite":"none";O.useEffect(()=>{const Q={"fade-in":500,"leaders-enter":1200,nameplate:800,"vs-display":1500,"coin-toss":1500,"turn-order":1e3,"leader-to-orb":800,"orb-pause":1e3,"orb-fly":900,"leader-appear":600};if(h==="complete"){d==null||d();const ze=setTimeout(()=>{r()},700);return()=>clearTimeout(ze)}const Pe={"fade-in":"leaders-enter","leaders-enter":"nameplate",nameplate:"vs-display","vs-display":"coin-toss","coin-toss":"turn-order","turn-order":"leader-to-orb","leader-to-orb":"orb-pause","orb-pause":"orb-fly","orb-fly":"leader-appear","leader-appear":"complete"},xe=setTimeout(()=>{const ze=Pe[h];ze&&f(ze)},Q[h]||1e3);return()=>clearTimeout(xe)},[h,r,n]),O.useEffect(()=>{if(h==="vs-display"){const Q=setTimeout(()=>{k(!0),i==null||i(),setTimeout(()=>k(!1),300)},800);return()=>clearTimeout(Q)}},[h,i]),O.useEffect(()=>{h==="coin-toss"&&(o==null||o())},[h,o]),O.useEffect(()=>{if(h==="leaders-enter"){const Q=setTimeout(()=>{l==null||l()},1e3);return()=>clearTimeout(Q)}},[h,l]),O.useEffect(()=>{h==="nameplate"&&(l==null||l())},[h,l]),O.useEffect(()=>{if(h==="leader-to-orb"){const Pe=Date.now();let xe;const ze=()=>{const we=Date.now()-Pe,je=Math.min(we/800,1),ht=1-Math.pow(1-je,3);v(1-ht*.7),p(1-ht),H(ht*1.5),W(Math.min(ht*1.5,1)),je<1&&(xe=requestAnimationFrame(ze))};return Ne(I),xe=requestAnimationFrame(ze),()=>cancelAnimationFrame(xe)}},[h,I]),O.useEffect(()=>{if(h==="orb-pause"){const Pe=Date.now();let xe;const ze=()=>{const we=Date.now()-Pe,je=Math.min(we/800,1);de(1-je),je<1&&(xe=requestAnimationFrame(ze))};return xe=requestAnimationFrame(ze),()=>cancelAnimationFrame(xe)}},[h]),O.useEffect(()=>{if(h==="orb-fly"){const Pe=Date.now();let xe;const ze=I.myX,we=I.myY,je=I.opX,ht=I.opY,nt=g.player.x,ct=g.player.y,qe=g.opponent.x,Me=g.opponent.y,rt=()=>{const vt=Date.now()-Pe,Ot=Math.min(vt/900,1),Ve=Ot*Ot*Ot,qt=ze-200*s,ft=(we+ct)/2+100*s,on=(1-Ve)*(1-Ve)*ze+2*(1-Ve)*Ve*qt+Ve*Ve*nt,zt=(1-Ve)*(1-Ve)*we+2*(1-Ve)*Ve*ft+Ve*Ve*ct,us=je+200*s,ia=(ht+Me)/2-100*s,oa=(1-Ve)*(1-Ve)*je+2*(1-Ve)*Ve*us+Ve*Ve*qe,Ir=(1-Ve)*(1-Ve)*ht+2*(1-Ve)*Ve*ia+Ve*Ve*Me;Ne({myX:on,myY:zt,opX:oa,opY:Ir}),H(1.5-Ve*1),Ot<1&&(xe=requestAnimationFrame(rt))};return xe=requestAnimationFrame(rt),()=>cancelAnimationFrame(xe)}},[h,I,g,s]),O.useEffect(()=>{if(h==="leader-appear"){const Pe=Date.now();let xe;c==null||c(),k(!0),setTimeout(()=>k(!1),300);const ze=g.player.x,we=g.player.y,je=g.opponent.x,ht=g.opponent.y,nt=24,ct=[];for(let rt=0;rt<nt;rt++){const vt=rt/nt*360+(Math.random()-.5)*15;ct.push({id:rt,x:ze,y:we,angle:vt,dist:80+Math.random()*120,size:8+Math.random()*12,delay:Math.random()*.1,color:`hsl(${200+Math.random()*40}, 80%, ${60+Math.random()*20}%)`})}for(let rt=0;rt<nt;rt++){const vt=rt/nt*360+(Math.random()-.5)*15;ct.push({id:nt+rt,x:je,y:ht,angle:vt,dist:80+Math.random()*120,size:8+Math.random()*12,delay:Math.random()*.1,color:`hsl(${0+Math.random()*30}, 80%, ${55+Math.random()*20}%)`})}y(ct);const qe=setTimeout(()=>{y([])},800),Me=()=>{const rt=Date.now()-Pe,vt=Math.min(rt/600,1),Ot=1-Math.pow(1-vt,3);W(1-Ot),w(Ot),C(Ot),vt<1&&(xe=requestAnimationFrame(Me))};return xe=requestAnimationFrame(Me),()=>{cancelAnimationFrame(xe),clearTimeout(qe)}}},[h,c,g]);const U=["fade-in","leaders-enter","nameplate","vs-display","coin-toss","turn-order","leader-to-orb","orb-pause","orb-fly","leader-appear","complete"].indexOf(h),ge=U>=3&&U<=9,G=U>=0&&U<=7,Ie=`polygon(0 0, ${50+Jn}% 0, ${50-Jn}% 100%, 0 100%)`,ne=`polygon(${50+Jn}% 0, 100% 0, 100% 100%, ${50-Jn}% 100%)`;return a.jsxs("div",{style:{position:"fixed",inset:0,background:U>=7?"transparent":"#0a0a0f",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",animation:x?"screenShake 0.3s ease-in-out":void 0,pointerEvents:U>=9?"none":"auto"},children:[a.jsx("div",{style:{position:"absolute",inset:0,background:"black",opacity:h==="fade-in"?1:0,transition:"opacity 0.5s ease-out",pointerEvents:"none",zIndex:1e4}}),G&&a.jsxs("div",{style:{opacity:q,transition:"opacity 0.3s"},children:[U>=0&&a.jsxs("div",{style:{position:"absolute",inset:0,clipPath:Ie,background:"linear-gradient(135deg, #0a1628 0%, #1a2a4a 50%, #0d1a30 100%)",transform:`translateX(${U>=1?"0":"-100%"})`,transition:"transform 1.2s cubic-bezier(0.22, 1, 0.36, 1)",zIndex:50,overflow:"hidden"},children:[a.jsx("div",{style:{position:"fixed",top:"50%",left:"25%",transform:"translate(-50%, -50%)",opacity:S},children:a.jsx("img",{src:Qc(t.class),alt:t.name,style:{height:"120vh",width:"auto",objectFit:"cover",objectPosition:t.class==="AJA"?"center top":"center",filter:"brightness(0.85) contrast(1.1)",transform:`scale(${b})`,transformOrigin:"center center"}})}),a.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(135deg, rgba(59, 130, 246, 0.3) 0%, transparent 60%)",pointerEvents:"none"}}),U>=2&&U<6&&a.jsx("div",{style:{position:"absolute",bottom:"12%",left:"15%",padding:`${16*s}px ${40*s}px`,background:"rgba(0,0,0,0.85)",borderRadius:8*s,borderLeft:"4px solid #3b82f6",animation:"nameplateSlideUp 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)",whiteSpace:"nowrap",boxShadow:"0 4px 30px rgba(59, 130, 246, 0.4)"},children:a.jsx("div",{style:{color:"white",fontSize:2.2*s+"rem",fontWeight:"bold",textShadow:"0 0 20px rgba(59, 130, 246, 0.8)"},children:t.name})}),U>=5&&U<6&&a.jsx("div",{style:{position:"absolute",top:"10%",left:"15%",padding:`${12*s}px ${32*s}px`,background:n?"rgba(239, 68, 68, 0.9)":"rgba(59, 130, 246, 0.9)",borderRadius:8*s,animation:"turnOrderFadeIn 1s ease-out",boxShadow:n?"0 0 30px rgba(239, 68, 68, 0.6)":"0 0 30px rgba(59, 130, 246, 0.6)"},children:a.jsx("div",{style:{color:"white",fontSize:1.8*s+"rem",fontWeight:"bold",letterSpacing:"0.1em"},children:n?"":""})})]}),U>=0&&a.jsxs("div",{style:{position:"absolute",inset:0,clipPath:ne,background:"linear-gradient(225deg, #280a0a 0%, #4a1a1a 50%, #300d0d 100%)",transform:`translateX(${U>=1?"0":"100%"})`,transition:"transform 1.2s cubic-bezier(0.22, 1, 0.36, 1)",zIndex:50,overflow:"hidden"},children:[a.jsx("div",{style:{position:"fixed",top:"50%",left:"75%",transform:"translate(-50%, -50%)",opacity:S},children:a.jsx("img",{src:Qc(e.class),alt:e.name,style:{height:"120vh",width:"auto",objectFit:"cover",objectPosition:e.class==="AJA"?"center top":"center",filter:"brightness(0.85) contrast(1.1)",transform:`scale(${b})`,transformOrigin:"center center"}})}),a.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(225deg, rgba(239, 68, 68, 0.3) 0%, transparent 60%)",pointerEvents:"none"}}),U>=2&&U<6&&a.jsx("div",{style:{position:"absolute",bottom:"12%",right:"15%",padding:`${16*s}px ${40*s}px`,background:"rgba(0,0,0,0.85)",borderRadius:8*s,borderRight:"4px solid #ef4444",animation:"nameplateSlideUp 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)",whiteSpace:"nowrap",boxShadow:"0 4px 30px rgba(239, 68, 68, 0.4)"},children:a.jsx("div",{style:{color:"white",fontSize:2.2*s+"rem",fontWeight:"bold",textShadow:"0 0 20px rgba(239, 68, 68, 0.8)"},children:e.name})}),U>=5&&U<6&&a.jsx("div",{style:{position:"absolute",top:"10%",right:"15%",padding:`${12*s}px ${32*s}px`,background:n?"rgba(59, 130, 246, 0.9)":"rgba(239, 68, 68, 0.9)",borderRadius:8*s,animation:"turnOrderFadeIn 1s ease-out",boxShadow:n?"0 0 30px rgba(59, 130, 246, 0.6)":"0 0 30px rgba(239, 68, 68, 0.6)"},children:a.jsx("div",{style:{color:"white",fontSize:1.8*s+"rem",fontWeight:"bold",letterSpacing:"0.1em"},children:n?"":""})})]}),U>=1&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{position:"absolute",top:0,left:0,width:4*s,height:"100%",background:"linear-gradient(180deg, #67e8f9 0%, #22d3ee 30%, #06b6d4 50%, #22d3ee 70%, #67e8f9 100%)",boxShadow:A,zIndex:100,animation:J}}),a.jsx("div",{style:{position:"absolute",top:0,left:0,width:`calc(${50+Jn}% + ${2*s}px)`,height:4*s,background:"linear-gradient(90deg, #67e8f9 0%, #22d3ee 30%, #06b6d4 50%, #22d3ee 70%, #67e8f9 100%)",boxShadow:A,zIndex:100,animation:J}}),a.jsx("div",{style:{position:"absolute",bottom:0,left:0,width:`calc(${50-Jn}% + ${2*s}px)`,height:4*s,background:"linear-gradient(90deg, #67e8f9 0%, #22d3ee 30%, #06b6d4 50%, #22d3ee 70%, #67e8f9 100%)",boxShadow:A,zIndex:100,animation:J}}),a.jsxs("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:100,pointerEvents:"none",overflow:"visible"},children:[a.jsxs("defs",{children:[a.jsxs("linearGradient",{id:"cyanGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[a.jsx("stop",{offset:"0%",stopColor:"#67e8f9"}),a.jsx("stop",{offset:"30%",stopColor:"#22d3ee"}),a.jsx("stop",{offset:"50%",stopColor:"#06b6d4"}),a.jsx("stop",{offset:"70%",stopColor:"#22d3ee"}),a.jsx("stop",{offset:"100%",stopColor:"#67e8f9"})]}),a.jsxs("filter",{id:"cyanGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{stdDeviation:j.blurAmount,result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),a.jsx("line",{x1:`${50+Jn-.2}%`,y1:"0",x2:`${50-Jn-.2}%`,y2:"100%",stroke:"url(#cyanGradient)",strokeWidth:4*s,filter:T?void 0:"url(#cyanGlow)",style:{animation:J}})]})]}),U>=1&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{position:"absolute",top:0,right:0,width:4*s,height:"100%",background:"linear-gradient(180deg, #f9a8d4 0%, #f472b6 30%, #ec4899 50%, #f472b6 70%, #f9a8d4 100%)",boxShadow:D,zIndex:100,animation:J,animationDelay:"0.3s"}}),a.jsx("div",{style:{position:"absolute",top:0,right:0,width:`calc(${50-Jn}% + ${2*s}px)`,height:4*s,background:"linear-gradient(90deg, #f9a8d4 0%, #f472b6 30%, #ec4899 50%, #f472b6 70%, #f9a8d4 100%)",boxShadow:D,zIndex:100,animation:J,animationDelay:"0.3s"}}),a.jsx("div",{style:{position:"absolute",bottom:0,right:0,width:`calc(${50+Jn}% + ${2*s}px)`,height:4*s,background:"linear-gradient(90deg, #f9a8d4 0%, #f472b6 30%, #ec4899 50%, #f472b6 70%, #f9a8d4 100%)",boxShadow:D,zIndex:100,animation:J,animationDelay:"0.3s"}}),a.jsxs("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:100,pointerEvents:"none",overflow:"visible"},children:[a.jsxs("defs",{children:[a.jsxs("linearGradient",{id:"pinkGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[a.jsx("stop",{offset:"0%",stopColor:"#f9a8d4"}),a.jsx("stop",{offset:"30%",stopColor:"#f472b6"}),a.jsx("stop",{offset:"50%",stopColor:"#ec4899"}),a.jsx("stop",{offset:"70%",stopColor:"#f472b6"}),a.jsx("stop",{offset:"100%",stopColor:"#f9a8d4"})]}),a.jsxs("filter",{id:"pinkGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{stdDeviation:j.blurAmount,result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),a.jsx("line",{x1:`${50+Jn+.2}%`,y1:"0",x2:`${50-Jn+.2}%`,y2:"100%",stroke:"url(#pinkGradient)",strokeWidth:4*s,filter:T?void 0:"url(#pinkGlow)",style:{animation:J,animationDelay:"0.3s"}})]})]})]}),U>=6&&U<=9&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{position:"fixed",left:ve.myX,top:ve.myY,transform:`translate(-50%, -50%) scale(${F})`,opacity:z,width:150*s,height:150*s,borderRadius:"50%",background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(100,180,255,0.8) 40%, rgba(59,130,246,0.4) 70%, transparent 100%)",boxShadow:T?`0 0 ${30*s}px rgba(59, 130, 246, 0.8)`:`0 0 ${40*s}px rgba(255,255,255,0.9), 0 0 ${80*s}px rgba(59, 130, 246, 0.8), 0 0 ${120*s}px rgba(59, 130, 246, 0.5)`,zIndex:500,pointerEvents:"none"}}),a.jsx("div",{style:{position:"fixed",left:ve.opX,top:ve.opY,transform:`translate(-50%, -50%) scale(${F})`,opacity:z,width:150*s,height:150*s,borderRadius:"50%",background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(255,150,150,0.8) 40%, rgba(239,68,68,0.4) 70%, transparent 100%)",boxShadow:T?`0 0 ${30*s}px rgba(239, 68, 68, 0.8)`:`0 0 ${40*s}px rgba(255,255,255,0.9), 0 0 ${80*s}px rgba(239, 68, 68, 0.8), 0 0 ${120*s}px rgba(239, 68, 68, 0.5)`,zIndex:500,pointerEvents:"none"}})]}),U>=9&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{position:"fixed",left:g.player.x,top:g.player.y,transform:`translate(-50%, -50%) scale(${ue})`,opacity:L,width:g.leaderSize,height:g.leaderSize,borderRadius:"50%",overflow:"hidden",border:"4px solid #3182ce",boxShadow:"0 0 20px rgba(49, 130, 206, 0.4)",background:"#1a202c",zIndex:500,pointerEvents:"none"},children:a.jsx("img",{src:Qc(t.class),alt:t.name,style:{width:"100%",height:"100%",objectFit:"cover",objectPosition:t.class==="AJA"?"center top":"center"}})}),a.jsx("div",{style:{position:"fixed",left:g.opponent.x,top:g.opponent.y,transform:`translate(-50%, -50%) scale(${ue})`,opacity:L,width:g.leaderSize,height:g.leaderSize,borderRadius:"50%",overflow:"hidden",border:"4px solid #c53030",boxShadow:"0 0 20px rgba(197, 48, 48, 0.4)",background:"#1a202c",zIndex:500,pointerEvents:"none"},children:a.jsx("img",{src:Qc(e.class),alt:e.name,style:{width:"100%",height:"100%",objectFit:"cover",objectPosition:e.class==="AJA"?"center top":"center"}})})]}),R.map(Q=>a.jsx("div",{style:{position:"fixed",left:Q.x,top:Q.y,width:Q.size*s,height:Q.size*s,borderRadius:"50%",background:Q.color,boxShadow:`0 0 ${Q.size*.5*s}px ${Q.color}`,pointerEvents:"none",zIndex:600,animation:`landingParticleBurst 0.6s ease-out ${Q.delay}s forwards`,transform:"translate(-50%, -50%)","--particle-angle":`${Q.angle}deg`,"--particle-dist":`${Q.dist*s}px`}},Q.id)),ge&&a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",animation:U===3?"vsZoomIn 1.5s cubic-bezier(0.34, 1.56, 0.64, 1)":void 0,opacity:U>=7?Math.max(0,q):1,zIndex:200,pointerEvents:"none"},children:a.jsx("img",{src:OL,alt:"VS",style:{height:300*s,width:"auto",filter:`drop-shadow(0 0 ${20*s}px rgba(255,255,255,0.8)) drop-shadow(0 0 ${40*s}px rgba(255,255,255,0.6))`}})}),U>=4&&U<5&&a.jsx("div",{style:{position:"absolute",top:"20%",left:"50%",transform:"translate(-50%, -50%)",zIndex:150},children:a.jsx("div",{style:{width:100*s,height:100*s,borderRadius:"50%",background:"linear-gradient(45deg, #f6ad55 0%, #fbd38d 100%)",border:"4px solid white",display:"flex",alignItems:"center",justifyContent:"center",fontSize:2*s+"rem",fontWeight:"bold",color:"white",animation:"coinFlip 1.5s ease-in-out",boxShadow:`0 0 ${30*s}px rgba(246, 173, 85, 0.8)`},children:""})}),a.jsx("style",{children:`
                @keyframes screenShake {
                    0%, 100% { transform: translate(0, 0); }
                    10% { transform: translate(-10px, -10px); }
                    20% { transform: translate(10px, 10px); }
                    30% { transform: translate(-10px, 10px); }
                    40% { transform: translate(10px, -10px); }
                    50% { transform: translate(-10px, -10px); }
                    60% { transform: translate(10px, 10px); }
                    70% { transform: translate(-10px, 10px); }
                    80% { transform: translate(10px, -10px); }
                    90% { transform: translate(-10px, 0); }
                }

                @keyframes nameplateSlideUp {
                    0% {
                        transform: translateY(50px);
                        opacity: 0;
                    }
                    60% {
                        transform: translateY(-10px);
                    }
                    100% {
                        transform: translateY(0);
                        opacity: 1;
                    }
                }

                @keyframes vsZoomIn {
                    0% {
                        transform: translate(-50%, -50%) scale(3) translateZ(0);
                        opacity: 0;
                        filter: blur(20px);
                    }
                    50% {
                        transform: translate(-50%, -50%) scale(1.2) translateZ(0);
                        opacity: 1;
                        filter: blur(0px);
                    }
                    100% {
                        transform: translate(-50%, -50%) scale(1) translateZ(0);
                        opacity: 1;
                        filter: blur(0px);
                    }
                }

                @keyframes coinFlip {
                    0% {
                        transform: rotateY(0deg) scale(1);
                    }
                    50% {
                        transform: rotateY(1800deg) scale(1.2);
                    }
                    100% {
                        transform: rotateY(3600deg) scale(1);
                    }
                }

                @keyframes turnOrderFadeIn {
                    0% {
                        opacity: 0;
                        transform: scale(0.5);
                    }
                    50% {
                        transform: scale(1.2);
                    }
                    100% {
                        opacity: 1;
                        transform: scale(1);
                    }
                }

                @keyframes glowPulse {
                    0%, 100% {
                        opacity: 0.8;
                        filter: brightness(1);
                    }
                    50% {
                        opacity: 1;
                        filter: brightness(1.3);
                    }
                }

                @keyframes landingParticleBurst {
                    0% {
                        transform: translate(-50%, -50%) rotate(var(--particle-angle)) translateX(0);
                        opacity: 1;
                    }
                    100% {
                        transform: translate(-50%, -50%) rotate(var(--particle-angle)) translateX(var(--particle-dist));
                        opacity: 0;
                    }
                }
            `})]})},DL=({isVictory:t,loserLeaderRef:e,onComplete:n,onPhaseChange:r,onShakeIntensityChange:s,scale:i=1})=>{const[o,l]=O.useState("start"),[c,d]=O.useState(null),[u,h]=O.useState([]);O.useEffect(()=>{if(e.current){const x=e.current.getBoundingClientRect();d({x:x.left+x.width/2,y:x.top+x.height/2,size:x.width})}},[e]),O.useEffect(()=>{r==null||r(o)},[o,r]),O.useEffect(()=>{const x={start:200,zoom:600,"white-fade":800,explode:1200,"result-text":1800,"fade-out":600};if(o==="complete"){n();return}const k={start:"zoom",zoom:"white-fade","white-fade":"explode",explode:"result-text","result-text":"fade-out","fade-out":"complete"},T=setTimeout(()=>{const j=k[o];j&&l(j)},x[o]||1e3);return()=>clearTimeout(T)},[o,n]),O.useEffect(()=>{if(o==="explode"&&c){const k=Array.from({length:60},(v,S)=>{const p=S/60*360,F=(Math.random()-.5)*12,H=p+F,z=150+Math.random()*250,W=12+Math.random()*20;return{id:S,x:c.x,y:c.y,angle:H,distance:z,size:W,delay:Math.random()*.1,duration:.6+Math.random()*.4}});h(k),s==null||s(1);const T=1e3,j=Date.now(),b=setInterval(()=>{const S=(Date.now()-j)/T;if(S>=1)s==null||s(0),clearInterval(b);else{const p=1-Math.pow(S,2);s==null||s(p)}},16);return()=>clearInterval(b)}},[o,c,s]);const f=["start","zoom","white-fade","explode","result-text","fade-out","complete"].indexOf(o);return c?a.jsxs("div",{style:{position:"fixed",inset:0,zIndex:8e3,pointerEvents:"none",overflow:"hidden"},children:[a.jsx("div",{style:{position:"absolute",inset:0,background:"black",opacity:f>=1?f>=5?1:.5:0,transition:"opacity 0.5s ease-out"}}),f>=1&&f<4&&a.jsx("div",{style:{position:"absolute",left:c.x,top:c.y,transform:"translate(-50%, -50%)",width:c.size*1.8,height:c.size*1.8,borderRadius:"50%",background:"radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 60%)",transition:"all 0.4s ease-out"}}),f>=3&&u.map(x=>a.jsx("div",{style:{position:"absolute",left:x.x,top:x.y,width:x.size*i,height:x.size*i,borderRadius:"50%",background:"white",boxShadow:"0 0 15px white, 0 0 30px rgba(255,255,255,0.5)",transform:"translate(-50%, -50%)",animation:`particleFly-${x.id} ${x.duration}s ease-out ${x.delay}s forwards`}},x.id)),f>=3&&a.jsx("style",{children:u.map(x=>{const k=x.angle*Math.PI/180,T=Math.cos(k)*x.distance,j=Math.sin(k)*x.distance;return`
                            @keyframes particleFly-${x.id} {
                                0% {
                                    transform: translate(-50%, -50%) scale(1);
                                    opacity: 1;
                                }
                                100% {
                                    transform: translate(calc(-50% + ${T}px), calc(-50% + ${j}px)) scale(0);
                                    opacity: 0;
                                }
                            }
                        `}).join(`
`)}),f>=4&&f<6&&a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",animation:"resultTextPop 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)"},children:a.jsx("div",{style:{fontSize:`${7*i}rem`,fontWeight:900,fontFamily:"Tamanegi, sans-serif",color:t?"#ffd700":"#718096",textShadow:t?"0 0 30px rgba(255,215,0,0.8), 0 0 60px rgba(255,215,0,0.6), 0 0 90px rgba(255,215,0,0.4), 4px 4px 8px rgba(0,0,0,0.8)":"0 0 20px rgba(113,128,150,0.5), 4px 4px 8px rgba(0,0,0,0.8)",letterSpacing:"0.15em"},children:t?"":"..."})}),a.jsx("style",{children:`
                @keyframes resultTextPop {
                    0% {
                        transform: translate(-50%, -50%) scale(2.5);
                        opacity: 0;
                        filter: blur(20px);
                    }
                    60% {
                        transform: translate(-50%, -50%) scale(0.95);
                        opacity: 1;
                        filter: blur(0px);
                    }
                    100% {
                        transform: translate(-50%, -50%) scale(1);
                        opacity: 1;
                        filter: blur(0px);
                    }
                }
            `})]}):null},ML=({isMyTurn:t,turnCount:e,activePlayerId:n,onTimeUp:r,timerEnabled:s,isGameOver:i=!1,isPaused:o=!1,scale:l=1,buttonSize:c=160,timerDuration:d=60})=>{const[u,h]=O.useState(d),[f,x]=O.useState(!1),[k,T]=O.useState(!1),j=O.useRef(null),b=O.useRef(""),v=O.useRef(0),S=O.useRef(r),p=O.useRef(!1),F=O.useId().replace(/:/g,"_");O.useEffect(()=>{S.current=r},[r]);const H=`${e}-${n}`,z=O.useCallback(()=>{h(d),x(!1),T(!1),v.current=Date.now()+d*1e3,p.current=!1},[d]);if(O.useEffect(()=>{H!==b.current&&(b.current=H,z())},[H,z]),O.useEffect(()=>{if(!s||!t||i||o){j.current&&(clearInterval(j.current),j.current=null);return}return v.current===0&&(v.current=Date.now()+d*1e3),j.current=window.setInterval(()=>{const g=Date.now(),I=Math.max(0,(v.current-g)/1e3);h(I);const A=Math.ceil(I);A<=15&&A>10?(x(!0),T(!1)):A<=10?(x(!0),T(!0)):(x(!1),T(!1)),I<=0&&!p.current&&(p.current=!0,j.current&&(clearInterval(j.current),j.current=null),setTimeout(()=>S.current(),0))},16),()=>{j.current&&(clearInterval(j.current),j.current=null)}},[s,t,i,o,d]),!s||o)return null;const W=u/d,q=(c/2+12)*l,de=6*l,ve=2*Math.PI*q,Ne=-ve*(1-W),ue=Math.ceil(u),w=k?Math.min(1,(10-ue)/10):0,L=Math.max(.05,.15-w*.1);let C="#4299e1";f&&!k?C="#f6ad55":k&&(C="#e53e3e");const R=20*l,y=q*2+de+R*2;return a.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:y,height:y,pointerEvents:"none",zIndex:10,animation:k?`timerShake${F} ${L}s ease-in-out infinite`:void 0},children:[a.jsxs("svg",{width:y,height:y,style:{position:"absolute",top:0,left:0,overflow:"visible"},children:[a.jsx("circle",{cx:y/2,cy:y/2,r:q,fill:"none",stroke:"rgba(0,0,0,0.3)",strokeWidth:de}),a.jsx("circle",{cx:y/2,cy:y/2,r:q,fill:"none",stroke:C,strokeWidth:de,strokeLinecap:"round",strokeDasharray:ve,strokeDashoffset:Ne,style:{transform:"rotate(-90deg)",transformOrigin:"center"}}),f&&a.jsx("circle",{cx:y/2,cy:y/2,r:q,fill:"none",stroke:C,strokeWidth:de*3,opacity:.4,style:{filter:`blur(${12*l}px)`,animation:k?`timerPulse${F} 0.5s ease-in-out infinite`:`timerPulse${F} 1s ease-in-out infinite`}})]}),a.jsx("style",{children:`
                @keyframes timerPulse${F} {
                    0%, 100% { opacity: 0.4; }
                    50% { opacity: 0.7; }
                }
                @keyframes timerShake${F} {
                    0%, 100% { transform: translate(-50%, -50%) translate(0, 0); }
                    25% { transform: translate(-50%, -50%) translate(${2*l}px, ${-2*l}px); }
                    50% { transform: translate(-50%, -50%) translate(${-2*l}px, ${2*l}px); }
                    75% { transform: translate(-50%, -50%) translate(${2*l}px, ${1*l}px); }
                }
            `})]})};function NL(t,e){const[n,r]=O.useState(null),[s,i]=O.useState(""),[o,l]=O.useState(!1),[c,d]=O.useState(null),[u,h]=O.useState(!1);return O.useEffect(()=>{if(t==="CPU")return;const f=new qS;return h(!0),(async()=>{try{const k=await f.connect(t==="JOIN"?e:void 0);i(k),r(f),f.onConnection(()=>{console.log("[useGameNetwork] Connection established!"),l(!0),h(!1)})}catch(k){d(k.toString()),h(!1)}})(),()=>{f.disconnect()}},[t,e]),{adapter:n,myId:s,connected:o,connecting:u,error:c,setConnected:l}}function k_(t,e,n){return!(!t.canEvolveThisTurn||t.evolutionsUsed>=2||e<(n?5:4))}function R_(t,e,n){return!(!t.canEvolveThisTurn||t.sep<=0||e<(n?7:6))}const Ze=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},jL=Ze("/leaders/azya_leader.png"),$L=Ze("/leaders/senka_leader.png"),FL=Ze("/leaders/yoRuka_leader.png"),UL=Ze("/sleeves/azya_sleeve.png"),BL=Ze("/sleeves/senka_sleeve.png"),zL=Ze("/sleeves/yoruka_sleeve.png"),sl=t=>t==="YORUKA"?FL:t==="AJA"?jL:$L,di=t=>t==="YORUKA"?zL:t==="AJA"?UL:BL,HL=1920,sI=1080,WL=()=>{const[t,e]=O.useState({scale:1,toGameX:r=>r,toGameY:r=>r}),n=O.useCallback(()=>{const r=window.visualViewport?window.visualViewport.width:window.innerWidth,s=window.visualViewport?window.visualViewport.height:window.innerHeight;let i=Math.min(r/HL,s/sI);i*=1.5,e({scale:i,toGameX:c=>c,toGameY:c=>c})},[]);return O.useEffect(()=>{n(),window.addEventListener("resize",n),window.addEventListener("orientationchange",()=>{setTimeout(n,150)}),window.visualViewport&&window.visualViewport.addEventListener("resize",n);const r=()=>{document.visibilityState==="visible"&&setTimeout(n,100)};return document.addEventListener("visibilitychange",r),()=>{window.removeEventListener("resize",n),window.removeEventListener("orientationchange",n),window.visualViewport&&window.visualViewport.removeEventListener("resize",n),document.removeEventListener("visibilitychange",r)}},[n]),t},cn=90,Sn=120,ui=cn+18,so=240,GL=({x:t,y:e,onComplete:n,scale:r=1})=>{N.useEffect(()=>{const i=setTimeout(n,2e3);return()=>clearTimeout(i)},[n]);const s=N.useMemo(()=>Array(20).fill(0).map((i,o)=>({id:o,angle:Math.random()*360,dist:(30+Math.random()*60)*r,size:(10+Math.random()*15)*r,delay:Math.random()*.5})),[r]);return a.jsxs("div",{style:{position:"absolute",left:t,top:e,pointerEvents:"none",zIndex:6e3},children:[a.jsx("style",{children:`
                @keyframes healGlowFade {
                    0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; filter: blur(10px); }
                    30% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.8; filter: blur(15px); }
                    100% { transform: translate(-50%, -50%) scale(1.6); opacity: 0; filter: blur(30px); }
                }
                @keyframes healParticleRise {
                    0% { transform: translate(-50%, -50%) rotate(var(--angle)) translate(0, 0) scale(0); opacity: 0; }
                    20% { transform: translate(-50%, -50%) rotate(var(--angle)) translate(0, 0) opacity: 0.7; }
                    100% { transform: translate(-50%, -50%) rotate(var(--angle)) translate(calc(var(--dist) * 1px), 0) scale(1.5); opacity: 0; }
                }
            `}),a.jsx("div",{style:{position:"absolute",left:0,top:0,width:150*r,height:150*r,background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(200,255,240,0.5) 50%, transparent 80%)",borderRadius:"50%",transform:"translate(-50%, -50%)",animation:"healGlowFade 1.5s ease-out forwards",filter:`blur(${8*r}px)`}}),s.map(i=>a.jsx("div",{style:{position:"absolute",left:0,top:0,width:i.size,height:i.size,background:"rgba(255,250,240,0.6)",borderRadius:"50%",filter:`blur(${4*r}px)`,"--angle":`${i.angle}deg`,"--dist":i.dist,animation:`healParticleRise 1.2s ease-out ${i.delay}s forwards`,pointerEvents:"none"}},i.id))]})},VL=({x:t,y:e,atkBuff:n,hpBuff:r,onComplete:s})=>{N.useEffect(()=>{const x=setTimeout(s,1500);return()=>clearTimeout(x)},[s]);const i=n<0||r<0,o=i?"radial-gradient(circle, rgba(180,50,50,0.9) 0%, rgba(150,30,30,0.4) 50%, transparent 80%)":"radial-gradient(circle, rgba(255,230,100,0.9) 0%, rgba(255,200,50,0.4) 50%, transparent 80%)",l=i?"#ff4444":"#ffd93d",c="#ffd93d",d="rgba(255,217,61,0.8)",u=x=>x>=0?`+${x}`:`${x}`,h=80,f=110;return a.jsxs("div",{style:{position:"absolute",left:t,top:e,pointerEvents:"none",zIndex:6e3},children:[a.jsx("style",{children:`
                @keyframes buffGlow {
                    0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
                    30% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
                    100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
                }
                @keyframes buffNumberRise {
                    0% { transform: translateY(0); opacity: 0; }
                    20% { opacity: 1; }
                    100% { transform: translateY(-30px); opacity: 0; }
                }
                @keyframes buffSparkle {
                    0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
                    50% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
                    100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
                }
            `}),a.jsx("div",{style:{position:"absolute",left:0,top:0,width:150,height:150,background:o,borderRadius:"50%",transform:"translate(-50%, -50%)",animation:"buffGlow 1.2s ease-out forwards",filter:"blur(8px)"}}),n!==0&&a.jsx("div",{style:{position:"absolute",left:-h/2+12,top:f/2-20,fontSize:"24px",fontWeight:"bold",color:c,textShadow:`0 0 10px ${d}, 2px 2px 4px rgba(0,0,0,0.8)`,fontFamily:"Tamanegi, sans-serif",animation:"buffNumberRise 1.2s ease-out forwards",textAlign:"center"},children:u(n)}),r!==0&&a.jsx("div",{style:{position:"absolute",left:h/2-28,top:f/2-20,fontSize:"24px",fontWeight:"bold",color:c,textShadow:`0 0 10px ${d}, 2px 2px 4px rgba(0,0,0,0.8)`,fontFamily:"Tamanegi, sans-serif",animation:"buffNumberRise 1.2s ease-out forwards",textAlign:"center"},children:u(r)}),[...Array(8)].map((x,k)=>a.jsx("div",{style:{position:"absolute",left:Math.cos(k*Math.PI/4)*60,top:Math.sin(k*Math.PI/4)*60,width:12,height:12,background:l,borderRadius:"50%",boxShadow:`0 0 10px ${l}, 0 0 20px ${l}`,animation:`buffSparkle 0.8s ease-out ${k*.1}s forwards`}},k))]})},YL=({x:t,y:e,onComplete:n,scale:r=1})=>(N.useEffect(()=>{const s=setTimeout(n,1200);return()=>clearTimeout(s)},[n]),a.jsxs("div",{style:{position:"absolute",left:t,top:e,transform:"translate(-50%, -50%)",width:130*r,height:130*r,pointerEvents:"none",zIndex:5e3,display:"flex",alignItems:"center",justifyContent:"center"},children:[a.jsx("div",{style:{fontSize:`${80*r}px`,animation:"baneSkullAppear 1.2s ease-out forwards",textShadow:`0 0 ${20*r}px #9b59b6, 0 0 ${40*r}px #8e44ad, 0 0 ${60*r}px #6c3483`,filter:`drop-shadow(0 0 ${15*r}px #9b59b6) hue-rotate(-10deg)`},children:""}),[...Array(12)].map((s,i)=>a.jsx("div",{style:{position:"absolute",left:"50%",top:"50%",width:6*r,height:6*r,background:"radial-gradient(circle, #9b59b6, #6c3483)",borderRadius:"50%",boxShadow:`0 0 ${8*r}px #9b59b6, 0 0 ${15*r}px #8e44ad`,animation:`baneParticle 1s ease-out ${i*.08}s forwards`,transform:`rotate(${i*30}deg) translateX(0)`}},i)),a.jsx("style",{children:`
                @keyframes baneSkullAppear {
                    0% { transform: scale(0) rotate(-30deg); opacity: 0; }
                    20% { transform: scale(1.3) rotate(10deg); opacity: 1; }
                    40% { transform: scale(1) rotate(-5deg); opacity: 1; }
                    60% { transform: scale(1.1) rotate(0deg); opacity: 1; }
                    80% { transform: scale(1) rotate(0deg); opacity: 0.8; }
                    100% { transform: scale(1.5) rotate(0deg); opacity: 0; }
                }
                @keyframes baneParticle {
                    0% { transform: rotate(0deg) translateX(0); opacity: 1; }
                    100% { transform: rotate(0deg) translateX(${70*r}px); opacity: 0; }
                }
            `})]})),KL=({type:t,x:e,y:n,onComplete:r,audioSettings:s,scale:i=1})=>{const o=N.useMemo(()=>{let f=8,x=8,k=100,T=256;return t==="SHOT"&&(T=128),{cols:f,rows:x,fps:k,size:T}},[t]);if(N.useEffect(()=>{const x=["LIGHTNING","THUNDER","IMPACT","SUMI","SHOT","ICE","WATER","RAY","FIRE","SLASH","BLUE_FIRE"].includes(t)?o.cols*o.rows/o.fps*1e3:t==="FIREBALL"?500:t==="HEAL"?2e3:400,k=setTimeout(r,x);return()=>clearTimeout(k)},[r,t,o]),N.useEffect(()=>{if(!s||!s.seEnabled)return;const f=(x,k=.5,T=0)=>{setTimeout(()=>{const j=new Audio(Ze(`/se/${x}`));j.volume=(s.se||.5)*k,j.play().catch(b=>console.warn("SE Play prevented",b))},T)};t==="SHOT"?(f("shot.mp3",.6),f("hibi.mp3",.4,400)):t==="IMPACT"?(f("panch1.mp3",.6,100),f("panch2.mp3",.6,500)):t==="LIGHTNING"||t==="THUNDER"?f("thunder.mp3",.5):t==="FIREBALL"?f("explosion.mp3",.5):t==="FIRE"?f("fire.mp3",.5):t==="SLASH"?f("slash.mp3",.5):t==="ICE"?f("ice.mp3",.5):t==="WATER"?f("water.mp3",.5):t==="RAY"?f("ray.mp3",.6):t==="SUMI"?f("yami.mp3",.6):t==="HEAL"?f("heal.mp3",.6):t==="BLUE_FIRE"?f("fire.mp3",.5):t==="BANE"&&f("yami.mp3",.7)},[t,s]),t==="HEAL")return a.jsx(GL,{x:e,y:n,onComplete:r,scale:i});if(t==="BANE")return a.jsx(YL,{x:e,y:n,onComplete:r,scale:i});const l=100*i,c={position:"absolute",left:e,top:n,transform:"translate(-50%, -50%)",width:l,height:l,pointerEvents:"none",zIndex:5e3,display:"flex",alignItems:"center",justifyContent:"center"};if(["LIGHTNING","THUNDER","IMPACT","SUMI","SHOT","ICE","WATER","RAY","FIRE","SLASH","BLUE_FIRE"].includes(t)){let f=Ze("/effects/thunder.png");t==="IMPACT"&&(f=Ze("/effects/impact.png")),t==="SUMI"&&(f=Ze("/effects/sumi.png")),t==="SHOT"&&(f=Ze("/effects/shot.png")),t==="ICE"&&(f=Ze("/effects/ice.png")),t==="WATER"&&(f=Ze("/effects/water.png")),t==="RAY"&&(f=Ze("/effects/ray.png")),t==="FIRE"&&(f=Ze("/effects/fire.png")),t==="SLASH"&&(f=Ze("/effects/slash.png")),t==="BLUE_FIRE"&&(f=Ze("/effects/blue_fire.png"));const x=o.cols*o.rows,k=Math.min(160,o.size)*i;return a.jsxs("div",{style:{...c,width:k,height:k,transform:`${(c==null?void 0:c.transform)||""}`},children:[a.jsx("div",{style:{width:"100%",height:"100%",backgroundImage:`url(${f})`,backgroundSize:`${o.cols*100}% ${o.rows*100}%`,animation:`spriteAnimation ${x/o.fps}s steps(1) forwards`}}),a.jsx("style",{children:`
                    @keyframes spriteAnimation {
                        ${Array.from({length:x}).map((T,j)=>{const b=j%o.cols,v=Math.floor(j/o.cols),S=b*(100/(o.cols-1)),p=v*(100/(o.rows-1));return`${j/(x-1)*100}% { background-position: ${S}% ${p}%; }`}).join(`
`)}
                    }
                `})]})}let u="",h="";if(t==="FIREBALL")u=Ze("/effects/fireball.png"),h="explode 0.5s ease-out forwards";else if(t==="BEAM")return a.jsx("div",{style:{position:"fixed",left:e,top:n,width:400,height:30,background:"linear-gradient(90deg, transparent, #faf089, #fff, #faf089, transparent)",transform:"translate(-50%, -50%) rotate(-45deg)",boxShadow:"0 0 20px #faf089",opacity:0,animation:"beamShoot 0.4s ease-out forwards",pointerEvents:"none",zIndex:5e3},children:a.jsx("style",{children:`
                    @keyframes beamShoot {
                        0% { width: 0; opacity: 1; transform: translate(-50%, -50%) rotate(-45deg) scaleX(0); }
                        20% { width: 400px; opacity: 1; transform: translate(-50%, -50%) rotate(-45deg) scaleX(1); }
                        100% { width: 400px; opacity: 0; transform: translate(-50%, -50%) rotate(-45deg) scaleX(1.2); }
                    }
                `})});return u?a.jsxs("div",{style:c,children:[a.jsx("img",{src:u,style:{width:"100%",height:"100%",objectFit:"contain",animation:h}}),a.jsx("style",{children:`
                @keyframes explode { 0% { transform: scale(0.5); opacity: 0; } 20% { opacity: 1; } 100% { transform: scale(2); opacity: 0; } }
            `})]}):null},XL=({value:t,x:e,y:n,color:r,onComplete:s,scale:i=1})=>{N.useEffect(()=>{const d=setTimeout(s,1200);return()=>clearTimeout(d)},[s]);const o=r==="#48bb78",l=r||"#e53e3e",c=o?"linear-gradient(180deg, #68d391 0%, #38a169 50%, #276749 100%)":"linear-gradient(180deg, #fc8181 0%, #e53e3e 50%, #c53030 100%)";return a.jsxs("div",{style:{position:"absolute",left:e,top:n,transform:"translate(-50%, -50%)",pointerEvents:"none",zIndex:6e3,fontSize:`${4*i}rem`,fontWeight:"900",fontFamily:'"Impact", "Arial Black", sans-serif',letterSpacing:`${-2*i}px`,background:c,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",filter:`drop-shadow(0 0 ${8*i}px ${l}) drop-shadow(0 ${2*i}px ${4*i}px rgba(0,0,0,0.8))`,animation:"floatUp 1.2s ease-out forwards"},children:[t,a.jsx("style",{children:`
                @keyframes floatUp {
                    0% { transform: translate(-50%, -50%) scale(0.3); opacity: 0; }
                    15% { transform: translate(-50%, -70%) scale(1.8); opacity: 1; }
                    30% { transform: translate(-50%, -90%) scale(1.4); opacity: 1; }
                    100% { transform: translate(-50%, -180%) scale(1); opacity: 0; }
                }
            `})]})},QL=({x:t,y:e})=>{const n=N.useMemo(()=>Array(16).fill(0).map((r,s)=>({id:s,angle:Math.random()*360,dist:60+Math.random()*120,size:4+Math.random()*8,delay:Math.random()*.3,color:Math.random()>.5?"#f6e05e":"#ffffff"})),[]);return a.jsxs("div",{style:{position:"absolute",left:t,top:e,pointerEvents:"none",zIndex:6e3},children:[a.jsx("style",{children:`
                @keyframes sparkleMove {
                    0% { transform: rotate(var(--angle)) translate(0, 0) scale(0); opacity: 0; }
                    20% { opacity: 1; transform: rotate(var(--angle)) translate(calc(var(--dist) * 0.2px), 0) scale(1.5); }
                    100% { transform: rotate(var(--angle)) translate(calc(var(--dist) * 1px), 0) scale(0); opacity: 0; }
                }
            `}),n.map(r=>a.jsx("div",{style:{position:"absolute",left:0,top:0,width:r.size,height:r.size,background:r.color,borderRadius:"50%",boxShadow:`0 0 10px ${r.color}, 0 0 20px ${r.color}`,"--angle":`${r.angle}deg`,"--dist":r.dist,animation:`sparkleMove 0.8s ease-out ${r.delay}s forwards`,pointerEvents:"none"}},r.id))]})},JL=({onClose:t})=>a.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(0,0,0,0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:t,children:a.jsxs("div",{style:{background:"linear-gradient(135deg, #1a202c 0%, #2d3748 100%)",borderRadius:16,padding:30,maxWidth:700,maxHeight:"80vh",overflowY:"auto",color:"#fff",boxShadow:"0 20px 60px rgba(0,0,0,0.5)",border:"1px solid #4a5568"},onClick:e=>e.stopPropagation(),children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[a.jsx("h2",{style:{margin:0,color:"#63b3ed"},children:""}),a.jsx("button",{onClick:t,style:{background:"transparent",border:"none",color:"#a0aec0",fontSize:"1.5rem",cursor:"pointer"},children:""})]}),a.jsxs("section",{style:{marginBottom:25},children:[a.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),a.jsxs("ul",{style:{lineHeight:1.8,paddingLeft:20,color:"#e2e8f0"},children:[a.jsx("li",{children:"0"}),a.jsx("li",{children:"1PP110"}),a.jsx("li",{children:"PP"}),a.jsx("li",{children:""}),a.jsx("li",{children:"5"}),a.jsx("li",{children:"910"})]})]}),a.jsxs("section",{style:{marginBottom:25},children:[a.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[a.jsxs("div",{children:[a.jsx("span",{style:{color:"#48bb78",fontWeight:"bold"},children:"[]"}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#ed8936",fontWeight:"bold"},children:"[]"}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#4299e1",fontWeight:"bold"},children:"[]"}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#9f7aea",fontWeight:"bold"},children:"[]"}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#f56565",fontWeight:"bold"},children:"[]"}),"12"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#38b2ac",fontWeight:"bold"},children:"[]"}),"1"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#718096",fontWeight:"bold"},children:"[]"}),"AoE"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#d69e2e",fontWeight:"bold"},children:"[]"}),"AoE"]})]})]}),a.jsxs("section",{style:{marginBottom:25},children:[a.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[a.jsxs("div",{children:[a.jsx("span",{style:{color:"#63b3ed",fontWeight:"bold"},children:""}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#f687b3",fontWeight:"bold"},children:""}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#faf089",fontWeight:"bold"},children:""}),"EP"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#b794f4",fontWeight:"bold"},children:""}),"SEP"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#68d391",fontWeight:"bold"},children:""}),""]})]})]}),a.jsxs("section",{style:{marginBottom:25},children:[a.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),a.jsxs("ul",{style:{lineHeight:1.8,paddingLeft:20,color:"#e2e8f0"},children:[a.jsxs("li",{children:[a.jsx("span",{style:{color:"#faf089"},children:"EP"}),"54112"]}),a.jsxs("li",{children:[a.jsx("span",{style:{color:"#b794f4"},children:"SEP"}),"76112"]}),a.jsx("li",{children:"1111"}),a.jsx("li",{children:"+2/+2"}),a.jsx("li",{children:"+3/+3"})]})]}),a.jsxs("section",{children:[a.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),a.jsxs("ul",{style:{lineHeight:1.8,paddingLeft:20,color:"#e2e8f0"},children:[a.jsxs("li",{children:[a.jsx("span",{style:{color:"#ed8936"},children:"PP"}),""]}),a.jsx("li",{children:"151612PP +1"})]})]})]})}),qL=({logs:t,onCardNameClick:e,scale:n=1,isMobile:r=!1})=>{const s=N.useRef(null);N.useEffect(()=>{s.current&&(s.current.scrollTop=s.current.scrollHeight)},[t.length]);const i=(c,d)=>{const u={color:"#ffd700",cursor:"pointer",textDecoration:"underline",textUnderlineOffset:"2px",fontWeight:"bold"},h=p=>{p.target.style.color="#ffec8b",p.target.style.textShadow="0 0 8px rgba(255, 215, 0, 0.8)"},f=p=>{p.target.style.color="#ffd700",p.target.style.textShadow="none"},x=(p,F)=>a.jsx("span",{style:u,onMouseEnter:h,onMouseLeave:f,onClick:H=>{H.stopPropagation(),e==null||e(p)},children:p},F),k=nI(),T=p=>p?!(/[a-zA-Z0-9]/.test(p)||/[\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/.test(p)):!0,j=[];for(const p of k){let F=0;for(;;){const H=c.indexOf(p,F);if(H===-1)break;const z=H>0?c[H-1]:void 0,W=H+p.length<c.length?c[H+p.length]:void 0,q=T(z)&&T(W),de=j.some(ve=>H>=ve.start&&H<ve.end||H+p.length>ve.start&&H+p.length<=ve.end||H<=ve.start&&H+p.length>=ve.end);q&&!de&&j.push({start:H,end:H+p.length,name:p}),F=H+1}}if(j.length===0)return a.jsx("span",{children:c});j.sort((p,F)=>p.start-F.start);const b=[];let v=0,S=0;for(const p of j)p.start>v&&b.push(a.jsx("span",{children:c.slice(v,p.start)},S++)),b.push(x(p.name,S++)),v=p.end;return v<c.length&&b.push(a.jsx("span",{children:c.slice(v)},S++)),a.jsx(a.Fragment,{children:b})},o=r?Math.max(100,140*n):Math.max(150,200*n),l=r?Math.max(140,180*n):Math.max(180,220*n);return a.jsxs("div",{ref:s,style:{position:"absolute",left:0,top:"45%",transform:"translateY(-50%)",width:l,height:o,overflowY:"auto",background:"linear-gradient(to right, rgba(0,0,0,0.8), rgba(0,0,0,0.0))",color:"#fff",fontSize:r?`${Math.max(.55,.65*n)}rem`:`${Math.max(.65,.75*n)}rem`,padding:r?`${6*n}px ${6*n}px ${6*n}px ${10*n}px`:`${8*n}px ${8*n}px ${8*n}px ${12*n}px`,borderLeft:r?"2px solid #63b3ed":"3px solid #63b3ed",zIndex:15,pointerEvents:"auto",scrollbarWidth:"thin"},onMouseDown:c=>c.stopPropagation(),onClick:c=>c.stopPropagation(),children:[a.jsx("div",{style:{fontWeight:"bold",marginBottom:(r?3:4)*n,color:"#a0aec0",borderBottom:"1px solid rgba(255,255,255,0.1)",paddingBottom:2,fontSize:r?`${Math.max(.5,.55*n)}rem`:`${Math.max(.55,.65*n)}rem`,textTransform:"uppercase",letterSpacing:1},children:r?"LOG":"BATTLE LOG"}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:(r?2:3)*n},children:t.map((c,d)=>a.jsx("div",{style:{opacity:.9,lineHeight:r?"1.3":"1.4",textShadow:"0 1px 2px black",animation:"fadeIn 0.3s ease-out"},children:i(c)},d))})]})},ZL=({card:t,evolvedImageUrl:e,startX:n,startY:r,phase:s,onPhaseChange:i,onShake:o,useSep:l,playSE:c,scale:d,isLightMode:u=!1})=>{const[h,f]=N.useState(0),[x,k]=N.useState(0),[T,j]=N.useState(0),[b,v]=N.useState(0),[S,p]=N.useState(0),[F,H]=N.useState(.25),[z,W]=N.useState({x:n,y:r}),[q,de]=N.useState(!1),[ve,Ne]=N.useState([]),[ue,w]=N.useState([]),[L,C]=N.useState(!1),R=N.useRef(!1),y=N.useRef(null),g=N.useRef(i),I=N.useRef(o),A=N.useRef(c);N.useEffect(()=>{g.current=i,I.current=o,A.current=c},[i,o,c]);const D=360*d,J=480*d;N.useEffect(()=>{var Q,Pe,xe;console.log("[EvolutionAnimation] Phase:",s);let Ie,ne=null;switch(s){case"ZOOM_IN":{W({x:n,y:r}),H(.25),k(0);const qe=Date.now(),Me=650,rt=.25,vt=.75,Ot=setInterval(()=>{const ft=Date.now()-qe,on=Math.min(ft/Me,1),zt=1-Math.pow(1-on,2);k(-5*zt),H(rt+(vt-rt)*zt),on>=1&&clearInterval(Ot)},16);Ie=setTimeout(()=>{const ft=280*d,on=window.innerWidth-ft,zt=ft+on*.4;W({x:zt,y:window.innerHeight/2-30*d})},50);const Ve=setTimeout(()=>{const ft=new Audio(Ze("/se/kirakira.mp3"));ft.volume=.35,ft.play().catch(()=>{}),y.current=ft},600),qt=setTimeout(()=>{g.current("WHITE_FADE")},700);return()=>{clearTimeout(Ie),clearTimeout(qt),clearTimeout(Ve),clearInterval(Ot)}}case"WHITE_FADE":(Q=A.current)==null||Q.call(A,"magic_charge.mp3",.3);const ze=Array(80).fill(0).map((qe,Me)=>{const rt=Me/80*360,vt=(Math.random()-.5)*10,Ot=rt+vt,Ve=200+Math.random()*600,qt=Math.random()*1.8,on=.5+(Ve-200)/600*.5,zt=24+Math.random()*48;return{id:Me,angle:Ot,dist:Ve,delay:qt,duration:on,size:zt}});Ne(ze),C(!0);let we=0;return ne=setInterval(()=>{we+=.025,v(Math.min(we,1)),p(Math.min(we*80,80)),j(we*15),we>=1.2&&(ne&&clearInterval(ne),C(!1),g.current("FLIP"))},40),()=>{ne&&clearInterval(ne)};case"FLIP":if((Pe=A.current)==null||Pe.call(A,"syakin.mp3",.8),(xe=A.current)==null||xe.call(A,"KO.mp3",.7),y.current){const qe=y.current,Me=300,rt=30,vt=Me/rt,Ot=qe.volume/vt;let Ve=0;const qt=setInterval(()=>{Ve++,qe.volume=Math.max(0,qe.volume-Ot),Ve>=vt&&(clearInterval(qt),qe.pause(),y.current=null)},rt)}Ne([]);const je=Date.now(),ht=400,nt=1200;return ne=setInterval(()=>{const qe=Date.now()-je;if(qe<ht){const Me=qe/ht,rt=1-Math.pow(1-Me,3),vt=10+rt*160;if(f(vt),H(.75+rt*((l?1.2:1.1)-.75)),k(-5+rt*2),v(Math.max(1-Me*3,0)),vt>90&&!R.current){R.current=!0;const Ve=Array(120).fill(0).map((qt,ft)=>{const on=ft/120*360,zt=(Math.random()-.5)*8,us=18+Math.random()*42;return{id:ft,angle:on+zt,dist:200+Math.random()*400,size:us*3,delay:Math.random()*.05}});w(Ve)}}else{const Me=Math.min((qe-ht)/nt,1),rt=Me<.5?2*Me*Me:1-Math.pow(-2*Me+2,2)/2;if(f(170+rt*10),v(0),!R.current){R.current=!0;const vt=Array(120).fill(0).map((Ot,Ve)=>{const qt=Ve/120*360,ft=(Math.random()-.5)*8,on=18+Math.random()*42;return{id:Ve,angle:qt+ft,dist:200+Math.random()*400,size:on*3,delay:Math.random()*.05}});w(vt)}Me>=1&&(ne&&clearInterval(ne),g.current("REVEAL"))}},16),()=>{ne&&clearInterval(ne)};case"REVEAL":let ct=0;return ne=setInterval(()=>{ct+=.25,v(Math.max(1-ct,0)),p(Math.max(60-ct*60,0)),ct>=1&&(ne&&clearInterval(ne),w([]),g.current("ZOOM_OUT"))},40),()=>{ne&&clearInterval(ne)};case"ZOOM_OUT":{W({x:n,y:r});const qe=Date.now(),Me=250,rt=F,vt=-3;return ne=setInterval(()=>{const Ot=Date.now()-qe,Ve=Math.min(Ot/Me,1),qt=1-Math.pow(1-Ve,3);H(rt-(rt-.25)*qt),k(vt*(1-qt)),Ve>=1&&(ne&&clearInterval(ne),f(180),j(0),H(.25),k(0),g.current("LAND"))},16),()=>{ne&&clearInterval(ne)}}case"LAND":return I.current(),de(!0),Ie=setTimeout(()=>{g.current("DONE")},600),()=>clearTimeout(Ie)}return()=>{Ie&&clearTimeout(Ie),ne&&clearInterval(ne),y.current&&(y.current.pause(),y.current=null)}},[s]);const U=h+T,ge=x,G=L?{x:(Math.random()-.5)*4,y:(Math.random()-.5)*4}:{x:0,y:0};return a.jsxs("div",{style:{position:"fixed",inset:0,zIndex:1e4,background:"rgba(0,0,0,0.75)",pointerEvents:"none"},children:[a.jsx("style",{children:`
                ${ve.map(Ie=>`
                    @keyframes chargeParticleIn-${Ie.id} {
                        0% { opacity: 0; transform: rotate(${Ie.angle}deg) translateX(${Ie.dist}px) scale(0.5); }
                        20% { opacity: 0.8; transform: rotate(${Ie.angle}deg) translateX(${Ie.dist*.8}px) scale(1.2); }
                        100% { opacity: 1; transform: rotate(${Ie.angle}deg) translateX(0) scale(0.2); } /* Keep visible at end */
                    }
                `).join("")}
                ${ue.map(Ie=>`
                    @keyframes burstParticleOut-${Ie.id} {
                        0% { opacity: 1; transform: translate(-50%, -50%) rotate(${Ie.angle}deg) translateX(0) scale(1.5); }
                        100% { opacity: 0; transform: translate(-50%, -50%) rotate(${Ie.angle}deg) translateX(${Ie.dist*1.5}px) scale(0); }
                    }
                `).join("")}
            `}),(u?ve.filter((Ie,ne)=>ne%2===0):ve).map(Ie=>a.jsx("div",{style:{position:"absolute",left:z.x,top:z.y,width:Ie.size*d,height:Ie.size*d,borderRadius:"50%",background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(200,230,255,0.6) 40%, transparent 70%)",boxShadow:u?"0 0 8px white":"0 0 10px white, 0 0 20px rgba(100,200,255,0.5)",filter:u?void 0:"blur(1px)",animation:`chargeParticleIn-${Ie.id} ${Ie.duration}s ease-in ${Ie.delay}s forwards`,transform:`rotate(${Ie.angle}deg) translateX(${Ie.dist*d}px)`,opacity:0,pointerEvents:"none"}},`charge-${Ie.id}`)),s==="WHITE_FADE"&&a.jsxs("div",{style:{position:"absolute",left:z.x+G.x,top:z.y+G.y,width:0,height:0,transformStyle:"preserve-3d"},children:[a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:500*d,height:500*d,border:"8px solid rgba(255, 255, 255, 0.6)",borderRadius:"50%",transform:"translate(-50%, -50%) rotateX(75deg)",boxShadow:u?"0 0 15px rgba(255, 255, 255, 0.6)":"0 0 30px rgba(255, 255, 255, 0.8), inset 0 0 30px rgba(255, 255, 255, 0.8)",animation:"ringSpin 2s linear infinite"}}),!u&&a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:600*d,height:600*d,border:"6px dashed rgba(100, 200, 255, 0.7)",borderRadius:"50%",transform:"translate(-50%, -50%) rotateX(80deg) rotateY(10deg)",boxShadow:"0 0 40px rgba(100, 200, 255, 0.5)",animation:"ringSpinReverse 3s linear infinite"}}),a.jsx("style",{children:`
                        @keyframes ringSpin {
                            0% { transform: translate(-50%, -50%) rotateX(75deg) rotate(0deg); opacity: 0; scale: 0.5; }
                            20% { opacity: 1; scale: 1; }
                            100% { transform: translate(-50%, -50%) rotateX(75deg) rotate(360deg); opacity: 1; scale: 1; }
                        }
                        @keyframes ringSpinReverse {
                            0% { transform: translate(-50%, -50%) rotateX(80deg) rotateY(10deg) rotate(0deg); opacity: 0; scale: 0.6; }
                            20% { opacity: 0.8; scale: 1; }
                            100% { transform: translate(-50%, -50%) rotateX(80deg) rotateY(10deg) rotate(-360deg); opacity: 0.8; scale: 1; }
                        }
                    `})]}),(u?ue.filter((Ie,ne)=>ne%2===0):ue).map(Ie=>a.jsx("div",{style:{position:"absolute",left:z.x,top:z.y,width:Ie.size*d,height:Ie.size*d,borderRadius:"50%",background:l?"radial-gradient(circle, rgba(183, 148, 244, 1) 0%, rgba(159, 122, 234, 0.8) 50%, transparent 100%)":"radial-gradient(circle, rgba(255, 251, 235, 1) 0%, rgba(251, 211, 141, 0.8) 50%, transparent 100%)",boxShadow:u?l?"0 0 8px #b794f4":"0 0 8px #fbd38d":l?"0 0 10px #b794f4, 0 0 20px rgba(159,122,234,0.6)":"0 0 10px #fbd38d, 0 0 20px rgba(251,211,141,0.6)",animation:`burstParticleOut-${Ie.id} 0.4s ease-out ${Ie.delay}s forwards`,pointerEvents:"none"}},`burst-${Ie.id}`)),a.jsxs("div",{style:{position:"absolute",left:z.x+G.x,top:z.y+G.y,transform:`translate(-50%, -50%) scale(${F}) perspective(1200px) rotateY(${U}deg) rotateZ(${ge}deg)`,transition:s==="ZOOM_IN"||s==="ZOOM_OUT"?"left 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), top 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)":"none",transformStyle:"preserve-3d"},children:[!u&&a.jsx("div",{style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:D*1.3,height:J*1.2,background:l?"radial-gradient(ellipse, rgba(159, 122, 234, 0.4) 0%, transparent 70%)":"radial-gradient(ellipse, rgba(251, 211, 141, 0.4) 0%, transparent 70%)",filter:"blur(20px)",pointerEvents:"none",opacity:S>1?1:0,transition:"opacity 0.4s"}}),a.jsxs("div",{style:{width:D,height:J,borderRadius:16,overflow:"hidden",boxShadow:u?l?"0 0 20px rgba(159, 122, 234, 0.5)":"0 0 20px rgba(251, 211, 141, 0.5)":l?"0 0 40px rgba(159, 122, 234, 0.7)":"0 0 40px rgba(251, 211, 141, 0.7)",position:"relative",transformStyle:"preserve-3d"},children:[a.jsxs("div",{style:{position:"absolute",inset:0,borderRadius:16,overflow:"hidden",background:"#1a202c",zIndex:U<=90?2:1,opacity:U<=90?1:0},children:[a.jsx("img",{src:Ze(t.imageUrl||""),alt:t.name,style:{width:"100%",height:"100%",objectFit:"cover",filter:`brightness(${1+b*.5}) contrast(${1-b*.2})`}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"white",opacity:b,pointerEvents:"none"}})]}),a.jsxs("div",{style:{position:"absolute",inset:0,transform:"rotateY(180deg)",borderRadius:16,overflow:"hidden",background:"#1a202c",zIndex:U>90?2:1,opacity:U>90?1:0},children:[a.jsx("img",{src:Ze(e&&e!==""?e:t.imageUrl||""),alt:`${t.name} Evolved`,style:{width:"100%",height:"100%",objectFit:"cover",filter:`brightness(${1+b*.5}) contrast(${1-b*.2})`}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"white",opacity:b,pointerEvents:"none"}})]})]})]}),q&&a.jsxs("div",{style:{position:"absolute",left:n,top:r,pointerEvents:"none"},children:[a.jsx("style",{children:`
                        @keyframes landParticleMove {
                            0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                            100% { opacity: 0; transform: translate(-50%, -50%) rotate(var(--angle)) translateX(calc(var(--dist) * 1px)) scale(0); }
                        }
                    `}),Array(20).fill(0).map((Ie,ne)=>{const Q=ne/20*360,Pe=40+Math.random()*100;return a.jsx("div",{style:{position:"absolute",left:0,top:0,width:8*d,height:8*d,borderRadius:"50%",background:"white","--angle":`${Q}deg`,"--dist":Pe,animation:"landParticleMove 0.5s ease-out forwards"}},`land-${ne}`)})]})]})},A_=Ze("/leaders/yoRuka_win.png"),P_=Ze("/leaders/yoRuka_lose.png"),e3=Ze("/leaders/senka_win.png"),t3=Ze("/leaders/senka_lose.png"),n3=Ze("/leaders/azya_win.png"),r3=Ze("/leaders/azya_lose.png"),s3=t=>({BRONZE:"#cd7f32",SILVER:"#c0c0c0",GOLD:"#ffd700",PLATINUM:"#e5e4e2",DIAMOND:"#b9f2ff",MASTER:"#ff4500"})[t],i3=({winnerId:t,playerId:e,playerClass:n,onRematch:r,onRematching:s,onLeave:i,isOnline:o,isRoomMatch:l=!0,myRematchRequested:c,opponentRematchRequested:d,battleStats:u,selectedCardInfo:h,onCardInfoClick:f,victoryReason:x="normal",isRankedMatch:k=!1,ratingResult:T})=>{const j=t===e,v=(()=>{if(!j)return null;switch(x){case"disconnect":return"";case"surrender":return"";default:return null}})(),[S,p]=N.useState("bg-fade"),F=["bg-fade","image","result-text","stats","rate","buttons","complete"].indexOf(S);N.useEffect(()=>{const y={"bg-fade":300,image:600,"result-text":400,stats:400,rate:300,buttons:0};if(S==="complete")return;const g={"bg-fade":"image",image:"result-text","result-text":"stats",stats:"rate",rate:"buttons",buttons:"complete"},I=setTimeout(()=>{const A=g[S];A&&p(A)},y[S]||0);return()=>clearTimeout(I)},[S]);const H=()=>n==="SENKA"?j?e3:t3:n==="AJA"?j?n3:r3:j?A_:P_,[z,W]=N.useState(15),[q,de]=N.useState(!1),[ve,Ne]=N.useState(null),ue=o?c||d:c||q;N.useEffect(()=>{if(ue)return;const y=setInterval(()=>{W(g=>g<=1?(clearInterval(y),i(),0):g-1)},1e3);return()=>clearInterval(y)},[i,ue]);const w=y=>{Ne(y),o&&!l&&s?s(y):r(y)},L=()=>{const y=!o||l?"":"";return o?c&&d?"...":c?"...":d?`${y}`:y:c?"...":y},C=()=>{const y={padding:"15px 40px",fontSize:"1.5rem",fontWeight:"bold",border:"none",borderRadius:12,cursor:c?"default":"pointer",transform:"scale(1)",transition:"transform 0.1s, background 0.2s"};return d&&!c?{...y,background:"linear-gradient(135deg, #f6e05e, #d69e2e)",color:"black",boxShadow:"0 4px 15px rgba(246, 224, 94, 0.6)",animation:"pulse 1s infinite"}:c?{...y,background:"linear-gradient(135deg, #718096, #4a5568)",color:"white",boxShadow:"none"}:{...y,background:"linear-gradient(135deg, #48bb78, #38a169)",color:"white",boxShadow:"0 4px 15px rgba(72, 187, 120, 0.4)"}},R=(y,g)=>({width:220,height:220,borderRadius:"50%",border:ve===y?"5px solid #f6e05e":"4px solid rgba(255,255,255,0.4)",background:y==="AJA"?`url(${sl(y)}) center top/cover`:`url(${sl(y)}) center/cover`,cursor:"pointer",transform:g?"scale(1.1)":"scale(1)",transition:"all 0.2s ease",boxShadow:g?"0 0 30px rgba(246, 224, 94, 0.7)":"0 6px 15px rgba(0,0,0,0.5)"});return a.jsxs("div",{style:{position:"absolute",inset:0,zIndex:5e3,background:"rgba(0,0,0,0.85)",backdropFilter:"blur(10px)",display:"flex",flexDirection:"row",alignItems:"stretch",opacity:F>=0?1:0,transition:"opacity 0.3s ease-out"},onClick:()=>{},children:[a.jsx("style",{children:`
                @keyframes pulse {
                    0%, 100% { transform: scale(1); }
                    50% { transform: scale(1.05); }
                }
                @keyframes float {
                    0%, 100% { transform: translateY(0); }
                    50% { transform: translateY(-10px); }
                }
                @keyframes slideUpFadeIn {
                    0% { opacity: 0; transform: translateY(30px); }
                    100% { opacity: 1; transform: translateY(0); }
                }
                @keyframes imageFadeIn {
                    0% { opacity: 0; transform: scale(0.95); }
                    100% { opacity: 0.9; transform: scale(1); }
                }
            `}),a.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:40,borderRight:"1px solid rgba(255,255,255,0.1)"},children:h?a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:16,maxWidth:320},children:[a.jsx("div",{style:{width:200,height:280,backgroundImage:`url(${Ze(`/cards/${h.id}.png`)})`,backgroundSize:"cover",backgroundPosition:"center",borderRadius:12,boxShadow:"0 8px 30px rgba(0,0,0,0.6)"}}),a.jsx("div",{style:{fontFamily:"var(--font-tamanegi)",fontSize:"1.6rem",color:"white",textShadow:"0 2px 6px rgba(0,0,0,0.6)",textAlign:"center"},children:h.name}),a.jsxs("div",{style:{display:"flex",gap:20,fontSize:"1.2rem",color:"rgba(255,255,255,0.9)"},children:[a.jsxs("span",{children:[": ",h.cost]}),h.type==="FOLLOWER"&&a.jsxs(a.Fragment,{children:[a.jsxs("span",{children:[": ",h.attack]}),a.jsxs("span",{children:[": ",h.health]})]})]}),a.jsx("div",{style:{fontSize:"1rem",color:"rgba(255,255,255,0.7)",textAlign:"center",lineHeight:1.5,maxHeight:120,overflow:"auto"},children:h.description||""}),a.jsx("button",{onClick:()=>f(null),style:{padding:"8px 24px",fontSize:"1rem",background:"transparent",border:"1px solid rgba(255,255,255,0.3)",color:"white",borderRadius:8,cursor:"pointer",marginTop:10},children:""})]}):a.jsx("div",{style:{width:"100%",height:"100%",backgroundImage:`url(${H()})`,backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat",opacity:F>=1?.9:0,transform:F>=1?"scale(1)":"scale(0.95)",transition:"opacity 0.6s ease-out, transform 0.6s ease-out"}})}),a.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:40,position:"relative"},children:[a.jsx("div",{style:{fontFamily:"var(--font-tamanegi)",fontSize:"5rem",color:j?"#f6e05e":"#a0aec0",textShadow:j?"0 0 40px rgba(246, 224, 94, 0.7), 4px 4px 8px rgba(0,0,0,0.6)":"0 0 20px rgba(160, 174, 192, 0.5), 4px 4px 8px rgba(0,0,0,0.6)",marginBottom:20,opacity:F>=2?1:0,transform:F>=2?"translateY(0)":"translateY(30px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out",animation:F>=2?"float 3s ease-in-out infinite":"none"},children:j?"":""}),v&&a.jsx("div",{style:{fontSize:"1.1rem",color:"rgba(255, 255, 255, 0.8)",marginTop:-10,marginBottom:20,opacity:F>=2?1:0,transform:F>=2?"translateY(0)":"translateY(20px)",transition:"opacity 0.4s ease-out 0.2s, transform 0.4s ease-out 0.2s"},children:v}),a.jsxs("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"center",gap:16,marginBottom:30,padding:"16px 24px",background:"rgba(0,0,0,0.3)",borderRadius:12,border:"1px solid rgba(255,255,255,0.1)",opacity:F>=3?1:0,transform:F>=3?"translateY(0)":"translateY(30px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out"},children:[a.jsxs("div",{style:{textAlign:"center",minWidth:80},children:[a.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#f6e05e"},children:u.turnCount}),a.jsx("div",{style:{fontSize:"0.9rem",color:"rgba(255,255,255,0.6)"},children:""})]}),a.jsxs("div",{style:{textAlign:"center",minWidth:80},children:[a.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#48bb78"},children:u.damageDealtToOpponent}),a.jsx("div",{style:{fontSize:"0.9rem",color:"rgba(255,255,255,0.6)"},children:""})]}),a.jsxs("div",{style:{textAlign:"center",minWidth:80},children:[a.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#e53e3e"},children:u.damageReceivedFromOpponent}),a.jsx("div",{style:{fontSize:"0.9rem",color:"rgba(255,255,255,0.6)"},children:""})]}),a.jsxs("div",{style:{textAlign:"center",minWidth:80},children:[a.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#63b3ed"},children:u.followersDestroyed}),a.jsx("div",{style:{fontSize:"0.9rem",color:"rgba(255,255,255,0.6)"},children:""})]})]}),k&&T&&a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:8,marginTop:16,opacity:F>=4?1:0,transform:F>=4?"translateY(0)":"translateY(20px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out"},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,background:"rgba(0, 0, 0, 0.5)",padding:"12px 24px",borderRadius:12,border:`2px solid ${T.ratingChange>=0?"#48bb78":"#e53e3e"}`},children:[a.jsx("span",{style:{fontSize:"1.2rem",color:"rgba(255,255,255,0.8)",fontFamily:"var(--font-tamanegi)"},children:""}),a.jsxs("span",{style:{fontSize:"2rem",fontWeight:"bold",color:T.ratingChange>=0?"#48bb78":"#e53e3e",fontFamily:"var(--font-tamanegi)"},children:[T.ratingChange>=0?"+":"",T.ratingChange]})]}),T.ratingChange>0&&(T.bonusBreakdown.winStreakBonus>0||T.bonusBreakdown.rankDiffBonus>0)&&a.jsxs("div",{style:{display:"flex",gap:16,fontSize:"0.85rem",color:"rgba(255,255,255,0.6)",fontFamily:"var(--font-tamanegi)"},children:[a.jsxs("span",{children:[": +",T.bonusBreakdown.base]}),T.bonusBreakdown.winStreakBonus>0&&a.jsxs("span",{style:{color:"#f6e05e"},children:[": +",T.bonusBreakdown.winStreakBonus]}),T.bonusBreakdown.rankDiffBonus>0&&a.jsxs("span",{style:{color:"#63b3ed"},children:[": +",T.bonusBreakdown.rankDiffBonus]})]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,fontSize:"1rem",color:"rgba(255,255,255,0.8)",fontFamily:"var(--font-tamanegi)"},children:[a.jsx("span",{style:{color:s3(T.newRank),fontWeight:"bold"},children:Po[T.newRank]}),a.jsx("span",{children:T.newRating})]}),T.isRankUp&&a.jsxs("div",{style:{fontSize:"1.4rem",fontWeight:"bold",color:"#f6e05e",textShadow:"0 0 20px rgba(246, 224, 94, 0.8)",fontFamily:"var(--font-tamanegi)",animation:"pulse 1s ease-in-out infinite"},children:[Po[T.newRank],""]}),T.isRankDown&&a.jsxs("div",{style:{fontSize:"1.2rem",color:"#e53e3e",fontFamily:"var(--font-tamanegi)"},children:[Po[T.newRank],""]})]}),a.jsx("div",{style:{position:"absolute",right:20,bottom:270,width:180,textAlign:"center",fontFamily:"var(--font-tamanegi)",fontSize:"1.4rem",color:j?"#f6e05e":"#e53e3e",textShadow:j?"0 0 20px rgba(246, 224, 94, 0.8), 2px 2px 4px rgba(0,0,0,0.8)":"0 0 20px rgba(229, 62, 62, 0.8), 2px 2px 4px rgba(0,0,0,0.8)",zIndex:10,opacity:F>=5?1:0,transition:"opacity 0.4s ease-out"},children:j?"":""}),q&&!c?a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",animation:"fadeIn 0.3s ease-out"},children:[a.jsx("div",{style:{fontFamily:"var(--font-tamanegi)",fontSize:"1.6rem",color:"white",marginBottom:24,textShadow:"0 2px 6px rgba(0,0,0,0.6)"},children:""}),a.jsxs("div",{style:{display:"flex",gap:40,marginBottom:24},children:[a.jsx(O_,{deckType:"SENKA",label:"",onSelect:w,getStyle:R}),a.jsx(O_,{deckType:"AJA",label:"",onSelect:w,getStyle:R})]}),a.jsx("button",{onClick:()=>de(!1),style:{padding:"10px 36px",fontSize:"1.1rem",fontWeight:"bold",background:"transparent",border:"2px solid rgba(255,255,255,0.3)",color:"white",borderRadius:10,cursor:"pointer",marginTop:8},children:""})]}):a.jsxs("div",{style:{display:"flex",gap:20,opacity:F>=5?1:0,transform:F>=5?"translateY(0)":"translateY(30px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out"},children:[a.jsx("button",{onClick:()=>{c||de(!0)},disabled:c,style:C(),onMouseDown:y=>{c||(y.currentTarget.style.transform="scale(0.95)")},onMouseUp:y=>y.currentTarget.style.transform="scale(1)",children:L()}),a.jsxs("button",{onClick:i,style:{padding:"15px 40px",fontSize:"1.5rem",fontWeight:"bold",background:"transparent",border:"2px solid rgba(255,255,255,0.3)",color:"white",borderRadius:12,cursor:"pointer"},children:[" ",!ue&&`(${z})`]})]}),a.jsx("div",{onClick:()=>{q&&!c&&w("YORUKA")},style:{position:"absolute",right:20,bottom:20,width:180,height:240,backgroundImage:`url(${j?A_:P_})`,backgroundSize:"cover",backgroundPosition:"center",borderRadius:12,cursor:q&&!c?"pointer":"default",opacity:F>=5?.7:0,transition:"opacity 0.4s ease",boxShadow:"0 8px 20px rgba(0,0,0,0.4)"}})]})]})},O_=({deckType:t,label:e,onSelect:n,getStyle:r})=>{const[s,i]=N.useState(!1);return a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:12},children:[a.jsx("button",{onClick:()=>n(t),onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),style:r(t,s)}),a.jsx("span",{style:{color:"white",fontFamily:"var(--font-tamanegi)",fontSize:"1.4rem",textShadow:"0 2px 6px rgba(0,0,0,0.6)"},children:e})]})},L_=(t,e)=>{const[n,r]=N.useState([]),s=N.useRef(!1);return N.useEffect(()=>{r(i=>{const o=[],l=new Map((t||[]).filter(c=>c).map(c=>[c.instanceId,c]));return i.forEach(c=>{var u;if(!c)return;const d=l.get(c.instanceId);d?(o.push({...d,passiveAbilities:d.passiveAbilities?[...d.passiveAbilities]:[],hasBarrier:d.hasBarrier??((u=d.passiveAbilities)==null?void 0:u.includes("BARRIER"))??!1,isDying:!1}),l.delete(c.instanceId)):o.push({...c,isDying:!0,killedByBane:c.killedByBane})}),l.forEach(c=>{var d;o.push({...c,passiveAbilities:c.passiveAbilities?[...c.passiveAbilities]:[],hasBarrier:c.hasBarrier??((d=c.passiveAbilities)==null?void 0:d.includes("BARRIER"))??!1,isDying:!1})}),o})},[t]),N.useEffect(()=>{if(n.some(o=>o.isDying)){if(e!=null&&e.current){s.current=!0;return}const o=setTimeout(()=>{r(l=>l.filter(c=>!c.isDying))},700);return()=>clearTimeout(o)}},[n,e]),N.useEffect(()=>{const o=setInterval(()=>{if(!(e!=null&&e.current)&&s.current){s.current=!1;const l=setTimeout(()=>{r(c=>c.filter(d=>!d.isDying))},300);return()=>clearTimeout(l)}},100);return()=>clearInterval(o)},[e]),n},o3=({playerClass:t,opponentType:e,gameMode:n,targetRoomId:r,onLeave:s,onRematching:i,networkAdapter:o,networkConnected:l,opponentClass:c,aiDifficulty:d="NORMAL",playerName:u,timerEnabled:h=!0,playerId:f,opponentPlayerId:x,opponentRating:k})=>{var Mm,Nm,jm,$m,Fm,Um,Bm,zm,Hm;const T=n==="CPU"||!o,j=NL(T?n==="CPU"?"CPU":n:"CPU",T?r:void 0),b=o||j.adapter,v=l!==void 0?l:j.connected,S=WL(),{scale:p,toGameX:F,toGameY:H}=S,{isLightMode:z}=rI(),[W,q]=O.useState(!1);O.useEffect(()=>{(()=>{q("ontouchstart"in window||navigator.maxTouchPoints>0)})()},[]);const de=O.useCallback((m,_)=>({x:F(m),y:H(_)}),[F,H]),[ve,Ne]=O.useState(null),ue=N.useRef(S);O.useEffect(()=>{ue.current=S},[S]);const w=n==="CPU"||n==="HOST"||(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&(b==null?void 0:b.isHost)===!0,L=w?"p1":"p2",C=w?"p2":"p1";console.log("[GameScreen INIT]",{gameMode:n,"adapter?.isHost":b==null?void 0:b.isHost,isHost:w,currentPlayerId:L,connected:v,"networkAdapter provided":!!o,networkConnected:l});const R=c||(t==="YORUKA"?Math.random()<.5?"SENKA":"AJA":t==="SENKA"?"AJA":"SENKA"),y=n==="JOIN"||(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&!w,[g,I]=O.useReducer(CL,null,()=>{const m=n==="CPU"?"CPU":"";return y?bd(m,R,u,t):bd(u,t,m,R)}),[A,D]=O.useState(!y),J=n==="CASUAL_MATCH"||n==="RANKED_MATCH",[U,ge]=N.useState(J?!1:!y),[G,Ie]=N.useState(!1),[ne,Q]=N.useState(!1),[Pe,xe]=N.useState(!1),[ze,we]=N.useState(J),[je,ht]=N.useState(!1),nt=N.useRef(!1);console.log("[GameScreen SYNC STATE]",{isCasualOrRanked:J,isJoinSide:y,gameSynced:A,waitingForIntroSync:ze,opponentReadyForIntro:je,showBattleIntro:U,"introSyncSentRef.current":nt.current});const[ct,qe]=N.useState(!1),[Me,rt]=N.useState(null),[vt,Ot]=N.useState(0),[Ve,qt]=N.useState({x:0,y:0}),[ft,on]=N.useState("IDLE"),[zt,us]=N.useState(null),[ia,oa]=N.useState(!1),[Ir,nc]=N.useState(()=>Math.random()>.5),[Ce,tt]=N.useState(!1),[Un,Gi]=N.useState(!1),[rf,J0]=N.useState("normal"),[Tr,q0]=N.useState(t),[rc,aa]=N.useState({turnCount:0,damageDealtToOpponent:0,damageReceivedFromOpponent:0,followersDestroyed:0,myFollowersDestroyed:0}),[iI,sf]=N.useState(null),[oI,aI]=N.useState(null),[Z0,em]=N.useState(!1);N.useEffect(()=>{if(n!=="RANKED_MATCH"||!f||!g.winnerId||Z0)return;(async()=>{try{const _=await lS(f,Tr),E=g.winnerId===L;let P;E?P=NO(_.rating,_.winStreak,k??0):P=jO(_.rating),await FO(f,Tr,P,E),aI(P),em(!0),console.log("[RatingUpdate] Rating updated:",P)}catch(_){console.error("[RatingUpdate] Failed to update rating:",_),em(!0)}})()},[n,f,g.winnerId,L,Tr,k,Z0]),N.useEffect(()=>{g.winnerId&&!ct&&!Pe&&xe(!0)},[g.winnerId,ct,Pe]),N.useEffect(()=>{if(vt<=0){qt({x:0,y:0});return}let m;const _=()=>{const E=Date.now()*.03,P=25*vt*p,M=Math.sin(E*7)*P+Math.sin(E*13)*P*.5,Y=Math.cos(E*11)*P+Math.cos(E*17)*P*.3;qt({x:M,y:Y}),m=requestAnimationFrame(_)};return m=requestAnimationFrame(_),()=>cancelAnimationFrame(m)},[vt,p]);const[of,tm]=N.useState([]),lI=N.useRef(0),[af,nm]=N.useState(!1),[lf,sc]=N.useState(null),[la,Vi]=N.useState(null),Br=N.useRef(null),wr=N.useRef(null),Cr=N.useRef(null),cf=N.useRef(g.logs.length),ic=O.useRef(!1),rm=O.useRef(!1),oc=O.useRef(null);O.useEffect(()=>{const m=n==="HOST"||(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&w,_=J?v&&b:v&&b&&ft==="DONE";if(console.log("[GameScreen INIT_GAME useEffect]",{isHostSide:m,isCasualOrRanked:J,connected:v,"adapter exists":!!b,coinTossPhase:ft,canSendInitGame:_,"initialStateSentRef.current":ic.current}),m&&_&&!ic.current){console.log("[GameScreen] HOST side: Sending initial game state to JOIN"),ic.current=!0;const E=()=>{console.log("[GameScreen] HOST side: Actually sending INIT_GAME now, isFirstPlayer:",Ir);const P=J?{...g,firstPlayerId:Ir?"p1":"p2"}:g;b.send({type:"INIT_GAME",payload:P}),(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&(console.log("[GameScreen] HOST side: Sending READY_FOR_INTRO"),b.send({type:"READY_FOR_INTRO"}),nt.current=!0)};setTimeout(E,500),(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&setTimeout(()=>{je||(console.log("[GameScreen] HOST side: Retrying INIT_GAME (no response yet)"),E())},2500)}},[n,v,b,g,ft,w,J,je]),O.useEffect(()=>{!J||!b||!A||nt.current||y&&(console.log("[GameScreen] JOIN side: Sending READY_FOR_INTRO after game sync"),b.send({type:"READY_FOR_INTRO"}),nt.current=!0)},[J,b,A,y]),O.useEffect(()=>{!J||!b||!ze||w&&je&&nt.current&&(console.log("[GameScreen] HOST side: Both ready, sending START_INTRO"),b.send({type:"START_INTRO"}),we(!1),ge(!0))},[J,b,w,je,ze]);const oe=g.players[L],Oe=g.players[C];O.useEffect(()=>{var _,E;const m=g.logs.length;if(m>cf.current)for(let P=cf.current;P<m;P++){const M=g.logs[P],Y=M.match(/(.+?)  (\d+) /);if(Y){const $=Y[1],B=parseInt(Y[2],10),K=(oe==null?void 0:oe.name)===$?L:C,le=lI.current++;tm(te=>[...te,{playerId:K,amount:B,key:le}]),setTimeout(()=>{tm(te=>te.filter(he=>he.key!==le))},1500)}const ee=M.match(/(.+?) (?:)?/);if(ee){const $=ee[1],B=(_=g.players[L])==null?void 0:_.board.find(he=>(he==null?void 0:he.name)===$),K=(E=g.players[C])==null?void 0:E.board.find(he=>(he==null?void 0:he.name)===$),le=B||K,te=B?L:C;if(le){const he=g.players[te].board.findIndex(Ee=>(Ee==null?void 0:Ee.instanceId)===le.instanceId),Ke=(te===L?kr.current:lr.current)[he];if(Ke){const Ee=Ke.getBoundingClientRect(),Ge=Ee.left+Ee.width/2,Je=Ee.top+Ee.height/2;mc(He=>[...He,{id:Date.now()+Math.random(),value:0,x:Ge,y:Je,color:"#e53e3e"}])}}}}cf.current=m},[g.logs.length,L,C,oe==null?void 0:oe.name,g.players]);const[df,ca]=N.useState(!1),zr=N.useRef(!1),bn=L_(((Mm=g.players[L])==null?void 0:Mm.board)||[],zr),hn=L_(((Nm=g.players[C])==null?void 0:Nm.board)||[],zr),da=N.useRef(bn),ac=N.useRef(hn),[ai,lc]=N.useState(null),[uf,sm]=N.useState(-1),cc=N.useRef(null),[Yi,ua]=N.useState([]),[Z,Hr]=N.useState(null),[ut,Qn]=N.useState(null),[cI,im]=N.useState([]),dI=N.useRef(0),om=N.useRef(0),am=N.useRef(null),lm=N.useRef(Z);lm.current=Z,N.useEffect(()=>{const m=Z==null?void 0:Z.sourceType;if(!m||m!=="BOARD"&&m!=="EVOLVE"){im([]);return}const _=400,E=setInterval(()=>{const P=lm.current;if(!P||P.sourceType!=="BOARD"&&P.sourceType!=="EVOLVE")return;const M=Date.now(),Y=Math.PI*(3-Math.sqrt(5));om.current+=Y+(Math.random()-.5)*.3;const ee=om.current,$=4+Math.random()*3,B={id:dI.current++,x:P.currentX,y:P.currentY,vx:Math.cos(ee)*$,vy:Math.sin(ee)*$,opacity:1,radius:3+Math.random()*2,createdAt:M};im(K=>[...K.filter(te=>M-te.createdAt<_).map(te=>({...te,x:te.x+te.vx,y:te.y+te.vy,opacity:Math.max(0,1-(M-te.createdAt)/_)})),B])},80);return()=>clearInterval(E)},[Z==null?void 0:Z.sourceType]),N.useEffect(()=>{const m=(Z==null?void 0:Z.sourceType)==="EVOLVE";if(m&&!Cr.current){const _=new Audio(Ze("/se/aura.mp3"));_.loop=!0,_.volume=0,_.play().catch(()=>{}),Cr.current=_;const E=300,P=30,M=E/P,Y=.25/M;let ee=0;const $=setInterval(()=>{ee++,Cr.current&&(Cr.current.volume=Math.min(ee*Y,.25)),ee>=M&&clearInterval($)},P)}else if(!m&&Cr.current){const _=Cr.current,E=200,P=20,M=E/P,Y=_.volume/M;let ee=0;const $=setInterval(()=>{ee++,_.volume=Math.max(0,_.volume-Y),ee>=M&&(clearInterval($),_.pause(),_.currentTime=0)},P);Cr.current=null}return()=>{!Z&&Cr.current&&(Cr.current.pause(),Cr.current=null)}},[Z==null?void 0:Z.sourceType]);const[cm,ff]=N.useState(new Set),[dm,dc]=N.useState(null),[um,uc]=N.useState(null),[uI,fm]=N.useState(null),[$e,Wr]=N.useState(null),hf=N.useCallback(m=>{const _=Kr(m);_&&(g.winnerId?sf(_):Wr({card:_,owner:"OPPONENT",source:"LOG"}))},[g.winnerId]),fI=N.useCallback(m=>{const _=/([^]+)/g,E=[];let P=0,M,Y=0;const ee=nI();for(;(M=_.exec(m))!==null;){M.index>P&&E.push(a.jsx("span",{children:m.slice(P,M.index)},Y++));const $=M[1];ee.includes($)?E.push(a.jsxs("span",{style:{color:"#ffd700",cursor:"pointer",textDecoration:"underline",textUnderlineOffset:"2px",fontWeight:"bold"},onMouseEnter:K=>{K.target.style.color="#ffec8b",K.target.style.textShadow="0 0 8px rgba(255, 215, 0, 0.8)"},onMouseLeave:K=>{K.target.style.color="#ffd700",K.target.style.textShadow="none"},onClick:K=>{K.stopPropagation(),hf($)},children:["",$,""]},Y++)):E.push(a.jsxs("span",{children:["",$,""]},Y++)),P=M.index+M[0].length}return P<m.length&&E.push(a.jsx("span",{children:m.slice(P)},Y++)),E.length>0?a.jsx(a.Fragment,{children:E}):m},[hf]),[fc,Ki]=N.useState([]),Wt=(m,_,E,P)=>{if(!m)return;let M=window.innerWidth/2,Y=window.innerHeight/2;const ee=_===C;if(E===void 0||E===-1){const B=ee?Qi:ci;if(B.current){const K=B.current.getBoundingClientRect(),le=de(K.left+K.width/2,K.top+K.height/2);M=le.x,Y=le.y}else Y=ee?150:sI-250}else if(E!==void 0&&E>=0){const B=ee?lr:kr,K=ee?ac.current:da.current;let le=E;if(P){const he=K.findIndex(_e=>_e&&_e.instanceId===P);he>=0&&(le=he)}const te=B.current[le];if(te){const he=te.getBoundingClientRect(),_e=de(he.left+he.width/2,he.top+he.height/2);M=_e.x,Y=_e.y}}Ki(B=>[...B,{type:m,x:M,y:Y,key:Date.now()+Math.random()}])},hm=(m,_,E,P,M)=>{let Y=window.innerWidth/2,ee=window.innerHeight/2;const $=m===C,B=$?lr:kr,K=$?ac.current:da.current;let le=_;if(M){const he=K.findIndex(_e=>_e&&_e.instanceId===M);he>=0&&(le=he)}const te=B.current[le];if(te){const he=te.getBoundingClientRect(),_e=de(he.left+he.width/2,he.top+he.height/2);Y=_e.x,ee=_e.y}Ki(he=>[...he,{type:"BUFF",x:Y,y:ee,key:Date.now()+Math.random(),atkBuff:E,hpBuff:P}])},ar=(m,_,E,P)=>{Wt(m,_,E,P),n==="HOST"&&v&&b&&b.send({type:"EFFECT",payload:{effectType:m,targetPlayerId:_||"",targetIndex:E??-1,targetInstanceId:P}})},fa=(m,_,E,P,M)=>{hm(m,_,E,P,M),n==="HOST"&&v&&b&&b.send({type:"EFFECT",payload:{effectType:"BUFF",targetPlayerId:m,targetIndex:_,targetInstanceId:M,isBuff:!0,atkBuff:E,hpBuff:P}})},pm=N.useRef([]),gm=N.useRef([]);N.useEffect(()=>{var P,M;const m=(Y,ee,$)=>{ee.forEach(B=>{if(!B)return;if(!Y.find(le=>le&&le.instanceId===B.instanceId)&&B.killedByBane){const le=$===C,te=le?lr:kr,_e=(le?ac.current:da.current).findIndex(Ke=>Ke&&Ke.instanceId===B.instanceId);if(_e>=0&&te.current[_e]){const Ee=te.current[_e].getBoundingClientRect(),Ge=de(Ee.left+Ee.width/2,Ee.top+Ee.height/2);Ki(Je=>[...Je,{type:"BANE",x:Ge.x,y:Ge.y,key:Date.now()+Math.random()}])}}})},_=((P=g.players[L])==null?void 0:P.board)||[],E=((M=g.players[C])==null?void 0:M.board)||[];m(_,pm.current,L),m(E,gm.current,C),pm.current=_.map(Y=>Y?{...Y}:null),gm.current=E.map(Y=>Y?{...Y}:null)},[g.players,L,C]);const pf=600,[fs,ha]=N.useState(null),gf=N.useRef({player:0,opponent:0}),[Ct,pa]=N.useState(()=>{try{const m=localStorage.getItem("audioSettings");if(m){const _=JSON.parse(m);if(_.enabled!==void 0){const{enabled:E,...P}=_;return{...P,bgmEnabled:E,seEnabled:E}}return _}return{bgm:.3,se:.5,voice:.5,bgmEnabled:!0,seEnabled:!0}}catch{return{bgm:.3,se:.5,voice:.5,bgmEnabled:!0,seEnabled:!0}}}),_t=N.useCallback((m,_=.5)=>{if(!Ct.seEnabled)return;const E=new Audio(Ze(`/se/${m}`));E.volume=Ct.se*_,E.play().catch(P=>console.warn("SE Play prevented",P))},[Ct]),hc=N.useRef(null);N.useEffect(()=>{if(Z&&ut&&!hc.current)_t("Buon.mp3",.25);else if(Z&&ut&&hc.current){const m=hc.current;(m.instanceId!==ut.instanceId||m.index!==ut.index||m.playerId!==ut.playerId)&&_t("Buon.mp3",.25)}hc.current=ut},[ut,Z,_t]);const En=N.useRef(null),[hI,mm]=N.useState(!1);N.useEffect(()=>{localStorage.setItem("audioSettings",JSON.stringify(Ct)),En.current&&(En.current.volume=Ct.bgmEnabled?Ct.bgm:0,Ct.bgmEnabled?En.current.paused&&En.current.play().catch(m=>console.warn("Auto-play prevented",m)):En.current.pause())},[Ct]);const[pI,pc]=N.useState(!1),[gI,mf]=N.useState(!1),[mI,gc]=N.useState(!1),yI=N.useCallback(()=>{console.log("[GameScreen] handleSurrender called"),gc(!1),pc(!1),n!=="CPU"&&b&&b.send({type:"SURRENDER",payload:{playerId:L}}),I({type:"CONCEDE",playerId:L})},[n,b,L]),[Gr,yf]=N.useState(!1),vf=N.useRef(!1),[ym,vm]=N.useState(!1),[st,li]=N.useState(null),Xi=N.useRef(null),Qi=N.useRef(null),lr=N.useRef([]),kr=N.useRef([]),ci=N.useRef(null),[vI,mc]=N.useState([]),yc=N.useRef({player:20,opponent:20}),vc=N.useRef({player:0,opponent:0}),ga=N.useRef(new Map);N.useEffect(()=>{var M,Y,ee,$;if(!oe||!Oe)return;const m=yc.current.opponent-Oe.hp;m>0&&aa(B=>({...B,damageDealtToOpponent:B.damageDealtToOpponent+m}));const _=yc.current.player-oe.hp;_>0&&aa(B=>({...B,damageReceivedFromOpponent:B.damageReceivedFromOpponent+_}));const E=vc.current.opponent-(((M=Oe.board)==null?void 0:M.filter(B=>B).length)||0);E>0&&aa(B=>({...B,followersDestroyed:B.followersDestroyed+E}));const P=vc.current.player-(((Y=oe.board)==null?void 0:Y.filter(B=>B).length)||0);P>0&&aa(B=>({...B,myFollowersDestroyed:B.myFollowersDestroyed+P})),yc.current={player:oe.hp,opponent:Oe.hp},vc.current={player:((ee=oe.board)==null?void 0:ee.filter(B=>B).length)||0,opponent:(($=Oe.board)==null?void 0:$.filter(B=>B).length)||0}},[oe==null?void 0:oe.hp,Oe==null?void 0:Oe.hp,(jm=oe==null?void 0:oe.board)==null?void 0:jm.length,($m=Oe==null?void 0:Oe.board)==null?void 0:$m.length]);const an=N.useRef(null),_m="lastPlayedBgm",xm=N.useCallback(m=>{const _={AJA:[Ze("/bgm/Green Misty Mountains.mp3"),Ze("/bgm/Jade Moon.mp3"),Ze("/bgm/amaama.mp3"),Ze("/bgm/kingetsu.mp3")],SENKA:[Ze("/bgm/ouka.mp3"),Ze("/bgm/Jade Moon.mp3"),Ze("/bgm/amaama.mp3"),Ze("/bgm/kingetsu.mp3")]},E=_[m]||_.SENKA,P=sessionStorage.getItem(_m),M=E.length>1?E.filter(ee=>ee!==P):E,Y=M[Math.floor(Math.random()*M.length)];return sessionStorage.setItem(_m,Y),encodeURI(Y)},[]),[_f,bm]=N.useState(null);N.useEffect(()=>{var m,_;if(console.log(`[PendingEffects] useEffect fired. isProcessingEffect=${df}, pendingEffects.length=${((m=g.pendingEffects)==null?void 0:m.length)||0}, gameMode=${n}`),n==="JOIN"){console.log("[PendingEffects] Early return: JOIN mode waits for EFFECT messages from HOST");return}if(df){console.log("[PendingEffects] Early return: isProcessingEffect=true");return}if(g.pendingEffects&&g.pendingEffects.length>0){const E=g.pendingEffects[0];if(console.log(`[PendingEffects] Processing effect: ${E.effect.type} from ${E.sourceCard.name}`),cc.current===E){console.log("[PendingEffects] Early return: same effect already processed");return}if(cc.current=E,ca(!0),zr.current=!0,E.effect.type==="GENERATE_CARD"&&E.effect.targetCardId){const pe=[E],X=g.pendingEffects||[];for(let ke=1;ke<X.length;ke++){const ye=X[ke];if(ye.effect.type==="GENERATE_CARD"&&ye.sourceCard.id===E.sourceCard.id&&ye.sourcePlayerId===E.sourcePlayerId)pe.push(ye);else break}const ae=120,re=20,V=-(pe.length*ae+(pe.length-1)*re-ae)/2,se=E.sourcePlayerId===L,me=se?window.innerWidth-200*p:200*p,Ae=se?window.innerHeight-100*p:100*p,Se=pe.map((ke,ye)=>({card:Kr(ke.effect.targetCardId),status:"APPEAR",targetX:me,targetY:Ae,xOffset:V+ye*(ae+re)})).filter(ke=>ke.card);if(Se.length>0){ua(Se),an.current&&clearTimeout(an.current),an.current=setTimeout(()=>{ua(ke=>ke.map(ye=>({...ye,status:"FLY"}))),an.current=setTimeout(()=>{ua([]),ca(!1),zr.current=!1,(n==="CPU"||n==="HOST")&&(pe.forEach(ke=>{I({type:"RESOLVE_EFFECT",playerId:ke.sourcePlayerId,payload:{targetId:ke.targetId}})}),n==="HOST"&&v&&b&&setTimeout(()=>{const ke=et.current;b.send({type:"GAME_STATE",payload:ke})},50)),an.current=null},600)},800);return}}const P=E.effect.type==="DAMAGE"||E.effect.type==="AOE_DAMAGE"||E.effect.type==="RANDOM_DAMAGE"||E.effect.type==="RANDOM_DAMAGE_BY_TURN",M=E.effect.type==="DESTROY"||E.effect.type==="RANDOM_DESTROY",Y=E.effect.type==="HEAL_LEADER",ee=E.effect.type==="RANDOM_SET_HP",$=E.effect.type==="SET_MAX_HP",B=E.effect.type==="RETURN_TO_HAND",K=E.effect.type==="SUMMON_CARD"||E.effect.type==="SUMMON_CARD_RUSH",le=E.effect.type==="VISUAL_BUFF_ONLY",te=E.effect.type==="BUFF_STATS",he=Y||B||K||le||te?600:50;if(P){let pe=E.sourceCard.attackEffectType||"SLASH";E.sourceCard.id==="c_alice"&&E.effect.targetType==="SELECT_FOLLOWER"&&(pe="WATER");const X=E.sourcePlayerId===L?C:L,ae=X===L?bn:hn;if(E.effect.type==="AOE_DAMAGE")g.players[X].board.forEach(ie=>{if(ie){const V=ae.findIndex(se=>(se==null?void 0:se.instanceId)===ie.instanceId);V!==-1&&ar(pe,X,V,ie.instanceId)}});else if(E.targetIds)E.effect.type==="RANDOM_DAMAGE_BY_TURN"?E.targetIds.forEach((ie,V)=>{setTimeout(()=>{const se=ae.findIndex(me=>(me==null?void 0:me.instanceId)===ie);se!==-1&&ar(pe,X,se,ie)},V*300)}):E.targetIds.forEach(re=>{const ie=ae.findIndex(V=>(V==null?void 0:V.instanceId)===re);ie!==-1&&ar(pe,X,ie,re)});else if(E.effect.targetType==="OPPONENT")ar(pe,X,-1),Bn();else if(E.targetId){const re=ae.findIndex(ie=>(ie==null?void 0:ie.instanceId)===E.targetId);re!==-1&&ar(pe,X,re,E.targetId)}}else if(M){let pe=E.sourceCard.attackEffectType||"IMPACT";const X=E.sourcePlayerId===L?C:L,ae=X===L?bn:hn;if(E.effect.targetType==="ALL_OTHER_FOLLOWERS"){ae.forEach((V,se)=>{V&&V.instanceId!==E.sourceCard.instanceId&&ar(pe,X,se,V.instanceId)});const re=E.sourcePlayerId;(re===L?bn:hn).forEach((V,se)=>{V&&V.instanceId!==E.sourceCard.instanceId&&ar(pe,re,se,V.instanceId)}),Bn()}else if(E.targetIds)E.targetIds.forEach(re=>{const ie=ae.findIndex(V=>(V==null?void 0:V.instanceId)===re);ie!==-1&&ar(pe,X,ie,re)});else if(E.targetId){const re=ae.findIndex(ie=>(ie==null?void 0:ie.instanceId)===E.targetId);re!==-1&&ar(pe,X,re,E.targetId)}}else if(Y){const pe=E.sourcePlayerId;ar("HEAL",pe)}else if($){const pe=E.sourcePlayerId===L?C:L;ar("RAY",pe,-1),Bn()}if(E.effect.type==="BUFF_STATS"){const pe=E.effect.value??0,X=E.effect.value2??0,ae=E.sourcePlayerId;if(E.effect.targetType==="SELF"){const ie=(ae===L?bn:hn).findIndex(V=>(V==null?void 0:V.instanceId)===E.sourceCard.instanceId);ie!==-1&&fa(ae,ie,pe,X,E.sourceCard.instanceId)}else if(E.effect.targetType==="ALL_FOLLOWERS"){const re=ae===L?bn:hn,ie=g.players[ae].board,V=E.effect.conditions;ie.forEach(se=>{var me;if(se){if(V!=null&&V.tag&&!((me=se.tags)!=null&&me.includes(V.tag))||V!=null&&V.nameIn&&!V.nameIn.includes(se.name))return;const Ae=re.findIndex(Se=>(Se==null?void 0:Se.instanceId)===se.instanceId);Ae!==-1&&fa(ae,Ae,pe,X,se.instanceId)}})}else if(E.effect.targetType==="ALL_OTHER_FOLLOWERS"){const re=ae===L?bn:hn,ie=g.players[ae].board,V=E.effect.conditions;ie.forEach(se=>{var me;if(se&&se.instanceId!==E.sourceCard.instanceId){if(V!=null&&V.tag&&!((me=se.tags)!=null&&me.includes(V.tag))||V!=null&&V.nameIn&&!V.nameIn.includes(se.name))return;const Ae=re.findIndex(Se=>(Se==null?void 0:Se.instanceId)===se.instanceId);Ae!==-1&&fa(ae,Ae,pe,X,se.instanceId)}})}else if(E.targetId){const ie=(ae===L?bn:hn).findIndex(V=>(V==null?void 0:V.instanceId)===E.targetId);ie!==-1&&fa(ae,ie,pe,X,E.targetId)}}if(le){const pe=E.effect.value??0,X=E.effect.value2??0,ae=E.sourcePlayerId,re=E.sourceCard;setTimeout(()=>{const ie=ae===L?bn:hn;if(re!=null&&re.instanceId){const V=ie.findIndex(se=>(se==null?void 0:se.instanceId)===re.instanceId);V!==-1&&fa(ae,V,pe,X,re.instanceId)}},300)}an.current&&clearTimeout(an.current);const Ke=P||M||ee||$,Ee=E.effect.type==="RANDOM_DAMAGE_BY_TURN",Ge=Ee?((_=E.targetIds)==null?void 0:_.length)||g.turnCount:1,Je=Ee?Ge*300+300:0,He=Ee?Je:Ke?700:he,We=Ee?200:Ke?700:0;an.current=setTimeout(()=>{(n==="CPU"||n==="HOST")&&(I({type:"RESOLVE_EFFECT",playerId:E.sourcePlayerId,payload:{targetId:E.targetId}}),n==="HOST"&&v&&b&&setTimeout(()=>{const pe=et.current;b.send({type:"GAME_STATE",payload:pe})},50)),We>0?an.current=setTimeout(()=>{ca(!1),zr.current=!1,an.current=null},We):(ca(!1),zr.current=!1,an.current=null)},He)}else cc.current=null,an.current&&(clearTimeout(an.current),an.current=null)},[g.pendingEffects,df,L,C,n,v,b]),N.useEffect(()=>{if(g.activePlayerId!==L)return;const m=L===g.firstPlayerId,_=g.turnCount,E=m?5:4;if(_===(m?7:6)){if(uf===_)return;lc("SUPER_EVOLVE_READY"),sm(_),setTimeout(()=>lc(null),2500)}else if(_===E){if(uf===_)return;lc("EVOLVE_READY"),sm(_),setTimeout(()=>lc(null),2500)}},[g.turnCount,g.activePlayerId,L,uf,g.firstPlayerId]);const _c=N.useRef(g.players);N.useEffect(()=>{const m=_c.current,_=new Set;if(Object.keys(g.players).forEach(E=>{const P=g.players[E],M=m[E];if(!M)return;const Y=new Set(M.board.filter($=>$).map($=>$.instanceId)),ee=new Set(M.hand.filter($=>$).map($=>$.instanceId));P.board.forEach($=>{if(!$)return;const B=$.instanceId;!Y.has(B)&&!ee.has(B)&&_.add(B)})}),_.size>0){ff(P=>new Set([...P,..._]));const E=setTimeout(()=>{ff(new Set)},1e3);return()=>clearTimeout(E)}},[g.players]),N.useEffect(()=>{const m=_c.current,_=g.players;let E=[];const P=M=>{const Y=M.getBoundingClientRect();return{x:Y.left+Y.width/2,y:Y.top+Y.height/2}};Object.keys(_).forEach(M=>{const Y=_[M],ee=m[M];if(ee&&Y.hp<ee.hp){const $=ee.hp-Y.hp,K=M===L?ci.current:Qi.current;if(K){const le=P(K);E.push({id:Date.now()+Math.random(),value:$,x:le.x,y:le.y,color:"#e53e3e"})}}else if(ee&&Y.hp>ee.hp){const $=Y.hp-ee.hp,K=M===L?ci.current:Qi.current;if(K){const le=P(K);E.push({id:Date.now()+Math.random(),value:"+"+$,x:le.x,y:le.y,color:"#48bb78"})}}ee==null||ee.board.forEach($=>{if(!$)return;const B=Y.board.find(K=>(K==null?void 0:K.instanceId)===$.instanceId);if(B){const K=Y.board.findIndex(_e=>(_e==null?void 0:_e.instanceId)===B.instanceId),he=(M===L?kr.current:lr.current)[K];if(he){const _e=P(he);if(ga.current.set($.instanceId,_e),B.currentHealth<$.currentHealth){const Ke=$.currentHealth-B.currentHealth;E.push({id:Date.now()+Math.random(),value:Ke,x:_e.x,y:_e.y,color:"#e53e3e"})}else if(B.currentHealth>$.currentHealth){const Ke=B.hasEvolved&&!$.hasEvolved,Ee=B.currentAttack!==$.currentAttack||B.maxHealth!==$.maxHealth;if(!Ke&&!Ee){const Ge=B.currentHealth-$.currentHealth;E.push({id:Date.now()+Math.random(),value:"+"+Ge,x:_e.x,y:_e.y,color:"#48bb78"})}}else B.currentHealth===$.currentHealth&&$.hasBarrier&&!B.hasBarrier&&E.push({id:Date.now()+Math.random(),value:0,x:_e.x,y:_e.y,color:"#e53e3e"})}}else{const K=Y.graveyard.find(te=>te.instanceId===$.instanceId);let le=0;if(K){const te=K.currentHealth||0;te<=0?le=$.currentHealth-te:le=0}else le=$.currentHealth;if(le>0){const te=ga.current.get($.instanceId);te&&(te.x!==0||te.y!==0)&&E.push({id:Date.now()+Math.random(),value:le,x:te.x,y:te.y,color:"#e53e3e"})}ga.current.delete($.instanceId)}})}),E.length>0&&(mc(Y=>[...Y,...E]),E.some(Y=>Y.color!=="#48bb78")&&Bn()),_c.current=_},[g.players,L,C]);const xf=N.useRef(null),Bn=()=>{xf.current||(vm(!0),xf.current=setTimeout(()=>{vm(!1),xf.current=null},300))},bf=O.useCallback(m=>{mc([]),Ki([]),ua([]),zn(null),Ji(null),ha(null),ff(new Set),hs.current=!1,Ef.current=null,aa({turnCount:0,damageDealtToOpponent:0,damageReceivedFromOpponent:0,followersDestroyed:0,myFollowersDestroyed:0}),yc.current={player:20,opponent:20},vc.current={player:0,opponent:0},sf(null),xe(!1),qe(!1),rt(null),tt(!1),Gi(!1);const _=m||Tr;m&&q0(m);let E=R;e==="CPU"&&(_==="YORUKA"?E=Math.random()<.5?"SENKA":"AJA":E=_==="SENKA"?"AJA":"SENKA");const M=bd(u,_,e==="ONLINE"?"":"CPU",E);_c.current=M.players,gf.current={player:M.players.p1.hand.length,opponent:M.players.p2.hand.length},bm(null),ge(n!=="JOIN"),nc(Math.random()>.5),on("IDLE"),us(null),oa(!1),n==="HOST"&&(ic.current=!1),I({type:"SYNC_STATE",payload:M})},[Tr,R,e,n]),_I=O.useCallback(()=>{if(ge(!1),Ie(!1),Q(!0),us(Ir?"FIRST":"SECOND"),!Ir){const m={...g,activePlayerId:"p2",firstPlayerId:"p2",players:{p1:{...g.players.p1,maxPp:0,pp:0},p2:{...g.players.p2,maxPp:1,pp:1}},logs:[` 1 - ${g.players.p2.name} `]};I({type:"SYNC_STATE",payload:m})}on("DONE")},[g,Ir]);O.useEffect(()=>{},[g.phase,ft,n,_t,v]),N.useEffect(()=>{if(_f===oe.class&&En.current)return;const m=xm(oe.class);console.log(`[BGM] Initializing track: ${m} for class: ${oe.class}`),En.current&&(En.current.pause(),En.current=null);const _=new Audio(m);_.loop=!0,_.volume=Ct.bgm,En.current=_,bm(oe.class)},[oe.class,xm,_f]),N.useEffect(()=>()=>{En.current&&(console.log("[GameScreen] Stopping BGM on unmount"),En.current.pause(),En.current=null)},[]),N.useEffect(()=>{if(!En.current)return;const m=En.current,_=()=>{m.paused&&Ct.bgmEnabled&&(console.log("[BGM] Attempting play on interaction..."),m.play().then(()=>{console.log("[BGM] Play success"),E()}).catch(P=>console.warn("[BGM] Play failed on interaction:",P)))},E=()=>{document.removeEventListener("click",_),document.removeEventListener("keydown",_),document.removeEventListener("touchstart",_)};return Ct.bgmEnabled?(document.addEventListener("click",_),document.addEventListener("keydown",_),document.addEventListener("touchstart",_),m.play().then(()=>{console.log("[BGM] Immediate play success"),E()}).catch(()=>console.log("[BGM] Immediate play blocked, waiting for interaction"))):(m.pause(),E()),()=>{E()}},[Ct.bgmEnabled,Ct.bgm,_f]),O.useEffect(()=>{if(!b){console.log("[GameScreen] Message handler setup skipped - no adapter yet");return}console.log("[GameScreen] Setting up message handler, adapter.isHost:",b.isHost);const m=_=>{var E,P,M,Y,ee;if(console.log("[GameScreen] Received message:",_.type,_),_.type==="HANDSHAKE"){const $=(E=_.payload)==null?void 0:E.name,B=typeof $=="string"&&$.trim().slice(0,12)||"";console.log("[GameScreen] Received HANDSHAKE from opponent:",B),oc.current=B,I({type:"UPDATE_PLAYER_NAME",payload:{playerId:L==="p1"?"p2":"p1",name:B}});return}if(_.type==="INIT_GAME"){console.log("[GameScreen] JOIN side: Received initial game state from HOST"),I({type:"SYNC_STATE",payload:_.payload}),I({type:"UPDATE_PLAYER_NAME",payload:{playerId:L,name:u}});const $=L==="p1"?"p2":"p1";oc.current&&(console.log("[GameScreen] Re-applying opponent name after INIT_GAME:",oc.current),I({type:"UPDATE_PLAYER_NAME",payload:{playerId:$,name:oc.current}})),D(!0);const B=_.payload.firstPlayerId===L;console.log("[GameScreen] JOIN side: Setting isFirstPlayer, firstPlayerId:",_.payload.firstPlayerId,"currentPlayerId:",L,"isJoinSideFirst:",B),nc(B),n==="CASUAL_MATCH"||n==="RANKED_MATCH"?console.log("[GameScreen] CASUAL_MATCH JOIN side: Waiting for intro sync"):ge(!0);return}if(_.type==="READY_FOR_INTRO"){console.log("[GameScreen] Received READY_FOR_INTRO from opponent"),ht(!0);return}if(_.type==="START_INTRO"){console.log("[GameScreen] Received START_INTRO - starting BattleIntro now"),we(!1),ge(!0);return}if(_.type==="GAME_STATE"){console.log("[GameScreen] JOIN: Received GAME_STATE sync from HOST"),I({type:"SYNC_STATE",payload:_.payload}),ca(!1),zr.current=!1,cc.current=null,ua([]),an.current&&(clearTimeout(an.current),an.current=null),!ya.current&&!Zi.current&&(pn.current=!1);return}if(_.type==="EFFECT"){const{effectType:$,targetPlayerId:B,targetIndex:K,targetInstanceId:le,isBuff:te,atkBuff:he,hpBuff:_e}=_.payload;console.log("[GameScreen] JOIN: Received EFFECT from HOST:",$,B,K,le),setTimeout(()=>{te&&he!==void 0&&_e!==void 0?hm(B,K,he,_e,le):Wt($,B,K,le)},50);return}if(_.type==="EVOLVE_ANIM"){const{playerId:$,followerIndex:B,useSep:K,targetId:le,instanceId:te}=_.payload,he=(P=g.players[$])==null?void 0:P.board[B];if(he){const _e=he.evolvedImageUrl||((M=Kr(he.id))==null?void 0:M.evolvedImageUrl),Ke=te||he.instanceId,Ee=hn.findIndex(X=>X&&X.instanceId===Ke),Ge=Ee>=0?lr.current[Ee]:null,Je=ue.current.scale,He=window.innerHeight/2;let We=window.innerWidth/2,pe=He-70*Je;if(Ge){const X=Ge.getBoundingClientRect();We=X.left+X.width/2,pe=X.top+X.height/2}Ji({card:he,evolvedImageUrl:_e,startX:We,startY:pe,phase:"ZOOM_IN",followerIndex:B,sourcePlayerId:$,useSep:K||!1,targetId:le,isRemote:!0}),_t("fon.mp3",.7)}return}if(_.type==="PLAY_CARD_ANIM"){const{playerId:$,card:B,targetBoardIndex:K}=_.payload;if(B){const le=((Y=g.players[$])==null?void 0:Y.board)||[],te=typeof K=="number"?K:le.filter(V=>V!==null).length,he=ue.current.scale,_e=window.innerWidth/2,Ke=window.innerHeight/2,Ee=_e,Ge=80*he,Je=_e,He=Ke-100*he,ae=-((Math.max(1,te+1)-1)*ui*he)/2+te*ui*he,re=_e+ae,ie=Ke-70*he;B.type==="SPELL"?zn({card:B,sourceIndex:-1,startX:Ee,startY:Ge,targetX:Je,targetY:He,playerClass:(Oe==null?void 0:Oe.class)||"SENKA",onComplete:()=>{zn(null)}}):zn({card:B,sourceIndex:-1,startX:Ee,startY:Ge,targetX:Je,targetY:He,finalX:re,finalY:ie,playerClass:(Oe==null?void 0:Oe.class)||"SENKA",onComplete:()=>{_t("gan.mp3",.6),Bn(),zn(null)}})}return}if(_.type==="REMATCH_REQUEST"){console.log("[GameScreen] Opponent requested rematch"),Gi(!0);return}if(_.type==="REMATCH_ACCEPT"){console.log("[GameScreen] Opponent accepted rematch - starting new game"),bf(Tr);return}if(_.type==="SURRENDER"){const $=(ee=_.payload)==null?void 0:ee.playerId;if(g.phase==="GAME_OVER"){console.warn("[GameScreen] Ignoring SURRENDER - game already over");return}if($===L){console.warn(`[GameScreen] Security Alert: Received SURRENDER message targeting self (${L}). Ignoring.`);return}if($!==C){console.warn(`[GameScreen] Security Alert: Invalid playerId in SURRENDER: ${$}. Expected: ${C}. Ignoring.`);return}console.log("[GameScreen] Opponent surrendered:",$),J0("surrender"),I({type:"CONCEDE",playerId:$});return}if(_.type==="STAMP"){console.log("[GameScreen] Opponent sent stamp:",_.stampId),wr.current&&(clearTimeout(wr.current),wr.current=null);const $=T_(_.stampId);$&&_t($,.6);const B={stampId:_.stampId,playerId:C,playerClass:_.playerClass||(Oe==null?void 0:Oe.class)||"SENKA",timestamp:Date.now()};Vi(null),requestAnimationFrame(()=>{Vi(B)}),wr.current=setTimeout(()=>{Vi(K=>(K==null?void 0:K.timestamp)===B.timestamp?null:K),wr.current=null},3e3);return}if(_.type==="ACTION"){const $=_.payload;if(console.log("[GameScreen] Processing remote action:",$.type,"from player:",$.playerId),I({...$,isRemote:!0}),$.type==="ATTACK"){const{playerId:B,payload:K}=$,le=g.players[B],te=le==null?void 0:le.board[K.attackerIndex],he=K.targetIsLeader?-1:K.targetIndex,_e=B==="p1"?"p2":"p1";if(te){const Ke=g.players[_e],Ee=K.targetIsLeader?null:Ke==null?void 0:Ke.board[K.targetIndex],Ge=Ee?Ee.instanceId:void 0;Wt(te.attackEffectType,_e,he,Ge)}}else $.type==="PLAY_CARD"||$.type==="EVOLVE"||$.type==="END_TURN"&&(console.log("[GameScreen] Remote END_TURN received, turn switching to:",$.playerId==="p1"?"p2":"p1"),qi.current=!1)}};return b.onMessage(m),n!=="CPU"&&!rm.current&&(rm.current=!0,b.send({type:"HANDSHAKE",payload:{name:u,class:t}}),console.log("[GameScreen] Sent HANDSHAKE:",u,t)),b.onClose(()=>{if((n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&g.phase==="GAME_OVER"){console.log("[GameScreen] Connection closed after game over (casual match) - silent disconnect");return}if(n!=="CPU"&&g.phase!=="GAME_OVER"){console.log("[GameScreen] Opponent disconnected during game - treating as surrender, player wins"),J0("disconnect");const _={...g,phase:"GAME_OVER",winnerId:L,logs:[...g.logs,""]};I({type:"SYNC_STATE",payload:_});return}alert(`
`),s()}),()=>{}},[b,g,_t,Wt,n,s,L]);const hs=N.useRef(!1),Ef=N.useRef(null),On=N.useRef(null),[Ye,zn]=N.useState(null),[Lt,Ji]=N.useState(null),pn=N.useRef(!1),ma=N.useRef(null),qi=N.useRef(!1),Sf=N.useRef(fc),If=N.useRef(Yi),ya=N.useRef(Ye),Zi=N.useRef(Lt);O.useEffect(()=>{Sf.current=fc,If.current=Yi,ya.current=Ye,Zi.current=Lt},[fc,Yi,Ye,Lt]),O.useEffect(()=>{if(Ye&&Ye.card.name===""&&Ct.seEnabled){const m=new Audio(Ze("/se/beam.mp3"));m.volume=Ct.se*.8,m.play().catch(_=>console.warn("SE Play prevented",_))}},[Ye,Ct]),O.useEffect(()=>{da.current=bn,ac.current=hn},[bn,hn]),O.useEffect(()=>{const m=_=>{const E=_.getBoundingClientRect();return{x:E.left+E.width/2,y:E.top}};bn.forEach((_,E)=>{if(_&&_.instanceId){const P=kr.current[E];if(P){const M=m(P);(M.x!==0||M.y!==0)&&ga.current.set(_.instanceId,M)}}}),hn.forEach((_,E)=>{if(_&&_.instanceId){const P=lr.current[E];if(P){const M=m(P);(M.x!==0||M.y!==0)&&ga.current.set(_.instanceId,M)}}})},[bn,hn]);const xc=(m,_,E,P)=>{const M=Rr.current.board,Y=P?M.findIndex(te=>te&&te.instanceId===P):m,ee=Y>=0?M[Y]:null;if(!ee)return;if(ee.hasEvolved){console.log("[GameScreen] Cannot evolve: card already evolved");return}const $=kr.current[m];let B=window.innerWidth/2,K=window.innerHeight/2;if($){const te=$.getBoundingClientRect();B=te.left+te.width/2,K=te.top+te.height/2}const le=ee.instanceId;n!=="CPU"&&v&&b&&b.send({type:"EVOLVE_ANIM",payload:{playerId:L,followerIndex:Y,useSep:_,targetId:E,instanceId:le}}),Ji({card:ee,evolvedImageUrl:ee.evolvedImageUrl,startX:B,startY:K,phase:"ZOOM_IN",followerIndex:Y,useSep:_,targetId:E,sourcePlayerId:L}),_t("fon.mp3",.7)},Tf=N.useRef(null),xI=N.useCallback(m=>{if(console.log("[GameScreen] handleEvolvePhaseChange:",m),m==="WHITE_FADE"&&_t("fon.mp3",.7),m==="LAND"&&_t("gan.mp3",.6),m==="DONE"){const _=Zi.current;if(_&&!_.isRemote){const P={type:"EVOLVE",playerId:_.sourcePlayerId||L,payload:{followerIndex:_.followerIndex,useSep:_.useSep,targetId:_.targetId}};I(P),b&&n!=="CPU"&&b.send({type:"ACTION",payload:P})}Ji(null)}else Ji(_=>_?{..._,phase:m}:null)},[b,I,n,L,_t]),wf=(m,_,E)=>{var We,pe,X,ae,re,ie;const M=Rr.current.hand[m];if(!M){console.warn("[handlePlayCard] Card not found at index:",m);return}if(M.instanceId&&ma.current===M.instanceId){console.warn("[handlePlayCard] Duplicate play blocked for instanceId:",M.instanceId);return}if(pn.current){console.warn("[handlePlayCard] Card play locked, ignoring duplicate call");return}pn.current=!0,ma.current=M.instanceId||null,_t("card.mp3",.5);const Y=(We=M.triggers)==null?void 0:We.find(V=>V.trigger==="FANFARE"),ee=Y==null?void 0:Y.effects[0];let $=C;const B=(ee==null?void 0:ee.targetType)==="SELECT_ALLY_FOLLOWER"||(ee==null?void 0:ee.targetType)==="SELECT_OTHER_ALLY_FOLLOWER";ee&&(B||["GRANT_PASSIVE","BUFF_STATS","HEAL_FOLLOWER"].includes(ee.type))&&($=L);const K=["SELECT_FOLLOWER","SELECT_ALLY_FOLLOWER","SELECT_OTHER_ALLY_FOLLOWER"],le=M.type==="SPELL"&&((pe=M.triggers)==null?void 0:pe.some(V=>V.effects.some(se=>se.targetType&&K.includes(se.targetType))))||M.type==="FOLLOWER"&&(((ae=(X=M.triggerAbilities)==null?void 0:X.FANFARE)==null?void 0:ae.targetType)&&K.includes(M.triggerAbilities.FANFARE.targetType)||((re=M.triggers)==null?void 0:re.some(V=>V.trigger==="FANFARE"&&V.effects.some(se=>se.targetType&&K.includes(se.targetType))))),he=et.current.players[$].board.some(V=>{var se,me;return V&&($===L||!((se=V.passiveAbilities)!=null&&se.includes("STEALTH"))&&!((me=V.passiveAbilities)!=null&&me.includes("AURA")))});if(console.log(`[handlePlayCard] needsTarget: ${le}, allowedTarget: ${$}, hasValidTargets: ${he}`),le&&he){li({type:"PLAY",sourceIndex:m,sourceInstanceId:M.instanceId,allowedTargetPlayerId:$}),Hr(null);return}const _e=window.innerWidth/2,Ke=window.innerHeight/2;let Ee,Ge;if(M.type==="FOLLOWER"){const se=et.current.players[L].board.filter(Re=>Re!==null),me=se.length+1,Ae=se.length,Se=ui*p,ke=(Ae-(me-1)/2)*Se,ye=(ie=Xi.current)==null?void 0:ie.getBoundingClientRect();Ee=(ye?ye.left+ye.width/2:window.innerWidth/2)+ke,Ge=window.innerHeight/2+70*p}const Je=()=>{M.type!=="SPELL"&&(_t("gan.mp3",.6),Bn()),ps({type:"PLAY_CARD",playerId:L,payload:{cardIndex:m,instanceId:M.instanceId}}),zn(null),setTimeout(()=>{pn.current=!1},100)},He=M.type==="FOLLOWER"?et.current.players[L].board.filter(V=>V!==null).length:void 0;n!=="CPU"&&v&&b&&b.send({type:"PLAY_CARD_ANIM",payload:{playerId:L,cardIndex:m,card:M,targetBoardIndex:He}}),zn({card:M,sourceIndex:m,startX:_,startY:E,targetX:_e,targetY:Ke,finalX:Ee,finalY:Ge,playerClass:(oe==null?void 0:oe.class)||"SENKA",onComplete:Je}),setTimeout(()=>{zn(V=>(V==null?void 0:V.card.id)===M.id?(Je(),null):V)},2e3)},ps=m=>{I(m),n!=="CPU"&&v&&!m.isRemote&&(b==null||b.send({type:"ACTION",payload:m}))};N.useEffect(()=>{if(!Lt&&Tf.current){const m=Tf.current;Tf.current=null,console.log("[GameScreen] Dispatching pending evolve action for:",m.playerId),ps({type:"EVOLVE",playerId:m.playerId,payload:{followerIndex:m.followerIndex,useSep:m.useSep,targetId:m.targetId}})}},[Lt,L,ps]);const Rr=N.useRef(oe),et=N.useRef(g);N.useEffect(()=>{Rr.current=oe,et.current=g},[oe,g]);const cr=N.useRef(!1);N.useEffect(()=>{const m=gf.current,_=oe.hand.length,E=Oe.hand.length;if(_>m.player){const P=_-m.player;ha({isPlayer:!0,count:P}),_t("card.mp3",.5),setTimeout(()=>ha(null),pf)}if(E>m.opponent){const P=E-m.opponent;ha({isPlayer:!1,count:P}),_t("card.mp3",.5),setTimeout(()=>ha(null),pf)}gf.current={player:_,opponent:E}},[oe.hand.length,Oe.hand.length,Ct,_t]),O.useEffect(()=>{g.activePlayerId===L&&(console.log("[GameScreen] Player turn started - resetting card play lock and ending turn state"),pn.current=!1,ma.current=null,qi.current=!1)},[g.activePlayerId,g.turnCount,L]),O.useEffect(()=>{if(n==="CPU")return;const m=setInterval(()=>{pn.current&&!ya.current&&!Zi.current&&!st&&g.activePlayerId===L&&(console.warn("[GameScreen] Safety release: Card play lock was stuck, releasing"),pn.current=!1)},3e3);return()=>clearInterval(m)},[n,st,g.activePlayerId,L]),O.useEffect(()=>{if(n!=="CPU")return;if(g.winnerId){hs.current=!1;return}const m=`${g.turnCount}-${g.activePlayerId}`;if(g.activePlayerId===L){hs.current=!1;return}if(g.activePlayerId===C){if(hs.current||Ef.current===m)return;(async()=>{var Ee,Ge,Je,He,We,pe;hs.current=!0,Ef.current=m;const E=async(X=300)=>{await new Promise(ie=>setTimeout(ie,X));const ae=()=>{const ie=et.current,V=ie.pendingEffects&&ie.pendingEffects.length>0,se=Sf.current.length>0,me=If.current.length>0,Ae=ya.current!==null,Se=Zi.current!==null;return!V&&!se&&!me&&!Ae&&!Se};let re=0;for(;!ae()&&re<60;){await new Promise(V=>setTimeout(V,100)),re++;const ie=et.current;if(ie.pendingEffects&&ie.pendingEffects.length>0&&!zr.current){console.log("[waitForIdle] Forcing RESOLVE_EFFECT for stuck pending effect");const V=ie.pendingEffects[0];I({type:"RESOLVE_EFFECT",playerId:V.sourcePlayerId,payload:{targetId:V.targetId}}),await new Promise(se=>setTimeout(se,200))}}},P=(X,ae)=>{var re;return X?!!((re=X.passiveAbilities)!=null&&re.includes("IMMUNE_TO_FOLLOWER_DAMAGE")):!1},M=(X,ae)=>{var re;return!ae||!X?!1:(re=ae.passiveAbilities)!=null&&re.includes("BANE")&&!X.hasBarrier?!0:(ae.currentAttack||0)>=X.currentHealth},Y=(X,ae)=>{var re;return!ae||!X?!1:(re=X.passiveAbilities)!=null&&re.includes("BANE")?!ae.hasBarrier:X.currentAttack>=ae.currentHealth},ee=X=>{var se,me,Ae;let ae=0;const re=X.players[C].board.filter(Se=>Se!==null),V=X.players[L].board.filter(Se=>Se!==null).some(Se=>{var ke,ye;return((ke=Se.passiveAbilities)==null?void 0:ke.includes("WARD"))&&!((ye=Se.passiveAbilities)!=null&&ye.includes("STEALTH"))});for(const Se of re)!Se.canAttack||!((se=Se.passiveAbilities)!=null&&se.includes("STORM")||Se.turnPlayed!==X.turnCount)||V&&!((me=Se.passiveAbilities)!=null&&me.includes("STEALTH"))&&!Se.hadStealth||(ae+=Se.currentAttack||0,(Ae=Se.passiveAbilities)!=null&&Ae.includes("DOUBLE_ATTACK")&&(ae+=Se.currentAttack||0));return ae},$=X=>{var ie,V,se;let ae=0;const re=X.players[L].board.filter(me=>me!==null);for(const me of re)ae+=me.currentAttack||0,(ie=me.passiveAbilities)!=null&&ie.includes("DOUBLE_ATTACK")&&(ae+=me.currentAttack||0),(V=me.passiveAbilities)!=null&&V.includes("BANE")&&(ae+=15),(se=me.passiveAbilities)!=null&&se.includes("STORM")&&(ae+=10);return ae},B=(X,ae)=>{var ke,ye,Xe,Re;let re=X.cost*10;const ie=ae.players[L].board.filter(De=>De!==null),V=ae.players[C].board.filter(De=>De!==null),se=ae.players[L].hp,me=ae.players[C].hp,Ae=ae.players[C].pp;if((ke=X.passiveAbilities)!=null&&ke.includes("STORM")){const De=ee(ae),Le=X.attack||0;De+Le>=se?re+=500:se<=10?re+=100:re+=30}if(ie.length>0){const De=X.triggers||[],Le=$(ae);for(const St of De)if(St.trigger==="FANFARE")for(const Fe of St.effects||[]){if(Fe.type==="DESTROY"&&(re+=60+(Le>10?30:0)),Fe.type==="RANDOM_DESTROY"){const Qe=Fe.value||1;re+=40*Qe+(Le>10?20:0)}["DAMAGE","SELECT_DAMAGE"].includes(Fe.type)&&(re+=35),Fe.type==="AOE_DAMAGE"&&(re+=25*Math.min(ie.length,3))}}me<=10&&((ye=X.passiveAbilities)!=null&&ye.includes("WARD")&&(re+=80),re+=20),X.cost===Ae?re+=15:Ae-X.cost<=1&&(re+=10);const Se=X.triggers||[];for(const De of Se)if(De.trigger==="FANFARE")for(const Le of De.effects||[])Le.type==="DRAW"&&(re+=20*(Le.value||1)),(Le.type==="SUMMON_CARD"||Le.type==="SUMMON_CARD_RUSH")&&(re+=30),Le.type==="GENERATE_CARD"&&(re+=15),Le.type==="HEAL"&&(re+=me<15?25:10);return X.type==="FOLLOWER"&&((X.attack||0)+(X.health||0)>=X.cost*2.5&&(re+=15),(Xe=X.passiveAbilities)!=null&&Xe.includes("WARD")&&ie.length>0&&(re+=25),(Re=X.passiveAbilities)!=null&&Re.includes("BANE")&&(re+=20)),X.type==="FOLLOWER"&&V.length>=5&&(re-=200),re},K=(X,ae,re,ie)=>{let V=0;const se=re.players[L].board.filter(ye=>ye!==null),me=re.players[C].board.filter(ye=>ye!==null),Ae=X.triggers||[],Se=ie?"SUPER_EVOLVE":"EVOLVE";let ke=!1;for(const ye of Ae)if(ye.trigger===Se){ke=!0;for(const Xe of ye.effects||[]){if(["DESTROY","RANDOM_DESTROY","DAMAGE","SELECT_DAMAGE","AOE_DAMAGE"].includes(Xe.type)&&(V+=se.length>0?80:5),["SUMMON_CARD","SUMMON_CARD_RUSH"].includes(Xe.type)&&(V+=60),Xe.type==="BUFF_STATS"){const Re=Xe.targetType||"SELF";Re==="ALL_OTHER_FOLLOWERS"||Re==="ALL_FOLLOWERS"?V+=25*Math.max(1,me.length-1):V+=30}Xe.type==="DRAW"&&(V+=35),Xe.type==="GENERATE_CARD"&&(V+=25)}}return X.canAttack?(V+=30,V+=(X.currentAttack||0)*5):V+=(X.currentAttack||0)*2,X.cost>=6&&ke&&(V+=20),!ke&&X.cost<=3&&(V-=30),V},le=(X,ae)=>{const ie=X.players[C].board.filter(Re=>Re!==null),V=X.players[L].board.filter(Re=>Re!==null),se=X.players[L].hp,me=X.players[C].hp,Ae=X.turnCount,Se=ie.filter(Re=>Re&&!Re.hasEvolved);if(Se.length===0)return!1;const ke=Se.map((Re,De)=>({c:Re,i:De,score:K(Re,De,X,ae)})),ye=Math.max(...ke.map(Re=>Re.score));if(se<=12&&ie.some(Re=>Re&&Re.canAttack)||me<=10)return!0;const Xe=$(X);return Xe>=8&&Se.some(De=>{const Le=De.triggers||[];for(const St of Le)if(St.trigger===(ae?"SUPER_EVOLVE":"EVOLVE")){for(const Fe of St.effects||[])if(["DESTROY","RANDOM_DESTROY","DAMAGE","AOE_DAMAGE"].includes(Fe.type))return!0}return!1})&&V.length>0||ye>=80||ae&&ye>=50?!0:Ae<=5&&me>=15&&Xe<8?ye>=100:ye<30?!1:ye>=50},te=(X,ae,re)=>{var Ae,Se,ke,ye,Xe;const ie=((Ae=X.passiveAbilities)==null?void 0:Ae.includes("STORM"))||X.turnPlayed!==re.turnCount,V=ae.map((Re,De)=>({c:Re,i:De})).filter(({c:Re})=>{var De,Le;return Re!==null&&!((De=Re.passiveAbilities)!=null&&De.includes("STEALTH"))&&!((Le=Re.passiveAbilities)!=null&&Le.includes("AURA"))});if(!(((Se=X.passiveAbilities)==null?void 0:Se.includes("STEALTH"))||X.hadStealth)){const Re=V.find(({c:De})=>{var Le;return(Le=De.passiveAbilities)==null?void 0:Le.includes("WARD")});if(Re)return P(Re.c)?{index:-1,isLeader:!1}:{index:Re.i,isLeader:!1}}let me={index:-1,isLeader:ie,score:ie?0:-1e3};for(const{c:Re,i:De}of V){if(P(Re))continue;let Le=0;const St=X.isEvolved,Fe=(ke=Re.passiveAbilities)==null?void 0:ke.includes("BANE"),Qe=M(X,Re);Y(X,Re)?(Le+=50,Le+=(Re.currentAttack||0)*5,Qe?Fe&&St?Le-=60:Fe&&(Le-=30):Le+=30,Fe&&!Qe&&(Le+=40),(ye=Re.passiveAbilities)!=null&&ye.includes("STORM")&&(Le+=30),(Xe=Re.passiveAbilities)!=null&&Xe.includes("DOUBLE_ATTACK")&&(Le+=35)):!Qe&&X.currentAttack>=Re.currentHealth/2?Le+=10:Qe&&(Le-=50,St&&(Le-=40),(Re.currentAttack||0)>=5&&(Le+=10)),Le>me.score&&(me={index:De,isLeader:!1,score:Le})}return ie&&(me.index===-1||me.score<=0)?{index:-1,isLeader:!0}:me},he=d==="EASY"?1200:d==="HARD"?400:800;if(await new Promise(X=>setTimeout(X,he)),!hs.current)return;let _e=0;const Ke=d==="EASY"?1:d==="HARD"?5:3;for(;_e<Ke;){const X=et.current,ae=X.players[C].hand,re=X.players[C].pp,V=X.players[C].board.filter(Fe=>Fe!==null).length>=5;let se=ae.map((Fe,Qe)=>({...Fe,originalIndex:Qe})).filter(Fe=>Fe.cost<=re).filter(Fe=>!(Fe.type==="FOLLOWER"&&V));if(se.length===0||(d==="HARD"?se=se.sort((Fe,Qe)=>B(Qe,X)-B(Fe,X)):se=se.sort((Fe,Qe)=>Qe.cost-Fe.cost),d==="EASY"&&Math.random()<.3&&_e>0))break;const me=se[0];let Ae;const ke=X.players[L].board.filter(Fe=>{var Qe,yt;return Fe&&!((Qe=Fe.passiveAbilities)!=null&&Qe.includes("STEALTH"))&&!((yt=Fe.passiveAbilities)!=null&&yt.includes("AURA"))});ke.length>0&&(d==="HARD"?Ae=[...ke].sort((Qe,yt)=>{var xt,Tt;let ot=(Qe.currentAttack||0)+(Qe.currentHealth||0),gt=(yt.currentAttack||0)+(yt.currentHealth||0);return(xt=Qe.passiveAbilities)!=null&&xt.includes("BANE")&&(ot+=10),(Tt=yt.passiveAbilities)!=null&&Tt.includes("BANE")&&(gt+=10),gt-ot})[0].instanceId:Ae=ke[0].instanceId);const ye=window.innerWidth-20*p-80*p/2,Xe=20*p+110*p/2,Re=window.innerWidth/2,De=window.innerHeight/2;let Le,St;if(me.type==="FOLLOWER"){const Qe=et.current.players[C].board.filter(Tc=>Tc!==null),yt=Qe.length+1,ot=Qe.length,gt=ui*p,xt=(ot-(yt-1)/2)*gt,Tt=(Ee=Xi.current)==null?void 0:Ee.getBoundingClientRect();Le=(Tt?Tt.left+Tt.width/2:window.innerWidth/2)+xt,St=window.innerHeight/2-70*p}zn({card:me,sourceIndex:-1,startX:ye,startY:Xe,targetX:Re,targetY:De,finalX:Le,finalY:St,playerClass:(Oe==null?void 0:Oe.class)||"SENKA",onComplete:()=>{if(me.type!=="SPELL"&&(_t("gan.mp3",.6),Bn()),I({type:"PLAY_CARD",playerId:C,payload:{cardIndex:me.originalIndex,targetId:Ae,instanceId:me.instanceId}}),me.id==="c_amandava"&&et.current.players[L].board.forEach((Qe,yt)=>{if(Qe){const ot=Qe.instanceId;setTimeout(()=>{Wt("SHOT",L,yt,ot)},200)}}),me.id==="c_azya"){if(setTimeout(()=>{Wt("THUNDER",L,-1)},200),Ae){const Qe=et.current.players[L].board.findIndex(yt=>(yt==null?void 0:yt.instanceId)===Ae);Qe!==-1&&setTimeout(()=>{Wt("ICE",L,Qe,Ae)},400)}setTimeout(()=>{const Fe=et.current.players[L].board,Qe=Fe.filter(yt=>yt!==null);if(Qe.length>0){const yt=Qe[Math.floor(Math.random()*Qe.length)],ot=Fe.findIndex(gt=>(gt==null?void 0:gt.instanceId)===(yt==null?void 0:yt.instanceId));ot!==-1&&Wt("WATER",L,ot,yt==null?void 0:yt.instanceId)}},600)}zn(null)}}),await E(600),_e++}{const X=et.current,ae=X.players[C],re=C===X.firstPlayerId,ie=X.turnCount,V=R_(ae,ie,re);if((k_(ae,ie,re)||V)&&ae.board.length>0){const me=ae.board.map((Ae,Se)=>({c:Ae,i:Se})).filter(({c:Ae})=>Ae&&Ae.type==="FOLLOWER"&&!Ae.hasEvolved);if(me.length>0){let Ae;const Se=V;if(d==="HARD"&&(le(X,Se)||console.log("[AI HARD] Skipping evolution - saving EP for better opportunity")),d==="HARD"&&!le(X,Se))Ae=null;else if(d==="EASY")Ae=me[Math.floor(Math.random()*me.length)];else{const ye=me.map(({c:Xe,i:Re})=>({c:Xe,i:Re,score:K(Xe,Re,X,Se)}));ye.sort((Xe,Re)=>Re.score-Xe.score),d==="HARD"&&ye[0].score<5?(console.log("[AI HARD] Evolution target score too low:",ye[0].score),Ae=null):Ae=ye[0]}if(Ae){let ye;const Re=X.players[L].board.filter(Le=>{var St,Fe;return Le!==null&&!((St=Le.passiveAbilities)!=null&&St.includes("STEALTH"))&&!((Fe=Le.passiveAbilities)!=null&&Fe.includes("AURA"))});Re.length>0&&(d==="HARD"?ye=[...Re].sort((St,Fe)=>{var ot,gt,xt,Tt;let Qe=(St.currentAttack||0)*2+(St.currentHealth||0),yt=(Fe.currentAttack||0)*2+(Fe.currentHealth||0);return(ot=St.passiveAbilities)!=null&&ot.includes("BANE")&&(Qe+=10),(gt=Fe.passiveAbilities)!=null&&gt.includes("BANE")&&(yt+=10),(xt=St.passiveAbilities)!=null&&xt.includes("DOUBLE_ATTACK")&&(Qe+=5),(Tt=Fe.passiveAbilities)!=null&&Tt.includes("DOUBLE_ATTACK")&&(yt+=5),yt-Qe})[0].instanceId:ye=Re[0].instanceId);const De=(Ge=lr.current[Ae.i])==null?void 0:Ge.getBoundingClientRect();De?(Ji({card:Ae.c,evolvedImageUrl:Ae.c.evolvedImageUrl,startX:De.left+De.width/2,startY:De.top+De.height/2,useSep:Se,phase:"ZOOM_IN",followerIndex:Ae.i,sourcePlayerId:C,targetId:ye}),await E(800)):(ps({type:"EVOLVE",playerId:C,payload:{followerIndex:Ae.i,useSep:Se,targetId:ye}}),await E(400))}}}}{let X=!0,ae=0;const re=ie=>{if(d!=="HARD")return!1;const V=ie.players[L].hp;return ee(ie)>=V};for(;X&&ae<15;){if(et.current.winnerId){X=!1;break}ae++;const ie=et.current,V=ie.players[C].board,se=ie.players[L].board,me=re(ie);let Ae=!1;for(let Se=0;Se<V.length;Se++){const ke=V[Se];if(!ke||!ke.canAttack)continue;let ye=-1,Xe=!0;const Re=((Je=ke.passiveAbilities)==null?void 0:Je.includes("STEALTH"))||ke.hadStealth,De=Re?-1:se.findIndex(ot=>{var gt,xt;return ot&&((gt=ot.passiveAbilities)==null?void 0:gt.includes("WARD"))&&!((xt=ot.passiveAbilities)!=null&&xt.includes("STEALTH"))&&!P(ot)});if(me&&De===-1)if(((He=ke.passiveAbilities)==null?void 0:He.includes("STORM"))||ke.turnPlayed!==ie.turnCount)ye=-1,Xe=!0;else{const xt=se.map((Tt,vs)=>({c:Tt,idx:vs})).filter(({c:Tt})=>{var vs,Tc;return Tt&&!((vs=Tt.passiveAbilities)!=null&&vs.includes("STEALTH"))&&!((Tc=Tt.passiveAbilities)!=null&&Tc.includes("AURA"))&&!P(Tt)});if(xt.length>0)ye=xt[0].idx,Xe=!1;else continue}else if(De!==-1)ye=De,Xe=!1;else if(d==="EASY"){const ot=se.map((xt,Tt)=>({c:xt,idx:Tt})).filter(({c:xt})=>{var Tt,vs;return xt&&!((Tt=xt.passiveAbilities)!=null&&Tt.includes("STEALTH"))&&!((vs=xt.passiveAbilities)!=null&&vs.includes("AURA"))&&!P(xt)}),gt=((We=ke.passiveAbilities)==null?void 0:We.includes("STORM"))||ke.turnPlayed!==ie.turnCount;if(!gt&&ot.length>0)ye=ot[Math.floor(Math.random()*ot.length)].idx,Xe=!1;else{if(!gt&&ot.length===0)continue;gt&&ot.length>0&&Math.random()<.5&&(ye=ot[Math.floor(Math.random()*ot.length)].idx,Xe=!1)}}else{const ot=te(ke,se,ie);if(ye=ot.index,Xe=ot.isLeader,ye===-1&&!Xe)continue}const Le=(pe=ke.passiveAbilities)==null?void 0:pe.includes("STORM"),St=ke.turnPlayed===ie.turnCount;if(!Le&&St&&Xe){const ot=se.map((gt,xt)=>({c:gt,idx:xt})).filter(({c:gt})=>{var xt,Tt;return gt&&!((xt=gt.passiveAbilities)!=null&&xt.includes("STEALTH"))&&!((Tt=gt.passiveAbilities)!=null&&Tt.includes("AURA"))&&!P(gt)});if(ot.length>0){const gt=Re?null:ot.find(({c:xt})=>{var Tt;return(Tt=xt.passiveAbilities)==null?void 0:Tt.includes("WARD")});gt?ye=gt.idx:ye=ot[0].idx,Xe=!1}else continue}const Fe=Xe?null:se[ye],Qe=Fe?Fe.instanceId:void 0,yt=ke.instanceId;if(yt&&(dc(yt),setTimeout(()=>dc(null),300)),Wt(ke.attackEffectType||"SLASH",L,Xe?-1:ye,Qe),!Xe&&ye>=0){const ot=se[ye];if(ot&&(ot.currentAttack||0)>0){const gt=ot.instanceId;setTimeout(()=>{gt&&(uc(gt),setTimeout(()=>uc(null),300)),Wt(ot.attackEffectType||"SLASH",C,Se,yt)},200)}}Ae=!0,await E(1e3),I({type:"ATTACK",playerId:C,payload:{attackerIndex:Se,targetIndex:ye,targetIsLeader:Xe}}),await E(1e3);break}Ae||(X=!1)}}if(await E(300),et.current.winnerId){hs.current=!1;return}I({type:"END_TURN",playerId:C}),hs.current=!1})()}},[g.activePlayerId,g.turnCount,n,g.phase,d,g.winnerId]);const Em=(m,_)=>{if(On.current||Ye||Yi.length>0)return;const E=oe.hand[_];m.stopPropagation();const P="touches"in m?m.touches[0].clientX:m.clientX,M="touches"in m?m.touches[0].clientY:m.clientY,Y=m.currentTarget.getBoundingClientRect();if(!Gr){yf(!0),Wr({card:E,owner:"PLAYER",source:"HAND"}),vf.current=!0;return}if(Wr({card:E,owner:"PLAYER",source:"HAND"}),g.activePlayerId!==L)return;if(pn.current){console.warn("[handleHandMouseDown] Card play in progress, blocking drag start");return}const ee=et.current;if(ee.winnerId){console.log("UI: Card play drag blocked - game has ended");return}if(ee.pendingEffects&&ee.pendingEffects.length>0){console.log("UI: Card play drag blocked - pendingEffects still processing");return}const $={sourceType:"HAND",sourceIndex:_,sourceInstanceId:E.instanceId,startX:Y.left+Y.width/2,startY:Y.top+Y.height/2,currentX:P,currentY:M,offsetX:0,offsetY:0,canDrag:!0};Hr($),On.current=$},Sm=(m,_,E)=>{m.stopPropagation();const P="touches"in m?m.touches[0].clientX:m.clientX,M="touches"in m?m.touches[0].clientY:m.clientY,Y=et.current;if(Y.winnerId){console.log("UI: Attack drag blocked - game has ended");return}const ee=Y.players[L].board,$=E?ee.findIndex(K=>K&&K.instanceId===E):_,B=$>=0?ee[$]:null;if(st&&st.allowedTargetPlayerId===L&&B){Cf("FOLLOWER",$,L,E);return}if(B&&Wr({card:B,owner:"PLAYER",source:"BOARD"}),Y.pendingEffects&&Y.pendingEffects.length>0){console.log("UI: Attack drag blocked - pendingEffects still processing");return}if(Y.activePlayerId===L&&(B!=null&&B.canAttack)){const K=m.currentTarget.getBoundingClientRect(),le={x:K.left+K.width/2,y:K.top+K.height/2},te={sourceType:"BOARD",sourceIndex:$,sourceInstanceId:B.instanceId,startX:le.x,startY:le.y,currentX:P,currentY:M,offsetX:0,offsetY:0};Hr(te),On.current=te}},bc=(m,_=!1)=>{if(g.activePlayerId!==L)return;m.stopPropagation();const E="touches"in m?m.touches[0].clientX:m.clientX,P="touches"in m?m.touches[0].clientY:m.clientY,M=et.current;if(M.winnerId){console.log("UI: Evolve drag blocked - game has ended");return}if(M.pendingEffects&&M.pendingEffects.length>0){console.log("UI: Evolve drag blocked - pendingEffects still processing");return}const Y=L===g.firstPlayerId;if(_){if(!R_(oe,g.turnCount,Y))return}else if(!k_(oe,g.turnCount,Y))return;const ee=m.currentTarget.getBoundingClientRect(),$=ee.left+ee.width/2,B=ee.top+ee.height/2,K={sourceType:"EVOLVE",sourceIndex:0,startX:$,startY:B,currentX:E,currentY:P,offsetX:0,offsetY:0,useSep:_};Hr(K),On.current=K},Im=O.useCallback(m=>{wr.current&&(clearTimeout(wr.current),wr.current=null);const _={stampId:m,playerId:L,playerClass:Tr,timestamp:Date.now()},E=T_(m);E&&_t(E,.6),Vi(null),requestAnimationFrame(()=>{Vi(_)}),e==="ONLINE"&&b&&b.send({type:"STAMP",stampId:m,playerClass:Tr}),wr.current=setTimeout(()=>{Vi(P=>(P==null?void 0:P.timestamp)===_.timestamp?null:P),wr.current=null},3e3)},[L,Tr,e,b]),bI=O.useCallback(m=>{if(m.stopPropagation(),m.preventDefault(),ci.current){const _=ci.current.getBoundingClientRect();Br.current={x:_.left+_.width/2,y:_.top+_.height/2}}else Br.current={x:m.clientX,y:m.clientY};nm(!0),sc(null)},[]),Tm=N.useRef(null);N.useEffect(()=>{Tm.current=lf},[lf]),O.useEffect(()=>{if(!af)return;const m=E=>{if(!Br.current)return;const P=E.clientX-Br.current.x,M=E.clientY-Br.current.y,Y=Math.sqrt(P*P+M*M),ee=Math.atan2(M,P)*(180/Math.PI);if(Y>=200&&Y<=320&&M<0){const le=180- -ee,te=Math.floor(le/22.5),_e=Math.max(0,Math.min(7,te))+1;sc(_e)}else sc(null)},_=()=>{const E=Tm.current;E&&Im(E),nm(!1),sc(null),Br.current=null};return window.addEventListener("mousemove",m),window.addEventListener("mouseup",_),()=>{window.removeEventListener("mousemove",m),window.removeEventListener("mouseup",_)}},[af,Im]),O.useEffect(()=>{const m=(P,M,Y=!1)=>{var B,K,le,te;if(!On.current)return;const{canDrag:ee,sourceType:$}=On.current;if(!($==="HAND"&&!ee)&&(On.current={...On.current,currentX:P,currentY:M},Hr(he=>he?{...he,currentX:P,currentY:M}:null),Y&&($==="BOARD"||$==="EVOLVE"))){const he=Qi.current;if(he){const Ee=he.getBoundingClientRect();if(P>=Ee.left&&P<=Ee.right&&M>=Ee.top&&M<=Ee.bottom){Qn({type:"LEADER",index:0,playerId:C});return}}const _e=et.current,Ke=((B=_e.players[C])==null?void 0:B.board)||[];for(let Ee=0;Ee<lr.current.length;Ee++){const Ge=lr.current[Ee];if(Ge&&Ke[Ee]){const Je=Ge.getBoundingClientRect();if(P>=Je.left&&P<=Je.right&&M>=Je.top&&M<=Je.bottom){Qn({type:"FOLLOWER",index:Ee,playerId:C,instanceId:(K=Ke[Ee])==null?void 0:K.instanceId});return}}}if($==="EVOLVE"){const Ee=((le=_e.players[L])==null?void 0:le.board)||[];for(let Ge=0;Ge<kr.current.length;Ge++){const Je=kr.current[Ge];if(Je&&Ee[Ge]){const He=Je.getBoundingClientRect();if(P>=He.left&&P<=He.right&&M>=He.top&&M<=He.bottom){Qn({type:"FOLLOWER",index:Ge,playerId:L,instanceId:(te=Ee[Ge])==null?void 0:te.instanceId});return}}}}Qn(null)}},_=P=>{m(P.clientX,P.clientY)},E=P=>{P.touches.length>0&&(On.current&&P.preventDefault(),m(P.touches[0].clientX,P.touches[0].clientY,!0))};return window.addEventListener("mousemove",_),window.addEventListener("touchmove",E,{passive:!1}),()=>{window.removeEventListener("mousemove",_),window.removeEventListener("touchmove",E)}},[]);const wm=N.useRef(null),EI=N.useRef(null);O.useEffect(()=>{wm.current=ut,EI.current=ut},[ut]),O.useEffect(()=>{const m=()=>{var M,Y,ee,$,B,K,le,te,he,_e,Ke,Ee,Ge;const E=On.current,P=wm.current;if(et.current.winnerId){console.log("[handleGlobalMouseUp] Game has ended, cancelling all actions"),Hr(null),On.current=null,Qn(null);return}if(E){if(E.sourceType==="HAND"){if(pn.current){console.warn("[handleGlobalMouseUp] Card play in progress, cancelling drag"),On.current=null,Hr(null);return}const Je=Math.sqrt(Math.pow(E.startX-E.currentX,2)+Math.pow(E.startY-E.currentY,2)),He=E.currentY<window.innerHeight-200*p;if(E.canDrag&&Je>30&&He){const We=Rr.current.hand[E.sourceIndex];if(Rr.current.pp>=We.cost){const pe=((Y=(M=We.triggerAbilities)==null?void 0:M.FANFARE)==null?void 0:Y.targetType)==="SELECT_FOLLOWER"||((ee=We.triggers)==null?void 0:ee.some(ie=>ie.trigger==="FANFARE"&&ie.effects.some(V=>V.targetType==="SELECT_FOLLOWER"))),X=((B=($=We.triggerAbilities)==null?void 0:$.FANFARE)==null?void 0:B.targetType)==="SELECT_ALLY_FOLLOWER"||((K=We.triggers)==null?void 0:K.some(ie=>ie.trigger==="FANFARE"&&ie.effects.some(V=>V.targetType==="SELECT_ALLY_FOLLOWER"))),ae=((te=(le=We.triggerAbilities)==null?void 0:le.FANFARE)==null?void 0:te.targetType)==="SELECT_OTHER_ALLY_FOLLOWER"||((he=We.triggers)==null?void 0:he.some(ie=>ie.trigger==="FANFARE"&&ie.effects.some(V=>V.targetType==="SELECT_OTHER_ALLY_FOLLOWER")));if(pe||X||ae){const ie=X||ae?L:C;et.current.players[ie].board.some(me=>{var Ae,Se;return!(!me||ie!==L&&((Ae=me.passiveAbilities)!=null&&Ae.includes("STEALTH")||(Se=me.passiveAbilities)!=null&&Se.includes("AURA")))})?(pn.current=!0,ma.current=We.instanceId||null,li({type:"PLAY",sourceIndex:E.sourceIndex,sourceInstanceId:We.instanceId,allowedTargetPlayerId:ie}),cr.current=!0,setTimeout(()=>{cr.current=!1},100)):(console.log("[handleGlobalMouseUp] No valid targets, skipping target selection"),wf(E.sourceIndex,E.startX,E.startY),Wr(null),cr.current=!0,setTimeout(()=>{cr.current=!1},100))}else wf(E.sourceIndex,E.startX,E.startY),Wr(null),cr.current=!0,setTimeout(()=>{cr.current=!1},100);On.current=null,Hr(null);return}}else E.canDrag||yf(!0)}else if(E.sourceType==="BOARD"){if(P&&P.playerId===C){const He=et.current.players[C],We=He.board.filter(V=>{var se,me;return V&&((se=V.passiveAbilities)==null?void 0:se.includes("WARD"))&&!((me=V.passiveAbilities)!=null&&me.includes("STEALTH"))});let pe=!1;const X=V=>V?He.board.findIndex(se=>se&&se.instanceId===V):-1,ae=P.type==="LEADER"?-1:X(P.instanceId),re=Rr.current.board[E.sourceIndex],ie=((_e=re==null?void 0:re.passiveAbilities)==null?void 0:_e.includes("STEALTH"))||(re==null?void 0:re.hadStealth);if(We.length>0&&!ie){if(P.type==="LEADER")pe=!0;else if(P.type==="FOLLOWER"&&ae>=0){const V=He.board[ae];V&&!((Ke=V.passiveAbilities)!=null&&Ke.includes("WARD"))&&(pe=!0)}}if(pe)console.log("UI: Attack blocked by WARD");else{const V=Rr.current.board.findIndex(Xe=>Xe&&Xe.instanceId===E.sourceInstanceId),se=V>=0?Rr.current.board[V]:null,me=(Ee=se==null?void 0:se.passiveAbilities)==null?void 0:Ee.includes("RUSH"),Ae=(Ge=se==null?void 0:se.passiveAbilities)==null?void 0:Ge.includes("STORM"),Se=(se==null?void 0:se.turnPlayed)===et.current.turnCount,ke=P.type==="LEADER",ye=ae;if(ke&&me&&!Ae&&Se)console.log("UI: Attack blocked by RUSH rule (Cannot attack leader)");else{if(V<0||!se){console.log("UI: Attack blocked - invalid attacker");return}const Xe=et.current;if(Xe.pendingEffects&&Xe.pendingEffects.length>0){console.log("UI: Attack blocked - pendingEffects still processing");return}const Re=P.instanceId,De=E.sourceInstanceId,Le=!ke&&ye>=0?He.board[ye]:null;ps({type:"ATTACK",playerId:L,payload:{attackerIndex:V,targetIndex:ke?-1:ye,targetIsLeader:ke}}),De&&(dc(De),setTimeout(()=>dc(null),300));const Fe=(se==null?void 0:se.attackEffectType)||"SLASH";if(Wt(Fe,C,ke?-1:ye,Re),Bn(),!ke&&Le&&(Le.currentAttack||0)>0){const Qe=Le.instanceId;setTimeout(()=>{Qe&&(uc(Qe),setTimeout(()=>uc(null),300)),Wt(Le.attackEffectType||"SLASH",L,V,De)},200)}}}}}else if(E.sourceType==="EVOLVE"&&P&&P.type==="FOLLOWER"&&P.playerId===L){const Je=P.index,We=da.current[Je],pe=(We==null?void 0:We.instanceId)||P.instanceId,X=Rr.current.board,ae=pe?X.findIndex(De=>De&&De.instanceId===pe):Je,re=ae>=0?X[ae]:null;if(!re)return;if(re.hasEvolved){console.log("[GameScreen] Cannot evolve: card already evolved (drag drop)");return}const V=E.useSep?["SUPER_EVOLVE","EVOLVE"]:["EVOLVE"],me=(()=>{var Le,St;const De=(St=(Le=re==null?void 0:re.triggerAbilities)==null?void 0:Le.EVOLVE)==null?void 0:St.targetType;if(De)return De;for(const Fe of(re==null?void 0:re.triggers)||[])if(V.includes(Fe.trigger)){for(const Qe of Fe.effects)if(Qe.targetType&&["SELECT_FOLLOWER","SELECT_ALLY_FOLLOWER","SELECT_OTHER_ALLY_FOLLOWER"].includes(Qe.targetType))return Qe.targetType}return null})(),Ae=!!me,Se=me==="SELECT_ALLY_FOLLOWER"||me==="SELECT_OTHER_ALLY_FOLLOWER",ke=me==="SELECT_OTHER_ALLY_FOLLOWER",ye=Se?L:C,Re=et.current.players[ye].board.some(De=>{var Le,St;return!(!De||Se&&ke&&De.instanceId===pe||!Se&&((Le=De.passiveAbilities)!=null&&Le.includes("STEALTH")||(St=De.passiveAbilities)!=null&&St.includes("AURA")))});Ae&&Re?(li({type:"EVOLVE",sourceIndex:ae,sourceInstanceId:pe,sourceVisualIndex:Je,useSep:E.useSep,allowedTargetPlayerId:ye,excludeInstanceId:ke?pe:void 0}),cr.current=!0,setTimeout(()=>{cr.current=!1},100)):(xc(Je,E.useSep,void 0,pe),cr.current=!0,setTimeout(()=>{cr.current=!1},100))}}E&&E.sourceType==="HAND"&&E.canDrag&&(fm(E.sourceIndex),setTimeout(()=>fm(null),300)),Hr(null),On.current=null,Qn(null)},_=()=>{m()};return window.addEventListener("mouseup",m),window.addEventListener("touchend",_),()=>{window.removeEventListener("mouseup",m),window.removeEventListener("touchend",_)}},[C,L,Gr,p]);const SI=()=>{if(!cr.current){if(st){st.type==="PLAY"&&(pn.current=!1),li(null);return}if(Gr){if(vf.current){vf.current=!1;return}yf(!1),Wr(null),Ne(null)}}},gs=()=>{if(!Z||Z.sourceType!=="BOARD"&&Z.sourceType!=="EVOLVE")return"";const m=Z.currentX-Z.startX,_=Z.currentY-Z.startY,E=Math.sqrt(m*m+_*_);if(E<10)return"";const P=(Z.startX+Z.currentX)/2,M=(Z.startY+Z.currentY)/2,Y=Math.min(200,E*.3),ee=Math.abs(m),$=Math.min(150,ee*.4),B=Y+$,le=-(m/(E+1))*B*.5,te=-B*.8,he=P+le,_e=M+te;return`M${Z.startX},${Z.startY} Q${he},${_e} ${Z.currentX},${Z.currentY}`},Cf=(m,_,E,P)=>{var ee;if(!st)return;if(st.allowedTargetPlayerId&&st.allowedTargetPlayerId!==E){console.log("Invalid target side");return}if(st.excludeInstanceId&&P===st.excludeInstanceId){console.log("Cannot target self (SELECT_OTHER_ALLY_FOLLOWER)"),Bn();return}let M,Y=_;if(m==="FOLLOWER"){if(P&&(Y=g.players[E].board.findIndex(B=>B&&B.instanceId===P),Y<0))return;const $=g.players[E].board[Y];if(!$)return;if(M=$.instanceId,E!==L){const B=$.passiveAbilities||[];if(B.includes("STEALTH")){console.log("Cannot target unit with STEALTH"),_t("cancel"),Bn();return}if(B.includes("AURA")){console.log("Cannot target unit with AURA"),_t("cancel"),Bn();return}}}else return;if(st.type==="PLAY"){const $=Rr.current;let B=st.sourceIndex,K=$.hand[B];if(st.sourceInstanceId){const He=$.hand.findIndex(We=>We.instanceId===st.sourceInstanceId);if(He>=0)B=He,K=$.hand[He],console.log(`[handleTargetClick] Using sourceInstanceId ${st.sourceInstanceId}, found at index ${He} (was ${st.sourceIndex})`);else{console.error("[handleTargetClick] Card not found with instanceId:",st.sourceInstanceId),li(null);return}}if(!K){console.error("[handleTargetClick] Card not found at index:",B),li(null),pn.current=!1;return}pn.current=!0,ma.current=K.instanceId||null,K.id==="c_y"&&(Wt("SUMI","p2",Y,M),et.current.players[C].board.forEach((We,pe)=>{if(We){const X=We.instanceId;setTimeout(()=>{Wt("SUMI",C,pe,X)},300)}})),K.id==="s_resignation_proxy"&&(Wt("SUMI",E,Y,M),setTimeout(()=>{const He=et.current.players[L].board,We=[];if(He.forEach((pe,X)=>{pe&&We.push({index:X,instanceId:pe.instanceId})}),We.length>0){const pe=We[Math.floor(Math.random()*We.length)];Wt("SUMI",L,pe.index,pe.instanceId)}},500)),K.id==="c_azya"&&(Wt("THUNDER",C,-1),setTimeout(()=>{Wt("ICE",E,Y,M)},300),setTimeout(()=>{const He=et.current.players[C].board,We=He.filter(pe=>pe!==null);if(We.length>0){const pe=We[Math.floor(Math.random()*We.length)],X=He.findIndex(ae=>(ae==null?void 0:ae.instanceId)===(pe==null?void 0:pe.instanceId));X!==-1&&Wt("WATER",C,X,pe==null?void 0:pe.instanceId)}},600));const le=window.innerWidth/2,te=window.innerHeight-200*p/2,he=window.innerWidth/2,_e=window.innerHeight/2,Ke=()=>{K.type==="SPELL"||Bn(),ps({type:"PLAY_CARD",playerId:L,payload:{cardIndex:B,targetId:M,instanceId:K.instanceId}}),K.id==="c_amandava"&&et.current.players[C].board.forEach((pe,X)=>{if(pe){const ae=pe.instanceId;setTimeout(()=>{Wt("SHOT",C,X,ae)},200)}}),zn(null),setTimeout(()=>{pn.current=!1},100)};let Ee,Ge;if(K.type==="FOLLOWER"){const We=et.current.players[L].board.filter(se=>se!==null),pe=We.length+1,X=We.length,ae=ui*p,re=(X-(pe-1)/2)*ae,ie=(ee=Xi.current)==null?void 0:ee.getBoundingClientRect();Ee=(ie?ie.left+ie.width/2:window.innerWidth/2)+re,Ge=window.innerHeight/2+70*p}const Je=K.type==="FOLLOWER"?et.current.players[L].board.filter(He=>He!==null).length:void 0;n!=="CPU"&&v&&b&&b.send({type:"PLAY_CARD_ANIM",payload:{playerId:L,cardIndex:B,card:K,targetBoardIndex:Je}}),zn({card:K,sourceIndex:st.sourceIndex??-1,startX:le,startY:te,targetX:he,targetY:_e,finalX:Ee,finalY:Ge,playerClass:(oe==null?void 0:oe.class)||"SENKA",onComplete:Ke}),setTimeout(()=>{zn(He=>(He==null?void 0:He.card.id)===K.id?(Ke(),null):He)},2e3)}else if(st.type==="EVOLVE"){const $=st.sourceVisualIndex??st.sourceIndex;xc($,!!st.useSep,M,st.sourceInstanceId)}li(null)},Cm=()=>{if(!$e||$e.owner!=="PLAYER")return;if(pn.current){console.warn("[handleUseButtonClick] Card play in progress, ignoring");return}const m=oe.hand.findIndex(P=>P.id===$e.card.id);if(m===-1)return;const _=window.innerWidth/2,E=window.innerHeight-200*p/2;wf(m,_,E),Wr(null)},[eo,kf]=N.useState(!1),[Ec,Rf]=N.useState(!1),[Yt,Af]=N.useState(null),II=N.useRef(0);N.useEffect(()=>{if(!(Yt!=null&&Yt.active))return;const m=Date.now(),_=800,E=()=>{const P=Date.now()-m;if(P>=_){Af(null);return}const M=P/_;Af(Y=>Y?{...Y,ringRadius:20+M*100,particles:Y.particles.map(ee=>({...ee,x:ee.x+ee.vx,y:ee.y+ee.vy,opacity:1-M}))}:null),requestAnimationFrame(E)};requestAnimationFrame(E)},[Yt==null?void 0:Yt.active]);const km=(m,_)=>{const E=[];for(let P=0;P<20;P++){const M=Math.random()*Math.PI*2,Y=2+Math.random()*3;E.push({id:II.current++,x:m,y:_,vx:Math.cos(M)*Y,vy:Math.sin(M)*Y,opacity:1,createdAt:Date.now()})}Af({active:!0,x:m,y:_,ringRadius:20,particles:E})},Pf=async()=>{if(g.winnerId){console.log("[handleEndTurn] Game is over, ignoring");return}if(g.activePlayerId!==L){console.log("[handleEndTurn] Not my turn, ignoring");return}if(qi.current){console.log("[handleEndTurn] Already ending turn, ignoring");return}qi.current=!0,kf(!0);const m=et.current.turnCount,_=et.current.activePlayerId;if(!await(async()=>{const M=()=>{const K=et.current,le=K.pendingEffects&&K.pendingEffects.length>0,te=Sf.current.length>0,he=If.current.length>0,_e=ya.current!==null,Ke=Zi.current!==null,Ee=zr.current,Ge=pn.current;return!le&&!te&&!he&&!_e&&!Ke&&!Ee&&!Ge};let $=0,B=0;for(;$<3e3;){if(et.current.turnCount!==m||et.current.activePlayerId!==_)return console.log("[handleEndTurn] Turn changed during wait, aborting local END_TURN"),!1;if(M()){if(B++,B>=2)break}else B=0;await new Promise(K=>setTimeout(K,50)),$+=50}return $>=3e3&&console.warn("[handleEndTurn] Timeout waiting for processing to complete - forcing end turn"),!0})()||et.current.turnCount!==m||et.current.activePlayerId!==_||et.current.activePlayerId!==L){console.log("[handleEndTurn] Turn state changed, aborting END_TURN dispatch"),qi.current=!1,kf(!1);return}console.log("[handleEndTurn] Dispatching END_TURN"),ps({type:"END_TURN",playerId:L}),qi.current=!1,kf(!1)},TI=O.useCallback(()=>{_t("sisiodosi.mp3",.6);const m=am.current;if(m){const _=m.getBoundingClientRect();km(_.left+_.width/2,_.top+_.height/2)}Pf()},[_t,Pf]),Rm=2-((oe==null?void 0:oe.evolutionsUsed)||0),Of=L===g.firstPlayerId,Am=(m,_)=>_?Math.ceil(g.turnCount/2):Math.floor(g.turnCount/2),Pm=Am(L,Of),wI=Of?3:2,CI=Of?4:3,Sc=Pm>=wI,Ic=Pm>=CI,ms=(oe==null?void 0:oe.canEvolveThisTurn)&&Rm>0&&g.activePlayerId===L&&Sc,ys=(oe==null?void 0:oe.canEvolveThisTurn)&&oe.sep>0&&g.activePlayerId===L&&Ic,Lf=C===g.firstPlayerId,Om=Am(C,Lf),kI=Lf?3:2,RI=Lf?4:3,Df=Om>=kI,Mf=Om>=RI,Nf=((Fm=oe==null?void 0:oe.board)==null?void 0:Fm.some(m=>{var _;return(_=m==null?void 0:m.passiveAbilities)==null?void 0:_.includes("LEADER_DAMAGE_CAP")}))??!1,jf=((Um=Oe==null?void 0:Oe.board)==null?void 0:Um.some(m=>{var _;return(_=m==null?void 0:m.passiveAbilities)==null?void 0:_.includes("LEADER_DAMAGE_CAP")}))??!1,AI=(oe==null?void 0:oe.leaderDamageShield)??!1,PI=(Oe==null?void 0:Oe.leaderDamageShield)??!1,Lm=Nf||AI,Dm=jf||PI;return O.useLayoutEffect(()=>{window.scrollTo(0,0),Xi.current&&(Xi.current.scrollTop=0);const m=()=>{window.scrollTo(0,0)};return window.addEventListener("scroll",m,{passive:!1}),()=>{window.removeEventListener("scroll",m)}},[]),n==="JOIN"&&!A||J&&y&&!A?a.jsxs("div",{style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",gap:"1rem"},children:[a.jsx("div",{style:{width:"50px",height:"50px",border:"4px solid rgba(233, 69, 96, 0.3)",borderTop:"4px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),a.jsx("p",{children:"..."}),a.jsx("button",{onClick:s,style:{marginTop:"1rem",padding:"0.5rem 1rem",background:"transparent",border:"1px solid #888",color:"#888",cursor:"pointer",borderRadius:"4px"},children:""}),a.jsx("style",{children:`
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                `})]}):J&&ze&&A?a.jsxs("div",{style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",gap:"1rem"},children:[a.jsx("div",{style:{fontSize:"2rem",fontWeight:"bold",color:"#4ade80",textShadow:"0 0 10px rgba(74, 222, 128, 0.5)",marginBottom:"0.5rem"},children:""}),a.jsx("div",{style:{width:"50px",height:"50px",border:"4px solid rgba(74, 222, 128, 0.3)",borderTop:"4px solid #4ade80",borderRadius:"50%",animation:"spin 1s linear infinite"}}),a.jsx("p",{style:{color:"#a0aec0"},children:"..."}),a.jsx("style",{children:`
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                `})]}):a.jsxs("div",{className:"game-screen-wrapper",style:{width:"100vw",height:"100dvh",overflow:"hidden",background:"#000",position:"relative"},children:[U&&a.jsx(LL,{myPlayer:oe,opponentPlayer:Oe,isFirstPlayer:Ir,onComplete:_I,scale:p,onVsImpact:()=>_t("vs.mp3",.7),onCoinToss:()=>_t("coin.mp3",.7),onImpact:()=>_t("gan.mp3",.7),onOrbLand:()=>_t("gan.mp3",.8),onFadeInBoard:()=>Ie(!0),isMobile:W}),a.jsxs("div",{className:"game-screen",style:{width:"100%",height:"100%",transform:vt>0?`translate(${Ve.x}px, ${Ve.y}px)`:"none",display:"flex",overflow:"hidden",background:"radial-gradient(circle at center, #1a202c 0%, #000 100%)",fontFamily:"'Helvetica Neue', sans-serif",userSelect:"none",color:"#fff",position:"absolute",top:0,left:0,opacity:U&&!G?0:1,transition:"opacity 0.5s ease-in"},onClick:SI,children:[a.jsx("style",{children:`
                    html, body {
                        margin: 0; padding: 0; height: 100%; background: #000;
                        overflow: hidden !important;
                        position: fixed !important;
                        width: 100% !important;
                        top: 0 !important;
                        left: 0 !important;
                    }
                    * { box-sizing: border-box; }
                    .shake-target { animation: shake 0.3s cubic-bezier(.36,.07,.19,.97) both; }
                    @keyframes shake {
                        10%, 90% { transform: translate3d(-1px, 0, 0); }
                        20%, 80% { transform: translate3d(2px, 0, 0); }
                        30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
                        40%, 60% { transform: translate3d(4px, 0, 0); }
                    }
                    @keyframes attackRotate {
                        0% { transform: rotateY(0deg); }
                        100% { transform: rotateY(360deg); }
                    }
                    .attack-rotating {
                        animation: attackRotate 0.2s linear forwards !important;
                        transform-style: preserve-3d;
                    }
                    @keyframes cardDie {
                        0% { transform: scale(1); filter: brightness(1) drop-shadow(0 0 0 white); opacity: 1; }
                        40% { transform: scale(1.15); filter: brightness(3) drop-shadow(0 0 20px white); opacity: 0.9; }
                        100% { transform: scale(0.4) rotate(8deg); filter: brightness(5) drop-shadow(0 0 40px white); opacity: 0; }
                    }
                    .card-dying { animation: cardDie 0.7s forwards; }
                    /* Necromance effect animations */
                    @keyframes necromanceFloat {
                        0% { transform: translateX(-50%) translateY(0) scale(1); opacity: 1; }
                        50% { transform: translateX(-50%) translateY(-20px) scale(1.2); opacity: 1; }
                        100% { transform: translateX(-50%) translateY(-40px) scale(0.8); opacity: 0; }
                    }
                    @keyframes necromanceFloatOpponent {
                        0% { transform: translateX(-50%) translateY(0) scale(1); opacity: 1; }
                        50% { transform: translateX(-50%) translateY(15px) scale(1.2); opacity: 1; }
                        100% { transform: translateX(-50%) translateY(30px) scale(0.8); opacity: 0; }
                    }
                    @keyframes necroPulse {
                        0%, 100% { box-shadow: 0 0 10px #d946ef, 0 0 20px #a855f7, inset 0 0 15px rgba(217, 70, 239, 0.3); }
                        50% { box-shadow: 0 0 25px #d946ef, 0 0 40px #a855f7, 0 0 60px #7c3aed, inset 0 0 25px rgba(217, 70, 239, 0.5); }
                    }
                    @keyframes leaderDamageCapPulse {
                        0%, 100% {
                            box-shadow: 0 0 20px rgba(103, 232, 249, 0.4), 0 0 40px rgba(103, 232, 249, 0.2);
                            border-color: #67e8f9;
                        }
                        50% {
                            box-shadow: 0 0 35px rgba(103, 232, 249, 0.7), 0 0 55px rgba(103, 232, 249, 0.4);
                            border-color: #a5f3fc;
                        }
                    }
                    @keyframes leaderDamageCapOverlay {
                        0%, 100% { opacity: 0.15; }
                        50% { opacity: 0.45; }
                    }
                    /* EP/SEP pulse animations for usable state - box-shadow only, no transform override */
                    @keyframes epPulse {
                        0%, 100% {
                            box-shadow: 0 0 12px #ffd700, 0 0 25px rgba(255,215,0,0.6);
                        }
                        50% {
                            box-shadow: 0 0 20px #ffd700, 0 0 40px rgba(255,215,0,0.8), 0 0 55px rgba(255,180,0,0.5);
                        }
                    }
                    @keyframes sepPulse {
                        0%, 100% {
                            box-shadow: 0 0 12px #b794f4, 0 0 25px rgba(159,122,234,0.6);
                        }
                        50% {
                            box-shadow: 0 0 20px #b794f4, 0 0 40px rgba(159,122,234,0.8), 0 0 55px rgba(180,0,255,0.5);
                        }
                    }
                `}),st&&a.jsx("div",{style:{position:"absolute",top:"15%",left:"50%",transform:"translate(-50%, -50%)",background:"rgba(0, 0, 0, 0.7)",color:"#fff",padding:"10px 20px",borderRadius:20,pointerEvents:"none",zIndex:1e3,fontWeight:"bold",border:st.allowedTargetPlayerId===L?"2px solid #48bb78":"2px solid #f56565"},children:st.allowedTargetPlayerId===L?"":""}),gI&&a.jsx(JL,{onClose:()=>mf(!1)}),pI&&a.jsx("div",{style:{position:"absolute",inset:0,zIndex:4e3,background:"rgba(0,0,0,0.8)",backdropFilter:"blur(5px)",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>pc(!1),children:a.jsxs("div",{style:{background:"#2d3748",padding:40,borderRadius:16,display:"flex",flexDirection:"column",gap:20,minWidth:300,border:"1px solid rgba(255,255,255,0.1)"},onClick:m=>m.stopPropagation(),children:[a.jsx("h2",{style:{margin:0,textAlign:"center",borderBottom:"1px solid #4a5568",paddingBottom:10,color:"#fff"},children:""}),hI?a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:15},children:[a.jsx("h3",{style:{margin:0,color:"#cbd5e0"},children:""}),a.jsxs("label",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",color:"white"},children:["BGM",a.jsx("input",{type:"checkbox",checked:Ct.bgmEnabled,onChange:m=>pa(_=>({..._,bgmEnabled:m.target.checked})),style:{width:20,height:20}})]}),a.jsxs("label",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",color:"white"},children:["SE",a.jsx("input",{type:"checkbox",checked:Ct.seEnabled,onChange:m=>pa(_=>({..._,seEnabled:m.target.checked})),style:{width:20,height:20}})]}),a.jsxs("div",{children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",color:"#a0aec0",marginBottom:5},children:[a.jsx("span",{children:"BGM"}),a.jsxs("span",{children:[Math.round(Ct.bgm*100),"%"]})]}),a.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:Ct.bgm,onChange:m=>pa(_=>({..._,bgm:parseFloat(m.target.value)})),style:{width:"100%"}})]}),a.jsxs("div",{children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",color:"#a0aec0",marginBottom:5},children:[a.jsx("span",{children:"SE"}),a.jsxs("span",{children:[Math.round(Ct.se*100),"%"]})]}),a.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:Ct.se,onChange:m=>pa(_=>({..._,se:parseFloat(m.target.value)})),style:{width:"100%"}})]}),a.jsxs("div",{children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",color:"#a0aec0",marginBottom:5},children:[a.jsx("span",{children:""}),a.jsxs("span",{children:[Math.round(Ct.voice*100),"%"]})]}),a.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:Ct.voice,onChange:m=>pa(_=>({..._,voice:parseFloat(m.target.value)})),style:{width:"100%"}})]}),a.jsx("button",{onClick:()=>mm(!1),style:{padding:10,background:"#4a5568",border:"none",color:"white",borderRadius:8,cursor:"pointer",marginTop:10},children:""})]}):a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:()=>pc(!1),style:{padding:15,background:"#4a5568",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.2rem"},children:""}),a.jsx("button",{onClick:()=>mm(!0),style:{padding:15,background:"#2b6cb0",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.2rem"},children:""}),a.jsx("button",{onClick:()=>gc(!0),style:{padding:15,background:"#e53e3e",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.2rem"},children:""})]})]})}),mI&&a.jsx("div",{style:{position:"absolute",inset:0,zIndex:4100,background:"rgba(0,0,0,0.85)",backdropFilter:"blur(5px)",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>gc(!1),children:a.jsxs("div",{style:{background:"#2d3748",padding:40,borderRadius:16,display:"flex",flexDirection:"column",gap:20,minWidth:320,border:"2px solid #e53e3e",boxShadow:"0 0 30px rgba(229, 62, 62, 0.3)"},onClick:m=>m.stopPropagation(),children:[a.jsx("h2",{style:{margin:0,textAlign:"center",color:"#fff",fontSize:"1.5rem"},children:""}),a.jsx("p",{style:{margin:0,textAlign:"center",color:"#a0aec0",fontSize:"1rem"},children:""}),a.jsxs("div",{style:{display:"flex",gap:15,marginTop:10},children:[a.jsx("button",{onClick:()=>gc(!1),style:{flex:1,padding:15,background:"#4a5568",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.1rem"},children:""}),a.jsx("button",{onClick:yI,style:{flex:1,padding:15,background:"#e53e3e",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.1rem"},children:""})]})]})}),a.jsxs("div",{className:ym?"shake-target":"",style:{width:(W?280:340)*p,borderRight:"1px solid rgba(255,255,255,0.1)",background:"rgba(0,0,0,0.3)",padding:W?`${10*p}px ${12*p}px`:`${20*p}px ${20*p}px ${20*p}px`,display:"flex",flexDirection:"column",zIndex:20,flexShrink:0},onClick:m=>m.stopPropagation(),children:[a.jsx("div",{style:{marginBottom:(W?6:12)*p},children:a.jsxs("button",{onClick:()=>pc(!0),style:{background:"transparent",border:"none",cursor:"pointer",padding:W?3:5},children:[a.jsx("div",{style:{width:(W?22:30)*p,height:(W?2:3)*p,background:"#cbd5e0",marginBottom:(W?4:6)*p}}),a.jsx("div",{style:{width:(W?22:30)*p,height:(W?2:3)*p,background:"#cbd5e0",marginBottom:(W?4:6)*p}}),a.jsx("div",{style:{width:(W?22:30)*p,height:(W?2:3)*p,background:"#cbd5e0"}})]})}),a.jsx("h3",{style:{color:"#a0aec0",borderBottom:"1px solid #4a5568",paddingBottom:(W?4:8)*p,marginTop:0,marginBottom:0,flexShrink:0,fontSize:W?`${.85*p}rem`:void 0},children:""}),$e?a.jsx("div",{style:{marginTop:(W?4:10)*p,display:"flex",flexDirection:"column",flex:1,overflow:"hidden",minHeight:0},children:a.jsxs("div",{style:{flex:1,overflow:"auto",minHeight:0,display:"flex",flexDirection:"column"},children:[a.jsxs("div",{style:{flexShrink:0},children:[a.jsx("div",{style:{width:"100%",aspectRatio:"1/1",marginBottom:(W?6:12)*p,display:"flex",alignItems:"center",justifyContent:"center",...W?{maxHeight:"28vh"}:{}},children:a.jsx(ro,{card:$e.card,style:{width:"100%",height:"100%",...W?{maxHeight:"28vh"}:{}},variant:"art-only"})}),a.jsx("div",{style:{fontSize:W?`${($e.card.name.length>12?.9:$e.card.name.length>8?1:1.1)*p}rem`:`${$e.card.name.length>12?1.1:$e.card.name.length>8?1.2:1.4}rem`,fontWeight:"bold",marginBottom:(W?4:6)*p,textAlign:"center"},children:$e.card.name}),a.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:(W?10:15)*p,marginBottom:(W?6:10)*p},children:[a.jsx("div",{style:{width:24*p,height:24*p,borderRadius:"50%",background:"radial-gradient(circle at 30% 30%, #68d391, #276749)",border:"1px solid #fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${.85*p}rem`,fontWeight:900,color:"white",textShadow:"0 1px 2px rgba(0,0,0,0.5)",boxShadow:"0 2px 4px rgba(0,0,0,0.3)"},children:$e.card.cost}),$e.card.type==="FOLLOWER"&&a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:3*p},children:[a.jsx("svg",{width:18*p,height:18*p,viewBox:"0 0 24 24",fill:"none",children:a.jsx("polygon",{points:"12,2 22,22 2,22",fill:"#63b3ed",stroke:"none"})}),a.jsx("span",{style:{fontSize:`${.95*p}rem`,fontWeight:"bold",color:"#4299e1"},children:"currentAttack"in $e.card?$e.card.currentAttack:$e.card.attack})]}),$e.card.type==="FOLLOWER"&&a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:3*p},children:[a.jsx("svg",{width:18*p,height:18*p,viewBox:"0 0 24 24",fill:"#f56565",children:a.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})}),a.jsx("span",{style:{fontSize:`${.95*p}rem`,fontWeight:"bold",color:"#f56565"},children:"currentHealth"in $e.card?$e.card.currentHealth:$e.card.health})]})]}),a.jsx("div",{style:{fontSize:`${((((Bm=$e.card.description)==null?void 0:Bm.length)||0)>150?.7:(((zm=$e.card.description)==null?void 0:zm.length)||0)>100?.8:.9)*p}rem`,color:"#cbd5e0",lineHeight:"1.4",whiteSpace:"pre-wrap",borderTop:"1px solid #4a5568",paddingTop:4*p},children:fI($e.card.description)})]}),$e.card.flavorText&&a.jsx("div",{style:{marginTop:"auto",paddingTop:8*p,paddingBottom:4*p,flexShrink:0},children:a.jsx("div",{style:{fontSize:`${((((Hm=$e.card.flavorText)==null?void 0:Hm.length)||0)>100?.6:.7)*p}rem`,color:"rgba(160, 174, 192, 0.6)",lineHeight:"1.3",fontStyle:"italic",whiteSpace:"pre-wrap",textAlign:"right"},children:$e.card.flavorText})})]})}):a.jsx("div",{style:{marginTop:10*p,color:"#718096",fontStyle:"italic",flex:1,fontSize:`${.7*p}rem`},children:""})]}),a.jsxs("div",{ref:Xi,className:ym?"shake-target":"",style:{flex:1,height:"100%",position:"relative",background:"rgba(0,0,0,0.1)",overflow:"hidden"},children:[a.jsxs("div",{ref:Qi,onMouseEnter:()=>Qn({type:"LEADER",playerId:C}),onMouseLeave:()=>Qn(null),onClick:m=>{m.stopPropagation(),st&&Cf("LEADER",-1,C)},style:{position:"absolute",top:-20*p,left:"50%",transform:"translateX(-50%)",width:so*p,height:so*p,borderRadius:"50%",zIndex:100,cursor:"default"},children:[a.jsx("div",{style:{position:"absolute",inset:0,borderRadius:"50%",background:Oe.class==="AJA"?`url(${sl(Oe.class)}) center top/cover`:`url(${sl(Oe.class)}) center/cover`,border:jf?"4px solid #67e8f9":(ut==null?void 0:ut.type)==="LEADER"&&ut.playerId===C&&!st?"4px solid #f56565":"4px solid #4a5568",boxShadow:jf?"0 0 20px rgba(103, 232, 249, 0.4), 0 0 40px rgba(103, 232, 249, 0.2)":"0 0 20px rgba(0,0,0,0.5)",transition:"border-color 0.3s, box-shadow 0.3s, filter 0.5s, opacity 0.5s",animation:Dm?"leaderDamageCapPulse 2s ease-in-out infinite":"none",...g.winnerId===L&&(Me||ct)?{filter:Me==="white-fade"?"brightness(2) saturate(0.3)":Me==="explode"||Me==="result-text"||Me==="fade-out"||ct?"brightness(3) saturate(0) blur(10px)":"none",opacity:Me==="explode"||Me==="result-text"||Me==="fade-out"||ct?0:1}:{}},children:Dm&&a.jsx("div",{style:{position:"absolute",inset:0,borderRadius:"50%",background:"radial-gradient(circle, rgba(103, 232, 249, 0.5) 0%, rgba(103, 232, 249, 0.2) 70%, rgba(103, 232, 249, 0.1) 100%)",pointerEvents:"none",animation:"leaderDamageCapOverlay 2s ease-in-out infinite",zIndex:1}})}),a.jsx("div",{style:{position:"absolute",bottom:0,left:"50%",transform:`translateX(-50%) translateX(${-140*p}px)`,width:55*p,height:55*p,background:"radial-gradient(circle at 30% 30%, #feb2b2, #c53030)",borderRadius:"50%",border:`${Math.max(2,3*p)}px solid #fff`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${1.2*p}rem`,fontWeight:900,color:"white",textShadow:"0 2px 2px rgba(0,0,0,0.5)",zIndex:10,boxShadow:"0 4px 6px rgba(0,0,0,0.4)",opacity:ne?1:0,transition:"opacity 0.3s ease-in"},children:Oe.hp}),a.jsx("div",{style:{position:"absolute",bottom:10*p,left:"50%",transform:`translateX(-50%) translateX(${-80*p}px)`,width:45*p,height:45*p,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,opacity:ne?Df?1:.5:0,filter:Df?"none":"grayscale(0.8)",transition:"opacity 0.3s ease-in"},children:a.jsx("div",{style:{display:"flex",gap:3*p},children:Array(2).fill(0).map((m,_)=>{const E=_<2-Oe.evolutionsUsed;return a.jsx("div",{style:{width:12*p,height:12*p,borderRadius:"50%",background:E?"#ecc94b":"#2d3748",boxShadow:E&&Df?"0 0 8px #ecc94b, 0 0 15px #ecc94b":"none",border:"2px solid rgba(0,0,0,0.5)"}},_)})})}),a.jsx("div",{style:{position:"absolute",bottom:10*p,left:"50%",transform:`translateX(-50%) translateX(${80*p}px)`,width:45*p,height:45*p,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,opacity:ne?Mf?1:.5:0,filter:Mf?"none":"grayscale(0.8)",transition:"opacity 0.3s ease-in"},children:a.jsx("div",{style:{display:"flex",gap:3*p},children:Array(2).fill(0).map((m,_)=>{const E=_<Oe.sep;return a.jsx("div",{style:{width:12*p,height:12*p,borderRadius:"50%",background:E?"#9f7aea":"#2d3748",boxShadow:E&&Mf?"0 0 8px #9f7aea, 0 0 15px #9f7aea":"none",border:"2px solid rgba(0,0,0,0.5)"}},_)})})}),a.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:so*p*.75,height:so*p*.75,pointerEvents:"none",zIndex:20,opacity:(ut==null?void 0:ut.type)==="LEADER"&&ut.playerId===C&&Z?1:0,transition:"opacity 0.1s ease-out"},children:[a.jsxs("svg",{width:"100%",height:"100%",viewBox:"0 0 100 100",children:[a.jsx("defs",{children:a.jsxs("filter",{id:"leaderCyanMarkerGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"4",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsxs("g",{style:{transformOrigin:"50% 50%",animation:"leaderMarkerSpin 2s linear infinite"},children:[a.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"rgba(100, 200, 255, 0.9)",strokeWidth:"3",strokeDasharray:"15 8",filter:"url(#leaderCyanMarkerGlow)"}),a.jsx("polygon",{points:"50,5 44,18 56,18",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"}),a.jsx("polygon",{points:"95,50 82,44 82,56",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"}),a.jsx("polygon",{points:"50,95 56,82 44,82",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"}),a.jsx("polygon",{points:"5,50 18,56 18,44",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"})]})]}),a.jsx("style",{children:`
                                @keyframes leaderMarkerSpin {
                                    0% { transform: rotate(0deg); }
                                    100% { transform: rotate(360deg); }
                                }
                            `})]})]}),a.jsxs("div",{style:{position:"absolute",top:20*p,left:20*p,width:60*p,height:85*p,zIndex:50},children:[[...Array(Math.min(5,Math.ceil(Oe.deck.length/5)))].map((m,_)=>a.jsx("div",{style:{position:"absolute",inset:0,transform:`translate(${_*2*p}px, ${-_*2*p}px)`,borderRadius:6,border:"1px solid #718096",overflow:"hidden"},children:a.jsx("img",{src:di((Oe==null?void 0:Oe.class)||"SENKA"),alt:"Deck",style:{width:"100%",height:"100%",objectFit:"cover"},onError:E=>{E.target.style.display="none",E.target.parentElement.style.background="linear-gradient(45deg, #2d3748, #1a202c)"}})},_)),a.jsx("div",{style:{position:"absolute",bottom:-20*p,width:"100%",textAlign:"center",fontWeight:"bold",color:"#a0aec0",fontSize:"0.9rem"},children:Oe.deck.length})]}),a.jsxs("div",{style:{position:"absolute",top:20*p,right:20*p,display:"flex",alignItems:"center",gap:8,zIndex:50,pointerEvents:"none"},children:[a.jsxs("div",{style:{position:"relative",width:24,height:30},children:[a.jsx("div",{style:{position:"absolute",inset:0,background:"#4a192c",borderRadius:2,border:"1px solid #742a3a",transform:"rotate(-15deg) translate(-3px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#3d1525",borderRadius:2,border:"1px solid #742a3a",transform:"rotate(-5deg) translate(-1px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#2d1a20",borderRadius:2,border:"1px solid #8b3a4a",transform:"rotate(5deg)"}})]}),a.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(74, 25, 44, 0.8), rgba(45, 26, 32, 0.9))",padding:"3px 8px",borderRadius:5,color:"#f0b8c4",fontSize:"0.64rem",fontWeight:"bold",border:"1px solid rgba(116, 42, 58, 0.5)",boxShadow:"0 2px 4px rgba(0,0,0,0.4)"},children:[" ",Oe.hand.length]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5,marginLeft:6},children:[a.jsx("div",{style:{fontSize:"0.9rem",filter:"drop-shadow(0 0 2px rgba(128, 90, 213, 0.6)) grayscale(30%)"},children:""}),a.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(128, 90, 213, 0.7), rgba(76, 29, 149, 0.8))",padding:"3px 8px",borderRadius:5,color:"#c4b5fd",fontSize:"0.64rem",fontWeight:"bold",border:"1px solid rgba(167, 139, 250, 0.4)",boxShadow:"0 2px 4px rgba(0,0,0,0.4)",position:"relative"},children:[" ",Oe.graveyard.length,of.filter(m=>m.playerId===C).map(m=>a.jsxs("div",{style:{position:"absolute",bottom:-25,left:"50%",transform:"translateX(-50%)",color:"#d946ef",fontSize:"1.2rem",fontWeight:"bold",textShadow:"0 0 8px #d946ef, 0 0 15px #a855f7, 0 0 25px #7c3aed",animation:"necromanceFloatOpponent 1.5s ease-out forwards",pointerEvents:"none",whiteSpace:"nowrap"},children:["-",m.amount]},m.key))]})]})]}),a.jsx("div",{style:{position:"absolute",top:`calc(50% - ${Sn*p/2}px - ${70*p}px)`,left:"0",width:"100%",height:Sn*p,pointerEvents:"none",zIndex:10},children:a.jsx("div",{style:{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center"},children:hn.map((m,_)=>{const E=hn.length,P=(_-(E-1)/2)*ui*p;return a.jsxs("div",{ref:M=>lr.current[_]=M,onMouseEnter:()=>{Z&&Qn({type:"FOLLOWER",index:_,playerId:C,instanceId:m==null?void 0:m.instanceId})},onMouseLeave:()=>{Z&&Qn(null)},onClick:M=>{if(M.stopPropagation(),st){if(!m)return;Cf("FOLLOWER",_,C,m==null?void 0:m.instanceId)}else m&&Wr({card:m,owner:"OPPONENT",source:"BOARD"})},style:{position:"absolute",left:"50%",top:0,transform:`translateX(calc(-50% + ${P}px))`,transition:"transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1), left 0.4s ease",border:st&&m&&st.allowedTargetPlayerId===C?"2px solid #f56565":"none",boxShadow:st&&m&&st.allowedTargetPlayerId===C?"0 0 15px #f56565":"none",borderRadius:8,cursor:st?"crosshair":"default",width:cn*p,height:Sn*p,pointerEvents:"auto",opacity:Lt&&Lt.sourcePlayerId===C&&Lt.followerIndex===_?0:m!=null&&m.isDying?.8:1,transitionProperty:Lt&&Lt.sourcePlayerId===C&&Lt.followerIndex===_?"none":"transform, left, opacity"},children:[a.jsx("div",{style:{width:"100%",height:"100%",perspective:"800px"},children:a.jsxs("div",{className:dm===(m==null?void 0:m.instanceId)||um===(m==null?void 0:m.instanceId)?"attack-rotating":"",style:{width:"100%",height:"100%",position:"relative",transformStyle:"preserve-3d"},children:[a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},children:m?a.jsx(ro,{card:m,turnCount:g.turnCount,className:m.isDying?"card-dying":"",scale:p,style:{width:cn*p,height:Sn*p,opacity:1,filter:m.isDying?"grayscale(0.5) brightness(2)":"none",boxShadow:(ut==null?void 0:ut.type)==="FOLLOWER"&&ut.index===_&&(Z==null?void 0:Z.sourceType)==="BOARD"?"0 0 20px #f56565":(Z==null?void 0:Z.sourceType)==="BOARD"?"0 0 20px #f6e05e":void 0},isOnBoard:!0,isSpecialSummoning:cm.has(m.instanceId)}):a.jsx("div",{style:{width:cn*p,height:Sn*p,border:"1px dashed rgba(255,255,255,0.1)",borderRadius:8}})}),m&&a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",transform:"rotateY(180deg)",borderRadius:12,overflow:"hidden"},children:a.jsx("img",{src:di((Oe==null?void 0:Oe.class)||"SENKA"),alt:"Card Sleeve",style:{width:"100%",height:"100%",objectFit:"cover"}})})]})}),m&&(Z==null?void 0:Z.sourceType)==="BOARD"&&a.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",width:"100%",height:"100%",transform:"translate(-50%, -50%)",pointerEvents:"none",zIndex:20,opacity:(ut==null?void 0:ut.type)==="FOLLOWER"&&ut.index===_&&ut.playerId===C?1:0,transition:"opacity 0.1s ease-out"},children:[a.jsxs("svg",{viewBox:"0 0 100 100",style:{width:"100%",height:"100%",filter:"drop-shadow(0 0 12px rgba(100, 200, 255, 0.9))"},children:[a.jsx("defs",{children:a.jsxs("filter",{id:"cyanMarkerGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"4",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsxs("g",{style:{transformOrigin:"50px 50px",animation:"attackMarkerSpin 1.5s linear infinite reverse"},children:[a.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:"rgba(100, 200, 255, 0.95)",strokeWidth:"4",strokeDasharray:"12 6",filter:"url(#cyanMarkerGlow)"}),a.jsx("polygon",{points:"50,10 45,20 55,20",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"}),a.jsx("polygon",{points:"90,50 80,45 80,55",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"}),a.jsx("polygon",{points:"50,90 55,80 45,80",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"}),a.jsx("polygon",{points:"10,50 20,55 20,45",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"})]})]}),a.jsx("style",{children:`
                                                    @keyframes attackMarkerSpin {
                                                        0% { transform: rotate(0deg); }
                                                        100% { transform: rotate(360deg); }
                                                    }
                                                `})]})]},(m==null?void 0:m.instanceId)||`empty-opp-${_}`)})})}),a.jsx("div",{style:{position:"absolute",bottom:`calc(50% - ${Sn*p/2}px - ${70*p}px)`,left:"0",width:"100%",height:Sn*p,pointerEvents:"none",zIndex:10},children:a.jsx("div",{style:{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center"},children:bn.map((m,_)=>{const E=bn.length,P=(_-(E-1)/2)*ui*p;return a.jsxs("div",{ref:M=>kr.current[_]=M,onMouseDown:M=>Sm(M,_,m==null?void 0:m.instanceId),onTouchStart:M=>Sm(M,_,m==null?void 0:m.instanceId),onClick:M=>M.stopPropagation(),onMouseEnter:()=>{Z&&Qn({type:"FOLLOWER",index:_,playerId:L,instanceId:m==null?void 0:m.instanceId})},onMouseLeave:()=>{Z&&Qn(null)},style:{position:"absolute",left:"50%",top:0,"--offsetX":`calc(-50% + ${P}px)`,transform:`translateX(calc(-50% + ${P}px)) ${(Z==null?void 0:Z.sourceType)==="BOARD"&&Z.sourceInstanceId===(m==null?void 0:m.instanceId)?"translateY(-20px) scale(1.1)":""}`,transition:"transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1), left 0.4s ease",cursor:"pointer",pointerEvents:"auto",width:cn*p,height:Sn*p,border:st&&m&&st.allowedTargetPlayerId===L?"2px solid #48bb78":"none",boxShadow:st&&m&&st.allowedTargetPlayerId===L?"0 0 15px #48bb78":"none",borderRadius:8,zIndex:(Z==null?void 0:Z.sourceType)==="BOARD"&&Z.sourceInstanceId===(m==null?void 0:m.instanceId)?10:1,opacity:Lt&&Lt.sourcePlayerId===L&&Lt.followerIndex===_?0:m!=null&&m.isDying?.8:1,transitionProperty:Lt&&Lt.sourcePlayerId===L&&Lt.followerIndex===_?"none":"transform, left, opacity"},children:[a.jsx("div",{style:{width:"100%",height:"100%",perspective:"800px"},children:a.jsxs("div",{className:dm===(m==null?void 0:m.instanceId)||um===(m==null?void 0:m.instanceId)?"attack-rotating":"",style:{width:"100%",height:"100%",position:"relative",transformStyle:"preserve-3d"},children:[a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},children:m?a.jsx(ro,{card:m,turnCount:g.turnCount,className:m.isDying?"card-dying":"",scale:p,style:{width:cn*p,height:Sn*p,opacity:1,filter:m.isDying?"grayscale(0.5) brightness(2)":"none",boxShadow:(Z==null?void 0:Z.sourceType)==="BOARD"&&Z.sourceInstanceId===(m==null?void 0:m.instanceId)&&(ut==null?void 0:ut.type)==="FOLLOWER"?"0 0 30px #f56565":(Z==null?void 0:Z.sourceType)==="BOARD"&&Z.sourceInstanceId===(m==null?void 0:m.instanceId)?"0 20px 30px rgba(0,0,0,0.6)":void 0,pointerEvents:(Z==null?void 0:Z.sourceType)==="BOARD"&&Z.sourceInstanceId===(m==null?void 0:m.instanceId)?"none":"auto"},isSelected:($e==null?void 0:$e.card)===m,isOnBoard:!0,isSpecialSummoning:cm.has(m.instanceId),isMyTurn:g.activePlayerId===L}):a.jsx("div",{style:{width:cn*p,height:Sn*p,border:"1px dashed rgba(255,255,255,0.2)",borderRadius:8}})}),m&&a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",transform:"rotateY(180deg)",borderRadius:12,overflow:"hidden"},children:a.jsx("img",{src:di((oe==null?void 0:oe.class)||"SENKA"),alt:"Card Sleeve",style:{width:"100%",height:"100%",objectFit:"cover"}})})]})}),m&&(Z==null?void 0:Z.sourceType)==="EVOLVE"&&!m.hasEvolved&&a.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",width:"120%",height:"120%",transform:"translate(-50%, -50%)",pointerEvents:"none",border:Z.useSep?"2px dashed rgba(183, 148, 244, 0.9)":"2px dashed rgba(255, 230, 100, 0.9)",borderRadius:"50%",boxShadow:Z.useSep?"0 0 15px rgba(159, 122, 234, 0.8)":"0 0 15px rgba(255, 200, 50, 0.8)",animation:"evolveMarkerSpin 1.5s linear infinite",zIndex:20,opacity:(ut==null?void 0:ut.type)==="FOLLOWER"&&ut.index===_&&ut.playerId===L?1:0,transition:"opacity 0.1s ease-out"},children:[a.jsxs("svg",{viewBox:"0 0 100 100",style:{width:"100%",height:"100%",filter:"drop-shadow(0 0 8px currentColor)"},children:[a.jsx("defs",{children:a.jsxs("filter",{id:Z.useSep?"purpleMarkerGlow":"yellowMarkerGlow",x:"-30%",y:"-30%",width:"160%",height:"160%",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"3",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:Z.useSep?"#b794f4":"#f6e05e",strokeWidth:"4",strokeDasharray:"15 8",filter:`url(#${Z.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`,opacity:"0.95"}),a.jsx("polygon",{points:"50,5 45,15 55,15",fill:Z.useSep?"#b794f4":"#f6e05e",filter:`url(#${Z.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`}),a.jsx("polygon",{points:"95,50 85,45 85,55",fill:Z.useSep?"#b794f4":"#f6e05e",filter:`url(#${Z.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`}),a.jsx("polygon",{points:"50,95 55,85 45,85",fill:Z.useSep?"#b794f4":"#f6e05e",filter:`url(#${Z.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`}),a.jsx("polygon",{points:"5,50 15,55 15,45",fill:Z.useSep?"#b794f4":"#f6e05e",filter:`url(#${Z.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`})]}),a.jsx("style",{children:`
                                                @keyframes evolveMarkerSpin {
                                                    0% { transform: translate(-50%, -50%) rotate(0deg); }
                                                    100% { transform: translate(-50%, -50%) rotate(360deg); }
                                                }
                                            `})]})]},(m==null?void 0:m.instanceId)||`empty-plr-${_}`)})})}),a.jsxs("div",{style:{position:"absolute",right:30*p,top:"50%",transform:"translateY(-50%)",display:"flex",flexDirection:"column",alignItems:"center",gap:30*p,zIndex:50},children:[a.jsx("div",{style:{textAlign:"center"},children:a.jsxs("div",{style:{fontSize:`${1.2*p}rem`,fontWeight:700,color:"#a0aec0",fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif'},children:["Turn ",g.turnCount]})}),a.jsxs("div",{style:{textAlign:"center"},children:[a.jsxs("div",{style:{fontSize:`${1.8*p}rem`,fontWeight:900,color:"#f6e05e",fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif'},children:[Oe.pp,"/",Oe.maxPp]}),a.jsx("div",{style:{display:"flex",gap:4*p,justifyContent:"center"},children:Array(Math.min(10,Oe.maxPp)).fill(0).map((m,_)=>a.jsx("div",{style:{width:10*p,height:10*p,borderRadius:"50%",background:_<Oe.pp?"#f6e05e":"#2d3748"}},_))})]}),a.jsxs("div",{style:{position:"relative",width:160*p,height:160*p},children:[a.jsx(ML,{isMyTurn:g.activePlayerId===L,turnCount:g.turnCount,activePlayerId:g.activePlayerId,onTimeUp:TI,timerEnabled:h,isGameOver:!!g.winnerId,isPaused:U,scale:p,buttonSize:160,timerDuration:60}),a.jsxs("button",{ref:am,disabled:g.activePlayerId!==L||eo,onMouseDown:m=>{m.stopPropagation(),g.activePlayerId===L&&!eo&&Rf(!0)},onMouseUp:m=>{var _;if(m.stopPropagation(),Ec&&g.activePlayerId===L&&!eo){Rf(!1),_t("sisiodosi.mp3",.6);const E=(_=m.target.closest("button"))==null?void 0:_.getBoundingClientRect();E&&km(E.left+E.width/2,E.top+E.height/2),Pf()}},onMouseLeave:()=>{Rf(!1)},style:{width:160*p,height:160*p,borderRadius:"50%",border:"4px solid rgba(255,255,255,0.2)",background:eo?"linear-gradient(135deg, #805ad5, #6b46c1)":Ec?"linear-gradient(135deg, #5a9bd5, #4a7fb0)":g.activePlayerId===L?"linear-gradient(135deg, #3182ce, #2b6cb0)":"#2d3748",color:"white",fontWeight:900,fontSize:`${2*p}rem`,fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif',boxShadow:g.activePlayerId===L?Ec?"0 0 20px rgba(66, 153, 225, 0.5)":"0 0 40px rgba(66, 153, 225, 0.8)":"none",opacity:Ec?.8:1,cursor:g.activePlayerId===L&&!eo?"pointer":"default",transition:"all 0.1s",position:"relative",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",lineHeight:1.2},children:[a.jsx("img",{src:Ze("/assets/tenfubu_mark.png"),alt:"",style:{position:"absolute",width:"80%",height:"80%",objectFit:"contain",opacity:.25,pointerEvents:"none"}}),eo?a.jsx("span",{style:{position:"relative",zIndex:1,whiteSpace:"nowrap"},children:"..."}):a.jsxs(a.Fragment,{children:[a.jsx("span",{style:{position:"relative",zIndex:1,whiteSpace:"nowrap"},children:""}),a.jsx("span",{style:{position:"relative",zIndex:1,whiteSpace:"nowrap"},children:""})]})]})]}),a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("div",{style:{fontSize:`${2.4*p}rem`,fontWeight:900,color:"#f6e05e",fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif'},children:oe.extraPpActive?a.jsxs("span",{children:[Math.max(0,oe.pp-1),"/",oe.maxPp," ",a.jsx("span",{style:{color:"#ed8936"},children:"+1"})]}):a.jsxs("span",{children:[oe.pp,"/",oe.maxPp]})}),a.jsx("div",{style:{display:"flex",gap:3*p,justifyContent:"center"},children:Array(10).fill(0).map((m,_)=>{const E=_<oe.pp,P=_<oe.maxPp;let M;return E?M="#f6e05e":P?M="#744210":M="#2d3748",a.jsx("div",{style:{width:11*p,height:11*p,borderRadius:"50%",background:M}},_)})})]}),(()=>{const m=L!==g.firstPlayerId,_=g.activePlayerId===L,E=g.turnCount,P=E<=5&&!oe.extraPpUsedEarly,M=E>=6&&!oe.extraPpUsedLate,Y=m&&_&&!oe.extraPpActive&&(P||M),ee=oe.extraPpActive;if(!m)return null;const $=E<=5&&oe.extraPpUsedEarly||E>=6&&oe.extraPpUsedLate,B=!Y&&!ee;return a.jsxs("button",{disabled:B,onClick:K=>{K.stopPropagation(),B||ps({type:"TOGGLE_EXTRA_PP",playerId:L})},style:{width:160*p,height:45*p,borderRadius:12*p,border:ee?"3px solid #ed8936":"3px solid rgba(255,255,255,0.2)",background:ee?"linear-gradient(135deg, #ed8936, #dd6b20)":Y?"linear-gradient(135deg, #744210, #5a3510)":"#2d3748",color:ee?"white":Y?"#f6e05e":"#718096",fontWeight:700,fontSize:"1rem",boxShadow:ee?"0 0 20px rgba(237, 137, 54, 0.6)":"none",cursor:B?"default":"pointer",transition:"all 0.3s",display:"flex",alignItems:"center",justifyContent:"center",gap:6*p,opacity:$&&!ee?.5:1},children:[a.jsx("span",{children:"PP"}),a.jsx("span",{style:{fontSize:"1.3rem"},children:"+1"}),ee&&a.jsx("span",{style:{fontSize:"0.8rem"},children:"ON"}),$&&!ee&&a.jsx("span",{style:{fontSize:"0.7rem",marginLeft:2},children:""})]})})()]}),W?a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:m=>{m.stopPropagation(),mf(!0)},style:{position:"absolute",left:15*p,top:120*p,width:64*p,height:64*p,minWidth:64*p,maxWidth:64*p,minHeight:64*p,maxHeight:64*p,borderRadius:"50%",background:"linear-gradient(135deg, #4a5568 0%, #2d3748 100%)",border:"3px solid #63b3ed",color:"#63b3ed",fontSize:`${1.8*p}rem`,fontWeight:"bold",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,padding:0,zIndex:16,boxShadow:"0 2px 8px rgba(0,0,0,0.4)",transition:"all 0.2s ease"},onMouseEnter:m=>{m.currentTarget.style.transform="scale(1.1)",m.currentTarget.style.boxShadow="0 0 15px rgba(99, 179, 237, 0.5)"},onMouseLeave:m=>{m.currentTarget.style.transform="scale(1)",m.currentTarget.style.boxShadow="0 2px 8px rgba(0,0,0,0.4)"},children:"?"}),a.jsx(qL,{logs:g.logs||[],onCardNameClick:hf,scale:p,isMobile:W})]}):a.jsxs("div",{style:{position:"absolute",left:15,top:"50%",transform:"translateY(-50%)",display:"flex",flexDirection:"column",alignItems:"flex-start",gap:8,zIndex:16,pointerEvents:"none"},children:[a.jsx("button",{onClick:m=>{m.stopPropagation(),mf(!0)},style:{width:36,height:36,borderRadius:"50%",background:"linear-gradient(135deg, #4a5568 0%, #2d3748 100%)",border:"2px solid #63b3ed",color:"#63b3ed",fontSize:"1.2rem",fontWeight:"bold",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",padding:0,boxShadow:"0 4px 12px rgba(0,0,0,0.4)",transition:"all 0.2s ease",pointerEvents:"auto"},onMouseEnter:m=>{m.currentTarget.style.transform="scale(1.1)",m.currentTarget.style.boxShadow="0 0 15px rgba(99, 179, 237, 0.5)"},onMouseLeave:m=>{m.currentTarget.style.transform="scale(1)",m.currentTarget.style.boxShadow="0 4px 12px rgba(0,0,0,0.4)"},children:"?"}),a.jsxs("div",{style:{width:Math.max(180,220*p),height:Math.max(200,280*p),overflowY:"auto",background:"linear-gradient(to right, rgba(0,0,0,0.8), rgba(0,0,0,0.0))",color:"#fff",fontSize:`${Math.max(.65,.75*p)}rem`,padding:`${8*p}px ${8*p}px ${8*p}px ${12*p}px`,borderLeft:"3px solid #63b3ed",pointerEvents:"auto",scrollbarWidth:"thin"},onMouseDown:m=>m.stopPropagation(),onClick:m=>m.stopPropagation(),ref:m=>{m&&(m.scrollTop=m.scrollHeight)},children:[a.jsx("div",{style:{fontWeight:"bold",marginBottom:4*p,color:"#a0aec0",borderBottom:"1px solid rgba(255,255,255,0.1)",paddingBottom:2,fontSize:`${Math.max(.55,.65*p)}rem`,textTransform:"uppercase",letterSpacing:1},children:"BATTLE LOG"}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:3*p},children:(g.logs||[]).map((m,_)=>a.jsx("div",{style:{opacity:.9,lineHeight:"1.4",textShadow:"0 1px 2px black",animation:"fadeIn 0.3s ease-out"},children:m},_))})]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,pointerEvents:"none"},children:[a.jsxs("div",{style:{position:"relative",width:32,height:40},children:[a.jsx("div",{style:{position:"absolute",inset:0,background:"#4a5568",borderRadius:4,border:"1px solid #718096",transform:"rotate(-15deg) translate(-5px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#2d3748",borderRadius:4,border:"1px solid #718096",transform:"rotate(-5deg) translate(-2px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#1a202c",borderRadius:4,border:"1px solid #cbd5e0",transform:"rotate(5deg)"}})]}),a.jsxs("div",{style:{background:"rgba(0,0,0,0.7)",padding:"4px 12px",borderRadius:8,color:"#e2e8f0",fontSize:"0.9rem",fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5)"},children:[" ",oe.hand.length]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,marginLeft:6},children:[a.jsx("div",{style:{fontSize:"1.2rem",filter:"drop-shadow(0 0 3px rgba(128, 90, 213, 0.8))"},children:""}),a.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(128, 90, 213, 0.8), rgba(76, 29, 149, 0.9))",padding:"4px 12px",borderRadius:8,color:"#e2e8f0",fontSize:"0.9rem",fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5), inset 0 1px rgba(255,255,255,0.1)",border:"1px solid rgba(167, 139, 250, 0.5)",position:"relative"},children:[" ",oe.graveyard.length,of.filter(m=>m.playerId===L).map(m=>a.jsxs("div",{style:{position:"absolute",top:-30,left:"50%",transform:"translateX(-50%)",color:"#d946ef",fontSize:"1.5rem",fontWeight:"bold",textShadow:"0 0 10px #d946ef, 0 0 20px #a855f7, 0 0 30px #7c3aed",animation:"necromanceFloat 1.5s ease-out forwards",pointerEvents:"none",whiteSpace:"nowrap"},children:["-",m.amount]},m.key))]})]})]}),$e&&$e.owner==="PLAYER"&&$e.source==="HAND"&&Gr&&(()=>{const E=((W?Math.max(140,180*p):Math.max(180,220*p))-6)/2,P=oe.pp>=$e.card.cost;return a.jsxs("button",{disabled:!P,onClick:M=>{M.stopPropagation(),Cm()},className:P?"play-button-active":"",style:{width:E,background:P?"linear-gradient(to bottom, #48bb78, #38a169)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:"8px 4px",borderRadius:12,fontSize:"0.85rem",fontWeight:"bold",cursor:P?"pointer":"not-allowed",boxShadow:P?"0 0 15px rgba(72, 187, 120, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease",pointerEvents:"auto"},onMouseDown:M=>M.stopPropagation(),children:["",a.jsxs("div",{style:{fontSize:"0.6rem",opacity:.8,marginTop:2},children:["pp ",$e.card.cost]})]})})(),$e&&$e.owner==="PLAYER"&&$e.source==="BOARD"&&(()=>{const m=W?Math.max(140,180*p):Math.max(180,220*p),_=6,E=(m-_)/2,P=$e.card,M=P==null?void 0:P.hasEvolved,Y=!M&&ms,ee=!M&&ys,$=P==null?void 0:P.instanceId,B=oe.board.findIndex(te=>te&&te.instanceId===$),K=oe.board.slice(0,B+1).filter(te=>te).length-1,le=te=>{B<0||xc(K>=0?K:B,te,void 0,$)};return a.jsxs("div",{style:{display:"flex",gap:_,pointerEvents:"auto"},onMouseDown:te=>te.stopPropagation(),children:[a.jsxs("button",{disabled:!Y,onClick:te=>{te.stopPropagation(),le(!1)},style:{width:E,background:Y?"linear-gradient(to bottom, #faf089, #d69e2e)":"#718096",color:Y?"#1a202c":"white",border:"2px solid rgba(255,255,255,0.2)",padding:"8px 4px",borderRadius:12,fontSize:"0.85rem",fontWeight:"bold",cursor:Y?"pointer":"not-allowed",boxShadow:Y?"0 0 15px rgba(250, 240, 137, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:Y?"0 1px 1px rgba(255,255,255,0.3)":"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",a.jsx("div",{style:{fontSize:"0.6rem",opacity:.8,marginTop:2},children:"EP"})]}),a.jsxs("button",{disabled:!ee,onClick:te=>{te.stopPropagation(),le(!0)},style:{width:E,background:ee?"linear-gradient(to bottom, #b794f4, #805ad5)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:"8px 4px",borderRadius:12,fontSize:"0.85rem",fontWeight:"bold",cursor:ee?"pointer":"not-allowed",boxShadow:ee?"0 0 15px rgba(183, 148, 244, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",a.jsx("div",{style:{fontSize:"0.6rem",opacity:.8,marginTop:2},children:"SEP"})]})]})})(),!($e&&$e.owner==="PLAYER"&&($e.source==="HAND"||$e.source==="BOARD"))&&(()=>{const m=W?Math.max(140,180*p):Math.max(180,220*p);return a.jsx("div",{style:{width:m,height:52,visibility:"hidden",pointerEvents:"none"}})})()]}),(ft==="TOSSING"||ft==="RESULT")&&a.jsxs("div",{style:{position:"absolute",inset:0,zIndex:4e3,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.85)",pointerEvents:"none"},children:[a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("div",{style:{width:120*p,height:120*p,margin:`0 auto ${30*p}px`,borderRadius:"50%",background:ft==="RESULT"?zt==="FIRST"?"linear-gradient(135deg, #ffd700, #ff8c00)":"linear-gradient(135deg, #c0c0c0, #808080)":"linear-gradient(135deg, #ffd700, #ff8c00)",boxShadow:ft==="RESULT"?`0 0 ${40*p}px ${zt==="FIRST"?"#ffd700":"#c0c0c0"}, 0 0 ${80*p}px ${zt==="FIRST"?"rgba(255,215,0,0.5)":"rgba(192,192,192,0.5)"}`:`0 0 ${30*p}px #ffd700`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"3rem",fontWeight:900,color:"#1a202c",textShadow:"0 2px 2px rgba(0,0,0,0.5)",animation:ft==="TOSSING"?"coinFlip 0.3s ease-in-out infinite":"coinLand 0.5s ease-out",border:"4px solid rgba(255,255,255,0.3)"},children:ft==="RESULT"?zt==="FIRST"?"":"":"?"}),a.jsxs("div",{style:{fontSize:ft==="RESULT"?"2.5rem":"1.8rem",fontWeight:900,color:zt==="FIRST"?"#ffd700":zt==="SECOND"?"#c0c0c0":"white",textShadow:"0 0 20px currentColor, 0 2px 4px black",animation:ft==="RESULT"?"textPop 0.5s ease-out":"none"},children:[ft==="TOSSING"&&"...",ft==="RESULT"&&(zt==="FIRST"?"":"")]}),ft==="RESULT"&&a.jsx("div",{style:{fontSize:"1rem",color:"#a0aec0",marginTop:10*p,animation:"fadeIn 0.5s ease-out 0.3s both"},children:zt==="FIRST"?"":""})]}),a.jsx("style",{children:`
                            @keyframes coinFlip {
                                0%, 100% { transform: rotateY(0deg) scale(1); }
                                50% { transform: rotateY(180deg) scale(1.1); }
                            }
                            @keyframes coinLand {
                                0% { transform: rotateY(720deg) scale(0.5); }
                                70% { transform: rotateY(0deg) scale(1.2); }
                                100% { transform: rotateY(0deg) scale(1); }
                            }
                            @keyframes textPop {
                                0% { transform: scale(0.5); opacity: 0; }
                                70% { transform: scale(1.2); }
                                100% { transform: scale(1); opacity: 1; }
                            }
                        `})]}),ia&&a.jsxs("div",{style:{position:"absolute",inset:0,zIndex:3e3,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.7)",pointerEvents:"none",animation:"fadeIn 0.2s ease-out"},children:[a.jsx("div",{style:{fontSize:`${3.5*p}rem`,fontWeight:900,fontFamily:"Tamanegi, sans-serif",background:"linear-gradient(135deg, #ffd700, #ff6b6b, #ffd700)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",textShadow:"none",filter:`drop-shadow(0 0 ${15*p}px rgba(255,215,0,0.8)) drop-shadow(0 0 ${30*p}px rgba(255,107,107,0.5))`,animation:"gameStartPop 0.8s ease-out",letterSpacing:"0.2em"},children:" "}),a.jsx("style",{children:`
                            @keyframes gameStartPop {
                                0% { transform: scale(0.3) rotate(-10deg); opacity: 0; }
                                50% { transform: scale(1.2) rotate(5deg); opacity: 1; }
                                70% { transform: scale(0.95) rotate(-2deg); }
                                100% { transform: scale(1) rotate(0deg); opacity: 1; }
                            }
                        `})]}),a.jsxs("div",{ref:ci,style:{position:"absolute",bottom:-20*p,left:"50%",transform:"translateX(-50%)",width:so*p,height:so*p,borderRadius:"50%",zIndex:200},children:[a.jsxs("div",{onMouseDown:bI,style:{width:"100%",height:"100%",borderRadius:"50%",overflow:"hidden",border:Nf?"4px solid #67e8f9":"4px solid #3182ce",boxShadow:Nf?"0 0 20px rgba(103, 232, 249, 0.4), 0 0 40px rgba(103, 232, 249, 0.2)":"0 0 20px rgba(49, 130, 206, 0.4)",background:"#1a202c",cursor:"grab",transition:"border-color 0.3s, box-shadow 0.3s, filter 0.5s, opacity 0.5s",animation:Lm?"leaderDamageCapPulse 2s ease-in-out infinite":"none",position:"relative",...g.winnerId&&g.winnerId!==L&&(Me||ct)?{filter:Me==="white-fade"?"brightness(2) saturate(0.3)":Me==="explode"||Me==="result-text"||Me==="fade-out"||ct?"brightness(3) saturate(0) blur(10px)":"none",opacity:Me==="explode"||Me==="result-text"||Me==="fade-out"||ct?0:1}:{}},children:[a.jsx("img",{src:sl(oe.class),style:oe.class==="AJA"?{width:"100%",height:"100%",objectFit:"cover",objectPosition:"center top",pointerEvents:"none"}:{width:"100%",height:"100%",objectFit:"cover",pointerEvents:"none"}}),Lm&&a.jsx("div",{style:{position:"absolute",inset:0,borderRadius:"50%",background:"radial-gradient(circle, rgba(103, 232, 249, 0.5) 0%, rgba(103, 232, 249, 0.2) 70%, rgba(103, 232, 249, 0.1) 100%)",pointerEvents:"none",animation:"leaderDamageCapOverlay 2s ease-in-out infinite",zIndex:1}})]}),a.jsx("div",{style:{position:"absolute",top:0,left:"50%",transform:`translateX(-50%) translateX(${-140*p}px)`,width:55*p,height:55*p,background:"radial-gradient(circle at 30% 30%, #feb2b2, #c53030)",borderRadius:"50%",border:`${Math.max(2,3*p)}px solid #fff`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${1.2*p}rem`,fontWeight:900,color:"white",textShadow:"0 2px 2px rgba(0,0,0,0.5)",boxShadow:"0 4px 6px rgba(0,0,0,0.4)",zIndex:10,opacity:ne?1:0,transition:"opacity 0.3s ease-in"},children:oe.hp}),a.jsx("div",{onMouseDown:m=>bc(m,!1),onTouchStart:m=>bc(m,!1),style:{position:"absolute",top:10*p,left:"50%",transform:`translateX(-50%) translateX(${-80*p}px)`,width:45*p,height:45*p,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:ms?"rgba(255,235,100,0.2)":"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",cursor:ms?"grab":"default",zIndex:10,opacity:ne?Sc?1:.5:0,filter:Sc?"none":"grayscale(0.8)",transition:"opacity 0.3s ease-in, filter 0.3s, background 0.3s",boxShadow:ms?"0 0 12px #ffd700, 0 0 25px rgba(255,215,0,0.5)":"none",animation:ms?"epPulse 1.5s ease-in-out infinite":"none"},children:a.jsx("div",{style:{display:"flex",gap:3*p},children:Array(2).fill(0).map((m,_)=>{const E=_<Rm;let P="none";return E&&Sc&&(P=ms?"0 0 10px #fff59d, 0 0 20px #ffd700, 0 0 30px #ecc94b":"0 0 8px #ecc94b, 0 0 15px #ecc94b"),a.jsx("div",{style:{width:12*p,height:12*p,borderRadius:"50%",background:E?ms?"#fff59d":"#ecc94b":"#2d3748",boxShadow:P,border:"2px solid rgba(0,0,0,0.5)",transition:"box-shadow 0.3s, background 0.3s"}},_)})})}),a.jsx("div",{onMouseDown:m=>bc(m,!0),onTouchStart:m=>bc(m,!0),style:{position:"absolute",top:10*p,left:"50%",transform:`translateX(-50%) translateX(${80*p}px)`,width:45*p,height:45*p,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:ys?"rgba(200,160,255,0.2)":"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,cursor:ys?"grab":"default",opacity:ne?Ic?1:.5:0,filter:Ic?"none":"grayscale(0.8)",transition:"opacity 0.3s ease-in, filter 0.3s, background 0.3s",boxShadow:ys?"0 0 12px #b794f4, 0 0 25px rgba(159,122,234,0.5)":"none",animation:ys?"sepPulse 1.5s ease-in-out infinite":"none"},children:a.jsx("div",{style:{display:"flex",gap:3*p},children:Array(2).fill(0).map((m,_)=>{const E=_<oe.sep;let P="none";return E&&Ic&&(P=ys?"0 0 10px #d6bcfa, 0 0 20px #b794f4, 0 0 30px #9f7aea":"0 0 8px #9f7aea, 0 0 15px #9f7aea"),a.jsx("div",{style:{width:12*p,height:12*p,borderRadius:"50%",background:E?ys?"#d6bcfa":"#9f7aea":"#2d3748",boxShadow:P,border:"2px solid rgba(0,0,0,0.5)",transition:"box-shadow 0.3s, background 0.3s"}},_)})})})]}),a.jsxs("div",{style:{position:"absolute",bottom:10*p,right:15*p,width:60*p,height:85*p,zIndex:50},children:[[...Array(Math.min(5,Math.ceil(oe.deck.length/5)))].map((m,_)=>a.jsx("div",{style:{position:"absolute",inset:0,transform:`translate(${_*2*p}px, ${-_*2*p}px)`,borderRadius:6,border:"1px solid #718096",boxShadow:"1px 1px 3px rgba(0,0,0,0.5)",overflow:"hidden"},children:a.jsx("img",{src:di((oe==null?void 0:oe.class)||"SENKA"),alt:"Deck",style:{width:"100%",height:"100%",objectFit:"cover"},onError:E=>{E.target.style.display="none",E.target.parentElement.style.background="linear-gradient(45deg, #2d3748, #1a202c)"}})},_)),a.jsx("div",{style:{position:"absolute",top:-20*p,width:"100%",textAlign:"center",color:"#a0aec0",fontSize:"0.9rem",fontWeight:"bold",textShadow:"0 1px 2px black"},children:oe.deck.length})]}),a.jsx("div",{style:{position:"absolute",bottom:0,left:0,width:"100%",height:200*p,display:"flex",justifyContent:"center",alignItems:"flex-end",pointerEvents:"none",zIndex:500},children:oe.hand.map((m,_)=>{if(Ye!==null&&Ye.sourceIndex===_)return null;const P=oe.hand.length;let M=0,Y=0,ee=0;if(Gr){const B=100*p,K=window.innerWidth-40*p,le=(P-1)*B+cn*p;let te=B;le>K&&(te=(K-cn*p)/Math.max(1,P-1)),M=(_-(P-1)/2)*te,Y=ve===_?-8*p:0,ee=0}else{const B=45*p,K=160*p,le=cn*p/2,te=window.innerWidth/2-K-le,he=window.innerWidth-340*p-K,_e=(P-1)*B+cn*p;let Ke=B;_e>he&&(Ke=(he-cn*p)/Math.max(1,P-1)),M=te-(P-1-_)*Ke,Y=0,ee=(_-(P-1)/2)*3}const $=oe.pp>=m.cost&&g.activePlayerId===L;return a.jsx("div",{onMouseDown:B=>{Em(B,_),Gr&&Ne(_===ve?null:_)},onTouchStart:B=>{Em(B,_),Gr&&Ne(_===ve?null:_)},style:{position:"absolute",left:"50%",bottom:5*p,transform:`translateX(calc(-50% + ${M}px)) translateY(${Y}px) rotate(${ee}deg) ${(Z==null?void 0:Z.sourceType)==="HAND"&&Z.sourceIndex===_?"scale(1.05) translateY(-10px)":Gr?"translateY(-3px)":""}`,transition:uI===_?"all 0.3s ease-in":(Z==null?void 0:Z.sourceType)==="HAND"&&Z.sourceIndex===_?"none":"all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1)",zIndex:(Z==null?void 0:Z.sourceType)==="HAND"&&Z.sourceIndex===_?1e3:_+100,width:(W?80:cn)*p,height:(W?115:Sn)*p,pointerEvents:"auto",cursor:$?"grab":"not-allowed"},onClick:B=>B.stopPropagation(),children:a.jsx(ro,{card:m,turnCount:g.turnCount,isMyTurn:g.activePlayerId===L,isPlayable:$,scale:p,variant:W?"mobile-hand":"normal",style:{width:W?80*p:cn*p,height:W?115*p:Sn*p,boxShadow:(Z==null?void 0:Z.sourceType)==="HAND"&&Z.sourceIndex===_?"0 0 40px rgba(49, 130, 206, 0.8)":$?"0 0 15px rgba(40, 180, 100, 0.6)":"none"}})},m.instanceId)})}),W&&a.jsxs("div",{style:{position:"absolute",bottom:200*p,left:15*p,display:"flex",alignItems:"center",gap:10*p,zIndex:601,pointerEvents:"none"},children:[a.jsxs("div",{style:{position:"relative",width:50*p,height:62*p},children:[a.jsx("div",{style:{position:"absolute",inset:0,background:"#4a5568",borderRadius:6*p,border:"1px solid #718096",transform:"rotate(-15deg) translate(-5px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#2d3748",borderRadius:6*p,border:"1px solid #718096",transform:"rotate(-5deg) translate(-2px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#1a202c",borderRadius:6*p,border:"1px solid #cbd5e0",transform:"rotate(5deg)"}})]}),a.jsxs("div",{style:{background:"rgba(0,0,0,0.7)",padding:`${6*p}px ${16*p}px`,borderRadius:10*p,color:"#e2e8f0",fontSize:`${1.32*p}rem`,fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5)"},children:[" ",oe.hand.length]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6*p,marginLeft:10*p},children:[a.jsx("div",{style:{fontSize:`${1.87*p}rem`,filter:"drop-shadow(0 0 3px rgba(128, 90, 213, 0.8))"},children:""}),a.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(128, 90, 213, 0.8), rgba(76, 29, 149, 0.9))",padding:`${6*p}px ${16*p}px`,borderRadius:10*p,color:"#e2e8f0",fontSize:`${1.32*p}rem`,fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5), inset 0 1px rgba(255,255,255,0.1)",border:"1px solid rgba(167, 139, 250, 0.5)",position:"relative"},children:[" ",oe.graveyard.length,of.filter(m=>m.playerId===L).map(m=>a.jsxs("div",{style:{position:"absolute",top:-30,left:"50%",transform:"translateX(-50%)",color:"#d946ef",fontSize:"1.5rem",fontWeight:"bold",textShadow:"0 0 10px #d946ef, 0 0 20px #a855f7, 0 0 30px #7c3aed",animation:"necromanceFloat 1.5s ease-out forwards",pointerEvents:"none",whiteSpace:"nowrap"},children:["-",m.amount]},m.key))]})]})]}),W&&$e&&$e.owner==="PLAYER"&&$e.source==="HAND"&&Gr&&(()=>{const m=Math.max(140,180*p),_=4*p,E=(m-_)/2,P=oe.pp>=$e.card.cost;return a.jsxs("div",{style:{position:"absolute",left:15*p,bottom:135*p,zIndex:600,pointerEvents:"auto"},children:[a.jsxs("button",{disabled:!P,onClick:M=>{M.stopPropagation(),Cm()},className:P?"play-button-active":"",style:{width:E,background:P?"linear-gradient(to bottom, #48bb78, #38a169)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:`${5*p}px ${3*p}px`,borderRadius:10*p,fontSize:`${.7*p}rem`,fontWeight:"bold",cursor:P?"pointer":"not-allowed",boxShadow:P?"0 0 12px rgba(72, 187, 120, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},onMouseDown:M=>M.stopPropagation(),children:["",a.jsxs("div",{style:{fontSize:`${.5*p}rem`,opacity:.8,marginTop:1},children:["pp ",$e.card.cost]})]}),a.jsx("style",{children:`
                                @keyframes playGlowPulse {
                                    0% { box-shadow: 0 0 10px rgba(72, 187, 120, 0.4); }
                                    50% { box-shadow: 0 0 25px rgba(72, 187, 120, 0.8); }
                                    100% { box-shadow: 0 0 10px rgba(72, 187, 120, 0.4); }
                                }
                                .play-button-active {
                                    animation: playGlowPulse 2s infinite ease-in-out;
                                }
                            `})]})})(),W&&$e&&$e.owner==="PLAYER"&&$e.source==="BOARD"&&(()=>{const m=Math.max(140,180*p),_=4*p,E=(m-_)/2,P=$e.card,M=P==null?void 0:P.hasEvolved,Y=!M&&ms,ee=!M&&ys,$=P==null?void 0:P.instanceId,B=oe.board.findIndex(te=>te&&te.instanceId===$),K=oe.board.slice(0,B+1).filter(te=>te).length-1,le=te=>{B<0||xc(K>=0?K:B,te,void 0,$)};return a.jsxs("div",{style:{position:"absolute",left:15*p,bottom:135*p,zIndex:600,pointerEvents:"auto",display:"flex",gap:_},onMouseDown:te=>te.stopPropagation(),children:[a.jsxs("button",{disabled:!Y,onClick:te=>{te.stopPropagation(),le(!1)},style:{width:E,background:Y?"linear-gradient(to bottom, #faf089, #d69e2e)":"#718096",color:Y?"#1a202c":"white",border:"2px solid rgba(255,255,255,0.2)",padding:`${5*p}px ${3*p}px`,borderRadius:10*p,fontSize:`${.7*p}rem`,fontWeight:"bold",cursor:Y?"pointer":"not-allowed",boxShadow:Y?"0 0 12px rgba(250, 240, 137, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:Y?"0 1px 1px rgba(255,255,255,0.3)":"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",a.jsx("div",{style:{fontSize:`${.5*p}rem`,opacity:.8,marginTop:1},children:"EP"})]}),a.jsxs("button",{disabled:!ee,onClick:te=>{te.stopPropagation(),le(!0)},style:{width:E,background:ee?"linear-gradient(to bottom, #b794f4, #805ad5)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:`${5*p}px ${3*p}px`,borderRadius:10*p,fontSize:`${.7*p}rem`,fontWeight:"bold",cursor:ee?"pointer":"not-allowed",boxShadow:ee?"0 0 12px rgba(183, 148, 244, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",a.jsx("div",{style:{fontSize:`${.5*p}rem`,opacity:.8,marginTop:1},children:"SEP"})]})]})})(),fs&&Array.from({length:fs.count},(m,_)=>{const ee=-(fs.count*80+(fs.count-1)*20-80)/2+_*100,$=fs.isPlayer?di((oe==null?void 0:oe.class)||"SENKA"):di((Oe==null?void 0:Oe.class)||"SENKA");return a.jsx("div",{style:{position:"absolute",left:fs.isPlayer?"calc(100% - 90px)":90,top:fs.isPlayer?"calc(100% - 105px)":105,width:80,height:110,borderRadius:8,border:"2px solid white",overflow:"hidden",transform:`translateX(${ee}px)`,animation:`drawCard${fs.isPlayer?"Player":"Opponent"} ${pf}ms cubic-bezier(0.2, 0.8, 0.2, 1) forwards`,zIndex:9e3+_,boxShadow:"0 0 10px rgba(255,255,255,0.5)"},children:a.jsx("img",{src:$,alt:"Card Back",style:{width:"100%",height:"100%",objectFit:"cover"},onError:B=>{B.target.style.display="none",B.target.parentElement.style.background="repeating-linear-gradient(45deg, #2d3748, #2d3748 10px, #1a202c 10px, #1a202c 20px)"}})},_)}),a.jsx("style",{children:`
                        @keyframes drawCardPlayer {
                            0% { opacity: 1; }
                            100% { transform: translate(-50vw, -100px) scale(0.5) rotate(-10deg); opacity: 0; }
                        }
                        @keyframes drawCardOpponent {
                            0% { opacity: 1; }
                            100% { transform: translate(50vw, 200px) scale(0.5) rotate(10deg); opacity: 0; }
                        }
                    `})]}),vI.map(m=>a.jsx(XL,{value:m.value,x:m.x,y:m.y,color:m.color,scale:p,onComplete:()=>mc(_=>_.filter(E=>E.id!==m.id))},m.id)),af&&Br.current&&(()=>{const m=Br.current.x,_=Br.current.y,E=200,P=320,Y=180/8,ee=($,B,K,le)=>{const te=$*Math.PI/180,he=B*Math.PI/180,_e=Math.cos(te)*le,Ke=-Math.sin(te)*le,Ee=Math.cos(he)*le,Ge=-Math.sin(he)*le,Je=Math.cos(he)*K,He=-Math.sin(he)*K,We=Math.cos(te)*K,pe=-Math.sin(te)*K;return`M ${_e} ${Ke} A ${le} ${le} 0 0 0 ${Ee} ${Ge} L ${Je} ${He} A ${K} ${K} 0 0 1 ${We} ${pe} Z`};return a.jsxs("div",{style:{position:"fixed",left:m,top:_,zIndex:2e3,pointerEvents:"none",animation:"stampUIFadeIn 0.15s ease-out"},children:[a.jsx("svg",{width:P*2+20,height:P+20,style:{position:"absolute",left:-330,top:-330,overflow:"visible"},children:a.jsx("g",{transform:`translate(${P+10}, ${P+10})`,children:K0.map(($,B)=>{const K=180-B*Y,le=K-Y,te=lf===$.id,_e=(K+le)/2*Math.PI/180,Ke=(E+P)/2,Ee=Math.cos(_e)*Ke,Ge=-Math.sin(_e)*Ke,Je=85;return a.jsxs("g",{children:[a.jsx("path",{d:ee(K,le,E,P),fill:te?"rgba(255, 215, 0, 0.4)":"rgba(0, 0, 0, 0.7)",stroke:te?"#ffd700":"rgba(255, 255, 255, 0.3)",strokeWidth:te?3:1,style:{transition:"all 0.1s ease-out"}}),a.jsx("defs",{children:a.jsx("clipPath",{id:`stampClip-${$.id}`,children:a.jsx("circle",{cx:Ee,cy:Ge,r:Je/2})})}),a.jsx("image",{href:Ze(I_($.id,Tr)),x:Ee-Je/2,y:Ge-Je/2,width:Je,height:Je,clipPath:`url(#stampClip-${$.id})`,style:{transform:te?"scale(1.15)":"scale(1)",transformOrigin:`${Ee}px ${Ge}px`,transition:"transform 0.1s ease-out"}}),a.jsx("circle",{cx:Ee,cy:Ge,r:Je/2,fill:"none",stroke:te?"#ffd700":"rgba(255, 255, 255, 0.5)",strokeWidth:te?2:1})]},$.id)})})}),a.jsx("style",{children:`
                                @keyframes stampUIFadeIn {
                                    from { opacity: 0; transform: scale(0.8); }
                                    to { opacity: 1; transform: scale(1); }
                                }
                            `})]})})(),la&&a.jsxs("div",{style:{position:"fixed",left:"50%",top:"40%",transform:"translate(-50%, -50%)",zIndex:2500,pointerEvents:"none",animation:"stampDisplay 3s ease-out forwards"},children:[a.jsx("div",{style:{width:250,height:250,borderRadius:20,overflow:"hidden",boxShadow:"0 0 40px rgba(0,0,0,0.5), 0 0 60px rgba(255,255,255,0.2)",border:"4px solid rgba(255,255,255,0.3)"},children:a.jsx("img",{src:Ze(I_(la.stampId,la.playerClass)),alt:"",style:{width:"100%",height:"100%",objectFit:"cover"}})}),la.playerId!==L&&a.jsx("div",{style:{position:"absolute",bottom:-30,left:"50%",transform:"translateX(-50%)",background:"rgba(0,0,0,0.7)",padding:"5px 15px",borderRadius:15,color:"#fff",fontSize:"0.9rem",whiteSpace:"nowrap"},children:""}),a.jsx("style",{children:`
                            @keyframes stampDisplay {
                                0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
                                10% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
                                20% { transform: translate(-50%, -50%) scale(1); }
                                80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                                100% { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
                            }
                        `})]},la.timestamp),a.jsx("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:1e3},children:Z&&(Z.sourceType==="BOARD"||Z.sourceType==="EVOLVE")&&a.jsxs(a.Fragment,{children:[a.jsxs("defs",{children:[a.jsxs("filter",{id:"cyanGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{stdDeviation:"10",result:"blur1"}),a.jsx("feFlood",{floodColor:"rgba(100, 200, 255, 0.7)",result:"color1"}),a.jsx("feComposite",{in:"color1",in2:"blur1",operator:"in",result:"glow1"}),a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"5",result:"blur2"}),a.jsx("feFlood",{floodColor:"rgba(150, 220, 255, 0.5)",result:"color2"}),a.jsx("feComposite",{in:"color2",in2:"blur2",operator:"in",result:"glow2"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"glow1"}),a.jsx("feMergeNode",{in:"glow2"})]})]}),a.jsxs("filter",{id:"yellowGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{stdDeviation:"10",result:"blur1"}),a.jsx("feFlood",{floodColor:"rgba(255, 255, 50, 0.7)",result:"color1"}),a.jsx("feComposite",{in:"color1",in2:"blur1",operator:"in",result:"glow1"}),a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"5",result:"blur2"}),a.jsx("feFlood",{floodColor:"rgba(255, 240, 100, 0.5)",result:"color2"}),a.jsx("feComposite",{in:"color2",in2:"blur2",operator:"in",result:"glow2"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"glow1"}),a.jsx("feMergeNode",{in:"glow2"})]})]}),a.jsxs("filter",{id:"softWhiteGlow",x:"-300%",y:"-300%",width:"700%",height:"700%",children:[a.jsx("feGaussianBlur",{stdDeviation:"20",result:"blur"}),a.jsx("feFlood",{floodColor:"rgba(255, 255, 255, 0.9)",result:"color"}),a.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"glow"}),a.jsx("feMergeNode",{in:"glow"}),a.jsx("feMergeNode",{in:"glow"})]})]}),a.jsxs("filter",{id:"innerCoreGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{stdDeviation:"4",result:"blur"}),a.jsx("feFlood",{floodColor:"rgba(255, 255, 255, 0.8)",result:"color"}),a.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),a.jsx("feMerge",{children:a.jsx("feMergeNode",{in:"glow"})})]}),a.jsxs("filter",{id:"coloredBallGlow",x:"-150%",y:"-150%",width:"400%",height:"400%",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"6",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"blur"})]})]}),a.jsxs("filter",{id:"particleGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"2",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),a.jsxs("filter",{id:"purpleGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{stdDeviation:"10",result:"blur1"}),a.jsx("feFlood",{floodColor:"rgba(183, 148, 244, 0.7)",result:"color1"}),a.jsx("feComposite",{in:"color1",in2:"blur1",operator:"in",result:"glow1"}),a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"5",result:"blur2"}),a.jsx("feFlood",{floodColor:"rgba(200, 170, 255, 0.5)",result:"color2"}),a.jsx("feComposite",{in:"color2",in2:"blur2",operator:"in",result:"glow2"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"glow1"}),a.jsx("feMergeNode",{in:"glow2"})]})]})]}),Z.sourceType==="BOARD"&&a.jsxs(a.Fragment,{children:[a.jsx("path",{d:gs(),fill:"none",stroke:"rgba(100, 200, 255, 0.3)",strokeWidth:"20",strokeLinecap:"butt",filter:"url(#cyanGlow)"}),a.jsx("path",{d:gs(),fill:"none",stroke:"rgba(150, 220, 255, 0.5)",strokeWidth:"10",strokeLinecap:"butt"}),a.jsx("path",{d:gs(),fill:"none",stroke:"rgba(200, 240, 255, 0.9)",strokeWidth:"4",strokeLinecap:"butt"}),a.jsx("path",{d:gs(),fill:"none",stroke:"rgba(255, 255, 255, 1)",strokeWidth:"2",strokeLinecap:"butt"})]}),Z.sourceType==="EVOLVE"&&a.jsxs(a.Fragment,{children:[a.jsx("path",{d:gs(),fill:"none",stroke:Z.useSep?"rgba(159, 122, 234, 0.3)":"rgba(236, 201, 75, 0.3)",strokeWidth:"20",strokeLinecap:"butt",filter:Z.useSep?"url(#purpleGlow)":"url(#yellowGlow)"}),a.jsx("path",{d:gs(),fill:"none",stroke:Z.useSep?"rgba(183, 148, 244, 0.5)":"rgba(246, 224, 94, 0.5)",strokeWidth:"10",strokeLinecap:"butt"}),a.jsx("path",{d:gs(),fill:"none",stroke:Z.useSep?"rgba(214, 188, 250, 0.9)":"rgba(250, 240, 137, 0.9)",strokeWidth:"4",strokeLinecap:"butt"}),a.jsx("path",{d:gs(),fill:"none",stroke:"rgba(255, 255, 255, 1)",strokeWidth:"2",strokeLinecap:"butt"})]}),(Z.sourceType==="BOARD"||Z.sourceType==="EVOLVE")&&a.jsxs(a.Fragment,{children:[a.jsx("circle",{cx:Z.startX,cy:Z.startY,r:"15",fill:"rgba(255, 255, 255, 0.3)",filter:"url(#softWhiteGlow)"}),a.jsx("circle",{cx:Z.startX,cy:Z.startY,r:"8",fill:"rgba(255, 255, 255, 0.4)",filter:"url(#softWhiteGlow)"})]}),(Z.sourceType==="BOARD"||Z.sourceType==="EVOLVE")&&a.jsxs(a.Fragment,{children:[a.jsx("circle",{cx:Z.currentX,cy:Z.currentY,r:"18",fill:"rgba(255, 255, 255, 0.25)",filter:"url(#softWhiteGlow)"}),a.jsx("circle",{cx:Z.currentX,cy:Z.currentY,r:"8",fill:"rgba(255, 255, 255, 0.35)",filter:"url(#softWhiteGlow)"}),a.jsx("circle",{cx:Z.currentX,cy:Z.currentY,r:"3",fill:"rgba(255, 255, 255, 0.7)",filter:"url(#innerCoreGlow)"})]}),cI.map(m=>{const _=Z.sourceType==="EVOLVE"?Z.useSep?`rgba(230, 220, 255, ${m.opacity})`:`rgba(255, 255, 230, ${m.opacity})`:`rgba(220, 245, 255, ${m.opacity})`;return a.jsx("circle",{cx:m.x,cy:m.y,r:m.radius,fill:_,filter:"url(#particleGlow)"},m.id)})]})}),Yt&&a.jsxs("svg",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100dvh",pointerEvents:"none",zIndex:99999},children:[a.jsx("defs",{children:a.jsxs("filter",{id:"endTurnGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{stdDeviation:"6",result:"blur"}),a.jsx("feFlood",{floodColor:"rgba(100, 200, 255, 0.8)",result:"color"}),a.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"glow"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsx("circle",{cx:Yt.x,cy:Yt.y,r:Yt.ringRadius,fill:"none",stroke:`rgba(100, 200, 255, ${Math.max(0,1-Yt.ringRadius/120)*.8})`,strokeWidth:"4",filter:"url(#endTurnGlow)"}),a.jsx("circle",{cx:Yt.x,cy:Yt.y,r:Yt.ringRadius*.8,fill:"none",stroke:`rgba(255, 255, 255, ${Math.max(0,1-Yt.ringRadius/120)*.6})`,strokeWidth:"2"}),a.jsx("circle",{cx:Yt.x,cy:Yt.y,r:20,fill:`rgba(255, 255, 255, ${Math.max(0,1-Yt.ringRadius/120)*.9})`}),Yt.particles.map(m=>a.jsx("circle",{cx:m.x,cy:m.y,r:4,fill:`rgba(255, 255, 255, ${m.opacity*.8})`},m.id))]}),Ye&&a.jsxs("div",{style:{position:"absolute",inset:0,zIndex:9999,pointerEvents:"auto",background:"rgba(0,0,0,0.5)",perspective:"1200px"},children:[a.jsx("style",{children:`
                                @keyframes playCardSequence {
                                    ${Ye.finalX!==void 0?`
                                    /* Phase 1: Start at hand position (0%) */
                                    0% {
                                        transform: translate(${Ye.startX-Ye.targetX}px, ${Ye.startY-Ye.targetY}px) translate(-50%, -50%) scale(1.0) rotateY(0deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Phase 1b: Mid-rotation during move (12.5%) - CRITICAL: explicit 180deg to force rotation direction */
                                    12.5% {
                                        transform: translate(${(Ye.startX-Ye.targetX)*.5}px, ${(Ye.startY-Ye.targetY)*.5}px) translate(-50%, -50%) scale(1.5) rotateY(180deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Phase 2: Arrive at center with rotation complete (25%) */
                                    25% {
                                        transform: translate(-50%, -50%) scale(1.8) rotateY(360deg);
                                        opacity: 1;
                                        animation-timing-function: ease-out;
                                    }
                                    /* Phase 3: Hold at center (25%-80%) */
                                    80% {
                                        transform: translate(-50%, -50%) scale(2.4) rotateY(360deg);
                                        opacity: 1;
                                    }
                                    /* Phase 4: Move to board position (80%-100%) */
                                    100% {
                                        transform: translate(calc(-50% + ${Ye.finalX-Ye.targetX}px), calc(-50% + ${Ye.finalY-Ye.targetY}px)) scale(1.0) rotateY(360deg);
                                        opacity: 1;
                                    }
                                    `:`
                                    /* Spell: Move to center while rotating, then fade */
                                    0% {
                                        transform: translate(${Ye.startX-Ye.targetX}px, ${Ye.startY-Ye.targetY}px) translate(-50%, -50%) scale(1.0) rotateY(0deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Mid-rotation during move (15%) - CRITICAL: explicit 180deg */
                                    15% {
                                        transform: translate(${(Ye.startX-Ye.targetX)*.5}px, ${(Ye.startY-Ye.targetY)*.5}px) translate(-50%, -50%) scale(1.7) rotateY(180deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    30% {
                                        transform: translate(-50%, -50%) scale(2.2) rotateY(360deg);
                                        opacity: 1;
                                        animation-timing-function: ease-out;
                                    }
                                    80% {
                                        transform: translate(-50%, -50%) scale(2.4) rotateY(360deg);
                                        opacity: 1;
                                    }
                                    100% {
                                        transform: translate(-50%, -50%) scale(3.0) rotateY(360deg);
                                        opacity: 0;
                                    }
                                    `}
                                }
                                @keyframes playSpellSequence {
                                    /* Move from hand to center while rotating (0-30%) */
                                    0% {
                                        transform: translate(${Ye.startX-Ye.targetX}px, ${Ye.startY-Ye.targetY}px) translate(-50%, -50%) scale(1.0) rotateY(0deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Mid-rotation during move (15%) - CRITICAL: explicit 180deg to force rotation direction */
                                    15% {
                                        transform: translate(${(Ye.startX-Ye.targetX)*.5}px, ${(Ye.startY-Ye.targetY)*.5}px) translate(-50%, -50%) scale(1.7) rotateY(180deg);
                                        opacity: 1;
                                        filter: brightness(1);
                                        animation-timing-function: linear;
                                    }
                                    /* Arrive at center with rotation complete (30%) */
                                    30% {
                                        transform: translate(-50%, -50%) scale(2.2) rotateY(360deg);
                                        opacity: 1;
                                        filter: brightness(1);
                                        animation-timing-function: ease-out;
                                    }
                                    /* Hold at center (30%-75%) */
                                    75% {
                                        transform: translate(-50%, -50%) scale(2.4) rotateY(360deg);
                                        opacity: 1;
                                        filter: brightness(1.2);
                                    }
                                    /* Fade out (75%-100%) */
                                    100% {
                                        transform: translate(-50%, -50%) scale(3.0) rotateY(360deg);
                                        opacity: 0;
                                        filter: brightness(3);
                                    }
                                }
                                .play-card-flipper {
                                    transform-style: preserve-3d !important;
                                }
                                .play-card-front, .play-card-back {
                                    backface-visibility: hidden !important;
                                    -webkit-backface-visibility: hidden !important;
                                    position: absolute;
                                    width: 100%;
                                    height: 100%;
                                }
                                .play-card-back {
                                    transform: rotateY(180deg) translateZ(1px);
                                }
                            `}),a.jsxs("div",{className:"play-card-flipper",onAnimationEnd:Ye.onComplete,style:{position:"absolute",left:Ye.targetX,top:Ye.targetY,width:cn*p,height:Sn*p,transformStyle:"preserve-3d",animation:Ye.card.type==="SPELL"?"playSpellSequence 1s forwards":"playCardSequence 0.8s forwards"},children:[a.jsx("div",{className:"play-card-front",children:a.jsx(ro,{card:Ye.card,isOnBoard:!0,suppressPassives:!0,scale:p,style:{width:cn*p,height:Sn*p,boxShadow:"0 0 50px rgba(255,215,0,0.8)"}})}),a.jsx("div",{className:"play-card-back",style:{borderRadius:12,boxShadow:"0 0 50px rgba(255,215,0,0.8)",overflow:"hidden"},children:a.jsx("img",{src:di(Ye.playerClass),alt:"Card Sleeve",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:12},onError:m=>{const _=m.target;_.style.display="none",_.parentElement&&(_.parentElement.style.background="linear-gradient(135deg, #1e3a5f 0%, #0d1b2a 50%, #1e3a5f 100%)")}})}),Ye.card.type==="SPELL"&&a.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none"},children:a.jsx(QL,{x:0,y:0})})]})]}),Yi.length>0&&Yi.map((m,_)=>a.jsx("div",{style:{position:"absolute",left:m.status==="FLY"&&m.targetX!==void 0?m.targetX:window.innerWidth/2+m.xOffset,top:m.status==="FLY"&&m.targetY!==void 0?m.targetY:window.innerHeight/2,transform:m.status==="APPEAR"?"translate(-50%, -50%) scale(1.2)":"translate(-50%, -50%) scale(0.2)",zIndex:7e3+_,pointerEvents:"none",transition:m.status==="FLY"?"all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)":"none",opacity:m.status==="FLY"?.3:1,animation:m.status==="APPEAR"?"cardAppear 0.8s ease-out":void 0},children:a.jsx(ro,{card:m.card,scale:p,style:{width:cn*p,height:Sn*p}})},_)),a.jsx("style",{children:`
                    @keyframes cardAppear {
                        0% { transform: translate(-50%, -50%) scale(0) rotate(-10deg); opacity: 0; }
                        50% { transform: translate(-50%, -50%) scale(1.3) rotate(5deg); opacity: 1; }
                        100% { transform: translate(-50%, -50%) scale(1.2) rotate(0deg); opacity: 1; }
                    }
                `}),fc.map(m=>m.type==="BUFF"?a.jsx(VL,{x:m.x,y:m.y,atkBuff:m.atkBuff??0,hpBuff:m.hpBuff??0,onComplete:()=>Ki(_=>_.filter(E=>E.key!==m.key))},m.key):a.jsx(KL,{type:m.type,x:m.x,y:m.y,onComplete:()=>Ki(_=>_.filter(E=>E.key!==m.key)),audioSettings:Ct,scale:p},m.key)),Lt&&a.jsx(ZL,{card:Lt.card,evolvedImageUrl:Lt.evolvedImageUrl,startX:Lt.startX,startY:Lt.startY,phase:Lt.phase,onPhaseChange:xI,onShake:Bn,useSep:Lt.useSep,playSE:_t,scale:p,isLightMode:z}),ai&&a.jsxs("div",{style:{position:"fixed",top:"45%",left:`${340*p}px`,width:`calc(100% - ${340*p}px)`,display:"flex",justifyContent:"center",alignItems:"center",transform:"translateY(-50%)",zIndex:9e3,pointerEvents:"none",animation:"notificationFade 2.5s forwards"},children:[a.jsx("div",{style:{padding:`${20*p}px ${90*p}px`,background:"rgba(0, 0, 0, 0.75)",backdropFilter:"blur(16px)",borderTop:`${3*p}px solid ${ai==="EVOLVE_READY"?"rgba(255, 215, 0, 0.7)":"rgba(180, 0, 255, 0.7)"}`,borderBottom:`${3*p}px solid ${ai==="EVOLVE_READY"?"rgba(255, 215, 0, 0.7)":"rgba(180, 0, 255, 0.7)"}`,boxShadow:ai==="EVOLVE_READY"?`0 0 ${50*p}px rgba(255, 180, 0, 0.5), inset 0 0 ${30*p}px rgba(255, 215, 0, 0.2)`:`0 0 ${50*p}px rgba(180, 0, 255, 0.5), inset 0 0 ${30*p}px rgba(180, 0, 255, 0.2)`,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",borderRadius:`${4*p}px`},children:a.jsx("span",{style:{fontSize:`${5*p}rem`,fontWeight:"900",fontFamily:'"YuMincho", "Hiragino Mincho ProN", "MS Mincho", serif',color:"#fff",letterSpacing:`${.8*p}rem`,whiteSpace:"nowrap",textShadow:ai==="EVOLVE_READY"?`0 0 ${15*p}px rgba(255, 215, 0, 1), 0 0 ${30*p}px rgba(255, 180, 0, 0.8), ${2*p}px ${2*p}px ${4*p}px rgba(0,0,0,0.9)`:`0 0 ${15*p}px rgba(180, 0, 255, 1), 0 0 ${30*p}px rgba(140, 0, 255, 0.8), ${2*p}px ${2*p}px ${4*p}px rgba(0,0,0,0.9)`,WebkitTextStroke:ai==="EVOLVE_READY"?`${1.5*p}px #ffd700`:`${1.5*p}px #b400ff`},children:ai==="EVOLVE_READY"?"":""})}),a.jsx("style",{children:`
                            @keyframes notificationFade {
                                0% { opacity: 0; transform: translateY(-40%) scale(0.8); filter: blur(15px); }
                                10% { opacity: 1; transform: translateY(-50%) scale(1); filter: blur(0px); }
                                90% { opacity: 1; transform: translateY(-50%) scale(1); filter: blur(0px); }
                                100% { opacity: 0; transform: translateY(-60%) scale(1.15); filter: blur(20px); }
                            }
                        `})]}),Pe&&g.winnerId&&a.jsx(DL,{isVictory:g.winnerId===L,loserLeaderRef:g.winnerId===L?Qi:ci,onComplete:()=>{xe(!1),qe(!0),rt(null),Ot(0),(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&b&&(console.log("[GameScreen] Disconnecting after game over (casual match)"),b.disconnect())},onPhaseChange:rt,onShakeIntensityChange:Ot,scale:p}),g.winnerId&&ct&&a.jsx(i3,{winnerId:g.winnerId,playerId:L,playerClass:(oe==null?void 0:oe.class)||"SENKA",isOnline:e==="ONLINE",isRoomMatch:n==="HOST"||n==="JOIN",myRematchRequested:Ce,opponentRematchRequested:Un,battleStats:{turnCount:g.turnCount,damageDealtToOpponent:rc.damageDealtToOpponent,damageReceivedFromOpponent:rc.damageReceivedFromOpponent,followersDestroyed:rc.followersDestroyed,myFollowersDestroyed:rc.myFollowersDestroyed},selectedCardInfo:iI,onCardInfoClick:sf,victoryReason:rf,isRankedMatch:n==="RANKED_MATCH",ratingResult:oI,onRematching:i,onRematch:m=>{e==="ONLINE"?(tt(!0),Un?(b==null||b.send({type:"REMATCH_ACCEPT"}),bf(m)):(b==null||b.send({type:"REMATCH_REQUEST"}),q0(m))):bf(m)},onLeave:s})]})]})},Q0=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},a3=Q0("/leaders/azya_leader.png"),l3=Q0("/leaders/senka_leader.png"),c3=Q0("/leaders/yoRuka_leader.png"),d3=1280,u3=720,f3=({onSelectClass:t,onBack:e})=>{const[n,r]=O.useState(1);O.useEffect(()=>{const u=()=>{const h=window.innerWidth/d3,f=window.innerHeight/u3;r(Math.min(h,f))};return u(),window.addEventListener("resize",u),()=>window.removeEventListener("resize",u)},[]);const s=200*n,i=280*n,o=2*n,l=1.4*n,c=1.2*n,d=`${8*n}px ${16*n}px`;return a.jsxs("div",{className:"screen",style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"#1a1a2e",color:"white",position:"relative"},children:[a.jsx("button",{onClick:e,style:{position:"absolute",top:`${20*n}px`,left:`${20*n}px`,background:"#333",padding:d,fontSize:`${.9*n}rem`,border:"1px solid #555",borderRadius:6*n,color:"white",cursor:"pointer",fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s"},onMouseOver:u=>u.currentTarget.style.background="#444",onMouseOut:u=>u.currentTarget.style.background="#333",children:""}),a.jsx("h2",{style:{fontSize:`${o}rem`,marginBottom:`${1.5*n}rem`,marginTop:0,fontFamily:"Tamanegi, sans-serif"},children:" - "}),a.jsxs("div",{style:{display:"flex",gap:`${c}rem`,marginBottom:`${1*n}rem`},children:[a.jsxs("div",{onClick:()=>t("SENKA"),style:{width:s,height:i,border:"1px solid #444",borderRadius:10*n,background:"linear-gradient(180deg, #2c0b0e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:"0 4px 20px rgba(233, 69, 96, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:u=>{u.currentTarget.style.transform="scale(1.05)",u.currentTarget.style.boxShadow="0 8px 30px rgba(233, 69, 96, 0.4)"},onMouseOut:u=>{u.currentTarget.style.transform="scale(1)",u.currentTarget.style.boxShadow="0 4px 20px rgba(233, 69, 96, 0.2)"},children:[a.jsx("img",{src:l3,alt:"Senka",style:{width:"100%",height:"75%",objectFit:"cover"}}),a.jsx("div",{style:{padding:`${8*n}px`,display:"flex",flexDirection:"column",alignItems:"center",width:"100%",justifyContent:"center",flex:1},children:a.jsx("h3",{style:{fontSize:`${l}rem`,color:"#e94560",margin:0,fontFamily:"Tamanegi, sans-serif"},children:""})})]}),a.jsxs("div",{onClick:()=>t("AJA"),style:{width:s,height:i,border:"1px solid #444",borderRadius:10*n,background:"linear-gradient(180deg, #0f1c2e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:"0 4px 20px rgba(69, 162, 233, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:u=>{u.currentTarget.style.transform="scale(1.05)",u.currentTarget.style.boxShadow="0 8px 30px rgba(69, 162, 233, 0.4)"},onMouseOut:u=>{u.currentTarget.style.transform="scale(1)",u.currentTarget.style.boxShadow="0 4px 20px rgba(69, 162, 233, 0.2)"},children:[a.jsx("img",{src:a3,alt:"Azya",style:{width:"100%",height:"75%",objectFit:"cover",objectPosition:"center top"}}),a.jsx("div",{style:{padding:`${8*n}px`,display:"flex",flexDirection:"column",alignItems:"center",width:"100%",justifyContent:"center",flex:1},children:a.jsx("h3",{style:{fontSize:`${l}rem`,color:"#45a2e9",margin:0,fontFamily:"Tamanegi, sans-serif"},children:""})})]}),a.jsxs("div",{onClick:()=>t("YORUKA"),style:{width:s,height:i,border:"1px solid #444",borderRadius:10*n,background:"linear-gradient(180deg, #1a0f2e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:"0 4px 20px rgba(168, 85, 247, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:u=>{u.currentTarget.style.transform="scale(1.05)",u.currentTarget.style.boxShadow="0 8px 30px rgba(168, 85, 247, 0.4)"},onMouseOut:u=>{u.currentTarget.style.transform="scale(1)",u.currentTarget.style.boxShadow="0 4px 20px rgba(168, 85, 247, 0.2)"},children:[a.jsx("img",{src:c3,alt:"Yoruka",style:{width:"100%",height:"75%",objectFit:"cover"}}),a.jsx("div",{style:{padding:`${8*n}px`,display:"flex",flexDirection:"column",alignItems:"center",width:"100%",justifyContent:"center",flex:1},children:a.jsx("h3",{style:{fontSize:`${l}rem`,color:"#a855f7",margin:0,fontFamily:"Tamanegi, sans-serif"},children:"Y"})})]})]})]})},nf=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},h3=nf("/leaders/azya_leader.png"),p3=nf("/leaders/senka_leader.png"),g3=nf("/leaders/yoRuka_leader.png"),m3=1280,y3=720,v3={SENKA:{primary:"#e94560",gradient:"linear-gradient(135deg, #2c0b0e 0%, #1a1a2e 100%)",shadow:"rgba(233, 69, 96, 0.3)"},AJA:{primary:"#45a2e9",gradient:"linear-gradient(135deg, #0f1c2e 0%, #1a1a2e 100%)",shadow:"rgba(69, 162, 233, 0.3)"},YORUKA:{primary:"#a855f7",gradient:"linear-gradient(135deg, #1a0f2e 0%, #1a1a2e 100%)",shadow:"rgba(168, 85, 247, 0.3)"}},_3={SENKA:"",AJA:"",YORUKA:"Y"},x3={SENKA:p3,AJA:h3,YORUKA:g3},La=["SENKA","AJA","YORUKA"],b3=({classType:t,onSelectCard:e,onBack:n})=>{const[r,s]=O.useState(1),[i,o]=O.useState(La.indexOf(t));O.useEffect(()=>{const z=()=>{const W=window.innerWidth/m3,q=window.innerHeight/y3;s(Math.min(W,q))};return z(),window.addEventListener("resize",z),()=>window.removeEventListener("resize",z)},[]);const l=z=>z==="SENKA"?ZS:z==="AJA"?eI:tI,c=La[i],u=l(c).filter(z=>!z.cardId.startsWith("TOKEN_")).map(z=>({card:tr.find(W=>W.id===z.cardId),count:z.count})).filter(z=>z.card),h=v3[c],f=_3[c],x=x3[c],k=180*r,T=250*r,j=110*r,b=155*r,v=.6*r,S=1.8*r,p=`${8*r}px ${16*r}px`,F=()=>{o(z=>(z-1+La.length)%La.length)},H=()=>{o(z=>(z+1)%La.length)};return a.jsxs("div",{style:{minHeight:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",background:h.gradient,color:"white",position:"relative",paddingBottom:`${40*r}px`},children:[a.jsx("button",{onClick:n,style:{position:"fixed",top:`${20*r}px`,left:`${20*r}px`,background:"rgba(0, 0, 0, 0.5)",padding:p,fontSize:`${.9*r}rem`,border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:6*r,color:"white",cursor:"pointer",fontFamily:"sans-serif",transition:"all 0.2s",zIndex:100},onMouseOver:z=>z.currentTarget.style.background="rgba(0, 0, 0, 0.7)",onMouseOut:z=>z.currentTarget.style.background="rgba(0, 0, 0, 0.5)",children:""}),a.jsxs("h2",{style:{fontSize:`${S}rem`,marginTop:`${80*r}px`,marginBottom:`${20*r}px`,fontFamily:"sans-serif",color:h.primary,textShadow:`0 0 20px ${h.shadow}`},children:[f," - "]}),a.jsxs("div",{style:{display:"flex",gap:`${2*r}rem`,width:"95%",maxWidth:`${1100*r}px`,alignItems:"flex-start",justifyContent:"center"},children:[a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${1*r}rem`},children:[a.jsx("button",{onClick:F,style:{width:`${50*r}px`,height:`${50*r}px`,background:"rgba(0, 0, 0, 0.5)",border:`2px solid ${h.primary}`,borderRadius:"50%",color:h.primary,fontSize:`${1.5*r}rem`,cursor:"pointer",fontWeight:"bold",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},onMouseOver:z=>{z.currentTarget.style.background=h.primary,z.currentTarget.style.color="white"},onMouseOut:z=>{z.currentTarget.style.background="rgba(0, 0, 0, 0.5)",z.currentTarget.style.color=h.primary},children:"<"}),a.jsxs("div",{style:{width:k,height:T,border:`3px solid ${h.primary}`,borderRadius:10*r,background:"linear-gradient(180deg, rgba(0,0,0,0.5) 0%, rgba(0,0,0,0.8) 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",boxShadow:`0 8px 30px ${h.shadow}`,overflow:"hidden",position:"relative"},children:[a.jsx("img",{src:x,alt:f,style:{width:"100%",height:"75%",objectFit:"cover"}}),a.jsx("div",{style:{padding:`${8*r}px`,display:"flex",flexDirection:"column",alignItems:"center",width:"100%",justifyContent:"center",flex:1},children:a.jsx("h3",{style:{fontSize:`${1.2*r}rem`,color:h.primary,margin:0,fontFamily:"sans-serif"},children:f})})]}),a.jsx("button",{onClick:H,style:{width:`${50*r}px`,height:`${50*r}px`,background:"rgba(0, 0, 0, 0.5)",border:`2px solid ${h.primary}`,borderRadius:"50%",color:h.primary,fontSize:`${1.5*r}rem`,cursor:"pointer",fontWeight:"bold",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},onMouseOver:z=>{z.currentTarget.style.background=h.primary,z.currentTarget.style.color="white"},onMouseOut:z=>{z.currentTarget.style.background="rgba(0, 0, 0, 0.5)",z.currentTarget.style.color=h.primary},children:">"})]}),a.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:`${1*r}rem`},children:[a.jsx("div",{style:{display:"grid",gridTemplateColumns:`repeat(auto-fill, minmax(${j}px, 1fr))`,gap:`${v}rem`,width:"100%",padding:`${10*r}px`,maxHeight:`${(b+v*16)*3+40*r}px`,overflowY:"auto",overflowX:"hidden"},children:u.map(({card:z,count:W})=>a.jsxs("div",{onClick:()=>e(z.id),style:{width:j,height:b,border:`2px solid ${h.primary}`,borderRadius:8*r,background:"linear-gradient(180deg, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.9) 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"all 0.2s",boxShadow:`0 4px 15px ${h.shadow}`,position:"relative",overflow:"hidden"},onMouseOver:q=>{q.currentTarget.style.transform="translateY(-5px) scale(1.05)",q.currentTarget.style.boxShadow=`0 8px 25px ${h.shadow}`},onMouseOut:q=>{q.currentTarget.style.transform="translateY(0) scale(1)",q.currentTarget.style.boxShadow=`0 4px 15px ${h.shadow}`},children:[a.jsx("div",{style:{width:"100%",height:"65%",overflow:"hidden",borderBottom:`1px solid ${h.primary}`},children:a.jsx("img",{src:nf(z.imageUrl||`/cards/${z.id}.png`),alt:z.name,style:{width:"100%",height:"100%",objectFit:"cover"},onError:q=>{q.currentTarget.style.display="none"}})}),a.jsxs("div",{style:{padding:`${5*r}px`,textAlign:"center",flex:1,display:"flex",flexDirection:"column",justifyContent:"center",width:"100%"},children:[a.jsx("h3",{style:{fontSize:`${.7*r}rem`,margin:`0 0 ${3*r}px 0`,fontFamily:"sans-serif",color:h.primary,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:z.name}),a.jsxs("p",{style:{fontSize:`${.6*r}rem`,color:"#ffcc00",margin:0,fontFamily:"sans-serif",fontWeight:"bold"},children:[": ",z.cost]})]}),a.jsx("div",{style:{position:"absolute",bottom:`${5*r}px`,right:`${5*r}px`,background:"rgba(0, 0, 0, 0.8)",color:"white",borderRadius:50,width:`${22*r}px`,height:`${22*r}px`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${.7*r}rem`,fontWeight:"bold",fontFamily:"sans-serif",border:`2px solid ${h.primary}`,boxShadow:`0 0 10px ${h.shadow}`},children:W})]},z.id))}),a.jsxs("div",{style:{fontSize:`${.85*r}rem`,color:"#aaa",fontFamily:"sans-serif",textAlign:"center"},children:[" ",u.length," "]})]})]})]})},E3=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},S3=1280,I3=720,T3=({cardId:t,onOpenRelatedCard:e,onBack:n})=>{const[r,s]=O.useState(1);O.useEffect(()=>{const x=()=>{const k=window.innerWidth/S3,T=window.innerHeight/I3;s(Math.min(k,T))};return x(),window.addEventListener("resize",x),()=>window.removeEventListener("resize",x)},[]);const i=tr.find(x=>x.id===t);if(!i)return a.jsx("div",{style:{minHeight:"100dvh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",fontFamily:"sans-serif",fontSize:`${1.5*r}rem`},children:""});const o=(x,k)=>E3(x||k),l=o(i.imageUrl,`/cards/${i.id}.png`),c=i.type==="FOLLOWER"?o(i.evolvedImageUrl,`/cards/${i.id}_evolved.png`):null,d=250*r,u=350*r,h=1.5*r;return a.jsxs("div",{style:{minHeight:"100dvh",display:"flex",flexDirection:"column",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #1a1a2e 100%)",color:"white",fontFamily:"sans-serif",overflow:"auto"},children:[a.jsx("div",{style:{position:"sticky",top:0,left:0,padding:`${20*r}px`,zIndex:100,background:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(10px)"},children:a.jsx("button",{onClick:n,style:{background:"rgba(255, 255, 255, 0.1)",padding:`${10*r}px ${20*r}px`,fontSize:`${1*r}rem`,border:"1px solid rgba(255, 255, 255, 0.3)",borderRadius:`${8*r}px`,color:"white",cursor:"pointer",fontFamily:"sans-serif",transition:"all 0.2s"},onMouseOver:x=>x.currentTarget.style.background="rgba(255, 255, 255, 0.2)",onMouseOut:x=>x.currentTarget.style.background="rgba(255, 255, 255, 0.1)",children:""})}),a.jsxs("div",{style:{display:"flex",gap:`${3*r}rem`,padding:`${30*r}px`,flex:1,justifyContent:"center",alignItems:"flex-start",maxWidth:`${1100*r}px`,width:"100%",margin:"0 auto"},children:[a.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${h}rem`,flex:"0 0 auto"},children:i.type==="FOLLOWER"?a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{width:d,height:u,border:"2px solid rgba(255, 255, 255, 0.3)",borderRadius:`${12*r}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.5)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:l,alt:`${i.name} `,style:{width:"100%",height:"100%",objectFit:"cover"}})}),a.jsx("div",{style:{fontSize:`${.8*r}rem`,color:"#aaa",textAlign:"center"},children:""}),a.jsx("div",{style:{width:d,height:u,border:"2px solid rgba(255, 215, 0, 0.5)",borderRadius:`${12*r}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(255, 215, 0, 0.3)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:c||l,alt:`${i.name} `,style:{width:"100%",height:"100%",objectFit:"cover"}})}),a.jsx("div",{style:{fontSize:`${.8*r}rem`,color:"#ffd700",textAlign:"center"},children:""})]}):a.jsx(a.Fragment,{children:a.jsx("div",{style:{width:d,height:u,border:"2px solid rgba(138, 43, 226, 0.5)",borderRadius:`${12*r}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(138, 43, 226, 0.3)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:l,alt:i.name,style:{width:"100%",height:"100%",objectFit:"cover"}})})})}),a.jsxs("div",{style:{flex:1,background:"rgba(0, 0, 0, 0.5)",padding:`${30*r}px`,borderRadius:`${12*r}px`,border:"1px solid rgba(255, 255, 255, 0.2)",display:"flex",flexDirection:"column",gap:`${20*r}px`,minHeight:`${500*r}px`,maxHeight:`${600*r}px`,overflowY:"auto"},children:[a.jsx("h2",{style:{fontSize:`${2*r}rem`,fontWeight:"bold",margin:0,color:"#fff",textAlign:"left"},children:i.name}),a.jsxs("div",{style:{display:"flex",gap:`${25*r}px`,fontSize:`${1.3*r}rem`,flexWrap:"wrap"},children:[a.jsxs("div",{style:{color:"#ffd700"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:i.cost})]}),i.type==="FOLLOWER"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{color:"#ff6b6b"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:i.attack})]}),a.jsxs("div",{style:{color:"#4ecdc4"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:i.health})]})]})]}),a.jsx("div",{style:{height:"1px",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)"}}),a.jsxs("div",{children:[a.jsx("h3",{style:{fontSize:`${1.2*r}rem`,margin:`0 0 ${10*r}px 0`,color:"#aaa"},children:""}),a.jsx("p",{style:{fontSize:`${1.05*r}rem`,margin:0,whiteSpace:"pre-wrap",lineHeight:1.8,color:"#fff"},children:i.description})]}),i.flavorText&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{height:"1px",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)"}}),a.jsxs("div",{children:[a.jsx("h3",{style:{fontSize:`${1.2*r}rem`,margin:`0 0 ${10*r}px 0`,color:"#aaa"},children:""}),a.jsx("p",{style:{fontSize:`${1*r}rem`,margin:0,fontStyle:"italic",opacity:.7,lineHeight:1.8,whiteSpace:"pre-wrap",color:"#ccc"},children:i.flavorText})]})]}),i.relatedCards&&i.relatedCards.length>0&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{height:"1px",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)"}}),a.jsx("div",{style:{display:"flex",justifyContent:"flex-start"},children:a.jsxs("button",{onClick:()=>e(t),style:{padding:`${1*r}rem ${2*r}rem`,background:"#4ade80",color:"white",border:"none",borderRadius:`${8*r}px`,fontSize:`${1.1*r}rem`,fontWeight:"bold",fontFamily:"sans-serif",cursor:"pointer",transition:"all 0.2s",boxShadow:"0 4px 15px rgba(74, 222, 128, 0.3)"},onMouseOver:x=>{x.currentTarget.style.background="#22c55e",x.currentTarget.style.transform="translateY(-2px)",x.currentTarget.style.boxShadow="0 6px 20px rgba(74, 222, 128, 0.4)"},onMouseOut:x=>{x.currentTarget.style.background="#4ade80",x.currentTarget.style.transform="translateY(0)",x.currentTarget.style.boxShadow="0 4px 15px rgba(74, 222, 128, 0.3)"},children:[" (",i.relatedCards.length,")"]})})]})]})]})]})},w3=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},C3=1280,k3=720,R3=({parentCardId:t,relatedCardIds:e,onBack:n})=>{const[r,s]=O.useState(1),[i,o]=O.useState(0);O.useEffect(()=>{const S=()=>{const p=window.innerWidth/C3,F=window.innerHeight/k3;s(Math.min(p,F))};return S(),window.addEventListener("resize",S),()=>window.removeEventListener("resize",S)},[]);const l=e[i],c=tr.find(S=>S.id===l),d=()=>{o(S=>S>0?S-1:e.length-1)},u=()=>{o(S=>S<e.length-1?S+1:0)};if(!c)return a.jsx("div",{style:{minHeight:"100dvh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",fontFamily:"Tamanegi, sans-serif",fontSize:`${1.5*r}rem`},children:""});const h=(S,p)=>w3(S||p),f=h(c.imageUrl,`/cards/${c.id}.png`),x=c.type==="FOLLOWER"?h(c.evolvedImageUrl,`/cards/${c.id}_evolved.png`):null,k=200*r,T=280*r,j=2*r,b="linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #1a1a2e 100%)",v={fontSize:`${3*r}rem`,background:"rgba(0, 0, 0, 0.5)",padding:`${1*r}rem`,borderRadius:`${8*r}px`,cursor:"pointer",border:"1px solid rgba(255, 255, 255, 0.2)",color:"white",transition:"all 0.2s",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",width:`${60*r}px`,height:`${60*r}px`};return a.jsxs("div",{style:{minHeight:"100dvh",display:"flex",flexDirection:"column",background:b,color:"white",fontFamily:"Tamanegi, sans-serif",overflow:"auto",paddingBottom:`${40*r}px`},children:[a.jsxs("div",{style:{position:"sticky",top:0,left:0,padding:`${20*r}px`,zIndex:100,background:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(10px)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[a.jsx("button",{onClick:n,style:{background:"rgba(255, 255, 255, 0.1)",padding:`${10*r}px ${20*r}px`,fontSize:`${1*r}rem`,border:"1px solid rgba(255, 255, 255, 0.3)",borderRadius:`${8*r}px`,color:"white",cursor:"pointer",fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s"},onMouseOver:S=>S.currentTarget.style.background="rgba(255, 255, 255, 0.2)",onMouseOut:S=>S.currentTarget.style.background="rgba(255, 255, 255, 0.1)",children:""}),a.jsxs("div",{style:{fontSize:`${1.2*r}rem`,opacity:.8,fontWeight:"bold"},children:[i+1," / ",e.length]})]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${30*r}px`,padding:`${20*r}px`,flex:1},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:`${20*r}px`,flexWrap:"wrap"},children:[a.jsx("button",{onClick:d,style:v,onMouseOver:S=>S.currentTarget.style.background="rgba(0, 0, 0, 0.7)",onMouseOut:S=>S.currentTarget.style.background="rgba(0, 0, 0, 0.5)",children:"<"}),a.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:`${j}rem`,flexWrap:"wrap"},children:c.type==="FOLLOWER"?a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{width:k,height:T,border:"2px solid rgba(255, 255, 255, 0.3)",borderRadius:`${12*r}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.5)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:f,alt:`${c.name} `,style:{width:"100%",height:"100%",objectFit:"cover"}})}),a.jsx("div",{style:{width:k,height:T,border:"2px solid rgba(255, 215, 0, 0.5)",borderRadius:`${12*r}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(255, 215, 0, 0.3)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:x||f,alt:`${c.name} `,style:{width:"100%",height:"100%",objectFit:"cover"}})})]}):a.jsx("div",{style:{width:k,height:T,border:"2px solid rgba(138, 43, 226, 0.5)",borderRadius:`${12*r}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(138, 43, 226, 0.3)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:f,alt:c.name,style:{width:"100%",height:"100%",objectFit:"cover"}})})}),a.jsx("button",{onClick:u,style:v,onMouseOver:S=>S.currentTarget.style.background="rgba(0, 0, 0, 0.7)",onMouseOut:S=>S.currentTarget.style.background="rgba(0, 0, 0, 0.5)",children:">"})]}),a.jsxs("div",{style:{maxWidth:`${600*r}px`,width:"90%",background:"rgba(0, 0, 0, 0.5)",padding:`${25*r}px`,borderRadius:`${12*r}px`,border:"1px solid rgba(255, 255, 255, 0.2)",display:"flex",flexDirection:"column",gap:`${15*r}px`},children:[a.jsx("h2",{style:{fontSize:`${1.8*r}rem`,fontWeight:"bold",margin:0,color:"#fff",textAlign:"center"},children:c.name}),a.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:`${20*r}px`,fontSize:`${1.2*r}rem`,flexWrap:"wrap"},children:[a.jsxs("div",{style:{color:"#ffd700"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:c.cost})]}),c.type==="FOLLOWER"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{color:"#ff6b6b"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:c.attack})]}),a.jsxs("div",{style:{color:"#4ecdc4"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:c.health})]})]})]}),a.jsx("div",{style:{height:"1px",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)"}}),a.jsxs("div",{children:[a.jsx("h3",{style:{fontSize:`${1.1*r}rem`,margin:`0 0 ${8*r}px 0`,color:"#aaa"},children:""}),a.jsx("p",{style:{fontSize:`${1*r}rem`,margin:0,whiteSpace:"pre-wrap",lineHeight:1.6,color:"#fff"},children:c.description})]}),c.flavorText&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{height:"1px",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)"}}),a.jsxs("div",{children:[a.jsx("h3",{style:{fontSize:`${1.1*r}rem`,margin:`0 0 ${8*r}px 0`,color:"#aaa"},children:""}),a.jsx("p",{style:{fontSize:`${.9*r}rem`,margin:0,fontStyle:"italic",opacity:.7,lineHeight:1.6,whiteSpace:"pre-wrap",color:"#ccc"},children:c.flavorText})]})]})]})]})]})},A3=async()=>(await cP(tc)).user,P3=async(t,e)=>(await mP(tc,t,e)).user,O3=async(t,e)=>{const n=tc.currentUser;if(!n)throw new Error("No user logged in");const r=Bi.credential(t,e);return(await pP(n,r)).user},L3=async()=>{await xP(tc)},D3=t=>_P(tc,t),D_=1280,M_=720,M3=({onRegisterSuccess:t,onBack:e})=>{const[n,r]=O.useState(""),[s,i]=O.useState(""),[o,l]=O.useState(""),[c,d]=O.useState(""),[u,h]=O.useState(!1),[f,x]=O.useState(1);O.useEffect(()=>{const v=()=>{const S=window.innerWidth/D_,p=window.innerHeight/M_;x(Math.min(S,p))};return v(),window.addEventListener("resize",v),()=>window.removeEventListener("resize",v)},[]);const k=v=>/^[a-zA-Z0-9_]{3,20}$/.test(v),T=v=>`${v}@tenfubu-game.local`,j=async()=>{if(d(""),!n||!s||!o){d("");return}if(!k(n)){d("ID3-20");return}if(s.length<6){d("6");return}if(s!==o){d("");return}h(!0);try{const v=T(n);await O3(v,s),t()}catch(v){console.error("Registration error:",v),console.error("Error code:",v==null?void 0:v.code),console.error("Error message:",v==null?void 0:v.message);const S=(v==null?void 0:v.code)||"";d(S==="auth/email-already-in-use"?"ID":S==="auth/invalid-email"?"ID":S==="auth/weak-password"?"6":S==="auth/requires-recent-login"?"":S==="auth/provider-already-linked"?"ID":S==="auth/credential-already-in-use"?"ID":` (${S||"unknown error"})`)}finally{h(!1)}},b=v=>{v.key==="Enter"&&!u&&j()};return a.jsx("div",{style:{width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",overflow:"hidden"},children:a.jsxs("div",{style:{width:D_*f,height:M_*f,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative"},children:[a.jsx("h1",{style:{fontSize:48*f,fontWeight:"bold",color:"#fff",marginBottom:40*f,textShadow:"0 4px 8px rgba(0,0,0,0.5)"},children:""}),a.jsxs("div",{style:{width:400*f,display:"flex",flexDirection:"column",gap:20*f},children:[a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*f,color:"#fff",marginBottom:8*f,fontWeight:"bold"},children:"ID"}),a.jsx("input",{type:"text",value:n,onChange:v=>r(v.target.value),onKeyPress:b,placeholder:"player123",disabled:u,style:{width:"100%",padding:`${12*f}px ${16*f}px`,fontSize:16*f,borderRadius:8*f,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:v=>v.currentTarget.style.borderColor="#4a9eff",onBlur:v=>v.currentTarget.style.borderColor="#444"}),a.jsx("p",{style:{fontSize:12*f,color:"#888",marginTop:4*f,marginBottom:0},children:"3-20"})]}),a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*f,color:"#fff",marginBottom:8*f,fontWeight:"bold"},children:"6"}),a.jsx("input",{type:"password",value:s,onChange:v=>i(v.target.value),onKeyPress:b,placeholder:"",disabled:u,style:{width:"100%",padding:`${12*f}px ${16*f}px`,fontSize:16*f,borderRadius:8*f,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:v=>v.currentTarget.style.borderColor="#4a9eff",onBlur:v=>v.currentTarget.style.borderColor="#444"})]}),a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*f,color:"#fff",marginBottom:8*f,fontWeight:"bold"},children:""}),a.jsx("input",{type:"password",value:o,onChange:v=>l(v.target.value),onKeyPress:b,placeholder:"",disabled:u,style:{width:"100%",padding:`${12*f}px ${16*f}px`,fontSize:16*f,borderRadius:8*f,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:v=>v.currentTarget.style.borderColor="#4a9eff",onBlur:v=>v.currentTarget.style.borderColor="#444"})]}),c&&a.jsx("div",{style:{padding:`${12*f}px ${16*f}px`,borderRadius:8*f,background:"rgba(255, 80, 80, 0.2)",border:"2px solid #ff5050",color:"#ff5050",fontSize:14*f,textAlign:"center"},children:c}),a.jsxs("div",{style:{display:"flex",gap:16*f,marginTop:20*f},children:[a.jsx("button",{onClick:e,disabled:u,style:{flex:1,padding:`${16*f}px ${32*f}px`,fontSize:18*f,fontWeight:"bold",borderRadius:8*f,border:"none",background:"#555",color:"#fff",cursor:u?"not-allowed":"pointer",transition:"all 0.3s",opacity:u?.5:1},onMouseEnter:v=>!u&&(v.currentTarget.style.background="#666"),onMouseLeave:v=>!u&&(v.currentTarget.style.background="#555"),children:""}),a.jsx("button",{onClick:j,disabled:u,style:{flex:1,padding:`${16*f}px ${32*f}px`,fontSize:18*f,fontWeight:"bold",borderRadius:8*f,border:"none",background:u?"#555":"linear-gradient(135deg, #4a9eff 0%, #357abd 100%)",color:"#fff",cursor:u?"not-allowed":"pointer",transition:"all 0.3s",boxShadow:u?"none":"0 4px 8px rgba(0,0,0,0.3)"},onMouseEnter:v=>!u&&(v.currentTarget.style.transform="scale(1.05)"),onMouseLeave:v=>!u&&(v.currentTarget.style.transform="scale(1)"),children:u?"...":""})]}),a.jsxs("div",{style:{marginTop:20*f,padding:`${12*f}px ${16*f}px`,borderRadius:8*f,background:"rgba(74, 158, 255, 0.1)",border:"1px solid rgba(74, 158, 255, 0.3)",fontSize:13*f,color:"#aaa",textAlign:"center",lineHeight:1.6},children:["ID",a.jsx("br",{}),""]})]})]})})},N_=1280,j_=720,N3=({onLoginSuccess:t,onBack:e})=>{const[n,r]=O.useState(""),[s,i]=O.useState(""),[o,l]=O.useState(""),[c,d]=O.useState(!1),[u,h]=O.useState(1);O.useEffect(()=>{const T=()=>{const j=window.innerWidth/N_,b=window.innerHeight/j_;h(Math.min(j,b))};return T(),window.addEventListener("resize",T),()=>window.removeEventListener("resize",T)},[]);const f=T=>`${T}@tenfubu-game.local`,x=async()=>{if(l(""),!n||!s){l("ID");return}d(!0);try{const T=f(n);await P3(T,s),t()}catch(T){const j=(T==null?void 0:T.code)||"";l(j==="auth/user-not-found"?"":j==="auth/wrong-password"?"":j==="auth/invalid-email"?"ID":j==="auth/invalid-credential"?"ID":"")}finally{d(!1)}},k=T=>{T.key==="Enter"&&!c&&x()};return a.jsx("div",{style:{width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",overflow:"hidden"},children:a.jsxs("div",{style:{width:N_*u,height:j_*u,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative"},children:[a.jsx("h1",{style:{fontSize:48*u,fontWeight:"bold",color:"#fff",marginBottom:40*u,textShadow:"0 4px 8px rgba(0,0,0,0.5)"},children:""}),a.jsxs("div",{style:{width:400*u,display:"flex",flexDirection:"column",gap:20*u},children:[a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*u,color:"#fff",marginBottom:8*u,fontWeight:"bold"},children:"ID"}),a.jsx("input",{type:"text",value:n,onChange:T=>r(T.target.value),onKeyPress:k,placeholder:"player123",disabled:c,style:{width:"100%",padding:`${12*u}px ${16*u}px`,fontSize:16*u,borderRadius:8*u,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:T=>T.currentTarget.style.borderColor="#4a9eff",onBlur:T=>T.currentTarget.style.borderColor="#444"})]}),a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*u,color:"#fff",marginBottom:8*u,fontWeight:"bold"},children:""}),a.jsx("input",{type:"password",value:s,onChange:T=>i(T.target.value),onKeyPress:k,placeholder:"",disabled:c,style:{width:"100%",padding:`${12*u}px ${16*u}px`,fontSize:16*u,borderRadius:8*u,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:T=>T.currentTarget.style.borderColor="#4a9eff",onBlur:T=>T.currentTarget.style.borderColor="#444"})]}),o&&a.jsx("div",{style:{padding:`${12*u}px ${16*u}px`,borderRadius:8*u,background:"rgba(255, 80, 80, 0.2)",border:"2px solid #ff5050",color:"#ff5050",fontSize:14*u,textAlign:"center"},children:o}),a.jsxs("div",{style:{display:"flex",gap:16*u,marginTop:20*u},children:[a.jsx("button",{onClick:e,disabled:c,style:{flex:1,padding:`${16*u}px ${32*u}px`,fontSize:18*u,fontWeight:"bold",borderRadius:8*u,border:"none",background:"#555",color:"#fff",cursor:c?"not-allowed":"pointer",transition:"all 0.3s",opacity:c?.5:1},onMouseEnter:T=>!c&&(T.currentTarget.style.background="#666"),onMouseLeave:T=>!c&&(T.currentTarget.style.background="#555"),children:""}),a.jsx("button",{onClick:x,disabled:c,style:{flex:1,padding:`${16*u}px ${32*u}px`,fontSize:18*u,fontWeight:"bold",borderRadius:8*u,border:"none",background:c?"#555":"linear-gradient(135deg, #4a9eff 0%, #357abd 100%)",color:"#fff",cursor:c?"not-allowed":"pointer",transition:"all 0.3s",boxShadow:c?"none":"0 4px 8px rgba(0,0,0,0.3)"},onMouseEnter:T=>!c&&(T.currentTarget.style.transform="scale(1.05)"),onMouseLeave:T=>!c&&(T.currentTarget.style.transform="scale(1)"),children:c?"...":""})]}),a.jsx("div",{style:{marginTop:20*u,padding:`${12*u}px ${16*u}px`,borderRadius:8*u,background:"rgba(255, 200, 80, 0.1)",border:"1px solid rgba(255, 200, 80, 0.3)",fontSize:13*u,color:"#ffcc80",textAlign:"center",lineHeight:1.6},children:" "})]})]})})},$_=1280,F_=720,j3=({playerId:t,currentPlayerName:e,onUpdateSuccess:n,onBack:r})=>{const[s,i]=O.useState(e),[o,l]=O.useState(""),[c,d]=O.useState(!1),[u,h]=O.useState(!1),[f,x]=O.useState(1);O.useEffect(()=>{const j=()=>{const b=window.innerWidth/$_,v=window.innerHeight/F_;x(Math.min(b,v))};return j(),window.addEventListener("resize",j),()=>window.removeEventListener("resize",j)},[]);const k=async()=>{if(l(""),h(!1),!s.trim()){l("");return}if(s.length>20){l("20");return}if(!t){l("ID");return}d(!0);try{await UO(t,s.trim()),h(!0),setTimeout(()=>{n(s.trim())},1e3)}catch(j){console.error("Failed to update player name:",j),l("")}finally{d(!1)}},T=j=>{j.key==="Enter"&&!c&&k()};return a.jsx("div",{style:{width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",overflow:"hidden"},children:a.jsxs("div",{style:{width:$_*f,height:F_*f,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative"},children:[a.jsx("h1",{style:{fontSize:48*f,fontWeight:"bold",color:"#fff",marginBottom:40*f,textShadow:"0 4px 8px rgba(0,0,0,0.5)"},children:""}),a.jsxs("div",{style:{width:400*f,display:"flex",flexDirection:"column",gap:20*f},children:[a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*f,color:"#fff",marginBottom:8*f,fontWeight:"bold"},children:""}),a.jsx("input",{type:"text",value:s,onChange:j=>i(j.target.value),onKeyPress:T,placeholder:"",disabled:c,maxLength:20,style:{width:"100%",padding:`${12*f}px ${16*f}px`,fontSize:16*f,borderRadius:8*f,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:j=>j.currentTarget.style.borderColor="#4a9eff",onBlur:j=>j.currentTarget.style.borderColor="#444"}),a.jsx("p",{style:{fontSize:12*f,color:"#888",marginTop:4*f,marginBottom:0},children:"20"})]}),o&&a.jsx("div",{style:{padding:`${12*f}px ${16*f}px`,borderRadius:8*f,background:"rgba(255, 80, 80, 0.2)",border:"2px solid #ff5050",color:"#ff5050",fontSize:14*f,textAlign:"center"},children:o}),u&&a.jsx("div",{style:{padding:`${12*f}px ${16*f}px`,borderRadius:8*f,background:"rgba(80, 255, 120, 0.2)",border:"2px solid #50ff78",color:"#50ff78",fontSize:14*f,textAlign:"center"},children:" "}),a.jsxs("div",{style:{display:"flex",gap:16*f,marginTop:20*f},children:[a.jsx("button",{onClick:r,disabled:c,style:{flex:1,padding:`${16*f}px ${32*f}px`,fontSize:18*f,fontWeight:"bold",borderRadius:8*f,border:"none",background:"#555",color:"#fff",cursor:c?"not-allowed":"pointer",transition:"all 0.3s",opacity:c?.5:1},onMouseEnter:j=>!c&&(j.currentTarget.style.background="#666"),onMouseLeave:j=>!c&&(j.currentTarget.style.background="#555"),children:""}),a.jsx("button",{onClick:k,disabled:c,style:{flex:1,padding:`${16*f}px ${32*f}px`,fontSize:18*f,fontWeight:"bold",borderRadius:8*f,border:"none",background:c?"#555":"linear-gradient(135deg, #4a9eff 0%, #357abd 100%)",color:"#fff",cursor:c?"not-allowed":"pointer",transition:"all 0.3s",boxShadow:c?"none":"0 4px 8px rgba(0,0,0,0.3)"},onMouseEnter:j=>!c&&(j.currentTarget.style.transform="scale(1.05)"),onMouseLeave:j=>!c&&(j.currentTarget.style.transform="scale(1)"),children:c?"...":""})]})]})]})})},$3=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},F3=$3("/bgm/tenfubu.mp3"),Jc={bgm:.3,se:.5,voice:.5,bgmEnabled:!0,seEnabled:!0},U3=()=>{try{const t=localStorage.getItem("audioSettings");if(t){const e=JSON.parse(t);if(e.enabled!==void 0){const{enabled:n,...r}=e;return{...Jc,...r,bgmEnabled:n,seEnabled:n}}return{...Jc,...e}}return Jc}catch{return Jc}},B3=()=>{const[t,e]=O.useState(!1);return O.useEffect(()=>{const n=()=>{const r="ontouchstart"in window||navigator.maxTouchPoints>0,s=window.innerHeight>window.innerWidth;e(r&&s)};return n(),window.addEventListener("resize",n),window.addEventListener("orientationchange",n),()=>{window.removeEventListener("resize",n),window.removeEventListener("orientationchange",n)}},[]),t};function z3(){const[t,e]=O.useState("TITLE"),[n,r]=O.useState("SENKA"),[s,i]=O.useState("CPU"),[o,l]=O.useState(""),[c,d]=O.useState(void 0),[u,h]=O.useState("NORMAL"),[f,x]=O.useState(null),[k,T]=O.useState(!0),[j,b]=O.useState(null),[v,S]=O.useState(null),[p,F]=O.useState(!0),[H,z]=O.useState(()=>{const Ce=localStorage.getItem("timerEnabled");return Ce!==null?JSON.parse(Ce):!0}),[W,q]=O.useState(()=>localStorage.getItem("playerName")||""),[de,ve]=O.useState(void 0),[Ne,ue]=O.useState(void 0),w=B3(),L=O.useRef(null),[C,R]=O.useState(!1),[y,g]=O.useState(U3),[I,A]=O.useState(null),[D,J]=O.useState(null),[U,ge]=O.useState([]),G=Ce=>Ce&&Ce.endsWith("@tenfubu-game.local")?Ce.replace("@tenfubu-game.local",""):null;O.useEffect(()=>{const Ce=D3(async tt=>{if(console.log(" Auth state changed:",{uid:tt==null?void 0:tt.uid,email:tt==null?void 0:tt.email,isAnonymous:tt==null?void 0:tt.isAnonymous}),tt){x(tt.uid),T(tt.isAnonymous),b(tt.email),S(G(tt.email));const Un=G(tt.email);console.log(" State updated:",{playerId:tt.uid,isAnonymous:tt.isAnonymous,userId:Un});try{await f_(tt.uid,Un||"anonymous",W||"")}catch(Gi){console.error("Failed to create player data:",Gi)}}else try{const Un=await A3();x(Un.uid),T(!0),b(null),S(null),await f_(Un.uid,"anonymous",W||"")}catch(Un){console.error("Failed to sign in:",Un)}F(!1)});return()=>Ce()},[]),O.useEffect(()=>{localStorage.setItem("audioSettings",JSON.stringify(y))},[y]);const Ie=O.useCallback(Ce=>{g(tt=>({...tt,...Ce}))},[]),ne=O.useCallback((Ce,tt)=>{L.current=Ce,R(!0),tt&&d(tt),e("GAME")},[]),Q=O.useCallback((Ce,tt,Un,Gi,rf)=>{L.current=Ce,R(!0),d(tt),ve(Gi),ue(rf),e("GAME")},[]),Pe=O.useCallback(Ce=>{L.current&&(L.current.disconnect(),L.current=null),R(!1),d(void 0),ve(void 0),ue(void 0),r(Ce),e("MATCHMAKING")},[]),xe=O.useRef(null),ze=O.useRef(!1);O.useEffect(()=>{const Ce=new Audio(F3);return Ce.loop=!0,Ce.volume=y.bgmEnabled?y.bgm:0,xe.current=Ce,ze.current=!0,()=>{Ce.pause(),Ce.src=""}},[]),O.useEffect(()=>{const Ce=xe.current;!Ce||!ze.current||(Ce.volume=y.bgmEnabled?y.bgm:0,y.bgmEnabled?Ce.paused&&(t==="TITLE"||t==="CLASS_SELECT")&&Ce.play().catch(()=>{}):Ce.pause())},[y.bgm,y.bgmEnabled,t]),O.useEffect(()=>{const Ce=xe.current;Ce&&(t==="TITLE"||t==="CLASS_SELECT"||t==="LOBBY"?Ce.paused&&y.bgmEnabled&&Ce.play().catch(()=>{}):(Ce.pause(),Ce.currentTime=0))},[t,y.bgmEnabled]),O.useEffect(()=>{const Ce=()=>{const tt=xe.current;tt&&tt.paused&&y.bgmEnabled&&(t==="TITLE"||t==="CLASS_SELECT"||t==="LOBBY")&&tt.play().catch(()=>{})};return document.addEventListener("click",Ce),()=>document.removeEventListener("click",Ce)},[t,y.bgmEnabled]);const we=O.useCallback((Ce,tt)=>{i(Ce),tt&&l(tt),e("CLASS_SELECT")},[]),je=O.useCallback(Ce=>{r(Ce),e(s==="CPU"?"GAME":s==="CASUAL_MATCH"||s==="RANKED_MATCH"?"MATCHMAKING":"LOBBY")},[s]),ht=O.useCallback(()=>{L.current&&(L.current.disconnect(),L.current=null),R(!1),e("TITLE"),l(""),i("CPU"),d(void 0),ve(void 0),ue(void 0),A(null),J(null),ge([])},[]),nt=O.useCallback(()=>{e("GALLERY_CLASS_SELECT")},[]),ct=O.useCallback(Ce=>{A(Ce),e("GALLERY_CARD_LIST")},[]),qe=O.useCallback(Ce=>{J(Ce),e("GALLERY_CARD_DETAIL")},[]),Me=O.useCallback(Ce=>{const tt=tr.find(Un=>Un.id===Ce);tt&&tt.relatedCards&&tt.relatedCards.length>0&&(J(Ce),ge(tt.relatedCards),e("GALLERY_RELATED_CARD"))},[]),rt=O.useCallback(()=>{A(null),e("GALLERY_CLASS_SELECT")},[]),vt=O.useCallback(()=>{J(null),e("GALLERY_CARD_LIST")},[]),Ot=O.useCallback(()=>{ge([]),e("GALLERY_CARD_DETAIL")},[]),Ve=O.useCallback(()=>{e("REGISTER")},[]),qt=O.useCallback(()=>{e("LOGIN")},[]),ft=O.useCallback(()=>{e("TITLE")},[]),on=O.useCallback(()=>{e("TITLE")},[]),zt=O.useCallback(async()=>{try{await L3(),e("TITLE")}catch(Ce){console.error("Failed to logout:",Ce)}},[]),us=O.useCallback(()=>{e("TITLE")},[]),ia=O.useCallback(()=>{e("TITLE")},[]),oa=O.useCallback(()=>{e("PROFILE")},[]),Ir=O.useCallback(Ce=>{q(Ce),localStorage.setItem("playerName",Ce),e("TITLE")},[]),nc=O.useCallback(()=>{e("TITLE")},[]);return p?a.jsx("div",{style:{width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",color:"white",fontSize:"1.5rem",fontWeight:"bold"},children:"Loading..."}):a.jsxs("div",{className:"app-container",children:[w&&a.jsxs("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100dvh",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:99999,color:"white",textAlign:"center",padding:20},children:[a.jsx("div",{style:{fontSize:"4rem",marginBottom:20,animation:"rotatePhone 2s ease-in-out infinite"},children:""}),a.jsx("h2",{style:{fontSize:"1.5rem",fontWeight:"bold",marginBottom:10,textShadow:"0 2px 4px rgba(0,0,0,0.5)"},children:""}),a.jsx("p",{style:{fontSize:"1rem",opacity:.8,maxWidth:280},children:""}),a.jsx("style",{children:`
                        @keyframes rotatePhone {
                            0%, 100% { transform: rotate(0deg); }
                            25% { transform: rotate(-30deg); }
                            75% { transform: rotate(30deg); }
                        }
                    `})]}),t==="TITLE"&&a.jsx(d2,{onStartConfig:we,audioSettings:y,onAudioSettingsChange:Ie,playerId:f,onGalleryStart:nt,isAnonymous:k,userId:v,onNavigateToRegister:Ve,onNavigateToLogin:qt,onNavigateToProfile:oa,onLogout:zt}),t==="CLASS_SELECT"&&a.jsx(YO,{onSelectClass:je,onBack:ht,gameMode:s,aiDifficulty:u,onDifficultyChange:h,playerName:W,onPlayerNameChange:Ce=>{q(Ce),localStorage.setItem("playerName",Ce)},timerEnabled:H,onTimerEnabledChange:Ce=>{z(Ce),localStorage.setItem("timerEnabled",JSON.stringify(Ce))},playerId:f}),t==="LOBBY"&&a.jsx(yL,{gameMode:s,targetRoomId:o,playerClass:n,onGameStart:ne,onBack:ht}),t==="MATCHMAKING"&&a.jsx(bL,{matchType:s==="CASUAL_MATCH"?"casual":"ranked",playerClass:n,playerName:W||"",playerId:f,onGameStart:Q,onCancel:ht}),t==="GAME"&&a.jsx(o3,{playerClass:n,opponentType:s==="CPU"?"CPU":"ONLINE",gameMode:s,targetRoomId:o,onLeave:ht,onRematching:Pe,networkAdapter:L.current,networkConnected:C,opponentClass:c,aiDifficulty:u,playerName:W||"",timerEnabled:s==="CASUAL_MATCH"||s==="RANKED_MATCH"?!0:H,playerId:f,opponentPlayerId:de,opponentRating:Ne}),t==="GALLERY_CLASS_SELECT"&&a.jsx(f3,{onSelectClass:ct,onBack:ht}),t==="GALLERY_CARD_LIST"&&I&&a.jsx(b3,{classType:I,onSelectCard:qe,onBack:rt}),t==="GALLERY_CARD_DETAIL"&&D&&a.jsx(T3,{cardId:D,onOpenRelatedCard:Me,onBack:vt}),t==="GALLERY_RELATED_CARD"&&D&&a.jsx(R3,{parentCardId:D,relatedCardIds:U,onBack:Ot}),t==="REGISTER"&&a.jsx(M3,{onRegisterSuccess:ft,onBack:us}),t==="LOGIN"&&a.jsx(N3,{onLoginSuccess:on,onBack:ia}),t==="PROFILE"&&a.jsx(j3,{playerId:f,currentPlayerName:W,onUpdateSuccess:Ir,onBack:nc})]})}Ch.createRoot(document.getElementById("root")).render(a.jsx(z3,{}));
