var fI=Object.defineProperty;var hI=t=>{throw TypeError(t)};var pI=(t,e,n)=>e in t?fI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var nn=(t,e,n)=>pI(t,typeof e!="symbol"?e+"":e,n);var ca=(t,e,n)=>e.has(t)?hI("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n);function gI(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in t)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function v_(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var __={exports:{}},rd={},x_={exports:{}},lt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Il=Symbol.for("react.element"),mI=Symbol.for("react.portal"),yI=Symbol.for("react.fragment"),vI=Symbol.for("react.strict_mode"),_I=Symbol.for("react.profiler"),xI=Symbol.for("react.provider"),bI=Symbol.for("react.context"),EI=Symbol.for("react.forward_ref"),SI=Symbol.for("react.suspense"),II=Symbol.for("react.memo"),TI=Symbol.for("react.lazy"),Pm=Symbol.iterator;function CI(t){return t===null||typeof t!="object"?null:(t=Pm&&t[Pm]||t["@@iterator"],typeof t=="function"?t:null)}var b_={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},E_=Object.assign,S_={};function Uo(t,e,n){this.props=t,this.context=e,this.refs=S_,this.updater=n||b_}Uo.prototype.isReactComponent={};Uo.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Uo.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function I_(){}I_.prototype=Uo.prototype;function Fp(t,e,n){this.props=t,this.context=e,this.refs=S_,this.updater=n||b_}var Up=Fp.prototype=new I_;Up.constructor=Fp;E_(Up,Uo.prototype);Up.isPureReactComponent=!0;var Om=Array.isArray,T_=Object.prototype.hasOwnProperty,Bp={current:null},C_={key:!0,ref:!0,__self:!0,__source:!0};function w_(t,e,n){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)T_.call(e,r)&&!C_.hasOwnProperty(r)&&(s[r]=e[r]);var l=arguments.length-2;if(l===1)s.children=n;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];s.children=c}if(t&&t.defaultProps)for(r in l=t.defaultProps,l)s[r]===void 0&&(s[r]=l[r]);return{$$typeof:Il,type:t,key:i,ref:o,props:s,_owner:Bp.current}}function wI(t,e){return{$$typeof:Il,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function zp(t){return typeof t=="object"&&t!==null&&t.$$typeof===Il}function kI(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Lm=/\/+/g;function Sf(t,e){return typeof t=="object"&&t!==null&&t.key!=null?kI(""+t.key):e.toString(36)}function Mc(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Il:case mI:o=!0}}if(o)return o=t,s=s(o),t=r===""?"."+Sf(o,0):r,Om(s)?(n="",t!=null&&(n=t.replace(Lm,"$&/")+"/"),Mc(s,e,n,"",function(u){return u})):s!=null&&(zp(s)&&(s=wI(s,n+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(Lm,"$&/")+"/")+t)),e.push(s)),1;if(o=0,r=r===""?".":r+":",Om(t))for(var l=0;l<t.length;l++){i=t[l];var c=r+Sf(i,l);o+=Mc(i,e,n,c,s)}else if(c=CI(t),typeof c=="function")for(t=c.call(t),l=0;!(i=t.next()).done;)i=i.value,c=r+Sf(i,l++),o+=Mc(i,e,n,c,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function cc(t,e,n){if(t==null)return t;var r=[],s=0;return Mc(t,r,"","",function(i){return e.call(n,i,s++)}),r}function AI(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var kn={current:null},Nc={transition:null},RI={ReactCurrentDispatcher:kn,ReactCurrentBatchConfig:Nc,ReactCurrentOwner:Bp};function k_(){throw Error("act(...) is not supported in production builds of React.")}lt.Children={map:cc,forEach:function(t,e,n){cc(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return cc(t,function(){e++}),e},toArray:function(t){return cc(t,function(e){return e})||[]},only:function(t){if(!zp(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};lt.Component=Uo;lt.Fragment=yI;lt.Profiler=_I;lt.PureComponent=Fp;lt.StrictMode=vI;lt.Suspense=SI;lt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=RI;lt.act=k_;lt.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=E_({},t.props),s=t.key,i=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=Bp.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(c in e)T_.call(e,c)&&!C_.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&l!==void 0?l[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];r.children=l}return{$$typeof:Il,type:t.type,key:s,ref:i,props:r,_owner:o}};lt.createContext=function(t){return t={$$typeof:bI,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:xI,_context:t},t.Consumer=t};lt.createElement=w_;lt.createFactory=function(t){var e=w_.bind(null,t);return e.type=t,e};lt.createRef=function(){return{current:null}};lt.forwardRef=function(t){return{$$typeof:EI,render:t}};lt.isValidElement=zp;lt.lazy=function(t){return{$$typeof:TI,_payload:{_status:-1,_result:t},_init:AI}};lt.memo=function(t,e){return{$$typeof:II,type:t,compare:e===void 0?null:e}};lt.startTransition=function(t){var e=Nc.transition;Nc.transition={};try{t()}finally{Nc.transition=e}};lt.unstable_act=k_;lt.useCallback=function(t,e){return kn.current.useCallback(t,e)};lt.useContext=function(t){return kn.current.useContext(t)};lt.useDebugValue=function(){};lt.useDeferredValue=function(t){return kn.current.useDeferredValue(t)};lt.useEffect=function(t,e){return kn.current.useEffect(t,e)};lt.useId=function(){return kn.current.useId()};lt.useImperativeHandle=function(t,e,n){return kn.current.useImperativeHandle(t,e,n)};lt.useInsertionEffect=function(t,e){return kn.current.useInsertionEffect(t,e)};lt.useLayoutEffect=function(t,e){return kn.current.useLayoutEffect(t,e)};lt.useMemo=function(t,e){return kn.current.useMemo(t,e)};lt.useReducer=function(t,e,n){return kn.current.useReducer(t,e,n)};lt.useRef=function(t){return kn.current.useRef(t)};lt.useState=function(t){return kn.current.useState(t)};lt.useSyncExternalStore=function(t,e,n){return kn.current.useSyncExternalStore(t,e,n)};lt.useTransition=function(){return kn.current.useTransition()};lt.version="18.3.1";x_.exports=lt;var D=x_.exports;const N=v_(D);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var PI=D,OI=Symbol.for("react.element"),LI=Symbol.for("react.fragment"),DI=Object.prototype.hasOwnProperty,MI=PI.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,NI={key:!0,ref:!0,__self:!0,__source:!0};function A_(t,e,n){var r,s={},i=null,o=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)DI.call(e,r)&&!NI.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:OI,type:t,key:i,ref:o,props:s,_owner:MI.current}}rd.Fragment=LI;rd.jsx=A_;rd.jsxs=A_;__.exports=rd;var a=__.exports,fh={},R_={exports:{}},Gn={},P_={exports:{}},O_={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(y,g){var I=y.length;y.push(g);e:for(;0<I;){var P=I-1>>>1,L=y[P];if(0<s(L,g))y[P]=g,y[I]=L,I=P;else break e}}function n(y){return y.length===0?null:y[0]}function r(y){if(y.length===0)return null;var g=y[0],I=y.pop();if(I!==g){y[0]=I;e:for(var P=0,L=y.length,X=L>>>1;P<X;){var F=2*(P+1)-1,ye=y[F],Ae=F+1,Re=y[Ae];if(0>s(ye,I))Ae<L&&0>s(Re,ye)?(y[P]=Re,y[Ae]=I,P=Ae):(y[P]=ye,y[F]=I,P=F);else if(Ae<L&&0>s(Re,I))y[P]=Re,y[Ae]=I,P=Ae;else break e}}return g}function s(y,g){var I=y.sortIndex-g.sortIndex;return I!==0?I:y.id-g.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],u=[],d=1,h=null,f=3,_=!1,R=!1,k=!1,B=typeof setTimeout=="function"?setTimeout:null,x=typeof clearTimeout=="function"?clearTimeout:null,E=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function T(y){for(var g=n(u);g!==null;){if(g.callback===null)r(u);else if(g.startTime<=y)r(u),g.sortIndex=g.expirationTime,e(c,g);else break;g=n(u)}}function p(y){if(k=!1,T(y),!R)if(n(c)!==null)R=!0,S($);else{var g=n(u);g!==null&&A(p,g.startTime-y)}}function $(y,g){R=!1,k&&(k=!1,x(Y),Y=-1),_=!0;var I=f;try{for(T(g),h=n(c);h!==null&&(!(h.expirationTime>g)||y&&!me());){var P=h.callback;if(typeof P=="function"){h.callback=null,f=h.priorityLevel;var L=P(h.expirationTime<=g);g=t.unstable_now(),typeof L=="function"?h.callback=L:h===n(c)&&r(c),T(g)}else r(c);h=n(c)}if(h!==null)var X=!0;else{var F=n(u);F!==null&&A(p,F.startTime-g),X=!1}return X}finally{h=null,f=I,_=!1}}var C=!1,re=null,Y=-1,K=5,ce=-1;function me(){return!(t.unstable_now()-ce<K)}function Se(){if(re!==null){var y=t.unstable_now();ce=y;var g=!0;try{g=re(!0,y)}finally{g?fe():(C=!1,re=null)}}else C=!1}var fe;if(typeof E=="function")fe=function(){E(Se)};else if(typeof MessageChannel<"u"){var te=new MessageChannel,w=te.port2;te.port1.onmessage=Se,fe=function(){w.postMessage(null)}}else fe=function(){B(Se,0)};function S(y){re=y,C||(C=!0,fe())}function A(y,g){Y=B(function(){y(t.unstable_now())},g)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(y){y.callback=null},t.unstable_continueExecution=function(){R||_||(R=!0,S($))},t.unstable_forceFrameRate=function(y){0>y||125<y?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):K=0<y?Math.floor(1e3/y):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(y){switch(f){case 1:case 2:case 3:var g=3;break;default:g=f}var I=f;f=g;try{return y()}finally{f=I}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(y,g){switch(y){case 1:case 2:case 3:case 4:case 5:break;default:y=3}var I=f;f=y;try{return g()}finally{f=I}},t.unstable_scheduleCallback=function(y,g,I){var P=t.unstable_now();switch(typeof I=="object"&&I!==null?(I=I.delay,I=typeof I=="number"&&0<I?P+I:P):I=P,y){case 1:var L=-1;break;case 2:L=250;break;case 5:L=1073741823;break;case 4:L=1e4;break;default:L=5e3}return L=I+L,y={id:d++,callback:g,priorityLevel:y,startTime:I,expirationTime:L,sortIndex:-1},I>P?(y.sortIndex=I,e(u,y),n(c)===null&&y===n(u)&&(k?(x(Y),Y=-1):k=!0,A(p,I-P))):(y.sortIndex=L,e(c,y),R||_||(R=!0,S($))),y},t.unstable_shouldYield=me,t.unstable_wrapCallback=function(y){var g=f;return function(){var I=f;f=g;try{return y.apply(this,arguments)}finally{f=I}}}})(O_);P_.exports=O_;var jI=P_.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $I=D,Hn=jI;function le(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var L_=new Set,Xa={};function Ai(t,e){To(t,e),To(t+"Capture",e)}function To(t,e){for(Xa[t]=e,t=0;t<e.length;t++)L_.add(e[t])}var Jr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),hh=Object.prototype.hasOwnProperty,FI=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Dm={},Mm={};function UI(t){return hh.call(Mm,t)?!0:hh.call(Dm,t)?!1:FI.test(t)?Mm[t]=!0:(Dm[t]=!0,!1)}function BI(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function zI(t,e,n,r){if(e===null||typeof e>"u"||BI(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function An(t,e,n,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var an={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){an[t]=new An(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];an[e]=new An(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){an[t]=new An(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){an[t]=new An(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){an[t]=new An(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){an[t]=new An(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){an[t]=new An(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){an[t]=new An(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){an[t]=new An(t,5,!1,t.toLowerCase(),null,!1,!1)});var Hp=/[\-:]([a-z])/g;function Wp(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Hp,Wp);an[e]=new An(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Hp,Wp);an[e]=new An(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Hp,Wp);an[e]=new An(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){an[t]=new An(t,1,!1,t.toLowerCase(),null,!1,!1)});an.xlinkHref=new An("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){an[t]=new An(t,1,!1,t.toLowerCase(),null,!0,!0)});function Gp(t,e,n,r){var s=an.hasOwnProperty(e)?an[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(zI(e,n,s,r)&&(n=null),r||s===null?UI(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var is=$I.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,uc=Symbol.for("react.element"),Ji=Symbol.for("react.portal"),qi=Symbol.for("react.fragment"),Vp=Symbol.for("react.strict_mode"),ph=Symbol.for("react.profiler"),D_=Symbol.for("react.provider"),M_=Symbol.for("react.context"),Yp=Symbol.for("react.forward_ref"),gh=Symbol.for("react.suspense"),mh=Symbol.for("react.suspense_list"),Kp=Symbol.for("react.memo"),ms=Symbol.for("react.lazy"),N_=Symbol.for("react.offscreen"),Nm=Symbol.iterator;function ua(t){return t===null||typeof t!="object"?null:(t=Nm&&t[Nm]||t["@@iterator"],typeof t=="function"?t:null)}var jt=Object.assign,If;function Ia(t){if(If===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);If=e&&e[1]||""}return`
`+If+t}var Tf=!1;function Cf(t,e){if(!t||Tf)return"";Tf=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){r=u}t.call(e.prototype)}else{try{throw Error()}catch(u){r=u}t()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var s=u.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,l=i.length-1;1<=o&&0<=l&&s[o]!==i[l];)l--;for(;1<=o&&0<=l;o--,l--)if(s[o]!==i[l]){if(o!==1||l!==1)do if(o--,l--,0>l||s[o]!==i[l]){var c=`
`+s[o].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=o&&0<=l);break}}}finally{Tf=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Ia(t):""}function HI(t){switch(t.tag){case 5:return Ia(t.type);case 16:return Ia("Lazy");case 13:return Ia("Suspense");case 19:return Ia("SuspenseList");case 0:case 2:case 15:return t=Cf(t.type,!1),t;case 11:return t=Cf(t.type.render,!1),t;case 1:return t=Cf(t.type,!0),t;default:return""}}function yh(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case qi:return"Fragment";case Ji:return"Portal";case ph:return"Profiler";case Vp:return"StrictMode";case gh:return"Suspense";case mh:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case M_:return(t.displayName||"Context")+".Consumer";case D_:return(t._context.displayName||"Context")+".Provider";case Yp:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Kp:return e=t.displayName||null,e!==null?e:yh(t.type)||"Memo";case ms:e=t._payload,t=t._init;try{return yh(t(e))}catch{}}return null}function WI(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return yh(e);case 8:return e===Vp?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Ws(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function j_(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function GI(t){var e=j_(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function dc(t){t._valueTracker||(t._valueTracker=GI(t))}function $_(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=j_(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function ou(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function vh(t,e){var n=e.checked;return jt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function jm(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Ws(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function F_(t,e){e=e.checked,e!=null&&Gp(t,"checked",e,!1)}function _h(t,e){F_(t,e);var n=Ws(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?xh(t,e.type,n):e.hasOwnProperty("defaultValue")&&xh(t,e.type,Ws(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function $m(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function xh(t,e,n){(e!=="number"||ou(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Ta=Array.isArray;function fo(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Ws(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function bh(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(le(91));return jt({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Fm(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(le(92));if(Ta(n)){if(1<n.length)throw Error(le(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Ws(n)}}function U_(t,e){var n=Ws(e.value),r=Ws(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function Um(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function B_(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Eh(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?B_(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var fc,z_=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(fc=fc||document.createElement("div"),fc.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=fc.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Qa(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Aa={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},VI=["Webkit","ms","Moz","O"];Object.keys(Aa).forEach(function(t){VI.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Aa[e]=Aa[t]})});function H_(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Aa.hasOwnProperty(t)&&Aa[t]?(""+e).trim():e+"px"}function W_(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=H_(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var YI=jt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Sh(t,e){if(e){if(YI[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(le(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(le(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(le(61))}if(e.style!=null&&typeof e.style!="object")throw Error(le(62))}}function Ih(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Th=null;function Xp(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Ch=null,ho=null,po=null;function Bm(t){if(t=wl(t)){if(typeof Ch!="function")throw Error(le(280));var e=t.stateNode;e&&(e=ld(e),Ch(t.stateNode,t.type,e))}}function G_(t){ho?po?po.push(t):po=[t]:ho=t}function V_(){if(ho){var t=ho,e=po;if(po=ho=null,Bm(t),e)for(t=0;t<e.length;t++)Bm(e[t])}}function Y_(t,e){return t(e)}function K_(){}var wf=!1;function X_(t,e,n){if(wf)return t(e,n);wf=!0;try{return Y_(t,e,n)}finally{wf=!1,(ho!==null||po!==null)&&(K_(),V_())}}function Ja(t,e){var n=t.stateNode;if(n===null)return null;var r=ld(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(le(231,e,typeof n));return n}var wh=!1;if(Jr)try{var da={};Object.defineProperty(da,"passive",{get:function(){wh=!0}}),window.addEventListener("test",da,da),window.removeEventListener("test",da,da)}catch{wh=!1}function KI(t,e,n,r,s,i,o,l,c){var u=Array.prototype.slice.call(arguments,3);try{e.apply(n,u)}catch(d){this.onError(d)}}var Ra=!1,au=null,lu=!1,kh=null,XI={onError:function(t){Ra=!0,au=t}};function QI(t,e,n,r,s,i,o,l,c){Ra=!1,au=null,KI.apply(XI,arguments)}function JI(t,e,n,r,s,i,o,l,c){if(QI.apply(this,arguments),Ra){if(Ra){var u=au;Ra=!1,au=null}else throw Error(le(198));lu||(lu=!0,kh=u)}}function Ri(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function Q_(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function zm(t){if(Ri(t)!==t)throw Error(le(188))}function qI(t){var e=t.alternate;if(!e){if(e=Ri(t),e===null)throw Error(le(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return zm(s),t;if(i===r)return zm(s),e;i=i.sibling}throw Error(le(188))}if(n.return!==r.return)n=s,r=i;else{for(var o=!1,l=s.child;l;){if(l===n){o=!0,n=s,r=i;break}if(l===r){o=!0,r=s,n=i;break}l=l.sibling}if(!o){for(l=i.child;l;){if(l===n){o=!0,n=i,r=s;break}if(l===r){o=!0,r=i,n=s;break}l=l.sibling}if(!o)throw Error(le(189))}}if(n.alternate!==r)throw Error(le(190))}if(n.tag!==3)throw Error(le(188));return n.stateNode.current===n?t:e}function J_(t){return t=qI(t),t!==null?q_(t):null}function q_(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=q_(t);if(e!==null)return e;t=t.sibling}return null}var Z_=Hn.unstable_scheduleCallback,Hm=Hn.unstable_cancelCallback,ZI=Hn.unstable_shouldYield,eT=Hn.unstable_requestPaint,Ut=Hn.unstable_now,tT=Hn.unstable_getCurrentPriorityLevel,Qp=Hn.unstable_ImmediatePriority,ex=Hn.unstable_UserBlockingPriority,cu=Hn.unstable_NormalPriority,nT=Hn.unstable_LowPriority,tx=Hn.unstable_IdlePriority,sd=null,Ar=null;function rT(t){if(Ar&&typeof Ar.onCommitFiberRoot=="function")try{Ar.onCommitFiberRoot(sd,t,void 0,(t.current.flags&128)===128)}catch{}}var gr=Math.clz32?Math.clz32:oT,sT=Math.log,iT=Math.LN2;function oT(t){return t>>>=0,t===0?32:31-(sT(t)/iT|0)|0}var hc=64,pc=4194304;function Ca(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function uu(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,o=n&268435455;if(o!==0){var l=o&~s;l!==0?r=Ca(l):(i&=o,i!==0&&(r=Ca(i)))}else o=n&~s,o!==0?r=Ca(o):i!==0&&(r=Ca(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-gr(e),s=1<<n,r|=t[n],e&=~s;return r}function aT(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function lT(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var o=31-gr(i),l=1<<o,c=s[o];c===-1?(!(l&n)||l&r)&&(s[o]=aT(l,e)):c<=e&&(t.expiredLanes|=l),i&=~l}}function Ah(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function nx(){var t=hc;return hc<<=1,!(hc&4194240)&&(hc=64),t}function kf(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Tl(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-gr(e),t[e]=n}function cT(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-gr(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function Jp(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-gr(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var vt=0;function rx(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var sx,qp,ix,ox,ax,Rh=!1,gc=[],As=null,Rs=null,Ps=null,qa=new Map,Za=new Map,vs=[],uT="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Wm(t,e){switch(t){case"focusin":case"focusout":As=null;break;case"dragenter":case"dragleave":Rs=null;break;case"mouseover":case"mouseout":Ps=null;break;case"pointerover":case"pointerout":qa.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Za.delete(e.pointerId)}}function fa(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=wl(e),e!==null&&qp(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function dT(t,e,n,r,s){switch(e){case"focusin":return As=fa(As,t,e,n,r,s),!0;case"dragenter":return Rs=fa(Rs,t,e,n,r,s),!0;case"mouseover":return Ps=fa(Ps,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return qa.set(i,fa(qa.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,Za.set(i,fa(Za.get(i)||null,t,e,n,r,s)),!0}return!1}function lx(t){var e=di(t.target);if(e!==null){var n=Ri(e);if(n!==null){if(e=n.tag,e===13){if(e=Q_(n),e!==null){t.blockedOn=e,ax(t.priority,function(){ix(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function jc(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Ph(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);Th=r,n.target.dispatchEvent(r),Th=null}else return e=wl(n),e!==null&&qp(e),t.blockedOn=n,!1;e.shift()}return!0}function Gm(t,e,n){jc(t)&&n.delete(e)}function fT(){Rh=!1,As!==null&&jc(As)&&(As=null),Rs!==null&&jc(Rs)&&(Rs=null),Ps!==null&&jc(Ps)&&(Ps=null),qa.forEach(Gm),Za.forEach(Gm)}function ha(t,e){t.blockedOn===e&&(t.blockedOn=null,Rh||(Rh=!0,Hn.unstable_scheduleCallback(Hn.unstable_NormalPriority,fT)))}function el(t){function e(s){return ha(s,t)}if(0<gc.length){ha(gc[0],t);for(var n=1;n<gc.length;n++){var r=gc[n];r.blockedOn===t&&(r.blockedOn=null)}}for(As!==null&&ha(As,t),Rs!==null&&ha(Rs,t),Ps!==null&&ha(Ps,t),qa.forEach(e),Za.forEach(e),n=0;n<vs.length;n++)r=vs[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<vs.length&&(n=vs[0],n.blockedOn===null);)lx(n),n.blockedOn===null&&vs.shift()}var go=is.ReactCurrentBatchConfig,du=!0;function hT(t,e,n,r){var s=vt,i=go.transition;go.transition=null;try{vt=1,Zp(t,e,n,r)}finally{vt=s,go.transition=i}}function pT(t,e,n,r){var s=vt,i=go.transition;go.transition=null;try{vt=4,Zp(t,e,n,r)}finally{vt=s,go.transition=i}}function Zp(t,e,n,r){if(du){var s=Ph(t,e,n,r);if(s===null)$f(t,e,r,fu,n),Wm(t,r);else if(dT(s,t,e,n,r))r.stopPropagation();else if(Wm(t,r),e&4&&-1<uT.indexOf(t)){for(;s!==null;){var i=wl(s);if(i!==null&&sx(i),i=Ph(t,e,n,r),i===null&&$f(t,e,r,fu,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else $f(t,e,r,null,n)}}var fu=null;function Ph(t,e,n,r){if(fu=null,t=Xp(r),t=di(t),t!==null)if(e=Ri(t),e===null)t=null;else if(n=e.tag,n===13){if(t=Q_(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return fu=t,null}function cx(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(tT()){case Qp:return 1;case ex:return 4;case cu:case nT:return 16;case tx:return 536870912;default:return 16}default:return 16}}var Is=null,eg=null,$c=null;function ux(){if($c)return $c;var t,e=eg,n=e.length,r,s="value"in Is?Is.value:Is.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===s[i-r];r++);return $c=s.slice(t,1<r?1-r:void 0)}function Fc(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function mc(){return!0}function Vm(){return!1}function Vn(t){function e(n,r,s,i,o){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(i):i[l]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?mc:Vm,this.isPropagationStopped=Vm,this}return jt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=mc)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=mc)},persist:function(){},isPersistent:mc}),e}var Bo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},tg=Vn(Bo),Cl=jt({},Bo,{view:0,detail:0}),gT=Vn(Cl),Af,Rf,pa,id=jt({},Cl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ng,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==pa&&(pa&&t.type==="mousemove"?(Af=t.screenX-pa.screenX,Rf=t.screenY-pa.screenY):Rf=Af=0,pa=t),Af)},movementY:function(t){return"movementY"in t?t.movementY:Rf}}),Ym=Vn(id),mT=jt({},id,{dataTransfer:0}),yT=Vn(mT),vT=jt({},Cl,{relatedTarget:0}),Pf=Vn(vT),_T=jt({},Bo,{animationName:0,elapsedTime:0,pseudoElement:0}),xT=Vn(_T),bT=jt({},Bo,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),ET=Vn(bT),ST=jt({},Bo,{data:0}),Km=Vn(ST),IT={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},TT={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},CT={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function wT(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=CT[t])?!!e[t]:!1}function ng(){return wT}var kT=jt({},Cl,{key:function(t){if(t.key){var e=IT[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Fc(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?TT[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ng,charCode:function(t){return t.type==="keypress"?Fc(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Fc(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),AT=Vn(kT),RT=jt({},id,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Xm=Vn(RT),PT=jt({},Cl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ng}),OT=Vn(PT),LT=jt({},Bo,{propertyName:0,elapsedTime:0,pseudoElement:0}),DT=Vn(LT),MT=jt({},id,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),NT=Vn(MT),jT=[9,13,27,32],rg=Jr&&"CompositionEvent"in window,Pa=null;Jr&&"documentMode"in document&&(Pa=document.documentMode);var $T=Jr&&"TextEvent"in window&&!Pa,dx=Jr&&(!rg||Pa&&8<Pa&&11>=Pa),Qm=" ",Jm=!1;function fx(t,e){switch(t){case"keyup":return jT.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function hx(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Zi=!1;function FT(t,e){switch(t){case"compositionend":return hx(e);case"keypress":return e.which!==32?null:(Jm=!0,Qm);case"textInput":return t=e.data,t===Qm&&Jm?null:t;default:return null}}function UT(t,e){if(Zi)return t==="compositionend"||!rg&&fx(t,e)?(t=ux(),$c=eg=Is=null,Zi=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return dx&&e.locale!=="ko"?null:e.data;default:return null}}var BT={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function qm(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!BT[t.type]:e==="textarea"}function px(t,e,n,r){G_(r),e=hu(e,"onChange"),0<e.length&&(n=new tg("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Oa=null,tl=null;function zT(t){Tx(t,0)}function od(t){var e=no(t);if($_(e))return t}function HT(t,e){if(t==="change")return e}var gx=!1;if(Jr){var Of;if(Jr){var Lf="oninput"in document;if(!Lf){var Zm=document.createElement("div");Zm.setAttribute("oninput","return;"),Lf=typeof Zm.oninput=="function"}Of=Lf}else Of=!1;gx=Of&&(!document.documentMode||9<document.documentMode)}function ey(){Oa&&(Oa.detachEvent("onpropertychange",mx),tl=Oa=null)}function mx(t){if(t.propertyName==="value"&&od(tl)){var e=[];px(e,tl,t,Xp(t)),X_(zT,e)}}function WT(t,e,n){t==="focusin"?(ey(),Oa=e,tl=n,Oa.attachEvent("onpropertychange",mx)):t==="focusout"&&ey()}function GT(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return od(tl)}function VT(t,e){if(t==="click")return od(e)}function YT(t,e){if(t==="input"||t==="change")return od(e)}function KT(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var vr=typeof Object.is=="function"?Object.is:KT;function nl(t,e){if(vr(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!hh.call(e,s)||!vr(t[s],e[s]))return!1}return!0}function ty(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function ny(t,e){var n=ty(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=ty(n)}}function yx(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?yx(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function vx(){for(var t=window,e=ou();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=ou(t.document)}return e}function sg(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function XT(t){var e=vx(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&yx(n.ownerDocument.documentElement,n)){if(r!==null&&sg(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=ny(n,i);var o=ny(n,r);s&&o&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var QT=Jr&&"documentMode"in document&&11>=document.documentMode,eo=null,Oh=null,La=null,Lh=!1;function ry(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Lh||eo==null||eo!==ou(r)||(r=eo,"selectionStart"in r&&sg(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),La&&nl(La,r)||(La=r,r=hu(Oh,"onSelect"),0<r.length&&(e=new tg("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=eo)))}function yc(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var to={animationend:yc("Animation","AnimationEnd"),animationiteration:yc("Animation","AnimationIteration"),animationstart:yc("Animation","AnimationStart"),transitionend:yc("Transition","TransitionEnd")},Df={},_x={};Jr&&(_x=document.createElement("div").style,"AnimationEvent"in window||(delete to.animationend.animation,delete to.animationiteration.animation,delete to.animationstart.animation),"TransitionEvent"in window||delete to.transitionend.transition);function ad(t){if(Df[t])return Df[t];if(!to[t])return t;var e=to[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in _x)return Df[t]=e[n];return t}var xx=ad("animationend"),bx=ad("animationiteration"),Ex=ad("animationstart"),Sx=ad("transitionend"),Ix=new Map,sy="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Js(t,e){Ix.set(t,e),Ai(e,[t])}for(var Mf=0;Mf<sy.length;Mf++){var Nf=sy[Mf],JT=Nf.toLowerCase(),qT=Nf[0].toUpperCase()+Nf.slice(1);Js(JT,"on"+qT)}Js(xx,"onAnimationEnd");Js(bx,"onAnimationIteration");Js(Ex,"onAnimationStart");Js("dblclick","onDoubleClick");Js("focusin","onFocus");Js("focusout","onBlur");Js(Sx,"onTransitionEnd");To("onMouseEnter",["mouseout","mouseover"]);To("onMouseLeave",["mouseout","mouseover"]);To("onPointerEnter",["pointerout","pointerover"]);To("onPointerLeave",["pointerout","pointerover"]);Ai("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ai("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ai("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ai("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ai("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ai("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var wa="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ZT=new Set("cancel close invalid load scroll toggle".split(" ").concat(wa));function iy(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,JI(r,e,void 0,t),t.currentTarget=null}function Tx(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var l=r[o],c=l.instance,u=l.currentTarget;if(l=l.listener,c!==i&&s.isPropagationStopped())break e;iy(s,l,u),i=c}else for(o=0;o<r.length;o++){if(l=r[o],c=l.instance,u=l.currentTarget,l=l.listener,c!==i&&s.isPropagationStopped())break e;iy(s,l,u),i=c}}}if(lu)throw t=kh,lu=!1,kh=null,t}function kt(t,e){var n=e[$h];n===void 0&&(n=e[$h]=new Set);var r=t+"__bubble";n.has(r)||(Cx(e,t,2,!1),n.add(r))}function jf(t,e,n){var r=0;e&&(r|=4),Cx(n,t,r,e)}var vc="_reactListening"+Math.random().toString(36).slice(2);function rl(t){if(!t[vc]){t[vc]=!0,L_.forEach(function(n){n!=="selectionchange"&&(ZT.has(n)||jf(n,!1,t),jf(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[vc]||(e[vc]=!0,jf("selectionchange",!1,e))}}function Cx(t,e,n,r){switch(cx(e)){case 1:var s=hT;break;case 4:s=pT;break;default:s=Zp}n=s.bind(null,e,n,t),s=void 0,!wh||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function $f(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var l=r.stateNode.containerInfo;if(l===s||l.nodeType===8&&l.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===s||c.nodeType===8&&c.parentNode===s))return;o=o.return}for(;l!==null;){if(o=di(l),o===null)return;if(c=o.tag,c===5||c===6){r=i=o;continue e}l=l.parentNode}}r=r.return}X_(function(){var u=i,d=Xp(n),h=[];e:{var f=Ix.get(t);if(f!==void 0){var _=tg,R=t;switch(t){case"keypress":if(Fc(n)===0)break e;case"keydown":case"keyup":_=AT;break;case"focusin":R="focus",_=Pf;break;case"focusout":R="blur",_=Pf;break;case"beforeblur":case"afterblur":_=Pf;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":_=Ym;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":_=yT;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":_=OT;break;case xx:case bx:case Ex:_=xT;break;case Sx:_=DT;break;case"scroll":_=gT;break;case"wheel":_=NT;break;case"copy":case"cut":case"paste":_=ET;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":_=Xm}var k=(e&4)!==0,B=!k&&t==="scroll",x=k?f!==null?f+"Capture":null:f;k=[];for(var E=u,T;E!==null;){T=E;var p=T.stateNode;if(T.tag===5&&p!==null&&(T=p,x!==null&&(p=Ja(E,x),p!=null&&k.push(sl(E,p,T)))),B)break;E=E.return}0<k.length&&(f=new _(f,R,null,n,d),h.push({event:f,listeners:k}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",_=t==="mouseout"||t==="pointerout",f&&n!==Th&&(R=n.relatedTarget||n.fromElement)&&(di(R)||R[qr]))break e;if((_||f)&&(f=d.window===d?d:(f=d.ownerDocument)?f.defaultView||f.parentWindow:window,_?(R=n.relatedTarget||n.toElement,_=u,R=R?di(R):null,R!==null&&(B=Ri(R),R!==B||R.tag!==5&&R.tag!==6)&&(R=null)):(_=null,R=u),_!==R)){if(k=Ym,p="onMouseLeave",x="onMouseEnter",E="mouse",(t==="pointerout"||t==="pointerover")&&(k=Xm,p="onPointerLeave",x="onPointerEnter",E="pointer"),B=_==null?f:no(_),T=R==null?f:no(R),f=new k(p,E+"leave",_,n,d),f.target=B,f.relatedTarget=T,p=null,di(d)===u&&(k=new k(x,E+"enter",R,n,d),k.target=T,k.relatedTarget=B,p=k),B=p,_&&R)t:{for(k=_,x=R,E=0,T=k;T;T=Yi(T))E++;for(T=0,p=x;p;p=Yi(p))T++;for(;0<E-T;)k=Yi(k),E--;for(;0<T-E;)x=Yi(x),T--;for(;E--;){if(k===x||x!==null&&k===x.alternate)break t;k=Yi(k),x=Yi(x)}k=null}else k=null;_!==null&&oy(h,f,_,k,!1),R!==null&&B!==null&&oy(h,B,R,k,!0)}}e:{if(f=u?no(u):window,_=f.nodeName&&f.nodeName.toLowerCase(),_==="select"||_==="input"&&f.type==="file")var $=HT;else if(qm(f))if(gx)$=YT;else{$=GT;var C=WT}else(_=f.nodeName)&&_.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&($=VT);if($&&($=$(t,u))){px(h,$,n,d);break e}C&&C(t,f,u),t==="focusout"&&(C=f._wrapperState)&&C.controlled&&f.type==="number"&&xh(f,"number",f.value)}switch(C=u?no(u):window,t){case"focusin":(qm(C)||C.contentEditable==="true")&&(eo=C,Oh=u,La=null);break;case"focusout":La=Oh=eo=null;break;case"mousedown":Lh=!0;break;case"contextmenu":case"mouseup":case"dragend":Lh=!1,ry(h,n,d);break;case"selectionchange":if(QT)break;case"keydown":case"keyup":ry(h,n,d)}var re;if(rg)e:{switch(t){case"compositionstart":var Y="onCompositionStart";break e;case"compositionend":Y="onCompositionEnd";break e;case"compositionupdate":Y="onCompositionUpdate";break e}Y=void 0}else Zi?fx(t,n)&&(Y="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(Y="onCompositionStart");Y&&(dx&&n.locale!=="ko"&&(Zi||Y!=="onCompositionStart"?Y==="onCompositionEnd"&&Zi&&(re=ux()):(Is=d,eg="value"in Is?Is.value:Is.textContent,Zi=!0)),C=hu(u,Y),0<C.length&&(Y=new Km(Y,t,null,n,d),h.push({event:Y,listeners:C}),re?Y.data=re:(re=hx(n),re!==null&&(Y.data=re)))),(re=$T?FT(t,n):UT(t,n))&&(u=hu(u,"onBeforeInput"),0<u.length&&(d=new Km("onBeforeInput","beforeinput",null,n,d),h.push({event:d,listeners:u}),d.data=re))}Tx(h,e)})}function sl(t,e,n){return{instance:t,listener:e,currentTarget:n}}function hu(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=Ja(t,n),i!=null&&r.unshift(sl(t,i,s)),i=Ja(t,e),i!=null&&r.push(sl(t,i,s))),t=t.return}return r}function Yi(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function oy(t,e,n,r,s){for(var i=e._reactName,o=[];n!==null&&n!==r;){var l=n,c=l.alternate,u=l.stateNode;if(c!==null&&c===r)break;l.tag===5&&u!==null&&(l=u,s?(c=Ja(n,i),c!=null&&o.unshift(sl(n,c,l))):s||(c=Ja(n,i),c!=null&&o.push(sl(n,c,l)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var e2=/\r\n?/g,t2=/\u0000|\uFFFD/g;function ay(t){return(typeof t=="string"?t:""+t).replace(e2,`
`).replace(t2,"")}function _c(t,e,n){if(e=ay(e),ay(t)!==e&&n)throw Error(le(425))}function pu(){}var Dh=null,Mh=null;function Nh(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var jh=typeof setTimeout=="function"?setTimeout:void 0,n2=typeof clearTimeout=="function"?clearTimeout:void 0,ly=typeof Promise=="function"?Promise:void 0,r2=typeof queueMicrotask=="function"?queueMicrotask:typeof ly<"u"?function(t){return ly.resolve(null).then(t).catch(s2)}:jh;function s2(t){setTimeout(function(){throw t})}function Ff(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),el(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);el(e)}function Os(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function cy(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var zo=Math.random().toString(36).slice(2),wr="__reactFiber$"+zo,il="__reactProps$"+zo,qr="__reactContainer$"+zo,$h="__reactEvents$"+zo,i2="__reactListeners$"+zo,o2="__reactHandles$"+zo;function di(t){var e=t[wr];if(e)return e;for(var n=t.parentNode;n;){if(e=n[qr]||n[wr]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=cy(t);t!==null;){if(n=t[wr])return n;t=cy(t)}return e}t=n,n=t.parentNode}return null}function wl(t){return t=t[wr]||t[qr],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function no(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(le(33))}function ld(t){return t[il]||null}var Fh=[],ro=-1;function qs(t){return{current:t}}function At(t){0>ro||(t.current=Fh[ro],Fh[ro]=null,ro--)}function wt(t,e){ro++,Fh[ro]=t.current,t.current=e}var Gs={},gn=qs(Gs),Mn=qs(!1),yi=Gs;function Co(t,e){var n=t.type.contextTypes;if(!n)return Gs;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function Nn(t){return t=t.childContextTypes,t!=null}function gu(){At(Mn),At(gn)}function uy(t,e,n){if(gn.current!==Gs)throw Error(le(168));wt(gn,e),wt(Mn,n)}function wx(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(le(108,WI(t)||"Unknown",s));return jt({},n,r)}function mu(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Gs,yi=gn.current,wt(gn,t),wt(Mn,Mn.current),!0}function dy(t,e,n){var r=t.stateNode;if(!r)throw Error(le(169));n?(t=wx(t,e,yi),r.__reactInternalMemoizedMergedChildContext=t,At(Mn),At(gn),wt(gn,t)):At(Mn),wt(Mn,n)}var Ur=null,cd=!1,Uf=!1;function kx(t){Ur===null?Ur=[t]:Ur.push(t)}function a2(t){cd=!0,kx(t)}function Zs(){if(!Uf&&Ur!==null){Uf=!0;var t=0,e=vt;try{var n=Ur;for(vt=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}Ur=null,cd=!1}catch(s){throw Ur!==null&&(Ur=Ur.slice(t+1)),Z_(Qp,Zs),s}finally{vt=e,Uf=!1}}return null}var so=[],io=0,yu=null,vu=0,Xn=[],Qn=0,vi=null,zr=1,Hr="";function oi(t,e){so[io++]=vu,so[io++]=yu,yu=t,vu=e}function Ax(t,e,n){Xn[Qn++]=zr,Xn[Qn++]=Hr,Xn[Qn++]=vi,vi=t;var r=zr;t=Hr;var s=32-gr(r)-1;r&=~(1<<s),n+=1;var i=32-gr(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,zr=1<<32-gr(e)+s|n<<s|r,Hr=i+t}else zr=1<<i|n<<s|r,Hr=t}function ig(t){t.return!==null&&(oi(t,1),Ax(t,1,0))}function og(t){for(;t===yu;)yu=so[--io],so[io]=null,vu=so[--io],so[io]=null;for(;t===vi;)vi=Xn[--Qn],Xn[Qn]=null,Hr=Xn[--Qn],Xn[Qn]=null,zr=Xn[--Qn],Xn[Qn]=null}var zn=null,Bn=null,Pt=!1,cr=null;function Rx(t,e){var n=qn(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function fy(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,zn=t,Bn=Os(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,zn=t,Bn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=vi!==null?{id:zr,overflow:Hr}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=qn(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,zn=t,Bn=null,!0):!1;default:return!1}}function Uh(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Bh(t){if(Pt){var e=Bn;if(e){var n=e;if(!fy(t,e)){if(Uh(t))throw Error(le(418));e=Os(n.nextSibling);var r=zn;e&&fy(t,e)?Rx(r,n):(t.flags=t.flags&-4097|2,Pt=!1,zn=t)}}else{if(Uh(t))throw Error(le(418));t.flags=t.flags&-4097|2,Pt=!1,zn=t}}}function hy(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;zn=t}function xc(t){if(t!==zn)return!1;if(!Pt)return hy(t),Pt=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Nh(t.type,t.memoizedProps)),e&&(e=Bn)){if(Uh(t))throw Px(),Error(le(418));for(;e;)Rx(t,e),e=Os(e.nextSibling)}if(hy(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(le(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Bn=Os(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Bn=null}}else Bn=zn?Os(t.stateNode.nextSibling):null;return!0}function Px(){for(var t=Bn;t;)t=Os(t.nextSibling)}function wo(){Bn=zn=null,Pt=!1}function ag(t){cr===null?cr=[t]:cr.push(t)}var l2=is.ReactCurrentBatchConfig;function ga(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(le(309));var r=n.stateNode}if(!r)throw Error(le(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var l=s.refs;o===null?delete l[i]:l[i]=o},e._stringRef=i,e)}if(typeof t!="string")throw Error(le(284));if(!n._owner)throw Error(le(290,t))}return t}function bc(t,e){throw t=Object.prototype.toString.call(e),Error(le(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function py(t){var e=t._init;return e(t._payload)}function Ox(t){function e(x,E){if(t){var T=x.deletions;T===null?(x.deletions=[E],x.flags|=16):T.push(E)}}function n(x,E){if(!t)return null;for(;E!==null;)e(x,E),E=E.sibling;return null}function r(x,E){for(x=new Map;E!==null;)E.key!==null?x.set(E.key,E):x.set(E.index,E),E=E.sibling;return x}function s(x,E){return x=Ns(x,E),x.index=0,x.sibling=null,x}function i(x,E,T){return x.index=T,t?(T=x.alternate,T!==null?(T=T.index,T<E?(x.flags|=2,E):T):(x.flags|=2,E)):(x.flags|=1048576,E)}function o(x){return t&&x.alternate===null&&(x.flags|=2),x}function l(x,E,T,p){return E===null||E.tag!==6?(E=Yf(T,x.mode,p),E.return=x,E):(E=s(E,T),E.return=x,E)}function c(x,E,T,p){var $=T.type;return $===qi?d(x,E,T.props.children,p,T.key):E!==null&&(E.elementType===$||typeof $=="object"&&$!==null&&$.$$typeof===ms&&py($)===E.type)?(p=s(E,T.props),p.ref=ga(x,E,T),p.return=x,p):(p=Vc(T.type,T.key,T.props,null,x.mode,p),p.ref=ga(x,E,T),p.return=x,p)}function u(x,E,T,p){return E===null||E.tag!==4||E.stateNode.containerInfo!==T.containerInfo||E.stateNode.implementation!==T.implementation?(E=Kf(T,x.mode,p),E.return=x,E):(E=s(E,T.children||[]),E.return=x,E)}function d(x,E,T,p,$){return E===null||E.tag!==7?(E=mi(T,x.mode,p,$),E.return=x,E):(E=s(E,T),E.return=x,E)}function h(x,E,T){if(typeof E=="string"&&E!==""||typeof E=="number")return E=Yf(""+E,x.mode,T),E.return=x,E;if(typeof E=="object"&&E!==null){switch(E.$$typeof){case uc:return T=Vc(E.type,E.key,E.props,null,x.mode,T),T.ref=ga(x,null,E),T.return=x,T;case Ji:return E=Kf(E,x.mode,T),E.return=x,E;case ms:var p=E._init;return h(x,p(E._payload),T)}if(Ta(E)||ua(E))return E=mi(E,x.mode,T,null),E.return=x,E;bc(x,E)}return null}function f(x,E,T,p){var $=E!==null?E.key:null;if(typeof T=="string"&&T!==""||typeof T=="number")return $!==null?null:l(x,E,""+T,p);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case uc:return T.key===$?c(x,E,T,p):null;case Ji:return T.key===$?u(x,E,T,p):null;case ms:return $=T._init,f(x,E,$(T._payload),p)}if(Ta(T)||ua(T))return $!==null?null:d(x,E,T,p,null);bc(x,T)}return null}function _(x,E,T,p,$){if(typeof p=="string"&&p!==""||typeof p=="number")return x=x.get(T)||null,l(E,x,""+p,$);if(typeof p=="object"&&p!==null){switch(p.$$typeof){case uc:return x=x.get(p.key===null?T:p.key)||null,c(E,x,p,$);case Ji:return x=x.get(p.key===null?T:p.key)||null,u(E,x,p,$);case ms:var C=p._init;return _(x,E,T,C(p._payload),$)}if(Ta(p)||ua(p))return x=x.get(T)||null,d(E,x,p,$,null);bc(E,p)}return null}function R(x,E,T,p){for(var $=null,C=null,re=E,Y=E=0,K=null;re!==null&&Y<T.length;Y++){re.index>Y?(K=re,re=null):K=re.sibling;var ce=f(x,re,T[Y],p);if(ce===null){re===null&&(re=K);break}t&&re&&ce.alternate===null&&e(x,re),E=i(ce,E,Y),C===null?$=ce:C.sibling=ce,C=ce,re=K}if(Y===T.length)return n(x,re),Pt&&oi(x,Y),$;if(re===null){for(;Y<T.length;Y++)re=h(x,T[Y],p),re!==null&&(E=i(re,E,Y),C===null?$=re:C.sibling=re,C=re);return Pt&&oi(x,Y),$}for(re=r(x,re);Y<T.length;Y++)K=_(re,x,Y,T[Y],p),K!==null&&(t&&K.alternate!==null&&re.delete(K.key===null?Y:K.key),E=i(K,E,Y),C===null?$=K:C.sibling=K,C=K);return t&&re.forEach(function(me){return e(x,me)}),Pt&&oi(x,Y),$}function k(x,E,T,p){var $=ua(T);if(typeof $!="function")throw Error(le(150));if(T=$.call(T),T==null)throw Error(le(151));for(var C=$=null,re=E,Y=E=0,K=null,ce=T.next();re!==null&&!ce.done;Y++,ce=T.next()){re.index>Y?(K=re,re=null):K=re.sibling;var me=f(x,re,ce.value,p);if(me===null){re===null&&(re=K);break}t&&re&&me.alternate===null&&e(x,re),E=i(me,E,Y),C===null?$=me:C.sibling=me,C=me,re=K}if(ce.done)return n(x,re),Pt&&oi(x,Y),$;if(re===null){for(;!ce.done;Y++,ce=T.next())ce=h(x,ce.value,p),ce!==null&&(E=i(ce,E,Y),C===null?$=ce:C.sibling=ce,C=ce);return Pt&&oi(x,Y),$}for(re=r(x,re);!ce.done;Y++,ce=T.next())ce=_(re,x,Y,ce.value,p),ce!==null&&(t&&ce.alternate!==null&&re.delete(ce.key===null?Y:ce.key),E=i(ce,E,Y),C===null?$=ce:C.sibling=ce,C=ce);return t&&re.forEach(function(Se){return e(x,Se)}),Pt&&oi(x,Y),$}function B(x,E,T,p){if(typeof T=="object"&&T!==null&&T.type===qi&&T.key===null&&(T=T.props.children),typeof T=="object"&&T!==null){switch(T.$$typeof){case uc:e:{for(var $=T.key,C=E;C!==null;){if(C.key===$){if($=T.type,$===qi){if(C.tag===7){n(x,C.sibling),E=s(C,T.props.children),E.return=x,x=E;break e}}else if(C.elementType===$||typeof $=="object"&&$!==null&&$.$$typeof===ms&&py($)===C.type){n(x,C.sibling),E=s(C,T.props),E.ref=ga(x,C,T),E.return=x,x=E;break e}n(x,C);break}else e(x,C);C=C.sibling}T.type===qi?(E=mi(T.props.children,x.mode,p,T.key),E.return=x,x=E):(p=Vc(T.type,T.key,T.props,null,x.mode,p),p.ref=ga(x,E,T),p.return=x,x=p)}return o(x);case Ji:e:{for(C=T.key;E!==null;){if(E.key===C)if(E.tag===4&&E.stateNode.containerInfo===T.containerInfo&&E.stateNode.implementation===T.implementation){n(x,E.sibling),E=s(E,T.children||[]),E.return=x,x=E;break e}else{n(x,E);break}else e(x,E);E=E.sibling}E=Kf(T,x.mode,p),E.return=x,x=E}return o(x);case ms:return C=T._init,B(x,E,C(T._payload),p)}if(Ta(T))return R(x,E,T,p);if(ua(T))return k(x,E,T,p);bc(x,T)}return typeof T=="string"&&T!==""||typeof T=="number"?(T=""+T,E!==null&&E.tag===6?(n(x,E.sibling),E=s(E,T),E.return=x,x=E):(n(x,E),E=Yf(T,x.mode,p),E.return=x,x=E),o(x)):n(x,E)}return B}var ko=Ox(!0),Lx=Ox(!1),_u=qs(null),xu=null,oo=null,lg=null;function cg(){lg=oo=xu=null}function ug(t){var e=_u.current;At(_u),t._currentValue=e}function zh(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function mo(t,e){xu=t,lg=oo=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Ln=!0),t.firstContext=null)}function tr(t){var e=t._currentValue;if(lg!==t)if(t={context:t,memoizedValue:e,next:null},oo===null){if(xu===null)throw Error(le(308));oo=t,xu.dependencies={lanes:0,firstContext:t}}else oo=oo.next=t;return e}var fi=null;function dg(t){fi===null?fi=[t]:fi.push(t)}function Dx(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,dg(e)):(n.next=s.next,s.next=n),e.interleaved=n,Zr(t,r)}function Zr(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var ys=!1;function fg(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Mx(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Xr(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Ls(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,ut&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,Zr(t,n)}return s=r.interleaved,s===null?(e.next=e,dg(r)):(e.next=s.next,s.next=e),r.interleaved=e,Zr(t,n)}function Uc(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Jp(t,n)}}function gy(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=o:i=i.next=o,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function bu(t,e,n,r){var s=t.updateQueue;ys=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,l=s.shared.pending;if(l!==null){s.shared.pending=null;var c=l,u=c.next;c.next=null,o===null?i=u:o.next=u,o=c;var d=t.alternate;d!==null&&(d=d.updateQueue,l=d.lastBaseUpdate,l!==o&&(l===null?d.firstBaseUpdate=u:l.next=u,d.lastBaseUpdate=c))}if(i!==null){var h=s.baseState;o=0,d=u=c=null,l=i;do{var f=l.lane,_=l.eventTime;if((r&f)===f){d!==null&&(d=d.next={eventTime:_,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var R=t,k=l;switch(f=e,_=n,k.tag){case 1:if(R=k.payload,typeof R=="function"){h=R.call(_,h,f);break e}h=R;break e;case 3:R.flags=R.flags&-65537|128;case 0:if(R=k.payload,f=typeof R=="function"?R.call(_,h,f):R,f==null)break e;h=jt({},h,f);break e;case 2:ys=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,f=s.effects,f===null?s.effects=[l]:f.push(l))}else _={eventTime:_,lane:f,tag:l.tag,payload:l.payload,callback:l.callback,next:null},d===null?(u=d=_,c=h):d=d.next=_,o|=f;if(l=l.next,l===null){if(l=s.shared.pending,l===null)break;f=l,l=f.next,f.next=null,s.lastBaseUpdate=f,s.shared.pending=null}}while(!0);if(d===null&&(c=h),s.baseState=c,s.firstBaseUpdate=u,s.lastBaseUpdate=d,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);xi|=o,t.lanes=o,t.memoizedState=h}}function my(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(le(191,s));s.call(r)}}}var kl={},Rr=qs(kl),ol=qs(kl),al=qs(kl);function hi(t){if(t===kl)throw Error(le(174));return t}function hg(t,e){switch(wt(al,e),wt(ol,t),wt(Rr,kl),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Eh(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Eh(e,t)}At(Rr),wt(Rr,e)}function Ao(){At(Rr),At(ol),At(al)}function Nx(t){hi(al.current);var e=hi(Rr.current),n=Eh(e,t.type);e!==n&&(wt(ol,t),wt(Rr,n))}function pg(t){ol.current===t&&(At(Rr),At(ol))}var Lt=qs(0);function Eu(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Bf=[];function gg(){for(var t=0;t<Bf.length;t++)Bf[t]._workInProgressVersionPrimary=null;Bf.length=0}var Bc=is.ReactCurrentDispatcher,zf=is.ReactCurrentBatchConfig,_i=0,Nt=null,Vt=null,Qt=null,Su=!1,Da=!1,ll=0,c2=0;function dn(){throw Error(le(321))}function mg(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!vr(t[n],e[n]))return!1;return!0}function yg(t,e,n,r,s,i){if(_i=i,Nt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Bc.current=t===null||t.memoizedState===null?h2:p2,t=n(r,s),Da){i=0;do{if(Da=!1,ll=0,25<=i)throw Error(le(301));i+=1,Qt=Vt=null,e.updateQueue=null,Bc.current=g2,t=n(r,s)}while(Da)}if(Bc.current=Iu,e=Vt!==null&&Vt.next!==null,_i=0,Qt=Vt=Nt=null,Su=!1,e)throw Error(le(300));return t}function vg(){var t=ll!==0;return ll=0,t}function Cr(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Qt===null?Nt.memoizedState=Qt=t:Qt=Qt.next=t,Qt}function nr(){if(Vt===null){var t=Nt.alternate;t=t!==null?t.memoizedState:null}else t=Vt.next;var e=Qt===null?Nt.memoizedState:Qt.next;if(e!==null)Qt=e,Vt=t;else{if(t===null)throw Error(le(310));Vt=t,t={memoizedState:Vt.memoizedState,baseState:Vt.baseState,baseQueue:Vt.baseQueue,queue:Vt.queue,next:null},Qt===null?Nt.memoizedState=Qt=t:Qt=Qt.next=t}return Qt}function cl(t,e){return typeof e=="function"?e(t):e}function Hf(t){var e=nr(),n=e.queue;if(n===null)throw Error(le(311));n.lastRenderedReducer=t;var r=Vt,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var l=o=null,c=null,u=i;do{var d=u.lane;if((_i&d)===d)c!==null&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:t(r,u.action);else{var h={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};c===null?(l=c=h,o=r):c=c.next=h,Nt.lanes|=d,xi|=d}u=u.next}while(u!==null&&u!==i);c===null?o=r:c.next=l,vr(r,e.memoizedState)||(Ln=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=c,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,Nt.lanes|=i,xi|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Wf(t){var e=nr(),n=e.queue;if(n===null)throw Error(le(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var o=s=s.next;do i=t(i,o.action),o=o.next;while(o!==s);vr(i,e.memoizedState)||(Ln=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function jx(){}function $x(t,e){var n=Nt,r=nr(),s=e(),i=!vr(r.memoizedState,s);if(i&&(r.memoizedState=s,Ln=!0),r=r.queue,_g(Bx.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||Qt!==null&&Qt.memoizedState.tag&1){if(n.flags|=2048,ul(9,Ux.bind(null,n,r,s,e),void 0,null),Zt===null)throw Error(le(349));_i&30||Fx(n,e,s)}return s}function Fx(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Nt.updateQueue,e===null?(e={lastEffect:null,stores:null},Nt.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function Ux(t,e,n,r){e.value=n,e.getSnapshot=r,zx(e)&&Hx(t)}function Bx(t,e,n){return n(function(){zx(e)&&Hx(t)})}function zx(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!vr(t,n)}catch{return!0}}function Hx(t){var e=Zr(t,1);e!==null&&mr(e,t,1,-1)}function yy(t){var e=Cr();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:cl,lastRenderedState:t},e.queue=t,t=t.dispatch=f2.bind(null,Nt,t),[e.memoizedState,t]}function ul(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=Nt.updateQueue,e===null?(e={lastEffect:null,stores:null},Nt.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function Wx(){return nr().memoizedState}function zc(t,e,n,r){var s=Cr();Nt.flags|=t,s.memoizedState=ul(1|e,n,void 0,r===void 0?null:r)}function ud(t,e,n,r){var s=nr();r=r===void 0?null:r;var i=void 0;if(Vt!==null){var o=Vt.memoizedState;if(i=o.destroy,r!==null&&mg(r,o.deps)){s.memoizedState=ul(e,n,i,r);return}}Nt.flags|=t,s.memoizedState=ul(1|e,n,i,r)}function vy(t,e){return zc(8390656,8,t,e)}function _g(t,e){return ud(2048,8,t,e)}function Gx(t,e){return ud(4,2,t,e)}function Vx(t,e){return ud(4,4,t,e)}function Yx(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Kx(t,e,n){return n=n!=null?n.concat([t]):null,ud(4,4,Yx.bind(null,e,t),n)}function xg(){}function Xx(t,e){var n=nr();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&mg(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function Qx(t,e){var n=nr();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&mg(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function Jx(t,e,n){return _i&21?(vr(n,e)||(n=nx(),Nt.lanes|=n,xi|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Ln=!0),t.memoizedState=n)}function u2(t,e){var n=vt;vt=n!==0&&4>n?n:4,t(!0);var r=zf.transition;zf.transition={};try{t(!1),e()}finally{vt=n,zf.transition=r}}function qx(){return nr().memoizedState}function d2(t,e,n){var r=Ms(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Zx(t))e1(e,n);else if(n=Dx(t,e,n,r),n!==null){var s=In();mr(n,t,r,s),t1(n,e,r)}}function f2(t,e,n){var r=Ms(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Zx(t))e1(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,l=i(o,n);if(s.hasEagerState=!0,s.eagerState=l,vr(l,o)){var c=e.interleaved;c===null?(s.next=s,dg(e)):(s.next=c.next,c.next=s),e.interleaved=s;return}}catch{}finally{}n=Dx(t,e,s,r),n!==null&&(s=In(),mr(n,t,r,s),t1(n,e,r))}}function Zx(t){var e=t.alternate;return t===Nt||e!==null&&e===Nt}function e1(t,e){Da=Su=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function t1(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Jp(t,n)}}var Iu={readContext:tr,useCallback:dn,useContext:dn,useEffect:dn,useImperativeHandle:dn,useInsertionEffect:dn,useLayoutEffect:dn,useMemo:dn,useReducer:dn,useRef:dn,useState:dn,useDebugValue:dn,useDeferredValue:dn,useTransition:dn,useMutableSource:dn,useSyncExternalStore:dn,useId:dn,unstable_isNewReconciler:!1},h2={readContext:tr,useCallback:function(t,e){return Cr().memoizedState=[t,e===void 0?null:e],t},useContext:tr,useEffect:vy,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,zc(4194308,4,Yx.bind(null,e,t),n)},useLayoutEffect:function(t,e){return zc(4194308,4,t,e)},useInsertionEffect:function(t,e){return zc(4,2,t,e)},useMemo:function(t,e){var n=Cr();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Cr();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=d2.bind(null,Nt,t),[r.memoizedState,t]},useRef:function(t){var e=Cr();return t={current:t},e.memoizedState=t},useState:yy,useDebugValue:xg,useDeferredValue:function(t){return Cr().memoizedState=t},useTransition:function(){var t=yy(!1),e=t[0];return t=u2.bind(null,t[1]),Cr().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=Nt,s=Cr();if(Pt){if(n===void 0)throw Error(le(407));n=n()}else{if(n=e(),Zt===null)throw Error(le(349));_i&30||Fx(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,vy(Bx.bind(null,r,i,t),[t]),r.flags|=2048,ul(9,Ux.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=Cr(),e=Zt.identifierPrefix;if(Pt){var n=Hr,r=zr;n=(r&~(1<<32-gr(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=ll++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=c2++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},p2={readContext:tr,useCallback:Xx,useContext:tr,useEffect:_g,useImperativeHandle:Kx,useInsertionEffect:Gx,useLayoutEffect:Vx,useMemo:Qx,useReducer:Hf,useRef:Wx,useState:function(){return Hf(cl)},useDebugValue:xg,useDeferredValue:function(t){var e=nr();return Jx(e,Vt.memoizedState,t)},useTransition:function(){var t=Hf(cl)[0],e=nr().memoizedState;return[t,e]},useMutableSource:jx,useSyncExternalStore:$x,useId:qx,unstable_isNewReconciler:!1},g2={readContext:tr,useCallback:Xx,useContext:tr,useEffect:_g,useImperativeHandle:Kx,useInsertionEffect:Gx,useLayoutEffect:Vx,useMemo:Qx,useReducer:Wf,useRef:Wx,useState:function(){return Wf(cl)},useDebugValue:xg,useDeferredValue:function(t){var e=nr();return Vt===null?e.memoizedState=t:Jx(e,Vt.memoizedState,t)},useTransition:function(){var t=Wf(cl)[0],e=nr().memoizedState;return[t,e]},useMutableSource:jx,useSyncExternalStore:$x,useId:qx,unstable_isNewReconciler:!1};function ar(t,e){if(t&&t.defaultProps){e=jt({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Hh(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:jt({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var dd={isMounted:function(t){return(t=t._reactInternals)?Ri(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=In(),s=Ms(t),i=Xr(r,s);i.payload=e,n!=null&&(i.callback=n),e=Ls(t,i,s),e!==null&&(mr(e,t,s,r),Uc(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=In(),s=Ms(t),i=Xr(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=Ls(t,i,s),e!==null&&(mr(e,t,s,r),Uc(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=In(),r=Ms(t),s=Xr(n,r);s.tag=2,e!=null&&(s.callback=e),e=Ls(t,s,r),e!==null&&(mr(e,t,r,n),Uc(e,t,r))}};function _y(t,e,n,r,s,i,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!nl(n,r)||!nl(s,i):!0}function n1(t,e,n){var r=!1,s=Gs,i=e.contextType;return typeof i=="object"&&i!==null?i=tr(i):(s=Nn(e)?yi:gn.current,r=e.contextTypes,i=(r=r!=null)?Co(t,s):Gs),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=dd,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function xy(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&dd.enqueueReplaceState(e,e.state,null)}function Wh(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},fg(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=tr(i):(i=Nn(e)?yi:gn.current,s.context=Co(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(Hh(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&dd.enqueueReplaceState(s,s.state,null),bu(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function Ro(t,e){try{var n="",r=e;do n+=HI(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function Gf(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Gh(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var m2=typeof WeakMap=="function"?WeakMap:Map;function r1(t,e,n){n=Xr(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Cu||(Cu=!0,tp=r),Gh(t,e)},n}function s1(t,e,n){n=Xr(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){Gh(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){Gh(t,e),typeof r!="function"&&(Ds===null?Ds=new Set([this]):Ds.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function by(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new m2;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=R2.bind(null,t,e,n),e.then(t,t))}function Ey(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Sy(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Xr(-1,1),e.tag=2,Ls(n,e,1))),n.lanes|=1),t)}var y2=is.ReactCurrentOwner,Ln=!1;function En(t,e,n,r){e.child=t===null?Lx(e,null,n,r):ko(e,t.child,n,r)}function Iy(t,e,n,r,s){n=n.render;var i=e.ref;return mo(e,s),r=yg(t,e,n,r,i,s),n=vg(),t!==null&&!Ln?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,es(t,e,s)):(Pt&&n&&ig(e),e.flags|=1,En(t,e,r,s),e.child)}function Ty(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!kg(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,i1(t,e,i,r,s)):(t=Vc(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var o=i.memoizedProps;if(n=n.compare,n=n!==null?n:nl,n(o,r)&&t.ref===e.ref)return es(t,e,s)}return e.flags|=1,t=Ns(i,r),t.ref=e.ref,t.return=e,e.child=t}function i1(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(nl(i,r)&&t.ref===e.ref)if(Ln=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(Ln=!0);else return e.lanes=t.lanes,es(t,e,s)}return Vh(t,e,n,r,s)}function o1(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},wt(lo,Un),Un|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,wt(lo,Un),Un|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,wt(lo,Un),Un|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,wt(lo,Un),Un|=r;return En(t,e,s,n),e.child}function a1(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Vh(t,e,n,r,s){var i=Nn(n)?yi:gn.current;return i=Co(e,i),mo(e,s),n=yg(t,e,n,r,i,s),r=vg(),t!==null&&!Ln?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,es(t,e,s)):(Pt&&r&&ig(e),e.flags|=1,En(t,e,n,s),e.child)}function Cy(t,e,n,r,s){if(Nn(n)){var i=!0;mu(e)}else i=!1;if(mo(e,s),e.stateNode===null)Hc(t,e),n1(e,n,r),Wh(e,n,r,s),r=!0;else if(t===null){var o=e.stateNode,l=e.memoizedProps;o.props=l;var c=o.context,u=n.contextType;typeof u=="object"&&u!==null?u=tr(u):(u=Nn(n)?yi:gn.current,u=Co(e,u));var d=n.getDerivedStateFromProps,h=typeof d=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==r||c!==u)&&xy(e,o,r,u),ys=!1;var f=e.memoizedState;o.state=f,bu(e,r,o,s),c=e.memoizedState,l!==r||f!==c||Mn.current||ys?(typeof d=="function"&&(Hh(e,n,d,r),c=e.memoizedState),(l=ys||_y(e,n,l,r,f,c,u))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),o.props=r,o.state=c,o.context=u,r=l):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,Mx(t,e),l=e.memoizedProps,u=e.type===e.elementType?l:ar(e.type,l),o.props=u,h=e.pendingProps,f=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=tr(c):(c=Nn(n)?yi:gn.current,c=Co(e,c));var _=n.getDerivedStateFromProps;(d=typeof _=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==h||f!==c)&&xy(e,o,r,c),ys=!1,f=e.memoizedState,o.state=f,bu(e,r,o,s);var R=e.memoizedState;l!==h||f!==R||Mn.current||ys?(typeof _=="function"&&(Hh(e,n,_,r),R=e.memoizedState),(u=ys||_y(e,n,u,r,f,R,c)||!1)?(d||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,R,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,R,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=R),o.props=r,o.state=R,o.context=c,r=u):(typeof o.componentDidUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),r=!1)}return Yh(t,e,n,r,i,s)}function Yh(t,e,n,r,s,i){a1(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&dy(e,n,!1),es(t,e,i);r=e.stateNode,y2.current=e;var l=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=ko(e,t.child,null,i),e.child=ko(e,null,l,i)):En(t,e,l,i),e.memoizedState=r.state,s&&dy(e,n,!0),e.child}function l1(t){var e=t.stateNode;e.pendingContext?uy(t,e.pendingContext,e.pendingContext!==e.context):e.context&&uy(t,e.context,!1),hg(t,e.containerInfo)}function wy(t,e,n,r,s){return wo(),ag(s),e.flags|=256,En(t,e,n,r),e.child}var Kh={dehydrated:null,treeContext:null,retryLane:0};function Xh(t){return{baseLanes:t,cachePool:null,transitions:null}}function c1(t,e,n){var r=e.pendingProps,s=Lt.current,i=!1,o=(e.flags&128)!==0,l;if((l=o)||(l=t!==null&&t.memoizedState===null?!1:(s&2)!==0),l?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),wt(Lt,s&1),t===null)return Bh(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=pd(o,r,0,null),t=mi(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=Xh(n),e.memoizedState=Kh,t):bg(e,o));if(s=t.memoizedState,s!==null&&(l=s.dehydrated,l!==null))return v2(t,e,o,r,l,s,n);if(i){i=r.fallback,o=e.mode,s=t.child,l=s.sibling;var c={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=Ns(s,c),r.subtreeFlags=s.subtreeFlags&14680064),l!==null?i=Ns(l,i):(i=mi(i,o,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=t.child.memoizedState,o=o===null?Xh(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=t.childLanes&~n,e.memoizedState=Kh,r}return i=t.child,t=i.sibling,r=Ns(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function bg(t,e){return e=pd({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Ec(t,e,n,r){return r!==null&&ag(r),ko(e,t.child,null,n),t=bg(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function v2(t,e,n,r,s,i,o){if(n)return e.flags&256?(e.flags&=-257,r=Gf(Error(le(422))),Ec(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=pd({mode:"visible",children:r.children},s,0,null),i=mi(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&ko(e,t.child,null,o),e.child.memoizedState=Xh(o),e.memoizedState=Kh,i);if(!(e.mode&1))return Ec(t,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var l=r.dgst;return r=l,i=Error(le(419)),r=Gf(i,r,void 0),Ec(t,e,o,r)}if(l=(o&t.childLanes)!==0,Ln||l){if(r=Zt,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,Zr(t,s),mr(r,t,s,-1))}return wg(),r=Gf(Error(le(421))),Ec(t,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=P2.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,Bn=Os(s.nextSibling),zn=e,Pt=!0,cr=null,t!==null&&(Xn[Qn++]=zr,Xn[Qn++]=Hr,Xn[Qn++]=vi,zr=t.id,Hr=t.overflow,vi=e),e=bg(e,r.children),e.flags|=4096,e)}function ky(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),zh(t.return,e,n)}function Vf(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function u1(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(En(t,e,r.children,n),r=Lt.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&ky(t,n,e);else if(t.tag===19)ky(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(wt(Lt,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&Eu(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),Vf(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&Eu(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}Vf(e,!0,n,null,i);break;case"together":Vf(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Hc(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function es(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),xi|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(le(153));if(e.child!==null){for(t=e.child,n=Ns(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Ns(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function _2(t,e,n){switch(e.tag){case 3:l1(e),wo();break;case 5:Nx(e);break;case 1:Nn(e.type)&&mu(e);break;case 4:hg(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;wt(_u,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(wt(Lt,Lt.current&1),e.flags|=128,null):n&e.child.childLanes?c1(t,e,n):(wt(Lt,Lt.current&1),t=es(t,e,n),t!==null?t.sibling:null);wt(Lt,Lt.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return u1(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),wt(Lt,Lt.current),r)break;return null;case 22:case 23:return e.lanes=0,o1(t,e,n)}return es(t,e,n)}var d1,Qh,f1,h1;d1=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Qh=function(){};f1=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,hi(Rr.current);var i=null;switch(n){case"input":s=vh(t,s),r=vh(t,r),i=[];break;case"select":s=jt({},s,{value:void 0}),r=jt({},r,{value:void 0}),i=[];break;case"textarea":s=bh(t,s),r=bh(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=pu)}Sh(n,r);var o;n=null;for(u in s)if(!r.hasOwnProperty(u)&&s.hasOwnProperty(u)&&s[u]!=null)if(u==="style"){var l=s[u];for(o in l)l.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Xa.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in r){var c=r[u];if(l=s!=null?s[u]:void 0,r.hasOwnProperty(u)&&c!==l&&(c!=null||l!=null))if(u==="style")if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(i||(i=[]),i.push(u,n)),n=c;else u==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(i=i||[]).push(u,c)):u==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(u,""+c):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Xa.hasOwnProperty(u)?(c!=null&&u==="onScroll"&&kt("scroll",t),i||l===c||(i=[])):(i=i||[]).push(u,c))}n&&(i=i||[]).push("style",n);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};h1=function(t,e,n,r){n!==r&&(e.flags|=4)};function ma(t,e){if(!Pt)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function fn(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function x2(t,e,n){var r=e.pendingProps;switch(og(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return fn(e),null;case 1:return Nn(e.type)&&gu(),fn(e),null;case 3:return r=e.stateNode,Ao(),At(Mn),At(gn),gg(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(xc(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,cr!==null&&(sp(cr),cr=null))),Qh(t,e),fn(e),null;case 5:pg(e);var s=hi(al.current);if(n=e.type,t!==null&&e.stateNode!=null)f1(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(le(166));return fn(e),null}if(t=hi(Rr.current),xc(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[wr]=e,r[il]=i,t=(e.mode&1)!==0,n){case"dialog":kt("cancel",r),kt("close",r);break;case"iframe":case"object":case"embed":kt("load",r);break;case"video":case"audio":for(s=0;s<wa.length;s++)kt(wa[s],r);break;case"source":kt("error",r);break;case"img":case"image":case"link":kt("error",r),kt("load",r);break;case"details":kt("toggle",r);break;case"input":jm(r,i),kt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},kt("invalid",r);break;case"textarea":Fm(r,i),kt("invalid",r)}Sh(n,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var l=i[o];o==="children"?typeof l=="string"?r.textContent!==l&&(i.suppressHydrationWarning!==!0&&_c(r.textContent,l,t),s=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(i.suppressHydrationWarning!==!0&&_c(r.textContent,l,t),s=["children",""+l]):Xa.hasOwnProperty(o)&&l!=null&&o==="onScroll"&&kt("scroll",r)}switch(n){case"input":dc(r),$m(r,i,!0);break;case"textarea":dc(r),Um(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=pu)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=B_(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[wr]=e,t[il]=r,d1(t,e,!1,!1),e.stateNode=t;e:{switch(o=Ih(n,r),n){case"dialog":kt("cancel",t),kt("close",t),s=r;break;case"iframe":case"object":case"embed":kt("load",t),s=r;break;case"video":case"audio":for(s=0;s<wa.length;s++)kt(wa[s],t);s=r;break;case"source":kt("error",t),s=r;break;case"img":case"image":case"link":kt("error",t),kt("load",t),s=r;break;case"details":kt("toggle",t),s=r;break;case"input":jm(t,r),s=vh(t,r),kt("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=jt({},r,{value:void 0}),kt("invalid",t);break;case"textarea":Fm(t,r),s=bh(t,r),kt("invalid",t);break;default:s=r}Sh(n,s),l=s;for(i in l)if(l.hasOwnProperty(i)){var c=l[i];i==="style"?W_(t,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&z_(t,c)):i==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&Qa(t,c):typeof c=="number"&&Qa(t,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Xa.hasOwnProperty(i)?c!=null&&i==="onScroll"&&kt("scroll",t):c!=null&&Gp(t,i,c,o))}switch(n){case"input":dc(t),$m(t,r,!1);break;case"textarea":dc(t),Um(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Ws(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?fo(t,!!r.multiple,i,!1):r.defaultValue!=null&&fo(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=pu)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return fn(e),null;case 6:if(t&&e.stateNode!=null)h1(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(le(166));if(n=hi(al.current),hi(Rr.current),xc(e)){if(r=e.stateNode,n=e.memoizedProps,r[wr]=e,(i=r.nodeValue!==n)&&(t=zn,t!==null))switch(t.tag){case 3:_c(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&_c(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[wr]=e,e.stateNode=r}return fn(e),null;case 13:if(At(Lt),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Pt&&Bn!==null&&e.mode&1&&!(e.flags&128))Px(),wo(),e.flags|=98560,i=!1;else if(i=xc(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(le(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(le(317));i[wr]=e}else wo(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;fn(e),i=!1}else cr!==null&&(sp(cr),cr=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||Lt.current&1?Kt===0&&(Kt=3):wg())),e.updateQueue!==null&&(e.flags|=4),fn(e),null);case 4:return Ao(),Qh(t,e),t===null&&rl(e.stateNode.containerInfo),fn(e),null;case 10:return ug(e.type._context),fn(e),null;case 17:return Nn(e.type)&&gu(),fn(e),null;case 19:if(At(Lt),i=e.memoizedState,i===null)return fn(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)ma(i,!1);else{if(Kt!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=Eu(t),o!==null){for(e.flags|=128,ma(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,t=o.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return wt(Lt,Lt.current&1|2),e.child}t=t.sibling}i.tail!==null&&Ut()>Po&&(e.flags|=128,r=!0,ma(i,!1),e.lanes=4194304)}else{if(!r)if(t=Eu(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),ma(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!Pt)return fn(e),null}else 2*Ut()-i.renderingStartTime>Po&&n!==1073741824&&(e.flags|=128,r=!0,ma(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(n=i.last,n!==null?n.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Ut(),e.sibling=null,n=Lt.current,wt(Lt,r?n&1|2:n&1),e):(fn(e),null);case 22:case 23:return Cg(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Un&1073741824&&(fn(e),e.subtreeFlags&6&&(e.flags|=8192)):fn(e),null;case 24:return null;case 25:return null}throw Error(le(156,e.tag))}function b2(t,e){switch(og(e),e.tag){case 1:return Nn(e.type)&&gu(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Ao(),At(Mn),At(gn),gg(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return pg(e),null;case 13:if(At(Lt),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(le(340));wo()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return At(Lt),null;case 4:return Ao(),null;case 10:return ug(e.type._context),null;case 22:case 23:return Cg(),null;case 24:return null;default:return null}}var Sc=!1,pn=!1,E2=typeof WeakSet=="function"?WeakSet:Set,xe=null;function ao(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){Ft(t,e,r)}else n.current=null}function Jh(t,e,n){try{n()}catch(r){Ft(t,e,r)}}var Ay=!1;function S2(t,e){if(Dh=du,t=vx(),sg(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var o=0,l=-1,c=-1,u=0,d=0,h=t,f=null;t:for(;;){for(var _;h!==n||s!==0&&h.nodeType!==3||(l=o+s),h!==i||r!==0&&h.nodeType!==3||(c=o+r),h.nodeType===3&&(o+=h.nodeValue.length),(_=h.firstChild)!==null;)f=h,h=_;for(;;){if(h===t)break t;if(f===n&&++u===s&&(l=o),f===i&&++d===r&&(c=o),(_=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=_}n=l===-1||c===-1?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Mh={focusedElem:t,selectionRange:n},du=!1,xe=e;xe!==null;)if(e=xe,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,xe=t;else for(;xe!==null;){e=xe;try{var R=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(R!==null){var k=R.memoizedProps,B=R.memoizedState,x=e.stateNode,E=x.getSnapshotBeforeUpdate(e.elementType===e.type?k:ar(e.type,k),B);x.__reactInternalSnapshotBeforeUpdate=E}break;case 3:var T=e.stateNode.containerInfo;T.nodeType===1?T.textContent="":T.nodeType===9&&T.documentElement&&T.removeChild(T.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(le(163))}}catch(p){Ft(e,e.return,p)}if(t=e.sibling,t!==null){t.return=e.return,xe=t;break}xe=e.return}return R=Ay,Ay=!1,R}function Ma(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&Jh(e,n,i)}s=s.next}while(s!==r)}}function fd(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function qh(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function p1(t){var e=t.alternate;e!==null&&(t.alternate=null,p1(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[wr],delete e[il],delete e[$h],delete e[i2],delete e[o2])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function g1(t){return t.tag===5||t.tag===3||t.tag===4}function Ry(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||g1(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Zh(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=pu));else if(r!==4&&(t=t.child,t!==null))for(Zh(t,e,n),t=t.sibling;t!==null;)Zh(t,e,n),t=t.sibling}function ep(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(ep(t,e,n),t=t.sibling;t!==null;)ep(t,e,n),t=t.sibling}var sn=null,lr=!1;function ps(t,e,n){for(n=n.child;n!==null;)m1(t,e,n),n=n.sibling}function m1(t,e,n){if(Ar&&typeof Ar.onCommitFiberUnmount=="function")try{Ar.onCommitFiberUnmount(sd,n)}catch{}switch(n.tag){case 5:pn||ao(n,e);case 6:var r=sn,s=lr;sn=null,ps(t,e,n),sn=r,lr=s,sn!==null&&(lr?(t=sn,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):sn.removeChild(n.stateNode));break;case 18:sn!==null&&(lr?(t=sn,n=n.stateNode,t.nodeType===8?Ff(t.parentNode,n):t.nodeType===1&&Ff(t,n),el(t)):Ff(sn,n.stateNode));break;case 4:r=sn,s=lr,sn=n.stateNode.containerInfo,lr=!0,ps(t,e,n),sn=r,lr=s;break;case 0:case 11:case 14:case 15:if(!pn&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&Jh(n,e,o),s=s.next}while(s!==r)}ps(t,e,n);break;case 1:if(!pn&&(ao(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(l){Ft(n,e,l)}ps(t,e,n);break;case 21:ps(t,e,n);break;case 22:n.mode&1?(pn=(r=pn)||n.memoizedState!==null,ps(t,e,n),pn=r):ps(t,e,n);break;default:ps(t,e,n)}}function Py(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new E2),e.forEach(function(r){var s=O2.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function or(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,o=e,l=o;e:for(;l!==null;){switch(l.tag){case 5:sn=l.stateNode,lr=!1;break e;case 3:sn=l.stateNode.containerInfo,lr=!0;break e;case 4:sn=l.stateNode.containerInfo,lr=!0;break e}l=l.return}if(sn===null)throw Error(le(160));m1(i,o,s),sn=null,lr=!1;var c=s.alternate;c!==null&&(c.return=null),s.return=null}catch(u){Ft(s,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)y1(e,t),e=e.sibling}function y1(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(or(e,t),Tr(t),r&4){try{Ma(3,t,t.return),fd(3,t)}catch(k){Ft(t,t.return,k)}try{Ma(5,t,t.return)}catch(k){Ft(t,t.return,k)}}break;case 1:or(e,t),Tr(t),r&512&&n!==null&&ao(n,n.return);break;case 5:if(or(e,t),Tr(t),r&512&&n!==null&&ao(n,n.return),t.flags&32){var s=t.stateNode;try{Qa(s,"")}catch(k){Ft(t,t.return,k)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,o=n!==null?n.memoizedProps:i,l=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{l==="input"&&i.type==="radio"&&i.name!=null&&F_(s,i),Ih(l,o);var u=Ih(l,i);for(o=0;o<c.length;o+=2){var d=c[o],h=c[o+1];d==="style"?W_(s,h):d==="dangerouslySetInnerHTML"?z_(s,h):d==="children"?Qa(s,h):Gp(s,d,h,u)}switch(l){case"input":_h(s,i);break;case"textarea":U_(s,i);break;case"select":var f=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var _=i.value;_!=null?fo(s,!!i.multiple,_,!1):f!==!!i.multiple&&(i.defaultValue!=null?fo(s,!!i.multiple,i.defaultValue,!0):fo(s,!!i.multiple,i.multiple?[]:"",!1))}s[il]=i}catch(k){Ft(t,t.return,k)}}break;case 6:if(or(e,t),Tr(t),r&4){if(t.stateNode===null)throw Error(le(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(k){Ft(t,t.return,k)}}break;case 3:if(or(e,t),Tr(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{el(e.containerInfo)}catch(k){Ft(t,t.return,k)}break;case 4:or(e,t),Tr(t);break;case 13:or(e,t),Tr(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(Ig=Ut())),r&4&&Py(t);break;case 22:if(d=n!==null&&n.memoizedState!==null,t.mode&1?(pn=(u=pn)||d,or(e,t),pn=u):or(e,t),Tr(t),r&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!d&&t.mode&1)for(xe=t,d=t.child;d!==null;){for(h=xe=d;xe!==null;){switch(f=xe,_=f.child,f.tag){case 0:case 11:case 14:case 15:Ma(4,f,f.return);break;case 1:ao(f,f.return);var R=f.stateNode;if(typeof R.componentWillUnmount=="function"){r=f,n=f.return;try{e=r,R.props=e.memoizedProps,R.state=e.memoizedState,R.componentWillUnmount()}catch(k){Ft(r,n,k)}}break;case 5:ao(f,f.return);break;case 22:if(f.memoizedState!==null){Ly(h);continue}}_!==null?(_.return=f,xe=_):Ly(h)}d=d.sibling}e:for(d=null,h=t;;){if(h.tag===5){if(d===null){d=h;try{s=h.stateNode,u?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(l=h.stateNode,c=h.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=H_("display",o))}catch(k){Ft(t,t.return,k)}}}else if(h.tag===6){if(d===null)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(k){Ft(t,t.return,k)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===t)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===t)break e;for(;h.sibling===null;){if(h.return===null||h.return===t)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:or(e,t),Tr(t),r&4&&Py(t);break;case 21:break;default:or(e,t),Tr(t)}}function Tr(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(g1(n)){var r=n;break e}n=n.return}throw Error(le(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(Qa(s,""),r.flags&=-33);var i=Ry(t);ep(t,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,l=Ry(t);Zh(t,l,o);break;default:throw Error(le(161))}}catch(c){Ft(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function I2(t,e,n){xe=t,v1(t)}function v1(t,e,n){for(var r=(t.mode&1)!==0;xe!==null;){var s=xe,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||Sc;if(!o){var l=s.alternate,c=l!==null&&l.memoizedState!==null||pn;l=Sc;var u=pn;if(Sc=o,(pn=c)&&!u)for(xe=s;xe!==null;)o=xe,c=o.child,o.tag===22&&o.memoizedState!==null?Dy(s):c!==null?(c.return=o,xe=c):Dy(s);for(;i!==null;)xe=i,v1(i),i=i.sibling;xe=s,Sc=l,pn=u}Oy(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,xe=i):Oy(t)}}function Oy(t){for(;xe!==null;){var e=xe;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:pn||fd(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!pn)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:ar(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&my(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}my(e,o,n)}break;case 5:var l=e.stateNode;if(n===null&&e.flags&4){n=l;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var d=u.memoizedState;if(d!==null){var h=d.dehydrated;h!==null&&el(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(le(163))}pn||e.flags&512&&qh(e)}catch(f){Ft(e,e.return,f)}}if(e===t){xe=null;break}if(n=e.sibling,n!==null){n.return=e.return,xe=n;break}xe=e.return}}function Ly(t){for(;xe!==null;){var e=xe;if(e===t){xe=null;break}var n=e.sibling;if(n!==null){n.return=e.return,xe=n;break}xe=e.return}}function Dy(t){for(;xe!==null;){var e=xe;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{fd(4,e)}catch(c){Ft(e,n,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(c){Ft(e,s,c)}}var i=e.return;try{qh(e)}catch(c){Ft(e,i,c)}break;case 5:var o=e.return;try{qh(e)}catch(c){Ft(e,o,c)}}}catch(c){Ft(e,e.return,c)}if(e===t){xe=null;break}var l=e.sibling;if(l!==null){l.return=e.return,xe=l;break}xe=e.return}}var T2=Math.ceil,Tu=is.ReactCurrentDispatcher,Eg=is.ReactCurrentOwner,er=is.ReactCurrentBatchConfig,ut=0,Zt=null,Ht=null,on=0,Un=0,lo=qs(0),Kt=0,dl=null,xi=0,hd=0,Sg=0,Na=null,On=null,Ig=0,Po=1/0,Fr=null,Cu=!1,tp=null,Ds=null,Ic=!1,Ts=null,wu=0,ja=0,np=null,Wc=-1,Gc=0;function In(){return ut&6?Ut():Wc!==-1?Wc:Wc=Ut()}function Ms(t){return t.mode&1?ut&2&&on!==0?on&-on:l2.transition!==null?(Gc===0&&(Gc=nx()),Gc):(t=vt,t!==0||(t=window.event,t=t===void 0?16:cx(t.type)),t):1}function mr(t,e,n,r){if(50<ja)throw ja=0,np=null,Error(le(185));Tl(t,n,r),(!(ut&2)||t!==Zt)&&(t===Zt&&(!(ut&2)&&(hd|=n),Kt===4&&_s(t,on)),jn(t,r),n===1&&ut===0&&!(e.mode&1)&&(Po=Ut()+500,cd&&Zs()))}function jn(t,e){var n=t.callbackNode;lT(t,e);var r=uu(t,t===Zt?on:0);if(r===0)n!==null&&Hm(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&Hm(n),e===1)t.tag===0?a2(My.bind(null,t)):kx(My.bind(null,t)),r2(function(){!(ut&6)&&Zs()}),n=null;else{switch(rx(r)){case 1:n=Qp;break;case 4:n=ex;break;case 16:n=cu;break;case 536870912:n=tx;break;default:n=cu}n=C1(n,_1.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function _1(t,e){if(Wc=-1,Gc=0,ut&6)throw Error(le(327));var n=t.callbackNode;if(yo()&&t.callbackNode!==n)return null;var r=uu(t,t===Zt?on:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=ku(t,r);else{e=r;var s=ut;ut|=2;var i=b1();(Zt!==t||on!==e)&&(Fr=null,Po=Ut()+500,gi(t,e));do try{k2();break}catch(l){x1(t,l)}while(!0);cg(),Tu.current=i,ut=s,Ht!==null?e=0:(Zt=null,on=0,e=Kt)}if(e!==0){if(e===2&&(s=Ah(t),s!==0&&(r=s,e=rp(t,s))),e===1)throw n=dl,gi(t,0),_s(t,r),jn(t,Ut()),n;if(e===6)_s(t,r);else{if(s=t.current.alternate,!(r&30)&&!C2(s)&&(e=ku(t,r),e===2&&(i=Ah(t),i!==0&&(r=i,e=rp(t,i))),e===1))throw n=dl,gi(t,0),_s(t,r),jn(t,Ut()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(le(345));case 2:ai(t,On,Fr);break;case 3:if(_s(t,r),(r&130023424)===r&&(e=Ig+500-Ut(),10<e)){if(uu(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){In(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=jh(ai.bind(null,t,On,Fr),e);break}ai(t,On,Fr);break;case 4:if(_s(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var o=31-gr(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=Ut()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*T2(r/1960))-r,10<r){t.timeoutHandle=jh(ai.bind(null,t,On,Fr),r);break}ai(t,On,Fr);break;case 5:ai(t,On,Fr);break;default:throw Error(le(329))}}}return jn(t,Ut()),t.callbackNode===n?_1.bind(null,t):null}function rp(t,e){var n=Na;return t.current.memoizedState.isDehydrated&&(gi(t,e).flags|=256),t=ku(t,e),t!==2&&(e=On,On=n,e!==null&&sp(e)),t}function sp(t){On===null?On=t:On.push.apply(On,t)}function C2(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!vr(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function _s(t,e){for(e&=~Sg,e&=~hd,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-gr(e),r=1<<n;t[n]=-1,e&=~r}}function My(t){if(ut&6)throw Error(le(327));yo();var e=uu(t,0);if(!(e&1))return jn(t,Ut()),null;var n=ku(t,e);if(t.tag!==0&&n===2){var r=Ah(t);r!==0&&(e=r,n=rp(t,r))}if(n===1)throw n=dl,gi(t,0),_s(t,e),jn(t,Ut()),n;if(n===6)throw Error(le(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,ai(t,On,Fr),jn(t,Ut()),null}function Tg(t,e){var n=ut;ut|=1;try{return t(e)}finally{ut=n,ut===0&&(Po=Ut()+500,cd&&Zs())}}function bi(t){Ts!==null&&Ts.tag===0&&!(ut&6)&&yo();var e=ut;ut|=1;var n=er.transition,r=vt;try{if(er.transition=null,vt=1,t)return t()}finally{vt=r,er.transition=n,ut=e,!(ut&6)&&Zs()}}function Cg(){Un=lo.current,At(lo)}function gi(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,n2(n)),Ht!==null)for(n=Ht.return;n!==null;){var r=n;switch(og(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&gu();break;case 3:Ao(),At(Mn),At(gn),gg();break;case 5:pg(r);break;case 4:Ao();break;case 13:At(Lt);break;case 19:At(Lt);break;case 10:ug(r.type._context);break;case 22:case 23:Cg()}n=n.return}if(Zt=t,Ht=t=Ns(t.current,null),on=Un=e,Kt=0,dl=null,Sg=hd=xi=0,On=Na=null,fi!==null){for(e=0;e<fi.length;e++)if(n=fi[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}n.pending=r}fi=null}return t}function x1(t,e){do{var n=Ht;try{if(cg(),Bc.current=Iu,Su){for(var r=Nt.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Su=!1}if(_i=0,Qt=Vt=Nt=null,Da=!1,ll=0,Eg.current=null,n===null||n.return===null){Kt=1,dl=e,Ht=null;break}e:{var i=t,o=n.return,l=n,c=e;if(e=on,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var u=c,d=l,h=d.tag;if(!(d.mode&1)&&(h===0||h===11||h===15)){var f=d.alternate;f?(d.updateQueue=f.updateQueue,d.memoizedState=f.memoizedState,d.lanes=f.lanes):(d.updateQueue=null,d.memoizedState=null)}var _=Ey(o);if(_!==null){_.flags&=-257,Sy(_,o,l,i,e),_.mode&1&&by(i,u,e),e=_,c=u;var R=e.updateQueue;if(R===null){var k=new Set;k.add(c),e.updateQueue=k}else R.add(c);break e}else{if(!(e&1)){by(i,u,e),wg();break e}c=Error(le(426))}}else if(Pt&&l.mode&1){var B=Ey(o);if(B!==null){!(B.flags&65536)&&(B.flags|=256),Sy(B,o,l,i,e),ag(Ro(c,l));break e}}i=c=Ro(c,l),Kt!==4&&(Kt=2),Na===null?Na=[i]:Na.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var x=r1(i,c,e);gy(i,x);break e;case 1:l=c;var E=i.type,T=i.stateNode;if(!(i.flags&128)&&(typeof E.getDerivedStateFromError=="function"||T!==null&&typeof T.componentDidCatch=="function"&&(Ds===null||!Ds.has(T)))){i.flags|=65536,e&=-e,i.lanes|=e;var p=s1(i,l,e);gy(i,p);break e}}i=i.return}while(i!==null)}S1(n)}catch($){e=$,Ht===n&&n!==null&&(Ht=n=n.return);continue}break}while(!0)}function b1(){var t=Tu.current;return Tu.current=Iu,t===null?Iu:t}function wg(){(Kt===0||Kt===3||Kt===2)&&(Kt=4),Zt===null||!(xi&268435455)&&!(hd&268435455)||_s(Zt,on)}function ku(t,e){var n=ut;ut|=2;var r=b1();(Zt!==t||on!==e)&&(Fr=null,gi(t,e));do try{w2();break}catch(s){x1(t,s)}while(!0);if(cg(),ut=n,Tu.current=r,Ht!==null)throw Error(le(261));return Zt=null,on=0,Kt}function w2(){for(;Ht!==null;)E1(Ht)}function k2(){for(;Ht!==null&&!ZI();)E1(Ht)}function E1(t){var e=T1(t.alternate,t,Un);t.memoizedProps=t.pendingProps,e===null?S1(t):Ht=e,Eg.current=null}function S1(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=b2(n,e),n!==null){n.flags&=32767,Ht=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Kt=6,Ht=null;return}}else if(n=x2(n,e,Un),n!==null){Ht=n;return}if(e=e.sibling,e!==null){Ht=e;return}Ht=e=t}while(e!==null);Kt===0&&(Kt=5)}function ai(t,e,n){var r=vt,s=er.transition;try{er.transition=null,vt=1,A2(t,e,n,r)}finally{er.transition=s,vt=r}return null}function A2(t,e,n,r){do yo();while(Ts!==null);if(ut&6)throw Error(le(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(le(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(cT(t,i),t===Zt&&(Ht=Zt=null,on=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Ic||(Ic=!0,C1(cu,function(){return yo(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=er.transition,er.transition=null;var o=vt;vt=1;var l=ut;ut|=4,Eg.current=null,S2(t,n),y1(n,t),XT(Mh),du=!!Dh,Mh=Dh=null,t.current=n,I2(n),eT(),ut=l,vt=o,er.transition=i}else t.current=n;if(Ic&&(Ic=!1,Ts=t,wu=s),i=t.pendingLanes,i===0&&(Ds=null),rT(n.stateNode),jn(t,Ut()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(Cu)throw Cu=!1,t=tp,tp=null,t;return wu&1&&t.tag!==0&&yo(),i=t.pendingLanes,i&1?t===np?ja++:(ja=0,np=t):ja=0,Zs(),null}function yo(){if(Ts!==null){var t=rx(wu),e=er.transition,n=vt;try{if(er.transition=null,vt=16>t?16:t,Ts===null)var r=!1;else{if(t=Ts,Ts=null,wu=0,ut&6)throw Error(le(331));var s=ut;for(ut|=4,xe=t.current;xe!==null;){var i=xe,o=i.child;if(xe.flags&16){var l=i.deletions;if(l!==null){for(var c=0;c<l.length;c++){var u=l[c];for(xe=u;xe!==null;){var d=xe;switch(d.tag){case 0:case 11:case 15:Ma(8,d,i)}var h=d.child;if(h!==null)h.return=d,xe=h;else for(;xe!==null;){d=xe;var f=d.sibling,_=d.return;if(p1(d),d===u){xe=null;break}if(f!==null){f.return=_,xe=f;break}xe=_}}}var R=i.alternate;if(R!==null){var k=R.child;if(k!==null){R.child=null;do{var B=k.sibling;k.sibling=null,k=B}while(k!==null)}}xe=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,xe=o;else e:for(;xe!==null;){if(i=xe,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Ma(9,i,i.return)}var x=i.sibling;if(x!==null){x.return=i.return,xe=x;break e}xe=i.return}}var E=t.current;for(xe=E;xe!==null;){o=xe;var T=o.child;if(o.subtreeFlags&2064&&T!==null)T.return=o,xe=T;else e:for(o=E;xe!==null;){if(l=xe,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:fd(9,l)}}catch($){Ft(l,l.return,$)}if(l===o){xe=null;break e}var p=l.sibling;if(p!==null){p.return=l.return,xe=p;break e}xe=l.return}}if(ut=s,Zs(),Ar&&typeof Ar.onPostCommitFiberRoot=="function")try{Ar.onPostCommitFiberRoot(sd,t)}catch{}r=!0}return r}finally{vt=n,er.transition=e}}return!1}function Ny(t,e,n){e=Ro(n,e),e=r1(t,e,1),t=Ls(t,e,1),e=In(),t!==null&&(Tl(t,1,e),jn(t,e))}function Ft(t,e,n){if(t.tag===3)Ny(t,t,n);else for(;e!==null;){if(e.tag===3){Ny(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Ds===null||!Ds.has(r))){t=Ro(n,t),t=s1(e,t,1),e=Ls(e,t,1),t=In(),e!==null&&(Tl(e,1,t),jn(e,t));break}}e=e.return}}function R2(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=In(),t.pingedLanes|=t.suspendedLanes&n,Zt===t&&(on&n)===n&&(Kt===4||Kt===3&&(on&130023424)===on&&500>Ut()-Ig?gi(t,0):Sg|=n),jn(t,e)}function I1(t,e){e===0&&(t.mode&1?(e=pc,pc<<=1,!(pc&130023424)&&(pc=4194304)):e=1);var n=In();t=Zr(t,e),t!==null&&(Tl(t,e,n),jn(t,n))}function P2(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),I1(t,n)}function O2(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(le(314))}r!==null&&r.delete(e),I1(t,n)}var T1;T1=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Mn.current)Ln=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Ln=!1,_2(t,e,n);Ln=!!(t.flags&131072)}else Ln=!1,Pt&&e.flags&1048576&&Ax(e,vu,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Hc(t,e),t=e.pendingProps;var s=Co(e,gn.current);mo(e,n),s=yg(null,e,r,t,s,n);var i=vg();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Nn(r)?(i=!0,mu(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,fg(e),s.updater=dd,e.stateNode=s,s._reactInternals=e,Wh(e,r,t,n),e=Yh(null,e,r,!0,i,n)):(e.tag=0,Pt&&i&&ig(e),En(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(Hc(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=D2(r),t=ar(r,t),s){case 0:e=Vh(null,e,r,t,n);break e;case 1:e=Cy(null,e,r,t,n);break e;case 11:e=Iy(null,e,r,t,n);break e;case 14:e=Ty(null,e,r,ar(r.type,t),n);break e}throw Error(le(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:ar(r,s),Vh(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:ar(r,s),Cy(t,e,r,s,n);case 3:e:{if(l1(e),t===null)throw Error(le(387));r=e.pendingProps,i=e.memoizedState,s=i.element,Mx(t,e),bu(e,r,null,n);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=Ro(Error(le(423)),e),e=wy(t,e,r,n,s);break e}else if(r!==s){s=Ro(Error(le(424)),e),e=wy(t,e,r,n,s);break e}else for(Bn=Os(e.stateNode.containerInfo.firstChild),zn=e,Pt=!0,cr=null,n=Lx(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(wo(),r===s){e=es(t,e,n);break e}En(t,e,r,n)}e=e.child}return e;case 5:return Nx(e),t===null&&Bh(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,o=s.children,Nh(r,s)?o=null:i!==null&&Nh(r,i)&&(e.flags|=32),a1(t,e),En(t,e,o,n),e.child;case 6:return t===null&&Bh(e),null;case 13:return c1(t,e,n);case 4:return hg(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=ko(e,null,r,n):En(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:ar(r,s),Iy(t,e,r,s,n);case 7:return En(t,e,e.pendingProps,n),e.child;case 8:return En(t,e,e.pendingProps.children,n),e.child;case 12:return En(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,wt(_u,r._currentValue),r._currentValue=o,i!==null)if(vr(i.value,o)){if(i.children===s.children&&!Mn.current){e=es(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var l=i.dependencies;if(l!==null){o=i.child;for(var c=l.firstContext;c!==null;){if(c.context===r){if(i.tag===1){c=Xr(-1,n&-n),c.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var d=u.pending;d===null?c.next=c:(c.next=d.next,d.next=c),u.pending=c}}i.lanes|=n,c=i.alternate,c!==null&&(c.lanes|=n),zh(i.return,n,e),l.lanes|=n;break}c=c.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(le(341));o.lanes|=n,l=o.alternate,l!==null&&(l.lanes|=n),zh(o,n,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}En(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,mo(e,n),s=tr(s),r=r(s),e.flags|=1,En(t,e,r,n),e.child;case 14:return r=e.type,s=ar(r,e.pendingProps),s=ar(r.type,s),Ty(t,e,r,s,n);case 15:return i1(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:ar(r,s),Hc(t,e),e.tag=1,Nn(r)?(t=!0,mu(e)):t=!1,mo(e,n),n1(e,r,s),Wh(e,r,s,n),Yh(null,e,r,!0,t,n);case 19:return u1(t,e,n);case 22:return o1(t,e,n)}throw Error(le(156,e.tag))};function C1(t,e){return Z_(t,e)}function L2(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function qn(t,e,n,r){return new L2(t,e,n,r)}function kg(t){return t=t.prototype,!(!t||!t.isReactComponent)}function D2(t){if(typeof t=="function")return kg(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Yp)return 11;if(t===Kp)return 14}return 2}function Ns(t,e){var n=t.alternate;return n===null?(n=qn(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Vc(t,e,n,r,s,i){var o=2;if(r=t,typeof t=="function")kg(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case qi:return mi(n.children,s,i,e);case Vp:o=8,s|=8;break;case ph:return t=qn(12,n,e,s|2),t.elementType=ph,t.lanes=i,t;case gh:return t=qn(13,n,e,s),t.elementType=gh,t.lanes=i,t;case mh:return t=qn(19,n,e,s),t.elementType=mh,t.lanes=i,t;case N_:return pd(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case D_:o=10;break e;case M_:o=9;break e;case Yp:o=11;break e;case Kp:o=14;break e;case ms:o=16,r=null;break e}throw Error(le(130,t==null?t:typeof t,""))}return e=qn(o,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function mi(t,e,n,r){return t=qn(7,t,r,e),t.lanes=n,t}function pd(t,e,n,r){return t=qn(22,t,r,e),t.elementType=N_,t.lanes=n,t.stateNode={isHidden:!1},t}function Yf(t,e,n){return t=qn(6,t,null,e),t.lanes=n,t}function Kf(t,e,n){return e=qn(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function M2(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=kf(0),this.expirationTimes=kf(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=kf(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Ag(t,e,n,r,s,i,o,l,c){return t=new M2(t,e,n,l,c),e===1?(e=1,i===!0&&(e|=8)):e=0,i=qn(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},fg(i),t}function N2(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ji,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function w1(t){if(!t)return Gs;t=t._reactInternals;e:{if(Ri(t)!==t||t.tag!==1)throw Error(le(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Nn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(le(171))}if(t.tag===1){var n=t.type;if(Nn(n))return wx(t,n,e)}return e}function k1(t,e,n,r,s,i,o,l,c){return t=Ag(n,r,!0,t,s,i,o,l,c),t.context=w1(null),n=t.current,r=In(),s=Ms(n),i=Xr(r,s),i.callback=e??null,Ls(n,i,s),t.current.lanes=s,Tl(t,s,r),jn(t,r),t}function gd(t,e,n,r){var s=e.current,i=In(),o=Ms(s);return n=w1(n),e.context===null?e.context=n:e.pendingContext=n,e=Xr(i,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Ls(s,e,o),t!==null&&(mr(t,s,o,i),Uc(t,s,o)),o}function Au(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function jy(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Rg(t,e){jy(t,e),(t=t.alternate)&&jy(t,e)}function j2(){return null}var A1=typeof reportError=="function"?reportError:function(t){console.error(t)};function Pg(t){this._internalRoot=t}md.prototype.render=Pg.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(le(409));gd(t,e,null,null)};md.prototype.unmount=Pg.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;bi(function(){gd(null,t,null,null)}),e[qr]=null}};function md(t){this._internalRoot=t}md.prototype.unstable_scheduleHydration=function(t){if(t){var e=ox();t={blockedOn:null,target:t,priority:e};for(var n=0;n<vs.length&&e!==0&&e<vs[n].priority;n++);vs.splice(n,0,t),n===0&&lx(t)}};function Og(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function yd(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function $y(){}function $2(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var u=Au(o);i.call(u)}}var o=k1(e,r,t,0,null,!1,!1,"",$y);return t._reactRootContainer=o,t[qr]=o.current,rl(t.nodeType===8?t.parentNode:t),bi(),o}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var l=r;r=function(){var u=Au(c);l.call(u)}}var c=Ag(t,0,!1,null,null,!1,!1,"",$y);return t._reactRootContainer=c,t[qr]=c.current,rl(t.nodeType===8?t.parentNode:t),bi(function(){gd(e,c,n,r)}),c}function vd(t,e,n,r,s){var i=n._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var l=s;s=function(){var c=Au(o);l.call(c)}}gd(e,o,t,s)}else o=$2(n,e,t,s,r);return Au(o)}sx=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Ca(e.pendingLanes);n!==0&&(Jp(e,n|1),jn(e,Ut()),!(ut&6)&&(Po=Ut()+500,Zs()))}break;case 13:bi(function(){var r=Zr(t,1);if(r!==null){var s=In();mr(r,t,1,s)}}),Rg(t,1)}};qp=function(t){if(t.tag===13){var e=Zr(t,134217728);if(e!==null){var n=In();mr(e,t,134217728,n)}Rg(t,134217728)}};ix=function(t){if(t.tag===13){var e=Ms(t),n=Zr(t,e);if(n!==null){var r=In();mr(n,t,e,r)}Rg(t,e)}};ox=function(){return vt};ax=function(t,e){var n=vt;try{return vt=t,e()}finally{vt=n}};Ch=function(t,e,n){switch(e){case"input":if(_h(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=ld(r);if(!s)throw Error(le(90));$_(r),_h(r,s)}}}break;case"textarea":U_(t,n);break;case"select":e=n.value,e!=null&&fo(t,!!n.multiple,e,!1)}};Y_=Tg;K_=bi;var F2={usingClientEntryPoint:!1,Events:[wl,no,ld,G_,V_,Tg]},ya={findFiberByHostInstance:di,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},U2={bundleType:ya.bundleType,version:ya.version,rendererPackageName:ya.rendererPackageName,rendererConfig:ya.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:is.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=J_(t),t===null?null:t.stateNode},findFiberByHostInstance:ya.findFiberByHostInstance||j2,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Tc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Tc.isDisabled&&Tc.supportsFiber)try{sd=Tc.inject(U2),Ar=Tc}catch{}}Gn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=F2;Gn.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Og(e))throw Error(le(200));return N2(t,e,null,n)};Gn.createRoot=function(t,e){if(!Og(t))throw Error(le(299));var n=!1,r="",s=A1;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=Ag(t,1,!1,null,null,n,!1,r,s),t[qr]=e.current,rl(t.nodeType===8?t.parentNode:t),new Pg(e)};Gn.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(le(188)):(t=Object.keys(t).join(","),Error(le(268,t)));return t=J_(e),t=t===null?null:t.stateNode,t};Gn.flushSync=function(t){return bi(t)};Gn.hydrate=function(t,e,n){if(!yd(e))throw Error(le(200));return vd(null,t,e,!0,n)};Gn.hydrateRoot=function(t,e,n){if(!Og(t))throw Error(le(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",o=A1;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=k1(e,null,t,1,n??null,s,!1,i,o),t[qr]=e.current,rl(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new md(e)};Gn.render=function(t,e,n){if(!yd(e))throw Error(le(200));return vd(null,t,e,!1,n)};Gn.unmountComponentAtNode=function(t){if(!yd(t))throw Error(le(40));return t._reactRootContainer?(bi(function(){vd(null,null,t,!1,function(){t._reactRootContainer=null,t[qr]=null})}),!0):!1};Gn.unstable_batchedUpdates=Tg;Gn.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!yd(n))throw Error(le(200));if(t==null||t._reactInternals===void 0)throw Error(le(38));return vd(t,e,n,!1,r)};Gn.version="18.3.1-next-f1338f8080-20240426";function R1(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(R1)}catch(t){console.error(t)}}R1(),R_.exports=Gn;var B2=R_.exports,Fy=B2;fh.createRoot=Fy.createRoot,fh.hydrateRoot=Fy.hydrateRoot;const va=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},z2=1280,H2=720,W2=({onStartConfig:t,audioSettings:e,onAudioSettingsChange:n,playerId:r,onGalleryStart:s})=>{const[i,o]=D.useState("title"),[l,c]=D.useState(!1),[u,d]=D.useState("home"),[h,f]=D.useState(!1),[_,R]=D.useState(""),[k]=D.useState(()=>localStorage.getItem("homeCardId")),[B,x]=D.useState(25),[E,T]=D.useState(!1),p=D.useRef(0),$=D.useRef(0),[C,re]=D.useState(1);D.useEffect(()=>{const w=()=>{const S=window.innerWidth/z2,A=window.innerHeight/H2;re(Math.min(S,A))};return w(),window.addEventListener("resize",w),()=>window.removeEventListener("resize",w)},[]);const Y=()=>{c(!0),setTimeout(()=>{o("home"),c(!1)},600)},K=w=>{T(!0),p.current=w.clientX,$.current=B},ce=w=>{if(!E)return;const S=w.clientX-p.current,A=$.current+S*.5;x(Math.max(-180,Math.min(180,A)))},me=()=>{T(!1)},Se=w=>{t(w==="casual"?"CASUAL_MATCH":"RANKED_MATCH")},fe=9*C;if(i==="title")return a.jsxs("div",{className:"screen title-screen",onClick:Y,style:{height:"100dvh",width:"100vw",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative",overflow:"hidden",color:"white",cursor:"pointer"},children:[a.jsx("div",{style:{position:"absolute",inset:0,backgroundImage:`url(${va("/title/background.png")})`,backgroundSize:"cover",backgroundPosition:"center",zIndex:0}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",zIndex:-1}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(0, 0, 0, 0.3)",zIndex:1}}),a.jsxs("div",{style:{position:"relative",zIndex:2,display:"flex",flexDirection:"column",alignItems:"center",transform:l?"translateY(-100vh)":"translateY(0)",transition:l?"transform 0.6s ease-in":"none"},children:[a.jsx("div",{style:{fontFamily:"Tamanegi, sans-serif",fontSize:`${fe}rem`,color:"#fff",textShadow:"0 0 30px rgba(233, 69, 96, 0.9), 0 0 60px rgba(233, 69, 96, 0.5), 3px 3px 6px rgba(0,0,0,0.9)",letterSpacing:`${.5*C}rem`,whiteSpace:"nowrap",marginBottom:`${2*C}rem`},children:""}),a.jsx("div",{style:{fontSize:`${2*C}rem`,color:"#fff",fontWeight:"bold",letterSpacing:`${.3*C}rem`,animation:"blink 1.5s ease-in-out infinite",textShadow:"0 0 10px rgba(255, 255, 255, 0.8)"},children:"GAME START"})]}),a.jsx("p",{style:{position:"absolute",bottom:20*C,opacity:.5,fontSize:`${.8*C}rem`,zIndex:2},children:"Ver 1.04 Beta"}),a.jsx("style",{children:`
                    @keyframes blink {
                        0%, 100% { opacity: 1; }
                        50% { opacity: 0.3; }
                    }
                `})]});const te=[{id:"solo",label:"",color:"#e94560"},{id:"room",label:"",color:"#60a5fa"},{id:"random",label:"",color:"#4ade80"},{id:"home",label:"",color:"#f59e0b"},{id:"ranking",label:"",color:"#a855f7"},{id:"gallery",label:"",color:"#ec4899"},{id:"settings",label:"",color:"#6b7280"}];return a.jsxs("div",{className:"screen home-screen",style:{height:"100dvh",width:"100vw",display:"flex",flexDirection:"column",position:"relative",overflow:"hidden",color:"white"},onMouseMove:ce,onMouseUp:me,onMouseLeave:me,children:[a.jsx("div",{style:{position:"absolute",inset:0,backgroundImage:`url(${va("/title/background.png")})`,backgroundSize:"cover",backgroundPosition:"center",zIndex:0}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",zIndex:-1}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(0, 0, 0, 0.5)",zIndex:1}}),a.jsx("div",{style:{position:"absolute",top:20*C,left:"50%",transform:"translateX(-50%)",fontFamily:"Tamanegi, sans-serif",fontSize:`${2.5*C}rem`,color:"#fff",textShadow:"0 0 15px rgba(233, 69, 96, 0.7)",letterSpacing:`${.2*C}rem`,zIndex:10},children:""}),a.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",paddingBottom:80*C,position:"relative",zIndex:2},children:[u==="home"&&a.jsxs("div",{style:{position:"absolute",left:50*C,top:"50%",transform:"translateY(-50%)",perspective:1e3},children:[a.jsxs("div",{onMouseDown:K,style:{width:200*C,height:280*C,transformStyle:"preserve-3d",transform:`rotateY(${B}deg)`,transition:E?"none":"transform 0.3s ease-out",cursor:E?"grabbing":"grab"},children:[a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",borderRadius:12*C,background:k?`url(${va(`/cards/${k}.png`)})`:"linear-gradient(135deg, #2d3748 0%, #1a202c 100%)",backgroundSize:"cover",backgroundPosition:"center",border:`3px solid ${k?"#e94560":"#4a5568"}`,boxShadow:"0 10px 30px rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center"},children:!k&&a.jsxs("span",{style:{fontSize:`${.9*C}rem`,color:"#718096",textAlign:"center",padding:20*C},children:["",a.jsx("br",{}),"",a.jsx("br",{}),""]})}),a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",transform:"rotateY(180deg)",borderRadius:12*C,background:k?`url(${va(`/cards/${k}_evolved.png`)})`:`url(${va("/cards/sleeve_default.png")})`,backgroundSize:"cover",backgroundPosition:"center",border:`3px solid ${k?"#a855f7":"#4a5568"}`,boxShadow:"0 10px 30px rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center"},children:!k&&a.jsx("span",{style:{fontSize:`${.8*C}rem`,color:"#718096"},children:""})})]}),a.jsx("p",{style:{textAlign:"center",marginTop:10*C,fontSize:`${.75*C}rem`,color:"#888"},children:""})]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",maxWidth:600*C},children:[u==="home"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*C}rem`,marginBottom:`${1*C}rem`},children:""}),a.jsx("p",{style:{fontSize:`${1*C}rem`,color:"#aaa"},children:""})]}),u==="solo"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*C}rem`,marginBottom:`${1*C}rem`,color:"#e94560"},children:""}),a.jsx("button",{onClick:()=>t("CPU"),style:{padding:`${1*C}rem ${3*C}rem`,fontSize:`${1.2*C}rem`,background:"#e94560",border:"none",borderRadius:8*C,color:"white",cursor:"pointer",fontWeight:"bold"},children:"CPU"})]}),u==="room"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*C}rem`,marginBottom:`${1.5*C}rem`,color:"#60a5fa"},children:""}),h?a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:`${1*C}rem`,alignItems:"center"},children:[a.jsx("input",{type:"text",placeholder:"ID",value:_,onChange:w=>R(w.target.value),style:{padding:`${.8*C}rem`,fontSize:`${1*C}rem`,width:250*C,background:"rgba(255,255,255,0.1)",border:"2px solid #a855f7",borderRadius:8*C,color:"white",textAlign:"center"}}),a.jsxs("div",{style:{display:"flex",gap:`${.5*C}rem`},children:[a.jsx("button",{onClick:()=>f(!1),style:{padding:`${.6*C}rem ${1.5*C}rem`,fontSize:`${1*C}rem`,background:"transparent",border:"1px solid #666",borderRadius:6*C,color:"#888",cursor:"pointer"},children:""}),a.jsx("button",{onClick:()=>t("JOIN",_),disabled:!_,style:{padding:`${.6*C}rem ${1.5*C}rem`,fontSize:`${1*C}rem`,background:_?"#a855f7":"#333",border:"none",borderRadius:6*C,color:"white",cursor:_?"pointer":"not-allowed",opacity:_?1:.5},children:""})]})]}):a.jsxs("div",{style:{display:"flex",gap:`${3*C}rem`,perspective:1200},children:[a.jsxs("div",{onClick:()=>t("HOST"),style:{width:200*C,height:280*C,background:"linear-gradient(135deg, #1a2a3a 0%, #0d1a2a 100%)",border:"3px solid #60a5fa",borderRadius:16*C,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(96, 165, 250, 0.3)"},onMouseOver:w=>{w.currentTarget.style.transform="rotateY(0deg) scale(1.05)",w.currentTarget.style.boxShadow="0 15px 40px rgba(96, 165, 250, 0.5)"},onMouseOut:w=>{w.currentTarget.style.transform="rotateY(15deg)",w.currentTarget.style.boxShadow="0 10px 30px rgba(96, 165, 250, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*C}rem`,marginBottom:`${.5*C}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*C}rem`,color:"#60a5fa",margin:0,marginBottom:`${.5*C}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*C}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*C}rem`},children:["ID",a.jsx("br",{}),""]})]}),a.jsxs("div",{onClick:()=>f(!0),style:{width:200*C,height:280*C,background:"linear-gradient(135deg, #2a1a3a 0%, #1a0d2a 100%)",border:"3px solid #a855f7",borderRadius:16*C,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(-15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(168, 85, 247, 0.3)"},onMouseOver:w=>{w.currentTarget.style.transform="rotateY(0deg) scale(1.05)",w.currentTarget.style.boxShadow="0 15px 40px rgba(168, 85, 247, 0.5)"},onMouseOut:w=>{w.currentTarget.style.transform="rotateY(-15deg)",w.currentTarget.style.boxShadow="0 10px 30px rgba(168, 85, 247, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*C}rem`,marginBottom:`${.5*C}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*C}rem`,color:"#a855f7",margin:0,marginBottom:`${.5*C}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*C}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*C}rem`},children:["ID",a.jsx("br",{}),""]})]})]})]}),u==="random"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*C}rem`,marginBottom:`${1.5*C}rem`,color:"#4ade80"},children:""}),a.jsxs("div",{style:{display:"flex",gap:`${3*C}rem`,perspective:1200},children:[a.jsxs("div",{onClick:()=>Se("casual"),style:{width:200*C,height:280*C,background:"linear-gradient(135deg, #1a3a1a 0%, #0d2d0d 100%)",border:"3px solid #4ade80",borderRadius:16*C,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(74, 222, 128, 0.3)"},onMouseOver:w=>{w.currentTarget.style.transform="rotateY(0deg) scale(1.05)",w.currentTarget.style.boxShadow="0 15px 40px rgba(74, 222, 128, 0.5)"},onMouseOut:w=>{w.currentTarget.style.transform="rotateY(15deg)",w.currentTarget.style.boxShadow="0 10px 30px rgba(74, 222, 128, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*C}rem`,marginBottom:`${.5*C}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*C}rem`,color:"#4ade80",margin:0,marginBottom:`${.5*C}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*C}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*C}rem`},children:["",a.jsx("br",{}),""]})]}),a.jsxs("div",{onClick:()=>Se("ranked"),style:{width:200*C,height:280*C,background:"linear-gradient(135deg, #3a1a1a 0%, #2d0d0d 100%)",border:"3px solid #e94560",borderRadius:16*C,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(-15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(233, 69, 96, 0.3)"},onMouseOver:w=>{w.currentTarget.style.transform="rotateY(0deg) scale(1.05)",w.currentTarget.style.boxShadow="0 15px 40px rgba(233, 69, 96, 0.5)"},onMouseOut:w=>{w.currentTarget.style.transform="rotateY(-15deg)",w.currentTarget.style.boxShadow="0 10px 30px rgba(233, 69, 96, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*C}rem`,marginBottom:`${.5*C}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*C}rem`,color:"#e94560",margin:0,marginBottom:`${.5*C}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*C}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*C}rem`},children:["",a.jsx("br",{}),""]})]})]})]}),u==="ranking"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*C}rem`,marginBottom:`${1*C}rem`,color:"#a855f7"},children:""}),a.jsx("p",{style:{fontSize:`${1*C}rem`,color:"#888"},children:"Coming Soon..."})]}),u==="gallery"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*C}rem`,marginBottom:`${1.5*C}rem`,color:"#ec4899"},children:""}),a.jsx("button",{onClick:s,style:{padding:`${1*C}rem ${3*C}rem`,fontSize:`${1.2*C}rem`,background:"#ec4899",border:"none",borderRadius:8*C,color:"white",cursor:"pointer",fontWeight:"bold"},children:""})]}),u==="settings"&&a.jsxs("div",{style:{background:"rgba(0, 0, 0, 0.3)",borderRadius:12*C,padding:`${2*C}rem`,minWidth:400*C},children:[a.jsx("h2",{style:{fontSize:`${1.8*C}rem`,marginBottom:`${1.5*C}rem`,color:"#6b7280",textAlign:"center"},children:""}),a.jsxs("div",{style:{marginBottom:`${1.5*C}rem`},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:`${.5*C}rem`},children:[a.jsx("span",{style:{fontSize:`${1*C}rem`},children:"BGM"}),a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8*C,cursor:"pointer"},children:[a.jsx("input",{type:"checkbox",checked:e.bgmEnabled,onChange:w=>n({bgmEnabled:w.target.checked}),style:{width:18*C,height:18*C}}),a.jsx("span",{style:{color:e.bgmEnabled?"#4ade80":"#888",fontSize:`${.9*C}rem`},children:e.bgmEnabled?"ON":"OFF"})]})]}),a.jsx("input",{type:"range",min:0,max:1,step:.05,value:e.bgm,onChange:w=>n({bgm:parseFloat(w.target.value)}),disabled:!e.bgmEnabled,style:{width:"100%",opacity:e.bgmEnabled?1:.5}})]}),a.jsxs("div",{style:{marginBottom:`${1*C}rem`},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:`${.5*C}rem`},children:[a.jsx("span",{style:{fontSize:`${1*C}rem`},children:""}),a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8*C,cursor:"pointer"},children:[a.jsx("input",{type:"checkbox",checked:e.seEnabled,onChange:w=>n({seEnabled:w.target.checked}),style:{width:18*C,height:18*C}}),a.jsx("span",{style:{color:e.seEnabled?"#4ade80":"#888",fontSize:`${.9*C}rem`},children:e.seEnabled?"ON":"OFF"})]})]}),a.jsx("input",{type:"range",min:0,max:1,step:.05,value:e.se,onChange:w=>n({se:parseFloat(w.target.value)}),disabled:!e.seEnabled,style:{width:"100%",opacity:e.seEnabled?1:.5}})]})]})]})]}),a.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:70*C,background:"rgba(0, 0, 0, 0.8)",borderTop:"2px solid rgba(255, 255, 255, 0.1)",display:"flex",justifyContent:"center",alignItems:"center",gap:`${.5*C}rem`,padding:`0 ${1*C}rem`,zIndex:3},children:te.map(w=>a.jsx("button",{onClick:()=>d(w.id),style:{flex:1,maxWidth:140*C,padding:`${.6*C}rem ${.5*C}rem`,fontSize:`${.85*C}rem`,background:u===w.id?w.color:"transparent",border:u===w.id?"none":`2px solid ${w.color}`,borderRadius:8*C,color:u===w.id?"white":w.color,cursor:"pointer",transition:"all 0.2s",fontWeight:u===w.id?"bold":"normal"},children:w.label},w.id))}),a.jsx("p",{style:{position:"absolute",bottom:75*C,right:20*C,opacity:.5,fontSize:`${.7*C}rem`,zIndex:2},children:"Ver 1.04 Beta"})]})},G2=()=>{};var Uy={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P1={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const de=function(t,e){if(!t)throw Ho(e)},Ho=function(t){return new Error("Firebase Database ("+P1.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O1=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},V2=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=t[n++],o=t[n++],l=t[n++],c=((s&7)<<18|(i&63)<<12|(o&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{const i=t[n++],o=t[n++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},Lg={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<t.length;s+=3){const i=t[s],o=s+1<t.length,l=o?t[s+1]:0,c=s+2<t.length,u=c?t[s+2]:0,d=i>>2,h=(i&3)<<4|l>>4;let f=(l&15)<<2|u>>6,_=u&63;c||(_=64,o||(f=64)),r.push(n[d],n[h],n[f],n[_])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(O1(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):V2(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<t.length;){const i=n[t.charAt(s++)],l=s<t.length?n[t.charAt(s)]:0;++s;const u=s<t.length?n[t.charAt(s)]:64;++s;const h=s<t.length?n[t.charAt(s)]:64;if(++s,i==null||l==null||u==null||h==null)throw new Y2;const f=i<<2|l>>4;if(r.push(f),u!==64){const _=l<<4&240|u>>2;if(r.push(_),h!==64){const R=u<<6&192|h;r.push(R)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class Y2 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const L1=function(t){const e=O1(t);return Lg.encodeByteArray(e,!0)},Ru=function(t){return L1(t).replace(/\./g,"")},Pu=function(t){try{return Lg.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K2(t){return D1(void 0,t)}function D1(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const n=e;return new Date(n.getTime());case Object:t===void 0&&(t={});break;case Array:t=[];break;default:return e}for(const n in e)!e.hasOwnProperty(n)||!X2(n)||(t[n]=D1(t[n],e[n]));return t}function X2(t){return t!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Q2(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J2=()=>Q2().__FIREBASE_DEFAULTS__,q2=()=>{if(typeof process>"u"||typeof Uy>"u")return;const t=Uy.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},Z2=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&Pu(t[1]);return e&&JSON.parse(e)},Dg=()=>{try{return G2()||J2()||q2()||Z2()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},M1=t=>{var e,n;return(n=(e=Dg())==null?void 0:e.emulatorHosts)==null?void 0:n[t]},eC=t=>{const e=M1(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},N1=()=>{var t;return(t=Dg())==null?void 0:t.config},j1=t=>{var e;return(e=Dg())==null?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ur{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wo(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function $1(t){return(await fetch(t,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tC(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",s=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...t};return[Ru(JSON.stringify(n)),Ru(JSON.stringify(o)),""].join(".")}const $a={};function nC(){const t={prod:[],emulator:[]};for(const e of Object.keys($a))$a[e]?t.emulator.push(e):t.prod.push(e);return t}function rC(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let By=!1;function F1(t,e){if(typeof window>"u"||typeof document>"u"||!Wo(window.location.host)||$a[t]===e||$a[t]||By)return;$a[t]=e;function n(f){return`__firebase__banner__${f}`}const r="__firebase__banner",i=nC().prod.length>0;function o(){const f=document.getElementById(r);f&&f.remove()}function l(f){f.style.display="flex",f.style.background="#7faaf0",f.style.position="fixed",f.style.bottom="5px",f.style.left="5px",f.style.padding=".5em",f.style.borderRadius="5px",f.style.alignItems="center"}function c(f,_){f.setAttribute("width","24"),f.setAttribute("id",_),f.setAttribute("height","24"),f.setAttribute("viewBox","0 0 24 24"),f.setAttribute("fill","none"),f.style.marginLeft="-6px"}function u(){const f=document.createElement("span");return f.style.cursor="pointer",f.style.marginLeft="16px",f.style.fontSize="24px",f.innerHTML=" &times;",f.onclick=()=>{By=!0,o()},f}function d(f,_){f.setAttribute("id",_),f.innerText="Learn more",f.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",f.setAttribute("target","__blank"),f.style.paddingLeft="5px",f.style.textDecoration="underline"}function h(){const f=rC(r),_=n("text"),R=document.getElementById(_)||document.createElement("span"),k=n("learnmore"),B=document.getElementById(k)||document.createElement("a"),x=n("preprendIcon"),E=document.getElementById(x)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(f.created){const T=f.element;l(T),d(B,k);const p=u();c(E,x),T.append(E,R,B,p),document.body.appendChild(T)}i?(R.innerText="Preview backend disconnected.",E.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(E.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,R.innerText="Preview backend running in this workspace."),R.setAttribute("id",_)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",h):h()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Mg(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Cn())}function sC(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function iC(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function U1(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function oC(){const t=Cn();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function aC(){return P1.NODE_ADMIN===!0}function lC(){try{return typeof indexedDB=="object"}catch{return!1}}function cC(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var i;e(((i=s.error)==null?void 0:i.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uC="FirebaseError";class ei extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=uC,Object.setPrototypeOf(this,ei.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Al.prototype.create)}}class Al{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?dC(i,r):"Error",l=`${this.serviceName}: ${o} (${s}).`;return new ei(s,l,r)}}function dC(t,e){return t.replace(fC,(n,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const fC=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fl(t){return JSON.parse(t)}function Yt(t){return JSON.stringify(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B1=function(t){let e={},n={},r={},s="";try{const i=t.split(".");e=fl(Pu(i[0])||""),n=fl(Pu(i[1])||""),s=i[2],r=n.d||{},delete n.d}catch{}return{header:e,claims:n,data:r,signature:s}},hC=function(t){const e=B1(t),n=e.claims;return!!n&&typeof n=="object"&&n.hasOwnProperty("iat")},pC=function(t){const e=B1(t).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _r(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Ei(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}function Ou(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Lu(t,e,n){const r={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(r[s]=e.call(n,t[s],s,t));return r}function Si(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const i=t[s],o=e[s];if(zy(i)&&zy(o)){if(!Si(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function zy(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Go(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gC{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,n){n||(n=0);const r=this.W_;if(typeof e=="string")for(let h=0;h<16;h++)r[h]=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),n+=4;else for(let h=0;h<16;h++)r[h]=e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3],n+=4;for(let h=16;h<80;h++){const f=r[h-3]^r[h-8]^r[h-14]^r[h-16];r[h]=(f<<1|f>>>31)&4294967295}let s=this.chain_[0],i=this.chain_[1],o=this.chain_[2],l=this.chain_[3],c=this.chain_[4],u,d;for(let h=0;h<80;h++){h<40?h<20?(u=l^i&(o^l),d=1518500249):(u=i^o^l,d=1859775393):h<60?(u=i&o|l&(i|o),d=2400959708):(u=i^o^l,d=3395469782);const f=(s<<5|s>>>27)+u+c+d+r[h]&4294967295;c=l,l=o,o=(i<<30|i>>>2)&4294967295,i=s,s=f}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+i&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,n){if(e==null)return;n===void 0&&(n=e.length);const r=n-this.blockSize;let s=0;const i=this.buf_;let o=this.inbuf_;for(;s<n;){if(o===0)for(;s<=r;)this.compress_(e,s),s+=this.blockSize;if(typeof e=="string"){for(;s<n;)if(i[o]=e.charCodeAt(s),++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}else for(;s<n;)if(i[o]=e[s],++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=n}digest(){const e=[];let n=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=n&255,n/=256;this.compress_(this.buf_);let r=0;for(let s=0;s<5;s++)for(let i=24;i>=0;i-=8)e[r]=this.chain_[s]>>i&255,++r;return e}}function mC(t,e){const n=new yC(t,e);return n.subscribe.bind(n)}class yC{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let s;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");vC(e,["next","error","complete"])?s=e:s={next:e,error:n,complete:r},s.next===void 0&&(s.next=Xf),s.error===void 0&&(s.error=Xf),s.complete===void 0&&(s.complete=Xf);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function vC(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function Xf(){}function Oo(t,e){return`${t} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _C=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);if(s>=55296&&s<=56319){const i=s-55296;r++,de(r<t.length,"Surrogate pair missing trail surrogate.");const o=t.charCodeAt(r)-56320;s=65536+(i<<10)+o}s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):s<65536?(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},_d=function(t){let e=0;for(let n=0;n<t.length;n++){const r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,n++):e+=3}return e};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yn(t){return t&&t._delegate?t._delegate:t}class Ii{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const li="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xC{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new ur;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:n});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(EC(e))try{this.getOrInitializeService({instanceIdentifier:li})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(n);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=li){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=li){return this.instances.has(e)}getOptions(e=li){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[i,o]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);r===l&&o.resolve(s)}return s}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const s of r)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:bC(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=li){return this.component?this.component.multipleInstances?e:li:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function bC(t){return t===li?void 0:t}function EC(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SC{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new xC(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var bt;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(bt||(bt={}));const IC={debug:bt.DEBUG,verbose:bt.VERBOSE,info:bt.INFO,warn:bt.WARN,error:bt.ERROR,silent:bt.SILENT},TC=bt.INFO,CC={[bt.DEBUG]:"log",[bt.VERBOSE]:"log",[bt.INFO]:"info",[bt.WARN]:"warn",[bt.ERROR]:"error"},wC=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),s=CC[e];if(s)console[s](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Ng{constructor(e){this.name=e,this._logLevel=TC,this._logHandler=wC,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in bt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?IC[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,bt.DEBUG,...e),this._logHandler(this,bt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,bt.VERBOSE,...e),this._logHandler(this,bt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,bt.INFO,...e),this._logHandler(this,bt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,bt.WARN,...e),this._logHandler(this,bt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,bt.ERROR,...e),this._logHandler(this,bt.ERROR,...e)}}const kC=(t,e)=>e.some(n=>t instanceof n);let Hy,Wy;function AC(){return Hy||(Hy=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function RC(){return Wy||(Wy=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const z1=new WeakMap,ip=new WeakMap,H1=new WeakMap,Qf=new WeakMap,jg=new WeakMap;function PC(t){const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("success",i),t.removeEventListener("error",o)},i=()=>{n(js(t.result)),s()},o=()=>{r(t.error),s()};t.addEventListener("success",i),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&z1.set(n,t)}).catch(()=>{}),jg.set(e,t),e}function OC(t){if(ip.has(t))return;const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",o),t.removeEventListener("abort",o)},i=()=>{n(),s()},o=()=>{r(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",i),t.addEventListener("error",o),t.addEventListener("abort",o)});ip.set(t,e)}let op={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return ip.get(t);if(e==="objectStoreNames")return t.objectStoreNames||H1.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return js(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function LC(t){op=t(op)}function DC(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(Jf(this),e,...n);return H1.set(r,e.sort?e.sort():[e]),js(r)}:RC().includes(t)?function(...e){return t.apply(Jf(this),e),js(z1.get(this))}:function(...e){return js(t.apply(Jf(this),e))}}function MC(t){return typeof t=="function"?DC(t):(t instanceof IDBTransaction&&OC(t),kC(t,AC())?new Proxy(t,op):t)}function js(t){if(t instanceof IDBRequest)return PC(t);if(Qf.has(t))return Qf.get(t);const e=MC(t);return e!==t&&(Qf.set(t,e),jg.set(e,t)),e}const Jf=t=>jg.get(t);function NC(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(t,e),l=js(o);return r&&o.addEventListener("upgradeneeded",c=>{r(js(o.result),c.oldVersion,c.newVersion,js(o.transaction),c)}),n&&o.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),l.then(c=>{i&&c.addEventListener("close",()=>i()),s&&c.addEventListener("versionchange",u=>s(u.oldVersion,u.newVersion,u))}).catch(()=>{}),l}const jC=["get","getKey","getAll","getAllKeys","count"],$C=["put","add","delete","clear"],qf=new Map;function Gy(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(qf.get(e))return qf.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=$C.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||jC.includes(n)))return;const i=async function(o,...l){const c=this.transaction(o,s?"readwrite":"readonly");let u=c.store;return r&&(u=u.index(l.shift())),(await Promise.all([u[n](...l),s&&c.done]))[0]};return qf.set(e,i),i}LC(t=>({...t,get:(e,n,r)=>Gy(e,n)||t.get(e,n,r),has:(e,n)=>!!Gy(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FC{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(UC(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function UC(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const ap="@firebase/app",Vy="0.14.6";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ts=new Ng("@firebase/app"),BC="@firebase/app-compat",zC="@firebase/analytics-compat",HC="@firebase/analytics",WC="@firebase/app-check-compat",GC="@firebase/app-check",VC="@firebase/auth",YC="@firebase/auth-compat",KC="@firebase/database",XC="@firebase/data-connect",QC="@firebase/database-compat",JC="@firebase/functions",qC="@firebase/functions-compat",ZC="@firebase/installations",ew="@firebase/installations-compat",tw="@firebase/messaging",nw="@firebase/messaging-compat",rw="@firebase/performance",sw="@firebase/performance-compat",iw="@firebase/remote-config",ow="@firebase/remote-config-compat",aw="@firebase/storage",lw="@firebase/storage-compat",cw="@firebase/firestore",uw="@firebase/ai",dw="@firebase/firestore-compat",fw="firebase",hw="12.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lp="[DEFAULT]",pw={[ap]:"fire-core",[BC]:"fire-core-compat",[HC]:"fire-analytics",[zC]:"fire-analytics-compat",[GC]:"fire-app-check",[WC]:"fire-app-check-compat",[VC]:"fire-auth",[YC]:"fire-auth-compat",[KC]:"fire-rtdb",[XC]:"fire-data-connect",[QC]:"fire-rtdb-compat",[JC]:"fire-fn",[qC]:"fire-fn-compat",[ZC]:"fire-iid",[ew]:"fire-iid-compat",[tw]:"fire-fcm",[nw]:"fire-fcm-compat",[rw]:"fire-perf",[sw]:"fire-perf-compat",[iw]:"fire-rc",[ow]:"fire-rc-compat",[aw]:"fire-gcs",[lw]:"fire-gcs-compat",[cw]:"fire-fst",[dw]:"fire-fst-compat",[uw]:"fire-vertex","fire-js":"fire-js",[fw]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Du=new Map,gw=new Map,cp=new Map;function Yy(t,e){try{t.container.addComponent(e)}catch(n){ts.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Lo(t){const e=t.name;if(cp.has(e))return ts.debug(`There were multiple attempts to register component ${e}.`),!1;cp.set(e,t);for(const n of Du.values())Yy(n,t);for(const n of gw.values())Yy(n,t);return!0}function $g(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function dr(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mw={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},$s=new Al("app","Firebase",mw);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yw{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Ii("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw $s.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vo=hw;function W1(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:lp,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw $s.create("bad-app-name",{appName:String(s)});if(n||(n=N1()),!n)throw $s.create("no-options");const i=Du.get(s);if(i){if(Si(n,i.options)&&Si(r,i.config))return i;throw $s.create("duplicate-app",{appName:s})}const o=new SC(s);for(const c of cp.values())o.addComponent(c);const l=new yw(n,r,o);return Du.set(s,l),l}function G1(t=lp){const e=Du.get(t);if(!e&&t===lp&&N1())return W1();if(!e)throw $s.create("no-app",{appName:t});return e}function Fs(t,e,n){let r=pw[t]??t;n&&(r+=`-${n}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const o=[`Unable to register library "${r}" with version "${e}":`];s&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),ts.warn(o.join(" "));return}Lo(new Ii(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vw="firebase-heartbeat-database",_w=1,hl="firebase-heartbeat-store";let Zf=null;function V1(){return Zf||(Zf=NC(vw,_w,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(hl)}catch(n){console.warn(n)}}}}).catch(t=>{throw $s.create("idb-open",{originalErrorMessage:t.message})})),Zf}async function xw(t){try{const n=(await V1()).transaction(hl),r=await n.objectStore(hl).get(Y1(t));return await n.done,r}catch(e){if(e instanceof ei)ts.warn(e.message);else{const n=$s.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});ts.warn(n.message)}}}async function Ky(t,e){try{const r=(await V1()).transaction(hl,"readwrite");await r.objectStore(hl).put(e,Y1(t)),await r.done}catch(n){if(n instanceof ei)ts.warn(n.message);else{const r=$s.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});ts.warn(r.message)}}}function Y1(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bw=1024,Ew=30;class Sw{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new Tw(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Xy();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)==null?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats.length>Ew){const o=Cw(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){ts.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=Xy(),{heartbeatsToSend:r,unsentEntries:s}=Iw(this._heartbeatsCache.heartbeats),i=Ru(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(n){return ts.warn(n),""}}}function Xy(){return new Date().toISOString().substring(0,10)}function Iw(t,e=bw){const n=[];let r=t.slice();for(const s of t){const i=n.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),Qy(n)>e){i.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),Qy(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class Tw{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return lC()?cC().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await xw(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Ky(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Ky(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function Qy(t){return Ru(JSON.stringify({version:2,heartbeats:t})).length}function Cw(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ww(t){Lo(new Ii("platform-logger",e=>new FC(e),"PRIVATE")),Lo(new Ii("heartbeat",e=>new Sw(e),"PRIVATE")),Fs(ap,Vy,t),Fs(ap,Vy,"esm2020"),Fs("fire-js","")}ww("");var kw="firebase",Aw="12.7.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Fs(kw,Aw,"app");var Jy={};const qy="@firebase/database",Zy="1.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let K1="";function Rw(t){K1=t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pw{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,n){n==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Yt(n))}get(e){const n=this.domStorage_.getItem(this.prefixedName_(e));return n==null?null:fl(n)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ow{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,n){n==null?delete this.cache_[e]:this.cache_[e]=n}get(e){return _r(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X1=function(t){try{if(typeof window<"u"&&typeof window[t]<"u"){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Pw(e)}}catch{}return new Ow},pi=X1("localStorage"),Lw=X1("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vo=new Ng("@firebase/database"),Q1=function(){let t=1;return function(){return t++}}(),J1=function(t){const e=_C(t),n=new gC;n.update(e);const r=n.digest();return Lg.encodeByteArray(r)},Rl=function(...t){let e="";for(let n=0;n<t.length;n++){const r=t[n];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=Rl.apply(null,r):typeof r=="object"?e+=Yt(r):e+=r,e+=" "}return e};let Fa=null,ev=!0;const Dw=function(t,e){de(!0,"Can't turn on custom loggers persistently."),vo.logLevel=bt.VERBOSE,Fa=vo.log.bind(vo)},qt=function(...t){if(ev===!0&&(ev=!1,Fa===null&&Lw.get("logging_enabled")===!0&&Dw()),Fa){const e=Rl.apply(null,t);Fa(e)}},Pl=function(t){return function(...e){qt(t,...e)}},up=function(...t){const e="FIREBASE INTERNAL ERROR: "+Rl(...t);vo.error(e)},ns=function(...t){const e=`FIREBASE FATAL ERROR: ${Rl(...t)}`;throw vo.error(e),new Error(e)},Tn=function(...t){const e="FIREBASE WARNING: "+Rl(...t);vo.warn(e)},Mw=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Tn("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},xd=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},Nw=function(t){if(document.readyState==="complete")t();else{let e=!1;const n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&n()}),window.attachEvent("onload",n))}},Do="[MIN_NAME]",Ti="[MAX_NAME]",Pi=function(t,e){if(t===e)return 0;if(t===Do||e===Ti)return-1;if(e===Do||t===Ti)return 1;{const n=tv(t),r=tv(e);return n!==null?r!==null?n-r===0?t.length-e.length:n-r:-1:r!==null?1:t<e?-1:1}},jw=function(t,e){return t===e?0:t<e?-1:1},_a=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+Yt(e))},Fg=function(t){if(typeof t!="object"||t===null)return Yt(t);const e=[];for(const r in t)e.push(r);e.sort();let n="{";for(let r=0;r<e.length;r++)r!==0&&(n+=","),n+=Yt(e[r]),n+=":",n+=Fg(t[e[r]]);return n+="}",n},q1=function(t,e){const n=t.length;if(n<=e)return[t];const r=[];for(let s=0;s<n;s+=e)s+e>n?r.push(t.substring(s,n)):r.push(t.substring(s,s+e));return r};function en(t,e){for(const n in t)t.hasOwnProperty(n)&&e(n,t[n])}const Z1=function(t){de(!xd(t),"Invalid JSON number");const e=11,n=52,r=(1<<e-1)-1;let s,i,o,l,c;t===0?(i=0,o=0,s=1/t===-1/0?1:0):(s=t<0,t=Math.abs(t),t>=Math.pow(2,1-r)?(l=Math.min(Math.floor(Math.log(t)/Math.LN2),r),i=l+r,o=Math.round(t*Math.pow(2,n-l)-Math.pow(2,n))):(i=0,o=Math.round(t/Math.pow(2,1-r-n))));const u=[];for(c=n;c;c-=1)u.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)u.push(i%2?1:0),i=Math.floor(i/2);u.push(s?1:0),u.reverse();const d=u.join("");let h="";for(c=0;c<64;c+=8){let f=parseInt(d.substr(c,8),2).toString(16);f.length===1&&(f="0"+f),h=h+f}return h.toLowerCase()},$w=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},Fw=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function Uw(t,e){let n="Unknown Error";t==="too_big"?n="The data requested exceeds the maximum size that can be accessed with a single request.":t==="permission_denied"?n="Client doesn't have permission to access the desired data.":t==="unavailable"&&(n="The service is unavailable");const r=new Error(t+" at "+e._path.toString()+": "+n);return r.code=t.toUpperCase(),r}const Bw=new RegExp("^-?(0*)\\d{1,10}$"),zw=-2147483648,Hw=2147483647,tv=function(t){if(Bw.test(t)){const e=Number(t);if(e>=zw&&e<=Hw)return e}return null},Yo=function(t){try{t()}catch(e){setTimeout(()=>{const n=e.stack||"";throw Tn("Exception was thrown by user callback.",n),e},Math.floor(0))}},Ww=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Ua=function(t,e){const n=setTimeout(t,e);return typeof n=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(n):typeof n=="object"&&n.unref&&n.unref(),n};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gw{constructor(e,n){this.appCheckProvider=n,this.appName=e.name,dr(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=n==null?void 0:n.getImmediate({optional:!0}),this.appCheck||n==null||n.get().then(r=>this.appCheck=r)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((n,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(n,r):n(null)},0)})}addTokenChangeListener(e){var n;(n=this.appCheckProvider)==null||n.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){Tn(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vw{constructor(e,n,r){this.appName_=e,this.firebaseOptions_=n,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(n=>n&&n.code==="auth/token-not-initialized"?(qt("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(n)):new Promise((n,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(n,r):n(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(n=>n.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(n=>n.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Tn(e)}}class Yc{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Yc.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ug="5",eb="v",tb="s",nb="r",rb="f",sb=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,ib="ls",ob="p",dp="ac",ab="websocket",lb="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cb{constructor(e,n,r,s,i=!1,o="",l=!1,c=!1,u=null){this.secure=n,this.namespace=r,this.webSocketOnly=s,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=l,this.isUsingEmulator=c,this.emulatorOptions=u,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=pi.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&pi.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",n=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${n}`}}function Yw(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function ub(t,e,n){de(typeof e=="string","typeof type must == string"),de(typeof n=="object","typeof params must == object");let r;if(e===ab)r=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===lb)r=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);Yw(t)&&(n.ns=t.namespace);const s=[];return en(n,(i,o)=>{s.push(i+"="+o)}),r+s.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kw{constructor(){this.counters_={}}incrementCounter(e,n=1){_r(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=n}get(){return K2(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eh={},th={};function Bg(t){const e=t.toString();return eh[e]||(eh[e]=new Kw),eh[e]}function Xw(t,e){const n=t.toString();return th[n]||(th[n]=e()),th[n]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qw{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,n){this.closeAfterResponse=e,this.onClose=n,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,n){for(this.pendingResponses[e]=n;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<r.length;++s)r[s]&&Yo(()=>{this.onMessage_(r[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nv="start",Jw="close",qw="pLPCommand",Zw="pRTLPCB",db="id",fb="pw",hb="ser",ek="cb",tk="seg",nk="ts",rk="d",sk="dframe",pb=1870,gb=30,ik=pb-gb,ok=25e3,ak=3e4;class co{constructor(e,n,r,s,i,o,l){this.connId=e,this.repoInfo=n,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.transportSessionId=o,this.lastSessionId=l,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Pl(e),this.stats_=Bg(n),this.urlFn=c=>(this.appCheckToken&&(c[dp]=this.appCheckToken),ub(n,lb,c))}open(e,n){this.curSegmentNum=0,this.onDisconnect_=n,this.myPacketOrderer=new Qw(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(ak)),Nw(()=>{if(this.isClosed_)return;this.scriptTagHolder=new zg((...i)=>{const[o,l,c,u,d]=i;if(this.incrementIncomingBytes_(i),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===nv)this.id=l,this.password=c;else if(o===Jw)l?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(l,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...i)=>{const[o,l]=i;this.incrementIncomingBytes_(i),this.myPacketOrderer.handleResponse(o,l)},()=>{this.onClosed_()},this.urlFn);const r={};r[nv]="t",r[hb]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[ek]=this.scriptTagHolder.uniqueCallbackIdentifier),r[eb]=Ug,this.transportSessionId&&(r[tb]=this.transportSessionId),this.lastSessionId&&(r[ib]=this.lastSessionId),this.applicationId&&(r[ob]=this.applicationId),this.appCheckToken&&(r[dp]=this.appCheckToken),typeof location<"u"&&location.hostname&&sb.test(location.hostname)&&(r[nb]=rb);const s=this.urlFn(r);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){co.forceAllow_=!0}static forceDisallow(){co.forceDisallow_=!0}static isAvailable(){return co.forceAllow_?!0:!co.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!$w()&&!Fw()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const n=Yt(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const r=L1(n),s=q1(r,ik);for(let i=0;i<s.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[i]),this.curSegmentNum++}addDisconnectPingFrame(e,n){this.myDisconnFrame=document.createElement("iframe");const r={};r[sk]="t",r[db]=e,r[fb]=n,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const n=Yt(e).length;this.bytesReceived+=n,this.stats_.incrementCounter("bytes_received",n)}}class zg{constructor(e,n,r,s){this.onDisconnect=r,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=Q1(),window[qw+this.uniqueCallbackIdentifier]=e,window[Zw+this.uniqueCallbackIdentifier]=n,this.myIFrame=zg.createIFrame_();let i="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(i='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(l){qt("frame writing exception"),l.stack&&qt(l.stack),qt(l)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||qt("No IE domain setting required")}catch{const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,n){for(this.myID=e,this.myPW=n,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[db]=this.myID,e[fb]=this.myPW,e[hb]=this.currentSerial;let n=this.urlFn(e),r="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+gb+r.length<=pb;){const o=this.pendingSegs.shift();r=r+"&"+tk+s+"="+o.seg+"&"+nk+s+"="+o.ts+"&"+rk+s+"="+o.d,s++}return n=n+r,this.addLongPollTag_(n,this.currentSerial),!0}else return!1}enqueueSegment(e,n,r){this.pendingSegs.push({seg:e,ts:n,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,n){this.outstandingRequests.add(n);const r=()=>{this.outstandingRequests.delete(n),this.newRequest_()},s=setTimeout(r,Math.floor(ok)),i=()=>{clearTimeout(s),r()};this.addTag(e,i)}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const s=r.readyState;(!s||s==="loaded"||s==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),n())},r.onerror=()=>{qt("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lk=16384,ck=45e3;let Mu=null;typeof MozWebSocket<"u"?Mu=MozWebSocket:typeof WebSocket<"u"&&(Mu=WebSocket);class fr{constructor(e,n,r,s,i,o,l){this.connId=e,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Pl(this.connId),this.stats_=Bg(n),this.connURL=fr.connectionURL_(n,o,l,s,r),this.nodeAdmin=n.nodeAdmin}static connectionURL_(e,n,r,s,i){const o={};return o[eb]=Ug,typeof location<"u"&&location.hostname&&sb.test(location.hostname)&&(o[nb]=rb),n&&(o[tb]=n),r&&(o[ib]=r),s&&(o[dp]=s),i&&(o[ob]=i),ub(e,ab,o)}open(e,n){this.onDisconnect=n,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,pi.set("previous_websocket_failure",!0);try{let r;aC(),this.mySock=new Mu(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){fr.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const n=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(n);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&Mu!==null&&!fr.forceDisallow_}static previouslyFailed(){return pi.isInMemoryStorage||pi.get("previous_websocket_failure")===!0}markConnectionHealthy(){pi.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const n=this.frames.join("");this.frames=null;const r=fl(n);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(de(this.frames===null,"We already have a frame buffer"),e.length<=6){const n=Number(e);if(!isNaN(n))return this.handleNewFrameCount_(n),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const n=e.data;if(this.bytesReceived+=n.length,this.stats_.incrementCounter("bytes_received",n.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(n);else{const r=this.extractFrameCount_(n);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();const n=Yt(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const r=q1(n,lk);r.length>1&&this.sendString_(String(r.length));for(let s=0;s<r.length;s++)this.sendString_(r[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(ck))}sendString_(e){try{this.mySock.send(e)}catch(n){this.log_("Exception thrown from WebSocket.send():",n.message||n.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}fr.responsesRequiredToBeHealthy=2;fr.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pl{static get ALL_TRANSPORTS(){return[co,fr]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const n=fr&&fr.isAvailable();let r=n&&!fr.previouslyFailed();if(e.webSocketOnly&&(n||Tn("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[fr];else{const s=this.transports_=[];for(const i of pl.ALL_TRANSPORTS)i&&i.isAvailable()&&s.push(i);pl.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}pl.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uk=6e4,dk=5e3,fk=10*1024,hk=100*1024,nh="t",rv="d",pk="s",sv="r",gk="e",iv="o",ov="a",av="n",lv="p",mk="h";class yk{constructor(e,n,r,s,i,o,l,c,u,d){this.id=e,this.repoInfo_=n,this.applicationId_=r,this.appCheckToken_=s,this.authToken_=i,this.onMessage_=o,this.onReady_=l,this.onDisconnect_=c,this.onKill_=u,this.lastSessionId=d,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Pl("c:"+this.id+":"),this.transportManager_=new pl(n),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(n,r)},Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=Ua(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>hk?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>fk?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return n=>{e===this.conn_?this.onConnectionLost_(n):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return n=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(n):e===this.secondaryConn_?this.onSecondaryMessageReceived_(n):this.log_("message on old connection"))}}sendRequest(e){const n={t:"d",d:e};this.sendData_(n)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(nh in e){const n=e[nh];n===ov?this.upgradeIfSecondaryHealthy_():n===sv?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):n===iv&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const n=_a("t",e),r=_a("d",e);if(n==="c")this.onSecondaryControl_(r);else if(n==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+n)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:lv,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:ov,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:av,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const n=_a("t",e),r=_a("d",e);n==="c"?this.onControl_(r):n==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const n=_a(nh,e);if(rv in e){const r=e[rv];if(n===mk){const s={...r};this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(n===av){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else n===pk?this.onConnectionShutdown_(r):n===sv?this.onReset_(r):n===gk?up("Server Error: "+r):n===iv?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):up("Unknown control packet command: "+n)}}onHandshake_(e){const n=e.ts,r=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,n),Ug!==r&&Tn("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),Ua(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(uk))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,n){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(n,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Ua(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(dk))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:lv,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(pi.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mb{put(e,n,r,s){}merge(e,n,r,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,n,r){}onDisconnectMerge(e,n,r){}onDisconnectCancel(e,n){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yb{constructor(e){this.allowedEvents_=e,this.listeners_={},de(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...n){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let s=0;s<r.length;s++)r[s].callback.apply(r[s].context,n)}}on(e,n,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:n,context:r});const s=this.getInitialEvent(e);s&&n.apply(r,s)}off(e,n,r){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let i=0;i<s.length;i++)if(s[i].callback===n&&(!r||r===s[i].context)){s.splice(i,1);return}}validateEventType_(e){de(this.allowedEvents_.find(n=>n===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nu extends yb{static getInstance(){return new Nu}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Mg()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return de(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cv=32,uv=768;class _t{constructor(e,n){if(n===void 0){this.pieces_=e.split("/");let r=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[r]=this.pieces_[s],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=n}toString(){let e="";for(let n=this.pieceNum_;n<this.pieces_.length;n++)this.pieces_[n]!==""&&(e+="/"+this.pieces_[n]);return e||"/"}}function ht(){return new _t("")}function st(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function Vs(t){return t.pieces_.length-t.pieceNum_}function It(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new _t(t.pieces_,e)}function Hg(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function vk(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)t.pieces_[n]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}function gl(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function vb(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new _t(e,0)}function Mt(t,e){const n=[];for(let r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);if(e instanceof _t)for(let r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);else{const r=e.split("/");for(let s=0;s<r.length;s++)r[s].length>0&&n.push(r[s])}return new _t(n,0)}function ot(t){return t.pieceNum_>=t.pieces_.length}function Sn(t,e){const n=st(t),r=st(e);if(n===null)return e;if(n===r)return Sn(It(t),It(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function _k(t,e){const n=gl(t,0),r=gl(e,0);for(let s=0;s<n.length&&s<r.length;s++){const i=Pi(n[s],r[s]);if(i!==0)return i}return n.length===r.length?0:n.length<r.length?-1:1}function Wg(t,e){if(Vs(t)!==Vs(e))return!1;for(let n=t.pieceNum_,r=e.pieceNum_;n<=t.pieces_.length;n++,r++)if(t.pieces_[n]!==e.pieces_[r])return!1;return!0}function Zn(t,e){let n=t.pieceNum_,r=e.pieceNum_;if(Vs(t)>Vs(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[r])return!1;++n,++r}return!0}class xk{constructor(e,n){this.errorPrefix_=n,this.parts_=gl(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=_d(this.parts_[r]);_b(this)}}function bk(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=_d(e),_b(t)}function Ek(t){const e=t.parts_.pop();t.byteLength_-=_d(e),t.parts_.length>0&&(t.byteLength_-=1)}function _b(t){if(t.byteLength_>uv)throw new Error(t.errorPrefix_+"has a key path longer than "+uv+" bytes ("+t.byteLength_+").");if(t.parts_.length>cv)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+cv+") or object contains a cycle "+ci(t))}function ci(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gg extends yb{static getInstance(){return new Gg}constructor(){super(["visible"]);let e,n;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(n="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(n="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(n="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(n="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,n&&document.addEventListener(n,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}getInitialEvent(e){return de(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xa=1e3,Sk=60*5*1e3,dv=30*1e3,Ik=1.3,Tk=3e4,Ck="server_kill",fv=3;class Qr extends mb{constructor(e,n,r,s,i,o,l,c){if(super(),this.repoInfo_=e,this.applicationId_=n,this.onDataUpdate_=r,this.onConnectStatus_=s,this.onServerInfoUpdate_=i,this.authTokenProvider_=o,this.appCheckTokenProvider_=l,this.authOverride_=c,this.id=Qr.nextPersistentConnectionId_++,this.log_=Pl("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=xa,this.maxReconnectDelay_=Sk,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Gg.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&Nu.getInstance().on("online",this.onOnline_,this)}sendRequest(e,n,r){const s=++this.requestNumber_,i={r:s,a:e,b:n};this.log_(Yt(i)),de(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),r&&(this.requestCBHash_[s]=r)}get(e){this.initConnection_();const n=new ur,s={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const l=o.d;o.s==="ok"?n.resolve(l):n.reject(l)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),n.promise}listen(e,n,r,s){this.initConnection_();const i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),de(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),de(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");const l={onComplete:s,hashFn:n,query:e,tag:r};this.listens.get(o).set(i,l),this.connected_&&this.sendListen_(l)}sendGet_(e){const n=this.outstandingGets_[e];this.sendRequest("g",n.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(r)})}sendListen_(e){const n=e.query,r=n._path.toString(),s=n._queryIdentifier;this.log_("Listen on "+r+" for "+s);const i={p:r},o="q";e.tag&&(i.q=n._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest(o,i,l=>{const c=l.d,u=l.s;Qr.warnOnListenWarnings_(c,n),(this.listens.get(r)&&this.listens.get(r).get(s))===e&&(this.log_("listen response",l),u!=="ok"&&this.removeListen_(r,s),e.onComplete&&e.onComplete(u,c))})}static warnOnListenWarnings_(e,n){if(e&&typeof e=="object"&&_r(e,"w")){const r=Ei(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const s='".indexOn": "'+n._queryParams.getIndex().toString()+'"',i=n._path.toString();Tn(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${i} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||pC(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=dv)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,n=hC(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(n,r,s=>{const i=s.s,o=s.d||"error";this.authToken_===e&&(i==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(i,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const n=e.s,r=e.d||"error";n==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(n,r)})}unlisten(e,n){const r=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+s),de(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,s)&&this.connected_&&this.sendUnlisten_(r,s,e._queryObject,n)}sendUnlisten_(e,n,r,s){this.log_("Unlisten on "+e+" for "+n);const i={p:e},o="n";s&&(i.q=r,i.t=s),this.sendRequest(o,i)}onDisconnectPut(e,n,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,n,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:n,onComplete:r})}onDisconnectMerge(e,n,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,n,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:n,onComplete:r})}onDisconnectCancel(e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:n})}sendOnDisconnect_(e,n,r,s){const i={p:n,d:r};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,o=>{s&&setTimeout(()=>{s(o.s,o.d)},Math.floor(0))})}put(e,n,r,s){this.putInternal("p",e,n,r,s)}merge(e,n,r,s){this.putInternal("m",e,n,r,s)}putInternal(e,n,r,s,i){this.initConnection_();const o={p:n,d:r};i!==void 0&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:s}),this.outstandingPutCount_++;const l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+n)}sendPut_(e){const n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,s=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,i=>{this.log_(n+" response",i),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(i.s,i.d)})}reportStats(e){if(this.connected_){const n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,r=>{if(r.s!=="ok"){const i=r.d;this.log_("reportStats","Error sending stats: "+i)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Yt(e));const n=e.r,r=this.requestCBHash_[n];r&&(delete this.requestCBHash_[n],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,n){this.log_("handleServerMessage",e,n),e==="d"?this.onDataUpdate_(n.p,n.d,!1,n.t):e==="m"?this.onDataUpdate_(n.p,n.d,!0,n.t):e==="c"?this.onListenRevoked_(n.p,n.q):e==="ac"?this.onAuthRevoked_(n.s,n.d):e==="apc"?this.onAppCheckRevoked_(n.s,n.d):e==="sd"?this.onSecurityDebugPacket_(n):up("Unrecognized action received from server: "+Yt(e)+`
Are you using the latest client?`)}onReady_(e,n){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=n,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){de(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=xa,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=xa,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>Tk&&(this.reconnectDelay_=xa),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let n=Math.max(0,this.reconnectDelay_-e);n=Math.random()*n,this.log_("Trying to reconnect in "+n+"ms"),this.scheduleConnect_(n),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Ik)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+Qr.nextConnectionId_++,i=this.lastSessionId;let o=!1,l=null;const c=function(){l?l.close():(o=!0,r())},u=function(h){de(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(h)};this.realtime_={close:c,sendRequest:u};const d=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[h,f]=await Promise.all([this.authTokenProvider_.getToken(d),this.appCheckTokenProvider_.getToken(d)]);o?qt("getToken() completed but was canceled"):(qt("getToken() completed. Creating connection."),this.authToken_=h&&h.accessToken,this.appCheckToken_=f&&f.token,l=new yk(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,r,_=>{Tn(_+" ("+this.repoInfo_.toString()+")"),this.interrupt(Ck)},i))}catch(h){this.log_("Failed to get token: "+h),o||(this.repoInfo_.nodeAdmin&&Tn(h),c())}}}interrupt(e){qt("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){qt("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Ou(this.interruptReasons_)&&(this.reconnectDelay_=xa,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const n=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:n})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const n=this.outstandingPuts_[e];n&&"h"in n.request&&n.queued&&(n.onComplete&&n.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,n){let r;n?r=n.map(i=>Fg(i)).join("$"):r="default";const s=this.removeListen_(e,r);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(e,n){const r=new _t(e).toString();let s;if(this.listens.has(r)){const i=this.listens.get(r);s=i.get(n),i.delete(n),i.size===0&&this.listens.delete(r)}else s=void 0;return s}onAuthRevoked_(e,n){qt("Auth token revoked: "+e+"/"+n),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=fv&&(this.reconnectDelay_=dv,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,n){qt("App check token revoked: "+e+"/"+n),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=fv&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const n of e.values())this.sendListen_(n);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let n="js";e["sdk."+n+"."+K1.replace(/\./g,"-")]=1,Mg()?e["framework.cordova"]=1:U1()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Nu.getInstance().currentlyOnline();return Ou(this.interruptReasons_)&&e}}Qr.nextPersistentConnectionId_=0;Qr.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class at{constructor(e,n){this.name=e,this.node=n}static Wrap(e,n){return new at(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bd{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,n){const r=new at(Do,e),s=new at(Do,n);return this.compare(r,s)!==0}minPost(){return at.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Cc;class xb extends bd{static get __EMPTY_NODE(){return Cc}static set __EMPTY_NODE(e){Cc=e}compare(e,n){return Pi(e.name,n.name)}isDefinedOn(e){throw Ho("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,n){return!1}minPost(){return at.MIN}maxPost(){return new at(Ti,Cc)}makePost(e,n){return de(typeof e=="string","KeyIndex indexValue must always be a string."),new at(e,Cc)}toString(){return".key"}}const _o=new xb;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wc{constructor(e,n,r,s,i=null){this.isReverse_=s,this.resultGenerator_=i,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=n?r(e.key,n):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),n;if(this.resultGenerator_?n=this.resultGenerator_(e.key,e.value):n={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return n}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Jt{constructor(e,n,r,s,i){this.key=e,this.value=n,this.color=r??Jt.RED,this.left=s??Dn.EMPTY_NODE,this.right=i??Dn.EMPTY_NODE}copy(e,n,r,s,i){return new Jt(e??this.key,n??this.value,r??this.color,s??this.left,i??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let s=this;const i=r(e,s.key);return i<0?s=s.copy(null,null,null,s.left.insert(e,n,r),null):i===0?s=s.copy(null,n,null,null,null):s=s.copy(null,null,null,null,s.right.insert(e,n,r)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return Dn.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,n){let r,s;if(r=this,n(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,n),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),n(e,r.key)===0){if(r.right.isEmpty())return Dn.EMPTY_NODE;s=r.right.min_(),r=r.copy(s.key,s.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,n))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Jt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Jt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Jt.RED=!0;Jt.BLACK=!1;class wk{copy(e,n,r,s,i){return this}insert(e,n,r){return new Jt(e,n,null)}remove(e,n){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class Dn{constructor(e,n=Dn.EMPTY_NODE){this.comparator_=e,this.root_=n}insert(e,n){return new Dn(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,Jt.BLACK,null,null))}remove(e){return new Dn(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Jt.BLACK,null,null))}get(e){let n,r=this.root_;for(;!r.isEmpty();){if(n=this.comparator_(e,r.key),n===0)return r.value;n<0?r=r.left:n>0&&(r=r.right)}return null}getPredecessorKey(e){let n,r=this.root_,s=null;for(;!r.isEmpty();)if(n=this.comparator_(e,r.key),n===0){if(r.left.isEmpty())return s?s.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else n<0?r=r.left:n>0&&(s=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new wc(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,n){return new wc(this.root_,e,this.comparator_,!1,n)}getReverseIteratorFrom(e,n){return new wc(this.root_,e,this.comparator_,!0,n)}getReverseIterator(e){return new wc(this.root_,null,this.comparator_,!0,e)}}Dn.EMPTY_NODE=new wk;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kk(t,e){return Pi(t.name,e.name)}function Vg(t,e){return Pi(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fp;function Ak(t){fp=t}const bb=function(t){return typeof t=="number"?"number:"+Z1(t):"string:"+t},Eb=function(t){if(t.isLeafNode()){const e=t.val();de(typeof e=="string"||typeof e=="number"||typeof e=="object"&&_r(e,".sv"),"Priority must be a string or number.")}else de(t===fp||t.isEmpty(),"priority of unexpected type.");de(t===fp||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let hv;class Xt{static set __childrenNodeConstructor(e){hv=e}static get __childrenNodeConstructor(){return hv}constructor(e,n=Xt.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=n,this.lazyHash_=null,de(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),Eb(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Xt(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:Xt.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return ot(e)?this:st(e)===".priority"?this.priorityNode_:Xt.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,n){return null}updateImmediateChild(e,n){return e===".priority"?this.updatePriority(n):n.isEmpty()&&e!==".priority"?this:Xt.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)}updateChild(e,n){const r=st(e);return r===null?n:n.isEmpty()&&r!==".priority"?this:(de(r!==".priority"||Vs(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,Xt.__childrenNodeConstructor.EMPTY_NODE.updateChild(It(e),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,n){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+bb(this.priorityNode_.val())+":");const n=typeof this.value_;e+=n+":",n==="number"?e+=Z1(this.value_):e+=this.value_,this.lazyHash_=J1(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Xt.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Xt.__childrenNodeConstructor?-1:(de(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const n=typeof e.value_,r=typeof this.value_,s=Xt.VALUE_TYPE_ORDER.indexOf(n),i=Xt.VALUE_TYPE_ORDER.indexOf(r);return de(s>=0,"Unknown leaf type: "+n),de(i>=0,"Unknown leaf type: "+r),s===i?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const n=e;return this.value_===n.value_&&this.priorityNode_.equals(n.priorityNode_)}else return!1}}Xt.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Sb,Ib;function Rk(t){Sb=t}function Pk(t){Ib=t}class Ok extends bd{compare(e,n){const r=e.node.getPriority(),s=n.node.getPriority(),i=r.compareTo(s);return i===0?Pi(e.name,n.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,n){return!e.getPriority().equals(n.getPriority())}minPost(){return at.MIN}maxPost(){return new at(Ti,new Xt("[PRIORITY-POST]",Ib))}makePost(e,n){const r=Sb(e);return new at(n,new Xt("[PRIORITY-POST]",r))}toString(){return".priority"}}const Ot=new Ok;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lk=Math.log(2);class Dk{constructor(e){const n=i=>parseInt(Math.log(i)/Lk,10),r=i=>parseInt(Array(i+1).join("1"),2);this.count=n(e+1),this.current_=this.count-1;const s=r(this.count);this.bits_=e+1&s}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const ju=function(t,e,n,r){t.sort(e);const s=function(c,u){const d=u-c;let h,f;if(d===0)return null;if(d===1)return h=t[c],f=n?n(h):h,new Jt(f,h.node,Jt.BLACK,null,null);{const _=parseInt(d/2,10)+c,R=s(c,_),k=s(_+1,u);return h=t[_],f=n?n(h):h,new Jt(f,h.node,Jt.BLACK,R,k)}},i=function(c){let u=null,d=null,h=t.length;const f=function(R,k){const B=h-R,x=h;h-=R;const E=s(B+1,x),T=t[B],p=n?n(T):T;_(new Jt(p,T.node,k,null,E))},_=function(R){u?(u.left=R,u=R):(d=R,u=R)};for(let R=0;R<c.count;++R){const k=c.nextBitIsOne(),B=Math.pow(2,c.count-(R+1));k?f(B,Jt.BLACK):(f(B,Jt.BLACK),f(B,Jt.RED))}return d},o=new Dk(t.length),l=i(o);return new Dn(r||e,l)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rh;const Ki={};class Wr{static get Default(){return de(Ki&&Ot,"ChildrenNode.ts has not been loaded"),rh=rh||new Wr({".priority":Ki},{".priority":Ot}),rh}constructor(e,n){this.indexes_=e,this.indexSet_=n}get(e){const n=Ei(this.indexes_,e);if(!n)throw new Error("No index defined for "+e);return n instanceof Dn?n:null}hasIndex(e){return _r(this.indexSet_,e.toString())}addIndex(e,n){de(e!==_o,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let s=!1;const i=n.getIterator(at.Wrap);let o=i.getNext();for(;o;)s=s||e.isDefinedOn(o.node),r.push(o),o=i.getNext();let l;s?l=ju(r,e.getCompare()):l=Ki;const c=e.toString(),u={...this.indexSet_};u[c]=e;const d={...this.indexes_};return d[c]=l,new Wr(d,u)}addToIndexes(e,n){const r=Lu(this.indexes_,(s,i)=>{const o=Ei(this.indexSet_,i);if(de(o,"Missing index implementation for "+i),s===Ki)if(o.isDefinedOn(e.node)){const l=[],c=n.getIterator(at.Wrap);let u=c.getNext();for(;u;)u.name!==e.name&&l.push(u),u=c.getNext();return l.push(e),ju(l,o.getCompare())}else return Ki;else{const l=n.get(e.name);let c=s;return l&&(c=c.remove(new at(e.name,l))),c.insert(e,e.node)}});return new Wr(r,this.indexSet_)}removeFromIndexes(e,n){const r=Lu(this.indexes_,s=>{if(s===Ki)return s;{const i=n.get(e.name);return i?s.remove(new at(e.name,i)):s}});return new Wr(r,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ba;class ze{static get EMPTY_NODE(){return ba||(ba=new ze(new Dn(Vg),null,Wr.Default))}constructor(e,n,r){this.children_=e,this.priorityNode_=n,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&Eb(this.priorityNode_),this.children_.isEmpty()&&de(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||ba}updatePriority(e){return this.children_.isEmpty()?this:new ze(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const n=this.children_.get(e);return n===null?ba:n}}getChild(e){const n=st(e);return n===null?this:this.getImmediateChild(n).getChild(It(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,n){if(de(n,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(n);{const r=new at(e,n);let s,i;n.isEmpty()?(s=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(r,this.children_)):(s=this.children_.insert(e,n),i=this.indexMap_.addToIndexes(r,this.children_));const o=s.isEmpty()?ba:this.priorityNode_;return new ze(s,o,i)}}updateChild(e,n){const r=st(e);if(r===null)return n;{de(st(e)!==".priority"||Vs(e)===1,".priority must be the last token in a path");const s=this.getImmediateChild(r).updateChild(It(e),n);return this.updateImmediateChild(r,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const n={};let r=0,s=0,i=!0;if(this.forEachChild(Ot,(o,l)=>{n[o]=l.val(e),r++,i&&ze.INTEGER_REGEXP_.test(o)?s=Math.max(s,Number(o)):i=!1}),!e&&i&&s<2*r){const o=[];for(const l in n)o[l]=n[l];return o}else return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+bb(this.getPriority().val())+":"),this.forEachChild(Ot,(n,r)=>{const s=r.hash();s!==""&&(e+=":"+n+":"+s)}),this.lazyHash_=e===""?"":J1(e)}return this.lazyHash_}getPredecessorChildName(e,n,r){const s=this.resolveIndex_(r);if(s){const i=s.getPredecessorKey(new at(e,n));return i?i.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const n=this.resolveIndex_(e);if(n){const r=n.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){const n=this.getFirstChildName(e);return n?new at(n,this.children_.get(n)):null}getLastChildName(e){const n=this.resolveIndex_(e);if(n){const r=n.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){const n=this.getLastChildName(e);return n?new at(n,this.children_.get(n)):null}forEachChild(e,n){const r=this.resolveIndex_(e);return r?r.inorderTraversal(s=>n(s.name,s.node)):this.children_.inorderTraversal(n)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,n){const r=this.resolveIndex_(n);if(r)return r.getIteratorFrom(e,s=>s);{const s=this.children_.getIteratorFrom(e.name,at.Wrap);let i=s.peek();for(;i!=null&&n.compare(i,e)<0;)s.getNext(),i=s.peek();return s}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,n){const r=this.resolveIndex_(n);if(r)return r.getReverseIteratorFrom(e,s=>s);{const s=this.children_.getReverseIteratorFrom(e.name,at.Wrap);let i=s.peek();for(;i!=null&&n.compare(i,e)>0;)s.getNext(),i=s.peek();return s}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Ol?-1:0}withIndex(e){if(e===_o||this.indexMap_.hasIndex(e))return this;{const n=this.indexMap_.addIndex(e,this.children_);return new ze(this.children_,this.priorityNode_,n)}}isIndexed(e){return e===_o||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority()))if(this.children_.count()===n.children_.count()){const r=this.getIterator(Ot),s=n.getIterator(Ot);let i=r.getNext(),o=s.getNext();for(;i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=r.getNext(),o=s.getNext()}return i===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===_o?null:this.indexMap_.get(e.toString())}}ze.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class Mk extends ze{constructor(){super(new Dn(Vg),ze.EMPTY_NODE,Wr.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return ze.EMPTY_NODE}isEmpty(){return!1}}const Ol=new Mk;Object.defineProperties(at,{MIN:{value:new at(Do,ze.EMPTY_NODE)},MAX:{value:new at(Ti,Ol)}});xb.__EMPTY_NODE=ze.EMPTY_NODE;Xt.__childrenNodeConstructor=ze;Ak(Ol);Pk(Ol);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nk=!0;function Dt(t,e=null){if(t===null)return ze.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),de(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){const n=t;return new Xt(n,Dt(e))}if(!(t instanceof Array)&&Nk){const n=[];let r=!1;if(en(t,(o,l)=>{if(o.substring(0,1)!=="."){const c=Dt(l);c.isEmpty()||(r=r||!c.getPriority().isEmpty(),n.push(new at(o,c)))}}),n.length===0)return ze.EMPTY_NODE;const i=ju(n,kk,o=>o.name,Vg);if(r){const o=ju(n,Ot.getCompare());return new ze(i,Dt(e),new Wr({".priority":o},{".priority":Ot}))}else return new ze(i,Dt(e),Wr.Default)}else{let n=ze.EMPTY_NODE;return en(t,(r,s)=>{if(_r(t,r)&&r.substring(0,1)!=="."){const i=Dt(s);(i.isLeafNode()||!i.isEmpty())&&(n=n.updateImmediateChild(r,i))}}),n.updatePriority(Dt(e))}}Rk(Dt);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jk extends bd{constructor(e){super(),this.indexPath_=e,de(!ot(e)&&st(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,n){const r=this.extractChild(e.node),s=this.extractChild(n.node),i=r.compareTo(s);return i===0?Pi(e.name,n.name):i}makePost(e,n){const r=Dt(e),s=ze.EMPTY_NODE.updateChild(this.indexPath_,r);return new at(n,s)}maxPost(){const e=ze.EMPTY_NODE.updateChild(this.indexPath_,Ol);return new at(Ti,e)}toString(){return gl(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $k extends bd{compare(e,n){const r=e.node.compareTo(n.node);return r===0?Pi(e.name,n.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,n){return!e.equals(n)}minPost(){return at.MIN}maxPost(){return at.MAX}makePost(e,n){const r=Dt(e);return new at(n,r)}toString(){return".value"}}const Fk=new $k;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tb(t){return{type:"value",snapshotNode:t}}function Mo(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function ml(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function yl(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}function Uk(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yg{constructor(e){this.index_=e}updateChild(e,n,r,s,i,o){de(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const l=e.getImmediateChild(n);return l.getChild(s).equals(r.getChild(s))&&l.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(n)?o.trackChildChange(ml(n,l)):de(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):l.isEmpty()?o.trackChildChange(Mo(n,r)):o.trackChildChange(yl(n,r,l))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(n,r).withIndex(this.index_)}updateFullNode(e,n,r){return r!=null&&(e.isLeafNode()||e.forEachChild(Ot,(s,i)=>{n.hasChild(s)||r.trackChildChange(ml(s,i))}),n.isLeafNode()||n.forEachChild(Ot,(s,i)=>{if(e.hasChild(s)){const o=e.getImmediateChild(s);o.equals(i)||r.trackChildChange(yl(s,i,o))}else r.trackChildChange(Mo(s,i))})),n.withIndex(this.index_)}updatePriority(e,n){return e.isEmpty()?ze.EMPTY_NODE:e.updatePriority(n)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vl{constructor(e){this.indexedFilter_=new Yg(e.getIndex()),this.index_=e.getIndex(),this.startPost_=vl.getStartPost_(e),this.endPost_=vl.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const n=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return n&&r}updateChild(e,n,r,s,i,o){return this.matches(new at(n,r))||(r=ze.EMPTY_NODE),this.indexedFilter_.updateChild(e,n,r,s,i,o)}updateFullNode(e,n,r){n.isLeafNode()&&(n=ze.EMPTY_NODE);let s=n.withIndex(this.index_);s=s.updatePriority(ze.EMPTY_NODE);const i=this;return n.forEachChild(Ot,(o,l)=>{i.matches(new at(o,l))||(s=s.updateImmediateChild(o,ze.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,r)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const n=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),n)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const n=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),n)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bk{constructor(e){this.withinDirectionalStart=n=>this.reverse_?this.withinEndPost(n):this.withinStartPost(n),this.withinDirectionalEnd=n=>this.reverse_?this.withinStartPost(n):this.withinEndPost(n),this.withinStartPost=n=>{const r=this.index_.compare(this.rangedFilter_.getStartPost(),n);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=n=>{const r=this.index_.compare(n,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new vl(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,n,r,s,i,o){return this.rangedFilter_.matches(new at(n,r))||(r=ze.EMPTY_NODE),e.getImmediateChild(n).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,n,r,s,i,o):this.fullLimitUpdateChild_(e,n,r,i,o)}updateFullNode(e,n,r){let s;if(n.isLeafNode()||n.isEmpty())s=ze.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<n.numChildren()&&n.isIndexed(this.index_)){s=ze.EMPTY_NODE.withIndex(this.index_);let i;this.reverse_?i=n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):i=n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;i.hasNext()&&o<this.limit_;){const l=i.getNext();if(this.withinDirectionalStart(l))if(this.withinDirectionalEnd(l))s=s.updateImmediateChild(l.name,l.node),o++;else break;else continue}}else{s=n.withIndex(this.index_),s=s.updatePriority(ze.EMPTY_NODE);let i;this.reverse_?i=s.getReverseIterator(this.index_):i=s.getIterator(this.index_);let o=0;for(;i.hasNext();){const l=i.getNext();o<this.limit_&&this.withinDirectionalStart(l)&&this.withinDirectionalEnd(l)?o++:s=s.updateImmediateChild(l.name,ze.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,r)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,n,r,s,i){let o;if(this.reverse_){const h=this.index_.getCompare();o=(f,_)=>h(_,f)}else o=this.index_.getCompare();const l=e;de(l.numChildren()===this.limit_,"");const c=new at(n,r),u=this.reverse_?l.getFirstChild(this.index_):l.getLastChild(this.index_),d=this.rangedFilter_.matches(c);if(l.hasChild(n)){const h=l.getImmediateChild(n);let f=s.getChildAfterChild(this.index_,u,this.reverse_);for(;f!=null&&(f.name===n||l.hasChild(f.name));)f=s.getChildAfterChild(this.index_,f,this.reverse_);const _=f==null?1:o(f,c);if(d&&!r.isEmpty()&&_>=0)return i!=null&&i.trackChildChange(yl(n,r,h)),l.updateImmediateChild(n,r);{i!=null&&i.trackChildChange(ml(n,h));const k=l.updateImmediateChild(n,ze.EMPTY_NODE);return f!=null&&this.rangedFilter_.matches(f)?(i!=null&&i.trackChildChange(Mo(f.name,f.node)),k.updateImmediateChild(f.name,f.node)):k}}else return r.isEmpty()?e:d&&o(u,c)>=0?(i!=null&&(i.trackChildChange(ml(u.name,u.node)),i.trackChildChange(Mo(n,r))),l.updateImmediateChild(n,r).updateImmediateChild(u.name,ze.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kg{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Ot}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return de(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return de(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Do}hasEnd(){return this.endSet_}getIndexEndValue(){return de(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return de(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Ti}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return de(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Ot}copy(){const e=new Kg;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function zk(t){return t.loadsAllData()?new Yg(t.getIndex()):t.hasLimit()?new Bk(t):new vl(t)}function pv(t){const e={};if(t.isDefault())return e;let n;if(t.index_===Ot?n="$priority":t.index_===Fk?n="$value":t.index_===_o?n="$key":(de(t.index_ instanceof jk,"Unrecognized index type!"),n=t.index_.toString()),e.orderBy=Yt(n),t.startSet_){const r=t.startAfterSet_?"startAfter":"startAt";e[r]=Yt(t.indexStartValue_),t.startNameSet_&&(e[r]+=","+Yt(t.indexStartName_))}if(t.endSet_){const r=t.endBeforeSet_?"endBefore":"endAt";e[r]=Yt(t.indexEndValue_),t.endNameSet_&&(e[r]+=","+Yt(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function gv(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;n===""&&(t.isViewFromLeft()?n="l":n="r"),e.vf=n}return t.index_!==Ot&&(e.i=t.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $u extends mb{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,n){return n!==void 0?"tag$"+n:(de(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,n,r,s){super(),this.repoInfo_=e,this.onDataUpdate_=n,this.authTokenProvider_=r,this.appCheckTokenProvider_=s,this.log_=Pl("p:rest:"),this.listens_={}}listen(e,n,r,s){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const o=$u.getListenId_(e,r),l={};this.listens_[o]=l;const c=pv(e._queryParams);this.restRequest_(i+".json",c,(u,d)=>{let h=d;if(u===404&&(h=null,u=null),u===null&&this.onDataUpdate_(i,h,!1,r),Ei(this.listens_,o)===l){let f;u?u===401?f="permission_denied":f="rest_error:"+u:f="ok",s(f,null)}})}unlisten(e,n){const r=$u.getListenId_(e,n);delete this.listens_[r]}get(e){const n=pv(e._queryParams),r=e._path.toString(),s=new ur;return this.restRequest_(r+".json",n,(i,o)=>{let l=o;i===404&&(l=null,i=null),i===null?(this.onDataUpdate_(r,l,!1,null),s.resolve(l)):s.reject(new Error(l))}),s.promise}refreshAuthToken(e){}restRequest_(e,n={},r){return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,i])=>{s&&s.accessToken&&(n.auth=s.accessToken),i&&i.token&&(n.ac=i.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Go(n);this.log_("Sending REST request for "+o);const l=new XMLHttpRequest;l.onreadystatechange=()=>{if(r&&l.readyState===4){this.log_("REST Response for "+o+" received. status:",l.status,"response:",l.responseText);let c=null;if(l.status>=200&&l.status<300){try{c=fl(l.responseText)}catch{Tn("Failed to parse JSON response for "+o+": "+l.responseText)}r(null,c)}else l.status!==401&&l.status!==404&&Tn("Got unsuccessful REST response for "+o+" Status: "+l.status),r(l.status);r=null}},l.open("GET",o,!0),l.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hk{constructor(){this.rootNode_=ze.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,n){this.rootNode_=this.rootNode_.updateChild(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fu(){return{value:null,children:new Map}}function Ko(t,e,n){if(ot(e))t.value=n,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,n);else{const r=st(e);t.children.has(r)||t.children.set(r,Fu());const s=t.children.get(r);e=It(e),Ko(s,e,n)}}function hp(t,e){if(ot(e))return t.value=null,t.children.clear(),!0;if(t.value!==null){if(t.value.isLeafNode())return!1;{const n=t.value;return t.value=null,n.forEachChild(Ot,(r,s)=>{Ko(t,new _t(r),s)}),hp(t,e)}}else if(t.children.size>0){const n=st(e);return e=It(e),t.children.has(n)&&hp(t.children.get(n),e)&&t.children.delete(n),t.children.size===0}else return!0}function pp(t,e,n){t.value!==null?n(e,t.value):Wk(t,(r,s)=>{const i=new _t(e.toString()+"/"+r);pp(s,i,n)})}function Wk(t,e){t.children.forEach((n,r)=>{e(r,n)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gk{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),n={...e};return this.last_&&en(this.last_,(r,s)=>{n[r]=n[r]-s}),this.last_=e,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mv=10*1e3,Vk=30*1e3,Yk=5*60*1e3;class Kk{constructor(e,n){this.server_=n,this.statsToReport_={},this.statsListener_=new Gk(e);const r=mv+(Vk-mv)*Math.random();Ua(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),n={};let r=!1;en(e,(s,i)=>{i>0&&_r(this.statsToReport_,s)&&(n[s]=i,r=!0)}),r&&this.server_.reportStats(n),Ua(this.reportStats_.bind(this),Math.floor(Math.random()*2*Yk))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var hr;(function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(hr||(hr={}));function Xg(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Qg(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Jg(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uu{constructor(e,n,r){this.path=e,this.affectedTree=n,this.revert=r,this.type=hr.ACK_USER_WRITE,this.source=Xg()}operationForChild(e){if(ot(this.path)){if(this.affectedTree.value!=null)return de(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const n=this.affectedTree.subtree(new _t(e));return new Uu(ht(),n,this.revert)}}else return de(st(this.path)===e,"operationForChild called for unrelated child."),new Uu(It(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _l{constructor(e,n){this.source=e,this.path=n,this.type=hr.LISTEN_COMPLETE}operationForChild(e){return ot(this.path)?new _l(this.source,ht()):new _l(this.source,It(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ci{constructor(e,n,r){this.source=e,this.path=n,this.snap=r,this.type=hr.OVERWRITE}operationForChild(e){return ot(this.path)?new Ci(this.source,ht(),this.snap.getImmediateChild(e)):new Ci(this.source,It(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class No{constructor(e,n,r){this.source=e,this.path=n,this.children=r,this.type=hr.MERGE}operationForChild(e){if(ot(this.path)){const n=this.children.subtree(new _t(e));return n.isEmpty()?null:n.value?new Ci(this.source,ht(),n.value):new No(this.source,ht(),n)}else return de(st(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new No(this.source,It(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ys{constructor(e,n,r){this.node_=e,this.fullyInitialized_=n,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(ot(e))return this.isFullyInitialized()&&!this.filtered_;const n=st(e);return this.isCompleteForChild(n)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xk{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Qk(t,e,n,r){const s=[],i=[];return e.forEach(o=>{o.type==="child_changed"&&t.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&i.push(Uk(o.childName,o.snapshotNode))}),Ea(t,s,"child_removed",e,r,n),Ea(t,s,"child_added",e,r,n),Ea(t,s,"child_moved",i,r,n),Ea(t,s,"child_changed",e,r,n),Ea(t,s,"value",e,r,n),s}function Ea(t,e,n,r,s,i){const o=r.filter(l=>l.type===n);o.sort((l,c)=>qk(t,l,c)),o.forEach(l=>{const c=Jk(t,l,i);s.forEach(u=>{u.respondsTo(l.type)&&e.push(u.createEvent(c,t.query_))})})}function Jk(t,e,n){return e.type==="value"||e.type==="child_removed"||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function qk(t,e,n){if(e.childName==null||n.childName==null)throw Ho("Should only compare child_ events.");const r=new at(e.childName,e.snapshotNode),s=new at(n.childName,n.snapshotNode);return t.index_.compare(r,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ed(t,e){return{eventCache:t,serverCache:e}}function Ba(t,e,n,r){return Ed(new Ys(e,n,r),t.serverCache)}function Cb(t,e,n,r){return Ed(t.eventCache,new Ys(e,n,r))}function Bu(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function wi(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sh;const Zk=()=>(sh||(sh=new Dn(jw)),sh);class Ct{static fromObject(e){let n=new Ct(null);return en(e,(r,s)=>{n=n.set(new _t(r),s)}),n}constructor(e,n=Zk()){this.value=e,this.children=n}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,n){if(this.value!=null&&n(this.value))return{path:ht(),value:this.value};if(ot(e))return null;{const r=st(e),s=this.children.get(r);if(s!==null){const i=s.findRootMostMatchingPathAndValue(It(e),n);return i!=null?{path:Mt(new _t(r),i.path),value:i.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(ot(e))return this;{const n=st(e),r=this.children.get(n);return r!==null?r.subtree(It(e)):new Ct(null)}}set(e,n){if(ot(e))return new Ct(n,this.children);{const r=st(e),i=(this.children.get(r)||new Ct(null)).set(It(e),n),o=this.children.insert(r,i);return new Ct(this.value,o)}}remove(e){if(ot(e))return this.children.isEmpty()?new Ct(null):new Ct(null,this.children);{const n=st(e),r=this.children.get(n);if(r){const s=r.remove(It(e));let i;return s.isEmpty()?i=this.children.remove(n):i=this.children.insert(n,s),this.value===null&&i.isEmpty()?new Ct(null):new Ct(this.value,i)}else return this}}get(e){if(ot(e))return this.value;{const n=st(e),r=this.children.get(n);return r?r.get(It(e)):null}}setTree(e,n){if(ot(e))return n;{const r=st(e),i=(this.children.get(r)||new Ct(null)).setTree(It(e),n);let o;return i.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,i),new Ct(this.value,o)}}fold(e){return this.fold_(ht(),e)}fold_(e,n){const r={};return this.children.inorderTraversal((s,i)=>{r[s]=i.fold_(Mt(e,s),n)}),n(e,this.value,r)}findOnPath(e,n){return this.findOnPath_(e,ht(),n)}findOnPath_(e,n,r){const s=this.value?r(n,this.value):!1;if(s)return s;if(ot(e))return null;{const i=st(e),o=this.children.get(i);return o?o.findOnPath_(It(e),Mt(n,i),r):null}}foreachOnPath(e,n){return this.foreachOnPath_(e,ht(),n)}foreachOnPath_(e,n,r){if(ot(e))return this;{this.value&&r(n,this.value);const s=st(e),i=this.children.get(s);return i?i.foreachOnPath_(It(e),Mt(n,s),r):new Ct(null)}}foreach(e){this.foreach_(ht(),e)}foreach_(e,n){this.children.inorderTraversal((r,s)=>{s.foreach_(Mt(e,r),n)}),this.value&&n(e,this.value)}foreachChild(e){this.children.inorderTraversal((n,r)=>{r.value&&e(n,r.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yr{constructor(e){this.writeTree_=e}static empty(){return new yr(new Ct(null))}}function za(t,e,n){if(ot(e))return new yr(new Ct(n));{const r=t.writeTree_.findRootMostValueAndPath(e);if(r!=null){const s=r.path;let i=r.value;const o=Sn(s,e);return i=i.updateChild(o,n),new yr(t.writeTree_.set(s,i))}else{const s=new Ct(n),i=t.writeTree_.setTree(e,s);return new yr(i)}}}function gp(t,e,n){let r=t;return en(n,(s,i)=>{r=za(r,Mt(e,s),i)}),r}function yv(t,e){if(ot(e))return yr.empty();{const n=t.writeTree_.setTree(e,new Ct(null));return new yr(n)}}function mp(t,e){return Oi(t,e)!=null}function Oi(t,e){const n=t.writeTree_.findRootMostValueAndPath(e);return n!=null?t.writeTree_.get(n.path).getChild(Sn(n.path,e)):null}function vv(t){const e=[],n=t.writeTree_.value;return n!=null?n.isLeafNode()||n.forEachChild(Ot,(r,s)=>{e.push(new at(r,s))}):t.writeTree_.children.inorderTraversal((r,s)=>{s.value!=null&&e.push(new at(r,s.value))}),e}function Us(t,e){if(ot(e))return t;{const n=Oi(t,e);return n!=null?new yr(new Ct(n)):new yr(t.writeTree_.subtree(e))}}function yp(t){return t.writeTree_.isEmpty()}function jo(t,e){return wb(ht(),t.writeTree_,e)}function wb(t,e,n){if(e.value!=null)return n.updateChild(t,e.value);{let r=null;return e.children.inorderTraversal((s,i)=>{s===".priority"?(de(i.value!==null,"Priority writes must always be leaf nodes"),r=i.value):n=wb(Mt(t,s),i,n)}),!n.getChild(t).isEmpty()&&r!==null&&(n=n.updateChild(Mt(t,".priority"),r)),n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sd(t,e){return Pb(e,t)}function e5(t,e,n,r,s){de(r>t.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),t.allWrites.push({path:e,snap:n,writeId:r,visible:s}),s&&(t.visibleWrites=za(t.visibleWrites,e,n)),t.lastWriteId=r}function t5(t,e,n,r){de(r>t.lastWriteId,"Stacking an older merge on top of newer ones"),t.allWrites.push({path:e,children:n,writeId:r,visible:!0}),t.visibleWrites=gp(t.visibleWrites,e,n),t.lastWriteId=r}function n5(t,e){for(let n=0;n<t.allWrites.length;n++){const r=t.allWrites[n];if(r.writeId===e)return r}return null}function r5(t,e){const n=t.allWrites.findIndex(l=>l.writeId===e);de(n>=0,"removeWrite called with nonexistent writeId.");const r=t.allWrites[n];t.allWrites.splice(n,1);let s=r.visible,i=!1,o=t.allWrites.length-1;for(;s&&o>=0;){const l=t.allWrites[o];l.visible&&(o>=n&&s5(l,r.path)?s=!1:Zn(r.path,l.path)&&(i=!0)),o--}if(s){if(i)return i5(t),!0;if(r.snap)t.visibleWrites=yv(t.visibleWrites,r.path);else{const l=r.children;en(l,c=>{t.visibleWrites=yv(t.visibleWrites,Mt(r.path,c))})}return!0}else return!1}function s5(t,e){if(t.snap)return Zn(t.path,e);for(const n in t.children)if(t.children.hasOwnProperty(n)&&Zn(Mt(t.path,n),e))return!0;return!1}function i5(t){t.visibleWrites=kb(t.allWrites,o5,ht()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function o5(t){return t.visible}function kb(t,e,n){let r=yr.empty();for(let s=0;s<t.length;++s){const i=t[s];if(e(i)){const o=i.path;let l;if(i.snap)Zn(n,o)?(l=Sn(n,o),r=za(r,l,i.snap)):Zn(o,n)&&(l=Sn(o,n),r=za(r,ht(),i.snap.getChild(l)));else if(i.children){if(Zn(n,o))l=Sn(n,o),r=gp(r,l,i.children);else if(Zn(o,n))if(l=Sn(o,n),ot(l))r=gp(r,ht(),i.children);else{const c=Ei(i.children,st(l));if(c){const u=c.getChild(It(l));r=za(r,ht(),u)}}}else throw Ho("WriteRecord should have .snap or .children")}}return r}function Ab(t,e,n,r,s){if(!r&&!s){const i=Oi(t.visibleWrites,e);if(i!=null)return i;{const o=Us(t.visibleWrites,e);if(yp(o))return n;if(n==null&&!mp(o,ht()))return null;{const l=n||ze.EMPTY_NODE;return jo(o,l)}}}else{const i=Us(t.visibleWrites,e);if(!s&&yp(i))return n;if(!s&&n==null&&!mp(i,ht()))return null;{const o=function(u){return(u.visible||s)&&(!r||!~r.indexOf(u.writeId))&&(Zn(u.path,e)||Zn(e,u.path))},l=kb(t.allWrites,o,e),c=n||ze.EMPTY_NODE;return jo(l,c)}}}function a5(t,e,n){let r=ze.EMPTY_NODE;const s=Oi(t.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(Ot,(i,o)=>{r=r.updateImmediateChild(i,o)}),r;if(n){const i=Us(t.visibleWrites,e);return n.forEachChild(Ot,(o,l)=>{const c=jo(Us(i,new _t(o)),l);r=r.updateImmediateChild(o,c)}),vv(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{const i=Us(t.visibleWrites,e);return vv(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function l5(t,e,n,r,s){de(r||s,"Either existingEventSnap or existingServerSnap must exist");const i=Mt(e,n);if(mp(t.visibleWrites,i))return null;{const o=Us(t.visibleWrites,i);return yp(o)?s.getChild(n):jo(o,s.getChild(n))}}function c5(t,e,n,r){const s=Mt(e,n),i=Oi(t.visibleWrites,s);if(i!=null)return i;if(r.isCompleteForChild(n)){const o=Us(t.visibleWrites,s);return jo(o,r.getNode().getImmediateChild(n))}else return null}function u5(t,e){return Oi(t.visibleWrites,e)}function d5(t,e,n,r,s,i,o){let l;const c=Us(t.visibleWrites,e),u=Oi(c,ht());if(u!=null)l=u;else if(n!=null)l=jo(c,n);else return[];if(l=l.withIndex(o),!l.isEmpty()&&!l.isLeafNode()){const d=[],h=o.getCompare(),f=i?l.getReverseIteratorFrom(r,o):l.getIteratorFrom(r,o);let _=f.getNext();for(;_&&d.length<s;)h(_,r)!==0&&d.push(_),_=f.getNext();return d}else return[]}function f5(){return{visibleWrites:yr.empty(),allWrites:[],lastWriteId:-1}}function zu(t,e,n,r){return Ab(t.writeTree,t.treePath,e,n,r)}function qg(t,e){return a5(t.writeTree,t.treePath,e)}function _v(t,e,n,r){return l5(t.writeTree,t.treePath,e,n,r)}function Hu(t,e){return u5(t.writeTree,Mt(t.treePath,e))}function h5(t,e,n,r,s,i){return d5(t.writeTree,t.treePath,e,n,r,s,i)}function Zg(t,e,n){return c5(t.writeTree,t.treePath,e,n)}function Rb(t,e){return Pb(Mt(t.treePath,e),t.writeTree)}function Pb(t,e){return{treePath:t,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p5{constructor(){this.changeMap=new Map}trackChildChange(e){const n=e.type,r=e.childName;de(n==="child_added"||n==="child_changed"||n==="child_removed","Only child changes supported for tracking"),de(r!==".priority","Only non-priority child changes can be tracked.");const s=this.changeMap.get(r);if(s){const i=s.type;if(n==="child_added"&&i==="child_removed")this.changeMap.set(r,yl(r,e.snapshotNode,s.snapshotNode));else if(n==="child_removed"&&i==="child_added")this.changeMap.delete(r);else if(n==="child_removed"&&i==="child_changed")this.changeMap.set(r,ml(r,s.oldSnap));else if(n==="child_changed"&&i==="child_added")this.changeMap.set(r,Mo(r,e.snapshotNode));else if(n==="child_changed"&&i==="child_changed")this.changeMap.set(r,yl(r,e.snapshotNode,s.oldSnap));else throw Ho("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g5{getCompleteChild(e){return null}getChildAfterChild(e,n,r){return null}}const Ob=new g5;class e0{constructor(e,n,r=null){this.writes_=e,this.viewCache_=n,this.optCompleteServerCache_=r}getCompleteChild(e){const n=this.viewCache_.eventCache;if(n.isCompleteForChild(e))return n.getNode().getImmediateChild(e);{const r=this.optCompleteServerCache_!=null?new Ys(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Zg(this.writes_,e,r)}}getChildAfterChild(e,n,r){const s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:wi(this.viewCache_),i=h5(this.writes_,s,n,1,r,e);return i.length===0?null:i[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m5(t){return{filter:t}}function y5(t,e){de(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),de(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function v5(t,e,n,r,s){const i=new p5;let o,l;if(n.type===hr.OVERWRITE){const u=n;u.source.fromUser?o=vp(t,e,u.path,u.snap,r,s,i):(de(u.source.fromServer,"Unknown source."),l=u.source.tagged||e.serverCache.isFiltered()&&!ot(u.path),o=Wu(t,e,u.path,u.snap,r,s,l,i))}else if(n.type===hr.MERGE){const u=n;u.source.fromUser?o=x5(t,e,u.path,u.children,r,s,i):(de(u.source.fromServer,"Unknown source."),l=u.source.tagged||e.serverCache.isFiltered(),o=_p(t,e,u.path,u.children,r,s,l,i))}else if(n.type===hr.ACK_USER_WRITE){const u=n;u.revert?o=S5(t,e,u.path,r,s,i):o=b5(t,e,u.path,u.affectedTree,r,s,i)}else if(n.type===hr.LISTEN_COMPLETE)o=E5(t,e,n.path,r,i);else throw Ho("Unknown operation type: "+n.type);const c=i.getChanges();return _5(e,o,c),{viewCache:o,changes:c}}function _5(t,e,n){const r=e.eventCache;if(r.isFullyInitialized()){const s=r.getNode().isLeafNode()||r.getNode().isEmpty(),i=Bu(t);(n.length>0||!t.eventCache.isFullyInitialized()||s&&!r.getNode().equals(i)||!r.getNode().getPriority().equals(i.getPriority()))&&n.push(Tb(Bu(e)))}}function Lb(t,e,n,r,s,i){const o=e.eventCache;if(Hu(r,n)!=null)return e;{let l,c;if(ot(n))if(de(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const u=wi(e),d=u instanceof ze?u:ze.EMPTY_NODE,h=qg(r,d);l=t.filter.updateFullNode(e.eventCache.getNode(),h,i)}else{const u=zu(r,wi(e));l=t.filter.updateFullNode(e.eventCache.getNode(),u,i)}else{const u=st(n);if(u===".priority"){de(Vs(n)===1,"Can't have a priority with additional path components");const d=o.getNode();c=e.serverCache.getNode();const h=_v(r,n,d,c);h!=null?l=t.filter.updatePriority(d,h):l=o.getNode()}else{const d=It(n);let h;if(o.isCompleteForChild(u)){c=e.serverCache.getNode();const f=_v(r,n,o.getNode(),c);f!=null?h=o.getNode().getImmediateChild(u).updateChild(d,f):h=o.getNode().getImmediateChild(u)}else h=Zg(r,u,e.serverCache);h!=null?l=t.filter.updateChild(o.getNode(),u,h,d,s,i):l=o.getNode()}}return Ba(e,l,o.isFullyInitialized()||ot(n),t.filter.filtersNodes())}}function Wu(t,e,n,r,s,i,o,l){const c=e.serverCache;let u;const d=o?t.filter:t.filter.getIndexedFilter();if(ot(n))u=d.updateFullNode(c.getNode(),r,null);else if(d.filtersNodes()&&!c.isFiltered()){const _=c.getNode().updateChild(n,r);u=d.updateFullNode(c.getNode(),_,null)}else{const _=st(n);if(!c.isCompleteForPath(n)&&Vs(n)>1)return e;const R=It(n),B=c.getNode().getImmediateChild(_).updateChild(R,r);_===".priority"?u=d.updatePriority(c.getNode(),B):u=d.updateChild(c.getNode(),_,B,R,Ob,null)}const h=Cb(e,u,c.isFullyInitialized()||ot(n),d.filtersNodes()),f=new e0(s,h,i);return Lb(t,h,n,s,f,l)}function vp(t,e,n,r,s,i,o){const l=e.eventCache;let c,u;const d=new e0(s,e,i);if(ot(n))u=t.filter.updateFullNode(e.eventCache.getNode(),r,o),c=Ba(e,u,!0,t.filter.filtersNodes());else{const h=st(n);if(h===".priority")u=t.filter.updatePriority(e.eventCache.getNode(),r),c=Ba(e,u,l.isFullyInitialized(),l.isFiltered());else{const f=It(n),_=l.getNode().getImmediateChild(h);let R;if(ot(f))R=r;else{const k=d.getCompleteChild(h);k!=null?Hg(f)===".priority"&&k.getChild(vb(f)).isEmpty()?R=k:R=k.updateChild(f,r):R=ze.EMPTY_NODE}if(_.equals(R))c=e;else{const k=t.filter.updateChild(l.getNode(),h,R,f,d,o);c=Ba(e,k,l.isFullyInitialized(),t.filter.filtersNodes())}}}return c}function xv(t,e){return t.eventCache.isCompleteForChild(e)}function x5(t,e,n,r,s,i,o){let l=e;return r.foreach((c,u)=>{const d=Mt(n,c);xv(e,st(d))&&(l=vp(t,l,d,u,s,i,o))}),r.foreach((c,u)=>{const d=Mt(n,c);xv(e,st(d))||(l=vp(t,l,d,u,s,i,o))}),l}function bv(t,e,n){return n.foreach((r,s)=>{e=e.updateChild(r,s)}),e}function _p(t,e,n,r,s,i,o,l){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,u;ot(n)?u=r:u=new Ct(null).setTree(n,r);const d=e.serverCache.getNode();return u.children.inorderTraversal((h,f)=>{if(d.hasChild(h)){const _=e.serverCache.getNode().getImmediateChild(h),R=bv(t,_,f);c=Wu(t,c,new _t(h),R,s,i,o,l)}}),u.children.inorderTraversal((h,f)=>{const _=!e.serverCache.isCompleteForChild(h)&&f.value===null;if(!d.hasChild(h)&&!_){const R=e.serverCache.getNode().getImmediateChild(h),k=bv(t,R,f);c=Wu(t,c,new _t(h),k,s,i,o,l)}}),c}function b5(t,e,n,r,s,i,o){if(Hu(s,n)!=null)return e;const l=e.serverCache.isFiltered(),c=e.serverCache;if(r.value!=null){if(ot(n)&&c.isFullyInitialized()||c.isCompleteForPath(n))return Wu(t,e,n,c.getNode().getChild(n),s,i,l,o);if(ot(n)){let u=new Ct(null);return c.getNode().forEachChild(_o,(d,h)=>{u=u.set(new _t(d),h)}),_p(t,e,n,u,s,i,l,o)}else return e}else{let u=new Ct(null);return r.foreach((d,h)=>{const f=Mt(n,d);c.isCompleteForPath(f)&&(u=u.set(d,c.getNode().getChild(f)))}),_p(t,e,n,u,s,i,l,o)}}function E5(t,e,n,r,s){const i=e.serverCache,o=Cb(e,i.getNode(),i.isFullyInitialized()||ot(n),i.isFiltered());return Lb(t,o,n,r,Ob,s)}function S5(t,e,n,r,s,i){let o;if(Hu(r,n)!=null)return e;{const l=new e0(r,e,s),c=e.eventCache.getNode();let u;if(ot(n)||st(n)===".priority"){let d;if(e.serverCache.isFullyInitialized())d=zu(r,wi(e));else{const h=e.serverCache.getNode();de(h instanceof ze,"serverChildren would be complete if leaf node"),d=qg(r,h)}d=d,u=t.filter.updateFullNode(c,d,i)}else{const d=st(n);let h=Zg(r,d,e.serverCache);h==null&&e.serverCache.isCompleteForChild(d)&&(h=c.getImmediateChild(d)),h!=null?u=t.filter.updateChild(c,d,h,It(n),l,i):e.eventCache.getNode().hasChild(d)?u=t.filter.updateChild(c,d,ze.EMPTY_NODE,It(n),l,i):u=c,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=zu(r,wi(e)),o.isLeafNode()&&(u=t.filter.updateFullNode(u,o,i)))}return o=e.serverCache.isFullyInitialized()||Hu(r,ht())!=null,Ba(e,u,o,t.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I5{constructor(e,n){this.query_=e,this.eventRegistrations_=[];const r=this.query_._queryParams,s=new Yg(r.getIndex()),i=zk(r);this.processor_=m5(i);const o=n.serverCache,l=n.eventCache,c=s.updateFullNode(ze.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(ze.EMPTY_NODE,l.getNode(),null),d=new Ys(c,o.isFullyInitialized(),s.filtersNodes()),h=new Ys(u,l.isFullyInitialized(),i.filtersNodes());this.viewCache_=Ed(h,d),this.eventGenerator_=new Xk(this.query_)}get query(){return this.query_}}function T5(t){return t.viewCache_.serverCache.getNode()}function C5(t){return Bu(t.viewCache_)}function w5(t,e){const n=wi(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!ot(e)&&!n.getImmediateChild(st(e)).isEmpty())?n.getChild(e):null}function Ev(t){return t.eventRegistrations_.length===0}function k5(t,e){t.eventRegistrations_.push(e)}function Sv(t,e,n){const r=[];if(n){de(e==null,"A cancel should cancel all event registrations.");const s=t.query._path;t.eventRegistrations_.forEach(i=>{const o=i.createCancelEvent(n,s);o&&r.push(o)})}if(e){let s=[];for(let i=0;i<t.eventRegistrations_.length;++i){const o=t.eventRegistrations_[i];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(t.eventRegistrations_.slice(i+1));break}}t.eventRegistrations_=s}else t.eventRegistrations_=[];return r}function Iv(t,e,n,r){e.type===hr.MERGE&&e.source.queryId!==null&&(de(wi(t.viewCache_),"We should always have a full cache before handling merges"),de(Bu(t.viewCache_),"Missing event cache, even though we have a server cache"));const s=t.viewCache_,i=v5(t.processor_,s,e,n,r);return y5(t.processor_,i.viewCache),de(i.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=i.viewCache,Db(t,i.changes,i.viewCache.eventCache.getNode(),null)}function A5(t,e){const n=t.viewCache_.eventCache,r=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(Ot,(i,o)=>{r.push(Mo(i,o))}),n.isFullyInitialized()&&r.push(Tb(n.getNode())),Db(t,r,n.getNode(),e)}function Db(t,e,n,r){const s=r?[r]:t.eventRegistrations_;return Qk(t.eventGenerator_,e,n,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Gu;class Mb{constructor(){this.views=new Map}}function R5(t){de(!Gu,"__referenceConstructor has already been defined"),Gu=t}function P5(){return de(Gu,"Reference.ts has not been loaded"),Gu}function O5(t){return t.views.size===0}function t0(t,e,n,r){const s=e.source.queryId;if(s!==null){const i=t.views.get(s);return de(i!=null,"SyncTree gave us an op for an invalid query."),Iv(i,e,n,r)}else{let i=[];for(const o of t.views.values())i=i.concat(Iv(o,e,n,r));return i}}function Nb(t,e,n,r,s){const i=e._queryIdentifier,o=t.views.get(i);if(!o){let l=zu(n,s?r:null),c=!1;l?c=!0:r instanceof ze?(l=qg(n,r),c=!1):(l=ze.EMPTY_NODE,c=!1);const u=Ed(new Ys(l,c,!1),new Ys(r,s,!1));return new I5(e,u)}return o}function L5(t,e,n,r,s,i){const o=Nb(t,e,r,s,i);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,o),k5(o,n),A5(o,n)}function D5(t,e,n,r){const s=e._queryIdentifier,i=[];let o=[];const l=Ks(t);if(s==="default")for(const[c,u]of t.views.entries())o=o.concat(Sv(u,n,r)),Ev(u)&&(t.views.delete(c),u.query._queryParams.loadsAllData()||i.push(u.query));else{const c=t.views.get(s);c&&(o=o.concat(Sv(c,n,r)),Ev(c)&&(t.views.delete(s),c.query._queryParams.loadsAllData()||i.push(c.query)))}return l&&!Ks(t)&&i.push(new(P5())(e._repo,e._path)),{removed:i,events:o}}function jb(t){const e=[];for(const n of t.views.values())n.query._queryParams.loadsAllData()||e.push(n);return e}function Bs(t,e){let n=null;for(const r of t.views.values())n=n||w5(r,e);return n}function $b(t,e){if(e._queryParams.loadsAllData())return Id(t);{const r=e._queryIdentifier;return t.views.get(r)}}function Fb(t,e){return $b(t,e)!=null}function Ks(t){return Id(t)!=null}function Id(t){for(const e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Vu;function M5(t){de(!Vu,"__referenceConstructor has already been defined"),Vu=t}function N5(){return de(Vu,"Reference.ts has not been loaded"),Vu}let j5=1;class Tv{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Ct(null),this.pendingWriteTree_=f5(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function n0(t,e,n,r,s){return e5(t.pendingWriteTree_,e,n,r,s),s?Xo(t,new Ci(Xg(),e,n)):[]}function $5(t,e,n,r){t5(t.pendingWriteTree_,e,n,r);const s=Ct.fromObject(n);return Xo(t,new No(Xg(),e,s))}function Cs(t,e,n=!1){const r=n5(t.pendingWriteTree_,e);if(r5(t.pendingWriteTree_,e)){let i=new Ct(null);return r.snap!=null?i=i.set(ht(),!0):en(r.children,o=>{i=i.set(new _t(o),!0)}),Xo(t,new Uu(r.path,i,n))}else return[]}function Ll(t,e,n){return Xo(t,new Ci(Qg(),e,n))}function F5(t,e,n){const r=Ct.fromObject(n);return Xo(t,new No(Qg(),e,r))}function U5(t,e){return Xo(t,new _l(Qg(),e))}function B5(t,e,n){const r=r0(t,n);if(r){const s=s0(r),i=s.path,o=s.queryId,l=Sn(i,e),c=new _l(Jg(o),l);return i0(t,i,c)}else return[]}function Yu(t,e,n,r,s=!1){const i=e._path,o=t.syncPointTree_.get(i);let l=[];if(o&&(e._queryIdentifier==="default"||Fb(o,e))){const c=D5(o,e,n,r);O5(o)&&(t.syncPointTree_=t.syncPointTree_.remove(i));const u=c.removed;if(l=c.events,!s){const d=u.findIndex(f=>f._queryParams.loadsAllData())!==-1,h=t.syncPointTree_.findOnPath(i,(f,_)=>Ks(_));if(d&&!h){const f=t.syncPointTree_.subtree(i);if(!f.isEmpty()){const _=W5(f);for(let R=0;R<_.length;++R){const k=_[R],B=k.query,x=Hb(t,k);t.listenProvider_.startListening(Ha(B),xl(t,B),x.hashFn,x.onComplete)}}}!h&&u.length>0&&!r&&(d?t.listenProvider_.stopListening(Ha(e),null):u.forEach(f=>{const _=t.queryToTagMap.get(Cd(f));t.listenProvider_.stopListening(Ha(f),_)}))}G5(t,u)}return l}function Ub(t,e,n,r){const s=r0(t,r);if(s!=null){const i=s0(s),o=i.path,l=i.queryId,c=Sn(o,e),u=new Ci(Jg(l),c,n);return i0(t,o,u)}else return[]}function z5(t,e,n,r){const s=r0(t,r);if(s){const i=s0(s),o=i.path,l=i.queryId,c=Sn(o,e),u=Ct.fromObject(n),d=new No(Jg(l),c,u);return i0(t,o,d)}else return[]}function xp(t,e,n,r=!1){const s=e._path;let i=null,o=!1;t.syncPointTree_.foreachOnPath(s,(f,_)=>{const R=Sn(f,s);i=i||Bs(_,R),o=o||Ks(_)});let l=t.syncPointTree_.get(s);l?(o=o||Ks(l),i=i||Bs(l,ht())):(l=new Mb,t.syncPointTree_=t.syncPointTree_.set(s,l));let c;i!=null?c=!0:(c=!1,i=ze.EMPTY_NODE,t.syncPointTree_.subtree(s).foreachChild((_,R)=>{const k=Bs(R,ht());k&&(i=i.updateImmediateChild(_,k))}));const u=Fb(l,e);if(!u&&!e._queryParams.loadsAllData()){const f=Cd(e);de(!t.queryToTagMap.has(f),"View does not exist, but we have a tag");const _=V5();t.queryToTagMap.set(f,_),t.tagToQueryMap.set(_,f)}const d=Sd(t.pendingWriteTree_,s);let h=L5(l,e,n,d,i,c);if(!u&&!o&&!r){const f=$b(l,e);h=h.concat(Y5(t,e,f))}return h}function Td(t,e,n){const s=t.pendingWriteTree_,i=t.syncPointTree_.findOnPath(e,(o,l)=>{const c=Sn(o,e),u=Bs(l,c);if(u)return u});return Ab(s,e,i,n,!0)}function H5(t,e){const n=e._path;let r=null;t.syncPointTree_.foreachOnPath(n,(u,d)=>{const h=Sn(u,n);r=r||Bs(d,h)});let s=t.syncPointTree_.get(n);s?r=r||Bs(s,ht()):(s=new Mb,t.syncPointTree_=t.syncPointTree_.set(n,s));const i=r!=null,o=i?new Ys(r,!0,!1):null,l=Sd(t.pendingWriteTree_,e._path),c=Nb(s,e,l,i?o.getNode():ze.EMPTY_NODE,i);return C5(c)}function Xo(t,e){return Bb(e,t.syncPointTree_,null,Sd(t.pendingWriteTree_,ht()))}function Bb(t,e,n,r){if(ot(t.path))return zb(t,e,n,r);{const s=e.get(ht());n==null&&s!=null&&(n=Bs(s,ht()));let i=[];const o=st(t.path),l=t.operationForChild(o),c=e.children.get(o);if(c&&l){const u=n?n.getImmediateChild(o):null,d=Rb(r,o);i=i.concat(Bb(l,c,u,d))}return s&&(i=i.concat(t0(s,t,r,n))),i}}function zb(t,e,n,r){const s=e.get(ht());n==null&&s!=null&&(n=Bs(s,ht()));let i=[];return e.children.inorderTraversal((o,l)=>{const c=n?n.getImmediateChild(o):null,u=Rb(r,o),d=t.operationForChild(o);d&&(i=i.concat(zb(d,l,c,u)))}),s&&(i=i.concat(t0(s,t,r,n))),i}function Hb(t,e){const n=e.query,r=xl(t,n);return{hashFn:()=>(T5(e)||ze.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return r?B5(t,n._path,r):U5(t,n._path);{const i=Uw(s,n);return Yu(t,n,null,i)}}}}function xl(t,e){const n=Cd(e);return t.queryToTagMap.get(n)}function Cd(t){return t._path.toString()+"$"+t._queryIdentifier}function r0(t,e){return t.tagToQueryMap.get(e)}function s0(t){const e=t.indexOf("$");return de(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new _t(t.substr(0,e))}}function i0(t,e,n){const r=t.syncPointTree_.get(e);de(r,"Missing sync point for query tag that we're tracking");const s=Sd(t.pendingWriteTree_,e);return t0(r,n,s,null)}function W5(t){return t.fold((e,n,r)=>{if(n&&Ks(n))return[Id(n)];{let s=[];return n&&(s=jb(n)),en(r,(i,o)=>{s=s.concat(o)}),s}})}function Ha(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(N5())(t._repo,t._path):t}function G5(t,e){for(let n=0;n<e.length;++n){const r=e[n];if(!r._queryParams.loadsAllData()){const s=Cd(r),i=t.queryToTagMap.get(s);t.queryToTagMap.delete(s),t.tagToQueryMap.delete(i)}}}function V5(){return j5++}function Y5(t,e,n){const r=e._path,s=xl(t,e),i=Hb(t,n),o=t.listenProvider_.startListening(Ha(e),s,i.hashFn,i.onComplete),l=t.syncPointTree_.subtree(r);if(s)de(!Ks(l.value),"If we're adding a query, it shouldn't be shadowed");else{const c=l.fold((u,d,h)=>{if(!ot(u)&&d&&Ks(d))return[Id(d).query];{let f=[];return d&&(f=f.concat(jb(d).map(_=>_.query))),en(h,(_,R)=>{f=f.concat(R)}),f}});for(let u=0;u<c.length;++u){const d=c[u];t.listenProvider_.stopListening(Ha(d),xl(t,d))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o0{constructor(e){this.node_=e}getImmediateChild(e){const n=this.node_.getImmediateChild(e);return new o0(n)}node(){return this.node_}}class a0{constructor(e,n){this.syncTree_=e,this.path_=n}getImmediateChild(e){const n=Mt(this.path_,e);return new a0(this.syncTree_,n)}node(){return Td(this.syncTree_,this.path_)}}const K5=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},Cv=function(t,e,n){if(!t||typeof t!="object")return t;if(de(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return X5(t[".sv"],e,n);if(typeof t[".sv"]=="object")return Q5(t[".sv"],e);de(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},X5=function(t,e,n){switch(t){case"timestamp":return n.timestamp;default:de(!1,"Unexpected server value: "+t)}},Q5=function(t,e,n){t.hasOwnProperty("increment")||de(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const r=t.increment;typeof r!="number"&&de(!1,"Unexpected increment value: "+r);const s=e.node();if(de(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return r;const o=s.getValue();return typeof o!="number"?r:o+r},Wb=function(t,e,n,r){return c0(e,new a0(n,t),r)},l0=function(t,e,n){return c0(t,new o0(e),n)};function c0(t,e,n){const r=t.getPriority().val(),s=Cv(r,e.getImmediateChild(".priority"),n);let i;if(t.isLeafNode()){const o=t,l=Cv(o.getValue(),e,n);return l!==o.getValue()||s!==o.getPriority().val()?new Xt(l,Dt(s)):t}else{const o=t;return i=o,s!==o.getPriority().val()&&(i=i.updatePriority(new Xt(s))),o.forEachChild(Ot,(l,c)=>{const u=c0(c,e.getImmediateChild(l),n);u!==c&&(i=i.updateImmediateChild(l,u))}),i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u0{constructor(e="",n=null,r={children:{},childCount:0}){this.name=e,this.parent=n,this.node=r}}function wd(t,e){let n=e instanceof _t?e:new _t(e),r=t,s=st(n);for(;s!==null;){const i=Ei(r.node.children,s)||{children:{},childCount:0};r=new u0(s,r,i),n=It(n),s=st(n)}return r}function Li(t){return t.node.value}function d0(t,e){t.node.value=e,bp(t)}function Gb(t){return t.node.childCount>0}function J5(t){return Li(t)===void 0&&!Gb(t)}function kd(t,e){en(t.node.children,(n,r)=>{e(new u0(n,t,r))})}function Vb(t,e,n,r){n&&e(t),kd(t,s=>{Vb(s,e,!0)})}function q5(t,e,n){let r=t.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function Dl(t){return new _t(t.parent===null?t.name:Dl(t.parent)+"/"+t.name)}function bp(t){t.parent!==null&&Z5(t.parent,t.name,t)}function Z5(t,e,n){const r=J5(n),s=_r(t.node.children,e);r&&s?(delete t.node.children[e],t.node.childCount--,bp(t)):!r&&!s&&(t.node.children[e]=n.node,t.node.childCount++,bp(t))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eA=/[\[\].#$\/\u0000-\u001F\u007F]/,tA=/[\[\].#$\u0000-\u001F\u007F]/,ih=10*1024*1024,f0=function(t){return typeof t=="string"&&t.length!==0&&!eA.test(t)},Yb=function(t){return typeof t=="string"&&t.length!==0&&!tA.test(t)},nA=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Yb(t)},h0=function(t){return t===null||typeof t=="string"||typeof t=="number"&&!xd(t)||t&&typeof t=="object"&&_r(t,".sv")},Ku=function(t,e,n,r){r&&e===void 0||Ml(Oo(t,"value"),e,n)},Ml=function(t,e,n){const r=n instanceof _t?new xk(n,t):n;if(e===void 0)throw new Error(t+"contains undefined "+ci(r));if(typeof e=="function")throw new Error(t+"contains a function "+ci(r)+" with contents = "+e.toString());if(xd(e))throw new Error(t+"contains "+e.toString()+" "+ci(r));if(typeof e=="string"&&e.length>ih/3&&_d(e)>ih)throw new Error(t+"contains a string greater than "+ih+" utf8 bytes "+ci(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,i=!1;if(en(e,(o,l)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(i=!0,!f0(o)))throw new Error(t+" contains an invalid key ("+o+") "+ci(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);bk(r,o),Ml(t,l,r),Ek(r)}),s&&i)throw new Error(t+' contains ".value" child '+ci(r)+" in addition to actual children.")}},rA=function(t,e){let n,r;for(n=0;n<e.length;n++){r=e[n];const i=gl(r);for(let o=0;o<i.length;o++)if(!(i[o]===".priority"&&o===i.length-1)){if(!f0(i[o]))throw new Error(t+"contains an invalid key ("+i[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(_k);let s=null;for(n=0;n<e.length;n++){if(r=e[n],s!==null&&Zn(s,r))throw new Error(t+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}},Kb=function(t,e,n,r){const s=Oo(t,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");const i=[];en(e,(o,l)=>{const c=new _t(o);if(Ml(s,l,Mt(n,c)),Hg(c)===".priority"&&!h0(l))throw new Error(s+"contains an invalid value for '"+c.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");i.push(c)}),rA(s,i)},sA=function(t,e,n){if(xd(e))throw new Error(Oo(t,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!h0(e))throw new Error(Oo(t,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")},Xb=function(t,e,n,r){if(!Yb(n))throw new Error(Oo(t,e)+'was an invalid path = "'+n+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},iA=function(t,e,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Xb(t,e,n)},ws=function(t,e){if(st(e)===".info")throw new Error(t+" failed = Can't modify data under /.info/")},oA=function(t,e){const n=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!f0(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||n.length!==0&&!nA(n))throw new Error(Oo(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aA{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Ad(t,e){let n=null;for(let r=0;r<e.length;r++){const s=e[r],i=s.getPath();n!==null&&!Wg(i,n.path)&&(t.eventLists_.push(n),n=null),n===null&&(n={events:[],path:i}),n.events.push(s)}n&&t.eventLists_.push(n)}function Qb(t,e,n){Ad(t,n),Jb(t,r=>Wg(r,e))}function Wn(t,e,n){Ad(t,n),Jb(t,r=>Zn(r,e)||Zn(e,r))}function Jb(t,e){t.recursionDepth_++;let n=!0;for(let r=0;r<t.eventLists_.length;r++){const s=t.eventLists_[r];if(s){const i=s.path;e(i)?(lA(t.eventLists_[r]),t.eventLists_[r]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function lA(t){for(let e=0;e<t.events.length;e++){const n=t.events[e];if(n!==null){t.events[e]=null;const r=n.getEventRunner();Fa&&qt("event: "+n.toString()),Yo(r)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cA="repo_interrupt",uA=25;class dA{constructor(e,n,r,s){this.repoInfo_=e,this.forceRestClient_=n,this.authTokenProvider_=r,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new aA,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Fu(),this.transactionQueueTree_=new u0,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function fA(t,e,n){if(t.stats_=Bg(t.repoInfo_),t.forceRestClient_||Ww())t.server_=new $u(t.repoInfo_,(r,s,i,o)=>{wv(t,r,s,i,o)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>kv(t,!0),0);else{if(typeof n<"u"&&n!==null){if(typeof n!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Yt(n)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}t.persistentConnection_=new Qr(t.repoInfo_,e,(r,s,i,o)=>{wv(t,r,s,i,o)},r=>{kv(t,r)},r=>{hA(t,r)},t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(r=>{t.server_.refreshAuthToken(r)}),t.appCheckProvider_.addTokenChangeListener(r=>{t.server_.refreshAppCheckToken(r.token)}),t.statsReporter_=Xw(t.repoInfo_,()=>new Kk(t.stats_,t.server_)),t.infoData_=new Hk,t.infoSyncTree_=new Tv({startListening:(r,s,i,o)=>{let l=[];const c=t.infoData_.getNode(r._path);return c.isEmpty()||(l=Ll(t.infoSyncTree_,r._path,c),setTimeout(()=>{o("ok")},0)),l},stopListening:()=>{}}),p0(t,"connected",!1),t.serverSyncTree_=new Tv({startListening:(r,s,i,o)=>(t.server_.listen(r,i,s,(l,c)=>{const u=o(l,c);Wn(t.eventQueue_,r._path,u)}),[]),stopListening:(r,s)=>{t.server_.unlisten(r,s)}})}function qb(t){const n=t.infoData_.getNode(new _t(".info/serverTimeOffset")).val()||0;return new Date().getTime()+n}function Nl(t){return K5({timestamp:qb(t)})}function wv(t,e,n,r,s){t.dataUpdateCount++;const i=new _t(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let o=[];if(s)if(r){const c=Lu(n,u=>Dt(u));o=z5(t.serverSyncTree_,i,c,s)}else{const c=Dt(n);o=Ub(t.serverSyncTree_,i,c,s)}else if(r){const c=Lu(n,u=>Dt(u));o=F5(t.serverSyncTree_,i,c)}else{const c=Dt(n);o=Ll(t.serverSyncTree_,i,c)}let l=i;o.length>0&&(l=$o(t,i)),Wn(t.eventQueue_,l,o)}function kv(t,e){p0(t,"connected",e),e===!1&&yA(t)}function hA(t,e){en(e,(n,r)=>{p0(t,n,r)})}function p0(t,e,n){const r=new _t("/.info/"+e),s=Dt(n);t.infoData_.updateSnapshot(r,s);const i=Ll(t.infoSyncTree_,r,s);Wn(t.eventQueue_,r,i)}function Rd(t){return t.nextWriteId_++}function pA(t,e,n){const r=H5(t.serverSyncTree_,e);return r!=null?Promise.resolve(r):t.server_.get(e).then(s=>{const i=Dt(s).withIndex(e._queryParams.getIndex());xp(t.serverSyncTree_,e,n,!0);let o;if(e._queryParams.loadsAllData())o=Ll(t.serverSyncTree_,e._path,i);else{const l=xl(t.serverSyncTree_,e);o=Ub(t.serverSyncTree_,e._path,i,l)}return Wn(t.eventQueue_,e._path,o),Yu(t.serverSyncTree_,e,n,null,!0),i},s=>(Qo(t,"get for query "+Yt(e)+" failed: "+s),Promise.reject(new Error(s))))}function gA(t,e,n,r,s){Qo(t,"set",{path:e.toString(),value:n,priority:r});const i=Nl(t),o=Dt(n,r),l=Td(t.serverSyncTree_,e),c=l0(o,l,i),u=Rd(t),d=n0(t.serverSyncTree_,e,c,u,!0);Ad(t.eventQueue_,d),t.server_.put(e.toString(),o.val(!0),(f,_)=>{const R=f==="ok";R||Tn("set at "+e+" failed: "+f);const k=Cs(t.serverSyncTree_,u,!R);Wn(t.eventQueue_,e,k),Xs(t,s,f,_)});const h=m0(t,e);$o(t,h),Wn(t.eventQueue_,h,[])}function mA(t,e,n,r){Qo(t,"update",{path:e.toString(),value:n});let s=!0;const i=Nl(t),o={};if(en(n,(l,c)=>{s=!1,o[l]=Wb(Mt(e,l),Dt(c),t.serverSyncTree_,i)}),s)qt("update() called with empty data.  Don't do anything."),Xs(t,r,"ok",void 0);else{const l=Rd(t),c=$5(t.serverSyncTree_,e,o,l);Ad(t.eventQueue_,c),t.server_.merge(e.toString(),n,(u,d)=>{const h=u==="ok";h||Tn("update at "+e+" failed: "+u);const f=Cs(t.serverSyncTree_,l,!h),_=f.length>0?$o(t,e):e;Wn(t.eventQueue_,_,f),Xs(t,r,u,d)}),en(n,u=>{const d=m0(t,Mt(e,u));$o(t,d)}),Wn(t.eventQueue_,e,[])}}function yA(t){Qo(t,"onDisconnectEvents");const e=Nl(t),n=Fu();pp(t.onDisconnect_,ht(),(s,i)=>{const o=Wb(s,i,t.serverSyncTree_,e);Ko(n,s,o)});let r=[];pp(n,ht(),(s,i)=>{r=r.concat(Ll(t.serverSyncTree_,s,i));const o=m0(t,s);$o(t,o)}),t.onDisconnect_=Fu(),Wn(t.eventQueue_,ht(),r)}function vA(t,e,n){t.server_.onDisconnectCancel(e.toString(),(r,s)=>{r==="ok"&&hp(t.onDisconnect_,e),Xs(t,n,r,s)})}function Av(t,e,n,r){const s=Dt(n);t.server_.onDisconnectPut(e.toString(),s.val(!0),(i,o)=>{i==="ok"&&Ko(t.onDisconnect_,e,s),Xs(t,r,i,o)})}function _A(t,e,n,r,s){const i=Dt(n,r);t.server_.onDisconnectPut(e.toString(),i.val(!0),(o,l)=>{o==="ok"&&Ko(t.onDisconnect_,e,i),Xs(t,s,o,l)})}function xA(t,e,n,r){if(Ou(n)){qt("onDisconnect().update() called with empty data.  Don't do anything."),Xs(t,r,"ok",void 0);return}t.server_.onDisconnectMerge(e.toString(),n,(s,i)=>{s==="ok"&&en(n,(o,l)=>{const c=Dt(l);Ko(t.onDisconnect_,Mt(e,o),c)}),Xs(t,r,s,i)})}function bA(t,e,n){let r;st(e._path)===".info"?r=xp(t.infoSyncTree_,e,n):r=xp(t.serverSyncTree_,e,n),Qb(t.eventQueue_,e._path,r)}function EA(t,e,n){let r;st(e._path)===".info"?r=Yu(t.infoSyncTree_,e,n):r=Yu(t.serverSyncTree_,e,n),Qb(t.eventQueue_,e._path,r)}function SA(t){t.persistentConnection_&&t.persistentConnection_.interrupt(cA)}function Qo(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),qt(n,...e)}function Xs(t,e,n,r){e&&Yo(()=>{if(n==="ok")e(null);else{const s=(n||"error").toUpperCase();let i=s;r&&(i+=": "+r);const o=new Error(i);o.code=s,e(o)}})}function IA(t,e,n,r,s,i){Qo(t,"transaction on "+e);const o={path:e,update:n,onComplete:r,status:null,order:Q1(),applyLocally:i,retryCount:0,unwatcher:s,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},l=g0(t,e,void 0);o.currentInputSnapshot=l;const c=o.update(l.val());if(c===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{Ml("transaction failed: Data returned ",c,o.path),o.status=0;const u=wd(t.transactionQueueTree_,e),d=Li(u)||[];d.push(o),d0(u,d);let h;typeof c=="object"&&c!==null&&_r(c,".priority")?(h=Ei(c,".priority"),de(h0(h),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):h=(Td(t.serverSyncTree_,e)||ze.EMPTY_NODE).getPriority().val();const f=Nl(t),_=Dt(c,h),R=l0(_,l,f);o.currentOutputSnapshotRaw=_,o.currentOutputSnapshotResolved=R,o.currentWriteId=Rd(t);const k=n0(t.serverSyncTree_,e,R,o.currentWriteId,o.applyLocally);Wn(t.eventQueue_,e,k),Pd(t,t.transactionQueueTree_)}}function g0(t,e,n){return Td(t.serverSyncTree_,e,n)||ze.EMPTY_NODE}function Pd(t,e=t.transactionQueueTree_){if(e||Od(t,e),Li(e)){const n=eE(t,e);de(n.length>0,"Sending zero length transaction queue"),n.every(s=>s.status===0)&&TA(t,Dl(e),n)}else Gb(e)&&kd(e,n=>{Pd(t,n)})}function TA(t,e,n){const r=n.map(u=>u.currentWriteId),s=g0(t,e,r);let i=s;const o=s.hash();for(let u=0;u<n.length;u++){const d=n[u];de(d.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),d.status=1,d.retryCount++;const h=Sn(e,d.path);i=i.updateChild(h,d.currentOutputSnapshotRaw)}const l=i.val(!0),c=e;t.server_.put(c.toString(),l,u=>{Qo(t,"transaction put response",{path:c.toString(),status:u});let d=[];if(u==="ok"){const h=[];for(let f=0;f<n.length;f++)n[f].status=2,d=d.concat(Cs(t.serverSyncTree_,n[f].currentWriteId)),n[f].onComplete&&h.push(()=>n[f].onComplete(null,!0,n[f].currentOutputSnapshotResolved)),n[f].unwatcher();Od(t,wd(t.transactionQueueTree_,e)),Pd(t,t.transactionQueueTree_),Wn(t.eventQueue_,e,d);for(let f=0;f<h.length;f++)Yo(h[f])}else{if(u==="datastale")for(let h=0;h<n.length;h++)n[h].status===3?n[h].status=4:n[h].status=0;else{Tn("transaction at "+c.toString()+" failed: "+u);for(let h=0;h<n.length;h++)n[h].status=4,n[h].abortReason=u}$o(t,e)}},o)}function $o(t,e){const n=Zb(t,e),r=Dl(n),s=eE(t,n);return CA(t,s,r),r}function CA(t,e,n){if(e.length===0)return;const r=[];let s=[];const o=e.filter(l=>l.status===0).map(l=>l.currentWriteId);for(let l=0;l<e.length;l++){const c=e[l],u=Sn(n,c.path);let d=!1,h;if(de(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)d=!0,h=c.abortReason,s=s.concat(Cs(t.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=uA)d=!0,h="maxretry",s=s.concat(Cs(t.serverSyncTree_,c.currentWriteId,!0));else{const f=g0(t,c.path,o);c.currentInputSnapshot=f;const _=e[l].update(f.val());if(_!==void 0){Ml("transaction failed: Data returned ",_,c.path);let R=Dt(_);typeof _=="object"&&_!=null&&_r(_,".priority")||(R=R.updatePriority(f.getPriority()));const B=c.currentWriteId,x=Nl(t),E=l0(R,f,x);c.currentOutputSnapshotRaw=R,c.currentOutputSnapshotResolved=E,c.currentWriteId=Rd(t),o.splice(o.indexOf(B),1),s=s.concat(n0(t.serverSyncTree_,c.path,E,c.currentWriteId,c.applyLocally)),s=s.concat(Cs(t.serverSyncTree_,B,!0))}else d=!0,h="nodata",s=s.concat(Cs(t.serverSyncTree_,c.currentWriteId,!0))}Wn(t.eventQueue_,n,s),s=[],d&&(e[l].status=2,function(f){setTimeout(f,Math.floor(0))}(e[l].unwatcher),e[l].onComplete&&(h==="nodata"?r.push(()=>e[l].onComplete(null,!1,e[l].currentInputSnapshot)):r.push(()=>e[l].onComplete(new Error(h),!1,null))))}Od(t,t.transactionQueueTree_);for(let l=0;l<r.length;l++)Yo(r[l]);Pd(t,t.transactionQueueTree_)}function Zb(t,e){let n,r=t.transactionQueueTree_;for(n=st(e);n!==null&&Li(r)===void 0;)r=wd(r,n),e=It(e),n=st(e);return r}function eE(t,e){const n=[];return tE(t,e,n),n.sort((r,s)=>r.order-s.order),n}function tE(t,e,n){const r=Li(e);if(r)for(let s=0;s<r.length;s++)n.push(r[s]);kd(e,s=>{tE(t,s,n)})}function Od(t,e){const n=Li(e);if(n){let r=0;for(let s=0;s<n.length;s++)n[s].status!==2&&(n[r]=n[s],r++);n.length=r,d0(e,n.length>0?n:void 0)}kd(e,r=>{Od(t,r)})}function m0(t,e){const n=Dl(Zb(t,e)),r=wd(t.transactionQueueTree_,e);return q5(r,s=>{oh(t,s)}),oh(t,r),Vb(r,s=>{oh(t,s)}),n}function oh(t,e){const n=Li(e);if(n){const r=[];let s=[],i=-1;for(let o=0;o<n.length;o++)n[o].status===3||(n[o].status===1?(de(i===o-1,"All SENT items should be at beginning of queue."),i=o,n[o].status=3,n[o].abortReason="set"):(de(n[o].status===0,"Unexpected transaction status in abort"),n[o].unwatcher(),s=s.concat(Cs(t.serverSyncTree_,n[o].currentWriteId,!0)),n[o].onComplete&&r.push(n[o].onComplete.bind(null,new Error("set"),!1,null))));i===-1?d0(e,void 0):n.length=i+1,Wn(t.eventQueue_,Dl(e),s);for(let o=0;o<r.length;o++)Yo(r[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wA(t){let e="";const n=t.split("/");for(let r=0;r<n.length;r++)if(n[r].length>0){let s=n[r];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function kA(t){const e={};t.charAt(0)==="?"&&(t=t.substring(1));for(const n of t.split("&")){if(n.length===0)continue;const r=n.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):Tn(`Invalid query segment '${n}' in query '${t}'`)}return e}const Rv=function(t,e){const n=AA(t),r=n.namespace;n.domain==="firebase.com"&&ns(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&n.domain!=="localhost"&&ns("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||Mw();const s=n.scheme==="ws"||n.scheme==="wss";return{repoInfo:new cb(n.host,n.secure,r,s,e,"",r!==n.subdomain),path:new _t(n.pathString)}},AA=function(t){let e="",n="",r="",s="",i="",o=!0,l="https",c=443;if(typeof t=="string"){let u=t.indexOf("//");u>=0&&(l=t.substring(0,u-1),t=t.substring(u+2));let d=t.indexOf("/");d===-1&&(d=t.length);let h=t.indexOf("?");h===-1&&(h=t.length),e=t.substring(0,Math.min(d,h)),d<h&&(s=wA(t.substring(d,h)));const f=kA(t.substring(Math.min(t.length,h)));u=e.indexOf(":"),u>=0?(o=l==="https"||l==="wss",c=parseInt(e.substring(u+1),10)):u=e.length;const _=e.slice(0,u);if(_.toLowerCase()==="localhost")n="localhost";else if(_.split(".").length<=2)n=_;else{const R=e.indexOf(".");r=e.substring(0,R).toLowerCase(),n=e.substring(R+1),i=r}"ns"in f&&(i=f.ns)}return{host:e,port:c,domain:n,subdomain:r,secure:o,scheme:l,pathString:s,namespace:i}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pv="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",RA=function(){let t=0;const e=[];return function(n){const r=n===t;t=n;let s;const i=new Array(8);for(s=7;s>=0;s--)i[s]=Pv.charAt(n%64),n=Math.floor(n/64);de(n===0,"Cannot push at time == 0");let o=i.join("");if(r){for(s=11;s>=0&&e[s]===63;s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)o+=Pv.charAt(e[s]);return de(o.length===20,"nextPushId: Length should be 20."),o}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PA{constructor(e,n,r,s){this.eventType=e,this.eventRegistration=n,this.snapshot=r,this.prevName=s}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Yt(this.snapshot.exportVal())}}class OA{constructor(e,n,r){this.eventRegistration=e,this.error=n,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nE{constructor(e,n){this.snapshotCallback=e,this.cancelCallback=n}onValue(e,n){this.snapshotCallback.call(null,e,n)}onCancel(e){return de(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LA{constructor(e,n){this._repo=e,this._path=n}cancel(){const e=new ur;return vA(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){ws("OnDisconnect.remove",this._path);const e=new ur;return Av(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){ws("OnDisconnect.set",this._path),Ku("OnDisconnect.set",e,this._path,!1);const n=new ur;return Av(this._repo,this._path,e,n.wrapCallback(()=>{})),n.promise}setWithPriority(e,n){ws("OnDisconnect.setWithPriority",this._path),Ku("OnDisconnect.setWithPriority",e,this._path,!1),sA("OnDisconnect.setWithPriority",n);const r=new ur;return _A(this._repo,this._path,e,n,r.wrapCallback(()=>{})),r.promise}update(e){ws("OnDisconnect.update",this._path),Kb("OnDisconnect.update",e,this._path);const n=new ur;return xA(this._repo,this._path,e,n.wrapCallback(()=>{})),n.promise}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y0{constructor(e,n,r,s){this._repo=e,this._path=n,this._queryParams=r,this._orderByCalled=s}get key(){return ot(this._path)?null:Hg(this._path)}get ref(){return new Lr(this._repo,this._path)}get _queryIdentifier(){const e=gv(this._queryParams),n=Fg(e);return n==="{}"?"default":n}get _queryObject(){return gv(this._queryParams)}isEqual(e){if(e=yn(e),!(e instanceof y0))return!1;const n=this._repo===e._repo,r=Wg(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return n&&r&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+vk(this._path)}}class Lr extends y0{constructor(e,n){super(e,n,new Kg,!1)}get parent(){const e=vb(this._path);return e===null?null:new Lr(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class Fo{constructor(e,n,r){this._node=e,this.ref=n,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const n=new _t(e),r=bl(this.ref,e);return new Fo(this._node.getChild(n),r,Ot)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,s)=>e(new Fo(s,bl(this.ref,r),Ot)))}hasChild(e){const n=new _t(e);return!this._node.getChild(n).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Gr(t,e){return t=yn(t),t._checkNotDeleted("ref"),e!==void 0?bl(t._root,e):t._root}function bl(t,e){return t=yn(t),st(t._path)===null?iA("child","path",e):Xb("child","path",e),new Lr(t._repo,Mt(t._path,e))}function DA(t){return t=yn(t),new LA(t._repo,t._path)}function MA(t,e){t=yn(t),ws("push",t._path),Ku("push",e,t._path,!0);const n=qb(t._repo),r=RA(n),s=bl(t,r),i=bl(t,r);let o;return o=Promise.resolve(i),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function kc(t){return ws("remove",t._path),Ld(t,null)}function Ld(t,e){t=yn(t),ws("set",t._path),Ku("set",e,t._path,!1);const n=new ur;return gA(t._repo,t._path,e,null,n.wrapCallback(()=>{})),n.promise}function rE(t,e){Kb("update",e,t._path);const n=new ur;return mA(t._repo,t._path,e,n.wrapCallback(()=>{})),n.promise}function Dd(t){t=yn(t);const e=new nE(()=>{}),n=new Md(e);return pA(t._repo,t,n).then(r=>new Fo(r,new Lr(t._repo,t._path),t._queryParams.getIndex()))}class Md{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,n){const r=n._queryParams.getIndex();return new PA("value",this,new Fo(e.snapshotNode,new Lr(n._repo,n._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new OA(this,e,n):null}matches(e){return e instanceof Md?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function NA(t,e,n,r,s){const i=new nE(n,void 0),o=new Md(i);return bA(t._repo,t,o),()=>EA(t._repo,t,o)}function sE(t,e,n,r){return NA(t,"value",e)}R5(Lr);M5(Lr);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jA="FIREBASE_DATABASE_EMULATOR_HOST",Ep={};let $A=!1;function FA(t,e,n,r){const s=e.lastIndexOf(":"),i=e.substring(0,s),o=Wo(i);t.repoInfo_=new cb(e,o,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0,n),r&&(t.authTokenProvider_=r)}function UA(t,e,n,r,s){let i=r||t.options.databaseURL;i===void 0&&(t.options.projectId||ns("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),qt("Using default host for project ",t.options.projectId),i=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o=Rv(i,s),l=o.repoInfo,c;typeof process<"u"&&Jy&&(c=Jy[jA]),c?(i=`http://${c}?ns=${l.namespace}`,o=Rv(i,s),l=o.repoInfo):o.repoInfo.secure;const u=new Vw(t.name,t.options,e);oA("Invalid Firebase Database URL",o),ot(o.path)||ns("Database URL must point to the root of a Firebase Database (not including a child path).");const d=zA(l,t,u,new Gw(t,n));return new HA(d,t)}function BA(t,e){const n=Ep[e];(!n||n[t.key]!==t)&&ns(`Database ${e}(${t.repoInfo_}) has already been deleted.`),SA(t),delete n[t.key]}function zA(t,e,n,r){let s=Ep[e.name];s||(s={},Ep[e.name]=s);let i=s[t.toURLString()];return i&&ns("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new dA(t,$A,n,r),s[t.toURLString()]=i,i}class HA{constructor(e,n){this._repoInternal=e,this.app=n,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(fA(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Lr(this._repo,ht())),this._rootInternal}_delete(){return this._rootInternal!==null&&(BA(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&ns("Cannot call "+e+" on a deleted database.")}}function WA(t=G1(),e){const n=$g(t,"database").getImmediate({identifier:e});if(!n._instanceStarted){const r=eC("database");r&&GA(n,...r)}return n}function GA(t,e,n,r={}){t=yn(t),t._checkNotDeleted("useEmulator");const s=`${e}:${n}`,i=t._repoInternal;if(t._instanceStarted){if(s===t._repoInternal.repoInfo_.host&&Si(r,i.repoInfo_.emulatorOptions))return;ns("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&ns('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new Yc(Yc.OWNER);else if(r.mockUserToken){const l=typeof r.mockUserToken=="string"?r.mockUserToken:tC(r.mockUserToken,t.app.options.projectId);o=new Yc(l)}Wo(e)&&($1(e),F1("Database",!0)),FA(i,s,r,o)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VA(t){Rw(Vo),Lo(new Ii("database",(e,{instanceIdentifier:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return UA(r,s,i,n)},"PUBLIC").setMultipleInstances(!0)),Fs(qy,Zy,t),Fs(qy,Zy,"esm2020")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YA{constructor(e,n){this.committed=e,this.snapshot=n}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function KA(t,e,n){if(t=yn(t),ws("Reference.transaction",t._path),t.key===".length"||t.key===".keys")throw"Reference.transaction failed: "+t.key+" is a read-only object.";const r=!0,s=new ur,i=(l,c,u)=>{let d=null;l?s.reject(l):(d=new Fo(u,new Lr(t._repo,t._path),Ot),s.resolve(new YA(c,d)))},o=sE(t,()=>{});return IA(t._repo,t._path,e,i,o,r),s.promise}Qr.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};Qr.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};VA();function iE(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const XA=iE,oE=new Al("auth","Firebase",iE());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xu=new Ng("@firebase/auth");function QA(t,...e){Xu.logLevel<=bt.WARN&&Xu.warn(`Auth (${Vo}): ${t}`,...e)}function Kc(t,...e){Xu.logLevel<=bt.ERROR&&Xu.error(`Auth (${Vo}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rs(t,...e){throw v0(t,...e)}function Pr(t,...e){return v0(t,...e)}function aE(t,e,n){const r={...XA(),[e]:n};return new Al("auth","Firebase",r).create(e,{appName:t.name})}function zs(t){return aE(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function v0(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return oE.create(t,...e)}function Ye(t,e,...n){if(!t)throw v0(e,...n)}function Vr(t){const e="INTERNAL ASSERTION FAILED: "+t;throw Kc(e),new Error(e)}function ss(t,e){t||Vr(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sp(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.href)||""}function JA(){return Ov()==="http:"||Ov()==="https:"}function Ov(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qA(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(JA()||iC()||"connection"in navigator)?navigator.onLine:!0}function ZA(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jl{constructor(e,n){this.shortDelay=e,this.longDelay=n,ss(n>e,"Short delay should be less than long delay!"),this.isMobile=Mg()||U1()}get(){return qA()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _0(t,e){ss(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lE{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Vr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Vr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Vr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eR={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tR=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],nR=new jl(3e4,6e4);function Nd(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function Jo(t,e,n,r,s={}){return cE(t,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const l=Go({key:t.config.apiKey,...o}).slice(1),c=await t._getAdditionalHeaders();c["Content-Type"]="application/json",t.languageCode&&(c["X-Firebase-Locale"]=t.languageCode);const u={method:e,headers:c,...i};return sC()||(u.referrerPolicy="no-referrer"),t.emulatorConfig&&Wo(t.emulatorConfig.host)&&(u.credentials="include"),lE.fetch()(await dE(t,t.config.apiHost,n,l),u)})}async function cE(t,e,n){t._canInitEmulator=!1;const r={...eR,...e};try{const s=new rR(t),i=await Promise.race([n(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Ac(t,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const l=i.ok?o.errorMessage:o.error.message,[c,u]=l.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw Ac(t,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw Ac(t,"email-already-in-use",o);if(c==="USER_DISABLED")throw Ac(t,"user-disabled",o);const d=r[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw aE(t,d,u);rs(t,d)}}catch(s){if(s instanceof ei)throw s;rs(t,"network-request-failed",{message:String(s)})}}async function uE(t,e,n,r,s={}){const i=await Jo(t,e,n,r,s);return"mfaPendingCredential"in i&&rs(t,"multi-factor-auth-required",{_serverResponse:i}),i}async function dE(t,e,n,r){const s=`${e}${n}?${r}`,i=t,o=i.config.emulator?_0(t.config,s):`${t.config.apiScheme}://${s}`;return tR.includes(n)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(o).toString():o}class rR{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(Pr(this.auth,"network-request-failed")),nR.get())})}}function Ac(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=Pr(t,e,r);return s.customData._tokenResponse=n,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sR(t,e){return Jo(t,"POST","/v1/accounts:delete",e)}async function Qu(t,e){return Jo(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wa(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function iR(t,e=!1){const n=yn(t),r=await n.getIdToken(e),s=x0(r);Ye(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:Wa(ah(s.auth_time)),issuedAtTime:Wa(ah(s.iat)),expirationTime:Wa(ah(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function ah(t){return Number(t)*1e3}function x0(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return Kc("JWT malformed, contained fewer than 3 sections"),null;try{const s=Pu(n);return s?JSON.parse(s):(Kc("Failed to decode base64 JWT payload"),null)}catch(s){return Kc("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function Lv(t){const e=x0(t);return Ye(e,"internal-error"),Ye(typeof e.exp<"u","internal-error"),Ye(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function El(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof ei&&oR(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function oR({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aR{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ip{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Wa(this.lastLoginAt),this.creationTime=Wa(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ju(t){var h;const e=t.auth,n=await t.getIdToken(),r=await El(t,Qu(e,{idToken:n}));Ye(r==null?void 0:r.users.length,e,"internal-error");const s=r.users[0];t._notifyReloadListener(s);const i=(h=s.providerUserInfo)!=null&&h.length?fE(s.providerUserInfo):[],o=cR(t.providerData,i),l=t.isAnonymous,c=!(t.email&&s.passwordHash)&&!(o!=null&&o.length),u=l?c:!1,d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new Ip(s.createdAt,s.lastLoginAt),isAnonymous:u};Object.assign(t,d)}async function lR(t){const e=yn(t);await Ju(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function cR(t,e){return[...t.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function fE(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uR(t,e){const n=await cE(t,{},async()=>{const r=Go({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=t.config,o=await dE(t,s,"/v1/token",`key=${i}`),l=await t._getAdditionalHeaders();l["Content-Type"]="application/x-www-form-urlencoded";const c={method:"POST",headers:l,body:r};return t.emulatorConfig&&Wo(t.emulatorConfig.host)&&(c.credentials="include"),lE.fetch()(o,c)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function dR(t,e){return Jo(t,"POST","/v2/accounts:revokeToken",Nd(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xo{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ye(e.idToken,"internal-error"),Ye(typeof e.idToken<"u","internal-error"),Ye(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Lv(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){Ye(e.length!==0,"internal-error");const n=Lv(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(Ye(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:s,expiresIn:i}=await uR(e,n);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:s,expirationTime:i}=n,o=new xo;return r&&(Ye(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(Ye(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(Ye(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new xo,this.toJSON())}_performRefresh(){return Vr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gs(t,e){Ye(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class pr{constructor({uid:e,auth:n,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new aR(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Ip(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const n=await El(this,this.stsTokenManager.getToken(this.auth,e));return Ye(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return iR(this,e)}reload(){return lR(this)}_assign(e){this!==e&&(Ye(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new pr({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){Ye(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await Ju(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(dr(this.auth.app))return Promise.reject(zs(this.auth));const e=await this.getIdToken();return await El(this,sR(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const r=n.displayName??void 0,s=n.email??void 0,i=n.phoneNumber??void 0,o=n.photoURL??void 0,l=n.tenantId??void 0,c=n._redirectEventId??void 0,u=n.createdAt??void 0,d=n.lastLoginAt??void 0,{uid:h,emailVerified:f,isAnonymous:_,providerData:R,stsTokenManager:k}=n;Ye(h&&k,e,"internal-error");const B=xo.fromJSON(this.name,k);Ye(typeof h=="string",e,"internal-error"),gs(r,e.name),gs(s,e.name),Ye(typeof f=="boolean",e,"internal-error"),Ye(typeof _=="boolean",e,"internal-error"),gs(i,e.name),gs(o,e.name),gs(l,e.name),gs(c,e.name),gs(u,e.name),gs(d,e.name);const x=new pr({uid:h,auth:e,email:s,emailVerified:f,displayName:r,isAnonymous:_,photoURL:o,phoneNumber:i,tenantId:l,stsTokenManager:B,createdAt:u,lastLoginAt:d});return R&&Array.isArray(R)&&(x.providerData=R.map(E=>({...E}))),c&&(x._redirectEventId=c),x}static async _fromIdTokenResponse(e,n,r=!1){const s=new xo;s.updateFromServerResponse(n);const i=new pr({uid:n.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Ju(i),i}static async _fromGetAccountInfoResponse(e,n,r){const s=n.users[0];Ye(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?fE(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),l=new xo;l.updateFromIdToken(r);const c=new pr({uid:s.localId,auth:e,stsTokenManager:l,isAnonymous:o}),u={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Ip(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(c,u),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dv=new Map;function Yr(t){ss(t instanceof Function,"Expected a class definition");let e=Dv.get(t);return e?(ss(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,Dv.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hE{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}hE.type="NONE";const Mv=hE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xc(t,e,n){return`firebase:${t}:${e}:${n}`}class bo{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=Xc(this.userKey,s.apiKey,i),this.fullPersistenceKey=Xc("persistence",s.apiKey,i),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await Qu(this.auth,{idToken:e}).catch(()=>{});return n?pr._fromGetAccountInfoResponse(this.auth,n,e):null}return pr._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new bo(Yr(Mv),e,r);const s=(await Promise.all(n.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let i=s[0]||Yr(Mv);const o=Xc(r,e.config.apiKey,e.name);let l=null;for(const u of n)try{const d=await u._get(o);if(d){let h;if(typeof d=="string"){const f=await Qu(e,{idToken:d}).catch(()=>{});if(!f)break;h=await pr._fromGetAccountInfoResponse(e,f,d)}else h=pr._fromJSON(e,d);u!==i&&(l=h),i=u;break}}catch{}const c=s.filter(u=>u._shouldAllowMigration);return!i._shouldAllowMigration||!c.length?new bo(i,e,r):(i=c[0],l&&await i._set(o,l.toJSON()),await Promise.all(n.map(async u=>{if(u!==i)try{await u._remove(o)}catch{}})),new bo(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nv(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(yE(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(pE(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(_E(e))return"Blackberry";if(xE(e))return"Webos";if(gE(e))return"Safari";if((e.includes("chrome/")||mE(e))&&!e.includes("edge/"))return"Chrome";if(vE(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function pE(t=Cn()){return/firefox\//i.test(t)}function gE(t=Cn()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function mE(t=Cn()){return/crios\//i.test(t)}function yE(t=Cn()){return/iemobile/i.test(t)}function vE(t=Cn()){return/android/i.test(t)}function _E(t=Cn()){return/blackberry/i.test(t)}function xE(t=Cn()){return/webos/i.test(t)}function b0(t=Cn()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function fR(t=Cn()){var e;return b0(t)&&!!((e=window.navigator)!=null&&e.standalone)}function hR(){return oC()&&document.documentMode===10}function bE(t=Cn()){return b0(t)||vE(t)||xE(t)||_E(t)||/windows phone/i.test(t)||yE(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EE(t,e=[]){let n;switch(t){case"Browser":n=Nv(Cn());break;case"Worker":n=`${Nv(Cn())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${Vo}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pR{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=i=>new Promise((o,l)=>{try{const c=e(i);o(c)}catch(c){l(c)}});r.onAbort=n,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const s of n)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gR(t,e={}){return Jo(t,"GET","/v2/passwordPolicy",Nd(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mR=6;class yR{constructor(e){var r;const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??mR,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((r=e.allowedNonAlphanumericCharacters)==null?void 0:r.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),s&&(n.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vR{constructor(e,n,r,s){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new jv(this),this.idTokenSubscription=new jv(this),this.beforeStateQueue=new pR(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=oE,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=Yr(n)),this._initializationPromise=this.queue(async()=>{var r,s,i;if(!this._deleted&&(this.persistenceManager=await bo.create(this,e),(r=this._resolvePersistenceManagerAvailable)==null||r.call(this),!this._deleted)){if((s=this._popupRedirectResolver)!=null&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((i=this.currentUser)==null?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await Qu(this,{idToken:e}),r=await pr._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(dr(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(l,l))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(i=this.redirectUser)==null?void 0:i._redirectEventId,l=r==null?void 0:r._redirectEventId,c=await this.tryRedirectSignIn(e);(!o||o===l)&&(c!=null&&c.user)&&(r=c.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Ye(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await Ju(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=ZA()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(dr(this.app))return Promise.reject(zs(this));const n=e?yn(e):null;return n&&Ye(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&Ye(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return dr(this.app)?Promise.reject(zs(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return dr(this.app)?Promise.reject(zs(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Yr(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await gR(this),n=new yR(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Al("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await dR(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&Yr(e)||this._popupRedirectResolver;Ye(n,this,"argument-error"),this.redirectPersistenceManager=await bo.create(this,[Yr(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)==null?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)==null?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((n=this.currentUser)==null?void 0:n.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,s){if(this._deleted)return()=>{};const i=typeof n=="function"?n:n.next.bind(n);let o=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ye(l,this,"internal-error"),l.then(()=>{o||i(this.currentUser)}),typeof n=="function"){const c=e.addObserver(n,r,s);return()=>{o=!0,c()}}else{const c=e.addObserver(n);return()=>{o=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ye(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=EE(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var s;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await((s=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getHeartbeatsHeader());n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var n;if(dr(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((n=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:n.getToken());return e!=null&&e.error&&QA(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function jd(t){return yn(t)}class jv{constructor(e){this.auth=e,this.observer=null,this.addObserver=mC(n=>this.observer=n)}get next(){return Ye(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let E0={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function _R(t){E0=t}function xR(t){return E0.loadJS(t)}function bR(){return E0.gapiScript}function ER(t){return`__${t}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SR(t,e){const n=$g(t,"auth");if(n.isInitialized()){const s=n.getImmediate(),i=n.getOptions();if(Si(i,e??{}))return s;rs(s,"already-initialized")}return n.initialize({options:e})}function IR(t,e){const n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(Yr);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function TR(t,e,n){const r=jd(t);Ye(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,i=SE(e),{host:o,port:l}=CR(e),c=l===null?"":`:${l}`,u={url:`${i}//${o}${c}/`},d=Object.freeze({host:o,port:l,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){Ye(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),Ye(Si(u,r.config.emulator)&&Si(d,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=u,r.emulatorConfig=d,r.settings.appVerificationDisabledForTesting=!0,Wo(o)?($1(`${i}//${o}${c}`),F1("Auth",!0)):wR()}function SE(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function CR(t){const e=SE(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:$v(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:$v(o)}}}function $v(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function wR(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IE{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return Vr("not implemented")}_getIdTokenResponse(e){return Vr("not implemented")}_linkToIdToken(e,n){return Vr("not implemented")}_getReauthenticationResolver(e){return Vr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Eo(t,e){return uE(t,"POST","/v1/accounts:signInWithIdp",Nd(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kR="http://localhost";class ki extends IE{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new ki(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):rs("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=n;if(!r||!s)return null;const o=new ki(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const n=this.buildRequest();return Eo(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,Eo(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,Eo(e,n)}buildRequest(){const e={requestUri:kR,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=Go(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TE{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $l extends TE{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xs extends $l{constructor(){super("facebook.com")}static credential(e){return ki._fromParams({providerId:xs.PROVIDER_ID,signInMethod:xs.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return xs.credentialFromTaggedObject(e)}static credentialFromError(e){return xs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return xs.credential(e.oauthAccessToken)}catch{return null}}}xs.FACEBOOK_SIGN_IN_METHOD="facebook.com";xs.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bs extends $l{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return ki._fromParams({providerId:bs.PROVIDER_ID,signInMethod:bs.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return bs.credentialFromTaggedObject(e)}static credentialFromError(e){return bs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return bs.credential(n,r)}catch{return null}}}bs.GOOGLE_SIGN_IN_METHOD="google.com";bs.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Es extends $l{constructor(){super("github.com")}static credential(e){return ki._fromParams({providerId:Es.PROVIDER_ID,signInMethod:Es.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Es.credentialFromTaggedObject(e)}static credentialFromError(e){return Es.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Es.credential(e.oauthAccessToken)}catch{return null}}}Es.GITHUB_SIGN_IN_METHOD="github.com";Es.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ss extends $l{constructor(){super("twitter.com")}static credential(e,n){return ki._fromParams({providerId:Ss.PROVIDER_ID,signInMethod:Ss.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return Ss.credentialFromTaggedObject(e)}static credentialFromError(e){return Ss.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return Ss.credential(n,r)}catch{return null}}}Ss.TWITTER_SIGN_IN_METHOD="twitter.com";Ss.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function AR(t,e){return uE(t,"POST","/v1/accounts:signUp",Nd(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qs{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,s=!1){const i=await pr._fromIdTokenResponse(e,r,s),o=Fv(r);return new Qs({user:i,providerId:o,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const s=Fv(r);return new Qs({user:e,providerId:s,_tokenResponse:r,operationType:n})}}function Fv(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function RR(t){var s;if(dr(t.app))return Promise.reject(zs(t));const e=jd(t);if(await e._initializationPromise,(s=e.currentUser)!=null&&s.isAnonymous)return new Qs({user:e.currentUser,providerId:null,operationType:"signIn"});const n=await AR(e,{returnSecureToken:!0}),r=await Qs._fromIdTokenResponse(e,"signIn",n,!0);return await e._updateCurrentUser(r.user),r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qu extends ei{constructor(e,n,r,s){super(n.code,n.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,qu.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,s){return new qu(e,n,r,s)}}function CE(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?qu._fromErrorAndOperation(t,i,e,r):i})}async function PR(t,e,n=!1){const r=await El(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Qs._forOperation(t,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function OR(t,e,n=!1){const{auth:r}=t;if(dr(r.app))return Promise.reject(zs(r));const s="reauthenticate";try{const i=await El(t,CE(r,s,e,t),n);Ye(i.idToken,r,"internal-error");const o=x0(i.idToken);Ye(o,r,"internal-error");const{sub:l}=o;return Ye(t.uid===l,r,"user-mismatch"),Qs._forOperation(t,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&rs(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function LR(t,e,n=!1){if(dr(t.app))return Promise.reject(zs(t));const r="signIn",s=await CE(t,r,e),i=await Qs._fromIdTokenResponse(t,r,s);return n||await t._updateCurrentUser(i.user),i}function DR(t,e,n,r){return yn(t).onIdTokenChanged(e,n,r)}function MR(t,e,n){return yn(t).beforeAuthStateChanged(e,n)}function NR(t,e,n,r){return yn(t).onAuthStateChanged(e,n,r)}const Zu="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wE{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(Zu,"1"),this.storage.removeItem(Zu),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jR=1e3,$R=10;class kE extends wE{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=bE(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),s=this.localCache[n];r!==s&&e(n,s,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((o,l,c)=>{this.notifyListeners(o,c)});return}const r=e.key;n?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!n&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);hR()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,$R):s()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},jR)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}kE.type="LOCAL";const FR=kE;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AE extends wE{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}AE.type="SESSION";const RE=AE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UR(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $d{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(s=>s.isListeningto(e));if(n)return n;const r=new $d(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:s,data:i}=n.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const l=Array.from(o).map(async u=>u(n.origin,i)),c=await UR(l);n.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:c})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}$d.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S0(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BR{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((l,c)=>{const u=S0("",20);s.port1.start();const d=setTimeout(()=>{c(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(h){const f=h;if(f.data.eventId===u)switch(f.data.status){case"ack":clearTimeout(d),i=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),l(f.data.response);break;default:clearTimeout(d),clearTimeout(i),c(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:n},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Or(){return window}function zR(t){Or().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PE(){return typeof Or().WorkerGlobalScope<"u"&&typeof Or().importScripts=="function"}async function HR(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function WR(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)==null?void 0:t.controller)||null}function GR(){return PE()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OE="firebaseLocalStorageDb",VR=1,ed="firebaseLocalStorage",LE="fbase_key";class Fl{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function Fd(t,e){return t.transaction([ed],e?"readwrite":"readonly").objectStore(ed)}function YR(){const t=indexedDB.deleteDatabase(OE);return new Fl(t).toPromise()}function Tp(){const t=indexedDB.open(OE,VR);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(ed,{keyPath:LE})}catch(s){n(s)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(ed)?e(r):(r.close(),await YR(),e(await Tp()))})})}async function Uv(t,e,n){const r=Fd(t,!0).put({[LE]:e,value:n});return new Fl(r).toPromise()}async function KR(t,e){const n=Fd(t,!1).get(e),r=await new Fl(n).toPromise();return r===void 0?null:r.value}function Bv(t,e){const n=Fd(t,!0).delete(e);return new Fl(n).toPromise()}const XR=800,QR=3;class DE{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Tp(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>QR)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return PE()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=$d._getInstance(GR()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var n,r;if(this.activeServiceWorker=await HR(),!this.activeServiceWorker)return;this.sender=new BR(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(n=e[0])!=null&&n.fulfilled&&(r=e[0])!=null&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||WR()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Tp();return await Uv(e,Zu,"1"),await Bv(e,Zu),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>Uv(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>KR(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>Bv(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Fd(s,!1).getAll();return new Fl(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),n.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),n.push(s));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),XR)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}DE.type="LOCAL";const JR=DE;new jl(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qR(t,e){return e?Yr(e):(Ye(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I0 extends IE{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Eo(e,this._buildIdpRequest())}_linkToIdToken(e,n){return Eo(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return Eo(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function ZR(t){return LR(t.auth,new I0(t),t.bypassAuthState)}function eP(t){const{auth:e,user:n}=t;return Ye(n,e,"internal-error"),OR(n,new I0(t),t.bypassAuthState)}async function tP(t){const{auth:e,user:n}=t;return Ye(n,e,"internal-error"),PR(n,new I0(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ME{constructor(e,n,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:s,tenantId:i,error:o,type:l}=e;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:n,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(c))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return ZR;case"linkViaPopup":case"linkViaRedirect":return tP;case"reauthViaPopup":case"reauthViaRedirect":return eP;default:rs(this.auth,"internal-error")}}resolve(e){ss(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){ss(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nP=new jl(2e3,1e4);class uo extends ME{constructor(e,n,r,s,i){super(e,n,s,i),this.provider=r,this.authWindow=null,this.pollId=null,uo.currentPopupAction&&uo.currentPopupAction.cancel(),uo.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ye(e,this.auth,"internal-error"),e}async onExecution(){ss(this.filter.length===1,"Popup operations only handle one event");const e=S0();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Pr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(Pr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,uo.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if((r=(n=this.authWindow)==null?void 0:n.window)!=null&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Pr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,nP.get())};e()}}uo.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rP="pendingRedirect",Qc=new Map;class sP extends ME{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=Qc.get(this.auth._key());if(!e){try{const r=await iP(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}Qc.set(this.auth._key(),e)}return this.bypassAuthState||Qc.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function iP(t,e){const n=lP(e),r=aP(t);if(!await r._isAvailable())return!1;const s=await r._get(n)==="true";return await r._remove(n),s}function oP(t,e){Qc.set(t._key(),e)}function aP(t){return Yr(t._redirectPersistence)}function lP(t){return Xc(rP,t.config.apiKey,t.name)}async function cP(t,e,n=!1){if(dr(t.app))return Promise.reject(zs(t));const r=jd(t),s=qR(r,e),o=await new sP(r,s,n).execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uP=10*60*1e3;class dP{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!fP(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!NE(e)){const s=((r=e.error.code)==null?void 0:r.split("auth/")[1])||"internal-error";n.onError(Pr(this.auth,s))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=uP&&this.cachedEventUids.clear(),this.cachedEventUids.has(zv(e))}saveEventToCache(e){this.cachedEventUids.add(zv(e)),this.lastProcessedEventTime=Date.now()}}function zv(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function NE({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function fP(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return NE(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hP(t,e={}){return Jo(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pP=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,gP=/^https?/;async function mP(t){if(t.config.emulator)return;const{authorizedDomains:e}=await hP(t);for(const n of e)try{if(yP(n))return}catch{}rs(t,"unauthorized-domain")}function yP(t){const e=Sp(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const o=new URL(t);return o.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&o.hostname===r}if(!gP.test(n))return!1;if(pP.test(t))return r===t;const s=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vP=new jl(3e4,6e4);function Hv(){const t=Or().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function _P(t){return new Promise((e,n)=>{var s,i,o;function r(){Hv(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Hv(),n(Pr(t,"network-request-failed"))},timeout:vP.get()})}if((i=(s=Or().gapi)==null?void 0:s.iframes)!=null&&i.Iframe)e(gapi.iframes.getContext());else if((o=Or().gapi)!=null&&o.load)r();else{const l=ER("iframefcb");return Or()[l]=()=>{gapi.load?r():n(Pr(t,"network-request-failed"))},xR(`${bR()}?onload=${l}`).catch(c=>n(c))}}).catch(e=>{throw Jc=null,e})}let Jc=null;function xP(t){return Jc=Jc||_P(t),Jc}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bP=new jl(5e3,15e3),EP="__/auth/iframe",SP="emulator/auth/iframe",IP={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},TP=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function CP(t){const e=t.config;Ye(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?_0(e,SP):`https://${t.config.authDomain}/${EP}`,r={apiKey:e.apiKey,appName:t.name,v:Vo},s=TP.get(t.config.apiHost);s&&(r.eid=s);const i=t._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${Go(r).slice(1)}`}async function wP(t){const e=await xP(t),n=Or().gapi;return Ye(n,t,"internal-error"),e.open({where:document.body,url:CP(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:IP,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=Pr(t,"network-request-failed"),l=Or().setTimeout(()=>{i(o)},bP.get());function c(){Or().clearTimeout(l),s(r)}r.ping(c).then(c,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kP={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},AP=500,RP=600,PP="_blank",OP="http://localhost";class Wv{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function LP(t,e,n,r=AP,s=RP){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const c={...kP,width:r.toString(),height:s.toString(),top:i,left:o},u=Cn().toLowerCase();n&&(l=mE(u)?PP:n),pE(u)&&(e=e||OP,c.scrollbars="yes");const d=Object.entries(c).reduce((f,[_,R])=>`${f}${_}=${R},`,"");if(fR(u)&&l!=="_self")return DP(e||"",l),new Wv(null);const h=window.open(e||"",l,d);Ye(h,t,"popup-blocked");try{h.focus()}catch{}return new Wv(h)}function DP(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MP="__/auth/handler",NP="emulator/auth/handler",jP=encodeURIComponent("fac");async function Gv(t,e,n,r,s,i){Ye(t.config.authDomain,t,"auth-domain-config-required"),Ye(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:Vo,eventId:s};if(e instanceof TE){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",Ou(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[d,h]of Object.entries({}))o[d]=h}if(e instanceof $l){const d=e.getScopes().filter(h=>h!=="");d.length>0&&(o.scopes=d.join(","))}t.tenantId&&(o.tid=t.tenantId);const l=o;for(const d of Object.keys(l))l[d]===void 0&&delete l[d];const c=await t._getAppCheckToken(),u=c?`#${jP}=${encodeURIComponent(c)}`:"";return`${$P(t)}?${Go(l).slice(1)}${u}`}function $P({config:t}){return t.emulator?_0(t,NP):`https://${t.authDomain}/${MP}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lh="webStorageSupport";class FP{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=RE,this._completeRedirectFn=cP,this._overrideRedirectResult=oP}async _openPopup(e,n,r,s){var o;ss((o=this.eventManagers[e._key()])==null?void 0:o.manager,"_initialize() not called before _openPopup()");const i=await Gv(e,n,r,Sp(),s);return LP(e,i,S0())}async _openRedirect(e,n,r,s){await this._originValidation(e);const i=await Gv(e,n,r,Sp(),s);return zR(i),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:s,promise:i}=this.eventManagers[n];return s?Promise.resolve(s):(ss(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await wP(e),r=new dP(e);return n.register("authEvent",s=>(Ye(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(lh,{type:lh},s=>{var o;const i=(o=s==null?void 0:s[0])==null?void 0:o[lh];i!==void 0&&n(!!i),rs(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=mP(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return bE()||gE()||b0()}}const UP=FP;var Vv="@firebase/auth",Yv="1.12.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BP{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){Ye(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zP(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function HP(t){Lo(new Ii("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:l}=r.options;Ye(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:o,authDomain:l,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:EE(t)},u=new vR(r,s,i,c);return IR(u,n),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),Lo(new Ii("auth-internal",e=>{const n=jd(e.getProvider("auth").getImmediate());return(r=>new BP(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Fs(Vv,Yv,zP(t)),Fs(Vv,Yv,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WP=5*60,GP=j1("authIdTokenMaxAge")||WP;let Kv=null;const VP=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>GP)return;const s=n==null?void 0:n.token;Kv!==s&&(Kv=s,await fetch(t,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function YP(t=G1()){const e=$g(t,"auth");if(e.isInitialized())return e.getImmediate();const n=SR(t,{popupRedirectResolver:UP,persistence:[JR,FR,RE]}),r=j1("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=VP(i.toString());MR(n,o,()=>o(n.currentUser)),DR(n,l=>o(l))}}const s=M1("auth");return s&&TR(n,`http://${s}`),n}function KP(){var t;return((t=document.getElementsByTagName("head"))==null?void 0:t[0])??document}_R({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=s=>{const i=Pr("internal-error");i.customData=s,n(i)},r.type="text/javascript",r.charset="UTF-8",KP().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});HP("Browser");const XP={apiKey:"AIzaSyCqXssa5oOaWY3CiN7ti53Qt1F_AGpBrVE",authDomain:"tenfubu-verse.firebaseapp.com",databaseURL:"https://tenfubu-verse-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"tenfubu-verse",storageBucket:"tenfubu-verse.firebasestorage.app",messagingSenderId:"1047996014362",appId:"1:1047996014362:web:729f6b715d929087e296a3"},jE=W1(XP),Kr=WA(jE),$E=YP(jE),T0=[{rank:"BRONZE",min:0,max:2e3,lossPoints:0},{rank:"SILVER",min:2001,max:4e3,lossPoints:20},{rank:"GOLD",min:4001,max:6e3,lossPoints:40},{rank:"PLATINUM",min:6001,max:8e3,lossPoints:60},{rank:"DIAMOND",min:8001,max:1e4,lossPoints:80},{rank:"MASTER",min:10001,max:1/0,lossPoints:100}],So={BRONZE:"",SILVER:"",GOLD:"",PLATINUM:"",DIAMOND:"",MASTER:""},kr=t=>{for(const e of T0)if(t>=e.min&&t<=e.max)return e.rank;return"BRONZE"},Ga=t=>T0.findIndex(e=>e.rank===t),FE=()=>({rating:0,winStreak:0,totalMatches:0,wins:0,losses:0}),Rc=200,Xv=100,QP=10,JP=20,qP=(t,e,n)=>{const r=kr(t),s=kr(n),i=Ga(r),o=Ga(s),l=e+1,c=Math.min((l-1)*QP,Xv),u=Math.max(0,o-i),d=Math.min(u*JP,Xv),h=100+c+d,f=Math.floor(Rc*h/100),_=t+f,R=kr(_),k=Ga(R);return{newRating:_,ratingChange:f,newWinStreak:l,newRank:R,oldRank:r,isRankUp:k>i,isRankDown:!1,bonusBreakdown:{base:Rc,winStreakBonus:Math.floor(Rc*c/100),rankDiffBonus:Math.floor(Rc*d/100),total:f}}},ZP=t=>{const e=kr(t),r=-T0.find(c=>c.rank===e).lossPoints,s=Math.max(0,t+r),i=kr(s),o=Ga(e),l=Ga(i);return{newRating:s,ratingChange:r,newWinStreak:0,newRank:i,oldRank:e,isRankUp:!1,isRankDown:l<o,bonusBreakdown:{base:r,winStreakBonus:0,rankDiffBonus:0,total:r}}},Qv=async(t,e)=>{const n=Gr(Kr,`players/${t}`),r=await Dd(n);if(r.exists()){const i=r.val();return i.playerName!==e&&(await rE(n,{playerName:e}),i.playerName=e),i}const s={playerName:e,createdAt:Date.now(),lastMatchAt:Date.now(),ratings:{}};return await Ld(n,s),s},UE=async(t,e)=>{const n=Gr(Kr,`players/${t}/ratings/${e}`),r=await Dd(n);if(r.exists())return r.val();const s=FE();return await Ld(n,s),s},eO=async t=>{const e=Gr(Kr,`players/${t}/ratings`),n=await Dd(e);return n.exists()?n.val():{}},tO=async(t,e,n,r)=>{const s=Gr(Kr,`players/${t}/ratings/${e}`),i=Gr(Kr,`players/${t}`);await KA(s,o=>{const l=o||FE();return{rating:n.newRating,winStreak:n.newWinStreak,totalMatches:l.totalMatches+1,wins:l.wins+(r?1:0),losses:l.losses+(r?0:1)}}),await rE(i,{lastMatchAt:Date.now()})},C0=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},nO=C0("/leaders/azya_leader.png"),rO=C0("/leaders/senka_leader.png"),sO=C0("/leaders/yoRuka_leader.png"),iO=1280,oO=720,aO={BRONZE:"#cd7f32",SILVER:"#c0c0c0",GOLD:"#ffd700",PLATINUM:"#e5e4e2",DIAMOND:"#b9f2ff",MASTER:"#ff4500"},lO=({onSelectClass:t,onBack:e,gameMode:n="CPU",aiDifficulty:r="NORMAL",onDifficultyChange:s,playerName:i,onPlayerNameChange:o,timerEnabled:l=!0,onTimerEnabledChange:c,playerId:u})=>{const[d,h]=D.useState(1),[f,_]=D.useState({}),[R,k]=D.useState(!1);D.useEffect(()=>{const K=()=>{const ce=window.innerWidth/iO,me=window.innerHeight/oO;h(Math.min(ce,me))};return K(),window.addEventListener("resize",K),()=>window.removeEventListener("resize",K)},[]),D.useEffect(()=>{(async()=>{if(!u){k(!1);return}k(!0);try{const ce=await eO(u);_(ce)}catch(ce){console.error("Failed to fetch class ratings:",ce)}finally{k(!1)}})()},[u]);const B=200*d,x=280*d,E=2*d,T=1.4*d,p=.75*d,$=.65*d,C=1.2*d,re=`${8*d}px ${16*d}px`,Y=K=>{if(n!=="RANKED_MATCH"||!u||R)return null;const ce=f[K];if(!ce)return null;const me=kr(ce.rating),Se=So[me],fe=aO[me];return a.jsxs("div",{style:{marginTop:`${4*d}px`,padding:`${4*d}px ${8*d}px`,background:"rgba(0, 0, 0, 0.3)",borderRadius:4*d,display:"flex",alignItems:"center",gap:`${6*d}px`},children:[a.jsx("span",{style:{fontSize:`${.7*d}rem`,fontWeight:"bold",color:fe,fontFamily:"Tamanegi, sans-serif"},children:Se}),a.jsx("span",{style:{fontSize:`${.75*d}rem`,color:"#fff",fontFamily:"Tamanegi, sans-serif"},children:ce.rating})]})};return a.jsxs("div",{className:"screen",style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"#1a1a2e",color:"white"},children:[a.jsx("h2",{style:{fontSize:`${E}rem`,marginBottom:`${.5*d}rem`,marginTop:0},children:""}),a.jsxs("div",{style:{marginBottom:`${.8*d}rem`,display:"flex",flexDirection:"column",alignItems:"center",gap:`${.3*d}rem`},children:[a.jsx("label",{style:{fontSize:`${.9*d}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif"},children:""}),a.jsx("input",{type:"text",value:i,onChange:K=>o(K.target.value),maxLength:12,placeholder:"",style:{padding:`${6*d}px ${12*d}px`,fontSize:`${.9*d}rem`,background:"#2d3748",border:"2px solid #4a5568",borderRadius:6*d,color:"white",outline:"none",width:180*d,textAlign:"center",fontFamily:"Tamanegi, sans-serif"},onFocus:K=>K.target.style.borderColor="#63b3ed",onBlur:K=>K.target.style.borderColor="#4a5568"})]}),a.jsxs("div",{style:{display:"flex",gap:`${C}rem`,marginBottom:`${1*d}rem`},children:[a.jsxs("div",{onClick:()=>t("SENKA"),style:{width:B,height:x,border:"1px solid #444",borderRadius:10*d,background:"linear-gradient(180deg, #2c0b0e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s",boxShadow:"0 4px 20px rgba(233, 69, 96, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:K=>K.currentTarget.style.transform="scale(1.05)",onMouseOut:K=>K.currentTarget.style.transform="scale(1)",children:[a.jsx("img",{src:rO,alt:"Senka",style:{width:"100%",height:"60%",objectFit:"cover"}}),a.jsxs("div",{style:{padding:`${6*d}px`,display:"flex",flexDirection:"column",alignItems:"center"},children:[a.jsx("h3",{style:{fontSize:`${T}rem`,color:"#e94560",margin:0},children:""}),a.jsx("p",{style:{color:"#aaa",margin:`${3*d}px 0`,fontSize:`${p}rem`,fontFamily:"Tamanegi, sans-serif"},children:" / "}),a.jsxs("p",{style:{padding:`0 ${.5*d}rem`,textAlign:"center",fontSize:`${$}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",lineHeight:1.3},children:["",a.jsx("br",{}),""]}),Y("SENKA")]})]}),a.jsxs("div",{onClick:()=>t("AJA"),style:{width:B,height:x,border:"1px solid #444",borderRadius:10*d,background:"linear-gradient(180deg, #0f1c2e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s",boxShadow:"0 4px 20px rgba(69, 162, 233, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:K=>K.currentTarget.style.transform="scale(1.05)",onMouseOut:K=>K.currentTarget.style.transform="scale(1)",children:[a.jsx("img",{src:nO,alt:"Azya",style:{width:"100%",height:"60%",objectFit:"cover",objectPosition:"center top"}}),a.jsxs("div",{style:{padding:`${6*d}px`,display:"flex",flexDirection:"column",alignItems:"center"},children:[a.jsx("h3",{style:{fontSize:`${T}rem`,color:"#45a2e9",margin:0},children:""}),a.jsx("p",{style:{color:"#aaa",margin:`${3*d}px 0`,fontSize:`${p}rem`,fontFamily:"Tamanegi, sans-serif"},children:" / "}),a.jsxs("p",{style:{padding:`${.5*d}rem`,textAlign:"center",fontSize:`${$}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",lineHeight:1.3},children:["",a.jsx("br",{}),""]}),Y("AJA")]})]}),a.jsxs("div",{onClick:()=>t("YORUKA"),style:{width:B,height:x,border:"1px solid #444",borderRadius:10*d,background:"linear-gradient(180deg, #1a0f2e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s",boxShadow:"0 4px 20px rgba(168, 85, 247, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:K=>K.currentTarget.style.transform="scale(1.05)",onMouseOut:K=>K.currentTarget.style.transform="scale(1)",children:[a.jsx("img",{src:sO,alt:"Yoruka",style:{width:"100%",height:"60%",objectFit:"cover"}}),a.jsxs("div",{style:{padding:`${6*d}px`,display:"flex",flexDirection:"column",alignItems:"center"},children:[a.jsx("h3",{style:{fontSize:`${T}rem`,color:"#a855f7",margin:0},children:"Y"}),a.jsx("p",{style:{color:"#aaa",margin:`${3*d}px 0`,fontSize:`${p}rem`,fontFamily:"Tamanegi, sans-serif"},children:" / "}),a.jsxs("p",{style:{padding:`0 ${.5*d}rem`,textAlign:"center",fontSize:`${$}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",lineHeight:1.3},children:["",a.jsx("br",{}),""]}),Y("YORUKA")]})]})]}),n==="CPU"&&s&&a.jsxs("div",{style:{marginBottom:`${.6*d}rem`,display:"flex",flexDirection:"column",alignItems:"center",gap:`${.3*d}rem`},children:[a.jsx("p",{style:{fontSize:`${.85*d}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",margin:0},children:""}),a.jsx("div",{style:{display:"flex",gap:`${.6*d}rem`},children:["EASY","NORMAL","HARD"].map(K=>a.jsx("button",{onClick:()=>s(K),style:{padding:`${6*d}px ${14*d}px`,fontSize:`${.8*d}rem`,background:r===K?K==="EASY"?"#48bb78":K==="NORMAL"?"#e94560":"#9f7aea":"transparent",border:`2px solid ${K==="EASY"?"#48bb78":K==="NORMAL"?"#e94560":"#9f7aea"}`,color:"#fff",cursor:"pointer",borderRadius:4*d,fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s"},children:K==="EASY"?"":K==="NORMAL"?"":""},K))}),a.jsxs("p",{style:{fontSize:`${.65*d}rem`,opacity:.6,fontFamily:"Tamanegi, sans-serif",margin:0},children:[r==="EASY"&&"CPU",r==="NORMAL"&&"CPU",r==="HARD"&&"CPU"]})]}),c&&a.jsxs("div",{style:{marginBottom:`${.6*d}rem`,display:"flex",flexDirection:"column",alignItems:"center",gap:`${.3*d}rem`},children:[a.jsx("p",{style:{fontSize:`${.85*d}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",margin:0},children:""}),a.jsxs("div",{style:{display:"flex",gap:`${.6*d}rem`},children:[a.jsx("button",{onClick:()=>c(!0),style:{padding:`${6*d}px ${14*d}px`,fontSize:`${.8*d}rem`,background:l?"#3182ce":"transparent",border:"2px solid #3182ce",color:"#fff",cursor:"pointer",borderRadius:4*d,fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s"},children:"ON (60)"}),a.jsx("button",{onClick:()=>c(!1),style:{padding:`${6*d}px ${14*d}px`,fontSize:`${.8*d}rem`,background:l?"transparent":"#718096",border:"2px solid #718096",color:"#fff",cursor:"pointer",borderRadius:4*d,fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s"},children:"OFF"})]}),a.jsx("p",{style:{fontSize:`${.65*d}rem`,opacity:.6,fontFamily:"Tamanegi, sans-serif",margin:0},children:l?"600":""})]}),a.jsx("button",{onClick:e,style:{background:"#333",padding:re,fontSize:`${.9*d}rem`,marginBottom:`${.5*d}rem`},children:""})]})};class cO{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(e){this.flush(),this._parts.push(e)}append(e){this._pieces.push(e)}flush(){if(this._pieces.length>0){const e=new Uint8Array(this._pieces);this._parts.push(e),this._pieces=[]}}toArrayBuffer(){const e=[];for(const n of this._parts)e.push(n);return uO(e).buffer}}function uO(t){let e=0;for(const s of t)e+=s.byteLength;const n=new Uint8Array(e);let r=0;for(const s of t){const i=new Uint8Array(s.buffer,s.byteOffset,s.byteLength);n.set(i,r),r+=s.byteLength}return n}function BE(t){return new dO(t).unpack()}function zE(t){const e=new fO,n=e.pack(t);return n instanceof Promise?n.then(()=>e.getBuffer()):e.getBuffer()}class dO{constructor(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){const e=this.unpack_uint8();if(e<128)return e;if((e^224)<32)return(e^224)-32;let n;if((n=e^160)<=15)return this.unpack_raw(n);if((n=e^176)<=15)return this.unpack_string(n);if((n=e^144)<=15)return this.unpack_array(n);if((n=e^128)<=15)return this.unpack_map(n);switch(e){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return n=this.unpack_uint16(),this.unpack_string(n);case 217:return n=this.unpack_uint32(),this.unpack_string(n);case 218:return n=this.unpack_uint16(),this.unpack_raw(n);case 219:return n=this.unpack_uint32(),this.unpack_raw(n);case 220:return n=this.unpack_uint16(),this.unpack_array(n);case 221:return n=this.unpack_uint32(),this.unpack_array(n);case 222:return n=this.unpack_uint16(),this.unpack_map(n);case 223:return n=this.unpack_uint32(),this.unpack_map(n)}}unpack_uint8(){const e=this.dataView[this.index]&255;return this.index++,e}unpack_uint16(){const e=this.read(2),n=(e[0]&255)*256+(e[1]&255);return this.index+=2,n}unpack_uint32(){const e=this.read(4),n=((e[0]*256+e[1])*256+e[2])*256+e[3];return this.index+=4,n}unpack_uint64(){const e=this.read(8),n=((((((e[0]*256+e[1])*256+e[2])*256+e[3])*256+e[4])*256+e[5])*256+e[6])*256+e[7];return this.index+=8,n}unpack_int8(){const e=this.unpack_uint8();return e<128?e:e-256}unpack_int16(){const e=this.unpack_uint16();return e<32768?e:e-65536}unpack_int32(){const e=this.unpack_uint32();return e<2**31?e:e-2**32}unpack_int64(){const e=this.unpack_uint64();return e<2**63?e:e-2**64}unpack_raw(e){if(this.length<this.index+e)throw new Error(`BinaryPackFailure: index is out of range ${this.index} ${e} ${this.length}`);const n=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,n}unpack_string(e){const n=this.read(e);let r=0,s="",i,o;for(;r<e;)i=n[r],i<160?(o=i,r++):(i^192)<32?(o=(i&31)<<6|n[r+1]&63,r+=2):(i^224)<16?(o=(i&15)<<12|(n[r+1]&63)<<6|n[r+2]&63,r+=3):(o=(i&7)<<18|(n[r+1]&63)<<12|(n[r+2]&63)<<6|n[r+3]&63,r+=4),s+=String.fromCodePoint(o);return this.index+=e,s}unpack_array(e){const n=new Array(e);for(let r=0;r<e;r++)n[r]=this.unpack();return n}unpack_map(e){const n={};for(let r=0;r<e;r++){const s=this.unpack();n[s]=this.unpack()}return n}unpack_float(){const e=this.unpack_uint32(),n=e>>31,r=(e>>23&255)-127,s=e&8388607|8388608;return(n===0?1:-1)*s*2**(r-23)}unpack_double(){const e=this.unpack_uint32(),n=this.unpack_uint32(),r=e>>31,s=(e>>20&2047)-1023,o=(e&1048575|1048576)*2**(s-20)+n*2**(s-52);return(r===0?1:-1)*o}read(e){const n=this.index;if(n+e<=this.length)return this.dataView.subarray(n,n+e);throw new Error("BinaryPackFailure: read index out of range")}}class fO{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(e){if(typeof e=="string")this.pack_string(e);else if(typeof e=="number")Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if(typeof e=="boolean")e===!0?this._bufferBuilder.append(195):e===!1&&this._bufferBuilder.append(194);else if(e===void 0)this._bufferBuilder.append(192);else if(typeof e=="object")if(e===null)this._bufferBuilder.append(192);else{const n=e.constructor;if(e instanceof Array){const r=this.pack_array(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else if(e instanceof ArrayBuffer)this.pack_bin(new Uint8Array(e));else if("BYTES_PER_ELEMENT"in e){const r=e;this.pack_bin(new Uint8Array(r.buffer,r.byteOffset,r.byteLength))}else if(e instanceof Date)this.pack_string(e.toString());else{if(e instanceof Blob)return e.arrayBuffer().then(r=>{this.pack_bin(new Uint8Array(r)),this._bufferBuilder.flush()});if(n==Object||n.toString().startsWith("class")){const r=this.pack_object(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else throw new Error(`Type "${n.toString()}" not yet supported`)}}else throw new Error(`Type "${typeof e}" not yet supported`);this._bufferBuilder.flush()}pack_bin(e){const n=e.length;if(n<=15)this.pack_uint8(160+n);else if(n<=65535)this._bufferBuilder.append(218),this.pack_uint16(n);else if(n<=4294967295)this._bufferBuilder.append(219),this.pack_uint32(n);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(e)}pack_string(e){const n=this._textEncoder.encode(e),r=n.length;if(r<=15)this.pack_uint8(176+r);else if(r<=65535)this._bufferBuilder.append(216),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(217),this.pack_uint32(r);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(n)}pack_array(e){const n=e.length;if(n<=15)this.pack_uint8(144+n);else if(n<=65535)this._bufferBuilder.append(220),this.pack_uint16(n);else if(n<=4294967295)this._bufferBuilder.append(221),this.pack_uint32(n);else throw new Error("Invalid length");const r=s=>{if(s<n){const i=this.pack(e[s]);return i instanceof Promise?i.then(()=>r(s+1)):r(s+1)}};return r(0)}pack_integer(e){if(e>=-32&&e<=127)this._bufferBuilder.append(e&255);else if(e>=0&&e<=255)this._bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&e<=127)this._bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&e<=65535)this._bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&e<=32767)this._bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&e<=4294967295)this._bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-2147483648&&e<=2147483647)this._bufferBuilder.append(210),this.pack_int32(e);else if(e>=-9223372036854776e3&&e<=9223372036854776e3)this._bufferBuilder.append(211),this.pack_int64(e);else if(e>=0&&e<=18446744073709552e3)this._bufferBuilder.append(207),this.pack_uint64(e);else throw new Error("Invalid integer")}pack_double(e){let n=0;e<0&&(n=1,e=-e);const r=Math.floor(Math.log(e)/Math.LN2),s=e/2**r-1,i=Math.floor(s*2**52),o=2**32,l=n<<31|r+1023<<20|i/o&1048575,c=i%o;this._bufferBuilder.append(203),this.pack_int32(l),this.pack_int32(c)}pack_object(e){const n=Object.keys(e),r=n.length;if(r<=15)this.pack_uint8(128+r);else if(r<=65535)this._bufferBuilder.append(222),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(223),this.pack_uint32(r);else throw new Error("Invalid length");const s=i=>{if(i<n.length){const o=n[i];if(e.hasOwnProperty(o)){this.pack(o);const l=this.pack(e[o]);if(l instanceof Promise)return l.then(()=>s(i+1))}return s(i+1)}};return s(0)}pack_uint8(e){this._bufferBuilder.append(e)}pack_uint16(e){this._bufferBuilder.append(e>>8),this._bufferBuilder.append(e&255)}pack_uint32(e){const n=e&4294967295;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255)}pack_uint64(e){const n=e/4294967296,r=e%2**32;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}pack_int8(e){this._bufferBuilder.append(e&255)}pack_int16(e){this._bufferBuilder.append((e&65280)>>8),this._bufferBuilder.append(e&255)}pack_int32(e){this._bufferBuilder.append(e>>>24&255),this._bufferBuilder.append((e&16711680)>>>16),this._bufferBuilder.append((e&65280)>>>8),this._bufferBuilder.append(e&255)}pack_int64(e){const n=Math.floor(e/4294967296),r=e%2**32;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}constructor(){this._bufferBuilder=new cO,this._textEncoder=new TextEncoder}}let HE=!0,WE=!0;function ka(t,e,n){const r=t.match(e);return r&&r.length>=n&&parseFloat(r[n],10)}function Di(t,e,n){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,s=r.addEventListener;r.addEventListener=function(o,l){if(o!==e)return s.apply(this,arguments);const c=u=>{const d=n(u);d&&(l.handleEvent?l.handleEvent(d):l(d))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(l,c),s.apply(this,[o,c])};const i=r.removeEventListener;r.removeEventListener=function(o,l){if(o!==e||!this._eventMap||!this._eventMap[e])return i.apply(this,arguments);if(!this._eventMap[e].has(l))return i.apply(this,arguments);const c=this._eventMap[e].get(l);return this._eventMap[e].delete(l),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,i.apply(this,[o,c])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function hO(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(HE=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function pO(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(WE=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function GE(){if(typeof window=="object"){if(HE)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function w0(t,e){WE&&console.warn(t+" is deprecated, please use "+e+" instead.")}function gO(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const r=n.userAgentData.brands.find(s=>s.brand==="Chromium");if(r)return{browser:"chrome",version:parseInt(r.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(ka(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(ka(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(ka(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=ka(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function Jv(t){return Object.prototype.toString.call(t)==="[object Object]"}function VE(t){return Jv(t)?Object.keys(t).reduce(function(e,n){const r=Jv(t[n]),s=r?VE(t[n]):t[n],i=r&&!Object.keys(s).length;return s===void 0||i?e:Object.assign(e,{[n]:s})},{}):t}function Cp(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?Cp(t,t.get(e[r]),n):r.endsWith("Ids")&&e[r].forEach(s=>{Cp(t,t.get(s),n)})}))}function qv(t,e,n){const r=n?"outbound-rtp":"inbound-rtp",s=new Map;if(e===null)return s;const i=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&i.push(o)}),i.forEach(o=>{t.forEach(l=>{l.type===r&&l.trackId===o.id&&Cp(t,l,s)})}),s}const Zv=GE;function YE(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const r=function(l){if(typeof l!="object"||l.mandatory||l.optional)return l;const c={};return Object.keys(l).forEach(u=>{if(u==="require"||u==="advanced"||u==="mediaSource")return;const d=typeof l[u]=="object"?l[u]:{ideal:l[u]};d.exact!==void 0&&typeof d.exact=="number"&&(d.min=d.max=d.exact);const h=function(f,_){return f?f+_.charAt(0).toUpperCase()+_.slice(1):_==="deviceId"?"sourceId":_};if(d.ideal!==void 0){c.optional=c.optional||[];let f={};typeof d.ideal=="number"?(f[h("min",u)]=d.ideal,c.optional.push(f),f={},f[h("max",u)]=d.ideal,c.optional.push(f)):(f[h("",u)]=d.ideal,c.optional.push(f))}d.exact!==void 0&&typeof d.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[h("",u)]=d.exact):["min","max"].forEach(f=>{d[f]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[h(f,u)]=d[f])})}),l.advanced&&(c.optional=(c.optional||[]).concat(l.advanced)),c},s=function(l,c){if(e.version>=61)return c(l);if(l=JSON.parse(JSON.stringify(l)),l&&typeof l.audio=="object"){const u=function(d,h,f){h in d&&!(f in d)&&(d[f]=d[h],delete d[h])};l=JSON.parse(JSON.stringify(l)),u(l.audio,"autoGainControl","googAutoGainControl"),u(l.audio,"noiseSuppression","googNoiseSuppression"),l.audio=r(l.audio)}if(l&&typeof l.video=="object"){let u=l.video.facingMode;u=u&&(typeof u=="object"?u:{ideal:u});const d=e.version<66;if(u&&(u.exact==="user"||u.exact==="environment"||u.ideal==="user"||u.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!d)){delete l.video.facingMode;let h;if(u.exact==="environment"||u.ideal==="environment"?h=["back","rear"]:(u.exact==="user"||u.ideal==="user")&&(h=["front"]),h)return n.mediaDevices.enumerateDevices().then(f=>{f=f.filter(R=>R.kind==="videoinput");let _=f.find(R=>h.some(k=>R.label.toLowerCase().includes(k)));return!_&&f.length&&h.includes("back")&&(_=f[f.length-1]),_&&(l.video.deviceId=u.exact?{exact:_.deviceId}:{ideal:_.deviceId}),l.video=r(l.video),Zv("chrome: "+JSON.stringify(l)),c(l)})}l.video=r(l.video)}return Zv("chrome: "+JSON.stringify(l)),c(l)},i=function(l){return e.version>=64?l:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[l.name]||l.name,message:l.message,constraint:l.constraint||l.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(l,c,u){s(l,d=>{n.webkitGetUserMedia(d,c,h=>{u&&u(i(h))})})};if(n.getUserMedia=o.bind(n),n.mediaDevices.getUserMedia){const l=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return s(c,u=>l(u).then(d=>{if(u.audio&&!d.getAudioTracks().length||u.video&&!d.getVideoTracks().length)throw d.getTracks().forEach(h=>{h.stop()}),new DOMException("","NotFoundError");return d},d=>Promise.reject(i(d))))}}}function KE(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function XE(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",s=>{let i;t.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(l=>l.track&&l.track.id===s.track.id):i={track:s.track};const o=new Event("track");o.track=s.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[r.stream],this.dispatchEvent(o)}),r.stream.getTracks().forEach(s=>{let i;t.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(l=>l.track&&l.track.id===s.id):i={track:s};const o=new Event("track");o.track=s,o.receiver=i,o.transceiver={receiver:i},o.streams=[r.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Di(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function QE(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(s,i){return{track:i,get dtmf(){return this._dtmf===void 0&&(i.kind==="audio"?this._dtmf=s.createDTMFSender(i):this._dtmf=null),this._dtmf},_pc:s}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const s=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(l,c){let u=s.apply(this,arguments);return u||(u=e(this,l),this._senders.push(u)),u};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(l){i.apply(this,arguments);const c=this._senders.indexOf(l);c!==-1&&this._senders.splice(c,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],n.apply(this,[i]),i.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach(o=>{const l=this._senders.find(c=>c.track===o);l&&this._senders.splice(this._senders.indexOf(l),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function JE(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=n.apply(this,[]);return i.forEach(o=>o._pc=this),i});const r=t.RTCPeerConnection.prototype.addTrack;r&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=r.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){const i=this;return this._pc.getStats().then(o=>qv(o,i.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const s=n.apply(this,[]);return s.forEach(i=>i._pc=this),s}),Di(t,"track",r=>(r.receiver._pc=r.srcElement,r)),t.RTCRtpReceiver.prototype.getStats=function(){const s=this;return this._pc.getStats().then(i=>qv(i,s.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const r=arguments[0];let s,i,o;return this.getSenders().forEach(l=>{l.track===r&&(s?o=!0:s=l)}),this.getReceivers().forEach(l=>(l.track===r&&(i?o=!0:i=l),l.track===r)),o||s&&i?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function qE(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,l){if(!l)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[l.id]?this._shimmedLocalStreams[l.id].indexOf(c)===-1&&this._shimmedLocalStreams[l.id].push(c):this._shimmedLocalStreams[l.id]=[l,c],c};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(u=>{if(this.getSenders().find(h=>h.track===u))throw new DOMException("Track already exists.","InvalidAccessError")});const l=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(u=>l.indexOf(u)===-1);this._shimmedLocalStreams[o.id]=[o].concat(c)};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],r.apply(this,arguments)};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(l=>{const c=this._shimmedLocalStreams[l].indexOf(o);c!==-1&&this._shimmedLocalStreams[l].splice(c,1),this._shimmedLocalStreams[l].length===1&&delete this._shimmedLocalStreams[l]}),s.apply(this,arguments)}}function ZE(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return qE(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const d=n.apply(this);return this._reverseStreams=this._reverseStreams||{},d.map(h=>this._reverseStreams[h.id])};const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(d){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},d.getTracks().forEach(h=>{if(this.getSenders().find(_=>_.track===h))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[d.id]){const h=new t.MediaStream(d.getTracks());this._streams[d.id]=h,this._reverseStreams[h.id]=d,d=h}r.apply(this,[d])};const s=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(d){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[d.id]||d]),delete this._reverseStreams[this._streams[d.id]?this._streams[d.id].id:d.id],delete this._streams[d.id]},t.RTCPeerConnection.prototype.addTrack=function(d,h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const f=[].slice.call(arguments,1);if(f.length!==1||!f[0].getTracks().find(k=>k===d))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(k=>k.track===d))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const R=this._streams[h.id];if(R)R.addTrack(d),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const k=new t.MediaStream([d]);this._streams[h.id]=k,this._reverseStreams[k.id]=h,this.addStream(k)}return this.getSenders().find(k=>k.track===d)};function i(u,d){let h=d.sdp;return Object.keys(u._reverseStreams||[]).forEach(f=>{const _=u._reverseStreams[f],R=u._streams[_.id];h=h.replace(new RegExp(R.id,"g"),_.id)}),new RTCSessionDescription({type:d.type,sdp:h})}function o(u,d){let h=d.sdp;return Object.keys(u._reverseStreams||[]).forEach(f=>{const _=u._reverseStreams[f],R=u._streams[_.id];h=h.replace(new RegExp(_.id,"g"),R.id)}),new RTCSessionDescription({type:d.type,sdp:h})}["createOffer","createAnswer"].forEach(function(u){const d=t.RTCPeerConnection.prototype[u],h={[u](){const f=arguments;return arguments.length&&typeof arguments[0]=="function"?d.apply(this,[R=>{const k=i(this,R);f[0].apply(null,[k])},R=>{f[1]&&f[1].apply(null,R)},arguments[2]]):d.apply(this,arguments).then(R=>i(this,R))}};t.RTCPeerConnection.prototype[u]=h[u]});const l=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?l.apply(this,arguments):(arguments[0]=o(this,arguments[0]),l.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const u=c.get.apply(this);return u.type===""?u:i(this,u)}}),t.RTCPeerConnection.prototype.removeTrack=function(d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!d._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(d._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let f;Object.keys(this._streams).forEach(_=>{this._streams[_].getTracks().find(k=>d.track===k)&&(f=this._streams[_])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(d.track),this.dispatchEvent(new Event("negotiationneeded")))}}function wp(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=t.RTCPeerConnection.prototype[n],s={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=s[n]})}function eS(t,e){Di(t,"negotiationneeded",n=>{const r=n.target;if(!((e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return n})}const e_=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:eS,shimAddTrackRemoveTrack:ZE,shimAddTrackRemoveTrackWithNative:qE,shimGetSendersWithDtmf:QE,shimGetUserMedia:YE,shimMediaStream:KE,shimOnTrack:XE,shimPeerConnection:wp,shimSenderReceiverGetStats:JE},Symbol.toStringTag,{value:"Module"}));function tS(t,e){const n=t&&t.navigator,r=t&&t.MediaStreamTrack;if(n.getUserMedia=function(s,i,o){w0("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(s).then(i,o)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const s=function(o,l,c){l in o&&!(c in o)&&(o[c]=o[l],delete o[l])},i=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),s(o.audio,"autoGainControl","mozAutoGainControl"),s(o.audio,"noiseSuppression","mozNoiseSuppression")),i(o)},r&&r.prototype.getSettings){const o=r.prototype.getSettings;r.prototype.getSettings=function(){const l=o.apply(this,arguments);return s(l,"mozAutoGainControl","autoGainControl"),s(l,"mozNoiseSuppression","noiseSuppression"),l}}if(r&&r.prototype.applyConstraints){const o=r.prototype.applyConstraints;r.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),s(l,"autoGainControl","mozAutoGainControl"),s(l,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[l])}}}}function mO(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,Promise.reject(s)}return r.video===!0?r.video={mediaSource:e}:r.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(r)})}function nS(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function kp(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const i=t.RTCPeerConnection.prototype[s],o={[s](){return arguments[0]=new(s==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[s]=o[s]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[i,o,l]=arguments;return r.apply(this,[i||null]).then(c=>{if(e.version<53&&!o)try{c.forEach(u=>{u.type=n[u.type]||u.type})}catch(u){if(u.name!=="TypeError")throw u;c.forEach((d,h)=>{c.set(h,Object.assign({},d,{type:n[d.type]||d.type}))})}return c}).then(o,l)}}function rS(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=e.apply(this,[]);return s.forEach(i=>i._pc=this),s});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=n.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function sS(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r}),Di(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function iS(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){w0("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&n.getTracks().includes(r.track)&&this.removeTrack(r)})})}function oS(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function aS(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const s=r.length>0;s&&r.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=e.apply(this,arguments);if(s){const{sender:o}=i,l=o.getParameters();(!("encodings"in l)||l.encodings.length===1&&Object.keys(l.encodings[0]).length===0)&&(l.encodings=r,o.sendEncodings=r,this.setParametersPromises.push(o.setParameters(l).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return i})}function lS(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const r=e.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function cS(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function uS(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}const t_=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:aS,shimCreateAnswer:uS,shimCreateOffer:cS,shimGetDisplayMedia:mO,shimGetParameters:lS,shimGetUserMedia:tS,shimOnTrack:nS,shimPeerConnection:kp,shimRTCDataChannel:oS,shimReceiverGetStats:sS,shimRemoveStream:iS,shimSenderGetStats:rS},Symbol.toStringTag,{value:"Module"}));function dS(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(s=>e.call(this,s,r)),r.getVideoTracks().forEach(s=>e.call(this,s,r))},t.RTCPeerConnection.prototype.addTrack=function(r,...s){return s&&s.forEach(i=>{this._localStreams?this._localStreams.includes(i)||this._localStreams.push(i):this._localStreams=[i]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(n);if(r===-1)return;this._localStreams.splice(r,1);const s=n.getTracks();this.getSenders().forEach(i=>{s.includes(i.track)&&this.removeTrack(i)})})}}function fS(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(s=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(s))return;this._remoteStreams.push(s);const i=new Event("addstream");i.stream=s,this.dispatchEvent(i)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){s.streams.forEach(i=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(i)>=0)return;r._remoteStreams.push(i);const o=new Event("addstream");o.stream=i,r.dispatchEvent(o)})}),e.apply(r,arguments)}}}function hS(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,r=e.createAnswer,s=e.setLocalDescription,i=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(u,d){const h=arguments.length>=2?arguments[2]:arguments[0],f=n.apply(this,[h]);return d?(f.then(u,d),Promise.resolve()):f},e.createAnswer=function(u,d){const h=arguments.length>=2?arguments[2]:arguments[0],f=r.apply(this,[h]);return d?(f.then(u,d),Promise.resolve()):f};let l=function(c,u,d){const h=s.apply(this,[c]);return d?(h.then(u,d),Promise.resolve()):h};e.setLocalDescription=l,l=function(c,u,d){const h=i.apply(this,[c]);return d?(h.then(u,d),Promise.resolve()):h},e.setRemoteDescription=l,l=function(c,u,d){const h=o.apply(this,[c]);return d?(h.then(u,d),Promise.resolve()):h},e.addIceCandidate=l}function pS(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,r=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=s=>r(gS(s))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(r,s,i){e.mediaDevices.getUserMedia(r).then(s,i)}).bind(e))}function gS(t){return t&&t.video!==void 0?Object.assign({},t,{video:VE(t.video)}):t}function mS(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(r,s){if(r&&r.iceServers){const i=[];for(let o=0;o<r.iceServers.length;o++){let l=r.iceServers[o];l.urls===void 0&&l.url?(w0("RTCIceServer.url","RTCIceServer.urls"),l=JSON.parse(JSON.stringify(l)),l.urls=l.url,delete l.url,i.push(l)):i.push(r.iceServers[o])}r.iceServers=i}return new e(r,s)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function yS(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function vS(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):r.offerToReceiveAudio===!0&&!s&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const i=this.getTransceivers().find(o=>o.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveVideo===!0&&!i&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function _S(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}const n_=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:_S,shimCallbacksAPI:hS,shimConstraints:gS,shimCreateOfferLegacy:vS,shimGetUserMedia:pS,shimLocalStreamsAPI:dS,shimRTCIceServerUrls:mS,shimRemoteStreamsAPI:fS,shimTrackEventTransceiver:yS},Symbol.toStringTag,{value:"Module"}));var xS={exports:{}};(function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},e.splitSections=function(n){return n.split(`
m=`).map((s,i)=>(i>0?"m="+s:s).trim()+`\r
`)},e.getDescription=function(n){const r=e.splitSections(n);return r&&r[0]},e.getMediaSections=function(n){const r=e.splitSections(n);return r.shift(),r},e.matchPrefix=function(n,r){return e.splitLines(n).filter(s=>s.indexOf(r)===0)},e.parseCandidate=function(n){let r;n.indexOf("a=candidate:")===0?r=n.substring(12).split(" "):r=n.substring(10).split(" ");const s={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let i=8;i<r.length;i+=2)switch(r[i]){case"raddr":s.relatedAddress=r[i+1];break;case"rport":s.relatedPort=parseInt(r[i+1],10);break;case"tcptype":s.tcpType=r[i+1];break;case"ufrag":s.ufrag=r[i+1],s.usernameFragment=r[i+1];break;default:s[r[i]]===void 0&&(s[r[i]]=r[i+1]);break}return s},e.writeCandidate=function(n){const r=[];r.push(n.foundation);const s=n.component;s==="rtp"?r.push(1):s==="rtcp"?r.push(2):r.push(s),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const i=n.type;return r.push("typ"),r.push(i),i!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let r=n.substring(9).split(" ");const s={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),s.name=r[0],s.clockRate=parseInt(r[1],10),s.channels=r.length===3?parseInt(r[2],10):1,s.numChannels=s.channels,s},e.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const s=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(s!==1?"/"+s:"")+`\r
`},e.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const r={};let s;const i=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<i.length;o++)s=i[o].trim().split("="),r[s[0].trim()]=s[1];return r},e.writeFmtp=function(n){let r="",s=n.payloadType;if(n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const i=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?i.push(o+"="+n.parameters[o]):i.push(o)}),r+="a=fmtp:"+s+" "+i.join(";")+`\r
`}return r},e.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},e.writeRtcpFb=function(n){let r="",s=n.payloadType;return n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(i=>{r+="a=rtcp-fb:"+s+" "+i.type+(i.parameter&&i.parameter.length?" "+i.parameter:"")+`\r
`}),r},e.parseSsrcMedia=function(n){const r=n.indexOf(" "),s={ssrc:parseInt(n.substring(7,r),10)},i=n.indexOf(":",r);return i>-1?(s.attribute=n.substring(r+1,i),s.value=n.substring(i+1)):s.attribute=n.substring(r+1),s},e.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(s=>parseInt(s,10))}},e.getMid=function(n){const r=e.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},e.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:e.matchPrefix(n+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,r){let s="a=setup:"+r+`\r
`;return n.fingerprints.forEach(i=>{s+="a=fingerprint:"+i.algorithm+" "+i.value+`\r
`}),s},e.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,r){return e.matchPrefix(n+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,r){const s=e.matchPrefix(n+r,"a=ice-ufrag:")[0],i=e.matchPrefix(n+r,"a=ice-pwd:")[0];return s&&i?{usernameFragment:s.substring(12),password:i.substring(10)}:null},e.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},e.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=e.splitLines(n)[0].split(" ");r.profile=i[2];for(let l=3;l<i.length;l++){const c=i[l],u=e.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(u){const d=e.parseRtpMap(u),h=e.matchPrefix(n,"a=fmtp:"+c+" ");switch(d.parameters=h.length?e.parseFmtp(h[0]):{},d.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),r.codecs.push(d),d.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(d.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(l=>{r.headerExtensions.push(e.parseExtmap(l))});const o=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(l=>{o.forEach(c=>{l.rtcpFeedback.find(d=>d.type===c.type&&d.parameter===c.parameter)||l.rtcpFeedback.push(c)})}),r},e.writeRtpDescription=function(n,r){let s="";s+="m="+n+" ",s+=r.codecs.length>0?"9":"0",s+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",s+=r.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,s+=`c=IN IP4 0.0.0.0\r
`,s+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(o=>{s+=e.writeRtpMap(o),s+=e.writeFmtp(o),s+=e.writeRtcpFb(o)});let i=0;return r.codecs.forEach(o=>{o.maxptime>i&&(i=o.maxptime)}),i>0&&(s+="a=maxptime:"+i+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(o=>{s+=e.writeExtmap(o)}),s},e.parseRtpEncodingParameters=function(n){const r=[],s=e.parseRtpParameters(n),i=s.fecMechanisms.indexOf("RED")!==-1,o=s.fecMechanisms.indexOf("ULPFEC")!==-1,l=e.matchPrefix(n,"a=ssrc:").map(f=>e.parseSsrcMedia(f)).filter(f=>f.attribute==="cname"),c=l.length>0&&l[0].ssrc;let u;const d=e.matchPrefix(n,"a=ssrc-group:FID").map(f=>f.substring(17).split(" ").map(R=>parseInt(R,10)));d.length>0&&d[0].length>1&&d[0][0]===c&&(u=d[0][1]),s.codecs.forEach(f=>{if(f.name.toUpperCase()==="RTX"&&f.parameters.apt){let _={ssrc:c,codecPayloadType:parseInt(f.parameters.apt,10)};c&&u&&(_.rtx={ssrc:u}),r.push(_),i&&(_=JSON.parse(JSON.stringify(_)),_.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},r.push(_))}}),r.length===0&&c&&r.push({ssrc:c});let h=e.matchPrefix(n,"b=");return h.length&&(h[0].indexOf("b=TIAS:")===0?h=parseInt(h[0].substring(7),10):h[0].indexOf("b=AS:")===0?h=parseInt(h[0].substring(5),10)*1e3*.95-50*40*8:h=void 0,r.forEach(f=>{f.maxBitrate=h})),r},e.parseRtcpParameters=function(n){const r={},s=e.matchPrefix(n,"a=ssrc:").map(l=>e.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];s&&(r.cname=s.value,r.ssrc=s.ssrc);const i=e.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=i.length>0,r.compound=i.length===0;const o=e.matchPrefix(n,"a=rtcp-mux");return r.mux=o.length>0,r},e.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},e.parseMsid=function(n){let r;const s=e.matchPrefix(n,"a=msid:");if(s.length===1)return r=s[0].substring(7).split(" "),{stream:r[0],track:r[1]};const i=e.matchPrefix(n,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(i.length>0)return r=i[0].value.split(" "),{stream:r[0],track:r[1]}},e.parseSctpDescription=function(n){const r=e.parseMLine(n),s=e.matchPrefix(n,"a=max-message-size:");let i;s.length>0&&(i=parseInt(s[0].substring(19),10)),isNaN(i)&&(i=65536);const o=e.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:r.fmt,maxMessageSize:i};const l=e.matchPrefix(n,"a=sctpmap:");if(l.length>0){const c=l[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:i}}},e.writeSctpDescription=function(n,r){let s=[];return n.protocol!=="DTLS/SCTP"?s=["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:s=["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&s.push("a=max-message-size:"+r.maxMessageSize+`\r
`),s.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,r,s){let i;const o=r!==void 0?r:2;return n?i=n:i=e.generateSessionId(),`v=0\r
o=`+(s||"thisisadapterortc")+" "+i+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,r){const s=e.splitLines(n);for(let i=0;i<s.length;i++)switch(s[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[i].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const s=e.splitLines(n)[0].substring(2).split(" ");return{kind:s[0],port:parseInt(s[1],10),protocol:s[2],fmt:s.slice(3).join(" ")}},e.parseOLine=function(n){const s=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:s[0],sessionId:s[1],sessionVersion:parseInt(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=e.splitLines(n);for(let s=0;s<r.length;s++)if(r[s].length<2||r[s].charAt(1)!=="=")return!1;return!0},t.exports=e})(xS);var bS=xS.exports;const Io=v_(bS),yO=gI({__proto__:null,default:Io},[bS]);function qc(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const s=new e(r),i=Io.parseCandidate(r.candidate);for(const o in i)o in s||Object.defineProperty(s,o,{value:i[o]});return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new e(r)},t.RTCIceCandidate.prototype=e.prototype,Di(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function Ap(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Di(t,"icecandidate",e=>{if(e.candidate){const n=Io.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function Zc(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(l){if(!l||!l.sdp)return!1;const c=Io.splitSections(l.sdp);return c.shift(),c.some(u=>{const d=Io.parseMLine(u);return d&&d.kind==="application"&&d.protocol.indexOf("SCTP")!==-1})},r=function(l){const c=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const u=parseInt(c[1],10);return u!==u?-1:u},s=function(l){let c=65536;return e.browser==="firefox"&&(e.version<57?l===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},i=function(l,c){let u=65536;e.browser==="firefox"&&e.version===57&&(u=65535);const d=Io.matchPrefix(l.sdp,"a=max-message-size:");return d.length>0?u=parseInt(d[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(u=2147483637),u},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=r(arguments[0]),u=s(c),d=i(arguments[0],c);let h;u===0&&d===0?h=Number.POSITIVE_INFINITY:u===0||d===0?h=Math.max(u,d):h=Math.min(u,d);const f={};Object.defineProperty(f,"maxMessageSize",{get(){return h}}),this._sctp=f}return o.apply(this,arguments)}}function eu(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(r,s){const i=r.send;r.send=function(){const l=arguments[0],c=l.length||l.size||l.byteLength;if(r.readyState==="open"&&s.sctp&&c>s.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+s.sctp.maxMessageSize+" bytes)");return i.apply(r,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const s=n.apply(this,arguments);return e(s,this),s},Di(t,"datachannel",r=>(e(r.channel,r.target),r))}function Rp(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=s=>{const i=s.target;if(i._lastConnectionState!==i.connectionState){i._lastConnectionState=i.connectionState;const o=new Event("connectionstatechange",s);i.dispatchEvent(o)}return s},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function Pp(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(s){if(s&&s.sdp&&s.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i=s.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&s instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:s.type,sdp:i}):s.sdp=i}return n.apply(this,arguments)}}function tu(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function nu(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let s=arguments[0]||{};if(typeof s!="object"||s.type&&s.sdp)return n.apply(this,arguments);if(s={type:s.type,sdp:s.sdp},!s.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":s.type="offer";break;default:s.type="answer";break}return s.sdp||s.type!=="offer"&&s.type!=="answer"?n.apply(this,[s]):(s.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}const vO=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:Pp,shimAddIceCandidateNullOrEmpty:tu,shimConnectionState:Rp,shimMaxMessageSize:Zc,shimParameterlessSetLocalDescription:nu,shimRTCIceCandidate:qc,shimRTCIceCandidateRelayProtocol:Ap,shimSendThrowTypeError:eu},Symbol.toStringTag,{value:"Module"}));function _O({window:t}={},e={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const n=GE,r=gO(t),s={browserDetails:r,commonShim:vO,extractVersion:ka,disableLog:hO,disableWarnings:pO,sdp:yO};switch(r.browser){case"chrome":if(!e_||!wp||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),s;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),s;n("adapter.js shimming chrome."),s.browserShim=e_,tu(t,r),nu(t),YE(t,r),KE(t),wp(t,r),XE(t),ZE(t,r),QE(t),JE(t),eS(t,r),qc(t),Ap(t),Rp(t),Zc(t,r),eu(t),Pp(t,r);break;case"firefox":if(!t_||!kp||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),s;n("adapter.js shimming firefox."),s.browserShim=t_,tu(t,r),nu(t),tS(t,r),kp(t,r),nS(t),iS(t),rS(t),sS(t),oS(t),aS(t),lS(t),cS(t),uS(t),qc(t),Rp(t),Zc(t,r),eu(t);break;case"safari":if(!n_||!e.shimSafari)return n("Safari shim is not included in this adapter release."),s;n("adapter.js shimming safari."),s.browserShim=n_,tu(t,r),nu(t),mS(t),vS(t),hS(t),dS(t),fS(t),yS(t),pS(t),_S(t),qc(t),Ap(t),Zc(t,r),eu(t),Pp(t,r);break;default:n("Unsupported browser!");break}return s}const r_=_O({window:typeof window>"u"?void 0:window});function Mi(t,e,n,r){Object.defineProperty(t,e,{get:n,set:r,enumerable:!0,configurable:!0})}class ES{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=e=>{const n=[],r=e.byteLength,s=Math.ceil(r/this.chunkedMTU);let i=0,o=0;for(;o<r;){const l=Math.min(r,o+this.chunkedMTU),c=e.slice(o,l),u={__peerData:this._dataCount,n:i,data:c,total:s};n.push(u),o=l,i++}return this._dataCount++,n}}}function xO(t){let e=0;for(const s of t)e+=s.byteLength;const n=new Uint8Array(e);let r=0;for(const s of t)n.set(s,r),r+=s.byteLength;return n}const ch=r_.default||r_,Sa=new class{isWebRTCSupported(){return typeof RTCPeerConnection<"u"}isBrowserSupported(){const t=this.getBrowser(),e=this.getVersion();return this.supportedBrowsers.includes(t)?t==="chrome"?e>=this.minChromeVersion:t==="firefox"?e>=this.minFirefoxVersion:t==="safari"?!this.isIOS&&e>=this.minSafariVersion:!1:!1}getBrowser(){return ch.browserDetails.browser}getVersion(){return ch.browserDetails.version||0}isUnifiedPlanSupported(){const t=this.getBrowser(),e=ch.browserDetails.version||0;if(t==="chrome"&&e<this.minChromeVersion)return!1;if(t==="firefox"&&e>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let n,r=!1;try{n=new RTCPeerConnection,n.addTransceiver("audio"),r=!0}catch{}finally{n&&n.close()}return r}toString(){return`Supports:
    browser:${this.getBrowser()}
    version:${this.getVersion()}
    isIOS:${this.isIOS}
    isWebRTCSupported:${this.isWebRTCSupported()}
    isBrowserSupported:${this.isBrowserSupported()}
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS=typeof navigator<"u"?["iPad","iPhone","iPod"].includes(navigator.platform):!1,this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},bO=t=>!t||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(t),SS=()=>Math.random().toString(36).slice(2),s_={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};class EO extends ES{noop(){}blobToArrayBuffer(e,n){const r=new FileReader;return r.onload=function(s){s.target&&n(s.target.result)},r.readAsArrayBuffer(e),r}binaryStringToArrayBuffer(e){const n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r)&255;return n.buffer}isSecure(){return location.protocol==="https:"}constructor(...e){super(...e),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=s_,this.browser=Sa.getBrowser(),this.browserVersion=Sa.getVersion(),this.pack=zE,this.unpack=BE,this.supports=function(){const n={browser:Sa.isBrowserSupported(),webRTC:Sa.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!n.webRTC)return n;let r;try{r=new RTCPeerConnection(s_),n.audioVideo=!0;let s;try{s=r.createDataChannel("_PEERJSTEST",{ordered:!0}),n.data=!0,n.reliable=!!s.ordered;try{s.binaryType="blob",n.binaryBlob=!Sa.isIOS}catch{}}catch{}finally{s&&s.close()}}catch{}finally{r&&r.close()}return n}(),this.validateId=bO,this.randomToken=SS}}const Pn=new EO,SO="PeerJS: ";class IO{get logLevel(){return this._logLevel}set logLevel(e){this._logLevel=e}log(...e){this._logLevel>=3&&this._print(3,...e)}warn(...e){this._logLevel>=2&&this._print(2,...e)}error(...e){this._logLevel>=1&&this._print(1,...e)}setLogFunction(e){this._print=e}_print(e,...n){const r=[SO,...n];for(const s in r)r[s]instanceof Error&&(r[s]="("+r[s].name+") "+r[s].message);e>=3?console.log(...r):e>=2?console.warn("WARNING",...r):e>=1&&console.error("ERROR",...r)}constructor(){this._logLevel=0}}var Te=new IO,k0={},TO=Object.prototype.hasOwnProperty,wn="~";function Sl(){}Object.create&&(Sl.prototype=Object.create(null),new Sl().__proto__||(wn=!1));function CO(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function IS(t,e,n,r,s){if(typeof n!="function")throw new TypeError("The listener must be a function");var i=new CO(n,r||t,s),o=wn?wn+e:e;return t._events[o]?t._events[o].fn?t._events[o]=[t._events[o],i]:t._events[o].push(i):(t._events[o]=i,t._eventsCount++),t}function ru(t,e){--t._eventsCount===0?t._events=new Sl:delete t._events[e]}function mn(){this._events=new Sl,this._eventsCount=0}mn.prototype.eventNames=function(){var e=[],n,r;if(this._eventsCount===0)return e;for(r in n=this._events)TO.call(n,r)&&e.push(wn?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(n)):e};mn.prototype.listeners=function(e){var n=wn?wn+e:e,r=this._events[n];if(!r)return[];if(r.fn)return[r.fn];for(var s=0,i=r.length,o=new Array(i);s<i;s++)o[s]=r[s].fn;return o};mn.prototype.listenerCount=function(e){var n=wn?wn+e:e,r=this._events[n];return r?r.fn?1:r.length:0};mn.prototype.emit=function(e,n,r,s,i,o){var l=wn?wn+e:e;if(!this._events[l])return!1;var c=this._events[l],u=arguments.length,d,h;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,n),!0;case 3:return c.fn.call(c.context,n,r),!0;case 4:return c.fn.call(c.context,n,r,s),!0;case 5:return c.fn.call(c.context,n,r,s,i),!0;case 6:return c.fn.call(c.context,n,r,s,i,o),!0}for(h=1,d=new Array(u-1);h<u;h++)d[h-1]=arguments[h];c.fn.apply(c.context,d)}else{var f=c.length,_;for(h=0;h<f;h++)switch(c[h].once&&this.removeListener(e,c[h].fn,void 0,!0),u){case 1:c[h].fn.call(c[h].context);break;case 2:c[h].fn.call(c[h].context,n);break;case 3:c[h].fn.call(c[h].context,n,r);break;case 4:c[h].fn.call(c[h].context,n,r,s);break;default:if(!d)for(_=1,d=new Array(u-1);_<u;_++)d[_-1]=arguments[_];c[h].fn.apply(c[h].context,d)}}return!0};mn.prototype.on=function(e,n,r){return IS(this,e,n,r,!1)};mn.prototype.once=function(e,n,r){return IS(this,e,n,r,!0)};mn.prototype.removeListener=function(e,n,r,s){var i=wn?wn+e:e;if(!this._events[i])return this;if(!n)return ru(this,i),this;var o=this._events[i];if(o.fn)o.fn===n&&(!s||o.once)&&(!r||o.context===r)&&ru(this,i);else{for(var l=0,c=[],u=o.length;l<u;l++)(o[l].fn!==n||s&&!o[l].once||r&&o[l].context!==r)&&c.push(o[l]);c.length?this._events[i]=c.length===1?c[0]:c:ru(this,i)}return this};mn.prototype.removeAllListeners=function(e){var n;return e?(n=wn?wn+e:e,this._events[n]&&ru(this,n)):(this._events=new Sl,this._eventsCount=0),this};mn.prototype.off=mn.prototype.removeListener;mn.prototype.addListener=mn.prototype.on;mn.prefixed=wn;mn.EventEmitter=mn;k0=mn;var Ni={};Mi(Ni,"ConnectionType",()=>Hs);Mi(Ni,"PeerErrorType",()=>zt);Mi(Ni,"BaseConnectionErrorType",()=>Op);Mi(Ni,"DataConnectionErrorType",()=>A0);Mi(Ni,"SerializationType",()=>Ud);Mi(Ni,"SocketEventType",()=>ks);Mi(Ni,"ServerMessageType",()=>hn);var Hs=function(t){return t.Data="data",t.Media="media",t}({}),zt=function(t){return t.BrowserIncompatible="browser-incompatible",t.Disconnected="disconnected",t.InvalidID="invalid-id",t.InvalidKey="invalid-key",t.Network="network",t.PeerUnavailable="peer-unavailable",t.SslUnavailable="ssl-unavailable",t.ServerError="server-error",t.SocketError="socket-error",t.SocketClosed="socket-closed",t.UnavailableID="unavailable-id",t.WebRTC="webrtc",t}({}),Op=function(t){return t.NegotiationFailed="negotiation-failed",t.ConnectionClosed="connection-closed",t}({}),A0=function(t){return t.NotOpenYet="not-open-yet",t.MessageToBig="message-too-big",t}({}),Ud=function(t){return t.Binary="binary",t.BinaryUTF8="binary-utf8",t.JSON="json",t.None="raw",t}({}),ks=function(t){return t.Message="message",t.Disconnected="disconnected",t.Error="error",t.Close="close",t}({}),hn=function(t){return t.Heartbeat="HEARTBEAT",t.Candidate="CANDIDATE",t.Offer="OFFER",t.Answer="ANSWER",t.Open="OPEN",t.Error="ERROR",t.IdTaken="ID-TAKEN",t.InvalidKey="INVALID-KEY",t.Leave="LEAVE",t.Expire="EXPIRE",t}({});const TS="1.5.5";class wO extends k0.EventEmitter{constructor(e,n,r,s,i,o=5e3){super(),this.pingInterval=o,this._disconnected=!0,this._messagesQueue=[];const l=e?"wss://":"ws://";this._baseUrl=l+n+":"+r+s+"peerjs?key="+i}start(e,n){this._id=e;const r=`${this._baseUrl}&id=${e}&token=${n}`;this._socket||!this._disconnected||(this._socket=new WebSocket(r+"&version="+TS),this._disconnected=!1,this._socket.onmessage=s=>{let i;try{i=JSON.parse(s.data),Te.log("Server message received:",i)}catch{Te.log("Invalid server message",s.data);return}this.emit(ks.Message,i)},this._socket.onclose=s=>{this._disconnected||(Te.log("Socket closed.",s),this._cleanup(),this._disconnected=!0,this.emit(ks.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),Te.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen()){Te.log("Cannot send heartbeat, because socket closed");return}const e=JSON.stringify({type:hn.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&this._socket.readyState===1}_sendQueuedMessages(){const e=[...this._messagesQueue];this._messagesQueue=[];for(const n of e)this.send(n)}send(e){if(this._disconnected)return;if(!this._id){this._messagesQueue.push(e);return}if(!e.type){this.emit(ks.Error,"Invalid message");return}if(!this._wsOpen())return;const n=JSON.stringify(e);this._socket.send(n)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}class CS{constructor(e){this.connection=e}startConnection(e){const n=this._startPeerConnection();if(this.connection.peerConnection=n,this.connection.type===Hs.Media&&e._stream&&this._addTracksToConnection(e._stream,n),e.originator){const r=this.connection,s={ordered:!!e.reliable},i=n.createDataChannel(r.label,s);r._initializeDataChannel(i),this._makeOffer()}else this.handleSDP("OFFER",e.sdp)}_startPeerConnection(){Te.log("Creating RTCPeerConnection.");const e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e}_setupListeners(e){const n=this.connection.peer,r=this.connection.connectionId,s=this.connection.type,i=this.connection.provider;Te.log("Listening for ICE candidates."),e.onicecandidate=o=>{!o.candidate||!o.candidate.candidate||(Te.log(`Received ICE candidates for ${n}:`,o.candidate),i.socket.send({type:hn.Candidate,payload:{candidate:o.candidate,type:s,connectionId:r},dst:n}))},e.oniceconnectionstatechange=()=>{switch(e.iceConnectionState){case"failed":Te.log("iceConnectionState is failed, closing connections to "+n),this.connection.emitError(Op.NegotiationFailed,"Negotiation of connection to "+n+" failed."),this.connection.close();break;case"closed":Te.log("iceConnectionState is closed, closing connections to "+n),this.connection.emitError(Op.ConnectionClosed,"Connection to "+n+" closed."),this.connection.close();break;case"disconnected":Te.log("iceConnectionState changed to disconnected on the connection with "+n);break;case"completed":e.onicecandidate=()=>{};break}this.connection.emit("iceStateChanged",e.iceConnectionState)},Te.log("Listening for data channel"),e.ondatachannel=o=>{Te.log("Received data channel");const l=o.channel;i.getConnection(n,r)._initializeDataChannel(l)},Te.log("Listening for remote stream"),e.ontrack=o=>{Te.log("Received remote stream");const l=o.streams[0],c=i.getConnection(n,r);if(c.type===Hs.Media){const u=c;this._addStreamToMediaConnection(l,u)}}}cleanup(){Te.log("Cleaning up PeerConnection to "+this.connection.peer);const e=this.connection.peerConnection;if(!e)return;this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=()=>{};const n=e.signalingState!=="closed";let r=!1;const s=this.connection.dataChannel;s&&(r=!!s.readyState&&s.readyState!=="closed"),(n||r)&&e.close()}async _makeOffer(){const e=this.connection.peerConnection,n=this.connection.provider;try{const r=await e.createOffer(this.connection.options.constraints);Te.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),Te.log("Set localDescription:",r,`for:${this.connection.peer}`);let s={sdp:r,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===Hs.Data){const i=this.connection;s={...s,label:i.label,reliable:i.reliable,serialization:i.serialization}}n.socket.send({type:hn.Offer,payload:s,dst:this.connection.peer})}catch(s){s!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(n.emitError(zt.WebRTC,s),Te.log("Failed to setLocalDescription, ",s))}}catch(r){n.emitError(zt.WebRTC,r),Te.log("Failed to createOffer, ",r)}}async _makeAnswer(){const e=this.connection.peerConnection,n=this.connection.provider;try{const r=await e.createAnswer();Te.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),Te.log("Set localDescription:",r,`for:${this.connection.peer}`),n.socket.send({type:hn.Answer,payload:{sdp:r,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(s){n.emitError(zt.WebRTC,s),Te.log("Failed to setLocalDescription, ",s)}}catch(r){n.emitError(zt.WebRTC,r),Te.log("Failed to create answer, ",r)}}async handleSDP(e,n){n=new RTCSessionDescription(n);const r=this.connection.peerConnection,s=this.connection.provider;Te.log("Setting remote description",n);const i=this;try{await r.setRemoteDescription(n),Te.log(`Set remoteDescription:${e} for:${this.connection.peer}`),e==="OFFER"&&await i._makeAnswer()}catch(o){s.emitError(zt.WebRTC,o),Te.log("Failed to setRemoteDescription, ",o)}}async handleCandidate(e){Te.log("handleCandidate:",e);try{await this.connection.peerConnection.addIceCandidate(e),Te.log(`Added ICE candidate for:${this.connection.peer}`)}catch(n){this.connection.provider.emitError(zt.WebRTC,n),Te.log("Failed to handleCandidate, ",n)}}_addTracksToConnection(e,n){if(Te.log(`add tracks from stream ${e.id} to peer connection`),!n.addTrack)return Te.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(r=>{n.addTrack(r,e)})}_addStreamToMediaConnection(e,n){Te.log(`add stream ${e.id} to media connection ${n.connectionId}`),n.addStream(e)}}class wS extends k0.EventEmitter{emitError(e,n){Te.error("Error:",n),this.emit("error",new kO(`${e}`,n))}}class kO extends Error{constructor(e,n){typeof n=="string"?super(n):(super(),Object.assign(this,n)),this.type=e}}class kS extends wS{get open(){return this._open}constructor(e,n,r){super(),this.peer=e,this.provider=n,this.options=r,this._open=!1,this.metadata=r.metadata}}var Mp;const Ya=class Ya extends kS{get type(){return Hs.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(e,n,r){super(e,n,r),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||Ya.ID_PREFIX+Pn.randomToken(),this._negotiator=new CS(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{Te.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{Te.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(e){Te.log("Receiving stream",e),this._remoteStream=e,super.emit("stream",e)}handleMessage(e){const n=e.type,r=e.payload;switch(e.type){case hn.Answer:this._negotiator.handleSDP(n,r.sdp),this._open=!0;break;case hn.Candidate:this._negotiator.handleCandidate(r.candidate);break;default:Te.warn(`Unrecognized message type:${n} from peer:${this.peer}`);break}}answer(e,n={}){if(this._localStream){Te.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=e,n&&n.sdpTransform&&(this.options.sdpTransform=n.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:e});const r=this.provider._getMessages(this.connectionId);for(const s of r)this.handleMessage(s);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit("close"))}};Mp=new WeakMap,ca(Ya,Mp,Ya.ID_PREFIX="mc_");let td=Ya;class AO{constructor(e){this._options=e}_buildRequest(e){const n=this._options.secure?"https":"http",{host:r,port:s,path:i,key:o}=this._options,l=new URL(`${n}://${r}:${s}${i}${o}/${e}`);return l.searchParams.set("ts",`${Date.now()}${Math.random()}`),l.searchParams.set("version",TS),fetch(l.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{const e=await this._buildRequest("id");if(e.status!==200)throw new Error(`Error. Status:${e.status}`);return e.text()}catch(e){Te.error("Error retrieving ID",e);let n="";throw this._options.path==="/"&&this._options.host!==Pn.CLOUD_HOST&&(n=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+n)}}async listAllPeers(){try{const e=await this._buildRequest("peers");if(e.status!==200){if(e.status===401){let n="";throw this._options.host===Pn.CLOUD_HOST?n="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":n="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+n)}throw new Error(`Error. Status:${e.status}`)}return e.json()}catch(e){throw Te.error("Error retrieving list peers",e),new Error("Could not get list peers from the server."+e)}}}var Np,jp;const ui=class ui extends kS{get type(){return Hs.Data}constructor(e,n,r){super(e,n,r),this.connectionId=this.options.connectionId||ui.ID_PREFIX+SS(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new CS(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{Te.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=n=>{Te.log(`DC#${this.connectionId} dc onmessage:`,n.data)},this.dataChannel.onclose=()=>{Te.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(e){if(e!=null&&e.flush){this.send({__peerData:{type:"close"}});return}this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null),this.open&&(this._open=!1,super.emit("close"))}send(e,n=!1){if(!this.open){this.emitError(A0.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.");return}return this._send(e,n)}async handleMessage(e){const n=e.payload;switch(e.type){case hn.Answer:await this._negotiator.handleSDP(e.type,n.sdp);break;case hn.Candidate:await this._negotiator.handleCandidate(n.candidate);break;default:Te.warn("Unrecognized message type:",e.type,"from peer:",this.peer);break}}};Np=new WeakMap,jp=new WeakMap,ca(ui,Np,ui.ID_PREFIX="dc_"),ca(ui,jp,ui.MAX_BUFFERED_AMOUNT=8388608);let nd=ui;class R0 extends nd{get bufferSize(){return this._bufferSize}_initializeDataChannel(e){super._initializeDataChannel(e),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",n=>this._handleDataMessage(n))}_bufferedSend(e){(this._buffering||!this._trySend(e))&&(this._buffer.push(e),this._bufferSize=this._buffer.length)}_trySend(e){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>nd.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(e)}catch(n){return Te.error(`DC#:${this.connectionId} Error when sending:`,n),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open||this._buffer.length===0)return;const e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(e){if(e!=null&&e.flush){this.send({__peerData:{type:"close"}});return}this._buffer=[],this._bufferSize=0,super.close()}constructor(...e){super(...e),this._buffer=[],this._bufferSize=0,this._buffering=!1}}class uh extends R0{close(e){super.close(e),this._chunkedData={}}constructor(e,n,r){super(e,n,r),this.chunker=new ES,this.serialization=Ud.Binary,this._chunkedData={}}_handleDataMessage({data:e}){const n=BE(e),r=n.__peerData;if(r){if(r.type==="close"){this.close();return}this._handleChunk(n);return}this.emit("data",n)}_handleChunk(e){const n=e.__peerData,r=this._chunkedData[n]||{data:[],count:0,total:e.total};if(r.data[e.n]=new Uint8Array(e.data),r.count++,this._chunkedData[n]=r,r.total===r.count){delete this._chunkedData[n];const s=xO(r.data);this._handleDataMessage({data:s})}}_send(e,n){const r=zE(e);if(r instanceof Promise)return this._send_blob(r);if(!n&&r.byteLength>this.chunker.chunkedMTU){this._sendChunks(r);return}this._bufferedSend(r)}async _send_blob(e){const n=await e;if(n.byteLength>this.chunker.chunkedMTU){this._sendChunks(n);return}this._bufferedSend(n)}_sendChunks(e){const n=this.chunker.chunk(e);Te.log(`DC#${this.connectionId} Try to send ${n.length} chunks...`);for(const r of n)this.send(r,!0)}}class RO extends R0{_handleDataMessage({data:e}){super.emit("data",e)}_send(e,n){this._bufferedSend(e)}constructor(...e){super(...e),this.serialization=Ud.None}}class PO extends R0{_handleDataMessage({data:e}){const n=this.parse(this.decoder.decode(e)),r=n.__peerData;if(r&&r.type==="close"){this.close();return}this.emit("data",n)}_send(e,n){const r=this.encoder.encode(this.stringify(e));if(r.byteLength>=Pn.chunkedMTU){this.emitError(A0.MessageToBig,"Message too big for JSON channel");return}this._bufferedSend(r)}constructor(...e){super(...e),this.serialization=Ud.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}var $p;const Ka=class Ka extends wS{get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){const e=Object.create(null);for(const[n,r]of this._connections)e[n]=r;return e}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(e,n){super(),this._serializers={raw:RO,json:PO,binary:uh,"binary-utf8":uh,default:uh},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map;let r;if(e&&e.constructor==Object?n=e:e&&(r=e.toString()),n={debug:0,host:Pn.CLOUD_HOST,port:Pn.CLOUD_PORT,path:"/",key:Ka.DEFAULT_KEY,token:Pn.randomToken(),config:Pn.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...n},this._options=n,this._serializers={...this._serializers,...this.options.serializers},this._options.host==="/"&&(this._options.host=window.location.hostname),this._options.path&&(this._options.path[0]!=="/"&&(this._options.path="/"+this._options.path),this._options.path[this._options.path.length-1]!=="/"&&(this._options.path+="/")),this._options.secure===void 0&&this._options.host!==Pn.CLOUD_HOST?this._options.secure=Pn.isSecure():this._options.host==Pn.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&Te.setLogFunction(this._options.logFunction),Te.logLevel=this._options.debug||0,this._api=new AO(n),this._socket=this._createServerConnection(),!Pn.supports.audioVideo&&!Pn.supports.data){this._delayedAbort(zt.BrowserIncompatible,"The current browser does not support WebRTC");return}if(r&&!Pn.validateId(r)){this._delayedAbort(zt.InvalidID,`ID "${r}" is invalid`);return}r?this._initialize(r):this._api.retrieveId().then(s=>this._initialize(s)).catch(s=>this._abort(zt.ServerError,s))}_createServerConnection(){const e=new wO(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return e.on(ks.Message,n=>{this._handleMessage(n)}),e.on(ks.Error,n=>{this._abort(zt.SocketError,n)}),e.on(ks.Disconnected,()=>{this.disconnected||(this.emitError(zt.Network,"Lost connection to server."),this.disconnect())}),e.on(ks.Close,()=>{this.disconnected||this._abort(zt.SocketClosed,"Underlying socket is already closed.")}),e}_initialize(e){this._id=e,this.socket.start(e,this._options.token)}_handleMessage(e){const n=e.type,r=e.payload,s=e.src;switch(n){case hn.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case hn.Error:this._abort(zt.ServerError,r.msg);break;case hn.IdTaken:this._abort(zt.UnavailableID,`ID "${this.id}" is taken`);break;case hn.InvalidKey:this._abort(zt.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case hn.Leave:Te.log(`Received leave message from ${s}`),this._cleanupPeer(s),this._connections.delete(s);break;case hn.Expire:this.emitError(zt.PeerUnavailable,`Could not connect to peer ${s}`);break;case hn.Offer:{const i=r.connectionId;let o=this.getConnection(s,i);if(o&&(o.close(),Te.warn(`Offer received for existing Connection ID:${i}`)),r.type===Hs.Media){const c=new td(s,this,{connectionId:i,_payload:r,metadata:r.metadata});o=c,this._addConnection(s,o),this.emit("call",c)}else if(r.type===Hs.Data){const c=new this._serializers[r.serialization](s,this,{connectionId:i,_payload:r,metadata:r.metadata,label:r.label,serialization:r.serialization,reliable:r.reliable});o=c,this._addConnection(s,o),this.emit("connection",c)}else{Te.warn(`Received malformed connection type:${r.type}`);return}const l=this._getMessages(i);for(const c of l)o.handleMessage(c);break}default:{if(!r){Te.warn(`You received a malformed message from ${s} of type ${n}`);return}const i=r.connectionId,o=this.getConnection(s,i);o&&o.peerConnection?o.handleMessage(e):i?this._storeMessage(i,e):Te.warn("You received an unrecognized message:",e);break}}}_storeMessage(e,n){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(n)}_getMessages(e){const n=this._lostMessages.get(e);return n?(this._lostMessages.delete(e),n):[]}connect(e,n={}){if(n={serialization:"default",...n},this.disconnected){Te.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(zt.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}const r=new this._serializers[n.serialization](e,this,n);return this._addConnection(e,r),r}call(e,n,r={}){if(this.disconnected){Te.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(zt.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!n){Te.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}const s=new td(e,this,{...r,_stream:n});return this._addConnection(e,s),s}_addConnection(e,n){Te.log(`add connection ${n.type}:${n.connectionId} to peerId:${e}`),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(n)}_removeConnection(e){const n=this._connections.get(e.peer);if(n){const r=n.indexOf(e);r!==-1&&n.splice(r,1)}this._lostMessages.delete(e.connectionId)}getConnection(e,n){const r=this._connections.get(e);if(!r)return null;for(const s of r)if(s.connectionId===n)return s;return null}_delayedAbort(e,n){setTimeout(()=>{this._abort(e,n)},0)}_abort(e,n){Te.error("Aborting!"),this.emitError(e,n),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||(Te.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))}_cleanup(){for(const e of this._connections.keys())this._cleanupPeer(e),this._connections.delete(e);this.socket.removeAllListeners()}_cleanupPeer(e){const n=this._connections.get(e);if(n)for(const r of n)r.close()}disconnect(){if(this.disconnected)return;const e=this.id;Te.log(`Disconnect peer with ID:${e}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit("disconnected",e)}reconnect(){if(this.disconnected&&!this.destroyed)Te.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)Te.error("In a hurry? We're still trying to make the initial connection!");else throw new Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`)}}listAllPeers(e=n=>{}){this._api.listAllPeers().then(n=>e(n)).catch(n=>this._abort(zt.ServerError,n))}};$p=new WeakMap,ca(Ka,$p,Ka.DEFAULT_KEY="peerjs");let Lp=Ka;var AS=Lp;class RS{constructor(){nn(this,"peer",null);nn(this,"conn",null);nn(this,"isHost",!1);nn(this,"messageCallback",null);nn(this,"connectionCallback",null);nn(this,"closeCallback",null)}async connect(e){return this.peer=new AS,new Promise((n,r)=>{if(!this.peer)return r("Peer not initialized");this.peer.on("open",s=>{console.log("My Peer ID is:",s),e?(this.isHost=!1,this.connectToPeer(e),n(s)):(this.isHost=!0,this.peer.on("connection",i=>{console.log("Incoming connection..."),this.setupConnection(i)}),n(s))}),this.peer.on("error",s=>{console.error(s),r(s)})})}connectToPeer(e){if(!this.peer)return;const n=this.peer.connect(e);this.setupConnection(n)}setupConnection(e){this.conn=e,e.on("open",()=>{console.log("Connection established!"),this.connectionCallback&&this.connectionCallback()}),e.on("data",n=>{this.messageCallback&&this.messageCallback(n)}),e.on("close",()=>{console.log("Connection closed"),this.closeCallback&&this.closeCallback()}),e.on("error",n=>console.error("Connection Error:",n))}onConnection(e){this.connectionCallback=e}onClose(e){this.closeCallback=e}isConnected(){return this.conn!==null&&this.conn.open}send(e){this.conn&&this.conn.open?this.conn.send(e):console.warn("Connection not open, cannot send message")}onMessage(e){this.messageCallback=e}disconnect(){var e,n;(e=this.conn)==null||e.close(),(n=this.peer)==null||n.destroy()}}const OO=({gameMode:t,targetRoomId:e,playerClass:n,onGameStart:r,onBack:s})=>{const[i,o]=D.useState(""),[l,c]=D.useState(!1),[u,d]=D.useState(!0),[h,f]=D.useState(null),[_,R]=D.useState(!1),[k,B]=D.useState(null),[x,E]=D.useState(!1),T=D.useRef(null);D.useEffect(()=>{const C=new RS;return T.current=C,(async()=>{try{const Y=await C.connect(t==="JOIN"?e:void 0);o(Y),d(!1),C.onMessage(K=>{console.log("[LobbyScreen] Received message:",K),K.type==="CLASS_INFO"&&(console.log("[LobbyScreen] Received opponent class:",K.playerClass),B(K.playerClass))}),C.onConnection(()=>{console.log("[LobbyScreen] Connection established!"),c(!0)})}catch(Y){console.error("[LobbyScreen] Connection error:",Y),f(Y.toString()),d(!1)}})(),()=>{var Y;(Y=T.current)!=null&&Y.isConnected()||C.disconnect()}},[t,e]),D.useEffect(()=>{l&&T.current&&!x&&(console.log("[LobbyScreen] Sending class info:",n),setTimeout(()=>{var C;(C=T.current)==null||C.send({type:"CLASS_INFO",playerClass:n}),E(!0)},100))},[l,n,x]),D.useEffect(()=>{if(l&&T.current&&k){const C=setTimeout(()=>{console.log("[LobbyScreen] Starting game with opponent class:",k),r(T.current,k)},500);return()=>clearTimeout(C)}},[l,r,k]);const p=async()=>{if(i)try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(i);else{const C=document.createElement("textarea");C.value=i,C.style.position="fixed",C.style.left="-999999px",C.style.top="-999999px",document.body.appendChild(C),C.focus(),C.select(),document.execCommand("copy"),document.body.removeChild(C)}R(!0),setTimeout(()=>R(!1),2e3)}catch(C){console.error("Failed to copy:",C),alert(`Room ID: ${i}

()`)}},$=()=>{T.current&&(T.current.disconnect(),T.current=null),s()};return a.jsxs("div",{className:"screen lobby-screen",style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",gap:"2rem"},children:[a.jsx("h1",{style:{fontSize:"2.5rem",marginBottom:"1rem",textShadow:"0 0 10px #e94560",fontFamily:"Tamanegi, sans-serif",letterSpacing:"2px"},children:t==="HOST"?"":"..."}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1.5rem",padding:"2rem",background:"rgba(0,0,0,0.3)",borderRadius:"10px",minWidth:"400px"},children:[h&&a.jsxs("div",{style:{color:"#ff6b6b",fontSize:"1.2rem",textAlign:"center",fontFamily:"Tamanegi, sans-serif"},children:[a.jsx("p",{children:""}),a.jsx("p",{style:{fontSize:"0.9rem",opacity:.7},children:h})]}),u&&!h&&a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1rem"},children:[a.jsx("div",{className:"loading-spinner",style:{width:"50px",height:"50px",border:"4px solid rgba(233, 69, 96, 0.3)",borderTop:"4px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),a.jsx("p",{style:{opacity:.8,fontFamily:"Tamanegi, sans-serif"},children:t==="HOST"?"...":"..."})]}),t==="HOST"&&i&&!u&&!l&&!h&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.5rem"},children:[a.jsx("p",{style:{fontSize:"1rem",opacity:.7,fontFamily:"Tamanegi, sans-serif"},children:"ID:"}),a.jsx("div",{style:{fontSize:"2rem",fontFamily:"monospace",fontWeight:"bold",padding:"0.5rem 1rem",background:"rgba(233, 69, 96, 0.2)",borderRadius:"8px",border:"1px solid #e94560",letterSpacing:"2px"},children:i})]}),a.jsx("button",{onClick:p,style:{fontSize:"1rem",padding:"0.8rem 2rem",background:_?"#48bb78":"transparent",border:"2px solid "+(_?"#48bb78":"#e94560"),color:"#fff",cursor:"pointer",transition:"all 0.3s",borderRadius:"4px",fontWeight:"bold",fontFamily:"Tamanegi, sans-serif"},children:_?" ":"ID"}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginTop:"1rem",opacity:.7},children:[a.jsx("div",{className:"loading-spinner",style:{width:"20px",height:"20px",border:"2px solid rgba(233, 69, 96, 0.3)",borderTop:"2px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),a.jsx("span",{style:{fontFamily:"Tamanegi, sans-serif"},children:"..."})]})]}),t==="JOIN"&&!u&&!l&&!h&&a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[a.jsx("div",{className:"loading-spinner",style:{width:"20px",height:"20px",border:"2px solid rgba(233, 69, 96, 0.3)",borderTop:"2px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),a.jsxs("span",{style:{fontFamily:"Tamanegi, sans-serif"},children:[" ",e," ..."]})]}),l&&a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1rem"},children:[a.jsx("p",{style:{fontSize:"1.5rem",color:"#48bb78",fontFamily:"Tamanegi, sans-serif"},children:" "}),a.jsx("p",{style:{fontFamily:"Tamanegi, sans-serif"},children:"..."})]}),a.jsxs("div",{style:{marginTop:"1rem",padding:"0.5rem 1rem",background:"rgba(255,255,255,0.1)",borderRadius:"4px",fontSize:"0.9rem",opacity:.7,fontFamily:"Tamanegi, sans-serif"},children:[": ",n==="SENKA"?"":n==="AJA"?"":"yoRuka"]})]}),a.jsx("button",{onClick:$,style:{fontSize:"1rem",padding:"0.8rem 2rem",background:"transparent",border:"1px solid #888",color:"#888",cursor:"pointer",transition:"all 0.3s",borderRadius:"4px",marginTop:"1rem",fontFamily:"Tamanegi, sans-serif"},onMouseOver:C=>{C.currentTarget.style.color="#fff",C.currentTarget.style.borderColor="#fff"},onMouseOut:C=>{C.currentTarget.style.color="#888",C.currentTarget.style.borderColor="#888"},children:" "}),a.jsx("style",{children:`
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `})]})};class LO{constructor(){nn(this,"myEntryRef",null);nn(this,"listenerUnsubscribe",null);nn(this,"myId","");nn(this,"myPeerId","");nn(this,"hasMatched",!1)}async startMatchmaking(e,n,r,s,i,o,l,c){this.myPeerId=e,this.hasMatched=!1;const u=Gr(Kr,`matchmaking/${s}`);try{const d=await Dd(u),h=[];if(d.exists()&&d.forEach(k=>{const B=k.val(),x=Date.now()-B.timestamp<5*60*1e3;B.peerId!==e&&x&&h.push({key:k.key,data:B})}),h.length>0){const k=h.sort((B,x)=>B.data.timestamp-x.data.timestamp)[0];await kc(Gr(Kr,`matchmaking/${s}/${k.key}`)),i("matched"),o({peerId:k.data.peerId,playerName:k.data.playerName,playerClass:k.data.playerClass,isHost:!1,playerId:k.data.playerId,rating:k.data.rating});return}i("searching");const f=MA(u);this.myEntryRef=f,this.myId=f.key;const _={id:this.myId,peerId:e,playerName:n,playerClass:r,matchType:s,...l!=null&&{playerId:l},...c!=null&&{rating:c},timestamp:Date.now()};await Ld(f,_),DA(f).remove();const R=s;this.listenerUnsubscribe=sE(u,async k=>{if(this.hasMatched||!k.exists())return;let B=!1,x=null;if(k.forEach(E=>{const T=E.val();E.key===this.myId?B=!0:T.peerId!==this.myPeerId&&(!x||T.timestamp>x.data.timestamp)&&(x={key:E.key,data:T})}),!B&&this.myEntryRef){if(this.hasMatched)return;this.hasMatched=!0,i("matched"),this.cleanup();return}if(x!==null&&B){const E=k.child(this.myId).val(),T=x;if(E&&E.timestamp<T.data.timestamp){if(this.hasMatched)return;this.hasMatched=!0,await kc(Gr(Kr,`matchmaking/${R}/${T.key}`)),await kc(Gr(Kr,`matchmaking/${R}/${this.myId}`)),this.cleanup(),i("matched"),o({peerId:T.data.peerId,playerName:T.data.playerName,playerClass:T.data.playerClass,isHost:!0,playerId:T.data.playerId,rating:T.data.rating})}}})}catch(d){console.error("[Matchmaking] Error:",d),i("error"),this.cleanup()}}async cancelMatchmaking(){if(this.myEntryRef)try{await kc(this.myEntryRef)}catch(e){console.error("[Matchmaking] Error removing entry:",e)}this.cleanup()}cleanup(){this.listenerUnsubscribe&&(this.listenerUnsubscribe(),this.listenerUnsubscribe=null),this.myEntryRef=null,this.myId=""}}const Pc=new LO;class i_{constructor(e,n,r=!1){nn(this,"peer");nn(this,"conn");nn(this,"isHost",!1);nn(this,"messageCallback",null);nn(this,"closeCallback",null);this.peer=e,this.conn=n,this.isHost=r,n.on("data",s=>{this.messageCallback&&this.messageCallback(s)}),n.on("close",()=>{console.log("[PeerJSAdapter] Connection closed"),this.closeCallback&&this.closeCallback()}),n.on("error",s=>console.error("[PeerJSAdapter] Connection Error:",s))}async connect(e){return this.peer.id}onConnection(e){}onClose(e){this.closeCallback=e}isConnected(){return this.conn!==null&&this.conn.open}send(e){this.conn&&this.conn.open?this.conn.send(e):console.warn("[PeerJSAdapter] Connection not open, cannot send message")}onMessage(e){this.messageCallback=e}disconnect(){var e,n;(e=this.conn)==null||e.close(),(n=this.peer)==null||n.destroy()}}const DO=1280,MO=720,o_={BRONZE:"#cd7f32",SILVER:"#c0c0c0",GOLD:"#ffd700",PLATINUM:"#e5e4e2",DIAMOND:"#b9f2ff",MASTER:"#ff4500"},NO=({matchType:t,playerClass:e,playerName:n,playerId:r,onGameStart:s,onCancel:i})=>{const[o,l]=D.useState("idle"),[c,u]=D.useState("..."),[d,h]=D.useState(0),f=D.useRef(null),_=D.useRef(null),R=D.useRef(null),k=D.useRef(!1),B=D.useRef(!1),[x,E]=D.useState(0),[T,p]=D.useState(void 0),[$,C]=D.useState(1);D.useEffect(()=>{const K=()=>{const ce=window.innerWidth/DO,me=window.innerHeight/MO;C(Math.min(ce,me))};return K(),window.addEventListener("resize",K),()=>window.removeEventListener("resize",K)},[]),D.useEffect(()=>{if(o!=="searching")return;const K=setInterval(()=>{h(ce=>{const me=ce+1;return me>=60&&(l("error"),u(""),Pc.cancelMatchmaking(),_.current&&_.current.close(),f.current&&f.current.destroy()),me})},1e3);return()=>clearInterval(K)},[o]),D.useEffect(()=>{let K=!0,ce=0;return(async()=>{try{if(t==="ranked"&&r)try{ce=(await UE(r,e)).rating,E(ce)}catch(te){console.error("[Matchmaking] Failed to get rating:",te)}const Se=new AS({debug:1,config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]}});if(f.current=Se,await new Promise((te,w)=>{Se.on("open",()=>te()),Se.on("error",S=>w(S))}),!K)return;const fe=Se.id;console.log("[Matchmaking] My PeerJS ID:",fe),Se.on("connection",te=>{console.log("[Matchmaking] Incoming connection from:",te.peer),_.current=te,te.on("open",()=>{console.log("[Matchmaking] Connection opened (as HOST)"),te.on("data",w=>{if(w.type==="PLAYER_INFO"){console.log("[Matchmaking] Received player info:",w),te.send({type:"PLAYER_INFO",playerName:n,playerClass:e,playerId:t==="ranked"?r:void 0,rating:t==="ranked"?ce:void 0}),K&&t==="ranked"&&p(w.rating),B.current=!0;const S=new i_(Se,te,!0);s(S,w.playerClass,!0,w.playerId,w.rating)}})})}),Pc.startMatchmaking(fe,n,e,t,te=>{if(K)switch(l(te),te){case"searching":u("...");break;case"matched":u("...");break;case"error":u("");break}},async te=>{if(K)if(console.log("[Matchmaking] Match found:",te),R.current=te,k.current=te.isHost,te.isHost)u("...");else{u("...");const w=Se.connect(te.peerId,{reliable:!0});_.current=w,w.on("open",()=>{console.log("[Matchmaking] Connection opened (as JOIN)"),w.send({type:"PLAYER_INFO",playerName:n,playerClass:e,playerId:t==="ranked"?r:void 0,rating:t==="ranked"?ce:void 0}),w.on("data",S=>{if(S.type==="PLAYER_INFO"){console.log("[Matchmaking] Received player info:",S),K&&t==="ranked"&&p(S.rating),B.current=!0;const A=new i_(Se,w,!1);s(A,S.playerClass,!1,S.playerId,S.rating)}})}),w.on("error",S=>{console.error("[Matchmaking] Connection error:",S),l("error"),u("")})}},t==="ranked"&&r?r:void 0,t==="ranked"?ce:void 0)}catch(Se){console.error("[Matchmaking] Init error:",Se),K&&(l("error"),u(""))}})(),()=>{K=!1,Pc.cancelMatchmaking(),B.current||(_.current&&_.current.close(),f.current&&f.current.destroy())}},[t,e,n,r,s]);const re=async()=>{await Pc.cancelMatchmaking(),_.current&&_.current.close(),f.current&&f.current.destroy(),i()},Y=K=>{const ce=Math.floor(K/60),me=K%60;return`${ce}:${me.toString().padStart(2,"0")}`};return a.jsxs("div",{className:"screen",style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white"},children:[a.jsx("div",{style:{fontSize:`${1.2*$}rem`,color:"#4ade80",marginBottom:`${1*$}rem`,fontWeight:"bold"},children:t==="casual"?"":""}),a.jsx("div",{style:{fontSize:`${2*$}rem`,fontWeight:"bold",marginBottom:`${1*$}rem`,textAlign:"center"},children:c}),o==="searching"&&a.jsxs("div",{style:{fontSize:`${1.5*$}rem`,color:"#888",marginBottom:`${2*$}rem`},children:[": ",Y(d)]}),(o==="searching"||o==="matched")&&a.jsx("div",{style:{width:80*$,height:80*$,border:"4px solid rgba(255,255,255,0.2)",borderTop:"4px solid #4ade80",borderRadius:"50%",animation:"spin 1s linear infinite",marginBottom:`${2*$}rem`}}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*$}rem`,marginBottom:`${2*$}rem`,padding:`${1*$}rem`,background:"rgba(255,255,255,0.1)",borderRadius:8*$},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:`${1*$}rem`},children:[a.jsx("div",{style:{fontSize:`${1*$}rem`},children:n||""}),a.jsx("div",{style:{fontSize:`${.9*$}rem`,color:e==="SENKA"?"#e94560":e==="AJA"?"#45a2e9":"#a855f7"},children:e==="SENKA"?"":e==="AJA"?"":"Y"})]}),t==="ranked"&&x>0&&a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:`${.5*$}rem`,fontSize:`${.85*$}rem`,color:"#aaa"},children:[a.jsx("span",{style:{fontWeight:"bold",color:o_[kr(x)],fontFamily:"Tamanegi, sans-serif"},children:So[kr(x)]}),a.jsx("span",{style:{fontFamily:"Tamanegi, sans-serif"},children:x})]}),t==="ranked"&&o==="matched"&&T!==void 0&&a.jsxs("div",{style:{marginTop:`${.5*$}rem`,padding:`${.5*$}rem ${1*$}rem`,background:"rgba(0, 0, 0, 0.3)",borderRadius:4*$,fontSize:`${.8*$}rem`,color:"#aaa"},children:[": ",a.jsx("span",{style:{fontWeight:"bold",color:o_[kr(T)],fontFamily:"Tamanegi, sans-serif"},children:So[kr(T)]})," ",T]})]}),o!=="error"&&a.jsx("button",{onClick:re,style:{padding:`${.8*$}rem ${2*$}rem`,fontSize:`${1*$}rem`,background:"transparent",border:"2px solid #e94560",color:"#e94560",borderRadius:8*$,cursor:"pointer",transition:"all 0.2s"},onMouseOver:K=>{K.currentTarget.style.background="#e94560",K.currentTarget.style.color="white"},onMouseOut:K=>{K.currentTarget.style.background="transparent",K.currentTarget.style.color="#e94560"},children:""}),o==="error"&&a.jsx("button",{onClick:i,style:{padding:`${.8*$}rem ${2*$}rem`,fontSize:`${1*$}rem`,background:"#e94560",border:"none",color:"white",borderRadius:8*$,cursor:"pointer"},children:""}),a.jsx("style",{children:`
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `})]})},a_=20,P0=[{id:1,filename:"1_yoroshiku.png",label:"",se:"pa.mp3"},{id:2,filename:"2_nandato.png",label:"",se:"shock.mp3"},{id:3,filename:"3_thank.png",label:"",se:"thanks.mp3"},{id:4,filename:"4_willwin.png",label:"",se:"nt.mp3"},{id:5,filename:"5_dontmind.png",label:"",se:"boyon.mp3"},{id:6,filename:"6_thinking.png",label:"",se:"thinking.mp3"},{id:7,filename:"7_gg.png",label:"GG",se:"kiri.mp3"},{id:8,filename:"8_sorry.png",label:"",se:"gomen.mp3"}],l_=(t,e)=>{const n=P0.find(s=>s.id===t);return n?`/stamps/${e==="AJA"?"azya":e.toLowerCase()}/${n.filename}`:""},c_=t=>{const e=P0.find(n=>n.id===t);return(e==null?void 0:e.se)||null},Jn=[{id:"s_3cats",name:"",cost:2,type:"SPELL",description:"1",flavorText:"",imageUrl:"/cards/chatora_three_cats.png",triggers:[{trigger:"FANFARE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_CHATORA"},{type:"GENERATE_CARD",targetCardId:"TOKEN_SABATORA"},{type:"GENERATE_CARD",targetCardId:"TOKEN_KIJITORA"}]}]},{id:"s_final_cannon",name:"",cost:10,type:"SPELL",description:"1",flavorText:'""""',imageUrl:"/cards/final_cannon.png",triggers:[{trigger:"FANFARE",effects:[{type:"SET_MAX_HP",value:1,targetType:"OPPONENT"}]}]},{id:"c_senka_knuckler",name:"",cost:8,type:"FOLLOWER",attack:3,health:5,description:`[] []
2
[]
1`,flavorText:`

`,imageUrl:"/cards/senka.png",evolvedImageUrl:"/cards/senka_2.png",tags:["Knuckler"],passiveAbilities:["STORM","DOUBLE_ATTACK"],attackEffectType:"IMPACT",triggers:[{trigger:"SUPER_EVOLVE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_FLICKER_JAB"},{type:"GENERATE_CARD",targetCardId:"TOKEN_QUAKE_HOWLING"},{type:"GENERATE_CARD",targetCardId:"TOKEN_BACKHAND_SMASH"}]}]},{id:"c_ruiyu",name:"",cost:7,type:"FOLLOWER",attack:5,health:5,description:`4cyoriena
14`,flavorText:`
`,imageUrl:"/cards/ruiyu.png",evolvedImageUrl:"/cards/ruiyu_2.png",attackEffectType:"BLUE_FIRE",relatedCards:["c_cyoriena"],triggers:[{trigger:"FANFARE",effects:[{type:"HEAL_LEADER",value:4,targetType:"SELF"},{type:"SUMMON_CARD",targetCardId:"c_cyoriena"}]},{trigger:"EVOLVE",effects:[{type:"DESTROY",targetType:"SELECT_FOLLOWER"},{type:"HEAL_LEADER",value:4,targetType:"SELF"}]}]},{id:"c_y",name:"Y",cost:6,type:"FOLLOWER",attack:3,health:3,description:`[]
142
3`,flavorText:"",imageUrl:"/cards/y.png",evolvedImageUrl:"/cards/y_2.png",passiveAbilities:["STEALTH"],attackEffectType:"SUMI",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:4,targetType:"SELECT_FOLLOWER"},{type:"AOE_DAMAGE",value:2,targetType:"ALL_FOLLOWERS"}]},{trigger:"EVOLVE",effects:[{type:"AOE_DAMAGE",value:3,targetType:"ALL_FOLLOWERS"}]}]},{id:"c_tsubumaru",name:"",cost:2,type:"FOLLOWER",attack:1,health:3,description:`[]
1
1`,flavorText:`

`,imageUrl:"/cards/tsubumaru.png",evolvedImageUrl:"/cards/tsubumaru_2.png",passiveAbilities:["WARD"],attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"GENERATE_CARD",targetCardId:"s_resignation_proxy"}]}]},{id:"c_barura",name:"",cost:4,type:"FOLLOWER",attack:3,health:4,description:`1
13`,flavorText:`

`,imageUrl:"/cards/barura.png",evolvedImageUrl:"/cards/barura_2.png",attackEffectType:"FIRE",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:3,targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_CHATORA",name:"",cost:0,type:"FOLLOWER",attack:1,health:1,description:"",flavorText:"",imageUrl:"/cards/chatora.png",attackEffectType:"SLASH"},{id:"TOKEN_SABATORA",name:"",cost:1,type:"FOLLOWER",attack:1,health:2,description:"[]",flavorText:"",passiveAbilities:["RUSH"],imageUrl:"/cards/sabatora.png",attackEffectType:"SLASH"},{id:"TOKEN_KIJITORA",name:"",cost:3,type:"FOLLOWER",attack:2,health:3,description:"[]",flavorText:"",passiveAbilities:["WARD"],imageUrl:"/cards/kijitora.png",attackEffectType:"SLASH"},{id:"TOKEN_RICE",name:"",cost:0,type:"SPELL",description:"1",flavorText:" ",imageUrl:"/cards/rice.png",triggers:[{trigger:"FANFARE",effects:[{type:"HEAL_LEADER",value:1,targetType:"SELF"}]}]},{id:"c_yunagi",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:`1
11`,flavorText:`


`,imageUrl:"/cards/yunagi.png",evolvedImageUrl:"/cards/yunagi_2.png",attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:1,targetType:"SELECT_FOLLOWER"},{type:"GENERATE_CARD",targetCardId:"TOKEN_OOMORI_RICE"}]}]},{id:"TOKEN_OOMORI_RICE",name:"",cost:1,type:"SPELL",description:"3",flavorText:"",imageUrl:"/cards/oomoririce.png",tags:["Token"],triggers:[{trigger:"FANFARE",effects:[{type:"HEAL_LEADER",value:3,targetType:"SELF"}]}]},{id:"c_nayuta",name:"",cost:4,type:"FOLLOWER",attack:3,health:3,description:`[]
1
1`,flavorText:"",imageUrl:"/cards/nayuta.png",evolvedImageUrl:"/cards/nayuta_2.png",attackEffectType:"RAY",passiveAbilities:["WARD"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]},{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]}]},{id:"c_yunagi_ward",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:`[]
1`,imageUrl:"/cards/yunagi.png",evolvedImageUrl:"/cards/yunagi_2.png",passiveAbilities:["WARD"],triggers:[{trigger:"FANFARE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_RICE"}]}]},{id:"c_nayuta_ward",name:"",cost:4,type:"FOLLOWER",attack:3,health:3,description:`[]
1
1`,imageUrl:"/cards/nayuta.png",evolvedImageUrl:"/cards/nayuta_2.png",passiveAbilities:["WARD"],attackEffectType:"RAY",triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]},{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]}]},{id:"c_azya",name:"",cost:8,type:"FOLLOWER",attack:4,health:4,description:`[]
3211-2
1+1/+2[][]0`,flavorText:`
&&`,imageUrl:"/cards/azya.png",evolvedImageUrl:"/cards/azya_2.png",attackEffectType:"THUNDER",passiveAbilities:["AURA"],relatedCards:["c_tsubumaru","c_yunagi","c_nayuta"],triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:3,targetType:"OPPONENT"},{type:"HEAL_LEADER",value:2,targetType:"SELF"},{type:"RANDOM_DESTROY",value:1},{type:"RANDOM_BOUNCE",value:1},{type:"REDUCE_HAND_COST",value:2,conditions:{nameIn:["","",""]}}]},{trigger:"SUPER_EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_tsubumaru"},{type:"SUMMON_CARD",targetCardId:"c_yunagi"},{type:"SUMMON_CARD",targetCardId:"c_nayuta"},{type:"BUFF_STATS",value:1,value2:2,targetType:"ALL_OTHER_FOLLOWERS"},{type:"GRANT_PASSIVE",targetPassive:"WARD",targetType:"ALL_OTHER_FOLLOWERS"},{type:"GRANT_PASSIVE",targetPassive:"RUSH",targetType:"ALL_OTHER_FOLLOWERS"},{type:"GENERATE_CARD",targetCardId:"s_yucho_of_the_abyss"},{type:"GENERATE_CARD",targetCardId:"s_thats_mine"},{type:"GRANT_LEADER_DAMAGE_SHIELD"}]}]},{id:"c_yuki",name:"",cost:3,type:"FOLLOWER",attack:3,health:2,description:`[]
+1/+1`,flavorText:"",imageUrl:"/cards/yuki.png",evolvedImageUrl:"/cards/yuki_2.png",tags:["Knuckler"],passiveAbilities:["RUSH"],attackEffectType:"IMPACT",triggers:[{trigger:"EVOLVE",effects:[{type:"BUFF_STATS",value:1,value2:1,targetType:"ALL_FOLLOWERS"}]}]},{id:"c_white_tsubaki",name:"",cost:4,type:"FOLLOWER",attack:4,health:3,description:`[]

01
1`,flavorText:`
`,imageUrl:"/cards/white_tsubaki.png",evolvedImageUrl:"/cards/white_tsubaki_2.png",tags:["Knuckler"],passiveAbilities:["RUSH","IMMUNE_TO_FOLLOWER_DAMAGE","GUTS_MY_TURN"],attackEffectType:"ICE",relatedCards:["c_shieko"],triggers:[{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_shieko"}]}]},{id:"c_shieko",name:"",cost:2,type:"FOLLOWER",attack:2,health:1,description:`[]
1+2/+2`,flavorText:`
`,imageUrl:"/cards/shieko.png",evolvedImageUrl:"/cards/shieko_2.png",tags:["Knuckler"],passiveAbilities:["RUSH"],attackEffectType:"IMPACT",triggers:[{trigger:"EVOLVE",effects:[{type:"BUFF_STATS",value:2,value2:2,targetType:"SELECT_OTHER_ALLY_FOLLOWER"}]}]},{id:"c_urara",name:"",cost:3,type:"FOLLOWER",attack:2,health:2,description:`[] []
2`,flavorText:`
`,imageUrl:"/cards/urara.png",evolvedImageUrl:"/cards/urara_2.png",passiveAbilities:["WARD","BARRIER"],attackEffectType:"WATER",triggers:[{trigger:"EVOLVE",effects:[{type:"HEAL_LEADER",value:2}]}]},{id:"c_kasuga",name:"",cost:10,type:"FOLLOWER",attack:8,health:8,description:"",flavorText:`

`,imageUrl:"/cards/kasuga.png",evolvedImageUrl:"/cards/kasuga_2.png",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY",targetType:"ALL_OTHER_FOLLOWERS"}]}],attackEffectType:"SLASH"},{id:"c_kyokune",name:"",cost:4,type:"FOLLOWER",attack:4,health:4,description:"1",imageUrl:"/cards/kyokune.jpg",relatedCards:["c_sia"],triggers:[{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_sia"}]}],attackEffectType:"SLASH"},{id:"c_sia",name:"",cost:2,type:"FOLLOWER",attack:2,health:1,description:"21",flavorText:"",imageUrl:"/cards/sia.png",evolvedImageUrl:"/cards/sia_2.png",attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DAMAGE",value:1,value2:2,targetType:"OPPONENT"}]}]},{id:"TOKEN_BACKHAND_SMASH",name:"",cost:0,type:"SPELL",description:"16",flavorText:`10
`,imageUrl:"/cards/BackhandSmash.jpg",tags:["Token"],attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:6,targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_QUAKE_HOWLING",name:"",cost:0,type:"SPELL",description:"2",flavorText:"",imageUrl:"/cards/QuakeHowling.png",tags:["Token"],attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"AOE_DAMAGE",value:2,targetType:"ALL_FOLLOWERS"}]}]},{id:"TOKEN_FLICKER_JAB",name:"",cost:0,type:"SPELL",description:"12",flavorText:`
BHS
`,imageUrl:"/cards/FlickerJab.png",tags:["Token"],attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:2,targetType:"SELECT_FOLLOWER"}]}]},{id:"c_bucchi",name:"",cost:5,type:"FOLLOWER",attack:1,health:3,description:"3",flavorText:`
`,imageUrl:"/cards/bucchi.png",evolvedImageUrl:"/cards/bucchi_2.png",attackEffectType:"SLASH",relatedCards:["c_manary"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_manary"},{type:"SUMMON_CARD",targetCardId:"c_manary"},{type:"SUMMON_CARD",targetCardId:"c_manary"}]}]},{id:"c_valkyrie",name:"",cost:6,type:"FOLLOWER",attack:6,health:6,description:`[] [] []
[]`,flavorText:"",imageUrl:"/cards/valkyrie.png",evolvedImageUrl:"/cards/valkyrie_2.png",passiveAbilities:["WARD","BARRIER","AURA"],attackEffectType:"RAY",triggers:[{trigger:"END_OF_TURN",effects:[{type:"GRANT_PASSIVE",targetPassive:"BARRIER",targetType:"SELF"}]}]},{id:"c_manary",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:"[]",flavorText:"^^",imageUrl:"/cards/manary.png",evolvedImageUrl:"/cards/manary_2.png",tags:["Token"],passiveAbilities:["WARD"],attackEffectType:"WATER"},{id:"c_potechi",name:"",cost:3,type:"FOLLOWER",attack:2,health:3,description:`[]
1`,flavorText:"",imageUrl:"/cards/potechi.png",evolvedImageUrl:"/cards/potechi_2.png",passiveAbilities:["WARD"],attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]}]},{id:"c_mono",name:"Mono",cost:3,type:"FOLLOWER",attack:2,health:1,description:`15
15`,flavorText:"",imageUrl:"/cards/Mono.png",evolvedImageUrl:"/cards/Mono_2.png",attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:5,targetType:"SELECT_FOLLOWER"}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:5,targetType:"SELECT_FOLLOWER"}]}]},{id:"c_sara",name:"sara",cost:7,type:"FOLLOWER",attack:4,health:6,description:`2111
1`,flavorText:"w",imageUrl:"/cards/sara.png",evolvedImageUrl:"/cards/sara_2.png",attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DESTROY",value:2,targetType:"OPPONENT"},{type:"GENERATE_CARD",targetCardId:"TOKEN_SORRY_THE_END",conditions:{minTurn:11}}]},{trigger:"SUPER_EVOLVE",effects:[{type:"DESTROY",targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_SORRY_THE_END",name:"",cost:3,type:"SPELL",description:"553sara1",flavorText:'""',imageUrl:"/cards/sorryTheEnd.png",tags:["Token"],attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"AOE_DAMAGE",value:5,targetType:"ALL_FOLLOWERS"},{type:"DAMAGE",value:5,targetType:"OPPONENT"},{type:"DRAW",value:3},{type:"SUMMON_CARD",targetCardId:"c_sara"}]}]},{id:"c_blue_tsubaki",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:`1
1`,flavorText:"",imageUrl:"/cards/blue_tsubaki.png",evolvedImageUrl:"/cards/blue_tsubaki_2.png",attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"RANDOM_DESTROY",value:1,targetType:"OPPONENT"}]}]},{id:"s_resignation_proxy",name:"",cost:0,type:"SPELL",description:"11",flavorText:"1",imageUrl:"/cards/taisyokudaiko.png",tags:["Token"],attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DESTROY",targetType:"OPPONENT",value:1},{type:"DRAW",value:1}]}]},{id:"s_yucho_of_the_abyss",name:"",cost:0,type:"SPELL",description:"11",flavorText:"",imageUrl:"/cards/yuchooftheabyss.png",tags:["Token"],attackEffectType:"THUNDER",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DAMAGE_BY_TURN",value:1,targetType:"OPPONENT"}]}]},{id:"s_thats_mine",name:"",cost:2,type:"SPELL",description:"1",flavorText:"",imageUrl:"/cards/thatsmine.png",tags:["Token"],attackEffectType:"ICE",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY_AND_GENERATE",value:0,targetType:"SELECT_FOLLOWER"}]}]},{id:"s_tenfubu_yabe_hutari",name:"2",cost:4,type:"SPELL",description:"11",flavorText:"",imageUrl:"/cards/tenfubuyabehutari.png",relatedCards:["c_yuki","c_potechi"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_yuki"},{type:"SUMMON_CARD",targetCardId:"c_potechi"}]}]},{id:"s_samurai_tea",name:"",cost:2,type:"SPELL",description:"1+1/+1",flavorText:'""""',imageUrl:"/cards/samuraitea.png",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1},{type:"BUFF_STATS",value:1,value2:1,targetType:"ALL_FOLLOWERS"}]}]},{id:"s_crazy_knucklers",name:"",cost:5,type:"SPELL",description:"+1/+11",flavorText:`
www www`,imageUrl:"/cards/crazy_knucklers.png",relatedCards:["c_white_tsubaki","c_shieko"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD_BUFFED",targetCardId:"c_white_tsubaki",value:1,value2:1},{type:"SUMMON_CARD_BUFFED",targetCardId:"c_shieko",value:1,value2:1},{type:"DRAW",value:1}]}]},{id:"s_knuckle_four",name:"",cost:10,type:"SPELL",description:"444",flavorText:"",imageUrl:"/cards/knucklefour.png",attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DESTROY",value:4,targetType:"OPPONENT"},{type:"DRAW",value:4},{type:"HEAL_LEADER",value:4,targetType:"SELF"}]}]},{id:"c_amandava",name:"amandava",cost:5,attack:2,health:3,type:"FOLLOWER",description:`21
1`,flavorText:"",imageUrl:"/cards/amandava.png",evolvedImageUrl:"/cards/amandava_2.png",attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_SET_HP",value:2,value2:1,targetType:"OPPONENT"}]},{trigger:"EVOLVE",effects:[{type:"AOE_DAMAGE",value:1,targetType:"ALL_FOLLOWERS"}]}]},{id:"c_alice",name:"",cost:3,attack:1,health:1,type:"FOLLOWER",description:`22
22`,flavorText:"",imageUrl:"/cards/alice.png",evolvedImageUrl:"/cards/alice_2.png",attackEffectType:"FIRE",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DAMAGE",value:2,value2:2,targetType:"OPPONENT"}]},{trigger:"EVOLVE",effects:[{type:"RANDOM_DAMAGE",value:2,value2:2,targetType:"OPPONENT"}]}]},{id:"c_yuri",name:"",cost:5,type:"FOLLOWER",attack:3,health:3,description:`1
13`,flavorText:`
`,imageUrl:"/cards/yuri.png",evolvedImageUrl:"/cards/yuri_2.png",attackEffectType:"WATER",relatedCards:["TOKEN_SUIHYORYU"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"TOKEN_SUIHYORYU"}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:3,targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_SUIHYORYU",name:"",cost:5,type:"FOLLOWER",attack:4,health:4,description:`[] []
`,flavorText:"",imageUrl:"/cards/suihyoryu.png",evolvedImageUrl:"/cards/suihyoryu.png",tags:["Token"],passiveAbilities:["RUSH","WARD"],attackEffectType:"ICE",triggers:[{trigger:"START_OF_TURN",effects:[{type:"DESTROY_SELF"}]}]},{id:"c_cyoriena",name:"cyoriena",cost:2,type:"FOLLOWER",attack:1,health:2,description:`[] []
HP2
`,flavorText:"7",imageUrl:"/cards/cyoriena.png",evolvedImageUrl:"/cards/cyoriena_2.png",tags:["Token"],passiveAbilities:["WARD","BARRIER"],attackEffectType:"RAY",triggers:[{trigger:"END_OF_TURN",effects:[{type:"HEAL_LEADER",value:2,targetType:"SELF"}]},{trigger:"EVOLVE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_TSUBASA"}]}]},{id:"TOKEN_TSUBASA",name:"",cost:1,type:"SPELL",description:"1[]",flavorText:"",imageUrl:"/cards/tsubasa.png",tags:["Token"],triggers:[{trigger:"FANFARE",effects:[{type:"GRANT_PASSIVE",targetPassive:"STORM",targetType:"SELECT_ALLY_FOLLOWER"}]}]},{id:"c_yamato",name:"",cost:5,type:"FOLLOWER",attack:5,health:1,description:"[]",imageUrl:"/cards/yamato.jpg",passiveAbilities:["STORM"],attackEffectType:"SLASH"},{id:"c_yoruka",name:"yoRuka",cost:8,type:"FOLLOWER",attack:5,health:5,description:`1
 8yoRuka1
2`,flavorText:"Y",imageUrl:"/cards/yoRuka.png",evolvedImageUrl:"/cards/yoRuka_2.png",attackEffectType:"SUMI",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY",targetType:"SELECT_FOLLOWER"}]},{trigger:"LAST_WORD",effects:[{type:"SUMMON_CARD",targetCardId:"c_yoruka",necromance:8}]},{trigger:"SUPER_EVOLVE",effects:[{type:"RANDOM_DESTROY",value:2,targetType:"OPPONENT"}]}]},{id:"c_haruka",name:"",cost:7,type:"FOLLOWER",attack:2,health:3,description:`[]
[]1
4
1 4+2/+0`,flavorText:"",imageUrl:"/cards/haruka.png",evolvedImageUrl:"/cards/haruka_2.png",passiveAbilities:["STEALTH"],attackEffectType:"SLASH",relatedCards:["c_yuka","c_setsuna"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD_RUSH",targetCardId:"c_yuka"},{type:"SUMMON_CARD",targetCardId:"c_setsuna"}]},{trigger:"LAST_WORD",effects:[{type:"ADD_GRAVEYARD",value:4}]},{trigger:"SUPER_EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_setsuna"},{type:"BUFF_STATS",value:2,value2:0,targetType:"ALL_OTHER_FOLLOWERS",necromance:4}]}]},{id:"c_setsuna",name:"",cost:3,type:"FOLLOWER",attack:1,health:1,description:`[] []
-12`,flavorText:"",imageUrl:"/cards/setsuna.png",evolvedImageUrl:"/cards/setsuna_2.png",passiveAbilities:["STORM","BANE"],attackEffectType:"SUMI",triggers:[{trigger:"LAST_WORD",effects:[{type:"BUFF_STATS",value:-1,value2:0,targetType:"RANDOM_FOLLOWER"},{type:"ADD_GRAVEYARD",value:2}]}]},{id:"c_yuka",name:"",cost:5,type:"FOLLOWER",attack:1,health:6,description:`[] []
1
3
132`,flavorText:"",imageUrl:"/cards/yuka.png",evolvedImageUrl:"/cards/yuka_2.png",passiveAbilities:["WARD","AURA"],attackEffectType:"SHOT",relatedCards:["c_setsuna"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_setsuna"}]},{trigger:"LAST_WORD",effects:[{type:"ADD_GRAVEYARD",value:3}]},{trigger:"EVOLVE",effects:[{type:"RANDOM_DAMAGE",value:3,value2:1,targetType:"OPPONENT"},{type:"RANDOM_DAMAGE",value:3,value2:1,targetType:"OPPONENT"}]}]},{id:"s_hayakikoto",name:"",cost:4,type:"SPELL",description:"21",flavorText:"",imageUrl:"/cards/hayakikoto.png",relatedCards:["c_setsuna"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_setsuna"},{type:"SUMMON_CARD",targetCardId:"c_setsuna"},{type:"DRAW",value:1}]}]},{id:"s_keishou",name:"",cost:9,type:"SPELL",description:"1-9",flavorText:`
`,imageUrl:"/cards/keisyopower.png",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY_AND_GENERATE",targetType:"RANDOM_ENEMY_FOLLOWER",value:-9}]}]},{id:"s_night_parade",name:"",cost:10,type:"SPELL",description:` 41
+1/+0`,flavorText:"",imageUrl:"/cards/nightparade.png",relatedCards:["c_setsuna"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD_FILL_BOARD",targetCardId:"c_setsuna",necromance:4},{type:"BUFF_STATS",value:1,value2:0,targetType:"ALL_FOLLOWERS"}]}]}];function O0(t){let e=t;return()=>(e=(e*1664525+1013904223)%4294967296,e/4294967296)}function jO(t,e){let n=t.length,r;for(;n!=0;)r=Math.floor(e()*n),n--,[t[n],t[r]]=[t[r],t[n]];return t}function $O(t){var s;const e=t.players.p1,n=t.players.p2;return[t.turnCount,t.activePlayerId,e.hp,e.maxHp,e.pp,e.maxPp,e.sep,e.evolutionsUsed,n.hp,n.maxHp,n.pp,n.maxPp,n.sep,n.evolutionsUsed,e.board.map(i=>i?`${i.id}_${i.instanceId}_${i.currentHealth}_${i.hasBarrier?"B":""}`:"null").join(","),n.board.map(i=>i?`${i.id}_${i.instanceId}_${i.currentHealth}_${i.hasBarrier?"B":""}`:"null").join(","),e.hand.length,n.hand.length,((s=t.pendingEffects)==null?void 0:s.length)||0,t.rngSeed].join("|")}const PS=[{cardId:"c_senka_knuckler",count:3},{cardId:"c_yuki",count:3},{cardId:"c_white_tsubaki",count:3},{cardId:"c_shieko",count:3},{cardId:"s_samurai_tea",count:3},{cardId:"c_bucchi",count:2},{cardId:"c_valkyrie",count:1},{cardId:"c_potechi",count:3},{cardId:"s_tenfubu_yabe_hutari",count:3},{cardId:"s_crazy_knucklers",count:2},{cardId:"c_sia",count:2},{cardId:"c_mono",count:3},{cardId:"c_ruiyu",count:1},{cardId:"c_kasuga",count:1},{cardId:"c_y",count:2},{cardId:"c_sara",count:1},{cardId:"s_knuckle_four",count:1},{cardId:"c_blue_tsubaki",count:3}],OS=[{cardId:"c_azya",count:3},{cardId:"c_ruiyu",count:2},{cardId:"c_y",count:2},{cardId:"c_sara",count:2},{cardId:"c_urara",count:3},{cardId:"c_yunagi",count:3},{cardId:"c_tsubumaru",count:3},{cardId:"c_nayuta",count:3},{cardId:"c_yuri",count:2},{cardId:"c_alice",count:3},{cardId:"c_kasuga",count:1},{cardId:"c_barura",count:3},{cardId:"c_valkyrie",count:3},{cardId:"s_3cats",count:2},{cardId:"s_final_cannon",count:1},{cardId:"c_amandava",count:2},{cardId:"c_mono",count:2}],LS=[{cardId:"c_yoruka",count:3},{cardId:"c_y",count:3},{cardId:"c_haruka",count:3},{cardId:"c_yuka",count:3},{cardId:"c_setsuna",count:3},{cardId:"s_hayakikoto",count:3},{cardId:"s_night_parade",count:1},{cardId:"c_kasuga",count:1},{cardId:"c_yunagi",count:3},{cardId:"c_tsubumaru",count:3},{cardId:"c_nayuta",count:3},{cardId:"c_mono",count:3},{cardId:"c_ruiyu",count:1},{cardId:"c_sara",count:1},{cardId:"s_3cats",count:2},{cardId:"c_yuri",count:2},{cardId:"c_sia",count:2}];function Br(t){const e=Jn.find(n=>n.id===t);return e||Jn.find(n=>n.name===t)}function DS(){return Jn.map(t=>t.name).sort((t,e)=>e.length-t.length)}function Oc(t){return{STORM:"",RUSH:"",WARD:"",BARRIER:"",AURA:"",STEALTH:"",BANE:"",DOUBLE_ATTACK:"",IMMUNE_TO_FOLLOWER_DAMAGE:"",GUTS_MY_TURN:""}[t]||t}function FO(t,e){const n=[];let r=0;return t.forEach(s=>{const i=Br(s.cardId);if(i)for(let o=0;o<s.count;o++)n.push({...i,id:`${e}_c${r}`,instanceId:`inst_${e}_c${r}`}),r++;else console.warn(`Card definition not found: ${s.cardId}`)}),n}function u_(t,e,n,r){const i=FO(n==="SENKA"?PS:n==="AJA"?OS:LS,t);return{id:t,name:e,class:n,hp:a_,maxHp:a_,pp:0,maxPp:0,sep:2,deck:jO(i,r),hand:[],graveyard:[],board:[],evolutionsUsed:0,canEvolveThisTurn:!1,extraPpUsedEarly:!1,extraPpUsedLate:!1,extraPpActive:!1}}function su(t,e,n,r,s,i=!0){const o=Math.floor(Math.random()*1e6),l=O0(o),c=u_("p1",t,e,l),u=u_("p2",n,r,l);c.hand=c.deck.splice(0,4),u.hand=u.deck.splice(0,4);let d,h;return i?(d="p1",h=t,c.maxPp=1,c.pp=1,u.maxPp=0,u.pp=0):(d="p2",h=n,c.maxPp=0,c.pp=0,u.maxPp=1,u.pp=1),{phase:"INIT",rngSeed:Math.floor(l()*1e6),activePlayerId:d,firstPlayerId:d,players:{p1:c,p2:u},turnCount:1,pendingEffects:[],logs:[` 1 - ${h} `],winnerId:void 0}}function Dp(t){return t==="p1"?"p2":"p1"}function UO(t,e,n,r,s,i){var h,f,_,R,k,B,x,E,T,p,$,C,re,Y,K,ce,me,Se,fe,te,w;let o={...t,players:{p1:{...t.players.p1,hand:[...t.players.p1.hand],deck:[...t.players.p1.deck],board:t.players.p1.board.map(S=>S?{...S,passiveAbilities:S.passiveAbilities?[...S.passiveAbilities]:[]}:null),graveyard:[...t.players.p1.graveyard]},p2:{...t.players.p2,hand:[...t.players.p2.hand],deck:[...t.players.p2.deck],board:t.players.p2.board.map(S=>S?{...S,passiveAbilities:S.passiveAbilities?[...S.passiveAbilities]:[]}:null),graveyard:[...t.players.p2.graveyard]}},logs:[...t.logs||[]]};const l=O0(o.rngSeed||999);o.rngSeed=Math.floor(l()*1e6);const c=Dp(e),u=S=>{for(const A of["p1","p2"]){const y=o.players[A].board.findIndex(g=>(g==null?void 0:g.instanceId)===S);if(y!==-1&&o.players[A].board[y])return{card:o.players[A].board[y],player:o.players[A],index:y}}return null};if(r.necromance!==void 0&&r.necromance>0&&r.type!=="SUMMON_CARD_FILL_BOARD"){const S=o.players[e];if(S.graveyard.length<r.necromance)return console.log(`[Engine] : ${S.graveyard.length} < ${r.necromance}`),o;const A=S.graveyard.splice(-r.necromance,r.necromance);o.logs.push(`${S.name}  ${r.necromance} `),console.log(`[Engine] : ${A.map(y=>y.name).join(", ")} `)}const d=(S,A)=>{var g;const y=(g=S.triggers)==null?void 0:g.find(I=>I.trigger==="LAST_WORD");if(y){const I=y.effects.map(P=>({sourceCard:S,effect:P,sourcePlayerId:A}));o.pendingEffects=[...o.pendingEffects||[],...I],o.logs.push(`${S.name} `),console.log(`[Engine] processSingleEffect: Last Word triggered for ${S.name}. pendingEffects count: ${o.pendingEffects.length}`)}};switch(r.type){case"DAMAGE":{const S=r.value||0;if(r.targetType==="SELECT_FOLLOWER"&&s){const A=u(s);if(A){const{card:y,player:g,index:I}=A;if(y.hasBarrier)y.hasBarrier=!1,o.logs.push(`${y.name} `);else if(y.currentHealth-=S,o.logs.push(`${n.name}  ${y.name}  ${S} `),y.currentHealth<=0){y.currentHealth=Math.min(0,y.currentHealth);const P=Object.keys(o.players).find(L=>o.players[L]===g)||c;d(y,P),g.graveyard.push(y),g.board[I]=null,o.logs.push(`${y.name} `)}}}else if(r.targetType==="OPPONENT"){const A=o.players[c];if(A.leaderDamageShield)A.leaderDamageShield=!1,o.logs.push(`${n.name}  ${S} `);else{const y=A.board.some(I=>{var P;return(P=I==null?void 0:I.passiveAbilities)==null?void 0:P.includes("LEADER_DAMAGE_CAP")}),g=y?Math.min(S,1):S;A.hp-=g,y&&S>1?o.logs.push(`${n.name}  ${S} 1`):o.logs.push(`${n.name}  ${g} `),A.hp<=0&&(o.winnerId=e,o.logs.push(`${A.name} `))}}break}case"AOE_DAMAGE":{const S=r.value||0;if(r.targetType==="ALL_FOLLOWERS"){const A=o.players[c].board,y=i&&i.length>0?new Set(i):null;A.forEach(I=>{if(I){if(y&&!y.has(I.instanceId))return;I.hasBarrier?(I.hasBarrier=!1,o.logs.push(`${I.name} `)):I.currentHealth-=S}}),A.filter(I=>I&&I.currentHealth<=0).forEach(I=>{I&&(I.currentHealth=Math.min(0,I.currentHealth),d(I,c),o.players[c].graveyard.push(I),o.logs.push(`${I.name} `))}),o.logs.push(`${n.name}  ${S} `),A.forEach((I,P)=>{I&&I.currentHealth<=0&&(A[P]=null)})}break}case"DRAW":{const S=r.value||1,A=o.players[e];for(let y=0;y<S;y++)if(A.deck.length>0){const g=A.deck.pop();g&&(A.hand.length<9?A.hand.push(g):(A.graveyard.push(g),o.logs.push(`${A.name}${g.name}`)))}o.logs.push(`${A.name}  ${S} `);break}case"ADD_GRAVEYARD":{const S=r.value||1,A=o.players[e];for(let y=0;y<S;y++){const g={...n,instanceId:`grave_${o.rngSeed}_${Math.floor(l()*1e3)}_${y}`};A.graveyard.push(g)}o.logs.push(`${A.name}  ${S} `);break}case"HEAL_LEADER":{const S=r.value||0,A=o.players[e];A.hp=Math.min(A.maxHp,A.hp+S),o.logs.push(`${A.name}  ${S} HP`);break}case"DESTROY":{const S=(A,y)=>{var g;return((g=A.passiveAbilities)==null?void 0:g.includes("IMMUNE_TO_DAMAGE_MY_TURN"))===!0&&o.activePlayerId===y};if(r.targetType==="ALL_OTHER_FOLLOWERS"){const A=o.players[c].board,y=[];A.forEach(L=>{L&&(S(L,c)?(y.push(L),o.logs.push(`${L.name} `)):(d(L,c),o.players[c].graveyard.push(L)))}),o.players[c].board=y;const g=o.players[e].board,I=[],P=n.instanceId;g.forEach(L=>{L&&(P&&L.instanceId===P?I.push(L):S(L,e)?(I.push(L),o.logs.push(`${L.name} `)):(d(L,e),o.players[e].graveyard.push(L)))}),o.players[e].board=I,o.logs.push(`${n.name} `)}else if((r.targetType==="SELECT_FOLLOWER"||r.targetType==="SELECT_ALLY_FOLLOWER")&&s){const A=u(s);if(A){const{card:y,player:g,index:I}=A,P=Object.keys(o.players).find(L=>o.players[L].board.includes(y))||"";S(y,P)?o.logs.push(`${y.name} `):(y.currentHealth=1,d(y,P),g.graveyard.push(y),g.board[I]=null,o.logs.push(`${y.name}  ${n.name} `))}}break}case"GENERATE_CARD":{if((h=r.conditions)!=null&&h.minTurn&&t.turnCount<r.conditions.minTurn)break;const S=r.targetCardId,A=Jn.find(y=>y.id===S);if(A){const y=o.players[e],g=`gen_${o.rngSeed}_${Date.now()}_${Math.floor(l()*1e4)}`,I={...A,id:`token_${o.rngSeed}_${Math.floor(l()*1e3)}`,instanceId:g};y.hand.length<9?(y.hand.push(I),o.logs.push(`${y.name}  ${A.name} `)):(y.graveyard.push(I),o.logs.push(`${y.name}${A.name}`))}break}case"REDUCE_HAND_COST":{const S=r.value||0,A=((f=r.conditions)==null?void 0:f.nameIn)||[],y=o.players[e];let g=0;y.hand.forEach(I=>{if(A.includes(I.name)){const P=I.cost,L=Math.max(0,P-S);L!==P&&(I.cost=L,I.baseCost=L,g++)}}),g>0&&o.logs.push(`${n.name} -${S}`);break}case"GRANT_LEADER_DAMAGE_SHIELD":{const S=o.players[e];S.leaderDamageShield=!0,o.logs.push(`${S.name} 0`);break}case"RANDOM_DESTROY":{const S=(I,P)=>{var L;return((L=I.passiveAbilities)==null?void 0:L.includes("IMMUNE_TO_DAMAGE_MY_TURN"))===!0&&o.activePlayerId===P},A=r.value||1,y=r.targetType==="SELF"?e:c,g=o.players[y].board;if(i&&i.length>0)i.forEach(I=>{const P=g.findIndex(L=>(L==null?void 0:L.instanceId)===I);if(P!==-1&&g[P]){const L=g[P];S(L,y)?o.logs.push(`${L.name} `):(L.currentHealth=1,d(L,y),o.players[y].graveyard.push(L),g[P]=null,o.logs.push(`${L.name}  ${n.name} `))}});else{const I=g.map((L,X)=>!L||S(L,y)?-1:X).filter(L=>L!==-1);for(let L=I.length-1;L>0;L--){const X=Math.floor(l()*(L+1));[I[L],I[X]]=[I[X],I[L]]}I.slice(0,A).forEach(L=>{const X=g[L];X&&(X.currentHealth=1,d(X,y),o.players[y].graveyard.push(X),g[L]=null,o.logs.push(`${X.name}  ${n.name} `))})}break}case"RANDOM_SET_HP":{const S=r.value||1,A=r.value2||1,y=r.targetType==="SELF"?e:c,g=o.players[y].board;if(i&&i.length>0)i.forEach(I=>{const P=g.findIndex(L=>(L==null?void 0:L.instanceId)===I);P!==-1&&g[P]&&(g[P].currentHealth=A,o.logs.push(`${g[P].name} HP ${A} `))});else{const I=g.map((L,X)=>L?X:-1).filter(L=>L!==-1);for(let L=I.length-1;L>0;L--){const X=Math.floor(l()*(L+1));[I[L],I[X]]=[I[X],I[L]]}I.slice(0,S).forEach(L=>{const X=g[L];X&&(X.currentHealth=A,o.logs.push(`${X.name} HP ${A} `))})}break}case"RANDOM_DAMAGE":{const S=r.value2||1,A=r.value||0,y=r.targetType==="SELF"?e:c,g=o.players[y].board,I=L=>{const X=g[L];X&&(X.hasBarrier?(X.hasBarrier=!1,o.logs.push(`${X.name} `)):(X.currentHealth-=A,o.logs.push(`${n.name}  ${X.name}  ${A} `)),X.currentHealth<=0&&(X.currentHealth=0,d(X,y),o.players[y].graveyard.push(X),g[L]=null,o.logs.push(`${X.name} `)))},P=new Set;if(i&&i.length>0)i.forEach(L=>{const X=g.findIndex(F=>(F==null?void 0:F.instanceId)===L);if(X!==-1&&g[X])P.add(L),I(X);else{const F=g.map((ye,Ae)=>ye&&!P.has(ye.instanceId)?Ae:-1).filter(ye=>ye!==-1);if(F.length>0){const ye=Math.floor(l()*F.length),Ae=F[ye],Re=g[Ae];P.add(Re.instanceId),I(Ae)}}});else{const L=g.map((F,ye)=>F?ye:-1).filter(F=>F!==-1);for(let F=L.length-1;F>0;F--){const ye=Math.floor(l()*(F+1));[L[F],L[ye]]=[L[ye],L[F]]}L.slice(0,S).forEach(F=>{I(F)})}break}case"RANDOM_DAMAGE_BY_TURN":{const S=r.value||1,A=o.turnCount,y=r.targetType==="SELF"?e:c,g=o.players[y].board,I=P=>{var X;const L=g[P];if(!L)return!1;if(L.hasBarrier)return L.hasBarrier=!1,o.logs.push(`${L.name} `),!0;if(L.currentHealth-=S,o.logs.push(`${n.name}  ${L.name}  ${S} `),L.currentHealth<=0){L.currentHealth=0;const F=Object.keys(o.players).find(Ae=>o.players[Ae]===o.players[y])||y,ye=(X=L.triggers)==null?void 0:X.find(Ae=>Ae.trigger==="LASTWORD");return ye&&ye.effects.forEach(Ae=>{o.pendingEffects.push({sourceCard:L,effect:Ae,sourcePlayerId:F})}),o.players[y].graveyard.push(L),g[P]=null,o.logs.push(`${L.name} `),!1}return!0};if(i&&i.length>0)for(let P=0;P<i.length;P++){const L=i[P],X=g.findIndex(F=>(F==null?void 0:F.instanceId)===L);if(X!==-1&&g[X])I(X);else{const F=g.map((ye,Ae)=>ye?Ae:-1).filter(ye=>ye!==-1);if(F.length>0){const ye=Math.floor(l()*F.length);I(F[ye])}}}else for(let P=0;P<A;P++){const L=g.map((F,ye)=>F?ye:-1).filter(F=>F!==-1);if(L.length===0)break;const X=Math.floor(l()*L.length);I(L[X])}break}case"SET_MAX_HP":{const S=r.value||20;if(r.targetType==="OPPONENT"){const A=o.players[c];A.maxHp=S,A.hp>S&&(A.hp=S)}break}case"SUMMON_CARD":{const S=r.targetCardId,A=Jn.find(y=>y.id===S);if(A){const y=o.players[e];if(y.board.filter(I=>I!==null).length<5){const I={...A,instanceId:`token_${o.rngSeed}_${Math.floor(l()*1e3)}`,canAttack:((_=A.passiveAbilities)==null?void 0:_.includes("STORM"))||((R=A.passiveAbilities)==null?void 0:R.includes("RUSH"))||!1,currentHealth:A.health||1,maxHealth:A.health||1,attack:A.attack||0,currentAttack:A.attack||0,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((k=A.passiveAbilities)==null?void 0:k.includes("BARRIER"))??!1,passiveAbilities:A.passiveAbilities?[...A.passiveAbilities]:[],hadStealth:((B=A.passiveAbilities)==null?void 0:B.includes("STEALTH"))??!1};(x=A.tags)!=null&&x.includes("Knuckler")&&!I.passiveAbilities.includes("STORM")&&y.board.some(L=>(L==null?void 0:L.name)==="")&&(I.passiveAbilities.push("STORM"),I.canAttack=!0,o.logs.push(`${A.name}   `)),y.board.push(I),o.logs.push(`${y.name}  ${A.name} `)}}break}case"SUMMON_CARD_RUSH":{const S=r.targetCardId,A=Jn.find(y=>y.id===S);if(A){const y=o.players[e];if(y.board.filter(I=>I!==null).length<5){const I={...A,instanceId:`token_${o.rngSeed}_${Math.floor(l()*1e3)}`,canAttack:!0,currentHealth:A.health||1,maxHealth:A.health||1,attack:A.attack||0,currentAttack:A.attack||0,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((E=A.passiveAbilities)==null?void 0:E.includes("BARRIER"))??!1,passiveAbilities:A.passiveAbilities?[...A.passiveAbilities]:[],hadStealth:((T=A.passiveAbilities)==null?void 0:T.includes("STEALTH"))??!1};let P=!1;(p=A.tags)!=null&&p.includes("Knuckler")&&!I.passiveAbilities.includes("STORM")&&y.board.some(X=>(X==null?void 0:X.name)==="")&&(I.passiveAbilities.push("STORM"),P=!0,o.logs.push(`${A.name}   `)),!P&&!I.passiveAbilities.includes("RUSH")&&I.passiveAbilities.push("RUSH"),y.board.push(I),o.logs.push(`${y.name}  ${A.name} ${P?"":""}`)}}break}case"SUMMON_CARD_BUFFED":{const S=r.targetCardId,A=Jn.find(I=>I.id===S),y=r.value||0,g=r.value2||0;if(A){const I=o.players[e];if(I.board.filter(L=>L!==null).length<5){const L=A.attack||0,X=A.health||1,F=L+y,ye=X+g,Ae={...A,instanceId:`token_${o.rngSeed}_${Math.floor(l()*1e3)}`,canAttack:!1,currentHealth:ye,maxHealth:ye,health:ye,attack:F,currentAttack:F,baseAttack:L,baseHealth:X,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:(($=A.passiveAbilities)==null?void 0:$.includes("BARRIER"))??!1,passiveAbilities:A.passiveAbilities?[...A.passiveAbilities]:[],hadStealth:((C=A.passiveAbilities)==null?void 0:C.includes("STEALTH"))??!1};(re=A.tags)!=null&&re.includes("Knuckler")&&!Ae.passiveAbilities.includes("STORM")&&I.board.some(Z=>(Z==null?void 0:Z.name)==="")&&(Ae.passiveAbilities.push("STORM"),Ae.canAttack=!0,o.logs.push(`${A.name}   `)),((Y=Ae.passiveAbilities)!=null&&Y.includes("RUSH")||(K=Ae.passiveAbilities)!=null&&K.includes("STORM"))&&(Ae.canAttack=!0),I.board.push(Ae),o.logs.push(`${I.name}  ${A.name} +${y}/+${g}`),o.pendingEffects=[...o.pendingEffects||[],{sourceCard:Ae,effect:{type:"VISUAL_BUFF_ONLY",value:y,value2:g},sourcePlayerId:e}]}}break}case"SUMMON_CARD_FILL_BOARD":{const S=r.targetCardId,A=Jn.find(g=>g.id===S),y=r.necromance||0;if(A){const g=o.players[e];let I=0;for(;!(g.board.filter(X=>X!==null).length>=5);){if(y>0&&g.graveyard.length<y){I===0&&o.logs.push(` ${A.name} `);break}if(y>0){const X=g.graveyard.splice(-y,y);o.logs.push(` ${y} ${X.map(F=>F.name).join(", ")} `)}const L={...A,instanceId:`token_${o.rngSeed}_${Math.floor(l()*1e3)}_${I}`,canAttack:((ce=A.passiveAbilities)==null?void 0:ce.includes("STORM"))||((me=A.passiveAbilities)==null?void 0:me.includes("RUSH"))||!1,currentHealth:A.health||1,maxHealth:A.health||1,attack:A.attack||0,currentAttack:A.attack||0,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((Se=A.passiveAbilities)==null?void 0:Se.includes("BARRIER"))??!1,passiveAbilities:A.passiveAbilities?[...A.passiveAbilities]:[],hadStealth:((fe=A.passiveAbilities)==null?void 0:fe.includes("STEALTH"))??!1};(te=A.tags)!=null&&te.includes("Knuckler")&&!L.passiveAbilities.includes("STORM")&&g.board.some(F=>(F==null?void 0:F.name)==="")&&(L.passiveAbilities.push("STORM"),L.canAttack=!0,o.logs.push(`${A.name}   `)),g.board.push(L),I++,o.logs.push(`${g.name}  ${A.name} `)}I>0&&o.logs.push(` ${I}  ${A.name} `)}break}case"DESTROY_AND_STEAL":{if(r.targetType==="SELECT_FOLLOWER"&&s){const S=u(s);if(S){const{card:A,player:y,index:g}=S,I=Object.keys(o.players).find(X=>o.players[X]===y)||c,P=o.players[e];if(P.board.filter(X=>X!==null).length<5){y.board[g]=null,o.logs.push(`${A.name}  ${n.name} `);const X={...A,instanceId:`stolen_${o.rngSeed}_${Math.floor(l()*1e3)}`,canAttack:!1,currentHealth:A.health||A.currentHealth,maxHealth:A.health||A.maxHealth,currentAttack:A.attack||A.currentAttack,attacksMade:0,turnPlayed:o.turnCount,hasEvolved:!1};P.board.push(X),o.logs.push(`${P.name}  ${X.name} `)}else d(A,I),y.graveyard.push(A),y.board[g]=null,o.logs.push(`${A.name}  ${n.name} `)}}break}case"DESTROY_AND_GENERATE":{let S=null;if(r.targetType==="SELECT_FOLLOWER"&&s)S=u(s);else if(r.targetType==="RANDOM_ENEMY_FOLLOWER"){const y=o.players[c].board.map((g,I)=>({card:g,index:I})).filter(g=>g.card!==null);if(y.length>0){const g=Math.floor(l()*y.length),I=y[g];S={card:I.card,player:o.players[c],index:I.index}}}if(S){const{card:A,player:y,index:g}=S,I=Object.keys(o.players).find(X=>o.players[X]===y)||c;d(A,I),y.graveyard.push(A),y.board[g]=null,o.logs.push(`${A.name}  ${n.name} `);const P=o.players[e],L=Br(A.name);if(L){const X=Math.max(0,L.cost+(r.value||0)),F={...L,instanceId:`generated_${o.rngSeed}_${Math.floor(l()*1e3)}`,baseCost:X,cost:X,attackEffectType:L.attackEffectType};P.hand.push(F);const ye=r.value||0;o.logs.push(`${P.name}  ${F.name} ${ye>=0?"+":""}${ye}`)}}break}case"RETURN_TO_HAND":{const S=o.players[c].board;let A=-1;if(r.targetType==="SELECT_FOLLOWER"&&s?A=S.findIndex(y=>(y==null?void 0:y.instanceId)===s):(r.targetType==="RANDOM_FOLLOWER"||!s)&&S.length>0&&(A=Math.floor(l()*S.length)),A!==-1&&S[A]){const y=S[A];o.players[c].board[A]=null;const g=o.players[c],I=Br(y.id)||Br(y.name),{currentHealth:P,maxHealth:L,canAttack:X,attacksMade:F,hasEvolved:ye,baseAttack:Ae,baseHealth:Re,turnPlayed:Z,hasBarrier:V,attack:Le,health:Ie,...Ge}=y,Ce={...Ge,attack:(I==null?void 0:I.attack)??Le,health:(I==null?void 0:I.health)??Ie};g.hand.length<9?(g.hand.push(Ce),o.logs.push(`${y.name} `)):(g.graveyard.push(Ce),o.logs.push(`${y.name} `))}break}case"RANDOM_BOUNCE":{const S=r.value||1,A=o.players[c].board;for(let y=0;y<S;y++){const g=A.map((Pe,Fe)=>Pe?Fe:-1).filter(Pe=>Pe!==-1);if(g.length===0)break;const I=g[Math.floor(l()*g.length)],P=A[I];A[I]=null;const L=o.players[c],X=Br(P.id)||Br(P.name),{currentHealth:F,maxHealth:ye,canAttack:Ae,attacksMade:Re,hasEvolved:Z,baseAttack:V,baseHealth:Le,turnPlayed:Ie,hasBarrier:Ge,attack:Ce,health:$e,...gt}=P,ue={...gt,attack:(X==null?void 0:X.attack)??Ce,health:(X==null?void 0:X.health)??$e};L.hand.length<9?(L.hand.push(ue),o.logs.push(`${P.name} `)):(L.graveyard.push(ue),o.logs.push(`${P.name} `))}break}case"GRANT_PASSIVE":{const S=r.targetPassive;if(!S)break;if(r.targetType==="SELF"){const A=n;if(A.instanceId){const g=o.players[e].board.find(I=>(I==null?void 0:I.instanceId)===A.instanceId);g&&(S==="BARRIER"?(g.hasBarrier=!0,o.logs.push(`${g.name} `)):(g.passiveAbilities||(g.passiveAbilities=[]),g.passiveAbilities.includes(S)||(g.passiveAbilities.push(S),o.logs.push(`${g.name}  ${Oc(S)} `)),(S==="STORM"||S==="RUSH")&&(g.canAttack=!0)))}}else if((r.targetType==="SELECT_FOLLOWER"||r.targetType==="SELECT_ALLY_FOLLOWER")&&s){const A=u(s);if(A){const{card:y}=A;S==="BARRIER"?(y.hasBarrier=!0,o.logs.push(`${y.name} `)):(y.passiveAbilities||(y.passiveAbilities=[]),y.passiveAbilities.includes(S)||(y.passiveAbilities.push(S),o.logs.push(`${y.name}  ${Oc(S)} `)),(S==="STORM"||S==="RUSH")&&(y.canAttack=!0))}}else if(r.targetType==="ALL_FOLLOWERS"){const A=o.players[e];let y=0;console.log(`[GRANT_PASSIVE] ALL_FOLLOWERS: Player board has ${A.board.filter(g=>g).length} units, condition tag=${(w=r.conditions)==null?void 0:w.tag}`),A.board.forEach(g=>{var I,P,L;if(g){if(console.log(`[GRANT_PASSIVE] Checking: ${g.name}, tags=${g.tags}, passives=${g.passiveAbilities}`),(I=r.conditions)!=null&&I.tag&&!((P=g.tags)!=null&&P.includes(r.conditions.tag))){console.log(`[GRANT_PASSIVE] Skipped ${g.name}: no matching tag`);return}if((L=r.conditions)!=null&&L.nameIn&&!r.conditions.nameIn.includes(g.name)){console.log(`[GRANT_PASSIVE] Skipped ${g.name}: no matching nameIn`);return}S==="BARRIER"?(g.hasBarrier=!0,y++):(g.passiveAbilities||(g.passiveAbilities=[]),g.passiveAbilities.includes(S)||(g.passiveAbilities.push(S),y++,console.log(`[GRANT_PASSIVE] Granted ${S} to ${g.name}`),(S==="STORM"||S==="RUSH")&&(g.canAttack=!0)))}}),y>0&&o.logs.push(`${y} ${Oc(S)} `),console.log(`[GRANT_PASSIVE] Total granted: ${y}`)}else if(r.targetType==="ALL_OTHER_FOLLOWERS"){const A=o.players[e];let y=0;A.board.forEach(g=>{var I,P,L;if(g&&g.instanceId!==n.instanceId){if((I=r.conditions)!=null&&I.tag&&!((P=g.tags)!=null&&P.includes(r.conditions.tag))||(L=r.conditions)!=null&&L.nameIn&&!r.conditions.nameIn.includes(g.name))return;S==="BARRIER"?(g.hasBarrier=!0,y++):(g.passiveAbilities||(g.passiveAbilities=[]),g.passiveAbilities.includes(S)||(g.passiveAbilities.push(S),y++,(S==="STORM"||S==="RUSH")&&(g.canAttack=!0)))}}),y>0&&o.logs.push(`${y} ${Oc(S)} `)}break}case"BUFF_STATS":{const S=r.value||0,A=r.value2||0;if(r.targetType==="ALL_FOLLOWERS")o.players[e].board.forEach(g=>{var I,P,L;if(g){if((I=r.conditions)!=null&&I.tag&&!((P=g.tags)!=null&&P.includes(r.conditions.tag))||(L=r.conditions)!=null&&L.nameIn&&!r.conditions.nameIn.includes(g.name))return;g.baseAttack||(g.baseAttack=g.attack||0),g.baseHealth||(g.baseHealth=g.health||0),g.attack=(g.attack||0)+S,g.currentAttack=(g.currentAttack||0)+S,g.health=(g.health||0)+A,g.maxHealth=(g.maxHealth||0)+A,g.currentHealth=(g.currentHealth||0)+A,o.logs.push(`${g.name}  +${S}/+${A} `)}});else if(r.targetType==="ALL_OTHER_FOLLOWERS")o.players[e].board.forEach(g=>{var I,P,L;if(g&&g.instanceId!==n.instanceId){if((I=r.conditions)!=null&&I.tag&&!((P=g.tags)!=null&&P.includes(r.conditions.tag))||(L=r.conditions)!=null&&L.nameIn&&!r.conditions.nameIn.includes(g.name))return;g.baseAttack||(g.baseAttack=g.attack||0),g.baseHealth||(g.baseHealth=g.health||0),g.attack=(g.attack||0)+S,g.currentAttack=(g.currentAttack||0)+S,g.health=(g.health||0)+A,g.maxHealth=(g.maxHealth||0)+A,g.currentHealth=(g.currentHealth||0)+A,o.logs.push(`${g.name}  +${S}/+${A} `)}});else if((r.targetType==="SELECT_FOLLOWER"||r.targetType==="SELECT_ALLY_FOLLOWER"||r.targetType==="SELECT_OTHER_ALLY_FOLLOWER")&&s){const y=u(s);if(y){const{card:g}=y;g.baseAttack||(g.baseAttack=g.attack||0),g.baseHealth||(g.baseHealth=g.health||0),g.attack=(g.attack||0)+S,g.currentAttack=(g.currentAttack||0)+S,g.health=(g.health||0)+A,g.maxHealth=(g.maxHealth||0)+A,g.currentHealth=(g.currentHealth||0)+A,o.logs.push(`${g.name}  +${S}/+${A} `)}}else if(r.targetType==="RANDOM_FOLLOWER"){const y=o.players[c].board,g=y.map((I,P)=>I?P:-1).filter(I=>I!==-1);if(g.length>0){const I=g[Math.floor(l()*g.length)],P=y[I];P.baseAttack||(P.baseAttack=P.attack||0),P.baseHealth||(P.baseHealth=P.health||0),P.attack=(P.attack||0)+S,P.currentAttack=(P.currentAttack||0)+S,P.health=(P.health||0)+A,P.maxHealth=(P.maxHealth||0)+A,P.currentHealth=(P.currentHealth||0)+A,P.currentAttack<0&&(P.currentAttack=0),P.attack&&P.attack<0&&(P.attack=0);const L=S>=0?`+${S}`:`${S}`,X=A>=0?`+${A}`:`${A}`;o.logs.push(`${P.name}  ${L}/${X} `)}else o.logs.push("")}break}}return o}const BO=t=>{const e=n=>{const r=n.board.some(i=>i&&i.name.includes("")),s=n.hand.map(i=>{var c;const o=i.baseCost!==void 0?i.baseCost:i.cost;let l=o;return r&&((c=i.tags)!=null&&c.includes("Knuckler"))&&(l=Math.max(0,o-2)),i.cost!==l?{...i,cost:l,baseCost:o}:i});return{...n,hand:s}};return{...t,players:{p1:e(t.players.p1),p2:e(t.players.p2)}}},zO=(t,e)=>{let n=HO(t,e);return n=BO(n),n.lastHash=$O(n),n},HO=(t,e)=>{var s,i,o,l,c,u,d,h,f,_,R,k,B,x,E,T,p,$,C,re,Y,K,ce,me,Se;console.log(`[Reducer] Action: ${e.type}, isRemote: ${e.isRemote}`);let n={...t,players:{p1:{...t.players.p1,hand:[...t.players.p1.hand],deck:[...t.players.p1.deck],board:t.players.p1.board.map(fe=>fe?{...fe,passiveAbilities:fe.passiveAbilities?[...fe.passiveAbilities]:[]}:null),graveyard:[...t.players.p1.graveyard]},p2:{...t.players.p2,hand:[...t.players.p2.hand],deck:[...t.players.p2.deck],board:t.players.p2.board.map(fe=>fe?{...fe,passiveAbilities:fe.passiveAbilities?[...fe.passiveAbilities]:[]}:null),graveyard:[...t.players.p2.graveyard]}},logs:[...t.logs||[]]};const r=O0(n.rngSeed||999);switch(n.rngSeed=Math.floor(r()*1e6),e.type){case"START_GAME":return t;case"END_TURN":{const fe=t.activePlayerId,te=n.players[fe];te.extraPpActive&&(te.id!==t.firstPlayerId&&(n.turnCount<=5?te.extraPpUsedEarly=!0:te.extraPpUsedLate=!0),te.extraPpActive=!1);const w=[...n.pendingEffects||[]];te.board.forEach(y=>{y&&y.triggers&&y.triggers.filter(g=>g.trigger==="END_OF_TURN").forEach(g=>{g.effects.forEach(I=>{w.push({sourceCard:y,effect:I,sourcePlayerId:fe})})})});const S=Dp(fe),A=n.players[S];if(A.board.forEach((y,g)=>{y&&y.triggers&&y.triggers.filter(I=>I.trigger==="START_OF_TURN").forEach(I=>{I.effects.forEach(P=>{P.type==="DESTROY_SELF"?y&&(n.players[S].graveyard.push(y),n.players[S].board[g]=null,n.logs.push(`${y.name} `)):w.push({sourceCard:y,effect:P,sourcePlayerId:S})})})}),n.players[S].board=n.players[S].board.filter(Boolean),A.maxPp=Math.min(10,A.maxPp+1),A.pp=A.maxPp,A.deck.length>0){const y=A.deck.pop();y&&(A.hand.length<9?A.hand.push(y):(A.graveyard.push(y),n.logs.push(`${A.name}${y.name}`)))}return A.board=A.board.filter(Boolean),A.board.forEach(y=>{y&&(y.canAttack=!0,y.attacksMade=0,y.turnPlayed=-1)}),A.canEvolveThisTurn=!0,n.activePlayerId=S,n.pendingEffects=w,S===t.firstPlayerId&&(n.turnCount+=1),n.logs.push(` ${n.turnCount} - ${A.name} `),n}case"CONCEDE":{const fe=e.playerId,te=n.players[fe];if(!te)return console.warn(`[Engine] CONCEDE: Unknown playerId: ${fe}. Ignoring.`),t;if(t.phase==="GAME_OVER")return console.warn("[Engine] CONCEDE: Game already over. Ignoring."),t;const w=Dp(fe);return n.phase="GAME_OVER",n.winnerId=w,n.logs.push(`${te.name} `),console.log(`[Engine] CONCEDE: ${fe} surrendered. Winner: ${w}`),n}case"RESOLVE_EFFECT":{if(!n.pendingEffects||n.pendingEffects.length===0)return n;const[fe,...te]=n.pendingEffects;console.log(`[Engine] RESOLVE_EFFECT: Processing ${fe.effect.type} from ${fe.sourceCard.name}. Remaining: ${te.length}`);const w=((s=e.payload)==null?void 0:s.targetId)||fe.targetId;let S=UO(n,fe.sourcePlayerId,fe.sourceCard,fe.effect,w,fe.targetIds);const A=(S.pendingEffects||[]).filter(g=>{var I;return!((I=n.pendingEffects)!=null&&I.includes(g))}),y=[...te,...A];return console.log(`[Engine] RESOLVE_EFFECT done. Remaining: ${te.length}, NewlyAdded: ${A.length}, Final: ${y.length}`),y.length===0&&Object.values(S.players).forEach(g=>{g.board=g.board.filter(Boolean)}),{...S,pendingEffects:y}}case"PLAY_CARD":{if(!e.isRemote&&n.activePlayerId!==e.playerId)return n;const{cardIndex:fe,targetId:te,instanceId:w}=e.payload,S={...n.players.p1,hand:[...n.players.p1.hand],deck:[...n.players.p1.deck],board:[...n.players.p1.board],graveyard:[...n.players.p1.graveyard]},A={...n.players.p2,hand:[...n.players.p2.hand],deck:[...n.players.p2.deck],board:[...n.players.p2.board],graveyard:[...n.players.p2.graveyard]},y=e.playerId==="p1"?S:A;console.log(`[Engine] PLAY_CARD: playerId=${e.playerId}, cardIndex=${fe}, instanceId=${w}, handLength=${y.hand.length}, isRemote=${e.isRemote}`),console.log("[Engine] PLAY_CARD: hand cards:",y.hand.map(Z=>`${Z.name}(${Z.instanceId})`));let g=fe;if(w){const Z=y.hand.findIndex(V=>V.instanceId===w);if(Z>=0)g=Z,console.log(`[Engine] PLAY_CARD: Using instanceId ${w}, found at index ${Z} (was ${fe})`);else return console.log(`[Engine] PLAY_CARD: instanceId ${w} not found in hand!`),n}if(g<0||g>=y.hand.length)return console.log("[Engine] PLAY_CARD: Invalid cardIndex! Returning unchanged state."),n;const I=y.hand[g];let P="";if(te){const V=(e.playerId==="p1"?A:S).board.find(Le=>(Le==null?void 0:Le.instanceId)===te);V&&(P=` (: ${V.name})`)}if(n.logs.push(`${y.name}  ${I.name} ${P}`),y.pp<I.cost)return n;const L=y.board.filter(Z=>Z!==null).length;if(I.type==="FOLLOWER"&&L>=5)return n;const X=y.pp;y.pp-=I.cost,y.extraPpActive&&X-1<I.cost&&(y.id!==t.firstPlayerId&&(n.turnCount<=5?y.extraPpUsedEarly=!0:y.extraPpUsedLate=!0),y.extraPpActive=!1,y.pp<0&&(y.pp=0),console.log("[Engine] PLAY_CARD: Extra PP consumed, marked as used"),n.logs.push(`${y.name} PP`)),y.hand.splice(g,1);let F=I;if(I.type==="FOLLOWER"){const Z={...I,instanceId:e.payload.instanceId||`inst_${n.rngSeed}_${Math.floor(r()*1e3)}`,currentAttack:I.attack||0,currentHealth:I.health||0,maxHealth:I.health||0,canAttack:!1,hasEvolved:!1,attacksMade:0,turnPlayed:n.turnCount,hasBarrier:((i=I.passiveAbilities)==null?void 0:i.includes("BARRIER"))??!1,passiveAbilities:I.passiveAbilities?[...I.passiveAbilities]:[],hadStealth:((o=I.passiveAbilities)==null?void 0:o.includes("STEALTH"))??!1};((l=I.passiveAbilities)!=null&&l.includes("STORM")||(c=I.passiveAbilities)!=null&&c.includes("RUSH"))&&(Z.canAttack=!0),(u=Z.tags)!=null&&u.includes("Knuckler")&&!Z.passiveAbilities.includes("STORM")&&y.board.some(Le=>(Le==null?void 0:Le.name)==="")&&(Z.passiveAbilities.push("STORM"),Z.canAttack=!0,n.logs.push(`${Z.name}   `)),y.board.push(Z),F=Z,Z.name===""&&y.board.forEach(V=>{var Le,Ie;V&&((Le=V.tags)!=null&&Le.includes("Knuckler"))&&V.instanceId!==Z.instanceId&&((Ie=V.passiveAbilities)!=null&&Ie.includes("STORM")||(V.passiveAbilities||(V.passiveAbilities=[]),V.passiveAbilities.push("STORM"),V.canAttack=!0,n.logs.push(`${V.name}   `)))})}else y.graveyard.push({...I,instanceId:`spell_${n.rngSeed}_${Math.floor(r()*1e3)}`});const ye=[];(d=I.triggers)==null||d.filter(Z=>Z.trigger==="FANFARE").forEach(Z=>ye.push(...Z.effects)),(h=I.triggerAbilities)!=null&&h.FANFARE&&ye.push(I.triggerAbilities.FANFARE);let Ae=[...n.pendingEffects||[]];return ye.forEach(Z=>{if(Z.conditions&&Z.conditions.minTurn&&n.turnCount<Z.conditions.minTurn)return;let V;if(Z.targetType==="OPPONENT"||Z.targetType==="SELF"||Z.targetType==="ALL_FOLLOWERS"||Z.targetType==="ALL_OTHER_FOLLOWERS"||Z.type==="RANDOM_DESTROY"||Z.type==="RANDOM_SET_HP"||Z.type==="AOE_DAMAGE"||Z.type==="RANDOM_DAMAGE"||Z.type==="RANDOM_DAMAGE_BY_TURN"){const Ie=e.playerId==="p1"?"p2":"p1",Ge=e.playerId;if(Z.type==="RANDOM_DAMAGE_BY_TURN"){const Ce=Z.targetType==="SELF"?Ge:Ie,$e=n.players[Ce].board,gt=n.turnCount;V=[];for(let ue=0;ue<gt;ue++){const Pe=$e.map((je,nt)=>je?nt:-1).filter(je=>je!==-1);if(Pe.length===0)break;const Fe=Math.floor(r()*Pe.length);V.push($e[Pe[Fe]].instanceId)}}else if(Z.type==="RANDOM_DESTROY"||Z.type==="RANDOM_SET_HP"||Z.type==="RANDOM_DAMAGE"){const Ce=Z.targetType==="SELF"?Ge:Ie,$e=n.players[Ce].board,gt=Z.type==="RANDOM_DAMAGE"?Z.value2||1:Z.value||1,ue=$e.map((Fe,je)=>Fe?je:-1).filter(Fe=>Fe!==-1);for(let Fe=ue.length-1;Fe>0;Fe--){const je=Math.floor(r()*(Fe+1));[ue[Fe],ue[je]]=[ue[je],ue[Fe]]}V=ue.slice(0,gt).map(Fe=>$e[Fe].instanceId)}else if(Z.targetType==="ALL_FOLLOWERS"||Z.type==="AOE_DAMAGE"){const Ce=Z.type==="GRANT_PASSIVE"||Z.type==="BUFF_STATS",$e=Ce?Ge:Ie;V=n.players[$e].board.filter(ue=>ue!==null).map(ue=>ue.instanceId),console.log(`[Engine] Pre-calculated ALL_FOLLOWERS targets (${Ce?"ally":"enemy"}): ${V.length} units`)}else Z.targetType==="ALL_OTHER_FOLLOWERS"&&(V=n.players[Ge].board.filter($e=>$e!==null&&$e.instanceId!==F.instanceId).map($e=>$e.instanceId))}const Le=Z.targetType==="SELECT_FOLLOWER"||Z.targetType==="SELECT_ALLY_FOLLOWER"||Z.targetType==="SELECT_OTHER_ALLY_FOLLOWER";Ae.push({sourceCard:F,effect:Z,sourcePlayerId:e.playerId,targetId:Le?te:void 0,targetIds:V})}),console.log(`[Engine] PLAY_CARD: Queued ${ye.length} effects. Total pending: ${Ae.length}`),{...n,players:{p1:S,p2:A},pendingEffects:Ae}}case"EVOLVE":{const{followerIndex:fe,targetId:te,useSep:w}=e.payload,S={...n.players.p1,hand:[...n.players.p1.hand],deck:[...n.players.p1.deck],board:n.players.p1.board.map(F=>F?{...F,passiveAbilities:F.passiveAbilities?[...F.passiveAbilities]:void 0}:null),graveyard:[...n.players.p1.graveyard]},A={...n.players.p2,hand:[...n.players.p2.hand],deck:[...n.players.p2.deck],board:n.players.p2.board.map(F=>F?{...F,passiveAbilities:F.passiveAbilities?[...F.passiveAbilities]:void 0}:null),graveyard:[...n.players.p2.graveyard]},y=e.playerId==="p1"?S:A,g=y.board[fe];if(!g||g.hasEvolved)return n;const I=e.isRemote;if(console.log(`[Engine] EVOLVE Logic: name=${g.name}, useSep=${w}, isRemote=${I}, turn=${t.turnCount}`),n.logs.push(`${y.name}  ${g.name} ${w?"":""}`),w){if(!I){if(t.turnCount<6)return console.log(`[Engine] Cannot Super Evolve: Turn ${t.turnCount} < 6`),n;if(y.sep<=0)return console.log("[Engine] Cannot Super Evolve: No SEP"),n;if(!y.canEvolveThisTurn)return console.log("[Engine] Cannot Super Evolve: Already evolved this turn"),n}y.sep=Math.max(0,y.sep-1),y.canEvolveThisTurn=!1,g.hasEvolved=!0,g.currentAttack+=3,g.currentHealth+=3,g.maxHealth+=3,g.canAttack=!0;const F=[...g.passiveAbilities||[]];F.includes("IMMUNE_TO_DAMAGE_MY_TURN")||F.push("IMMUNE_TO_DAMAGE_MY_TURN"),!F.includes("STORM")&&!F.includes("RUSH")&&F.push("RUSH"),g.passiveAbilities=F,console.log(`[Engine] Super Evolved ${g.name}! SEP remaining: ${y.sep}`)}else{if(!I){const Ae=e.playerId===t.firstPlayerId?5:4;if(t.turnCount<Ae)return console.log(`[Engine] Cannot Evolve: Turn ${t.turnCount} < ${Ae}`),n;if(y.evolutionsUsed>=2)return console.log("[Engine] Cannot Evolve: Limit reached"),n;if(!y.canEvolveThisTurn)return console.log("[Engine] Cannot Evolve: Already evolved this turn"),n}y.evolutionsUsed+=1,y.canEvolveThisTurn=!1,g.hasEvolved=!0,g.currentAttack+=2,g.currentHealth+=2,g.maxHealth+=2,g.canAttack=!0;const F=[...g.passiveAbilities||[]];!F.includes("STORM")&&!F.includes("RUSH")&&F.push("RUSH"),g.passiveAbilities=F}const P=[];(f=g.triggers)==null||f.filter(F=>F.trigger==="EVOLVE").forEach(F=>P.push(...F.effects)),(_=g.triggerAbilities)!=null&&_.EVOLVE&&P.push(g.triggerAbilities.EVOLVE),w&&((R=g.triggers)==null||R.filter(F=>F.trigger==="SUPER_EVOLVE").forEach(F=>P.push(...F.effects)));let L=[...n.pendingEffects||[]];return P.forEach(F=>{if(F.conditions&&F.conditions.minTurn&&n.turnCount<F.conditions.minTurn)return;let ye;const Ae=e.playerId==="p1"?"p2":"p1",Re=e.playerId;if(F.type==="RANDOM_DESTROY"||F.type==="RANDOM_SET_HP"||F.type==="RANDOM_DAMAGE"){const Z=F.targetType==="SELF"?Re:Ae,V=n.players[Z].board,Le=F.type==="RANDOM_DAMAGE"?F.value2||1:F.value||1,Ie=V.map((Ce,$e)=>Ce?$e:-1).filter(Ce=>Ce!==-1);for(let Ce=Ie.length-1;Ce>0;Ce--){const $e=Math.floor(r()*(Ce+1));[Ie[Ce],Ie[$e]]=[Ie[$e],Ie[Ce]]}ye=Ie.slice(0,Le).map(Ce=>V[Ce].instanceId)}else F.targetType==="ALL_FOLLOWERS"||F.type==="AOE_DAMAGE"?(ye=n.players[Ae].board.filter(V=>V!==null).map(V=>V.instanceId),console.log(`[Engine EVOLVE] Pre-calculated ALL_FOLLOWERS targets: ${ye.length} units`)):F.targetType==="ALL_OTHER_FOLLOWERS"&&(ye=n.players[Re].board.filter(V=>V!==null&&V.instanceId!==g.instanceId).map(V=>V.instanceId));L.push({sourceCard:g,effect:F,sourcePlayerId:e.playerId,targetId:te,targetIds:ye})}),console.log(`[Engine] EVOLVE: Queued ${P.length} effects. Total pending: ${L.length}`),{...n,players:{p1:S,p2:A},pendingEffects:L}}case"ATTACK":{console.log(`[Engine] ATTACK received. Incoming state P1 HP: ${t.players.p1.hp}, P2 HP: ${t.players.p2.hp}`);const{attackerIndex:fe,targetIndex:te,targetIsLeader:w}=e.payload,S={...n.players.p1,board:n.players.p1.board.map(V=>V?{...V,passiveAbilities:V.passiveAbilities?[...V.passiveAbilities]:void 0}:null),graveyard:[...n.players.p1.graveyard]},A={...n.players.p2,board:n.players.p2.board.map(V=>V?{...V,passiveAbilities:V.passiveAbilities?[...V.passiveAbilities]:void 0}:null),graveyard:[...n.players.p2.graveyard]},y=e.playerId==="p1",g=y?S:A,I=y?A:S,P=g.board[fe];if(!P||!P.canAttack)return n;const L=I.board.filter(V=>{var Le,Ie;return V&&((Le=V.passiveAbilities)==null?void 0:Le.includes("WARD"))&&!((Ie=V.passiveAbilities)!=null&&Ie.includes("STEALTH"))}),X=((k=P.passiveAbilities)==null?void 0:k.includes("STEALTH"))||P.hadStealth;if(L.length>0&&!X){if(w)return console.log("[Engine] Attack blocked: Must attack Ward unit first."),n;const V=I.board[te];if(V&&!((B=V.passiveAbilities)!=null&&B.includes("WARD")))return console.log("[Engine] Attack blocked: Must attack Ward unit first."),n}if(w===!1){const V=I.board[te];if(V&&((x=V.passiveAbilities)!=null&&x.includes("STEALTH")))return console.log("[Engine] ATTACK blocked: Target has STEALTH"),n}const F=(E=P.passiveAbilities)==null?void 0:E.includes("RUSH"),ye=(T=P.passiveAbilities)==null?void 0:T.includes("STORM");if(F&&!ye&&w&&P.turnPlayed===n.turnCount)return console.log("[Engine] ATTACK blocked: RUSH unit cannot attack leader on the turn it was played"),n;(p=P.passiveAbilities)!=null&&p.includes("STEALTH")&&(P.passiveAbilities=P.passiveAbilities.filter(V=>V!=="STEALTH"),n.logs.push(`${P.name} `)),P.canAttack=!1,P.attacksMade=(P.attacksMade||0)+1,($=P.passiveAbilities)!=null&&$.includes("DOUBLE_ATTACK")&&P.attacksMade<2&&(P.canAttack=!0);const Ae=P.currentAttack;console.log(`[Engine] Attack: ${P.name} (${Ae}) -> Target (Leader? ${w}). DefHP before: ${I.hp}`);const Re=(V,Le)=>{var Ge;const Ie=(Ge=V.triggers)==null?void 0:Ge.find(Ce=>Ce.trigger==="LAST_WORD");if(Ie){const Ce=Ie.effects.map($e=>({sourceCard:V,effect:$e,sourcePlayerId:Le}));n.pendingEffects=[...n.pendingEffects||[],...Ce],n.logs.push(`${V.name} `),console.log(`[Engine] Last Word triggered for ${V.name}. pendingEffects count: ${n.pendingEffects.length}`)}};if(w){const V="";if(n.logs.push(`${P.name}  ${V} `),I.leaderDamageShield)I.leaderDamageShield=!1,n.logs.push(`${P.name}  ${V}  ${Ae} `);else{const Le=I.board.some(Ge=>{var Ce;return(Ce=Ge==null?void 0:Ge.passiveAbilities)==null?void 0:Ce.includes("LEADER_DAMAGE_CAP")}),Ie=Le?Math.min(Ae,1):Ae;I.hp-=Ie,Le&&Ae>1?n.logs.push(`${P.name}  ${V}  ${Ae} 1`):n.logs.push(`${P.name}  ${V}  ${Ie} `),I.hp<=0&&(n.winnerId=e.playerId)}}else{const V=I.board[te];if(!V)return console.log(`[Engine] Attack target at index ${te} no longer exists. Skipping.`),n;n.logs.push(`${P.name}  ${V.name} `);let Le=Ae;(C=V.passiveAbilities)!=null&&C.includes("IMMUNE_TO_FOLLOWER_DAMAGE")?(Le=0,n.logs.push(`${V.name} `)):V.hasBarrier&&Le>0?(Le=0,V.hasBarrier=!1,n.logs.push(`${V.name} `)):n.logs.push(`${P.name}  ${V.name}  ${Le} `),V.currentHealth-=Le;const Ie=y?"p2":"p1",Ge=((re=V.passiveAbilities)==null?void 0:re.includes("IMMUNE_TO_DAMAGE_MY_TURN"))&&n.activePlayerId===Ie;(Y=P.passiveAbilities)!=null&&Y.includes("BANE")&&V.currentHealth>0&&(Ge?n.logs.push(`${V.name} `):(V.currentHealth=0,V.killedByBane=!0,n.logs.push(`${P.name}  ${V.name} `)));let Ce=V.currentAttack;(K=P.passiveAbilities)!=null&&K.includes("IMMUNE_TO_DAMAGE_MY_TURN")&&(Ce=0,n.logs.push(`${P.name} `)),P.hasBarrier&&Ce>0?(Ce=0,P.hasBarrier=!1,n.logs.push(`${P.name} `)):Ce>0&&n.logs.push(`${V.name}  ${P.name}  ${Ce} `),P.currentHealth-=Ce;const $e=y?"p1":"p2";P.currentHealth<=0&&((ce=P.passiveAbilities)!=null&&ce.includes("GUTS_MY_TURN"))&&n.activePlayerId===$e&&(P.currentHealth=1,n.logs.push(`${P.name} 1`));const gt=((me=P.passiveAbilities)==null?void 0:me.includes("IMMUNE_TO_DAMAGE_MY_TURN"))&&n.activePlayerId===$e;(Se=V.passiveAbilities)!=null&&Se.includes("BANE")&&P.currentHealth>0&&(gt?n.logs.push(`${P.name} `):(P.currentHealth=0,P.killedByBane=!0,n.logs.push(`${V.name}  ${P.name} `)));const ue=V.currentHealth<=0,Pe=P.currentHealth<=0;ue&&(V.currentHealth=Math.min(0,V.currentHealth),I.graveyard.push(V),I.board[te]=null,n.logs.push(`${V.name} `)),Pe&&(P.currentHealth=Math.min(0,P.currentHealth),g.graveyard.push(P),g.board[fe]=null,n.logs.push(`${P.name} `)),ue&&Re(V,y?"p2":"p1"),Pe&&Re(P,y?"p1":"p2")}console.log(`[Engine] Committing state. P1 HP: ${S.hp}, P2 HP: ${A.hp}`);const Z={...n,players:{p1:S,p2:A}};return console.log(`[Engine] After commit. finalState.players.p1.hp: ${Z.players.p1.hp}, finalState.players.p2.hp: ${Z.players.p2.hp}`),Z}case"REINIT_GAME":{const{p1Class:fe,p2Class:te}=e.payload;return console.log(`[Engine] REINIT_GAME: p1=${fe}, p2=${te}`),su("Player 1",fe,"Player 2",te)}case"SYNC_STATE":return console.log("[Engine] SYNC_STATE received"),e.payload;case"UPDATE_PLAYER_NAME":{const{playerId:fe,name:te}=e.payload;return console.log("[Engine] UPDATE_PLAYER_NAME:",fe,te),t.players[fe]?{...t,players:{...t.players,[fe]:{...t.players[fe],name:te}}}:(console.warn("[Engine] UPDATE_PLAYER_NAME: Unknown playerId:",fe),t)}case"TOGGLE_EXTRA_PP":{const fe=e.playerId,te=n.players[fe];if(!(fe!==t.firstPlayerId))return console.log("[Engine] TOGGLE_EXTRA_PP: Only second player can use Extra PP"),t;if(t.activePlayerId!==fe)return console.log("[Engine] TOGGLE_EXTRA_PP: Can only toggle on your turn"),t;if(te.extraPpActive)return te.extraPpActive=!1,te.pp=Math.max(0,te.pp-1),console.log("[Engine] TOGGLE_EXTRA_PP: Deactivated, PP now",te.pp),n;if(n.turnCount<=5){if(te.extraPpUsedEarly)return console.log("[Engine] TOGGLE_EXTRA_PP: Already used in early turns"),t}else if(te.extraPpUsedLate)return console.log("[Engine] TOGGLE_EXTRA_PP: Already used in late turns"),t;return te.extraPpActive=!0,te.pp+=1,console.log("[Engine] TOGGLE_EXTRA_PP: Activated, PP now",te.pp),n}default:return t}},WO=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},Xi=({card:t,onClick:e,style:n,isSelected:r,isPlayable:s,variant:i="normal",turnCount:o,isOnBoard:l,isSpecialSummoning:c,className:u,suppressPassives:d,isMyTurn:h,scale:f=1})=>{const _="currentAttack"in t?t.currentAttack:t.attack,R="currentHealth"in t?t.currentHealth:t.health,k="maxHealth"in t?t.maxHealth:t.health,B="canAttack"in t?t.canAttack:!1,x="turnPlayed"in t?t.turnPlayed:void 0,[E,T]=N.useState(!1);N.useEffect(()=>{if(c&&l){T(!0);const L=setTimeout(()=>T(!1),800);return()=>clearTimeout(L)}},[c,l]);const p="baseAttack"in t?t.baseAttack:void 0,$="baseHealth"in t?t.baseHealth:void 0,C=p!==void 0&&_>p,re=$!==void 0&&(R>$||k>$),Y="hasEvolved"in t?t.hasEvolved:!1,K="evolvedImageUrl"in t?t.evolvedImageUrl:void 0,ce=Y&&K?K:t.imageUrl,me=ce?WO(ce):void 0;let Se=n==null?void 0:n.boxShadow,fe;const te=t.passiveAbilities||t.abilities||[],w=te.includes("WARD"),S=te.includes("AURA"),A=te.includes("STEALTH"),y=t.hasBarrier===!0||te.includes("BARRIER")&&t.hasBarrier!==!1;if(r)Se="0 0 15px rgba(255, 255, 255, 0.8)";else if(s)Se="0 0 10px #48bb78",fe="2px solid #48bb78";else if(B&&h){const L=te.includes("STORM"),X=te.includes("RUSH"),F=o!==void 0&&x!==void 0&&x===o;let ye=!1;L||(F?ye=!0:(o===void 0||x===void 0)&&(ye=X)),ye?Se="0 0 10px #f6e05e":Se="0 0 10px #48bb78"}const g=R<k;if(i==="art-only")return a.jsx("div",{className:"card art-only",style:{width:140,height:200,...n,borderRadius:8,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",background:"#2d3748",position:"relative",boxShadow:"0 4px 6px rgba(0,0,0,0.3)"},children:me?a.jsx("img",{src:me,alt:t.name,draggable:!1,style:{width:"100%",height:"100%",objectFit:"cover"}}):a.jsx("div",{style:{fontSize:"1.5rem",opacity:.5,color:"white",fontWeight:"bold"},children:t.type})});if(i==="mobile-hand"){const X=t.type==="SPELL"?16:6,F=28*f,ye=.85*f;return a.jsxs("div",{className:`card mobile-hand ${u||""}`,style:{width:80,height:115,...n,position:"relative",cursor:e?"pointer":"default",transform:r?"translateY(-8px)":n==null?void 0:n.transform,boxShadow:Se||(n==null?void 0:n.boxShadow),border:fe||(s?"2px solid #48bb78":void 0),transition:"transform 0.2s, box-shadow 0.2s",background:"#1a202c",overflow:"hidden",borderRadius:`${X}px ${X}px 6px 6px`,backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},onClick:e,children:[a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"hidden",borderRadius:`${X}px ${X}px 6px 6px`},children:me?a.jsx("img",{src:me,alt:t.name,draggable:!1,style:{width:"100%",height:"100%",objectFit:"cover"}}):a.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"#4a5568",color:"#a0aec0",fontSize:"0.6rem"},children:t.type})}),a.jsxs("div",{style:{position:"absolute",top:3,left:4,display:"flex",flexDirection:"column",gap:2,zIndex:10},children:[a.jsx("div",{style:{width:F,height:F,borderRadius:"50%",background:"#48bb78",border:"1px solid rgba(255,255,255,0.8)",color:"white",fontSize:`${ye}rem`,fontWeight:900,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.6)"},children:t.cost}),t.type==="FOLLOWER"&&a.jsxs("div",{style:{width:F,height:F,display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[a.jsx("svg",{width:F,height:F,viewBox:"0 0 24 24",fill:"none",style:{position:"absolute",filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.8))"},children:a.jsx("polygon",{points:"12,2 22,22 2,22",fill:"#4299e1",stroke:"rgba(255,255,255,0.8)",strokeWidth:"1",strokeLinejoin:"round"})}),a.jsx("span",{style:{zIndex:1,color:C?"#faf089":"white",fontWeight:"bold",fontSize:`${ye}rem`,textShadow:"0 1px 2px black"},children:_})]}),t.type==="FOLLOWER"&&a.jsxs("div",{style:{width:F,height:F,display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[a.jsx("svg",{width:F,height:F,viewBox:"0 0 24 24",style:{position:"absolute",filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.8))"},children:a.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z",fill:"#c53030",stroke:"rgba(255,255,255,0.8)",strokeWidth:"1"})}),a.jsx("span",{style:{zIndex:1,color:re?"#faf089":g?"#fc8181":"white",fontWeight:"bold",fontSize:`${ye}rem`,textShadow:"0 1px 2px black"},children:R})]})]})]})}const I=t.type==="SPELL"&&!l,P=I?20:8;return a.jsxs("div",{className:`card card-container ${B?"ready":""} ${l?"on-board":""} ${u||""}`,style:{width:140,height:200,...n,position:"relative",cursor:e?"pointer":"default",transform:r?"translateY(-10px)":n==null?void 0:n.transform,boxShadow:Se||(B?"0 0 10px #f6e05e":n==null?void 0:n.boxShadow),border:fe||(s?"2px solid #48bb78":void 0),transition:"transform 0.2s, box-shadow 0.2s",display:"flex",flexDirection:"column",background:"#1a202c",overflow:"visible",animation:E?"cardSummonAppear 0.8s cubic-bezier(0.22, 1, 0.36, 1) forwards":n==null?void 0:n.animation,backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",borderRadius:I?`${P}px ${P}px 8px 8px`:"8px"},onClick:e,children:[!l&&a.jsx("div",{style:{height:20,background:"rgba(0,0,0,0.8)",color:"#e2e8f0",fontSize:t.name.length>10?"0.6rem":"0.7rem",fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid rgba(255,255,255,0.2)",zIndex:2,transform:t.name.length>15?"scaleX(0.9)":"none",borderRadius:I?`${P}px ${P}px 0 0`:"8px 8px 0 0"},children:t.name}),a.jsxs("div",{style:{flex:1,position:"relative",width:"100%",background:"#2d3748",borderRadius:l?"8px":"0 0 8px 8px",minHeight:0},children:[a.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"hidden",borderRadius:l?"8px":"0 0 8px 8px",zIndex:1},children:[me?a.jsx("img",{src:me,alt:t.name,draggable:!1,style:{width:"100%",height:"100%",objectFit:"cover",display:"block"}}):a.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"#4a5568",color:"#a0aec0",fontSize:"0.8rem"},children:t.type}),a.jsx("div",{style:{position:"absolute",bottom:0,left:0,width:"100%",height:40,background:"linear-gradient(to top, rgba(0,0,0,0.8), transparent)",pointerEvents:"none",zIndex:3}})]}),!l&&a.jsx("div",{style:{position:"absolute",top:2*f,left:2*f,width:24*f,height:24*f,borderRadius:"50%",background:"#48bb78",border:`${Math.max(1,2*f)}px solid #fff`,color:"white",fontSize:`${.9*f}rem`,fontWeight:900,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 2px 4px rgba(0,0,0,0.5), inset 0 2px 5px rgba(255,255,255,0.3)",zIndex:10},children:t.cost}),t.type==="FOLLOWER"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{position:"absolute",bottom:l?2*f:40*f,left:2*f,width:32*f,height:32*f,zIndex:10,display:"flex",alignItems:"center",justifyContent:"center"},children:[a.jsxs("svg",{width:40*f,height:40*f,viewBox:"0 0 24 24",fill:"none",style:{position:"absolute",filter:"drop-shadow(0 2px 2px rgba(0,0,0,0.8))"},children:[a.jsx("defs",{children:a.jsxs("linearGradient",{id:"blueGrad",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[a.jsx("stop",{offset:"0%",stopColor:"#63b3ed"}),a.jsx("stop",{offset:"100%",stopColor:"#4299e1"})]})}),a.jsx("polygon",{points:"12,2 22,22 2,22",fill:"url(#blueGrad)",stroke:"white",strokeWidth:"1",strokeLinejoin:"round"})]}),a.jsx("span",{style:{zIndex:11,color:C?"#faf089":"white",fontWeight:"bold",fontSize:`${1.2*f}rem`,textShadow:"0 2px 2px black"},children:_})]}),a.jsxs("div",{style:{position:"absolute",bottom:2*f,right:l?2*f:"auto",left:l?"auto":2*f,width:32*f,height:32*f,zIndex:10,display:"flex",alignItems:"center",justifyContent:"center"},children:[a.jsxs("svg",{width:36*f,height:36*f,viewBox:"0 0 24 24",style:{position:"absolute",filter:"drop-shadow(0 2px 2px rgba(0,0,0,0.8))"},children:[a.jsx("defs",{children:a.jsxs("linearGradient",{id:"redGrad",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[a.jsx("stop",{offset:"0%",stopColor:"#f56565"}),a.jsx("stop",{offset:"100%",stopColor:"#c53030"})]})}),a.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z",fill:"url(#redGrad)",stroke:"white",strokeWidth:"1.5"})]}),a.jsx("span",{style:{zIndex:11,color:re?"#faf089":g?"#fc8181":"white",fontWeight:"bold",fontSize:`${1.2*f}rem`,textShadow:"0 2px 2px black"},children:R})]})]}),l&&a.jsx("div",{style:{position:"absolute",top:-6*f,left:-6*f,right:-6*f,bottom:-6*f,zIndex:50,pointerEvents:"none",opacity:w&&!d?1:0,transition:"opacity 0.2s ease-in-out"},children:a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,animation:"wardPulseLoop 2.5s infinite ease-in-out"},children:a.jsxs("svg",{viewBox:"0 0 100 120",preserveAspectRatio:"none",style:{width:"100%",height:"100%"},children:[a.jsx("defs",{children:a.jsxs("filter",{id:"wardGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{stdDeviation:"2",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsx("path",{d:"M50 2 L96 20 V60 C96 90 50 116 50 116 C50 116 4 90 4 60 V20 Z",fill:"rgba(255, 255, 255, 0.12)",stroke:"#ECC94B",strokeWidth:"3",filter:"url(#wardGlow)"})]})})}),l&&a.jsxs("div",{style:{position:"absolute",top:-5*f,left:-5*f,right:-5*f,bottom:-5*f,zIndex:21,pointerEvents:"none",opacity:y&&!E&&!d?1:0,transition:"opacity 0.2s ease-in-out"},children:[a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,borderRadius:"50%",background:"radial-gradient(ellipse at center, rgba(99, 179, 237, 0.12) 0%, transparent 60%)",animation:"barrierGlowLoop 3s infinite ease-in-out"}}),a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,borderRadius:"50%",border:`${Math.max(1.5,2*f)}px solid rgba(99, 179, 237, 0.9)`,boxShadow:"0 0 6px rgba(66, 153, 225, 0.5), inset 0 0 8px rgba(99, 179, 237, 0.15)",animation:"barrierPulseLoop 3s infinite ease-in-out"}})]}),l&&a.jsx("div",{style:{position:"absolute",top:-6*f,left:-6*f,right:-6*f,bottom:-6*f,zIndex:22,pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center",opacity:S&&!E&&!d?1:0,transition:"opacity 0.2s ease-in-out"},children:a.jsx("div",{style:{width:"100%",height:"100%",position:"relative",animation:"auraPulseLoop 3s infinite ease-in-out"},children:a.jsxs("svg",{viewBox:"0 0 100 100",style:{width:"100%",height:"100%"},children:[a.jsx("defs",{children:a.jsxs("filter",{id:"auraGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{stdDeviation:"1.5",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsx("path",{d:"M40 5 L60 5 L60 30 L95 30 L95 45 L60 45 L60 95 L40 95 L40 45 L5 45 L5 30 L40 30 Z",fill:"rgba(255, 204, 0, 0.2)",stroke:"#f6ad55",strokeWidth:"2.5",filter:"url(#auraGlow)"})]})})}),l&&a.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:13,pointerEvents:"none",overflow:"hidden",borderRadius:"0 0 8px 8px",opacity:A&&!E&&!d?1:0,transition:"opacity 0.2s ease-in-out"},children:[a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:"120%",height:"120%",transform:"translate(-50%, -50%)",background:"radial-gradient(circle, rgba(0, 0, 0, 0.9) 0%, rgba(0, 0, 0, 0.6) 30%, rgba(0, 0, 0, 0.2) 60%, transparent 80%)",filter:"blur(10px)",animation:"stealthInkMove 3s infinite ease-in-out",mixBlendMode:"multiply"}}),a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:"100%",height:"100%",transform:"translate(-50%, -50%)",background:"radial-gradient(circle, rgba(20, 20, 30, 0.85) 0%, rgba(10, 10, 20, 0.4) 40%, transparent 70%)",filter:"blur(8px)",animation:"stealthInkPulse 1.5s infinite ease-in-out",mixBlendMode:"multiply"}}),a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:"70%",height:"70%",transform:"translate(-50%, -50%)",background:"radial-gradient(circle, rgba(255, 255, 255, 0.4) 0%, rgba(200, 200, 200, 0.25) 30%, transparent 60%)",filter:"blur(8px)",animation:"stealthMistMove 4s infinite ease-in-out",mixBlendMode:"screen"}}),a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,boxShadow:"inset 0 0 30px rgba(0, 0, 0, 0.85), 0 0 20px rgba(0, 0, 0, 0.6)",animation:"stealthPulse 1.5s infinite ease-in-out"}})]})]}),E&&a.jsx("div",{style:{position:"absolute",inset:0,borderRadius:8,background:"radial-gradient(circle, rgba(255,255,255,0.8) 0%, transparent 70%)",mixBlendMode:"overlay",animation:"cardSummonFlash 0.8s ease-out forwards",pointerEvents:"none",zIndex:100}}),a.jsx("style",{children:`
                @keyframes cardSummonAppear {
                    0% { opacity: 0; transform: scale(1.5); filter: brightness(2) blur(4px); }
                    100% { opacity: 1; transform: scale(1); filter: brightness(1) blur(0px); }
                }
                @keyframes cardSummonFlash {
                    0% { opacity: 0.8; transform: scale(1.2); }
                    100% { opacity: 0; transform: scale(1); }
                }
                @keyframes wardPulseLoop {
                    0% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(255, 255, 255, 0.5)); }
                    50% { transform: scale(1.08); opacity: 0.5; filter: blur(3px) drop-shadow(0 0 15px rgba(255, 255, 255, 0.8)); }
                    100% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(255, 255, 255, 0.5)); }
                }
                @keyframes barrierPulseLoop {
                    0% { transform: scale(1); opacity: 1; box-shadow: 0 0 8px rgba(66, 153, 225, 0.6), inset 0 0 10px rgba(99, 179, 237, 0.2); }
                    50% { transform: scale(1.03); opacity: 0.85; box-shadow: 0 0 12px rgba(99, 179, 237, 0.8), inset 0 0 15px rgba(99, 179, 237, 0.3); }
                    100% { transform: scale(1); opacity: 1; box-shadow: 0 0 8px rgba(66, 153, 225, 0.6), inset 0 0 10px rgba(99, 179, 237, 0.2); }
                }
                @keyframes barrierGlowLoop {
                    0% { transform: scale(1); opacity: 0.6; }
                    50% { transform: scale(1.05); opacity: 0.4; }
                    100% { transform: scale(1); opacity: 0.6; }
                }
                @keyframes auraPulseLoop {
                    0% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(246, 173, 85, 0.5)); }
                    50% { transform: scale(1.12); opacity: 0.4; filter: blur(4px) drop-shadow(0 0 20px rgba(255, 204, 0, 0.8)); }
                    100% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(246, 173, 85, 0.5)); }
                }
                @keyframes stealthInkMove {
                    0%, 100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 0.7; }
                    25% { transform: translate(-45%, -55%) scale(1.15) rotate(3deg); opacity: 1; }
                    50% { transform: translate(-50%, -50%) scale(0.95) rotate(0deg); opacity: 0.5; }
                    75% { transform: translate(-55%, -45%) scale(1.1) rotate(-3deg); opacity: 0.9; }
                }
                @keyframes stealthInkPulse {
                    0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.8; }
                    50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.4; }
                }
                @keyframes stealthMistMove {
                    0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.5; }
                    25% { transform: translate(-48%, -52%) scale(1.1); opacity: 0.8; }
                    50% { transform: translate(-52%, -48%) scale(1.2); opacity: 0.3; }
                    75% { transform: translate(-50%, -50%) scale(0.9); opacity: 0.7; }
                }
                @keyframes stealthPulse {
                    0%, 100% { opacity: 0.6; box-shadow: inset 0 0 50px rgba(0, 0, 0, 0.9), 0 0 30px rgba(0, 0, 0, 0.7); }
                    50% { opacity: 1; box-shadow: inset 0 0 70px rgba(0, 0, 0, 1), 0 0 40px rgba(0, 0, 0, 0.9); }
                }
                /* 3D flip support - ensure all child elements inherit backface-visibility */
                .card, .card * {
                    backface-visibility: hidden !important;
                    -webkit-backface-visibility: hidden !important;
                }
            `})]})},GO=35e5;function MS(){const[t,e]=D.useState(()=>d_());return D.useEffect(()=>{const n=()=>{e(d_())};return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),t}function d_(){const t=window.innerWidth*window.devicePixelRatio,e=window.innerHeight*window.devicePixelRatio,n=t*e,r=n>GO;let s="HD";return n>8e6?s="4K":n>35e5?s="1440p":n>2e6&&(s="1080p"),{isHighRes:r,isLightMode:r,pixelCount:n,resolution:s}}function VO(t){return t?{glowShadow:(e,n)=>`0 0 ${10*n}px ${e}`,blurAmount:4,enableGlowPulse:!1,dropShadow:e=>`drop-shadow(0 0 ${10*e}px rgba(255,255,255,0.6))`}:{glowShadow:(e,n)=>`
            0 0 ${15*n}px ${e},
            0 0 ${30*n}px ${e}80,
            0 0 ${60*n}px ${e}50
        `,blurAmount:8,enableGlowPulse:!0,dropShadow:e=>`drop-shadow(0 0 ${20*e}px rgba(255,255,255,0.8)) drop-shadow(0 0 ${40*e}px rgba(255,255,255,0.6))`}}const iu=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},Lc=t=>iu(t==="YORUKA"?"/leaders/yoRuka_leader.png":t==="AJA"?"/leaders/azya_leader.png":"/leaders/senka_leader.png"),YO=iu("/assets/VS.png"),Kn=8,dh=240,KO=({myPlayer:t,opponentPlayer:e,isFirstPlayer:n,onComplete:r,scale:s=1,onVsImpact:i,onCoinToss:o,onImpact:l,onOrbLand:c,onFadeInBoard:u,isMobile:d=!1})=>{const[h,f]=D.useState("fade-in"),[_,R]=D.useState(!1),{isLightMode:k}=MS(),B=VO(k),[x,E]=D.useState(1),[T,p]=D.useState(1),[$,C]=D.useState(0),[re,Y]=D.useState(0),[K,ce]=D.useState(1),[me,Se]=D.useState({myX:0,myY:0,opX:0,opY:0}),[fe,te]=D.useState(0),[w,S]=D.useState(0),[A,y]=D.useState([]),g=D.useMemo(()=>{const V=window.innerWidth,Le=window.innerHeight,Ie=s,Ge=(d?280:340)*Ie,Ce=V-Ge,$e=Ge+Ce/2,gt=$e,ue=Le- -20*Ie-dh*Ie/2,Pe=$e,Fe=-20*Ie+dh*Ie/2;return{player:{x:gt,y:ue},opponent:{x:Pe,y:Fe},leaderSize:dh*Ie}},[d,s]),I=D.useMemo(()=>{const V=window.innerWidth,Le=window.innerHeight,Ie=V*.25,Ge=Le*.5,Ce=V*.75,$e=Le*.5;return{myX:Ie,myY:Ge,opX:Ce,opY:$e}},[]),P=k?`0 0 ${10*s}px rgba(103, 232, 249, 0.8)`:`0 0 ${15*s}px rgba(103, 232, 249, 1), 0 0 ${30*s}px rgba(34, 211, 238, 0.8), 0 0 ${60*s}px rgba(6, 182, 212, 0.5)`,L=k?`0 0 ${10*s}px rgba(249, 168, 212, 0.8)`:`0 0 ${15*s}px rgba(249, 168, 212, 1), 0 0 ${30*s}px rgba(244, 114, 182, 0.8), 0 0 ${60*s}px rgba(236, 72, 153, 0.5)`,X=B.enableGlowPulse?"glowPulse 2s ease-in-out infinite":"none";D.useEffect(()=>{const V={"fade-in":500,"leaders-enter":1200,nameplate:800,"vs-display":1500,"coin-toss":1500,"turn-order":1e3,"leader-to-orb":800,"orb-pause":1e3,"orb-fly":900,"leader-appear":600};if(h==="complete"){u==null||u();const Ge=setTimeout(()=>{r()},700);return()=>clearTimeout(Ge)}const Le={"fade-in":"leaders-enter","leaders-enter":"nameplate",nameplate:"vs-display","vs-display":"coin-toss","coin-toss":"turn-order","turn-order":"leader-to-orb","leader-to-orb":"orb-pause","orb-pause":"orb-fly","orb-fly":"leader-appear","leader-appear":"complete"},Ie=setTimeout(()=>{const Ge=Le[h];Ge&&f(Ge)},V[h]||1e3);return()=>clearTimeout(Ie)},[h,r,n]),D.useEffect(()=>{if(h==="vs-display"){const V=setTimeout(()=>{R(!0),i==null||i(),setTimeout(()=>R(!1),300)},800);return()=>clearTimeout(V)}},[h,i]),D.useEffect(()=>{h==="coin-toss"&&(o==null||o())},[h,o]),D.useEffect(()=>{if(h==="leaders-enter"){const V=setTimeout(()=>{l==null||l()},1e3);return()=>clearTimeout(V)}},[h,l]),D.useEffect(()=>{h==="nameplate"&&(l==null||l())},[h,l]),D.useEffect(()=>{if(h==="leader-to-orb"){const Le=Date.now();let Ie;const Ge=()=>{const Ce=Date.now()-Le,$e=Math.min(Ce/800,1),gt=1-Math.pow(1-$e,3);E(1-gt*.7),p(1-gt),C(gt*1.5),Y(Math.min(gt*1.5,1)),$e<1&&(Ie=requestAnimationFrame(Ge))};return Se(I),Ie=requestAnimationFrame(Ge),()=>cancelAnimationFrame(Ie)}},[h,I]),D.useEffect(()=>{if(h==="orb-pause"){const Le=Date.now();let Ie;const Ge=()=>{const Ce=Date.now()-Le,$e=Math.min(Ce/800,1);ce(1-$e),$e<1&&(Ie=requestAnimationFrame(Ge))};return Ie=requestAnimationFrame(Ge),()=>cancelAnimationFrame(Ie)}},[h]),D.useEffect(()=>{if(h==="orb-fly"){const Le=Date.now();let Ie;const Ge=I.myX,Ce=I.myY,$e=I.opX,gt=I.opY,ue=g.player.x,Pe=g.player.y,Fe=g.opponent.x,je=g.opponent.y,nt=()=>{const Et=Date.now()-Le,$t=Math.min(Et/900,1),qe=$t*$t*$t,ln=Ge-200*s,dt=(Ce+Pe)/2+100*s,vn=(1-qe)*(1-qe)*Ge+2*(1-qe)*qe*ln+qe*qe*ue,Wt=(1-qe)*(1-qe)*Ce+2*(1-qe)*qe*dt+qe*qe*Pe,ji=$e+200*s,Bd=(gt+je)/2-100*s,zd=(1-qe)*(1-qe)*$e+2*(1-qe)*qe*ji+qe*qe*Fe,os=(1-qe)*(1-qe)*gt+2*(1-qe)*qe*Bd+qe*qe*je;Se({myX:vn,myY:Wt,opX:zd,opY:os}),C(1.5-qe*1),$t<1&&(Ie=requestAnimationFrame(nt))};return Ie=requestAnimationFrame(nt),()=>cancelAnimationFrame(Ie)}},[h,I,g,s]),D.useEffect(()=>{if(h==="leader-appear"){const Le=Date.now();let Ie;c==null||c(),R(!0),setTimeout(()=>R(!1),300);const Ge=g.player.x,Ce=g.player.y,$e=g.opponent.x,gt=g.opponent.y,ue=24,Pe=[];for(let nt=0;nt<ue;nt++){const Et=nt/ue*360+(Math.random()-.5)*15;Pe.push({id:nt,x:Ge,y:Ce,angle:Et,dist:80+Math.random()*120,size:8+Math.random()*12,delay:Math.random()*.1,color:`hsl(${200+Math.random()*40}, 80%, ${60+Math.random()*20}%)`})}for(let nt=0;nt<ue;nt++){const Et=nt/ue*360+(Math.random()-.5)*15;Pe.push({id:ue+nt,x:$e,y:gt,angle:Et,dist:80+Math.random()*120,size:8+Math.random()*12,delay:Math.random()*.1,color:`hsl(${0+Math.random()*30}, 80%, ${55+Math.random()*20}%)`})}y(Pe);const Fe=setTimeout(()=>{y([])},800),je=()=>{const nt=Date.now()-Le,Et=Math.min(nt/600,1),$t=1-Math.pow(1-Et,3);Y(1-$t),te($t),S($t),Et<1&&(Ie=requestAnimationFrame(je))};return Ie=requestAnimationFrame(je),()=>{cancelAnimationFrame(Ie),clearTimeout(Fe)}}},[h,c,g]);const F=["fade-in","leaders-enter","nameplate","vs-display","coin-toss","turn-order","leader-to-orb","orb-pause","orb-fly","leader-appear","complete"].indexOf(h),ye=F>=3&&F<=9,Ae=F>=0&&F<=7,Re=`polygon(0 0, ${50+Kn}% 0, ${50-Kn}% 100%, 0 100%)`,Z=`polygon(${50+Kn}% 0, 100% 0, 100% 100%, ${50-Kn}% 100%)`;return a.jsxs("div",{style:{position:"fixed",inset:0,background:F>=7?"transparent":"#0a0a0f",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",animation:_?"screenShake 0.3s ease-in-out":void 0,pointerEvents:F>=9?"none":"auto"},children:[a.jsx("div",{style:{position:"absolute",inset:0,background:"black",opacity:h==="fade-in"?1:0,transition:"opacity 0.5s ease-out",pointerEvents:"none",zIndex:1e4}}),Ae&&a.jsxs("div",{style:{opacity:K,transition:"opacity 0.3s"},children:[F>=0&&a.jsxs("div",{style:{position:"absolute",inset:0,clipPath:Re,background:"linear-gradient(135deg, #0a1628 0%, #1a2a4a 50%, #0d1a30 100%)",transform:`translateX(${F>=1?"0":"-100%"})`,transition:"transform 1.2s cubic-bezier(0.22, 1, 0.36, 1)",zIndex:50,overflow:"hidden"},children:[a.jsx("div",{style:{position:"fixed",top:"50%",left:"25%",transform:"translate(-50%, -50%)",opacity:T},children:a.jsx("img",{src:Lc(t.class),alt:t.name,style:{height:"120vh",width:"auto",objectFit:"cover",objectPosition:t.class==="AJA"?"center top":"center",filter:"brightness(0.85) contrast(1.1)",transform:`scale(${x})`,transformOrigin:"center center"}})}),a.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(135deg, rgba(59, 130, 246, 0.3) 0%, transparent 60%)",pointerEvents:"none"}}),F>=2&&F<6&&a.jsx("div",{style:{position:"absolute",bottom:"12%",left:"15%",padding:`${16*s}px ${40*s}px`,background:"rgba(0,0,0,0.85)",borderRadius:8*s,borderLeft:"4px solid #3b82f6",animation:"nameplateSlideUp 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)",whiteSpace:"nowrap",boxShadow:"0 4px 30px rgba(59, 130, 246, 0.4)"},children:a.jsx("div",{style:{color:"white",fontSize:2.2*s+"rem",fontWeight:"bold",textShadow:"0 0 20px rgba(59, 130, 246, 0.8)"},children:t.name})}),F>=5&&F<6&&a.jsx("div",{style:{position:"absolute",top:"10%",left:"15%",padding:`${12*s}px ${32*s}px`,background:n?"rgba(239, 68, 68, 0.9)":"rgba(59, 130, 246, 0.9)",borderRadius:8*s,animation:"turnOrderFadeIn 1s ease-out",boxShadow:n?"0 0 30px rgba(239, 68, 68, 0.6)":"0 0 30px rgba(59, 130, 246, 0.6)"},children:a.jsx("div",{style:{color:"white",fontSize:1.8*s+"rem",fontWeight:"bold",letterSpacing:"0.1em"},children:n?"":""})})]}),F>=0&&a.jsxs("div",{style:{position:"absolute",inset:0,clipPath:Z,background:"linear-gradient(225deg, #280a0a 0%, #4a1a1a 50%, #300d0d 100%)",transform:`translateX(${F>=1?"0":"100%"})`,transition:"transform 1.2s cubic-bezier(0.22, 1, 0.36, 1)",zIndex:50,overflow:"hidden"},children:[a.jsx("div",{style:{position:"fixed",top:"50%",left:"75%",transform:"translate(-50%, -50%)",opacity:T},children:a.jsx("img",{src:Lc(e.class),alt:e.name,style:{height:"120vh",width:"auto",objectFit:"cover",objectPosition:e.class==="AJA"?"center top":"center",filter:"brightness(0.85) contrast(1.1)",transform:`scale(${x})`,transformOrigin:"center center"}})}),a.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(225deg, rgba(239, 68, 68, 0.3) 0%, transparent 60%)",pointerEvents:"none"}}),F>=2&&F<6&&a.jsx("div",{style:{position:"absolute",bottom:"12%",right:"15%",padding:`${16*s}px ${40*s}px`,background:"rgba(0,0,0,0.85)",borderRadius:8*s,borderRight:"4px solid #ef4444",animation:"nameplateSlideUp 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)",whiteSpace:"nowrap",boxShadow:"0 4px 30px rgba(239, 68, 68, 0.4)"},children:a.jsx("div",{style:{color:"white",fontSize:2.2*s+"rem",fontWeight:"bold",textShadow:"0 0 20px rgba(239, 68, 68, 0.8)"},children:e.name})}),F>=5&&F<6&&a.jsx("div",{style:{position:"absolute",top:"10%",right:"15%",padding:`${12*s}px ${32*s}px`,background:n?"rgba(59, 130, 246, 0.9)":"rgba(239, 68, 68, 0.9)",borderRadius:8*s,animation:"turnOrderFadeIn 1s ease-out",boxShadow:n?"0 0 30px rgba(59, 130, 246, 0.6)":"0 0 30px rgba(239, 68, 68, 0.6)"},children:a.jsx("div",{style:{color:"white",fontSize:1.8*s+"rem",fontWeight:"bold",letterSpacing:"0.1em"},children:n?"":""})})]}),F>=1&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{position:"absolute",top:0,left:0,width:4*s,height:"100%",background:"linear-gradient(180deg, #67e8f9 0%, #22d3ee 30%, #06b6d4 50%, #22d3ee 70%, #67e8f9 100%)",boxShadow:P,zIndex:100,animation:X}}),a.jsx("div",{style:{position:"absolute",top:0,left:0,width:`calc(${50+Kn}% + ${2*s}px)`,height:4*s,background:"linear-gradient(90deg, #67e8f9 0%, #22d3ee 30%, #06b6d4 50%, #22d3ee 70%, #67e8f9 100%)",boxShadow:P,zIndex:100,animation:X}}),a.jsx("div",{style:{position:"absolute",bottom:0,left:0,width:`calc(${50-Kn}% + ${2*s}px)`,height:4*s,background:"linear-gradient(90deg, #67e8f9 0%, #22d3ee 30%, #06b6d4 50%, #22d3ee 70%, #67e8f9 100%)",boxShadow:P,zIndex:100,animation:X}}),a.jsxs("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:100,pointerEvents:"none",overflow:"visible"},children:[a.jsxs("defs",{children:[a.jsxs("linearGradient",{id:"cyanGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[a.jsx("stop",{offset:"0%",stopColor:"#67e8f9"}),a.jsx("stop",{offset:"30%",stopColor:"#22d3ee"}),a.jsx("stop",{offset:"50%",stopColor:"#06b6d4"}),a.jsx("stop",{offset:"70%",stopColor:"#22d3ee"}),a.jsx("stop",{offset:"100%",stopColor:"#67e8f9"})]}),a.jsxs("filter",{id:"cyanGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{stdDeviation:B.blurAmount,result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),a.jsx("line",{x1:`${50+Kn-.2}%`,y1:"0",x2:`${50-Kn-.2}%`,y2:"100%",stroke:"url(#cyanGradient)",strokeWidth:4*s,filter:k?void 0:"url(#cyanGlow)",style:{animation:X}})]})]}),F>=1&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{position:"absolute",top:0,right:0,width:4*s,height:"100%",background:"linear-gradient(180deg, #f9a8d4 0%, #f472b6 30%, #ec4899 50%, #f472b6 70%, #f9a8d4 100%)",boxShadow:L,zIndex:100,animation:X,animationDelay:"0.3s"}}),a.jsx("div",{style:{position:"absolute",top:0,right:0,width:`calc(${50-Kn}% + ${2*s}px)`,height:4*s,background:"linear-gradient(90deg, #f9a8d4 0%, #f472b6 30%, #ec4899 50%, #f472b6 70%, #f9a8d4 100%)",boxShadow:L,zIndex:100,animation:X,animationDelay:"0.3s"}}),a.jsx("div",{style:{position:"absolute",bottom:0,right:0,width:`calc(${50+Kn}% + ${2*s}px)`,height:4*s,background:"linear-gradient(90deg, #f9a8d4 0%, #f472b6 30%, #ec4899 50%, #f472b6 70%, #f9a8d4 100%)",boxShadow:L,zIndex:100,animation:X,animationDelay:"0.3s"}}),a.jsxs("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:100,pointerEvents:"none",overflow:"visible"},children:[a.jsxs("defs",{children:[a.jsxs("linearGradient",{id:"pinkGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[a.jsx("stop",{offset:"0%",stopColor:"#f9a8d4"}),a.jsx("stop",{offset:"30%",stopColor:"#f472b6"}),a.jsx("stop",{offset:"50%",stopColor:"#ec4899"}),a.jsx("stop",{offset:"70%",stopColor:"#f472b6"}),a.jsx("stop",{offset:"100%",stopColor:"#f9a8d4"})]}),a.jsxs("filter",{id:"pinkGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{stdDeviation:B.blurAmount,result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),a.jsx("line",{x1:`${50+Kn+.2}%`,y1:"0",x2:`${50-Kn+.2}%`,y2:"100%",stroke:"url(#pinkGradient)",strokeWidth:4*s,filter:k?void 0:"url(#pinkGlow)",style:{animation:X,animationDelay:"0.3s"}})]})]})]}),F>=6&&F<=9&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{position:"fixed",left:me.myX,top:me.myY,transform:`translate(-50%, -50%) scale(${$})`,opacity:re,width:150*s,height:150*s,borderRadius:"50%",background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(100,180,255,0.8) 40%, rgba(59,130,246,0.4) 70%, transparent 100%)",boxShadow:k?`0 0 ${30*s}px rgba(59, 130, 246, 0.8)`:`0 0 ${40*s}px rgba(255,255,255,0.9), 0 0 ${80*s}px rgba(59, 130, 246, 0.8), 0 0 ${120*s}px rgba(59, 130, 246, 0.5)`,zIndex:500,pointerEvents:"none"}}),a.jsx("div",{style:{position:"fixed",left:me.opX,top:me.opY,transform:`translate(-50%, -50%) scale(${$})`,opacity:re,width:150*s,height:150*s,borderRadius:"50%",background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(255,150,150,0.8) 40%, rgba(239,68,68,0.4) 70%, transparent 100%)",boxShadow:k?`0 0 ${30*s}px rgba(239, 68, 68, 0.8)`:`0 0 ${40*s}px rgba(255,255,255,0.9), 0 0 ${80*s}px rgba(239, 68, 68, 0.8), 0 0 ${120*s}px rgba(239, 68, 68, 0.5)`,zIndex:500,pointerEvents:"none"}})]}),F>=9&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{position:"fixed",left:g.player.x,top:g.player.y,transform:`translate(-50%, -50%) scale(${fe})`,opacity:w,width:g.leaderSize,height:g.leaderSize,borderRadius:"50%",overflow:"hidden",border:"4px solid #3182ce",boxShadow:"0 0 20px rgba(49, 130, 206, 0.4)",background:"#1a202c",zIndex:500,pointerEvents:"none"},children:a.jsx("img",{src:Lc(t.class),alt:t.name,style:{width:"100%",height:"100%",objectFit:"cover",objectPosition:t.class==="AJA"?"center top":"center"}})}),a.jsx("div",{style:{position:"fixed",left:g.opponent.x,top:g.opponent.y,transform:`translate(-50%, -50%) scale(${fe})`,opacity:w,width:g.leaderSize,height:g.leaderSize,borderRadius:"50%",overflow:"hidden",border:"4px solid #c53030",boxShadow:"0 0 20px rgba(197, 48, 48, 0.4)",background:"#1a202c",zIndex:500,pointerEvents:"none"},children:a.jsx("img",{src:Lc(e.class),alt:e.name,style:{width:"100%",height:"100%",objectFit:"cover",objectPosition:e.class==="AJA"?"center top":"center"}})})]}),A.map(V=>a.jsx("div",{style:{position:"fixed",left:V.x,top:V.y,width:V.size*s,height:V.size*s,borderRadius:"50%",background:V.color,boxShadow:`0 0 ${V.size*.5*s}px ${V.color}`,pointerEvents:"none",zIndex:600,animation:`landingParticleBurst 0.6s ease-out ${V.delay}s forwards`,transform:"translate(-50%, -50%)","--particle-angle":`${V.angle}deg`,"--particle-dist":`${V.dist*s}px`}},V.id)),ye&&a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",animation:F===3?"vsZoomIn 1.5s cubic-bezier(0.34, 1.56, 0.64, 1)":void 0,opacity:F>=7?Math.max(0,K):1,zIndex:200,pointerEvents:"none"},children:a.jsx("img",{src:YO,alt:"VS",style:{height:300*s,width:"auto",filter:`drop-shadow(0 0 ${20*s}px rgba(255,255,255,0.8)) drop-shadow(0 0 ${40*s}px rgba(255,255,255,0.6))`}})}),F>=4&&F<5&&a.jsx("div",{style:{position:"absolute",top:"20%",left:"50%",transform:"translate(-50%, -50%)",zIndex:150},children:a.jsx("div",{style:{width:100*s,height:100*s,borderRadius:"50%",background:"linear-gradient(45deg, #f6ad55 0%, #fbd38d 100%)",border:"4px solid white",display:"flex",alignItems:"center",justifyContent:"center",fontSize:2*s+"rem",fontWeight:"bold",color:"white",animation:"coinFlip 1.5s ease-in-out",boxShadow:`0 0 ${30*s}px rgba(246, 173, 85, 0.8)`},children:""})}),a.jsx("style",{children:`
                @keyframes screenShake {
                    0%, 100% { transform: translate(0, 0); }
                    10% { transform: translate(-10px, -10px); }
                    20% { transform: translate(10px, 10px); }
                    30% { transform: translate(-10px, 10px); }
                    40% { transform: translate(10px, -10px); }
                    50% { transform: translate(-10px, -10px); }
                    60% { transform: translate(10px, 10px); }
                    70% { transform: translate(-10px, 10px); }
                    80% { transform: translate(10px, -10px); }
                    90% { transform: translate(-10px, 0); }
                }

                @keyframes nameplateSlideUp {
                    0% {
                        transform: translateY(50px);
                        opacity: 0;
                    }
                    60% {
                        transform: translateY(-10px);
                    }
                    100% {
                        transform: translateY(0);
                        opacity: 1;
                    }
                }

                @keyframes vsZoomIn {
                    0% {
                        transform: translate(-50%, -50%) scale(3) translateZ(0);
                        opacity: 0;
                        filter: blur(20px);
                    }
                    50% {
                        transform: translate(-50%, -50%) scale(1.2) translateZ(0);
                        opacity: 1;
                        filter: blur(0px);
                    }
                    100% {
                        transform: translate(-50%, -50%) scale(1) translateZ(0);
                        opacity: 1;
                        filter: blur(0px);
                    }
                }

                @keyframes coinFlip {
                    0% {
                        transform: rotateY(0deg) scale(1);
                    }
                    50% {
                        transform: rotateY(1800deg) scale(1.2);
                    }
                    100% {
                        transform: rotateY(3600deg) scale(1);
                    }
                }

                @keyframes turnOrderFadeIn {
                    0% {
                        opacity: 0;
                        transform: scale(0.5);
                    }
                    50% {
                        transform: scale(1.2);
                    }
                    100% {
                        opacity: 1;
                        transform: scale(1);
                    }
                }

                @keyframes glowPulse {
                    0%, 100% {
                        opacity: 0.8;
                        filter: brightness(1);
                    }
                    50% {
                        opacity: 1;
                        filter: brightness(1.3);
                    }
                }

                @keyframes landingParticleBurst {
                    0% {
                        transform: translate(-50%, -50%) rotate(var(--particle-angle)) translateX(0);
                        opacity: 1;
                    }
                    100% {
                        transform: translate(-50%, -50%) rotate(var(--particle-angle)) translateX(var(--particle-dist));
                        opacity: 0;
                    }
                }
            `})]})},XO=({isVictory:t,loserLeaderRef:e,onComplete:n,onPhaseChange:r,onShakeIntensityChange:s,scale:i=1})=>{const[o,l]=D.useState("start"),[c,u]=D.useState(null),[d,h]=D.useState([]);D.useEffect(()=>{if(e.current){const _=e.current.getBoundingClientRect();u({x:_.left+_.width/2,y:_.top+_.height/2,size:_.width})}},[e]),D.useEffect(()=>{r==null||r(o)},[o,r]),D.useEffect(()=>{const _={start:200,zoom:600,"white-fade":800,explode:1200,"result-text":1800,"fade-out":600};if(o==="complete"){n();return}const R={start:"zoom",zoom:"white-fade","white-fade":"explode",explode:"result-text","result-text":"fade-out","fade-out":"complete"},k=setTimeout(()=>{const B=R[o];B&&l(B)},_[o]||1e3);return()=>clearTimeout(k)},[o,n]),D.useEffect(()=>{if(o==="explode"&&c){const R=Array.from({length:60},(E,T)=>{const p=T/60*360,$=(Math.random()-.5)*12,C=p+$,re=150+Math.random()*250,Y=12+Math.random()*20;return{id:T,x:c.x,y:c.y,angle:C,distance:re,size:Y,delay:Math.random()*.1,duration:.6+Math.random()*.4}});h(R),s==null||s(1);const k=1e3,B=Date.now(),x=setInterval(()=>{const T=(Date.now()-B)/k;if(T>=1)s==null||s(0),clearInterval(x);else{const p=1-Math.pow(T,2);s==null||s(p)}},16);return()=>clearInterval(x)}},[o,c,s]);const f=["start","zoom","white-fade","explode","result-text","fade-out","complete"].indexOf(o);return c?a.jsxs("div",{style:{position:"fixed",inset:0,zIndex:8e3,pointerEvents:"none",overflow:"hidden"},children:[a.jsx("div",{style:{position:"absolute",inset:0,background:"black",opacity:f>=1?f>=5?1:.5:0,transition:"opacity 0.5s ease-out"}}),f>=1&&f<4&&a.jsx("div",{style:{position:"absolute",left:c.x,top:c.y,transform:"translate(-50%, -50%)",width:c.size*1.8,height:c.size*1.8,borderRadius:"50%",background:"radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 60%)",transition:"all 0.4s ease-out"}}),f>=3&&d.map(_=>a.jsx("div",{style:{position:"absolute",left:_.x,top:_.y,width:_.size*i,height:_.size*i,borderRadius:"50%",background:"white",boxShadow:"0 0 15px white, 0 0 30px rgba(255,255,255,0.5)",transform:"translate(-50%, -50%)",animation:`particleFly-${_.id} ${_.duration}s ease-out ${_.delay}s forwards`}},_.id)),f>=3&&a.jsx("style",{children:d.map(_=>{const R=_.angle*Math.PI/180,k=Math.cos(R)*_.distance,B=Math.sin(R)*_.distance;return`
                            @keyframes particleFly-${_.id} {
                                0% {
                                    transform: translate(-50%, -50%) scale(1);
                                    opacity: 1;
                                }
                                100% {
                                    transform: translate(calc(-50% + ${k}px), calc(-50% + ${B}px)) scale(0);
                                    opacity: 0;
                                }
                            }
                        `}).join(`
`)}),f>=4&&f<6&&a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",animation:"resultTextPop 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)"},children:a.jsx("div",{style:{fontSize:`${7*i}rem`,fontWeight:900,fontFamily:"Tamanegi, sans-serif",color:t?"#ffd700":"#718096",textShadow:t?"0 0 30px rgba(255,215,0,0.8), 0 0 60px rgba(255,215,0,0.6), 0 0 90px rgba(255,215,0,0.4), 4px 4px 8px rgba(0,0,0,0.8)":"0 0 20px rgba(113,128,150,0.5), 4px 4px 8px rgba(0,0,0,0.8)",letterSpacing:"0.15em"},children:t?"":"..."})}),a.jsx("style",{children:`
                @keyframes resultTextPop {
                    0% {
                        transform: translate(-50%, -50%) scale(2.5);
                        opacity: 0;
                        filter: blur(20px);
                    }
                    60% {
                        transform: translate(-50%, -50%) scale(0.95);
                        opacity: 1;
                        filter: blur(0px);
                    }
                    100% {
                        transform: translate(-50%, -50%) scale(1);
                        opacity: 1;
                        filter: blur(0px);
                    }
                }
            `})]}):null},QO=({isMyTurn:t,turnCount:e,activePlayerId:n,onTimeUp:r,timerEnabled:s,isGameOver:i=!1,isPaused:o=!1,scale:l=1,buttonSize:c=160,timerDuration:u=60})=>{const[d,h]=D.useState(u),[f,_]=D.useState(!1),[R,k]=D.useState(!1),B=D.useRef(null),x=D.useRef(""),E=D.useRef(0),T=D.useRef(r),p=D.useRef(!1),$=D.useId().replace(/:/g,"_");D.useEffect(()=>{T.current=r},[r]);const C=`${e}-${n}`,re=D.useCallback(()=>{h(u),_(!1),k(!1),E.current=Date.now()+u*1e3,p.current=!1},[u]);if(D.useEffect(()=>{C!==x.current&&(x.current=C,re())},[C,re]),D.useEffect(()=>{if(!s||!t||i||o){B.current&&(clearInterval(B.current),B.current=null);return}return E.current===0&&(E.current=Date.now()+u*1e3),B.current=window.setInterval(()=>{const g=Date.now(),I=Math.max(0,(E.current-g)/1e3);h(I);const P=Math.ceil(I);P<=15&&P>10?(_(!0),k(!1)):P<=10?(_(!0),k(!0)):(_(!1),k(!1)),I<=0&&!p.current&&(p.current=!0,B.current&&(clearInterval(B.current),B.current=null),setTimeout(()=>T.current(),0))},16),()=>{B.current&&(clearInterval(B.current),B.current=null)}},[s,t,i,o,u]),!s||o)return null;const Y=d/u,K=(c/2+12)*l,ce=6*l,me=2*Math.PI*K,Se=-me*(1-Y),fe=Math.ceil(d),te=R?Math.min(1,(10-fe)/10):0,w=Math.max(.05,.15-te*.1);let S="#4299e1";f&&!R?S="#f6ad55":R&&(S="#e53e3e");const A=20*l,y=K*2+ce+A*2;return a.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:y,height:y,pointerEvents:"none",zIndex:10,animation:R?`timerShake${$} ${w}s ease-in-out infinite`:void 0},children:[a.jsxs("svg",{width:y,height:y,style:{position:"absolute",top:0,left:0,overflow:"visible"},children:[a.jsx("circle",{cx:y/2,cy:y/2,r:K,fill:"none",stroke:"rgba(0,0,0,0.3)",strokeWidth:ce}),a.jsx("circle",{cx:y/2,cy:y/2,r:K,fill:"none",stroke:S,strokeWidth:ce,strokeLinecap:"round",strokeDasharray:me,strokeDashoffset:Se,style:{transform:"rotate(-90deg)",transformOrigin:"center"}}),f&&a.jsx("circle",{cx:y/2,cy:y/2,r:K,fill:"none",stroke:S,strokeWidth:ce*3,opacity:.4,style:{filter:`blur(${12*l}px)`,animation:R?`timerPulse${$} 0.5s ease-in-out infinite`:`timerPulse${$} 1s ease-in-out infinite`}})]}),a.jsx("style",{children:`
                @keyframes timerPulse${$} {
                    0%, 100% { opacity: 0.4; }
                    50% { opacity: 0.7; }
                }
                @keyframes timerShake${$} {
                    0%, 100% { transform: translate(-50%, -50%) translate(0, 0); }
                    25% { transform: translate(-50%, -50%) translate(${2*l}px, ${-2*l}px); }
                    50% { transform: translate(-50%, -50%) translate(${-2*l}px, ${2*l}px); }
                    75% { transform: translate(-50%, -50%) translate(${2*l}px, ${1*l}px); }
                }
            `})]})};function JO(t,e){const[n,r]=D.useState(null),[s,i]=D.useState(""),[o,l]=D.useState(!1),[c,u]=D.useState(null),[d,h]=D.useState(!1);return D.useEffect(()=>{if(t==="CPU")return;const f=new RS;return h(!0),(async()=>{try{const R=await f.connect(t==="JOIN"?e:void 0);i(R),r(f),f.onConnection(()=>{console.log("[useGameNetwork] Connection established!"),l(!0),h(!1)})}catch(R){u(R.toString()),h(!1)}})(),()=>{f.disconnect()}},[t,e]),{adapter:n,myId:s,connected:o,connecting:d,error:c,setConnected:l}}function f_(t,e,n){return!(!t.canEvolveThisTurn||t.evolutionsUsed>=2||e<(n?5:4))}function h_(t,e,n){return!(!t.canEvolveThisTurn||t.sep<=0||e<(n?7:6))}const et=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},qO=et("/leaders/azya_leader.png"),ZO=et("/leaders/senka_leader.png"),eL=et("/leaders/yoRuka_leader.png"),tL=et("/sleeves/azya_sleeve.png"),nL=et("/sleeves/senka_sleeve.png"),rL=et("/sleeves/yoruka_sleeve.png"),Va=t=>t==="YORUKA"?eL:t==="AJA"?qO:ZO,si=t=>t==="YORUKA"?rL:t==="AJA"?tL:nL,sL=1920,NS=1080,iL=()=>{const[t,e]=D.useState({scale:1,toGameX:r=>r,toGameY:r=>r}),n=D.useCallback(()=>{const r=window.visualViewport?window.visualViewport.width:window.innerWidth,s=window.visualViewport?window.visualViewport.height:window.innerHeight;let i=Math.min(r/sL,s/NS);i*=1.5,e({scale:i,toGameX:c=>c,toGameY:c=>c})},[]);return D.useEffect(()=>{n(),window.addEventListener("resize",n),window.addEventListener("orientationchange",()=>{setTimeout(n,150)}),window.visualViewport&&window.visualViewport.addEventListener("resize",n);const r=()=>{document.visibilityState==="visible"&&setTimeout(n,100)};return document.addEventListener("visibilitychange",r),()=>{window.removeEventListener("resize",n),window.removeEventListener("orientationchange",n),window.visualViewport&&window.visualViewport.removeEventListener("resize",n),document.removeEventListener("visibilitychange",r)}},[n]),t},rn=90,bn=120,ii=rn+18,Qi=240,oL=({x:t,y:e,onComplete:n,scale:r=1})=>{N.useEffect(()=>{const i=setTimeout(n,2e3);return()=>clearTimeout(i)},[n]);const s=N.useMemo(()=>Array(20).fill(0).map((i,o)=>({id:o,angle:Math.random()*360,dist:(30+Math.random()*60)*r,size:(10+Math.random()*15)*r,delay:Math.random()*.5})),[r]);return a.jsxs("div",{style:{position:"absolute",left:t,top:e,pointerEvents:"none",zIndex:6e3},children:[a.jsx("style",{children:`
                @keyframes healGlowFade {
                    0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; filter: blur(10px); }
                    30% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.8; filter: blur(15px); }
                    100% { transform: translate(-50%, -50%) scale(1.6); opacity: 0; filter: blur(30px); }
                }
                @keyframes healParticleRise {
                    0% { transform: translate(-50%, -50%) rotate(var(--angle)) translate(0, 0) scale(0); opacity: 0; }
                    20% { transform: translate(-50%, -50%) rotate(var(--angle)) translate(0, 0) opacity: 0.7; }
                    100% { transform: translate(-50%, -50%) rotate(var(--angle)) translate(calc(var(--dist) * 1px), 0) scale(1.5); opacity: 0; }
                }
            `}),a.jsx("div",{style:{position:"absolute",left:0,top:0,width:150*r,height:150*r,background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(200,255,240,0.5) 50%, transparent 80%)",borderRadius:"50%",transform:"translate(-50%, -50%)",animation:"healGlowFade 1.5s ease-out forwards",filter:`blur(${8*r}px)`}}),s.map(i=>a.jsx("div",{style:{position:"absolute",left:0,top:0,width:i.size,height:i.size,background:"rgba(255,250,240,0.6)",borderRadius:"50%",filter:`blur(${4*r}px)`,"--angle":`${i.angle}deg`,"--dist":i.dist,animation:`healParticleRise 1.2s ease-out ${i.delay}s forwards`,pointerEvents:"none"}},i.id))]})},aL=({x:t,y:e,atkBuff:n,hpBuff:r,onComplete:s})=>{N.useEffect(()=>{const _=setTimeout(s,1500);return()=>clearTimeout(_)},[s]);const i=n<0||r<0,o=i?"radial-gradient(circle, rgba(180,50,50,0.9) 0%, rgba(150,30,30,0.4) 50%, transparent 80%)":"radial-gradient(circle, rgba(255,230,100,0.9) 0%, rgba(255,200,50,0.4) 50%, transparent 80%)",l=i?"#ff4444":"#ffd93d",c="#ffd93d",u="rgba(255,217,61,0.8)",d=_=>_>=0?`+${_}`:`${_}`,h=80,f=110;return a.jsxs("div",{style:{position:"absolute",left:t,top:e,pointerEvents:"none",zIndex:6e3},children:[a.jsx("style",{children:`
                @keyframes buffGlow {
                    0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
                    30% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
                    100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
                }
                @keyframes buffNumberRise {
                    0% { transform: translateY(0); opacity: 0; }
                    20% { opacity: 1; }
                    100% { transform: translateY(-30px); opacity: 0; }
                }
                @keyframes buffSparkle {
                    0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
                    50% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
                    100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
                }
            `}),a.jsx("div",{style:{position:"absolute",left:0,top:0,width:150,height:150,background:o,borderRadius:"50%",transform:"translate(-50%, -50%)",animation:"buffGlow 1.2s ease-out forwards",filter:"blur(8px)"}}),n!==0&&a.jsx("div",{style:{position:"absolute",left:-h/2+12,top:f/2-20,fontSize:"24px",fontWeight:"bold",color:c,textShadow:`0 0 10px ${u}, 2px 2px 4px rgba(0,0,0,0.8)`,fontFamily:"Tamanegi, sans-serif",animation:"buffNumberRise 1.2s ease-out forwards",textAlign:"center"},children:d(n)}),r!==0&&a.jsx("div",{style:{position:"absolute",left:h/2-28,top:f/2-20,fontSize:"24px",fontWeight:"bold",color:c,textShadow:`0 0 10px ${u}, 2px 2px 4px rgba(0,0,0,0.8)`,fontFamily:"Tamanegi, sans-serif",animation:"buffNumberRise 1.2s ease-out forwards",textAlign:"center"},children:d(r)}),[...Array(8)].map((_,R)=>a.jsx("div",{style:{position:"absolute",left:Math.cos(R*Math.PI/4)*60,top:Math.sin(R*Math.PI/4)*60,width:12,height:12,background:l,borderRadius:"50%",boxShadow:`0 0 10px ${l}, 0 0 20px ${l}`,animation:`buffSparkle 0.8s ease-out ${R*.1}s forwards`}},R))]})},lL=({x:t,y:e,onComplete:n,scale:r=1})=>(N.useEffect(()=>{const s=setTimeout(n,1200);return()=>clearTimeout(s)},[n]),a.jsxs("div",{style:{position:"absolute",left:t,top:e,transform:"translate(-50%, -50%)",width:130*r,height:130*r,pointerEvents:"none",zIndex:5e3,display:"flex",alignItems:"center",justifyContent:"center"},children:[a.jsx("div",{style:{fontSize:`${80*r}px`,animation:"baneSkullAppear 1.2s ease-out forwards",textShadow:`0 0 ${20*r}px #9b59b6, 0 0 ${40*r}px #8e44ad, 0 0 ${60*r}px #6c3483`,filter:`drop-shadow(0 0 ${15*r}px #9b59b6) hue-rotate(-10deg)`},children:""}),[...Array(12)].map((s,i)=>a.jsx("div",{style:{position:"absolute",left:"50%",top:"50%",width:6*r,height:6*r,background:"radial-gradient(circle, #9b59b6, #6c3483)",borderRadius:"50%",boxShadow:`0 0 ${8*r}px #9b59b6, 0 0 ${15*r}px #8e44ad`,animation:`baneParticle 1s ease-out ${i*.08}s forwards`,transform:`rotate(${i*30}deg) translateX(0)`}},i)),a.jsx("style",{children:`
                @keyframes baneSkullAppear {
                    0% { transform: scale(0) rotate(-30deg); opacity: 0; }
                    20% { transform: scale(1.3) rotate(10deg); opacity: 1; }
                    40% { transform: scale(1) rotate(-5deg); opacity: 1; }
                    60% { transform: scale(1.1) rotate(0deg); opacity: 1; }
                    80% { transform: scale(1) rotate(0deg); opacity: 0.8; }
                    100% { transform: scale(1.5) rotate(0deg); opacity: 0; }
                }
                @keyframes baneParticle {
                    0% { transform: rotate(0deg) translateX(0); opacity: 1; }
                    100% { transform: rotate(0deg) translateX(${70*r}px); opacity: 0; }
                }
            `})]})),cL=({type:t,x:e,y:n,onComplete:r,audioSettings:s,scale:i=1})=>{const o=N.useMemo(()=>{let f=8,_=8,R=100,k=256;return t==="SHOT"&&(k=128),{cols:f,rows:_,fps:R,size:k}},[t]);if(N.useEffect(()=>{const _=["LIGHTNING","THUNDER","IMPACT","SUMI","SHOT","ICE","WATER","RAY","FIRE","SLASH","BLUE_FIRE"].includes(t)?o.cols*o.rows/o.fps*1e3:t==="FIREBALL"?500:t==="HEAL"?2e3:400,R=setTimeout(r,_);return()=>clearTimeout(R)},[r,t,o]),N.useEffect(()=>{if(!s||!s.seEnabled)return;const f=(_,R=.5,k=0)=>{setTimeout(()=>{const B=new Audio(et(`/se/${_}`));B.volume=(s.se||.5)*R,B.play().catch(x=>console.warn("SE Play prevented",x))},k)};t==="SHOT"?(f("shot.mp3",.6),f("hibi.mp3",.4,400)):t==="IMPACT"?(f("panch1.mp3",.6,100),f("panch2.mp3",.6,500)):t==="LIGHTNING"||t==="THUNDER"?f("thunder.mp3",.5):t==="FIREBALL"?f("explosion.mp3",.5):t==="FIRE"?f("fire.mp3",.5):t==="SLASH"?f("slash.mp3",.5):t==="ICE"?f("ice.mp3",.5):t==="WATER"?f("water.mp3",.5):t==="RAY"?f("ray.mp3",.6):t==="SUMI"?f("yami.mp3",.6):t==="HEAL"?f("heal.mp3",.6):t==="BLUE_FIRE"?f("fire.mp3",.5):t==="BANE"&&f("yami.mp3",.7)},[t,s]),t==="HEAL")return a.jsx(oL,{x:e,y:n,onComplete:r,scale:i});if(t==="BANE")return a.jsx(lL,{x:e,y:n,onComplete:r,scale:i});const l=100*i,c={position:"absolute",left:e,top:n,transform:"translate(-50%, -50%)",width:l,height:l,pointerEvents:"none",zIndex:5e3,display:"flex",alignItems:"center",justifyContent:"center"};if(["LIGHTNING","THUNDER","IMPACT","SUMI","SHOT","ICE","WATER","RAY","FIRE","SLASH","BLUE_FIRE"].includes(t)){let f=et("/effects/thunder.png");t==="IMPACT"&&(f=et("/effects/impact.png")),t==="SUMI"&&(f=et("/effects/sumi.png")),t==="SHOT"&&(f=et("/effects/shot.png")),t==="ICE"&&(f=et("/effects/ice.png")),t==="WATER"&&(f=et("/effects/water.png")),t==="RAY"&&(f=et("/effects/ray.png")),t==="FIRE"&&(f=et("/effects/fire.png")),t==="SLASH"&&(f=et("/effects/slash.png")),t==="BLUE_FIRE"&&(f=et("/effects/blue_fire.png"));const _=o.cols*o.rows,R=Math.min(160,o.size)*i;return a.jsxs("div",{style:{...c,width:R,height:R,transform:`${(c==null?void 0:c.transform)||""}`},children:[a.jsx("div",{style:{width:"100%",height:"100%",backgroundImage:`url(${f})`,backgroundSize:`${o.cols*100}% ${o.rows*100}%`,animation:`spriteAnimation ${_/o.fps}s steps(1) forwards`}}),a.jsx("style",{children:`
                    @keyframes spriteAnimation {
                        ${Array.from({length:_}).map((k,B)=>{const x=B%o.cols,E=Math.floor(B/o.cols),T=x*(100/(o.cols-1)),p=E*(100/(o.rows-1));return`${B/(_-1)*100}% { background-position: ${T}% ${p}%; }`}).join(`
`)}
                    }
                `})]})}let d="",h="";if(t==="FIREBALL")d=et("/effects/fireball.png"),h="explode 0.5s ease-out forwards";else if(t==="BEAM")return a.jsx("div",{style:{position:"fixed",left:e,top:n,width:400,height:30,background:"linear-gradient(90deg, transparent, #faf089, #fff, #faf089, transparent)",transform:"translate(-50%, -50%) rotate(-45deg)",boxShadow:"0 0 20px #faf089",opacity:0,animation:"beamShoot 0.4s ease-out forwards",pointerEvents:"none",zIndex:5e3},children:a.jsx("style",{children:`
                    @keyframes beamShoot {
                        0% { width: 0; opacity: 1; transform: translate(-50%, -50%) rotate(-45deg) scaleX(0); }
                        20% { width: 400px; opacity: 1; transform: translate(-50%, -50%) rotate(-45deg) scaleX(1); }
                        100% { width: 400px; opacity: 0; transform: translate(-50%, -50%) rotate(-45deg) scaleX(1.2); }
                    }
                `})});return d?a.jsxs("div",{style:c,children:[a.jsx("img",{src:d,style:{width:"100%",height:"100%",objectFit:"contain",animation:h}}),a.jsx("style",{children:`
                @keyframes explode { 0% { transform: scale(0.5); opacity: 0; } 20% { opacity: 1; } 100% { transform: scale(2); opacity: 0; } }
            `})]}):null},uL=({value:t,x:e,y:n,color:r,onComplete:s,scale:i=1})=>{N.useEffect(()=>{const u=setTimeout(s,1200);return()=>clearTimeout(u)},[s]);const o=r==="#48bb78",l=r||"#e53e3e",c=o?"linear-gradient(180deg, #68d391 0%, #38a169 50%, #276749 100%)":"linear-gradient(180deg, #fc8181 0%, #e53e3e 50%, #c53030 100%)";return a.jsxs("div",{style:{position:"absolute",left:e,top:n,transform:"translate(-50%, -50%)",pointerEvents:"none",zIndex:6e3,fontSize:`${4*i}rem`,fontWeight:"900",fontFamily:'"Impact", "Arial Black", sans-serif',letterSpacing:`${-2*i}px`,background:c,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",filter:`drop-shadow(0 0 ${8*i}px ${l}) drop-shadow(0 ${2*i}px ${4*i}px rgba(0,0,0,0.8))`,animation:"floatUp 1.2s ease-out forwards"},children:[t,a.jsx("style",{children:`
                @keyframes floatUp {
                    0% { transform: translate(-50%, -50%) scale(0.3); opacity: 0; }
                    15% { transform: translate(-50%, -70%) scale(1.8); opacity: 1; }
                    30% { transform: translate(-50%, -90%) scale(1.4); opacity: 1; }
                    100% { transform: translate(-50%, -180%) scale(1); opacity: 0; }
                }
            `})]})},dL=({x:t,y:e})=>{const n=N.useMemo(()=>Array(16).fill(0).map((r,s)=>({id:s,angle:Math.random()*360,dist:60+Math.random()*120,size:4+Math.random()*8,delay:Math.random()*.3,color:Math.random()>.5?"#f6e05e":"#ffffff"})),[]);return a.jsxs("div",{style:{position:"absolute",left:t,top:e,pointerEvents:"none",zIndex:6e3},children:[a.jsx("style",{children:`
                @keyframes sparkleMove {
                    0% { transform: rotate(var(--angle)) translate(0, 0) scale(0); opacity: 0; }
                    20% { opacity: 1; transform: rotate(var(--angle)) translate(calc(var(--dist) * 0.2px), 0) scale(1.5); }
                    100% { transform: rotate(var(--angle)) translate(calc(var(--dist) * 1px), 0) scale(0); opacity: 0; }
                }
            `}),n.map(r=>a.jsx("div",{style:{position:"absolute",left:0,top:0,width:r.size,height:r.size,background:r.color,borderRadius:"50%",boxShadow:`0 0 10px ${r.color}, 0 0 20px ${r.color}`,"--angle":`${r.angle}deg`,"--dist":r.dist,animation:`sparkleMove 0.8s ease-out ${r.delay}s forwards`,pointerEvents:"none"}},r.id))]})},fL=({onClose:t})=>a.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(0,0,0,0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:t,children:a.jsxs("div",{style:{background:"linear-gradient(135deg, #1a202c 0%, #2d3748 100%)",borderRadius:16,padding:30,maxWidth:700,maxHeight:"80vh",overflowY:"auto",color:"#fff",boxShadow:"0 20px 60px rgba(0,0,0,0.5)",border:"1px solid #4a5568"},onClick:e=>e.stopPropagation(),children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[a.jsx("h2",{style:{margin:0,color:"#63b3ed"},children:""}),a.jsx("button",{onClick:t,style:{background:"transparent",border:"none",color:"#a0aec0",fontSize:"1.5rem",cursor:"pointer"},children:""})]}),a.jsxs("section",{style:{marginBottom:25},children:[a.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),a.jsxs("ul",{style:{lineHeight:1.8,paddingLeft:20,color:"#e2e8f0"},children:[a.jsx("li",{children:"0"}),a.jsx("li",{children:"1PP110"}),a.jsx("li",{children:"PP"}),a.jsx("li",{children:""}),a.jsx("li",{children:"5"}),a.jsx("li",{children:"910"})]})]}),a.jsxs("section",{style:{marginBottom:25},children:[a.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[a.jsxs("div",{children:[a.jsx("span",{style:{color:"#48bb78",fontWeight:"bold"},children:"[]"}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#ed8936",fontWeight:"bold"},children:"[]"}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#4299e1",fontWeight:"bold"},children:"[]"}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#9f7aea",fontWeight:"bold"},children:"[]"}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#f56565",fontWeight:"bold"},children:"[]"}),"12"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#38b2ac",fontWeight:"bold"},children:"[]"}),"1"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#718096",fontWeight:"bold"},children:"[]"}),"AoE"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#d69e2e",fontWeight:"bold"},children:"[]"}),"AoE"]})]})]}),a.jsxs("section",{style:{marginBottom:25},children:[a.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[a.jsxs("div",{children:[a.jsx("span",{style:{color:"#63b3ed",fontWeight:"bold"},children:""}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#f687b3",fontWeight:"bold"},children:""}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#faf089",fontWeight:"bold"},children:""}),"EP"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#b794f4",fontWeight:"bold"},children:""}),"SEP"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#68d391",fontWeight:"bold"},children:""}),""]})]})]}),a.jsxs("section",{style:{marginBottom:25},children:[a.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),a.jsxs("ul",{style:{lineHeight:1.8,paddingLeft:20,color:"#e2e8f0"},children:[a.jsxs("li",{children:[a.jsx("span",{style:{color:"#faf089"},children:"EP"}),"54112"]}),a.jsxs("li",{children:[a.jsx("span",{style:{color:"#b794f4"},children:"SEP"}),"76112"]}),a.jsx("li",{children:"1111"}),a.jsx("li",{children:"+2/+2"}),a.jsx("li",{children:"+3/+3"})]})]}),a.jsxs("section",{children:[a.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),a.jsxs("ul",{style:{lineHeight:1.8,paddingLeft:20,color:"#e2e8f0"},children:[a.jsxs("li",{children:[a.jsx("span",{style:{color:"#ed8936"},children:"PP"}),""]}),a.jsx("li",{children:"151612PP +1"})]})]})]})}),hL=({logs:t,onCardNameClick:e,scale:n=1,isMobile:r=!1})=>{const s=N.useRef(null);N.useEffect(()=>{s.current&&(s.current.scrollTop=s.current.scrollHeight)},[t.length]);const i=(c,u)=>{const d={color:"#ffd700",cursor:"pointer",textDecoration:"underline",textUnderlineOffset:"2px",fontWeight:"bold"},h=p=>{p.target.style.color="#ffec8b",p.target.style.textShadow="0 0 8px rgba(255, 215, 0, 0.8)"},f=p=>{p.target.style.color="#ffd700",p.target.style.textShadow="none"},_=(p,$)=>a.jsx("span",{style:d,onMouseEnter:h,onMouseLeave:f,onClick:C=>{C.stopPropagation(),e==null||e(p)},children:p},$),R=DS(),k=p=>p?!(/[a-zA-Z0-9]/.test(p)||/[\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/.test(p)):!0,B=[];for(const p of R){let $=0;for(;;){const C=c.indexOf(p,$);if(C===-1)break;const re=C>0?c[C-1]:void 0,Y=C+p.length<c.length?c[C+p.length]:void 0,K=k(re)&&k(Y),ce=B.some(me=>C>=me.start&&C<me.end||C+p.length>me.start&&C+p.length<=me.end||C<=me.start&&C+p.length>=me.end);K&&!ce&&B.push({start:C,end:C+p.length,name:p}),$=C+1}}if(B.length===0)return a.jsx("span",{children:c});B.sort((p,$)=>p.start-$.start);const x=[];let E=0,T=0;for(const p of B)p.start>E&&x.push(a.jsx("span",{children:c.slice(E,p.start)},T++)),x.push(_(p.name,T++)),E=p.end;return E<c.length&&x.push(a.jsx("span",{children:c.slice(E)},T++)),a.jsx(a.Fragment,{children:x})},o=r?Math.max(100,140*n):Math.max(150,200*n),l=r?Math.max(140,180*n):Math.max(180,220*n);return a.jsxs("div",{ref:s,style:{position:"absolute",left:0,top:"45%",transform:"translateY(-50%)",width:l,height:o,overflowY:"auto",background:"linear-gradient(to right, rgba(0,0,0,0.8), rgba(0,0,0,0.0))",color:"#fff",fontSize:r?`${Math.max(.55,.65*n)}rem`:`${Math.max(.65,.75*n)}rem`,padding:r?`${6*n}px ${6*n}px ${6*n}px ${10*n}px`:`${8*n}px ${8*n}px ${8*n}px ${12*n}px`,borderLeft:r?"2px solid #63b3ed":"3px solid #63b3ed",zIndex:15,pointerEvents:"auto",scrollbarWidth:"thin"},onMouseDown:c=>c.stopPropagation(),onClick:c=>c.stopPropagation(),children:[a.jsx("div",{style:{fontWeight:"bold",marginBottom:(r?3:4)*n,color:"#a0aec0",borderBottom:"1px solid rgba(255,255,255,0.1)",paddingBottom:2,fontSize:r?`${Math.max(.5,.55*n)}rem`:`${Math.max(.55,.65*n)}rem`,textTransform:"uppercase",letterSpacing:1},children:r?"LOG":"BATTLE LOG"}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:(r?2:3)*n},children:t.map((c,u)=>a.jsx("div",{style:{opacity:.9,lineHeight:r?"1.3":"1.4",textShadow:"0 1px 2px black",animation:"fadeIn 0.3s ease-out"},children:i(c)},u))})]})},pL=({card:t,evolvedImageUrl:e,startX:n,startY:r,phase:s,onPhaseChange:i,onShake:o,useSep:l,playSE:c,scale:u,isLightMode:d=!1})=>{const[h,f]=N.useState(0),[_,R]=N.useState(0),[k,B]=N.useState(0),[x,E]=N.useState(0),[T,p]=N.useState(0),[$,C]=N.useState(.25),[re,Y]=N.useState({x:n,y:r}),[K,ce]=N.useState(!1),[me,Se]=N.useState([]),[fe,te]=N.useState([]),[w,S]=N.useState(!1),A=N.useRef(!1),y=N.useRef(null),g=N.useRef(i),I=N.useRef(o),P=N.useRef(c);N.useEffect(()=>{g.current=i,I.current=o,P.current=c},[i,o,c]);const L=360*u,X=480*u;N.useEffect(()=>{var V,Le,Ie;console.log("[EvolutionAnimation] Phase:",s);let Re,Z=null;switch(s){case"ZOOM_IN":{Y({x:n,y:r}),C(.25),R(0);const Fe=Date.now(),je=650,nt=.25,Et=.75,$t=setInterval(()=>{const dt=Date.now()-Fe,vn=Math.min(dt/je,1),Wt=1-Math.pow(1-vn,2);R(-5*Wt),C(nt+(Et-nt)*Wt),vn>=1&&clearInterval($t)},16);Re=setTimeout(()=>{const dt=280*u,vn=window.innerWidth-dt,Wt=dt+vn*.4;Y({x:Wt,y:window.innerHeight/2-30*u})},50);const qe=setTimeout(()=>{const dt=new Audio(et("/se/kirakira.mp3"));dt.volume=.35,dt.play().catch(()=>{}),y.current=dt},600),ln=setTimeout(()=>{g.current("WHITE_FADE")},700);return()=>{clearTimeout(Re),clearTimeout(ln),clearTimeout(qe),clearInterval($t)}}case"WHITE_FADE":(V=P.current)==null||V.call(P,"magic_charge.mp3",.3);const Ge=Array(80).fill(0).map((Fe,je)=>{const nt=je/80*360,Et=(Math.random()-.5)*10,$t=nt+Et,qe=200+Math.random()*600,ln=Math.random()*1.8,vn=.5+(qe-200)/600*.5,Wt=24+Math.random()*48;return{id:je,angle:$t,dist:qe,delay:ln,duration:vn,size:Wt}});Se(Ge),S(!0);let Ce=0;return Z=setInterval(()=>{Ce+=.025,E(Math.min(Ce,1)),p(Math.min(Ce*80,80)),B(Ce*15),Ce>=1.2&&(Z&&clearInterval(Z),S(!1),g.current("FLIP"))},40),()=>{Z&&clearInterval(Z)};case"FLIP":if((Le=P.current)==null||Le.call(P,"syakin.mp3",.8),(Ie=P.current)==null||Ie.call(P,"KO.mp3",.7),y.current){const Fe=y.current,je=300,nt=30,Et=je/nt,$t=Fe.volume/Et;let qe=0;const ln=setInterval(()=>{qe++,Fe.volume=Math.max(0,Fe.volume-$t),qe>=Et&&(clearInterval(ln),Fe.pause(),y.current=null)},nt)}Se([]);const $e=Date.now(),gt=400,ue=1200;return Z=setInterval(()=>{const Fe=Date.now()-$e;if(Fe<gt){const je=Fe/gt,nt=1-Math.pow(1-je,3),Et=10+nt*160;if(f(Et),C(.75+nt*((l?1.2:1.1)-.75)),R(-5+nt*2),E(Math.max(1-je*3,0)),Et>90&&!A.current){A.current=!0;const qe=Array(120).fill(0).map((ln,dt)=>{const vn=dt/120*360,Wt=(Math.random()-.5)*8,ji=18+Math.random()*42;return{id:dt,angle:vn+Wt,dist:200+Math.random()*400,size:ji*3,delay:Math.random()*.05}});te(qe)}}else{const je=Math.min((Fe-gt)/ue,1),nt=je<.5?2*je*je:1-Math.pow(-2*je+2,2)/2;if(f(170+nt*10),E(0),!A.current){A.current=!0;const Et=Array(120).fill(0).map(($t,qe)=>{const ln=qe/120*360,dt=(Math.random()-.5)*8,vn=18+Math.random()*42;return{id:qe,angle:ln+dt,dist:200+Math.random()*400,size:vn*3,delay:Math.random()*.05}});te(Et)}je>=1&&(Z&&clearInterval(Z),g.current("REVEAL"))}},16),()=>{Z&&clearInterval(Z)};case"REVEAL":let Pe=0;return Z=setInterval(()=>{Pe+=.25,E(Math.max(1-Pe,0)),p(Math.max(60-Pe*60,0)),Pe>=1&&(Z&&clearInterval(Z),te([]),g.current("ZOOM_OUT"))},40),()=>{Z&&clearInterval(Z)};case"ZOOM_OUT":{Y({x:n,y:r});const Fe=Date.now(),je=250,nt=$,Et=-3;return Z=setInterval(()=>{const $t=Date.now()-Fe,qe=Math.min($t/je,1),ln=1-Math.pow(1-qe,3);C(nt-(nt-.25)*ln),R(Et*(1-ln)),qe>=1&&(Z&&clearInterval(Z),f(180),B(0),C(.25),R(0),g.current("LAND"))},16),()=>{Z&&clearInterval(Z)}}case"LAND":return I.current(),ce(!0),Re=setTimeout(()=>{g.current("DONE")},600),()=>clearTimeout(Re)}return()=>{Re&&clearTimeout(Re),Z&&clearInterval(Z),y.current&&(y.current.pause(),y.current=null)}},[s]);const F=h+k,ye=_,Ae=w?{x:(Math.random()-.5)*4,y:(Math.random()-.5)*4}:{x:0,y:0};return a.jsxs("div",{style:{position:"fixed",inset:0,zIndex:1e4,background:"rgba(0,0,0,0.75)",pointerEvents:"none"},children:[a.jsx("style",{children:`
                ${me.map(Re=>`
                    @keyframes chargeParticleIn-${Re.id} {
                        0% { opacity: 0; transform: rotate(${Re.angle}deg) translateX(${Re.dist}px) scale(0.5); }
                        20% { opacity: 0.8; transform: rotate(${Re.angle}deg) translateX(${Re.dist*.8}px) scale(1.2); }
                        100% { opacity: 1; transform: rotate(${Re.angle}deg) translateX(0) scale(0.2); } /* Keep visible at end */
                    }
                `).join("")}
                ${fe.map(Re=>`
                    @keyframes burstParticleOut-${Re.id} {
                        0% { opacity: 1; transform: translate(-50%, -50%) rotate(${Re.angle}deg) translateX(0) scale(1.5); }
                        100% { opacity: 0; transform: translate(-50%, -50%) rotate(${Re.angle}deg) translateX(${Re.dist*1.5}px) scale(0); }
                    }
                `).join("")}
            `}),(d?me.filter((Re,Z)=>Z%2===0):me).map(Re=>a.jsx("div",{style:{position:"absolute",left:re.x,top:re.y,width:Re.size*u,height:Re.size*u,borderRadius:"50%",background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(200,230,255,0.6) 40%, transparent 70%)",boxShadow:d?"0 0 8px white":"0 0 10px white, 0 0 20px rgba(100,200,255,0.5)",filter:d?void 0:"blur(1px)",animation:`chargeParticleIn-${Re.id} ${Re.duration}s ease-in ${Re.delay}s forwards`,transform:`rotate(${Re.angle}deg) translateX(${Re.dist*u}px)`,opacity:0,pointerEvents:"none"}},`charge-${Re.id}`)),s==="WHITE_FADE"&&a.jsxs("div",{style:{position:"absolute",left:re.x+Ae.x,top:re.y+Ae.y,width:0,height:0,transformStyle:"preserve-3d"},children:[a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:500*u,height:500*u,border:"8px solid rgba(255, 255, 255, 0.6)",borderRadius:"50%",transform:"translate(-50%, -50%) rotateX(75deg)",boxShadow:d?"0 0 15px rgba(255, 255, 255, 0.6)":"0 0 30px rgba(255, 255, 255, 0.8), inset 0 0 30px rgba(255, 255, 255, 0.8)",animation:"ringSpin 2s linear infinite"}}),!d&&a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:600*u,height:600*u,border:"6px dashed rgba(100, 200, 255, 0.7)",borderRadius:"50%",transform:"translate(-50%, -50%) rotateX(80deg) rotateY(10deg)",boxShadow:"0 0 40px rgba(100, 200, 255, 0.5)",animation:"ringSpinReverse 3s linear infinite"}}),a.jsx("style",{children:`
                        @keyframes ringSpin {
                            0% { transform: translate(-50%, -50%) rotateX(75deg) rotate(0deg); opacity: 0; scale: 0.5; }
                            20% { opacity: 1; scale: 1; }
                            100% { transform: translate(-50%, -50%) rotateX(75deg) rotate(360deg); opacity: 1; scale: 1; }
                        }
                        @keyframes ringSpinReverse {
                            0% { transform: translate(-50%, -50%) rotateX(80deg) rotateY(10deg) rotate(0deg); opacity: 0; scale: 0.6; }
                            20% { opacity: 0.8; scale: 1; }
                            100% { transform: translate(-50%, -50%) rotateX(80deg) rotateY(10deg) rotate(-360deg); opacity: 0.8; scale: 1; }
                        }
                    `})]}),(d?fe.filter((Re,Z)=>Z%2===0):fe).map(Re=>a.jsx("div",{style:{position:"absolute",left:re.x,top:re.y,width:Re.size*u,height:Re.size*u,borderRadius:"50%",background:l?"radial-gradient(circle, rgba(183, 148, 244, 1) 0%, rgba(159, 122, 234, 0.8) 50%, transparent 100%)":"radial-gradient(circle, rgba(255, 251, 235, 1) 0%, rgba(251, 211, 141, 0.8) 50%, transparent 100%)",boxShadow:d?l?"0 0 8px #b794f4":"0 0 8px #fbd38d":l?"0 0 10px #b794f4, 0 0 20px rgba(159,122,234,0.6)":"0 0 10px #fbd38d, 0 0 20px rgba(251,211,141,0.6)",animation:`burstParticleOut-${Re.id} 0.4s ease-out ${Re.delay}s forwards`,pointerEvents:"none"}},`burst-${Re.id}`)),a.jsxs("div",{style:{position:"absolute",left:re.x+Ae.x,top:re.y+Ae.y,transform:`translate(-50%, -50%) scale(${$}) perspective(1200px) rotateY(${F}deg) rotateZ(${ye}deg)`,transition:s==="ZOOM_IN"||s==="ZOOM_OUT"?"left 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), top 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)":"none",transformStyle:"preserve-3d"},children:[!d&&a.jsx("div",{style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:L*1.3,height:X*1.2,background:l?"radial-gradient(ellipse, rgba(159, 122, 234, 0.4) 0%, transparent 70%)":"radial-gradient(ellipse, rgba(251, 211, 141, 0.4) 0%, transparent 70%)",filter:"blur(20px)",pointerEvents:"none",opacity:T>1?1:0,transition:"opacity 0.4s"}}),a.jsxs("div",{style:{width:L,height:X,borderRadius:16,overflow:"hidden",boxShadow:d?l?"0 0 20px rgba(159, 122, 234, 0.5)":"0 0 20px rgba(251, 211, 141, 0.5)":l?"0 0 40px rgba(159, 122, 234, 0.7)":"0 0 40px rgba(251, 211, 141, 0.7)",position:"relative",transformStyle:"preserve-3d"},children:[a.jsxs("div",{style:{position:"absolute",inset:0,borderRadius:16,overflow:"hidden",background:"#1a202c",zIndex:F<=90?2:1,opacity:F<=90?1:0},children:[a.jsx("img",{src:et(t.imageUrl||""),alt:t.name,style:{width:"100%",height:"100%",objectFit:"cover",filter:`brightness(${1+x*.5}) contrast(${1-x*.2})`}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"white",opacity:x,pointerEvents:"none"}})]}),a.jsxs("div",{style:{position:"absolute",inset:0,transform:"rotateY(180deg)",borderRadius:16,overflow:"hidden",background:"#1a202c",zIndex:F>90?2:1,opacity:F>90?1:0},children:[a.jsx("img",{src:et(e&&e!==""?e:t.imageUrl||""),alt:`${t.name} Evolved`,style:{width:"100%",height:"100%",objectFit:"cover",filter:`brightness(${1+x*.5}) contrast(${1-x*.2})`}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"white",opacity:x,pointerEvents:"none"}})]})]})]}),K&&a.jsxs("div",{style:{position:"absolute",left:n,top:r,pointerEvents:"none"},children:[a.jsx("style",{children:`
                        @keyframes landParticleMove {
                            0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                            100% { opacity: 0; transform: translate(-50%, -50%) rotate(var(--angle)) translateX(calc(var(--dist) * 1px)) scale(0); }
                        }
                    `}),Array(20).fill(0).map((Re,Z)=>{const V=Z/20*360,Le=40+Math.random()*100;return a.jsx("div",{style:{position:"absolute",left:0,top:0,width:8*u,height:8*u,borderRadius:"50%",background:"white","--angle":`${V}deg`,"--dist":Le,animation:"landParticleMove 0.5s ease-out forwards"}},`land-${Z}`)})]})]})},p_=et("/leaders/yoRuka_win.png"),g_=et("/leaders/yoRuka_lose.png"),gL=et("/leaders/senka_win.png"),mL=et("/leaders/senka_lose.png"),yL=et("/leaders/azya_win.png"),vL=et("/leaders/azya_lose.png"),_L=t=>({BRONZE:"#cd7f32",SILVER:"#c0c0c0",GOLD:"#ffd700",PLATINUM:"#e5e4e2",DIAMOND:"#b9f2ff",MASTER:"#ff4500"})[t],xL=({winnerId:t,playerId:e,playerClass:n,onRematch:r,onRematching:s,onLeave:i,isOnline:o,isRoomMatch:l=!0,myRematchRequested:c,opponentRematchRequested:u,battleStats:d,selectedCardInfo:h,onCardInfoClick:f,victoryReason:_="normal",isRankedMatch:R=!1,ratingResult:k})=>{const B=t===e,E=(()=>{if(!B)return null;switch(_){case"disconnect":return"";case"surrender":return"";default:return null}})(),[T,p]=N.useState("bg-fade"),$=["bg-fade","image","result-text","stats","rate","buttons","complete"].indexOf(T);N.useEffect(()=>{const y={"bg-fade":300,image:600,"result-text":400,stats:400,rate:300,buttons:0};if(T==="complete")return;const g={"bg-fade":"image",image:"result-text","result-text":"stats",stats:"rate",rate:"buttons",buttons:"complete"},I=setTimeout(()=>{const P=g[T];P&&p(P)},y[T]||0);return()=>clearTimeout(I)},[T]);const C=()=>n==="SENKA"?B?gL:mL:n==="AJA"?B?yL:vL:B?p_:g_,[re,Y]=N.useState(15),[K,ce]=N.useState(!1),[me,Se]=N.useState(null),fe=o?c||u:c||K;N.useEffect(()=>{if(fe)return;const y=setInterval(()=>{Y(g=>g<=1?(clearInterval(y),i(),0):g-1)},1e3);return()=>clearInterval(y)},[i,fe]);const te=y=>{Se(y),o&&!l&&s?s(y):r(y)},w=()=>{const y=!o||l?"":"";return o?c&&u?"...":c?"...":u?`${y}`:y:c?"...":y},S=()=>{const y={padding:"15px 40px",fontSize:"1.5rem",fontWeight:"bold",border:"none",borderRadius:12,cursor:c?"default":"pointer",transform:"scale(1)",transition:"transform 0.1s, background 0.2s"};return u&&!c?{...y,background:"linear-gradient(135deg, #f6e05e, #d69e2e)",color:"black",boxShadow:"0 4px 15px rgba(246, 224, 94, 0.6)",animation:"pulse 1s infinite"}:c?{...y,background:"linear-gradient(135deg, #718096, #4a5568)",color:"white",boxShadow:"none"}:{...y,background:"linear-gradient(135deg, #48bb78, #38a169)",color:"white",boxShadow:"0 4px 15px rgba(72, 187, 120, 0.4)"}},A=(y,g)=>({width:220,height:220,borderRadius:"50%",border:me===y?"5px solid #f6e05e":"4px solid rgba(255,255,255,0.4)",background:y==="AJA"?`url(${Va(y)}) center top/cover`:`url(${Va(y)}) center/cover`,cursor:"pointer",transform:g?"scale(1.1)":"scale(1)",transition:"all 0.2s ease",boxShadow:g?"0 0 30px rgba(246, 224, 94, 0.7)":"0 6px 15px rgba(0,0,0,0.5)"});return a.jsxs("div",{style:{position:"absolute",inset:0,zIndex:5e3,background:"rgba(0,0,0,0.85)",backdropFilter:"blur(10px)",display:"flex",flexDirection:"row",alignItems:"stretch",opacity:$>=0?1:0,transition:"opacity 0.3s ease-out"},onClick:()=>{},children:[a.jsx("style",{children:`
                @keyframes pulse {
                    0%, 100% { transform: scale(1); }
                    50% { transform: scale(1.05); }
                }
                @keyframes float {
                    0%, 100% { transform: translateY(0); }
                    50% { transform: translateY(-10px); }
                }
                @keyframes slideUpFadeIn {
                    0% { opacity: 0; transform: translateY(30px); }
                    100% { opacity: 1; transform: translateY(0); }
                }
                @keyframes imageFadeIn {
                    0% { opacity: 0; transform: scale(0.95); }
                    100% { opacity: 0.9; transform: scale(1); }
                }
            `}),a.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:40,borderRight:"1px solid rgba(255,255,255,0.1)"},children:h?a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:16,maxWidth:320},children:[a.jsx("div",{style:{width:200,height:280,backgroundImage:`url(${et(`/cards/${h.id}.png`)})`,backgroundSize:"cover",backgroundPosition:"center",borderRadius:12,boxShadow:"0 8px 30px rgba(0,0,0,0.6)"}}),a.jsx("div",{style:{fontFamily:"var(--font-tamanegi)",fontSize:"1.6rem",color:"white",textShadow:"0 2px 6px rgba(0,0,0,0.6)",textAlign:"center"},children:h.name}),a.jsxs("div",{style:{display:"flex",gap:20,fontSize:"1.2rem",color:"rgba(255,255,255,0.9)"},children:[a.jsxs("span",{children:[": ",h.cost]}),h.type==="FOLLOWER"&&a.jsxs(a.Fragment,{children:[a.jsxs("span",{children:[": ",h.attack]}),a.jsxs("span",{children:[": ",h.health]})]})]}),a.jsx("div",{style:{fontSize:"1rem",color:"rgba(255,255,255,0.7)",textAlign:"center",lineHeight:1.5,maxHeight:120,overflow:"auto"},children:h.description||""}),a.jsx("button",{onClick:()=>f(null),style:{padding:"8px 24px",fontSize:"1rem",background:"transparent",border:"1px solid rgba(255,255,255,0.3)",color:"white",borderRadius:8,cursor:"pointer",marginTop:10},children:""})]}):a.jsx("div",{style:{width:"100%",height:"100%",backgroundImage:`url(${C()})`,backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat",opacity:$>=1?.9:0,transform:$>=1?"scale(1)":"scale(0.95)",transition:"opacity 0.6s ease-out, transform 0.6s ease-out"}})}),a.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:40,position:"relative"},children:[a.jsx("div",{style:{fontFamily:"var(--font-tamanegi)",fontSize:"5rem",color:B?"#f6e05e":"#a0aec0",textShadow:B?"0 0 40px rgba(246, 224, 94, 0.7), 4px 4px 8px rgba(0,0,0,0.6)":"0 0 20px rgba(160, 174, 192, 0.5), 4px 4px 8px rgba(0,0,0,0.6)",marginBottom:20,opacity:$>=2?1:0,transform:$>=2?"translateY(0)":"translateY(30px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out",animation:$>=2?"float 3s ease-in-out infinite":"none"},children:B?"":""}),E&&a.jsx("div",{style:{fontSize:"1.1rem",color:"rgba(255, 255, 255, 0.8)",marginTop:-10,marginBottom:20,opacity:$>=2?1:0,transform:$>=2?"translateY(0)":"translateY(20px)",transition:"opacity 0.4s ease-out 0.2s, transform 0.4s ease-out 0.2s"},children:E}),a.jsxs("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"center",gap:16,marginBottom:30,padding:"16px 24px",background:"rgba(0,0,0,0.3)",borderRadius:12,border:"1px solid rgba(255,255,255,0.1)",opacity:$>=3?1:0,transform:$>=3?"translateY(0)":"translateY(30px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out"},children:[a.jsxs("div",{style:{textAlign:"center",minWidth:80},children:[a.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#f6e05e"},children:d.turnCount}),a.jsx("div",{style:{fontSize:"0.9rem",color:"rgba(255,255,255,0.6)"},children:""})]}),a.jsxs("div",{style:{textAlign:"center",minWidth:80},children:[a.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#48bb78"},children:d.damageDealtToOpponent}),a.jsx("div",{style:{fontSize:"0.9rem",color:"rgba(255,255,255,0.6)"},children:""})]}),a.jsxs("div",{style:{textAlign:"center",minWidth:80},children:[a.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#e53e3e"},children:d.damageReceivedFromOpponent}),a.jsx("div",{style:{fontSize:"0.9rem",color:"rgba(255,255,255,0.6)"},children:""})]}),a.jsxs("div",{style:{textAlign:"center",minWidth:80},children:[a.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#63b3ed"},children:d.followersDestroyed}),a.jsx("div",{style:{fontSize:"0.9rem",color:"rgba(255,255,255,0.6)"},children:""})]})]}),R&&k&&a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:8,marginTop:16,opacity:$>=4?1:0,transform:$>=4?"translateY(0)":"translateY(20px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out"},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,background:"rgba(0, 0, 0, 0.5)",padding:"12px 24px",borderRadius:12,border:`2px solid ${k.ratingChange>=0?"#48bb78":"#e53e3e"}`},children:[a.jsx("span",{style:{fontSize:"1.2rem",color:"rgba(255,255,255,0.8)",fontFamily:"var(--font-tamanegi)"},children:""}),a.jsxs("span",{style:{fontSize:"2rem",fontWeight:"bold",color:k.ratingChange>=0?"#48bb78":"#e53e3e",fontFamily:"var(--font-tamanegi)"},children:[k.ratingChange>=0?"+":"",k.ratingChange]})]}),k.ratingChange>0&&(k.bonusBreakdown.winStreakBonus>0||k.bonusBreakdown.rankDiffBonus>0)&&a.jsxs("div",{style:{display:"flex",gap:16,fontSize:"0.85rem",color:"rgba(255,255,255,0.6)",fontFamily:"var(--font-tamanegi)"},children:[a.jsxs("span",{children:[": +",k.bonusBreakdown.base]}),k.bonusBreakdown.winStreakBonus>0&&a.jsxs("span",{style:{color:"#f6e05e"},children:[": +",k.bonusBreakdown.winStreakBonus]}),k.bonusBreakdown.rankDiffBonus>0&&a.jsxs("span",{style:{color:"#63b3ed"},children:[": +",k.bonusBreakdown.rankDiffBonus]})]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,fontSize:"1rem",color:"rgba(255,255,255,0.8)",fontFamily:"var(--font-tamanegi)"},children:[a.jsx("span",{style:{color:_L(k.newRank),fontWeight:"bold"},children:So[k.newRank]}),a.jsx("span",{children:k.newRating})]}),k.isRankUp&&a.jsxs("div",{style:{fontSize:"1.4rem",fontWeight:"bold",color:"#f6e05e",textShadow:"0 0 20px rgba(246, 224, 94, 0.8)",fontFamily:"var(--font-tamanegi)",animation:"pulse 1s ease-in-out infinite"},children:[So[k.newRank],""]}),k.isRankDown&&a.jsxs("div",{style:{fontSize:"1.2rem",color:"#e53e3e",fontFamily:"var(--font-tamanegi)"},children:[So[k.newRank],""]})]}),a.jsx("div",{style:{position:"absolute",right:20,bottom:270,width:180,textAlign:"center",fontFamily:"var(--font-tamanegi)",fontSize:"1.4rem",color:B?"#f6e05e":"#e53e3e",textShadow:B?"0 0 20px rgba(246, 224, 94, 0.8), 2px 2px 4px rgba(0,0,0,0.8)":"0 0 20px rgba(229, 62, 62, 0.8), 2px 2px 4px rgba(0,0,0,0.8)",zIndex:10,opacity:$>=5?1:0,transition:"opacity 0.4s ease-out"},children:B?"":""}),K&&!c?a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",animation:"fadeIn 0.3s ease-out"},children:[a.jsx("div",{style:{fontFamily:"var(--font-tamanegi)",fontSize:"1.6rem",color:"white",marginBottom:24,textShadow:"0 2px 6px rgba(0,0,0,0.6)"},children:""}),a.jsxs("div",{style:{display:"flex",gap:40,marginBottom:24},children:[a.jsx(m_,{deckType:"SENKA",label:"",onSelect:te,getStyle:A}),a.jsx(m_,{deckType:"AJA",label:"",onSelect:te,getStyle:A})]}),a.jsx("button",{onClick:()=>ce(!1),style:{padding:"10px 36px",fontSize:"1.1rem",fontWeight:"bold",background:"transparent",border:"2px solid rgba(255,255,255,0.3)",color:"white",borderRadius:10,cursor:"pointer",marginTop:8},children:""})]}):a.jsxs("div",{style:{display:"flex",gap:20,opacity:$>=5?1:0,transform:$>=5?"translateY(0)":"translateY(30px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out"},children:[a.jsx("button",{onClick:()=>{c||ce(!0)},disabled:c,style:S(),onMouseDown:y=>{c||(y.currentTarget.style.transform="scale(0.95)")},onMouseUp:y=>y.currentTarget.style.transform="scale(1)",children:w()}),a.jsxs("button",{onClick:i,style:{padding:"15px 40px",fontSize:"1.5rem",fontWeight:"bold",background:"transparent",border:"2px solid rgba(255,255,255,0.3)",color:"white",borderRadius:12,cursor:"pointer"},children:[" ",!fe&&`(${re})`]})]}),a.jsx("div",{onClick:()=>{K&&!c&&te("YORUKA")},style:{position:"absolute",right:20,bottom:20,width:180,height:240,backgroundImage:`url(${B?p_:g_})`,backgroundSize:"cover",backgroundPosition:"center",borderRadius:12,cursor:K&&!c?"pointer":"default",opacity:$>=5?.7:0,transition:"opacity 0.4s ease",boxShadow:"0 8px 20px rgba(0,0,0,0.4)"}})]})]})},m_=({deckType:t,label:e,onSelect:n,getStyle:r})=>{const[s,i]=N.useState(!1);return a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:12},children:[a.jsx("button",{onClick:()=>n(t),onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),style:r(t,s)}),a.jsx("span",{style:{color:"white",fontFamily:"var(--font-tamanegi)",fontSize:"1.4rem",textShadow:"0 2px 6px rgba(0,0,0,0.6)"},children:e})]})},y_=(t,e)=>{const[n,r]=N.useState([]),s=N.useRef(!1);return N.useEffect(()=>{r(i=>{const o=[],l=new Map((t||[]).filter(c=>c).map(c=>[c.instanceId,c]));return i.forEach(c=>{var d;if(!c)return;const u=l.get(c.instanceId);u?(o.push({...u,passiveAbilities:u.passiveAbilities?[...u.passiveAbilities]:[],hasBarrier:u.hasBarrier??((d=u.passiveAbilities)==null?void 0:d.includes("BARRIER"))??!1,isDying:!1}),l.delete(c.instanceId)):o.push({...c,isDying:!0,killedByBane:c.killedByBane})}),l.forEach(c=>{var u;o.push({...c,passiveAbilities:c.passiveAbilities?[...c.passiveAbilities]:[],hasBarrier:c.hasBarrier??((u=c.passiveAbilities)==null?void 0:u.includes("BARRIER"))??!1,isDying:!1})}),o})},[t]),N.useEffect(()=>{if(n.some(o=>o.isDying)){if(e!=null&&e.current){s.current=!0;return}const o=setTimeout(()=>{r(l=>l.filter(c=>!c.isDying))},700);return()=>clearTimeout(o)}},[n,e]),N.useEffect(()=>{const o=setInterval(()=>{if(!(e!=null&&e.current)&&s.current){s.current=!1;const l=setTimeout(()=>{r(c=>c.filter(u=>!u.isDying))},300);return()=>clearTimeout(l)}},100);return()=>clearInterval(o)},[e]),n},bL=({playerClass:t,opponentType:e,gameMode:n,targetRoomId:r,onLeave:s,onRematching:i,networkAdapter:o,networkConnected:l,opponentClass:c,aiDifficulty:u="NORMAL",playerName:d,timerEnabled:h=!0,playerId:f,opponentPlayerId:_,opponentRating:R})=>{var Em,Sm,Im,Tm,Cm,wm,km,Am,Rm;const k=n==="CPU"||!o,B=JO(k?n==="CPU"?"CPU":n:"CPU",k?r:void 0),x=o||B.adapter,E=l!==void 0?l:B.connected,T=iL(),{scale:p,toGameX:$,toGameY:C}=T,{isLightMode:re}=MS(),[Y,K]=D.useState(!1);D.useEffect(()=>{(()=>{K("ontouchstart"in window||navigator.maxTouchPoints>0)})()},[]);const ce=D.useCallback((m,v)=>({x:$(m),y:C(v)}),[$,C]),[me,Se]=D.useState(null),fe=N.useRef(T);D.useEffect(()=>{fe.current=T},[T]);const te=n==="CPU"||n==="HOST"||(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&(x==null?void 0:x.isHost)===!0,w=te?"p1":"p2",S=te?"p2":"p1";console.log("[GameScreen INIT]",{gameMode:n,"adapter?.isHost":x==null?void 0:x.isHost,isHost:te,currentPlayerId:w,connected:E,"networkAdapter provided":!!o,networkConnected:l});const A=c||(t==="YORUKA"?Math.random()<.5?"SENKA":"AJA":t==="SENKA"?"AJA":"SENKA"),y=n==="JOIN"||(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&!te,[g,I]=D.useReducer(zO,null,()=>{const m=n==="CPU"?"CPU":"";return y?su(m,A,d,t):su(d,t,m,A)}),[P,L]=D.useState(!y),X=n==="CASUAL_MATCH"||n==="RANKED_MATCH",[F,ye]=N.useState(X?!1:!y),[Ae,Re]=N.useState(!1),[Z,V]=N.useState(!1),[Le,Ie]=N.useState(!1),[Ge,Ce]=N.useState(X),[$e,gt]=N.useState(!1),ue=N.useRef(!1);console.log("[GameScreen SYNC STATE]",{isCasualOrRanked:X,isJoinSide:y,gameSynced:P,waitingForIntroSync:Ge,opponentReadyForIntro:$e,showBattleIntro:F,"introSyncSentRef.current":ue.current});const[Pe,Fe]=N.useState(!1),[je,nt]=N.useState(null),[Et,$t]=N.useState(0),[qe,ln]=N.useState({x:0,y:0}),[dt,vn]=N.useState("IDLE"),[Wt,ji]=N.useState(null),[Bd,zd]=N.useState(!1),[os,D0]=N.useState(()=>Math.random()>.5),[jS,M0]=N.useState(!1),[N0,j0]=N.useState(!1),[$S,$0]=N.useState("normal"),[xr,F0]=N.useState(t),[Ul,qo]=N.useState({turnCount:0,damageDealtToOpponent:0,damageReceivedFromOpponent:0,followersDestroyed:0,myFollowersDestroyed:0}),[FS,Hd]=N.useState(null),[US,BS]=N.useState(null),[U0,B0]=N.useState(!1);N.useEffect(()=>{if(n!=="RANKED_MATCH"||!f||!g.winnerId||U0)return;(async()=>{try{const v=await UE(f,xr),b=g.winnerId===w;let O;b?O=qP(v.rating,v.winStreak,R??0):O=ZP(v.rating),await tO(f,xr,O,b),BS(O),B0(!0),console.log("[RatingUpdate] Rating updated:",O)}catch(v){console.error("[RatingUpdate] Failed to update rating:",v),B0(!0)}})()},[n,f,g.winnerId,w,xr,R,U0]),N.useEffect(()=>{g.winnerId&&!Pe&&!Le&&Ie(!0)},[g.winnerId,Pe,Le]),N.useEffect(()=>{if(Et<=0){ln({x:0,y:0});return}let m;const v=()=>{const b=Date.now()*.03,O=25*Et*p,M=Math.sin(b*7)*O+Math.sin(b*13)*O*.5,H=Math.cos(b*11)*O+Math.cos(b*17)*O*.3;ln({x:M,y:H}),m=requestAnimationFrame(v)};return m=requestAnimationFrame(v),()=>cancelAnimationFrame(m)},[Et,p]);const[Wd,z0]=N.useState([]),zS=N.useRef(0),[Gd,H0]=N.useState(!1),[Vd,Bl]=N.useState(null),[Zo,$i]=N.useState(null),Dr=N.useRef(null),br=N.useRef(null),Er=N.useRef(null),Yd=N.useRef(g.logs.length),zl=D.useRef(!1),W0=D.useRef(!1),Hl=D.useRef(null);D.useEffect(()=>{const m=n==="HOST"||(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&te,v=X?E&&x:E&&x&&dt==="DONE";if(console.log("[GameScreen INIT_GAME useEffect]",{isHostSide:m,isCasualOrRanked:X,connected:E,"adapter exists":!!x,coinTossPhase:dt,canSendInitGame:v,"initialStateSentRef.current":zl.current}),m&&v&&!zl.current){console.log("[GameScreen] HOST side: Sending initial game state to JOIN"),zl.current=!0;const b=()=>{console.log("[GameScreen] HOST side: Actually sending INIT_GAME now, isFirstPlayer:",os);const O=X?{...g,firstPlayerId:os?"p1":"p2"}:g;x.send({type:"INIT_GAME",payload:O}),(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&(console.log("[GameScreen] HOST side: Sending READY_FOR_INTRO"),x.send({type:"READY_FOR_INTRO"}),ue.current=!0)};setTimeout(b,500),(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&setTimeout(()=>{$e||(console.log("[GameScreen] HOST side: Retrying INIT_GAME (no response yet)"),b())},2500)}},[n,E,x,g,dt,te,X,$e]),D.useEffect(()=>{!X||!x||!P||ue.current||y&&(console.log("[GameScreen] JOIN side: Sending READY_FOR_INTRO after game sync"),x.send({type:"READY_FOR_INTRO"}),ue.current=!0)},[X,x,P,y]),D.useEffect(()=>{!X||!x||!Ge||te&&$e&&ue.current&&(console.log("[GameScreen] HOST side: Both ready, sending START_INTRO"),x.send({type:"START_INTRO"}),Ce(!1),ye(!0))},[X,x,te,$e,Ge]);const ie=g.players[w],De=g.players[S];D.useEffect(()=>{var v,b;const m=g.logs.length;if(m>Yd.current)for(let O=Yd.current;O<m;O++){const M=g.logs[O],H=M.match(/(.+?)  (\d+) /);if(H){const j=H[1],U=parseInt(H[2],10),W=(ie==null?void 0:ie.name)===j?w:S,ae=zS.current++;z0(q=>[...q,{playerId:W,amount:U,key:ae}]),setTimeout(()=>{z0(q=>q.filter(he=>he.key!==ae))},1500)}const J=M.match(/(.+?) (?:)?/);if(J){const j=J[1],U=(v=g.players[w])==null?void 0:v.board.find(he=>(he==null?void 0:he.name)===j),W=(b=g.players[S])==null?void 0:b.board.find(he=>(he==null?void 0:he.name)===j),ae=U||W,q=U?w:S;if(ae){const he=g.players[q].board.findIndex(be=>(be==null?void 0:be.instanceId)===ae.instanceId),Xe=(q===w?Sr.current:sr.current)[he];if(Xe){const be=Xe.getBoundingClientRect(),Ve=be.left+be.width/2,Ze=be.top+be.height/2;Zl(He=>[...He,{id:Date.now()+Math.random(),value:0,x:Ve,y:Ze,color:"#e53e3e"}])}}}}Yd.current=m},[g.logs.length,w,S,ie==null?void 0:ie.name,g.players]);const[Kd,ea]=N.useState(!1),Mr=N.useRef(!1),_n=y_(((Em=g.players[w])==null?void 0:Em.board)||[],Mr),cn=y_(((Sm=g.players[S])==null?void 0:Sm.board)||[],Mr),ta=N.useRef(_n),Wl=N.useRef(cn),[ti,Gl]=N.useState(null),[Xd,G0]=N.useState(-1),Vl=N.useRef(null),[Fi,na]=N.useState([]),[Q,Nr]=N.useState(null),[ct,Yn]=N.useState(null),[HS,V0]=N.useState([]),WS=N.useRef(0),Y0=N.useRef(0),K0=N.useRef(null),X0=N.useRef(Q);X0.current=Q,N.useEffect(()=>{const m=Q==null?void 0:Q.sourceType;if(!m||m!=="BOARD"&&m!=="EVOLVE"){V0([]);return}const v=400,b=setInterval(()=>{const O=X0.current;if(!O||O.sourceType!=="BOARD"&&O.sourceType!=="EVOLVE")return;const M=Date.now(),H=Math.PI*(3-Math.sqrt(5));Y0.current+=H+(Math.random()-.5)*.3;const J=Y0.current,j=4+Math.random()*3,U={id:WS.current++,x:O.currentX,y:O.currentY,vx:Math.cos(J)*j,vy:Math.sin(J)*j,opacity:1,radius:3+Math.random()*2,createdAt:M};V0(W=>[...W.filter(q=>M-q.createdAt<v).map(q=>({...q,x:q.x+q.vx,y:q.y+q.vy,opacity:Math.max(0,1-(M-q.createdAt)/v)})),U])},80);return()=>clearInterval(b)},[Q==null?void 0:Q.sourceType]),N.useEffect(()=>{const m=(Q==null?void 0:Q.sourceType)==="EVOLVE";if(m&&!Er.current){const v=new Audio(et("/se/aura.mp3"));v.loop=!0,v.volume=0,v.play().catch(()=>{}),Er.current=v;const b=300,O=30,M=b/O,H=.25/M;let J=0;const j=setInterval(()=>{J++,Er.current&&(Er.current.volume=Math.min(J*H,.25)),J>=M&&clearInterval(j)},O)}else if(!m&&Er.current){const v=Er.current,b=200,O=20,M=b/O,H=v.volume/M;let J=0;const j=setInterval(()=>{J++,v.volume=Math.max(0,v.volume-H),J>=M&&(clearInterval(j),v.pause(),v.currentTime=0)},O);Er.current=null}return()=>{!Q&&Er.current&&(Er.current.pause(),Er.current=null)}},[Q==null?void 0:Q.sourceType]);const[Q0,Qd]=N.useState(new Set),[J0,Yl]=N.useState(null),[q0,Kl]=N.useState(null),[GS,Z0]=N.useState(null),[Ue,jr]=N.useState(null),Jd=N.useCallback(m=>{const v=Br(m);v&&(g.winnerId?Hd(v):jr({card:v,owner:"OPPONENT",source:"LOG"}))},[g.winnerId]),VS=N.useCallback(m=>{const v=/([^]+)/g,b=[];let O=0,M,H=0;const J=DS();for(;(M=v.exec(m))!==null;){M.index>O&&b.push(a.jsx("span",{children:m.slice(O,M.index)},H++));const j=M[1];J.includes(j)?b.push(a.jsxs("span",{style:{color:"#ffd700",cursor:"pointer",textDecoration:"underline",textUnderlineOffset:"2px",fontWeight:"bold"},onMouseEnter:W=>{W.target.style.color="#ffec8b",W.target.style.textShadow="0 0 8px rgba(255, 215, 0, 0.8)"},onMouseLeave:W=>{W.target.style.color="#ffd700",W.target.style.textShadow="none"},onClick:W=>{W.stopPropagation(),Jd(j)},children:["",j,""]},H++)):b.push(a.jsxs("span",{children:["",j,""]},H++)),O=M.index+M[0].length}return O<m.length&&b.push(a.jsx("span",{children:m.slice(O)},H++)),b.length>0?a.jsx(a.Fragment,{children:b}):m},[Jd]),[Xl,Ui]=N.useState([]),Bt=(m,v,b,O)=>{if(!m)return;let M=window.innerWidth/2,H=window.innerHeight/2;const J=v===S;if(b===void 0||b===-1){const U=J?zi:ri;if(U.current){const W=U.current.getBoundingClientRect(),ae=ce(W.left+W.width/2,W.top+W.height/2);M=ae.x,H=ae.y}else H=J?150:NS-250}else if(b!==void 0&&b>=0){const U=J?sr:Sr,W=J?Wl.current:ta.current;let ae=b;if(O){const he=W.findIndex(_e=>_e&&_e.instanceId===O);he>=0&&(ae=he)}const q=U.current[ae];if(q){const he=q.getBoundingClientRect(),_e=ce(he.left+he.width/2,he.top+he.height/2);M=_e.x,H=_e.y}}Ui(U=>[...U,{type:m,x:M,y:H,key:Date.now()+Math.random()}])},em=(m,v,b,O,M)=>{let H=window.innerWidth/2,J=window.innerHeight/2;const j=m===S,U=j?sr:Sr,W=j?Wl.current:ta.current;let ae=v;if(M){const he=W.findIndex(_e=>_e&&_e.instanceId===M);he>=0&&(ae=he)}const q=U.current[ae];if(q){const he=q.getBoundingClientRect(),_e=ce(he.left+he.width/2,he.top+he.height/2);H=_e.x,J=_e.y}Ui(he=>[...he,{type:"BUFF",x:H,y:J,key:Date.now()+Math.random(),atkBuff:b,hpBuff:O}])},rr=(m,v,b,O)=>{Bt(m,v,b,O),n==="HOST"&&E&&x&&x.send({type:"EFFECT",payload:{effectType:m,targetPlayerId:v||"",targetIndex:b??-1,targetInstanceId:O}})},ra=(m,v,b,O,M)=>{em(m,v,b,O,M),n==="HOST"&&E&&x&&x.send({type:"EFFECT",payload:{effectType:"BUFF",targetPlayerId:m,targetIndex:v,targetInstanceId:M,isBuff:!0,atkBuff:b,hpBuff:O}})},tm=N.useRef([]),nm=N.useRef([]);N.useEffect(()=>{var O,M;const m=(H,J,j)=>{J.forEach(U=>{if(!U)return;if(!H.find(ae=>ae&&ae.instanceId===U.instanceId)&&U.killedByBane){const ae=j===S,q=ae?sr:Sr,_e=(ae?Wl.current:ta.current).findIndex(Xe=>Xe&&Xe.instanceId===U.instanceId);if(_e>=0&&q.current[_e]){const be=q.current[_e].getBoundingClientRect(),Ve=ce(be.left+be.width/2,be.top+be.height/2);Ui(Ze=>[...Ze,{type:"BANE",x:Ve.x,y:Ve.y,key:Date.now()+Math.random()}])}}})},v=((O=g.players[w])==null?void 0:O.board)||[],b=((M=g.players[S])==null?void 0:M.board)||[];m(v,tm.current,w),m(b,nm.current,S),tm.current=v.map(H=>H?{...H}:null),nm.current=b.map(H=>H?{...H}:null)},[g.players,w,S]);const qd=600,[as,sa]=N.useState(null),Zd=N.useRef({player:0,opponent:0}),[Tt,ia]=N.useState(()=>{try{const m=localStorage.getItem("audioSettings");if(m){const v=JSON.parse(m);if(v.enabled!==void 0){const{enabled:b,...O}=v;return{...O,bgmEnabled:b,seEnabled:b}}return v}return{bgm:.3,se:.5,voice:.5,bgmEnabled:!0,seEnabled:!0}}catch{return{bgm:.3,se:.5,voice:.5,bgmEnabled:!0,seEnabled:!0}}}),mt=N.useCallback((m,v=.5)=>{if(!Tt.seEnabled)return;const b=new Audio(et(`/se/${m}`));b.volume=Tt.se*v,b.play().catch(O=>console.warn("SE Play prevented",O))},[Tt]),Ql=N.useRef(null);N.useEffect(()=>{if(Q&&ct&&!Ql.current)mt("Buon.mp3",.25);else if(Q&&ct&&Ql.current){const m=Ql.current;(m.instanceId!==ct.instanceId||m.index!==ct.index||m.playerId!==ct.playerId)&&mt("Buon.mp3",.25)}Ql.current=ct},[ct,Q,mt]);const xn=N.useRef(null),[YS,rm]=N.useState(!1);N.useEffect(()=>{localStorage.setItem("audioSettings",JSON.stringify(Tt)),xn.current&&(xn.current.volume=Tt.bgmEnabled?Tt.bgm:0,Tt.bgmEnabled?xn.current.paused&&xn.current.play().catch(m=>console.warn("Auto-play prevented",m)):xn.current.pause())},[Tt]);const[KS,Jl]=N.useState(!1),[XS,ef]=N.useState(!1),[QS,ql]=N.useState(!1),JS=N.useCallback(()=>{console.log("[GameScreen] handleSurrender called"),ql(!1),Jl(!1),n!=="CPU"&&x&&x.send({type:"SURRENDER",payload:{playerId:w}}),I({type:"CONCEDE",playerId:w})},[n,x,w]),[$r,tf]=N.useState(!1),nf=N.useRef(!1),[sm,im]=N.useState(!1),[rt,ni]=N.useState(null),Bi=N.useRef(null),zi=N.useRef(null),sr=N.useRef([]),Sr=N.useRef([]),ri=N.useRef(null),[qS,Zl]=N.useState([]),ec=N.useRef({player:20,opponent:20}),tc=N.useRef({player:0,opponent:0}),oa=N.useRef(new Map);N.useEffect(()=>{var M,H,J,j;if(!ie||!De)return;const m=ec.current.opponent-De.hp;m>0&&qo(U=>({...U,damageDealtToOpponent:U.damageDealtToOpponent+m}));const v=ec.current.player-ie.hp;v>0&&qo(U=>({...U,damageReceivedFromOpponent:U.damageReceivedFromOpponent+v}));const b=tc.current.opponent-(((M=De.board)==null?void 0:M.filter(U=>U).length)||0);b>0&&qo(U=>({...U,followersDestroyed:U.followersDestroyed+b}));const O=tc.current.player-(((H=ie.board)==null?void 0:H.filter(U=>U).length)||0);O>0&&qo(U=>({...U,myFollowersDestroyed:U.myFollowersDestroyed+O})),ec.current={player:ie.hp,opponent:De.hp},tc.current={player:((J=ie.board)==null?void 0:J.filter(U=>U).length)||0,opponent:((j=De.board)==null?void 0:j.filter(U=>U).length)||0}},[ie==null?void 0:ie.hp,De==null?void 0:De.hp,(Im=ie==null?void 0:ie.board)==null?void 0:Im.length,(Tm=De==null?void 0:De.board)==null?void 0:Tm.length]);const tn=N.useRef(null),om="lastPlayedBgm",am=N.useCallback(m=>{const v={AJA:[et("/bgm/Green Misty Mountains.mp3"),et("/bgm/Jade Moon.mp3"),et("/bgm/amaama.mp3"),et("/bgm/kingetsu.mp3")],SENKA:[et("/bgm/ouka.mp3"),et("/bgm/Jade Moon.mp3"),et("/bgm/amaama.mp3"),et("/bgm/kingetsu.mp3")]},b=v[m]||v.SENKA,O=sessionStorage.getItem(om),M=b.length>1?b.filter(J=>J!==O):b,H=M[Math.floor(Math.random()*M.length)];return sessionStorage.setItem(om,H),encodeURI(H)},[]),[rf,lm]=N.useState(null);N.useEffect(()=>{var m,v;if(console.log(`[PendingEffects] useEffect fired. isProcessingEffect=${Kd}, pendingEffects.length=${((m=g.pendingEffects)==null?void 0:m.length)||0}, gameMode=${n}`),n==="JOIN"){console.log("[PendingEffects] Early return: JOIN mode waits for EFFECT messages from HOST");return}if(Kd){console.log("[PendingEffects] Early return: isProcessingEffect=true");return}if(g.pendingEffects&&g.pendingEffects.length>0){const b=g.pendingEffects[0];if(console.log(`[PendingEffects] Processing effect: ${b.effect.type} from ${b.sourceCard.name}`),Vl.current===b){console.log("[PendingEffects] Early return: same effect already processed");return}if(Vl.current=b,ea(!0),Mr.current=!0,b.effect.type==="GENERATE_CARD"&&b.effect.targetCardId){const pe=[b],G=g.pendingEffects||[];for(let we=1;we<G.length;we++){const ve=G[we];if(ve.effect.type==="GENERATE_CARD"&&ve.sourceCard.id===b.sourceCard.id&&ve.sourcePlayerId===b.sourcePlayerId)pe.push(ve);else break}const oe=120,ee=20,z=-(pe.length*oe+(pe.length-1)*ee-oe)/2,ne=b.sourcePlayerId===w,ge=ne?window.innerWidth-200*p:200*p,Oe=ne?window.innerHeight-100*p:100*p,Ee=pe.map((we,ve)=>({card:Br(we.effect.targetCardId),status:"APPEAR",targetX:ge,targetY:Oe,xOffset:z+ve*(oe+ee)})).filter(we=>we.card);if(Ee.length>0){na(Ee),tn.current&&clearTimeout(tn.current),tn.current=setTimeout(()=>{na(we=>we.map(ve=>({...ve,status:"FLY"}))),tn.current=setTimeout(()=>{na([]),ea(!1),Mr.current=!1,(n==="CPU"||n==="HOST")&&(pe.forEach(we=>{I({type:"RESOLVE_EFFECT",playerId:we.sourcePlayerId,payload:{targetId:we.targetId}})}),n==="HOST"&&E&&x&&setTimeout(()=>{const we=tt.current;x.send({type:"GAME_STATE",payload:we})},50)),tn.current=null},600)},800);return}}const O=b.effect.type==="DAMAGE"||b.effect.type==="AOE_DAMAGE"||b.effect.type==="RANDOM_DAMAGE"||b.effect.type==="RANDOM_DAMAGE_BY_TURN",M=b.effect.type==="DESTROY"||b.effect.type==="RANDOM_DESTROY",H=b.effect.type==="HEAL_LEADER",J=b.effect.type==="RANDOM_SET_HP",j=b.effect.type==="SET_MAX_HP",U=b.effect.type==="RETURN_TO_HAND",W=b.effect.type==="SUMMON_CARD"||b.effect.type==="SUMMON_CARD_RUSH",ae=b.effect.type==="VISUAL_BUFF_ONLY",q=b.effect.type==="BUFF_STATS",he=H||U||W||ae||q?600:50;if(O){let pe=b.sourceCard.attackEffectType||"SLASH";b.sourceCard.id==="c_alice"&&b.effect.targetType==="SELECT_FOLLOWER"&&(pe="WATER");const G=b.sourcePlayerId===w?S:w,oe=G===w?_n:cn;if(b.effect.type==="AOE_DAMAGE")g.players[G].board.forEach(se=>{if(se){const z=oe.findIndex(ne=>(ne==null?void 0:ne.instanceId)===se.instanceId);z!==-1&&rr(pe,G,z,se.instanceId)}});else if(b.targetIds)b.effect.type==="RANDOM_DAMAGE_BY_TURN"?b.targetIds.forEach((se,z)=>{setTimeout(()=>{const ne=oe.findIndex(ge=>(ge==null?void 0:ge.instanceId)===se);ne!==-1&&rr(pe,G,ne,se)},z*300)}):b.targetIds.forEach(ee=>{const se=oe.findIndex(z=>(z==null?void 0:z.instanceId)===ee);se!==-1&&rr(pe,G,se,ee)});else if(b.effect.targetType==="OPPONENT")rr(pe,G,-1),$n();else if(b.targetId){const ee=oe.findIndex(se=>(se==null?void 0:se.instanceId)===b.targetId);ee!==-1&&rr(pe,G,ee,b.targetId)}}else if(M){let pe=b.sourceCard.attackEffectType||"IMPACT";const G=b.sourcePlayerId===w?S:w,oe=G===w?_n:cn;if(b.effect.targetType==="ALL_OTHER_FOLLOWERS"){oe.forEach((z,ne)=>{z&&z.instanceId!==b.sourceCard.instanceId&&rr(pe,G,ne,z.instanceId)});const ee=b.sourcePlayerId;(ee===w?_n:cn).forEach((z,ne)=>{z&&z.instanceId!==b.sourceCard.instanceId&&rr(pe,ee,ne,z.instanceId)}),$n()}else if(b.targetIds)b.targetIds.forEach(ee=>{const se=oe.findIndex(z=>(z==null?void 0:z.instanceId)===ee);se!==-1&&rr(pe,G,se,ee)});else if(b.targetId){const ee=oe.findIndex(se=>(se==null?void 0:se.instanceId)===b.targetId);ee!==-1&&rr(pe,G,ee,b.targetId)}}else if(H){const pe=b.sourcePlayerId;rr("HEAL",pe)}else if(j){const pe=b.sourcePlayerId===w?S:w;rr("RAY",pe,-1),$n()}if(b.effect.type==="BUFF_STATS"){const pe=b.effect.value??0,G=b.effect.value2??0,oe=b.sourcePlayerId;if(b.effect.targetType==="SELF"){const se=(oe===w?_n:cn).findIndex(z=>(z==null?void 0:z.instanceId)===b.sourceCard.instanceId);se!==-1&&ra(oe,se,pe,G,b.sourceCard.instanceId)}else if(b.effect.targetType==="ALL_FOLLOWERS"){const ee=oe===w?_n:cn,se=g.players[oe].board,z=b.effect.conditions;se.forEach(ne=>{var ge;if(ne){if(z!=null&&z.tag&&!((ge=ne.tags)!=null&&ge.includes(z.tag))||z!=null&&z.nameIn&&!z.nameIn.includes(ne.name))return;const Oe=ee.findIndex(Ee=>(Ee==null?void 0:Ee.instanceId)===ne.instanceId);Oe!==-1&&ra(oe,Oe,pe,G,ne.instanceId)}})}else if(b.effect.targetType==="ALL_OTHER_FOLLOWERS"){const ee=oe===w?_n:cn,se=g.players[oe].board,z=b.effect.conditions;se.forEach(ne=>{var ge;if(ne&&ne.instanceId!==b.sourceCard.instanceId){if(z!=null&&z.tag&&!((ge=ne.tags)!=null&&ge.includes(z.tag))||z!=null&&z.nameIn&&!z.nameIn.includes(ne.name))return;const Oe=ee.findIndex(Ee=>(Ee==null?void 0:Ee.instanceId)===ne.instanceId);Oe!==-1&&ra(oe,Oe,pe,G,ne.instanceId)}})}else if(b.targetId){const se=(oe===w?_n:cn).findIndex(z=>(z==null?void 0:z.instanceId)===b.targetId);se!==-1&&ra(oe,se,pe,G,b.targetId)}}if(ae){const pe=b.effect.value??0,G=b.effect.value2??0,oe=b.sourcePlayerId,ee=b.sourceCard;setTimeout(()=>{const se=oe===w?_n:cn;if(ee!=null&&ee.instanceId){const z=se.findIndex(ne=>(ne==null?void 0:ne.instanceId)===ee.instanceId);z!==-1&&ra(oe,z,pe,G,ee.instanceId)}},300)}tn.current&&clearTimeout(tn.current);const Xe=O||M||J||j,be=b.effect.type==="RANDOM_DAMAGE_BY_TURN",Ve=be?((v=b.targetIds)==null?void 0:v.length)||g.turnCount:1,Ze=be?Ve*300+300:0,He=be?Ze:Xe?700:he,We=be?200:Xe?700:0;tn.current=setTimeout(()=>{(n==="CPU"||n==="HOST")&&(I({type:"RESOLVE_EFFECT",playerId:b.sourcePlayerId,payload:{targetId:b.targetId}}),n==="HOST"&&E&&x&&setTimeout(()=>{const pe=tt.current;x.send({type:"GAME_STATE",payload:pe})},50)),We>0?tn.current=setTimeout(()=>{ea(!1),Mr.current=!1,tn.current=null},We):(ea(!1),Mr.current=!1,tn.current=null)},He)}else Vl.current=null,tn.current&&(clearTimeout(tn.current),tn.current=null)},[g.pendingEffects,Kd,w,S,n,E,x]),N.useEffect(()=>{if(g.activePlayerId!==w)return;const m=w===g.firstPlayerId,v=g.turnCount,b=m?5:4;if(v===(m?7:6)){if(Xd===v)return;Gl("SUPER_EVOLVE_READY"),G0(v),setTimeout(()=>Gl(null),2500)}else if(v===b){if(Xd===v)return;Gl("EVOLVE_READY"),G0(v),setTimeout(()=>Gl(null),2500)}},[g.turnCount,g.activePlayerId,w,Xd,g.firstPlayerId]);const nc=N.useRef(g.players);N.useEffect(()=>{const m=nc.current,v=new Set;if(Object.keys(g.players).forEach(b=>{const O=g.players[b],M=m[b];if(!M)return;const H=new Set(M.board.filter(j=>j).map(j=>j.instanceId)),J=new Set(M.hand.filter(j=>j).map(j=>j.instanceId));O.board.forEach(j=>{if(!j)return;const U=j.instanceId;!H.has(U)&&!J.has(U)&&v.add(U)})}),v.size>0){Qd(O=>new Set([...O,...v]));const b=setTimeout(()=>{Qd(new Set)},1e3);return()=>clearTimeout(b)}},[g.players]),N.useEffect(()=>{const m=nc.current,v=g.players;let b=[];const O=M=>{const H=M.getBoundingClientRect();return{x:H.left+H.width/2,y:H.top+H.height/2}};Object.keys(v).forEach(M=>{const H=v[M],J=m[M];if(J&&H.hp<J.hp){const j=J.hp-H.hp,W=M===w?ri.current:zi.current;if(W){const ae=O(W);b.push({id:Date.now()+Math.random(),value:j,x:ae.x,y:ae.y,color:"#e53e3e"})}}else if(J&&H.hp>J.hp){const j=H.hp-J.hp,W=M===w?ri.current:zi.current;if(W){const ae=O(W);b.push({id:Date.now()+Math.random(),value:"+"+j,x:ae.x,y:ae.y,color:"#48bb78"})}}J==null||J.board.forEach(j=>{if(!j)return;const U=H.board.find(W=>(W==null?void 0:W.instanceId)===j.instanceId);if(U){const W=H.board.findIndex(_e=>(_e==null?void 0:_e.instanceId)===U.instanceId),he=(M===w?Sr.current:sr.current)[W];if(he){const _e=O(he);if(oa.current.set(j.instanceId,_e),U.currentHealth<j.currentHealth){const Xe=j.currentHealth-U.currentHealth;b.push({id:Date.now()+Math.random(),value:Xe,x:_e.x,y:_e.y,color:"#e53e3e"})}else if(U.currentHealth>j.currentHealth){const Xe=U.hasEvolved&&!j.hasEvolved,be=U.currentAttack!==j.currentAttack||U.maxHealth!==j.maxHealth;if(!Xe&&!be){const Ve=U.currentHealth-j.currentHealth;b.push({id:Date.now()+Math.random(),value:"+"+Ve,x:_e.x,y:_e.y,color:"#48bb78"})}}else U.currentHealth===j.currentHealth&&j.hasBarrier&&!U.hasBarrier&&b.push({id:Date.now()+Math.random(),value:0,x:_e.x,y:_e.y,color:"#e53e3e"})}}else{const W=H.graveyard.find(q=>q.instanceId===j.instanceId);let ae=0;if(W){const q=W.currentHealth||0;q<=0?ae=j.currentHealth-q:ae=0}else ae=j.currentHealth;if(ae>0){const q=oa.current.get(j.instanceId);q&&(q.x!==0||q.y!==0)&&b.push({id:Date.now()+Math.random(),value:ae,x:q.x,y:q.y,color:"#e53e3e"})}oa.current.delete(j.instanceId)}})}),b.length>0&&(Zl(H=>[...H,...b]),b.some(H=>H.color!=="#48bb78")&&$n()),nc.current=v},[g.players,w,S]);const sf=N.useRef(null),$n=()=>{sf.current||(im(!0),sf.current=setTimeout(()=>{im(!1),sf.current=null},300))},of=D.useCallback(m=>{Zl([]),Ui([]),na([]),Fn(null),Hi(null),sa(null),Qd(new Set),ls.current=!1,af.current=null,qo({turnCount:0,damageDealtToOpponent:0,damageReceivedFromOpponent:0,followersDestroyed:0,myFollowersDestroyed:0}),ec.current={player:20,opponent:20},tc.current={player:0,opponent:0},Hd(null),Ie(!1),Fe(!1),nt(null),M0(!1),j0(!1);const v=m||xr;m&&F0(m);let b=A;e==="CPU"&&(v==="YORUKA"?b=Math.random()<.5?"SENKA":"AJA":b=v==="SENKA"?"AJA":"SENKA");const M=su(d,v,e==="ONLINE"?"":"CPU",b);nc.current=M.players,Zd.current={player:M.players.p1.hand.length,opponent:M.players.p2.hand.length},lm(null),ye(n!=="JOIN"),D0(Math.random()>.5),vn("IDLE"),ji(null),zd(!1),n==="HOST"&&(zl.current=!1),I({type:"SYNC_STATE",payload:M})},[xr,A,e,n]),ZS=D.useCallback(()=>{if(ye(!1),Re(!1),V(!0),ji(os?"FIRST":"SECOND"),!os){const m={...g,activePlayerId:"p2",firstPlayerId:"p2",players:{p1:{...g.players.p1,maxPp:0,pp:0},p2:{...g.players.p2,maxPp:1,pp:1}},logs:[` 1 - ${g.players.p2.name} `]};I({type:"SYNC_STATE",payload:m})}vn("DONE")},[g,os]);D.useEffect(()=>{},[g.phase,dt,n,mt,E]),N.useEffect(()=>{if(rf===ie.class&&xn.current)return;const m=am(ie.class);console.log(`[BGM] Initializing track: ${m} for class: ${ie.class}`),xn.current&&(xn.current.pause(),xn.current=null);const v=new Audio(m);v.loop=!0,v.volume=Tt.bgm,xn.current=v,lm(ie.class)},[ie.class,am,rf]),N.useEffect(()=>()=>{xn.current&&(console.log("[GameScreen] Stopping BGM on unmount"),xn.current.pause(),xn.current=null)},[]),N.useEffect(()=>{if(!xn.current)return;const m=xn.current,v=()=>{m.paused&&Tt.bgmEnabled&&(console.log("[BGM] Attempting play on interaction..."),m.play().then(()=>{console.log("[BGM] Play success"),b()}).catch(O=>console.warn("[BGM] Play failed on interaction:",O)))},b=()=>{document.removeEventListener("click",v),document.removeEventListener("keydown",v),document.removeEventListener("touchstart",v)};return Tt.bgmEnabled?(document.addEventListener("click",v),document.addEventListener("keydown",v),document.addEventListener("touchstart",v),m.play().then(()=>{console.log("[BGM] Immediate play success"),b()}).catch(()=>console.log("[BGM] Immediate play blocked, waiting for interaction"))):(m.pause(),b()),()=>{b()}},[Tt.bgmEnabled,Tt.bgm,rf]),D.useEffect(()=>{if(!x){console.log("[GameScreen] Message handler setup skipped - no adapter yet");return}console.log("[GameScreen] Setting up message handler, adapter.isHost:",x.isHost);const m=v=>{var b,O,M,H,J;if(console.log("[GameScreen] Received message:",v.type,v),v.type==="HANDSHAKE"){const j=(b=v.payload)==null?void 0:b.name,U=typeof j=="string"&&j.trim().slice(0,12)||"";console.log("[GameScreen] Received HANDSHAKE from opponent:",U),Hl.current=U,I({type:"UPDATE_PLAYER_NAME",payload:{playerId:w==="p1"?"p2":"p1",name:U}});return}if(v.type==="INIT_GAME"){console.log("[GameScreen] JOIN side: Received initial game state from HOST"),I({type:"SYNC_STATE",payload:v.payload}),I({type:"UPDATE_PLAYER_NAME",payload:{playerId:w,name:d}});const j=w==="p1"?"p2":"p1";Hl.current&&(console.log("[GameScreen] Re-applying opponent name after INIT_GAME:",Hl.current),I({type:"UPDATE_PLAYER_NAME",payload:{playerId:j,name:Hl.current}})),L(!0);const U=v.payload.firstPlayerId===w;console.log("[GameScreen] JOIN side: Setting isFirstPlayer, firstPlayerId:",v.payload.firstPlayerId,"currentPlayerId:",w,"isJoinSideFirst:",U),D0(U),n==="CASUAL_MATCH"||n==="RANKED_MATCH"?console.log("[GameScreen] CASUAL_MATCH JOIN side: Waiting for intro sync"):ye(!0);return}if(v.type==="READY_FOR_INTRO"){console.log("[GameScreen] Received READY_FOR_INTRO from opponent"),gt(!0);return}if(v.type==="START_INTRO"){console.log("[GameScreen] Received START_INTRO - starting BattleIntro now"),Ce(!1),ye(!0);return}if(v.type==="GAME_STATE"){console.log("[GameScreen] JOIN: Received GAME_STATE sync from HOST"),I({type:"SYNC_STATE",payload:v.payload}),ea(!1),Mr.current=!1,Vl.current=null,na([]),tn.current&&(clearTimeout(tn.current),tn.current=null),!la.current&&!Gi.current&&(un.current=!1);return}if(v.type==="EFFECT"){const{effectType:j,targetPlayerId:U,targetIndex:W,targetInstanceId:ae,isBuff:q,atkBuff:he,hpBuff:_e}=v.payload;console.log("[GameScreen] JOIN: Received EFFECT from HOST:",j,U,W,ae),setTimeout(()=>{q&&he!==void 0&&_e!==void 0?em(U,W,he,_e,ae):Bt(j,U,W,ae)},50);return}if(v.type==="EVOLVE_ANIM"){const{playerId:j,followerIndex:U,useSep:W,targetId:ae,instanceId:q}=v.payload,he=(O=g.players[j])==null?void 0:O.board[U];if(he){const _e=he.evolvedImageUrl||((M=Br(he.id))==null?void 0:M.evolvedImageUrl),Xe=q||he.instanceId,be=cn.findIndex(G=>G&&G.instanceId===Xe),Ve=be>=0?sr.current[be]:null,Ze=fe.current.scale,He=window.innerHeight/2;let We=window.innerWidth/2,pe=He-70*Ze;if(Ve){const G=Ve.getBoundingClientRect();We=G.left+G.width/2,pe=G.top+G.height/2}Hi({card:he,evolvedImageUrl:_e,startX:We,startY:pe,phase:"ZOOM_IN",followerIndex:U,sourcePlayerId:j,useSep:W||!1,targetId:ae,isRemote:!0}),mt("fon.mp3",.7)}return}if(v.type==="PLAY_CARD_ANIM"){const{playerId:j,card:U,targetBoardIndex:W}=v.payload;if(U){const ae=((H=g.players[j])==null?void 0:H.board)||[],q=typeof W=="number"?W:ae.filter(z=>z!==null).length,he=fe.current.scale,_e=window.innerWidth/2,Xe=window.innerHeight/2,be=_e,Ve=80*he,Ze=_e,He=Xe-100*he,oe=-((Math.max(1,q+1)-1)*ii*he)/2+q*ii*he,ee=_e+oe,se=Xe-70*he;U.type==="SPELL"?Fn({card:U,sourceIndex:-1,startX:be,startY:Ve,targetX:Ze,targetY:He,playerClass:(De==null?void 0:De.class)||"SENKA",onComplete:()=>{Fn(null)}}):Fn({card:U,sourceIndex:-1,startX:be,startY:Ve,targetX:Ze,targetY:He,finalX:ee,finalY:se,playerClass:(De==null?void 0:De.class)||"SENKA",onComplete:()=>{mt("gan.mp3",.6),$n(),Fn(null)}})}return}if(v.type==="REMATCH_REQUEST"){console.log("[GameScreen] Opponent requested rematch"),j0(!0);return}if(v.type==="REMATCH_ACCEPT"){console.log("[GameScreen] Opponent accepted rematch - starting new game"),of(xr);return}if(v.type==="SURRENDER"){const j=(J=v.payload)==null?void 0:J.playerId;if(g.phase==="GAME_OVER"){console.warn("[GameScreen] Ignoring SURRENDER - game already over");return}if(j===w){console.warn(`[GameScreen] Security Alert: Received SURRENDER message targeting self (${w}). Ignoring.`);return}if(j!==S){console.warn(`[GameScreen] Security Alert: Invalid playerId in SURRENDER: ${j}. Expected: ${S}. Ignoring.`);return}console.log("[GameScreen] Opponent surrendered:",j),$0("surrender"),I({type:"CONCEDE",playerId:j});return}if(v.type==="STAMP"){console.log("[GameScreen] Opponent sent stamp:",v.stampId),br.current&&(clearTimeout(br.current),br.current=null);const j=c_(v.stampId);j&&mt(j,.6);const U={stampId:v.stampId,playerId:S,playerClass:v.playerClass||(De==null?void 0:De.class)||"SENKA",timestamp:Date.now()};$i(null),requestAnimationFrame(()=>{$i(U)}),br.current=setTimeout(()=>{$i(W=>(W==null?void 0:W.timestamp)===U.timestamp?null:W),br.current=null},3e3);return}if(v.type==="ACTION"){const j=v.payload;if(console.log("[GameScreen] Processing remote action:",j.type,"from player:",j.playerId),I({...j,isRemote:!0}),j.type==="ATTACK"){const{playerId:U,payload:W}=j,ae=g.players[U],q=ae==null?void 0:ae.board[W.attackerIndex],he=W.targetIsLeader?-1:W.targetIndex,_e=U==="p1"?"p2":"p1";if(q){const Xe=g.players[_e],be=W.targetIsLeader?null:Xe==null?void 0:Xe.board[W.targetIndex],Ve=be?be.instanceId:void 0;Bt(q.attackEffectType,_e,he,Ve)}}else j.type==="PLAY_CARD"||j.type==="EVOLVE"||j.type==="END_TURN"&&(console.log("[GameScreen] Remote END_TURN received, turn switching to:",j.playerId==="p1"?"p2":"p1"),Wi.current=!1)}};return x.onMessage(m),n!=="CPU"&&!W0.current&&(W0.current=!0,x.send({type:"HANDSHAKE",payload:{name:d,class:t}}),console.log("[GameScreen] Sent HANDSHAKE:",d,t)),x.onClose(()=>{if((n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&g.phase==="GAME_OVER"){console.log("[GameScreen] Connection closed after game over (casual match) - silent disconnect");return}if(n!=="CPU"&&g.phase!=="GAME_OVER"){console.log("[GameScreen] Opponent disconnected during game - treating as surrender, player wins"),$0("disconnect");const v={...g,phase:"GAME_OVER",winnerId:w,logs:[...g.logs,""]};I({type:"SYNC_STATE",payload:v});return}alert(`
`),s()}),()=>{}},[x,g,mt,Bt,n,s,w]);const ls=N.useRef(!1),af=N.useRef(null),Rn=N.useRef(null),[Ke,Fn]=N.useState(null),[Rt,Hi]=N.useState(null),un=N.useRef(!1),aa=N.useRef(null),Wi=N.useRef(!1),lf=N.useRef(Xl),cf=N.useRef(Fi),la=N.useRef(Ke),Gi=N.useRef(Rt);D.useEffect(()=>{lf.current=Xl,cf.current=Fi,la.current=Ke,Gi.current=Rt},[Xl,Fi,Ke,Rt]),D.useEffect(()=>{if(Ke&&Ke.card.name===""&&Tt.seEnabled){const m=new Audio(et("/se/beam.mp3"));m.volume=Tt.se*.8,m.play().catch(v=>console.warn("SE Play prevented",v))}},[Ke,Tt]),D.useEffect(()=>{ta.current=_n,Wl.current=cn},[_n,cn]),D.useEffect(()=>{const m=v=>{const b=v.getBoundingClientRect();return{x:b.left+b.width/2,y:b.top}};_n.forEach((v,b)=>{if(v&&v.instanceId){const O=Sr.current[b];if(O){const M=m(O);(M.x!==0||M.y!==0)&&oa.current.set(v.instanceId,M)}}}),cn.forEach((v,b)=>{if(v&&v.instanceId){const O=sr.current[b];if(O){const M=m(O);(M.x!==0||M.y!==0)&&oa.current.set(v.instanceId,M)}}})},[_n,cn]);const rc=(m,v,b,O)=>{const M=Ir.current.board,H=O?M.findIndex(q=>q&&q.instanceId===O):m,J=H>=0?M[H]:null;if(!J)return;if(J.hasEvolved){console.log("[GameScreen] Cannot evolve: card already evolved");return}const j=Sr.current[m];let U=window.innerWidth/2,W=window.innerHeight/2;if(j){const q=j.getBoundingClientRect();U=q.left+q.width/2,W=q.top+q.height/2}const ae=J.instanceId;n!=="CPU"&&E&&x&&x.send({type:"EVOLVE_ANIM",payload:{playerId:w,followerIndex:H,useSep:v,targetId:b,instanceId:ae}}),Hi({card:J,evolvedImageUrl:J.evolvedImageUrl,startX:U,startY:W,phase:"ZOOM_IN",followerIndex:H,useSep:v,targetId:b,sourcePlayerId:w}),mt("fon.mp3",.7)},uf=N.useRef(null),eI=N.useCallback(m=>{if(console.log("[GameScreen] handleEvolvePhaseChange:",m),m==="WHITE_FADE"&&mt("fon.mp3",.7),m==="LAND"&&mt("gan.mp3",.6),m==="DONE"){const v=Gi.current;if(v&&!v.isRemote){const O={type:"EVOLVE",playerId:v.sourcePlayerId||w,payload:{followerIndex:v.followerIndex,useSep:v.useSep,targetId:v.targetId}};I(O),x&&n!=="CPU"&&x.send({type:"ACTION",payload:O})}Hi(null)}else Hi(v=>v?{...v,phase:m}:null)},[x,I,n,w,mt]),df=(m,v,b)=>{var We,pe,G,oe,ee,se;const M=Ir.current.hand[m];if(!M){console.warn("[handlePlayCard] Card not found at index:",m);return}if(M.instanceId&&aa.current===M.instanceId){console.warn("[handlePlayCard] Duplicate play blocked for instanceId:",M.instanceId);return}if(un.current){console.warn("[handlePlayCard] Card play locked, ignoring duplicate call");return}un.current=!0,aa.current=M.instanceId||null,mt("card.mp3",.5);const H=(We=M.triggers)==null?void 0:We.find(z=>z.trigger==="FANFARE"),J=H==null?void 0:H.effects[0];let j=S;const U=(J==null?void 0:J.targetType)==="SELECT_ALLY_FOLLOWER"||(J==null?void 0:J.targetType)==="SELECT_OTHER_ALLY_FOLLOWER";J&&(U||["GRANT_PASSIVE","BUFF_STATS","HEAL_FOLLOWER"].includes(J.type))&&(j=w);const W=["SELECT_FOLLOWER","SELECT_ALLY_FOLLOWER","SELECT_OTHER_ALLY_FOLLOWER"],ae=M.type==="SPELL"&&((pe=M.triggers)==null?void 0:pe.some(z=>z.effects.some(ne=>ne.targetType&&W.includes(ne.targetType))))||M.type==="FOLLOWER"&&(((oe=(G=M.triggerAbilities)==null?void 0:G.FANFARE)==null?void 0:oe.targetType)&&W.includes(M.triggerAbilities.FANFARE.targetType)||((ee=M.triggers)==null?void 0:ee.some(z=>z.trigger==="FANFARE"&&z.effects.some(ne=>ne.targetType&&W.includes(ne.targetType))))),he=tt.current.players[j].board.some(z=>{var ne,ge;return z&&(j===w||!((ne=z.passiveAbilities)!=null&&ne.includes("STEALTH"))&&!((ge=z.passiveAbilities)!=null&&ge.includes("AURA")))});if(console.log(`[handlePlayCard] needsTarget: ${ae}, allowedTarget: ${j}, hasValidTargets: ${he}`),ae&&he){ni({type:"PLAY",sourceIndex:m,sourceInstanceId:M.instanceId,allowedTargetPlayerId:j}),Nr(null);return}const _e=window.innerWidth/2,Xe=window.innerHeight/2;let be,Ve;if(M.type==="FOLLOWER"){const ne=tt.current.players[w].board.filter(ke=>ke!==null),ge=ne.length+1,Oe=ne.length,Ee=ii*p,we=(Oe-(ge-1)/2)*Ee,ve=(se=Bi.current)==null?void 0:se.getBoundingClientRect();be=(ve?ve.left+ve.width/2:window.innerWidth/2)+we,Ve=window.innerHeight/2+70*p}const Ze=()=>{M.type!=="SPELL"&&(mt("gan.mp3",.6),$n()),cs({type:"PLAY_CARD",playerId:w,payload:{cardIndex:m,instanceId:M.instanceId}}),Fn(null),setTimeout(()=>{un.current=!1},100)},He=M.type==="FOLLOWER"?tt.current.players[w].board.filter(z=>z!==null).length:void 0;n!=="CPU"&&E&&x&&x.send({type:"PLAY_CARD_ANIM",payload:{playerId:w,cardIndex:m,card:M,targetBoardIndex:He}}),Fn({card:M,sourceIndex:m,startX:v,startY:b,targetX:_e,targetY:Xe,finalX:be,finalY:Ve,playerClass:(ie==null?void 0:ie.class)||"SENKA",onComplete:Ze}),setTimeout(()=>{Fn(z=>(z==null?void 0:z.card.id)===M.id?(Ze(),null):z)},2e3)},cs=m=>{I(m),n!=="CPU"&&E&&!m.isRemote&&(x==null||x.send({type:"ACTION",payload:m}))};N.useEffect(()=>{if(!Rt&&uf.current){const m=uf.current;uf.current=null,console.log("[GameScreen] Dispatching pending evolve action for:",m.playerId),cs({type:"EVOLVE",playerId:m.playerId,payload:{followerIndex:m.followerIndex,useSep:m.useSep,targetId:m.targetId}})}},[Rt,w,cs]);const Ir=N.useRef(ie),tt=N.useRef(g);N.useEffect(()=>{Ir.current=ie,tt.current=g},[ie,g]);const ir=N.useRef(!1);N.useEffect(()=>{const m=Zd.current,v=ie.hand.length,b=De.hand.length;if(v>m.player){const O=v-m.player;sa({isPlayer:!0,count:O}),mt("card.mp3",.5),setTimeout(()=>sa(null),qd)}if(b>m.opponent){const O=b-m.opponent;sa({isPlayer:!1,count:O}),mt("card.mp3",.5),setTimeout(()=>sa(null),qd)}Zd.current={player:v,opponent:b}},[ie.hand.length,De.hand.length,Tt,mt]),D.useEffect(()=>{g.activePlayerId===w&&(console.log("[GameScreen] Player turn started - resetting card play lock and ending turn state"),un.current=!1,aa.current=null,Wi.current=!1)},[g.activePlayerId,g.turnCount,w]),D.useEffect(()=>{if(n==="CPU")return;const m=setInterval(()=>{un.current&&!la.current&&!Gi.current&&!rt&&g.activePlayerId===w&&(console.warn("[GameScreen] Safety release: Card play lock was stuck, releasing"),un.current=!1)},3e3);return()=>clearInterval(m)},[n,rt,g.activePlayerId,w]),D.useEffect(()=>{if(n!=="CPU")return;if(g.winnerId){ls.current=!1;return}const m=`${g.turnCount}-${g.activePlayerId}`;if(g.activePlayerId===w){ls.current=!1;return}if(g.activePlayerId===S){if(ls.current||af.current===m)return;(async()=>{var be,Ve,Ze,He,We,pe;ls.current=!0,af.current=m;const b=async(G=300)=>{await new Promise(se=>setTimeout(se,G));const oe=()=>{const se=tt.current,z=se.pendingEffects&&se.pendingEffects.length>0,ne=lf.current.length>0,ge=cf.current.length>0,Oe=la.current!==null,Ee=Gi.current!==null;return!z&&!ne&&!ge&&!Oe&&!Ee};let ee=0;for(;!oe()&&ee<60;){await new Promise(z=>setTimeout(z,100)),ee++;const se=tt.current;if(se.pendingEffects&&se.pendingEffects.length>0&&!Mr.current){console.log("[waitForIdle] Forcing RESOLVE_EFFECT for stuck pending effect");const z=se.pendingEffects[0];I({type:"RESOLVE_EFFECT",playerId:z.sourcePlayerId,payload:{targetId:z.targetId}}),await new Promise(ne=>setTimeout(ne,200))}}},O=(G,oe)=>{var ee;return G?!!((ee=G.passiveAbilities)!=null&&ee.includes("IMMUNE_TO_FOLLOWER_DAMAGE")):!1},M=(G,oe)=>{var ee;return!oe||!G?!1:(ee=oe.passiveAbilities)!=null&&ee.includes("BANE")&&!G.hasBarrier?!0:(oe.currentAttack||0)>=G.currentHealth},H=(G,oe)=>{var ee;return!oe||!G?!1:(ee=G.passiveAbilities)!=null&&ee.includes("BANE")?!oe.hasBarrier:G.currentAttack>=oe.currentHealth},J=G=>{var ne,ge,Oe;let oe=0;const ee=G.players[S].board.filter(Ee=>Ee!==null),z=G.players[w].board.filter(Ee=>Ee!==null).some(Ee=>{var we,ve;return((we=Ee.passiveAbilities)==null?void 0:we.includes("WARD"))&&!((ve=Ee.passiveAbilities)!=null&&ve.includes("STEALTH"))});for(const Ee of ee)!Ee.canAttack||!((ne=Ee.passiveAbilities)!=null&&ne.includes("STORM")||Ee.turnPlayed!==G.turnCount)||z&&!((ge=Ee.passiveAbilities)!=null&&ge.includes("STEALTH"))&&!Ee.hadStealth||(oe+=Ee.currentAttack||0,(Oe=Ee.passiveAbilities)!=null&&Oe.includes("DOUBLE_ATTACK")&&(oe+=Ee.currentAttack||0));return oe},j=G=>{var se,z,ne;let oe=0;const ee=G.players[w].board.filter(ge=>ge!==null);for(const ge of ee)oe+=ge.currentAttack||0,(se=ge.passiveAbilities)!=null&&se.includes("DOUBLE_ATTACK")&&(oe+=ge.currentAttack||0),(z=ge.passiveAbilities)!=null&&z.includes("BANE")&&(oe+=15),(ne=ge.passiveAbilities)!=null&&ne.includes("STORM")&&(oe+=10);return oe},U=(G,oe)=>{var we,ve,Qe,ke;let ee=G.cost*10;const se=oe.players[w].board.filter(Ne=>Ne!==null),z=oe.players[S].board.filter(Ne=>Ne!==null),ne=oe.players[w].hp,ge=oe.players[S].hp,Oe=oe.players[S].pp;if((we=G.passiveAbilities)!=null&&we.includes("STORM")){const Ne=J(oe),Me=G.attack||0;Ne+Me>=ne?ee+=500:ne<=10?ee+=100:ee+=30}if(se.length>0){const Ne=G.triggers||[],Me=j(oe);for(const xt of Ne)if(xt.trigger==="FANFARE")for(const Be of xt.effects||[]){if(Be.type==="DESTROY"&&(ee+=60+(Me>10?30:0)),Be.type==="RANDOM_DESTROY"){const Je=Be.value||1;ee+=40*Je+(Me>10?20:0)}["DAMAGE","SELECT_DAMAGE"].includes(Be.type)&&(ee+=35),Be.type==="AOE_DAMAGE"&&(ee+=25*Math.min(se.length,3))}}ge<=10&&((ve=G.passiveAbilities)!=null&&ve.includes("WARD")&&(ee+=80),ee+=20),G.cost===Oe?ee+=15:Oe-G.cost<=1&&(ee+=10);const Ee=G.triggers||[];for(const Ne of Ee)if(Ne.trigger==="FANFARE")for(const Me of Ne.effects||[])Me.type==="DRAW"&&(ee+=20*(Me.value||1)),(Me.type==="SUMMON_CARD"||Me.type==="SUMMON_CARD_RUSH")&&(ee+=30),Me.type==="GENERATE_CARD"&&(ee+=15),Me.type==="HEAL"&&(ee+=ge<15?25:10);return G.type==="FOLLOWER"&&((G.attack||0)+(G.health||0)>=G.cost*2.5&&(ee+=15),(Qe=G.passiveAbilities)!=null&&Qe.includes("WARD")&&se.length>0&&(ee+=25),(ke=G.passiveAbilities)!=null&&ke.includes("BANE")&&(ee+=20)),G.type==="FOLLOWER"&&z.length>=5&&(ee-=200),ee},W=(G,oe,ee,se)=>{let z=0;const ne=ee.players[w].board.filter(ve=>ve!==null),ge=ee.players[S].board.filter(ve=>ve!==null),Oe=G.triggers||[],Ee=se?"SUPER_EVOLVE":"EVOLVE";let we=!1;for(const ve of Oe)if(ve.trigger===Ee){we=!0;for(const Qe of ve.effects||[]){if(["DESTROY","RANDOM_DESTROY","DAMAGE","SELECT_DAMAGE","AOE_DAMAGE"].includes(Qe.type)&&(z+=ne.length>0?80:5),["SUMMON_CARD","SUMMON_CARD_RUSH"].includes(Qe.type)&&(z+=60),Qe.type==="BUFF_STATS"){const ke=Qe.targetType||"SELF";ke==="ALL_OTHER_FOLLOWERS"||ke==="ALL_FOLLOWERS"?z+=25*Math.max(1,ge.length-1):z+=30}Qe.type==="DRAW"&&(z+=35),Qe.type==="GENERATE_CARD"&&(z+=25)}}return G.canAttack?(z+=30,z+=(G.currentAttack||0)*5):z+=(G.currentAttack||0)*2,G.cost>=6&&we&&(z+=20),!we&&G.cost<=3&&(z-=30),z},ae=(G,oe)=>{const se=G.players[S].board.filter(ke=>ke!==null),z=G.players[w].board.filter(ke=>ke!==null),ne=G.players[w].hp,ge=G.players[S].hp,Oe=G.turnCount,Ee=se.filter(ke=>ke&&!ke.hasEvolved);if(Ee.length===0)return!1;const we=Ee.map((ke,Ne)=>({c:ke,i:Ne,score:W(ke,Ne,G,oe)})),ve=Math.max(...we.map(ke=>ke.score));if(ne<=12&&se.some(ke=>ke&&ke.canAttack)||ge<=10)return!0;const Qe=j(G);return Qe>=8&&Ee.some(Ne=>{const Me=Ne.triggers||[];for(const xt of Me)if(xt.trigger===(oe?"SUPER_EVOLVE":"EVOLVE")){for(const Be of xt.effects||[])if(["DESTROY","RANDOM_DESTROY","DAMAGE","AOE_DAMAGE"].includes(Be.type))return!0}return!1})&&z.length>0||ve>=80||oe&&ve>=50?!0:Oe<=5&&ge>=15&&Qe<8?ve>=100:ve<30?!1:ve>=50},q=(G,oe,ee)=>{var Oe,Ee,we,ve,Qe;const se=((Oe=G.passiveAbilities)==null?void 0:Oe.includes("STORM"))||G.turnPlayed!==ee.turnCount,z=oe.map((ke,Ne)=>({c:ke,i:Ne})).filter(({c:ke})=>{var Ne,Me;return ke!==null&&!((Ne=ke.passiveAbilities)!=null&&Ne.includes("STEALTH"))&&!((Me=ke.passiveAbilities)!=null&&Me.includes("AURA"))});if(!(((Ee=G.passiveAbilities)==null?void 0:Ee.includes("STEALTH"))||G.hadStealth)){const ke=z.find(({c:Ne})=>{var Me;return(Me=Ne.passiveAbilities)==null?void 0:Me.includes("WARD")});if(ke)return O(ke.c)?{index:-1,isLeader:!1}:{index:ke.i,isLeader:!1}}let ge={index:-1,isLeader:se,score:se?0:-1e3};for(const{c:ke,i:Ne}of z){if(O(ke))continue;let Me=0;const xt=G.isEvolved,Be=(we=ke.passiveAbilities)==null?void 0:we.includes("BANE"),Je=M(G,ke);H(G,ke)?(Me+=50,Me+=(ke.currentAttack||0)*5,Je?Be&&xt?Me-=60:Be&&(Me-=30):Me+=30,Be&&!Je&&(Me+=40),(ve=ke.passiveAbilities)!=null&&ve.includes("STORM")&&(Me+=30),(Qe=ke.passiveAbilities)!=null&&Qe.includes("DOUBLE_ATTACK")&&(Me+=35)):!Je&&G.currentAttack>=ke.currentHealth/2?Me+=10:Je&&(Me-=50,xt&&(Me-=40),(ke.currentAttack||0)>=5&&(Me+=10)),Me>ge.score&&(ge={index:Ne,isLeader:!1,score:Me})}return se&&(ge.index===-1||ge.score<=0)?{index:-1,isLeader:!0}:ge},he=u==="EASY"?1200:u==="HARD"?400:800;if(await new Promise(G=>setTimeout(G,he)),!ls.current)return;let _e=0;const Xe=u==="EASY"?1:u==="HARD"?5:3;for(;_e<Xe;){const G=tt.current,oe=G.players[S].hand,ee=G.players[S].pp,z=G.players[S].board.filter(Be=>Be!==null).length>=5;let ne=oe.map((Be,Je)=>({...Be,originalIndex:Je})).filter(Be=>Be.cost<=ee).filter(Be=>!(Be.type==="FOLLOWER"&&z));if(ne.length===0||(u==="HARD"?ne=ne.sort((Be,Je)=>U(Je,G)-U(Be,G)):ne=ne.sort((Be,Je)=>Je.cost-Be.cost),u==="EASY"&&Math.random()<.3&&_e>0))break;const ge=ne[0];let Oe;const we=G.players[w].board.filter(Be=>{var Je,pt;return Be&&!((Je=Be.passiveAbilities)!=null&&Je.includes("STEALTH"))&&!((pt=Be.passiveAbilities)!=null&&pt.includes("AURA"))});we.length>0&&(u==="HARD"?Oe=[...we].sort((Je,pt)=>{var yt,St;let it=(Je.currentAttack||0)+(Je.currentHealth||0),ft=(pt.currentAttack||0)+(pt.currentHealth||0);return(yt=Je.passiveAbilities)!=null&&yt.includes("BANE")&&(it+=10),(St=pt.passiveAbilities)!=null&&St.includes("BANE")&&(ft+=10),ft-it})[0].instanceId:Oe=we[0].instanceId);const ve=window.innerWidth-20*p-80*p/2,Qe=20*p+110*p/2,ke=window.innerWidth/2,Ne=window.innerHeight/2;let Me,xt;if(ge.type==="FOLLOWER"){const Je=tt.current.players[S].board.filter(lc=>lc!==null),pt=Je.length+1,it=Je.length,ft=ii*p,yt=(it-(pt-1)/2)*ft,St=(be=Bi.current)==null?void 0:be.getBoundingClientRect();Me=(St?St.left+St.width/2:window.innerWidth/2)+yt,xt=window.innerHeight/2-70*p}Fn({card:ge,sourceIndex:-1,startX:ve,startY:Qe,targetX:ke,targetY:Ne,finalX:Me,finalY:xt,playerClass:(De==null?void 0:De.class)||"SENKA",onComplete:()=>{if(ge.type!=="SPELL"&&(mt("gan.mp3",.6),$n()),I({type:"PLAY_CARD",playerId:S,payload:{cardIndex:ge.originalIndex,targetId:Oe,instanceId:ge.instanceId}}),ge.id==="c_amandava"&&tt.current.players[w].board.forEach((Je,pt)=>{if(Je){const it=Je.instanceId;setTimeout(()=>{Bt("SHOT",w,pt,it)},200)}}),ge.id==="c_azya"){if(setTimeout(()=>{Bt("THUNDER",w,-1)},200),Oe){const Je=tt.current.players[w].board.findIndex(pt=>(pt==null?void 0:pt.instanceId)===Oe);Je!==-1&&setTimeout(()=>{Bt("ICE",w,Je,Oe)},400)}setTimeout(()=>{const Be=tt.current.players[w].board,Je=Be.filter(pt=>pt!==null);if(Je.length>0){const pt=Je[Math.floor(Math.random()*Je.length)],it=Be.findIndex(ft=>(ft==null?void 0:ft.instanceId)===(pt==null?void 0:pt.instanceId));it!==-1&&Bt("WATER",w,it,pt==null?void 0:pt.instanceId)}},600)}Fn(null)}}),await b(600),_e++}{const G=tt.current,oe=G.players[S],ee=S===G.firstPlayerId,se=G.turnCount,z=h_(oe,se,ee);if((f_(oe,se,ee)||z)&&oe.board.length>0){const ge=oe.board.map((Oe,Ee)=>({c:Oe,i:Ee})).filter(({c:Oe})=>Oe&&Oe.type==="FOLLOWER"&&!Oe.hasEvolved);if(ge.length>0){let Oe;const Ee=z;if(u==="HARD"&&(ae(G,Ee)||console.log("[AI HARD] Skipping evolution - saving EP for better opportunity")),u==="HARD"&&!ae(G,Ee))Oe=null;else if(u==="EASY")Oe=ge[Math.floor(Math.random()*ge.length)];else{const ve=ge.map(({c:Qe,i:ke})=>({c:Qe,i:ke,score:W(Qe,ke,G,Ee)}));ve.sort((Qe,ke)=>ke.score-Qe.score),u==="HARD"&&ve[0].score<5?(console.log("[AI HARD] Evolution target score too low:",ve[0].score),Oe=null):Oe=ve[0]}if(Oe){let ve;const ke=G.players[w].board.filter(Me=>{var xt,Be;return Me!==null&&!((xt=Me.passiveAbilities)!=null&&xt.includes("STEALTH"))&&!((Be=Me.passiveAbilities)!=null&&Be.includes("AURA"))});ke.length>0&&(u==="HARD"?ve=[...ke].sort((xt,Be)=>{var it,ft,yt,St;let Je=(xt.currentAttack||0)*2+(xt.currentHealth||0),pt=(Be.currentAttack||0)*2+(Be.currentHealth||0);return(it=xt.passiveAbilities)!=null&&it.includes("BANE")&&(Je+=10),(ft=Be.passiveAbilities)!=null&&ft.includes("BANE")&&(pt+=10),(yt=xt.passiveAbilities)!=null&&yt.includes("DOUBLE_ATTACK")&&(Je+=5),(St=Be.passiveAbilities)!=null&&St.includes("DOUBLE_ATTACK")&&(pt+=5),pt-Je})[0].instanceId:ve=ke[0].instanceId);const Ne=(Ve=sr.current[Oe.i])==null?void 0:Ve.getBoundingClientRect();Ne?(Hi({card:Oe.c,evolvedImageUrl:Oe.c.evolvedImageUrl,startX:Ne.left+Ne.width/2,startY:Ne.top+Ne.height/2,useSep:Ee,phase:"ZOOM_IN",followerIndex:Oe.i,sourcePlayerId:S,targetId:ve}),await b(800)):(cs({type:"EVOLVE",playerId:S,payload:{followerIndex:Oe.i,useSep:Ee,targetId:ve}}),await b(400))}}}}{let G=!0,oe=0;const ee=se=>{if(u!=="HARD")return!1;const z=se.players[w].hp;return J(se)>=z};for(;G&&oe<15;){if(tt.current.winnerId){G=!1;break}oe++;const se=tt.current,z=se.players[S].board,ne=se.players[w].board,ge=ee(se);let Oe=!1;for(let Ee=0;Ee<z.length;Ee++){const we=z[Ee];if(!we||!we.canAttack)continue;let ve=-1,Qe=!0;const ke=((Ze=we.passiveAbilities)==null?void 0:Ze.includes("STEALTH"))||we.hadStealth,Ne=ke?-1:ne.findIndex(it=>{var ft,yt;return it&&((ft=it.passiveAbilities)==null?void 0:ft.includes("WARD"))&&!((yt=it.passiveAbilities)!=null&&yt.includes("STEALTH"))&&!O(it)});if(ge&&Ne===-1)if(((He=we.passiveAbilities)==null?void 0:He.includes("STORM"))||we.turnPlayed!==se.turnCount)ve=-1,Qe=!0;else{const yt=ne.map((St,hs)=>({c:St,idx:hs})).filter(({c:St})=>{var hs,lc;return St&&!((hs=St.passiveAbilities)!=null&&hs.includes("STEALTH"))&&!((lc=St.passiveAbilities)!=null&&lc.includes("AURA"))&&!O(St)});if(yt.length>0)ve=yt[0].idx,Qe=!1;else continue}else if(Ne!==-1)ve=Ne,Qe=!1;else if(u==="EASY"){const it=ne.map((yt,St)=>({c:yt,idx:St})).filter(({c:yt})=>{var St,hs;return yt&&!((St=yt.passiveAbilities)!=null&&St.includes("STEALTH"))&&!((hs=yt.passiveAbilities)!=null&&hs.includes("AURA"))&&!O(yt)}),ft=((We=we.passiveAbilities)==null?void 0:We.includes("STORM"))||we.turnPlayed!==se.turnCount;if(!ft&&it.length>0)ve=it[Math.floor(Math.random()*it.length)].idx,Qe=!1;else{if(!ft&&it.length===0)continue;ft&&it.length>0&&Math.random()<.5&&(ve=it[Math.floor(Math.random()*it.length)].idx,Qe=!1)}}else{const it=q(we,ne,se);if(ve=it.index,Qe=it.isLeader,ve===-1&&!Qe)continue}const Me=(pe=we.passiveAbilities)==null?void 0:pe.includes("STORM"),xt=we.turnPlayed===se.turnCount;if(!Me&&xt&&Qe){const it=ne.map((ft,yt)=>({c:ft,idx:yt})).filter(({c:ft})=>{var yt,St;return ft&&!((yt=ft.passiveAbilities)!=null&&yt.includes("STEALTH"))&&!((St=ft.passiveAbilities)!=null&&St.includes("AURA"))&&!O(ft)});if(it.length>0){const ft=ke?null:it.find(({c:yt})=>{var St;return(St=yt.passiveAbilities)==null?void 0:St.includes("WARD")});ft?ve=ft.idx:ve=it[0].idx,Qe=!1}else continue}const Be=Qe?null:ne[ve],Je=Be?Be.instanceId:void 0,pt=we.instanceId;if(pt&&(Yl(pt),setTimeout(()=>Yl(null),300)),Bt(we.attackEffectType||"SLASH",w,Qe?-1:ve,Je),!Qe&&ve>=0){const it=ne[ve];if(it&&(it.currentAttack||0)>0){const ft=it.instanceId;setTimeout(()=>{ft&&(Kl(ft),setTimeout(()=>Kl(null),300)),Bt(it.attackEffectType||"SLASH",S,Ee,pt)},200)}}Oe=!0,await b(1e3),I({type:"ATTACK",playerId:S,payload:{attackerIndex:Ee,targetIndex:ve,targetIsLeader:Qe}}),await b(1e3);break}Oe||(G=!1)}}if(await b(300),tt.current.winnerId){ls.current=!1;return}I({type:"END_TURN",playerId:S}),ls.current=!1})()}},[g.activePlayerId,g.turnCount,n,g.phase,u,g.winnerId]);const cm=(m,v)=>{if(Rn.current||Ke||Fi.length>0)return;const b=ie.hand[v];m.stopPropagation();const O="touches"in m?m.touches[0].clientX:m.clientX,M="touches"in m?m.touches[0].clientY:m.clientY,H=m.currentTarget.getBoundingClientRect();if(!$r){tf(!0),jr({card:b,owner:"PLAYER",source:"HAND"}),nf.current=!0;return}if(jr({card:b,owner:"PLAYER",source:"HAND"}),g.activePlayerId!==w)return;if(un.current){console.warn("[handleHandMouseDown] Card play in progress, blocking drag start");return}const J=tt.current;if(J.winnerId){console.log("UI: Card play drag blocked - game has ended");return}if(J.pendingEffects&&J.pendingEffects.length>0){console.log("UI: Card play drag blocked - pendingEffects still processing");return}const j={sourceType:"HAND",sourceIndex:v,sourceInstanceId:b.instanceId,startX:H.left+H.width/2,startY:H.top+H.height/2,currentX:O,currentY:M,offsetX:0,offsetY:0,canDrag:!0};Nr(j),Rn.current=j},um=(m,v,b)=>{m.stopPropagation();const O="touches"in m?m.touches[0].clientX:m.clientX,M="touches"in m?m.touches[0].clientY:m.clientY,H=tt.current;if(H.winnerId){console.log("UI: Attack drag blocked - game has ended");return}const J=H.players[w].board,j=b?J.findIndex(W=>W&&W.instanceId===b):v,U=j>=0?J[j]:null;if(rt&&rt.allowedTargetPlayerId===w&&U){ff("FOLLOWER",j,w,b);return}if(U&&jr({card:U,owner:"PLAYER",source:"BOARD"}),H.pendingEffects&&H.pendingEffects.length>0){console.log("UI: Attack drag blocked - pendingEffects still processing");return}if(H.activePlayerId===w&&(U!=null&&U.canAttack)){const W=m.currentTarget.getBoundingClientRect(),ae={x:W.left+W.width/2,y:W.top+W.height/2},q={sourceType:"BOARD",sourceIndex:j,sourceInstanceId:U.instanceId,startX:ae.x,startY:ae.y,currentX:O,currentY:M,offsetX:0,offsetY:0};Nr(q),Rn.current=q}},sc=(m,v=!1)=>{if(g.activePlayerId!==w)return;m.stopPropagation();const b="touches"in m?m.touches[0].clientX:m.clientX,O="touches"in m?m.touches[0].clientY:m.clientY,M=tt.current;if(M.winnerId){console.log("UI: Evolve drag blocked - game has ended");return}if(M.pendingEffects&&M.pendingEffects.length>0){console.log("UI: Evolve drag blocked - pendingEffects still processing");return}const H=w===g.firstPlayerId;if(v){if(!h_(ie,g.turnCount,H))return}else if(!f_(ie,g.turnCount,H))return;const J=m.currentTarget.getBoundingClientRect(),j=J.left+J.width/2,U=J.top+J.height/2,W={sourceType:"EVOLVE",sourceIndex:0,startX:j,startY:U,currentX:b,currentY:O,offsetX:0,offsetY:0,useSep:v};Nr(W),Rn.current=W},dm=D.useCallback(m=>{br.current&&(clearTimeout(br.current),br.current=null);const v={stampId:m,playerId:w,playerClass:xr,timestamp:Date.now()},b=c_(m);b&&mt(b,.6),$i(null),requestAnimationFrame(()=>{$i(v)}),e==="ONLINE"&&x&&x.send({type:"STAMP",stampId:m,playerClass:xr}),br.current=setTimeout(()=>{$i(O=>(O==null?void 0:O.timestamp)===v.timestamp?null:O),br.current=null},3e3)},[w,xr,e,x]),tI=D.useCallback(m=>{if(m.stopPropagation(),m.preventDefault(),ri.current){const v=ri.current.getBoundingClientRect();Dr.current={x:v.left+v.width/2,y:v.top+v.height/2}}else Dr.current={x:m.clientX,y:m.clientY};H0(!0),Bl(null)},[]),fm=N.useRef(null);N.useEffect(()=>{fm.current=Vd},[Vd]),D.useEffect(()=>{if(!Gd)return;const m=b=>{if(!Dr.current)return;const O=b.clientX-Dr.current.x,M=b.clientY-Dr.current.y,H=Math.sqrt(O*O+M*M),J=Math.atan2(M,O)*(180/Math.PI);if(H>=200&&H<=320&&M<0){const ae=180- -J,q=Math.floor(ae/22.5),_e=Math.max(0,Math.min(7,q))+1;Bl(_e)}else Bl(null)},v=()=>{const b=fm.current;b&&dm(b),H0(!1),Bl(null),Dr.current=null};return window.addEventListener("mousemove",m),window.addEventListener("mouseup",v),()=>{window.removeEventListener("mousemove",m),window.removeEventListener("mouseup",v)}},[Gd,dm]),D.useEffect(()=>{const m=(O,M,H=!1)=>{var U,W,ae,q;if(!Rn.current)return;const{canDrag:J,sourceType:j}=Rn.current;if(!(j==="HAND"&&!J)&&(Rn.current={...Rn.current,currentX:O,currentY:M},Nr(he=>he?{...he,currentX:O,currentY:M}:null),H&&(j==="BOARD"||j==="EVOLVE"))){const he=zi.current;if(he){const be=he.getBoundingClientRect();if(O>=be.left&&O<=be.right&&M>=be.top&&M<=be.bottom){Yn({type:"LEADER",index:0,playerId:S});return}}const _e=tt.current,Xe=((U=_e.players[S])==null?void 0:U.board)||[];for(let be=0;be<sr.current.length;be++){const Ve=sr.current[be];if(Ve&&Xe[be]){const Ze=Ve.getBoundingClientRect();if(O>=Ze.left&&O<=Ze.right&&M>=Ze.top&&M<=Ze.bottom){Yn({type:"FOLLOWER",index:be,playerId:S,instanceId:(W=Xe[be])==null?void 0:W.instanceId});return}}}if(j==="EVOLVE"){const be=((ae=_e.players[w])==null?void 0:ae.board)||[];for(let Ve=0;Ve<Sr.current.length;Ve++){const Ze=Sr.current[Ve];if(Ze&&be[Ve]){const He=Ze.getBoundingClientRect();if(O>=He.left&&O<=He.right&&M>=He.top&&M<=He.bottom){Yn({type:"FOLLOWER",index:Ve,playerId:w,instanceId:(q=be[Ve])==null?void 0:q.instanceId});return}}}}Yn(null)}},v=O=>{m(O.clientX,O.clientY)},b=O=>{O.touches.length>0&&(Rn.current&&O.preventDefault(),m(O.touches[0].clientX,O.touches[0].clientY,!0))};return window.addEventListener("mousemove",v),window.addEventListener("touchmove",b,{passive:!1}),()=>{window.removeEventListener("mousemove",v),window.removeEventListener("touchmove",b)}},[]);const hm=N.useRef(null),nI=N.useRef(null);D.useEffect(()=>{hm.current=ct,nI.current=ct},[ct]),D.useEffect(()=>{const m=()=>{var M,H,J,j,U,W,ae,q,he,_e,Xe,be,Ve;const b=Rn.current,O=hm.current;if(tt.current.winnerId){console.log("[handleGlobalMouseUp] Game has ended, cancelling all actions"),Nr(null),Rn.current=null,Yn(null);return}if(b){if(b.sourceType==="HAND"){if(un.current){console.warn("[handleGlobalMouseUp] Card play in progress, cancelling drag"),Rn.current=null,Nr(null);return}const Ze=Math.sqrt(Math.pow(b.startX-b.currentX,2)+Math.pow(b.startY-b.currentY,2)),He=b.currentY<window.innerHeight-200*p;if(b.canDrag&&Ze>30&&He){const We=Ir.current.hand[b.sourceIndex];if(Ir.current.pp>=We.cost){const pe=((H=(M=We.triggerAbilities)==null?void 0:M.FANFARE)==null?void 0:H.targetType)==="SELECT_FOLLOWER"||((J=We.triggers)==null?void 0:J.some(se=>se.trigger==="FANFARE"&&se.effects.some(z=>z.targetType==="SELECT_FOLLOWER"))),G=((U=(j=We.triggerAbilities)==null?void 0:j.FANFARE)==null?void 0:U.targetType)==="SELECT_ALLY_FOLLOWER"||((W=We.triggers)==null?void 0:W.some(se=>se.trigger==="FANFARE"&&se.effects.some(z=>z.targetType==="SELECT_ALLY_FOLLOWER"))),oe=((q=(ae=We.triggerAbilities)==null?void 0:ae.FANFARE)==null?void 0:q.targetType)==="SELECT_OTHER_ALLY_FOLLOWER"||((he=We.triggers)==null?void 0:he.some(se=>se.trigger==="FANFARE"&&se.effects.some(z=>z.targetType==="SELECT_OTHER_ALLY_FOLLOWER")));if(pe||G||oe){const se=G||oe?w:S;tt.current.players[se].board.some(ge=>{var Oe,Ee;return!(!ge||se!==w&&((Oe=ge.passiveAbilities)!=null&&Oe.includes("STEALTH")||(Ee=ge.passiveAbilities)!=null&&Ee.includes("AURA")))})?(un.current=!0,aa.current=We.instanceId||null,ni({type:"PLAY",sourceIndex:b.sourceIndex,sourceInstanceId:We.instanceId,allowedTargetPlayerId:se}),ir.current=!0,setTimeout(()=>{ir.current=!1},100)):(console.log("[handleGlobalMouseUp] No valid targets, skipping target selection"),df(b.sourceIndex,b.startX,b.startY),jr(null),ir.current=!0,setTimeout(()=>{ir.current=!1},100))}else df(b.sourceIndex,b.startX,b.startY),jr(null),ir.current=!0,setTimeout(()=>{ir.current=!1},100);Rn.current=null,Nr(null);return}}else b.canDrag||tf(!0)}else if(b.sourceType==="BOARD"){if(O&&O.playerId===S){const He=tt.current.players[S],We=He.board.filter(z=>{var ne,ge;return z&&((ne=z.passiveAbilities)==null?void 0:ne.includes("WARD"))&&!((ge=z.passiveAbilities)!=null&&ge.includes("STEALTH"))});let pe=!1;const G=z=>z?He.board.findIndex(ne=>ne&&ne.instanceId===z):-1,oe=O.type==="LEADER"?-1:G(O.instanceId),ee=Ir.current.board[b.sourceIndex],se=((_e=ee==null?void 0:ee.passiveAbilities)==null?void 0:_e.includes("STEALTH"))||(ee==null?void 0:ee.hadStealth);if(We.length>0&&!se){if(O.type==="LEADER")pe=!0;else if(O.type==="FOLLOWER"&&oe>=0){const z=He.board[oe];z&&!((Xe=z.passiveAbilities)!=null&&Xe.includes("WARD"))&&(pe=!0)}}if(pe)console.log("UI: Attack blocked by WARD");else{const z=Ir.current.board.findIndex(Qe=>Qe&&Qe.instanceId===b.sourceInstanceId),ne=z>=0?Ir.current.board[z]:null,ge=(be=ne==null?void 0:ne.passiveAbilities)==null?void 0:be.includes("RUSH"),Oe=(Ve=ne==null?void 0:ne.passiveAbilities)==null?void 0:Ve.includes("STORM"),Ee=(ne==null?void 0:ne.turnPlayed)===tt.current.turnCount,we=O.type==="LEADER",ve=oe;if(we&&ge&&!Oe&&Ee)console.log("UI: Attack blocked by RUSH rule (Cannot attack leader)");else{if(z<0||!ne){console.log("UI: Attack blocked - invalid attacker");return}const Qe=tt.current;if(Qe.pendingEffects&&Qe.pendingEffects.length>0){console.log("UI: Attack blocked - pendingEffects still processing");return}const ke=O.instanceId,Ne=b.sourceInstanceId,Me=!we&&ve>=0?He.board[ve]:null;cs({type:"ATTACK",playerId:w,payload:{attackerIndex:z,targetIndex:we?-1:ve,targetIsLeader:we}}),Ne&&(Yl(Ne),setTimeout(()=>Yl(null),300));const Be=(ne==null?void 0:ne.attackEffectType)||"SLASH";if(Bt(Be,S,we?-1:ve,ke),$n(),!we&&Me&&(Me.currentAttack||0)>0){const Je=Me.instanceId;setTimeout(()=>{Je&&(Kl(Je),setTimeout(()=>Kl(null),300)),Bt(Me.attackEffectType||"SLASH",w,z,Ne)},200)}}}}}else if(b.sourceType==="EVOLVE"&&O&&O.type==="FOLLOWER"&&O.playerId===w){const Ze=O.index,We=ta.current[Ze],pe=(We==null?void 0:We.instanceId)||O.instanceId,G=Ir.current.board,oe=pe?G.findIndex(Ne=>Ne&&Ne.instanceId===pe):Ze,ee=oe>=0?G[oe]:null;if(!ee)return;if(ee.hasEvolved){console.log("[GameScreen] Cannot evolve: card already evolved (drag drop)");return}const z=b.useSep?["SUPER_EVOLVE","EVOLVE"]:["EVOLVE"],ge=(()=>{var Me,xt;const Ne=(xt=(Me=ee==null?void 0:ee.triggerAbilities)==null?void 0:Me.EVOLVE)==null?void 0:xt.targetType;if(Ne)return Ne;for(const Be of(ee==null?void 0:ee.triggers)||[])if(z.includes(Be.trigger)){for(const Je of Be.effects)if(Je.targetType&&["SELECT_FOLLOWER","SELECT_ALLY_FOLLOWER","SELECT_OTHER_ALLY_FOLLOWER"].includes(Je.targetType))return Je.targetType}return null})(),Oe=!!ge,Ee=ge==="SELECT_ALLY_FOLLOWER"||ge==="SELECT_OTHER_ALLY_FOLLOWER",we=ge==="SELECT_OTHER_ALLY_FOLLOWER",ve=Ee?w:S,ke=tt.current.players[ve].board.some(Ne=>{var Me,xt;return!(!Ne||Ee&&we&&Ne.instanceId===pe||!Ee&&((Me=Ne.passiveAbilities)!=null&&Me.includes("STEALTH")||(xt=Ne.passiveAbilities)!=null&&xt.includes("AURA")))});Oe&&ke?(ni({type:"EVOLVE",sourceIndex:oe,sourceInstanceId:pe,sourceVisualIndex:Ze,useSep:b.useSep,allowedTargetPlayerId:ve,excludeInstanceId:we?pe:void 0}),ir.current=!0,setTimeout(()=>{ir.current=!1},100)):(rc(Ze,b.useSep,void 0,pe),ir.current=!0,setTimeout(()=>{ir.current=!1},100))}}b&&b.sourceType==="HAND"&&b.canDrag&&(Z0(b.sourceIndex),setTimeout(()=>Z0(null),300)),Nr(null),Rn.current=null,Yn(null)},v=()=>{m()};return window.addEventListener("mouseup",m),window.addEventListener("touchend",v),()=>{window.removeEventListener("mouseup",m),window.removeEventListener("touchend",v)}},[S,w,$r,p]);const rI=()=>{if(!ir.current){if(rt){rt.type==="PLAY"&&(un.current=!1),ni(null);return}if($r){if(nf.current){nf.current=!1;return}tf(!1),jr(null),Se(null)}}},us=()=>{if(!Q||Q.sourceType!=="BOARD"&&Q.sourceType!=="EVOLVE")return"";const m=Q.currentX-Q.startX,v=Q.currentY-Q.startY,b=Math.sqrt(m*m+v*v);if(b<10)return"";const O=(Q.startX+Q.currentX)/2,M=(Q.startY+Q.currentY)/2,H=Math.min(200,b*.3),J=Math.abs(m),j=Math.min(150,J*.4),U=H+j,ae=-(m/(b+1))*U*.5,q=-U*.8,he=O+ae,_e=M+q;return`M${Q.startX},${Q.startY} Q${he},${_e} ${Q.currentX},${Q.currentY}`},ff=(m,v,b,O)=>{var J;if(!rt)return;if(rt.allowedTargetPlayerId&&rt.allowedTargetPlayerId!==b){console.log("Invalid target side");return}if(rt.excludeInstanceId&&O===rt.excludeInstanceId){console.log("Cannot target self (SELECT_OTHER_ALLY_FOLLOWER)"),$n();return}let M,H=v;if(m==="FOLLOWER"){if(O&&(H=g.players[b].board.findIndex(U=>U&&U.instanceId===O),H<0))return;const j=g.players[b].board[H];if(!j)return;if(M=j.instanceId,b!==w){const U=j.passiveAbilities||[];if(U.includes("STEALTH")){console.log("Cannot target unit with STEALTH"),mt("cancel"),$n();return}if(U.includes("AURA")){console.log("Cannot target unit with AURA"),mt("cancel"),$n();return}}}else return;if(rt.type==="PLAY"){const j=Ir.current;let U=rt.sourceIndex,W=j.hand[U];if(rt.sourceInstanceId){const He=j.hand.findIndex(We=>We.instanceId===rt.sourceInstanceId);if(He>=0)U=He,W=j.hand[He],console.log(`[handleTargetClick] Using sourceInstanceId ${rt.sourceInstanceId}, found at index ${He} (was ${rt.sourceIndex})`);else{console.error("[handleTargetClick] Card not found with instanceId:",rt.sourceInstanceId),ni(null);return}}if(!W){console.error("[handleTargetClick] Card not found at index:",U),ni(null),un.current=!1;return}un.current=!0,aa.current=W.instanceId||null,W.id==="c_y"&&(Bt("SUMI","p2",H,M),tt.current.players[S].board.forEach((We,pe)=>{if(We){const G=We.instanceId;setTimeout(()=>{Bt("SUMI",S,pe,G)},300)}})),W.id==="s_resignation_proxy"&&(Bt("SUMI",b,H,M),setTimeout(()=>{const He=tt.current.players[w].board,We=[];if(He.forEach((pe,G)=>{pe&&We.push({index:G,instanceId:pe.instanceId})}),We.length>0){const pe=We[Math.floor(Math.random()*We.length)];Bt("SUMI",w,pe.index,pe.instanceId)}},500)),W.id==="c_azya"&&(Bt("THUNDER",S,-1),setTimeout(()=>{Bt("ICE",b,H,M)},300),setTimeout(()=>{const He=tt.current.players[S].board,We=He.filter(pe=>pe!==null);if(We.length>0){const pe=We[Math.floor(Math.random()*We.length)],G=He.findIndex(oe=>(oe==null?void 0:oe.instanceId)===(pe==null?void 0:pe.instanceId));G!==-1&&Bt("WATER",S,G,pe==null?void 0:pe.instanceId)}},600));const ae=window.innerWidth/2,q=window.innerHeight-200*p/2,he=window.innerWidth/2,_e=window.innerHeight/2,Xe=()=>{W.type==="SPELL"||$n(),cs({type:"PLAY_CARD",playerId:w,payload:{cardIndex:U,targetId:M,instanceId:W.instanceId}}),W.id==="c_amandava"&&tt.current.players[S].board.forEach((pe,G)=>{if(pe){const oe=pe.instanceId;setTimeout(()=>{Bt("SHOT",S,G,oe)},200)}}),Fn(null),setTimeout(()=>{un.current=!1},100)};let be,Ve;if(W.type==="FOLLOWER"){const We=tt.current.players[w].board.filter(ne=>ne!==null),pe=We.length+1,G=We.length,oe=ii*p,ee=(G-(pe-1)/2)*oe,se=(J=Bi.current)==null?void 0:J.getBoundingClientRect();be=(se?se.left+se.width/2:window.innerWidth/2)+ee,Ve=window.innerHeight/2+70*p}const Ze=W.type==="FOLLOWER"?tt.current.players[w].board.filter(He=>He!==null).length:void 0;n!=="CPU"&&E&&x&&x.send({type:"PLAY_CARD_ANIM",payload:{playerId:w,cardIndex:U,card:W,targetBoardIndex:Ze}}),Fn({card:W,sourceIndex:rt.sourceIndex??-1,startX:ae,startY:q,targetX:he,targetY:_e,finalX:be,finalY:Ve,playerClass:(ie==null?void 0:ie.class)||"SENKA",onComplete:Xe}),setTimeout(()=>{Fn(He=>(He==null?void 0:He.card.id)===W.id?(Xe(),null):He)},2e3)}else if(rt.type==="EVOLVE"){const j=rt.sourceVisualIndex??rt.sourceIndex;rc(j,!!rt.useSep,M,rt.sourceInstanceId)}ni(null)},pm=()=>{if(!Ue||Ue.owner!=="PLAYER")return;if(un.current){console.warn("[handleUseButtonClick] Card play in progress, ignoring");return}const m=ie.hand.findIndex(O=>O.id===Ue.card.id);if(m===-1)return;const v=window.innerWidth/2,b=window.innerHeight-200*p/2;df(m,v,b),jr(null)},[Vi,hf]=N.useState(!1),[ic,pf]=N.useState(!1),[Gt,gf]=N.useState(null),sI=N.useRef(0);N.useEffect(()=>{if(!(Gt!=null&&Gt.active))return;const m=Date.now(),v=800,b=()=>{const O=Date.now()-m;if(O>=v){gf(null);return}const M=O/v;gf(H=>H?{...H,ringRadius:20+M*100,particles:H.particles.map(J=>({...J,x:J.x+J.vx,y:J.y+J.vy,opacity:1-M}))}:null),requestAnimationFrame(b)};requestAnimationFrame(b)},[Gt==null?void 0:Gt.active]);const gm=(m,v)=>{const b=[];for(let O=0;O<20;O++){const M=Math.random()*Math.PI*2,H=2+Math.random()*3;b.push({id:sI.current++,x:m,y:v,vx:Math.cos(M)*H,vy:Math.sin(M)*H,opacity:1,createdAt:Date.now()})}gf({active:!0,x:m,y:v,ringRadius:20,particles:b})},mf=async()=>{if(g.winnerId){console.log("[handleEndTurn] Game is over, ignoring");return}if(g.activePlayerId!==w){console.log("[handleEndTurn] Not my turn, ignoring");return}if(Wi.current){console.log("[handleEndTurn] Already ending turn, ignoring");return}Wi.current=!0,hf(!0);const m=tt.current.turnCount,v=tt.current.activePlayerId;if(!await(async()=>{const M=()=>{const W=tt.current,ae=W.pendingEffects&&W.pendingEffects.length>0,q=lf.current.length>0,he=cf.current.length>0,_e=la.current!==null,Xe=Gi.current!==null,be=Mr.current,Ve=un.current;return!ae&&!q&&!he&&!_e&&!Xe&&!be&&!Ve};let j=0,U=0;for(;j<3e3;){if(tt.current.turnCount!==m||tt.current.activePlayerId!==v)return console.log("[handleEndTurn] Turn changed during wait, aborting local END_TURN"),!1;if(M()){if(U++,U>=2)break}else U=0;await new Promise(W=>setTimeout(W,50)),j+=50}return j>=3e3&&console.warn("[handleEndTurn] Timeout waiting for processing to complete - forcing end turn"),!0})()||tt.current.turnCount!==m||tt.current.activePlayerId!==v||tt.current.activePlayerId!==w){console.log("[handleEndTurn] Turn state changed, aborting END_TURN dispatch"),Wi.current=!1,hf(!1);return}console.log("[handleEndTurn] Dispatching END_TURN"),cs({type:"END_TURN",playerId:w}),Wi.current=!1,hf(!1)},iI=D.useCallback(()=>{mt("sisiodosi.mp3",.6);const m=K0.current;if(m){const v=m.getBoundingClientRect();gm(v.left+v.width/2,v.top+v.height/2)}mf()},[mt,mf]),mm=2-((ie==null?void 0:ie.evolutionsUsed)||0),yf=w===g.firstPlayerId,ym=(m,v)=>v?Math.ceil(g.turnCount/2):Math.floor(g.turnCount/2),vm=ym(w,yf),oI=yf?3:2,aI=yf?4:3,oc=vm>=oI,ac=vm>=aI,ds=(ie==null?void 0:ie.canEvolveThisTurn)&&mm>0&&g.activePlayerId===w&&oc,fs=(ie==null?void 0:ie.canEvolveThisTurn)&&ie.sep>0&&g.activePlayerId===w&&ac,vf=S===g.firstPlayerId,_m=ym(S,vf),lI=vf?3:2,cI=vf?4:3,_f=_m>=lI,xf=_m>=cI,bf=((Cm=ie==null?void 0:ie.board)==null?void 0:Cm.some(m=>{var v;return(v=m==null?void 0:m.passiveAbilities)==null?void 0:v.includes("LEADER_DAMAGE_CAP")}))??!1,Ef=((wm=De==null?void 0:De.board)==null?void 0:wm.some(m=>{var v;return(v=m==null?void 0:m.passiveAbilities)==null?void 0:v.includes("LEADER_DAMAGE_CAP")}))??!1,uI=(ie==null?void 0:ie.leaderDamageShield)??!1,dI=(De==null?void 0:De.leaderDamageShield)??!1,xm=bf||uI,bm=Ef||dI;return D.useLayoutEffect(()=>{window.scrollTo(0,0),Bi.current&&(Bi.current.scrollTop=0);const m=()=>{window.scrollTo(0,0)};return window.addEventListener("scroll",m,{passive:!1}),()=>{window.removeEventListener("scroll",m)}},[]),n==="JOIN"&&!P||X&&y&&!P?a.jsxs("div",{style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",gap:"1rem"},children:[a.jsx("div",{style:{width:"50px",height:"50px",border:"4px solid rgba(233, 69, 96, 0.3)",borderTop:"4px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),a.jsx("p",{children:"..."}),a.jsx("button",{onClick:s,style:{marginTop:"1rem",padding:"0.5rem 1rem",background:"transparent",border:"1px solid #888",color:"#888",cursor:"pointer",borderRadius:"4px"},children:""}),a.jsx("style",{children:`
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                `})]}):X&&Ge&&P?a.jsxs("div",{style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",gap:"1rem"},children:[a.jsx("div",{style:{fontSize:"2rem",fontWeight:"bold",color:"#4ade80",textShadow:"0 0 10px rgba(74, 222, 128, 0.5)",marginBottom:"0.5rem"},children:""}),a.jsx("div",{style:{width:"50px",height:"50px",border:"4px solid rgba(74, 222, 128, 0.3)",borderTop:"4px solid #4ade80",borderRadius:"50%",animation:"spin 1s linear infinite"}}),a.jsx("p",{style:{color:"#a0aec0"},children:"..."}),a.jsx("style",{children:`
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                `})]}):a.jsxs("div",{className:"game-screen-wrapper",style:{width:"100vw",height:"100dvh",overflow:"hidden",background:"#000",position:"relative"},children:[F&&a.jsx(KO,{myPlayer:ie,opponentPlayer:De,isFirstPlayer:os,onComplete:ZS,scale:p,onVsImpact:()=>mt("vs.mp3",.7),onCoinToss:()=>mt("coin.mp3",.7),onImpact:()=>mt("gan.mp3",.7),onOrbLand:()=>mt("gan.mp3",.8),onFadeInBoard:()=>Re(!0),isMobile:Y}),a.jsxs("div",{className:"game-screen",style:{width:"100%",height:"100%",transform:Et>0?`translate(${qe.x}px, ${qe.y}px)`:"none",display:"flex",overflow:"hidden",background:"radial-gradient(circle at center, #1a202c 0%, #000 100%)",fontFamily:"'Helvetica Neue', sans-serif",userSelect:"none",color:"#fff",position:"absolute",top:0,left:0,opacity:F&&!Ae?0:1,transition:"opacity 0.5s ease-in"},onClick:rI,children:[a.jsx("style",{children:`
                    html, body {
                        margin: 0; padding: 0; height: 100%; background: #000;
                        overflow: hidden !important;
                        position: fixed !important;
                        width: 100% !important;
                        top: 0 !important;
                        left: 0 !important;
                    }
                    * { box-sizing: border-box; }
                    .shake-target { animation: shake 0.3s cubic-bezier(.36,.07,.19,.97) both; }
                    @keyframes shake {
                        10%, 90% { transform: translate3d(-1px, 0, 0); }
                        20%, 80% { transform: translate3d(2px, 0, 0); }
                        30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
                        40%, 60% { transform: translate3d(4px, 0, 0); }
                    }
                    @keyframes attackRotate {
                        0% { transform: rotateY(0deg); }
                        100% { transform: rotateY(360deg); }
                    }
                    .attack-rotating {
                        animation: attackRotate 0.2s linear forwards !important;
                        transform-style: preserve-3d;
                    }
                    @keyframes cardDie {
                        0% { transform: scale(1); filter: brightness(1) drop-shadow(0 0 0 white); opacity: 1; }
                        40% { transform: scale(1.15); filter: brightness(3) drop-shadow(0 0 20px white); opacity: 0.9; }
                        100% { transform: scale(0.4) rotate(8deg); filter: brightness(5) drop-shadow(0 0 40px white); opacity: 0; }
                    }
                    .card-dying { animation: cardDie 0.7s forwards; }
                    /* Necromance effect animations */
                    @keyframes necromanceFloat {
                        0% { transform: translateX(-50%) translateY(0) scale(1); opacity: 1; }
                        50% { transform: translateX(-50%) translateY(-20px) scale(1.2); opacity: 1; }
                        100% { transform: translateX(-50%) translateY(-40px) scale(0.8); opacity: 0; }
                    }
                    @keyframes necromanceFloatOpponent {
                        0% { transform: translateX(-50%) translateY(0) scale(1); opacity: 1; }
                        50% { transform: translateX(-50%) translateY(15px) scale(1.2); opacity: 1; }
                        100% { transform: translateX(-50%) translateY(30px) scale(0.8); opacity: 0; }
                    }
                    @keyframes necroPulse {
                        0%, 100% { box-shadow: 0 0 10px #d946ef, 0 0 20px #a855f7, inset 0 0 15px rgba(217, 70, 239, 0.3); }
                        50% { box-shadow: 0 0 25px #d946ef, 0 0 40px #a855f7, 0 0 60px #7c3aed, inset 0 0 25px rgba(217, 70, 239, 0.5); }
                    }
                    @keyframes leaderDamageCapPulse {
                        0%, 100% {
                            box-shadow: 0 0 20px rgba(103, 232, 249, 0.4), 0 0 40px rgba(103, 232, 249, 0.2);
                            border-color: #67e8f9;
                        }
                        50% {
                            box-shadow: 0 0 35px rgba(103, 232, 249, 0.7), 0 0 55px rgba(103, 232, 249, 0.4);
                            border-color: #a5f3fc;
                        }
                    }
                    @keyframes leaderDamageCapOverlay {
                        0%, 100% { opacity: 0.15; }
                        50% { opacity: 0.45; }
                    }
                    /* EP/SEP pulse animations for usable state - box-shadow only, no transform override */
                    @keyframes epPulse {
                        0%, 100% {
                            box-shadow: 0 0 12px #ffd700, 0 0 25px rgba(255,215,0,0.6);
                        }
                        50% {
                            box-shadow: 0 0 20px #ffd700, 0 0 40px rgba(255,215,0,0.8), 0 0 55px rgba(255,180,0,0.5);
                        }
                    }
                    @keyframes sepPulse {
                        0%, 100% {
                            box-shadow: 0 0 12px #b794f4, 0 0 25px rgba(159,122,234,0.6);
                        }
                        50% {
                            box-shadow: 0 0 20px #b794f4, 0 0 40px rgba(159,122,234,0.8), 0 0 55px rgba(180,0,255,0.5);
                        }
                    }
                `}),rt&&a.jsx("div",{style:{position:"absolute",top:"15%",left:"50%",transform:"translate(-50%, -50%)",background:"rgba(0, 0, 0, 0.7)",color:"#fff",padding:"10px 20px",borderRadius:20,pointerEvents:"none",zIndex:1e3,fontWeight:"bold",border:rt.allowedTargetPlayerId===w?"2px solid #48bb78":"2px solid #f56565"},children:rt.allowedTargetPlayerId===w?"":""}),XS&&a.jsx(fL,{onClose:()=>ef(!1)}),KS&&a.jsx("div",{style:{position:"absolute",inset:0,zIndex:4e3,background:"rgba(0,0,0,0.8)",backdropFilter:"blur(5px)",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>Jl(!1),children:a.jsxs("div",{style:{background:"#2d3748",padding:40,borderRadius:16,display:"flex",flexDirection:"column",gap:20,minWidth:300,border:"1px solid rgba(255,255,255,0.1)"},onClick:m=>m.stopPropagation(),children:[a.jsx("h2",{style:{margin:0,textAlign:"center",borderBottom:"1px solid #4a5568",paddingBottom:10,color:"#fff"},children:""}),YS?a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:15},children:[a.jsx("h3",{style:{margin:0,color:"#cbd5e0"},children:""}),a.jsxs("label",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",color:"white"},children:["BGM",a.jsx("input",{type:"checkbox",checked:Tt.bgmEnabled,onChange:m=>ia(v=>({...v,bgmEnabled:m.target.checked})),style:{width:20,height:20}})]}),a.jsxs("label",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",color:"white"},children:["SE",a.jsx("input",{type:"checkbox",checked:Tt.seEnabled,onChange:m=>ia(v=>({...v,seEnabled:m.target.checked})),style:{width:20,height:20}})]}),a.jsxs("div",{children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",color:"#a0aec0",marginBottom:5},children:[a.jsx("span",{children:"BGM"}),a.jsxs("span",{children:[Math.round(Tt.bgm*100),"%"]})]}),a.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:Tt.bgm,onChange:m=>ia(v=>({...v,bgm:parseFloat(m.target.value)})),style:{width:"100%"}})]}),a.jsxs("div",{children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",color:"#a0aec0",marginBottom:5},children:[a.jsx("span",{children:"SE"}),a.jsxs("span",{children:[Math.round(Tt.se*100),"%"]})]}),a.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:Tt.se,onChange:m=>ia(v=>({...v,se:parseFloat(m.target.value)})),style:{width:"100%"}})]}),a.jsxs("div",{children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",color:"#a0aec0",marginBottom:5},children:[a.jsx("span",{children:""}),a.jsxs("span",{children:[Math.round(Tt.voice*100),"%"]})]}),a.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:Tt.voice,onChange:m=>ia(v=>({...v,voice:parseFloat(m.target.value)})),style:{width:"100%"}})]}),a.jsx("button",{onClick:()=>rm(!1),style:{padding:10,background:"#4a5568",border:"none",color:"white",borderRadius:8,cursor:"pointer",marginTop:10},children:""})]}):a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:()=>Jl(!1),style:{padding:15,background:"#4a5568",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.2rem"},children:""}),a.jsx("button",{onClick:()=>rm(!0),style:{padding:15,background:"#2b6cb0",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.2rem"},children:""}),a.jsx("button",{onClick:()=>ql(!0),style:{padding:15,background:"#e53e3e",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.2rem"},children:""})]})]})}),QS&&a.jsx("div",{style:{position:"absolute",inset:0,zIndex:4100,background:"rgba(0,0,0,0.85)",backdropFilter:"blur(5px)",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>ql(!1),children:a.jsxs("div",{style:{background:"#2d3748",padding:40,borderRadius:16,display:"flex",flexDirection:"column",gap:20,minWidth:320,border:"2px solid #e53e3e",boxShadow:"0 0 30px rgba(229, 62, 62, 0.3)"},onClick:m=>m.stopPropagation(),children:[a.jsx("h2",{style:{margin:0,textAlign:"center",color:"#fff",fontSize:"1.5rem"},children:""}),a.jsx("p",{style:{margin:0,textAlign:"center",color:"#a0aec0",fontSize:"1rem"},children:""}),a.jsxs("div",{style:{display:"flex",gap:15,marginTop:10},children:[a.jsx("button",{onClick:()=>ql(!1),style:{flex:1,padding:15,background:"#4a5568",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.1rem"},children:""}),a.jsx("button",{onClick:JS,style:{flex:1,padding:15,background:"#e53e3e",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.1rem"},children:""})]})]})}),a.jsxs("div",{className:sm?"shake-target":"",style:{width:(Y?280:340)*p,borderRight:"1px solid rgba(255,255,255,0.1)",background:"rgba(0,0,0,0.3)",padding:Y?`${10*p}px ${12*p}px`:`${20*p}px ${20*p}px ${20*p}px`,display:"flex",flexDirection:"column",zIndex:20,flexShrink:0},onClick:m=>m.stopPropagation(),children:[a.jsx("div",{style:{marginBottom:(Y?6:12)*p},children:a.jsxs("button",{onClick:()=>Jl(!0),style:{background:"transparent",border:"none",cursor:"pointer",padding:Y?3:5},children:[a.jsx("div",{style:{width:(Y?22:30)*p,height:(Y?2:3)*p,background:"#cbd5e0",marginBottom:(Y?4:6)*p}}),a.jsx("div",{style:{width:(Y?22:30)*p,height:(Y?2:3)*p,background:"#cbd5e0",marginBottom:(Y?4:6)*p}}),a.jsx("div",{style:{width:(Y?22:30)*p,height:(Y?2:3)*p,background:"#cbd5e0"}})]})}),a.jsx("h3",{style:{color:"#a0aec0",borderBottom:"1px solid #4a5568",paddingBottom:(Y?4:8)*p,marginTop:0,marginBottom:0,flexShrink:0,fontSize:Y?`${.85*p}rem`:void 0},children:""}),Ue?a.jsx("div",{style:{marginTop:(Y?4:10)*p,display:"flex",flexDirection:"column",flex:1,overflow:"hidden",minHeight:0},children:a.jsxs("div",{style:{flex:1,overflow:"auto",minHeight:0,display:"flex",flexDirection:"column"},children:[a.jsxs("div",{style:{flexShrink:0},children:[a.jsx("div",{style:{width:"100%",aspectRatio:"1/1",marginBottom:(Y?6:12)*p,display:"flex",alignItems:"center",justifyContent:"center",...Y?{maxHeight:"28vh"}:{}},children:a.jsx(Xi,{card:Ue.card,style:{width:"100%",height:"100%",...Y?{maxHeight:"28vh"}:{}},variant:"art-only"})}),a.jsx("div",{style:{fontSize:Y?`${(Ue.card.name.length>12?.9:Ue.card.name.length>8?1:1.1)*p}rem`:`${Ue.card.name.length>12?1.1:Ue.card.name.length>8?1.2:1.4}rem`,fontWeight:"bold",marginBottom:(Y?4:6)*p,textAlign:"center"},children:Ue.card.name}),a.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:(Y?10:15)*p,marginBottom:(Y?6:10)*p},children:[a.jsx("div",{style:{width:24*p,height:24*p,borderRadius:"50%",background:"radial-gradient(circle at 30% 30%, #68d391, #276749)",border:"1px solid #fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${.85*p}rem`,fontWeight:900,color:"white",textShadow:"0 1px 2px rgba(0,0,0,0.5)",boxShadow:"0 2px 4px rgba(0,0,0,0.3)"},children:Ue.card.cost}),Ue.card.type==="FOLLOWER"&&a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:3*p},children:[a.jsx("svg",{width:18*p,height:18*p,viewBox:"0 0 24 24",fill:"none",children:a.jsx("polygon",{points:"12,2 22,22 2,22",fill:"#63b3ed",stroke:"none"})}),a.jsx("span",{style:{fontSize:`${.95*p}rem`,fontWeight:"bold",color:"#4299e1"},children:"currentAttack"in Ue.card?Ue.card.currentAttack:Ue.card.attack})]}),Ue.card.type==="FOLLOWER"&&a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:3*p},children:[a.jsx("svg",{width:18*p,height:18*p,viewBox:"0 0 24 24",fill:"#f56565",children:a.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})}),a.jsx("span",{style:{fontSize:`${.95*p}rem`,fontWeight:"bold",color:"#f56565"},children:"currentHealth"in Ue.card?Ue.card.currentHealth:Ue.card.health})]})]}),a.jsx("div",{style:{fontSize:`${((((km=Ue.card.description)==null?void 0:km.length)||0)>150?.7:(((Am=Ue.card.description)==null?void 0:Am.length)||0)>100?.8:.9)*p}rem`,color:"#cbd5e0",lineHeight:"1.4",whiteSpace:"pre-wrap",borderTop:"1px solid #4a5568",paddingTop:4*p},children:VS(Ue.card.description)})]}),Ue.card.flavorText&&a.jsx("div",{style:{marginTop:"auto",paddingTop:8*p,paddingBottom:4*p,flexShrink:0},children:a.jsx("div",{style:{fontSize:`${((((Rm=Ue.card.flavorText)==null?void 0:Rm.length)||0)>100?.6:.7)*p}rem`,color:"rgba(160, 174, 192, 0.6)",lineHeight:"1.3",fontStyle:"italic",whiteSpace:"pre-wrap",textAlign:"right"},children:Ue.card.flavorText})})]})}):a.jsx("div",{style:{marginTop:10*p,color:"#718096",fontStyle:"italic",flex:1,fontSize:`${.7*p}rem`},children:""})]}),a.jsxs("div",{ref:Bi,className:sm?"shake-target":"",style:{flex:1,height:"100%",position:"relative",background:"rgba(0,0,0,0.1)",overflow:"hidden"},children:[a.jsxs("div",{ref:zi,onMouseEnter:()=>Yn({type:"LEADER",playerId:S}),onMouseLeave:()=>Yn(null),onClick:m=>{m.stopPropagation(),rt&&ff("LEADER",-1,S)},style:{position:"absolute",top:-20*p,left:"50%",transform:"translateX(-50%)",width:Qi*p,height:Qi*p,borderRadius:"50%",zIndex:100,cursor:"default"},children:[a.jsx("div",{style:{position:"absolute",inset:0,borderRadius:"50%",background:De.class==="AJA"?`url(${Va(De.class)}) center top/cover`:`url(${Va(De.class)}) center/cover`,border:Ef?"4px solid #67e8f9":(ct==null?void 0:ct.type)==="LEADER"&&ct.playerId===S&&!rt?"4px solid #f56565":"4px solid #4a5568",boxShadow:Ef?"0 0 20px rgba(103, 232, 249, 0.4), 0 0 40px rgba(103, 232, 249, 0.2)":"0 0 20px rgba(0,0,0,0.5)",transition:"border-color 0.3s, box-shadow 0.3s, filter 0.5s, opacity 0.5s",animation:bm?"leaderDamageCapPulse 2s ease-in-out infinite":"none",...g.winnerId===w&&(je||Pe)?{filter:je==="white-fade"?"brightness(2) saturate(0.3)":je==="explode"||je==="result-text"||je==="fade-out"||Pe?"brightness(3) saturate(0) blur(10px)":"none",opacity:je==="explode"||je==="result-text"||je==="fade-out"||Pe?0:1}:{}},children:bm&&a.jsx("div",{style:{position:"absolute",inset:0,borderRadius:"50%",background:"radial-gradient(circle, rgba(103, 232, 249, 0.5) 0%, rgba(103, 232, 249, 0.2) 70%, rgba(103, 232, 249, 0.1) 100%)",pointerEvents:"none",animation:"leaderDamageCapOverlay 2s ease-in-out infinite",zIndex:1}})}),a.jsx("div",{style:{position:"absolute",bottom:0,left:"50%",transform:`translateX(-50%) translateX(${-140*p}px)`,width:55*p,height:55*p,background:"radial-gradient(circle at 30% 30%, #feb2b2, #c53030)",borderRadius:"50%",border:`${Math.max(2,3*p)}px solid #fff`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${1.2*p}rem`,fontWeight:900,color:"white",textShadow:"0 2px 2px rgba(0,0,0,0.5)",zIndex:10,boxShadow:"0 4px 6px rgba(0,0,0,0.4)",opacity:Z?1:0,transition:"opacity 0.3s ease-in"},children:De.hp}),a.jsx("div",{style:{position:"absolute",bottom:10*p,left:"50%",transform:`translateX(-50%) translateX(${-80*p}px)`,width:45*p,height:45*p,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,opacity:Z?_f?1:.5:0,filter:_f?"none":"grayscale(0.8)",transition:"opacity 0.3s ease-in"},children:a.jsx("div",{style:{display:"flex",gap:3*p},children:Array(2).fill(0).map((m,v)=>{const b=v<2-De.evolutionsUsed;return a.jsx("div",{style:{width:12*p,height:12*p,borderRadius:"50%",background:b?"#ecc94b":"#2d3748",boxShadow:b&&_f?"0 0 8px #ecc94b, 0 0 15px #ecc94b":"none",border:"2px solid rgba(0,0,0,0.5)"}},v)})})}),a.jsx("div",{style:{position:"absolute",bottom:10*p,left:"50%",transform:`translateX(-50%) translateX(${80*p}px)`,width:45*p,height:45*p,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,opacity:Z?xf?1:.5:0,filter:xf?"none":"grayscale(0.8)",transition:"opacity 0.3s ease-in"},children:a.jsx("div",{style:{display:"flex",gap:3*p},children:Array(2).fill(0).map((m,v)=>{const b=v<De.sep;return a.jsx("div",{style:{width:12*p,height:12*p,borderRadius:"50%",background:b?"#9f7aea":"#2d3748",boxShadow:b&&xf?"0 0 8px #9f7aea, 0 0 15px #9f7aea":"none",border:"2px solid rgba(0,0,0,0.5)"}},v)})})}),a.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:Qi*p*.75,height:Qi*p*.75,pointerEvents:"none",zIndex:20,opacity:(ct==null?void 0:ct.type)==="LEADER"&&ct.playerId===S&&Q?1:0,transition:"opacity 0.1s ease-out"},children:[a.jsxs("svg",{width:"100%",height:"100%",viewBox:"0 0 100 100",children:[a.jsx("defs",{children:a.jsxs("filter",{id:"leaderCyanMarkerGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"4",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsxs("g",{style:{transformOrigin:"50% 50%",animation:"leaderMarkerSpin 2s linear infinite"},children:[a.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"rgba(100, 200, 255, 0.9)",strokeWidth:"3",strokeDasharray:"15 8",filter:"url(#leaderCyanMarkerGlow)"}),a.jsx("polygon",{points:"50,5 44,18 56,18",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"}),a.jsx("polygon",{points:"95,50 82,44 82,56",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"}),a.jsx("polygon",{points:"50,95 56,82 44,82",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"}),a.jsx("polygon",{points:"5,50 18,56 18,44",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"})]})]}),a.jsx("style",{children:`
                                @keyframes leaderMarkerSpin {
                                    0% { transform: rotate(0deg); }
                                    100% { transform: rotate(360deg); }
                                }
                            `})]})]}),a.jsxs("div",{style:{position:"absolute",top:20*p,left:20*p,width:60*p,height:85*p,zIndex:50},children:[[...Array(Math.min(5,Math.ceil(De.deck.length/5)))].map((m,v)=>a.jsx("div",{style:{position:"absolute",inset:0,transform:`translate(${v*2*p}px, ${-v*2*p}px)`,borderRadius:6,border:"1px solid #718096",overflow:"hidden"},children:a.jsx("img",{src:si((De==null?void 0:De.class)||"SENKA"),alt:"Deck",style:{width:"100%",height:"100%",objectFit:"cover"},onError:b=>{b.target.style.display="none",b.target.parentElement.style.background="linear-gradient(45deg, #2d3748, #1a202c)"}})},v)),a.jsx("div",{style:{position:"absolute",bottom:-20*p,width:"100%",textAlign:"center",fontWeight:"bold",color:"#a0aec0",fontSize:"0.9rem"},children:De.deck.length})]}),a.jsxs("div",{style:{position:"absolute",top:20*p,right:20*p,display:"flex",alignItems:"center",gap:8,zIndex:50,pointerEvents:"none"},children:[a.jsxs("div",{style:{position:"relative",width:24,height:30},children:[a.jsx("div",{style:{position:"absolute",inset:0,background:"#4a192c",borderRadius:2,border:"1px solid #742a3a",transform:"rotate(-15deg) translate(-3px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#3d1525",borderRadius:2,border:"1px solid #742a3a",transform:"rotate(-5deg) translate(-1px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#2d1a20",borderRadius:2,border:"1px solid #8b3a4a",transform:"rotate(5deg)"}})]}),a.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(74, 25, 44, 0.8), rgba(45, 26, 32, 0.9))",padding:"3px 8px",borderRadius:5,color:"#f0b8c4",fontSize:"0.64rem",fontWeight:"bold",border:"1px solid rgba(116, 42, 58, 0.5)",boxShadow:"0 2px 4px rgba(0,0,0,0.4)"},children:[" ",De.hand.length]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5,marginLeft:6},children:[a.jsx("div",{style:{fontSize:"0.9rem",filter:"drop-shadow(0 0 2px rgba(128, 90, 213, 0.6)) grayscale(30%)"},children:""}),a.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(128, 90, 213, 0.7), rgba(76, 29, 149, 0.8))",padding:"3px 8px",borderRadius:5,color:"#c4b5fd",fontSize:"0.64rem",fontWeight:"bold",border:"1px solid rgba(167, 139, 250, 0.4)",boxShadow:"0 2px 4px rgba(0,0,0,0.4)",position:"relative"},children:[" ",De.graveyard.length,Wd.filter(m=>m.playerId===S).map(m=>a.jsxs("div",{style:{position:"absolute",bottom:-25,left:"50%",transform:"translateX(-50%)",color:"#d946ef",fontSize:"1.2rem",fontWeight:"bold",textShadow:"0 0 8px #d946ef, 0 0 15px #a855f7, 0 0 25px #7c3aed",animation:"necromanceFloatOpponent 1.5s ease-out forwards",pointerEvents:"none",whiteSpace:"nowrap"},children:["-",m.amount]},m.key))]})]})]}),a.jsx("div",{style:{position:"absolute",top:`calc(50% - ${bn*p/2}px - ${70*p}px)`,left:"0",width:"100%",height:bn*p,pointerEvents:"none",zIndex:10},children:a.jsx("div",{style:{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center"},children:cn.map((m,v)=>{const b=cn.length,O=(v-(b-1)/2)*ii*p;return a.jsxs("div",{ref:M=>sr.current[v]=M,onMouseEnter:()=>{Q&&Yn({type:"FOLLOWER",index:v,playerId:S,instanceId:m==null?void 0:m.instanceId})},onMouseLeave:()=>{Q&&Yn(null)},onClick:M=>{if(M.stopPropagation(),rt){if(!m)return;ff("FOLLOWER",v,S,m==null?void 0:m.instanceId)}else m&&jr({card:m,owner:"OPPONENT",source:"BOARD"})},style:{position:"absolute",left:"50%",top:0,transform:`translateX(calc(-50% + ${O}px))`,transition:"transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1), left 0.4s ease",border:rt&&m&&rt.allowedTargetPlayerId===S?"2px solid #f56565":"none",boxShadow:rt&&m&&rt.allowedTargetPlayerId===S?"0 0 15px #f56565":"none",borderRadius:8,cursor:rt?"crosshair":"default",width:rn*p,height:bn*p,pointerEvents:"auto",opacity:Rt&&Rt.sourcePlayerId===S&&Rt.followerIndex===v?0:m!=null&&m.isDying?.8:1,transitionProperty:Rt&&Rt.sourcePlayerId===S&&Rt.followerIndex===v?"none":"transform, left, opacity"},children:[a.jsx("div",{style:{width:"100%",height:"100%",perspective:"800px"},children:a.jsxs("div",{className:J0===(m==null?void 0:m.instanceId)||q0===(m==null?void 0:m.instanceId)?"attack-rotating":"",style:{width:"100%",height:"100%",position:"relative",transformStyle:"preserve-3d"},children:[a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},children:m?a.jsx(Xi,{card:m,turnCount:g.turnCount,className:m.isDying?"card-dying":"",scale:p,style:{width:rn*p,height:bn*p,opacity:1,filter:m.isDying?"grayscale(0.5) brightness(2)":"none",boxShadow:(ct==null?void 0:ct.type)==="FOLLOWER"&&ct.index===v&&(Q==null?void 0:Q.sourceType)==="BOARD"?"0 0 20px #f56565":(Q==null?void 0:Q.sourceType)==="BOARD"?"0 0 20px #f6e05e":void 0},isOnBoard:!0,isSpecialSummoning:Q0.has(m.instanceId)}):a.jsx("div",{style:{width:rn*p,height:bn*p,border:"1px dashed rgba(255,255,255,0.1)",borderRadius:8}})}),m&&a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",transform:"rotateY(180deg)",borderRadius:12,overflow:"hidden"},children:a.jsx("img",{src:si((De==null?void 0:De.class)||"SENKA"),alt:"Card Sleeve",style:{width:"100%",height:"100%",objectFit:"cover"}})})]})}),m&&(Q==null?void 0:Q.sourceType)==="BOARD"&&a.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",width:"100%",height:"100%",transform:"translate(-50%, -50%)",pointerEvents:"none",zIndex:20,opacity:(ct==null?void 0:ct.type)==="FOLLOWER"&&ct.index===v&&ct.playerId===S?1:0,transition:"opacity 0.1s ease-out"},children:[a.jsxs("svg",{viewBox:"0 0 100 100",style:{width:"100%",height:"100%",filter:"drop-shadow(0 0 12px rgba(100, 200, 255, 0.9))"},children:[a.jsx("defs",{children:a.jsxs("filter",{id:"cyanMarkerGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"4",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsxs("g",{style:{transformOrigin:"50px 50px",animation:"attackMarkerSpin 1.5s linear infinite reverse"},children:[a.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:"rgba(100, 200, 255, 0.95)",strokeWidth:"4",strokeDasharray:"12 6",filter:"url(#cyanMarkerGlow)"}),a.jsx("polygon",{points:"50,10 45,20 55,20",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"}),a.jsx("polygon",{points:"90,50 80,45 80,55",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"}),a.jsx("polygon",{points:"50,90 55,80 45,80",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"}),a.jsx("polygon",{points:"10,50 20,55 20,45",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"})]})]}),a.jsx("style",{children:`
                                                    @keyframes attackMarkerSpin {
                                                        0% { transform: rotate(0deg); }
                                                        100% { transform: rotate(360deg); }
                                                    }
                                                `})]})]},(m==null?void 0:m.instanceId)||`empty-opp-${v}`)})})}),a.jsx("div",{style:{position:"absolute",bottom:`calc(50% - ${bn*p/2}px - ${70*p}px)`,left:"0",width:"100%",height:bn*p,pointerEvents:"none",zIndex:10},children:a.jsx("div",{style:{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center"},children:_n.map((m,v)=>{const b=_n.length,O=(v-(b-1)/2)*ii*p;return a.jsxs("div",{ref:M=>Sr.current[v]=M,onMouseDown:M=>um(M,v,m==null?void 0:m.instanceId),onTouchStart:M=>um(M,v,m==null?void 0:m.instanceId),onClick:M=>M.stopPropagation(),onMouseEnter:()=>{Q&&Yn({type:"FOLLOWER",index:v,playerId:w,instanceId:m==null?void 0:m.instanceId})},onMouseLeave:()=>{Q&&Yn(null)},style:{position:"absolute",left:"50%",top:0,"--offsetX":`calc(-50% + ${O}px)`,transform:`translateX(calc(-50% + ${O}px)) ${(Q==null?void 0:Q.sourceType)==="BOARD"&&Q.sourceInstanceId===(m==null?void 0:m.instanceId)?"translateY(-20px) scale(1.1)":""}`,transition:"transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1), left 0.4s ease",cursor:"pointer",pointerEvents:"auto",width:rn*p,height:bn*p,border:rt&&m&&rt.allowedTargetPlayerId===w?"2px solid #48bb78":"none",boxShadow:rt&&m&&rt.allowedTargetPlayerId===w?"0 0 15px #48bb78":"none",borderRadius:8,zIndex:(Q==null?void 0:Q.sourceType)==="BOARD"&&Q.sourceInstanceId===(m==null?void 0:m.instanceId)?10:1,opacity:Rt&&Rt.sourcePlayerId===w&&Rt.followerIndex===v?0:m!=null&&m.isDying?.8:1,transitionProperty:Rt&&Rt.sourcePlayerId===w&&Rt.followerIndex===v?"none":"transform, left, opacity"},children:[a.jsx("div",{style:{width:"100%",height:"100%",perspective:"800px"},children:a.jsxs("div",{className:J0===(m==null?void 0:m.instanceId)||q0===(m==null?void 0:m.instanceId)?"attack-rotating":"",style:{width:"100%",height:"100%",position:"relative",transformStyle:"preserve-3d"},children:[a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},children:m?a.jsx(Xi,{card:m,turnCount:g.turnCount,className:m.isDying?"card-dying":"",scale:p,style:{width:rn*p,height:bn*p,opacity:1,filter:m.isDying?"grayscale(0.5) brightness(2)":"none",boxShadow:(Q==null?void 0:Q.sourceType)==="BOARD"&&Q.sourceInstanceId===(m==null?void 0:m.instanceId)&&(ct==null?void 0:ct.type)==="FOLLOWER"?"0 0 30px #f56565":(Q==null?void 0:Q.sourceType)==="BOARD"&&Q.sourceInstanceId===(m==null?void 0:m.instanceId)?"0 20px 30px rgba(0,0,0,0.6)":void 0,pointerEvents:(Q==null?void 0:Q.sourceType)==="BOARD"&&Q.sourceInstanceId===(m==null?void 0:m.instanceId)?"none":"auto"},isSelected:(Ue==null?void 0:Ue.card)===m,isOnBoard:!0,isSpecialSummoning:Q0.has(m.instanceId),isMyTurn:g.activePlayerId===w}):a.jsx("div",{style:{width:rn*p,height:bn*p,border:"1px dashed rgba(255,255,255,0.2)",borderRadius:8}})}),m&&a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",transform:"rotateY(180deg)",borderRadius:12,overflow:"hidden"},children:a.jsx("img",{src:si((ie==null?void 0:ie.class)||"SENKA"),alt:"Card Sleeve",style:{width:"100%",height:"100%",objectFit:"cover"}})})]})}),m&&(Q==null?void 0:Q.sourceType)==="EVOLVE"&&!m.hasEvolved&&a.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",width:"120%",height:"120%",transform:"translate(-50%, -50%)",pointerEvents:"none",border:Q.useSep?"2px dashed rgba(183, 148, 244, 0.9)":"2px dashed rgba(255, 230, 100, 0.9)",borderRadius:"50%",boxShadow:Q.useSep?"0 0 15px rgba(159, 122, 234, 0.8)":"0 0 15px rgba(255, 200, 50, 0.8)",animation:"evolveMarkerSpin 1.5s linear infinite",zIndex:20,opacity:(ct==null?void 0:ct.type)==="FOLLOWER"&&ct.index===v&&ct.playerId===w?1:0,transition:"opacity 0.1s ease-out"},children:[a.jsxs("svg",{viewBox:"0 0 100 100",style:{width:"100%",height:"100%",filter:"drop-shadow(0 0 8px currentColor)"},children:[a.jsx("defs",{children:a.jsxs("filter",{id:Q.useSep?"purpleMarkerGlow":"yellowMarkerGlow",x:"-30%",y:"-30%",width:"160%",height:"160%",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"3",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:Q.useSep?"#b794f4":"#f6e05e",strokeWidth:"4",strokeDasharray:"15 8",filter:`url(#${Q.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`,opacity:"0.95"}),a.jsx("polygon",{points:"50,5 45,15 55,15",fill:Q.useSep?"#b794f4":"#f6e05e",filter:`url(#${Q.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`}),a.jsx("polygon",{points:"95,50 85,45 85,55",fill:Q.useSep?"#b794f4":"#f6e05e",filter:`url(#${Q.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`}),a.jsx("polygon",{points:"50,95 55,85 45,85",fill:Q.useSep?"#b794f4":"#f6e05e",filter:`url(#${Q.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`}),a.jsx("polygon",{points:"5,50 15,55 15,45",fill:Q.useSep?"#b794f4":"#f6e05e",filter:`url(#${Q.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`})]}),a.jsx("style",{children:`
                                                @keyframes evolveMarkerSpin {
                                                    0% { transform: translate(-50%, -50%) rotate(0deg); }
                                                    100% { transform: translate(-50%, -50%) rotate(360deg); }
                                                }
                                            `})]})]},(m==null?void 0:m.instanceId)||`empty-plr-${v}`)})})}),a.jsxs("div",{style:{position:"absolute",right:30*p,top:"50%",transform:"translateY(-50%)",display:"flex",flexDirection:"column",alignItems:"center",gap:30*p,zIndex:50},children:[a.jsx("div",{style:{textAlign:"center"},children:a.jsxs("div",{style:{fontSize:`${1.2*p}rem`,fontWeight:700,color:"#a0aec0",fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif'},children:["Turn ",g.turnCount]})}),a.jsxs("div",{style:{textAlign:"center"},children:[a.jsxs("div",{style:{fontSize:`${1.8*p}rem`,fontWeight:900,color:"#f6e05e",fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif'},children:[De.pp,"/",De.maxPp]}),a.jsx("div",{style:{display:"flex",gap:4*p,justifyContent:"center"},children:Array(Math.min(10,De.maxPp)).fill(0).map((m,v)=>a.jsx("div",{style:{width:10*p,height:10*p,borderRadius:"50%",background:v<De.pp?"#f6e05e":"#2d3748"}},v))})]}),a.jsxs("div",{style:{position:"relative",width:160*p,height:160*p},children:[a.jsx(QO,{isMyTurn:g.activePlayerId===w,turnCount:g.turnCount,activePlayerId:g.activePlayerId,onTimeUp:iI,timerEnabled:h,isGameOver:!!g.winnerId,isPaused:F,scale:p,buttonSize:160,timerDuration:60}),a.jsxs("button",{ref:K0,disabled:g.activePlayerId!==w||Vi,onMouseDown:m=>{m.stopPropagation(),g.activePlayerId===w&&!Vi&&pf(!0)},onMouseUp:m=>{var v;if(m.stopPropagation(),ic&&g.activePlayerId===w&&!Vi){pf(!1),mt("sisiodosi.mp3",.6);const b=(v=m.target.closest("button"))==null?void 0:v.getBoundingClientRect();b&&gm(b.left+b.width/2,b.top+b.height/2),mf()}},onMouseLeave:()=>{pf(!1)},style:{width:160*p,height:160*p,borderRadius:"50%",border:"4px solid rgba(255,255,255,0.2)",background:Vi?"linear-gradient(135deg, #805ad5, #6b46c1)":ic?"linear-gradient(135deg, #5a9bd5, #4a7fb0)":g.activePlayerId===w?"linear-gradient(135deg, #3182ce, #2b6cb0)":"#2d3748",color:"white",fontWeight:900,fontSize:`${2*p}rem`,fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif',boxShadow:g.activePlayerId===w?ic?"0 0 20px rgba(66, 153, 225, 0.5)":"0 0 40px rgba(66, 153, 225, 0.8)":"none",opacity:ic?.8:1,cursor:g.activePlayerId===w&&!Vi?"pointer":"default",transition:"all 0.1s",position:"relative",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",lineHeight:1.2},children:[a.jsx("img",{src:et("/assets/tenfubu_mark.png"),alt:"",style:{position:"absolute",width:"80%",height:"80%",objectFit:"contain",opacity:.25,pointerEvents:"none"}}),Vi?a.jsx("span",{style:{position:"relative",zIndex:1,whiteSpace:"nowrap"},children:"..."}):a.jsxs(a.Fragment,{children:[a.jsx("span",{style:{position:"relative",zIndex:1,whiteSpace:"nowrap"},children:""}),a.jsx("span",{style:{position:"relative",zIndex:1,whiteSpace:"nowrap"},children:""})]})]})]}),a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("div",{style:{fontSize:`${2.4*p}rem`,fontWeight:900,color:"#f6e05e",fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif'},children:ie.extraPpActive?a.jsxs("span",{children:[Math.max(0,ie.pp-1),"/",ie.maxPp," ",a.jsx("span",{style:{color:"#ed8936"},children:"+1"})]}):a.jsxs("span",{children:[ie.pp,"/",ie.maxPp]})}),a.jsx("div",{style:{display:"flex",gap:3*p,justifyContent:"center"},children:Array(10).fill(0).map((m,v)=>{const b=v<ie.pp,O=v<ie.maxPp;let M;return b?M="#f6e05e":O?M="#744210":M="#2d3748",a.jsx("div",{style:{width:11*p,height:11*p,borderRadius:"50%",background:M}},v)})})]}),(()=>{const m=w!==g.firstPlayerId,v=g.activePlayerId===w,b=g.turnCount,O=b<=5&&!ie.extraPpUsedEarly,M=b>=6&&!ie.extraPpUsedLate,H=m&&v&&!ie.extraPpActive&&(O||M),J=ie.extraPpActive;if(!m)return null;const j=b<=5&&ie.extraPpUsedEarly||b>=6&&ie.extraPpUsedLate,U=!H&&!J;return a.jsxs("button",{disabled:U,onClick:W=>{W.stopPropagation(),U||cs({type:"TOGGLE_EXTRA_PP",playerId:w})},style:{width:160*p,height:45*p,borderRadius:12*p,border:J?"3px solid #ed8936":"3px solid rgba(255,255,255,0.2)",background:J?"linear-gradient(135deg, #ed8936, #dd6b20)":H?"linear-gradient(135deg, #744210, #5a3510)":"#2d3748",color:J?"white":H?"#f6e05e":"#718096",fontWeight:700,fontSize:"1rem",boxShadow:J?"0 0 20px rgba(237, 137, 54, 0.6)":"none",cursor:U?"default":"pointer",transition:"all 0.3s",display:"flex",alignItems:"center",justifyContent:"center",gap:6*p,opacity:j&&!J?.5:1},children:[a.jsx("span",{children:"PP"}),a.jsx("span",{style:{fontSize:"1.3rem"},children:"+1"}),J&&a.jsx("span",{style:{fontSize:"0.8rem"},children:"ON"}),j&&!J&&a.jsx("span",{style:{fontSize:"0.7rem",marginLeft:2},children:""})]})})()]}),Y?a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:m=>{m.stopPropagation(),ef(!0)},style:{position:"absolute",left:15*p,top:120*p,width:64*p,height:64*p,minWidth:64*p,maxWidth:64*p,minHeight:64*p,maxHeight:64*p,borderRadius:"50%",background:"linear-gradient(135deg, #4a5568 0%, #2d3748 100%)",border:"3px solid #63b3ed",color:"#63b3ed",fontSize:`${1.8*p}rem`,fontWeight:"bold",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,padding:0,zIndex:16,boxShadow:"0 2px 8px rgba(0,0,0,0.4)",transition:"all 0.2s ease"},onMouseEnter:m=>{m.currentTarget.style.transform="scale(1.1)",m.currentTarget.style.boxShadow="0 0 15px rgba(99, 179, 237, 0.5)"},onMouseLeave:m=>{m.currentTarget.style.transform="scale(1)",m.currentTarget.style.boxShadow="0 2px 8px rgba(0,0,0,0.4)"},children:"?"}),a.jsx(hL,{logs:g.logs||[],onCardNameClick:Jd,scale:p,isMobile:Y})]}):a.jsxs("div",{style:{position:"absolute",left:15,top:"50%",transform:"translateY(-50%)",display:"flex",flexDirection:"column",alignItems:"flex-start",gap:8,zIndex:16,pointerEvents:"none"},children:[a.jsx("button",{onClick:m=>{m.stopPropagation(),ef(!0)},style:{width:36,height:36,borderRadius:"50%",background:"linear-gradient(135deg, #4a5568 0%, #2d3748 100%)",border:"2px solid #63b3ed",color:"#63b3ed",fontSize:"1.2rem",fontWeight:"bold",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",padding:0,boxShadow:"0 4px 12px rgba(0,0,0,0.4)",transition:"all 0.2s ease",pointerEvents:"auto"},onMouseEnter:m=>{m.currentTarget.style.transform="scale(1.1)",m.currentTarget.style.boxShadow="0 0 15px rgba(99, 179, 237, 0.5)"},onMouseLeave:m=>{m.currentTarget.style.transform="scale(1)",m.currentTarget.style.boxShadow="0 4px 12px rgba(0,0,0,0.4)"},children:"?"}),a.jsxs("div",{style:{width:Math.max(180,220*p),height:Math.max(200,280*p),overflowY:"auto",background:"linear-gradient(to right, rgba(0,0,0,0.8), rgba(0,0,0,0.0))",color:"#fff",fontSize:`${Math.max(.65,.75*p)}rem`,padding:`${8*p}px ${8*p}px ${8*p}px ${12*p}px`,borderLeft:"3px solid #63b3ed",pointerEvents:"auto",scrollbarWidth:"thin"},onMouseDown:m=>m.stopPropagation(),onClick:m=>m.stopPropagation(),ref:m=>{m&&(m.scrollTop=m.scrollHeight)},children:[a.jsx("div",{style:{fontWeight:"bold",marginBottom:4*p,color:"#a0aec0",borderBottom:"1px solid rgba(255,255,255,0.1)",paddingBottom:2,fontSize:`${Math.max(.55,.65*p)}rem`,textTransform:"uppercase",letterSpacing:1},children:"BATTLE LOG"}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:3*p},children:(g.logs||[]).map((m,v)=>a.jsx("div",{style:{opacity:.9,lineHeight:"1.4",textShadow:"0 1px 2px black",animation:"fadeIn 0.3s ease-out"},children:m},v))})]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,pointerEvents:"none"},children:[a.jsxs("div",{style:{position:"relative",width:32,height:40},children:[a.jsx("div",{style:{position:"absolute",inset:0,background:"#4a5568",borderRadius:4,border:"1px solid #718096",transform:"rotate(-15deg) translate(-5px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#2d3748",borderRadius:4,border:"1px solid #718096",transform:"rotate(-5deg) translate(-2px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#1a202c",borderRadius:4,border:"1px solid #cbd5e0",transform:"rotate(5deg)"}})]}),a.jsxs("div",{style:{background:"rgba(0,0,0,0.7)",padding:"4px 12px",borderRadius:8,color:"#e2e8f0",fontSize:"0.9rem",fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5)"},children:[" ",ie.hand.length]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,marginLeft:6},children:[a.jsx("div",{style:{fontSize:"1.2rem",filter:"drop-shadow(0 0 3px rgba(128, 90, 213, 0.8))"},children:""}),a.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(128, 90, 213, 0.8), rgba(76, 29, 149, 0.9))",padding:"4px 12px",borderRadius:8,color:"#e2e8f0",fontSize:"0.9rem",fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5), inset 0 1px rgba(255,255,255,0.1)",border:"1px solid rgba(167, 139, 250, 0.5)",position:"relative"},children:[" ",ie.graveyard.length,Wd.filter(m=>m.playerId===w).map(m=>a.jsxs("div",{style:{position:"absolute",top:-30,left:"50%",transform:"translateX(-50%)",color:"#d946ef",fontSize:"1.5rem",fontWeight:"bold",textShadow:"0 0 10px #d946ef, 0 0 20px #a855f7, 0 0 30px #7c3aed",animation:"necromanceFloat 1.5s ease-out forwards",pointerEvents:"none",whiteSpace:"nowrap"},children:["-",m.amount]},m.key))]})]})]}),Ue&&Ue.owner==="PLAYER"&&Ue.source==="HAND"&&$r&&(()=>{const b=((Y?Math.max(140,180*p):Math.max(180,220*p))-6)/2,O=ie.pp>=Ue.card.cost;return a.jsxs("button",{disabled:!O,onClick:M=>{M.stopPropagation(),pm()},className:O?"play-button-active":"",style:{width:b,background:O?"linear-gradient(to bottom, #48bb78, #38a169)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:"8px 4px",borderRadius:12,fontSize:"0.85rem",fontWeight:"bold",cursor:O?"pointer":"not-allowed",boxShadow:O?"0 0 15px rgba(72, 187, 120, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease",pointerEvents:"auto"},onMouseDown:M=>M.stopPropagation(),children:["",a.jsxs("div",{style:{fontSize:"0.6rem",opacity:.8,marginTop:2},children:["pp ",Ue.card.cost]})]})})(),Ue&&Ue.owner==="PLAYER"&&Ue.source==="BOARD"&&(()=>{const m=Y?Math.max(140,180*p):Math.max(180,220*p),v=6,b=(m-v)/2,O=Ue.card,M=O==null?void 0:O.hasEvolved,H=!M&&ds,J=!M&&fs,j=O==null?void 0:O.instanceId,U=ie.board.findIndex(q=>q&&q.instanceId===j),W=ie.board.slice(0,U+1).filter(q=>q).length-1,ae=q=>{U<0||rc(W>=0?W:U,q,void 0,j)};return a.jsxs("div",{style:{display:"flex",gap:v,pointerEvents:"auto"},onMouseDown:q=>q.stopPropagation(),children:[a.jsxs("button",{disabled:!H,onClick:q=>{q.stopPropagation(),ae(!1)},style:{width:b,background:H?"linear-gradient(to bottom, #faf089, #d69e2e)":"#718096",color:H?"#1a202c":"white",border:"2px solid rgba(255,255,255,0.2)",padding:"8px 4px",borderRadius:12,fontSize:"0.85rem",fontWeight:"bold",cursor:H?"pointer":"not-allowed",boxShadow:H?"0 0 15px rgba(250, 240, 137, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:H?"0 1px 1px rgba(255,255,255,0.3)":"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",a.jsx("div",{style:{fontSize:"0.6rem",opacity:.8,marginTop:2},children:"EP"})]}),a.jsxs("button",{disabled:!J,onClick:q=>{q.stopPropagation(),ae(!0)},style:{width:b,background:J?"linear-gradient(to bottom, #b794f4, #805ad5)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:"8px 4px",borderRadius:12,fontSize:"0.85rem",fontWeight:"bold",cursor:J?"pointer":"not-allowed",boxShadow:J?"0 0 15px rgba(183, 148, 244, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",a.jsx("div",{style:{fontSize:"0.6rem",opacity:.8,marginTop:2},children:"SEP"})]})]})})(),!(Ue&&Ue.owner==="PLAYER"&&(Ue.source==="HAND"||Ue.source==="BOARD"))&&(()=>{const m=Y?Math.max(140,180*p):Math.max(180,220*p);return a.jsx("div",{style:{width:m,height:52,visibility:"hidden",pointerEvents:"none"}})})()]}),(dt==="TOSSING"||dt==="RESULT")&&a.jsxs("div",{style:{position:"absolute",inset:0,zIndex:4e3,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.85)",pointerEvents:"none"},children:[a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("div",{style:{width:120*p,height:120*p,margin:`0 auto ${30*p}px`,borderRadius:"50%",background:dt==="RESULT"?Wt==="FIRST"?"linear-gradient(135deg, #ffd700, #ff8c00)":"linear-gradient(135deg, #c0c0c0, #808080)":"linear-gradient(135deg, #ffd700, #ff8c00)",boxShadow:dt==="RESULT"?`0 0 ${40*p}px ${Wt==="FIRST"?"#ffd700":"#c0c0c0"}, 0 0 ${80*p}px ${Wt==="FIRST"?"rgba(255,215,0,0.5)":"rgba(192,192,192,0.5)"}`:`0 0 ${30*p}px #ffd700`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"3rem",fontWeight:900,color:"#1a202c",textShadow:"0 2px 2px rgba(0,0,0,0.5)",animation:dt==="TOSSING"?"coinFlip 0.3s ease-in-out infinite":"coinLand 0.5s ease-out",border:"4px solid rgba(255,255,255,0.3)"},children:dt==="RESULT"?Wt==="FIRST"?"":"":"?"}),a.jsxs("div",{style:{fontSize:dt==="RESULT"?"2.5rem":"1.8rem",fontWeight:900,color:Wt==="FIRST"?"#ffd700":Wt==="SECOND"?"#c0c0c0":"white",textShadow:"0 0 20px currentColor, 0 2px 4px black",animation:dt==="RESULT"?"textPop 0.5s ease-out":"none"},children:[dt==="TOSSING"&&"...",dt==="RESULT"&&(Wt==="FIRST"?"":"")]}),dt==="RESULT"&&a.jsx("div",{style:{fontSize:"1rem",color:"#a0aec0",marginTop:10*p,animation:"fadeIn 0.5s ease-out 0.3s both"},children:Wt==="FIRST"?"":""})]}),a.jsx("style",{children:`
                            @keyframes coinFlip {
                                0%, 100% { transform: rotateY(0deg) scale(1); }
                                50% { transform: rotateY(180deg) scale(1.1); }
                            }
                            @keyframes coinLand {
                                0% { transform: rotateY(720deg) scale(0.5); }
                                70% { transform: rotateY(0deg) scale(1.2); }
                                100% { transform: rotateY(0deg) scale(1); }
                            }
                            @keyframes textPop {
                                0% { transform: scale(0.5); opacity: 0; }
                                70% { transform: scale(1.2); }
                                100% { transform: scale(1); opacity: 1; }
                            }
                        `})]}),Bd&&a.jsxs("div",{style:{position:"absolute",inset:0,zIndex:3e3,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.7)",pointerEvents:"none",animation:"fadeIn 0.2s ease-out"},children:[a.jsx("div",{style:{fontSize:`${3.5*p}rem`,fontWeight:900,fontFamily:"Tamanegi, sans-serif",background:"linear-gradient(135deg, #ffd700, #ff6b6b, #ffd700)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",textShadow:"none",filter:`drop-shadow(0 0 ${15*p}px rgba(255,215,0,0.8)) drop-shadow(0 0 ${30*p}px rgba(255,107,107,0.5))`,animation:"gameStartPop 0.8s ease-out",letterSpacing:"0.2em"},children:" "}),a.jsx("style",{children:`
                            @keyframes gameStartPop {
                                0% { transform: scale(0.3) rotate(-10deg); opacity: 0; }
                                50% { transform: scale(1.2) rotate(5deg); opacity: 1; }
                                70% { transform: scale(0.95) rotate(-2deg); }
                                100% { transform: scale(1) rotate(0deg); opacity: 1; }
                            }
                        `})]}),a.jsxs("div",{ref:ri,style:{position:"absolute",bottom:-20*p,left:"50%",transform:"translateX(-50%)",width:Qi*p,height:Qi*p,borderRadius:"50%",zIndex:200},children:[a.jsxs("div",{onMouseDown:tI,style:{width:"100%",height:"100%",borderRadius:"50%",overflow:"hidden",border:bf?"4px solid #67e8f9":"4px solid #3182ce",boxShadow:bf?"0 0 20px rgba(103, 232, 249, 0.4), 0 0 40px rgba(103, 232, 249, 0.2)":"0 0 20px rgba(49, 130, 206, 0.4)",background:"#1a202c",cursor:"grab",transition:"border-color 0.3s, box-shadow 0.3s, filter 0.5s, opacity 0.5s",animation:xm?"leaderDamageCapPulse 2s ease-in-out infinite":"none",position:"relative",...g.winnerId&&g.winnerId!==w&&(je||Pe)?{filter:je==="white-fade"?"brightness(2) saturate(0.3)":je==="explode"||je==="result-text"||je==="fade-out"||Pe?"brightness(3) saturate(0) blur(10px)":"none",opacity:je==="explode"||je==="result-text"||je==="fade-out"||Pe?0:1}:{}},children:[a.jsx("img",{src:Va(ie.class),style:ie.class==="AJA"?{width:"100%",height:"100%",objectFit:"cover",objectPosition:"center top",pointerEvents:"none"}:{width:"100%",height:"100%",objectFit:"cover",pointerEvents:"none"}}),xm&&a.jsx("div",{style:{position:"absolute",inset:0,borderRadius:"50%",background:"radial-gradient(circle, rgba(103, 232, 249, 0.5) 0%, rgba(103, 232, 249, 0.2) 70%, rgba(103, 232, 249, 0.1) 100%)",pointerEvents:"none",animation:"leaderDamageCapOverlay 2s ease-in-out infinite",zIndex:1}})]}),a.jsx("div",{style:{position:"absolute",top:0,left:"50%",transform:`translateX(-50%) translateX(${-140*p}px)`,width:55*p,height:55*p,background:"radial-gradient(circle at 30% 30%, #feb2b2, #c53030)",borderRadius:"50%",border:`${Math.max(2,3*p)}px solid #fff`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${1.2*p}rem`,fontWeight:900,color:"white",textShadow:"0 2px 2px rgba(0,0,0,0.5)",boxShadow:"0 4px 6px rgba(0,0,0,0.4)",zIndex:10,opacity:Z?1:0,transition:"opacity 0.3s ease-in"},children:ie.hp}),a.jsx("div",{onMouseDown:m=>sc(m,!1),onTouchStart:m=>sc(m,!1),style:{position:"absolute",top:10*p,left:"50%",transform:`translateX(-50%) translateX(${-80*p}px)`,width:45*p,height:45*p,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:ds?"rgba(255,235,100,0.2)":"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",cursor:ds?"grab":"default",zIndex:10,opacity:Z?oc?1:.5:0,filter:oc?"none":"grayscale(0.8)",transition:"opacity 0.3s ease-in, filter 0.3s, background 0.3s",boxShadow:ds?"0 0 12px #ffd700, 0 0 25px rgba(255,215,0,0.5)":"none",animation:ds?"epPulse 1.5s ease-in-out infinite":"none"},children:a.jsx("div",{style:{display:"flex",gap:3*p},children:Array(2).fill(0).map((m,v)=>{const b=v<mm;let O="none";return b&&oc&&(O=ds?"0 0 10px #fff59d, 0 0 20px #ffd700, 0 0 30px #ecc94b":"0 0 8px #ecc94b, 0 0 15px #ecc94b"),a.jsx("div",{style:{width:12*p,height:12*p,borderRadius:"50%",background:b?ds?"#fff59d":"#ecc94b":"#2d3748",boxShadow:O,border:"2px solid rgba(0,0,0,0.5)",transition:"box-shadow 0.3s, background 0.3s"}},v)})})}),a.jsx("div",{onMouseDown:m=>sc(m,!0),onTouchStart:m=>sc(m,!0),style:{position:"absolute",top:10*p,left:"50%",transform:`translateX(-50%) translateX(${80*p}px)`,width:45*p,height:45*p,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:fs?"rgba(200,160,255,0.2)":"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,cursor:fs?"grab":"default",opacity:Z?ac?1:.5:0,filter:ac?"none":"grayscale(0.8)",transition:"opacity 0.3s ease-in, filter 0.3s, background 0.3s",boxShadow:fs?"0 0 12px #b794f4, 0 0 25px rgba(159,122,234,0.5)":"none",animation:fs?"sepPulse 1.5s ease-in-out infinite":"none"},children:a.jsx("div",{style:{display:"flex",gap:3*p},children:Array(2).fill(0).map((m,v)=>{const b=v<ie.sep;let O="none";return b&&ac&&(O=fs?"0 0 10px #d6bcfa, 0 0 20px #b794f4, 0 0 30px #9f7aea":"0 0 8px #9f7aea, 0 0 15px #9f7aea"),a.jsx("div",{style:{width:12*p,height:12*p,borderRadius:"50%",background:b?fs?"#d6bcfa":"#9f7aea":"#2d3748",boxShadow:O,border:"2px solid rgba(0,0,0,0.5)",transition:"box-shadow 0.3s, background 0.3s"}},v)})})})]}),a.jsxs("div",{style:{position:"absolute",bottom:10*p,right:15*p,width:60*p,height:85*p,zIndex:50},children:[[...Array(Math.min(5,Math.ceil(ie.deck.length/5)))].map((m,v)=>a.jsx("div",{style:{position:"absolute",inset:0,transform:`translate(${v*2*p}px, ${-v*2*p}px)`,borderRadius:6,border:"1px solid #718096",boxShadow:"1px 1px 3px rgba(0,0,0,0.5)",overflow:"hidden"},children:a.jsx("img",{src:si((ie==null?void 0:ie.class)||"SENKA"),alt:"Deck",style:{width:"100%",height:"100%",objectFit:"cover"},onError:b=>{b.target.style.display="none",b.target.parentElement.style.background="linear-gradient(45deg, #2d3748, #1a202c)"}})},v)),a.jsx("div",{style:{position:"absolute",top:-20*p,width:"100%",textAlign:"center",color:"#a0aec0",fontSize:"0.9rem",fontWeight:"bold",textShadow:"0 1px 2px black"},children:ie.deck.length})]}),a.jsx("div",{style:{position:"absolute",bottom:0,left:0,width:"100%",height:200*p,display:"flex",justifyContent:"center",alignItems:"flex-end",pointerEvents:"none",zIndex:500},children:ie.hand.map((m,v)=>{if(Ke!==null&&Ke.sourceIndex===v)return null;const O=ie.hand.length;let M=0,H=0,J=0;if($r){const U=100*p,W=window.innerWidth-40*p,ae=(O-1)*U+rn*p;let q=U;ae>W&&(q=(W-rn*p)/Math.max(1,O-1)),M=(v-(O-1)/2)*q,H=me===v?-8*p:0,J=0}else{const U=45*p,W=160*p,ae=rn*p/2,q=window.innerWidth/2-W-ae,he=window.innerWidth-340*p-W,_e=(O-1)*U+rn*p;let Xe=U;_e>he&&(Xe=(he-rn*p)/Math.max(1,O-1)),M=q-(O-1-v)*Xe,H=0,J=(v-(O-1)/2)*3}const j=ie.pp>=m.cost&&g.activePlayerId===w;return a.jsx("div",{onMouseDown:U=>{cm(U,v),$r&&Se(v===me?null:v)},onTouchStart:U=>{cm(U,v),$r&&Se(v===me?null:v)},style:{position:"absolute",left:"50%",bottom:5*p,transform:`translateX(calc(-50% + ${M}px)) translateY(${H}px) rotate(${J}deg) ${(Q==null?void 0:Q.sourceType)==="HAND"&&Q.sourceIndex===v?"scale(1.05) translateY(-10px)":$r?"translateY(-3px)":""}`,transition:GS===v?"all 0.3s ease-in":(Q==null?void 0:Q.sourceType)==="HAND"&&Q.sourceIndex===v?"none":"all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1)",zIndex:(Q==null?void 0:Q.sourceType)==="HAND"&&Q.sourceIndex===v?1e3:v+100,width:(Y?80:rn)*p,height:(Y?115:bn)*p,pointerEvents:"auto",cursor:j?"grab":"not-allowed"},onClick:U=>U.stopPropagation(),children:a.jsx(Xi,{card:m,turnCount:g.turnCount,isMyTurn:g.activePlayerId===w,isPlayable:j,scale:p,variant:Y?"mobile-hand":"normal",style:{width:Y?80*p:rn*p,height:Y?115*p:bn*p,boxShadow:(Q==null?void 0:Q.sourceType)==="HAND"&&Q.sourceIndex===v?"0 0 40px rgba(49, 130, 206, 0.8)":j?"0 0 15px rgba(40, 180, 100, 0.6)":"none"}})},m.instanceId)})}),Y&&a.jsxs("div",{style:{position:"absolute",bottom:200*p,left:15*p,display:"flex",alignItems:"center",gap:10*p,zIndex:601,pointerEvents:"none"},children:[a.jsxs("div",{style:{position:"relative",width:50*p,height:62*p},children:[a.jsx("div",{style:{position:"absolute",inset:0,background:"#4a5568",borderRadius:6*p,border:"1px solid #718096",transform:"rotate(-15deg) translate(-5px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#2d3748",borderRadius:6*p,border:"1px solid #718096",transform:"rotate(-5deg) translate(-2px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#1a202c",borderRadius:6*p,border:"1px solid #cbd5e0",transform:"rotate(5deg)"}})]}),a.jsxs("div",{style:{background:"rgba(0,0,0,0.7)",padding:`${6*p}px ${16*p}px`,borderRadius:10*p,color:"#e2e8f0",fontSize:`${1.32*p}rem`,fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5)"},children:[" ",ie.hand.length]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6*p,marginLeft:10*p},children:[a.jsx("div",{style:{fontSize:`${1.87*p}rem`,filter:"drop-shadow(0 0 3px rgba(128, 90, 213, 0.8))"},children:""}),a.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(128, 90, 213, 0.8), rgba(76, 29, 149, 0.9))",padding:`${6*p}px ${16*p}px`,borderRadius:10*p,color:"#e2e8f0",fontSize:`${1.32*p}rem`,fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5), inset 0 1px rgba(255,255,255,0.1)",border:"1px solid rgba(167, 139, 250, 0.5)",position:"relative"},children:[" ",ie.graveyard.length,Wd.filter(m=>m.playerId===w).map(m=>a.jsxs("div",{style:{position:"absolute",top:-30,left:"50%",transform:"translateX(-50%)",color:"#d946ef",fontSize:"1.5rem",fontWeight:"bold",textShadow:"0 0 10px #d946ef, 0 0 20px #a855f7, 0 0 30px #7c3aed",animation:"necromanceFloat 1.5s ease-out forwards",pointerEvents:"none",whiteSpace:"nowrap"},children:["-",m.amount]},m.key))]})]})]}),Y&&Ue&&Ue.owner==="PLAYER"&&Ue.source==="HAND"&&$r&&(()=>{const m=Math.max(140,180*p),v=4*p,b=(m-v)/2,O=ie.pp>=Ue.card.cost;return a.jsxs("div",{style:{position:"absolute",left:15*p,bottom:135*p,zIndex:600,pointerEvents:"auto"},children:[a.jsxs("button",{disabled:!O,onClick:M=>{M.stopPropagation(),pm()},className:O?"play-button-active":"",style:{width:b,background:O?"linear-gradient(to bottom, #48bb78, #38a169)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:`${5*p}px ${3*p}px`,borderRadius:10*p,fontSize:`${.7*p}rem`,fontWeight:"bold",cursor:O?"pointer":"not-allowed",boxShadow:O?"0 0 12px rgba(72, 187, 120, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},onMouseDown:M=>M.stopPropagation(),children:["",a.jsxs("div",{style:{fontSize:`${.5*p}rem`,opacity:.8,marginTop:1},children:["pp ",Ue.card.cost]})]}),a.jsx("style",{children:`
                                @keyframes playGlowPulse {
                                    0% { box-shadow: 0 0 10px rgba(72, 187, 120, 0.4); }
                                    50% { box-shadow: 0 0 25px rgba(72, 187, 120, 0.8); }
                                    100% { box-shadow: 0 0 10px rgba(72, 187, 120, 0.4); }
                                }
                                .play-button-active {
                                    animation: playGlowPulse 2s infinite ease-in-out;
                                }
                            `})]})})(),Y&&Ue&&Ue.owner==="PLAYER"&&Ue.source==="BOARD"&&(()=>{const m=Math.max(140,180*p),v=4*p,b=(m-v)/2,O=Ue.card,M=O==null?void 0:O.hasEvolved,H=!M&&ds,J=!M&&fs,j=O==null?void 0:O.instanceId,U=ie.board.findIndex(q=>q&&q.instanceId===j),W=ie.board.slice(0,U+1).filter(q=>q).length-1,ae=q=>{U<0||rc(W>=0?W:U,q,void 0,j)};return a.jsxs("div",{style:{position:"absolute",left:15*p,bottom:135*p,zIndex:600,pointerEvents:"auto",display:"flex",gap:v},onMouseDown:q=>q.stopPropagation(),children:[a.jsxs("button",{disabled:!H,onClick:q=>{q.stopPropagation(),ae(!1)},style:{width:b,background:H?"linear-gradient(to bottom, #faf089, #d69e2e)":"#718096",color:H?"#1a202c":"white",border:"2px solid rgba(255,255,255,0.2)",padding:`${5*p}px ${3*p}px`,borderRadius:10*p,fontSize:`${.7*p}rem`,fontWeight:"bold",cursor:H?"pointer":"not-allowed",boxShadow:H?"0 0 12px rgba(250, 240, 137, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:H?"0 1px 1px rgba(255,255,255,0.3)":"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",a.jsx("div",{style:{fontSize:`${.5*p}rem`,opacity:.8,marginTop:1},children:"EP"})]}),a.jsxs("button",{disabled:!J,onClick:q=>{q.stopPropagation(),ae(!0)},style:{width:b,background:J?"linear-gradient(to bottom, #b794f4, #805ad5)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:`${5*p}px ${3*p}px`,borderRadius:10*p,fontSize:`${.7*p}rem`,fontWeight:"bold",cursor:J?"pointer":"not-allowed",boxShadow:J?"0 0 12px rgba(183, 148, 244, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",a.jsx("div",{style:{fontSize:`${.5*p}rem`,opacity:.8,marginTop:1},children:"SEP"})]})]})})(),as&&Array.from({length:as.count},(m,v)=>{const J=-(as.count*80+(as.count-1)*20-80)/2+v*100,j=as.isPlayer?si((ie==null?void 0:ie.class)||"SENKA"):si((De==null?void 0:De.class)||"SENKA");return a.jsx("div",{style:{position:"absolute",left:as.isPlayer?"calc(100% - 90px)":90,top:as.isPlayer?"calc(100% - 105px)":105,width:80,height:110,borderRadius:8,border:"2px solid white",overflow:"hidden",transform:`translateX(${J}px)`,animation:`drawCard${as.isPlayer?"Player":"Opponent"} ${qd}ms cubic-bezier(0.2, 0.8, 0.2, 1) forwards`,zIndex:9e3+v,boxShadow:"0 0 10px rgba(255,255,255,0.5)"},children:a.jsx("img",{src:j,alt:"Card Back",style:{width:"100%",height:"100%",objectFit:"cover"},onError:U=>{U.target.style.display="none",U.target.parentElement.style.background="repeating-linear-gradient(45deg, #2d3748, #2d3748 10px, #1a202c 10px, #1a202c 20px)"}})},v)}),a.jsx("style",{children:`
                        @keyframes drawCardPlayer {
                            0% { opacity: 1; }
                            100% { transform: translate(-50vw, -100px) scale(0.5) rotate(-10deg); opacity: 0; }
                        }
                        @keyframes drawCardOpponent {
                            0% { opacity: 1; }
                            100% { transform: translate(50vw, 200px) scale(0.5) rotate(10deg); opacity: 0; }
                        }
                    `})]}),qS.map(m=>a.jsx(uL,{value:m.value,x:m.x,y:m.y,color:m.color,scale:p,onComplete:()=>Zl(v=>v.filter(b=>b.id!==m.id))},m.id)),Gd&&Dr.current&&(()=>{const m=Dr.current.x,v=Dr.current.y,b=200,O=320,H=180/8,J=(j,U,W,ae)=>{const q=j*Math.PI/180,he=U*Math.PI/180,_e=Math.cos(q)*ae,Xe=-Math.sin(q)*ae,be=Math.cos(he)*ae,Ve=-Math.sin(he)*ae,Ze=Math.cos(he)*W,He=-Math.sin(he)*W,We=Math.cos(q)*W,pe=-Math.sin(q)*W;return`M ${_e} ${Xe} A ${ae} ${ae} 0 0 0 ${be} ${Ve} L ${Ze} ${He} A ${W} ${W} 0 0 1 ${We} ${pe} Z`};return a.jsxs("div",{style:{position:"fixed",left:m,top:v,zIndex:2e3,pointerEvents:"none",animation:"stampUIFadeIn 0.15s ease-out"},children:[a.jsx("svg",{width:O*2+20,height:O+20,style:{position:"absolute",left:-330,top:-330,overflow:"visible"},children:a.jsx("g",{transform:`translate(${O+10}, ${O+10})`,children:P0.map((j,U)=>{const W=180-U*H,ae=W-H,q=Vd===j.id,_e=(W+ae)/2*Math.PI/180,Xe=(b+O)/2,be=Math.cos(_e)*Xe,Ve=-Math.sin(_e)*Xe,Ze=85;return a.jsxs("g",{children:[a.jsx("path",{d:J(W,ae,b,O),fill:q?"rgba(255, 215, 0, 0.4)":"rgba(0, 0, 0, 0.7)",stroke:q?"#ffd700":"rgba(255, 255, 255, 0.3)",strokeWidth:q?3:1,style:{transition:"all 0.1s ease-out"}}),a.jsx("defs",{children:a.jsx("clipPath",{id:`stampClip-${j.id}`,children:a.jsx("circle",{cx:be,cy:Ve,r:Ze/2})})}),a.jsx("image",{href:et(l_(j.id,xr)),x:be-Ze/2,y:Ve-Ze/2,width:Ze,height:Ze,clipPath:`url(#stampClip-${j.id})`,style:{transform:q?"scale(1.15)":"scale(1)",transformOrigin:`${be}px ${Ve}px`,transition:"transform 0.1s ease-out"}}),a.jsx("circle",{cx:be,cy:Ve,r:Ze/2,fill:"none",stroke:q?"#ffd700":"rgba(255, 255, 255, 0.5)",strokeWidth:q?2:1})]},j.id)})})}),a.jsx("style",{children:`
                                @keyframes stampUIFadeIn {
                                    from { opacity: 0; transform: scale(0.8); }
                                    to { opacity: 1; transform: scale(1); }
                                }
                            `})]})})(),Zo&&a.jsxs("div",{style:{position:"fixed",left:"50%",top:"40%",transform:"translate(-50%, -50%)",zIndex:2500,pointerEvents:"none",animation:"stampDisplay 3s ease-out forwards"},children:[a.jsx("div",{style:{width:250,height:250,borderRadius:20,overflow:"hidden",boxShadow:"0 0 40px rgba(0,0,0,0.5), 0 0 60px rgba(255,255,255,0.2)",border:"4px solid rgba(255,255,255,0.3)"},children:a.jsx("img",{src:et(l_(Zo.stampId,Zo.playerClass)),alt:"",style:{width:"100%",height:"100%",objectFit:"cover"}})}),Zo.playerId!==w&&a.jsx("div",{style:{position:"absolute",bottom:-30,left:"50%",transform:"translateX(-50%)",background:"rgba(0,0,0,0.7)",padding:"5px 15px",borderRadius:15,color:"#fff",fontSize:"0.9rem",whiteSpace:"nowrap"},children:""}),a.jsx("style",{children:`
                            @keyframes stampDisplay {
                                0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
                                10% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
                                20% { transform: translate(-50%, -50%) scale(1); }
                                80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                                100% { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
                            }
                        `})]},Zo.timestamp),a.jsx("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:1e3},children:Q&&(Q.sourceType==="BOARD"||Q.sourceType==="EVOLVE")&&a.jsxs(a.Fragment,{children:[a.jsxs("defs",{children:[a.jsxs("filter",{id:"cyanGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{stdDeviation:"10",result:"blur1"}),a.jsx("feFlood",{floodColor:"rgba(100, 200, 255, 0.7)",result:"color1"}),a.jsx("feComposite",{in:"color1",in2:"blur1",operator:"in",result:"glow1"}),a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"5",result:"blur2"}),a.jsx("feFlood",{floodColor:"rgba(150, 220, 255, 0.5)",result:"color2"}),a.jsx("feComposite",{in:"color2",in2:"blur2",operator:"in",result:"glow2"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"glow1"}),a.jsx("feMergeNode",{in:"glow2"})]})]}),a.jsxs("filter",{id:"yellowGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{stdDeviation:"10",result:"blur1"}),a.jsx("feFlood",{floodColor:"rgba(255, 255, 50, 0.7)",result:"color1"}),a.jsx("feComposite",{in:"color1",in2:"blur1",operator:"in",result:"glow1"}),a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"5",result:"blur2"}),a.jsx("feFlood",{floodColor:"rgba(255, 240, 100, 0.5)",result:"color2"}),a.jsx("feComposite",{in:"color2",in2:"blur2",operator:"in",result:"glow2"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"glow1"}),a.jsx("feMergeNode",{in:"glow2"})]})]}),a.jsxs("filter",{id:"softWhiteGlow",x:"-300%",y:"-300%",width:"700%",height:"700%",children:[a.jsx("feGaussianBlur",{stdDeviation:"20",result:"blur"}),a.jsx("feFlood",{floodColor:"rgba(255, 255, 255, 0.9)",result:"color"}),a.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"glow"}),a.jsx("feMergeNode",{in:"glow"}),a.jsx("feMergeNode",{in:"glow"})]})]}),a.jsxs("filter",{id:"innerCoreGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{stdDeviation:"4",result:"blur"}),a.jsx("feFlood",{floodColor:"rgba(255, 255, 255, 0.8)",result:"color"}),a.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),a.jsx("feMerge",{children:a.jsx("feMergeNode",{in:"glow"})})]}),a.jsxs("filter",{id:"coloredBallGlow",x:"-150%",y:"-150%",width:"400%",height:"400%",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"6",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"blur"})]})]}),a.jsxs("filter",{id:"particleGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"2",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),a.jsxs("filter",{id:"purpleGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{stdDeviation:"10",result:"blur1"}),a.jsx("feFlood",{floodColor:"rgba(183, 148, 244, 0.7)",result:"color1"}),a.jsx("feComposite",{in:"color1",in2:"blur1",operator:"in",result:"glow1"}),a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"5",result:"blur2"}),a.jsx("feFlood",{floodColor:"rgba(200, 170, 255, 0.5)",result:"color2"}),a.jsx("feComposite",{in:"color2",in2:"blur2",operator:"in",result:"glow2"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"glow1"}),a.jsx("feMergeNode",{in:"glow2"})]})]})]}),Q.sourceType==="BOARD"&&a.jsxs(a.Fragment,{children:[a.jsx("path",{d:us(),fill:"none",stroke:"rgba(100, 200, 255, 0.3)",strokeWidth:"20",strokeLinecap:"butt",filter:"url(#cyanGlow)"}),a.jsx("path",{d:us(),fill:"none",stroke:"rgba(150, 220, 255, 0.5)",strokeWidth:"10",strokeLinecap:"butt"}),a.jsx("path",{d:us(),fill:"none",stroke:"rgba(200, 240, 255, 0.9)",strokeWidth:"4",strokeLinecap:"butt"}),a.jsx("path",{d:us(),fill:"none",stroke:"rgba(255, 255, 255, 1)",strokeWidth:"2",strokeLinecap:"butt"})]}),Q.sourceType==="EVOLVE"&&a.jsxs(a.Fragment,{children:[a.jsx("path",{d:us(),fill:"none",stroke:Q.useSep?"rgba(159, 122, 234, 0.3)":"rgba(236, 201, 75, 0.3)",strokeWidth:"20",strokeLinecap:"butt",filter:Q.useSep?"url(#purpleGlow)":"url(#yellowGlow)"}),a.jsx("path",{d:us(),fill:"none",stroke:Q.useSep?"rgba(183, 148, 244, 0.5)":"rgba(246, 224, 94, 0.5)",strokeWidth:"10",strokeLinecap:"butt"}),a.jsx("path",{d:us(),fill:"none",stroke:Q.useSep?"rgba(214, 188, 250, 0.9)":"rgba(250, 240, 137, 0.9)",strokeWidth:"4",strokeLinecap:"butt"}),a.jsx("path",{d:us(),fill:"none",stroke:"rgba(255, 255, 255, 1)",strokeWidth:"2",strokeLinecap:"butt"})]}),(Q.sourceType==="BOARD"||Q.sourceType==="EVOLVE")&&a.jsxs(a.Fragment,{children:[a.jsx("circle",{cx:Q.startX,cy:Q.startY,r:"15",fill:"rgba(255, 255, 255, 0.3)",filter:"url(#softWhiteGlow)"}),a.jsx("circle",{cx:Q.startX,cy:Q.startY,r:"8",fill:"rgba(255, 255, 255, 0.4)",filter:"url(#softWhiteGlow)"})]}),(Q.sourceType==="BOARD"||Q.sourceType==="EVOLVE")&&a.jsxs(a.Fragment,{children:[a.jsx("circle",{cx:Q.currentX,cy:Q.currentY,r:"18",fill:"rgba(255, 255, 255, 0.25)",filter:"url(#softWhiteGlow)"}),a.jsx("circle",{cx:Q.currentX,cy:Q.currentY,r:"8",fill:"rgba(255, 255, 255, 0.35)",filter:"url(#softWhiteGlow)"}),a.jsx("circle",{cx:Q.currentX,cy:Q.currentY,r:"3",fill:"rgba(255, 255, 255, 0.7)",filter:"url(#innerCoreGlow)"})]}),HS.map(m=>{const v=Q.sourceType==="EVOLVE"?Q.useSep?`rgba(230, 220, 255, ${m.opacity})`:`rgba(255, 255, 230, ${m.opacity})`:`rgba(220, 245, 255, ${m.opacity})`;return a.jsx("circle",{cx:m.x,cy:m.y,r:m.radius,fill:v,filter:"url(#particleGlow)"},m.id)})]})}),Gt&&a.jsxs("svg",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100dvh",pointerEvents:"none",zIndex:99999},children:[a.jsx("defs",{children:a.jsxs("filter",{id:"endTurnGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{stdDeviation:"6",result:"blur"}),a.jsx("feFlood",{floodColor:"rgba(100, 200, 255, 0.8)",result:"color"}),a.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"glow"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsx("circle",{cx:Gt.x,cy:Gt.y,r:Gt.ringRadius,fill:"none",stroke:`rgba(100, 200, 255, ${Math.max(0,1-Gt.ringRadius/120)*.8})`,strokeWidth:"4",filter:"url(#endTurnGlow)"}),a.jsx("circle",{cx:Gt.x,cy:Gt.y,r:Gt.ringRadius*.8,fill:"none",stroke:`rgba(255, 255, 255, ${Math.max(0,1-Gt.ringRadius/120)*.6})`,strokeWidth:"2"}),a.jsx("circle",{cx:Gt.x,cy:Gt.y,r:20,fill:`rgba(255, 255, 255, ${Math.max(0,1-Gt.ringRadius/120)*.9})`}),Gt.particles.map(m=>a.jsx("circle",{cx:m.x,cy:m.y,r:4,fill:`rgba(255, 255, 255, ${m.opacity*.8})`},m.id))]}),Ke&&a.jsxs("div",{style:{position:"absolute",inset:0,zIndex:9999,pointerEvents:"auto",background:"rgba(0,0,0,0.5)",perspective:"1200px"},children:[a.jsx("style",{children:`
                                @keyframes playCardSequence {
                                    ${Ke.finalX!==void 0?`
                                    /* Phase 1: Start at hand position (0%) */
                                    0% {
                                        transform: translate(${Ke.startX-Ke.targetX}px, ${Ke.startY-Ke.targetY}px) translate(-50%, -50%) scale(1.0) rotateY(0deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Phase 1b: Mid-rotation during move (12.5%) - CRITICAL: explicit 180deg to force rotation direction */
                                    12.5% {
                                        transform: translate(${(Ke.startX-Ke.targetX)*.5}px, ${(Ke.startY-Ke.targetY)*.5}px) translate(-50%, -50%) scale(1.5) rotateY(180deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Phase 2: Arrive at center with rotation complete (25%) */
                                    25% {
                                        transform: translate(-50%, -50%) scale(1.8) rotateY(360deg);
                                        opacity: 1;
                                        animation-timing-function: ease-out;
                                    }
                                    /* Phase 3: Hold at center (25%-80%) */
                                    80% {
                                        transform: translate(-50%, -50%) scale(2.4) rotateY(360deg);
                                        opacity: 1;
                                    }
                                    /* Phase 4: Move to board position (80%-100%) */
                                    100% {
                                        transform: translate(calc(-50% + ${Ke.finalX-Ke.targetX}px), calc(-50% + ${Ke.finalY-Ke.targetY}px)) scale(1.0) rotateY(360deg);
                                        opacity: 1;
                                    }
                                    `:`
                                    /* Spell: Move to center while rotating, then fade */
                                    0% {
                                        transform: translate(${Ke.startX-Ke.targetX}px, ${Ke.startY-Ke.targetY}px) translate(-50%, -50%) scale(1.0) rotateY(0deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Mid-rotation during move (15%) - CRITICAL: explicit 180deg */
                                    15% {
                                        transform: translate(${(Ke.startX-Ke.targetX)*.5}px, ${(Ke.startY-Ke.targetY)*.5}px) translate(-50%, -50%) scale(1.7) rotateY(180deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    30% {
                                        transform: translate(-50%, -50%) scale(2.2) rotateY(360deg);
                                        opacity: 1;
                                        animation-timing-function: ease-out;
                                    }
                                    80% {
                                        transform: translate(-50%, -50%) scale(2.4) rotateY(360deg);
                                        opacity: 1;
                                    }
                                    100% {
                                        transform: translate(-50%, -50%) scale(3.0) rotateY(360deg);
                                        opacity: 0;
                                    }
                                    `}
                                }
                                @keyframes playSpellSequence {
                                    /* Move from hand to center while rotating (0-30%) */
                                    0% {
                                        transform: translate(${Ke.startX-Ke.targetX}px, ${Ke.startY-Ke.targetY}px) translate(-50%, -50%) scale(1.0) rotateY(0deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Mid-rotation during move (15%) - CRITICAL: explicit 180deg to force rotation direction */
                                    15% {
                                        transform: translate(${(Ke.startX-Ke.targetX)*.5}px, ${(Ke.startY-Ke.targetY)*.5}px) translate(-50%, -50%) scale(1.7) rotateY(180deg);
                                        opacity: 1;
                                        filter: brightness(1);
                                        animation-timing-function: linear;
                                    }
                                    /* Arrive at center with rotation complete (30%) */
                                    30% {
                                        transform: translate(-50%, -50%) scale(2.2) rotateY(360deg);
                                        opacity: 1;
                                        filter: brightness(1);
                                        animation-timing-function: ease-out;
                                    }
                                    /* Hold at center (30%-75%) */
                                    75% {
                                        transform: translate(-50%, -50%) scale(2.4) rotateY(360deg);
                                        opacity: 1;
                                        filter: brightness(1.2);
                                    }
                                    /* Fade out (75%-100%) */
                                    100% {
                                        transform: translate(-50%, -50%) scale(3.0) rotateY(360deg);
                                        opacity: 0;
                                        filter: brightness(3);
                                    }
                                }
                                .play-card-flipper {
                                    transform-style: preserve-3d !important;
                                }
                                .play-card-front, .play-card-back {
                                    backface-visibility: hidden !important;
                                    -webkit-backface-visibility: hidden !important;
                                    position: absolute;
                                    width: 100%;
                                    height: 100%;
                                }
                                .play-card-back {
                                    transform: rotateY(180deg) translateZ(1px);
                                }
                            `}),a.jsxs("div",{className:"play-card-flipper",onAnimationEnd:Ke.onComplete,style:{position:"absolute",left:Ke.targetX,top:Ke.targetY,width:rn*p,height:bn*p,transformStyle:"preserve-3d",animation:Ke.card.type==="SPELL"?"playSpellSequence 1s forwards":"playCardSequence 0.8s forwards"},children:[a.jsx("div",{className:"play-card-front",children:a.jsx(Xi,{card:Ke.card,isOnBoard:!0,suppressPassives:!0,scale:p,style:{width:rn*p,height:bn*p,boxShadow:"0 0 50px rgba(255,215,0,0.8)"}})}),a.jsx("div",{className:"play-card-back",style:{borderRadius:12,boxShadow:"0 0 50px rgba(255,215,0,0.8)",overflow:"hidden"},children:a.jsx("img",{src:si(Ke.playerClass),alt:"Card Sleeve",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:12},onError:m=>{const v=m.target;v.style.display="none",v.parentElement&&(v.parentElement.style.background="linear-gradient(135deg, #1e3a5f 0%, #0d1b2a 50%, #1e3a5f 100%)")}})}),Ke.card.type==="SPELL"&&a.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none"},children:a.jsx(dL,{x:0,y:0})})]})]}),Fi.length>0&&Fi.map((m,v)=>a.jsx("div",{style:{position:"absolute",left:m.status==="FLY"&&m.targetX!==void 0?m.targetX:window.innerWidth/2+m.xOffset,top:m.status==="FLY"&&m.targetY!==void 0?m.targetY:window.innerHeight/2,transform:m.status==="APPEAR"?"translate(-50%, -50%) scale(1.2)":"translate(-50%, -50%) scale(0.2)",zIndex:7e3+v,pointerEvents:"none",transition:m.status==="FLY"?"all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)":"none",opacity:m.status==="FLY"?.3:1,animation:m.status==="APPEAR"?"cardAppear 0.8s ease-out":void 0},children:a.jsx(Xi,{card:m.card,scale:p,style:{width:rn*p,height:bn*p}})},v)),a.jsx("style",{children:`
                    @keyframes cardAppear {
                        0% { transform: translate(-50%, -50%) scale(0) rotate(-10deg); opacity: 0; }
                        50% { transform: translate(-50%, -50%) scale(1.3) rotate(5deg); opacity: 1; }
                        100% { transform: translate(-50%, -50%) scale(1.2) rotate(0deg); opacity: 1; }
                    }
                `}),Xl.map(m=>m.type==="BUFF"?a.jsx(aL,{x:m.x,y:m.y,atkBuff:m.atkBuff??0,hpBuff:m.hpBuff??0,onComplete:()=>Ui(v=>v.filter(b=>b.key!==m.key))},m.key):a.jsx(cL,{type:m.type,x:m.x,y:m.y,onComplete:()=>Ui(v=>v.filter(b=>b.key!==m.key)),audioSettings:Tt,scale:p},m.key)),Rt&&a.jsx(pL,{card:Rt.card,evolvedImageUrl:Rt.evolvedImageUrl,startX:Rt.startX,startY:Rt.startY,phase:Rt.phase,onPhaseChange:eI,onShake:$n,useSep:Rt.useSep,playSE:mt,scale:p,isLightMode:re}),ti&&a.jsxs("div",{style:{position:"fixed",top:"45%",left:`${340*p}px`,width:`calc(100% - ${340*p}px)`,display:"flex",justifyContent:"center",alignItems:"center",transform:"translateY(-50%)",zIndex:9e3,pointerEvents:"none",animation:"notificationFade 2.5s forwards"},children:[a.jsx("div",{style:{padding:`${20*p}px ${90*p}px`,background:"rgba(0, 0, 0, 0.75)",backdropFilter:"blur(16px)",borderTop:`${3*p}px solid ${ti==="EVOLVE_READY"?"rgba(255, 215, 0, 0.7)":"rgba(180, 0, 255, 0.7)"}`,borderBottom:`${3*p}px solid ${ti==="EVOLVE_READY"?"rgba(255, 215, 0, 0.7)":"rgba(180, 0, 255, 0.7)"}`,boxShadow:ti==="EVOLVE_READY"?`0 0 ${50*p}px rgba(255, 180, 0, 0.5), inset 0 0 ${30*p}px rgba(255, 215, 0, 0.2)`:`0 0 ${50*p}px rgba(180, 0, 255, 0.5), inset 0 0 ${30*p}px rgba(180, 0, 255, 0.2)`,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",borderRadius:`${4*p}px`},children:a.jsx("span",{style:{fontSize:`${5*p}rem`,fontWeight:"900",fontFamily:'"YuMincho", "Hiragino Mincho ProN", "MS Mincho", serif',color:"#fff",letterSpacing:`${.8*p}rem`,whiteSpace:"nowrap",textShadow:ti==="EVOLVE_READY"?`0 0 ${15*p}px rgba(255, 215, 0, 1), 0 0 ${30*p}px rgba(255, 180, 0, 0.8), ${2*p}px ${2*p}px ${4*p}px rgba(0,0,0,0.9)`:`0 0 ${15*p}px rgba(180, 0, 255, 1), 0 0 ${30*p}px rgba(140, 0, 255, 0.8), ${2*p}px ${2*p}px ${4*p}px rgba(0,0,0,0.9)`,WebkitTextStroke:ti==="EVOLVE_READY"?`${1.5*p}px #ffd700`:`${1.5*p}px #b400ff`},children:ti==="EVOLVE_READY"?"":""})}),a.jsx("style",{children:`
                            @keyframes notificationFade {
                                0% { opacity: 0; transform: translateY(-40%) scale(0.8); filter: blur(15px); }
                                10% { opacity: 1; transform: translateY(-50%) scale(1); filter: blur(0px); }
                                90% { opacity: 1; transform: translateY(-50%) scale(1); filter: blur(0px); }
                                100% { opacity: 0; transform: translateY(-60%) scale(1.15); filter: blur(20px); }
                            }
                        `})]}),Le&&g.winnerId&&a.jsx(XO,{isVictory:g.winnerId===w,loserLeaderRef:g.winnerId===w?zi:ri,onComplete:()=>{Ie(!1),Fe(!0),nt(null),$t(0),(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&x&&(console.log("[GameScreen] Disconnecting after game over (casual match)"),x.disconnect())},onPhaseChange:nt,onShakeIntensityChange:$t,scale:p}),g.winnerId&&Pe&&a.jsx(xL,{winnerId:g.winnerId,playerId:w,playerClass:(ie==null?void 0:ie.class)||"SENKA",isOnline:e==="ONLINE",isRoomMatch:n==="HOST"||n==="JOIN",myRematchRequested:jS,opponentRematchRequested:N0,battleStats:{turnCount:g.turnCount,damageDealtToOpponent:Ul.damageDealtToOpponent,damageReceivedFromOpponent:Ul.damageReceivedFromOpponent,followersDestroyed:Ul.followersDestroyed,myFollowersDestroyed:Ul.myFollowersDestroyed},selectedCardInfo:FS,onCardInfoClick:Hd,victoryReason:$S,isRankedMatch:n==="RANKED_MATCH",ratingResult:US,onRematching:i,onRematch:m=>{e==="ONLINE"?(M0(!0),N0?(x==null||x.send({type:"REMATCH_ACCEPT"}),of(m)):(x==null||x.send({type:"REMATCH_REQUEST"}),F0(m))):of(m)},onLeave:s})]})]})},L0=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},EL=L0("/leaders/azya_leader.png"),SL=L0("/leaders/senka_leader.png"),IL=L0("/leaders/yoRuka_leader.png"),TL=1280,CL=720,wL=({onSelectClass:t,onBack:e})=>{const[n,r]=D.useState(1);D.useEffect(()=>{const d=()=>{const h=window.innerWidth/TL,f=window.innerHeight/CL;r(Math.min(h,f))};return d(),window.addEventListener("resize",d),()=>window.removeEventListener("resize",d)},[]);const s=200*n,i=280*n,o=2*n,l=1.4*n,c=1.2*n,u=`${8*n}px ${16*n}px`;return a.jsxs("div",{className:"screen",style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"#1a1a2e",color:"white",position:"relative"},children:[a.jsx("button",{onClick:e,style:{position:"absolute",top:`${20*n}px`,left:`${20*n}px`,background:"#333",padding:u,fontSize:`${.9*n}rem`,border:"1px solid #555",borderRadius:6*n,color:"white",cursor:"pointer",fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s"},onMouseOver:d=>d.currentTarget.style.background="#444",onMouseOut:d=>d.currentTarget.style.background="#333",children:""}),a.jsx("h2",{style:{fontSize:`${o}rem`,marginBottom:`${1.5*n}rem`,marginTop:0,fontFamily:"Tamanegi, sans-serif"},children:" - "}),a.jsxs("div",{style:{display:"flex",gap:`${c}rem`,marginBottom:`${1*n}rem`},children:[a.jsxs("div",{onClick:()=>t("SENKA"),style:{width:s,height:i,border:"1px solid #444",borderRadius:10*n,background:"linear-gradient(180deg, #2c0b0e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:"0 4px 20px rgba(233, 69, 96, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:d=>{d.currentTarget.style.transform="scale(1.05)",d.currentTarget.style.boxShadow="0 8px 30px rgba(233, 69, 96, 0.4)"},onMouseOut:d=>{d.currentTarget.style.transform="scale(1)",d.currentTarget.style.boxShadow="0 4px 20px rgba(233, 69, 96, 0.2)"},children:[a.jsx("img",{src:SL,alt:"Senka",style:{width:"100%",height:"75%",objectFit:"cover"}}),a.jsx("div",{style:{padding:`${8*n}px`,display:"flex",flexDirection:"column",alignItems:"center",width:"100%",justifyContent:"center",flex:1},children:a.jsx("h3",{style:{fontSize:`${l}rem`,color:"#e94560",margin:0,fontFamily:"Tamanegi, sans-serif"},children:""})})]}),a.jsxs("div",{onClick:()=>t("AJA"),style:{width:s,height:i,border:"1px solid #444",borderRadius:10*n,background:"linear-gradient(180deg, #0f1c2e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:"0 4px 20px rgba(69, 162, 233, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:d=>{d.currentTarget.style.transform="scale(1.05)",d.currentTarget.style.boxShadow="0 8px 30px rgba(69, 162, 233, 0.4)"},onMouseOut:d=>{d.currentTarget.style.transform="scale(1)",d.currentTarget.style.boxShadow="0 4px 20px rgba(69, 162, 233, 0.2)"},children:[a.jsx("img",{src:EL,alt:"Azya",style:{width:"100%",height:"75%",objectFit:"cover",objectPosition:"center top"}}),a.jsx("div",{style:{padding:`${8*n}px`,display:"flex",flexDirection:"column",alignItems:"center",width:"100%",justifyContent:"center",flex:1},children:a.jsx("h3",{style:{fontSize:`${l}rem`,color:"#45a2e9",margin:0,fontFamily:"Tamanegi, sans-serif"},children:""})})]}),a.jsxs("div",{onClick:()=>t("YORUKA"),style:{width:s,height:i,border:"1px solid #444",borderRadius:10*n,background:"linear-gradient(180deg, #1a0f2e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:"0 4px 20px rgba(168, 85, 247, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:d=>{d.currentTarget.style.transform="scale(1.05)",d.currentTarget.style.boxShadow="0 8px 30px rgba(168, 85, 247, 0.4)"},onMouseOut:d=>{d.currentTarget.style.transform="scale(1)",d.currentTarget.style.boxShadow="0 4px 20px rgba(168, 85, 247, 0.2)"},children:[a.jsx("img",{src:IL,alt:"Yoruka",style:{width:"100%",height:"75%",objectFit:"cover"}}),a.jsx("div",{style:{padding:`${8*n}px`,display:"flex",flexDirection:"column",alignItems:"center",width:"100%",justifyContent:"center",flex:1},children:a.jsx("h3",{style:{fontSize:`${l}rem`,color:"#a855f7",margin:0,fontFamily:"Tamanegi, sans-serif"},children:"Y"})})]})]})]})},kL=1280,AL=720,RL={SENKA:{primary:"#e94560",gradient:"linear-gradient(135deg, #2c0b0e 0%, #1a1a2e 100%)",shadow:"rgba(233, 69, 96, 0.3)"},AJA:{primary:"#45a2e9",gradient:"linear-gradient(135deg, #0f1c2e 0%, #1a1a2e 100%)",shadow:"rgba(69, 162, 233, 0.3)"},YORUKA:{primary:"#a855f7",gradient:"linear-gradient(135deg, #1a0f2e 0%, #1a1a2e 100%)",shadow:"rgba(168, 85, 247, 0.3)"}},PL={SENKA:"",AJA:"",YORUKA:"Y"},OL=({classType:t,onSelectCard:e,onBack:n})=>{const[r,s]=D.useState(1);D.useEffect(()=>{const k=()=>{const B=window.innerWidth/kL,x=window.innerHeight/AL;s(Math.min(B,x))};return k(),window.addEventListener("resize",k),()=>window.removeEventListener("resize",k)},[]);const l=(k=>k==="SENKA"?PS:k==="AJA"?OS:LS)(t).filter(k=>!k.cardId.startsWith("TOKEN_")).map(k=>({card:Jn.find(B=>B.id===k.cardId),count:k.count})).filter(k=>k.card),c=RL[t],u=PL[t],d=140*r,h=200*r,f=1*r,_=2*r,R=`${8*r}px ${16*r}px`;return a.jsxs("div",{style:{minHeight:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",background:c.gradient,color:"white",position:"relative",paddingBottom:`${40*r}px`},children:[a.jsx("button",{onClick:n,style:{position:"fixed",top:`${20*r}px`,left:`${20*r}px`,background:"rgba(0, 0, 0, 0.5)",padding:R,fontSize:`${.9*r}rem`,border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:6*r,color:"white",cursor:"pointer",fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s",zIndex:100},onMouseOver:k=>k.currentTarget.style.background="rgba(0, 0, 0, 0.7)",onMouseOut:k=>k.currentTarget.style.background="rgba(0, 0, 0, 0.5)",children:""}),a.jsxs("h2",{style:{fontSize:`${_}rem`,marginTop:`${80*r}px`,marginBottom:`${20*r}px`,fontFamily:"Tamanegi, sans-serif",color:c.primary,textShadow:`0 0 20px ${c.shadow}`},children:[u," - "]}),a.jsx("div",{style:{display:"grid",gridTemplateColumns:`repeat(auto-fill, minmax(${d}px, 1fr))`,gap:`${f}rem`,maxWidth:`${1100*r}px`,width:"90%",padding:`${20*r}px`,justifyItems:"center"},children:l.map(({card:k,count:B})=>a.jsxs("div",{onClick:()=>e(k.id),style:{width:d,height:h,border:`2px solid ${c.primary}`,borderRadius:8*r,background:"linear-gradient(180deg, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.9) 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 0.2s",boxShadow:`0 4px 15px ${c.shadow}`,position:"relative",overflow:"hidden"},onMouseOver:x=>{x.currentTarget.style.transform="translateY(-5px) scale(1.05)",x.currentTarget.style.boxShadow=`0 8px 25px ${c.shadow}`},onMouseOut:x=>{x.currentTarget.style.transform="translateY(0) scale(1)",x.currentTarget.style.boxShadow=`0 4px 15px ${c.shadow}`},children:[a.jsxs("div",{style:{padding:`${10*r}px`,textAlign:"center",flex:1,display:"flex",flexDirection:"column",justifyContent:"center",width:"100%"},children:[a.jsx("h3",{style:{fontSize:`${.9*r}rem`,margin:`0 0 ${8*r}px 0`,fontFamily:"Tamanegi, sans-serif",color:c.primary},children:k.name}),a.jsx("p",{style:{fontSize:`${.7*r}rem`,color:"#aaa",margin:0,fontFamily:"Tamanegi, sans-serif"},children:k.type==="FOLLOWER"?"":""}),k.type==="FOLLOWER"&&a.jsxs("p",{style:{fontSize:`${.8*r}rem`,color:"#fff",margin:`${5*r}px 0 0 0`,fontFamily:"Tamanegi, sans-serif"},children:[k.attack,"/",k.health]}),a.jsxs("p",{style:{fontSize:`${.7*r}rem`,color:"#ffcc00",margin:`${5*r}px 0 0 0`,fontFamily:"Tamanegi, sans-serif",fontWeight:"bold"},children:[": ",k.cost]})]}),a.jsx("div",{style:{position:"absolute",bottom:`${8*r}px`,right:`${8*r}px`,background:"rgba(0, 0, 0, 0.8)",color:"white",borderRadius:50,width:`${28*r}px`,height:`${28*r}px`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${.85*r}rem`,fontWeight:"bold",fontFamily:"Tamanegi, sans-serif",border:`2px solid ${c.primary}`,boxShadow:`0 0 10px ${c.shadow}`},children:B})]},k.id))}),a.jsxs("div",{style:{marginTop:`${20*r}px`,fontSize:`${.9*r}rem`,color:"#aaa",fontFamily:"Tamanegi, sans-serif"},children:[" ",l.length," "]})]})},LL=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},DL=1280,ML=720,NL=({cardId:t,onOpenRelatedCard:e,onBack:n})=>{const[r,s]=D.useState(1);D.useEffect(()=>{const _=()=>{const R=window.innerWidth/DL,k=window.innerHeight/ML;s(Math.min(R,k))};return _(),window.addEventListener("resize",_),()=>window.removeEventListener("resize",_)},[]);const i=Jn.find(_=>_.id===t);if(!i)return a.jsx("div",{style:{minHeight:"100dvh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",fontFamily:"Tamanegi, sans-serif",fontSize:`${1.5*r}rem`},children:""});const o=(_,R)=>LL(_||R),l=o(i.imageUrl,`/cards/${i.id}.png`),c=i.type==="FOLLOWER"?o(i.evolvedImageUrl,`/cards/${i.id}_evolved.png`):null,u=200*r,d=280*r,h=2*r;return a.jsxs("div",{style:{minHeight:"100dvh",display:"flex",flexDirection:"column",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #1a1a2e 100%)",color:"white",fontFamily:"Tamanegi, sans-serif",overflow:"auto",paddingBottom:`${40*r}px`},children:[a.jsx("div",{style:{position:"sticky",top:0,left:0,padding:`${20*r}px`,zIndex:100,background:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(10px)"},children:a.jsx("button",{onClick:n,style:{background:"rgba(255, 255, 255, 0.1)",padding:`${10*r}px ${20*r}px`,fontSize:`${1*r}rem`,border:"1px solid rgba(255, 255, 255, 0.3)",borderRadius:`${8*r}px`,color:"white",cursor:"pointer",fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s"},onMouseOver:_=>_.currentTarget.style.background="rgba(255, 255, 255, 0.2)",onMouseOut:_=>_.currentTarget.style.background="rgba(255, 255, 255, 0.1)",children:""})}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${30*r}px`,padding:`${20*r}px`,flex:1},children:[a.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:`${h}rem`,flexWrap:"wrap"},children:i.type==="FOLLOWER"?a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{width:u,height:d,border:"2px solid rgba(255, 255, 255, 0.3)",borderRadius:`${12*r}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.5)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:l,alt:`${i.name} `,style:{width:"100%",height:"100%",objectFit:"cover"}})}),a.jsx("div",{style:{width:u,height:d,border:"2px solid rgba(255, 215, 0, 0.5)",borderRadius:`${12*r}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(255, 215, 0, 0.3)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:c||l,alt:`${i.name} `,style:{width:"100%",height:"100%",objectFit:"cover"}})})]}):a.jsx("div",{style:{width:u,height:d,border:"2px solid rgba(138, 43, 226, 0.5)",borderRadius:`${12*r}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(138, 43, 226, 0.3)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:l,alt:i.name,style:{width:"100%",height:"100%",objectFit:"cover"}})})}),a.jsxs("div",{style:{maxWidth:`${600*r}px`,width:"90%",background:"rgba(0, 0, 0, 0.5)",padding:`${25*r}px`,borderRadius:`${12*r}px`,border:"1px solid rgba(255, 255, 255, 0.2)",display:"flex",flexDirection:"column",gap:`${15*r}px`},children:[a.jsx("h2",{style:{fontSize:`${1.8*r}rem`,fontWeight:"bold",margin:0,color:"#fff",textAlign:"center"},children:i.name}),a.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:`${20*r}px`,fontSize:`${1.2*r}rem`,flexWrap:"wrap"},children:[a.jsxs("div",{style:{color:"#ffd700"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:i.cost})]}),i.type==="FOLLOWER"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{color:"#ff6b6b"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:i.attack})]}),a.jsxs("div",{style:{color:"#4ecdc4"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:i.health})]})]})]}),a.jsx("div",{style:{height:"1px",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)"}}),a.jsxs("div",{children:[a.jsx("h3",{style:{fontSize:`${1.1*r}rem`,margin:`0 0 ${8*r}px 0`,color:"#aaa"},children:""}),a.jsx("p",{style:{fontSize:`${1*r}rem`,margin:0,whiteSpace:"pre-wrap",lineHeight:1.6,color:"#fff"},children:i.description})]}),i.flavorText&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{height:"1px",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)"}}),a.jsxs("div",{children:[a.jsx("h3",{style:{fontSize:`${1.1*r}rem`,margin:`0 0 ${8*r}px 0`,color:"#aaa"},children:""}),a.jsx("p",{style:{fontSize:`${.9*r}rem`,margin:0,fontStyle:"italic",opacity:.7,lineHeight:1.6,whiteSpace:"pre-wrap",color:"#ccc"},children:i.flavorText})]})]}),i.relatedCards&&i.relatedCards.length>0&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{height:"1px",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)"}}),a.jsx("div",{style:{display:"flex",justifyContent:"center"},children:a.jsxs("button",{onClick:()=>e(t),style:{padding:`${.8*r}rem ${1.5*r}rem`,background:"#4ade80",color:"white",border:"none",borderRadius:`${8*r}px`,fontSize:`${1*r}rem`,fontWeight:"bold",fontFamily:"Tamanegi, sans-serif",cursor:"pointer",transition:"all 0.2s",boxShadow:"0 4px 15px rgba(74, 222, 128, 0.3)"},onMouseOver:_=>{_.currentTarget.style.background="#22c55e",_.currentTarget.style.transform="translateY(-2px)",_.currentTarget.style.boxShadow="0 6px 20px rgba(74, 222, 128, 0.4)"},onMouseOut:_=>{_.currentTarget.style.background="#4ade80",_.currentTarget.style.transform="translateY(0)",_.currentTarget.style.boxShadow="0 4px 15px rgba(74, 222, 128, 0.3)"},children:[" (",i.relatedCards.length,")"]})})]})]})]})]})},jL=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},$L=1280,FL=720,UL=({parentCardId:t,relatedCardIds:e,onBack:n})=>{const[r,s]=D.useState(1),[i,o]=D.useState(0);D.useEffect(()=>{const T=()=>{const p=window.innerWidth/$L,$=window.innerHeight/FL;s(Math.min(p,$))};return T(),window.addEventListener("resize",T),()=>window.removeEventListener("resize",T)},[]);const l=e[i],c=Jn.find(T=>T.id===l),u=()=>{o(T=>T>0?T-1:e.length-1)},d=()=>{o(T=>T<e.length-1?T+1:0)};if(!c)return a.jsx("div",{style:{minHeight:"100dvh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",fontFamily:"Tamanegi, sans-serif",fontSize:`${1.5*r}rem`},children:""});const h=(T,p)=>jL(T||p),f=h(c.imageUrl,`/cards/${c.id}.png`),_=c.type==="FOLLOWER"?h(c.evolvedImageUrl,`/cards/${c.id}_evolved.png`):null,R=200*r,k=280*r,B=2*r,x="linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #1a1a2e 100%)",E={fontSize:`${3*r}rem`,background:"rgba(0, 0, 0, 0.5)",padding:`${1*r}rem`,borderRadius:`${8*r}px`,cursor:"pointer",border:"1px solid rgba(255, 255, 255, 0.2)",color:"white",transition:"all 0.2s",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",width:`${60*r}px`,height:`${60*r}px`};return a.jsxs("div",{style:{minHeight:"100dvh",display:"flex",flexDirection:"column",background:x,color:"white",fontFamily:"Tamanegi, sans-serif",overflow:"auto",paddingBottom:`${40*r}px`},children:[a.jsxs("div",{style:{position:"sticky",top:0,left:0,padding:`${20*r}px`,zIndex:100,background:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(10px)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[a.jsx("button",{onClick:n,style:{background:"rgba(255, 255, 255, 0.1)",padding:`${10*r}px ${20*r}px`,fontSize:`${1*r}rem`,border:"1px solid rgba(255, 255, 255, 0.3)",borderRadius:`${8*r}px`,color:"white",cursor:"pointer",fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s"},onMouseOver:T=>T.currentTarget.style.background="rgba(255, 255, 255, 0.2)",onMouseOut:T=>T.currentTarget.style.background="rgba(255, 255, 255, 0.1)",children:""}),a.jsxs("div",{style:{fontSize:`${1.2*r}rem`,opacity:.8,fontWeight:"bold"},children:[i+1," / ",e.length]})]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${30*r}px`,padding:`${20*r}px`,flex:1},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:`${20*r}px`,flexWrap:"wrap"},children:[a.jsx("button",{onClick:u,style:E,onMouseOver:T=>T.currentTarget.style.background="rgba(0, 0, 0, 0.7)",onMouseOut:T=>T.currentTarget.style.background="rgba(0, 0, 0, 0.5)",children:"<"}),a.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:`${B}rem`,flexWrap:"wrap"},children:c.type==="FOLLOWER"?a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{width:R,height:k,border:"2px solid rgba(255, 255, 255, 0.3)",borderRadius:`${12*r}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.5)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:f,alt:`${c.name} `,style:{width:"100%",height:"100%",objectFit:"cover"}})}),a.jsx("div",{style:{width:R,height:k,border:"2px solid rgba(255, 215, 0, 0.5)",borderRadius:`${12*r}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(255, 215, 0, 0.3)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:_||f,alt:`${c.name} `,style:{width:"100%",height:"100%",objectFit:"cover"}})})]}):a.jsx("div",{style:{width:R,height:k,border:"2px solid rgba(138, 43, 226, 0.5)",borderRadius:`${12*r}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(138, 43, 226, 0.3)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:f,alt:c.name,style:{width:"100%",height:"100%",objectFit:"cover"}})})}),a.jsx("button",{onClick:d,style:E,onMouseOver:T=>T.currentTarget.style.background="rgba(0, 0, 0, 0.7)",onMouseOut:T=>T.currentTarget.style.background="rgba(0, 0, 0, 0.5)",children:">"})]}),a.jsxs("div",{style:{maxWidth:`${600*r}px`,width:"90%",background:"rgba(0, 0, 0, 0.5)",padding:`${25*r}px`,borderRadius:`${12*r}px`,border:"1px solid rgba(255, 255, 255, 0.2)",display:"flex",flexDirection:"column",gap:`${15*r}px`},children:[a.jsx("h2",{style:{fontSize:`${1.8*r}rem`,fontWeight:"bold",margin:0,color:"#fff",textAlign:"center"},children:c.name}),a.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:`${20*r}px`,fontSize:`${1.2*r}rem`,flexWrap:"wrap"},children:[a.jsxs("div",{style:{color:"#ffd700"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:c.cost})]}),c.type==="FOLLOWER"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{color:"#ff6b6b"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:c.attack})]}),a.jsxs("div",{style:{color:"#4ecdc4"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:c.health})]})]})]}),a.jsx("div",{style:{height:"1px",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)"}}),a.jsxs("div",{children:[a.jsx("h3",{style:{fontSize:`${1.1*r}rem`,margin:`0 0 ${8*r}px 0`,color:"#aaa"},children:""}),a.jsx("p",{style:{fontSize:`${1*r}rem`,margin:0,whiteSpace:"pre-wrap",lineHeight:1.6,color:"#fff"},children:c.description})]}),c.flavorText&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{height:"1px",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)"}}),a.jsxs("div",{children:[a.jsx("h3",{style:{fontSize:`${1.1*r}rem`,margin:`0 0 ${8*r}px 0`,color:"#aaa"},children:""}),a.jsx("p",{style:{fontSize:`${.9*r}rem`,margin:0,fontStyle:"italic",opacity:.7,lineHeight:1.6,whiteSpace:"pre-wrap",color:"#ccc"},children:c.flavorText})]})]})]})]})]})},BL=async()=>{const t=await RR($E);return t.user,t.user.uid},zL=t=>NR($E,e=>{t(e)}),HL=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},WL=HL("/bgm/tenfubu.mp3"),Dc={bgm:.3,se:.5,voice:.5,bgmEnabled:!0,seEnabled:!0},GL=()=>{try{const t=localStorage.getItem("audioSettings");if(t){const e=JSON.parse(t);if(e.enabled!==void 0){const{enabled:n,...r}=e;return{...Dc,...r,bgmEnabled:n,seEnabled:n}}return{...Dc,...e}}return Dc}catch{return Dc}},VL=()=>{const[t,e]=D.useState(!1);return D.useEffect(()=>{const n=()=>{const r="ontouchstart"in window||navigator.maxTouchPoints>0,s=window.innerHeight>window.innerWidth;e(r&&s)};return n(),window.addEventListener("resize",n),window.addEventListener("orientationchange",n),()=>{window.removeEventListener("resize",n),window.removeEventListener("orientationchange",n)}},[]),t};function YL(){const[t,e]=D.useState("TITLE"),[n,r]=D.useState("SENKA"),[s,i]=D.useState("CPU"),[o,l]=D.useState(""),[c,u]=D.useState(void 0),[d,h]=D.useState("NORMAL"),[f,_]=D.useState(null),[R,k]=D.useState(!0),[B,x]=D.useState(()=>{const ue=localStorage.getItem("timerEnabled");return ue!==null?JSON.parse(ue):!0}),[E,T]=D.useState(()=>localStorage.getItem("playerName")||""),[p,$]=D.useState(void 0),[C,re]=D.useState(void 0),Y=VL(),K=D.useRef(null),[ce,me]=D.useState(!1),[Se,fe]=D.useState(GL),[te,w]=D.useState(null),[S,A]=D.useState(null),[y,g]=D.useState([]);D.useEffect(()=>{const ue=zL(async Pe=>{if(Pe){_(Pe.uid);try{await Qv(Pe.uid,E||"")}catch(Fe){console.error("Failed to create player data:",Fe)}}else try{const Fe=await BL();_(Fe),await Qv(Fe,E||"")}catch(Fe){console.error("Failed to sign in:",Fe)}k(!1)});return()=>ue()},[]),D.useEffect(()=>{localStorage.setItem("audioSettings",JSON.stringify(Se))},[Se]);const I=D.useCallback(ue=>{fe(Pe=>({...Pe,...ue}))},[]),P=D.useCallback((ue,Pe)=>{K.current=ue,me(!0),Pe&&u(Pe),e("GAME")},[]),L=D.useCallback((ue,Pe,Fe,je,nt)=>{K.current=ue,me(!0),u(Pe),$(je),re(nt),e("GAME")},[]),X=D.useCallback(ue=>{K.current&&(K.current.disconnect(),K.current=null),me(!1),u(void 0),$(void 0),re(void 0),r(ue),e("MATCHMAKING")},[]),F=D.useRef(null),ye=D.useRef(!1);D.useEffect(()=>{const ue=new Audio(WL);return ue.loop=!0,ue.volume=Se.bgmEnabled?Se.bgm:0,F.current=ue,ye.current=!0,()=>{ue.pause(),ue.src=""}},[]),D.useEffect(()=>{const ue=F.current;!ue||!ye.current||(ue.volume=Se.bgmEnabled?Se.bgm:0,Se.bgmEnabled?ue.paused&&(t==="TITLE"||t==="CLASS_SELECT")&&ue.play().catch(()=>{}):ue.pause())},[Se.bgm,Se.bgmEnabled,t]),D.useEffect(()=>{const ue=F.current;ue&&(t==="TITLE"||t==="CLASS_SELECT"||t==="LOBBY"?ue.paused&&Se.bgmEnabled&&ue.play().catch(()=>{}):(ue.pause(),ue.currentTime=0))},[t,Se.bgmEnabled]),D.useEffect(()=>{const ue=()=>{const Pe=F.current;Pe&&Pe.paused&&Se.bgmEnabled&&(t==="TITLE"||t==="CLASS_SELECT"||t==="LOBBY")&&Pe.play().catch(()=>{})};return document.addEventListener("click",ue),()=>document.removeEventListener("click",ue)},[t,Se.bgmEnabled]);const Ae=D.useCallback((ue,Pe)=>{i(ue),Pe&&l(Pe),e("CLASS_SELECT")},[]),Re=D.useCallback(ue=>{r(ue),e(s==="CPU"?"GAME":s==="CASUAL_MATCH"||s==="RANKED_MATCH"?"MATCHMAKING":"LOBBY")},[s]),Z=D.useCallback(()=>{K.current&&(K.current.disconnect(),K.current=null),me(!1),e("TITLE"),l(""),i("CPU"),u(void 0),$(void 0),re(void 0),w(null),A(null),g([])},[]),V=D.useCallback(()=>{e("GALLERY_CLASS_SELECT")},[]),Le=D.useCallback(ue=>{w(ue),e("GALLERY_CARD_LIST")},[]),Ie=D.useCallback(ue=>{A(ue),e("GALLERY_CARD_DETAIL")},[]),Ge=D.useCallback(ue=>{const Pe=Jn.find(Fe=>Fe.id===ue);Pe&&Pe.relatedCards&&Pe.relatedCards.length>0&&(A(ue),g(Pe.relatedCards),e("GALLERY_RELATED_CARD"))},[]),Ce=D.useCallback(()=>{w(null),e("GALLERY_CLASS_SELECT")},[]),$e=D.useCallback(()=>{A(null),e("GALLERY_CARD_LIST")},[]),gt=D.useCallback(()=>{g([]),e("GALLERY_CARD_DETAIL")},[]);return a.jsxs("div",{className:"app-container",children:[Y&&a.jsxs("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100dvh",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:99999,color:"white",textAlign:"center",padding:20},children:[a.jsx("div",{style:{fontSize:"4rem",marginBottom:20,animation:"rotatePhone 2s ease-in-out infinite"},children:""}),a.jsx("h2",{style:{fontSize:"1.5rem",fontWeight:"bold",marginBottom:10,textShadow:"0 2px 4px rgba(0,0,0,0.5)"},children:""}),a.jsx("p",{style:{fontSize:"1rem",opacity:.8,maxWidth:280},children:""}),a.jsx("style",{children:`
                        @keyframes rotatePhone {
                            0%, 100% { transform: rotate(0deg); }
                            25% { transform: rotate(-30deg); }
                            75% { transform: rotate(30deg); }
                        }
                    `})]}),t==="TITLE"&&a.jsx(W2,{onStartConfig:Ae,audioSettings:Se,onAudioSettingsChange:I,playerId:f,onGalleryStart:V}),t==="CLASS_SELECT"&&a.jsx(lO,{onSelectClass:Re,onBack:Z,gameMode:s,aiDifficulty:d,onDifficultyChange:h,playerName:E,onPlayerNameChange:ue=>{T(ue),localStorage.setItem("playerName",ue)},timerEnabled:B,onTimerEnabledChange:ue=>{x(ue),localStorage.setItem("timerEnabled",JSON.stringify(ue))},playerId:f}),t==="LOBBY"&&a.jsx(OO,{gameMode:s,targetRoomId:o,playerClass:n,onGameStart:P,onBack:Z}),t==="MATCHMAKING"&&a.jsx(NO,{matchType:s==="CASUAL_MATCH"?"casual":"ranked",playerClass:n,playerName:E||"",playerId:f,onGameStart:L,onCancel:Z}),t==="GAME"&&a.jsx(bL,{playerClass:n,opponentType:s==="CPU"?"CPU":"ONLINE",gameMode:s,targetRoomId:o,onLeave:Z,onRematching:X,networkAdapter:K.current,networkConnected:ce,opponentClass:c,aiDifficulty:d,playerName:E||"",timerEnabled:s==="CASUAL_MATCH"||s==="RANKED_MATCH"?!0:B,playerId:f,opponentPlayerId:p,opponentRating:C}),t==="GALLERY_CLASS_SELECT"&&a.jsx(wL,{onSelectClass:Le,onBack:Z}),t==="GALLERY_CARD_LIST"&&te&&a.jsx(OL,{classType:te,onSelectCard:Ie,onBack:Ce}),t==="GALLERY_CARD_DETAIL"&&S&&a.jsx(NL,{cardId:S,onOpenRelatedCard:Ge,onBack:$e}),t==="GALLERY_RELATED_CARD"&&S&&a.jsx(UL,{parentCardId:S,relatedCardIds:y,onBack:gt})]})}fh.createRoot(document.getElementById("root")).render(a.jsx(YL,{}));
