var RE=Object.defineProperty;var OE=t=>{throw TypeError(t)};var PE=(t,e,n)=>e in t?RE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Zt=(t,e,n)=>PE(t,typeof e!="symbol"?e+"":e,n);var So=(t,e,n)=>e.has(t)?OE("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n);function LE(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in t)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function by(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Sy={exports:{}},ru={},Cy={exports:{}},st={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ja=Symbol.for("react.element"),DE=Symbol.for("react.portal"),ME=Symbol.for("react.fragment"),NE=Symbol.for("react.strict_mode"),jE=Symbol.for("react.profiler"),FE=Symbol.for("react.provider"),$E=Symbol.for("react.context"),BE=Symbol.for("react.forward_ref"),UE=Symbol.for("react.suspense"),zE=Symbol.for("react.memo"),HE=Symbol.for("react.lazy"),eg=Symbol.iterator;function WE(t){return t===null||typeof t!="object"?null:(t=eg&&t[eg]||t["@@iterator"],typeof t=="function"?t:null)}var Ty={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Iy=Object.assign,ky={};function so(t,e,n){this.props=t,this.context=e,this.refs=ky,this.updater=n||Ty}so.prototype.isReactComponent={};so.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};so.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function wy(){}wy.prototype=so.prototype;function Ip(t,e,n){this.props=t,this.context=e,this.refs=ky,this.updater=n||Ty}var kp=Ip.prototype=new wy;kp.constructor=Ip;Iy(kp,so.prototype);kp.isPureReactComponent=!0;var tg=Array.isArray,Ay=Object.prototype.hasOwnProperty,wp={current:null},Ry={key:!0,ref:!0,__self:!0,__source:!0};function Oy(t,e,n){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)Ay.call(e,r)&&!Ry.hasOwnProperty(r)&&(s[r]=e[r]);var a=arguments.length-2;if(a===1)s.children=n;else if(1<a){for(var c=Array(a),u=0;u<a;u++)c[u]=arguments[u+2];s.children=c}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)s[r]===void 0&&(s[r]=a[r]);return{$$typeof:ja,type:t,key:i,ref:o,props:s,_owner:wp.current}}function GE(t,e){return{$$typeof:ja,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Ap(t){return typeof t=="object"&&t!==null&&t.$$typeof===ja}function VE(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var ng=/\/+/g;function pd(t,e){return typeof t=="object"&&t!==null&&t.key!=null?VE(""+t.key):e.toString(36)}function Gl(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case ja:case DE:o=!0}}if(o)return o=t,s=s(o),t=r===""?"."+pd(o,0):r,tg(s)?(n="",t!=null&&(n=t.replace(ng,"$&/")+"/"),Gl(s,e,n,"",function(u){return u})):s!=null&&(Ap(s)&&(s=GE(s,n+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(ng,"$&/")+"/")+t)),e.push(s)),1;if(o=0,r=r===""?".":r+":",tg(t))for(var a=0;a<t.length;a++){i=t[a];var c=r+pd(i,a);o+=Gl(i,e,n,c,s)}else if(c=WE(t),typeof c=="function")for(t=c.call(t),a=0;!(i=t.next()).done;)i=i.value,c=r+pd(i,a++),o+=Gl(i,e,n,c,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function xl(t,e,n){if(t==null)return t;var r=[],s=0;return Gl(t,r,"","",function(i){return e.call(n,i,s++)}),r}function YE(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var bn={current:null},Vl={transition:null},KE={ReactCurrentDispatcher:bn,ReactCurrentBatchConfig:Vl,ReactCurrentOwner:wp};function Py(){throw Error("act(...) is not supported in production builds of React.")}st.Children={map:xl,forEach:function(t,e,n){xl(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return xl(t,function(){e++}),e},toArray:function(t){return xl(t,function(e){return e})||[]},only:function(t){if(!Ap(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};st.Component=so;st.Fragment=ME;st.Profiler=jE;st.PureComponent=Ip;st.StrictMode=NE;st.Suspense=UE;st.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=KE;st.act=Py;st.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=Iy({},t.props),s=t.key,i=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=wp.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(c in e)Ay.call(e,c)&&!Ry.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){a=Array(c);for(var u=0;u<c;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:ja,type:t.type,key:s,ref:i,props:r,_owner:o}};st.createContext=function(t){return t={$$typeof:$E,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:FE,_context:t},t.Consumer=t};st.createElement=Oy;st.createFactory=function(t){var e=Oy.bind(null,t);return e.type=t,e};st.createRef=function(){return{current:null}};st.forwardRef=function(t){return{$$typeof:BE,render:t}};st.isValidElement=Ap;st.lazy=function(t){return{$$typeof:HE,_payload:{_status:-1,_result:t},_init:YE}};st.memo=function(t,e){return{$$typeof:zE,type:t,compare:e===void 0?null:e}};st.startTransition=function(t){var e=Vl.transition;Vl.transition={};try{t()}finally{Vl.transition=e}};st.unstable_act=Py;st.useCallback=function(t,e){return bn.current.useCallback(t,e)};st.useContext=function(t){return bn.current.useContext(t)};st.useDebugValue=function(){};st.useDeferredValue=function(t){return bn.current.useDeferredValue(t)};st.useEffect=function(t,e){return bn.current.useEffect(t,e)};st.useId=function(){return bn.current.useId()};st.useImperativeHandle=function(t,e,n){return bn.current.useImperativeHandle(t,e,n)};st.useInsertionEffect=function(t,e){return bn.current.useInsertionEffect(t,e)};st.useLayoutEffect=function(t,e){return bn.current.useLayoutEffect(t,e)};st.useMemo=function(t,e){return bn.current.useMemo(t,e)};st.useReducer=function(t,e,n){return bn.current.useReducer(t,e,n)};st.useRef=function(t){return bn.current.useRef(t)};st.useState=function(t){return bn.current.useState(t)};st.useSyncExternalStore=function(t,e,n){return bn.current.useSyncExternalStore(t,e,n)};st.useTransition=function(){return bn.current.useTransition()};st.version="18.3.1";Cy.exports=st;var U=Cy.exports;const D=by(U);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var XE=U,QE=Symbol.for("react.element"),JE=Symbol.for("react.fragment"),qE=Object.prototype.hasOwnProperty,ZE=XE.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,eb={key:!0,ref:!0,__self:!0,__source:!0};function Ly(t,e,n){var r,s={},i=null,o=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)qE.call(e,r)&&!eb.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:QE,type:t,key:i,ref:o,props:s,_owner:ZE.current}}ru.Fragment=JE;ru.jsx=Ly;ru.jsxs=Ly;Sy.exports=ru;var l=Sy.exports,ef={},Dy={exports:{}},Bn={},My={exports:{}},Ny={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(x,v){var T=x.length;x.push(v);e:for(;0<T;){var w=T-1>>>1,O=x[w];if(0<s(O,v))x[w]=v,x[T]=O,T=w;else break e}}function n(x){return x.length===0?null:x[0]}function r(x){if(x.length===0)return null;var v=x[0],T=x.pop();if(T!==v){x[0]=T;e:for(var w=0,O=x.length,q=O>>>1;w<q;){var j=2*(w+1)-1,ye=x[j],Ae=j+1,we=x[Ae];if(0>s(ye,T))Ae<O&&0>s(we,ye)?(x[w]=we,x[Ae]=T,w=Ae):(x[w]=ye,x[j]=T,w=j);else if(Ae<O&&0>s(we,T))x[w]=we,x[Ae]=T,w=Ae;else break e}}return v}function s(x,v){var T=x.sortIndex-v.sortIndex;return T!==0?T:x.id-v.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var c=[],u=[],p=1,h=null,f=3,m=!1,b=!1,R=!1,W=typeof setTimeout=="function"?setTimeout:null,d=typeof clearTimeout=="function"?clearTimeout:null,I=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function S(x){for(var v=n(u);v!==null;){if(v.callback===null)r(u);else if(v.startTime<=x)r(u),v.sortIndex=v.expirationTime,e(c,v);else break;v=n(u)}}function k(x){if(R=!1,S(x),!b)if(n(c)!==null)b=!0,y($);else{var v=n(u);v!==null&&C(k,v.startTime-x)}}function $(x,v){b=!1,R&&(R=!1,d(J),J=-1),m=!0;var T=f;try{for(S(v),h=n(c);h!==null&&(!(h.expirationTime>v)||x&&!ke());){var w=h.callback;if(typeof w=="function"){h.callback=null,f=h.priorityLevel;var O=w(h.expirationTime<=v);v=t.unstable_now(),typeof O=="function"?h.callback=O:h===n(c)&&r(c),S(v)}else r(c);h=n(c)}if(h!==null)var q=!0;else{var j=n(u);j!==null&&C(k,j.startTime-v),q=!1}return q}finally{h=null,f=T,m=!1}}var B=!1,te=null,J=-1,me=5,he=-1;function ke(){return!(t.unstable_now()-he<me)}function L(){if(te!==null){var x=t.unstable_now();he=x;var v=!0;try{v=te(!0,x)}finally{v?F():(B=!1,te=null)}}else B=!1}var F;if(typeof I=="function")F=function(){I(L)};else if(typeof MessageChannel<"u"){var fe=new MessageChannel,ie=fe.port2;fe.port1.onmessage=L,F=function(){ie.postMessage(null)}}else F=function(){W(L,0)};function y(x){te=x,B||(B=!0,F())}function C(x,v){J=W(function(){x(t.unstable_now())},v)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(x){x.callback=null},t.unstable_continueExecution=function(){b||m||(b=!0,y($))},t.unstable_forceFrameRate=function(x){0>x||125<x?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):me=0<x?Math.floor(1e3/x):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(x){switch(f){case 1:case 2:case 3:var v=3;break;default:v=f}var T=f;f=v;try{return x()}finally{f=T}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(x,v){switch(x){case 1:case 2:case 3:case 4:case 5:break;default:x=3}var T=f;f=x;try{return v()}finally{f=T}},t.unstable_scheduleCallback=function(x,v,T){var w=t.unstable_now();switch(typeof T=="object"&&T!==null?(T=T.delay,T=typeof T=="number"&&0<T?w+T:w):T=w,x){case 1:var O=-1;break;case 2:O=250;break;case 5:O=1073741823;break;case 4:O=1e4;break;default:O=5e3}return O=T+O,x={id:p++,callback:v,priorityLevel:x,startTime:T,expirationTime:O,sortIndex:-1},T>w?(x.sortIndex=T,e(u,x),n(c)===null&&x===n(u)&&(R?(d(J),J=-1):R=!0,C(k,T-w))):(x.sortIndex=O,e(c,x),b||m||(b=!0,y($))),x},t.unstable_shouldYield=ke,t.unstable_wrapCallback=function(x){var v=f;return function(){var T=f;f=v;try{return x.apply(this,arguments)}finally{f=T}}}})(Ny);My.exports=Ny;var tb=My.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nb=U,$n=tb;function le(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var jy=new Set,oa={};function ni(t,e){Gi(t,e),Gi(t+"Capture",e)}function Gi(t,e){for(oa[t]=e,t=0;t<e.length;t++)jy.add(e[t])}var jr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),tf=Object.prototype.hasOwnProperty,rb=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,rg={},sg={};function sb(t){return tf.call(sg,t)?!0:tf.call(rg,t)?!1:rb.test(t)?sg[t]=!0:(rg[t]=!0,!1)}function ib(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function ob(t,e,n,r){if(e===null||typeof e>"u"||ib(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Sn(t,e,n,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var sn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){sn[t]=new Sn(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];sn[e]=new Sn(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){sn[t]=new Sn(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){sn[t]=new Sn(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){sn[t]=new Sn(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){sn[t]=new Sn(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){sn[t]=new Sn(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){sn[t]=new Sn(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){sn[t]=new Sn(t,5,!1,t.toLowerCase(),null,!1,!1)});var Rp=/[\-:]([a-z])/g;function Op(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Rp,Op);sn[e]=new Sn(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Rp,Op);sn[e]=new Sn(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Rp,Op);sn[e]=new Sn(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){sn[t]=new Sn(t,1,!1,t.toLowerCase(),null,!1,!1)});sn.xlinkHref=new Sn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){sn[t]=new Sn(t,1,!1,t.toLowerCase(),null,!0,!0)});function Pp(t,e,n,r){var s=sn.hasOwnProperty(e)?sn[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(ob(e,n,s,r)&&(n=null),r||s===null?sb(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var Hr=nb.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,El=Symbol.for("react.element"),bi=Symbol.for("react.portal"),Si=Symbol.for("react.fragment"),Lp=Symbol.for("react.strict_mode"),nf=Symbol.for("react.profiler"),Fy=Symbol.for("react.provider"),$y=Symbol.for("react.context"),Dp=Symbol.for("react.forward_ref"),rf=Symbol.for("react.suspense"),sf=Symbol.for("react.suspense_list"),Mp=Symbol.for("react.memo"),Zr=Symbol.for("react.lazy"),By=Symbol.for("react.offscreen"),ig=Symbol.iterator;function Co(t){return t===null||typeof t!="object"?null:(t=ig&&t[ig]||t["@@iterator"],typeof t=="function"?t:null)}var Dt=Object.assign,hd;function jo(t){if(hd===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);hd=e&&e[1]||""}return`
`+hd+t}var gd=!1;function md(t,e){if(!t||gd)return"";gd=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){r=u}t.call(e.prototype)}else{try{throw Error()}catch(u){r=u}t()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var s=u.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,a=i.length-1;1<=o&&0<=a&&s[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||s[o]!==i[a]){var c=`
`+s[o].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=o&&0<=a);break}}}finally{gd=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?jo(t):""}function ab(t){switch(t.tag){case 5:return jo(t.type);case 16:return jo("Lazy");case 13:return jo("Suspense");case 19:return jo("SuspenseList");case 0:case 2:case 15:return t=md(t.type,!1),t;case 11:return t=md(t.type.render,!1),t;case 1:return t=md(t.type,!0),t;default:return""}}function of(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Si:return"Fragment";case bi:return"Portal";case nf:return"Profiler";case Lp:return"StrictMode";case rf:return"Suspense";case sf:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case $y:return(t.displayName||"Context")+".Consumer";case Fy:return(t._context.displayName||"Context")+".Provider";case Dp:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Mp:return e=t.displayName||null,e!==null?e:of(t.type)||"Memo";case Zr:e=t._payload,t=t._init;try{return of(t(e))}catch{}}return null}function lb(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return of(e);case 8:return e===Lp?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function xs(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Uy(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function cb(t){var e=Uy(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function bl(t){t._valueTracker||(t._valueTracker=cb(t))}function zy(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=Uy(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function fc(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function af(t,e){var n=e.checked;return Dt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function og(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=xs(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Hy(t,e){e=e.checked,e!=null&&Pp(t,"checked",e,!1)}function lf(t,e){Hy(t,e);var n=xs(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?cf(t,e.type,n):e.hasOwnProperty("defaultValue")&&cf(t,e.type,xs(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function ag(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function cf(t,e,n){(e!=="number"||fc(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Fo=Array.isArray;function Mi(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+xs(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function uf(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(le(91));return Dt({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function lg(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(le(92));if(Fo(n)){if(1<n.length)throw Error(le(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:xs(n)}}function Wy(t,e){var n=xs(e.value),r=xs(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function cg(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function Gy(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function df(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?Gy(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Sl,Vy=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Sl=Sl||document.createElement("div"),Sl.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Sl.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function aa(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var zo={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ub=["Webkit","ms","Moz","O"];Object.keys(zo).forEach(function(t){ub.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),zo[e]=zo[t]})});function Yy(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||zo.hasOwnProperty(t)&&zo[t]?(""+e).trim():e+"px"}function Ky(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=Yy(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var db=Dt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ff(t,e){if(e){if(db[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(le(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(le(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(le(61))}if(e.style!=null&&typeof e.style!="object")throw Error(le(62))}}function pf(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var hf=null;function Np(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var gf=null,Ni=null,ji=null;function ug(t){if(t=Ba(t)){if(typeof gf!="function")throw Error(le(280));var e=t.stateNode;e&&(e=lu(e),gf(t.stateNode,t.type,e))}}function Xy(t){Ni?ji?ji.push(t):ji=[t]:Ni=t}function Qy(){if(Ni){var t=Ni,e=ji;if(ji=Ni=null,ug(t),e)for(t=0;t<e.length;t++)ug(e[t])}}function Jy(t,e){return t(e)}function qy(){}var yd=!1;function Zy(t,e,n){if(yd)return t(e,n);yd=!0;try{return Jy(t,e,n)}finally{yd=!1,(Ni!==null||ji!==null)&&(qy(),Qy())}}function la(t,e){var n=t.stateNode;if(n===null)return null;var r=lu(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(le(231,e,typeof n));return n}var mf=!1;if(jr)try{var To={};Object.defineProperty(To,"passive",{get:function(){mf=!0}}),window.addEventListener("test",To,To),window.removeEventListener("test",To,To)}catch{mf=!1}function fb(t,e,n,r,s,i,o,a,c){var u=Array.prototype.slice.call(arguments,3);try{e.apply(n,u)}catch(p){this.onError(p)}}var Ho=!1,pc=null,hc=!1,yf=null,pb={onError:function(t){Ho=!0,pc=t}};function hb(t,e,n,r,s,i,o,a,c){Ho=!1,pc=null,fb.apply(pb,arguments)}function gb(t,e,n,r,s,i,o,a,c){if(hb.apply(this,arguments),Ho){if(Ho){var u=pc;Ho=!1,pc=null}else throw Error(le(198));hc||(hc=!0,yf=u)}}function ri(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function ev(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function dg(t){if(ri(t)!==t)throw Error(le(188))}function mb(t){var e=t.alternate;if(!e){if(e=ri(t),e===null)throw Error(le(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return dg(s),t;if(i===r)return dg(s),e;i=i.sibling}throw Error(le(188))}if(n.return!==r.return)n=s,r=i;else{for(var o=!1,a=s.child;a;){if(a===n){o=!0,n=s,r=i;break}if(a===r){o=!0,r=s,n=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===n){o=!0,n=i,r=s;break}if(a===r){o=!0,r=i,n=s;break}a=a.sibling}if(!o)throw Error(le(189))}}if(n.alternate!==r)throw Error(le(190))}if(n.tag!==3)throw Error(le(188));return n.stateNode.current===n?t:e}function tv(t){return t=mb(t),t!==null?nv(t):null}function nv(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=nv(t);if(e!==null)return e;t=t.sibling}return null}var rv=$n.unstable_scheduleCallback,fg=$n.unstable_cancelCallback,yb=$n.unstable_shouldYield,vb=$n.unstable_requestPaint,jt=$n.unstable_now,_b=$n.unstable_getCurrentPriorityLevel,jp=$n.unstable_ImmediatePriority,sv=$n.unstable_UserBlockingPriority,gc=$n.unstable_NormalPriority,xb=$n.unstable_LowPriority,iv=$n.unstable_IdlePriority,su=null,_r=null;function Eb(t){if(_r&&typeof _r.onCommitFiberRoot=="function")try{_r.onCommitFiberRoot(su,t,void 0,(t.current.flags&128)===128)}catch{}}var ar=Math.clz32?Math.clz32:Cb,bb=Math.log,Sb=Math.LN2;function Cb(t){return t>>>=0,t===0?32:31-(bb(t)/Sb|0)|0}var Cl=64,Tl=4194304;function $o(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function mc(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~s;a!==0?r=$o(a):(i&=o,i!==0&&(r=$o(i)))}else o=n&~s,o!==0?r=$o(o):i!==0&&(r=$o(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-ar(e),s=1<<n,r|=t[n],e&=~s;return r}function Tb(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ib(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var o=31-ar(i),a=1<<o,c=s[o];c===-1?(!(a&n)||a&r)&&(s[o]=Tb(a,e)):c<=e&&(t.expiredLanes|=a),i&=~a}}function vf(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function ov(){var t=Cl;return Cl<<=1,!(Cl&4194240)&&(Cl=64),t}function vd(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Fa(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-ar(e),t[e]=n}function kb(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-ar(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function Fp(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-ar(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var mt=0;function av(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var lv,$p,cv,uv,dv,_f=!1,Il=[],as=null,ls=null,cs=null,ca=new Map,ua=new Map,ts=[],wb="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function pg(t,e){switch(t){case"focusin":case"focusout":as=null;break;case"dragenter":case"dragleave":ls=null;break;case"mouseover":case"mouseout":cs=null;break;case"pointerover":case"pointerout":ca.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ua.delete(e.pointerId)}}function Io(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=Ba(e),e!==null&&$p(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function Ab(t,e,n,r,s){switch(e){case"focusin":return as=Io(as,t,e,n,r,s),!0;case"dragenter":return ls=Io(ls,t,e,n,r,s),!0;case"mouseover":return cs=Io(cs,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return ca.set(i,Io(ca.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,ua.set(i,Io(ua.get(i)||null,t,e,n,r,s)),!0}return!1}function fv(t){var e=Bs(t.target);if(e!==null){var n=ri(e);if(n!==null){if(e=n.tag,e===13){if(e=ev(n),e!==null){t.blockedOn=e,dv(t.priority,function(){cv(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Yl(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=xf(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);hf=r,n.target.dispatchEvent(r),hf=null}else return e=Ba(n),e!==null&&$p(e),t.blockedOn=n,!1;e.shift()}return!0}function hg(t,e,n){Yl(t)&&n.delete(e)}function Rb(){_f=!1,as!==null&&Yl(as)&&(as=null),ls!==null&&Yl(ls)&&(ls=null),cs!==null&&Yl(cs)&&(cs=null),ca.forEach(hg),ua.forEach(hg)}function ko(t,e){t.blockedOn===e&&(t.blockedOn=null,_f||(_f=!0,$n.unstable_scheduleCallback($n.unstable_NormalPriority,Rb)))}function da(t){function e(s){return ko(s,t)}if(0<Il.length){ko(Il[0],t);for(var n=1;n<Il.length;n++){var r=Il[n];r.blockedOn===t&&(r.blockedOn=null)}}for(as!==null&&ko(as,t),ls!==null&&ko(ls,t),cs!==null&&ko(cs,t),ca.forEach(e),ua.forEach(e),n=0;n<ts.length;n++)r=ts[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<ts.length&&(n=ts[0],n.blockedOn===null);)fv(n),n.blockedOn===null&&ts.shift()}var Fi=Hr.ReactCurrentBatchConfig,yc=!0;function Ob(t,e,n,r){var s=mt,i=Fi.transition;Fi.transition=null;try{mt=1,Bp(t,e,n,r)}finally{mt=s,Fi.transition=i}}function Pb(t,e,n,r){var s=mt,i=Fi.transition;Fi.transition=null;try{mt=4,Bp(t,e,n,r)}finally{mt=s,Fi.transition=i}}function Bp(t,e,n,r){if(yc){var s=xf(t,e,n,r);if(s===null)wd(t,e,r,vc,n),pg(t,r);else if(Ab(s,t,e,n,r))r.stopPropagation();else if(pg(t,r),e&4&&-1<wb.indexOf(t)){for(;s!==null;){var i=Ba(s);if(i!==null&&lv(i),i=xf(t,e,n,r),i===null&&wd(t,e,r,vc,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else wd(t,e,r,null,n)}}var vc=null;function xf(t,e,n,r){if(vc=null,t=Np(r),t=Bs(t),t!==null)if(e=ri(t),e===null)t=null;else if(n=e.tag,n===13){if(t=ev(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return vc=t,null}function pv(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(_b()){case jp:return 1;case sv:return 4;case gc:case xb:return 16;case iv:return 536870912;default:return 16}default:return 16}}var ss=null,Up=null,Kl=null;function hv(){if(Kl)return Kl;var t,e=Up,n=e.length,r,s="value"in ss?ss.value:ss.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===s[i-r];r++);return Kl=s.slice(t,1<r?1-r:void 0)}function Xl(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function kl(){return!0}function gg(){return!1}function Un(t){function e(n,r,s,i,o){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?kl:gg,this.isPropagationStopped=gg,this}return Dt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=kl)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=kl)},persist:function(){},isPersistent:kl}),e}var io={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},zp=Un(io),$a=Dt({},io,{view:0,detail:0}),Lb=Un($a),_d,xd,wo,iu=Dt({},$a,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Hp,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==wo&&(wo&&t.type==="mousemove"?(_d=t.screenX-wo.screenX,xd=t.screenY-wo.screenY):xd=_d=0,wo=t),_d)},movementY:function(t){return"movementY"in t?t.movementY:xd}}),mg=Un(iu),Db=Dt({},iu,{dataTransfer:0}),Mb=Un(Db),Nb=Dt({},$a,{relatedTarget:0}),Ed=Un(Nb),jb=Dt({},io,{animationName:0,elapsedTime:0,pseudoElement:0}),Fb=Un(jb),$b=Dt({},io,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Bb=Un($b),Ub=Dt({},io,{data:0}),yg=Un(Ub),zb={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Hb={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Wb={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Gb(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=Wb[t])?!!e[t]:!1}function Hp(){return Gb}var Vb=Dt({},$a,{key:function(t){if(t.key){var e=zb[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Xl(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Hb[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Hp,charCode:function(t){return t.type==="keypress"?Xl(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Xl(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Yb=Un(Vb),Kb=Dt({},iu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),vg=Un(Kb),Xb=Dt({},$a,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Hp}),Qb=Un(Xb),Jb=Dt({},io,{propertyName:0,elapsedTime:0,pseudoElement:0}),qb=Un(Jb),Zb=Dt({},iu,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),eS=Un(Zb),tS=[9,13,27,32],Wp=jr&&"CompositionEvent"in window,Wo=null;jr&&"documentMode"in document&&(Wo=document.documentMode);var nS=jr&&"TextEvent"in window&&!Wo,gv=jr&&(!Wp||Wo&&8<Wo&&11>=Wo),_g=" ",xg=!1;function mv(t,e){switch(t){case"keyup":return tS.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function yv(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Ci=!1;function rS(t,e){switch(t){case"compositionend":return yv(e);case"keypress":return e.which!==32?null:(xg=!0,_g);case"textInput":return t=e.data,t===_g&&xg?null:t;default:return null}}function sS(t,e){if(Ci)return t==="compositionend"||!Wp&&mv(t,e)?(t=hv(),Kl=Up=ss=null,Ci=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return gv&&e.locale!=="ko"?null:e.data;default:return null}}var iS={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Eg(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!iS[t.type]:e==="textarea"}function vv(t,e,n,r){Xy(r),e=_c(e,"onChange"),0<e.length&&(n=new zp("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Go=null,fa=null;function oS(t){Av(t,0)}function ou(t){var e=ki(t);if(zy(e))return t}function aS(t,e){if(t==="change")return e}var _v=!1;if(jr){var bd;if(jr){var Sd="oninput"in document;if(!Sd){var bg=document.createElement("div");bg.setAttribute("oninput","return;"),Sd=typeof bg.oninput=="function"}bd=Sd}else bd=!1;_v=bd&&(!document.documentMode||9<document.documentMode)}function Sg(){Go&&(Go.detachEvent("onpropertychange",xv),fa=Go=null)}function xv(t){if(t.propertyName==="value"&&ou(fa)){var e=[];vv(e,fa,t,Np(t)),Zy(oS,e)}}function lS(t,e,n){t==="focusin"?(Sg(),Go=e,fa=n,Go.attachEvent("onpropertychange",xv)):t==="focusout"&&Sg()}function cS(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return ou(fa)}function uS(t,e){if(t==="click")return ou(e)}function dS(t,e){if(t==="input"||t==="change")return ou(e)}function fS(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var ur=typeof Object.is=="function"?Object.is:fS;function pa(t,e){if(ur(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!tf.call(e,s)||!ur(t[s],e[s]))return!1}return!0}function Cg(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Tg(t,e){var n=Cg(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Cg(n)}}function Ev(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?Ev(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function bv(){for(var t=window,e=fc();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=fc(t.document)}return e}function Gp(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function pS(t){var e=bv(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&Ev(n.ownerDocument.documentElement,n)){if(r!==null&&Gp(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=Tg(n,i);var o=Tg(n,r);s&&o&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var hS=jr&&"documentMode"in document&&11>=document.documentMode,Ti=null,Ef=null,Vo=null,bf=!1;function Ig(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;bf||Ti==null||Ti!==fc(r)||(r=Ti,"selectionStart"in r&&Gp(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Vo&&pa(Vo,r)||(Vo=r,r=_c(Ef,"onSelect"),0<r.length&&(e=new zp("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=Ti)))}function wl(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Ii={animationend:wl("Animation","AnimationEnd"),animationiteration:wl("Animation","AnimationIteration"),animationstart:wl("Animation","AnimationStart"),transitionend:wl("Transition","TransitionEnd")},Cd={},Sv={};jr&&(Sv=document.createElement("div").style,"AnimationEvent"in window||(delete Ii.animationend.animation,delete Ii.animationiteration.animation,delete Ii.animationstart.animation),"TransitionEvent"in window||delete Ii.transitionend.transition);function au(t){if(Cd[t])return Cd[t];if(!Ii[t])return t;var e=Ii[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in Sv)return Cd[t]=e[n];return t}var Cv=au("animationend"),Tv=au("animationiteration"),Iv=au("animationstart"),kv=au("transitionend"),wv=new Map,kg="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ts(t,e){wv.set(t,e),ni(e,[t])}for(var Td=0;Td<kg.length;Td++){var Id=kg[Td],gS=Id.toLowerCase(),mS=Id[0].toUpperCase()+Id.slice(1);Ts(gS,"on"+mS)}Ts(Cv,"onAnimationEnd");Ts(Tv,"onAnimationIteration");Ts(Iv,"onAnimationStart");Ts("dblclick","onDoubleClick");Ts("focusin","onFocus");Ts("focusout","onBlur");Ts(kv,"onTransitionEnd");Gi("onMouseEnter",["mouseout","mouseover"]);Gi("onMouseLeave",["mouseout","mouseover"]);Gi("onPointerEnter",["pointerout","pointerover"]);Gi("onPointerLeave",["pointerout","pointerover"]);ni("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ni("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ni("onBeforeInput",["compositionend","keypress","textInput","paste"]);ni("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ni("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ni("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Bo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),yS=new Set("cancel close invalid load scroll toggle".split(" ").concat(Bo));function wg(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,gb(r,e,void 0,t),t.currentTarget=null}function Av(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],c=a.instance,u=a.currentTarget;if(a=a.listener,c!==i&&s.isPropagationStopped())break e;wg(s,a,u),i=c}else for(o=0;o<r.length;o++){if(a=r[o],c=a.instance,u=a.currentTarget,a=a.listener,c!==i&&s.isPropagationStopped())break e;wg(s,a,u),i=c}}}if(hc)throw t=yf,hc=!1,yf=null,t}function It(t,e){var n=e[kf];n===void 0&&(n=e[kf]=new Set);var r=t+"__bubble";n.has(r)||(Rv(e,t,2,!1),n.add(r))}function kd(t,e,n){var r=0;e&&(r|=4),Rv(n,t,r,e)}var Al="_reactListening"+Math.random().toString(36).slice(2);function ha(t){if(!t[Al]){t[Al]=!0,jy.forEach(function(n){n!=="selectionchange"&&(yS.has(n)||kd(n,!1,t),kd(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Al]||(e[Al]=!0,kd("selectionchange",!1,e))}}function Rv(t,e,n,r){switch(pv(e)){case 1:var s=Ob;break;case 4:s=Pb;break;default:s=Bp}n=s.bind(null,e,n,t),s=void 0,!mf||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function wd(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===s||c.nodeType===8&&c.parentNode===s))return;o=o.return}for(;a!==null;){if(o=Bs(a),o===null)return;if(c=o.tag,c===5||c===6){r=i=o;continue e}a=a.parentNode}}r=r.return}Zy(function(){var u=i,p=Np(n),h=[];e:{var f=wv.get(t);if(f!==void 0){var m=zp,b=t;switch(t){case"keypress":if(Xl(n)===0)break e;case"keydown":case"keyup":m=Yb;break;case"focusin":b="focus",m=Ed;break;case"focusout":b="blur",m=Ed;break;case"beforeblur":case"afterblur":m=Ed;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=mg;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=Mb;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=Qb;break;case Cv:case Tv:case Iv:m=Fb;break;case kv:m=qb;break;case"scroll":m=Lb;break;case"wheel":m=eS;break;case"copy":case"cut":case"paste":m=Bb;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=vg}var R=(e&4)!==0,W=!R&&t==="scroll",d=R?f!==null?f+"Capture":null:f;R=[];for(var I=u,S;I!==null;){S=I;var k=S.stateNode;if(S.tag===5&&k!==null&&(S=k,d!==null&&(k=la(I,d),k!=null&&R.push(ga(I,k,S)))),W)break;I=I.return}0<R.length&&(f=new m(f,b,null,n,p),h.push({event:f,listeners:R}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",m=t==="mouseout"||t==="pointerout",f&&n!==hf&&(b=n.relatedTarget||n.fromElement)&&(Bs(b)||b[Fr]))break e;if((m||f)&&(f=p.window===p?p:(f=p.ownerDocument)?f.defaultView||f.parentWindow:window,m?(b=n.relatedTarget||n.toElement,m=u,b=b?Bs(b):null,b!==null&&(W=ri(b),b!==W||b.tag!==5&&b.tag!==6)&&(b=null)):(m=null,b=u),m!==b)){if(R=mg,k="onMouseLeave",d="onMouseEnter",I="mouse",(t==="pointerout"||t==="pointerover")&&(R=vg,k="onPointerLeave",d="onPointerEnter",I="pointer"),W=m==null?f:ki(m),S=b==null?f:ki(b),f=new R(k,I+"leave",m,n,p),f.target=W,f.relatedTarget=S,k=null,Bs(p)===u&&(R=new R(d,I+"enter",b,n,p),R.target=S,R.relatedTarget=W,k=R),W=k,m&&b)t:{for(R=m,d=b,I=0,S=R;S;S=vi(S))I++;for(S=0,k=d;k;k=vi(k))S++;for(;0<I-S;)R=vi(R),I--;for(;0<S-I;)d=vi(d),S--;for(;I--;){if(R===d||d!==null&&R===d.alternate)break t;R=vi(R),d=vi(d)}R=null}else R=null;m!==null&&Ag(h,f,m,R,!1),b!==null&&W!==null&&Ag(h,W,b,R,!0)}}e:{if(f=u?ki(u):window,m=f.nodeName&&f.nodeName.toLowerCase(),m==="select"||m==="input"&&f.type==="file")var $=aS;else if(Eg(f))if(_v)$=dS;else{$=cS;var B=lS}else(m=f.nodeName)&&m.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&($=uS);if($&&($=$(t,u))){vv(h,$,n,p);break e}B&&B(t,f,u),t==="focusout"&&(B=f._wrapperState)&&B.controlled&&f.type==="number"&&cf(f,"number",f.value)}switch(B=u?ki(u):window,t){case"focusin":(Eg(B)||B.contentEditable==="true")&&(Ti=B,Ef=u,Vo=null);break;case"focusout":Vo=Ef=Ti=null;break;case"mousedown":bf=!0;break;case"contextmenu":case"mouseup":case"dragend":bf=!1,Ig(h,n,p);break;case"selectionchange":if(hS)break;case"keydown":case"keyup":Ig(h,n,p)}var te;if(Wp)e:{switch(t){case"compositionstart":var J="onCompositionStart";break e;case"compositionend":J="onCompositionEnd";break e;case"compositionupdate":J="onCompositionUpdate";break e}J=void 0}else Ci?mv(t,n)&&(J="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(J="onCompositionStart");J&&(gv&&n.locale!=="ko"&&(Ci||J!=="onCompositionStart"?J==="onCompositionEnd"&&Ci&&(te=hv()):(ss=p,Up="value"in ss?ss.value:ss.textContent,Ci=!0)),B=_c(u,J),0<B.length&&(J=new yg(J,t,null,n,p),h.push({event:J,listeners:B}),te?J.data=te:(te=yv(n),te!==null&&(J.data=te)))),(te=nS?rS(t,n):sS(t,n))&&(u=_c(u,"onBeforeInput"),0<u.length&&(p=new yg("onBeforeInput","beforeinput",null,n,p),h.push({event:p,listeners:u}),p.data=te))}Av(h,e)})}function ga(t,e,n){return{instance:t,listener:e,currentTarget:n}}function _c(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=la(t,n),i!=null&&r.unshift(ga(t,i,s)),i=la(t,e),i!=null&&r.push(ga(t,i,s))),t=t.return}return r}function vi(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Ag(t,e,n,r,s){for(var i=e._reactName,o=[];n!==null&&n!==r;){var a=n,c=a.alternate,u=a.stateNode;if(c!==null&&c===r)break;a.tag===5&&u!==null&&(a=u,s?(c=la(n,i),c!=null&&o.unshift(ga(n,c,a))):s||(c=la(n,i),c!=null&&o.push(ga(n,c,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var vS=/\r\n?/g,_S=/\u0000|\uFFFD/g;function Rg(t){return(typeof t=="string"?t:""+t).replace(vS,`
`).replace(_S,"")}function Rl(t,e,n){if(e=Rg(e),Rg(t)!==e&&n)throw Error(le(425))}function xc(){}var Sf=null,Cf=null;function Tf(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var If=typeof setTimeout=="function"?setTimeout:void 0,xS=typeof clearTimeout=="function"?clearTimeout:void 0,Og=typeof Promise=="function"?Promise:void 0,ES=typeof queueMicrotask=="function"?queueMicrotask:typeof Og<"u"?function(t){return Og.resolve(null).then(t).catch(bS)}:If;function bS(t){setTimeout(function(){throw t})}function Ad(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),da(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);da(e)}function us(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Pg(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var oo=Math.random().toString(36).slice(2),vr="__reactFiber$"+oo,ma="__reactProps$"+oo,Fr="__reactContainer$"+oo,kf="__reactEvents$"+oo,SS="__reactListeners$"+oo,CS="__reactHandles$"+oo;function Bs(t){var e=t[vr];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Fr]||n[vr]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Pg(t);t!==null;){if(n=t[vr])return n;t=Pg(t)}return e}t=n,n=t.parentNode}return null}function Ba(t){return t=t[vr]||t[Fr],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function ki(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(le(33))}function lu(t){return t[ma]||null}var wf=[],wi=-1;function Is(t){return{current:t}}function wt(t){0>wi||(t.current=wf[wi],wf[wi]=null,wi--)}function Ct(t,e){wi++,wf[wi]=t.current,t.current=e}var Es={},fn=Is(Es),Rn=Is(!1),Ks=Es;function Vi(t,e){var n=t.type.contextTypes;if(!n)return Es;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function On(t){return t=t.childContextTypes,t!=null}function Ec(){wt(Rn),wt(fn)}function Lg(t,e,n){if(fn.current!==Es)throw Error(le(168));Ct(fn,e),Ct(Rn,n)}function Ov(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(le(108,lb(t)||"Unknown",s));return Dt({},n,r)}function bc(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Es,Ks=fn.current,Ct(fn,t),Ct(Rn,Rn.current),!0}function Dg(t,e,n){var r=t.stateNode;if(!r)throw Error(le(169));n?(t=Ov(t,e,Ks),r.__reactInternalMemoizedMergedChildContext=t,wt(Rn),wt(fn),Ct(fn,t)):wt(Rn),Ct(Rn,n)}var Ar=null,cu=!1,Rd=!1;function Pv(t){Ar===null?Ar=[t]:Ar.push(t)}function TS(t){cu=!0,Pv(t)}function ks(){if(!Rd&&Ar!==null){Rd=!0;var t=0,e=mt;try{var n=Ar;for(mt=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}Ar=null,cu=!1}catch(s){throw Ar!==null&&(Ar=Ar.slice(t+1)),rv(jp,ks),s}finally{mt=e,Rd=!1}}return null}var Ai=[],Ri=0,Sc=null,Cc=0,Gn=[],Vn=0,Xs=null,Pr=1,Lr="";function Ms(t,e){Ai[Ri++]=Cc,Ai[Ri++]=Sc,Sc=t,Cc=e}function Lv(t,e,n){Gn[Vn++]=Pr,Gn[Vn++]=Lr,Gn[Vn++]=Xs,Xs=t;var r=Pr;t=Lr;var s=32-ar(r)-1;r&=~(1<<s),n+=1;var i=32-ar(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,Pr=1<<32-ar(e)+s|n<<s|r,Lr=i+t}else Pr=1<<i|n<<s|r,Lr=t}function Vp(t){t.return!==null&&(Ms(t,1),Lv(t,1,0))}function Yp(t){for(;t===Sc;)Sc=Ai[--Ri],Ai[Ri]=null,Cc=Ai[--Ri],Ai[Ri]=null;for(;t===Xs;)Xs=Gn[--Vn],Gn[Vn]=null,Lr=Gn[--Vn],Gn[Vn]=null,Pr=Gn[--Vn],Gn[Vn]=null}var Fn=null,jn=null,Rt=!1,sr=null;function Dv(t,e){var n=Yn(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Mg(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Fn=t,jn=us(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Fn=t,jn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Xs!==null?{id:Pr,overflow:Lr}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Yn(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Fn=t,jn=null,!0):!1;default:return!1}}function Af(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Rf(t){if(Rt){var e=jn;if(e){var n=e;if(!Mg(t,e)){if(Af(t))throw Error(le(418));e=us(n.nextSibling);var r=Fn;e&&Mg(t,e)?Dv(r,n):(t.flags=t.flags&-4097|2,Rt=!1,Fn=t)}}else{if(Af(t))throw Error(le(418));t.flags=t.flags&-4097|2,Rt=!1,Fn=t}}}function Ng(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Fn=t}function Ol(t){if(t!==Fn)return!1;if(!Rt)return Ng(t),Rt=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Tf(t.type,t.memoizedProps)),e&&(e=jn)){if(Af(t))throw Mv(),Error(le(418));for(;e;)Dv(t,e),e=us(e.nextSibling)}if(Ng(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(le(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){jn=us(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}jn=null}}else jn=Fn?us(t.stateNode.nextSibling):null;return!0}function Mv(){for(var t=jn;t;)t=us(t.nextSibling)}function Yi(){jn=Fn=null,Rt=!1}function Kp(t){sr===null?sr=[t]:sr.push(t)}var IS=Hr.ReactCurrentBatchConfig;function Ao(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(le(309));var r=n.stateNode}if(!r)throw Error(le(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=s.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof t!="string")throw Error(le(284));if(!n._owner)throw Error(le(290,t))}return t}function Pl(t,e){throw t=Object.prototype.toString.call(e),Error(le(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function jg(t){var e=t._init;return e(t._payload)}function Nv(t){function e(d,I){if(t){var S=d.deletions;S===null?(d.deletions=[I],d.flags|=16):S.push(I)}}function n(d,I){if(!t)return null;for(;I!==null;)e(d,I),I=I.sibling;return null}function r(d,I){for(d=new Map;I!==null;)I.key!==null?d.set(I.key,I):d.set(I.index,I),I=I.sibling;return d}function s(d,I){return d=hs(d,I),d.index=0,d.sibling=null,d}function i(d,I,S){return d.index=S,t?(S=d.alternate,S!==null?(S=S.index,S<I?(d.flags|=2,I):S):(d.flags|=2,I)):(d.flags|=1048576,I)}function o(d){return t&&d.alternate===null&&(d.flags|=2),d}function a(d,I,S,k){return I===null||I.tag!==6?(I=jd(S,d.mode,k),I.return=d,I):(I=s(I,S),I.return=d,I)}function c(d,I,S,k){var $=S.type;return $===Si?p(d,I,S.props.children,k,S.key):I!==null&&(I.elementType===$||typeof $=="object"&&$!==null&&$.$$typeof===Zr&&jg($)===I.type)?(k=s(I,S.props),k.ref=Ao(d,I,S),k.return=d,k):(k=nc(S.type,S.key,S.props,null,d.mode,k),k.ref=Ao(d,I,S),k.return=d,k)}function u(d,I,S,k){return I===null||I.tag!==4||I.stateNode.containerInfo!==S.containerInfo||I.stateNode.implementation!==S.implementation?(I=Fd(S,d.mode,k),I.return=d,I):(I=s(I,S.children||[]),I.return=d,I)}function p(d,I,S,k,$){return I===null||I.tag!==7?(I=Ys(S,d.mode,k,$),I.return=d,I):(I=s(I,S),I.return=d,I)}function h(d,I,S){if(typeof I=="string"&&I!==""||typeof I=="number")return I=jd(""+I,d.mode,S),I.return=d,I;if(typeof I=="object"&&I!==null){switch(I.$$typeof){case El:return S=nc(I.type,I.key,I.props,null,d.mode,S),S.ref=Ao(d,null,I),S.return=d,S;case bi:return I=Fd(I,d.mode,S),I.return=d,I;case Zr:var k=I._init;return h(d,k(I._payload),S)}if(Fo(I)||Co(I))return I=Ys(I,d.mode,S,null),I.return=d,I;Pl(d,I)}return null}function f(d,I,S,k){var $=I!==null?I.key:null;if(typeof S=="string"&&S!==""||typeof S=="number")return $!==null?null:a(d,I,""+S,k);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case El:return S.key===$?c(d,I,S,k):null;case bi:return S.key===$?u(d,I,S,k):null;case Zr:return $=S._init,f(d,I,$(S._payload),k)}if(Fo(S)||Co(S))return $!==null?null:p(d,I,S,k,null);Pl(d,S)}return null}function m(d,I,S,k,$){if(typeof k=="string"&&k!==""||typeof k=="number")return d=d.get(S)||null,a(I,d,""+k,$);if(typeof k=="object"&&k!==null){switch(k.$$typeof){case El:return d=d.get(k.key===null?S:k.key)||null,c(I,d,k,$);case bi:return d=d.get(k.key===null?S:k.key)||null,u(I,d,k,$);case Zr:var B=k._init;return m(d,I,S,B(k._payload),$)}if(Fo(k)||Co(k))return d=d.get(S)||null,p(I,d,k,$,null);Pl(I,k)}return null}function b(d,I,S,k){for(var $=null,B=null,te=I,J=I=0,me=null;te!==null&&J<S.length;J++){te.index>J?(me=te,te=null):me=te.sibling;var he=f(d,te,S[J],k);if(he===null){te===null&&(te=me);break}t&&te&&he.alternate===null&&e(d,te),I=i(he,I,J),B===null?$=he:B.sibling=he,B=he,te=me}if(J===S.length)return n(d,te),Rt&&Ms(d,J),$;if(te===null){for(;J<S.length;J++)te=h(d,S[J],k),te!==null&&(I=i(te,I,J),B===null?$=te:B.sibling=te,B=te);return Rt&&Ms(d,J),$}for(te=r(d,te);J<S.length;J++)me=m(te,d,J,S[J],k),me!==null&&(t&&me.alternate!==null&&te.delete(me.key===null?J:me.key),I=i(me,I,J),B===null?$=me:B.sibling=me,B=me);return t&&te.forEach(function(ke){return e(d,ke)}),Rt&&Ms(d,J),$}function R(d,I,S,k){var $=Co(S);if(typeof $!="function")throw Error(le(150));if(S=$.call(S),S==null)throw Error(le(151));for(var B=$=null,te=I,J=I=0,me=null,he=S.next();te!==null&&!he.done;J++,he=S.next()){te.index>J?(me=te,te=null):me=te.sibling;var ke=f(d,te,he.value,k);if(ke===null){te===null&&(te=me);break}t&&te&&ke.alternate===null&&e(d,te),I=i(ke,I,J),B===null?$=ke:B.sibling=ke,B=ke,te=me}if(he.done)return n(d,te),Rt&&Ms(d,J),$;if(te===null){for(;!he.done;J++,he=S.next())he=h(d,he.value,k),he!==null&&(I=i(he,I,J),B===null?$=he:B.sibling=he,B=he);return Rt&&Ms(d,J),$}for(te=r(d,te);!he.done;J++,he=S.next())he=m(te,d,J,he.value,k),he!==null&&(t&&he.alternate!==null&&te.delete(he.key===null?J:he.key),I=i(he,I,J),B===null?$=he:B.sibling=he,B=he);return t&&te.forEach(function(L){return e(d,L)}),Rt&&Ms(d,J),$}function W(d,I,S,k){if(typeof S=="object"&&S!==null&&S.type===Si&&S.key===null&&(S=S.props.children),typeof S=="object"&&S!==null){switch(S.$$typeof){case El:e:{for(var $=S.key,B=I;B!==null;){if(B.key===$){if($=S.type,$===Si){if(B.tag===7){n(d,B.sibling),I=s(B,S.props.children),I.return=d,d=I;break e}}else if(B.elementType===$||typeof $=="object"&&$!==null&&$.$$typeof===Zr&&jg($)===B.type){n(d,B.sibling),I=s(B,S.props),I.ref=Ao(d,B,S),I.return=d,d=I;break e}n(d,B);break}else e(d,B);B=B.sibling}S.type===Si?(I=Ys(S.props.children,d.mode,k,S.key),I.return=d,d=I):(k=nc(S.type,S.key,S.props,null,d.mode,k),k.ref=Ao(d,I,S),k.return=d,d=k)}return o(d);case bi:e:{for(B=S.key;I!==null;){if(I.key===B)if(I.tag===4&&I.stateNode.containerInfo===S.containerInfo&&I.stateNode.implementation===S.implementation){n(d,I.sibling),I=s(I,S.children||[]),I.return=d,d=I;break e}else{n(d,I);break}else e(d,I);I=I.sibling}I=Fd(S,d.mode,k),I.return=d,d=I}return o(d);case Zr:return B=S._init,W(d,I,B(S._payload),k)}if(Fo(S))return b(d,I,S,k);if(Co(S))return R(d,I,S,k);Pl(d,S)}return typeof S=="string"&&S!==""||typeof S=="number"?(S=""+S,I!==null&&I.tag===6?(n(d,I.sibling),I=s(I,S),I.return=d,d=I):(n(d,I),I=jd(S,d.mode,k),I.return=d,d=I),o(d)):n(d,I)}return W}var Ki=Nv(!0),jv=Nv(!1),Tc=Is(null),Ic=null,Oi=null,Xp=null;function Qp(){Xp=Oi=Ic=null}function Jp(t){var e=Tc.current;wt(Tc),t._currentValue=e}function Of(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function $i(t,e){Ic=t,Xp=Oi=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(wn=!0),t.firstContext=null)}function Qn(t){var e=t._currentValue;if(Xp!==t)if(t={context:t,memoizedValue:e,next:null},Oi===null){if(Ic===null)throw Error(le(308));Oi=t,Ic.dependencies={lanes:0,firstContext:t}}else Oi=Oi.next=t;return e}var Us=null;function qp(t){Us===null?Us=[t]:Us.push(t)}function Fv(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,qp(e)):(n.next=s.next,s.next=n),e.interleaved=n,$r(t,r)}function $r(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var es=!1;function Zp(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function $v(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Mr(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function ds(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,ct&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,$r(t,n)}return s=r.interleaved,s===null?(e.next=e,qp(r)):(e.next=s.next,s.next=e),r.interleaved=e,$r(t,n)}function Ql(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Fp(t,n)}}function Fg(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=o:i=i.next=o,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function kc(t,e,n,r){var s=t.updateQueue;es=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var c=a,u=c.next;c.next=null,o===null?i=u:o.next=u,o=c;var p=t.alternate;p!==null&&(p=p.updateQueue,a=p.lastBaseUpdate,a!==o&&(a===null?p.firstBaseUpdate=u:a.next=u,p.lastBaseUpdate=c))}if(i!==null){var h=s.baseState;o=0,p=u=c=null,a=i;do{var f=a.lane,m=a.eventTime;if((r&f)===f){p!==null&&(p=p.next={eventTime:m,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var b=t,R=a;switch(f=e,m=n,R.tag){case 1:if(b=R.payload,typeof b=="function"){h=b.call(m,h,f);break e}h=b;break e;case 3:b.flags=b.flags&-65537|128;case 0:if(b=R.payload,f=typeof b=="function"?b.call(m,h,f):b,f==null)break e;h=Dt({},h,f);break e;case 2:es=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,f=s.effects,f===null?s.effects=[a]:f.push(a))}else m={eventTime:m,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},p===null?(u=p=m,c=h):p=p.next=m,o|=f;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;f=a,a=f.next,f.next=null,s.lastBaseUpdate=f,s.shared.pending=null}}while(!0);if(p===null&&(c=h),s.baseState=c,s.firstBaseUpdate=u,s.lastBaseUpdate=p,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);Js|=o,t.lanes=o,t.memoizedState=h}}function $g(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(le(191,s));s.call(r)}}}var Ua={},xr=Is(Ua),ya=Is(Ua),va=Is(Ua);function zs(t){if(t===Ua)throw Error(le(174));return t}function eh(t,e){switch(Ct(va,e),Ct(ya,t),Ct(xr,Ua),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:df(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=df(e,t)}wt(xr),Ct(xr,e)}function Xi(){wt(xr),wt(ya),wt(va)}function Bv(t){zs(va.current);var e=zs(xr.current),n=df(e,t.type);e!==n&&(Ct(ya,t),Ct(xr,n))}function th(t){ya.current===t&&(wt(xr),wt(ya))}var Ot=Is(0);function wc(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Od=[];function nh(){for(var t=0;t<Od.length;t++)Od[t]._workInProgressVersionPrimary=null;Od.length=0}var Jl=Hr.ReactCurrentDispatcher,Pd=Hr.ReactCurrentBatchConfig,Qs=0,Lt=null,Gt=null,Xt=null,Ac=!1,Yo=!1,_a=0,kS=0;function ln(){throw Error(le(321))}function rh(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!ur(t[n],e[n]))return!1;return!0}function sh(t,e,n,r,s,i){if(Qs=i,Lt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Jl.current=t===null||t.memoizedState===null?OS:PS,t=n(r,s),Yo){i=0;do{if(Yo=!1,_a=0,25<=i)throw Error(le(301));i+=1,Xt=Gt=null,e.updateQueue=null,Jl.current=LS,t=n(r,s)}while(Yo)}if(Jl.current=Rc,e=Gt!==null&&Gt.next!==null,Qs=0,Xt=Gt=Lt=null,Ac=!1,e)throw Error(le(300));return t}function ih(){var t=_a!==0;return _a=0,t}function yr(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Xt===null?Lt.memoizedState=Xt=t:Xt=Xt.next=t,Xt}function Jn(){if(Gt===null){var t=Lt.alternate;t=t!==null?t.memoizedState:null}else t=Gt.next;var e=Xt===null?Lt.memoizedState:Xt.next;if(e!==null)Xt=e,Gt=t;else{if(t===null)throw Error(le(310));Gt=t,t={memoizedState:Gt.memoizedState,baseState:Gt.baseState,baseQueue:Gt.baseQueue,queue:Gt.queue,next:null},Xt===null?Lt.memoizedState=Xt=t:Xt=Xt.next=t}return Xt}function xa(t,e){return typeof e=="function"?e(t):e}function Ld(t){var e=Jn(),n=e.queue;if(n===null)throw Error(le(311));n.lastRenderedReducer=t;var r=Gt,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var a=o=null,c=null,u=i;do{var p=u.lane;if((Qs&p)===p)c!==null&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:t(r,u.action);else{var h={lane:p,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};c===null?(a=c=h,o=r):c=c.next=h,Lt.lanes|=p,Js|=p}u=u.next}while(u!==null&&u!==i);c===null?o=r:c.next=a,ur(r,e.memoizedState)||(wn=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=c,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,Lt.lanes|=i,Js|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Dd(t){var e=Jn(),n=e.queue;if(n===null)throw Error(le(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var o=s=s.next;do i=t(i,o.action),o=o.next;while(o!==s);ur(i,e.memoizedState)||(wn=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function Uv(){}function zv(t,e){var n=Lt,r=Jn(),s=e(),i=!ur(r.memoizedState,s);if(i&&(r.memoizedState=s,wn=!0),r=r.queue,oh(Gv.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||Xt!==null&&Xt.memoizedState.tag&1){if(n.flags|=2048,Ea(9,Wv.bind(null,n,r,s,e),void 0,null),Jt===null)throw Error(le(349));Qs&30||Hv(n,e,s)}return s}function Hv(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Lt.updateQueue,e===null?(e={lastEffect:null,stores:null},Lt.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function Wv(t,e,n,r){e.value=n,e.getSnapshot=r,Vv(e)&&Yv(t)}function Gv(t,e,n){return n(function(){Vv(e)&&Yv(t)})}function Vv(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!ur(t,n)}catch{return!0}}function Yv(t){var e=$r(t,1);e!==null&&lr(e,t,1,-1)}function Bg(t){var e=yr();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:xa,lastRenderedState:t},e.queue=t,t=t.dispatch=RS.bind(null,Lt,t),[e.memoizedState,t]}function Ea(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=Lt.updateQueue,e===null?(e={lastEffect:null,stores:null},Lt.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function Kv(){return Jn().memoizedState}function ql(t,e,n,r){var s=yr();Lt.flags|=t,s.memoizedState=Ea(1|e,n,void 0,r===void 0?null:r)}function uu(t,e,n,r){var s=Jn();r=r===void 0?null:r;var i=void 0;if(Gt!==null){var o=Gt.memoizedState;if(i=o.destroy,r!==null&&rh(r,o.deps)){s.memoizedState=Ea(e,n,i,r);return}}Lt.flags|=t,s.memoizedState=Ea(1|e,n,i,r)}function Ug(t,e){return ql(8390656,8,t,e)}function oh(t,e){return uu(2048,8,t,e)}function Xv(t,e){return uu(4,2,t,e)}function Qv(t,e){return uu(4,4,t,e)}function Jv(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function qv(t,e,n){return n=n!=null?n.concat([t]):null,uu(4,4,Jv.bind(null,e,t),n)}function ah(){}function Zv(t,e){var n=Jn();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&rh(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function e_(t,e){var n=Jn();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&rh(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function t_(t,e,n){return Qs&21?(ur(n,e)||(n=ov(),Lt.lanes|=n,Js|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,wn=!0),t.memoizedState=n)}function wS(t,e){var n=mt;mt=n!==0&&4>n?n:4,t(!0);var r=Pd.transition;Pd.transition={};try{t(!1),e()}finally{mt=n,Pd.transition=r}}function n_(){return Jn().memoizedState}function AS(t,e,n){var r=ps(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},r_(t))s_(e,n);else if(n=Fv(t,e,n,r),n!==null){var s=xn();lr(n,t,r,s),i_(n,e,r)}}function RS(t,e,n){var r=ps(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(r_(t))s_(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,n);if(s.hasEagerState=!0,s.eagerState=a,ur(a,o)){var c=e.interleaved;c===null?(s.next=s,qp(e)):(s.next=c.next,c.next=s),e.interleaved=s;return}}catch{}finally{}n=Fv(t,e,s,r),n!==null&&(s=xn(),lr(n,t,r,s),i_(n,e,r))}}function r_(t){var e=t.alternate;return t===Lt||e!==null&&e===Lt}function s_(t,e){Yo=Ac=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function i_(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Fp(t,n)}}var Rc={readContext:Qn,useCallback:ln,useContext:ln,useEffect:ln,useImperativeHandle:ln,useInsertionEffect:ln,useLayoutEffect:ln,useMemo:ln,useReducer:ln,useRef:ln,useState:ln,useDebugValue:ln,useDeferredValue:ln,useTransition:ln,useMutableSource:ln,useSyncExternalStore:ln,useId:ln,unstable_isNewReconciler:!1},OS={readContext:Qn,useCallback:function(t,e){return yr().memoizedState=[t,e===void 0?null:e],t},useContext:Qn,useEffect:Ug,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,ql(4194308,4,Jv.bind(null,e,t),n)},useLayoutEffect:function(t,e){return ql(4194308,4,t,e)},useInsertionEffect:function(t,e){return ql(4,2,t,e)},useMemo:function(t,e){var n=yr();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=yr();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=AS.bind(null,Lt,t),[r.memoizedState,t]},useRef:function(t){var e=yr();return t={current:t},e.memoizedState=t},useState:Bg,useDebugValue:ah,useDeferredValue:function(t){return yr().memoizedState=t},useTransition:function(){var t=Bg(!1),e=t[0];return t=wS.bind(null,t[1]),yr().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=Lt,s=yr();if(Rt){if(n===void 0)throw Error(le(407));n=n()}else{if(n=e(),Jt===null)throw Error(le(349));Qs&30||Hv(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,Ug(Gv.bind(null,r,i,t),[t]),r.flags|=2048,Ea(9,Wv.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=yr(),e=Jt.identifierPrefix;if(Rt){var n=Lr,r=Pr;n=(r&~(1<<32-ar(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=_a++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=kS++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},PS={readContext:Qn,useCallback:Zv,useContext:Qn,useEffect:oh,useImperativeHandle:qv,useInsertionEffect:Xv,useLayoutEffect:Qv,useMemo:e_,useReducer:Ld,useRef:Kv,useState:function(){return Ld(xa)},useDebugValue:ah,useDeferredValue:function(t){var e=Jn();return t_(e,Gt.memoizedState,t)},useTransition:function(){var t=Ld(xa)[0],e=Jn().memoizedState;return[t,e]},useMutableSource:Uv,useSyncExternalStore:zv,useId:n_,unstable_isNewReconciler:!1},LS={readContext:Qn,useCallback:Zv,useContext:Qn,useEffect:oh,useImperativeHandle:qv,useInsertionEffect:Xv,useLayoutEffect:Qv,useMemo:e_,useReducer:Dd,useRef:Kv,useState:function(){return Dd(xa)},useDebugValue:ah,useDeferredValue:function(t){var e=Jn();return Gt===null?e.memoizedState=t:t_(e,Gt.memoizedState,t)},useTransition:function(){var t=Dd(xa)[0],e=Jn().memoizedState;return[t,e]},useMutableSource:Uv,useSyncExternalStore:zv,useId:n_,unstable_isNewReconciler:!1};function nr(t,e){if(t&&t.defaultProps){e=Dt({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Pf(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:Dt({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var du={isMounted:function(t){return(t=t._reactInternals)?ri(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=xn(),s=ps(t),i=Mr(r,s);i.payload=e,n!=null&&(i.callback=n),e=ds(t,i,s),e!==null&&(lr(e,t,s,r),Ql(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=xn(),s=ps(t),i=Mr(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=ds(t,i,s),e!==null&&(lr(e,t,s,r),Ql(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=xn(),r=ps(t),s=Mr(n,r);s.tag=2,e!=null&&(s.callback=e),e=ds(t,s,r),e!==null&&(lr(e,t,r,n),Ql(e,t,r))}};function zg(t,e,n,r,s,i,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!pa(n,r)||!pa(s,i):!0}function o_(t,e,n){var r=!1,s=Es,i=e.contextType;return typeof i=="object"&&i!==null?i=Qn(i):(s=On(e)?Ks:fn.current,r=e.contextTypes,i=(r=r!=null)?Vi(t,s):Es),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=du,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function Hg(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&du.enqueueReplaceState(e,e.state,null)}function Lf(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},Zp(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=Qn(i):(i=On(e)?Ks:fn.current,s.context=Vi(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(Pf(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&du.enqueueReplaceState(s,s.state,null),kc(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function Qi(t,e){try{var n="",r=e;do n+=ab(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function Md(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Df(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var DS=typeof WeakMap=="function"?WeakMap:Map;function a_(t,e,n){n=Mr(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Pc||(Pc=!0,Wf=r),Df(t,e)},n}function l_(t,e,n){n=Mr(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){Df(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){Df(t,e),typeof r!="function"&&(fs===null?fs=new Set([this]):fs.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function Wg(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new DS;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=KS.bind(null,t,e,n),e.then(t,t))}function Gg(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Vg(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Mr(-1,1),e.tag=2,ds(n,e,1))),n.lanes|=1),t)}var MS=Hr.ReactCurrentOwner,wn=!1;function vn(t,e,n,r){e.child=t===null?jv(e,null,n,r):Ki(e,t.child,n,r)}function Yg(t,e,n,r,s){n=n.render;var i=e.ref;return $i(e,s),r=sh(t,e,n,r,i,s),n=ih(),t!==null&&!wn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Br(t,e,s)):(Rt&&n&&Vp(e),e.flags|=1,vn(t,e,r,s),e.child)}function Kg(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!gh(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,c_(t,e,i,r,s)):(t=nc(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var o=i.memoizedProps;if(n=n.compare,n=n!==null?n:pa,n(o,r)&&t.ref===e.ref)return Br(t,e,s)}return e.flags|=1,t=hs(i,r),t.ref=e.ref,t.return=e,e.child=t}function c_(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(pa(i,r)&&t.ref===e.ref)if(wn=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(wn=!0);else return e.lanes=t.lanes,Br(t,e,s)}return Mf(t,e,n,r,s)}function u_(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ct(Li,Nn),Nn|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Ct(Li,Nn),Nn|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,Ct(Li,Nn),Nn|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,Ct(Li,Nn),Nn|=r;return vn(t,e,s,n),e.child}function d_(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Mf(t,e,n,r,s){var i=On(n)?Ks:fn.current;return i=Vi(e,i),$i(e,s),n=sh(t,e,n,r,i,s),r=ih(),t!==null&&!wn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Br(t,e,s)):(Rt&&r&&Vp(e),e.flags|=1,vn(t,e,n,s),e.child)}function Xg(t,e,n,r,s){if(On(n)){var i=!0;bc(e)}else i=!1;if($i(e,s),e.stateNode===null)Zl(t,e),o_(e,n,r),Lf(e,n,r,s),r=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var c=o.context,u=n.contextType;typeof u=="object"&&u!==null?u=Qn(u):(u=On(n)?Ks:fn.current,u=Vi(e,u));var p=n.getDerivedStateFromProps,h=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||c!==u)&&Hg(e,o,r,u),es=!1;var f=e.memoizedState;o.state=f,kc(e,r,o,s),c=e.memoizedState,a!==r||f!==c||Rn.current||es?(typeof p=="function"&&(Pf(e,n,p,r),c=e.memoizedState),(a=es||zg(e,n,a,r,f,c,u))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),o.props=r,o.state=c,o.context=u,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,$v(t,e),a=e.memoizedProps,u=e.type===e.elementType?a:nr(e.type,a),o.props=u,h=e.pendingProps,f=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=Qn(c):(c=On(n)?Ks:fn.current,c=Vi(e,c));var m=n.getDerivedStateFromProps;(p=typeof m=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==h||f!==c)&&Hg(e,o,r,c),es=!1,f=e.memoizedState,o.state=f,kc(e,r,o,s);var b=e.memoizedState;a!==h||f!==b||Rn.current||es?(typeof m=="function"&&(Pf(e,n,m,r),b=e.memoizedState),(u=es||zg(e,n,u,r,f,b,c)||!1)?(p||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,b,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,b,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=b),o.props=r,o.state=b,o.context=c,r=u):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),r=!1)}return Nf(t,e,n,r,i,s)}function Nf(t,e,n,r,s,i){d_(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&Dg(e,n,!1),Br(t,e,i);r=e.stateNode,MS.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=Ki(e,t.child,null,i),e.child=Ki(e,null,a,i)):vn(t,e,a,i),e.memoizedState=r.state,s&&Dg(e,n,!0),e.child}function f_(t){var e=t.stateNode;e.pendingContext?Lg(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Lg(t,e.context,!1),eh(t,e.containerInfo)}function Qg(t,e,n,r,s){return Yi(),Kp(s),e.flags|=256,vn(t,e,n,r),e.child}var jf={dehydrated:null,treeContext:null,retryLane:0};function Ff(t){return{baseLanes:t,cachePool:null,transitions:null}}function p_(t,e,n){var r=e.pendingProps,s=Ot.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(s&2)!==0),a?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),Ct(Ot,s&1),t===null)return Rf(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=hu(o,r,0,null),t=Ys(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=Ff(n),e.memoizedState=jf,t):lh(e,o));if(s=t.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return NS(t,e,o,r,a,s,n);if(i){i=r.fallback,o=e.mode,s=t.child,a=s.sibling;var c={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=hs(s,c),r.subtreeFlags=s.subtreeFlags&14680064),a!==null?i=hs(a,i):(i=Ys(i,o,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=t.child.memoizedState,o=o===null?Ff(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=t.childLanes&~n,e.memoizedState=jf,r}return i=t.child,t=i.sibling,r=hs(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function lh(t,e){return e=hu({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Ll(t,e,n,r){return r!==null&&Kp(r),Ki(e,t.child,null,n),t=lh(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function NS(t,e,n,r,s,i,o){if(n)return e.flags&256?(e.flags&=-257,r=Md(Error(le(422))),Ll(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=hu({mode:"visible",children:r.children},s,0,null),i=Ys(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&Ki(e,t.child,null,o),e.child.memoizedState=Ff(o),e.memoizedState=jf,i);if(!(e.mode&1))return Ll(t,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var a=r.dgst;return r=a,i=Error(le(419)),r=Md(i,r,void 0),Ll(t,e,o,r)}if(a=(o&t.childLanes)!==0,wn||a){if(r=Jt,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,$r(t,s),lr(r,t,s,-1))}return hh(),r=Md(Error(le(421))),Ll(t,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=XS.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,jn=us(s.nextSibling),Fn=e,Rt=!0,sr=null,t!==null&&(Gn[Vn++]=Pr,Gn[Vn++]=Lr,Gn[Vn++]=Xs,Pr=t.id,Lr=t.overflow,Xs=e),e=lh(e,r.children),e.flags|=4096,e)}function Jg(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),Of(t.return,e,n)}function Nd(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function h_(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(vn(t,e,r.children,n),r=Ot.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Jg(t,n,e);else if(t.tag===19)Jg(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(Ct(Ot,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&wc(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),Nd(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&wc(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}Nd(e,!0,n,null,i);break;case"together":Nd(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Zl(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Br(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Js|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(le(153));if(e.child!==null){for(t=e.child,n=hs(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=hs(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function jS(t,e,n){switch(e.tag){case 3:f_(e),Yi();break;case 5:Bv(e);break;case 1:On(e.type)&&bc(e);break;case 4:eh(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;Ct(Tc,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Ct(Ot,Ot.current&1),e.flags|=128,null):n&e.child.childLanes?p_(t,e,n):(Ct(Ot,Ot.current&1),t=Br(t,e,n),t!==null?t.sibling:null);Ct(Ot,Ot.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return h_(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Ct(Ot,Ot.current),r)break;return null;case 22:case 23:return e.lanes=0,u_(t,e,n)}return Br(t,e,n)}var g_,$f,m_,y_;g_=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};$f=function(){};m_=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,zs(xr.current);var i=null;switch(n){case"input":s=af(t,s),r=af(t,r),i=[];break;case"select":s=Dt({},s,{value:void 0}),r=Dt({},r,{value:void 0}),i=[];break;case"textarea":s=uf(t,s),r=uf(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=xc)}ff(n,r);var o;n=null;for(u in s)if(!r.hasOwnProperty(u)&&s.hasOwnProperty(u)&&s[u]!=null)if(u==="style"){var a=s[u];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(oa.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in r){var c=r[u];if(a=s!=null?s[u]:void 0,r.hasOwnProperty(u)&&c!==a&&(c!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&a[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(i||(i=[]),i.push(u,n)),n=c;else u==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,a=a?a.__html:void 0,c!=null&&a!==c&&(i=i||[]).push(u,c)):u==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(u,""+c):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(oa.hasOwnProperty(u)?(c!=null&&u==="onScroll"&&It("scroll",t),i||a===c||(i=[])):(i=i||[]).push(u,c))}n&&(i=i||[]).push("style",n);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};y_=function(t,e,n,r){n!==r&&(e.flags|=4)};function Ro(t,e){if(!Rt)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function cn(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function FS(t,e,n){var r=e.pendingProps;switch(Yp(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return cn(e),null;case 1:return On(e.type)&&Ec(),cn(e),null;case 3:return r=e.stateNode,Xi(),wt(Rn),wt(fn),nh(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(Ol(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,sr!==null&&(Yf(sr),sr=null))),$f(t,e),cn(e),null;case 5:th(e);var s=zs(va.current);if(n=e.type,t!==null&&e.stateNode!=null)m_(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(le(166));return cn(e),null}if(t=zs(xr.current),Ol(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[vr]=e,r[ma]=i,t=(e.mode&1)!==0,n){case"dialog":It("cancel",r),It("close",r);break;case"iframe":case"object":case"embed":It("load",r);break;case"video":case"audio":for(s=0;s<Bo.length;s++)It(Bo[s],r);break;case"source":It("error",r);break;case"img":case"image":case"link":It("error",r),It("load",r);break;case"details":It("toggle",r);break;case"input":og(r,i),It("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},It("invalid",r);break;case"textarea":lg(r,i),It("invalid",r)}ff(n,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?r.textContent!==a&&(i.suppressHydrationWarning!==!0&&Rl(r.textContent,a,t),s=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&Rl(r.textContent,a,t),s=["children",""+a]):oa.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&It("scroll",r)}switch(n){case"input":bl(r),ag(r,i,!0);break;case"textarea":bl(r),cg(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=xc)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Gy(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[vr]=e,t[ma]=r,g_(t,e,!1,!1),e.stateNode=t;e:{switch(o=pf(n,r),n){case"dialog":It("cancel",t),It("close",t),s=r;break;case"iframe":case"object":case"embed":It("load",t),s=r;break;case"video":case"audio":for(s=0;s<Bo.length;s++)It(Bo[s],t);s=r;break;case"source":It("error",t),s=r;break;case"img":case"image":case"link":It("error",t),It("load",t),s=r;break;case"details":It("toggle",t),s=r;break;case"input":og(t,r),s=af(t,r),It("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=Dt({},r,{value:void 0}),It("invalid",t);break;case"textarea":lg(t,r),s=uf(t,r),It("invalid",t);break;default:s=r}ff(n,s),a=s;for(i in a)if(a.hasOwnProperty(i)){var c=a[i];i==="style"?Ky(t,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&Vy(t,c)):i==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&aa(t,c):typeof c=="number"&&aa(t,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(oa.hasOwnProperty(i)?c!=null&&i==="onScroll"&&It("scroll",t):c!=null&&Pp(t,i,c,o))}switch(n){case"input":bl(t),ag(t,r,!1);break;case"textarea":bl(t),cg(t);break;case"option":r.value!=null&&t.setAttribute("value",""+xs(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?Mi(t,!!r.multiple,i,!1):r.defaultValue!=null&&Mi(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=xc)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return cn(e),null;case 6:if(t&&e.stateNode!=null)y_(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(le(166));if(n=zs(va.current),zs(xr.current),Ol(e)){if(r=e.stateNode,n=e.memoizedProps,r[vr]=e,(i=r.nodeValue!==n)&&(t=Fn,t!==null))switch(t.tag){case 3:Rl(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Rl(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[vr]=e,e.stateNode=r}return cn(e),null;case 13:if(wt(Ot),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Rt&&jn!==null&&e.mode&1&&!(e.flags&128))Mv(),Yi(),e.flags|=98560,i=!1;else if(i=Ol(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(le(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(le(317));i[vr]=e}else Yi(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;cn(e),i=!1}else sr!==null&&(Yf(sr),sr=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||Ot.current&1?Yt===0&&(Yt=3):hh())),e.updateQueue!==null&&(e.flags|=4),cn(e),null);case 4:return Xi(),$f(t,e),t===null&&ha(e.stateNode.containerInfo),cn(e),null;case 10:return Jp(e.type._context),cn(e),null;case 17:return On(e.type)&&Ec(),cn(e),null;case 19:if(wt(Ot),i=e.memoizedState,i===null)return cn(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)Ro(i,!1);else{if(Yt!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=wc(t),o!==null){for(e.flags|=128,Ro(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,t=o.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Ct(Ot,Ot.current&1|2),e.child}t=t.sibling}i.tail!==null&&jt()>Ji&&(e.flags|=128,r=!0,Ro(i,!1),e.lanes=4194304)}else{if(!r)if(t=wc(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Ro(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!Rt)return cn(e),null}else 2*jt()-i.renderingStartTime>Ji&&n!==1073741824&&(e.flags|=128,r=!0,Ro(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(n=i.last,n!==null?n.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=jt(),e.sibling=null,n=Ot.current,Ct(Ot,r?n&1|2:n&1),e):(cn(e),null);case 22:case 23:return ph(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Nn&1073741824&&(cn(e),e.subtreeFlags&6&&(e.flags|=8192)):cn(e),null;case 24:return null;case 25:return null}throw Error(le(156,e.tag))}function $S(t,e){switch(Yp(e),e.tag){case 1:return On(e.type)&&Ec(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Xi(),wt(Rn),wt(fn),nh(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return th(e),null;case 13:if(wt(Ot),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(le(340));Yi()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return wt(Ot),null;case 4:return Xi(),null;case 10:return Jp(e.type._context),null;case 22:case 23:return ph(),null;case 24:return null;default:return null}}var Dl=!1,dn=!1,BS=typeof WeakSet=="function"?WeakSet:Set,_e=null;function Pi(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){Nt(t,e,r)}else n.current=null}function Bf(t,e,n){try{n()}catch(r){Nt(t,e,r)}}var qg=!1;function US(t,e){if(Sf=yc,t=bv(),Gp(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var o=0,a=-1,c=-1,u=0,p=0,h=t,f=null;t:for(;;){for(var m;h!==n||s!==0&&h.nodeType!==3||(a=o+s),h!==i||r!==0&&h.nodeType!==3||(c=o+r),h.nodeType===3&&(o+=h.nodeValue.length),(m=h.firstChild)!==null;)f=h,h=m;for(;;){if(h===t)break t;if(f===n&&++u===s&&(a=o),f===i&&++p===r&&(c=o),(m=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=m}n=a===-1||c===-1?null:{start:a,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Cf={focusedElem:t,selectionRange:n},yc=!1,_e=e;_e!==null;)if(e=_e,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,_e=t;else for(;_e!==null;){e=_e;try{var b=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(b!==null){var R=b.memoizedProps,W=b.memoizedState,d=e.stateNode,I=d.getSnapshotBeforeUpdate(e.elementType===e.type?R:nr(e.type,R),W);d.__reactInternalSnapshotBeforeUpdate=I}break;case 3:var S=e.stateNode.containerInfo;S.nodeType===1?S.textContent="":S.nodeType===9&&S.documentElement&&S.removeChild(S.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(le(163))}}catch(k){Nt(e,e.return,k)}if(t=e.sibling,t!==null){t.return=e.return,_e=t;break}_e=e.return}return b=qg,qg=!1,b}function Ko(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&Bf(e,n,i)}s=s.next}while(s!==r)}}function fu(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Uf(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function v_(t){var e=t.alternate;e!==null&&(t.alternate=null,v_(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[vr],delete e[ma],delete e[kf],delete e[SS],delete e[CS])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function __(t){return t.tag===5||t.tag===3||t.tag===4}function Zg(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||__(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function zf(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=xc));else if(r!==4&&(t=t.child,t!==null))for(zf(t,e,n),t=t.sibling;t!==null;)zf(t,e,n),t=t.sibling}function Hf(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Hf(t,e,n),t=t.sibling;t!==null;)Hf(t,e,n),t=t.sibling}var tn=null,rr=!1;function qr(t,e,n){for(n=n.child;n!==null;)x_(t,e,n),n=n.sibling}function x_(t,e,n){if(_r&&typeof _r.onCommitFiberUnmount=="function")try{_r.onCommitFiberUnmount(su,n)}catch{}switch(n.tag){case 5:dn||Pi(n,e);case 6:var r=tn,s=rr;tn=null,qr(t,e,n),tn=r,rr=s,tn!==null&&(rr?(t=tn,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):tn.removeChild(n.stateNode));break;case 18:tn!==null&&(rr?(t=tn,n=n.stateNode,t.nodeType===8?Ad(t.parentNode,n):t.nodeType===1&&Ad(t,n),da(t)):Ad(tn,n.stateNode));break;case 4:r=tn,s=rr,tn=n.stateNode.containerInfo,rr=!0,qr(t,e,n),tn=r,rr=s;break;case 0:case 11:case 14:case 15:if(!dn&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&Bf(n,e,o),s=s.next}while(s!==r)}qr(t,e,n);break;case 1:if(!dn&&(Pi(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){Nt(n,e,a)}qr(t,e,n);break;case 21:qr(t,e,n);break;case 22:n.mode&1?(dn=(r=dn)||n.memoizedState!==null,qr(t,e,n),dn=r):qr(t,e,n);break;default:qr(t,e,n)}}function em(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new BS),e.forEach(function(r){var s=QS.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function tr(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:tn=a.stateNode,rr=!1;break e;case 3:tn=a.stateNode.containerInfo,rr=!0;break e;case 4:tn=a.stateNode.containerInfo,rr=!0;break e}a=a.return}if(tn===null)throw Error(le(160));x_(i,o,s),tn=null,rr=!1;var c=s.alternate;c!==null&&(c.return=null),s.return=null}catch(u){Nt(s,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)E_(e,t),e=e.sibling}function E_(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(tr(e,t),mr(t),r&4){try{Ko(3,t,t.return),fu(3,t)}catch(R){Nt(t,t.return,R)}try{Ko(5,t,t.return)}catch(R){Nt(t,t.return,R)}}break;case 1:tr(e,t),mr(t),r&512&&n!==null&&Pi(n,n.return);break;case 5:if(tr(e,t),mr(t),r&512&&n!==null&&Pi(n,n.return),t.flags&32){var s=t.stateNode;try{aa(s,"")}catch(R){Nt(t,t.return,R)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,o=n!==null?n.memoizedProps:i,a=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&Hy(s,i),pf(a,o);var u=pf(a,i);for(o=0;o<c.length;o+=2){var p=c[o],h=c[o+1];p==="style"?Ky(s,h):p==="dangerouslySetInnerHTML"?Vy(s,h):p==="children"?aa(s,h):Pp(s,p,h,u)}switch(a){case"input":lf(s,i);break;case"textarea":Wy(s,i);break;case"select":var f=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var m=i.value;m!=null?Mi(s,!!i.multiple,m,!1):f!==!!i.multiple&&(i.defaultValue!=null?Mi(s,!!i.multiple,i.defaultValue,!0):Mi(s,!!i.multiple,i.multiple?[]:"",!1))}s[ma]=i}catch(R){Nt(t,t.return,R)}}break;case 6:if(tr(e,t),mr(t),r&4){if(t.stateNode===null)throw Error(le(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(R){Nt(t,t.return,R)}}break;case 3:if(tr(e,t),mr(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{da(e.containerInfo)}catch(R){Nt(t,t.return,R)}break;case 4:tr(e,t),mr(t);break;case 13:tr(e,t),mr(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(dh=jt())),r&4&&em(t);break;case 22:if(p=n!==null&&n.memoizedState!==null,t.mode&1?(dn=(u=dn)||p,tr(e,t),dn=u):tr(e,t),mr(t),r&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!p&&t.mode&1)for(_e=t,p=t.child;p!==null;){for(h=_e=p;_e!==null;){switch(f=_e,m=f.child,f.tag){case 0:case 11:case 14:case 15:Ko(4,f,f.return);break;case 1:Pi(f,f.return);var b=f.stateNode;if(typeof b.componentWillUnmount=="function"){r=f,n=f.return;try{e=r,b.props=e.memoizedProps,b.state=e.memoizedState,b.componentWillUnmount()}catch(R){Nt(r,n,R)}}break;case 5:Pi(f,f.return);break;case 22:if(f.memoizedState!==null){nm(h);continue}}m!==null?(m.return=f,_e=m):nm(h)}p=p.sibling}e:for(p=null,h=t;;){if(h.tag===5){if(p===null){p=h;try{s=h.stateNode,u?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=h.stateNode,c=h.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,a.style.display=Yy("display",o))}catch(R){Nt(t,t.return,R)}}}else if(h.tag===6){if(p===null)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(R){Nt(t,t.return,R)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===t)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===t)break e;for(;h.sibling===null;){if(h.return===null||h.return===t)break e;p===h&&(p=null),h=h.return}p===h&&(p=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:tr(e,t),mr(t),r&4&&em(t);break;case 21:break;default:tr(e,t),mr(t)}}function mr(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(__(n)){var r=n;break e}n=n.return}throw Error(le(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(aa(s,""),r.flags&=-33);var i=Zg(t);Hf(t,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,a=Zg(t);zf(t,a,o);break;default:throw Error(le(161))}}catch(c){Nt(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function zS(t,e,n){_e=t,b_(t)}function b_(t,e,n){for(var r=(t.mode&1)!==0;_e!==null;){var s=_e,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||Dl;if(!o){var a=s.alternate,c=a!==null&&a.memoizedState!==null||dn;a=Dl;var u=dn;if(Dl=o,(dn=c)&&!u)for(_e=s;_e!==null;)o=_e,c=o.child,o.tag===22&&o.memoizedState!==null?rm(s):c!==null?(c.return=o,_e=c):rm(s);for(;i!==null;)_e=i,b_(i),i=i.sibling;_e=s,Dl=a,dn=u}tm(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,_e=i):tm(t)}}function tm(t){for(;_e!==null;){var e=_e;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:dn||fu(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!dn)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:nr(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&$g(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}$g(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var p=u.memoizedState;if(p!==null){var h=p.dehydrated;h!==null&&da(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(le(163))}dn||e.flags&512&&Uf(e)}catch(f){Nt(e,e.return,f)}}if(e===t){_e=null;break}if(n=e.sibling,n!==null){n.return=e.return,_e=n;break}_e=e.return}}function nm(t){for(;_e!==null;){var e=_e;if(e===t){_e=null;break}var n=e.sibling;if(n!==null){n.return=e.return,_e=n;break}_e=e.return}}function rm(t){for(;_e!==null;){var e=_e;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{fu(4,e)}catch(c){Nt(e,n,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(c){Nt(e,s,c)}}var i=e.return;try{Uf(e)}catch(c){Nt(e,i,c)}break;case 5:var o=e.return;try{Uf(e)}catch(c){Nt(e,o,c)}}}catch(c){Nt(e,e.return,c)}if(e===t){_e=null;break}var a=e.sibling;if(a!==null){a.return=e.return,_e=a;break}_e=e.return}}var HS=Math.ceil,Oc=Hr.ReactCurrentDispatcher,ch=Hr.ReactCurrentOwner,Xn=Hr.ReactCurrentBatchConfig,ct=0,Jt=null,zt=null,rn=0,Nn=0,Li=Is(0),Yt=0,ba=null,Js=0,pu=0,uh=0,Xo=null,kn=null,dh=0,Ji=1/0,wr=null,Pc=!1,Wf=null,fs=null,Ml=!1,is=null,Lc=0,Qo=0,Gf=null,ec=-1,tc=0;function xn(){return ct&6?jt():ec!==-1?ec:ec=jt()}function ps(t){return t.mode&1?ct&2&&rn!==0?rn&-rn:IS.transition!==null?(tc===0&&(tc=ov()),tc):(t=mt,t!==0||(t=window.event,t=t===void 0?16:pv(t.type)),t):1}function lr(t,e,n,r){if(50<Qo)throw Qo=0,Gf=null,Error(le(185));Fa(t,n,r),(!(ct&2)||t!==Jt)&&(t===Jt&&(!(ct&2)&&(pu|=n),Yt===4&&ns(t,rn)),Pn(t,r),n===1&&ct===0&&!(e.mode&1)&&(Ji=jt()+500,cu&&ks()))}function Pn(t,e){var n=t.callbackNode;Ib(t,e);var r=mc(t,t===Jt?rn:0);if(r===0)n!==null&&fg(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&fg(n),e===1)t.tag===0?TS(sm.bind(null,t)):Pv(sm.bind(null,t)),ES(function(){!(ct&6)&&ks()}),n=null;else{switch(av(r)){case 1:n=jp;break;case 4:n=sv;break;case 16:n=gc;break;case 536870912:n=iv;break;default:n=gc}n=R_(n,S_.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function S_(t,e){if(ec=-1,tc=0,ct&6)throw Error(le(327));var n=t.callbackNode;if(Bi()&&t.callbackNode!==n)return null;var r=mc(t,t===Jt?rn:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=Dc(t,r);else{e=r;var s=ct;ct|=2;var i=T_();(Jt!==t||rn!==e)&&(wr=null,Ji=jt()+500,Vs(t,e));do try{VS();break}catch(a){C_(t,a)}while(!0);Qp(),Oc.current=i,ct=s,zt!==null?e=0:(Jt=null,rn=0,e=Yt)}if(e!==0){if(e===2&&(s=vf(t),s!==0&&(r=s,e=Vf(t,s))),e===1)throw n=ba,Vs(t,0),ns(t,r),Pn(t,jt()),n;if(e===6)ns(t,r);else{if(s=t.current.alternate,!(r&30)&&!WS(s)&&(e=Dc(t,r),e===2&&(i=vf(t),i!==0&&(r=i,e=Vf(t,i))),e===1))throw n=ba,Vs(t,0),ns(t,r),Pn(t,jt()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(le(345));case 2:Ns(t,kn,wr);break;case 3:if(ns(t,r),(r&130023424)===r&&(e=dh+500-jt(),10<e)){if(mc(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){xn(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=If(Ns.bind(null,t,kn,wr),e);break}Ns(t,kn,wr);break;case 4:if(ns(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var o=31-ar(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=jt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*HS(r/1960))-r,10<r){t.timeoutHandle=If(Ns.bind(null,t,kn,wr),r);break}Ns(t,kn,wr);break;case 5:Ns(t,kn,wr);break;default:throw Error(le(329))}}}return Pn(t,jt()),t.callbackNode===n?S_.bind(null,t):null}function Vf(t,e){var n=Xo;return t.current.memoizedState.isDehydrated&&(Vs(t,e).flags|=256),t=Dc(t,e),t!==2&&(e=kn,kn=n,e!==null&&Yf(e)),t}function Yf(t){kn===null?kn=t:kn.push.apply(kn,t)}function WS(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!ur(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function ns(t,e){for(e&=~uh,e&=~pu,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-ar(e),r=1<<n;t[n]=-1,e&=~r}}function sm(t){if(ct&6)throw Error(le(327));Bi();var e=mc(t,0);if(!(e&1))return Pn(t,jt()),null;var n=Dc(t,e);if(t.tag!==0&&n===2){var r=vf(t);r!==0&&(e=r,n=Vf(t,r))}if(n===1)throw n=ba,Vs(t,0),ns(t,e),Pn(t,jt()),n;if(n===6)throw Error(le(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Ns(t,kn,wr),Pn(t,jt()),null}function fh(t,e){var n=ct;ct|=1;try{return t(e)}finally{ct=n,ct===0&&(Ji=jt()+500,cu&&ks())}}function qs(t){is!==null&&is.tag===0&&!(ct&6)&&Bi();var e=ct;ct|=1;var n=Xn.transition,r=mt;try{if(Xn.transition=null,mt=1,t)return t()}finally{mt=r,Xn.transition=n,ct=e,!(ct&6)&&ks()}}function ph(){Nn=Li.current,wt(Li)}function Vs(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,xS(n)),zt!==null)for(n=zt.return;n!==null;){var r=n;switch(Yp(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Ec();break;case 3:Xi(),wt(Rn),wt(fn),nh();break;case 5:th(r);break;case 4:Xi();break;case 13:wt(Ot);break;case 19:wt(Ot);break;case 10:Jp(r.type._context);break;case 22:case 23:ph()}n=n.return}if(Jt=t,zt=t=hs(t.current,null),rn=Nn=e,Yt=0,ba=null,uh=pu=Js=0,kn=Xo=null,Us!==null){for(e=0;e<Us.length;e++)if(n=Us[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}n.pending=r}Us=null}return t}function C_(t,e){do{var n=zt;try{if(Qp(),Jl.current=Rc,Ac){for(var r=Lt.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Ac=!1}if(Qs=0,Xt=Gt=Lt=null,Yo=!1,_a=0,ch.current=null,n===null||n.return===null){Yt=1,ba=e,zt=null;break}e:{var i=t,o=n.return,a=n,c=e;if(e=rn,a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var u=c,p=a,h=p.tag;if(!(p.mode&1)&&(h===0||h===11||h===15)){var f=p.alternate;f?(p.updateQueue=f.updateQueue,p.memoizedState=f.memoizedState,p.lanes=f.lanes):(p.updateQueue=null,p.memoizedState=null)}var m=Gg(o);if(m!==null){m.flags&=-257,Vg(m,o,a,i,e),m.mode&1&&Wg(i,u,e),e=m,c=u;var b=e.updateQueue;if(b===null){var R=new Set;R.add(c),e.updateQueue=R}else b.add(c);break e}else{if(!(e&1)){Wg(i,u,e),hh();break e}c=Error(le(426))}}else if(Rt&&a.mode&1){var W=Gg(o);if(W!==null){!(W.flags&65536)&&(W.flags|=256),Vg(W,o,a,i,e),Kp(Qi(c,a));break e}}i=c=Qi(c,a),Yt!==4&&(Yt=2),Xo===null?Xo=[i]:Xo.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var d=a_(i,c,e);Fg(i,d);break e;case 1:a=c;var I=i.type,S=i.stateNode;if(!(i.flags&128)&&(typeof I.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(fs===null||!fs.has(S)))){i.flags|=65536,e&=-e,i.lanes|=e;var k=l_(i,a,e);Fg(i,k);break e}}i=i.return}while(i!==null)}k_(n)}catch($){e=$,zt===n&&n!==null&&(zt=n=n.return);continue}break}while(!0)}function T_(){var t=Oc.current;return Oc.current=Rc,t===null?Rc:t}function hh(){(Yt===0||Yt===3||Yt===2)&&(Yt=4),Jt===null||!(Js&268435455)&&!(pu&268435455)||ns(Jt,rn)}function Dc(t,e){var n=ct;ct|=2;var r=T_();(Jt!==t||rn!==e)&&(wr=null,Vs(t,e));do try{GS();break}catch(s){C_(t,s)}while(!0);if(Qp(),ct=n,Oc.current=r,zt!==null)throw Error(le(261));return Jt=null,rn=0,Yt}function GS(){for(;zt!==null;)I_(zt)}function VS(){for(;zt!==null&&!yb();)I_(zt)}function I_(t){var e=A_(t.alternate,t,Nn);t.memoizedProps=t.pendingProps,e===null?k_(t):zt=e,ch.current=null}function k_(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=$S(n,e),n!==null){n.flags&=32767,zt=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Yt=6,zt=null;return}}else if(n=FS(n,e,Nn),n!==null){zt=n;return}if(e=e.sibling,e!==null){zt=e;return}zt=e=t}while(e!==null);Yt===0&&(Yt=5)}function Ns(t,e,n){var r=mt,s=Xn.transition;try{Xn.transition=null,mt=1,YS(t,e,n,r)}finally{Xn.transition=s,mt=r}return null}function YS(t,e,n,r){do Bi();while(is!==null);if(ct&6)throw Error(le(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(le(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(kb(t,i),t===Jt&&(zt=Jt=null,rn=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Ml||(Ml=!0,R_(gc,function(){return Bi(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=Xn.transition,Xn.transition=null;var o=mt;mt=1;var a=ct;ct|=4,ch.current=null,US(t,n),E_(n,t),pS(Cf),yc=!!Sf,Cf=Sf=null,t.current=n,zS(n),vb(),ct=a,mt=o,Xn.transition=i}else t.current=n;if(Ml&&(Ml=!1,is=t,Lc=s),i=t.pendingLanes,i===0&&(fs=null),Eb(n.stateNode),Pn(t,jt()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(Pc)throw Pc=!1,t=Wf,Wf=null,t;return Lc&1&&t.tag!==0&&Bi(),i=t.pendingLanes,i&1?t===Gf?Qo++:(Qo=0,Gf=t):Qo=0,ks(),null}function Bi(){if(is!==null){var t=av(Lc),e=Xn.transition,n=mt;try{if(Xn.transition=null,mt=16>t?16:t,is===null)var r=!1;else{if(t=is,is=null,Lc=0,ct&6)throw Error(le(331));var s=ct;for(ct|=4,_e=t.current;_e!==null;){var i=_e,o=i.child;if(_e.flags&16){var a=i.deletions;if(a!==null){for(var c=0;c<a.length;c++){var u=a[c];for(_e=u;_e!==null;){var p=_e;switch(p.tag){case 0:case 11:case 15:Ko(8,p,i)}var h=p.child;if(h!==null)h.return=p,_e=h;else for(;_e!==null;){p=_e;var f=p.sibling,m=p.return;if(v_(p),p===u){_e=null;break}if(f!==null){f.return=m,_e=f;break}_e=m}}}var b=i.alternate;if(b!==null){var R=b.child;if(R!==null){b.child=null;do{var W=R.sibling;R.sibling=null,R=W}while(R!==null)}}_e=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,_e=o;else e:for(;_e!==null;){if(i=_e,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Ko(9,i,i.return)}var d=i.sibling;if(d!==null){d.return=i.return,_e=d;break e}_e=i.return}}var I=t.current;for(_e=I;_e!==null;){o=_e;var S=o.child;if(o.subtreeFlags&2064&&S!==null)S.return=o,_e=S;else e:for(o=I;_e!==null;){if(a=_e,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:fu(9,a)}}catch($){Nt(a,a.return,$)}if(a===o){_e=null;break e}var k=a.sibling;if(k!==null){k.return=a.return,_e=k;break e}_e=a.return}}if(ct=s,ks(),_r&&typeof _r.onPostCommitFiberRoot=="function")try{_r.onPostCommitFiberRoot(su,t)}catch{}r=!0}return r}finally{mt=n,Xn.transition=e}}return!1}function im(t,e,n){e=Qi(n,e),e=a_(t,e,1),t=ds(t,e,1),e=xn(),t!==null&&(Fa(t,1,e),Pn(t,e))}function Nt(t,e,n){if(t.tag===3)im(t,t,n);else for(;e!==null;){if(e.tag===3){im(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(fs===null||!fs.has(r))){t=Qi(n,t),t=l_(e,t,1),e=ds(e,t,1),t=xn(),e!==null&&(Fa(e,1,t),Pn(e,t));break}}e=e.return}}function KS(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=xn(),t.pingedLanes|=t.suspendedLanes&n,Jt===t&&(rn&n)===n&&(Yt===4||Yt===3&&(rn&130023424)===rn&&500>jt()-dh?Vs(t,0):uh|=n),Pn(t,e)}function w_(t,e){e===0&&(t.mode&1?(e=Tl,Tl<<=1,!(Tl&130023424)&&(Tl=4194304)):e=1);var n=xn();t=$r(t,e),t!==null&&(Fa(t,e,n),Pn(t,n))}function XS(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),w_(t,n)}function QS(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(le(314))}r!==null&&r.delete(e),w_(t,n)}var A_;A_=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Rn.current)wn=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return wn=!1,jS(t,e,n);wn=!!(t.flags&131072)}else wn=!1,Rt&&e.flags&1048576&&Lv(e,Cc,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Zl(t,e),t=e.pendingProps;var s=Vi(e,fn.current);$i(e,n),s=sh(null,e,r,t,s,n);var i=ih();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,On(r)?(i=!0,bc(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Zp(e),s.updater=du,e.stateNode=s,s._reactInternals=e,Lf(e,r,t,n),e=Nf(null,e,r,!0,i,n)):(e.tag=0,Rt&&i&&Vp(e),vn(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(Zl(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=qS(r),t=nr(r,t),s){case 0:e=Mf(null,e,r,t,n);break e;case 1:e=Xg(null,e,r,t,n);break e;case 11:e=Yg(null,e,r,t,n);break e;case 14:e=Kg(null,e,r,nr(r.type,t),n);break e}throw Error(le(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:nr(r,s),Mf(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:nr(r,s),Xg(t,e,r,s,n);case 3:e:{if(f_(e),t===null)throw Error(le(387));r=e.pendingProps,i=e.memoizedState,s=i.element,$v(t,e),kc(e,r,null,n);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=Qi(Error(le(423)),e),e=Qg(t,e,r,n,s);break e}else if(r!==s){s=Qi(Error(le(424)),e),e=Qg(t,e,r,n,s);break e}else for(jn=us(e.stateNode.containerInfo.firstChild),Fn=e,Rt=!0,sr=null,n=jv(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Yi(),r===s){e=Br(t,e,n);break e}vn(t,e,r,n)}e=e.child}return e;case 5:return Bv(e),t===null&&Rf(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,o=s.children,Tf(r,s)?o=null:i!==null&&Tf(r,i)&&(e.flags|=32),d_(t,e),vn(t,e,o,n),e.child;case 6:return t===null&&Rf(e),null;case 13:return p_(t,e,n);case 4:return eh(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Ki(e,null,r,n):vn(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:nr(r,s),Yg(t,e,r,s,n);case 7:return vn(t,e,e.pendingProps,n),e.child;case 8:return vn(t,e,e.pendingProps.children,n),e.child;case 12:return vn(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,Ct(Tc,r._currentValue),r._currentValue=o,i!==null)if(ur(i.value,o)){if(i.children===s.children&&!Rn.current){e=Br(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var c=a.firstContext;c!==null;){if(c.context===r){if(i.tag===1){c=Mr(-1,n&-n),c.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var p=u.pending;p===null?c.next=c:(c.next=p.next,p.next=c),u.pending=c}}i.lanes|=n,c=i.alternate,c!==null&&(c.lanes|=n),Of(i.return,n,e),a.lanes|=n;break}c=c.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(le(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),Of(o,n,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}vn(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,$i(e,n),s=Qn(s),r=r(s),e.flags|=1,vn(t,e,r,n),e.child;case 14:return r=e.type,s=nr(r,e.pendingProps),s=nr(r.type,s),Kg(t,e,r,s,n);case 15:return c_(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:nr(r,s),Zl(t,e),e.tag=1,On(r)?(t=!0,bc(e)):t=!1,$i(e,n),o_(e,r,s),Lf(e,r,s,n),Nf(null,e,r,!0,t,n);case 19:return h_(t,e,n);case 22:return u_(t,e,n)}throw Error(le(156,e.tag))};function R_(t,e){return rv(t,e)}function JS(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Yn(t,e,n,r){return new JS(t,e,n,r)}function gh(t){return t=t.prototype,!(!t||!t.isReactComponent)}function qS(t){if(typeof t=="function")return gh(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Dp)return 11;if(t===Mp)return 14}return 2}function hs(t,e){var n=t.alternate;return n===null?(n=Yn(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function nc(t,e,n,r,s,i){var o=2;if(r=t,typeof t=="function")gh(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Si:return Ys(n.children,s,i,e);case Lp:o=8,s|=8;break;case nf:return t=Yn(12,n,e,s|2),t.elementType=nf,t.lanes=i,t;case rf:return t=Yn(13,n,e,s),t.elementType=rf,t.lanes=i,t;case sf:return t=Yn(19,n,e,s),t.elementType=sf,t.lanes=i,t;case By:return hu(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Fy:o=10;break e;case $y:o=9;break e;case Dp:o=11;break e;case Mp:o=14;break e;case Zr:o=16,r=null;break e}throw Error(le(130,t==null?t:typeof t,""))}return e=Yn(o,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function Ys(t,e,n,r){return t=Yn(7,t,r,e),t.lanes=n,t}function hu(t,e,n,r){return t=Yn(22,t,r,e),t.elementType=By,t.lanes=n,t.stateNode={isHidden:!1},t}function jd(t,e,n){return t=Yn(6,t,null,e),t.lanes=n,t}function Fd(t,e,n){return e=Yn(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function ZS(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=vd(0),this.expirationTimes=vd(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=vd(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function mh(t,e,n,r,s,i,o,a,c){return t=new ZS(t,e,n,a,c),e===1?(e=1,i===!0&&(e|=8)):e=0,i=Yn(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Zp(i),t}function e2(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:bi,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function O_(t){if(!t)return Es;t=t._reactInternals;e:{if(ri(t)!==t||t.tag!==1)throw Error(le(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(On(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(le(171))}if(t.tag===1){var n=t.type;if(On(n))return Ov(t,n,e)}return e}function P_(t,e,n,r,s,i,o,a,c){return t=mh(n,r,!0,t,s,i,o,a,c),t.context=O_(null),n=t.current,r=xn(),s=ps(n),i=Mr(r,s),i.callback=e??null,ds(n,i,s),t.current.lanes=s,Fa(t,s,r),Pn(t,r),t}function gu(t,e,n,r){var s=e.current,i=xn(),o=ps(s);return n=O_(n),e.context===null?e.context=n:e.pendingContext=n,e=Mr(i,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=ds(s,e,o),t!==null&&(lr(t,s,o,i),Ql(t,s,o)),o}function Mc(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function om(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function yh(t,e){om(t,e),(t=t.alternate)&&om(t,e)}function t2(){return null}var L_=typeof reportError=="function"?reportError:function(t){console.error(t)};function vh(t){this._internalRoot=t}mu.prototype.render=vh.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(le(409));gu(t,e,null,null)};mu.prototype.unmount=vh.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;qs(function(){gu(null,t,null,null)}),e[Fr]=null}};function mu(t){this._internalRoot=t}mu.prototype.unstable_scheduleHydration=function(t){if(t){var e=uv();t={blockedOn:null,target:t,priority:e};for(var n=0;n<ts.length&&e!==0&&e<ts[n].priority;n++);ts.splice(n,0,t),n===0&&fv(t)}};function _h(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function yu(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function am(){}function n2(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var u=Mc(o);i.call(u)}}var o=P_(e,r,t,0,null,!1,!1,"",am);return t._reactRootContainer=o,t[Fr]=o.current,ha(t.nodeType===8?t.parentNode:t),qs(),o}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var a=r;r=function(){var u=Mc(c);a.call(u)}}var c=mh(t,0,!1,null,null,!1,!1,"",am);return t._reactRootContainer=c,t[Fr]=c.current,ha(t.nodeType===8?t.parentNode:t),qs(function(){gu(e,c,n,r)}),c}function vu(t,e,n,r,s){var i=n._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var a=s;s=function(){var c=Mc(o);a.call(c)}}gu(e,o,t,s)}else o=n2(n,e,t,s,r);return Mc(o)}lv=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=$o(e.pendingLanes);n!==0&&(Fp(e,n|1),Pn(e,jt()),!(ct&6)&&(Ji=jt()+500,ks()))}break;case 13:qs(function(){var r=$r(t,1);if(r!==null){var s=xn();lr(r,t,1,s)}}),yh(t,1)}};$p=function(t){if(t.tag===13){var e=$r(t,134217728);if(e!==null){var n=xn();lr(e,t,134217728,n)}yh(t,134217728)}};cv=function(t){if(t.tag===13){var e=ps(t),n=$r(t,e);if(n!==null){var r=xn();lr(n,t,e,r)}yh(t,e)}};uv=function(){return mt};dv=function(t,e){var n=mt;try{return mt=t,e()}finally{mt=n}};gf=function(t,e,n){switch(e){case"input":if(lf(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=lu(r);if(!s)throw Error(le(90));zy(r),lf(r,s)}}}break;case"textarea":Wy(t,n);break;case"select":e=n.value,e!=null&&Mi(t,!!n.multiple,e,!1)}};Jy=fh;qy=qs;var r2={usingClientEntryPoint:!1,Events:[Ba,ki,lu,Xy,Qy,fh]},Oo={findFiberByHostInstance:Bs,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},s2={bundleType:Oo.bundleType,version:Oo.version,rendererPackageName:Oo.rendererPackageName,rendererConfig:Oo.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Hr.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=tv(t),t===null?null:t.stateNode},findFiberByHostInstance:Oo.findFiberByHostInstance||t2,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Nl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Nl.isDisabled&&Nl.supportsFiber)try{su=Nl.inject(s2),_r=Nl}catch{}}Bn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=r2;Bn.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!_h(e))throw Error(le(200));return e2(t,e,null,n)};Bn.createRoot=function(t,e){if(!_h(t))throw Error(le(299));var n=!1,r="",s=L_;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=mh(t,1,!1,null,null,n,!1,r,s),t[Fr]=e.current,ha(t.nodeType===8?t.parentNode:t),new vh(e)};Bn.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(le(188)):(t=Object.keys(t).join(","),Error(le(268,t)));return t=tv(e),t=t===null?null:t.stateNode,t};Bn.flushSync=function(t){return qs(t)};Bn.hydrate=function(t,e,n){if(!yu(e))throw Error(le(200));return vu(null,t,e,!0,n)};Bn.hydrateRoot=function(t,e,n){if(!_h(t))throw Error(le(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",o=L_;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=P_(e,null,t,1,n??null,s,!1,i,o),t[Fr]=e.current,ha(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new mu(e)};Bn.render=function(t,e,n){if(!yu(e))throw Error(le(200));return vu(null,t,e,!1,n)};Bn.unmountComponentAtNode=function(t){if(!yu(t))throw Error(le(40));return t._reactRootContainer?(qs(function(){vu(null,null,t,!1,function(){t._reactRootContainer=null,t[Fr]=null})}),!0):!1};Bn.unstable_batchedUpdates=fh;Bn.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!yu(n))throw Error(le(200));if(t==null||t._reactInternals===void 0)throw Error(le(38));return vu(t,e,n,!1,r)};Bn.version="18.3.1-next-f1338f8080-20240426";function D_(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(D_)}catch(t){console.error(t)}}D_(),Dy.exports=Bn;var i2=Dy.exports,lm=i2;ef.createRoot=lm.createRoot,ef.hydrateRoot=lm.hydrateRoot;const o2=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},a2=1280,l2=720,c2=({onStartConfig:t,audioSettings:e,onAudioSettingsChange:n})=>{const[r,s]=U.useState(!1),[i,o]=U.useState(""),[a,c]=U.useState(!1),[u,p]=U.useState(!1),[h,f]=U.useState(!1),[m,b]=U.useState(1);U.useEffect(()=>{const k=()=>{const $=window.innerWidth/a2,B=window.innerHeight/l2;b(Math.min($,B))};return k(),window.addEventListener("resize",k),()=>window.removeEventListener("resize",k)},[]);const R=9*m,W=300*m,d=1.2*m,I=`${1*m}rem 0`,S={fontSize:`${d}rem`,padding:I,background:"transparent",border:"2px solid #e94560",color:"#fff",cursor:"pointer",transition:"all 0.3s",borderRadius:4*m,fontWeight:"bold",letterSpacing:"1px",width:"100%"};return l.jsxs("div",{className:"screen title-screen",style:{height:"100dvh",width:"100vw",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative",overflow:"hidden",color:"white"},children:[l.jsx("div",{style:{position:"absolute",inset:0,backgroundImage:`url(${o2("/title/background.png")})`,backgroundSize:"cover",backgroundPosition:"center",zIndex:0}}),l.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",zIndex:-1}}),l.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(0, 0, 0, 0.3)",zIndex:1}}),l.jsxs("div",{style:{position:"relative",zIndex:2,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-end",height:"100%",width:"100%",paddingBottom:`${1*m}rem`,boxSizing:"border-box"},children:[l.jsx("div",{style:{fontFamily:"Tamanegi, sans-serif",fontSize:`${R}rem`,color:"#fff",textShadow:"0 0 30px rgba(233, 69, 96, 0.9), 0 0 60px rgba(233, 69, 96, 0.5), 3px 3px 6px rgba(0,0,0,0.9)",letterSpacing:`${.5*m}rem`,whiteSpace:"nowrap",marginBottom:`${.5*m}rem`},children:""}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[!r&&!u&&!h?l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:`${1*m}rem`,width:W},children:[l.jsx("button",{onClick:()=>t("CPU"),style:S,onMouseOver:k=>k.currentTarget.style.background="#e94560",onMouseOut:k=>k.currentTarget.style.background="transparent",children:""}),l.jsx("button",{onClick:()=>p(!0),style:{...S,border:"2px solid #4ade80",background:"rgba(74, 222, 128, 0.1)"},onMouseOver:k=>k.currentTarget.style.background="#4ade80",onMouseOut:k=>k.currentTarget.style.background="rgba(74, 222, 128, 0.1)",children:""}),l.jsx("button",{onClick:()=>f(!0),style:{...S,border:"2px solid #60a5fa",background:"rgba(96, 165, 250, 0.1)"},onMouseOver:k=>k.currentTarget.style.background="#60a5fa",onMouseOut:k=>k.currentTarget.style.background="rgba(96, 165, 250, 0.1)",children:""})]}):h?l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:`${1*m}rem`,width:W},children:[l.jsx("p",{style:{textAlign:"center",fontSize:`${1.2*m}rem`,marginBottom:`${.5*m}rem`,color:"#fff"},children:""}),l.jsx("button",{onClick:()=>{f(!1),t("HOST")},style:{...S,border:"2px solid #60a5fa"},onMouseOver:k=>k.currentTarget.style.background="#60a5fa",onMouseOut:k=>k.currentTarget.style.background="transparent",children:""}),l.jsx("button",{onClick:()=>{f(!1),s(!0)},style:{...S,border:"2px solid #60a5fa"},onMouseOver:k=>k.currentTarget.style.background="#60a5fa",onMouseOut:k=>k.currentTarget.style.background="transparent",children:""}),l.jsx("button",{onClick:()=>f(!1),style:{...S,border:"none",fontSize:`${1*m}rem`,color:"#888"},children:""})]}):u?l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:`${1*m}rem`,width:W},children:[l.jsx("p",{style:{textAlign:"center",fontSize:`${1.2*m}rem`,marginBottom:`${.5*m}rem`,color:"#fff"},children:""}),l.jsx("button",{onClick:()=>{p(!1),t("CASUAL_MATCH")},style:{...S,border:"2px solid #4ade80"},onMouseOver:k=>k.currentTarget.style.background="#4ade80",onMouseOut:k=>k.currentTarget.style.background="transparent",children:""}),l.jsx("p",{style:{textAlign:"center",fontSize:`${.8*m}rem`,color:"#888",marginTop:`-${.5*m}rem`,marginBottom:`${.5*m}rem`},children:""}),l.jsx("button",{disabled:!0,style:{...S,border:"2px solid #666",color:"#666",cursor:"not-allowed",opacity:.5},children:""}),l.jsx("p",{style:{textAlign:"center",fontSize:`${.8*m}rem`,color:"#666",marginTop:`-${.5*m}rem`,marginBottom:`${.5*m}rem`},children:"Coming Soon..."}),l.jsx("button",{onClick:()=>p(!1),style:{...S,border:"none",fontSize:`${1*m}rem`,color:"#888"},children:""})]}):l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:`${1*m}rem`,width:W},children:[l.jsx("input",{type:"text",placeholder:"ID",value:i,onChange:k=>o(k.target.value),style:{padding:`${1*m}rem`,fontSize:`${1.2*m}rem`,background:"rgba(255,255,255,0.1)",border:"1px solid #444",color:"white",borderRadius:4*m,textAlign:"center"}}),l.jsx("button",{onClick:()=>t("JOIN",i),disabled:!i,style:{...S,opacity:i?1:.5},children:""}),l.jsx("button",{onClick:()=>s(!1),style:{...S,border:"none",fontSize:`${1*m}rem`,color:"#888"},children:""})]}),l.jsx("p",{style:{marginTop:`${1.5*m}rem`,opacity:.5,fontSize:`${.8*m}rem`},children:"Ver 1.03 Beta"})]})]}),l.jsxs("button",{onClick:()=>c(!0),style:{position:"absolute",top:20*m,right:20*m,zIndex:10,background:"rgba(0, 0, 0, 0.5)",border:"2px solid rgba(255, 255, 255, 0.3)",borderRadius:8*m,padding:`${.6*m}rem ${1*m}rem`,color:"white",fontSize:`${1*m}rem`,cursor:"pointer",display:"flex",alignItems:"center",gap:8*m,transition:"all 0.2s"},onMouseOver:k=>{k.currentTarget.style.background="rgba(233, 69, 96, 0.6)",k.currentTarget.style.borderColor="#e94560"},onMouseOut:k=>{k.currentTarget.style.background="rgba(0, 0, 0, 0.5)",k.currentTarget.style.borderColor="rgba(255, 255, 255, 0.3)"},children:[l.jsx("span",{style:{fontSize:`${1.2*m}rem`},children:""}),""]}),a&&l.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.8)",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>c(!1),children:l.jsxs("div",{style:{background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",borderRadius:12*m,padding:`${2*m}rem`,minWidth:400*m,maxWidth:500*m,border:"2px solid rgba(255, 255, 255, 0.2)",boxShadow:"0 10px 40px rgba(0, 0, 0, 0.5)"},onClick:k=>k.stopPropagation(),children:[l.jsx("h2",{style:{margin:0,marginBottom:`${1.5*m}rem`,fontSize:`${1.8*m}rem`,color:"white",textAlign:"center"},children:""}),l.jsxs("div",{style:{marginBottom:`${1.5*m}rem`},children:[l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:`${.5*m}rem`},children:[l.jsx("span",{style:{color:"white",fontSize:`${1*m}rem`},children:"BGM"}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8*m,cursor:"pointer"},children:[l.jsx("input",{type:"checkbox",checked:e.bgmEnabled,onChange:k=>n({bgmEnabled:k.target.checked}),style:{width:18*m,height:18*m,cursor:"pointer"}}),l.jsx("span",{style:{color:e.bgmEnabled?"#4ade80":"#888",fontSize:`${.9*m}rem`},children:e.bgmEnabled?"ON":"OFF"})]})]}),l.jsx("input",{type:"range",min:0,max:1,step:.05,value:e.bgm,onChange:k=>n({bgm:parseFloat(k.target.value)}),disabled:!e.bgmEnabled,style:{width:"100%",height:8*m,cursor:e.bgmEnabled?"pointer":"not-allowed",opacity:e.bgmEnabled?1:.5}})]}),l.jsxs("div",{style:{marginBottom:`${1.5*m}rem`},children:[l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:`${.5*m}rem`},children:[l.jsx("span",{style:{color:"white",fontSize:`${1*m}rem`},children:""}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8*m,cursor:"pointer"},children:[l.jsx("input",{type:"checkbox",checked:e.seEnabled,onChange:k=>n({seEnabled:k.target.checked}),style:{width:18*m,height:18*m,cursor:"pointer"}}),l.jsx("span",{style:{color:e.seEnabled?"#4ade80":"#888",fontSize:`${.9*m}rem`},children:e.seEnabled?"ON":"OFF"})]})]}),l.jsx("input",{type:"range",min:0,max:1,step:.05,value:e.se,onChange:k=>n({se:parseFloat(k.target.value)}),disabled:!e.seEnabled,style:{width:"100%",height:8*m,cursor:e.seEnabled?"pointer":"not-allowed",opacity:e.seEnabled?1:.5}})]}),l.jsx("button",{onClick:()=>c(!1),style:{width:"100%",padding:`${.8*m}rem`,fontSize:`${1*m}rem`,background:"#e94560",border:"none",borderRadius:6*m,color:"white",cursor:"pointer",fontWeight:"bold",marginTop:`${.5*m}rem`},children:""})]})})]})},xh=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},u2=xh("/leaders/azya_leader.png"),d2=xh("/leaders/senka_leader.png"),f2=xh("/leaders/yoRuka_leader.png"),p2=1280,h2=720,g2=({onSelectClass:t,onBack:e,gameMode:n="CPU",aiDifficulty:r="NORMAL",onDifficultyChange:s,playerName:i,onPlayerNameChange:o,timerEnabled:a=!0,onTimerEnabledChange:c})=>{const[u,p]=U.useState(1);U.useEffect(()=>{const S=()=>{const k=window.innerWidth/p2,$=window.innerHeight/h2;p(Math.min(k,$))};return S(),window.addEventListener("resize",S),()=>window.removeEventListener("resize",S)},[]);const h=200*u,f=280*u,m=2*u,b=1.4*u,R=.75*u,W=.65*u,d=1.2*u,I=`${8*u}px ${16*u}px`;return l.jsxs("div",{className:"screen",style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"#1a1a2e",color:"white"},children:[l.jsx("h2",{style:{fontSize:`${m}rem`,marginBottom:`${.5*u}rem`,marginTop:0},children:""}),l.jsxs("div",{style:{marginBottom:`${.8*u}rem`,display:"flex",flexDirection:"column",alignItems:"center",gap:`${.3*u}rem`},children:[l.jsx("label",{style:{fontSize:`${.9*u}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif"},children:""}),l.jsx("input",{type:"text",value:i,onChange:S=>o(S.target.value),maxLength:12,placeholder:"",style:{padding:`${6*u}px ${12*u}px`,fontSize:`${.9*u}rem`,background:"#2d3748",border:"2px solid #4a5568",borderRadius:6*u,color:"white",outline:"none",width:180*u,textAlign:"center",fontFamily:"Tamanegi, sans-serif"},onFocus:S=>S.target.style.borderColor="#63b3ed",onBlur:S=>S.target.style.borderColor="#4a5568"})]}),l.jsxs("div",{style:{display:"flex",gap:`${d}rem`,marginBottom:`${1*u}rem`},children:[l.jsxs("div",{onClick:()=>t("SENKA"),style:{width:h,height:f,border:"1px solid #444",borderRadius:10*u,background:"linear-gradient(180deg, #2c0b0e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s",boxShadow:"0 4px 20px rgba(233, 69, 96, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:S=>S.currentTarget.style.transform="scale(1.05)",onMouseOut:S=>S.currentTarget.style.transform="scale(1)",children:[l.jsx("img",{src:d2,alt:"Senka",style:{width:"100%",height:"60%",objectFit:"cover"}}),l.jsxs("div",{style:{padding:`${6*u}px`,display:"flex",flexDirection:"column",alignItems:"center"},children:[l.jsx("h3",{style:{fontSize:`${b}rem`,color:"#e94560",margin:0},children:""}),l.jsx("p",{style:{color:"#aaa",margin:`${3*u}px 0`,fontSize:`${R}rem`,fontFamily:"Tamanegi, sans-serif"},children:" / "}),l.jsxs("p",{style:{padding:`0 ${.5*u}rem`,textAlign:"center",fontSize:`${W}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",lineHeight:1.3},children:["",l.jsx("br",{}),""]})]})]}),l.jsxs("div",{onClick:()=>t("AJA"),style:{width:h,height:f,border:"1px solid #444",borderRadius:10*u,background:"linear-gradient(180deg, #0f1c2e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s",boxShadow:"0 4px 20px rgba(69, 162, 233, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:S=>S.currentTarget.style.transform="scale(1.05)",onMouseOut:S=>S.currentTarget.style.transform="scale(1)",children:[l.jsx("img",{src:u2,alt:"Azya",style:{width:"100%",height:"60%",objectFit:"cover",objectPosition:"center top"}}),l.jsxs("div",{style:{padding:`${6*u}px`,display:"flex",flexDirection:"column",alignItems:"center"},children:[l.jsx("h3",{style:{fontSize:`${b}rem`,color:"#45a2e9",margin:0},children:""}),l.jsx("p",{style:{color:"#aaa",margin:`${3*u}px 0`,fontSize:`${R}rem`,fontFamily:"Tamanegi, sans-serif"},children:" / "}),l.jsxs("p",{style:{padding:`0 ${.5*u}rem`,textAlign:"center",fontSize:`${W}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",lineHeight:1.3},children:["",l.jsx("br",{}),""]})]})]}),l.jsxs("div",{onClick:()=>t("YORUKA"),style:{width:h,height:f,border:"1px solid #444",borderRadius:10*u,background:"linear-gradient(180deg, #1a0f2e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s",boxShadow:"0 4px 20px rgba(168, 85, 247, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:S=>S.currentTarget.style.transform="scale(1.05)",onMouseOut:S=>S.currentTarget.style.transform="scale(1)",children:[l.jsx("img",{src:f2,alt:"Yoruka",style:{width:"100%",height:"60%",objectFit:"cover"}}),l.jsxs("div",{style:{padding:`${6*u}px`,display:"flex",flexDirection:"column",alignItems:"center"},children:[l.jsx("h3",{style:{fontSize:`${b}rem`,color:"#a855f7",margin:0},children:"Y"}),l.jsx("p",{style:{color:"#aaa",margin:`${3*u}px 0`,fontSize:`${R}rem`,fontFamily:"Tamanegi, sans-serif"},children:" / "}),l.jsxs("p",{style:{padding:`0 ${.5*u}rem`,textAlign:"center",fontSize:`${W}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",lineHeight:1.3},children:["",l.jsx("br",{}),""]})]})]})]}),n==="CPU"&&s&&l.jsxs("div",{style:{marginBottom:`${.6*u}rem`,display:"flex",flexDirection:"column",alignItems:"center",gap:`${.3*u}rem`},children:[l.jsx("p",{style:{fontSize:`${.85*u}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",margin:0},children:""}),l.jsx("div",{style:{display:"flex",gap:`${.6*u}rem`},children:["EASY","NORMAL","HARD"].map(S=>l.jsx("button",{onClick:()=>s(S),style:{padding:`${6*u}px ${14*u}px`,fontSize:`${.8*u}rem`,background:r===S?S==="EASY"?"#48bb78":S==="NORMAL"?"#e94560":"#9f7aea":"transparent",border:`2px solid ${S==="EASY"?"#48bb78":S==="NORMAL"?"#e94560":"#9f7aea"}`,color:"#fff",cursor:"pointer",borderRadius:4*u,fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s"},children:S==="EASY"?"":S==="NORMAL"?"":""},S))}),l.jsxs("p",{style:{fontSize:`${.65*u}rem`,opacity:.6,fontFamily:"Tamanegi, sans-serif",margin:0},children:[r==="EASY"&&"CPU",r==="NORMAL"&&"CPU",r==="HARD"&&"CPU"]})]}),c&&l.jsxs("div",{style:{marginBottom:`${.6*u}rem`,display:"flex",flexDirection:"column",alignItems:"center",gap:`${.3*u}rem`},children:[l.jsx("p",{style:{fontSize:`${.85*u}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",margin:0},children:""}),l.jsxs("div",{style:{display:"flex",gap:`${.6*u}rem`},children:[l.jsx("button",{onClick:()=>c(!0),style:{padding:`${6*u}px ${14*u}px`,fontSize:`${.8*u}rem`,background:a?"#3182ce":"transparent",border:"2px solid #3182ce",color:"#fff",cursor:"pointer",borderRadius:4*u,fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s"},children:"ON (60)"}),l.jsx("button",{onClick:()=>c(!1),style:{padding:`${6*u}px ${14*u}px`,fontSize:`${.8*u}rem`,background:a?"transparent":"#718096",border:"2px solid #718096",color:"#fff",cursor:"pointer",borderRadius:4*u,fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s"},children:"OFF"})]}),l.jsx("p",{style:{fontSize:`${.65*u}rem`,opacity:.6,fontFamily:"Tamanegi, sans-serif",margin:0},children:a?"600":""})]}),l.jsx("button",{onClick:e,style:{background:"#333",padding:I,fontSize:`${.9*u}rem`,marginBottom:`${.5*u}rem`},children:""})]})};class m2{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(e){this.flush(),this._parts.push(e)}append(e){this._pieces.push(e)}flush(){if(this._pieces.length>0){const e=new Uint8Array(this._pieces);this._parts.push(e),this._pieces=[]}}toArrayBuffer(){const e=[];for(const n of this._parts)e.push(n);return y2(e).buffer}}function y2(t){let e=0;for(const s of t)e+=s.byteLength;const n=new Uint8Array(e);let r=0;for(const s of t){const i=new Uint8Array(s.buffer,s.byteOffset,s.byteLength);n.set(i,r),r+=s.byteLength}return n}function M_(t){return new v2(t).unpack()}function N_(t){const e=new _2,n=e.pack(t);return n instanceof Promise?n.then(()=>e.getBuffer()):e.getBuffer()}class v2{constructor(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){const e=this.unpack_uint8();if(e<128)return e;if((e^224)<32)return(e^224)-32;let n;if((n=e^160)<=15)return this.unpack_raw(n);if((n=e^176)<=15)return this.unpack_string(n);if((n=e^144)<=15)return this.unpack_array(n);if((n=e^128)<=15)return this.unpack_map(n);switch(e){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return n=this.unpack_uint16(),this.unpack_string(n);case 217:return n=this.unpack_uint32(),this.unpack_string(n);case 218:return n=this.unpack_uint16(),this.unpack_raw(n);case 219:return n=this.unpack_uint32(),this.unpack_raw(n);case 220:return n=this.unpack_uint16(),this.unpack_array(n);case 221:return n=this.unpack_uint32(),this.unpack_array(n);case 222:return n=this.unpack_uint16(),this.unpack_map(n);case 223:return n=this.unpack_uint32(),this.unpack_map(n)}}unpack_uint8(){const e=this.dataView[this.index]&255;return this.index++,e}unpack_uint16(){const e=this.read(2),n=(e[0]&255)*256+(e[1]&255);return this.index+=2,n}unpack_uint32(){const e=this.read(4),n=((e[0]*256+e[1])*256+e[2])*256+e[3];return this.index+=4,n}unpack_uint64(){const e=this.read(8),n=((((((e[0]*256+e[1])*256+e[2])*256+e[3])*256+e[4])*256+e[5])*256+e[6])*256+e[7];return this.index+=8,n}unpack_int8(){const e=this.unpack_uint8();return e<128?e:e-256}unpack_int16(){const e=this.unpack_uint16();return e<32768?e:e-65536}unpack_int32(){const e=this.unpack_uint32();return e<2**31?e:e-2**32}unpack_int64(){const e=this.unpack_uint64();return e<2**63?e:e-2**64}unpack_raw(e){if(this.length<this.index+e)throw new Error(`BinaryPackFailure: index is out of range ${this.index} ${e} ${this.length}`);const n=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,n}unpack_string(e){const n=this.read(e);let r=0,s="",i,o;for(;r<e;)i=n[r],i<160?(o=i,r++):(i^192)<32?(o=(i&31)<<6|n[r+1]&63,r+=2):(i^224)<16?(o=(i&15)<<12|(n[r+1]&63)<<6|n[r+2]&63,r+=3):(o=(i&7)<<18|(n[r+1]&63)<<12|(n[r+2]&63)<<6|n[r+3]&63,r+=4),s+=String.fromCodePoint(o);return this.index+=e,s}unpack_array(e){const n=new Array(e);for(let r=0;r<e;r++)n[r]=this.unpack();return n}unpack_map(e){const n={};for(let r=0;r<e;r++){const s=this.unpack();n[s]=this.unpack()}return n}unpack_float(){const e=this.unpack_uint32(),n=e>>31,r=(e>>23&255)-127,s=e&8388607|8388608;return(n===0?1:-1)*s*2**(r-23)}unpack_double(){const e=this.unpack_uint32(),n=this.unpack_uint32(),r=e>>31,s=(e>>20&2047)-1023,o=(e&1048575|1048576)*2**(s-20)+n*2**(s-52);return(r===0?1:-1)*o}read(e){const n=this.index;if(n+e<=this.length)return this.dataView.subarray(n,n+e);throw new Error("BinaryPackFailure: read index out of range")}}class _2{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(e){if(typeof e=="string")this.pack_string(e);else if(typeof e=="number")Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if(typeof e=="boolean")e===!0?this._bufferBuilder.append(195):e===!1&&this._bufferBuilder.append(194);else if(e===void 0)this._bufferBuilder.append(192);else if(typeof e=="object")if(e===null)this._bufferBuilder.append(192);else{const n=e.constructor;if(e instanceof Array){const r=this.pack_array(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else if(e instanceof ArrayBuffer)this.pack_bin(new Uint8Array(e));else if("BYTES_PER_ELEMENT"in e){const r=e;this.pack_bin(new Uint8Array(r.buffer,r.byteOffset,r.byteLength))}else if(e instanceof Date)this.pack_string(e.toString());else{if(e instanceof Blob)return e.arrayBuffer().then(r=>{this.pack_bin(new Uint8Array(r)),this._bufferBuilder.flush()});if(n==Object||n.toString().startsWith("class")){const r=this.pack_object(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else throw new Error(`Type "${n.toString()}" not yet supported`)}}else throw new Error(`Type "${typeof e}" not yet supported`);this._bufferBuilder.flush()}pack_bin(e){const n=e.length;if(n<=15)this.pack_uint8(160+n);else if(n<=65535)this._bufferBuilder.append(218),this.pack_uint16(n);else if(n<=4294967295)this._bufferBuilder.append(219),this.pack_uint32(n);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(e)}pack_string(e){const n=this._textEncoder.encode(e),r=n.length;if(r<=15)this.pack_uint8(176+r);else if(r<=65535)this._bufferBuilder.append(216),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(217),this.pack_uint32(r);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(n)}pack_array(e){const n=e.length;if(n<=15)this.pack_uint8(144+n);else if(n<=65535)this._bufferBuilder.append(220),this.pack_uint16(n);else if(n<=4294967295)this._bufferBuilder.append(221),this.pack_uint32(n);else throw new Error("Invalid length");const r=s=>{if(s<n){const i=this.pack(e[s]);return i instanceof Promise?i.then(()=>r(s+1)):r(s+1)}};return r(0)}pack_integer(e){if(e>=-32&&e<=127)this._bufferBuilder.append(e&255);else if(e>=0&&e<=255)this._bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&e<=127)this._bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&e<=65535)this._bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&e<=32767)this._bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&e<=4294967295)this._bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-2147483648&&e<=2147483647)this._bufferBuilder.append(210),this.pack_int32(e);else if(e>=-9223372036854776e3&&e<=9223372036854776e3)this._bufferBuilder.append(211),this.pack_int64(e);else if(e>=0&&e<=18446744073709552e3)this._bufferBuilder.append(207),this.pack_uint64(e);else throw new Error("Invalid integer")}pack_double(e){let n=0;e<0&&(n=1,e=-e);const r=Math.floor(Math.log(e)/Math.LN2),s=e/2**r-1,i=Math.floor(s*2**52),o=2**32,a=n<<31|r+1023<<20|i/o&1048575,c=i%o;this._bufferBuilder.append(203),this.pack_int32(a),this.pack_int32(c)}pack_object(e){const n=Object.keys(e),r=n.length;if(r<=15)this.pack_uint8(128+r);else if(r<=65535)this._bufferBuilder.append(222),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(223),this.pack_uint32(r);else throw new Error("Invalid length");const s=i=>{if(i<n.length){const o=n[i];if(e.hasOwnProperty(o)){this.pack(o);const a=this.pack(e[o]);if(a instanceof Promise)return a.then(()=>s(i+1))}return s(i+1)}};return s(0)}pack_uint8(e){this._bufferBuilder.append(e)}pack_uint16(e){this._bufferBuilder.append(e>>8),this._bufferBuilder.append(e&255)}pack_uint32(e){const n=e&4294967295;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255)}pack_uint64(e){const n=e/4294967296,r=e%2**32;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}pack_int8(e){this._bufferBuilder.append(e&255)}pack_int16(e){this._bufferBuilder.append((e&65280)>>8),this._bufferBuilder.append(e&255)}pack_int32(e){this._bufferBuilder.append(e>>>24&255),this._bufferBuilder.append((e&16711680)>>>16),this._bufferBuilder.append((e&65280)>>>8),this._bufferBuilder.append(e&255)}pack_int64(e){const n=Math.floor(e/4294967296),r=e%2**32;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}constructor(){this._bufferBuilder=new m2,this._textEncoder=new TextEncoder}}let j_=!0,F_=!0;function Uo(t,e,n){const r=t.match(e);return r&&r.length>=n&&parseFloat(r[n],10)}function si(t,e,n){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,s=r.addEventListener;r.addEventListener=function(o,a){if(o!==e)return s.apply(this,arguments);const c=u=>{const p=n(u);p&&(a.handleEvent?a.handleEvent(p):a(p))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,c),s.apply(this,[o,c])};const i=r.removeEventListener;r.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return i.apply(this,arguments);if(!this._eventMap[e].has(a))return i.apply(this,arguments);const c=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,i.apply(this,[o,c])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function x2(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(j_=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function E2(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(F_=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function $_(){if(typeof window=="object"){if(j_)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Eh(t,e){F_&&console.warn(t+" is deprecated, please use "+e+" instead.")}function b2(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const r=n.userAgentData.brands.find(s=>s.brand==="Chromium");if(r)return{browser:"chrome",version:parseInt(r.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(Uo(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(Uo(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(Uo(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=Uo(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function cm(t){return Object.prototype.toString.call(t)==="[object Object]"}function B_(t){return cm(t)?Object.keys(t).reduce(function(e,n){const r=cm(t[n]),s=r?B_(t[n]):t[n],i=r&&!Object.keys(s).length;return s===void 0||i?e:Object.assign(e,{[n]:s})},{}):t}function Kf(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?Kf(t,t.get(e[r]),n):r.endsWith("Ids")&&e[r].forEach(s=>{Kf(t,t.get(s),n)})}))}function um(t,e,n){const r=n?"outbound-rtp":"inbound-rtp",s=new Map;if(e===null)return s;const i=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&i.push(o)}),i.forEach(o=>{t.forEach(a=>{a.type===r&&a.trackId===o.id&&Kf(t,a,s)})}),s}const dm=$_;function U_(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const r=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const c={};return Object.keys(a).forEach(u=>{if(u==="require"||u==="advanced"||u==="mediaSource")return;const p=typeof a[u]=="object"?a[u]:{ideal:a[u]};p.exact!==void 0&&typeof p.exact=="number"&&(p.min=p.max=p.exact);const h=function(f,m){return f?f+m.charAt(0).toUpperCase()+m.slice(1):m==="deviceId"?"sourceId":m};if(p.ideal!==void 0){c.optional=c.optional||[];let f={};typeof p.ideal=="number"?(f[h("min",u)]=p.ideal,c.optional.push(f),f={},f[h("max",u)]=p.ideal,c.optional.push(f)):(f[h("",u)]=p.ideal,c.optional.push(f))}p.exact!==void 0&&typeof p.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[h("",u)]=p.exact):["min","max"].forEach(f=>{p[f]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[h(f,u)]=p[f])})}),a.advanced&&(c.optional=(c.optional||[]).concat(a.advanced)),c},s=function(a,c){if(e.version>=61)return c(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const u=function(p,h,f){h in p&&!(f in p)&&(p[f]=p[h],delete p[h])};a=JSON.parse(JSON.stringify(a)),u(a.audio,"autoGainControl","googAutoGainControl"),u(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=r(a.audio)}if(a&&typeof a.video=="object"){let u=a.video.facingMode;u=u&&(typeof u=="object"?u:{ideal:u});const p=e.version<66;if(u&&(u.exact==="user"||u.exact==="environment"||u.ideal==="user"||u.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!p)){delete a.video.facingMode;let h;if(u.exact==="environment"||u.ideal==="environment"?h=["back","rear"]:(u.exact==="user"||u.ideal==="user")&&(h=["front"]),h)return n.mediaDevices.enumerateDevices().then(f=>{f=f.filter(b=>b.kind==="videoinput");let m=f.find(b=>h.some(R=>b.label.toLowerCase().includes(R)));return!m&&f.length&&h.includes("back")&&(m=f[f.length-1]),m&&(a.video.deviceId=u.exact?{exact:m.deviceId}:{ideal:m.deviceId}),a.video=r(a.video),dm("chrome: "+JSON.stringify(a)),c(a)})}a.video=r(a.video)}return dm("chrome: "+JSON.stringify(a)),c(a)},i=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,c,u){s(a,p=>{n.webkitGetUserMedia(p,c,h=>{u&&u(i(h))})})};if(n.getUserMedia=o.bind(n),n.mediaDevices.getUserMedia){const a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return s(c,u=>a(u).then(p=>{if(u.audio&&!p.getAudioTracks().length||u.video&&!p.getVideoTracks().length)throw p.getTracks().forEach(h=>{h.stop()}),new DOMException("","NotFoundError");return p},p=>Promise.reject(i(p))))}}}function z_(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function H_(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",s=>{let i;t.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(a=>a.track&&a.track.id===s.track.id):i={track:s.track};const o=new Event("track");o.track=s.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[r.stream],this.dispatchEvent(o)}),r.stream.getTracks().forEach(s=>{let i;t.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(a=>a.track&&a.track.id===s.id):i={track:s};const o=new Event("track");o.track=s,o.receiver=i,o.transceiver={receiver:i},o.streams=[r.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else si(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function W_(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(s,i){return{track:i,get dtmf(){return this._dtmf===void 0&&(i.kind==="audio"?this._dtmf=s.createDTMFSender(i):this._dtmf=null),this._dtmf},_pc:s}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const s=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,c){let u=s.apply(this,arguments);return u||(u=e(this,a),this._senders.push(u)),u};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){i.apply(this,arguments);const c=this._senders.indexOf(a);c!==-1&&this._senders.splice(c,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],n.apply(this,[i]),i.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach(o=>{const a=this._senders.find(c=>c.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function G_(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=n.apply(this,[]);return i.forEach(o=>o._pc=this),i});const r=t.RTCPeerConnection.prototype.addTrack;r&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=r.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){const i=this;return this._pc.getStats().then(o=>um(o,i.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const s=n.apply(this,[]);return s.forEach(i=>i._pc=this),s}),si(t,"track",r=>(r.receiver._pc=r.srcElement,r)),t.RTCRtpReceiver.prototype.getStats=function(){const s=this;return this._pc.getStats().then(i=>um(i,s.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const r=arguments[0];let s,i,o;return this.getSenders().forEach(a=>{a.track===r&&(s?o=!0:s=a)}),this.getReceivers().forEach(a=>(a.track===r&&(i?o=!0:i=a),a.track===r)),o||s&&i?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function V_(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(c)===-1&&this._shimmedLocalStreams[a.id].push(c):this._shimmedLocalStreams[a.id]=[a,c],c};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(u=>{if(this.getSenders().find(h=>h.track===u))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(u=>a.indexOf(u)===-1);this._shimmedLocalStreams[o.id]=[o].concat(c)};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],r.apply(this,arguments)};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const c=this._shimmedLocalStreams[a].indexOf(o);c!==-1&&this._shimmedLocalStreams[a].splice(c,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),s.apply(this,arguments)}}function Y_(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return V_(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const p=n.apply(this);return this._reverseStreams=this._reverseStreams||{},p.map(h=>this._reverseStreams[h.id])};const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(p){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},p.getTracks().forEach(h=>{if(this.getSenders().find(m=>m.track===h))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[p.id]){const h=new t.MediaStream(p.getTracks());this._streams[p.id]=h,this._reverseStreams[h.id]=p,p=h}r.apply(this,[p])};const s=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(p){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[p.id]||p]),delete this._reverseStreams[this._streams[p.id]?this._streams[p.id].id:p.id],delete this._streams[p.id]},t.RTCPeerConnection.prototype.addTrack=function(p,h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const f=[].slice.call(arguments,1);if(f.length!==1||!f[0].getTracks().find(R=>R===p))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(R=>R.track===p))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const b=this._streams[h.id];if(b)b.addTrack(p),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const R=new t.MediaStream([p]);this._streams[h.id]=R,this._reverseStreams[R.id]=h,this.addStream(R)}return this.getSenders().find(R=>R.track===p)};function i(u,p){let h=p.sdp;return Object.keys(u._reverseStreams||[]).forEach(f=>{const m=u._reverseStreams[f],b=u._streams[m.id];h=h.replace(new RegExp(b.id,"g"),m.id)}),new RTCSessionDescription({type:p.type,sdp:h})}function o(u,p){let h=p.sdp;return Object.keys(u._reverseStreams||[]).forEach(f=>{const m=u._reverseStreams[f],b=u._streams[m.id];h=h.replace(new RegExp(m.id,"g"),b.id)}),new RTCSessionDescription({type:p.type,sdp:h})}["createOffer","createAnswer"].forEach(function(u){const p=t.RTCPeerConnection.prototype[u],h={[u](){const f=arguments;return arguments.length&&typeof arguments[0]=="function"?p.apply(this,[b=>{const R=i(this,b);f[0].apply(null,[R])},b=>{f[1]&&f[1].apply(null,b)},arguments[2]]):p.apply(this,arguments).then(b=>i(this,b))}};t.RTCPeerConnection.prototype[u]=h[u]});const a=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const u=c.get.apply(this);return u.type===""?u:i(this,u)}}),t.RTCPeerConnection.prototype.removeTrack=function(p){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!p._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(p._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let f;Object.keys(this._streams).forEach(m=>{this._streams[m].getTracks().find(R=>p.track===R)&&(f=this._streams[m])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(p.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Xf(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=t.RTCPeerConnection.prototype[n],s={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=s[n]})}function K_(t,e){si(t,"negotiationneeded",n=>{const r=n.target;if(!((e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return n})}const fm=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:K_,shimAddTrackRemoveTrack:Y_,shimAddTrackRemoveTrackWithNative:V_,shimGetSendersWithDtmf:W_,shimGetUserMedia:U_,shimMediaStream:z_,shimOnTrack:H_,shimPeerConnection:Xf,shimSenderReceiverGetStats:G_},Symbol.toStringTag,{value:"Module"}));function X_(t,e){const n=t&&t.navigator,r=t&&t.MediaStreamTrack;if(n.getUserMedia=function(s,i,o){Eh("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(s).then(i,o)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const s=function(o,a,c){a in o&&!(c in o)&&(o[c]=o[a],delete o[a])},i=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),s(o.audio,"autoGainControl","mozAutoGainControl"),s(o.audio,"noiseSuppression","mozNoiseSuppression")),i(o)},r&&r.prototype.getSettings){const o=r.prototype.getSettings;r.prototype.getSettings=function(){const a=o.apply(this,arguments);return s(a,"mozAutoGainControl","autoGainControl"),s(a,"mozNoiseSuppression","noiseSuppression"),a}}if(r&&r.prototype.applyConstraints){const o=r.prototype.applyConstraints;r.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),s(a,"autoGainControl","mozAutoGainControl"),s(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function S2(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,Promise.reject(s)}return r.video===!0?r.video={mediaSource:e}:r.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(r)})}function Q_(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Qf(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const i=t.RTCPeerConnection.prototype[s],o={[s](){return arguments[0]=new(s==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[s]=o[s]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[i,o,a]=arguments;return r.apply(this,[i||null]).then(c=>{if(e.version<53&&!o)try{c.forEach(u=>{u.type=n[u.type]||u.type})}catch(u){if(u.name!=="TypeError")throw u;c.forEach((p,h)=>{c.set(h,Object.assign({},p,{type:n[p.type]||p.type}))})}return c}).then(o,a)}}function J_(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=e.apply(this,[]);return s.forEach(i=>i._pc=this),s});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=n.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function q_(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r}),si(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Z_(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){Eh("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&n.getTracks().includes(r.track)&&this.removeTrack(r)})})}function e1(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function t1(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const s=r.length>0;s&&r.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=e.apply(this,arguments);if(s){const{sender:o}=i,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=r,o.sendEncodings=r,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return i})}function n1(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const r=e.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function r1(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function s1(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}const pm=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:t1,shimCreateAnswer:s1,shimCreateOffer:r1,shimGetDisplayMedia:S2,shimGetParameters:n1,shimGetUserMedia:X_,shimOnTrack:Q_,shimPeerConnection:Qf,shimRTCDataChannel:e1,shimReceiverGetStats:q_,shimRemoveStream:Z_,shimSenderGetStats:J_},Symbol.toStringTag,{value:"Module"}));function i1(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(s=>e.call(this,s,r)),r.getVideoTracks().forEach(s=>e.call(this,s,r))},t.RTCPeerConnection.prototype.addTrack=function(r,...s){return s&&s.forEach(i=>{this._localStreams?this._localStreams.includes(i)||this._localStreams.push(i):this._localStreams=[i]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(n);if(r===-1)return;this._localStreams.splice(r,1);const s=n.getTracks();this.getSenders().forEach(i=>{s.includes(i.track)&&this.removeTrack(i)})})}}function o1(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(s=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(s))return;this._remoteStreams.push(s);const i=new Event("addstream");i.stream=s,this.dispatchEvent(i)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){s.streams.forEach(i=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(i)>=0)return;r._remoteStreams.push(i);const o=new Event("addstream");o.stream=i,r.dispatchEvent(o)})}),e.apply(r,arguments)}}}function a1(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,r=e.createAnswer,s=e.setLocalDescription,i=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(u,p){const h=arguments.length>=2?arguments[2]:arguments[0],f=n.apply(this,[h]);return p?(f.then(u,p),Promise.resolve()):f},e.createAnswer=function(u,p){const h=arguments.length>=2?arguments[2]:arguments[0],f=r.apply(this,[h]);return p?(f.then(u,p),Promise.resolve()):f};let a=function(c,u,p){const h=s.apply(this,[c]);return p?(h.then(u,p),Promise.resolve()):h};e.setLocalDescription=a,a=function(c,u,p){const h=i.apply(this,[c]);return p?(h.then(u,p),Promise.resolve()):h},e.setRemoteDescription=a,a=function(c,u,p){const h=o.apply(this,[c]);return p?(h.then(u,p),Promise.resolve()):h},e.addIceCandidate=a}function l1(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,r=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=s=>r(c1(s))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(r,s,i){e.mediaDevices.getUserMedia(r).then(s,i)}).bind(e))}function c1(t){return t&&t.video!==void 0?Object.assign({},t,{video:B_(t.video)}):t}function u1(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(r,s){if(r&&r.iceServers){const i=[];for(let o=0;o<r.iceServers.length;o++){let a=r.iceServers[o];a.urls===void 0&&a.url?(Eh("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,i.push(a)):i.push(r.iceServers[o])}r.iceServers=i}return new e(r,s)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function d1(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function f1(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):r.offerToReceiveAudio===!0&&!s&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const i=this.getTransceivers().find(o=>o.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveVideo===!0&&!i&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function p1(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}const hm=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:p1,shimCallbacksAPI:a1,shimConstraints:c1,shimCreateOfferLegacy:f1,shimGetUserMedia:l1,shimLocalStreamsAPI:i1,shimRTCIceServerUrls:u1,shimRemoteStreamsAPI:o1,shimTrackEventTransceiver:d1},Symbol.toStringTag,{value:"Module"}));var h1={exports:{}};(function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},e.splitSections=function(n){return n.split(`
m=`).map((s,i)=>(i>0?"m="+s:s).trim()+`\r
`)},e.getDescription=function(n){const r=e.splitSections(n);return r&&r[0]},e.getMediaSections=function(n){const r=e.splitSections(n);return r.shift(),r},e.matchPrefix=function(n,r){return e.splitLines(n).filter(s=>s.indexOf(r)===0)},e.parseCandidate=function(n){let r;n.indexOf("a=candidate:")===0?r=n.substring(12).split(" "):r=n.substring(10).split(" ");const s={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let i=8;i<r.length;i+=2)switch(r[i]){case"raddr":s.relatedAddress=r[i+1];break;case"rport":s.relatedPort=parseInt(r[i+1],10);break;case"tcptype":s.tcpType=r[i+1];break;case"ufrag":s.ufrag=r[i+1],s.usernameFragment=r[i+1];break;default:s[r[i]]===void 0&&(s[r[i]]=r[i+1]);break}return s},e.writeCandidate=function(n){const r=[];r.push(n.foundation);const s=n.component;s==="rtp"?r.push(1):s==="rtcp"?r.push(2):r.push(s),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const i=n.type;return r.push("typ"),r.push(i),i!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let r=n.substring(9).split(" ");const s={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),s.name=r[0],s.clockRate=parseInt(r[1],10),s.channels=r.length===3?parseInt(r[2],10):1,s.numChannels=s.channels,s},e.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const s=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(s!==1?"/"+s:"")+`\r
`},e.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const r={};let s;const i=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<i.length;o++)s=i[o].trim().split("="),r[s[0].trim()]=s[1];return r},e.writeFmtp=function(n){let r="",s=n.payloadType;if(n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const i=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?i.push(o+"="+n.parameters[o]):i.push(o)}),r+="a=fmtp:"+s+" "+i.join(";")+`\r
`}return r},e.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},e.writeRtcpFb=function(n){let r="",s=n.payloadType;return n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(i=>{r+="a=rtcp-fb:"+s+" "+i.type+(i.parameter&&i.parameter.length?" "+i.parameter:"")+`\r
`}),r},e.parseSsrcMedia=function(n){const r=n.indexOf(" "),s={ssrc:parseInt(n.substring(7,r),10)},i=n.indexOf(":",r);return i>-1?(s.attribute=n.substring(r+1,i),s.value=n.substring(i+1)):s.attribute=n.substring(r+1),s},e.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(s=>parseInt(s,10))}},e.getMid=function(n){const r=e.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},e.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:e.matchPrefix(n+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,r){let s="a=setup:"+r+`\r
`;return n.fingerprints.forEach(i=>{s+="a=fingerprint:"+i.algorithm+" "+i.value+`\r
`}),s},e.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,r){return e.matchPrefix(n+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,r){const s=e.matchPrefix(n+r,"a=ice-ufrag:")[0],i=e.matchPrefix(n+r,"a=ice-pwd:")[0];return s&&i?{usernameFragment:s.substring(12),password:i.substring(10)}:null},e.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},e.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=e.splitLines(n)[0].split(" ");r.profile=i[2];for(let a=3;a<i.length;a++){const c=i[a],u=e.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(u){const p=e.parseRtpMap(u),h=e.matchPrefix(n,"a=fmtp:"+c+" ");switch(p.parameters=h.length?e.parseFmtp(h[0]):{},p.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),r.codecs.push(p),p.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(p.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(a=>{r.headerExtensions.push(e.parseExtmap(a))});const o=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(a=>{o.forEach(c=>{a.rtcpFeedback.find(p=>p.type===c.type&&p.parameter===c.parameter)||a.rtcpFeedback.push(c)})}),r},e.writeRtpDescription=function(n,r){let s="";s+="m="+n+" ",s+=r.codecs.length>0?"9":"0",s+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",s+=r.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,s+=`c=IN IP4 0.0.0.0\r
`,s+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(o=>{s+=e.writeRtpMap(o),s+=e.writeFmtp(o),s+=e.writeRtcpFb(o)});let i=0;return r.codecs.forEach(o=>{o.maxptime>i&&(i=o.maxptime)}),i>0&&(s+="a=maxptime:"+i+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(o=>{s+=e.writeExtmap(o)}),s},e.parseRtpEncodingParameters=function(n){const r=[],s=e.parseRtpParameters(n),i=s.fecMechanisms.indexOf("RED")!==-1,o=s.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(n,"a=ssrc:").map(f=>e.parseSsrcMedia(f)).filter(f=>f.attribute==="cname"),c=a.length>0&&a[0].ssrc;let u;const p=e.matchPrefix(n,"a=ssrc-group:FID").map(f=>f.substring(17).split(" ").map(b=>parseInt(b,10)));p.length>0&&p[0].length>1&&p[0][0]===c&&(u=p[0][1]),s.codecs.forEach(f=>{if(f.name.toUpperCase()==="RTX"&&f.parameters.apt){let m={ssrc:c,codecPayloadType:parseInt(f.parameters.apt,10)};c&&u&&(m.rtx={ssrc:u}),r.push(m),i&&(m=JSON.parse(JSON.stringify(m)),m.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},r.push(m))}}),r.length===0&&c&&r.push({ssrc:c});let h=e.matchPrefix(n,"b=");return h.length&&(h[0].indexOf("b=TIAS:")===0?h=parseInt(h[0].substring(7),10):h[0].indexOf("b=AS:")===0?h=parseInt(h[0].substring(5),10)*1e3*.95-50*40*8:h=void 0,r.forEach(f=>{f.maxBitrate=h})),r},e.parseRtcpParameters=function(n){const r={},s=e.matchPrefix(n,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];s&&(r.cname=s.value,r.ssrc=s.ssrc);const i=e.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=i.length>0,r.compound=i.length===0;const o=e.matchPrefix(n,"a=rtcp-mux");return r.mux=o.length>0,r},e.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},e.parseMsid=function(n){let r;const s=e.matchPrefix(n,"a=msid:");if(s.length===1)return r=s[0].substring(7).split(" "),{stream:r[0],track:r[1]};const i=e.matchPrefix(n,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(i.length>0)return r=i[0].value.split(" "),{stream:r[0],track:r[1]}},e.parseSctpDescription=function(n){const r=e.parseMLine(n),s=e.matchPrefix(n,"a=max-message-size:");let i;s.length>0&&(i=parseInt(s[0].substring(19),10)),isNaN(i)&&(i=65536);const o=e.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:r.fmt,maxMessageSize:i};const a=e.matchPrefix(n,"a=sctpmap:");if(a.length>0){const c=a[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:i}}},e.writeSctpDescription=function(n,r){let s=[];return n.protocol!=="DTLS/SCTP"?s=["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:s=["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&s.push("a=max-message-size:"+r.maxMessageSize+`\r
`),s.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,r,s){let i;const o=r!==void 0?r:2;return n?i=n:i=e.generateSessionId(),`v=0\r
o=`+(s||"thisisadapterortc")+" "+i+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,r){const s=e.splitLines(n);for(let i=0;i<s.length;i++)switch(s[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[i].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const s=e.splitLines(n)[0].substring(2).split(" ");return{kind:s[0],port:parseInt(s[1],10),protocol:s[2],fmt:s.slice(3).join(" ")}},e.parseOLine=function(n){const s=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:s[0],sessionId:s[1],sessionVersion:parseInt(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=e.splitLines(n);for(let s=0;s<r.length;s++)if(r[s].length<2||r[s].charAt(1)!=="=")return!1;return!0},t.exports=e})(h1);var g1=h1.exports;const Ui=by(g1),C2=LE({__proto__:null,default:Ui},[g1]);function rc(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const s=new e(r),i=Ui.parseCandidate(r.candidate);for(const o in i)o in s||Object.defineProperty(s,o,{value:i[o]});return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new e(r)},t.RTCIceCandidate.prototype=e.prototype,si(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function Jf(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||si(t,"icecandidate",e=>{if(e.candidate){const n=Ui.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function sc(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(a){if(!a||!a.sdp)return!1;const c=Ui.splitSections(a.sdp);return c.shift(),c.some(u=>{const p=Ui.parseMLine(u);return p&&p.kind==="application"&&p.protocol.indexOf("SCTP")!==-1})},r=function(a){const c=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const u=parseInt(c[1],10);return u!==u?-1:u},s=function(a){let c=65536;return e.browser==="firefox"&&(e.version<57?a===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},i=function(a,c){let u=65536;e.browser==="firefox"&&e.version===57&&(u=65535);const p=Ui.matchPrefix(a.sdp,"a=max-message-size:");return p.length>0?u=parseInt(p[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(u=2147483637),u},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=r(arguments[0]),u=s(c),p=i(arguments[0],c);let h;u===0&&p===0?h=Number.POSITIVE_INFINITY:u===0||p===0?h=Math.max(u,p):h=Math.min(u,p);const f={};Object.defineProperty(f,"maxMessageSize",{get(){return h}}),this._sctp=f}return o.apply(this,arguments)}}function ic(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(r,s){const i=r.send;r.send=function(){const a=arguments[0],c=a.length||a.size||a.byteLength;if(r.readyState==="open"&&s.sctp&&c>s.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+s.sctp.maxMessageSize+" bytes)");return i.apply(r,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const s=n.apply(this,arguments);return e(s,this),s},si(t,"datachannel",r=>(e(r.channel,r.target),r))}function qf(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=s=>{const i=s.target;if(i._lastConnectionState!==i.connectionState){i._lastConnectionState=i.connectionState;const o=new Event("connectionstatechange",s);i.dispatchEvent(o)}return s},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function Zf(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(s){if(s&&s.sdp&&s.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i=s.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&s instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:s.type,sdp:i}):s.sdp=i}return n.apply(this,arguments)}}function oc(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function ac(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let s=arguments[0]||{};if(typeof s!="object"||s.type&&s.sdp)return n.apply(this,arguments);if(s={type:s.type,sdp:s.sdp},!s.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":s.type="offer";break;default:s.type="answer";break}return s.sdp||s.type!=="offer"&&s.type!=="answer"?n.apply(this,[s]):(s.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}const T2=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:Zf,shimAddIceCandidateNullOrEmpty:oc,shimConnectionState:qf,shimMaxMessageSize:sc,shimParameterlessSetLocalDescription:ac,shimRTCIceCandidate:rc,shimRTCIceCandidateRelayProtocol:Jf,shimSendThrowTypeError:ic},Symbol.toStringTag,{value:"Module"}));function I2({window:t}={},e={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const n=$_,r=b2(t),s={browserDetails:r,commonShim:T2,extractVersion:Uo,disableLog:x2,disableWarnings:E2,sdp:C2};switch(r.browser){case"chrome":if(!fm||!Xf||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),s;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),s;n("adapter.js shimming chrome."),s.browserShim=fm,oc(t,r),ac(t),U_(t,r),z_(t),Xf(t,r),H_(t),Y_(t,r),W_(t),G_(t),K_(t,r),rc(t),Jf(t),qf(t),sc(t,r),ic(t),Zf(t,r);break;case"firefox":if(!pm||!Qf||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),s;n("adapter.js shimming firefox."),s.browserShim=pm,oc(t,r),ac(t),X_(t,r),Qf(t,r),Q_(t),Z_(t),J_(t),q_(t),e1(t),t1(t),n1(t),r1(t),s1(t),rc(t),qf(t),sc(t,r),ic(t);break;case"safari":if(!hm||!e.shimSafari)return n("Safari shim is not included in this adapter release."),s;n("adapter.js shimming safari."),s.browserShim=hm,oc(t,r),ac(t),u1(t),f1(t),a1(t),i1(t),o1(t),d1(t),l1(t),p1(t),rc(t),Jf(t),sc(t,r),ic(t),Zf(t,r);break;default:n("Unsupported browser!");break}return s}const gm=I2({window:typeof window>"u"?void 0:window});function ii(t,e,n,r){Object.defineProperty(t,e,{get:n,set:r,enumerable:!0,configurable:!0})}class m1{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=e=>{const n=[],r=e.byteLength,s=Math.ceil(r/this.chunkedMTU);let i=0,o=0;for(;o<r;){const a=Math.min(r,o+this.chunkedMTU),c=e.slice(o,a),u={__peerData:this._dataCount,n:i,data:c,total:s};n.push(u),o=a,i++}return this._dataCount++,n}}}function k2(t){let e=0;for(const s of t)e+=s.byteLength;const n=new Uint8Array(e);let r=0;for(const s of t)n.set(s,r),r+=s.byteLength;return n}const $d=gm.default||gm,Po=new class{isWebRTCSupported(){return typeof RTCPeerConnection<"u"}isBrowserSupported(){const t=this.getBrowser(),e=this.getVersion();return this.supportedBrowsers.includes(t)?t==="chrome"?e>=this.minChromeVersion:t==="firefox"?e>=this.minFirefoxVersion:t==="safari"?!this.isIOS&&e>=this.minSafariVersion:!1:!1}getBrowser(){return $d.browserDetails.browser}getVersion(){return $d.browserDetails.version||0}isUnifiedPlanSupported(){const t=this.getBrowser(),e=$d.browserDetails.version||0;if(t==="chrome"&&e<this.minChromeVersion)return!1;if(t==="firefox"&&e>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let n,r=!1;try{n=new RTCPeerConnection,n.addTransceiver("audio"),r=!0}catch{}finally{n&&n.close()}return r}toString(){return`Supports:
    browser:${this.getBrowser()}
    version:${this.getVersion()}
    isIOS:${this.isIOS}
    isWebRTCSupported:${this.isWebRTCSupported()}
    isBrowserSupported:${this.isBrowserSupported()}
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS=typeof navigator<"u"?["iPad","iPhone","iPod"].includes(navigator.platform):!1,this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},w2=t=>!t||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(t),y1=()=>Math.random().toString(36).slice(2),mm={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};class A2 extends m1{noop(){}blobToArrayBuffer(e,n){const r=new FileReader;return r.onload=function(s){s.target&&n(s.target.result)},r.readAsArrayBuffer(e),r}binaryStringToArrayBuffer(e){const n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r)&255;return n.buffer}isSecure(){return location.protocol==="https:"}constructor(...e){super(...e),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=mm,this.browser=Po.getBrowser(),this.browserVersion=Po.getVersion(),this.pack=N_,this.unpack=M_,this.supports=function(){const n={browser:Po.isBrowserSupported(),webRTC:Po.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!n.webRTC)return n;let r;try{r=new RTCPeerConnection(mm),n.audioVideo=!0;let s;try{s=r.createDataChannel("_PEERJSTEST",{ordered:!0}),n.data=!0,n.reliable=!!s.ordered;try{s.binaryType="blob",n.binaryBlob=!Po.isIOS}catch{}}catch{}finally{s&&s.close()}}catch{}finally{r&&r.close()}return n}(),this.validateId=w2,this.randomToken=y1}}const In=new A2,R2="PeerJS: ";class O2{get logLevel(){return this._logLevel}set logLevel(e){this._logLevel=e}log(...e){this._logLevel>=3&&this._print(3,...e)}warn(...e){this._logLevel>=2&&this._print(2,...e)}error(...e){this._logLevel>=1&&this._print(1,...e)}setLogFunction(e){this._print=e}_print(e,...n){const r=[R2,...n];for(const s in r)r[s]instanceof Error&&(r[s]="("+r[s].name+") "+r[s].message);e>=3?console.log(...r):e>=2?console.warn("WARNING",...r):e>=1&&console.error("ERROR",...r)}constructor(){this._logLevel=0}}var Ce=new O2,bh={},P2=Object.prototype.hasOwnProperty,En="~";function Sa(){}Object.create&&(Sa.prototype=Object.create(null),new Sa().__proto__||(En=!1));function L2(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function v1(t,e,n,r,s){if(typeof n!="function")throw new TypeError("The listener must be a function");var i=new L2(n,r||t,s),o=En?En+e:e;return t._events[o]?t._events[o].fn?t._events[o]=[t._events[o],i]:t._events[o].push(i):(t._events[o]=i,t._eventsCount++),t}function lc(t,e){--t._eventsCount===0?t._events=new Sa:delete t._events[e]}function pn(){this._events=new Sa,this._eventsCount=0}pn.prototype.eventNames=function(){var e=[],n,r;if(this._eventsCount===0)return e;for(r in n=this._events)P2.call(n,r)&&e.push(En?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(n)):e};pn.prototype.listeners=function(e){var n=En?En+e:e,r=this._events[n];if(!r)return[];if(r.fn)return[r.fn];for(var s=0,i=r.length,o=new Array(i);s<i;s++)o[s]=r[s].fn;return o};pn.prototype.listenerCount=function(e){var n=En?En+e:e,r=this._events[n];return r?r.fn?1:r.length:0};pn.prototype.emit=function(e,n,r,s,i,o){var a=En?En+e:e;if(!this._events[a])return!1;var c=this._events[a],u=arguments.length,p,h;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,n),!0;case 3:return c.fn.call(c.context,n,r),!0;case 4:return c.fn.call(c.context,n,r,s),!0;case 5:return c.fn.call(c.context,n,r,s,i),!0;case 6:return c.fn.call(c.context,n,r,s,i,o),!0}for(h=1,p=new Array(u-1);h<u;h++)p[h-1]=arguments[h];c.fn.apply(c.context,p)}else{var f=c.length,m;for(h=0;h<f;h++)switch(c[h].once&&this.removeListener(e,c[h].fn,void 0,!0),u){case 1:c[h].fn.call(c[h].context);break;case 2:c[h].fn.call(c[h].context,n);break;case 3:c[h].fn.call(c[h].context,n,r);break;case 4:c[h].fn.call(c[h].context,n,r,s);break;default:if(!p)for(m=1,p=new Array(u-1);m<u;m++)p[m-1]=arguments[m];c[h].fn.apply(c[h].context,p)}}return!0};pn.prototype.on=function(e,n,r){return v1(this,e,n,r,!1)};pn.prototype.once=function(e,n,r){return v1(this,e,n,r,!0)};pn.prototype.removeListener=function(e,n,r,s){var i=En?En+e:e;if(!this._events[i])return this;if(!n)return lc(this,i),this;var o=this._events[i];if(o.fn)o.fn===n&&(!s||o.once)&&(!r||o.context===r)&&lc(this,i);else{for(var a=0,c=[],u=o.length;a<u;a++)(o[a].fn!==n||s&&!o[a].once||r&&o[a].context!==r)&&c.push(o[a]);c.length?this._events[i]=c.length===1?c[0]:c:lc(this,i)}return this};pn.prototype.removeAllListeners=function(e){var n;return e?(n=En?En+e:e,this._events[n]&&lc(this,n)):(this._events=new Sa,this._eventsCount=0),this};pn.prototype.off=pn.prototype.removeListener;pn.prototype.addListener=pn.prototype.on;pn.prefixed=En;pn.EventEmitter=pn;bh=pn;var oi={};ii(oi,"ConnectionType",()=>gs);ii(oi,"PeerErrorType",()=>Ut);ii(oi,"BaseConnectionErrorType",()=>ep);ii(oi,"DataConnectionErrorType",()=>Sh);ii(oi,"SerializationType",()=>_u);ii(oi,"SocketEventType",()=>os);ii(oi,"ServerMessageType",()=>un);var gs=function(t){return t.Data="data",t.Media="media",t}({}),Ut=function(t){return t.BrowserIncompatible="browser-incompatible",t.Disconnected="disconnected",t.InvalidID="invalid-id",t.InvalidKey="invalid-key",t.Network="network",t.PeerUnavailable="peer-unavailable",t.SslUnavailable="ssl-unavailable",t.ServerError="server-error",t.SocketError="socket-error",t.SocketClosed="socket-closed",t.UnavailableID="unavailable-id",t.WebRTC="webrtc",t}({}),ep=function(t){return t.NegotiationFailed="negotiation-failed",t.ConnectionClosed="connection-closed",t}({}),Sh=function(t){return t.NotOpenYet="not-open-yet",t.MessageToBig="message-too-big",t}({}),_u=function(t){return t.Binary="binary",t.BinaryUTF8="binary-utf8",t.JSON="json",t.None="raw",t}({}),os=function(t){return t.Message="message",t.Disconnected="disconnected",t.Error="error",t.Close="close",t}({}),un=function(t){return t.Heartbeat="HEARTBEAT",t.Candidate="CANDIDATE",t.Offer="OFFER",t.Answer="ANSWER",t.Open="OPEN",t.Error="ERROR",t.IdTaken="ID-TAKEN",t.InvalidKey="INVALID-KEY",t.Leave="LEAVE",t.Expire="EXPIRE",t}({});const _1="1.5.5";class D2 extends bh.EventEmitter{constructor(e,n,r,s,i,o=5e3){super(),this.pingInterval=o,this._disconnected=!0,this._messagesQueue=[];const a=e?"wss://":"ws://";this._baseUrl=a+n+":"+r+s+"peerjs?key="+i}start(e,n){this._id=e;const r=`${this._baseUrl}&id=${e}&token=${n}`;this._socket||!this._disconnected||(this._socket=new WebSocket(r+"&version="+_1),this._disconnected=!1,this._socket.onmessage=s=>{let i;try{i=JSON.parse(s.data),Ce.log("Server message received:",i)}catch{Ce.log("Invalid server message",s.data);return}this.emit(os.Message,i)},this._socket.onclose=s=>{this._disconnected||(Ce.log("Socket closed.",s),this._cleanup(),this._disconnected=!0,this.emit(os.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),Ce.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen()){Ce.log("Cannot send heartbeat, because socket closed");return}const e=JSON.stringify({type:un.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&this._socket.readyState===1}_sendQueuedMessages(){const e=[...this._messagesQueue];this._messagesQueue=[];for(const n of e)this.send(n)}send(e){if(this._disconnected)return;if(!this._id){this._messagesQueue.push(e);return}if(!e.type){this.emit(os.Error,"Invalid message");return}if(!this._wsOpen())return;const n=JSON.stringify(e);this._socket.send(n)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}class x1{constructor(e){this.connection=e}startConnection(e){const n=this._startPeerConnection();if(this.connection.peerConnection=n,this.connection.type===gs.Media&&e._stream&&this._addTracksToConnection(e._stream,n),e.originator){const r=this.connection,s={ordered:!!e.reliable},i=n.createDataChannel(r.label,s);r._initializeDataChannel(i),this._makeOffer()}else this.handleSDP("OFFER",e.sdp)}_startPeerConnection(){Ce.log("Creating RTCPeerConnection.");const e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e}_setupListeners(e){const n=this.connection.peer,r=this.connection.connectionId,s=this.connection.type,i=this.connection.provider;Ce.log("Listening for ICE candidates."),e.onicecandidate=o=>{!o.candidate||!o.candidate.candidate||(Ce.log(`Received ICE candidates for ${n}:`,o.candidate),i.socket.send({type:un.Candidate,payload:{candidate:o.candidate,type:s,connectionId:r},dst:n}))},e.oniceconnectionstatechange=()=>{switch(e.iceConnectionState){case"failed":Ce.log("iceConnectionState is failed, closing connections to "+n),this.connection.emitError(ep.NegotiationFailed,"Negotiation of connection to "+n+" failed."),this.connection.close();break;case"closed":Ce.log("iceConnectionState is closed, closing connections to "+n),this.connection.emitError(ep.ConnectionClosed,"Connection to "+n+" closed."),this.connection.close();break;case"disconnected":Ce.log("iceConnectionState changed to disconnected on the connection with "+n);break;case"completed":e.onicecandidate=()=>{};break}this.connection.emit("iceStateChanged",e.iceConnectionState)},Ce.log("Listening for data channel"),e.ondatachannel=o=>{Ce.log("Received data channel");const a=o.channel;i.getConnection(n,r)._initializeDataChannel(a)},Ce.log("Listening for remote stream"),e.ontrack=o=>{Ce.log("Received remote stream");const a=o.streams[0],c=i.getConnection(n,r);if(c.type===gs.Media){const u=c;this._addStreamToMediaConnection(a,u)}}}cleanup(){Ce.log("Cleaning up PeerConnection to "+this.connection.peer);const e=this.connection.peerConnection;if(!e)return;this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=()=>{};const n=e.signalingState!=="closed";let r=!1;const s=this.connection.dataChannel;s&&(r=!!s.readyState&&s.readyState!=="closed"),(n||r)&&e.close()}async _makeOffer(){const e=this.connection.peerConnection,n=this.connection.provider;try{const r=await e.createOffer(this.connection.options.constraints);Ce.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),Ce.log("Set localDescription:",r,`for:${this.connection.peer}`);let s={sdp:r,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===gs.Data){const i=this.connection;s={...s,label:i.label,reliable:i.reliable,serialization:i.serialization}}n.socket.send({type:un.Offer,payload:s,dst:this.connection.peer})}catch(s){s!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(n.emitError(Ut.WebRTC,s),Ce.log("Failed to setLocalDescription, ",s))}}catch(r){n.emitError(Ut.WebRTC,r),Ce.log("Failed to createOffer, ",r)}}async _makeAnswer(){const e=this.connection.peerConnection,n=this.connection.provider;try{const r=await e.createAnswer();Ce.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),Ce.log("Set localDescription:",r,`for:${this.connection.peer}`),n.socket.send({type:un.Answer,payload:{sdp:r,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(s){n.emitError(Ut.WebRTC,s),Ce.log("Failed to setLocalDescription, ",s)}}catch(r){n.emitError(Ut.WebRTC,r),Ce.log("Failed to create answer, ",r)}}async handleSDP(e,n){n=new RTCSessionDescription(n);const r=this.connection.peerConnection,s=this.connection.provider;Ce.log("Setting remote description",n);const i=this;try{await r.setRemoteDescription(n),Ce.log(`Set remoteDescription:${e} for:${this.connection.peer}`),e==="OFFER"&&await i._makeAnswer()}catch(o){s.emitError(Ut.WebRTC,o),Ce.log("Failed to setRemoteDescription, ",o)}}async handleCandidate(e){Ce.log("handleCandidate:",e);try{await this.connection.peerConnection.addIceCandidate(e),Ce.log(`Added ICE candidate for:${this.connection.peer}`)}catch(n){this.connection.provider.emitError(Ut.WebRTC,n),Ce.log("Failed to handleCandidate, ",n)}}_addTracksToConnection(e,n){if(Ce.log(`add tracks from stream ${e.id} to peer connection`),!n.addTrack)return Ce.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(r=>{n.addTrack(r,e)})}_addStreamToMediaConnection(e,n){Ce.log(`add stream ${e.id} to media connection ${n.connectionId}`),n.addStream(e)}}class E1 extends bh.EventEmitter{emitError(e,n){Ce.error("Error:",n),this.emit("error",new M2(`${e}`,n))}}class M2 extends Error{constructor(e,n){typeof n=="string"?super(n):(super(),Object.assign(this,n)),this.type=e}}class b1 extends E1{get open(){return this._open}constructor(e,n,r){super(),this.peer=e,this.provider=n,this.options=r,this._open=!1,this.metadata=r.metadata}}var bp;const sa=class sa extends b1{get type(){return gs.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(e,n,r){super(e,n,r),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||sa.ID_PREFIX+In.randomToken(),this._negotiator=new x1(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{Ce.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{Ce.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(e){Ce.log("Receiving stream",e),this._remoteStream=e,super.emit("stream",e)}handleMessage(e){const n=e.type,r=e.payload;switch(e.type){case un.Answer:this._negotiator.handleSDP(n,r.sdp),this._open=!0;break;case un.Candidate:this._negotiator.handleCandidate(r.candidate);break;default:Ce.warn(`Unrecognized message type:${n} from peer:${this.peer}`);break}}answer(e,n={}){if(this._localStream){Ce.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=e,n&&n.sdpTransform&&(this.options.sdpTransform=n.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:e});const r=this.provider._getMessages(this.connectionId);for(const s of r)this.handleMessage(s);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit("close"))}};bp=new WeakMap,So(sa,bp,sa.ID_PREFIX="mc_");let Nc=sa;class N2{constructor(e){this._options=e}_buildRequest(e){const n=this._options.secure?"https":"http",{host:r,port:s,path:i,key:o}=this._options,a=new URL(`${n}://${r}:${s}${i}${o}/${e}`);return a.searchParams.set("ts",`${Date.now()}${Math.random()}`),a.searchParams.set("version",_1),fetch(a.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{const e=await this._buildRequest("id");if(e.status!==200)throw new Error(`Error. Status:${e.status}`);return e.text()}catch(e){Ce.error("Error retrieving ID",e);let n="";throw this._options.path==="/"&&this._options.host!==In.CLOUD_HOST&&(n=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+n)}}async listAllPeers(){try{const e=await this._buildRequest("peers");if(e.status!==200){if(e.status===401){let n="";throw this._options.host===In.CLOUD_HOST?n="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":n="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+n)}throw new Error(`Error. Status:${e.status}`)}return e.json()}catch(e){throw Ce.error("Error retrieving list peers",e),new Error("Could not get list peers from the server."+e)}}}var Sp,Cp;const $s=class $s extends b1{get type(){return gs.Data}constructor(e,n,r){super(e,n,r),this.connectionId=this.options.connectionId||$s.ID_PREFIX+y1(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new x1(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{Ce.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=n=>{Ce.log(`DC#${this.connectionId} dc onmessage:`,n.data)},this.dataChannel.onclose=()=>{Ce.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(e){if(e!=null&&e.flush){this.send({__peerData:{type:"close"}});return}this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null),this.open&&(this._open=!1,super.emit("close"))}send(e,n=!1){if(!this.open){this.emitError(Sh.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.");return}return this._send(e,n)}async handleMessage(e){const n=e.payload;switch(e.type){case un.Answer:await this._negotiator.handleSDP(e.type,n.sdp);break;case un.Candidate:await this._negotiator.handleCandidate(n.candidate);break;default:Ce.warn("Unrecognized message type:",e.type,"from peer:",this.peer);break}}};Sp=new WeakMap,Cp=new WeakMap,So($s,Sp,$s.ID_PREFIX="dc_"),So($s,Cp,$s.MAX_BUFFERED_AMOUNT=8388608);let jc=$s;class Ch extends jc{get bufferSize(){return this._bufferSize}_initializeDataChannel(e){super._initializeDataChannel(e),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",n=>this._handleDataMessage(n))}_bufferedSend(e){(this._buffering||!this._trySend(e))&&(this._buffer.push(e),this._bufferSize=this._buffer.length)}_trySend(e){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>jc.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(e)}catch(n){return Ce.error(`DC#:${this.connectionId} Error when sending:`,n),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open||this._buffer.length===0)return;const e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(e){if(e!=null&&e.flush){this.send({__peerData:{type:"close"}});return}this._buffer=[],this._bufferSize=0,super.close()}constructor(...e){super(...e),this._buffer=[],this._bufferSize=0,this._buffering=!1}}class Bd extends Ch{close(e){super.close(e),this._chunkedData={}}constructor(e,n,r){super(e,n,r),this.chunker=new m1,this.serialization=_u.Binary,this._chunkedData={}}_handleDataMessage({data:e}){const n=M_(e),r=n.__peerData;if(r){if(r.type==="close"){this.close();return}this._handleChunk(n);return}this.emit("data",n)}_handleChunk(e){const n=e.__peerData,r=this._chunkedData[n]||{data:[],count:0,total:e.total};if(r.data[e.n]=new Uint8Array(e.data),r.count++,this._chunkedData[n]=r,r.total===r.count){delete this._chunkedData[n];const s=k2(r.data);this._handleDataMessage({data:s})}}_send(e,n){const r=N_(e);if(r instanceof Promise)return this._send_blob(r);if(!n&&r.byteLength>this.chunker.chunkedMTU){this._sendChunks(r);return}this._bufferedSend(r)}async _send_blob(e){const n=await e;if(n.byteLength>this.chunker.chunkedMTU){this._sendChunks(n);return}this._bufferedSend(n)}_sendChunks(e){const n=this.chunker.chunk(e);Ce.log(`DC#${this.connectionId} Try to send ${n.length} chunks...`);for(const r of n)this.send(r,!0)}}class j2 extends Ch{_handleDataMessage({data:e}){super.emit("data",e)}_send(e,n){this._bufferedSend(e)}constructor(...e){super(...e),this.serialization=_u.None}}class F2 extends Ch{_handleDataMessage({data:e}){const n=this.parse(this.decoder.decode(e)),r=n.__peerData;if(r&&r.type==="close"){this.close();return}this.emit("data",n)}_send(e,n){const r=this.encoder.encode(this.stringify(e));if(r.byteLength>=In.chunkedMTU){this.emitError(Sh.MessageToBig,"Message too big for JSON channel");return}this._bufferedSend(r)}constructor(...e){super(...e),this.serialization=_u.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}var Tp;const ia=class ia extends E1{get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){const e=Object.create(null);for(const[n,r]of this._connections)e[n]=r;return e}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(e,n){super(),this._serializers={raw:j2,json:F2,binary:Bd,"binary-utf8":Bd,default:Bd},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map;let r;if(e&&e.constructor==Object?n=e:e&&(r=e.toString()),n={debug:0,host:In.CLOUD_HOST,port:In.CLOUD_PORT,path:"/",key:ia.DEFAULT_KEY,token:In.randomToken(),config:In.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...n},this._options=n,this._serializers={...this._serializers,...this.options.serializers},this._options.host==="/"&&(this._options.host=window.location.hostname),this._options.path&&(this._options.path[0]!=="/"&&(this._options.path="/"+this._options.path),this._options.path[this._options.path.length-1]!=="/"&&(this._options.path+="/")),this._options.secure===void 0&&this._options.host!==In.CLOUD_HOST?this._options.secure=In.isSecure():this._options.host==In.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&Ce.setLogFunction(this._options.logFunction),Ce.logLevel=this._options.debug||0,this._api=new N2(n),this._socket=this._createServerConnection(),!In.supports.audioVideo&&!In.supports.data){this._delayedAbort(Ut.BrowserIncompatible,"The current browser does not support WebRTC");return}if(r&&!In.validateId(r)){this._delayedAbort(Ut.InvalidID,`ID "${r}" is invalid`);return}r?this._initialize(r):this._api.retrieveId().then(s=>this._initialize(s)).catch(s=>this._abort(Ut.ServerError,s))}_createServerConnection(){const e=new D2(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return e.on(os.Message,n=>{this._handleMessage(n)}),e.on(os.Error,n=>{this._abort(Ut.SocketError,n)}),e.on(os.Disconnected,()=>{this.disconnected||(this.emitError(Ut.Network,"Lost connection to server."),this.disconnect())}),e.on(os.Close,()=>{this.disconnected||this._abort(Ut.SocketClosed,"Underlying socket is already closed.")}),e}_initialize(e){this._id=e,this.socket.start(e,this._options.token)}_handleMessage(e){const n=e.type,r=e.payload,s=e.src;switch(n){case un.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case un.Error:this._abort(Ut.ServerError,r.msg);break;case un.IdTaken:this._abort(Ut.UnavailableID,`ID "${this.id}" is taken`);break;case un.InvalidKey:this._abort(Ut.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case un.Leave:Ce.log(`Received leave message from ${s}`),this._cleanupPeer(s),this._connections.delete(s);break;case un.Expire:this.emitError(Ut.PeerUnavailable,`Could not connect to peer ${s}`);break;case un.Offer:{const i=r.connectionId;let o=this.getConnection(s,i);if(o&&(o.close(),Ce.warn(`Offer received for existing Connection ID:${i}`)),r.type===gs.Media){const c=new Nc(s,this,{connectionId:i,_payload:r,metadata:r.metadata});o=c,this._addConnection(s,o),this.emit("call",c)}else if(r.type===gs.Data){const c=new this._serializers[r.serialization](s,this,{connectionId:i,_payload:r,metadata:r.metadata,label:r.label,serialization:r.serialization,reliable:r.reliable});o=c,this._addConnection(s,o),this.emit("connection",c)}else{Ce.warn(`Received malformed connection type:${r.type}`);return}const a=this._getMessages(i);for(const c of a)o.handleMessage(c);break}default:{if(!r){Ce.warn(`You received a malformed message from ${s} of type ${n}`);return}const i=r.connectionId,o=this.getConnection(s,i);o&&o.peerConnection?o.handleMessage(e):i?this._storeMessage(i,e):Ce.warn("You received an unrecognized message:",e);break}}}_storeMessage(e,n){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(n)}_getMessages(e){const n=this._lostMessages.get(e);return n?(this._lostMessages.delete(e),n):[]}connect(e,n={}){if(n={serialization:"default",...n},this.disconnected){Ce.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(Ut.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}const r=new this._serializers[n.serialization](e,this,n);return this._addConnection(e,r),r}call(e,n,r={}){if(this.disconnected){Ce.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(Ut.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!n){Ce.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}const s=new Nc(e,this,{...r,_stream:n});return this._addConnection(e,s),s}_addConnection(e,n){Ce.log(`add connection ${n.type}:${n.connectionId} to peerId:${e}`),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(n)}_removeConnection(e){const n=this._connections.get(e.peer);if(n){const r=n.indexOf(e);r!==-1&&n.splice(r,1)}this._lostMessages.delete(e.connectionId)}getConnection(e,n){const r=this._connections.get(e);if(!r)return null;for(const s of r)if(s.connectionId===n)return s;return null}_delayedAbort(e,n){setTimeout(()=>{this._abort(e,n)},0)}_abort(e,n){Ce.error("Aborting!"),this.emitError(e,n),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||(Ce.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))}_cleanup(){for(const e of this._connections.keys())this._cleanupPeer(e),this._connections.delete(e);this.socket.removeAllListeners()}_cleanupPeer(e){const n=this._connections.get(e);if(n)for(const r of n)r.close()}disconnect(){if(this.disconnected)return;const e=this.id;Ce.log(`Disconnect peer with ID:${e}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit("disconnected",e)}reconnect(){if(this.disconnected&&!this.destroyed)Ce.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)Ce.error("In a hurry? We're still trying to make the initial connection!");else throw new Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`)}}listAllPeers(e=n=>{}){this._api.listAllPeers().then(n=>e(n)).catch(n=>this._abort(Ut.ServerError,n))}};Tp=new WeakMap,So(ia,Tp,ia.DEFAULT_KEY="peerjs");let tp=ia;var S1=tp;class C1{constructor(){Zt(this,"peer",null);Zt(this,"conn",null);Zt(this,"isHost",!1);Zt(this,"messageCallback",null);Zt(this,"connectionCallback",null);Zt(this,"closeCallback",null)}async connect(e){return this.peer=new S1,new Promise((n,r)=>{if(!this.peer)return r("Peer not initialized");this.peer.on("open",s=>{console.log("My Peer ID is:",s),e?(this.isHost=!1,this.connectToPeer(e),n(s)):(this.isHost=!0,this.peer.on("connection",i=>{console.log("Incoming connection..."),this.setupConnection(i)}),n(s))}),this.peer.on("error",s=>{console.error(s),r(s)})})}connectToPeer(e){if(!this.peer)return;const n=this.peer.connect(e);this.setupConnection(n)}setupConnection(e){this.conn=e,e.on("open",()=>{console.log("Connection established!"),this.connectionCallback&&this.connectionCallback()}),e.on("data",n=>{this.messageCallback&&this.messageCallback(n)}),e.on("close",()=>{console.log("Connection closed"),this.closeCallback&&this.closeCallback()}),e.on("error",n=>console.error("Connection Error:",n))}onConnection(e){this.connectionCallback=e}onClose(e){this.closeCallback=e}isConnected(){return this.conn!==null&&this.conn.open}send(e){this.conn&&this.conn.open?this.conn.send(e):console.warn("Connection not open, cannot send message")}onMessage(e){this.messageCallback=e}disconnect(){var e,n;(e=this.conn)==null||e.close(),(n=this.peer)==null||n.destroy()}}const $2=({gameMode:t,targetRoomId:e,playerClass:n,onGameStart:r,onBack:s})=>{const[i,o]=U.useState(""),[a,c]=U.useState(!1),[u,p]=U.useState(!0),[h,f]=U.useState(null),[m,b]=U.useState(!1),[R,W]=U.useState(null),[d,I]=U.useState(!1),S=U.useRef(null);U.useEffect(()=>{const B=new C1;return S.current=B,(async()=>{try{const J=await B.connect(t==="JOIN"?e:void 0);o(J),p(!1),B.onMessage(me=>{console.log("[LobbyScreen] Received message:",me),me.type==="CLASS_INFO"&&(console.log("[LobbyScreen] Received opponent class:",me.playerClass),W(me.playerClass))}),B.onConnection(()=>{console.log("[LobbyScreen] Connection established!"),c(!0)})}catch(J){console.error("[LobbyScreen] Connection error:",J),f(J.toString()),p(!1)}})(),()=>{var J;(J=S.current)!=null&&J.isConnected()||B.disconnect()}},[t,e]),U.useEffect(()=>{a&&S.current&&!d&&(console.log("[LobbyScreen] Sending class info:",n),setTimeout(()=>{var B;(B=S.current)==null||B.send({type:"CLASS_INFO",playerClass:n}),I(!0)},100))},[a,n,d]),U.useEffect(()=>{if(a&&S.current&&R){const B=setTimeout(()=>{console.log("[LobbyScreen] Starting game with opponent class:",R),r(S.current,R)},500);return()=>clearTimeout(B)}},[a,r,R]);const k=async()=>{if(i)try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(i);else{const B=document.createElement("textarea");B.value=i,B.style.position="fixed",B.style.left="-999999px",B.style.top="-999999px",document.body.appendChild(B),B.focus(),B.select(),document.execCommand("copy"),document.body.removeChild(B)}b(!0),setTimeout(()=>b(!1),2e3)}catch(B){console.error("Failed to copy:",B),alert(`Room ID: ${i}

()`)}},$=()=>{S.current&&(S.current.disconnect(),S.current=null),s()};return l.jsxs("div",{className:"screen lobby-screen",style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",gap:"2rem"},children:[l.jsx("h1",{style:{fontSize:"2.5rem",marginBottom:"1rem",textShadow:"0 0 10px #e94560",fontFamily:"Tamanegi, sans-serif",letterSpacing:"2px"},children:t==="HOST"?"":"..."}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1.5rem",padding:"2rem",background:"rgba(0,0,0,0.3)",borderRadius:"10px",minWidth:"400px"},children:[h&&l.jsxs("div",{style:{color:"#ff6b6b",fontSize:"1.2rem",textAlign:"center",fontFamily:"Tamanegi, sans-serif"},children:[l.jsx("p",{children:""}),l.jsx("p",{style:{fontSize:"0.9rem",opacity:.7},children:h})]}),u&&!h&&l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1rem"},children:[l.jsx("div",{className:"loading-spinner",style:{width:"50px",height:"50px",border:"4px solid rgba(233, 69, 96, 0.3)",borderTop:"4px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),l.jsx("p",{style:{opacity:.8,fontFamily:"Tamanegi, sans-serif"},children:t==="HOST"?"...":"..."})]}),t==="HOST"&&i&&!u&&!a&&!h&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.5rem"},children:[l.jsx("p",{style:{fontSize:"1rem",opacity:.7,fontFamily:"Tamanegi, sans-serif"},children:"ID:"}),l.jsx("div",{style:{fontSize:"2rem",fontFamily:"monospace",fontWeight:"bold",padding:"0.5rem 1rem",background:"rgba(233, 69, 96, 0.2)",borderRadius:"8px",border:"1px solid #e94560",letterSpacing:"2px"},children:i})]}),l.jsx("button",{onClick:k,style:{fontSize:"1rem",padding:"0.8rem 2rem",background:m?"#48bb78":"transparent",border:"2px solid "+(m?"#48bb78":"#e94560"),color:"#fff",cursor:"pointer",transition:"all 0.3s",borderRadius:"4px",fontWeight:"bold",fontFamily:"Tamanegi, sans-serif"},children:m?" ":"ID"}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginTop:"1rem",opacity:.7},children:[l.jsx("div",{className:"loading-spinner",style:{width:"20px",height:"20px",border:"2px solid rgba(233, 69, 96, 0.3)",borderTop:"2px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),l.jsx("span",{style:{fontFamily:"Tamanegi, sans-serif"},children:"..."})]})]}),t==="JOIN"&&!u&&!a&&!h&&l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[l.jsx("div",{className:"loading-spinner",style:{width:"20px",height:"20px",border:"2px solid rgba(233, 69, 96, 0.3)",borderTop:"2px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),l.jsxs("span",{style:{fontFamily:"Tamanegi, sans-serif"},children:[" ",e," ..."]})]}),a&&l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1rem"},children:[l.jsx("p",{style:{fontSize:"1.5rem",color:"#48bb78",fontFamily:"Tamanegi, sans-serif"},children:" "}),l.jsx("p",{style:{fontFamily:"Tamanegi, sans-serif"},children:"..."})]}),l.jsxs("div",{style:{marginTop:"1rem",padding:"0.5rem 1rem",background:"rgba(255,255,255,0.1)",borderRadius:"4px",fontSize:"0.9rem",opacity:.7,fontFamily:"Tamanegi, sans-serif"},children:[": ",n==="SENKA"?"":n==="AJA"?"":"yoRuka"]})]}),l.jsx("button",{onClick:$,style:{fontSize:"1rem",padding:"0.8rem 2rem",background:"transparent",border:"1px solid #888",color:"#888",cursor:"pointer",transition:"all 0.3s",borderRadius:"4px",marginTop:"1rem",fontFamily:"Tamanegi, sans-serif"},onMouseOver:B=>{B.currentTarget.style.color="#fff",B.currentTarget.style.borderColor="#fff"},onMouseOut:B=>{B.currentTarget.style.color="#888",B.currentTarget.style.borderColor="#888"},children:" "}),l.jsx("style",{children:`
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `})]})},B2=()=>{};var ym={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T1={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ce=function(t,e){if(!t)throw ao(e)},ao=function(t){return new Error("Firebase Database ("+T1.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I1=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},U2=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=t[n++],o=t[n++],a=t[n++],c=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{const i=t[n++],o=t[n++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},Th={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<t.length;s+=3){const i=t[s],o=s+1<t.length,a=o?t[s+1]:0,c=s+2<t.length,u=c?t[s+2]:0,p=i>>2,h=(i&3)<<4|a>>4;let f=(a&15)<<2|u>>6,m=u&63;c||(m=64,o||(f=64)),r.push(n[p],n[h],n[f],n[m])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(I1(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):U2(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<t.length;){const i=n[t.charAt(s++)],a=s<t.length?n[t.charAt(s)]:0;++s;const u=s<t.length?n[t.charAt(s)]:64;++s;const h=s<t.length?n[t.charAt(s)]:64;if(++s,i==null||a==null||u==null||h==null)throw new z2;const f=i<<2|a>>4;if(r.push(f),u!==64){const m=a<<4&240|u>>2;if(r.push(m),h!==64){const b=u<<6&192|h;r.push(b)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class z2 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const k1=function(t){const e=I1(t);return Th.encodeByteArray(e,!0)},Fc=function(t){return k1(t).replace(/\./g,"")},np=function(t){try{return Th.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function H2(t){return w1(void 0,t)}function w1(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const n=e;return new Date(n.getTime());case Object:t===void 0&&(t={});break;case Array:t=[];break;default:return e}for(const n in e)!e.hasOwnProperty(n)||!W2(n)||(t[n]=w1(t[n],e[n]));return t}function W2(t){return t!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function G2(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V2=()=>G2().__FIREBASE_DEFAULTS__,Y2=()=>{if(typeof process>"u"||typeof ym>"u")return;const t=ym.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},K2=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&np(t[1]);return e&&JSON.parse(e)},A1=()=>{try{return B2()||V2()||Y2()||K2()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},X2=t=>{var e,n;return(n=(e=A1())==null?void 0:e.emulatorHosts)==null?void 0:n[t]},Q2=t=>{const e=X2(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},R1=()=>{var t;return(t=A1())==null?void 0:t.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rr{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ih(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function J2(t){return(await fetch(t,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function q2(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",s=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...t};return[Fc(JSON.stringify(n)),Fc(JSON.stringify(o)),""].join(".")}const Jo={};function Z2(){const t={prod:[],emulator:[]};for(const e of Object.keys(Jo))Jo[e]?t.emulator.push(e):t.prod.push(e);return t}function eC(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let vm=!1;function tC(t,e){if(typeof window>"u"||typeof document>"u"||!Ih(window.location.host)||Jo[t]===e||Jo[t]||vm)return;Jo[t]=e;function n(f){return`__firebase__banner__${f}`}const r="__firebase__banner",i=Z2().prod.length>0;function o(){const f=document.getElementById(r);f&&f.remove()}function a(f){f.style.display="flex",f.style.background="#7faaf0",f.style.position="fixed",f.style.bottom="5px",f.style.left="5px",f.style.padding=".5em",f.style.borderRadius="5px",f.style.alignItems="center"}function c(f,m){f.setAttribute("width","24"),f.setAttribute("id",m),f.setAttribute("height","24"),f.setAttribute("viewBox","0 0 24 24"),f.setAttribute("fill","none"),f.style.marginLeft="-6px"}function u(){const f=document.createElement("span");return f.style.cursor="pointer",f.style.marginLeft="16px",f.style.fontSize="24px",f.innerHTML=" &times;",f.onclick=()=>{vm=!0,o()},f}function p(f,m){f.setAttribute("id",m),f.innerText="Learn more",f.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",f.setAttribute("target","__blank"),f.style.paddingLeft="5px",f.style.textDecoration="underline"}function h(){const f=eC(r),m=n("text"),b=document.getElementById(m)||document.createElement("span"),R=n("learnmore"),W=document.getElementById(R)||document.createElement("a"),d=n("preprendIcon"),I=document.getElementById(d)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(f.created){const S=f.element;a(S),p(W,R);const k=u();c(I,d),S.append(I,b,W,k),document.body.appendChild(S)}i?(b.innerText="Preview backend disconnected.",I.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(I.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,b.innerText="Preview backend running in this workspace."),b.setAttribute("id",m)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",h):h()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nC(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function O1(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(nC())}function rC(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function sC(){return T1.NODE_ADMIN===!0}function iC(){try{return typeof indexedDB=="object"}catch{return!1}}function oC(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var i;e(((i=s.error)==null?void 0:i.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aC="FirebaseError";class za extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=aC,Object.setPrototypeOf(this,za.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,P1.prototype.create)}}class P1{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?lC(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new za(s,a,r)}}function lC(t,e){return t.replace(cC,(n,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const cC=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ca(t){return JSON.parse(t)}function Vt(t){return JSON.stringify(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const L1=function(t){let e={},n={},r={},s="";try{const i=t.split(".");e=Ca(np(i[0])||""),n=Ca(np(i[1])||""),s=i[2],r=n.d||{},delete n.d}catch{}return{header:e,claims:n,data:r,signature:s}},uC=function(t){const e=L1(t),n=e.claims;return!!n&&typeof n=="object"&&n.hasOwnProperty("iat")},dC=function(t){const e=L1(t).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function br(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function qi(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}function rp(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function $c(t,e,n){const r={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(r[s]=e.call(n,t[s],s,t));return r}function Bc(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const i=t[s],o=e[s];if(_m(i)&&_m(o)){if(!Bc(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function _m(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fC(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pC{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,n){n||(n=0);const r=this.W_;if(typeof e=="string")for(let h=0;h<16;h++)r[h]=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),n+=4;else for(let h=0;h<16;h++)r[h]=e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3],n+=4;for(let h=16;h<80;h++){const f=r[h-3]^r[h-8]^r[h-14]^r[h-16];r[h]=(f<<1|f>>>31)&4294967295}let s=this.chain_[0],i=this.chain_[1],o=this.chain_[2],a=this.chain_[3],c=this.chain_[4],u,p;for(let h=0;h<80;h++){h<40?h<20?(u=a^i&(o^a),p=1518500249):(u=i^o^a,p=1859775393):h<60?(u=i&o|a&(i|o),p=2400959708):(u=i^o^a,p=3395469782);const f=(s<<5|s>>>27)+u+c+p+r[h]&4294967295;c=a,a=o,o=(i<<30|i>>>2)&4294967295,i=s,s=f}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+i&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,n){if(e==null)return;n===void 0&&(n=e.length);const r=n-this.blockSize;let s=0;const i=this.buf_;let o=this.inbuf_;for(;s<n;){if(o===0)for(;s<=r;)this.compress_(e,s),s+=this.blockSize;if(typeof e=="string"){for(;s<n;)if(i[o]=e.charCodeAt(s),++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}else for(;s<n;)if(i[o]=e[s],++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=n}digest(){const e=[];let n=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=n&255,n/=256;this.compress_(this.buf_);let r=0;for(let s=0;s<5;s++)for(let i=24;i>=0;i-=8)e[r]=this.chain_[s]>>i&255,++r;return e}}function Zi(t,e){return`${t} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hC=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);if(s>=55296&&s<=56319){const i=s-55296;r++,ce(r<t.length,"Surrogate pair missing trail surrogate.");const o=t.charCodeAt(r)-56320;s=65536+(i<<10)+o}s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):s<65536?(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},xu=function(t){let e=0;for(let n=0;n<t.length;n++){const r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,n++):e+=3}return e};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ws(t){return t&&t._delegate?t._delegate:t}class Ta{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const js="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gC{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new Rr;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:n});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(yC(e))try{this.getOrInitializeService({instanceIdentifier:js})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(n);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=js){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=js){return this.instances.has(e)}getOptions(e=js){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const s of r)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:mC(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=js){return this.component?this.component.multipleInstances?e:js:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function mC(t){return t===js?void 0:t}function yC(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vC{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new gC(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var St;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(St||(St={}));const _C={debug:St.DEBUG,verbose:St.VERBOSE,info:St.INFO,warn:St.WARN,error:St.ERROR,silent:St.SILENT},xC=St.INFO,EC={[St.DEBUG]:"log",[St.VERBOSE]:"log",[St.INFO]:"info",[St.WARN]:"warn",[St.ERROR]:"error"},bC=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),s=EC[e];if(s)console[s](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class D1{constructor(e){this.name=e,this._logLevel=xC,this._logHandler=bC,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in St))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?_C[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,St.DEBUG,...e),this._logHandler(this,St.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,St.VERBOSE,...e),this._logHandler(this,St.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,St.INFO,...e),this._logHandler(this,St.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,St.WARN,...e),this._logHandler(this,St.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,St.ERROR,...e),this._logHandler(this,St.ERROR,...e)}}const SC=(t,e)=>e.some(n=>t instanceof n);let xm,Em;function CC(){return xm||(xm=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function TC(){return Em||(Em=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const M1=new WeakMap,sp=new WeakMap,N1=new WeakMap,Ud=new WeakMap,kh=new WeakMap;function IC(t){const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("success",i),t.removeEventListener("error",o)},i=()=>{n(ms(t.result)),s()},o=()=>{r(t.error),s()};t.addEventListener("success",i),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&M1.set(n,t)}).catch(()=>{}),kh.set(e,t),e}function kC(t){if(sp.has(t))return;const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",o),t.removeEventListener("abort",o)},i=()=>{n(),s()},o=()=>{r(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",i),t.addEventListener("error",o),t.addEventListener("abort",o)});sp.set(t,e)}let ip={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return sp.get(t);if(e==="objectStoreNames")return t.objectStoreNames||N1.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ms(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function wC(t){ip=t(ip)}function AC(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(zd(this),e,...n);return N1.set(r,e.sort?e.sort():[e]),ms(r)}:TC().includes(t)?function(...e){return t.apply(zd(this),e),ms(M1.get(this))}:function(...e){return ms(t.apply(zd(this),e))}}function RC(t){return typeof t=="function"?AC(t):(t instanceof IDBTransaction&&kC(t),SC(t,CC())?new Proxy(t,ip):t)}function ms(t){if(t instanceof IDBRequest)return IC(t);if(Ud.has(t))return Ud.get(t);const e=RC(t);return e!==t&&(Ud.set(t,e),kh.set(e,t)),e}const zd=t=>kh.get(t);function OC(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(t,e),a=ms(o);return r&&o.addEventListener("upgradeneeded",c=>{r(ms(o.result),c.oldVersion,c.newVersion,ms(o.transaction),c)}),n&&o.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),a.then(c=>{i&&c.addEventListener("close",()=>i()),s&&c.addEventListener("versionchange",u=>s(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const PC=["get","getKey","getAll","getAllKeys","count"],LC=["put","add","delete","clear"],Hd=new Map;function bm(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Hd.get(e))return Hd.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=LC.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||PC.includes(n)))return;const i=async function(o,...a){const c=this.transaction(o,s?"readwrite":"readonly");let u=c.store;return r&&(u=u.index(a.shift())),(await Promise.all([u[n](...a),s&&c.done]))[0]};return Hd.set(e,i),i}wC(t=>({...t,get:(e,n,r)=>bm(e,n)||t.get(e,n,r),has:(e,n)=>!!bm(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DC{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(MC(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function MC(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const op="@firebase/app",Sm="0.14.6";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ur=new D1("@firebase/app"),NC="@firebase/app-compat",jC="@firebase/analytics-compat",FC="@firebase/analytics",$C="@firebase/app-check-compat",BC="@firebase/app-check",UC="@firebase/auth",zC="@firebase/auth-compat",HC="@firebase/database",WC="@firebase/data-connect",GC="@firebase/database-compat",VC="@firebase/functions",YC="@firebase/functions-compat",KC="@firebase/installations",XC="@firebase/installations-compat",QC="@firebase/messaging",JC="@firebase/messaging-compat",qC="@firebase/performance",ZC="@firebase/performance-compat",e5="@firebase/remote-config",t5="@firebase/remote-config-compat",n5="@firebase/storage",r5="@firebase/storage-compat",s5="@firebase/firestore",i5="@firebase/ai",o5="@firebase/firestore-compat",a5="firebase",l5="12.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ap="[DEFAULT]",c5={[op]:"fire-core",[NC]:"fire-core-compat",[FC]:"fire-analytics",[jC]:"fire-analytics-compat",[BC]:"fire-app-check",[$C]:"fire-app-check-compat",[UC]:"fire-auth",[zC]:"fire-auth-compat",[HC]:"fire-rtdb",[WC]:"fire-data-connect",[GC]:"fire-rtdb-compat",[VC]:"fire-fn",[YC]:"fire-fn-compat",[KC]:"fire-iid",[XC]:"fire-iid-compat",[QC]:"fire-fcm",[JC]:"fire-fcm-compat",[qC]:"fire-perf",[ZC]:"fire-perf-compat",[e5]:"fire-rc",[t5]:"fire-rc-compat",[n5]:"fire-gcs",[r5]:"fire-gcs-compat",[s5]:"fire-fst",[o5]:"fire-fst-compat",[i5]:"fire-vertex","fire-js":"fire-js",[a5]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uc=new Map,u5=new Map,lp=new Map;function Cm(t,e){try{t.container.addComponent(e)}catch(n){Ur.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function zc(t){const e=t.name;if(lp.has(e))return Ur.debug(`There were multiple attempts to register component ${e}.`),!1;lp.set(e,t);for(const n of Uc.values())Cm(n,t);for(const n of u5.values())Cm(n,t);return!0}function d5(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function f5(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p5={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ys=new P1("app","Firebase",p5);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h5{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Ta("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ys.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g5=l5;function j1(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:ap,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw ys.create("bad-app-name",{appName:String(s)});if(n||(n=R1()),!n)throw ys.create("no-options");const i=Uc.get(s);if(i){if(Bc(n,i.options)&&Bc(r,i.config))return i;throw ys.create("duplicate-app",{appName:s})}const o=new vC(s);for(const c of lp.values())o.addComponent(c);const a=new h5(n,r,o);return Uc.set(s,a),a}function m5(t=ap){const e=Uc.get(t);if(!e&&t===ap&&R1())return j1();if(!e)throw ys.create("no-app",{appName:t});return e}function zi(t,e,n){let r=c5[t]??t;n&&(r+=`-${n}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const o=[`Unable to register library "${r}" with version "${e}":`];s&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ur.warn(o.join(" "));return}zc(new Ta(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y5="firebase-heartbeat-database",v5=1,Ia="firebase-heartbeat-store";let Wd=null;function F1(){return Wd||(Wd=OC(y5,v5,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Ia)}catch(n){console.warn(n)}}}}).catch(t=>{throw ys.create("idb-open",{originalErrorMessage:t.message})})),Wd}async function _5(t){try{const n=(await F1()).transaction(Ia),r=await n.objectStore(Ia).get($1(t));return await n.done,r}catch(e){if(e instanceof za)Ur.warn(e.message);else{const n=ys.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Ur.warn(n.message)}}}async function Tm(t,e){try{const r=(await F1()).transaction(Ia,"readwrite");await r.objectStore(Ia).put(e,$1(t)),await r.done}catch(n){if(n instanceof za)Ur.warn(n.message);else{const r=ys.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});Ur.warn(r.message)}}}function $1(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x5=1024,E5=30;class b5{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new C5(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Im();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)==null?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats.length>E5){const o=T5(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){Ur.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=Im(),{heartbeatsToSend:r,unsentEntries:s}=S5(this._heartbeatsCache.heartbeats),i=Fc(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(n){return Ur.warn(n),""}}}function Im(){return new Date().toISOString().substring(0,10)}function S5(t,e=x5){const n=[];let r=t.slice();for(const s of t){const i=n.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),km(n)>e){i.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),km(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class C5{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return iC()?oC().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await _5(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Tm(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Tm(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function km(t){return Fc(JSON.stringify({version:2,heartbeats:t})).length}function T5(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function I5(t){zc(new Ta("platform-logger",e=>new DC(e),"PRIVATE")),zc(new Ta("heartbeat",e=>new b5(e),"PRIVATE")),zi(op,Sm,t),zi(op,Sm,"esm2020"),zi("fire-js","")}I5("");var k5="firebase",w5="12.7.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */zi(k5,w5,"app");var wm={};const Am="@firebase/database",Rm="1.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let B1="";function A5(t){B1=t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R5{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,n){n==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Vt(n))}get(e){const n=this.domStorage_.getItem(this.prefixedName_(e));return n==null?null:Ca(n)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O5{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,n){n==null?delete this.cache_[e]:this.cache_[e]=n}get(e){return br(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U1=function(t){try{if(typeof window<"u"&&typeof window[t]<"u"){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new R5(e)}}catch{}return new O5},Hs=U1("localStorage"),P5=U1("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hi=new D1("@firebase/database"),L5=function(){let t=1;return function(){return t++}}(),z1=function(t){const e=hC(t),n=new pC;n.update(e);const r=n.digest();return Th.encodeByteArray(r)},Ha=function(...t){let e="";for(let n=0;n<t.length;n++){const r=t[n];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=Ha.apply(null,r):typeof r=="object"?e+=Vt(r):e+=r,e+=" "}return e};let qo=null,Om=!0;const D5=function(t,e){ce(!0,"Can't turn on custom loggers persistently."),Hi.logLevel=St.VERBOSE,qo=Hi.log.bind(Hi)},nn=function(...t){if(Om===!0&&(Om=!1,qo===null&&P5.get("logging_enabled")===!0&&D5()),qo){const e=Ha.apply(null,t);qo(e)}},Wa=function(t){return function(...e){nn(t,...e)}},cp=function(...t){const e="FIREBASE INTERNAL ERROR: "+Ha(...t);Hi.error(e)},zr=function(...t){const e=`FIREBASE FATAL ERROR: ${Ha(...t)}`;throw Hi.error(e),new Error(e)},Ln=function(...t){const e="FIREBASE WARNING: "+Ha(...t);Hi.warn(e)},M5=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Ln("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Eu=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},N5=function(t){if(document.readyState==="complete")t();else{let e=!1;const n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&n()}),window.attachEvent("onload",n))}},eo="[MIN_NAME]",Zs="[MAX_NAME]",ai=function(t,e){if(t===e)return 0;if(t===eo||e===Zs)return-1;if(e===eo||t===Zs)return 1;{const n=Pm(t),r=Pm(e);return n!==null?r!==null?n-r===0?t.length-e.length:n-r:-1:r!==null?1:t<e?-1:1}},j5=function(t,e){return t===e?0:t<e?-1:1},Lo=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+Vt(e))},wh=function(t){if(typeof t!="object"||t===null)return Vt(t);const e=[];for(const r in t)e.push(r);e.sort();let n="{";for(let r=0;r<e.length;r++)r!==0&&(n+=","),n+=Vt(e[r]),n+=":",n+=wh(t[e[r]]);return n+="}",n},H1=function(t,e){const n=t.length;if(n<=e)return[t];const r=[];for(let s=0;s<n;s+=e)s+e>n?r.push(t.substring(s,n)):r.push(t.substring(s,s+e));return r};function hn(t,e){for(const n in t)t.hasOwnProperty(n)&&e(n,t[n])}const W1=function(t){ce(!Eu(t),"Invalid JSON number");const e=11,n=52,r=(1<<e-1)-1;let s,i,o,a,c;t===0?(i=0,o=0,s=1/t===-1/0?1:0):(s=t<0,t=Math.abs(t),t>=Math.pow(2,1-r)?(a=Math.min(Math.floor(Math.log(t)/Math.LN2),r),i=a+r,o=Math.round(t*Math.pow(2,n-a)-Math.pow(2,n))):(i=0,o=Math.round(t/Math.pow(2,1-r-n))));const u=[];for(c=n;c;c-=1)u.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)u.push(i%2?1:0),i=Math.floor(i/2);u.push(s?1:0),u.reverse();const p=u.join("");let h="";for(c=0;c<64;c+=8){let f=parseInt(p.substr(c,8),2).toString(16);f.length===1&&(f="0"+f),h=h+f}return h.toLowerCase()},F5=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},$5=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function B5(t,e){let n="Unknown Error";t==="too_big"?n="The data requested exceeds the maximum size that can be accessed with a single request.":t==="permission_denied"?n="Client doesn't have permission to access the desired data.":t==="unavailable"&&(n="The service is unavailable");const r=new Error(t+" at "+e._path.toString()+": "+n);return r.code=t.toUpperCase(),r}const U5=new RegExp("^-?(0*)\\d{1,10}$"),z5=-2147483648,H5=2147483647,Pm=function(t){if(U5.test(t)){const e=Number(t);if(e>=z5&&e<=H5)return e}return null},lo=function(t){try{t()}catch(e){setTimeout(()=>{const n=e.stack||"";throw Ln("Exception was thrown by user callback.",n),e},Math.floor(0))}},W5=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Zo=function(t,e){const n=setTimeout(t,e);return typeof n=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(n):typeof n=="object"&&n.unref&&n.unref(),n};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G5{constructor(e,n){this.appCheckProvider=n,this.appName=e.name,f5(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=n==null?void 0:n.getImmediate({optional:!0}),this.appCheck||n==null||n.get().then(r=>this.appCheck=r)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((n,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(n,r):n(null)},0)})}addTokenChangeListener(e){var n;(n=this.appCheckProvider)==null||n.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){Ln(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V5{constructor(e,n,r){this.appName_=e,this.firebaseOptions_=n,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(n=>n&&n.code==="auth/token-not-initialized"?(nn("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(n)):new Promise((n,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(n,r):n(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(n=>n.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(n=>n.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Ln(e)}}class cc{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}cc.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ah="5",G1="v",V1="s",Y1="r",K1="f",X1=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Q1="ls",J1="p",up="ac",q1="websocket",Z1="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ex{constructor(e,n,r,s,i=!1,o="",a=!1,c=!1,u=null){this.secure=n,this.namespace=r,this.webSocketOnly=s,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=c,this.emulatorOptions=u,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Hs.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Hs.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",n=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${n}`}}function Y5(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function tx(t,e,n){ce(typeof e=="string","typeof type must == string"),ce(typeof n=="object","typeof params must == object");let r;if(e===q1)r=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===Z1)r=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);Y5(t)&&(n.ns=t.namespace);const s=[];return hn(n,(i,o)=>{s.push(i+"="+o)}),r+s.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K5{constructor(){this.counters_={}}incrementCounter(e,n=1){br(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=n}get(){return H2(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gd={},Vd={};function Rh(t){const e=t.toString();return Gd[e]||(Gd[e]=new K5),Gd[e]}function X5(t,e){const n=t.toString();return Vd[n]||(Vd[n]=e()),Vd[n]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q5{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,n){this.closeAfterResponse=e,this.onClose=n,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,n){for(this.pendingResponses[e]=n;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<r.length;++s)r[s]&&lo(()=>{this.onMessage_(r[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lm="start",J5="close",q5="pLPCommand",Z5="pRTLPCB",nx="id",rx="pw",sx="ser",eT="cb",tT="seg",nT="ts",rT="d",sT="dframe",ix=1870,ox=30,iT=ix-ox,oT=25e3,aT=3e4;class Di{constructor(e,n,r,s,i,o,a){this.connId=e,this.repoInfo=n,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Wa(e),this.stats_=Rh(n),this.urlFn=c=>(this.appCheckToken&&(c[up]=this.appCheckToken),tx(n,Z1,c))}open(e,n){this.curSegmentNum=0,this.onDisconnect_=n,this.myPacketOrderer=new Q5(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(aT)),N5(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Oh((...i)=>{const[o,a,c,u,p]=i;if(this.incrementIncomingBytes_(i),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===Lm)this.id=a,this.password=c;else if(o===J5)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...i)=>{const[o,a]=i;this.incrementIncomingBytes_(i),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const r={};r[Lm]="t",r[sx]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[eT]=this.scriptTagHolder.uniqueCallbackIdentifier),r[G1]=Ah,this.transportSessionId&&(r[V1]=this.transportSessionId),this.lastSessionId&&(r[Q1]=this.lastSessionId),this.applicationId&&(r[J1]=this.applicationId),this.appCheckToken&&(r[up]=this.appCheckToken),typeof location<"u"&&location.hostname&&X1.test(location.hostname)&&(r[Y1]=K1);const s=this.urlFn(r);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Di.forceAllow_=!0}static forceDisallow(){Di.forceDisallow_=!0}static isAvailable(){return Di.forceAllow_?!0:!Di.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!F5()&&!$5()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const n=Vt(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const r=k1(n),s=H1(r,iT);for(let i=0;i<s.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[i]),this.curSegmentNum++}addDisconnectPingFrame(e,n){this.myDisconnFrame=document.createElement("iframe");const r={};r[sT]="t",r[nx]=e,r[rx]=n,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const n=Vt(e).length;this.bytesReceived+=n,this.stats_.incrementCounter("bytes_received",n)}}class Oh{constructor(e,n,r,s){this.onDisconnect=r,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=L5(),window[q5+this.uniqueCallbackIdentifier]=e,window[Z5+this.uniqueCallbackIdentifier]=n,this.myIFrame=Oh.createIFrame_();let i="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(i='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){nn("frame writing exception"),a.stack&&nn(a.stack),nn(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||nn("No IE domain setting required")}catch{const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,n){for(this.myID=e,this.myPW=n,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[nx]=this.myID,e[rx]=this.myPW,e[sx]=this.currentSerial;let n=this.urlFn(e),r="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+ox+r.length<=ix;){const o=this.pendingSegs.shift();r=r+"&"+tT+s+"="+o.seg+"&"+nT+s+"="+o.ts+"&"+rT+s+"="+o.d,s++}return n=n+r,this.addLongPollTag_(n,this.currentSerial),!0}else return!1}enqueueSegment(e,n,r){this.pendingSegs.push({seg:e,ts:n,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,n){this.outstandingRequests.add(n);const r=()=>{this.outstandingRequests.delete(n),this.newRequest_()},s=setTimeout(r,Math.floor(oT)),i=()=>{clearTimeout(s),r()};this.addTag(e,i)}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const s=r.readyState;(!s||s==="loaded"||s==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),n())},r.onerror=()=>{nn("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lT=16384,cT=45e3;let Hc=null;typeof MozWebSocket<"u"?Hc=MozWebSocket:typeof WebSocket<"u"&&(Hc=WebSocket);class ir{constructor(e,n,r,s,i,o,a){this.connId=e,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Wa(this.connId),this.stats_=Rh(n),this.connURL=ir.connectionURL_(n,o,a,s,r),this.nodeAdmin=n.nodeAdmin}static connectionURL_(e,n,r,s,i){const o={};return o[G1]=Ah,typeof location<"u"&&location.hostname&&X1.test(location.hostname)&&(o[Y1]=K1),n&&(o[V1]=n),r&&(o[Q1]=r),s&&(o[up]=s),i&&(o[J1]=i),tx(e,q1,o)}open(e,n){this.onDisconnect=n,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Hs.set("previous_websocket_failure",!0);try{let r;sC(),this.mySock=new Hc(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){ir.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const n=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(n);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&Hc!==null&&!ir.forceDisallow_}static previouslyFailed(){return Hs.isInMemoryStorage||Hs.get("previous_websocket_failure")===!0}markConnectionHealthy(){Hs.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const n=this.frames.join("");this.frames=null;const r=Ca(n);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(ce(this.frames===null,"We already have a frame buffer"),e.length<=6){const n=Number(e);if(!isNaN(n))return this.handleNewFrameCount_(n),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const n=e.data;if(this.bytesReceived+=n.length,this.stats_.incrementCounter("bytes_received",n.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(n);else{const r=this.extractFrameCount_(n);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();const n=Vt(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const r=H1(n,lT);r.length>1&&this.sendString_(String(r.length));for(let s=0;s<r.length;s++)this.sendString_(r[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(cT))}sendString_(e){try{this.mySock.send(e)}catch(n){this.log_("Exception thrown from WebSocket.send():",n.message||n.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}ir.responsesRequiredToBeHealthy=2;ir.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ka{static get ALL_TRANSPORTS(){return[Di,ir]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const n=ir&&ir.isAvailable();let r=n&&!ir.previouslyFailed();if(e.webSocketOnly&&(n||Ln("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[ir];else{const s=this.transports_=[];for(const i of ka.ALL_TRANSPORTS)i&&i.isAvailable()&&s.push(i);ka.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}ka.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uT=6e4,dT=5e3,fT=10*1024,pT=100*1024,Yd="t",Dm="d",hT="s",Mm="r",gT="e",Nm="o",jm="a",Fm="n",$m="p",mT="h";class yT{constructor(e,n,r,s,i,o,a,c,u,p){this.id=e,this.repoInfo_=n,this.applicationId_=r,this.appCheckToken_=s,this.authToken_=i,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=c,this.onKill_=u,this.lastSessionId=p,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Wa("c:"+this.id+":"),this.transportManager_=new ka(n),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(n,r)},Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=Zo(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>pT?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>fT?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return n=>{e===this.conn_?this.onConnectionLost_(n):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return n=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(n):e===this.secondaryConn_?this.onSecondaryMessageReceived_(n):this.log_("message on old connection"))}}sendRequest(e){const n={t:"d",d:e};this.sendData_(n)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Yd in e){const n=e[Yd];n===jm?this.upgradeIfSecondaryHealthy_():n===Mm?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):n===Nm&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const n=Lo("t",e),r=Lo("d",e);if(n==="c")this.onSecondaryControl_(r);else if(n==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+n)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:$m,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:jm,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:Fm,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const n=Lo("t",e),r=Lo("d",e);n==="c"?this.onControl_(r):n==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const n=Lo(Yd,e);if(Dm in e){const r=e[Dm];if(n===mT){const s={...r};this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(n===Fm){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else n===hT?this.onConnectionShutdown_(r):n===Mm?this.onReset_(r):n===gT?cp("Server Error: "+r):n===Nm?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):cp("Unknown control packet command: "+n)}}onHandshake_(e){const n=e.ts,r=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,n),Ah!==r&&Ln("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),Zo(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(uT))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,n){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(n,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Zo(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(dT))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:$m,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Hs.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ax{put(e,n,r,s){}merge(e,n,r,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,n,r){}onDisconnectMerge(e,n,r){}onDisconnectCancel(e,n){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lx{constructor(e){this.allowedEvents_=e,this.listeners_={},ce(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...n){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let s=0;s<r.length;s++)r[s].callback.apply(r[s].context,n)}}on(e,n,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:n,context:r});const s=this.getInitialEvent(e);s&&n.apply(r,s)}off(e,n,r){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let i=0;i<s.length;i++)if(s[i].callback===n&&(!r||r===s[i].context)){s.splice(i,1);return}}validateEventType_(e){ce(this.allowedEvents_.find(n=>n===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wc extends lx{static getInstance(){return new Wc}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!O1()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return ce(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bm=32,Um=768;class yt{constructor(e,n){if(n===void 0){this.pieces_=e.split("/");let r=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[r]=this.pieces_[s],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=n}toString(){let e="";for(let n=this.pieceNum_;n<this.pieces_.length;n++)this.pieces_[n]!==""&&(e+="/"+this.pieces_[n]);return e||"/"}}function dt(){return new yt("")}function et(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function bs(t){return t.pieces_.length-t.pieceNum_}function Et(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new yt(t.pieces_,e)}function Ph(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function vT(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)t.pieces_[n]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}function wa(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function cx(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new yt(e,0)}function $t(t,e){const n=[];for(let r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);if(e instanceof yt)for(let r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);else{const r=e.split("/");for(let s=0;s<r.length;s++)r[s].length>0&&n.push(r[s])}return new yt(n,0)}function nt(t){return t.pieceNum_>=t.pieces_.length}function _n(t,e){const n=et(t),r=et(e);if(n===null)return e;if(n===r)return _n(Et(t),Et(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function _T(t,e){const n=wa(t,0),r=wa(e,0);for(let s=0;s<n.length&&s<r.length;s++){const i=ai(n[s],r[s]);if(i!==0)return i}return n.length===r.length?0:n.length<r.length?-1:1}function Lh(t,e){if(bs(t)!==bs(e))return!1;for(let n=t.pieceNum_,r=e.pieceNum_;n<=t.pieces_.length;n++,r++)if(t.pieces_[n]!==e.pieces_[r])return!1;return!0}function Kn(t,e){let n=t.pieceNum_,r=e.pieceNum_;if(bs(t)>bs(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[r])return!1;++n,++r}return!0}class xT{constructor(e,n){this.errorPrefix_=n,this.parts_=wa(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=xu(this.parts_[r]);ux(this)}}function ET(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=xu(e),ux(t)}function bT(t){const e=t.parts_.pop();t.byteLength_-=xu(e),t.parts_.length>0&&(t.byteLength_-=1)}function ux(t){if(t.byteLength_>Um)throw new Error(t.errorPrefix_+"has a key path longer than "+Um+" bytes ("+t.byteLength_+").");if(t.parts_.length>Bm)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Bm+") or object contains a cycle "+Fs(t))}function Fs(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dh extends lx{static getInstance(){return new Dh}constructor(){super(["visible"]);let e,n;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(n="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(n="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(n="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(n="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,n&&document.addEventListener(n,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}getInitialEvent(e){return ce(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Do=1e3,ST=60*5*1e3,zm=30*1e3,CT=1.3,TT=3e4,IT="server_kill",Hm=3;class Nr extends ax{constructor(e,n,r,s,i,o,a,c){if(super(),this.repoInfo_=e,this.applicationId_=n,this.onDataUpdate_=r,this.onConnectStatus_=s,this.onServerInfoUpdate_=i,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=c,this.id=Nr.nextPersistentConnectionId_++,this.log_=Wa("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Do,this.maxReconnectDelay_=ST,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Dh.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&Wc.getInstance().on("online",this.onOnline_,this)}sendRequest(e,n,r){const s=++this.requestNumber_,i={r:s,a:e,b:n};this.log_(Vt(i)),ce(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),r&&(this.requestCBHash_[s]=r)}get(e){this.initConnection_();const n=new Rr,s={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?n.resolve(a):n.reject(a)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),n.promise}listen(e,n,r,s){this.initConnection_();const i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),ce(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),ce(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");const a={onComplete:s,hashFn:n,query:e,tag:r};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const n=this.outstandingGets_[e];this.sendRequest("g",n.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(r)})}sendListen_(e){const n=e.query,r=n._path.toString(),s=n._queryIdentifier;this.log_("Listen on "+r+" for "+s);const i={p:r},o="q";e.tag&&(i.q=n._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest(o,i,a=>{const c=a.d,u=a.s;Nr.warnOnListenWarnings_(c,n),(this.listens.get(r)&&this.listens.get(r).get(s))===e&&(this.log_("listen response",a),u!=="ok"&&this.removeListen_(r,s),e.onComplete&&e.onComplete(u,c))})}static warnOnListenWarnings_(e,n){if(e&&typeof e=="object"&&br(e,"w")){const r=qi(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const s='".indexOn": "'+n._queryParams.getIndex().toString()+'"',i=n._path.toString();Ln(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${i} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||dC(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=zm)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,n=uC(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(n,r,s=>{const i=s.s,o=s.d||"error";this.authToken_===e&&(i==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(i,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const n=e.s,r=e.d||"error";n==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(n,r)})}unlisten(e,n){const r=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+s),ce(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,s)&&this.connected_&&this.sendUnlisten_(r,s,e._queryObject,n)}sendUnlisten_(e,n,r,s){this.log_("Unlisten on "+e+" for "+n);const i={p:e},o="n";s&&(i.q=r,i.t=s),this.sendRequest(o,i)}onDisconnectPut(e,n,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,n,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:n,onComplete:r})}onDisconnectMerge(e,n,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,n,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:n,onComplete:r})}onDisconnectCancel(e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:n})}sendOnDisconnect_(e,n,r,s){const i={p:n,d:r};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,o=>{s&&setTimeout(()=>{s(o.s,o.d)},Math.floor(0))})}put(e,n,r,s){this.putInternal("p",e,n,r,s)}merge(e,n,r,s){this.putInternal("m",e,n,r,s)}putInternal(e,n,r,s,i){this.initConnection_();const o={p:n,d:r};i!==void 0&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:s}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+n)}sendPut_(e){const n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,s=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,i=>{this.log_(n+" response",i),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(i.s,i.d)})}reportStats(e){if(this.connected_){const n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,r=>{if(r.s!=="ok"){const i=r.d;this.log_("reportStats","Error sending stats: "+i)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Vt(e));const n=e.r,r=this.requestCBHash_[n];r&&(delete this.requestCBHash_[n],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,n){this.log_("handleServerMessage",e,n),e==="d"?this.onDataUpdate_(n.p,n.d,!1,n.t):e==="m"?this.onDataUpdate_(n.p,n.d,!0,n.t):e==="c"?this.onListenRevoked_(n.p,n.q):e==="ac"?this.onAuthRevoked_(n.s,n.d):e==="apc"?this.onAppCheckRevoked_(n.s,n.d):e==="sd"?this.onSecurityDebugPacket_(n):cp("Unrecognized action received from server: "+Vt(e)+`
Are you using the latest client?`)}onReady_(e,n){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=n,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){ce(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Do,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Do,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>TT&&(this.reconnectDelay_=Do),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let n=Math.max(0,this.reconnectDelay_-e);n=Math.random()*n,this.log_("Trying to reconnect in "+n+"ms"),this.scheduleConnect_(n),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*CT)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+Nr.nextConnectionId_++,i=this.lastSessionId;let o=!1,a=null;const c=function(){a?a.close():(o=!0,r())},u=function(h){ce(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(h)};this.realtime_={close:c,sendRequest:u};const p=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[h,f]=await Promise.all([this.authTokenProvider_.getToken(p),this.appCheckTokenProvider_.getToken(p)]);o?nn("getToken() completed but was canceled"):(nn("getToken() completed. Creating connection."),this.authToken_=h&&h.accessToken,this.appCheckToken_=f&&f.token,a=new yT(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,r,m=>{Ln(m+" ("+this.repoInfo_.toString()+")"),this.interrupt(IT)},i))}catch(h){this.log_("Failed to get token: "+h),o||(this.repoInfo_.nodeAdmin&&Ln(h),c())}}}interrupt(e){nn("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){nn("Resuming connection for reason: "+e),delete this.interruptReasons_[e],rp(this.interruptReasons_)&&(this.reconnectDelay_=Do,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const n=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:n})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const n=this.outstandingPuts_[e];n&&"h"in n.request&&n.queued&&(n.onComplete&&n.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,n){let r;n?r=n.map(i=>wh(i)).join("$"):r="default";const s=this.removeListen_(e,r);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(e,n){const r=new yt(e).toString();let s;if(this.listens.has(r)){const i=this.listens.get(r);s=i.get(n),i.delete(n),i.size===0&&this.listens.delete(r)}else s=void 0;return s}onAuthRevoked_(e,n){nn("Auth token revoked: "+e+"/"+n),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Hm&&(this.reconnectDelay_=zm,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,n){nn("App check token revoked: "+e+"/"+n),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Hm&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const n of e.values())this.sendListen_(n);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let n="js";e["sdk."+n+"."+B1.replace(/\./g,"-")]=1,O1()?e["framework.cordova"]=1:rC()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Wc.getInstance().currentlyOnline();return rp(this.interruptReasons_)&&e}}Nr.nextPersistentConnectionId_=0;Nr.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rt{constructor(e,n){this.name=e,this.node=n}static Wrap(e,n){return new rt(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bu{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,n){const r=new rt(eo,e),s=new rt(eo,n);return this.compare(r,s)!==0}minPost(){return rt.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let jl;class dx extends bu{static get __EMPTY_NODE(){return jl}static set __EMPTY_NODE(e){jl=e}compare(e,n){return ai(e.name,n.name)}isDefinedOn(e){throw ao("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,n){return!1}minPost(){return rt.MIN}maxPost(){return new rt(Zs,jl)}makePost(e,n){return ce(typeof e=="string","KeyIndex indexValue must always be a string."),new rt(e,jl)}toString(){return".key"}}const Wi=new dx;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fl{constructor(e,n,r,s,i=null){this.isReverse_=s,this.resultGenerator_=i,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=n?r(e.key,n):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),n;if(this.resultGenerator_?n=this.resultGenerator_(e.key,e.value):n={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return n}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Qt{constructor(e,n,r,s,i){this.key=e,this.value=n,this.color=r??Qt.RED,this.left=s??An.EMPTY_NODE,this.right=i??An.EMPTY_NODE}copy(e,n,r,s,i){return new Qt(e??this.key,n??this.value,r??this.color,s??this.left,i??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let s=this;const i=r(e,s.key);return i<0?s=s.copy(null,null,null,s.left.insert(e,n,r),null):i===0?s=s.copy(null,n,null,null,null):s=s.copy(null,null,null,null,s.right.insert(e,n,r)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return An.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,n){let r,s;if(r=this,n(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,n),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),n(e,r.key)===0){if(r.right.isEmpty())return An.EMPTY_NODE;s=r.right.min_(),r=r.copy(s.key,s.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,n))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Qt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Qt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Qt.RED=!0;Qt.BLACK=!1;class kT{copy(e,n,r,s,i){return this}insert(e,n,r){return new Qt(e,n,null)}remove(e,n){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class An{constructor(e,n=An.EMPTY_NODE){this.comparator_=e,this.root_=n}insert(e,n){return new An(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,Qt.BLACK,null,null))}remove(e){return new An(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Qt.BLACK,null,null))}get(e){let n,r=this.root_;for(;!r.isEmpty();){if(n=this.comparator_(e,r.key),n===0)return r.value;n<0?r=r.left:n>0&&(r=r.right)}return null}getPredecessorKey(e){let n,r=this.root_,s=null;for(;!r.isEmpty();)if(n=this.comparator_(e,r.key),n===0){if(r.left.isEmpty())return s?s.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else n<0?r=r.left:n>0&&(s=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Fl(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,n){return new Fl(this.root_,e,this.comparator_,!1,n)}getReverseIteratorFrom(e,n){return new Fl(this.root_,e,this.comparator_,!0,n)}getReverseIterator(e){return new Fl(this.root_,null,this.comparator_,!0,e)}}An.EMPTY_NODE=new kT;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wT(t,e){return ai(t.name,e.name)}function Mh(t,e){return ai(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let dp;function AT(t){dp=t}const fx=function(t){return typeof t=="number"?"number:"+W1(t):"string:"+t},px=function(t){if(t.isLeafNode()){const e=t.val();ce(typeof e=="string"||typeof e=="number"||typeof e=="object"&&br(e,".sv"),"Priority must be a string or number.")}else ce(t===dp||t.isEmpty(),"priority of unexpected type.");ce(t===dp||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Wm;class Kt{static set __childrenNodeConstructor(e){Wm=e}static get __childrenNodeConstructor(){return Wm}constructor(e,n=Kt.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=n,this.lazyHash_=null,ce(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),px(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Kt(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:Kt.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return nt(e)?this:et(e)===".priority"?this.priorityNode_:Kt.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,n){return null}updateImmediateChild(e,n){return e===".priority"?this.updatePriority(n):n.isEmpty()&&e!==".priority"?this:Kt.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)}updateChild(e,n){const r=et(e);return r===null?n:n.isEmpty()&&r!==".priority"?this:(ce(r!==".priority"||bs(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,Kt.__childrenNodeConstructor.EMPTY_NODE.updateChild(Et(e),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,n){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+fx(this.priorityNode_.val())+":");const n=typeof this.value_;e+=n+":",n==="number"?e+=W1(this.value_):e+=this.value_,this.lazyHash_=z1(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Kt.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Kt.__childrenNodeConstructor?-1:(ce(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const n=typeof e.value_,r=typeof this.value_,s=Kt.VALUE_TYPE_ORDER.indexOf(n),i=Kt.VALUE_TYPE_ORDER.indexOf(r);return ce(s>=0,"Unknown leaf type: "+n),ce(i>=0,"Unknown leaf type: "+r),s===i?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const n=e;return this.value_===n.value_&&this.priorityNode_.equals(n.priorityNode_)}else return!1}}Kt.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let hx,gx;function RT(t){hx=t}function OT(t){gx=t}class PT extends bu{compare(e,n){const r=e.node.getPriority(),s=n.node.getPriority(),i=r.compareTo(s);return i===0?ai(e.name,n.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,n){return!e.getPriority().equals(n.getPriority())}minPost(){return rt.MIN}maxPost(){return new rt(Zs,new Kt("[PRIORITY-POST]",gx))}makePost(e,n){const r=hx(e);return new rt(n,new Kt("[PRIORITY-POST]",r))}toString(){return".priority"}}const Pt=new PT;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LT=Math.log(2);class DT{constructor(e){const n=i=>parseInt(Math.log(i)/LT,10),r=i=>parseInt(Array(i+1).join("1"),2);this.count=n(e+1),this.current_=this.count-1;const s=r(this.count);this.bits_=e+1&s}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Gc=function(t,e,n,r){t.sort(e);const s=function(c,u){const p=u-c;let h,f;if(p===0)return null;if(p===1)return h=t[c],f=n?n(h):h,new Qt(f,h.node,Qt.BLACK,null,null);{const m=parseInt(p/2,10)+c,b=s(c,m),R=s(m+1,u);return h=t[m],f=n?n(h):h,new Qt(f,h.node,Qt.BLACK,b,R)}},i=function(c){let u=null,p=null,h=t.length;const f=function(b,R){const W=h-b,d=h;h-=b;const I=s(W+1,d),S=t[W],k=n?n(S):S;m(new Qt(k,S.node,R,null,I))},m=function(b){u?(u.left=b,u=b):(p=b,u=b)};for(let b=0;b<c.count;++b){const R=c.nextBitIsOne(),W=Math.pow(2,c.count-(b+1));R?f(W,Qt.BLACK):(f(W,Qt.BLACK),f(W,Qt.RED))}return p},o=new DT(t.length),a=i(o);return new An(r||e,a)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Kd;const _i={};class Dr{static get Default(){return ce(_i&&Pt,"ChildrenNode.ts has not been loaded"),Kd=Kd||new Dr({".priority":_i},{".priority":Pt}),Kd}constructor(e,n){this.indexes_=e,this.indexSet_=n}get(e){const n=qi(this.indexes_,e);if(!n)throw new Error("No index defined for "+e);return n instanceof An?n:null}hasIndex(e){return br(this.indexSet_,e.toString())}addIndex(e,n){ce(e!==Wi,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let s=!1;const i=n.getIterator(rt.Wrap);let o=i.getNext();for(;o;)s=s||e.isDefinedOn(o.node),r.push(o),o=i.getNext();let a;s?a=Gc(r,e.getCompare()):a=_i;const c=e.toString(),u={...this.indexSet_};u[c]=e;const p={...this.indexes_};return p[c]=a,new Dr(p,u)}addToIndexes(e,n){const r=$c(this.indexes_,(s,i)=>{const o=qi(this.indexSet_,i);if(ce(o,"Missing index implementation for "+i),s===_i)if(o.isDefinedOn(e.node)){const a=[],c=n.getIterator(rt.Wrap);let u=c.getNext();for(;u;)u.name!==e.name&&a.push(u),u=c.getNext();return a.push(e),Gc(a,o.getCompare())}else return _i;else{const a=n.get(e.name);let c=s;return a&&(c=c.remove(new rt(e.name,a))),c.insert(e,e.node)}});return new Dr(r,this.indexSet_)}removeFromIndexes(e,n){const r=$c(this.indexes_,s=>{if(s===_i)return s;{const i=n.get(e.name);return i?s.remove(new rt(e.name,i)):s}});return new Dr(r,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Mo;class Fe{static get EMPTY_NODE(){return Mo||(Mo=new Fe(new An(Mh),null,Dr.Default))}constructor(e,n,r){this.children_=e,this.priorityNode_=n,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&px(this.priorityNode_),this.children_.isEmpty()&&ce(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Mo}updatePriority(e){return this.children_.isEmpty()?this:new Fe(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const n=this.children_.get(e);return n===null?Mo:n}}getChild(e){const n=et(e);return n===null?this:this.getImmediateChild(n).getChild(Et(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,n){if(ce(n,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(n);{const r=new rt(e,n);let s,i;n.isEmpty()?(s=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(r,this.children_)):(s=this.children_.insert(e,n),i=this.indexMap_.addToIndexes(r,this.children_));const o=s.isEmpty()?Mo:this.priorityNode_;return new Fe(s,o,i)}}updateChild(e,n){const r=et(e);if(r===null)return n;{ce(et(e)!==".priority"||bs(e)===1,".priority must be the last token in a path");const s=this.getImmediateChild(r).updateChild(Et(e),n);return this.updateImmediateChild(r,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const n={};let r=0,s=0,i=!0;if(this.forEachChild(Pt,(o,a)=>{n[o]=a.val(e),r++,i&&Fe.INTEGER_REGEXP_.test(o)?s=Math.max(s,Number(o)):i=!1}),!e&&i&&s<2*r){const o=[];for(const a in n)o[a]=n[a];return o}else return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+fx(this.getPriority().val())+":"),this.forEachChild(Pt,(n,r)=>{const s=r.hash();s!==""&&(e+=":"+n+":"+s)}),this.lazyHash_=e===""?"":z1(e)}return this.lazyHash_}getPredecessorChildName(e,n,r){const s=this.resolveIndex_(r);if(s){const i=s.getPredecessorKey(new rt(e,n));return i?i.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const n=this.resolveIndex_(e);if(n){const r=n.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){const n=this.getFirstChildName(e);return n?new rt(n,this.children_.get(n)):null}getLastChildName(e){const n=this.resolveIndex_(e);if(n){const r=n.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){const n=this.getLastChildName(e);return n?new rt(n,this.children_.get(n)):null}forEachChild(e,n){const r=this.resolveIndex_(e);return r?r.inorderTraversal(s=>n(s.name,s.node)):this.children_.inorderTraversal(n)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,n){const r=this.resolveIndex_(n);if(r)return r.getIteratorFrom(e,s=>s);{const s=this.children_.getIteratorFrom(e.name,rt.Wrap);let i=s.peek();for(;i!=null&&n.compare(i,e)<0;)s.getNext(),i=s.peek();return s}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,n){const r=this.resolveIndex_(n);if(r)return r.getReverseIteratorFrom(e,s=>s);{const s=this.children_.getReverseIteratorFrom(e.name,rt.Wrap);let i=s.peek();for(;i!=null&&n.compare(i,e)>0;)s.getNext(),i=s.peek();return s}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Ga?-1:0}withIndex(e){if(e===Wi||this.indexMap_.hasIndex(e))return this;{const n=this.indexMap_.addIndex(e,this.children_);return new Fe(this.children_,this.priorityNode_,n)}}isIndexed(e){return e===Wi||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority()))if(this.children_.count()===n.children_.count()){const r=this.getIterator(Pt),s=n.getIterator(Pt);let i=r.getNext(),o=s.getNext();for(;i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=r.getNext(),o=s.getNext()}return i===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===Wi?null:this.indexMap_.get(e.toString())}}Fe.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class MT extends Fe{constructor(){super(new An(Mh),Fe.EMPTY_NODE,Dr.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Fe.EMPTY_NODE}isEmpty(){return!1}}const Ga=new MT;Object.defineProperties(rt,{MIN:{value:new rt(eo,Fe.EMPTY_NODE)},MAX:{value:new rt(Zs,Ga)}});dx.__EMPTY_NODE=Fe.EMPTY_NODE;Kt.__childrenNodeConstructor=Fe;AT(Ga);OT(Ga);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NT=!0;function Ft(t,e=null){if(t===null)return Fe.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),ce(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){const n=t;return new Kt(n,Ft(e))}if(!(t instanceof Array)&&NT){const n=[];let r=!1;if(hn(t,(o,a)=>{if(o.substring(0,1)!=="."){const c=Ft(a);c.isEmpty()||(r=r||!c.getPriority().isEmpty(),n.push(new rt(o,c)))}}),n.length===0)return Fe.EMPTY_NODE;const i=Gc(n,wT,o=>o.name,Mh);if(r){const o=Gc(n,Pt.getCompare());return new Fe(i,Ft(e),new Dr({".priority":o},{".priority":Pt}))}else return new Fe(i,Ft(e),Dr.Default)}else{let n=Fe.EMPTY_NODE;return hn(t,(r,s)=>{if(br(t,r)&&r.substring(0,1)!=="."){const i=Ft(s);(i.isLeafNode()||!i.isEmpty())&&(n=n.updateImmediateChild(r,i))}}),n.updatePriority(Ft(e))}}RT(Ft);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jT extends bu{constructor(e){super(),this.indexPath_=e,ce(!nt(e)&&et(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,n){const r=this.extractChild(e.node),s=this.extractChild(n.node),i=r.compareTo(s);return i===0?ai(e.name,n.name):i}makePost(e,n){const r=Ft(e),s=Fe.EMPTY_NODE.updateChild(this.indexPath_,r);return new rt(n,s)}maxPost(){const e=Fe.EMPTY_NODE.updateChild(this.indexPath_,Ga);return new rt(Zs,e)}toString(){return wa(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FT extends bu{compare(e,n){const r=e.node.compareTo(n.node);return r===0?ai(e.name,n.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,n){return!e.equals(n)}minPost(){return rt.MIN}maxPost(){return rt.MAX}makePost(e,n){const r=Ft(e);return new rt(n,r)}toString(){return".value"}}const $T=new FT;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mx(t){return{type:"value",snapshotNode:t}}function to(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function Aa(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function Ra(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}function BT(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nh{constructor(e){this.index_=e}updateChild(e,n,r,s,i,o){ce(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(n);return a.getChild(s).equals(r.getChild(s))&&a.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(n)?o.trackChildChange(Aa(n,a)):ce(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(to(n,r)):o.trackChildChange(Ra(n,r,a))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(n,r).withIndex(this.index_)}updateFullNode(e,n,r){return r!=null&&(e.isLeafNode()||e.forEachChild(Pt,(s,i)=>{n.hasChild(s)||r.trackChildChange(Aa(s,i))}),n.isLeafNode()||n.forEachChild(Pt,(s,i)=>{if(e.hasChild(s)){const o=e.getImmediateChild(s);o.equals(i)||r.trackChildChange(Ra(s,i,o))}else r.trackChildChange(to(s,i))})),n.withIndex(this.index_)}updatePriority(e,n){return e.isEmpty()?Fe.EMPTY_NODE:e.updatePriority(n)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oa{constructor(e){this.indexedFilter_=new Nh(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Oa.getStartPost_(e),this.endPost_=Oa.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const n=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return n&&r}updateChild(e,n,r,s,i,o){return this.matches(new rt(n,r))||(r=Fe.EMPTY_NODE),this.indexedFilter_.updateChild(e,n,r,s,i,o)}updateFullNode(e,n,r){n.isLeafNode()&&(n=Fe.EMPTY_NODE);let s=n.withIndex(this.index_);s=s.updatePriority(Fe.EMPTY_NODE);const i=this;return n.forEachChild(Pt,(o,a)=>{i.matches(new rt(o,a))||(s=s.updateImmediateChild(o,Fe.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,r)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const n=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),n)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const n=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),n)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UT{constructor(e){this.withinDirectionalStart=n=>this.reverse_?this.withinEndPost(n):this.withinStartPost(n),this.withinDirectionalEnd=n=>this.reverse_?this.withinStartPost(n):this.withinEndPost(n),this.withinStartPost=n=>{const r=this.index_.compare(this.rangedFilter_.getStartPost(),n);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=n=>{const r=this.index_.compare(n,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new Oa(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,n,r,s,i,o){return this.rangedFilter_.matches(new rt(n,r))||(r=Fe.EMPTY_NODE),e.getImmediateChild(n).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,n,r,s,i,o):this.fullLimitUpdateChild_(e,n,r,i,o)}updateFullNode(e,n,r){let s;if(n.isLeafNode()||n.isEmpty())s=Fe.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<n.numChildren()&&n.isIndexed(this.index_)){s=Fe.EMPTY_NODE.withIndex(this.index_);let i;this.reverse_?i=n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):i=n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;i.hasNext()&&o<this.limit_;){const a=i.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))s=s.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{s=n.withIndex(this.index_),s=s.updatePriority(Fe.EMPTY_NODE);let i;this.reverse_?i=s.getReverseIterator(this.index_):i=s.getIterator(this.index_);let o=0;for(;i.hasNext();){const a=i.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:s=s.updateImmediateChild(a.name,Fe.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,r)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,n,r,s,i){let o;if(this.reverse_){const h=this.index_.getCompare();o=(f,m)=>h(m,f)}else o=this.index_.getCompare();const a=e;ce(a.numChildren()===this.limit_,"");const c=new rt(n,r),u=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),p=this.rangedFilter_.matches(c);if(a.hasChild(n)){const h=a.getImmediateChild(n);let f=s.getChildAfterChild(this.index_,u,this.reverse_);for(;f!=null&&(f.name===n||a.hasChild(f.name));)f=s.getChildAfterChild(this.index_,f,this.reverse_);const m=f==null?1:o(f,c);if(p&&!r.isEmpty()&&m>=0)return i!=null&&i.trackChildChange(Ra(n,r,h)),a.updateImmediateChild(n,r);{i!=null&&i.trackChildChange(Aa(n,h));const R=a.updateImmediateChild(n,Fe.EMPTY_NODE);return f!=null&&this.rangedFilter_.matches(f)?(i!=null&&i.trackChildChange(to(f.name,f.node)),R.updateImmediateChild(f.name,f.node)):R}}else return r.isEmpty()?e:p&&o(u,c)>=0?(i!=null&&(i.trackChildChange(Aa(u.name,u.node)),i.trackChildChange(to(n,r))),a.updateImmediateChild(n,r).updateImmediateChild(u.name,Fe.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jh{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Pt}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return ce(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return ce(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:eo}hasEnd(){return this.endSet_}getIndexEndValue(){return ce(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return ce(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Zs}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return ce(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Pt}copy(){const e=new jh;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function zT(t){return t.loadsAllData()?new Nh(t.getIndex()):t.hasLimit()?new UT(t):new Oa(t)}function Gm(t){const e={};if(t.isDefault())return e;let n;if(t.index_===Pt?n="$priority":t.index_===$T?n="$value":t.index_===Wi?n="$key":(ce(t.index_ instanceof jT,"Unrecognized index type!"),n=t.index_.toString()),e.orderBy=Vt(n),t.startSet_){const r=t.startAfterSet_?"startAfter":"startAt";e[r]=Vt(t.indexStartValue_),t.startNameSet_&&(e[r]+=","+Vt(t.indexStartName_))}if(t.endSet_){const r=t.endBeforeSet_?"endBefore":"endAt";e[r]=Vt(t.indexEndValue_),t.endNameSet_&&(e[r]+=","+Vt(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function Vm(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;n===""&&(t.isViewFromLeft()?n="l":n="r"),e.vf=n}return t.index_!==Pt&&(e.i=t.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vc extends ax{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,n){return n!==void 0?"tag$"+n:(ce(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,n,r,s){super(),this.repoInfo_=e,this.onDataUpdate_=n,this.authTokenProvider_=r,this.appCheckTokenProvider_=s,this.log_=Wa("p:rest:"),this.listens_={}}listen(e,n,r,s){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const o=Vc.getListenId_(e,r),a={};this.listens_[o]=a;const c=Gm(e._queryParams);this.restRequest_(i+".json",c,(u,p)=>{let h=p;if(u===404&&(h=null,u=null),u===null&&this.onDataUpdate_(i,h,!1,r),qi(this.listens_,o)===a){let f;u?u===401?f="permission_denied":f="rest_error:"+u:f="ok",s(f,null)}})}unlisten(e,n){const r=Vc.getListenId_(e,n);delete this.listens_[r]}get(e){const n=Gm(e._queryParams),r=e._path.toString(),s=new Rr;return this.restRequest_(r+".json",n,(i,o)=>{let a=o;i===404&&(a=null,i=null),i===null?(this.onDataUpdate_(r,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(e){}restRequest_(e,n={},r){return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,i])=>{s&&s.accessToken&&(n.auth=s.accessToken),i&&i.token&&(n.ac=i.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+fC(n);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(r&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let c=null;if(a.status>=200&&a.status<300){try{c=Ca(a.responseText)}catch{Ln("Failed to parse JSON response for "+o+": "+a.responseText)}r(null,c)}else a.status!==401&&a.status!==404&&Ln("Got unsuccessful REST response for "+o+" Status: "+a.status),r(a.status);r=null}},a.open("GET",o,!0),a.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HT{constructor(){this.rootNode_=Fe.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,n){this.rootNode_=this.rootNode_.updateChild(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yc(){return{value:null,children:new Map}}function co(t,e,n){if(nt(e))t.value=n,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,n);else{const r=et(e);t.children.has(r)||t.children.set(r,Yc());const s=t.children.get(r);e=Et(e),co(s,e,n)}}function fp(t,e){if(nt(e))return t.value=null,t.children.clear(),!0;if(t.value!==null){if(t.value.isLeafNode())return!1;{const n=t.value;return t.value=null,n.forEachChild(Pt,(r,s)=>{co(t,new yt(r),s)}),fp(t,e)}}else if(t.children.size>0){const n=et(e);return e=Et(e),t.children.has(n)&&fp(t.children.get(n),e)&&t.children.delete(n),t.children.size===0}else return!0}function pp(t,e,n){t.value!==null?n(e,t.value):WT(t,(r,s)=>{const i=new yt(e.toString()+"/"+r);pp(s,i,n)})}function WT(t,e){t.children.forEach((n,r)=>{e(r,n)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GT{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),n={...e};return this.last_&&hn(this.last_,(r,s)=>{n[r]=n[r]-s}),this.last_=e,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ym=10*1e3,VT=30*1e3,YT=5*60*1e3;class KT{constructor(e,n){this.server_=n,this.statsToReport_={},this.statsListener_=new GT(e);const r=Ym+(VT-Ym)*Math.random();Zo(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),n={};let r=!1;hn(e,(s,i)=>{i>0&&br(this.statsToReport_,s)&&(n[s]=i,r=!0)}),r&&this.server_.reportStats(n),Zo(this.reportStats_.bind(this),Math.floor(Math.random()*2*YT))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var or;(function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(or||(or={}));function yx(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Fh(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function $h(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kc{constructor(e,n,r){this.path=e,this.affectedTree=n,this.revert=r,this.type=or.ACK_USER_WRITE,this.source=yx()}operationForChild(e){if(nt(this.path)){if(this.affectedTree.value!=null)return ce(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const n=this.affectedTree.subtree(new yt(e));return new Kc(dt(),n,this.revert)}}else return ce(et(this.path)===e,"operationForChild called for unrelated child."),new Kc(Et(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pa{constructor(e,n){this.source=e,this.path=n,this.type=or.LISTEN_COMPLETE}operationForChild(e){return nt(this.path)?new Pa(this.source,dt()):new Pa(this.source,Et(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ei{constructor(e,n,r){this.source=e,this.path=n,this.snap=r,this.type=or.OVERWRITE}operationForChild(e){return nt(this.path)?new ei(this.source,dt(),this.snap.getImmediateChild(e)):new ei(this.source,Et(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class La{constructor(e,n,r){this.source=e,this.path=n,this.children=r,this.type=or.MERGE}operationForChild(e){if(nt(this.path)){const n=this.children.subtree(new yt(e));return n.isEmpty()?null:n.value?new ei(this.source,dt(),n.value):new La(this.source,dt(),n)}else return ce(et(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new La(this.source,Et(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ss{constructor(e,n,r){this.node_=e,this.fullyInitialized_=n,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(nt(e))return this.isFullyInitialized()&&!this.filtered_;const n=et(e);return this.isCompleteForChild(n)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XT{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function QT(t,e,n,r){const s=[],i=[];return e.forEach(o=>{o.type==="child_changed"&&t.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&i.push(BT(o.childName,o.snapshotNode))}),No(t,s,"child_removed",e,r,n),No(t,s,"child_added",e,r,n),No(t,s,"child_moved",i,r,n),No(t,s,"child_changed",e,r,n),No(t,s,"value",e,r,n),s}function No(t,e,n,r,s,i){const o=r.filter(a=>a.type===n);o.sort((a,c)=>qT(t,a,c)),o.forEach(a=>{const c=JT(t,a,i);s.forEach(u=>{u.respondsTo(a.type)&&e.push(u.createEvent(c,t.query_))})})}function JT(t,e,n){return e.type==="value"||e.type==="child_removed"||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function qT(t,e,n){if(e.childName==null||n.childName==null)throw ao("Should only compare child_ events.");const r=new rt(e.childName,e.snapshotNode),s=new rt(n.childName,n.snapshotNode);return t.index_.compare(r,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Su(t,e){return{eventCache:t,serverCache:e}}function ea(t,e,n,r){return Su(new Ss(e,n,r),t.serverCache)}function vx(t,e,n,r){return Su(t.eventCache,new Ss(e,n,r))}function Xc(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function ti(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Xd;const ZT=()=>(Xd||(Xd=new An(j5)),Xd);class kt{static fromObject(e){let n=new kt(null);return hn(e,(r,s)=>{n=n.set(new yt(r),s)}),n}constructor(e,n=ZT()){this.value=e,this.children=n}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,n){if(this.value!=null&&n(this.value))return{path:dt(),value:this.value};if(nt(e))return null;{const r=et(e),s=this.children.get(r);if(s!==null){const i=s.findRootMostMatchingPathAndValue(Et(e),n);return i!=null?{path:$t(new yt(r),i.path),value:i.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(nt(e))return this;{const n=et(e),r=this.children.get(n);return r!==null?r.subtree(Et(e)):new kt(null)}}set(e,n){if(nt(e))return new kt(n,this.children);{const r=et(e),i=(this.children.get(r)||new kt(null)).set(Et(e),n),o=this.children.insert(r,i);return new kt(this.value,o)}}remove(e){if(nt(e))return this.children.isEmpty()?new kt(null):new kt(null,this.children);{const n=et(e),r=this.children.get(n);if(r){const s=r.remove(Et(e));let i;return s.isEmpty()?i=this.children.remove(n):i=this.children.insert(n,s),this.value===null&&i.isEmpty()?new kt(null):new kt(this.value,i)}else return this}}get(e){if(nt(e))return this.value;{const n=et(e),r=this.children.get(n);return r?r.get(Et(e)):null}}setTree(e,n){if(nt(e))return n;{const r=et(e),i=(this.children.get(r)||new kt(null)).setTree(Et(e),n);let o;return i.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,i),new kt(this.value,o)}}fold(e){return this.fold_(dt(),e)}fold_(e,n){const r={};return this.children.inorderTraversal((s,i)=>{r[s]=i.fold_($t(e,s),n)}),n(e,this.value,r)}findOnPath(e,n){return this.findOnPath_(e,dt(),n)}findOnPath_(e,n,r){const s=this.value?r(n,this.value):!1;if(s)return s;if(nt(e))return null;{const i=et(e),o=this.children.get(i);return o?o.findOnPath_(Et(e),$t(n,i),r):null}}foreachOnPath(e,n){return this.foreachOnPath_(e,dt(),n)}foreachOnPath_(e,n,r){if(nt(e))return this;{this.value&&r(n,this.value);const s=et(e),i=this.children.get(s);return i?i.foreachOnPath_(Et(e),$t(n,s),r):new kt(null)}}foreach(e){this.foreach_(dt(),e)}foreach_(e,n){this.children.inorderTraversal((r,s)=>{s.foreach_($t(e,r),n)}),this.value&&n(e,this.value)}foreachChild(e){this.children.inorderTraversal((n,r)=>{r.value&&e(n,r.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cr{constructor(e){this.writeTree_=e}static empty(){return new cr(new kt(null))}}function ta(t,e,n){if(nt(e))return new cr(new kt(n));{const r=t.writeTree_.findRootMostValueAndPath(e);if(r!=null){const s=r.path;let i=r.value;const o=_n(s,e);return i=i.updateChild(o,n),new cr(t.writeTree_.set(s,i))}else{const s=new kt(n),i=t.writeTree_.setTree(e,s);return new cr(i)}}}function Km(t,e,n){let r=t;return hn(n,(s,i)=>{r=ta(r,$t(e,s),i)}),r}function Xm(t,e){if(nt(e))return cr.empty();{const n=t.writeTree_.setTree(e,new kt(null));return new cr(n)}}function hp(t,e){return li(t,e)!=null}function li(t,e){const n=t.writeTree_.findRootMostValueAndPath(e);return n!=null?t.writeTree_.get(n.path).getChild(_n(n.path,e)):null}function Qm(t){const e=[],n=t.writeTree_.value;return n!=null?n.isLeafNode()||n.forEachChild(Pt,(r,s)=>{e.push(new rt(r,s))}):t.writeTree_.children.inorderTraversal((r,s)=>{s.value!=null&&e.push(new rt(r,s.value))}),e}function vs(t,e){if(nt(e))return t;{const n=li(t,e);return n!=null?new cr(new kt(n)):new cr(t.writeTree_.subtree(e))}}function gp(t){return t.writeTree_.isEmpty()}function no(t,e){return _x(dt(),t.writeTree_,e)}function _x(t,e,n){if(e.value!=null)return n.updateChild(t,e.value);{let r=null;return e.children.inorderTraversal((s,i)=>{s===".priority"?(ce(i.value!==null,"Priority writes must always be leaf nodes"),r=i.value):n=_x($t(t,s),i,n)}),!n.getChild(t).isEmpty()&&r!==null&&(n=n.updateChild($t(t,".priority"),r)),n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cu(t,e){return Sx(e,t)}function eI(t,e,n,r,s){ce(r>t.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),t.allWrites.push({path:e,snap:n,writeId:r,visible:s}),s&&(t.visibleWrites=ta(t.visibleWrites,e,n)),t.lastWriteId=r}function tI(t,e){for(let n=0;n<t.allWrites.length;n++){const r=t.allWrites[n];if(r.writeId===e)return r}return null}function nI(t,e){const n=t.allWrites.findIndex(a=>a.writeId===e);ce(n>=0,"removeWrite called with nonexistent writeId.");const r=t.allWrites[n];t.allWrites.splice(n,1);let s=r.visible,i=!1,o=t.allWrites.length-1;for(;s&&o>=0;){const a=t.allWrites[o];a.visible&&(o>=n&&rI(a,r.path)?s=!1:Kn(r.path,a.path)&&(i=!0)),o--}if(s){if(i)return sI(t),!0;if(r.snap)t.visibleWrites=Xm(t.visibleWrites,r.path);else{const a=r.children;hn(a,c=>{t.visibleWrites=Xm(t.visibleWrites,$t(r.path,c))})}return!0}else return!1}function rI(t,e){if(t.snap)return Kn(t.path,e);for(const n in t.children)if(t.children.hasOwnProperty(n)&&Kn($t(t.path,n),e))return!0;return!1}function sI(t){t.visibleWrites=xx(t.allWrites,iI,dt()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function iI(t){return t.visible}function xx(t,e,n){let r=cr.empty();for(let s=0;s<t.length;++s){const i=t[s];if(e(i)){const o=i.path;let a;if(i.snap)Kn(n,o)?(a=_n(n,o),r=ta(r,a,i.snap)):Kn(o,n)&&(a=_n(o,n),r=ta(r,dt(),i.snap.getChild(a)));else if(i.children){if(Kn(n,o))a=_n(n,o),r=Km(r,a,i.children);else if(Kn(o,n))if(a=_n(o,n),nt(a))r=Km(r,dt(),i.children);else{const c=qi(i.children,et(a));if(c){const u=c.getChild(Et(a));r=ta(r,dt(),u)}}}else throw ao("WriteRecord should have .snap or .children")}}return r}function Ex(t,e,n,r,s){if(!r&&!s){const i=li(t.visibleWrites,e);if(i!=null)return i;{const o=vs(t.visibleWrites,e);if(gp(o))return n;if(n==null&&!hp(o,dt()))return null;{const a=n||Fe.EMPTY_NODE;return no(o,a)}}}else{const i=vs(t.visibleWrites,e);if(!s&&gp(i))return n;if(!s&&n==null&&!hp(i,dt()))return null;{const o=function(u){return(u.visible||s)&&(!r||!~r.indexOf(u.writeId))&&(Kn(u.path,e)||Kn(e,u.path))},a=xx(t.allWrites,o,e),c=n||Fe.EMPTY_NODE;return no(a,c)}}}function oI(t,e,n){let r=Fe.EMPTY_NODE;const s=li(t.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(Pt,(i,o)=>{r=r.updateImmediateChild(i,o)}),r;if(n){const i=vs(t.visibleWrites,e);return n.forEachChild(Pt,(o,a)=>{const c=no(vs(i,new yt(o)),a);r=r.updateImmediateChild(o,c)}),Qm(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{const i=vs(t.visibleWrites,e);return Qm(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function aI(t,e,n,r,s){ce(r||s,"Either existingEventSnap or existingServerSnap must exist");const i=$t(e,n);if(hp(t.visibleWrites,i))return null;{const o=vs(t.visibleWrites,i);return gp(o)?s.getChild(n):no(o,s.getChild(n))}}function lI(t,e,n,r){const s=$t(e,n),i=li(t.visibleWrites,s);if(i!=null)return i;if(r.isCompleteForChild(n)){const o=vs(t.visibleWrites,s);return no(o,r.getNode().getImmediateChild(n))}else return null}function cI(t,e){return li(t.visibleWrites,e)}function uI(t,e,n,r,s,i,o){let a;const c=vs(t.visibleWrites,e),u=li(c,dt());if(u!=null)a=u;else if(n!=null)a=no(c,n);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const p=[],h=o.getCompare(),f=i?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o);let m=f.getNext();for(;m&&p.length<s;)h(m,r)!==0&&p.push(m),m=f.getNext();return p}else return[]}function dI(){return{visibleWrites:cr.empty(),allWrites:[],lastWriteId:-1}}function Qc(t,e,n,r){return Ex(t.writeTree,t.treePath,e,n,r)}function Bh(t,e){return oI(t.writeTree,t.treePath,e)}function Jm(t,e,n,r){return aI(t.writeTree,t.treePath,e,n,r)}function Jc(t,e){return cI(t.writeTree,$t(t.treePath,e))}function fI(t,e,n,r,s,i){return uI(t.writeTree,t.treePath,e,n,r,s,i)}function Uh(t,e,n){return lI(t.writeTree,t.treePath,e,n)}function bx(t,e){return Sx($t(t.treePath,e),t.writeTree)}function Sx(t,e){return{treePath:t,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pI{constructor(){this.changeMap=new Map}trackChildChange(e){const n=e.type,r=e.childName;ce(n==="child_added"||n==="child_changed"||n==="child_removed","Only child changes supported for tracking"),ce(r!==".priority","Only non-priority child changes can be tracked.");const s=this.changeMap.get(r);if(s){const i=s.type;if(n==="child_added"&&i==="child_removed")this.changeMap.set(r,Ra(r,e.snapshotNode,s.snapshotNode));else if(n==="child_removed"&&i==="child_added")this.changeMap.delete(r);else if(n==="child_removed"&&i==="child_changed")this.changeMap.set(r,Aa(r,s.oldSnap));else if(n==="child_changed"&&i==="child_added")this.changeMap.set(r,to(r,e.snapshotNode));else if(n==="child_changed"&&i==="child_changed")this.changeMap.set(r,Ra(r,e.snapshotNode,s.oldSnap));else throw ao("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hI{getCompleteChild(e){return null}getChildAfterChild(e,n,r){return null}}const Cx=new hI;class zh{constructor(e,n,r=null){this.writes_=e,this.viewCache_=n,this.optCompleteServerCache_=r}getCompleteChild(e){const n=this.viewCache_.eventCache;if(n.isCompleteForChild(e))return n.getNode().getImmediateChild(e);{const r=this.optCompleteServerCache_!=null?new Ss(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Uh(this.writes_,e,r)}}getChildAfterChild(e,n,r){const s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:ti(this.viewCache_),i=fI(this.writes_,s,n,1,r,e);return i.length===0?null:i[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gI(t){return{filter:t}}function mI(t,e){ce(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),ce(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function yI(t,e,n,r,s){const i=new pI;let o,a;if(n.type===or.OVERWRITE){const u=n;u.source.fromUser?o=mp(t,e,u.path,u.snap,r,s,i):(ce(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered()&&!nt(u.path),o=qc(t,e,u.path,u.snap,r,s,a,i))}else if(n.type===or.MERGE){const u=n;u.source.fromUser?o=_I(t,e,u.path,u.children,r,s,i):(ce(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered(),o=yp(t,e,u.path,u.children,r,s,a,i))}else if(n.type===or.ACK_USER_WRITE){const u=n;u.revert?o=bI(t,e,u.path,r,s,i):o=xI(t,e,u.path,u.affectedTree,r,s,i)}else if(n.type===or.LISTEN_COMPLETE)o=EI(t,e,n.path,r,i);else throw ao("Unknown operation type: "+n.type);const c=i.getChanges();return vI(e,o,c),{viewCache:o,changes:c}}function vI(t,e,n){const r=e.eventCache;if(r.isFullyInitialized()){const s=r.getNode().isLeafNode()||r.getNode().isEmpty(),i=Xc(t);(n.length>0||!t.eventCache.isFullyInitialized()||s&&!r.getNode().equals(i)||!r.getNode().getPriority().equals(i.getPriority()))&&n.push(mx(Xc(e)))}}function Tx(t,e,n,r,s,i){const o=e.eventCache;if(Jc(r,n)!=null)return e;{let a,c;if(nt(n))if(ce(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const u=ti(e),p=u instanceof Fe?u:Fe.EMPTY_NODE,h=Bh(r,p);a=t.filter.updateFullNode(e.eventCache.getNode(),h,i)}else{const u=Qc(r,ti(e));a=t.filter.updateFullNode(e.eventCache.getNode(),u,i)}else{const u=et(n);if(u===".priority"){ce(bs(n)===1,"Can't have a priority with additional path components");const p=o.getNode();c=e.serverCache.getNode();const h=Jm(r,n,p,c);h!=null?a=t.filter.updatePriority(p,h):a=o.getNode()}else{const p=Et(n);let h;if(o.isCompleteForChild(u)){c=e.serverCache.getNode();const f=Jm(r,n,o.getNode(),c);f!=null?h=o.getNode().getImmediateChild(u).updateChild(p,f):h=o.getNode().getImmediateChild(u)}else h=Uh(r,u,e.serverCache);h!=null?a=t.filter.updateChild(o.getNode(),u,h,p,s,i):a=o.getNode()}}return ea(e,a,o.isFullyInitialized()||nt(n),t.filter.filtersNodes())}}function qc(t,e,n,r,s,i,o,a){const c=e.serverCache;let u;const p=o?t.filter:t.filter.getIndexedFilter();if(nt(n))u=p.updateFullNode(c.getNode(),r,null);else if(p.filtersNodes()&&!c.isFiltered()){const m=c.getNode().updateChild(n,r);u=p.updateFullNode(c.getNode(),m,null)}else{const m=et(n);if(!c.isCompleteForPath(n)&&bs(n)>1)return e;const b=Et(n),W=c.getNode().getImmediateChild(m).updateChild(b,r);m===".priority"?u=p.updatePriority(c.getNode(),W):u=p.updateChild(c.getNode(),m,W,b,Cx,null)}const h=vx(e,u,c.isFullyInitialized()||nt(n),p.filtersNodes()),f=new zh(s,h,i);return Tx(t,h,n,s,f,a)}function mp(t,e,n,r,s,i,o){const a=e.eventCache;let c,u;const p=new zh(s,e,i);if(nt(n))u=t.filter.updateFullNode(e.eventCache.getNode(),r,o),c=ea(e,u,!0,t.filter.filtersNodes());else{const h=et(n);if(h===".priority")u=t.filter.updatePriority(e.eventCache.getNode(),r),c=ea(e,u,a.isFullyInitialized(),a.isFiltered());else{const f=Et(n),m=a.getNode().getImmediateChild(h);let b;if(nt(f))b=r;else{const R=p.getCompleteChild(h);R!=null?Ph(f)===".priority"&&R.getChild(cx(f)).isEmpty()?b=R:b=R.updateChild(f,r):b=Fe.EMPTY_NODE}if(m.equals(b))c=e;else{const R=t.filter.updateChild(a.getNode(),h,b,f,p,o);c=ea(e,R,a.isFullyInitialized(),t.filter.filtersNodes())}}}return c}function qm(t,e){return t.eventCache.isCompleteForChild(e)}function _I(t,e,n,r,s,i,o){let a=e;return r.foreach((c,u)=>{const p=$t(n,c);qm(e,et(p))&&(a=mp(t,a,p,u,s,i,o))}),r.foreach((c,u)=>{const p=$t(n,c);qm(e,et(p))||(a=mp(t,a,p,u,s,i,o))}),a}function Zm(t,e,n){return n.foreach((r,s)=>{e=e.updateChild(r,s)}),e}function yp(t,e,n,r,s,i,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,u;nt(n)?u=r:u=new kt(null).setTree(n,r);const p=e.serverCache.getNode();return u.children.inorderTraversal((h,f)=>{if(p.hasChild(h)){const m=e.serverCache.getNode().getImmediateChild(h),b=Zm(t,m,f);c=qc(t,c,new yt(h),b,s,i,o,a)}}),u.children.inorderTraversal((h,f)=>{const m=!e.serverCache.isCompleteForChild(h)&&f.value===null;if(!p.hasChild(h)&&!m){const b=e.serverCache.getNode().getImmediateChild(h),R=Zm(t,b,f);c=qc(t,c,new yt(h),R,s,i,o,a)}}),c}function xI(t,e,n,r,s,i,o){if(Jc(s,n)!=null)return e;const a=e.serverCache.isFiltered(),c=e.serverCache;if(r.value!=null){if(nt(n)&&c.isFullyInitialized()||c.isCompleteForPath(n))return qc(t,e,n,c.getNode().getChild(n),s,i,a,o);if(nt(n)){let u=new kt(null);return c.getNode().forEachChild(Wi,(p,h)=>{u=u.set(new yt(p),h)}),yp(t,e,n,u,s,i,a,o)}else return e}else{let u=new kt(null);return r.foreach((p,h)=>{const f=$t(n,p);c.isCompleteForPath(f)&&(u=u.set(p,c.getNode().getChild(f)))}),yp(t,e,n,u,s,i,a,o)}}function EI(t,e,n,r,s){const i=e.serverCache,o=vx(e,i.getNode(),i.isFullyInitialized()||nt(n),i.isFiltered());return Tx(t,o,n,r,Cx,s)}function bI(t,e,n,r,s,i){let o;if(Jc(r,n)!=null)return e;{const a=new zh(r,e,s),c=e.eventCache.getNode();let u;if(nt(n)||et(n)===".priority"){let p;if(e.serverCache.isFullyInitialized())p=Qc(r,ti(e));else{const h=e.serverCache.getNode();ce(h instanceof Fe,"serverChildren would be complete if leaf node"),p=Bh(r,h)}p=p,u=t.filter.updateFullNode(c,p,i)}else{const p=et(n);let h=Uh(r,p,e.serverCache);h==null&&e.serverCache.isCompleteForChild(p)&&(h=c.getImmediateChild(p)),h!=null?u=t.filter.updateChild(c,p,h,Et(n),a,i):e.eventCache.getNode().hasChild(p)?u=t.filter.updateChild(c,p,Fe.EMPTY_NODE,Et(n),a,i):u=c,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Qc(r,ti(e)),o.isLeafNode()&&(u=t.filter.updateFullNode(u,o,i)))}return o=e.serverCache.isFullyInitialized()||Jc(r,dt())!=null,ea(e,u,o,t.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SI{constructor(e,n){this.query_=e,this.eventRegistrations_=[];const r=this.query_._queryParams,s=new Nh(r.getIndex()),i=zT(r);this.processor_=gI(i);const o=n.serverCache,a=n.eventCache,c=s.updateFullNode(Fe.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(Fe.EMPTY_NODE,a.getNode(),null),p=new Ss(c,o.isFullyInitialized(),s.filtersNodes()),h=new Ss(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=Su(h,p),this.eventGenerator_=new XT(this.query_)}get query(){return this.query_}}function CI(t){return t.viewCache_.serverCache.getNode()}function TI(t){return Xc(t.viewCache_)}function II(t,e){const n=ti(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!nt(e)&&!n.getImmediateChild(et(e)).isEmpty())?n.getChild(e):null}function ey(t){return t.eventRegistrations_.length===0}function kI(t,e){t.eventRegistrations_.push(e)}function ty(t,e,n){const r=[];if(n){ce(e==null,"A cancel should cancel all event registrations.");const s=t.query._path;t.eventRegistrations_.forEach(i=>{const o=i.createCancelEvent(n,s);o&&r.push(o)})}if(e){let s=[];for(let i=0;i<t.eventRegistrations_.length;++i){const o=t.eventRegistrations_[i];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(t.eventRegistrations_.slice(i+1));break}}t.eventRegistrations_=s}else t.eventRegistrations_=[];return r}function ny(t,e,n,r){e.type===or.MERGE&&e.source.queryId!==null&&(ce(ti(t.viewCache_),"We should always have a full cache before handling merges"),ce(Xc(t.viewCache_),"Missing event cache, even though we have a server cache"));const s=t.viewCache_,i=yI(t.processor_,s,e,n,r);return mI(t.processor_,i.viewCache),ce(i.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=i.viewCache,Ix(t,i.changes,i.viewCache.eventCache.getNode(),null)}function wI(t,e){const n=t.viewCache_.eventCache,r=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(Pt,(i,o)=>{r.push(to(i,o))}),n.isFullyInitialized()&&r.push(mx(n.getNode())),Ix(t,r,n.getNode(),e)}function Ix(t,e,n,r){const s=r?[r]:t.eventRegistrations_;return QT(t.eventGenerator_,e,n,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Zc;class kx{constructor(){this.views=new Map}}function AI(t){ce(!Zc,"__referenceConstructor has already been defined"),Zc=t}function RI(){return ce(Zc,"Reference.ts has not been loaded"),Zc}function OI(t){return t.views.size===0}function Hh(t,e,n,r){const s=e.source.queryId;if(s!==null){const i=t.views.get(s);return ce(i!=null,"SyncTree gave us an op for an invalid query."),ny(i,e,n,r)}else{let i=[];for(const o of t.views.values())i=i.concat(ny(o,e,n,r));return i}}function wx(t,e,n,r,s){const i=e._queryIdentifier,o=t.views.get(i);if(!o){let a=Qc(n,s?r:null),c=!1;a?c=!0:r instanceof Fe?(a=Bh(n,r),c=!1):(a=Fe.EMPTY_NODE,c=!1);const u=Su(new Ss(a,c,!1),new Ss(r,s,!1));return new SI(e,u)}return o}function PI(t,e,n,r,s,i){const o=wx(t,e,r,s,i);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,o),kI(o,n),wI(o,n)}function LI(t,e,n,r){const s=e._queryIdentifier,i=[];let o=[];const a=Cs(t);if(s==="default")for(const[c,u]of t.views.entries())o=o.concat(ty(u,n,r)),ey(u)&&(t.views.delete(c),u.query._queryParams.loadsAllData()||i.push(u.query));else{const c=t.views.get(s);c&&(o=o.concat(ty(c,n,r)),ey(c)&&(t.views.delete(s),c.query._queryParams.loadsAllData()||i.push(c.query)))}return a&&!Cs(t)&&i.push(new(RI())(e._repo,e._path)),{removed:i,events:o}}function Ax(t){const e=[];for(const n of t.views.values())n.query._queryParams.loadsAllData()||e.push(n);return e}function _s(t,e){let n=null;for(const r of t.views.values())n=n||II(r,e);return n}function Rx(t,e){if(e._queryParams.loadsAllData())return Tu(t);{const r=e._queryIdentifier;return t.views.get(r)}}function Ox(t,e){return Rx(t,e)!=null}function Cs(t){return Tu(t)!=null}function Tu(t){for(const e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let eu;function DI(t){ce(!eu,"__referenceConstructor has already been defined"),eu=t}function MI(){return ce(eu,"Reference.ts has not been loaded"),eu}let NI=1;class ry{constructor(e){this.listenProvider_=e,this.syncPointTree_=new kt(null),this.pendingWriteTree_=dI(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Px(t,e,n,r,s){return eI(t.pendingWriteTree_,e,n,r,s),s?Ya(t,new ei(yx(),e,n)):[]}function Ws(t,e,n=!1){const r=tI(t.pendingWriteTree_,e);if(nI(t.pendingWriteTree_,e)){let i=new kt(null);return r.snap!=null?i=i.set(dt(),!0):hn(r.children,o=>{i=i.set(new yt(o),!0)}),Ya(t,new Kc(r.path,i,n))}else return[]}function Va(t,e,n){return Ya(t,new ei(Fh(),e,n))}function jI(t,e,n){const r=kt.fromObject(n);return Ya(t,new La(Fh(),e,r))}function FI(t,e){return Ya(t,new Pa(Fh(),e))}function $I(t,e,n){const r=Gh(t,n);if(r){const s=Vh(r),i=s.path,o=s.queryId,a=_n(i,e),c=new Pa($h(o),a);return Yh(t,i,c)}else return[]}function tu(t,e,n,r,s=!1){const i=e._path,o=t.syncPointTree_.get(i);let a=[];if(o&&(e._queryIdentifier==="default"||Ox(o,e))){const c=LI(o,e,n,r);OI(o)&&(t.syncPointTree_=t.syncPointTree_.remove(i));const u=c.removed;if(a=c.events,!s){const p=u.findIndex(f=>f._queryParams.loadsAllData())!==-1,h=t.syncPointTree_.findOnPath(i,(f,m)=>Cs(m));if(p&&!h){const f=t.syncPointTree_.subtree(i);if(!f.isEmpty()){const m=zI(f);for(let b=0;b<m.length;++b){const R=m[b],W=R.query,d=Nx(t,R);t.listenProvider_.startListening(na(W),Da(t,W),d.hashFn,d.onComplete)}}}!h&&u.length>0&&!r&&(p?t.listenProvider_.stopListening(na(e),null):u.forEach(f=>{const m=t.queryToTagMap.get(Iu(f));t.listenProvider_.stopListening(na(f),m)}))}HI(t,u)}return a}function Lx(t,e,n,r){const s=Gh(t,r);if(s!=null){const i=Vh(s),o=i.path,a=i.queryId,c=_n(o,e),u=new ei($h(a),c,n);return Yh(t,o,u)}else return[]}function BI(t,e,n,r){const s=Gh(t,r);if(s){const i=Vh(s),o=i.path,a=i.queryId,c=_n(o,e),u=kt.fromObject(n),p=new La($h(a),c,u);return Yh(t,o,p)}else return[]}function vp(t,e,n,r=!1){const s=e._path;let i=null,o=!1;t.syncPointTree_.foreachOnPath(s,(f,m)=>{const b=_n(f,s);i=i||_s(m,b),o=o||Cs(m)});let a=t.syncPointTree_.get(s);a?(o=o||Cs(a),i=i||_s(a,dt())):(a=new kx,t.syncPointTree_=t.syncPointTree_.set(s,a));let c;i!=null?c=!0:(c=!1,i=Fe.EMPTY_NODE,t.syncPointTree_.subtree(s).foreachChild((m,b)=>{const R=_s(b,dt());R&&(i=i.updateImmediateChild(m,R))}));const u=Ox(a,e);if(!u&&!e._queryParams.loadsAllData()){const f=Iu(e);ce(!t.queryToTagMap.has(f),"View does not exist, but we have a tag");const m=WI();t.queryToTagMap.set(f,m),t.tagToQueryMap.set(m,f)}const p=Cu(t.pendingWriteTree_,s);let h=PI(a,e,n,p,i,c);if(!u&&!o&&!r){const f=Rx(a,e);h=h.concat(GI(t,e,f))}return h}function Wh(t,e,n){const s=t.pendingWriteTree_,i=t.syncPointTree_.findOnPath(e,(o,a)=>{const c=_n(o,e),u=_s(a,c);if(u)return u});return Ex(s,e,i,n,!0)}function UI(t,e){const n=e._path;let r=null;t.syncPointTree_.foreachOnPath(n,(u,p)=>{const h=_n(u,n);r=r||_s(p,h)});let s=t.syncPointTree_.get(n);s?r=r||_s(s,dt()):(s=new kx,t.syncPointTree_=t.syncPointTree_.set(n,s));const i=r!=null,o=i?new Ss(r,!0,!1):null,a=Cu(t.pendingWriteTree_,e._path),c=wx(s,e,a,i?o.getNode():Fe.EMPTY_NODE,i);return TI(c)}function Ya(t,e){return Dx(e,t.syncPointTree_,null,Cu(t.pendingWriteTree_,dt()))}function Dx(t,e,n,r){if(nt(t.path))return Mx(t,e,n,r);{const s=e.get(dt());n==null&&s!=null&&(n=_s(s,dt()));let i=[];const o=et(t.path),a=t.operationForChild(o),c=e.children.get(o);if(c&&a){const u=n?n.getImmediateChild(o):null,p=bx(r,o);i=i.concat(Dx(a,c,u,p))}return s&&(i=i.concat(Hh(s,t,r,n))),i}}function Mx(t,e,n,r){const s=e.get(dt());n==null&&s!=null&&(n=_s(s,dt()));let i=[];return e.children.inorderTraversal((o,a)=>{const c=n?n.getImmediateChild(o):null,u=bx(r,o),p=t.operationForChild(o);p&&(i=i.concat(Mx(p,a,c,u)))}),s&&(i=i.concat(Hh(s,t,r,n))),i}function Nx(t,e){const n=e.query,r=Da(t,n);return{hashFn:()=>(CI(e)||Fe.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return r?$I(t,n._path,r):FI(t,n._path);{const i=B5(s,n);return tu(t,n,null,i)}}}}function Da(t,e){const n=Iu(e);return t.queryToTagMap.get(n)}function Iu(t){return t._path.toString()+"$"+t._queryIdentifier}function Gh(t,e){return t.tagToQueryMap.get(e)}function Vh(t){const e=t.indexOf("$");return ce(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new yt(t.substr(0,e))}}function Yh(t,e,n){const r=t.syncPointTree_.get(e);ce(r,"Missing sync point for query tag that we're tracking");const s=Cu(t.pendingWriteTree_,e);return Hh(r,n,s,null)}function zI(t){return t.fold((e,n,r)=>{if(n&&Cs(n))return[Tu(n)];{let s=[];return n&&(s=Ax(n)),hn(r,(i,o)=>{s=s.concat(o)}),s}})}function na(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(MI())(t._repo,t._path):t}function HI(t,e){for(let n=0;n<e.length;++n){const r=e[n];if(!r._queryParams.loadsAllData()){const s=Iu(r),i=t.queryToTagMap.get(s);t.queryToTagMap.delete(s),t.tagToQueryMap.delete(i)}}}function WI(){return NI++}function GI(t,e,n){const r=e._path,s=Da(t,e),i=Nx(t,n),o=t.listenProvider_.startListening(na(e),s,i.hashFn,i.onComplete),a=t.syncPointTree_.subtree(r);if(s)ce(!Cs(a.value),"If we're adding a query, it shouldn't be shadowed");else{const c=a.fold((u,p,h)=>{if(!nt(u)&&p&&Cs(p))return[Tu(p).query];{let f=[];return p&&(f=f.concat(Ax(p).map(m=>m.query))),hn(h,(m,b)=>{f=f.concat(b)}),f}});for(let u=0;u<c.length;++u){const p=c[u];t.listenProvider_.stopListening(na(p),Da(t,p))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kh{constructor(e){this.node_=e}getImmediateChild(e){const n=this.node_.getImmediateChild(e);return new Kh(n)}node(){return this.node_}}class Xh{constructor(e,n){this.syncTree_=e,this.path_=n}getImmediateChild(e){const n=$t(this.path_,e);return new Xh(this.syncTree_,n)}node(){return Wh(this.syncTree_,this.path_)}}const VI=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},sy=function(t,e,n){if(!t||typeof t!="object")return t;if(ce(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return YI(t[".sv"],e,n);if(typeof t[".sv"]=="object")return KI(t[".sv"],e);ce(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},YI=function(t,e,n){switch(t){case"timestamp":return n.timestamp;default:ce(!1,"Unexpected server value: "+t)}},KI=function(t,e,n){t.hasOwnProperty("increment")||ce(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const r=t.increment;typeof r!="number"&&ce(!1,"Unexpected increment value: "+r);const s=e.node();if(ce(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return r;const o=s.getValue();return typeof o!="number"?r:o+r},XI=function(t,e,n,r){return Qh(e,new Xh(n,t),r)},jx=function(t,e,n){return Qh(t,new Kh(e),n)};function Qh(t,e,n){const r=t.getPriority().val(),s=sy(r,e.getImmediateChild(".priority"),n);let i;if(t.isLeafNode()){const o=t,a=sy(o.getValue(),e,n);return a!==o.getValue()||s!==o.getPriority().val()?new Kt(a,Ft(s)):t}else{const o=t;return i=o,s!==o.getPriority().val()&&(i=i.updatePriority(new Kt(s))),o.forEachChild(Pt,(a,c)=>{const u=Qh(c,e.getImmediateChild(a),n);u!==c&&(i=i.updateImmediateChild(a,u))}),i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jh{constructor(e="",n=null,r={children:{},childCount:0}){this.name=e,this.parent=n,this.node=r}}function qh(t,e){let n=e instanceof yt?e:new yt(e),r=t,s=et(n);for(;s!==null;){const i=qi(r.node.children,s)||{children:{},childCount:0};r=new Jh(s,r,i),n=Et(n),s=et(n)}return r}function uo(t){return t.node.value}function Fx(t,e){t.node.value=e,_p(t)}function $x(t){return t.node.childCount>0}function QI(t){return uo(t)===void 0&&!$x(t)}function ku(t,e){hn(t.node.children,(n,r)=>{e(new Jh(n,t,r))})}function Bx(t,e,n,r){n&&e(t),ku(t,s=>{Bx(s,e,!0)})}function JI(t,e,n){let r=t.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function Ka(t){return new yt(t.parent===null?t.name:Ka(t.parent)+"/"+t.name)}function _p(t){t.parent!==null&&qI(t.parent,t.name,t)}function qI(t,e,n){const r=QI(n),s=br(t.node.children,e);r&&s?(delete t.node.children[e],t.node.childCount--,_p(t)):!r&&!s&&(t.node.children[e]=n.node,t.node.childCount++,_p(t))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZI=/[\[\].#$\/\u0000-\u001F\u007F]/,ek=/[\[\].#$\u0000-\u001F\u007F]/,Qd=10*1024*1024,Zh=function(t){return typeof t=="string"&&t.length!==0&&!ZI.test(t)},Ux=function(t){return typeof t=="string"&&t.length!==0&&!ek.test(t)},tk=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Ux(t)},zx=function(t){return t===null||typeof t=="string"||typeof t=="number"&&!Eu(t)||t&&typeof t=="object"&&br(t,".sv")},nu=function(t,e,n,r){r&&e===void 0||wu(Zi(t,"value"),e,n)},wu=function(t,e,n){const r=n instanceof yt?new xT(n,t):n;if(e===void 0)throw new Error(t+"contains undefined "+Fs(r));if(typeof e=="function")throw new Error(t+"contains a function "+Fs(r)+" with contents = "+e.toString());if(Eu(e))throw new Error(t+"contains "+e.toString()+" "+Fs(r));if(typeof e=="string"&&e.length>Qd/3&&xu(e)>Qd)throw new Error(t+"contains a string greater than "+Qd+" utf8 bytes "+Fs(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,i=!1;if(hn(e,(o,a)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(i=!0,!Zh(o)))throw new Error(t+" contains an invalid key ("+o+") "+Fs(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);ET(r,o),wu(t,a,r),bT(r)}),s&&i)throw new Error(t+' contains ".value" child '+Fs(r)+" in addition to actual children.")}},nk=function(t,e){let n,r;for(n=0;n<e.length;n++){r=e[n];const i=wa(r);for(let o=0;o<i.length;o++)if(!(i[o]===".priority"&&o===i.length-1)){if(!Zh(i[o]))throw new Error(t+"contains an invalid key ("+i[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(_T);let s=null;for(n=0;n<e.length;n++){if(r=e[n],s!==null&&Kn(s,r))throw new Error(t+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}},rk=function(t,e,n,r){const s=Zi(t,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");const i=[];hn(e,(o,a)=>{const c=new yt(o);if(wu(s,a,$t(n,c)),Ph(c)===".priority"&&!zx(a))throw new Error(s+"contains an invalid value for '"+c.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");i.push(c)}),nk(s,i)},sk=function(t,e,n){if(Eu(e))throw new Error(Zi(t,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!zx(e))throw new Error(Zi(t,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")},Hx=function(t,e,n,r){if(!Ux(n))throw new Error(Zi(t,e)+'was an invalid path = "'+n+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},ik=function(t,e,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Hx(t,e,n)},Gs=function(t,e){if(et(e)===".info")throw new Error(t+" failed = Can't modify data under /.info/")},ok=function(t,e){const n=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Zh(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||n.length!==0&&!tk(n))throw new Error(Zi(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ak{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function e0(t,e){let n=null;for(let r=0;r<e.length;r++){const s=e[r],i=s.getPath();n!==null&&!Lh(i,n.path)&&(t.eventLists_.push(n),n=null),n===null&&(n={events:[],path:i}),n.events.push(s)}n&&t.eventLists_.push(n)}function Wx(t,e,n){e0(t,n),Gx(t,r=>Lh(r,e))}function Er(t,e,n){e0(t,n),Gx(t,r=>Kn(r,e)||Kn(e,r))}function Gx(t,e){t.recursionDepth_++;let n=!0;for(let r=0;r<t.eventLists_.length;r++){const s=t.eventLists_[r];if(s){const i=s.path;e(i)?(lk(t.eventLists_[r]),t.eventLists_[r]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function lk(t){for(let e=0;e<t.events.length;e++){const n=t.events[e];if(n!==null){t.events[e]=null;const r=n.getEventRunner();qo&&nn("event: "+n.toString()),lo(r)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ck="repo_interrupt",uk=25;class dk{constructor(e,n,r,s){this.repoInfo_=e,this.forceRestClient_=n,this.authTokenProvider_=r,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new ak,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Yc(),this.transactionQueueTree_=new Jh,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function fk(t,e,n){if(t.stats_=Rh(t.repoInfo_),t.forceRestClient_||W5())t.server_=new Vc(t.repoInfo_,(r,s,i,o)=>{iy(t,r,s,i,o)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>oy(t,!0),0);else{if(typeof n<"u"&&n!==null){if(typeof n!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Vt(n)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}t.persistentConnection_=new Nr(t.repoInfo_,e,(r,s,i,o)=>{iy(t,r,s,i,o)},r=>{oy(t,r)},r=>{pk(t,r)},t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(r=>{t.server_.refreshAuthToken(r)}),t.appCheckProvider_.addTokenChangeListener(r=>{t.server_.refreshAppCheckToken(r.token)}),t.statsReporter_=X5(t.repoInfo_,()=>new KT(t.stats_,t.server_)),t.infoData_=new HT,t.infoSyncTree_=new ry({startListening:(r,s,i,o)=>{let a=[];const c=t.infoData_.getNode(r._path);return c.isEmpty()||(a=Va(t.infoSyncTree_,r._path,c),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),n0(t,"connected",!1),t.serverSyncTree_=new ry({startListening:(r,s,i,o)=>(t.server_.listen(r,i,s,(a,c)=>{const u=o(a,c);Er(t.eventQueue_,r._path,u)}),[]),stopListening:(r,s)=>{t.server_.unlisten(r,s)}})}function Vx(t){const n=t.infoData_.getNode(new yt(".info/serverTimeOffset")).val()||0;return new Date().getTime()+n}function t0(t){return VI({timestamp:Vx(t)})}function iy(t,e,n,r,s){t.dataUpdateCount++;const i=new yt(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let o=[];if(s)if(r){const c=$c(n,u=>Ft(u));o=BI(t.serverSyncTree_,i,c,s)}else{const c=Ft(n);o=Lx(t.serverSyncTree_,i,c,s)}else if(r){const c=$c(n,u=>Ft(u));o=jI(t.serverSyncTree_,i,c)}else{const c=Ft(n);o=Va(t.serverSyncTree_,i,c)}let a=i;o.length>0&&(a=Ru(t,i)),Er(t.eventQueue_,a,o)}function oy(t,e){n0(t,"connected",e),e===!1&&mk(t)}function pk(t,e){hn(e,(n,r)=>{n0(t,n,r)})}function n0(t,e,n){const r=new yt("/.info/"+e),s=Ft(n);t.infoData_.updateSnapshot(r,s);const i=Va(t.infoSyncTree_,r,s);Er(t.eventQueue_,r,i)}function Yx(t){return t.nextWriteId_++}function hk(t,e,n){const r=UI(t.serverSyncTree_,e);return r!=null?Promise.resolve(r):t.server_.get(e).then(s=>{const i=Ft(s).withIndex(e._queryParams.getIndex());vp(t.serverSyncTree_,e,n,!0);let o;if(e._queryParams.loadsAllData())o=Va(t.serverSyncTree_,e._path,i);else{const a=Da(t.serverSyncTree_,e);o=Lx(t.serverSyncTree_,e._path,i,a)}return Er(t.eventQueue_,e._path,o),tu(t.serverSyncTree_,e,n,null,!0),i},s=>(Au(t,"get for query "+Vt(e)+" failed: "+s),Promise.reject(new Error(s))))}function gk(t,e,n,r,s){Au(t,"set",{path:e.toString(),value:n,priority:r});const i=t0(t),o=Ft(n,r),a=Wh(t.serverSyncTree_,e),c=jx(o,a,i),u=Yx(t),p=Px(t.serverSyncTree_,e,c,u,!0);e0(t.eventQueue_,p),t.server_.put(e.toString(),o.val(!0),(f,m)=>{const b=f==="ok";b||Ln("set at "+e+" failed: "+f);const R=Ws(t.serverSyncTree_,u,!b);Er(t.eventQueue_,e,R),ro(t,s,f,m)});const h=qx(t,e);Ru(t,h),Er(t.eventQueue_,h,[])}function mk(t){Au(t,"onDisconnectEvents");const e=t0(t),n=Yc();pp(t.onDisconnect_,dt(),(s,i)=>{const o=XI(s,i,t.serverSyncTree_,e);co(n,s,o)});let r=[];pp(n,dt(),(s,i)=>{r=r.concat(Va(t.serverSyncTree_,s,i));const o=qx(t,s);Ru(t,o)}),t.onDisconnect_=Yc(),Er(t.eventQueue_,dt(),r)}function yk(t,e,n){t.server_.onDisconnectCancel(e.toString(),(r,s)=>{r==="ok"&&fp(t.onDisconnect_,e),ro(t,n,r,s)})}function ay(t,e,n,r){const s=Ft(n);t.server_.onDisconnectPut(e.toString(),s.val(!0),(i,o)=>{i==="ok"&&co(t.onDisconnect_,e,s),ro(t,r,i,o)})}function vk(t,e,n,r,s){const i=Ft(n,r);t.server_.onDisconnectPut(e.toString(),i.val(!0),(o,a)=>{o==="ok"&&co(t.onDisconnect_,e,i),ro(t,s,o,a)})}function _k(t,e,n,r){if(rp(n)){nn("onDisconnect().update() called with empty data.  Don't do anything."),ro(t,r,"ok",void 0);return}t.server_.onDisconnectMerge(e.toString(),n,(s,i)=>{s==="ok"&&hn(n,(o,a)=>{const c=Ft(a);co(t.onDisconnect_,$t(e,o),c)}),ro(t,r,s,i)})}function xk(t,e,n){let r;et(e._path)===".info"?r=vp(t.infoSyncTree_,e,n):r=vp(t.serverSyncTree_,e,n),Wx(t.eventQueue_,e._path,r)}function Ek(t,e,n){let r;et(e._path)===".info"?r=tu(t.infoSyncTree_,e,n):r=tu(t.serverSyncTree_,e,n),Wx(t.eventQueue_,e._path,r)}function bk(t){t.persistentConnection_&&t.persistentConnection_.interrupt(ck)}function Au(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),nn(n,...e)}function ro(t,e,n,r){e&&lo(()=>{if(n==="ok")e(null);else{const s=(n||"error").toUpperCase();let i=s;r&&(i+=": "+r);const o=new Error(i);o.code=s,e(o)}})}function Kx(t,e,n){return Wh(t.serverSyncTree_,e,n)||Fe.EMPTY_NODE}function r0(t,e=t.transactionQueueTree_){if(e||Ou(t,e),uo(e)){const n=Qx(t,e);ce(n.length>0,"Sending zero length transaction queue"),n.every(s=>s.status===0)&&Sk(t,Ka(e),n)}else $x(e)&&ku(e,n=>{r0(t,n)})}function Sk(t,e,n){const r=n.map(u=>u.currentWriteId),s=Kx(t,e,r);let i=s;const o=s.hash();for(let u=0;u<n.length;u++){const p=n[u];ce(p.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),p.status=1,p.retryCount++;const h=_n(e,p.path);i=i.updateChild(h,p.currentOutputSnapshotRaw)}const a=i.val(!0),c=e;t.server_.put(c.toString(),a,u=>{Au(t,"transaction put response",{path:c.toString(),status:u});let p=[];if(u==="ok"){const h=[];for(let f=0;f<n.length;f++)n[f].status=2,p=p.concat(Ws(t.serverSyncTree_,n[f].currentWriteId)),n[f].onComplete&&h.push(()=>n[f].onComplete(null,!0,n[f].currentOutputSnapshotResolved)),n[f].unwatcher();Ou(t,qh(t.transactionQueueTree_,e)),r0(t,t.transactionQueueTree_),Er(t.eventQueue_,e,p);for(let f=0;f<h.length;f++)lo(h[f])}else{if(u==="datastale")for(let h=0;h<n.length;h++)n[h].status===3?n[h].status=4:n[h].status=0;else{Ln("transaction at "+c.toString()+" failed: "+u);for(let h=0;h<n.length;h++)n[h].status=4,n[h].abortReason=u}Ru(t,e)}},o)}function Ru(t,e){const n=Xx(t,e),r=Ka(n),s=Qx(t,n);return Ck(t,s,r),r}function Ck(t,e,n){if(e.length===0)return;const r=[];let s=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const c=e[a],u=_n(n,c.path);let p=!1,h;if(ce(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)p=!0,h=c.abortReason,s=s.concat(Ws(t.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=uk)p=!0,h="maxretry",s=s.concat(Ws(t.serverSyncTree_,c.currentWriteId,!0));else{const f=Kx(t,c.path,o);c.currentInputSnapshot=f;const m=e[a].update(f.val());if(m!==void 0){wu("transaction failed: Data returned ",m,c.path);let b=Ft(m);typeof m=="object"&&m!=null&&br(m,".priority")||(b=b.updatePriority(f.getPriority()));const W=c.currentWriteId,d=t0(t),I=jx(b,f,d);c.currentOutputSnapshotRaw=b,c.currentOutputSnapshotResolved=I,c.currentWriteId=Yx(t),o.splice(o.indexOf(W),1),s=s.concat(Px(t.serverSyncTree_,c.path,I,c.currentWriteId,c.applyLocally)),s=s.concat(Ws(t.serverSyncTree_,W,!0))}else p=!0,h="nodata",s=s.concat(Ws(t.serverSyncTree_,c.currentWriteId,!0))}Er(t.eventQueue_,n,s),s=[],p&&(e[a].status=2,function(f){setTimeout(f,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(h==="nodata"?r.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):r.push(()=>e[a].onComplete(new Error(h),!1,null))))}Ou(t,t.transactionQueueTree_);for(let a=0;a<r.length;a++)lo(r[a]);r0(t,t.transactionQueueTree_)}function Xx(t,e){let n,r=t.transactionQueueTree_;for(n=et(e);n!==null&&uo(r)===void 0;)r=qh(r,n),e=Et(e),n=et(e);return r}function Qx(t,e){const n=[];return Jx(t,e,n),n.sort((r,s)=>r.order-s.order),n}function Jx(t,e,n){const r=uo(e);if(r)for(let s=0;s<r.length;s++)n.push(r[s]);ku(e,s=>{Jx(t,s,n)})}function Ou(t,e){const n=uo(e);if(n){let r=0;for(let s=0;s<n.length;s++)n[s].status!==2&&(n[r]=n[s],r++);n.length=r,Fx(e,n.length>0?n:void 0)}ku(e,r=>{Ou(t,r)})}function qx(t,e){const n=Ka(Xx(t,e)),r=qh(t.transactionQueueTree_,e);return JI(r,s=>{Jd(t,s)}),Jd(t,r),Bx(r,s=>{Jd(t,s)}),n}function Jd(t,e){const n=uo(e);if(n){const r=[];let s=[],i=-1;for(let o=0;o<n.length;o++)n[o].status===3||(n[o].status===1?(ce(i===o-1,"All SENT items should be at beginning of queue."),i=o,n[o].status=3,n[o].abortReason="set"):(ce(n[o].status===0,"Unexpected transaction status in abort"),n[o].unwatcher(),s=s.concat(Ws(t.serverSyncTree_,n[o].currentWriteId,!0)),n[o].onComplete&&r.push(n[o].onComplete.bind(null,new Error("set"),!1,null))));i===-1?Fx(e,void 0):n.length=i+1,Er(t.eventQueue_,Ka(e),s);for(let o=0;o<r.length;o++)lo(r[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tk(t){let e="";const n=t.split("/");for(let r=0;r<n.length;r++)if(n[r].length>0){let s=n[r];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function Ik(t){const e={};t.charAt(0)==="?"&&(t=t.substring(1));for(const n of t.split("&")){if(n.length===0)continue;const r=n.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):Ln(`Invalid query segment '${n}' in query '${t}'`)}return e}const ly=function(t,e){const n=kk(t),r=n.namespace;n.domain==="firebase.com"&&zr(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&n.domain!=="localhost"&&zr("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||M5();const s=n.scheme==="ws"||n.scheme==="wss";return{repoInfo:new ex(n.host,n.secure,r,s,e,"",r!==n.subdomain),path:new yt(n.pathString)}},kk=function(t){let e="",n="",r="",s="",i="",o=!0,a="https",c=443;if(typeof t=="string"){let u=t.indexOf("//");u>=0&&(a=t.substring(0,u-1),t=t.substring(u+2));let p=t.indexOf("/");p===-1&&(p=t.length);let h=t.indexOf("?");h===-1&&(h=t.length),e=t.substring(0,Math.min(p,h)),p<h&&(s=Tk(t.substring(p,h)));const f=Ik(t.substring(Math.min(t.length,h)));u=e.indexOf(":"),u>=0?(o=a==="https"||a==="wss",c=parseInt(e.substring(u+1),10)):u=e.length;const m=e.slice(0,u);if(m.toLowerCase()==="localhost")n="localhost";else if(m.split(".").length<=2)n=m;else{const b=e.indexOf(".");r=e.substring(0,b).toLowerCase(),n=e.substring(b+1),i=r}"ns"in f&&(i=f.ns)}return{host:e,port:c,domain:n,subdomain:r,secure:o,scheme:a,pathString:s,namespace:i}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cy="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",wk=function(){let t=0;const e=[];return function(n){const r=n===t;t=n;let s;const i=new Array(8);for(s=7;s>=0;s--)i[s]=cy.charAt(n%64),n=Math.floor(n/64);ce(n===0,"Cannot push at time == 0");let o=i.join("");if(r){for(s=11;s>=0&&e[s]===63;s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)o+=cy.charAt(e[s]);return ce(o.length===20,"nextPushId: Length should be 20."),o}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ak{constructor(e,n,r,s){this.eventType=e,this.eventRegistration=n,this.snapshot=r,this.prevName=s}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Vt(this.snapshot.exportVal())}}class Rk{constructor(e,n,r){this.eventRegistration=e,this.error=n,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zx{constructor(e,n){this.snapshotCallback=e,this.cancelCallback=n}onValue(e,n){this.snapshotCallback.call(null,e,n)}onCancel(e){return ce(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ok{constructor(e,n){this._repo=e,this._path=n}cancel(){const e=new Rr;return yk(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Gs("OnDisconnect.remove",this._path);const e=new Rr;return ay(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Gs("OnDisconnect.set",this._path),nu("OnDisconnect.set",e,this._path,!1);const n=new Rr;return ay(this._repo,this._path,e,n.wrapCallback(()=>{})),n.promise}setWithPriority(e,n){Gs("OnDisconnect.setWithPriority",this._path),nu("OnDisconnect.setWithPriority",e,this._path,!1),sk("OnDisconnect.setWithPriority",n);const r=new Rr;return vk(this._repo,this._path,e,n,r.wrapCallback(()=>{})),r.promise}update(e){Gs("OnDisconnect.update",this._path),rk("OnDisconnect.update",e,this._path);const n=new Rr;return _k(this._repo,this._path,e,n.wrapCallback(()=>{})),n.promise}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s0{constructor(e,n,r,s){this._repo=e,this._path=n,this._queryParams=r,this._orderByCalled=s}get key(){return nt(this._path)?null:Ph(this._path)}get ref(){return new Wr(this._repo,this._path)}get _queryIdentifier(){const e=Vm(this._queryParams),n=wh(e);return n==="{}"?"default":n}get _queryObject(){return Vm(this._queryParams)}isEqual(e){if(e=ws(e),!(e instanceof s0))return!1;const n=this._repo===e._repo,r=Lh(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return n&&r&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+vT(this._path)}}class Wr extends s0{constructor(e,n){super(e,n,new jh,!1)}get parent(){const e=cx(this._path);return e===null?null:new Wr(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class Ma{constructor(e,n,r){this._node=e,this.ref=n,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const n=new yt(e),r=Na(this.ref,e);return new Ma(this._node.getChild(n),r,Pt)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,s)=>e(new Ma(s,Na(this.ref,r),Pt)))}hasChild(e){const n=new yt(e);return!this._node.getChild(n).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function $l(t,e){return t=ws(t),t._checkNotDeleted("ref"),e!==void 0?Na(t._root,e):t._root}function Na(t,e){return t=ws(t),et(t._path)===null?ik("child","path",e):Hx("child","path",e),new Wr(t._repo,$t(t._path,e))}function Pk(t){return t=ws(t),new Ok(t._repo,t._path)}function Lk(t,e){t=ws(t),Gs("push",t._path),nu("push",e,t._path,!0);const n=Vx(t._repo),r=wk(n),s=Na(t,r),i=Na(t,r);let o;return o=Promise.resolve(i),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function Bl(t){return Gs("remove",t._path),eE(t,null)}function eE(t,e){t=ws(t),Gs("set",t._path),nu("set",e,t._path,!1);const n=new Rr;return gk(t._repo,t._path,e,null,n.wrapCallback(()=>{})),n.promise}function Dk(t){t=ws(t);const e=new Zx(()=>{}),n=new Pu(e);return hk(t._repo,t,n).then(r=>new Ma(r,new Wr(t._repo,t._path),t._queryParams.getIndex()))}class Pu{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,n){const r=n._queryParams.getIndex();return new Ak("value",this,new Ma(e.snapshotNode,new Wr(n._repo,n._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new Rk(this,e,n):null}matches(e){return e instanceof Pu?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function Mk(t,e,n,r,s){const i=new Zx(n,void 0),o=new Pu(i);return xk(t._repo,t,o),()=>Ek(t._repo,t,o)}function Nk(t,e,n,r){return Mk(t,"value",e)}AI(Wr);DI(Wr);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jk="FIREBASE_DATABASE_EMULATOR_HOST",xp={};let Fk=!1;function $k(t,e,n,r){const s=e.lastIndexOf(":"),i=e.substring(0,s),o=Ih(i);t.repoInfo_=new ex(e,o,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0,n),r&&(t.authTokenProvider_=r)}function Bk(t,e,n,r,s){let i=r||t.options.databaseURL;i===void 0&&(t.options.projectId||zr("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),nn("Using default host for project ",t.options.projectId),i=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o=ly(i,s),a=o.repoInfo,c;typeof process<"u"&&wm&&(c=wm[jk]),c?(i=`http://${c}?ns=${a.namespace}`,o=ly(i,s),a=o.repoInfo):o.repoInfo.secure;const u=new V5(t.name,t.options,e);ok("Invalid Firebase Database URL",o),nt(o.path)||zr("Database URL must point to the root of a Firebase Database (not including a child path).");const p=zk(a,t,u,new G5(t,n));return new Hk(p,t)}function Uk(t,e){const n=xp[e];(!n||n[t.key]!==t)&&zr(`Database ${e}(${t.repoInfo_}) has already been deleted.`),bk(t),delete n[t.key]}function zk(t,e,n,r){let s=xp[e.name];s||(s={},xp[e.name]=s);let i=s[t.toURLString()];return i&&zr("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new dk(t,Fk,n,r),s[t.toURLString()]=i,i}class Hk{constructor(e,n){this._repoInternal=e,this.app=n,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(fk(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Wr(this._repo,dt())),this._rootInternal}_delete(){return this._rootInternal!==null&&(Uk(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&zr("Cannot call "+e+" on a deleted database.")}}function Wk(t=m5(),e){const n=d5(t,"database").getImmediate({identifier:e});if(!n._instanceStarted){const r=Q2("database");r&&Gk(n,...r)}return n}function Gk(t,e,n,r={}){t=ws(t),t._checkNotDeleted("useEmulator");const s=`${e}:${n}`,i=t._repoInternal;if(t._instanceStarted){if(s===t._repoInternal.repoInfo_.host&&Bc(r,i.repoInfo_.emulatorOptions))return;zr("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&zr('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new cc(cc.OWNER);else if(r.mockUserToken){const a=typeof r.mockUserToken=="string"?r.mockUserToken:q2(r.mockUserToken,t.app.options.projectId);o=new cc(a)}Ih(e)&&(J2(e),tC("Database",!0)),$k(i,s,r,o)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vk(t){A5(g5),zc(new Ta("database",(e,{instanceIdentifier:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return Bk(r,s,i,n)},"PUBLIC").setMultipleInstances(!0)),zi(Am,Rm,t),zi(Am,Rm,"esm2020")}Nr.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};Nr.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};Vk();const Yk={apiKey:"AIzaSyCqXssa5oOaWY3CiN7ti53Qt1F_AGpBrVE",authDomain:"tenfubu-verse.firebaseapp.com",databaseURL:"https://tenfubu-verse-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"tenfubu-verse",storageBucket:"tenfubu-verse.firebasestorage.app",messagingSenderId:"1047996014362",appId:"1:1047996014362:web:729f6b715d929087e296a3"},Kk=j1(Yk),Ul=Wk(Kk);class Xk{constructor(){Zt(this,"myEntryRef",null);Zt(this,"listenerUnsubscribe",null);Zt(this,"myId","");Zt(this,"myPeerId","");Zt(this,"hasMatched",!1)}async startMatchmaking(e,n,r,s,i,o){this.myPeerId=e,this.hasMatched=!1;const a=$l(Ul,`matchmaking/${s}`);try{const c=await Dk(a),u=[];if(c.exists()&&c.forEach(m=>{const b=m.val(),R=Date.now()-b.timestamp<5*60*1e3;b.peerId!==e&&R&&u.push({key:m.key,data:b})}),u.length>0){const m=u.sort((b,R)=>b.data.timestamp-R.data.timestamp)[0];await Bl($l(Ul,`matchmaking/${s}/${m.key}`)),i("matched"),o({peerId:m.data.peerId,playerName:m.data.playerName,playerClass:m.data.playerClass,isHost:!1});return}i("searching");const p=Lk(a);this.myEntryRef=p,this.myId=p.key;const h={id:this.myId,peerId:e,playerName:n,playerClass:r,matchType:s,timestamp:Date.now()};await eE(p,h),Pk(p).remove();const f=s;this.listenerUnsubscribe=Nk(a,async m=>{if(this.hasMatched||!m.exists())return;let b=!1,R=null;if(m.forEach(W=>{const d=W.val();W.key===this.myId?b=!0:d.peerId!==this.myPeerId&&(!R||d.timestamp>R.data.timestamp)&&(R={key:W.key,data:d})}),!b&&this.myEntryRef){if(this.hasMatched)return;this.hasMatched=!0,i("matched"),this.cleanup();return}if(R!==null&&b){const W=m.child(this.myId).val(),d=R;if(W&&W.timestamp<d.data.timestamp){if(this.hasMatched)return;this.hasMatched=!0,await Bl($l(Ul,`matchmaking/${f}/${d.key}`)),await Bl($l(Ul,`matchmaking/${f}/${this.myId}`)),this.cleanup(),i("matched"),o({peerId:d.data.peerId,playerName:d.data.playerName,playerClass:d.data.playerClass,isHost:!0})}}})}catch(c){console.error("[Matchmaking] Error:",c),i("error"),this.cleanup()}}async cancelMatchmaking(){if(this.myEntryRef)try{await Bl(this.myEntryRef)}catch(e){console.error("[Matchmaking] Error removing entry:",e)}this.cleanup()}cleanup(){this.listenerUnsubscribe&&(this.listenerUnsubscribe(),this.listenerUnsubscribe=null),this.myEntryRef=null,this.myId=""}}const qd=new Xk;class uy{constructor(e,n,r=!1){Zt(this,"peer");Zt(this,"conn");Zt(this,"isHost",!1);Zt(this,"messageCallback",null);Zt(this,"closeCallback",null);this.peer=e,this.conn=n,this.isHost=r,n.on("data",s=>{this.messageCallback&&this.messageCallback(s)}),n.on("close",()=>{console.log("[PeerJSAdapter] Connection closed"),this.closeCallback&&this.closeCallback()}),n.on("error",s=>console.error("[PeerJSAdapter] Connection Error:",s))}async connect(e){return this.peer.id}onConnection(e){}onClose(e){this.closeCallback=e}isConnected(){return this.conn!==null&&this.conn.open}send(e){this.conn&&this.conn.open?this.conn.send(e):console.warn("[PeerJSAdapter] Connection not open, cannot send message")}onMessage(e){this.messageCallback=e}disconnect(){var e,n;(e=this.conn)==null||e.close(),(n=this.peer)==null||n.destroy()}}const Qk=1280,Jk=720,qk=({matchType:t,playerClass:e,playerName:n,onGameStart:r,onCancel:s})=>{const[i,o]=U.useState("idle"),[a,c]=U.useState("..."),[u,p]=U.useState(0),h=U.useRef(null),f=U.useRef(null),m=U.useRef(null),b=U.useRef(!1),R=U.useRef(!1),[W,d]=U.useState(1);U.useEffect(()=>{const k=()=>{const $=window.innerWidth/Qk,B=window.innerHeight/Jk;d(Math.min($,B))};return k(),window.addEventListener("resize",k),()=>window.removeEventListener("resize",k)},[]),U.useEffect(()=>{if(i!=="searching")return;const k=setInterval(()=>{p($=>$+1)},1e3);return()=>clearInterval(k)},[i]),U.useEffect(()=>{let k=!0;return(async()=>{try{const B=new S1({debug:1,config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]}});if(h.current=B,await new Promise((J,me)=>{B.on("open",()=>J()),B.on("error",he=>me(he))}),!k)return;const te=B.id;console.log("[Matchmaking] My PeerJS ID:",te),B.on("connection",J=>{console.log("[Matchmaking] Incoming connection from:",J.peer),f.current=J,J.on("open",()=>{console.log("[Matchmaking] Connection opened (as HOST)"),J.on("data",me=>{if(me.type==="PLAYER_INFO"){console.log("[Matchmaking] Received player info:",me),J.send({type:"PLAYER_INFO",playerName:n,playerClass:e}),R.current=!0;const he=new uy(B,J,!0);r(he,me.playerClass,!0)}})})}),qd.startMatchmaking(te,n,e,t,J=>{if(k)switch(o(J),J){case"searching":c("...");break;case"matched":c("...");break;case"error":c("");break}},async J=>{if(k)if(console.log("[Matchmaking] Match found:",J),m.current=J,b.current=J.isHost,J.isHost)c("...");else{c("...");const me=B.connect(J.peerId,{reliable:!0});f.current=me,me.on("open",()=>{console.log("[Matchmaking] Connection opened (as JOIN)"),me.send({type:"PLAYER_INFO",playerName:n,playerClass:e}),me.on("data",he=>{if(he.type==="PLAYER_INFO"){console.log("[Matchmaking] Received player info:",he),R.current=!0;const ke=new uy(B,me,!1);r(ke,he.playerClass,!1)}})}),me.on("error",he=>{console.error("[Matchmaking] Connection error:",he),o("error"),c("")})}})}catch(B){console.error("[Matchmaking] Init error:",B),k&&(o("error"),c(""))}})(),()=>{k=!1,qd.cancelMatchmaking(),R.current||(f.current&&f.current.close(),h.current&&h.current.destroy())}},[t,e,n,r]);const I=async()=>{await qd.cancelMatchmaking(),f.current&&f.current.close(),h.current&&h.current.destroy(),s()},S=k=>{const $=Math.floor(k/60),B=k%60;return`${$}:${B.toString().padStart(2,"0")}`};return l.jsxs("div",{className:"screen",style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white"},children:[l.jsx("div",{style:{fontSize:`${1.2*W}rem`,color:"#4ade80",marginBottom:`${1*W}rem`,fontWeight:"bold"},children:t==="casual"?"":""}),l.jsx("div",{style:{fontSize:`${2*W}rem`,fontWeight:"bold",marginBottom:`${1*W}rem`,textAlign:"center"},children:a}),i==="searching"&&l.jsxs("div",{style:{fontSize:`${1.5*W}rem`,color:"#888",marginBottom:`${2*W}rem`},children:[": ",S(u)]}),(i==="searching"||i==="matched")&&l.jsx("div",{style:{width:80*W,height:80*W,border:"4px solid rgba(255,255,255,0.2)",borderTop:"4px solid #4ade80",borderRadius:"50%",animation:"spin 1s linear infinite",marginBottom:`${2*W}rem`}}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:`${1*W}rem`,marginBottom:`${2*W}rem`,padding:`${1*W}rem`,background:"rgba(255,255,255,0.1)",borderRadius:8*W},children:[l.jsx("div",{style:{fontSize:`${1*W}rem`},children:n||""}),l.jsx("div",{style:{fontSize:`${.9*W}rem`,color:e==="SENKA"?"#e94560":"#45a2e9"},children:e==="SENKA"?"":e==="AJA"?"":""})]}),i!=="error"&&l.jsx("button",{onClick:I,style:{padding:`${.8*W}rem ${2*W}rem`,fontSize:`${1*W}rem`,background:"transparent",border:"2px solid #e94560",color:"#e94560",borderRadius:8*W,cursor:"pointer",transition:"all 0.2s"},onMouseOver:k=>{k.currentTarget.style.background="#e94560",k.currentTarget.style.color="white"},onMouseOut:k=>{k.currentTarget.style.background="transparent",k.currentTarget.style.color="#e94560"},children:""}),i==="error"&&l.jsx("button",{onClick:s,style:{padding:`${.8*W}rem ${2*W}rem`,fontSize:`${1*W}rem`,background:"#e94560",border:"none",color:"white",borderRadius:8*W,cursor:"pointer"},children:""}),l.jsx("style",{children:`
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `})]})},dy=20,i0=[{id:1,filename:"1_yoroshiku.png",label:"",se:"pa.mp3"},{id:2,filename:"2_nandato.png",label:"",se:"shock.mp3"},{id:3,filename:"3_thank.png",label:"",se:"thanks.mp3"},{id:4,filename:"4_willwin.png",label:"",se:"nt.mp3"},{id:5,filename:"5_dontmind.png",label:"",se:"boyon.mp3"},{id:6,filename:"6_thinking.png",label:"",se:"thinking.mp3"},{id:7,filename:"7_gg.png",label:"GG",se:"kiri.mp3"},{id:8,filename:"8_sorry.png",label:"",se:"gomen.mp3"}],fy=(t,e)=>{const n=i0.find(s=>s.id===t);return n?`/stamps/${e==="AJA"?"azya":e.toLowerCase()}/${n.filename}`:""},py=t=>{const e=i0.find(n=>n.id===t);return(e==null?void 0:e.se)||null},rs=[{id:"s_3cats",name:"",cost:2,type:"SPELL",description:"1",flavorText:"",imageUrl:"/cards/chatora_three_cats.png",triggers:[{trigger:"FANFARE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_CHATORA"},{type:"GENERATE_CARD",targetCardId:"TOKEN_SABATORA"},{type:"GENERATE_CARD",targetCardId:"TOKEN_KIJITORA"}]}]},{id:"s_final_cannon",name:"",cost:10,type:"SPELL",description:"1",flavorText:'""""',imageUrl:"/cards/final_cannon.png",triggers:[{trigger:"FANFARE",effects:[{type:"SET_MAX_HP",value:1,targetType:"OPPONENT"}]}]},{id:"c_senka_knuckler",name:"",cost:8,type:"FOLLOWER",attack:3,health:5,description:`[] []
2
[]
1`,flavorText:`

`,imageUrl:"/cards/senka.png",evolvedImageUrl:"/cards/senka_2.png",tags:["Knuckler"],passiveAbilities:["STORM","DOUBLE_ATTACK"],attackEffectType:"IMPACT",triggers:[{trigger:"SUPER_EVOLVE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_FLICKER_JAB"},{type:"GENERATE_CARD",targetCardId:"TOKEN_QUAKE_HOWLING"},{type:"GENERATE_CARD",targetCardId:"TOKEN_BACKHAND_SMASH"}]}]},{id:"c_ruiyu",name:"",cost:7,type:"FOLLOWER",attack:5,health:5,description:`4cyoriena
14`,flavorText:`
`,imageUrl:"/cards/ruiyu.png",evolvedImageUrl:"/cards/ruiyu_2.png",attackEffectType:"BLUE_FIRE",triggers:[{trigger:"FANFARE",effects:[{type:"HEAL_LEADER",value:4,targetType:"SELF"},{type:"SUMMON_CARD",targetCardId:"c_cyoriena"}]},{trigger:"EVOLVE",effects:[{type:"DESTROY",targetType:"SELECT_FOLLOWER"},{type:"HEAL_LEADER",value:4,targetType:"SELF"}]}]},{id:"c_y",name:"Y",cost:6,type:"FOLLOWER",attack:3,health:3,description:`[]
142
3`,flavorText:"",imageUrl:"/cards/y.png",evolvedImageUrl:"/cards/y_2.png",passiveAbilities:["STEALTH"],attackEffectType:"SUMI",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:4,targetType:"SELECT_FOLLOWER"},{type:"AOE_DAMAGE",value:2,targetType:"ALL_FOLLOWERS"}]},{trigger:"EVOLVE",effects:[{type:"AOE_DAMAGE",value:3,targetType:"ALL_FOLLOWERS"}]}]},{id:"c_tsubumaru",name:"",cost:2,type:"FOLLOWER",attack:1,health:3,description:`[]
1
1`,flavorText:`

`,imageUrl:"/cards/tsubumaru.png",evolvedImageUrl:"/cards/tsubumaru_2.png",passiveAbilities:["WARD"],attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"GENERATE_CARD",targetCardId:"s_resignation_proxy"}]}]},{id:"c_barura",name:"",cost:4,type:"FOLLOWER",attack:3,health:4,description:`1
13`,flavorText:`

`,imageUrl:"/cards/barura.png",evolvedImageUrl:"/cards/barura_2.png",attackEffectType:"FIRE",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:3,targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_CHATORA",name:"",cost:0,type:"FOLLOWER",attack:1,health:1,description:"",flavorText:"",imageUrl:"/cards/chatora.png",attackEffectType:"SLASH"},{id:"TOKEN_SABATORA",name:"",cost:1,type:"FOLLOWER",attack:1,health:2,description:"[]",flavorText:"",passiveAbilities:["RUSH"],imageUrl:"/cards/sabatora.png",attackEffectType:"SLASH"},{id:"TOKEN_KIJITORA",name:"",cost:3,type:"FOLLOWER",attack:2,health:3,description:"[]",flavorText:"",passiveAbilities:["WARD"],imageUrl:"/cards/kijitora.png",attackEffectType:"SLASH"},{id:"TOKEN_RICE",name:"",cost:0,type:"SPELL",description:"1",flavorText:" ",imageUrl:"/cards/rice.png",triggers:[{trigger:"FANFARE",effects:[{type:"HEAL_LEADER",value:1,targetType:"SELF"}]}]},{id:"c_yunagi",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:`1
11`,flavorText:`


`,imageUrl:"/cards/yunagi.png",evolvedImageUrl:"/cards/yunagi_2.png",attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:1,targetType:"SELECT_FOLLOWER"},{type:"GENERATE_CARD",targetCardId:"TOKEN_OOMORI_RICE"}]}]},{id:"TOKEN_OOMORI_RICE",name:"",cost:1,type:"SPELL",description:"3",flavorText:"",imageUrl:"/cards/oomoririce.png",tags:["Token"],triggers:[{trigger:"FANFARE",effects:[{type:"HEAL_LEADER",value:3,targetType:"SELF"}]}]},{id:"c_nayuta",name:"",cost:4,type:"FOLLOWER",attack:3,health:3,description:`[]
1
1`,flavorText:"",imageUrl:"/cards/nayuta.png",evolvedImageUrl:"/cards/nayuta_2.png",attackEffectType:"RAY",passiveAbilities:["WARD"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]},{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]}]},{id:"c_yunagi_ward",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:`[]
1`,imageUrl:"/cards/yunagi.png",evolvedImageUrl:"/cards/yunagi_2.png",passiveAbilities:["WARD"],triggers:[{trigger:"FANFARE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_RICE"}]}]},{id:"c_nayuta_ward",name:"",cost:4,type:"FOLLOWER",attack:3,health:3,description:`[]
1
1`,imageUrl:"/cards/nayuta.png",evolvedImageUrl:"/cards/nayuta_2.png",passiveAbilities:["WARD"],attackEffectType:"RAY",triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]},{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]}]},{id:"c_azya",name:"",cost:8,type:"FOLLOWER",attack:4,health:4,description:`[]
3211-2
1+1/+2[][]0`,flavorText:`
&&`,imageUrl:"/cards/azya.png",evolvedImageUrl:"/cards/azya_2.png",attackEffectType:"THUNDER",passiveAbilities:["AURA"],triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:3,targetType:"OPPONENT"},{type:"HEAL_LEADER",value:2,targetType:"SELF"},{type:"RANDOM_DESTROY",value:1},{type:"RANDOM_BOUNCE",value:1},{type:"REDUCE_HAND_COST",value:2,conditions:{nameIn:["","",""]}}]},{trigger:"SUPER_EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_tsubumaru"},{type:"SUMMON_CARD",targetCardId:"c_yunagi"},{type:"SUMMON_CARD",targetCardId:"c_nayuta"},{type:"BUFF_STATS",value:1,value2:2,targetType:"ALL_OTHER_FOLLOWERS"},{type:"GRANT_PASSIVE",targetPassive:"WARD",targetType:"ALL_OTHER_FOLLOWERS"},{type:"GRANT_PASSIVE",targetPassive:"RUSH",targetType:"ALL_OTHER_FOLLOWERS"},{type:"GENERATE_CARD",targetCardId:"s_yucho_of_the_abyss"},{type:"GENERATE_CARD",targetCardId:"s_thats_mine"},{type:"GRANT_LEADER_DAMAGE_SHIELD"}]}]},{id:"c_yuki",name:"",cost:3,type:"FOLLOWER",attack:3,health:2,description:`[]
+1/+1`,flavorText:"",imageUrl:"/cards/yuki.png",evolvedImageUrl:"/cards/yuki_2.png",tags:["Knuckler"],passiveAbilities:["RUSH"],attackEffectType:"IMPACT",triggers:[{trigger:"EVOLVE",effects:[{type:"BUFF_STATS",value:1,value2:1,targetType:"ALL_FOLLOWERS"}]}]},{id:"c_white_tsubaki",name:"",cost:4,type:"FOLLOWER",attack:4,health:3,description:`[]

01
1`,flavorText:`
`,imageUrl:"/cards/white_tsubaki.png",evolvedImageUrl:"/cards/white_tsubaki_2.png",tags:["Knuckler"],passiveAbilities:["RUSH","IMMUNE_TO_FOLLOWER_DAMAGE","GUTS_MY_TURN"],attackEffectType:"ICE",triggers:[{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_shieko"}]}]},{id:"c_shieko",name:"",cost:2,type:"FOLLOWER",attack:2,health:1,description:`[]
1+2/+2`,flavorText:`
`,imageUrl:"/cards/shieko.png",evolvedImageUrl:"/cards/shieko_2.png",tags:["Knuckler"],passiveAbilities:["RUSH"],attackEffectType:"IMPACT",triggers:[{trigger:"EVOLVE",effects:[{type:"BUFF_STATS",value:2,value2:2,targetType:"SELECT_OTHER_ALLY_FOLLOWER"}]}]},{id:"c_urara",name:"",cost:3,type:"FOLLOWER",attack:2,health:2,description:`[] []
2`,flavorText:`
`,imageUrl:"/cards/urara.png",evolvedImageUrl:"/cards/urara_2.png",passiveAbilities:["WARD","BARRIER"],attackEffectType:"WATER",triggers:[{trigger:"EVOLVE",effects:[{type:"HEAL_LEADER",value:2}]}]},{id:"c_kasuga",name:"",cost:10,type:"FOLLOWER",attack:8,health:8,description:"",flavorText:`

`,imageUrl:"/cards/kasuga.png",evolvedImageUrl:"/cards/kasuga_2.png",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY",targetType:"ALL_OTHER_FOLLOWERS"}]}],attackEffectType:"SLASH"},{id:"c_kyokune",name:"",cost:4,type:"FOLLOWER",attack:4,health:4,description:"1",imageUrl:"/cards/kyokune.jpg",triggers:[{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_sia"}]}],attackEffectType:"SLASH"},{id:"c_sia",name:"",cost:2,type:"FOLLOWER",attack:2,health:1,description:"21",flavorText:"",imageUrl:"/cards/sia.png",evolvedImageUrl:"/cards/sia_2.png",attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DAMAGE",value:1,value2:2,targetType:"OPPONENT"}]}]},{id:"TOKEN_BACKHAND_SMASH",name:"",cost:0,type:"SPELL",description:"16",flavorText:`10
`,imageUrl:"/cards/BackhandSmash.jpg",tags:["Token"],attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:6,targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_QUAKE_HOWLING",name:"",cost:0,type:"SPELL",description:"2",flavorText:"",imageUrl:"/cards/QuakeHowling.png",tags:["Token"],attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"AOE_DAMAGE",value:2,targetType:"ALL_FOLLOWERS"}]}]},{id:"TOKEN_FLICKER_JAB",name:"",cost:0,type:"SPELL",description:"12",flavorText:`
BHS
`,imageUrl:"/cards/FlickerJab.png",tags:["Token"],attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:2,targetType:"SELECT_FOLLOWER"}]}]},{id:"c_bucchi",name:"",cost:5,type:"FOLLOWER",attack:1,health:3,description:"3",flavorText:`
`,imageUrl:"/cards/bucchi.png",evolvedImageUrl:"/cards/bucchi_2.png",attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_manary"},{type:"SUMMON_CARD",targetCardId:"c_manary"},{type:"SUMMON_CARD",targetCardId:"c_manary"}]}]},{id:"c_valkyrie",name:"",cost:6,type:"FOLLOWER",attack:6,health:6,description:`[] [] []
[]`,flavorText:"",imageUrl:"/cards/valkyrie.png",evolvedImageUrl:"/cards/valkyrie_2.png",passiveAbilities:["WARD","BARRIER","AURA"],attackEffectType:"RAY",triggers:[{trigger:"END_OF_TURN",effects:[{type:"GRANT_PASSIVE",targetPassive:"BARRIER",targetType:"SELF"}]}]},{id:"c_manary",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:"[]",flavorText:"^^",imageUrl:"/cards/manary.png",evolvedImageUrl:"/cards/manary_2.png",tags:["Token"],passiveAbilities:["WARD"],attackEffectType:"WATER"},{id:"c_potechi",name:"",cost:3,type:"FOLLOWER",attack:2,health:3,description:`[]
1`,flavorText:"",imageUrl:"/cards/potechi.png",evolvedImageUrl:"/cards/potechi_2.png",passiveAbilities:["WARD"],attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]}]},{id:"c_mono",name:"Mono",cost:3,type:"FOLLOWER",attack:2,health:1,description:`15
15`,flavorText:"",imageUrl:"/cards/Mono.png",evolvedImageUrl:"/cards/Mono_2.png",attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:5,targetType:"SELECT_FOLLOWER"}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:5,targetType:"SELECT_FOLLOWER"}]}]},{id:"c_sara",name:"sara",cost:7,type:"FOLLOWER",attack:4,health:6,description:`2111
1`,flavorText:"w",imageUrl:"/cards/sara.png",evolvedImageUrl:"/cards/sara_2.png",attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DESTROY",value:2,targetType:"OPPONENT"},{type:"GENERATE_CARD",targetCardId:"TOKEN_SORRY_THE_END",conditions:{minTurn:11}}]},{trigger:"SUPER_EVOLVE",effects:[{type:"DESTROY",targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_SORRY_THE_END",name:"",cost:3,type:"SPELL",description:"553sara1",flavorText:'""',imageUrl:"/cards/sorryTheEnd.png",tags:["Token"],attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"AOE_DAMAGE",value:5,targetType:"ALL_FOLLOWERS"},{type:"DAMAGE",value:5,targetType:"OPPONENT"},{type:"DRAW",value:3},{type:"SUMMON_CARD",targetCardId:"c_sara"}]}]},{id:"c_blue_tsubaki",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:`1
1`,flavorText:"",imageUrl:"/cards/blue_tsubaki.png",evolvedImageUrl:"/cards/blue_tsubaki_2.png",attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"RANDOM_DESTROY",value:1,targetType:"OPPONENT"}]}]},{id:"s_resignation_proxy",name:"",cost:0,type:"SPELL",description:"11",flavorText:"1",imageUrl:"/cards/taisyokudaiko.png",tags:["Token"],attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DESTROY",targetType:"OPPONENT",value:1},{type:"DRAW",value:1}]}]},{id:"s_yucho_of_the_abyss",name:"",cost:0,type:"SPELL",description:"11",flavorText:"",imageUrl:"/cards/yuchooftheabyss.png",tags:["Token"],attackEffectType:"THUNDER",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DAMAGE_BY_TURN",value:1,targetType:"OPPONENT"}]}]},{id:"s_thats_mine",name:"",cost:2,type:"SPELL",description:"1",flavorText:"",imageUrl:"/cards/thatsmine.png",tags:["Token"],attackEffectType:"ICE",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY_AND_GENERATE",value:0,targetType:"SELECT_FOLLOWER"}]}]},{id:"s_tenfubu_yabe_hutari",name:"2",cost:4,type:"SPELL",description:"11",flavorText:"",imageUrl:"/cards/tenfubuyabehutari.png",triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_yuki"},{type:"SUMMON_CARD",targetCardId:"c_potechi"}]}]},{id:"s_samurai_tea",name:"",cost:2,type:"SPELL",description:"1+1/+1",flavorText:'""""',imageUrl:"/cards/samuraitea.png",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1},{type:"BUFF_STATS",value:1,value2:1,targetType:"ALL_FOLLOWERS"}]}]},{id:"s_crazy_knucklers",name:"",cost:5,type:"SPELL",description:"+1/+11",flavorText:`
www www`,imageUrl:"/cards/crazy_knucklers.png",triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD_BUFFED",targetCardId:"c_white_tsubaki",value:1,value2:1},{type:"SUMMON_CARD_BUFFED",targetCardId:"c_shieko",value:1,value2:1},{type:"DRAW",value:1}]}]},{id:"s_knuckle_four",name:"",cost:10,type:"SPELL",description:"444",flavorText:"",imageUrl:"/cards/knucklefour.png",attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DESTROY",value:4,targetType:"OPPONENT"},{type:"DRAW",value:4},{type:"HEAL_LEADER",value:4,targetType:"SELF"}]}]},{id:"c_amandava",name:"amandava",cost:5,attack:2,health:3,type:"FOLLOWER",description:`21
1`,flavorText:"",imageUrl:"/cards/amandava.png",evolvedImageUrl:"/cards/amandava_2.png",attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_SET_HP",value:2,value2:1,targetType:"OPPONENT"}]},{trigger:"EVOLVE",effects:[{type:"AOE_DAMAGE",value:1,targetType:"ALL_FOLLOWERS"}]}]},{id:"c_alice",name:"",cost:3,attack:1,health:1,type:"FOLLOWER",description:`22
22`,flavorText:"",imageUrl:"/cards/alice.png",evolvedImageUrl:"/cards/alice_2.png",attackEffectType:"FIRE",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DAMAGE",value:2,value2:2,targetType:"OPPONENT"}]},{trigger:"EVOLVE",effects:[{type:"RANDOM_DAMAGE",value:2,value2:2,targetType:"OPPONENT"}]}]},{id:"c_yuri",name:"",cost:5,type:"FOLLOWER",attack:3,health:3,description:`1
13`,flavorText:`
`,imageUrl:"/cards/yuri.png",evolvedImageUrl:"/cards/yuri_2.png",attackEffectType:"WATER",triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"TOKEN_SUIHYORYU"}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:3,targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_SUIHYORYU",name:"",cost:5,type:"FOLLOWER",attack:4,health:4,description:`[] []
`,flavorText:"",imageUrl:"/cards/suihyoryu.png",evolvedImageUrl:"/cards/suihyoryu.png",tags:["Token"],passiveAbilities:["RUSH","WARD"],attackEffectType:"ICE",triggers:[{trigger:"START_OF_TURN",effects:[{type:"DESTROY_SELF"}]}]},{id:"c_cyoriena",name:"cyoriena",cost:2,type:"FOLLOWER",attack:1,health:2,description:`[] []
HP2
`,flavorText:"7",imageUrl:"/cards/cyoriena.png",evolvedImageUrl:"/cards/cyoriena_2.png",tags:["Token"],passiveAbilities:["WARD","BARRIER"],attackEffectType:"RAY",triggers:[{trigger:"END_OF_TURN",effects:[{type:"HEAL_LEADER",value:2,targetType:"SELF"}]},{trigger:"EVOLVE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_TSUBASA"}]}]},{id:"TOKEN_TSUBASA",name:"",cost:1,type:"SPELL",description:"1[]",flavorText:"",imageUrl:"/cards/tsubasa.png",tags:["Token"],triggers:[{trigger:"FANFARE",effects:[{type:"GRANT_PASSIVE",targetPassive:"STORM",targetType:"SELECT_ALLY_FOLLOWER"}]}]},{id:"c_yamato",name:"",cost:5,type:"FOLLOWER",attack:5,health:1,description:"[]",imageUrl:"/cards/yamato.jpg",passiveAbilities:["STORM"],attackEffectType:"SLASH"},{id:"c_yoruka",name:"yoRuka",cost:8,type:"FOLLOWER",attack:5,health:5,description:`1
 8yoRuka1
2`,flavorText:"Y",imageUrl:"/cards/yoRuka.png",evolvedImageUrl:"/cards/yoRuka_2.png",attackEffectType:"SUMI",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY",targetType:"SELECT_FOLLOWER"}]},{trigger:"LAST_WORD",effects:[{type:"SUMMON_CARD",targetCardId:"c_yoruka",necromance:8}]},{trigger:"SUPER_EVOLVE",effects:[{type:"RANDOM_DESTROY",value:2,targetType:"OPPONENT"}]}]},{id:"c_haruka",name:"",cost:7,type:"FOLLOWER",attack:2,health:3,description:`[]
[]1
4
1 4+2/+0`,flavorText:"",imageUrl:"/cards/haruka.png",evolvedImageUrl:"/cards/haruka_2.png",passiveAbilities:["STEALTH"],attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD_RUSH",targetCardId:"c_yuka"},{type:"SUMMON_CARD",targetCardId:"c_setsuna"}]},{trigger:"LAST_WORD",effects:[{type:"ADD_GRAVEYARD",value:4}]},{trigger:"SUPER_EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_setsuna"},{type:"BUFF_STATS",value:2,value2:0,targetType:"ALL_OTHER_FOLLOWERS",necromance:4}]}]},{id:"c_setsuna",name:"",cost:3,type:"FOLLOWER",attack:1,health:1,description:`[] []
-12`,flavorText:"",imageUrl:"/cards/setsuna.png",evolvedImageUrl:"/cards/setsuna_2.png",passiveAbilities:["STORM","BANE"],attackEffectType:"SUMI",triggers:[{trigger:"LAST_WORD",effects:[{type:"BUFF_STATS",value:-1,value2:0,targetType:"RANDOM_FOLLOWER"},{type:"ADD_GRAVEYARD",value:2}]}]},{id:"c_yuka",name:"",cost:5,type:"FOLLOWER",attack:1,health:6,description:`[] []
1
3
132`,flavorText:"",imageUrl:"/cards/yuka.png",evolvedImageUrl:"/cards/yuka_2.png",passiveAbilities:["WARD","AURA"],attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_setsuna"}]},{trigger:"LAST_WORD",effects:[{type:"ADD_GRAVEYARD",value:3}]},{trigger:"EVOLVE",effects:[{type:"RANDOM_DAMAGE",value:3,value2:1,targetType:"OPPONENT"},{type:"RANDOM_DAMAGE",value:3,value2:1,targetType:"OPPONENT"}]}]},{id:"s_hayakikoto",name:"",cost:4,type:"SPELL",description:"21",flavorText:"",imageUrl:"/cards/hayakikoto.png",triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_setsuna"},{type:"SUMMON_CARD",targetCardId:"c_setsuna"},{type:"DRAW",value:1}]}]},{id:"s_keishou",name:"",cost:9,type:"SPELL",description:"1-9",flavorText:`
`,imageUrl:"/cards/keisyopower.png",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY_AND_GENERATE",targetType:"RANDOM_ENEMY_FOLLOWER",value:-9}]}]},{id:"s_night_parade",name:"",cost:10,type:"SPELL",description:` 41
+1/+0`,flavorText:"",imageUrl:"/cards/nightparade.png",triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD_FILL_BOARD",targetCardId:"c_setsuna",necromance:4},{type:"BUFF_STATS",value:1,value2:0,targetType:"ALL_FOLLOWERS"}]}]}];function o0(t){let e=t;return()=>(e=(e*1664525+1013904223)%4294967296,e/4294967296)}function Zk(t,e){let n=t.length,r;for(;n!=0;)r=Math.floor(e()*n),n--,[t[n],t[r]]=[t[r],t[n]];return t}function ew(t){var s;const e=t.players.p1,n=t.players.p2;return[t.turnCount,t.activePlayerId,e.hp,e.maxHp,e.pp,e.maxPp,e.sep,e.evolutionsUsed,n.hp,n.maxHp,n.pp,n.maxPp,n.sep,n.evolutionsUsed,e.board.map(i=>i?`${i.id}_${i.instanceId}_${i.currentHealth}_${i.hasBarrier?"B":""}`:"null").join(","),n.board.map(i=>i?`${i.id}_${i.instanceId}_${i.currentHealth}_${i.hasBarrier?"B":""}`:"null").join(","),e.hand.length,n.hand.length,((s=t.pendingEffects)==null?void 0:s.length)||0,t.rngSeed].join("|")}const tw=[{cardId:"c_senka_knuckler",count:3},{cardId:"c_yuki",count:3},{cardId:"c_white_tsubaki",count:3},{cardId:"c_shieko",count:3},{cardId:"s_samurai_tea",count:3},{cardId:"c_bucchi",count:2},{cardId:"c_valkyrie",count:1},{cardId:"c_potechi",count:3},{cardId:"s_tenfubu_yabe_hutari",count:3},{cardId:"s_crazy_knucklers",count:2},{cardId:"c_sia",count:2},{cardId:"c_mono",count:3},{cardId:"c_ruiyu",count:1},{cardId:"c_kasuga",count:1},{cardId:"c_y",count:2},{cardId:"c_sara",count:1},{cardId:"s_knuckle_four",count:1},{cardId:"c_blue_tsubaki",count:3}],nw=[{cardId:"c_azya",count:3},{cardId:"c_ruiyu",count:2},{cardId:"c_y",count:2},{cardId:"c_sara",count:2},{cardId:"c_urara",count:3},{cardId:"c_yunagi",count:3},{cardId:"c_tsubumaru",count:3},{cardId:"c_nayuta",count:3},{cardId:"c_yuri",count:2},{cardId:"c_alice",count:3},{cardId:"c_kasuga",count:1},{cardId:"c_barura",count:3},{cardId:"c_valkyrie",count:3},{cardId:"s_3cats",count:2},{cardId:"s_final_cannon",count:1},{cardId:"c_amandava",count:2},{cardId:"c_mono",count:2}],rw=[{cardId:"c_yoruka",count:3},{cardId:"c_y",count:3},{cardId:"c_haruka",count:3},{cardId:"c_yuka",count:3},{cardId:"c_setsuna",count:3},{cardId:"s_hayakikoto",count:3},{cardId:"s_night_parade",count:1},{cardId:"c_kasuga",count:1},{cardId:"c_yunagi",count:3},{cardId:"c_tsubumaru",count:3},{cardId:"c_nayuta",count:3},{cardId:"c_mono",count:3},{cardId:"c_ruiyu",count:1},{cardId:"c_sara",count:1},{cardId:"s_3cats",count:2},{cardId:"c_yuri",count:2},{cardId:"c_sia",count:2}];function Or(t){const e=rs.find(n=>n.id===t);return e||rs.find(n=>n.name===t)}function tE(){return rs.map(t=>t.name).sort((t,e)=>e.length-t.length)}function zl(t){return{STORM:"",RUSH:"",WARD:"",BARRIER:"",AURA:"",STEALTH:"",BANE:"",DOUBLE_ATTACK:"",IMMUNE_TO_FOLLOWER_DAMAGE:"",GUTS_MY_TURN:""}[t]||t}function sw(t,e){const n=[];let r=0;return t.forEach(s=>{const i=Or(s.cardId);if(i)for(let o=0;o<s.count;o++)n.push({...i,id:`${e}_c${r}`,instanceId:`inst_${e}_c${r}`}),r++;else console.warn(`Card definition not found: ${s.cardId}`)}),n}function hy(t,e,n,r){const i=sw(n==="SENKA"?tw:n==="AJA"?nw:rw,t);return{id:t,name:e,class:n,hp:dy,maxHp:dy,pp:0,maxPp:0,sep:2,deck:Zk(i,r),hand:[],graveyard:[],board:[],evolutionsUsed:0,canEvolveThisTurn:!1,extraPpUsedEarly:!1,extraPpUsedLate:!1,extraPpActive:!1}}function uc(t,e,n,r,s,i=!0){const o=Math.floor(Math.random()*1e6),a=o0(o),c=hy("p1",t,e,a),u=hy("p2",n,r,a);c.hand=c.deck.splice(0,4),u.hand=u.deck.splice(0,4);let p,h;return i?(p="p1",h=t,c.maxPp=1,c.pp=1,u.maxPp=0,u.pp=0):(p="p2",h=n,c.maxPp=0,c.pp=0,u.maxPp=1,u.pp=1),{phase:"INIT",rngSeed:Math.floor(a()*1e6),activePlayerId:p,firstPlayerId:p,players:{p1:c,p2:u},turnCount:1,pendingEffects:[],logs:[` 1 - ${h} `],winnerId:void 0}}function Ep(t){return t==="p1"?"p2":"p1"}function iw(t,e,n,r,s,i){var h,f,m,b,R,W,d,I,S,k,$,B,te,J,me,he,ke,L,F,fe,ie;let o={...t,players:{p1:{...t.players.p1,hand:[...t.players.p1.hand],deck:[...t.players.p1.deck],board:t.players.p1.board.map(y=>y?{...y,passiveAbilities:y.passiveAbilities?[...y.passiveAbilities]:[]}:null),graveyard:[...t.players.p1.graveyard]},p2:{...t.players.p2,hand:[...t.players.p2.hand],deck:[...t.players.p2.deck],board:t.players.p2.board.map(y=>y?{...y,passiveAbilities:y.passiveAbilities?[...y.passiveAbilities]:[]}:null),graveyard:[...t.players.p2.graveyard]}},logs:[...t.logs||[]]};const a=o0(o.rngSeed||999);o.rngSeed=Math.floor(a()*1e6);const c=Ep(e),u=y=>{for(const C of["p1","p2"]){const x=o.players[C].board.findIndex(v=>(v==null?void 0:v.instanceId)===y);if(x!==-1&&o.players[C].board[x])return{card:o.players[C].board[x],player:o.players[C],index:x}}return null};if(r.necromance!==void 0&&r.necromance>0&&r.type!=="SUMMON_CARD_FILL_BOARD"){const y=o.players[e];if(y.graveyard.length<r.necromance)return console.log(`[Engine] : ${y.graveyard.length} < ${r.necromance}`),o;const C=y.graveyard.splice(-r.necromance,r.necromance);o.logs.push(`${y.name}  ${r.necromance} `),console.log(`[Engine] : ${C.map(x=>x.name).join(", ")} `)}const p=(y,C)=>{var v;const x=(v=y.triggers)==null?void 0:v.find(T=>T.trigger==="LAST_WORD");if(x){const T=x.effects.map(w=>({sourceCard:y,effect:w,sourcePlayerId:C}));o.pendingEffects=[...o.pendingEffects||[],...T],o.logs.push(`${y.name} `),console.log(`[Engine] processSingleEffect: Last Word triggered for ${y.name}. pendingEffects count: ${o.pendingEffects.length}`)}};switch(r.type){case"DAMAGE":{const y=r.value||0;if(r.targetType==="SELECT_FOLLOWER"&&s){const C=u(s);if(C){const{card:x,player:v,index:T}=C;if(x.hasBarrier)x.hasBarrier=!1,o.logs.push(`${x.name} `);else if(x.currentHealth-=y,o.logs.push(`${n.name}  ${x.name}  ${y} `),x.currentHealth<=0){x.currentHealth=Math.min(0,x.currentHealth);const w=Object.keys(o.players).find(O=>o.players[O]===v)||c;p(x,w),v.graveyard.push(x),v.board[T]=null,o.logs.push(`${x.name} `)}}}else if(r.targetType==="OPPONENT"){const C=o.players[c];if(C.leaderDamageShield)C.leaderDamageShield=!1,o.logs.push(`${n.name}  ${y} `);else{const x=C.board.some(T=>{var w;return(w=T==null?void 0:T.passiveAbilities)==null?void 0:w.includes("LEADER_DAMAGE_CAP")}),v=x?Math.min(y,1):y;C.hp-=v,x&&y>1?o.logs.push(`${n.name}  ${y} 1`):o.logs.push(`${n.name}  ${v} `),C.hp<=0&&(o.winnerId=e,o.logs.push(`${C.name} `))}}break}case"AOE_DAMAGE":{const y=r.value||0;if(r.targetType==="ALL_FOLLOWERS"){const C=o.players[c].board,x=i&&i.length>0?new Set(i):null;C.forEach(T=>{if(T){if(x&&!x.has(T.instanceId))return;T.hasBarrier?(T.hasBarrier=!1,o.logs.push(`${T.name} `)):T.currentHealth-=y}}),C.filter(T=>T&&T.currentHealth<=0).forEach(T=>{T&&(T.currentHealth=Math.min(0,T.currentHealth),p(T,c),o.players[c].graveyard.push(T),o.logs.push(`${T.name} `))}),o.logs.push(`${n.name}  ${y} `),C.forEach((T,w)=>{T&&T.currentHealth<=0&&(C[w]=null)})}break}case"DRAW":{const y=r.value||1,C=o.players[e];for(let x=0;x<y;x++)if(C.deck.length>0){const v=C.deck.pop();v&&(C.hand.length<9?C.hand.push(v):(C.graveyard.push(v),o.logs.push(`${C.name}${v.name}`)))}o.logs.push(`${C.name}  ${y} `);break}case"ADD_GRAVEYARD":{const y=r.value||1,C=o.players[e];for(let x=0;x<y;x++){const v={...n,instanceId:`grave_${o.rngSeed}_${Math.floor(a()*1e3)}_${x}`};C.graveyard.push(v)}o.logs.push(`${C.name}  ${y} `);break}case"HEAL_LEADER":{const y=r.value||0,C=o.players[e];C.hp=Math.min(C.maxHp,C.hp+y),o.logs.push(`${C.name}  ${y} HP`);break}case"DESTROY":{const y=(C,x)=>{var v;return((v=C.passiveAbilities)==null?void 0:v.includes("IMMUNE_TO_DAMAGE_MY_TURN"))===!0&&o.activePlayerId===x};if(r.targetType==="ALL_OTHER_FOLLOWERS"){const C=o.players[c].board,x=[];C.forEach(O=>{O&&(y(O,c)?(x.push(O),o.logs.push(`${O.name} `)):(p(O,c),o.players[c].graveyard.push(O)))}),o.players[c].board=x;const v=o.players[e].board,T=[],w=n.instanceId;v.forEach(O=>{O&&(w&&O.instanceId===w?T.push(O):y(O,e)?(T.push(O),o.logs.push(`${O.name} `)):(p(O,e),o.players[e].graveyard.push(O)))}),o.players[e].board=T,o.logs.push(`${n.name} `)}else if((r.targetType==="SELECT_FOLLOWER"||r.targetType==="SELECT_ALLY_FOLLOWER")&&s){const C=u(s);if(C){const{card:x,player:v,index:T}=C,w=Object.keys(o.players).find(O=>o.players[O].board.includes(x))||"";y(x,w)?o.logs.push(`${x.name} `):(x.currentHealth=1,p(x,w),v.graveyard.push(x),v.board[T]=null,o.logs.push(`${x.name}  ${n.name} `))}}break}case"GENERATE_CARD":{if((h=r.conditions)!=null&&h.minTurn&&t.turnCount<r.conditions.minTurn)break;const y=r.targetCardId,C=rs.find(x=>x.id===y);if(C){const x=o.players[e],v=`gen_${o.rngSeed}_${Date.now()}_${Math.floor(a()*1e4)}`,T={...C,id:`token_${o.rngSeed}_${Math.floor(a()*1e3)}`,instanceId:v};x.hand.length<9?(x.hand.push(T),o.logs.push(`${x.name}  ${C.name} `)):(x.graveyard.push(T),o.logs.push(`${x.name}${C.name}`))}break}case"REDUCE_HAND_COST":{const y=r.value||0,C=((f=r.conditions)==null?void 0:f.nameIn)||[],x=o.players[e];let v=0;x.hand.forEach(T=>{if(C.includes(T.name)){const w=T.cost,O=Math.max(0,w-y);O!==w&&(T.cost=O,T.baseCost=O,v++)}}),v>0&&o.logs.push(`${n.name} -${y}`);break}case"GRANT_LEADER_DAMAGE_SHIELD":{const y=o.players[e];y.leaderDamageShield=!0,o.logs.push(`${y.name} 0`);break}case"RANDOM_DESTROY":{const y=(T,w)=>{var O;return((O=T.passiveAbilities)==null?void 0:O.includes("IMMUNE_TO_DAMAGE_MY_TURN"))===!0&&o.activePlayerId===w},C=r.value||1,x=r.targetType==="SELF"?e:c,v=o.players[x].board;if(i&&i.length>0)i.forEach(T=>{const w=v.findIndex(O=>(O==null?void 0:O.instanceId)===T);if(w!==-1&&v[w]){const O=v[w];y(O,x)?o.logs.push(`${O.name} `):(O.currentHealth=1,p(O,x),o.players[x].graveyard.push(O),v[w]=null,o.logs.push(`${O.name}  ${n.name} `))}});else{const T=v.map((O,q)=>!O||y(O,x)?-1:q).filter(O=>O!==-1);for(let O=T.length-1;O>0;O--){const q=Math.floor(a()*(O+1));[T[O],T[q]]=[T[q],T[O]]}T.slice(0,C).forEach(O=>{const q=v[O];q&&(q.currentHealth=1,p(q,x),o.players[x].graveyard.push(q),v[O]=null,o.logs.push(`${q.name}  ${n.name} `))})}break}case"RANDOM_SET_HP":{const y=r.value||1,C=r.value2||1,x=r.targetType==="SELF"?e:c,v=o.players[x].board;if(i&&i.length>0)i.forEach(T=>{const w=v.findIndex(O=>(O==null?void 0:O.instanceId)===T);w!==-1&&v[w]&&(v[w].currentHealth=C,o.logs.push(`${v[w].name} HP ${C} `))});else{const T=v.map((O,q)=>O?q:-1).filter(O=>O!==-1);for(let O=T.length-1;O>0;O--){const q=Math.floor(a()*(O+1));[T[O],T[q]]=[T[q],T[O]]}T.slice(0,y).forEach(O=>{const q=v[O];q&&(q.currentHealth=C,o.logs.push(`${q.name} HP ${C} `))})}break}case"RANDOM_DAMAGE":{const y=r.value2||1,C=r.value||0,x=r.targetType==="SELF"?e:c,v=o.players[x].board,T=O=>{const q=v[O];q&&(q.hasBarrier?(q.hasBarrier=!1,o.logs.push(`${q.name} `)):(q.currentHealth-=C,o.logs.push(`${n.name}  ${q.name}  ${C} `)),q.currentHealth<=0&&(q.currentHealth=0,p(q,x),o.players[x].graveyard.push(q),v[O]=null,o.logs.push(`${q.name} `)))},w=new Set;if(i&&i.length>0)i.forEach(O=>{const q=v.findIndex(j=>(j==null?void 0:j.instanceId)===O);if(q!==-1&&v[q])w.add(O),T(q);else{const j=v.map((ye,Ae)=>ye&&!w.has(ye.instanceId)?Ae:-1).filter(ye=>ye!==-1);if(j.length>0){const ye=Math.floor(a()*j.length),Ae=j[ye],we=v[Ae];w.add(we.instanceId),T(Ae)}}});else{const O=v.map((j,ye)=>j?ye:-1).filter(j=>j!==-1);for(let j=O.length-1;j>0;j--){const ye=Math.floor(a()*(j+1));[O[j],O[ye]]=[O[ye],O[j]]}O.slice(0,y).forEach(j=>{T(j)})}break}case"RANDOM_DAMAGE_BY_TURN":{const y=r.value||1,C=o.turnCount,x=r.targetType==="SELF"?e:c,v=o.players[x].board,T=w=>{var q;const O=v[w];if(!O)return!1;if(O.hasBarrier)return O.hasBarrier=!1,o.logs.push(`${O.name} `),!0;if(O.currentHealth-=y,o.logs.push(`${n.name}  ${O.name}  ${y} `),O.currentHealth<=0){O.currentHealth=0;const j=Object.keys(o.players).find(Ae=>o.players[Ae]===o.players[x])||x,ye=(q=O.triggers)==null?void 0:q.find(Ae=>Ae.trigger==="LASTWORD");return ye&&ye.effects.forEach(Ae=>{o.pendingEffects.push({sourceCard:O,effect:Ae,sourcePlayerId:j})}),o.players[x].graveyard.push(O),v[w]=null,o.logs.push(`${O.name} `),!1}return!0};if(i&&i.length>0)for(let w=0;w<i.length;w++){const O=i[w],q=v.findIndex(j=>(j==null?void 0:j.instanceId)===O);if(q!==-1&&v[q])T(q);else{const j=v.map((ye,Ae)=>ye?Ae:-1).filter(ye=>ye!==-1);if(j.length>0){const ye=Math.floor(a()*j.length);T(j[ye])}}}else for(let w=0;w<C;w++){const O=v.map((j,ye)=>j?ye:-1).filter(j=>j!==-1);if(O.length===0)break;const q=Math.floor(a()*O.length);T(O[q])}break}case"SET_MAX_HP":{const y=r.value||20;if(r.targetType==="OPPONENT"){const C=o.players[c];C.maxHp=y,C.hp>y&&(C.hp=y)}break}case"SUMMON_CARD":{const y=r.targetCardId,C=rs.find(x=>x.id===y);if(C){const x=o.players[e];if(x.board.filter(T=>T!==null).length<5){const T={...C,instanceId:`token_${o.rngSeed}_${Math.floor(a()*1e3)}`,canAttack:((m=C.passiveAbilities)==null?void 0:m.includes("STORM"))||((b=C.passiveAbilities)==null?void 0:b.includes("RUSH"))||!1,currentHealth:C.health||1,maxHealth:C.health||1,attack:C.attack||0,currentAttack:C.attack||0,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((R=C.passiveAbilities)==null?void 0:R.includes("BARRIER"))??!1,passiveAbilities:C.passiveAbilities?[...C.passiveAbilities]:[],hadStealth:((W=C.passiveAbilities)==null?void 0:W.includes("STEALTH"))??!1};(d=C.tags)!=null&&d.includes("Knuckler")&&!T.passiveAbilities.includes("STORM")&&x.board.some(O=>(O==null?void 0:O.name)==="")&&(T.passiveAbilities.push("STORM"),T.canAttack=!0,o.logs.push(`${C.name}   `)),x.board.push(T),o.logs.push(`${x.name}  ${C.name} `)}}break}case"SUMMON_CARD_RUSH":{const y=r.targetCardId,C=rs.find(x=>x.id===y);if(C){const x=o.players[e];if(x.board.filter(T=>T!==null).length<5){const T={...C,instanceId:`token_${o.rngSeed}_${Math.floor(a()*1e3)}`,canAttack:!0,currentHealth:C.health||1,maxHealth:C.health||1,attack:C.attack||0,currentAttack:C.attack||0,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((I=C.passiveAbilities)==null?void 0:I.includes("BARRIER"))??!1,passiveAbilities:C.passiveAbilities?[...C.passiveAbilities]:[],hadStealth:((S=C.passiveAbilities)==null?void 0:S.includes("STEALTH"))??!1};let w=!1;(k=C.tags)!=null&&k.includes("Knuckler")&&!T.passiveAbilities.includes("STORM")&&x.board.some(q=>(q==null?void 0:q.name)==="")&&(T.passiveAbilities.push("STORM"),w=!0,o.logs.push(`${C.name}   `)),!w&&!T.passiveAbilities.includes("RUSH")&&T.passiveAbilities.push("RUSH"),x.board.push(T),o.logs.push(`${x.name}  ${C.name} ${w?"":""}`)}}break}case"SUMMON_CARD_BUFFED":{const y=r.targetCardId,C=rs.find(T=>T.id===y),x=r.value||0,v=r.value2||0;if(C){const T=o.players[e];if(T.board.filter(O=>O!==null).length<5){const O=C.attack||0,q=C.health||1,j=O+x,ye=q+v,Ae={...C,instanceId:`token_${o.rngSeed}_${Math.floor(a()*1e3)}`,canAttack:!1,currentHealth:ye,maxHealth:ye,health:ye,attack:j,currentAttack:j,baseAttack:O,baseHealth:q,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:(($=C.passiveAbilities)==null?void 0:$.includes("BARRIER"))??!1,passiveAbilities:C.passiveAbilities?[...C.passiveAbilities]:[],hadStealth:((B=C.passiveAbilities)==null?void 0:B.includes("STEALTH"))??!1};(te=C.tags)!=null&&te.includes("Knuckler")&&!Ae.passiveAbilities.includes("STORM")&&T.board.some(Z=>(Z==null?void 0:Z.name)==="")&&(Ae.passiveAbilities.push("STORM"),Ae.canAttack=!0,o.logs.push(`${C.name}   `)),((J=Ae.passiveAbilities)!=null&&J.includes("RUSH")||(me=Ae.passiveAbilities)!=null&&me.includes("STORM"))&&(Ae.canAttack=!0),T.board.push(Ae),o.logs.push(`${T.name}  ${C.name} +${x}/+${v}`),o.pendingEffects=[...o.pendingEffects||[],{sourceCard:Ae,effect:{type:"VISUAL_BUFF_ONLY",value:x,value2:v},sourcePlayerId:e}]}}break}case"SUMMON_CARD_FILL_BOARD":{const y=r.targetCardId,C=rs.find(v=>v.id===y),x=r.necromance||0;if(C){const v=o.players[e];let T=0;for(;!(v.board.filter(q=>q!==null).length>=5);){if(x>0&&v.graveyard.length<x){T===0&&o.logs.push(` ${C.name} `);break}if(x>0){const q=v.graveyard.splice(-x,x);o.logs.push(` ${x} ${q.map(j=>j.name).join(", ")} `)}const O={...C,instanceId:`token_${o.rngSeed}_${Math.floor(a()*1e3)}_${T}`,canAttack:((he=C.passiveAbilities)==null?void 0:he.includes("STORM"))||((ke=C.passiveAbilities)==null?void 0:ke.includes("RUSH"))||!1,currentHealth:C.health||1,maxHealth:C.health||1,attack:C.attack||0,currentAttack:C.attack||0,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((L=C.passiveAbilities)==null?void 0:L.includes("BARRIER"))??!1,passiveAbilities:C.passiveAbilities?[...C.passiveAbilities]:[],hadStealth:((F=C.passiveAbilities)==null?void 0:F.includes("STEALTH"))??!1};(fe=C.tags)!=null&&fe.includes("Knuckler")&&!O.passiveAbilities.includes("STORM")&&v.board.some(j=>(j==null?void 0:j.name)==="")&&(O.passiveAbilities.push("STORM"),O.canAttack=!0,o.logs.push(`${C.name}   `)),v.board.push(O),T++,o.logs.push(`${v.name}  ${C.name} `)}T>0&&o.logs.push(` ${T}  ${C.name} `)}break}case"DESTROY_AND_STEAL":{if(r.targetType==="SELECT_FOLLOWER"&&s){const y=u(s);if(y){const{card:C,player:x,index:v}=y,T=Object.keys(o.players).find(q=>o.players[q]===x)||c,w=o.players[e];if(w.board.filter(q=>q!==null).length<5){x.board[v]=null,o.logs.push(`${C.name}  ${n.name} `);const q={...C,instanceId:`stolen_${o.rngSeed}_${Math.floor(a()*1e3)}`,canAttack:!1,currentHealth:C.health||C.currentHealth,maxHealth:C.health||C.maxHealth,currentAttack:C.attack||C.currentAttack,attacksMade:0,turnPlayed:o.turnCount,hasEvolved:!1};w.board.push(q),o.logs.push(`${w.name}  ${q.name} `)}else p(C,T),x.graveyard.push(C),x.board[v]=null,o.logs.push(`${C.name}  ${n.name} `)}}break}case"DESTROY_AND_GENERATE":{let y=null;if(r.targetType==="SELECT_FOLLOWER"&&s)y=u(s);else if(r.targetType==="RANDOM_ENEMY_FOLLOWER"){const x=o.players[c].board.map((v,T)=>({card:v,index:T})).filter(v=>v.card!==null);if(x.length>0){const v=Math.floor(a()*x.length),T=x[v];y={card:T.card,player:o.players[c],index:T.index}}}if(y){const{card:C,player:x,index:v}=y,T=Object.keys(o.players).find(q=>o.players[q]===x)||c;p(C,T),x.graveyard.push(C),x.board[v]=null,o.logs.push(`${C.name}  ${n.name} `);const w=o.players[e],O=Or(C.name);if(O){const q=Math.max(0,O.cost+(r.value||0)),j={...O,instanceId:`generated_${o.rngSeed}_${Math.floor(a()*1e3)}`,baseCost:q,cost:q,attackEffectType:O.attackEffectType};w.hand.push(j);const ye=r.value||0;o.logs.push(`${w.name}  ${j.name} ${ye>=0?"+":""}${ye}`)}}break}case"RETURN_TO_HAND":{const y=o.players[c].board;let C=-1;if(r.targetType==="SELECT_FOLLOWER"&&s?C=y.findIndex(x=>(x==null?void 0:x.instanceId)===s):(r.targetType==="RANDOM_FOLLOWER"||!s)&&y.length>0&&(C=Math.floor(a()*y.length)),C!==-1&&y[C]){const x=y[C];o.players[c].board[C]=null;const v=o.players[c],T=Or(x.id)||Or(x.name),{currentHealth:w,maxHealth:O,canAttack:q,attacksMade:j,hasEvolved:ye,baseAttack:Ae,baseHealth:we,turnPlayed:Z,hasBarrier:V,attack:Le,health:be,...Xe}=x,Se={...Xe,attack:(T==null?void 0:T.attack)??Le,health:(T==null?void 0:T.health)??be};v.hand.length<9?(v.hand.push(Se),o.logs.push(`${x.name} `)):(v.graveyard.push(Se),o.logs.push(`${x.name} `))}break}case"RANDOM_BOUNCE":{const y=r.value||1,C=o.players[c].board;for(let x=0;x<y;x++){const v=C.map((pt,Qe)=>pt?Qe:-1).filter(pt=>pt!==-1);if(v.length===0)break;const T=v[Math.floor(a()*v.length)],w=C[T];C[T]=null;const O=o.players[c],q=Or(w.id)||Or(w.name),{currentHealth:j,maxHealth:ye,canAttack:Ae,attacksMade:we,hasEvolved:Z,baseAttack:V,baseHealth:Le,turnPlayed:be,hasBarrier:Xe,attack:Se,health:De,...vt}=w,$e={...vt,attack:(q==null?void 0:q.attack)??Se,health:(q==null?void 0:q.health)??De};O.hand.length<9?(O.hand.push($e),o.logs.push(`${w.name} `)):(O.graveyard.push($e),o.logs.push(`${w.name} `))}break}case"GRANT_PASSIVE":{const y=r.targetPassive;if(!y)break;if(r.targetType==="SELF"){const C=n;if(C.instanceId){const v=o.players[e].board.find(T=>(T==null?void 0:T.instanceId)===C.instanceId);v&&(y==="BARRIER"?(v.hasBarrier=!0,o.logs.push(`${v.name} `)):(v.passiveAbilities||(v.passiveAbilities=[]),v.passiveAbilities.includes(y)||(v.passiveAbilities.push(y),o.logs.push(`${v.name}  ${zl(y)} `)),(y==="STORM"||y==="RUSH")&&(v.canAttack=!0)))}}else if((r.targetType==="SELECT_FOLLOWER"||r.targetType==="SELECT_ALLY_FOLLOWER")&&s){const C=u(s);if(C){const{card:x}=C;y==="BARRIER"?(x.hasBarrier=!0,o.logs.push(`${x.name} `)):(x.passiveAbilities||(x.passiveAbilities=[]),x.passiveAbilities.includes(y)||(x.passiveAbilities.push(y),o.logs.push(`${x.name}  ${zl(y)} `)),(y==="STORM"||y==="RUSH")&&(x.canAttack=!0))}}else if(r.targetType==="ALL_FOLLOWERS"){const C=o.players[e];let x=0;console.log(`[GRANT_PASSIVE] ALL_FOLLOWERS: Player board has ${C.board.filter(v=>v).length} units, condition tag=${(ie=r.conditions)==null?void 0:ie.tag}`),C.board.forEach(v=>{var T,w,O;if(v){if(console.log(`[GRANT_PASSIVE] Checking: ${v.name}, tags=${v.tags}, passives=${v.passiveAbilities}`),(T=r.conditions)!=null&&T.tag&&!((w=v.tags)!=null&&w.includes(r.conditions.tag))){console.log(`[GRANT_PASSIVE] Skipped ${v.name}: no matching tag`);return}if((O=r.conditions)!=null&&O.nameIn&&!r.conditions.nameIn.includes(v.name)){console.log(`[GRANT_PASSIVE] Skipped ${v.name}: no matching nameIn`);return}y==="BARRIER"?(v.hasBarrier=!0,x++):(v.passiveAbilities||(v.passiveAbilities=[]),v.passiveAbilities.includes(y)||(v.passiveAbilities.push(y),x++,console.log(`[GRANT_PASSIVE] Granted ${y} to ${v.name}`),(y==="STORM"||y==="RUSH")&&(v.canAttack=!0)))}}),x>0&&o.logs.push(`${x} ${zl(y)} `),console.log(`[GRANT_PASSIVE] Total granted: ${x}`)}else if(r.targetType==="ALL_OTHER_FOLLOWERS"){const C=o.players[e];let x=0;C.board.forEach(v=>{var T,w,O;if(v&&v.instanceId!==n.instanceId){if((T=r.conditions)!=null&&T.tag&&!((w=v.tags)!=null&&w.includes(r.conditions.tag))||(O=r.conditions)!=null&&O.nameIn&&!r.conditions.nameIn.includes(v.name))return;y==="BARRIER"?(v.hasBarrier=!0,x++):(v.passiveAbilities||(v.passiveAbilities=[]),v.passiveAbilities.includes(y)||(v.passiveAbilities.push(y),x++,(y==="STORM"||y==="RUSH")&&(v.canAttack=!0)))}}),x>0&&o.logs.push(`${x} ${zl(y)} `)}break}case"BUFF_STATS":{const y=r.value||0,C=r.value2||0;if(r.targetType==="ALL_FOLLOWERS")o.players[e].board.forEach(v=>{var T,w,O;if(v){if((T=r.conditions)!=null&&T.tag&&!((w=v.tags)!=null&&w.includes(r.conditions.tag))||(O=r.conditions)!=null&&O.nameIn&&!r.conditions.nameIn.includes(v.name))return;v.baseAttack||(v.baseAttack=v.attack||0),v.baseHealth||(v.baseHealth=v.health||0),v.attack=(v.attack||0)+y,v.currentAttack=(v.currentAttack||0)+y,v.health=(v.health||0)+C,v.maxHealth=(v.maxHealth||0)+C,v.currentHealth=(v.currentHealth||0)+C,o.logs.push(`${v.name}  +${y}/+${C} `)}});else if(r.targetType==="ALL_OTHER_FOLLOWERS")o.players[e].board.forEach(v=>{var T,w,O;if(v&&v.instanceId!==n.instanceId){if((T=r.conditions)!=null&&T.tag&&!((w=v.tags)!=null&&w.includes(r.conditions.tag))||(O=r.conditions)!=null&&O.nameIn&&!r.conditions.nameIn.includes(v.name))return;v.baseAttack||(v.baseAttack=v.attack||0),v.baseHealth||(v.baseHealth=v.health||0),v.attack=(v.attack||0)+y,v.currentAttack=(v.currentAttack||0)+y,v.health=(v.health||0)+C,v.maxHealth=(v.maxHealth||0)+C,v.currentHealth=(v.currentHealth||0)+C,o.logs.push(`${v.name}  +${y}/+${C} `)}});else if((r.targetType==="SELECT_FOLLOWER"||r.targetType==="SELECT_ALLY_FOLLOWER"||r.targetType==="SELECT_OTHER_ALLY_FOLLOWER")&&s){const x=u(s);if(x){const{card:v}=x;v.baseAttack||(v.baseAttack=v.attack||0),v.baseHealth||(v.baseHealth=v.health||0),v.attack=(v.attack||0)+y,v.currentAttack=(v.currentAttack||0)+y,v.health=(v.health||0)+C,v.maxHealth=(v.maxHealth||0)+C,v.currentHealth=(v.currentHealth||0)+C,o.logs.push(`${v.name}  +${y}/+${C} `)}}else if(r.targetType==="RANDOM_FOLLOWER"){const x=o.players[c].board,v=x.map((T,w)=>T?w:-1).filter(T=>T!==-1);if(v.length>0){const T=v[Math.floor(a()*v.length)],w=x[T];w.baseAttack||(w.baseAttack=w.attack||0),w.baseHealth||(w.baseHealth=w.health||0),w.attack=(w.attack||0)+y,w.currentAttack=(w.currentAttack||0)+y,w.health=(w.health||0)+C,w.maxHealth=(w.maxHealth||0)+C,w.currentHealth=(w.currentHealth||0)+C,w.currentAttack<0&&(w.currentAttack=0),w.attack&&w.attack<0&&(w.attack=0);const O=y>=0?`+${y}`:`${y}`,q=C>=0?`+${C}`:`${C}`;o.logs.push(`${w.name}  ${O}/${q} `)}else o.logs.push("")}break}}return o}const ow=t=>{const e=n=>{const r=n.board.some(i=>i&&i.name.includes("")),s=n.hand.map(i=>{var c;const o=i.baseCost!==void 0?i.baseCost:i.cost;let a=o;return r&&((c=i.tags)!=null&&c.includes("Knuckler"))&&(a=Math.max(0,o-2)),i.cost!==a?{...i,cost:a,baseCost:o}:i});return{...n,hand:s}};return{...t,players:{p1:e(t.players.p1),p2:e(t.players.p2)}}},aw=(t,e)=>{let n=lw(t,e);return n=ow(n),n.lastHash=ew(n),n},lw=(t,e)=>{var s,i,o,a,c,u,p,h,f,m,b,R,W,d,I,S,k,$,B,te,J,me,he,ke,L;console.log(`[Reducer] Action: ${e.type}, isRemote: ${e.isRemote}`);let n={...t,players:{p1:{...t.players.p1,hand:[...t.players.p1.hand],deck:[...t.players.p1.deck],board:t.players.p1.board.map(F=>F?{...F,passiveAbilities:F.passiveAbilities?[...F.passiveAbilities]:[]}:null),graveyard:[...t.players.p1.graveyard]},p2:{...t.players.p2,hand:[...t.players.p2.hand],deck:[...t.players.p2.deck],board:t.players.p2.board.map(F=>F?{...F,passiveAbilities:F.passiveAbilities?[...F.passiveAbilities]:[]}:null),graveyard:[...t.players.p2.graveyard]}},logs:[...t.logs||[]]};const r=o0(n.rngSeed||999);switch(n.rngSeed=Math.floor(r()*1e6),e.type){case"START_GAME":return t;case"END_TURN":{const F=t.activePlayerId,fe=n.players[F];fe.extraPpActive&&(fe.id!==t.firstPlayerId&&(n.turnCount<=5?fe.extraPpUsedEarly=!0:fe.extraPpUsedLate=!0),fe.extraPpActive=!1);const ie=[...n.pendingEffects||[]];fe.board.forEach(x=>{x&&x.triggers&&x.triggers.filter(v=>v.trigger==="END_OF_TURN").forEach(v=>{v.effects.forEach(T=>{ie.push({sourceCard:x,effect:T,sourcePlayerId:F})})})});const y=Ep(F),C=n.players[y];if(C.board.forEach((x,v)=>{x&&x.triggers&&x.triggers.filter(T=>T.trigger==="START_OF_TURN").forEach(T=>{T.effects.forEach(w=>{w.type==="DESTROY_SELF"?x&&(n.players[y].graveyard.push(x),n.players[y].board[v]=null,n.logs.push(`${x.name} `)):ie.push({sourceCard:x,effect:w,sourcePlayerId:y})})})}),n.players[y].board=n.players[y].board.filter(Boolean),C.maxPp=Math.min(10,C.maxPp+1),C.pp=C.maxPp,C.deck.length>0){const x=C.deck.pop();x&&(C.hand.length<9?C.hand.push(x):(C.graveyard.push(x),n.logs.push(`${C.name}${x.name}`)))}return C.board=C.board.filter(Boolean),C.board.forEach(x=>{x&&(x.canAttack=!0,x.attacksMade=0,x.turnPlayed=-1)}),C.canEvolveThisTurn=!0,n.activePlayerId=y,n.pendingEffects=ie,y===t.firstPlayerId&&(n.turnCount+=1),n.logs.push(` ${n.turnCount} - ${C.name} `),n}case"CONCEDE":{const F=e.playerId,fe=n.players[F];if(!fe)return console.warn(`[Engine] CONCEDE: Unknown playerId: ${F}. Ignoring.`),t;if(t.phase==="GAME_OVER")return console.warn("[Engine] CONCEDE: Game already over. Ignoring."),t;const ie=Ep(F);return n.phase="GAME_OVER",n.winnerId=ie,n.logs.push(`${fe.name} `),console.log(`[Engine] CONCEDE: ${F} surrendered. Winner: ${ie}`),n}case"RESOLVE_EFFECT":{if(!n.pendingEffects||n.pendingEffects.length===0)return n;const[F,...fe]=n.pendingEffects;console.log(`[Engine] RESOLVE_EFFECT: Processing ${F.effect.type} from ${F.sourceCard.name}. Remaining: ${fe.length}`);const ie=((s=e.payload)==null?void 0:s.targetId)||F.targetId;let y=iw(n,F.sourcePlayerId,F.sourceCard,F.effect,ie,F.targetIds);const C=(y.pendingEffects||[]).filter(v=>{var T;return!((T=n.pendingEffects)!=null&&T.includes(v))}),x=[...fe,...C];return console.log(`[Engine] RESOLVE_EFFECT done. Remaining: ${fe.length}, NewlyAdded: ${C.length}, Final: ${x.length}`),x.length===0&&Object.values(y.players).forEach(v=>{v.board=v.board.filter(Boolean)}),{...y,pendingEffects:x}}case"PLAY_CARD":{if(!e.isRemote&&n.activePlayerId!==e.playerId)return n;const{cardIndex:F,targetId:fe,instanceId:ie}=e.payload,y={...n.players.p1,hand:[...n.players.p1.hand],deck:[...n.players.p1.deck],board:[...n.players.p1.board],graveyard:[...n.players.p1.graveyard]},C={...n.players.p2,hand:[...n.players.p2.hand],deck:[...n.players.p2.deck],board:[...n.players.p2.board],graveyard:[...n.players.p2.graveyard]},x=e.playerId==="p1"?y:C;console.log(`[Engine] PLAY_CARD: playerId=${e.playerId}, cardIndex=${F}, instanceId=${ie}, handLength=${x.hand.length}, isRemote=${e.isRemote}`),console.log("[Engine] PLAY_CARD: hand cards:",x.hand.map(Z=>`${Z.name}(${Z.instanceId})`));let v=F;if(ie){const Z=x.hand.findIndex(V=>V.instanceId===ie);if(Z>=0)v=Z,console.log(`[Engine] PLAY_CARD: Using instanceId ${ie}, found at index ${Z} (was ${F})`);else return console.log(`[Engine] PLAY_CARD: instanceId ${ie} not found in hand!`),n}if(v<0||v>=x.hand.length)return console.log("[Engine] PLAY_CARD: Invalid cardIndex! Returning unchanged state."),n;const T=x.hand[v];let w="";if(fe){const V=(e.playerId==="p1"?C:y).board.find(Le=>(Le==null?void 0:Le.instanceId)===fe);V&&(w=` (: ${V.name})`)}if(n.logs.push(`${x.name}  ${T.name} ${w}`),x.pp<T.cost)return n;const O=x.board.filter(Z=>Z!==null).length;if(T.type==="FOLLOWER"&&O>=5)return n;const q=x.pp;x.pp-=T.cost,x.extraPpActive&&q-1<T.cost&&(x.id!==t.firstPlayerId&&(n.turnCount<=5?x.extraPpUsedEarly=!0:x.extraPpUsedLate=!0),x.extraPpActive=!1,x.pp<0&&(x.pp=0),console.log("[Engine] PLAY_CARD: Extra PP consumed, marked as used"),n.logs.push(`${x.name} PP`)),x.hand.splice(v,1);let j=T;if(T.type==="FOLLOWER"){const Z={...T,instanceId:e.payload.instanceId||`inst_${n.rngSeed}_${Math.floor(r()*1e3)}`,currentAttack:T.attack||0,currentHealth:T.health||0,maxHealth:T.health||0,canAttack:!1,hasEvolved:!1,attacksMade:0,turnPlayed:n.turnCount,hasBarrier:((i=T.passiveAbilities)==null?void 0:i.includes("BARRIER"))??!1,passiveAbilities:T.passiveAbilities?[...T.passiveAbilities]:[],hadStealth:((o=T.passiveAbilities)==null?void 0:o.includes("STEALTH"))??!1};((a=T.passiveAbilities)!=null&&a.includes("STORM")||(c=T.passiveAbilities)!=null&&c.includes("RUSH"))&&(Z.canAttack=!0),(u=Z.tags)!=null&&u.includes("Knuckler")&&!Z.passiveAbilities.includes("STORM")&&x.board.some(Le=>(Le==null?void 0:Le.name)==="")&&(Z.passiveAbilities.push("STORM"),Z.canAttack=!0,n.logs.push(`${Z.name}   `)),x.board.push(Z),j=Z,Z.name===""&&x.board.forEach(V=>{var Le,be;V&&((Le=V.tags)!=null&&Le.includes("Knuckler"))&&V.instanceId!==Z.instanceId&&((be=V.passiveAbilities)!=null&&be.includes("STORM")||(V.passiveAbilities||(V.passiveAbilities=[]),V.passiveAbilities.push("STORM"),V.canAttack=!0,n.logs.push(`${V.name}   `)))})}else x.graveyard.push({...T,instanceId:`spell_${n.rngSeed}_${Math.floor(r()*1e3)}`});const ye=[];(p=T.triggers)==null||p.filter(Z=>Z.trigger==="FANFARE").forEach(Z=>ye.push(...Z.effects)),(h=T.triggerAbilities)!=null&&h.FANFARE&&ye.push(T.triggerAbilities.FANFARE);let Ae=[...n.pendingEffects||[]];return ye.forEach(Z=>{if(Z.conditions&&Z.conditions.minTurn&&n.turnCount<Z.conditions.minTurn)return;let V;if(Z.targetType==="OPPONENT"||Z.targetType==="SELF"||Z.targetType==="ALL_FOLLOWERS"||Z.targetType==="ALL_OTHER_FOLLOWERS"||Z.type==="RANDOM_DESTROY"||Z.type==="RANDOM_SET_HP"||Z.type==="AOE_DAMAGE"||Z.type==="RANDOM_DAMAGE"||Z.type==="RANDOM_DAMAGE_BY_TURN"){const be=e.playerId==="p1"?"p2":"p1",Xe=e.playerId;if(Z.type==="RANDOM_DAMAGE_BY_TURN"){const Se=Z.targetType==="SELF"?Xe:be,De=n.players[Se].board,vt=n.turnCount;V=[];for(let $e=0;$e<vt;$e++){const pt=De.map((ot,it)=>ot?it:-1).filter(ot=>ot!==-1);if(pt.length===0)break;const Qe=Math.floor(r()*pt.length);V.push(De[pt[Qe]].instanceId)}}else if(Z.type==="RANDOM_DESTROY"||Z.type==="RANDOM_SET_HP"||Z.type==="RANDOM_DAMAGE"){const Se=Z.targetType==="SELF"?Xe:be,De=n.players[Se].board,vt=Z.type==="RANDOM_DAMAGE"?Z.value2||1:Z.value||1,$e=De.map((Qe,ot)=>Qe?ot:-1).filter(Qe=>Qe!==-1);for(let Qe=$e.length-1;Qe>0;Qe--){const ot=Math.floor(r()*(Qe+1));[$e[Qe],$e[ot]]=[$e[ot],$e[Qe]]}V=$e.slice(0,vt).map(Qe=>De[Qe].instanceId)}else if(Z.targetType==="ALL_FOLLOWERS"||Z.type==="AOE_DAMAGE"){const Se=Z.type==="GRANT_PASSIVE"||Z.type==="BUFF_STATS",De=Se?Xe:be;V=n.players[De].board.filter($e=>$e!==null).map($e=>$e.instanceId),console.log(`[Engine] Pre-calculated ALL_FOLLOWERS targets (${Se?"ally":"enemy"}): ${V.length} units`)}else Z.targetType==="ALL_OTHER_FOLLOWERS"&&(V=n.players[Xe].board.filter(De=>De!==null&&De.instanceId!==j.instanceId).map(De=>De.instanceId))}const Le=Z.targetType==="SELECT_FOLLOWER"||Z.targetType==="SELECT_ALLY_FOLLOWER"||Z.targetType==="SELECT_OTHER_ALLY_FOLLOWER";Ae.push({sourceCard:j,effect:Z,sourcePlayerId:e.playerId,targetId:Le?fe:void 0,targetIds:V})}),console.log(`[Engine] PLAY_CARD: Queued ${ye.length} effects. Total pending: ${Ae.length}`),{...n,players:{p1:y,p2:C},pendingEffects:Ae}}case"EVOLVE":{const{followerIndex:F,targetId:fe,useSep:ie}=e.payload,y={...n.players.p1,hand:[...n.players.p1.hand],deck:[...n.players.p1.deck],board:n.players.p1.board.map(j=>j?{...j,passiveAbilities:j.passiveAbilities?[...j.passiveAbilities]:void 0}:null),graveyard:[...n.players.p1.graveyard]},C={...n.players.p2,hand:[...n.players.p2.hand],deck:[...n.players.p2.deck],board:n.players.p2.board.map(j=>j?{...j,passiveAbilities:j.passiveAbilities?[...j.passiveAbilities]:void 0}:null),graveyard:[...n.players.p2.graveyard]},x=e.playerId==="p1"?y:C,v=x.board[F];if(!v||v.hasEvolved)return n;const T=e.isRemote;if(console.log(`[Engine] EVOLVE Logic: name=${v.name}, useSep=${ie}, isRemote=${T}, turn=${t.turnCount}`),n.logs.push(`${x.name}  ${v.name} ${ie?"":""}`),ie){if(!T){if(t.turnCount<6)return console.log(`[Engine] Cannot Super Evolve: Turn ${t.turnCount} < 6`),n;if(x.sep<=0)return console.log("[Engine] Cannot Super Evolve: No SEP"),n;if(!x.canEvolveThisTurn)return console.log("[Engine] Cannot Super Evolve: Already evolved this turn"),n}x.sep=Math.max(0,x.sep-1),x.canEvolveThisTurn=!1,v.hasEvolved=!0,v.currentAttack+=3,v.currentHealth+=3,v.maxHealth+=3,v.canAttack=!0;const j=[...v.passiveAbilities||[]];j.includes("IMMUNE_TO_DAMAGE_MY_TURN")||j.push("IMMUNE_TO_DAMAGE_MY_TURN"),!j.includes("STORM")&&!j.includes("RUSH")&&j.push("RUSH"),v.passiveAbilities=j,console.log(`[Engine] Super Evolved ${v.name}! SEP remaining: ${x.sep}`)}else{if(!T){const Ae=e.playerId===t.firstPlayerId?5:4;if(t.turnCount<Ae)return console.log(`[Engine] Cannot Evolve: Turn ${t.turnCount} < ${Ae}`),n;if(x.evolutionsUsed>=2)return console.log("[Engine] Cannot Evolve: Limit reached"),n;if(!x.canEvolveThisTurn)return console.log("[Engine] Cannot Evolve: Already evolved this turn"),n}x.evolutionsUsed+=1,x.canEvolveThisTurn=!1,v.hasEvolved=!0,v.currentAttack+=2,v.currentHealth+=2,v.maxHealth+=2,v.canAttack=!0;const j=[...v.passiveAbilities||[]];!j.includes("STORM")&&!j.includes("RUSH")&&j.push("RUSH"),v.passiveAbilities=j}const w=[];(f=v.triggers)==null||f.filter(j=>j.trigger==="EVOLVE").forEach(j=>w.push(...j.effects)),(m=v.triggerAbilities)!=null&&m.EVOLVE&&w.push(v.triggerAbilities.EVOLVE),ie&&((b=v.triggers)==null||b.filter(j=>j.trigger==="SUPER_EVOLVE").forEach(j=>w.push(...j.effects)));let O=[...n.pendingEffects||[]];return w.forEach(j=>{if(j.conditions&&j.conditions.minTurn&&n.turnCount<j.conditions.minTurn)return;let ye;const Ae=e.playerId==="p1"?"p2":"p1",we=e.playerId;if(j.type==="RANDOM_DESTROY"||j.type==="RANDOM_SET_HP"||j.type==="RANDOM_DAMAGE"){const Z=j.targetType==="SELF"?we:Ae,V=n.players[Z].board,Le=j.type==="RANDOM_DAMAGE"?j.value2||1:j.value||1,be=V.map((Se,De)=>Se?De:-1).filter(Se=>Se!==-1);for(let Se=be.length-1;Se>0;Se--){const De=Math.floor(r()*(Se+1));[be[Se],be[De]]=[be[De],be[Se]]}ye=be.slice(0,Le).map(Se=>V[Se].instanceId)}else j.targetType==="ALL_FOLLOWERS"||j.type==="AOE_DAMAGE"?(ye=n.players[Ae].board.filter(V=>V!==null).map(V=>V.instanceId),console.log(`[Engine EVOLVE] Pre-calculated ALL_FOLLOWERS targets: ${ye.length} units`)):j.targetType==="ALL_OTHER_FOLLOWERS"&&(ye=n.players[we].board.filter(V=>V!==null&&V.instanceId!==v.instanceId).map(V=>V.instanceId));O.push({sourceCard:v,effect:j,sourcePlayerId:e.playerId,targetId:fe,targetIds:ye})}),console.log(`[Engine] EVOLVE: Queued ${w.length} effects. Total pending: ${O.length}`),{...n,players:{p1:y,p2:C},pendingEffects:O}}case"ATTACK":{console.log(`[Engine] ATTACK received. Incoming state P1 HP: ${t.players.p1.hp}, P2 HP: ${t.players.p2.hp}`);const{attackerIndex:F,targetIndex:fe,targetIsLeader:ie}=e.payload,y={...n.players.p1,board:n.players.p1.board.map(V=>V?{...V,passiveAbilities:V.passiveAbilities?[...V.passiveAbilities]:void 0}:null),graveyard:[...n.players.p1.graveyard]},C={...n.players.p2,board:n.players.p2.board.map(V=>V?{...V,passiveAbilities:V.passiveAbilities?[...V.passiveAbilities]:void 0}:null),graveyard:[...n.players.p2.graveyard]},x=e.playerId==="p1",v=x?y:C,T=x?C:y,w=v.board[F];if(!w||!w.canAttack)return n;const O=T.board.filter(V=>{var Le,be;return V&&((Le=V.passiveAbilities)==null?void 0:Le.includes("WARD"))&&!((be=V.passiveAbilities)!=null&&be.includes("STEALTH"))}),q=((R=w.passiveAbilities)==null?void 0:R.includes("STEALTH"))||w.hadStealth;if(O.length>0&&!q){if(ie)return console.log("[Engine] Attack blocked: Must attack Ward unit first."),n;const V=T.board[fe];if(V&&!((W=V.passiveAbilities)!=null&&W.includes("WARD")))return console.log("[Engine] Attack blocked: Must attack Ward unit first."),n}if(ie===!1){const V=T.board[fe];if(V&&((d=V.passiveAbilities)!=null&&d.includes("STEALTH")))return console.log("[Engine] ATTACK blocked: Target has STEALTH"),n}const j=(I=w.passiveAbilities)==null?void 0:I.includes("RUSH"),ye=(S=w.passiveAbilities)==null?void 0:S.includes("STORM");if(j&&!ye&&ie&&w.turnPlayed===n.turnCount)return console.log("[Engine] ATTACK blocked: RUSH unit cannot attack leader on the turn it was played"),n;(k=w.passiveAbilities)!=null&&k.includes("STEALTH")&&(w.passiveAbilities=w.passiveAbilities.filter(V=>V!=="STEALTH"),n.logs.push(`${w.name} `)),w.canAttack=!1,w.attacksMade=(w.attacksMade||0)+1,($=w.passiveAbilities)!=null&&$.includes("DOUBLE_ATTACK")&&w.attacksMade<2&&(w.canAttack=!0);const Ae=w.currentAttack;console.log(`[Engine] Attack: ${w.name} (${Ae}) -> Target (Leader? ${ie}). DefHP before: ${T.hp}`);const we=(V,Le)=>{var Xe;const be=(Xe=V.triggers)==null?void 0:Xe.find(Se=>Se.trigger==="LAST_WORD");if(be){const Se=be.effects.map(De=>({sourceCard:V,effect:De,sourcePlayerId:Le}));n.pendingEffects=[...n.pendingEffects||[],...Se],n.logs.push(`${V.name} `),console.log(`[Engine] Last Word triggered for ${V.name}. pendingEffects count: ${n.pendingEffects.length}`)}};if(ie){const V="";if(n.logs.push(`${w.name}  ${V} `),T.leaderDamageShield)T.leaderDamageShield=!1,n.logs.push(`${w.name}  ${V}  ${Ae} `);else{const Le=T.board.some(Xe=>{var Se;return(Se=Xe==null?void 0:Xe.passiveAbilities)==null?void 0:Se.includes("LEADER_DAMAGE_CAP")}),be=Le?Math.min(Ae,1):Ae;T.hp-=be,Le&&Ae>1?n.logs.push(`${w.name}  ${V}  ${Ae} 1`):n.logs.push(`${w.name}  ${V}  ${be} `),T.hp<=0&&(n.winnerId=e.playerId)}}else{const V=T.board[fe];if(!V)return console.log(`[Engine] Attack target at index ${fe} no longer exists. Skipping.`),n;n.logs.push(`${w.name}  ${V.name} `);let Le=Ae;(B=V.passiveAbilities)!=null&&B.includes("IMMUNE_TO_FOLLOWER_DAMAGE")?(Le=0,n.logs.push(`${V.name} `)):V.hasBarrier&&Le>0?(Le=0,V.hasBarrier=!1,n.logs.push(`${V.name} `)):n.logs.push(`${w.name}  ${V.name}  ${Le} `),V.currentHealth-=Le;const be=x?"p2":"p1",Xe=((te=V.passiveAbilities)==null?void 0:te.includes("IMMUNE_TO_DAMAGE_MY_TURN"))&&n.activePlayerId===be;(J=w.passiveAbilities)!=null&&J.includes("BANE")&&V.currentHealth>0&&(Xe?n.logs.push(`${V.name} `):(V.currentHealth=0,V.killedByBane=!0,n.logs.push(`${w.name}  ${V.name} `)));let Se=V.currentAttack;(me=w.passiveAbilities)!=null&&me.includes("IMMUNE_TO_DAMAGE_MY_TURN")&&(Se=0,n.logs.push(`${w.name} `)),w.hasBarrier&&Se>0?(Se=0,w.hasBarrier=!1,n.logs.push(`${w.name} `)):Se>0&&n.logs.push(`${V.name}  ${w.name}  ${Se} `),w.currentHealth-=Se;const De=x?"p1":"p2";w.currentHealth<=0&&((he=w.passiveAbilities)!=null&&he.includes("GUTS_MY_TURN"))&&n.activePlayerId===De&&(w.currentHealth=1,n.logs.push(`${w.name} 1`));const vt=((ke=w.passiveAbilities)==null?void 0:ke.includes("IMMUNE_TO_DAMAGE_MY_TURN"))&&n.activePlayerId===De;(L=V.passiveAbilities)!=null&&L.includes("BANE")&&w.currentHealth>0&&(vt?n.logs.push(`${w.name} `):(w.currentHealth=0,w.killedByBane=!0,n.logs.push(`${V.name}  ${w.name} `)));const $e=V.currentHealth<=0,pt=w.currentHealth<=0;$e&&(V.currentHealth=Math.min(0,V.currentHealth),T.graveyard.push(V),T.board[fe]=null,n.logs.push(`${V.name} `)),pt&&(w.currentHealth=Math.min(0,w.currentHealth),v.graveyard.push(w),v.board[F]=null,n.logs.push(`${w.name} `)),$e&&we(V,x?"p2":"p1"),pt&&we(w,x?"p1":"p2")}console.log(`[Engine] Committing state. P1 HP: ${y.hp}, P2 HP: ${C.hp}`);const Z={...n,players:{p1:y,p2:C}};return console.log(`[Engine] After commit. finalState.players.p1.hp: ${Z.players.p1.hp}, finalState.players.p2.hp: ${Z.players.p2.hp}`),Z}case"REINIT_GAME":{const{p1Class:F,p2Class:fe}=e.payload;return console.log(`[Engine] REINIT_GAME: p1=${F}, p2=${fe}`),uc("Player 1",F,"Player 2",fe)}case"SYNC_STATE":return console.log("[Engine] SYNC_STATE received"),e.payload;case"UPDATE_PLAYER_NAME":{const{playerId:F,name:fe}=e.payload;return console.log("[Engine] UPDATE_PLAYER_NAME:",F,fe),t.players[F]?{...t,players:{...t.players,[F]:{...t.players[F],name:fe}}}:(console.warn("[Engine] UPDATE_PLAYER_NAME: Unknown playerId:",F),t)}case"TOGGLE_EXTRA_PP":{const F=e.playerId,fe=n.players[F];if(!(F!==t.firstPlayerId))return console.log("[Engine] TOGGLE_EXTRA_PP: Only second player can use Extra PP"),t;if(t.activePlayerId!==F)return console.log("[Engine] TOGGLE_EXTRA_PP: Can only toggle on your turn"),t;if(fe.extraPpActive)return fe.extraPpActive=!1,fe.pp=Math.max(0,fe.pp-1),console.log("[Engine] TOGGLE_EXTRA_PP: Deactivated, PP now",fe.pp),n;if(n.turnCount<=5){if(fe.extraPpUsedEarly)return console.log("[Engine] TOGGLE_EXTRA_PP: Already used in early turns"),t}else if(fe.extraPpUsedLate)return console.log("[Engine] TOGGLE_EXTRA_PP: Already used in late turns"),t;return fe.extraPpActive=!0,fe.pp+=1,console.log("[Engine] TOGGLE_EXTRA_PP: Activated, PP now",fe.pp),n}default:return t}},cw=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},xi=({card:t,onClick:e,style:n,isSelected:r,isPlayable:s,variant:i="normal",turnCount:o,isOnBoard:a,isSpecialSummoning:c,className:u,suppressPassives:p,isMyTurn:h,scale:f=1})=>{const m="currentAttack"in t?t.currentAttack:t.attack,b="currentHealth"in t?t.currentHealth:t.health,R="maxHealth"in t?t.maxHealth:t.health,W="canAttack"in t?t.canAttack:!1,d="turnPlayed"in t?t.turnPlayed:void 0,[I,S]=D.useState(!1);D.useEffect(()=>{if(c&&a){S(!0);const O=setTimeout(()=>S(!1),800);return()=>clearTimeout(O)}},[c,a]);const k="baseAttack"in t?t.baseAttack:void 0,$="baseHealth"in t?t.baseHealth:void 0,B=k!==void 0&&m>k,te=$!==void 0&&(b>$||R>$),J="hasEvolved"in t?t.hasEvolved:!1,me="evolvedImageUrl"in t?t.evolvedImageUrl:void 0,he=J&&me?me:t.imageUrl,ke=he?cw(he):void 0;let L=n==null?void 0:n.boxShadow,F;const fe=t.passiveAbilities||t.abilities||[],ie=fe.includes("WARD"),y=fe.includes("AURA"),C=fe.includes("STEALTH"),x=t.hasBarrier===!0||fe.includes("BARRIER")&&t.hasBarrier!==!1;if(r)L="0 0 15px rgba(255, 255, 255, 0.8)";else if(s)L="0 0 10px #48bb78",F="2px solid #48bb78";else if(W&&h){const O=fe.includes("STORM"),q=fe.includes("RUSH"),j=o!==void 0&&d!==void 0&&d===o;let ye=!1;O||(j?ye=!0:(o===void 0||d===void 0)&&(ye=q)),ye?L="0 0 10px #f6e05e":L="0 0 10px #48bb78"}const v=b<R;if(i==="art-only")return l.jsx("div",{className:"card art-only",style:{width:140,height:200,...n,borderRadius:8,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",background:"#2d3748",position:"relative",boxShadow:"0 4px 6px rgba(0,0,0,0.3)"},children:ke?l.jsx("img",{src:ke,alt:t.name,draggable:!1,style:{width:"100%",height:"100%",objectFit:"cover"}}):l.jsx("div",{style:{fontSize:"1.5rem",opacity:.5,color:"white",fontWeight:"bold"},children:t.type})});if(i==="mobile-hand"){const q=t.type==="SPELL"?16:6,j=28*f,ye=.85*f;return l.jsxs("div",{className:`card mobile-hand ${u||""}`,style:{width:80,height:115,...n,position:"relative",cursor:e?"pointer":"default",transform:r?"translateY(-8px)":n==null?void 0:n.transform,boxShadow:L||(n==null?void 0:n.boxShadow),border:F||(s?"2px solid #48bb78":void 0),transition:"transform 0.2s, box-shadow 0.2s",background:"#1a202c",overflow:"hidden",borderRadius:`${q}px ${q}px 6px 6px`,backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},onClick:e,children:[l.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"hidden",borderRadius:`${q}px ${q}px 6px 6px`},children:ke?l.jsx("img",{src:ke,alt:t.name,draggable:!1,style:{width:"100%",height:"100%",objectFit:"cover"}}):l.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"#4a5568",color:"#a0aec0",fontSize:"0.6rem"},children:t.type})}),l.jsxs("div",{style:{position:"absolute",top:3,left:4,display:"flex",flexDirection:"column",gap:2,zIndex:10},children:[l.jsx("div",{style:{width:j,height:j,borderRadius:"50%",background:"#48bb78",border:"1px solid rgba(255,255,255,0.8)",color:"white",fontSize:`${ye}rem`,fontWeight:900,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.6)"},children:t.cost}),t.type==="FOLLOWER"&&l.jsxs("div",{style:{width:j,height:j,display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[l.jsx("svg",{width:j,height:j,viewBox:"0 0 24 24",fill:"none",style:{position:"absolute",filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.8))"},children:l.jsx("polygon",{points:"12,2 22,22 2,22",fill:"#4299e1",stroke:"rgba(255,255,255,0.8)",strokeWidth:"1",strokeLinejoin:"round"})}),l.jsx("span",{style:{zIndex:1,color:B?"#faf089":"white",fontWeight:"bold",fontSize:`${ye}rem`,textShadow:"0 1px 2px black"},children:m})]}),t.type==="FOLLOWER"&&l.jsxs("div",{style:{width:j,height:j,display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[l.jsx("svg",{width:j,height:j,viewBox:"0 0 24 24",style:{position:"absolute",filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.8))"},children:l.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z",fill:"#c53030",stroke:"rgba(255,255,255,0.8)",strokeWidth:"1"})}),l.jsx("span",{style:{zIndex:1,color:te?"#faf089":v?"#fc8181":"white",fontWeight:"bold",fontSize:`${ye}rem`,textShadow:"0 1px 2px black"},children:b})]})]})]})}const T=t.type==="SPELL"&&!a,w=T?20:8;return l.jsxs("div",{className:`card card-container ${W?"ready":""} ${a?"on-board":""} ${u||""}`,style:{width:140,height:200,...n,position:"relative",cursor:e?"pointer":"default",transform:r?"translateY(-10px)":n==null?void 0:n.transform,boxShadow:L||(W?"0 0 10px #f6e05e":n==null?void 0:n.boxShadow),border:F||(s?"2px solid #48bb78":void 0),transition:"transform 0.2s, box-shadow 0.2s",display:"flex",flexDirection:"column",background:"#1a202c",overflow:"visible",animation:I?"cardSummonAppear 0.8s cubic-bezier(0.22, 1, 0.36, 1) forwards":n==null?void 0:n.animation,backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",borderRadius:T?`${w}px ${w}px 8px 8px`:"8px"},onClick:e,children:[!a&&l.jsx("div",{style:{height:20,background:"rgba(0,0,0,0.8)",color:"#e2e8f0",fontSize:t.name.length>10?"0.6rem":"0.7rem",fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid rgba(255,255,255,0.2)",zIndex:2,transform:t.name.length>15?"scaleX(0.9)":"none",borderRadius:T?`${w}px ${w}px 0 0`:"8px 8px 0 0"},children:t.name}),l.jsxs("div",{style:{flex:1,position:"relative",width:"100%",background:"#2d3748",borderRadius:a?"8px":"0 0 8px 8px",minHeight:0},children:[l.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"hidden",borderRadius:a?"8px":"0 0 8px 8px",zIndex:1},children:[ke?l.jsx("img",{src:ke,alt:t.name,draggable:!1,style:{width:"100%",height:"100%",objectFit:"cover",display:"block"}}):l.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"#4a5568",color:"#a0aec0",fontSize:"0.8rem"},children:t.type}),l.jsx("div",{style:{position:"absolute",bottom:0,left:0,width:"100%",height:40,background:"linear-gradient(to top, rgba(0,0,0,0.8), transparent)",pointerEvents:"none",zIndex:3}})]}),!a&&l.jsx("div",{style:{position:"absolute",top:2*f,left:2*f,width:24*f,height:24*f,borderRadius:"50%",background:"#48bb78",border:`${Math.max(1,2*f)}px solid #fff`,color:"white",fontSize:`${.9*f}rem`,fontWeight:900,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 2px 4px rgba(0,0,0,0.5), inset 0 2px 5px rgba(255,255,255,0.3)",zIndex:10},children:t.cost}),t.type==="FOLLOWER"&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{style:{position:"absolute",bottom:a?2*f:40*f,left:2*f,width:32*f,height:32*f,zIndex:10,display:"flex",alignItems:"center",justifyContent:"center"},children:[l.jsxs("svg",{width:40*f,height:40*f,viewBox:"0 0 24 24",fill:"none",style:{position:"absolute",filter:"drop-shadow(0 2px 2px rgba(0,0,0,0.8))"},children:[l.jsx("defs",{children:l.jsxs("linearGradient",{id:"blueGrad",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[l.jsx("stop",{offset:"0%",stopColor:"#63b3ed"}),l.jsx("stop",{offset:"100%",stopColor:"#4299e1"})]})}),l.jsx("polygon",{points:"12,2 22,22 2,22",fill:"url(#blueGrad)",stroke:"white",strokeWidth:"1",strokeLinejoin:"round"})]}),l.jsx("span",{style:{zIndex:11,color:B?"#faf089":"white",fontWeight:"bold",fontSize:`${1.2*f}rem`,textShadow:"0 2px 2px black"},children:m})]}),l.jsxs("div",{style:{position:"absolute",bottom:2*f,right:a?2*f:"auto",left:a?"auto":2*f,width:32*f,height:32*f,zIndex:10,display:"flex",alignItems:"center",justifyContent:"center"},children:[l.jsxs("svg",{width:36*f,height:36*f,viewBox:"0 0 24 24",style:{position:"absolute",filter:"drop-shadow(0 2px 2px rgba(0,0,0,0.8))"},children:[l.jsx("defs",{children:l.jsxs("linearGradient",{id:"redGrad",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[l.jsx("stop",{offset:"0%",stopColor:"#f56565"}),l.jsx("stop",{offset:"100%",stopColor:"#c53030"})]})}),l.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z",fill:"url(#redGrad)",stroke:"white",strokeWidth:"1.5"})]}),l.jsx("span",{style:{zIndex:11,color:te?"#faf089":v?"#fc8181":"white",fontWeight:"bold",fontSize:`${1.2*f}rem`,textShadow:"0 2px 2px black"},children:b})]})]}),a&&l.jsx("div",{style:{position:"absolute",top:-6*f,left:-6*f,right:-6*f,bottom:-6*f,zIndex:50,pointerEvents:"none",opacity:ie&&!p?1:0,transition:"opacity 0.2s ease-in-out"},children:l.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,animation:"wardPulseLoop 2.5s infinite ease-in-out"},children:l.jsxs("svg",{viewBox:"0 0 100 120",preserveAspectRatio:"none",style:{width:"100%",height:"100%"},children:[l.jsx("defs",{children:l.jsxs("filter",{id:"wardGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[l.jsx("feGaussianBlur",{stdDeviation:"2",result:"blur"}),l.jsxs("feMerge",{children:[l.jsx("feMergeNode",{in:"blur"}),l.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),l.jsx("path",{d:"M50 2 L96 20 V60 C96 90 50 116 50 116 C50 116 4 90 4 60 V20 Z",fill:"rgba(255, 255, 255, 0.12)",stroke:"#ECC94B",strokeWidth:"3",filter:"url(#wardGlow)"})]})})}),a&&l.jsxs("div",{style:{position:"absolute",top:-5*f,left:-5*f,right:-5*f,bottom:-5*f,zIndex:21,pointerEvents:"none",opacity:x&&!I&&!p?1:0,transition:"opacity 0.2s ease-in-out"},children:[l.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,borderRadius:"50%",background:"radial-gradient(ellipse at center, rgba(99, 179, 237, 0.12) 0%, transparent 60%)",animation:"barrierGlowLoop 3s infinite ease-in-out"}}),l.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,borderRadius:"50%",border:`${Math.max(1.5,2*f)}px solid rgba(99, 179, 237, 0.9)`,boxShadow:"0 0 6px rgba(66, 153, 225, 0.5), inset 0 0 8px rgba(99, 179, 237, 0.15)",animation:"barrierPulseLoop 3s infinite ease-in-out"}})]}),a&&l.jsx("div",{style:{position:"absolute",top:-6*f,left:-6*f,right:-6*f,bottom:-6*f,zIndex:22,pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center",opacity:y&&!I&&!p?1:0,transition:"opacity 0.2s ease-in-out"},children:l.jsx("div",{style:{width:"100%",height:"100%",position:"relative",animation:"auraPulseLoop 3s infinite ease-in-out"},children:l.jsxs("svg",{viewBox:"0 0 100 100",style:{width:"100%",height:"100%"},children:[l.jsx("defs",{children:l.jsxs("filter",{id:"auraGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[l.jsx("feGaussianBlur",{stdDeviation:"1.5",result:"blur"}),l.jsxs("feMerge",{children:[l.jsx("feMergeNode",{in:"blur"}),l.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),l.jsx("path",{d:"M40 5 L60 5 L60 30 L95 30 L95 45 L60 45 L60 95 L40 95 L40 45 L5 45 L5 30 L40 30 Z",fill:"rgba(255, 204, 0, 0.2)",stroke:"#f6ad55",strokeWidth:"2.5",filter:"url(#auraGlow)"})]})})}),a&&l.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:13,pointerEvents:"none",overflow:"hidden",borderRadius:"0 0 8px 8px",opacity:C&&!I&&!p?1:0,transition:"opacity 0.2s ease-in-out"},children:[l.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:"120%",height:"120%",transform:"translate(-50%, -50%)",background:"radial-gradient(circle, rgba(0, 0, 0, 0.9) 0%, rgba(0, 0, 0, 0.6) 30%, rgba(0, 0, 0, 0.2) 60%, transparent 80%)",filter:"blur(10px)",animation:"stealthInkMove 3s infinite ease-in-out",mixBlendMode:"multiply"}}),l.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:"100%",height:"100%",transform:"translate(-50%, -50%)",background:"radial-gradient(circle, rgba(20, 20, 30, 0.85) 0%, rgba(10, 10, 20, 0.4) 40%, transparent 70%)",filter:"blur(8px)",animation:"stealthInkPulse 1.5s infinite ease-in-out",mixBlendMode:"multiply"}}),l.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:"70%",height:"70%",transform:"translate(-50%, -50%)",background:"radial-gradient(circle, rgba(255, 255, 255, 0.4) 0%, rgba(200, 200, 200, 0.25) 30%, transparent 60%)",filter:"blur(8px)",animation:"stealthMistMove 4s infinite ease-in-out",mixBlendMode:"screen"}}),l.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,boxShadow:"inset 0 0 30px rgba(0, 0, 0, 0.85), 0 0 20px rgba(0, 0, 0, 0.6)",animation:"stealthPulse 1.5s infinite ease-in-out"}})]})]}),I&&l.jsx("div",{style:{position:"absolute",inset:0,borderRadius:8,background:"radial-gradient(circle, rgba(255,255,255,0.8) 0%, transparent 70%)",mixBlendMode:"overlay",animation:"cardSummonFlash 0.8s ease-out forwards",pointerEvents:"none",zIndex:100}}),l.jsx("style",{children:`
                @keyframes cardSummonAppear {
                    0% { opacity: 0; transform: scale(1.5); filter: brightness(2) blur(4px); }
                    100% { opacity: 1; transform: scale(1); filter: brightness(1) blur(0px); }
                }
                @keyframes cardSummonFlash {
                    0% { opacity: 0.8; transform: scale(1.2); }
                    100% { opacity: 0; transform: scale(1); }
                }
                @keyframes wardPulseLoop {
                    0% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(255, 255, 255, 0.5)); }
                    50% { transform: scale(1.08); opacity: 0.5; filter: blur(3px) drop-shadow(0 0 15px rgba(255, 255, 255, 0.8)); }
                    100% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(255, 255, 255, 0.5)); }
                }
                @keyframes barrierPulseLoop {
                    0% { transform: scale(1); opacity: 1; box-shadow: 0 0 8px rgba(66, 153, 225, 0.6), inset 0 0 10px rgba(99, 179, 237, 0.2); }
                    50% { transform: scale(1.03); opacity: 0.85; box-shadow: 0 0 12px rgba(99, 179, 237, 0.8), inset 0 0 15px rgba(99, 179, 237, 0.3); }
                    100% { transform: scale(1); opacity: 1; box-shadow: 0 0 8px rgba(66, 153, 225, 0.6), inset 0 0 10px rgba(99, 179, 237, 0.2); }
                }
                @keyframes barrierGlowLoop {
                    0% { transform: scale(1); opacity: 0.6; }
                    50% { transform: scale(1.05); opacity: 0.4; }
                    100% { transform: scale(1); opacity: 0.6; }
                }
                @keyframes auraPulseLoop {
                    0% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(246, 173, 85, 0.5)); }
                    50% { transform: scale(1.12); opacity: 0.4; filter: blur(4px) drop-shadow(0 0 20px rgba(255, 204, 0, 0.8)); }
                    100% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(246, 173, 85, 0.5)); }
                }
                @keyframes stealthInkMove {
                    0%, 100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 0.7; }
                    25% { transform: translate(-45%, -55%) scale(1.15) rotate(3deg); opacity: 1; }
                    50% { transform: translate(-50%, -50%) scale(0.95) rotate(0deg); opacity: 0.5; }
                    75% { transform: translate(-55%, -45%) scale(1.1) rotate(-3deg); opacity: 0.9; }
                }
                @keyframes stealthInkPulse {
                    0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.8; }
                    50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.4; }
                }
                @keyframes stealthMistMove {
                    0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.5; }
                    25% { transform: translate(-48%, -52%) scale(1.1); opacity: 0.8; }
                    50% { transform: translate(-52%, -48%) scale(1.2); opacity: 0.3; }
                    75% { transform: translate(-50%, -50%) scale(0.9); opacity: 0.7; }
                }
                @keyframes stealthPulse {
                    0%, 100% { opacity: 0.6; box-shadow: inset 0 0 50px rgba(0, 0, 0, 0.9), 0 0 30px rgba(0, 0, 0, 0.7); }
                    50% { opacity: 1; box-shadow: inset 0 0 70px rgba(0, 0, 0, 1), 0 0 40px rgba(0, 0, 0, 0.9); }
                }
                /* 3D flip support - ensure all child elements inherit backface-visibility */
                .card, .card * {
                    backface-visibility: hidden !important;
                    -webkit-backface-visibility: hidden !important;
                }
            `})]})},uw=35e5;function nE(){const[t,e]=U.useState(()=>gy());return U.useEffect(()=>{const n=()=>{e(gy())};return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),t}function gy(){const t=window.innerWidth*window.devicePixelRatio,e=window.innerHeight*window.devicePixelRatio,n=t*e,r=n>uw;let s="HD";return n>8e6?s="4K":n>35e5?s="1440p":n>2e6&&(s="1080p"),{isHighRes:r,isLightMode:r,pixelCount:n,resolution:s}}function dw(t){return t?{glowShadow:(e,n)=>`0 0 ${10*n}px ${e}`,blurAmount:4,enableGlowPulse:!1,dropShadow:e=>`drop-shadow(0 0 ${10*e}px rgba(255,255,255,0.6))`}:{glowShadow:(e,n)=>`
            0 0 ${15*n}px ${e},
            0 0 ${30*n}px ${e}80,
            0 0 ${60*n}px ${e}50
        `,blurAmount:8,enableGlowPulse:!0,dropShadow:e=>`drop-shadow(0 0 ${20*e}px rgba(255,255,255,0.8)) drop-shadow(0 0 ${40*e}px rgba(255,255,255,0.6))`}}const dc=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},Hl=t=>dc(t==="YORUKA"?"/leaders/yoRuka_leader.png":t==="AJA"?"/leaders/azya_leader.png":"/leaders/senka_leader.png"),fw=dc("/assets/VS.png"),Wn=8,Zd=240,pw=({myPlayer:t,opponentPlayer:e,isFirstPlayer:n,onComplete:r,scale:s=1,onVsImpact:i,onCoinToss:o,onImpact:a,onOrbLand:c,onFadeInBoard:u,isMobile:p=!1})=>{const[h,f]=U.useState("fade-in"),[m,b]=U.useState(!1),{isLightMode:R}=nE(),W=dw(R),[d,I]=U.useState(1),[S,k]=U.useState(1),[$,B]=U.useState(0),[te,J]=U.useState(0),[me,he]=U.useState(1),[ke,L]=U.useState({myX:0,myY:0,opX:0,opY:0}),[F,fe]=U.useState(0),[ie,y]=U.useState(0),[C,x]=U.useState([]),v=U.useMemo(()=>{const V=window.innerWidth,Le=window.innerHeight,be=s,Xe=(p?280:340)*be,Se=V-Xe,De=Xe+Se/2,vt=De,$e=Le- -20*be-Zd*be/2,pt=De,Qe=-20*be+Zd*be/2;return{player:{x:vt,y:$e},opponent:{x:pt,y:Qe},leaderSize:Zd*be}},[p,s]),T=U.useMemo(()=>{const V=window.innerWidth,Le=window.innerHeight,be=V*.25,Xe=Le*.5,Se=V*.75,De=Le*.5;return{myX:be,myY:Xe,opX:Se,opY:De}},[]),w=R?`0 0 ${10*s}px rgba(103, 232, 249, 0.8)`:`0 0 ${15*s}px rgba(103, 232, 249, 1), 0 0 ${30*s}px rgba(34, 211, 238, 0.8), 0 0 ${60*s}px rgba(6, 182, 212, 0.5)`,O=R?`0 0 ${10*s}px rgba(249, 168, 212, 0.8)`:`0 0 ${15*s}px rgba(249, 168, 212, 1), 0 0 ${30*s}px rgba(244, 114, 182, 0.8), 0 0 ${60*s}px rgba(236, 72, 153, 0.5)`,q=W.enableGlowPulse?"glowPulse 2s ease-in-out infinite":"none";U.useEffect(()=>{const V={"fade-in":500,"leaders-enter":1200,nameplate:800,"vs-display":1500,"coin-toss":1500,"turn-order":1e3,"leader-to-orb":800,"orb-pause":1e3,"orb-fly":900,"leader-appear":600};if(h==="complete"){u==null||u();const Xe=setTimeout(()=>{r()},700);return()=>clearTimeout(Xe)}const Le={"fade-in":"leaders-enter","leaders-enter":"nameplate",nameplate:"vs-display","vs-display":"coin-toss","coin-toss":"turn-order","turn-order":"leader-to-orb","leader-to-orb":"orb-pause","orb-pause":"orb-fly","orb-fly":"leader-appear","leader-appear":"complete"},be=setTimeout(()=>{const Xe=Le[h];Xe&&f(Xe)},V[h]||1e3);return()=>clearTimeout(be)},[h,r,n]),U.useEffect(()=>{if(h==="vs-display"){const V=setTimeout(()=>{b(!0),i==null||i(),setTimeout(()=>b(!1),300)},800);return()=>clearTimeout(V)}},[h,i]),U.useEffect(()=>{h==="coin-toss"&&(o==null||o())},[h,o]),U.useEffect(()=>{if(h==="leaders-enter"){const V=setTimeout(()=>{a==null||a()},1e3);return()=>clearTimeout(V)}},[h,a]),U.useEffect(()=>{h==="nameplate"&&(a==null||a())},[h,a]),U.useEffect(()=>{if(h==="leader-to-orb"){const Le=Date.now();let be;const Xe=()=>{const Se=Date.now()-Le,De=Math.min(Se/800,1),vt=1-Math.pow(1-De,3);I(1-vt*.7),k(1-vt),B(vt*1.5),J(Math.min(vt*1.5,1)),De<1&&(be=requestAnimationFrame(Xe))};return L(T),be=requestAnimationFrame(Xe),()=>cancelAnimationFrame(be)}},[h,T]),U.useEffect(()=>{if(h==="orb-pause"){const Le=Date.now();let be;const Xe=()=>{const Se=Date.now()-Le,De=Math.min(Se/800,1);he(1-De),De<1&&(be=requestAnimationFrame(Xe))};return be=requestAnimationFrame(Xe),()=>cancelAnimationFrame(be)}},[h]),U.useEffect(()=>{if(h==="orb-fly"){const Le=Date.now();let be;const Xe=T.myX,Se=T.myY,De=T.opX,vt=T.opY,$e=v.player.x,pt=v.player.y,Qe=v.opponent.x,ot=v.opponent.y,it=()=>{const Tt=Date.now()-Le,at=Math.min(Tt/900,1),Ye=at*at*at,Mt=Xe-200*s,Ht=(Se+pt)/2+100*s,Cn=(1-Ye)*(1-Ye)*Xe+2*(1-Ye)*Ye*Mt+Ye*Ye*$e,zn=(1-Ye)*(1-Ye)*Se+2*(1-Ye)*Ye*Ht+Ye*Ye*pt,dr=De+200*s,Xa=(vt+ot)/2-100*s,Lu=(1-Ye)*(1-Ye)*De+2*(1-Ye)*Ye*dr+Ye*Ye*Qe,Qa=(1-Ye)*(1-Ye)*vt+2*(1-Ye)*Ye*Xa+Ye*Ye*ot;L({myX:Cn,myY:zn,opX:Lu,opY:Qa}),B(1.5-Ye*1),at<1&&(be=requestAnimationFrame(it))};return be=requestAnimationFrame(it),()=>cancelAnimationFrame(be)}},[h,T,v,s]),U.useEffect(()=>{if(h==="leader-appear"){const Le=Date.now();let be;c==null||c(),b(!0),setTimeout(()=>b(!1),300);const Xe=v.player.x,Se=v.player.y,De=v.opponent.x,vt=v.opponent.y,$e=24,pt=[];for(let it=0;it<$e;it++){const Tt=it/$e*360+(Math.random()-.5)*15;pt.push({id:it,x:Xe,y:Se,angle:Tt,dist:80+Math.random()*120,size:8+Math.random()*12,delay:Math.random()*.1,color:`hsl(${200+Math.random()*40}, 80%, ${60+Math.random()*20}%)`})}for(let it=0;it<$e;it++){const Tt=it/$e*360+(Math.random()-.5)*15;pt.push({id:$e+it,x:De,y:vt,angle:Tt,dist:80+Math.random()*120,size:8+Math.random()*12,delay:Math.random()*.1,color:`hsl(${0+Math.random()*30}, 80%, ${55+Math.random()*20}%)`})}x(pt);const Qe=setTimeout(()=>{x([])},800),ot=()=>{const it=Date.now()-Le,Tt=Math.min(it/600,1),at=1-Math.pow(1-Tt,3);J(1-at),fe(at),y(at),Tt<1&&(be=requestAnimationFrame(ot))};return be=requestAnimationFrame(ot),()=>{cancelAnimationFrame(be),clearTimeout(Qe)}}},[h,c,v]);const j=["fade-in","leaders-enter","nameplate","vs-display","coin-toss","turn-order","leader-to-orb","orb-pause","orb-fly","leader-appear","complete"].indexOf(h),ye=j>=3&&j<=9,Ae=j>=0&&j<=7,we=`polygon(0 0, ${50+Wn}% 0, ${50-Wn}% 100%, 0 100%)`,Z=`polygon(${50+Wn}% 0, 100% 0, 100% 100%, ${50-Wn}% 100%)`;return l.jsxs("div",{style:{position:"fixed",inset:0,background:j>=7?"transparent":"#0a0a0f",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",animation:m?"screenShake 0.3s ease-in-out":void 0,pointerEvents:j>=9?"none":"auto"},children:[l.jsx("div",{style:{position:"absolute",inset:0,background:"black",opacity:h==="fade-in"?1:0,transition:"opacity 0.5s ease-out",pointerEvents:"none",zIndex:1e4}}),Ae&&l.jsxs("div",{style:{opacity:me,transition:"opacity 0.3s"},children:[j>=0&&l.jsxs("div",{style:{position:"absolute",inset:0,clipPath:we,background:"linear-gradient(135deg, #0a1628 0%, #1a2a4a 50%, #0d1a30 100%)",transform:`translateX(${j>=1?"0":"-100%"})`,transition:"transform 1.2s cubic-bezier(0.22, 1, 0.36, 1)",zIndex:50,overflow:"hidden"},children:[l.jsx("div",{style:{position:"fixed",top:"50%",left:"25%",transform:"translate(-50%, -50%)",opacity:S},children:l.jsx("img",{src:Hl(t.class),alt:t.name,style:{height:"120vh",width:"auto",objectFit:"cover",objectPosition:t.class==="AJA"?"center top":"center",filter:"brightness(0.85) contrast(1.1)",transform:`scale(${d})`,transformOrigin:"center center"}})}),l.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(135deg, rgba(59, 130, 246, 0.3) 0%, transparent 60%)",pointerEvents:"none"}}),j>=2&&j<6&&l.jsx("div",{style:{position:"absolute",bottom:"12%",left:"15%",padding:`${16*s}px ${40*s}px`,background:"rgba(0,0,0,0.85)",borderRadius:8*s,borderLeft:"4px solid #3b82f6",animation:"nameplateSlideUp 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)",whiteSpace:"nowrap",boxShadow:"0 4px 30px rgba(59, 130, 246, 0.4)"},children:l.jsx("div",{style:{color:"white",fontSize:2.2*s+"rem",fontWeight:"bold",textShadow:"0 0 20px rgba(59, 130, 246, 0.8)"},children:t.name})}),j>=5&&j<6&&l.jsx("div",{style:{position:"absolute",top:"10%",left:"15%",padding:`${12*s}px ${32*s}px`,background:n?"rgba(239, 68, 68, 0.9)":"rgba(59, 130, 246, 0.9)",borderRadius:8*s,animation:"turnOrderFadeIn 1s ease-out",boxShadow:n?"0 0 30px rgba(239, 68, 68, 0.6)":"0 0 30px rgba(59, 130, 246, 0.6)"},children:l.jsx("div",{style:{color:"white",fontSize:1.8*s+"rem",fontWeight:"bold",letterSpacing:"0.1em"},children:n?"":""})})]}),j>=0&&l.jsxs("div",{style:{position:"absolute",inset:0,clipPath:Z,background:"linear-gradient(225deg, #280a0a 0%, #4a1a1a 50%, #300d0d 100%)",transform:`translateX(${j>=1?"0":"100%"})`,transition:"transform 1.2s cubic-bezier(0.22, 1, 0.36, 1)",zIndex:50,overflow:"hidden"},children:[l.jsx("div",{style:{position:"fixed",top:"50%",left:"75%",transform:"translate(-50%, -50%)",opacity:S},children:l.jsx("img",{src:Hl(e.class),alt:e.name,style:{height:"120vh",width:"auto",objectFit:"cover",objectPosition:e.class==="AJA"?"center top":"center",filter:"brightness(0.85) contrast(1.1)",transform:`scale(${d})`,transformOrigin:"center center"}})}),l.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(225deg, rgba(239, 68, 68, 0.3) 0%, transparent 60%)",pointerEvents:"none"}}),j>=2&&j<6&&l.jsx("div",{style:{position:"absolute",bottom:"12%",right:"15%",padding:`${16*s}px ${40*s}px`,background:"rgba(0,0,0,0.85)",borderRadius:8*s,borderRight:"4px solid #ef4444",animation:"nameplateSlideUp 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)",whiteSpace:"nowrap",boxShadow:"0 4px 30px rgba(239, 68, 68, 0.4)"},children:l.jsx("div",{style:{color:"white",fontSize:2.2*s+"rem",fontWeight:"bold",textShadow:"0 0 20px rgba(239, 68, 68, 0.8)"},children:e.name})}),j>=5&&j<6&&l.jsx("div",{style:{position:"absolute",top:"10%",right:"15%",padding:`${12*s}px ${32*s}px`,background:n?"rgba(59, 130, 246, 0.9)":"rgba(239, 68, 68, 0.9)",borderRadius:8*s,animation:"turnOrderFadeIn 1s ease-out",boxShadow:n?"0 0 30px rgba(59, 130, 246, 0.6)":"0 0 30px rgba(239, 68, 68, 0.6)"},children:l.jsx("div",{style:{color:"white",fontSize:1.8*s+"rem",fontWeight:"bold",letterSpacing:"0.1em"},children:n?"":""})})]}),j>=1&&l.jsxs(l.Fragment,{children:[l.jsx("div",{style:{position:"absolute",top:0,left:0,width:4*s,height:"100%",background:"linear-gradient(180deg, #67e8f9 0%, #22d3ee 30%, #06b6d4 50%, #22d3ee 70%, #67e8f9 100%)",boxShadow:w,zIndex:100,animation:q}}),l.jsx("div",{style:{position:"absolute",top:0,left:0,width:`calc(${50+Wn}% + ${2*s}px)`,height:4*s,background:"linear-gradient(90deg, #67e8f9 0%, #22d3ee 30%, #06b6d4 50%, #22d3ee 70%, #67e8f9 100%)",boxShadow:w,zIndex:100,animation:q}}),l.jsx("div",{style:{position:"absolute",bottom:0,left:0,width:`calc(${50-Wn}% + ${2*s}px)`,height:4*s,background:"linear-gradient(90deg, #67e8f9 0%, #22d3ee 30%, #06b6d4 50%, #22d3ee 70%, #67e8f9 100%)",boxShadow:w,zIndex:100,animation:q}}),l.jsxs("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:100,pointerEvents:"none",overflow:"visible"},children:[l.jsxs("defs",{children:[l.jsxs("linearGradient",{id:"cyanGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[l.jsx("stop",{offset:"0%",stopColor:"#67e8f9"}),l.jsx("stop",{offset:"30%",stopColor:"#22d3ee"}),l.jsx("stop",{offset:"50%",stopColor:"#06b6d4"}),l.jsx("stop",{offset:"70%",stopColor:"#22d3ee"}),l.jsx("stop",{offset:"100%",stopColor:"#67e8f9"})]}),l.jsxs("filter",{id:"cyanGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[l.jsx("feGaussianBlur",{stdDeviation:W.blurAmount,result:"blur"}),l.jsxs("feMerge",{children:[l.jsx("feMergeNode",{in:"blur"}),l.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),l.jsx("line",{x1:`${50+Wn-.2}%`,y1:"0",x2:`${50-Wn-.2}%`,y2:"100%",stroke:"url(#cyanGradient)",strokeWidth:4*s,filter:R?void 0:"url(#cyanGlow)",style:{animation:q}})]})]}),j>=1&&l.jsxs(l.Fragment,{children:[l.jsx("div",{style:{position:"absolute",top:0,right:0,width:4*s,height:"100%",background:"linear-gradient(180deg, #f9a8d4 0%, #f472b6 30%, #ec4899 50%, #f472b6 70%, #f9a8d4 100%)",boxShadow:O,zIndex:100,animation:q,animationDelay:"0.3s"}}),l.jsx("div",{style:{position:"absolute",top:0,right:0,width:`calc(${50-Wn}% + ${2*s}px)`,height:4*s,background:"linear-gradient(90deg, #f9a8d4 0%, #f472b6 30%, #ec4899 50%, #f472b6 70%, #f9a8d4 100%)",boxShadow:O,zIndex:100,animation:q,animationDelay:"0.3s"}}),l.jsx("div",{style:{position:"absolute",bottom:0,right:0,width:`calc(${50+Wn}% + ${2*s}px)`,height:4*s,background:"linear-gradient(90deg, #f9a8d4 0%, #f472b6 30%, #ec4899 50%, #f472b6 70%, #f9a8d4 100%)",boxShadow:O,zIndex:100,animation:q,animationDelay:"0.3s"}}),l.jsxs("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:100,pointerEvents:"none",overflow:"visible"},children:[l.jsxs("defs",{children:[l.jsxs("linearGradient",{id:"pinkGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[l.jsx("stop",{offset:"0%",stopColor:"#f9a8d4"}),l.jsx("stop",{offset:"30%",stopColor:"#f472b6"}),l.jsx("stop",{offset:"50%",stopColor:"#ec4899"}),l.jsx("stop",{offset:"70%",stopColor:"#f472b6"}),l.jsx("stop",{offset:"100%",stopColor:"#f9a8d4"})]}),l.jsxs("filter",{id:"pinkGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[l.jsx("feGaussianBlur",{stdDeviation:W.blurAmount,result:"blur"}),l.jsxs("feMerge",{children:[l.jsx("feMergeNode",{in:"blur"}),l.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),l.jsx("line",{x1:`${50+Wn+.2}%`,y1:"0",x2:`${50-Wn+.2}%`,y2:"100%",stroke:"url(#pinkGradient)",strokeWidth:4*s,filter:R?void 0:"url(#pinkGlow)",style:{animation:q,animationDelay:"0.3s"}})]})]})]}),j>=6&&j<=9&&l.jsxs(l.Fragment,{children:[l.jsx("div",{style:{position:"fixed",left:ke.myX,top:ke.myY,transform:`translate(-50%, -50%) scale(${$})`,opacity:te,width:150*s,height:150*s,borderRadius:"50%",background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(100,180,255,0.8) 40%, rgba(59,130,246,0.4) 70%, transparent 100%)",boxShadow:R?`0 0 ${30*s}px rgba(59, 130, 246, 0.8)`:`0 0 ${40*s}px rgba(255,255,255,0.9), 0 0 ${80*s}px rgba(59, 130, 246, 0.8), 0 0 ${120*s}px rgba(59, 130, 246, 0.5)`,zIndex:500,pointerEvents:"none"}}),l.jsx("div",{style:{position:"fixed",left:ke.opX,top:ke.opY,transform:`translate(-50%, -50%) scale(${$})`,opacity:te,width:150*s,height:150*s,borderRadius:"50%",background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(255,150,150,0.8) 40%, rgba(239,68,68,0.4) 70%, transparent 100%)",boxShadow:R?`0 0 ${30*s}px rgba(239, 68, 68, 0.8)`:`0 0 ${40*s}px rgba(255,255,255,0.9), 0 0 ${80*s}px rgba(239, 68, 68, 0.8), 0 0 ${120*s}px rgba(239, 68, 68, 0.5)`,zIndex:500,pointerEvents:"none"}})]}),j>=9&&l.jsxs(l.Fragment,{children:[l.jsx("div",{style:{position:"fixed",left:v.player.x,top:v.player.y,transform:`translate(-50%, -50%) scale(${F})`,opacity:ie,width:v.leaderSize,height:v.leaderSize,borderRadius:"50%",overflow:"hidden",border:"4px solid #3182ce",boxShadow:"0 0 20px rgba(49, 130, 206, 0.4)",background:"#1a202c",zIndex:500,pointerEvents:"none"},children:l.jsx("img",{src:Hl(t.class),alt:t.name,style:{width:"100%",height:"100%",objectFit:"cover",objectPosition:t.class==="AJA"?"center top":"center"}})}),l.jsx("div",{style:{position:"fixed",left:v.opponent.x,top:v.opponent.y,transform:`translate(-50%, -50%) scale(${F})`,opacity:ie,width:v.leaderSize,height:v.leaderSize,borderRadius:"50%",overflow:"hidden",border:"4px solid #c53030",boxShadow:"0 0 20px rgba(197, 48, 48, 0.4)",background:"#1a202c",zIndex:500,pointerEvents:"none"},children:l.jsx("img",{src:Hl(e.class),alt:e.name,style:{width:"100%",height:"100%",objectFit:"cover",objectPosition:e.class==="AJA"?"center top":"center"}})})]}),C.map(V=>l.jsx("div",{style:{position:"fixed",left:V.x,top:V.y,width:V.size*s,height:V.size*s,borderRadius:"50%",background:V.color,boxShadow:`0 0 ${V.size*.5*s}px ${V.color}`,pointerEvents:"none",zIndex:600,animation:`landingParticleBurst 0.6s ease-out ${V.delay}s forwards`,transform:"translate(-50%, -50%)","--particle-angle":`${V.angle}deg`,"--particle-dist":`${V.dist*s}px`}},V.id)),ye&&l.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",animation:j===3?"vsZoomIn 1.5s cubic-bezier(0.34, 1.56, 0.64, 1)":void 0,opacity:j>=7?Math.max(0,me):1,zIndex:200,pointerEvents:"none"},children:l.jsx("img",{src:fw,alt:"VS",style:{height:300*s,width:"auto",filter:`drop-shadow(0 0 ${20*s}px rgba(255,255,255,0.8)) drop-shadow(0 0 ${40*s}px rgba(255,255,255,0.6))`}})}),j>=4&&j<5&&l.jsx("div",{style:{position:"absolute",top:"20%",left:"50%",transform:"translate(-50%, -50%)",zIndex:150},children:l.jsx("div",{style:{width:100*s,height:100*s,borderRadius:"50%",background:"linear-gradient(45deg, #f6ad55 0%, #fbd38d 100%)",border:"4px solid white",display:"flex",alignItems:"center",justifyContent:"center",fontSize:2*s+"rem",fontWeight:"bold",color:"white",animation:"coinFlip 1.5s ease-in-out",boxShadow:`0 0 ${30*s}px rgba(246, 173, 85, 0.8)`},children:""})}),l.jsx("style",{children:`
                @keyframes screenShake {
                    0%, 100% { transform: translate(0, 0); }
                    10% { transform: translate(-10px, -10px); }
                    20% { transform: translate(10px, 10px); }
                    30% { transform: translate(-10px, 10px); }
                    40% { transform: translate(10px, -10px); }
                    50% { transform: translate(-10px, -10px); }
                    60% { transform: translate(10px, 10px); }
                    70% { transform: translate(-10px, 10px); }
                    80% { transform: translate(10px, -10px); }
                    90% { transform: translate(-10px, 0); }
                }

                @keyframes nameplateSlideUp {
                    0% {
                        transform: translateY(50px);
                        opacity: 0;
                    }
                    60% {
                        transform: translateY(-10px);
                    }
                    100% {
                        transform: translateY(0);
                        opacity: 1;
                    }
                }

                @keyframes vsZoomIn {
                    0% {
                        transform: translate(-50%, -50%) scale(3) translateZ(0);
                        opacity: 0;
                        filter: blur(20px);
                    }
                    50% {
                        transform: translate(-50%, -50%) scale(1.2) translateZ(0);
                        opacity: 1;
                        filter: blur(0px);
                    }
                    100% {
                        transform: translate(-50%, -50%) scale(1) translateZ(0);
                        opacity: 1;
                        filter: blur(0px);
                    }
                }

                @keyframes coinFlip {
                    0% {
                        transform: rotateY(0deg) scale(1);
                    }
                    50% {
                        transform: rotateY(1800deg) scale(1.2);
                    }
                    100% {
                        transform: rotateY(3600deg) scale(1);
                    }
                }

                @keyframes turnOrderFadeIn {
                    0% {
                        opacity: 0;
                        transform: scale(0.5);
                    }
                    50% {
                        transform: scale(1.2);
                    }
                    100% {
                        opacity: 1;
                        transform: scale(1);
                    }
                }

                @keyframes glowPulse {
                    0%, 100% {
                        opacity: 0.8;
                        filter: brightness(1);
                    }
                    50% {
                        opacity: 1;
                        filter: brightness(1.3);
                    }
                }

                @keyframes landingParticleBurst {
                    0% {
                        transform: translate(-50%, -50%) rotate(var(--particle-angle)) translateX(0);
                        opacity: 1;
                    }
                    100% {
                        transform: translate(-50%, -50%) rotate(var(--particle-angle)) translateX(var(--particle-dist));
                        opacity: 0;
                    }
                }
            `})]})},hw=({isVictory:t,loserLeaderRef:e,onComplete:n,onPhaseChange:r,onShakeIntensityChange:s,scale:i=1})=>{const[o,a]=U.useState("start"),[c,u]=U.useState(null),[p,h]=U.useState([]);U.useEffect(()=>{if(e.current){const m=e.current.getBoundingClientRect();u({x:m.left+m.width/2,y:m.top+m.height/2,size:m.width})}},[e]),U.useEffect(()=>{r==null||r(o)},[o,r]),U.useEffect(()=>{const m={start:200,zoom:600,"white-fade":800,explode:1200,"result-text":1800,"fade-out":600};if(o==="complete"){n();return}const b={start:"zoom",zoom:"white-fade","white-fade":"explode",explode:"result-text","result-text":"fade-out","fade-out":"complete"},R=setTimeout(()=>{const W=b[o];W&&a(W)},m[o]||1e3);return()=>clearTimeout(R)},[o,n]),U.useEffect(()=>{if(o==="explode"&&c){const b=Array.from({length:60},(I,S)=>{const k=S/60*360,$=(Math.random()-.5)*12,B=k+$,te=150+Math.random()*250,J=12+Math.random()*20;return{id:S,x:c.x,y:c.y,angle:B,distance:te,size:J,delay:Math.random()*.1,duration:.6+Math.random()*.4}});h(b),s==null||s(1);const R=1e3,W=Date.now(),d=setInterval(()=>{const S=(Date.now()-W)/R;if(S>=1)s==null||s(0),clearInterval(d);else{const k=1-Math.pow(S,2);s==null||s(k)}},16);return()=>clearInterval(d)}},[o,c,s]);const f=["start","zoom","white-fade","explode","result-text","fade-out","complete"].indexOf(o);return c?l.jsxs("div",{style:{position:"fixed",inset:0,zIndex:8e3,pointerEvents:"none",overflow:"hidden"},children:[l.jsx("div",{style:{position:"absolute",inset:0,background:"black",opacity:f>=1?f>=5?1:.5:0,transition:"opacity 0.5s ease-out"}}),f>=1&&f<4&&l.jsx("div",{style:{position:"absolute",left:c.x,top:c.y,transform:"translate(-50%, -50%)",width:c.size*1.8,height:c.size*1.8,borderRadius:"50%",background:"radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 60%)",transition:"all 0.4s ease-out"}}),f>=3&&p.map(m=>l.jsx("div",{style:{position:"absolute",left:m.x,top:m.y,width:m.size*i,height:m.size*i,borderRadius:"50%",background:"white",boxShadow:"0 0 15px white, 0 0 30px rgba(255,255,255,0.5)",transform:"translate(-50%, -50%)",animation:`particleFly-${m.id} ${m.duration}s ease-out ${m.delay}s forwards`}},m.id)),f>=3&&l.jsx("style",{children:p.map(m=>{const b=m.angle*Math.PI/180,R=Math.cos(b)*m.distance,W=Math.sin(b)*m.distance;return`
                            @keyframes particleFly-${m.id} {
                                0% {
                                    transform: translate(-50%, -50%) scale(1);
                                    opacity: 1;
                                }
                                100% {
                                    transform: translate(calc(-50% + ${R}px), calc(-50% + ${W}px)) scale(0);
                                    opacity: 0;
                                }
                            }
                        `}).join(`
`)}),f>=4&&f<6&&l.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",animation:"resultTextPop 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)"},children:l.jsx("div",{style:{fontSize:`${7*i}rem`,fontWeight:900,fontFamily:"Tamanegi, sans-serif",color:t?"#ffd700":"#718096",textShadow:t?"0 0 30px rgba(255,215,0,0.8), 0 0 60px rgba(255,215,0,0.6), 0 0 90px rgba(255,215,0,0.4), 4px 4px 8px rgba(0,0,0,0.8)":"0 0 20px rgba(113,128,150,0.5), 4px 4px 8px rgba(0,0,0,0.8)",letterSpacing:"0.15em"},children:t?"":"..."})}),l.jsx("style",{children:`
                @keyframes resultTextPop {
                    0% {
                        transform: translate(-50%, -50%) scale(2.5);
                        opacity: 0;
                        filter: blur(20px);
                    }
                    60% {
                        transform: translate(-50%, -50%) scale(0.95);
                        opacity: 1;
                        filter: blur(0px);
                    }
                    100% {
                        transform: translate(-50%, -50%) scale(1);
                        opacity: 1;
                        filter: blur(0px);
                    }
                }
            `})]}):null},gw=({isMyTurn:t,turnCount:e,activePlayerId:n,onTimeUp:r,timerEnabled:s,isGameOver:i=!1,scale:o=1,buttonSize:a=160,timerDuration:c=60})=>{const[u,p]=U.useState(c),[h,f]=U.useState(!1),[m,b]=U.useState(!1),R=U.useRef(null),W=U.useRef(""),d=U.useRef(0),I=U.useRef(r),S=U.useRef(!1),k=U.useId().replace(/:/g,"_");U.useEffect(()=>{I.current=r},[r]);const $=`${e}-${n}`,B=U.useCallback(()=>{p(c),f(!1),b(!1),d.current=Date.now()+c*1e3,S.current=!1},[c]);if(U.useEffect(()=>{$!==W.current&&(W.current=$,B())},[$,B]),U.useEffect(()=>{if(!s||!t||i){R.current&&(clearInterval(R.current),R.current=null);return}return d.current===0&&(d.current=Date.now()+c*1e3),R.current=window.setInterval(()=>{const x=Date.now(),v=Math.max(0,(d.current-x)/1e3);p(v);const T=Math.ceil(v);T<=15&&T>10?(f(!0),b(!1)):T<=10?(f(!0),b(!0)):(f(!1),b(!1)),v<=0&&!S.current&&(S.current=!0,R.current&&(clearInterval(R.current),R.current=null),setTimeout(()=>I.current(),0))},16),()=>{R.current&&(clearInterval(R.current),R.current=null)}},[s,t,i,c]),!s)return null;const te=u/c,J=(a/2+12)*o,me=6*o,he=2*Math.PI*J,ke=-he*(1-te),L=Math.ceil(u),F=m?Math.min(1,(10-L)/10):0,fe=Math.max(.05,.15-F*.1);let ie="#4299e1";h&&!m?ie="#f6ad55":m&&(ie="#e53e3e");const y=20*o,C=J*2+me+y*2;return l.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:C,height:C,pointerEvents:"none",zIndex:10,animation:m?`timerShake${k} ${fe}s ease-in-out infinite`:void 0},children:[l.jsxs("svg",{width:C,height:C,style:{position:"absolute",top:0,left:0,overflow:"visible"},children:[l.jsx("circle",{cx:C/2,cy:C/2,r:J,fill:"none",stroke:"rgba(0,0,0,0.3)",strokeWidth:me}),l.jsx("circle",{cx:C/2,cy:C/2,r:J,fill:"none",stroke:ie,strokeWidth:me,strokeLinecap:"round",strokeDasharray:he,strokeDashoffset:ke,style:{transform:"rotate(-90deg)",transformOrigin:"center"}}),h&&l.jsx("circle",{cx:C/2,cy:C/2,r:J,fill:"none",stroke:ie,strokeWidth:me*3,opacity:.4,style:{filter:`blur(${12*o}px)`,animation:m?`timerPulse${k} 0.5s ease-in-out infinite`:`timerPulse${k} 1s ease-in-out infinite`}})]}),l.jsx("style",{children:`
                @keyframes timerPulse${k} {
                    0%, 100% { opacity: 0.4; }
                    50% { opacity: 0.7; }
                }
                @keyframes timerShake${k} {
                    0%, 100% { transform: translate(-50%, -50%) translate(0, 0); }
                    25% { transform: translate(-50%, -50%) translate(${2*o}px, ${-2*o}px); }
                    50% { transform: translate(-50%, -50%) translate(${-2*o}px, ${2*o}px); }
                    75% { transform: translate(-50%, -50%) translate(${2*o}px, ${1*o}px); }
                }
            `})]})};function mw(t,e){const[n,r]=U.useState(null),[s,i]=U.useState(""),[o,a]=U.useState(!1),[c,u]=U.useState(null),[p,h]=U.useState(!1);return U.useEffect(()=>{if(t==="CPU")return;const f=new C1;return h(!0),(async()=>{try{const b=await f.connect(t==="JOIN"?e:void 0);i(b),r(f),f.onConnection(()=>{console.log("[useGameNetwork] Connection established!"),a(!0),h(!1)})}catch(b){u(b.toString()),h(!1)}})(),()=>{f.disconnect()}},[t,e]),{adapter:n,myId:s,connected:o,connecting:p,error:c,setConnected:a}}function my(t,e,n){return!(!t.canEvolveThisTurn||t.evolutionsUsed>=2||e<(n?5:4))}function yy(t,e,n){return!(!t.canEvolveThisTurn||t.sep<=0||e<(n?7:6))}const Je=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},yw=Je("/leaders/azya_leader.png"),vw=Je("/leaders/senka_leader.png"),_w=Je("/leaders/yoRuka_leader.png"),xw=Je("/sleeves/azya_sleeve.png"),Ew=Je("/sleeves/senka_sleeve.png"),bw=Je("/sleeves/yoruka_sleeve.png"),ra=t=>t==="YORUKA"?_w:t==="AJA"?yw:vw,Ls=t=>t==="YORUKA"?bw:t==="AJA"?xw:Ew,Sw=1920,rE=1080,Cw=()=>{const[t,e]=U.useState({scale:1,toGameX:r=>r,toGameY:r=>r}),n=U.useCallback(()=>{const r=window.visualViewport?window.visualViewport.width:window.innerWidth,s=window.visualViewport?window.visualViewport.height:window.innerHeight;let i=Math.min(r/Sw,s/rE);i*=1.5,e({scale:i,toGameX:c=>c,toGameY:c=>c})},[]);return U.useEffect(()=>{n(),window.addEventListener("resize",n),window.addEventListener("orientationchange",()=>{setTimeout(n,150)}),window.visualViewport&&window.visualViewport.addEventListener("resize",n);const r=()=>{document.visibilityState==="visible"&&setTimeout(n,100)};return document.addEventListener("visibilitychange",r),()=>{window.removeEventListener("resize",n),window.removeEventListener("orientationchange",n),window.visualViewport&&window.visualViewport.removeEventListener("resize",n),document.removeEventListener("visibilitychange",r)}},[n]),t},en=90,yn=120,Ds=en+18,Ei=240,Tw=({x:t,y:e,onComplete:n,scale:r=1})=>{D.useEffect(()=>{const i=setTimeout(n,2e3);return()=>clearTimeout(i)},[n]);const s=D.useMemo(()=>Array(20).fill(0).map((i,o)=>({id:o,angle:Math.random()*360,dist:(30+Math.random()*60)*r,size:(10+Math.random()*15)*r,delay:Math.random()*.5})),[r]);return l.jsxs("div",{style:{position:"absolute",left:t,top:e,pointerEvents:"none",zIndex:6e3},children:[l.jsx("style",{children:`
                @keyframes healGlowFade {
                    0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; filter: blur(10px); }
                    30% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.8; filter: blur(15px); }
                    100% { transform: translate(-50%, -50%) scale(1.6); opacity: 0; filter: blur(30px); }
                }
                @keyframes healParticleRise {
                    0% { transform: translate(-50%, -50%) rotate(var(--angle)) translate(0, 0) scale(0); opacity: 0; }
                    20% { transform: translate(-50%, -50%) rotate(var(--angle)) translate(0, 0) opacity: 0.7; }
                    100% { transform: translate(-50%, -50%) rotate(var(--angle)) translate(calc(var(--dist) * 1px), 0) scale(1.5); opacity: 0; }
                }
            `}),l.jsx("div",{style:{position:"absolute",left:0,top:0,width:150*r,height:150*r,background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(200,255,240,0.5) 50%, transparent 80%)",borderRadius:"50%",transform:"translate(-50%, -50%)",animation:"healGlowFade 1.5s ease-out forwards",filter:`blur(${8*r}px)`}}),s.map(i=>l.jsx("div",{style:{position:"absolute",left:0,top:0,width:i.size,height:i.size,background:"rgba(255,250,240,0.6)",borderRadius:"50%",filter:`blur(${4*r}px)`,"--angle":`${i.angle}deg`,"--dist":i.dist,animation:`healParticleRise 1.2s ease-out ${i.delay}s forwards`,pointerEvents:"none"}},i.id))]})},Iw=({x:t,y:e,atkBuff:n,hpBuff:r,onComplete:s})=>{D.useEffect(()=>{const m=setTimeout(s,1500);return()=>clearTimeout(m)},[s]);const i=n<0||r<0,o=i?"radial-gradient(circle, rgba(180,50,50,0.9) 0%, rgba(150,30,30,0.4) 50%, transparent 80%)":"radial-gradient(circle, rgba(255,230,100,0.9) 0%, rgba(255,200,50,0.4) 50%, transparent 80%)",a=i?"#ff4444":"#ffd93d",c="#ffd93d",u="rgba(255,217,61,0.8)",p=m=>m>=0?`+${m}`:`${m}`,h=80,f=110;return l.jsxs("div",{style:{position:"absolute",left:t,top:e,pointerEvents:"none",zIndex:6e3},children:[l.jsx("style",{children:`
                @keyframes buffGlow {
                    0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
                    30% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
                    100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
                }
                @keyframes buffNumberRise {
                    0% { transform: translateY(0); opacity: 0; }
                    20% { opacity: 1; }
                    100% { transform: translateY(-30px); opacity: 0; }
                }
                @keyframes buffSparkle {
                    0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
                    50% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
                    100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
                }
            `}),l.jsx("div",{style:{position:"absolute",left:0,top:0,width:150,height:150,background:o,borderRadius:"50%",transform:"translate(-50%, -50%)",animation:"buffGlow 1.2s ease-out forwards",filter:"blur(8px)"}}),n!==0&&l.jsx("div",{style:{position:"absolute",left:-h/2+12,top:f/2-20,fontSize:"24px",fontWeight:"bold",color:c,textShadow:`0 0 10px ${u}, 2px 2px 4px rgba(0,0,0,0.8)`,fontFamily:"Tamanegi, sans-serif",animation:"buffNumberRise 1.2s ease-out forwards",textAlign:"center"},children:p(n)}),r!==0&&l.jsx("div",{style:{position:"absolute",left:h/2-28,top:f/2-20,fontSize:"24px",fontWeight:"bold",color:c,textShadow:`0 0 10px ${u}, 2px 2px 4px rgba(0,0,0,0.8)`,fontFamily:"Tamanegi, sans-serif",animation:"buffNumberRise 1.2s ease-out forwards",textAlign:"center"},children:p(r)}),[...Array(8)].map((m,b)=>l.jsx("div",{style:{position:"absolute",left:Math.cos(b*Math.PI/4)*60,top:Math.sin(b*Math.PI/4)*60,width:12,height:12,background:a,borderRadius:"50%",boxShadow:`0 0 10px ${a}, 0 0 20px ${a}`,animation:`buffSparkle 0.8s ease-out ${b*.1}s forwards`}},b))]})},kw=({x:t,y:e,onComplete:n,scale:r=1})=>(D.useEffect(()=>{const s=setTimeout(n,1200);return()=>clearTimeout(s)},[n]),l.jsxs("div",{style:{position:"absolute",left:t,top:e,transform:"translate(-50%, -50%)",width:130*r,height:130*r,pointerEvents:"none",zIndex:5e3,display:"flex",alignItems:"center",justifyContent:"center"},children:[l.jsx("div",{style:{fontSize:`${80*r}px`,animation:"baneSkullAppear 1.2s ease-out forwards",textShadow:`0 0 ${20*r}px #9b59b6, 0 0 ${40*r}px #8e44ad, 0 0 ${60*r}px #6c3483`,filter:`drop-shadow(0 0 ${15*r}px #9b59b6) hue-rotate(-10deg)`},children:""}),[...Array(12)].map((s,i)=>l.jsx("div",{style:{position:"absolute",left:"50%",top:"50%",width:6*r,height:6*r,background:"radial-gradient(circle, #9b59b6, #6c3483)",borderRadius:"50%",boxShadow:`0 0 ${8*r}px #9b59b6, 0 0 ${15*r}px #8e44ad`,animation:`baneParticle 1s ease-out ${i*.08}s forwards`,transform:`rotate(${i*30}deg) translateX(0)`}},i)),l.jsx("style",{children:`
                @keyframes baneSkullAppear {
                    0% { transform: scale(0) rotate(-30deg); opacity: 0; }
                    20% { transform: scale(1.3) rotate(10deg); opacity: 1; }
                    40% { transform: scale(1) rotate(-5deg); opacity: 1; }
                    60% { transform: scale(1.1) rotate(0deg); opacity: 1; }
                    80% { transform: scale(1) rotate(0deg); opacity: 0.8; }
                    100% { transform: scale(1.5) rotate(0deg); opacity: 0; }
                }
                @keyframes baneParticle {
                    0% { transform: rotate(0deg) translateX(0); opacity: 1; }
                    100% { transform: rotate(0deg) translateX(${70*r}px); opacity: 0; }
                }
            `})]})),ww=({type:t,x:e,y:n,onComplete:r,audioSettings:s,scale:i=1})=>{const o=D.useMemo(()=>{let f=8,m=8,b=100,R=256;return t==="SHOT"&&(R=128),{cols:f,rows:m,fps:b,size:R}},[t]);if(D.useEffect(()=>{const m=["LIGHTNING","THUNDER","IMPACT","SUMI","SHOT","ICE","WATER","RAY","FIRE","SLASH","BLUE_FIRE"].includes(t)?o.cols*o.rows/o.fps*1e3:t==="FIREBALL"?500:t==="HEAL"?2e3:400,b=setTimeout(r,m);return()=>clearTimeout(b)},[r,t,o]),D.useEffect(()=>{if(!s||!s.seEnabled)return;const f=(m,b=.5,R=0)=>{setTimeout(()=>{const W=new Audio(Je(`/se/${m}`));W.volume=(s.se||.5)*b,W.play().catch(d=>console.warn("SE Play prevented",d))},R)};t==="SHOT"?(f("shot.mp3",.6),f("hibi.mp3",.4,400)):t==="IMPACT"?(f("panch1.mp3",.6,100),f("panch2.mp3",.6,500)):t==="LIGHTNING"||t==="THUNDER"?f("thunder.mp3",.5):t==="FIREBALL"?f("explosion.mp3",.5):t==="FIRE"?f("fire.mp3",.5):t==="SLASH"?f("slash.mp3",.5):t==="ICE"?f("ice.mp3",.5):t==="WATER"?f("water.mp3",.5):t==="RAY"?f("ray.mp3",.6):t==="SUMI"?f("yami.mp3",.6):t==="HEAL"?f("heal.mp3",.6):t==="BLUE_FIRE"?f("fire.mp3",.5):t==="BANE"&&f("yami.mp3",.7)},[t,s]),t==="HEAL")return l.jsx(Tw,{x:e,y:n,onComplete:r,scale:i});if(t==="BANE")return l.jsx(kw,{x:e,y:n,onComplete:r,scale:i});const a=100*i,c={position:"absolute",left:e,top:n,transform:"translate(-50%, -50%)",width:a,height:a,pointerEvents:"none",zIndex:5e3,display:"flex",alignItems:"center",justifyContent:"center"};if(["LIGHTNING","THUNDER","IMPACT","SUMI","SHOT","ICE","WATER","RAY","FIRE","SLASH","BLUE_FIRE"].includes(t)){let f=Je("/effects/thunder.png");t==="IMPACT"&&(f=Je("/effects/impact.png")),t==="SUMI"&&(f=Je("/effects/sumi.png")),t==="SHOT"&&(f=Je("/effects/shot.png")),t==="ICE"&&(f=Je("/effects/ice.png")),t==="WATER"&&(f=Je("/effects/water.png")),t==="RAY"&&(f=Je("/effects/ray.png")),t==="FIRE"&&(f=Je("/effects/fire.png")),t==="SLASH"&&(f=Je("/effects/slash.png")),t==="BLUE_FIRE"&&(f=Je("/effects/blue_fire.png"));const m=o.cols*o.rows,b=Math.min(160,o.size)*i;return l.jsxs("div",{style:{...c,width:b,height:b,transform:`${(c==null?void 0:c.transform)||""}`},children:[l.jsx("div",{style:{width:"100%",height:"100%",backgroundImage:`url(${f})`,backgroundSize:`${o.cols*100}% ${o.rows*100}%`,animation:`spriteAnimation ${m/o.fps}s steps(1) forwards`}}),l.jsx("style",{children:`
                    @keyframes spriteAnimation {
                        ${Array.from({length:m}).map((R,W)=>{const d=W%o.cols,I=Math.floor(W/o.cols),S=d*(100/(o.cols-1)),k=I*(100/(o.rows-1));return`${W/(m-1)*100}% { background-position: ${S}% ${k}%; }`}).join(`
`)}
                    }
                `})]})}let p="",h="";if(t==="FIREBALL")p=Je("/effects/fireball.png"),h="explode 0.5s ease-out forwards";else if(t==="BEAM")return l.jsx("div",{style:{position:"fixed",left:e,top:n,width:400,height:30,background:"linear-gradient(90deg, transparent, #faf089, #fff, #faf089, transparent)",transform:"translate(-50%, -50%) rotate(-45deg)",boxShadow:"0 0 20px #faf089",opacity:0,animation:"beamShoot 0.4s ease-out forwards",pointerEvents:"none",zIndex:5e3},children:l.jsx("style",{children:`
                    @keyframes beamShoot {
                        0% { width: 0; opacity: 1; transform: translate(-50%, -50%) rotate(-45deg) scaleX(0); }
                        20% { width: 400px; opacity: 1; transform: translate(-50%, -50%) rotate(-45deg) scaleX(1); }
                        100% { width: 400px; opacity: 0; transform: translate(-50%, -50%) rotate(-45deg) scaleX(1.2); }
                    }
                `})});return p?l.jsxs("div",{style:c,children:[l.jsx("img",{src:p,style:{width:"100%",height:"100%",objectFit:"contain",animation:h}}),l.jsx("style",{children:`
                @keyframes explode { 0% { transform: scale(0.5); opacity: 0; } 20% { opacity: 1; } 100% { transform: scale(2); opacity: 0; } }
            `})]}):null},Aw=({value:t,x:e,y:n,color:r,onComplete:s,scale:i=1})=>{D.useEffect(()=>{const u=setTimeout(s,1200);return()=>clearTimeout(u)},[s]);const o=r==="#48bb78",a=r||"#e53e3e",c=o?"linear-gradient(180deg, #68d391 0%, #38a169 50%, #276749 100%)":"linear-gradient(180deg, #fc8181 0%, #e53e3e 50%, #c53030 100%)";return l.jsxs("div",{style:{position:"absolute",left:e,top:n,transform:"translate(-50%, -50%)",pointerEvents:"none",zIndex:6e3,fontSize:`${4*i}rem`,fontWeight:"900",fontFamily:'"Impact", "Arial Black", sans-serif',letterSpacing:`${-2*i}px`,background:c,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",filter:`drop-shadow(0 0 ${8*i}px ${a}) drop-shadow(0 ${2*i}px ${4*i}px rgba(0,0,0,0.8))`,animation:"floatUp 1.2s ease-out forwards"},children:[t,l.jsx("style",{children:`
                @keyframes floatUp {
                    0% { transform: translate(-50%, -50%) scale(0.3); opacity: 0; }
                    15% { transform: translate(-50%, -70%) scale(1.8); opacity: 1; }
                    30% { transform: translate(-50%, -90%) scale(1.4); opacity: 1; }
                    100% { transform: translate(-50%, -180%) scale(1); opacity: 0; }
                }
            `})]})},Rw=({x:t,y:e})=>{const n=D.useMemo(()=>Array(16).fill(0).map((r,s)=>({id:s,angle:Math.random()*360,dist:60+Math.random()*120,size:4+Math.random()*8,delay:Math.random()*.3,color:Math.random()>.5?"#f6e05e":"#ffffff"})),[]);return l.jsxs("div",{style:{position:"absolute",left:t,top:e,pointerEvents:"none",zIndex:6e3},children:[l.jsx("style",{children:`
                @keyframes sparkleMove {
                    0% { transform: rotate(var(--angle)) translate(0, 0) scale(0); opacity: 0; }
                    20% { opacity: 1; transform: rotate(var(--angle)) translate(calc(var(--dist) * 0.2px), 0) scale(1.5); }
                    100% { transform: rotate(var(--angle)) translate(calc(var(--dist) * 1px), 0) scale(0); opacity: 0; }
                }
            `}),n.map(r=>l.jsx("div",{style:{position:"absolute",left:0,top:0,width:r.size,height:r.size,background:r.color,borderRadius:"50%",boxShadow:`0 0 10px ${r.color}, 0 0 20px ${r.color}`,"--angle":`${r.angle}deg`,"--dist":r.dist,animation:`sparkleMove 0.8s ease-out ${r.delay}s forwards`,pointerEvents:"none"}},r.id))]})},Ow=({onClose:t})=>l.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(0,0,0,0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:t,children:l.jsxs("div",{style:{background:"linear-gradient(135deg, #1a202c 0%, #2d3748 100%)",borderRadius:16,padding:30,maxWidth:700,maxHeight:"80vh",overflowY:"auto",color:"#fff",boxShadow:"0 20px 60px rgba(0,0,0,0.5)",border:"1px solid #4a5568"},onClick:e=>e.stopPropagation(),children:[l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[l.jsx("h2",{style:{margin:0,color:"#63b3ed"},children:""}),l.jsx("button",{onClick:t,style:{background:"transparent",border:"none",color:"#a0aec0",fontSize:"1.5rem",cursor:"pointer"},children:""})]}),l.jsxs("section",{style:{marginBottom:25},children:[l.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),l.jsxs("ul",{style:{lineHeight:1.8,paddingLeft:20,color:"#e2e8f0"},children:[l.jsx("li",{children:"0"}),l.jsx("li",{children:"1PP110"}),l.jsx("li",{children:"PP"}),l.jsx("li",{children:""}),l.jsx("li",{children:"5"}),l.jsx("li",{children:"910"})]})]}),l.jsxs("section",{style:{marginBottom:25},children:[l.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[l.jsxs("div",{children:[l.jsx("span",{style:{color:"#48bb78",fontWeight:"bold"},children:"[]"}),""]}),l.jsxs("div",{children:[l.jsx("span",{style:{color:"#ed8936",fontWeight:"bold"},children:"[]"}),""]}),l.jsxs("div",{children:[l.jsx("span",{style:{color:"#4299e1",fontWeight:"bold"},children:"[]"}),""]}),l.jsxs("div",{children:[l.jsx("span",{style:{color:"#9f7aea",fontWeight:"bold"},children:"[]"}),""]}),l.jsxs("div",{children:[l.jsx("span",{style:{color:"#f56565",fontWeight:"bold"},children:"[]"}),"12"]}),l.jsxs("div",{children:[l.jsx("span",{style:{color:"#38b2ac",fontWeight:"bold"},children:"[]"}),"1"]}),l.jsxs("div",{children:[l.jsx("span",{style:{color:"#718096",fontWeight:"bold"},children:"[]"}),"AoE"]}),l.jsxs("div",{children:[l.jsx("span",{style:{color:"#d69e2e",fontWeight:"bold"},children:"[]"}),"AoE"]})]})]}),l.jsxs("section",{style:{marginBottom:25},children:[l.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[l.jsxs("div",{children:[l.jsx("span",{style:{color:"#63b3ed",fontWeight:"bold"},children:""}),""]}),l.jsxs("div",{children:[l.jsx("span",{style:{color:"#f687b3",fontWeight:"bold"},children:""}),""]}),l.jsxs("div",{children:[l.jsx("span",{style:{color:"#faf089",fontWeight:"bold"},children:""}),"EP"]}),l.jsxs("div",{children:[l.jsx("span",{style:{color:"#b794f4",fontWeight:"bold"},children:""}),"SEP"]}),l.jsxs("div",{children:[l.jsx("span",{style:{color:"#68d391",fontWeight:"bold"},children:""}),""]})]})]}),l.jsxs("section",{style:{marginBottom:25},children:[l.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),l.jsxs("ul",{style:{lineHeight:1.8,paddingLeft:20,color:"#e2e8f0"},children:[l.jsxs("li",{children:[l.jsx("span",{style:{color:"#faf089"},children:"EP"}),"54112"]}),l.jsxs("li",{children:[l.jsx("span",{style:{color:"#b794f4"},children:"SEP"}),"76112"]}),l.jsx("li",{children:"1111"}),l.jsx("li",{children:"+2/+2"}),l.jsx("li",{children:"+3/+3"})]})]}),l.jsxs("section",{children:[l.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),l.jsxs("ul",{style:{lineHeight:1.8,paddingLeft:20,color:"#e2e8f0"},children:[l.jsxs("li",{children:[l.jsx("span",{style:{color:"#ed8936"},children:"PP"}),""]}),l.jsx("li",{children:"151612PP +1"})]})]})]})}),Pw=({logs:t,onCardNameClick:e,scale:n=1,isMobile:r=!1})=>{const s=D.useRef(null);D.useEffect(()=>{s.current&&(s.current.scrollTop=s.current.scrollHeight)},[t.length]);const i=(c,u)=>{const p={color:"#ffd700",cursor:"pointer",textDecoration:"underline",textUnderlineOffset:"2px",fontWeight:"bold"},h=k=>{k.target.style.color="#ffec8b",k.target.style.textShadow="0 0 8px rgba(255, 215, 0, 0.8)"},f=k=>{k.target.style.color="#ffd700",k.target.style.textShadow="none"},m=(k,$)=>l.jsx("span",{style:p,onMouseEnter:h,onMouseLeave:f,onClick:B=>{B.stopPropagation(),e==null||e(k)},children:k},$),b=tE(),R=k=>k?!(/[a-zA-Z0-9]/.test(k)||/[\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/.test(k)):!0,W=[];for(const k of b){let $=0;for(;;){const B=c.indexOf(k,$);if(B===-1)break;const te=B>0?c[B-1]:void 0,J=B+k.length<c.length?c[B+k.length]:void 0,me=R(te)&&R(J),he=W.some(ke=>B>=ke.start&&B<ke.end||B+k.length>ke.start&&B+k.length<=ke.end||B<=ke.start&&B+k.length>=ke.end);me&&!he&&W.push({start:B,end:B+k.length,name:k}),$=B+1}}if(W.length===0)return l.jsx("span",{children:c});W.sort((k,$)=>k.start-$.start);const d=[];let I=0,S=0;for(const k of W)k.start>I&&d.push(l.jsx("span",{children:c.slice(I,k.start)},S++)),d.push(m(k.name,S++)),I=k.end;return I<c.length&&d.push(l.jsx("span",{children:c.slice(I)},S++)),l.jsx(l.Fragment,{children:d})},o=r?Math.max(100,140*n):Math.max(150,200*n),a=r?Math.max(140,180*n):Math.max(180,220*n);return l.jsxs("div",{ref:s,style:{position:"absolute",left:0,top:"45%",transform:"translateY(-50%)",width:a,height:o,overflowY:"auto",background:"linear-gradient(to right, rgba(0,0,0,0.8), rgba(0,0,0,0.0))",color:"#fff",fontSize:r?`${Math.max(.55,.65*n)}rem`:`${Math.max(.65,.75*n)}rem`,padding:r?`${6*n}px ${6*n}px ${6*n}px ${10*n}px`:`${8*n}px ${8*n}px ${8*n}px ${12*n}px`,borderLeft:r?"2px solid #63b3ed":"3px solid #63b3ed",zIndex:15,pointerEvents:"auto",scrollbarWidth:"thin"},onMouseDown:c=>c.stopPropagation(),onClick:c=>c.stopPropagation(),children:[l.jsx("div",{style:{fontWeight:"bold",marginBottom:(r?3:4)*n,color:"#a0aec0",borderBottom:"1px solid rgba(255,255,255,0.1)",paddingBottom:2,fontSize:r?`${Math.max(.5,.55*n)}rem`:`${Math.max(.55,.65*n)}rem`,textTransform:"uppercase",letterSpacing:1},children:r?"LOG":"BATTLE LOG"}),l.jsx("div",{style:{display:"flex",flexDirection:"column",gap:(r?2:3)*n},children:t.map((c,u)=>l.jsx("div",{style:{opacity:.9,lineHeight:r?"1.3":"1.4",textShadow:"0 1px 2px black",animation:"fadeIn 0.3s ease-out"},children:i(c)},u))})]})},Lw=({card:t,evolvedImageUrl:e,startX:n,startY:r,phase:s,onPhaseChange:i,onShake:o,useSep:a,playSE:c,scale:u,isLightMode:p=!1})=>{const[h,f]=D.useState(0),[m,b]=D.useState(0),[R,W]=D.useState(0),[d,I]=D.useState(0),[S,k]=D.useState(0),[$,B]=D.useState(.25),[te,J]=D.useState({x:n,y:r}),[me,he]=D.useState(!1),[ke,L]=D.useState([]),[F,fe]=D.useState([]),[ie,y]=D.useState(!1),C=D.useRef(!1),x=D.useRef(null),v=D.useRef(i),T=D.useRef(o),w=D.useRef(c);D.useEffect(()=>{v.current=i,T.current=o,w.current=c},[i,o,c]);const O=360*u,q=480*u;D.useEffect(()=>{var V,Le,be;console.log("[EvolutionAnimation] Phase:",s);let we,Z=null;switch(s){case"ZOOM_IN":{J({x:n,y:r}),B(.25),b(0);const Qe=Date.now(),ot=650,it=.25,Tt=.75,at=setInterval(()=>{const Ht=Date.now()-Qe,Cn=Math.min(Ht/ot,1),zn=1-Math.pow(1-Cn,2);b(-5*zn),B(it+(Tt-it)*zn),Cn>=1&&clearInterval(at)},16);we=setTimeout(()=>{const Ht=280*u,Cn=window.innerWidth-Ht,zn=Ht+Cn*.4;J({x:zn,y:window.innerHeight/2-30*u})},50);const Ye=setTimeout(()=>{const Ht=new Audio(Je("/se/kirakira.mp3"));Ht.volume=.35,Ht.play().catch(()=>{}),x.current=Ht},600),Mt=setTimeout(()=>{v.current("WHITE_FADE")},700);return()=>{clearTimeout(we),clearTimeout(Mt),clearTimeout(Ye),clearInterval(at)}}case"WHITE_FADE":(V=w.current)==null||V.call(w,"magic_charge.mp3",.3);const Xe=Array(80).fill(0).map((Qe,ot)=>{const it=ot/80*360,Tt=(Math.random()-.5)*10,at=it+Tt,Ye=200+Math.random()*600,Mt=Math.random()*1.8,Cn=.5+(Ye-200)/600*.5,zn=24+Math.random()*48;return{id:ot,angle:at,dist:Ye,delay:Mt,duration:Cn,size:zn}});L(Xe),y(!0);let Se=0;return Z=setInterval(()=>{Se+=.025,I(Math.min(Se,1)),k(Math.min(Se*80,80)),W(Se*15),Se>=1.2&&(Z&&clearInterval(Z),y(!1),v.current("FLIP"))},40),()=>{Z&&clearInterval(Z)};case"FLIP":if((Le=w.current)==null||Le.call(w,"syakin.mp3",.8),(be=w.current)==null||be.call(w,"KO.mp3",.7),x.current){const Qe=x.current,ot=300,it=30,Tt=ot/it,at=Qe.volume/Tt;let Ye=0;const Mt=setInterval(()=>{Ye++,Qe.volume=Math.max(0,Qe.volume-at),Ye>=Tt&&(clearInterval(Mt),Qe.pause(),x.current=null)},it)}L([]);const De=Date.now(),vt=400,$e=1200;return Z=setInterval(()=>{const Qe=Date.now()-De;if(Qe<vt){const ot=Qe/vt,it=1-Math.pow(1-ot,3),Tt=10+it*160;if(f(Tt),B(.75+it*((a?1.2:1.1)-.75)),b(-5+it*2),I(Math.max(1-ot*3,0)),Tt>90&&!C.current){C.current=!0;const Ye=Array(120).fill(0).map((Mt,Ht)=>{const Cn=Ht/120*360,zn=(Math.random()-.5)*8,dr=18+Math.random()*42;return{id:Ht,angle:Cn+zn,dist:200+Math.random()*400,size:dr*3,delay:Math.random()*.05}});fe(Ye)}}else{const ot=Math.min((Qe-vt)/$e,1),it=ot<.5?2*ot*ot:1-Math.pow(-2*ot+2,2)/2;if(f(170+it*10),I(0),!C.current){C.current=!0;const Tt=Array(120).fill(0).map((at,Ye)=>{const Mt=Ye/120*360,Ht=(Math.random()-.5)*8,Cn=18+Math.random()*42;return{id:Ye,angle:Mt+Ht,dist:200+Math.random()*400,size:Cn*3,delay:Math.random()*.05}});fe(Tt)}ot>=1&&(Z&&clearInterval(Z),v.current("REVEAL"))}},16),()=>{Z&&clearInterval(Z)};case"REVEAL":let pt=0;return Z=setInterval(()=>{pt+=.25,I(Math.max(1-pt,0)),k(Math.max(60-pt*60,0)),pt>=1&&(Z&&clearInterval(Z),fe([]),v.current("ZOOM_OUT"))},40),()=>{Z&&clearInterval(Z)};case"ZOOM_OUT":{J({x:n,y:r});const Qe=Date.now(),ot=250,it=$,Tt=-3;return Z=setInterval(()=>{const at=Date.now()-Qe,Ye=Math.min(at/ot,1),Mt=1-Math.pow(1-Ye,3);B(it-(it-.25)*Mt),b(Tt*(1-Mt)),Ye>=1&&(Z&&clearInterval(Z),f(180),W(0),B(.25),b(0),v.current("LAND"))},16),()=>{Z&&clearInterval(Z)}}case"LAND":return T.current(),he(!0),we=setTimeout(()=>{v.current("DONE")},600),()=>clearTimeout(we)}return()=>{we&&clearTimeout(we),Z&&clearInterval(Z),x.current&&(x.current.pause(),x.current=null)}},[s]);const j=h+R,ye=m,Ae=ie?{x:(Math.random()-.5)*4,y:(Math.random()-.5)*4}:{x:0,y:0};return l.jsxs("div",{style:{position:"fixed",inset:0,zIndex:1e4,background:"rgba(0,0,0,0.75)",pointerEvents:"none"},children:[l.jsx("style",{children:`
                ${ke.map(we=>`
                    @keyframes chargeParticleIn-${we.id} {
                        0% { opacity: 0; transform: rotate(${we.angle}deg) translateX(${we.dist}px) scale(0.5); }
                        20% { opacity: 0.8; transform: rotate(${we.angle}deg) translateX(${we.dist*.8}px) scale(1.2); }
                        100% { opacity: 1; transform: rotate(${we.angle}deg) translateX(0) scale(0.2); } /* Keep visible at end */
                    }
                `).join("")}
                ${F.map(we=>`
                    @keyframes burstParticleOut-${we.id} {
                        0% { opacity: 1; transform: translate(-50%, -50%) rotate(${we.angle}deg) translateX(0) scale(1.5); }
                        100% { opacity: 0; transform: translate(-50%, -50%) rotate(${we.angle}deg) translateX(${we.dist*1.5}px) scale(0); }
                    }
                `).join("")}
            `}),(p?ke.filter((we,Z)=>Z%2===0):ke).map(we=>l.jsx("div",{style:{position:"absolute",left:te.x,top:te.y,width:we.size*u,height:we.size*u,borderRadius:"50%",background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(200,230,255,0.6) 40%, transparent 70%)",boxShadow:p?"0 0 8px white":"0 0 10px white, 0 0 20px rgba(100,200,255,0.5)",filter:p?void 0:"blur(1px)",animation:`chargeParticleIn-${we.id} ${we.duration}s ease-in ${we.delay}s forwards`,transform:`rotate(${we.angle}deg) translateX(${we.dist*u}px)`,opacity:0,pointerEvents:"none"}},`charge-${we.id}`)),s==="WHITE_FADE"&&l.jsxs("div",{style:{position:"absolute",left:te.x+Ae.x,top:te.y+Ae.y,width:0,height:0,transformStyle:"preserve-3d"},children:[l.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:500*u,height:500*u,border:"8px solid rgba(255, 255, 255, 0.6)",borderRadius:"50%",transform:"translate(-50%, -50%) rotateX(75deg)",boxShadow:p?"0 0 15px rgba(255, 255, 255, 0.6)":"0 0 30px rgba(255, 255, 255, 0.8), inset 0 0 30px rgba(255, 255, 255, 0.8)",animation:"ringSpin 2s linear infinite"}}),!p&&l.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:600*u,height:600*u,border:"6px dashed rgba(100, 200, 255, 0.7)",borderRadius:"50%",transform:"translate(-50%, -50%) rotateX(80deg) rotateY(10deg)",boxShadow:"0 0 40px rgba(100, 200, 255, 0.5)",animation:"ringSpinReverse 3s linear infinite"}}),l.jsx("style",{children:`
                        @keyframes ringSpin {
                            0% { transform: translate(-50%, -50%) rotateX(75deg) rotate(0deg); opacity: 0; scale: 0.5; }
                            20% { opacity: 1; scale: 1; }
                            100% { transform: translate(-50%, -50%) rotateX(75deg) rotate(360deg); opacity: 1; scale: 1; }
                        }
                        @keyframes ringSpinReverse {
                            0% { transform: translate(-50%, -50%) rotateX(80deg) rotateY(10deg) rotate(0deg); opacity: 0; scale: 0.6; }
                            20% { opacity: 0.8; scale: 1; }
                            100% { transform: translate(-50%, -50%) rotateX(80deg) rotateY(10deg) rotate(-360deg); opacity: 0.8; scale: 1; }
                        }
                    `})]}),(p?F.filter((we,Z)=>Z%2===0):F).map(we=>l.jsx("div",{style:{position:"absolute",left:te.x,top:te.y,width:we.size*u,height:we.size*u,borderRadius:"50%",background:a?"radial-gradient(circle, rgba(183, 148, 244, 1) 0%, rgba(159, 122, 234, 0.8) 50%, transparent 100%)":"radial-gradient(circle, rgba(255, 251, 235, 1) 0%, rgba(251, 211, 141, 0.8) 50%, transparent 100%)",boxShadow:p?a?"0 0 8px #b794f4":"0 0 8px #fbd38d":a?"0 0 10px #b794f4, 0 0 20px rgba(159,122,234,0.6)":"0 0 10px #fbd38d, 0 0 20px rgba(251,211,141,0.6)",animation:`burstParticleOut-${we.id} 0.4s ease-out ${we.delay}s forwards`,pointerEvents:"none"}},`burst-${we.id}`)),l.jsxs("div",{style:{position:"absolute",left:te.x+Ae.x,top:te.y+Ae.y,transform:`translate(-50%, -50%) scale(${$}) perspective(1200px) rotateY(${j}deg) rotateZ(${ye}deg)`,transition:s==="ZOOM_IN"||s==="ZOOM_OUT"?"left 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), top 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)":"none",transformStyle:"preserve-3d"},children:[!p&&l.jsx("div",{style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:O*1.3,height:q*1.2,background:a?"radial-gradient(ellipse, rgba(159, 122, 234, 0.4) 0%, transparent 70%)":"radial-gradient(ellipse, rgba(251, 211, 141, 0.4) 0%, transparent 70%)",filter:"blur(20px)",pointerEvents:"none",opacity:S>1?1:0,transition:"opacity 0.4s"}}),l.jsxs("div",{style:{width:O,height:q,borderRadius:16,overflow:"hidden",boxShadow:p?a?"0 0 20px rgba(159, 122, 234, 0.5)":"0 0 20px rgba(251, 211, 141, 0.5)":a?"0 0 40px rgba(159, 122, 234, 0.7)":"0 0 40px rgba(251, 211, 141, 0.7)",position:"relative",transformStyle:"preserve-3d"},children:[l.jsxs("div",{style:{position:"absolute",inset:0,borderRadius:16,overflow:"hidden",background:"#1a202c",zIndex:j<=90?2:1,opacity:j<=90?1:0},children:[l.jsx("img",{src:Je(t.imageUrl||""),alt:t.name,style:{width:"100%",height:"100%",objectFit:"cover",filter:`brightness(${1+d*.5}) contrast(${1-d*.2})`}}),l.jsx("div",{style:{position:"absolute",inset:0,background:"white",opacity:d,pointerEvents:"none"}})]}),l.jsxs("div",{style:{position:"absolute",inset:0,transform:"rotateY(180deg)",borderRadius:16,overflow:"hidden",background:"#1a202c",zIndex:j>90?2:1,opacity:j>90?1:0},children:[l.jsx("img",{src:Je(e&&e!==""?e:t.imageUrl||""),alt:`${t.name} Evolved`,style:{width:"100%",height:"100%",objectFit:"cover",filter:`brightness(${1+d*.5}) contrast(${1-d*.2})`}}),l.jsx("div",{style:{position:"absolute",inset:0,background:"white",opacity:d,pointerEvents:"none"}})]})]})]}),me&&l.jsxs("div",{style:{position:"absolute",left:n,top:r,pointerEvents:"none"},children:[l.jsx("style",{children:`
                        @keyframes landParticleMove {
                            0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                            100% { opacity: 0; transform: translate(-50%, -50%) rotate(var(--angle)) translateX(calc(var(--dist) * 1px)) scale(0); }
                        }
                    `}),Array(20).fill(0).map((we,Z)=>{const V=Z/20*360,Le=40+Math.random()*100;return l.jsx("div",{style:{position:"absolute",left:0,top:0,width:8*u,height:8*u,borderRadius:"50%",background:"white","--angle":`${V}deg`,"--dist":Le,animation:"landParticleMove 0.5s ease-out forwards"}},`land-${Z}`)})]})]})},vy=Je("/leaders/yoRuka_win.png"),_y=Je("/leaders/yoRuka_lose.png"),Dw=Je("/leaders/senka_win.png"),Mw=Je("/leaders/senka_lose.png"),Nw=Je("/leaders/azya_win.png"),jw=Je("/leaders/azya_lose.png"),Fw=({winnerId:t,playerId:e,playerClass:n,onRematch:r,onRematching:s,onLeave:i,isOnline:o,isRoomMatch:a=!0,myRematchRequested:c,opponentRematchRequested:u,battleStats:p,selectedCardInfo:h,onCardInfoClick:f,victoryReason:m="normal"})=>{const b=t===e,W=(()=>{if(!b)return null;switch(m){case"disconnect":return"";case"surrender":return"";default:return null}})(),[d,I]=D.useState("bg-fade"),S=["bg-fade","image","result-text","stats","rate","buttons","complete"].indexOf(d);D.useEffect(()=>{const y={"bg-fade":300,image:600,"result-text":400,stats:400,rate:300,buttons:0};if(d==="complete")return;const C={"bg-fade":"image",image:"result-text","result-text":"stats",stats:"rate",rate:"buttons",buttons:"complete"},x=setTimeout(()=>{const v=C[d];v&&I(v)},y[d]||0);return()=>clearTimeout(x)},[d]);const k=()=>n==="SENKA"?b?Dw:Mw:n==="AJA"?b?Nw:jw:b?vy:_y,[$,B]=D.useState(15),[te,J]=D.useState(!1),[me,he]=D.useState(null),ke=o?c||u:c||te;D.useEffect(()=>{if(ke)return;const y=setInterval(()=>{B(C=>C<=1?(clearInterval(y),i(),0):C-1)},1e3);return()=>clearInterval(y)},[i,ke]);const L=y=>{he(y),o&&!a&&s?s(y):r(y)},F=()=>{const y=!o||a?"":"";return o?c&&u?"...":c?"...":u?`${y}`:y:c?"...":y},fe=()=>{const y={padding:"15px 40px",fontSize:"1.5rem",fontWeight:"bold",border:"none",borderRadius:12,cursor:c?"default":"pointer",transform:"scale(1)",transition:"transform 0.1s, background 0.2s"};return u&&!c?{...y,background:"linear-gradient(135deg, #f6e05e, #d69e2e)",color:"black",boxShadow:"0 4px 15px rgba(246, 224, 94, 0.6)",animation:"pulse 1s infinite"}:c?{...y,background:"linear-gradient(135deg, #718096, #4a5568)",color:"white",boxShadow:"none"}:{...y,background:"linear-gradient(135deg, #48bb78, #38a169)",color:"white",boxShadow:"0 4px 15px rgba(72, 187, 120, 0.4)"}},ie=(y,C)=>({width:220,height:220,borderRadius:"50%",border:me===y?"5px solid #f6e05e":"4px solid rgba(255,255,255,0.4)",background:y==="AJA"?`url(${ra(y)}) center top/cover`:`url(${ra(y)}) center/cover`,cursor:"pointer",transform:C?"scale(1.1)":"scale(1)",transition:"all 0.2s ease",boxShadow:C?"0 0 30px rgba(246, 224, 94, 0.7)":"0 6px 15px rgba(0,0,0,0.5)"});return l.jsxs("div",{style:{position:"absolute",inset:0,zIndex:5e3,background:"rgba(0,0,0,0.85)",backdropFilter:"blur(10px)",display:"flex",flexDirection:"row",alignItems:"stretch",opacity:S>=0?1:0,transition:"opacity 0.3s ease-out"},onClick:()=>{},children:[l.jsx("style",{children:`
                @keyframes pulse {
                    0%, 100% { transform: scale(1); }
                    50% { transform: scale(1.05); }
                }
                @keyframes float {
                    0%, 100% { transform: translateY(0); }
                    50% { transform: translateY(-10px); }
                }
                @keyframes slideUpFadeIn {
                    0% { opacity: 0; transform: translateY(30px); }
                    100% { opacity: 1; transform: translateY(0); }
                }
                @keyframes imageFadeIn {
                    0% { opacity: 0; transform: scale(0.95); }
                    100% { opacity: 0.9; transform: scale(1); }
                }
            `}),l.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:40,borderRight:"1px solid rgba(255,255,255,0.1)"},children:h?l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:16,maxWidth:320},children:[l.jsx("div",{style:{width:200,height:280,backgroundImage:`url(${Je(`/cards/${h.id}.png`)})`,backgroundSize:"cover",backgroundPosition:"center",borderRadius:12,boxShadow:"0 8px 30px rgba(0,0,0,0.6)"}}),l.jsx("div",{style:{fontFamily:"var(--font-tamanegi)",fontSize:"1.6rem",color:"white",textShadow:"0 2px 6px rgba(0,0,0,0.6)",textAlign:"center"},children:h.name}),l.jsxs("div",{style:{display:"flex",gap:20,fontSize:"1.2rem",color:"rgba(255,255,255,0.9)"},children:[l.jsxs("span",{children:[": ",h.cost]}),h.type==="FOLLOWER"&&l.jsxs(l.Fragment,{children:[l.jsxs("span",{children:[": ",h.attack]}),l.jsxs("span",{children:[": ",h.health]})]})]}),l.jsx("div",{style:{fontSize:"1rem",color:"rgba(255,255,255,0.7)",textAlign:"center",lineHeight:1.5,maxHeight:120,overflow:"auto"},children:h.description||""}),l.jsx("button",{onClick:()=>f(null),style:{padding:"8px 24px",fontSize:"1rem",background:"transparent",border:"1px solid rgba(255,255,255,0.3)",color:"white",borderRadius:8,cursor:"pointer",marginTop:10},children:""})]}):l.jsx("div",{style:{width:"100%",height:"100%",backgroundImage:`url(${k()})`,backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat",opacity:S>=1?.9:0,transform:S>=1?"scale(1)":"scale(0.95)",transition:"opacity 0.6s ease-out, transform 0.6s ease-out"}})}),l.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:40,position:"relative"},children:[l.jsx("div",{style:{fontFamily:"var(--font-tamanegi)",fontSize:"5rem",color:b?"#f6e05e":"#a0aec0",textShadow:b?"0 0 40px rgba(246, 224, 94, 0.7), 4px 4px 8px rgba(0,0,0,0.6)":"0 0 20px rgba(160, 174, 192, 0.5), 4px 4px 8px rgba(0,0,0,0.6)",marginBottom:20,opacity:S>=2?1:0,transform:S>=2?"translateY(0)":"translateY(30px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out",animation:S>=2?"float 3s ease-in-out infinite":"none"},children:b?"":""}),W&&l.jsx("div",{style:{fontSize:"1.1rem",color:"rgba(255, 255, 255, 0.8)",marginTop:-10,marginBottom:20,opacity:S>=2?1:0,transform:S>=2?"translateY(0)":"translateY(20px)",transition:"opacity 0.4s ease-out 0.2s, transform 0.4s ease-out 0.2s"},children:W}),l.jsxs("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"center",gap:16,marginBottom:30,padding:"16px 24px",background:"rgba(0,0,0,0.3)",borderRadius:12,border:"1px solid rgba(255,255,255,0.1)",opacity:S>=3?1:0,transform:S>=3?"translateY(0)":"translateY(30px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out"},children:[l.jsxs("div",{style:{textAlign:"center",minWidth:80},children:[l.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#f6e05e"},children:p.turnCount}),l.jsx("div",{style:{fontSize:"0.9rem",color:"rgba(255,255,255,0.6)"},children:""})]}),l.jsxs("div",{style:{textAlign:"center",minWidth:80},children:[l.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#48bb78"},children:p.damageDealtToOpponent}),l.jsx("div",{style:{fontSize:"0.9rem",color:"rgba(255,255,255,0.6)"},children:""})]}),l.jsxs("div",{style:{textAlign:"center",minWidth:80},children:[l.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#e53e3e"},children:p.damageReceivedFromOpponent}),l.jsx("div",{style:{fontSize:"0.9rem",color:"rgba(255,255,255,0.6)"},children:""})]}),l.jsxs("div",{style:{textAlign:"center",minWidth:80},children:[l.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#63b3ed"},children:p.followersDestroyed}),l.jsx("div",{style:{fontSize:"0.9rem",color:"rgba(255,255,255,0.6)"},children:""})]})]}),l.jsx("div",{style:{position:"absolute",right:20,bottom:270,width:180,textAlign:"center",fontFamily:"var(--font-tamanegi)",fontSize:"1.4rem",color:b?"#f6e05e":"#e53e3e",textShadow:b?"0 0 20px rgba(246, 224, 94, 0.8), 2px 2px 4px rgba(0,0,0,0.8)":"0 0 20px rgba(229, 62, 62, 0.8), 2px 2px 4px rgba(0,0,0,0.8)",zIndex:10,opacity:S>=5?1:0,transition:"opacity 0.4s ease-out"},children:b?"":""}),te&&!c?l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",animation:"fadeIn 0.3s ease-out"},children:[l.jsx("div",{style:{fontFamily:"var(--font-tamanegi)",fontSize:"1.6rem",color:"white",marginBottom:24,textShadow:"0 2px 6px rgba(0,0,0,0.6)"},children:""}),l.jsxs("div",{style:{display:"flex",gap:40,marginBottom:24},children:[l.jsx(xy,{deckType:"SENKA",label:"",onSelect:L,getStyle:ie}),l.jsx(xy,{deckType:"AJA",label:"",onSelect:L,getStyle:ie})]}),l.jsx("button",{onClick:()=>J(!1),style:{padding:"10px 36px",fontSize:"1.1rem",fontWeight:"bold",background:"transparent",border:"2px solid rgba(255,255,255,0.3)",color:"white",borderRadius:10,cursor:"pointer",marginTop:8},children:""})]}):l.jsxs("div",{style:{display:"flex",gap:20,opacity:S>=5?1:0,transform:S>=5?"translateY(0)":"translateY(30px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out"},children:[l.jsx("button",{onClick:()=>{c||J(!0)},disabled:c,style:fe(),onMouseDown:y=>{c||(y.currentTarget.style.transform="scale(0.95)")},onMouseUp:y=>y.currentTarget.style.transform="scale(1)",children:F()}),l.jsxs("button",{onClick:i,style:{padding:"15px 40px",fontSize:"1.5rem",fontWeight:"bold",background:"transparent",border:"2px solid rgba(255,255,255,0.3)",color:"white",borderRadius:12,cursor:"pointer"},children:[" ",!ke&&`(${$})`]})]}),l.jsx("div",{onClick:()=>{te&&!c&&L("YORUKA")},style:{position:"absolute",right:20,bottom:20,width:180,height:240,backgroundImage:`url(${b?vy:_y})`,backgroundSize:"cover",backgroundPosition:"center",borderRadius:12,cursor:te&&!c?"pointer":"default",opacity:S>=5?.7:0,transition:"opacity 0.4s ease",boxShadow:"0 8px 20px rgba(0,0,0,0.4)"}})]})]})},xy=({deckType:t,label:e,onSelect:n,getStyle:r})=>{const[s,i]=D.useState(!1);return l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:12},children:[l.jsx("button",{onClick:()=>n(t),onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),style:r(t,s)}),l.jsx("span",{style:{color:"white",fontFamily:"var(--font-tamanegi)",fontSize:"1.4rem",textShadow:"0 2px 6px rgba(0,0,0,0.6)"},children:e})]})},Ey=(t,e)=>{const[n,r]=D.useState([]),s=D.useRef(!1);return D.useEffect(()=>{r(i=>{const o=[],a=new Map((t||[]).filter(c=>c).map(c=>[c.instanceId,c]));return i.forEach(c=>{var p;if(!c)return;const u=a.get(c.instanceId);u?(o.push({...u,passiveAbilities:u.passiveAbilities?[...u.passiveAbilities]:[],hasBarrier:u.hasBarrier??((p=u.passiveAbilities)==null?void 0:p.includes("BARRIER"))??!1,isDying:!1}),a.delete(c.instanceId)):o.push({...c,isDying:!0,killedByBane:c.killedByBane})}),a.forEach(c=>{var u;o.push({...c,passiveAbilities:c.passiveAbilities?[...c.passiveAbilities]:[],hasBarrier:c.hasBarrier??((u=c.passiveAbilities)==null?void 0:u.includes("BARRIER"))??!1,isDying:!1})}),o})},[t]),D.useEffect(()=>{if(n.some(o=>o.isDying)){if(e!=null&&e.current){s.current=!0;return}const o=setTimeout(()=>{r(a=>a.filter(c=>!c.isDying))},700);return()=>clearTimeout(o)}},[n,e]),D.useEffect(()=>{const o=setInterval(()=>{if(!(e!=null&&e.current)&&s.current){s.current=!1;const a=setTimeout(()=>{r(c=>c.filter(u=>!u.isDying))},300);return()=>clearTimeout(a)}},100);return()=>clearInterval(o)},[e]),n},$w=({playerClass:t,opponentType:e,gameMode:n,targetRoomId:r,onLeave:s,onRematching:i,networkAdapter:o,networkConnected:a,opponentClass:c,aiDifficulty:u="NORMAL",playerName:p,timerEnabled:h=!0})=>{var G0,V0,Y0,K0,X0,Q0,J0,q0,Z0;const f=n==="CPU"||!o,m=mw(f?n==="CPU"?"CPU":n:"CPU",f?r:void 0),b=o||m.adapter,R=a!==void 0?a:m.connected,W=Cw(),{scale:d,toGameX:I,toGameY:S}=W,{isLightMode:k}=nE(),[$,B]=U.useState(!1);U.useEffect(()=>{(()=>{B("ontouchstart"in window||navigator.maxTouchPoints>0)})()},[]);const te=U.useCallback((g,_)=>({x:I(g),y:S(_)}),[I,S]),[J,me]=U.useState(null),he=D.useRef(W);U.useEffect(()=>{he.current=W},[W]);const ke=n==="CPU"||n==="HOST"||(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&(b==null?void 0:b.isHost)===!0,L=ke?"p1":"p2",F=ke?"p2":"p1";console.log("[GameScreen INIT]",{gameMode:n,"adapter?.isHost":b==null?void 0:b.isHost,isHost:ke,currentPlayerId:L,connected:R,"networkAdapter provided":!!o,networkConnected:a});const fe=c||(t==="YORUKA"?Math.random()<.5?"SENKA":"AJA":t==="SENKA"?"AJA":"SENKA"),ie=n==="JOIN"||(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&!ke,[y,C]=U.useReducer(aw,null,()=>{const g=n==="CPU"?"CPU":"";return ie?uc(g,fe,p,t):uc(p,t,g,fe)}),[x,v]=U.useState(!ie),T=n==="CASUAL_MATCH"||n==="RANKED_MATCH",[w,O]=D.useState(T?!1:!ie),[q,j]=D.useState(!1),[ye,Ae]=D.useState(!1),[we,Z]=D.useState(!1),[V,Le]=D.useState(T),[be,Xe]=D.useState(!1),Se=D.useRef(!1);console.log("[GameScreen SYNC STATE]",{isCasualOrRanked:T,isJoinSide:ie,gameSynced:x,waitingForIntroSync:V,opponentReadyForIntro:be,showBattleIntro:w,"introSyncSentRef.current":Se.current});const[De,vt]=D.useState(!1),[$e,pt]=D.useState(null),[Qe,ot]=D.useState(0),[it,Tt]=D.useState({x:0,y:0}),[at,Ye]=D.useState("IDLE"),[Mt,Ht]=D.useState(null),[Cn,zn]=D.useState(!1),[dr,Xa]=D.useState(()=>Math.random()>.5),[Lu,Qa]=D.useState(!1),[a0,l0]=D.useState(!1),[sE,c0]=D.useState("normal"),[As,u0]=D.useState(t),[Ja,fo]=D.useState({turnCount:0,damageDealtToOpponent:0,damageReceivedFromOpponent:0,followersDestroyed:0,myFollowersDestroyed:0}),[iE,Du]=D.useState(null);D.useEffect(()=>{y.winnerId&&!De&&!we&&Z(!0)},[y.winnerId,De,we]),D.useEffect(()=>{if(Qe<=0){Tt({x:0,y:0});return}let g;const _=()=>{const E=Date.now()*.03,A=25*Qe*d,P=Math.sin(E*7)*A+Math.sin(E*13)*A*.5,H=Math.cos(E*11)*A+Math.cos(E*17)*A*.3;Tt({x:P,y:H}),g=requestAnimationFrame(_)};return g=requestAnimationFrame(_),()=>cancelAnimationFrame(g)},[Qe,d]);const[Mu,d0]=D.useState([]),oE=D.useRef(0),[Nu,f0]=D.useState(!1),[ju,qa]=D.useState(null),[po,ci]=D.useState(null),Sr=D.useRef(null),fr=D.useRef(null),pr=D.useRef(null),Fu=D.useRef(y.logs.length),Za=U.useRef(!1),p0=U.useRef(!1),el=U.useRef(null);U.useEffect(()=>{const g=n==="HOST"||(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&ke,_=T?R&&b:R&&b&&at==="DONE";if(console.log("[GameScreen INIT_GAME useEffect]",{isHostSide:g,isCasualOrRanked:T,connected:R,"adapter exists":!!b,coinTossPhase:at,canSendInitGame:_,"initialStateSentRef.current":Za.current}),g&&_&&!Za.current){console.log("[GameScreen] HOST side: Sending initial game state to JOIN"),Za.current=!0;const E=()=>{console.log("[GameScreen] HOST side: Actually sending INIT_GAME now, isFirstPlayer:",dr);const A=T?{...y,firstPlayerId:dr?"p1":"p2"}:y;b.send({type:"INIT_GAME",payload:A}),(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&(console.log("[GameScreen] HOST side: Sending READY_FOR_INTRO"),b.send({type:"READY_FOR_INTRO"}),Se.current=!0)};setTimeout(E,500),(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&setTimeout(()=>{be||(console.log("[GameScreen] HOST side: Retrying INIT_GAME (no response yet)"),E())},2500)}},[n,R,b,y,at,ke,T,be]),U.useEffect(()=>{!T||!b||!x||Se.current||ie&&(console.log("[GameScreen] JOIN side: Sending READY_FOR_INTRO after game sync"),b.send({type:"READY_FOR_INTRO"}),Se.current=!0)},[T,b,x,ie]),U.useEffect(()=>{!T||!b||!V||ke&&be&&Se.current&&(console.log("[GameScreen] HOST side: Both ready, sending START_INTRO"),b.send({type:"START_INTRO"}),Le(!1),O(!0))},[T,b,ke,be,V]);const se=y.players[L],Oe=y.players[F];U.useEffect(()=>{var _,E;const g=y.logs.length;if(g>Fu.current)for(let A=Fu.current;A<g;A++){const P=y.logs[A],H=P.match(/(.+?)  (\d+) /);if(H){const M=H[1],N=parseInt(H[2],10),G=(se==null?void 0:se.name)===M?L:F,ae=oE.current++;d0(Q=>[...Q,{playerId:G,amount:N,key:ae}]),setTimeout(()=>{d0(Q=>Q.filter(ue=>ue.key!==ae))},1500)}const X=P.match(/(.+?) (?:)?/);if(X){const M=X[1],N=(_=y.players[L])==null?void 0:_.board.find(ue=>(ue==null?void 0:ue.name)===M),G=(E=y.players[F])==null?void 0:E.board.find(ue=>(ue==null?void 0:ue.name)===M),ae=N||G,Q=N?L:F;if(ae){const ue=y.players[Q].board.findIndex(xe=>(xe==null?void 0:xe.instanceId)===ae.instanceId),We=(Q===L?hr.current:Zn.current)[ue];if(We){const xe=We.getBoundingClientRect(),ze=xe.left+xe.width/2,Ke=xe.top+xe.height/2;ul(Be=>[...Be,{id:Date.now()+Math.random(),value:0,x:ze,y:Ke,color:"#e53e3e"}])}}}}Fu.current=g},[y.logs.length,L,F,se==null?void 0:se.name,y.players]);const[$u,ho]=D.useState(!1),Cr=D.useRef(!1),gn=Ey(((G0=y.players[L])==null?void 0:G0.board)||[],Cr),on=Ey(((V0=y.players[F])==null?void 0:V0.board)||[],Cr),go=D.useRef(gn),tl=D.useRef(on),[Rs,nl]=D.useState(null),[Bu,h0]=D.useState(-1),rl=D.useRef(null),[ui,mo]=D.useState([]),[K,Tr]=D.useState(null),[lt,Hn]=D.useState(null),[aE,g0]=D.useState([]),lE=D.useRef(0),m0=D.useRef(0),y0=D.useRef(null),v0=D.useRef(K);v0.current=K,D.useEffect(()=>{const g=K==null?void 0:K.sourceType;if(!g||g!=="BOARD"&&g!=="EVOLVE"){g0([]);return}const _=400,E=setInterval(()=>{const A=v0.current;if(!A||A.sourceType!=="BOARD"&&A.sourceType!=="EVOLVE")return;const P=Date.now(),H=Math.PI*(3-Math.sqrt(5));m0.current+=H+(Math.random()-.5)*.3;const X=m0.current,M=4+Math.random()*3,N={id:lE.current++,x:A.currentX,y:A.currentY,vx:Math.cos(X)*M,vy:Math.sin(X)*M,opacity:1,radius:3+Math.random()*2,createdAt:P};g0(G=>[...G.filter(Q=>P-Q.createdAt<_).map(Q=>({...Q,x:Q.x+Q.vx,y:Q.y+Q.vy,opacity:Math.max(0,1-(P-Q.createdAt)/_)})),N])},80);return()=>clearInterval(E)},[K==null?void 0:K.sourceType]),D.useEffect(()=>{const g=(K==null?void 0:K.sourceType)==="EVOLVE";if(g&&!pr.current){const _=new Audio(Je("/se/aura.mp3"));_.loop=!0,_.volume=0,_.play().catch(()=>{}),pr.current=_;const E=300,A=30,P=E/A,H=.25/P;let X=0;const M=setInterval(()=>{X++,pr.current&&(pr.current.volume=Math.min(X*H,.25)),X>=P&&clearInterval(M)},A)}else if(!g&&pr.current){const _=pr.current,E=200,A=20,P=E/A,H=_.volume/P;let X=0;const M=setInterval(()=>{X++,_.volume=Math.max(0,_.volume-H),X>=P&&(clearInterval(M),_.pause(),_.currentTime=0)},A);pr.current=null}return()=>{!K&&pr.current&&(pr.current.pause(),pr.current=null)}},[K==null?void 0:K.sourceType]);const[_0,Uu]=D.useState(new Set),[x0,sl]=D.useState(null),[E0,il]=D.useState(null),[cE,b0]=D.useState(null),[Ne,Ir]=D.useState(null),zu=D.useCallback(g=>{const _=Or(g);_&&(y.winnerId?Du(_):Ir({card:_,owner:"OPPONENT",source:"LOG"}))},[y.winnerId]),uE=D.useCallback(g=>{const _=/([^]+)/g,E=[];let A=0,P,H=0;const X=tE();for(;(P=_.exec(g))!==null;){P.index>A&&E.push(l.jsx("span",{children:g.slice(A,P.index)},H++));const M=P[1];X.includes(M)?E.push(l.jsxs("span",{style:{color:"#ffd700",cursor:"pointer",textDecoration:"underline",textUnderlineOffset:"2px",fontWeight:"bold"},onMouseEnter:G=>{G.target.style.color="#ffec8b",G.target.style.textShadow="0 0 8px rgba(255, 215, 0, 0.8)"},onMouseLeave:G=>{G.target.style.color="#ffd700",G.target.style.textShadow="none"},onClick:G=>{G.stopPropagation(),zu(M)},children:["",M,""]},H++)):E.push(l.jsxs("span",{children:["",M,""]},H++)),A=P.index+P[0].length}return A<g.length&&E.push(l.jsx("span",{children:g.slice(A)},H++)),E.length>0?l.jsx(l.Fragment,{children:E}):g},[zu]),[ol,di]=D.useState([]),Bt=(g,_,E,A)=>{if(!g)return;let P=window.innerWidth/2,H=window.innerHeight/2;const X=_===F;if(E===void 0||E===-1){const N=X?pi:Ps;if(N.current){const G=N.current.getBoundingClientRect(),ae=te(G.left+G.width/2,G.top+G.height/2);P=ae.x,H=ae.y}else H=X?150:rE-250}else if(E!==void 0&&E>=0){const N=X?Zn:hr,G=X?tl.current:go.current;let ae=E;if(A){const ue=G.findIndex(ve=>ve&&ve.instanceId===A);ue>=0&&(ae=ue)}const Q=N.current[ae];if(Q){const ue=Q.getBoundingClientRect(),ve=te(ue.left+ue.width/2,ue.top+ue.height/2);P=ve.x,H=ve.y}}di(N=>[...N,{type:g,x:P,y:H,key:Date.now()+Math.random()}])},S0=(g,_,E,A,P)=>{let H=window.innerWidth/2,X=window.innerHeight/2;const M=g===F,N=M?Zn:hr,G=M?tl.current:go.current;let ae=_;if(P){const ue=G.findIndex(ve=>ve&&ve.instanceId===P);ue>=0&&(ae=ue)}const Q=N.current[ae];if(Q){const ue=Q.getBoundingClientRect(),ve=te(ue.left+ue.width/2,ue.top+ue.height/2);H=ve.x,X=ve.y}di(ue=>[...ue,{type:"BUFF",x:H,y:X,key:Date.now()+Math.random(),atkBuff:E,hpBuff:A}])},qn=(g,_,E,A)=>{Bt(g,_,E,A),n==="HOST"&&R&&b&&b.send({type:"EFFECT",payload:{effectType:g,targetPlayerId:_||"",targetIndex:E??-1,targetInstanceId:A}})},yo=(g,_,E,A,P)=>{S0(g,_,E,A,P),n==="HOST"&&R&&b&&b.send({type:"EFFECT",payload:{effectType:"BUFF",targetPlayerId:g,targetIndex:_,targetInstanceId:P,isBuff:!0,atkBuff:E,hpBuff:A}})},C0=D.useRef([]),T0=D.useRef([]);D.useEffect(()=>{var A,P;const g=(H,X,M)=>{X.forEach(N=>{if(!N)return;if(!H.find(ae=>ae&&ae.instanceId===N.instanceId)&&N.killedByBane){const ae=M===F,Q=ae?Zn:hr,ve=(ae?tl.current:go.current).findIndex(We=>We&&We.instanceId===N.instanceId);if(ve>=0&&Q.current[ve]){const xe=Q.current[ve].getBoundingClientRect(),ze=te(xe.left+xe.width/2,xe.top+xe.height/2);di(Ke=>[...Ke,{type:"BANE",x:ze.x,y:ze.y,key:Date.now()+Math.random()}])}}})},_=((A=y.players[L])==null?void 0:A.board)||[],E=((P=y.players[F])==null?void 0:P.board)||[];g(_,C0.current,L),g(E,T0.current,F),C0.current=_.map(H=>H?{...H}:null),T0.current=E.map(H=>H?{...H}:null)},[y.players,L,F]);const Hu=600,[Gr,vo]=D.useState(null),Wu=D.useRef({player:0,opponent:0}),[bt,_o]=D.useState(()=>{try{const g=localStorage.getItem("audioSettings");if(g){const _=JSON.parse(g);if(_.enabled!==void 0){const{enabled:E,...A}=_;return{...A,bgmEnabled:E,seEnabled:E}}return _}return{bgm:.3,se:.5,voice:.5,bgmEnabled:!0,seEnabled:!0}}catch{return{bgm:.3,se:.5,voice:.5,bgmEnabled:!0,seEnabled:!0}}}),ht=D.useCallback((g,_=.5)=>{if(!bt.seEnabled)return;const E=new Audio(Je(`/se/${g}`));E.volume=bt.se*_,E.play().catch(A=>console.warn("SE Play prevented",A))},[bt]),al=D.useRef(null);D.useEffect(()=>{if(K&&lt&&!al.current)ht("Buon.mp3",.25);else if(K&&lt&&al.current){const g=al.current;(g.instanceId!==lt.instanceId||g.index!==lt.index||g.playerId!==lt.playerId)&&ht("Buon.mp3",.25)}al.current=lt},[lt,K,ht]);const mn=D.useRef(null),[dE,I0]=D.useState(!1);D.useEffect(()=>{localStorage.setItem("audioSettings",JSON.stringify(bt)),mn.current&&(mn.current.volume=bt.bgmEnabled?bt.bgm:0,bt.bgmEnabled?mn.current.paused&&mn.current.play().catch(g=>console.warn("Auto-play prevented",g)):mn.current.pause())},[bt]);const[fE,ll]=D.useState(!1),[pE,Gu]=D.useState(!1),[hE,cl]=D.useState(!1),gE=D.useCallback(()=>{console.log("[GameScreen] handleSurrender called"),cl(!1),ll(!1),n!=="CPU"&&b&&b.send({type:"SURRENDER",payload:{playerId:L}}),C({type:"CONCEDE",playerId:L})},[n,b,L]),[kr,Vu]=D.useState(!1),Yu=D.useRef(!1),[k0,w0]=D.useState(!1),[Ze,Os]=D.useState(null),fi=D.useRef(null),pi=D.useRef(null),Zn=D.useRef([]),hr=D.useRef([]),Ps=D.useRef(null),[mE,ul]=D.useState([]),dl=D.useRef({player:20,opponent:20}),fl=D.useRef({player:0,opponent:0}),xo=D.useRef(new Map);D.useEffect(()=>{var P,H,X,M;if(!se||!Oe)return;const g=dl.current.opponent-Oe.hp;g>0&&fo(N=>({...N,damageDealtToOpponent:N.damageDealtToOpponent+g}));const _=dl.current.player-se.hp;_>0&&fo(N=>({...N,damageReceivedFromOpponent:N.damageReceivedFromOpponent+_}));const E=fl.current.opponent-(((P=Oe.board)==null?void 0:P.filter(N=>N).length)||0);E>0&&fo(N=>({...N,followersDestroyed:N.followersDestroyed+E}));const A=fl.current.player-(((H=se.board)==null?void 0:H.filter(N=>N).length)||0);A>0&&fo(N=>({...N,myFollowersDestroyed:N.myFollowersDestroyed+A})),dl.current={player:se.hp,opponent:Oe.hp},fl.current={player:((X=se.board)==null?void 0:X.filter(N=>N).length)||0,opponent:((M=Oe.board)==null?void 0:M.filter(N=>N).length)||0}},[se==null?void 0:se.hp,Oe==null?void 0:Oe.hp,(Y0=se==null?void 0:se.board)==null?void 0:Y0.length,(K0=Oe==null?void 0:Oe.board)==null?void 0:K0.length]);const qt=D.useRef(null),A0="lastPlayedBgm",R0=D.useCallback(g=>{const _={AJA:[Je("/bgm/Green Misty Mountains.mp3"),Je("/bgm/Jade Moon.mp3"),Je("/bgm/amaama.mp3"),Je("/bgm/kingetsu.mp3")],SENKA:[Je("/bgm/ouka.mp3"),Je("/bgm/Jade Moon.mp3"),Je("/bgm/amaama.mp3"),Je("/bgm/kingetsu.mp3")]},E=_[g]||_.SENKA,A=sessionStorage.getItem(A0),P=E.length>1?E.filter(X=>X!==A):E,H=P[Math.floor(Math.random()*P.length)];return sessionStorage.setItem(A0,H),encodeURI(H)},[]),[Ku,O0]=D.useState(null);D.useEffect(()=>{var g,_;if(console.log(`[PendingEffects] useEffect fired. isProcessingEffect=${$u}, pendingEffects.length=${((g=y.pendingEffects)==null?void 0:g.length)||0}, gameMode=${n}`),n==="JOIN"){console.log("[PendingEffects] Early return: JOIN mode waits for EFFECT messages from HOST");return}if($u){console.log("[PendingEffects] Early return: isProcessingEffect=true");return}if(y.pendingEffects&&y.pendingEffects.length>0){const E=y.pendingEffects[0];if(console.log(`[PendingEffects] Processing effect: ${E.effect.type} from ${E.sourceCard.name}`),rl.current===E){console.log("[PendingEffects] Early return: same effect already processed");return}if(rl.current=E,ho(!0),Cr.current=!0,E.effect.type==="GENERATE_CARD"&&E.effect.targetCardId){const de=[E],Y=y.pendingEffects||[];for(let Te=1;Te<Y.length;Te++){const ge=Y[Te];if(ge.effect.type==="GENERATE_CARD"&&ge.sourceCard.id===E.sourceCard.id&&ge.sourcePlayerId===E.sourcePlayerId)de.push(ge);else break}const oe=120,ee=20,z=-(de.length*oe+(de.length-1)*ee-oe)/2,ne=E.sourcePlayerId===L,pe=ne?window.innerWidth-200*d:200*d,Re=ne?window.innerHeight-100*d:100*d,Ee=de.map((Te,ge)=>({card:Or(Te.effect.targetCardId),status:"APPEAR",targetX:pe,targetY:Re,xOffset:z+ge*(oe+ee)})).filter(Te=>Te.card);if(Ee.length>0){mo(Ee),qt.current&&clearTimeout(qt.current),qt.current=setTimeout(()=>{mo(Te=>Te.map(ge=>({...ge,status:"FLY"}))),qt.current=setTimeout(()=>{mo([]),ho(!1),Cr.current=!1,(n==="CPU"||n==="HOST")&&(de.forEach(Te=>{C({type:"RESOLVE_EFFECT",playerId:Te.sourcePlayerId,payload:{targetId:Te.targetId}})}),n==="HOST"&&R&&b&&setTimeout(()=>{const Te=qe.current;b.send({type:"GAME_STATE",payload:Te})},50)),qt.current=null},600)},800);return}}const A=E.effect.type==="DAMAGE"||E.effect.type==="AOE_DAMAGE"||E.effect.type==="RANDOM_DAMAGE"||E.effect.type==="RANDOM_DAMAGE_BY_TURN",P=E.effect.type==="DESTROY"||E.effect.type==="RANDOM_DESTROY",H=E.effect.type==="HEAL_LEADER",X=E.effect.type==="RANDOM_SET_HP",M=E.effect.type==="SET_MAX_HP",N=E.effect.type==="RETURN_TO_HAND",G=E.effect.type==="SUMMON_CARD"||E.effect.type==="SUMMON_CARD_RUSH",ae=E.effect.type==="VISUAL_BUFF_ONLY",Q=E.effect.type==="BUFF_STATS",ue=H||N||G||ae||Q?600:50;if(A){let de=E.sourceCard.attackEffectType||"SLASH";E.sourceCard.id==="c_alice"&&E.effect.targetType==="SELECT_FOLLOWER"&&(de="WATER");const Y=E.sourcePlayerId===L?F:L,oe=Y===L?gn:on;if(E.effect.type==="AOE_DAMAGE")y.players[Y].board.forEach(re=>{if(re){const z=oe.findIndex(ne=>(ne==null?void 0:ne.instanceId)===re.instanceId);z!==-1&&qn(de,Y,z,re.instanceId)}});else if(E.targetIds)E.effect.type==="RANDOM_DAMAGE_BY_TURN"?E.targetIds.forEach((re,z)=>{setTimeout(()=>{const ne=oe.findIndex(pe=>(pe==null?void 0:pe.instanceId)===re);ne!==-1&&qn(de,Y,ne,re)},z*300)}):E.targetIds.forEach(ee=>{const re=oe.findIndex(z=>(z==null?void 0:z.instanceId)===ee);re!==-1&&qn(de,Y,re,ee)});else if(E.effect.targetType==="OPPONENT")qn(de,Y,-1),Dn();else if(E.targetId){const ee=oe.findIndex(re=>(re==null?void 0:re.instanceId)===E.targetId);ee!==-1&&qn(de,Y,ee,E.targetId)}}else if(P){let de=E.sourceCard.attackEffectType||"IMPACT";const Y=E.sourcePlayerId===L?F:L,oe=Y===L?gn:on;if(E.effect.targetType==="ALL_OTHER_FOLLOWERS"){oe.forEach((z,ne)=>{z&&z.instanceId!==E.sourceCard.instanceId&&qn(de,Y,ne,z.instanceId)});const ee=E.sourcePlayerId;(ee===L?gn:on).forEach((z,ne)=>{z&&z.instanceId!==E.sourceCard.instanceId&&qn(de,ee,ne,z.instanceId)}),Dn()}else if(E.targetIds)E.targetIds.forEach(ee=>{const re=oe.findIndex(z=>(z==null?void 0:z.instanceId)===ee);re!==-1&&qn(de,Y,re,ee)});else if(E.targetId){const ee=oe.findIndex(re=>(re==null?void 0:re.instanceId)===E.targetId);ee!==-1&&qn(de,Y,ee,E.targetId)}}else if(H){const de=E.sourcePlayerId;qn("HEAL",de)}else if(M){const de=E.sourcePlayerId===L?F:L;qn("RAY",de,-1),Dn()}if(E.effect.type==="BUFF_STATS"){const de=E.effect.value??0,Y=E.effect.value2??0,oe=E.sourcePlayerId;if(E.effect.targetType==="SELF"){const re=(oe===L?gn:on).findIndex(z=>(z==null?void 0:z.instanceId)===E.sourceCard.instanceId);re!==-1&&yo(oe,re,de,Y,E.sourceCard.instanceId)}else if(E.effect.targetType==="ALL_FOLLOWERS"){const ee=oe===L?gn:on,re=y.players[oe].board,z=E.effect.conditions;re.forEach(ne=>{var pe;if(ne){if(z!=null&&z.tag&&!((pe=ne.tags)!=null&&pe.includes(z.tag))||z!=null&&z.nameIn&&!z.nameIn.includes(ne.name))return;const Re=ee.findIndex(Ee=>(Ee==null?void 0:Ee.instanceId)===ne.instanceId);Re!==-1&&yo(oe,Re,de,Y,ne.instanceId)}})}else if(E.effect.targetType==="ALL_OTHER_FOLLOWERS"){const ee=oe===L?gn:on,re=y.players[oe].board,z=E.effect.conditions;re.forEach(ne=>{var pe;if(ne&&ne.instanceId!==E.sourceCard.instanceId){if(z!=null&&z.tag&&!((pe=ne.tags)!=null&&pe.includes(z.tag))||z!=null&&z.nameIn&&!z.nameIn.includes(ne.name))return;const Re=ee.findIndex(Ee=>(Ee==null?void 0:Ee.instanceId)===ne.instanceId);Re!==-1&&yo(oe,Re,de,Y,ne.instanceId)}})}else if(E.targetId){const re=(oe===L?gn:on).findIndex(z=>(z==null?void 0:z.instanceId)===E.targetId);re!==-1&&yo(oe,re,de,Y,E.targetId)}}if(ae){const de=E.effect.value??0,Y=E.effect.value2??0,oe=E.sourcePlayerId,ee=E.sourceCard;setTimeout(()=>{const re=oe===L?gn:on;if(ee!=null&&ee.instanceId){const z=re.findIndex(ne=>(ne==null?void 0:ne.instanceId)===ee.instanceId);z!==-1&&yo(oe,z,de,Y,ee.instanceId)}},300)}qt.current&&clearTimeout(qt.current);const We=A||P||X||M,xe=E.effect.type==="RANDOM_DAMAGE_BY_TURN",ze=xe?((_=E.targetIds)==null?void 0:_.length)||y.turnCount:1,Ke=xe?ze*300+300:0,Be=xe?Ke:We?700:ue,Ue=xe?200:We?700:0;qt.current=setTimeout(()=>{(n==="CPU"||n==="HOST")&&(C({type:"RESOLVE_EFFECT",playerId:E.sourcePlayerId,payload:{targetId:E.targetId}}),n==="HOST"&&R&&b&&setTimeout(()=>{const de=qe.current;b.send({type:"GAME_STATE",payload:de})},50)),Ue>0?qt.current=setTimeout(()=>{ho(!1),Cr.current=!1,qt.current=null},Ue):(ho(!1),Cr.current=!1,qt.current=null)},Be)}else rl.current=null,qt.current&&(clearTimeout(qt.current),qt.current=null)},[y.pendingEffects,$u,L,F,n,R,b]),D.useEffect(()=>{if(y.activePlayerId!==L)return;const g=L===y.firstPlayerId,_=y.turnCount,E=g?5:4;if(_===(g?7:6)){if(Bu===_)return;nl("SUPER_EVOLVE_READY"),h0(_),setTimeout(()=>nl(null),2500)}else if(_===E){if(Bu===_)return;nl("EVOLVE_READY"),h0(_),setTimeout(()=>nl(null),2500)}},[y.turnCount,y.activePlayerId,L,Bu,y.firstPlayerId]);const pl=D.useRef(y.players);D.useEffect(()=>{const g=pl.current,_=new Set;if(Object.keys(y.players).forEach(E=>{const A=y.players[E],P=g[E];if(!P)return;const H=new Set(P.board.filter(M=>M).map(M=>M.instanceId)),X=new Set(P.hand.filter(M=>M).map(M=>M.instanceId));A.board.forEach(M=>{if(!M)return;const N=M.instanceId;!H.has(N)&&!X.has(N)&&_.add(N)})}),_.size>0){Uu(A=>new Set([...A,..._]));const E=setTimeout(()=>{Uu(new Set)},1e3);return()=>clearTimeout(E)}},[y.players]),D.useEffect(()=>{const g=pl.current,_=y.players;let E=[];const A=P=>{const H=P.getBoundingClientRect();return{x:H.left+H.width/2,y:H.top+H.height/2}};Object.keys(_).forEach(P=>{const H=_[P],X=g[P];if(X&&H.hp<X.hp){const M=X.hp-H.hp,G=P===L?Ps.current:pi.current;if(G){const ae=A(G);E.push({id:Date.now()+Math.random(),value:M,x:ae.x,y:ae.y,color:"#e53e3e"})}}else if(X&&H.hp>X.hp){const M=H.hp-X.hp,G=P===L?Ps.current:pi.current;if(G){const ae=A(G);E.push({id:Date.now()+Math.random(),value:"+"+M,x:ae.x,y:ae.y,color:"#48bb78"})}}X==null||X.board.forEach(M=>{if(!M)return;const N=H.board.find(G=>(G==null?void 0:G.instanceId)===M.instanceId);if(N){const G=H.board.findIndex(ve=>(ve==null?void 0:ve.instanceId)===N.instanceId),ue=(P===L?hr.current:Zn.current)[G];if(ue){const ve=A(ue);if(xo.current.set(M.instanceId,ve),N.currentHealth<M.currentHealth){const We=M.currentHealth-N.currentHealth;E.push({id:Date.now()+Math.random(),value:We,x:ve.x,y:ve.y,color:"#e53e3e"})}else if(N.currentHealth>M.currentHealth){const We=N.hasEvolved&&!M.hasEvolved,xe=N.currentAttack!==M.currentAttack||N.maxHealth!==M.maxHealth;if(!We&&!xe){const ze=N.currentHealth-M.currentHealth;E.push({id:Date.now()+Math.random(),value:"+"+ze,x:ve.x,y:ve.y,color:"#48bb78"})}}else N.currentHealth===M.currentHealth&&M.hasBarrier&&!N.hasBarrier&&E.push({id:Date.now()+Math.random(),value:0,x:ve.x,y:ve.y,color:"#e53e3e"})}}else{const G=H.graveyard.find(Q=>Q.instanceId===M.instanceId);let ae=0;if(G){const Q=G.currentHealth||0;Q<=0?ae=M.currentHealth-Q:ae=0}else ae=M.currentHealth;if(ae>0){const Q=xo.current.get(M.instanceId);Q&&(Q.x!==0||Q.y!==0)&&E.push({id:Date.now()+Math.random(),value:ae,x:Q.x,y:Q.y,color:"#e53e3e"})}xo.current.delete(M.instanceId)}})}),E.length>0&&(ul(H=>[...H,...E]),E.some(H=>H.color!=="#48bb78")&&Dn()),pl.current=_},[y.players,L,F]);const Xu=D.useRef(null),Dn=()=>{Xu.current||(w0(!0),Xu.current=setTimeout(()=>{w0(!1),Xu.current=null},300))},Qu=U.useCallback(g=>{ul([]),di([]),mo([]),Mn(null),hi(null),vo(null),Uu(new Set),Vr.current=!1,Ju.current=null,fo({turnCount:0,damageDealtToOpponent:0,damageReceivedFromOpponent:0,followersDestroyed:0,myFollowersDestroyed:0}),dl.current={player:20,opponent:20},fl.current={player:0,opponent:0},Du(null),Z(!1),vt(!1),pt(null),Qa(!1),l0(!1);const _=g||As;g&&u0(g);let E=fe;e==="CPU"&&(_==="YORUKA"?E=Math.random()<.5?"SENKA":"AJA":E=_==="SENKA"?"AJA":"SENKA");const P=uc(p,_,e==="ONLINE"?"":"CPU",E);pl.current=P.players,Wu.current={player:P.players.p1.hand.length,opponent:P.players.p2.hand.length},O0(null),O(n!=="JOIN"),Xa(Math.random()>.5),Ye("IDLE"),Ht(null),zn(!1),n==="HOST"&&(Za.current=!1),C({type:"SYNC_STATE",payload:P})},[As,fe,e,n]),yE=U.useCallback(()=>{if(O(!1),j(!1),Ae(!0),Ht(dr?"FIRST":"SECOND"),!dr){const g={...y,activePlayerId:"p2",firstPlayerId:"p2",players:{p1:{...y.players.p1,maxPp:0,pp:0},p2:{...y.players.p2,maxPp:1,pp:1}},logs:[` 1 - ${y.players.p2.name} `]};C({type:"SYNC_STATE",payload:g})}Ye("DONE")},[y,dr]);U.useEffect(()=>{},[y.phase,at,n,ht,R]),D.useEffect(()=>{if(Ku===se.class&&mn.current)return;const g=R0(se.class);console.log(`[BGM] Initializing track: ${g} for class: ${se.class}`),mn.current&&(mn.current.pause(),mn.current=null);const _=new Audio(g);_.loop=!0,_.volume=bt.bgm,mn.current=_,O0(se.class)},[se.class,R0,Ku]),D.useEffect(()=>()=>{mn.current&&(console.log("[GameScreen] Stopping BGM on unmount"),mn.current.pause(),mn.current=null)},[]),D.useEffect(()=>{if(!mn.current)return;const g=mn.current,_=()=>{g.paused&&bt.bgmEnabled&&(console.log("[BGM] Attempting play on interaction..."),g.play().then(()=>{console.log("[BGM] Play success"),E()}).catch(A=>console.warn("[BGM] Play failed on interaction:",A)))},E=()=>{document.removeEventListener("click",_),document.removeEventListener("keydown",_),document.removeEventListener("touchstart",_)};return bt.bgmEnabled?(document.addEventListener("click",_),document.addEventListener("keydown",_),document.addEventListener("touchstart",_),g.play().then(()=>{console.log("[BGM] Immediate play success"),E()}).catch(()=>console.log("[BGM] Immediate play blocked, waiting for interaction"))):(g.pause(),E()),()=>{E()}},[bt.bgmEnabled,bt.bgm,Ku]),U.useEffect(()=>{if(!b){console.log("[GameScreen] Message handler setup skipped - no adapter yet");return}console.log("[GameScreen] Setting up message handler, adapter.isHost:",b.isHost);const g=_=>{var E,A,P,H,X;if(console.log("[GameScreen] Received message:",_.type,_),_.type==="HANDSHAKE"){const M=(E=_.payload)==null?void 0:E.name,N=typeof M=="string"&&M.trim().slice(0,12)||"";console.log("[GameScreen] Received HANDSHAKE from opponent:",N),el.current=N,C({type:"UPDATE_PLAYER_NAME",payload:{playerId:L==="p1"?"p2":"p1",name:N}});return}if(_.type==="INIT_GAME"){console.log("[GameScreen] JOIN side: Received initial game state from HOST"),C({type:"SYNC_STATE",payload:_.payload}),C({type:"UPDATE_PLAYER_NAME",payload:{playerId:L,name:p}});const M=L==="p1"?"p2":"p1";el.current&&(console.log("[GameScreen] Re-applying opponent name after INIT_GAME:",el.current),C({type:"UPDATE_PLAYER_NAME",payload:{playerId:M,name:el.current}})),v(!0);const N=_.payload.firstPlayerId===L;console.log("[GameScreen] JOIN side: Setting isFirstPlayer, firstPlayerId:",_.payload.firstPlayerId,"currentPlayerId:",L,"isJoinSideFirst:",N),Xa(N),n==="CASUAL_MATCH"||n==="RANKED_MATCH"?console.log("[GameScreen] CASUAL_MATCH JOIN side: Waiting for intro sync"):O(!0);return}if(_.type==="READY_FOR_INTRO"){console.log("[GameScreen] Received READY_FOR_INTRO from opponent"),Xe(!0);return}if(_.type==="START_INTRO"){console.log("[GameScreen] Received START_INTRO - starting BattleIntro now"),Le(!1),O(!0);return}if(_.type==="GAME_STATE"){console.log("[GameScreen] JOIN: Received GAME_STATE sync from HOST"),C({type:"SYNC_STATE",payload:_.payload}),ho(!1),Cr.current=!1,rl.current=null,mo([]),qt.current&&(clearTimeout(qt.current),qt.current=null),!bo.current&&!mi.current&&(an.current=!1);return}if(_.type==="EFFECT"){const{effectType:M,targetPlayerId:N,targetIndex:G,targetInstanceId:ae,isBuff:Q,atkBuff:ue,hpBuff:ve}=_.payload;console.log("[GameScreen] JOIN: Received EFFECT from HOST:",M,N,G,ae),setTimeout(()=>{Q&&ue!==void 0&&ve!==void 0?S0(N,G,ue,ve,ae):Bt(M,N,G,ae)},50);return}if(_.type==="EVOLVE_ANIM"){const{playerId:M,followerIndex:N,useSep:G,targetId:ae,instanceId:Q}=_.payload,ue=(A=y.players[M])==null?void 0:A.board[N];if(ue){const ve=ue.evolvedImageUrl||((P=Or(ue.id))==null?void 0:P.evolvedImageUrl),We=Q||ue.instanceId,xe=on.findIndex(Y=>Y&&Y.instanceId===We),ze=xe>=0?Zn.current[xe]:null,Ke=he.current.scale,Be=window.innerHeight/2;let Ue=window.innerWidth/2,de=Be-70*Ke;if(ze){const Y=ze.getBoundingClientRect();Ue=Y.left+Y.width/2,de=Y.top+Y.height/2}hi({card:ue,evolvedImageUrl:ve,startX:Ue,startY:de,phase:"ZOOM_IN",followerIndex:N,sourcePlayerId:M,useSep:G||!1,targetId:ae,isRemote:!0}),ht("fon.mp3",.7)}return}if(_.type==="PLAY_CARD_ANIM"){const{playerId:M,card:N,targetBoardIndex:G}=_.payload;if(N){const ae=((H=y.players[M])==null?void 0:H.board)||[],Q=typeof G=="number"?G:ae.filter(z=>z!==null).length,ue=he.current.scale,ve=window.innerWidth/2,We=window.innerHeight/2,xe=ve,ze=80*ue,Ke=ve,Be=We-100*ue,oe=-((Math.max(1,Q+1)-1)*Ds*ue)/2+Q*Ds*ue,ee=ve+oe,re=We-70*ue;N.type==="SPELL"?Mn({card:N,sourceIndex:-1,startX:xe,startY:ze,targetX:Ke,targetY:Be,playerClass:(Oe==null?void 0:Oe.class)||"SENKA",onComplete:()=>{Mn(null)}}):Mn({card:N,sourceIndex:-1,startX:xe,startY:ze,targetX:Ke,targetY:Be,finalX:ee,finalY:re,playerClass:(Oe==null?void 0:Oe.class)||"SENKA",onComplete:()=>{ht("gan.mp3",.6),Dn(),Mn(null)}})}return}if(_.type==="REMATCH_REQUEST"){console.log("[GameScreen] Opponent requested rematch"),l0(!0);return}if(_.type==="REMATCH_ACCEPT"){console.log("[GameScreen] Opponent accepted rematch - starting new game"),Qu(As);return}if(_.type==="SURRENDER"){const M=(X=_.payload)==null?void 0:X.playerId;if(y.phase==="GAME_OVER"){console.warn("[GameScreen] Ignoring SURRENDER - game already over");return}if(M===L){console.warn(`[GameScreen] Security Alert: Received SURRENDER message targeting self (${L}). Ignoring.`);return}if(M!==F){console.warn(`[GameScreen] Security Alert: Invalid playerId in SURRENDER: ${M}. Expected: ${F}. Ignoring.`);return}console.log("[GameScreen] Opponent surrendered:",M),c0("surrender"),C({type:"CONCEDE",playerId:M});return}if(_.type==="STAMP"){console.log("[GameScreen] Opponent sent stamp:",_.stampId),fr.current&&(clearTimeout(fr.current),fr.current=null);const M=py(_.stampId);M&&ht(M,.6);const N={stampId:_.stampId,playerId:F,playerClass:_.playerClass||(Oe==null?void 0:Oe.class)||"SENKA",timestamp:Date.now()};ci(null),requestAnimationFrame(()=>{ci(N)}),fr.current=setTimeout(()=>{ci(G=>(G==null?void 0:G.timestamp)===N.timestamp?null:G),fr.current=null},3e3);return}if(_.type==="ACTION"){const M=_.payload;if(console.log("[GameScreen] Processing remote action:",M.type,"from player:",M.playerId),C({...M,isRemote:!0}),M.type==="ATTACK"){const{playerId:N,payload:G}=M,ae=y.players[N],Q=ae==null?void 0:ae.board[G.attackerIndex],ue=G.targetIsLeader?-1:G.targetIndex,ve=N==="p1"?"p2":"p1";if(Q){const We=y.players[ve],xe=G.targetIsLeader?null:We==null?void 0:We.board[G.targetIndex],ze=xe?xe.instanceId:void 0;Bt(Q.attackEffectType,ve,ue,ze)}}else M.type==="PLAY_CARD"||M.type==="EVOLVE"||M.type==="END_TURN"&&(console.log("[GameScreen] Remote END_TURN received, turn switching to:",M.playerId==="p1"?"p2":"p1"),gi.current=!1)}};return b.onMessage(g),n!=="CPU"&&!p0.current&&(p0.current=!0,b.send({type:"HANDSHAKE",payload:{name:p,class:t}}),console.log("[GameScreen] Sent HANDSHAKE:",p,t)),b.onClose(()=>{if((n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&y.phase==="GAME_OVER"){console.log("[GameScreen] Connection closed after game over (casual match) - silent disconnect");return}if(n!=="CPU"&&y.phase!=="GAME_OVER"){console.log("[GameScreen] Opponent disconnected during game - treating as surrender, player wins"),c0("disconnect");const _={...y,phase:"GAME_OVER",winnerId:L,logs:[...y.logs,""]};C({type:"SYNC_STATE",payload:_});return}alert(`
`),s()}),()=>{}},[b,y,ht,Bt,n,s,L]);const Vr=D.useRef(!1),Ju=D.useRef(null),Tn=D.useRef(null),[He,Mn]=D.useState(null),[At,hi]=D.useState(null),an=D.useRef(!1),Eo=D.useRef(null),gi=D.useRef(!1),qu=D.useRef(ol),Zu=D.useRef(ui),bo=D.useRef(He),mi=D.useRef(At);U.useEffect(()=>{qu.current=ol,Zu.current=ui,bo.current=He,mi.current=At},[ol,ui,He,At]),U.useEffect(()=>{if(He&&He.card.name===""&&bt.seEnabled){const g=new Audio(Je("/se/beam.mp3"));g.volume=bt.se*.8,g.play().catch(_=>console.warn("SE Play prevented",_))}},[He,bt]),U.useEffect(()=>{go.current=gn,tl.current=on},[gn,on]),U.useEffect(()=>{const g=_=>{const E=_.getBoundingClientRect();return{x:E.left+E.width/2,y:E.top}};gn.forEach((_,E)=>{if(_&&_.instanceId){const A=hr.current[E];if(A){const P=g(A);(P.x!==0||P.y!==0)&&xo.current.set(_.instanceId,P)}}}),on.forEach((_,E)=>{if(_&&_.instanceId){const A=Zn.current[E];if(A){const P=g(A);(P.x!==0||P.y!==0)&&xo.current.set(_.instanceId,P)}}})},[gn,on]);const hl=(g,_,E,A)=>{const P=gr.current.board,H=A?P.findIndex(Q=>Q&&Q.instanceId===A):g,X=H>=0?P[H]:null;if(!X)return;if(X.hasEvolved){console.log("[GameScreen] Cannot evolve: card already evolved");return}const M=hr.current[g];let N=window.innerWidth/2,G=window.innerHeight/2;if(M){const Q=M.getBoundingClientRect();N=Q.left+Q.width/2,G=Q.top+Q.height/2}const ae=X.instanceId;n!=="CPU"&&R&&b&&b.send({type:"EVOLVE_ANIM",payload:{playerId:L,followerIndex:H,useSep:_,targetId:E,instanceId:ae}}),hi({card:X,evolvedImageUrl:X.evolvedImageUrl,startX:N,startY:G,phase:"ZOOM_IN",followerIndex:H,useSep:_,targetId:E,sourcePlayerId:L}),ht("fon.mp3",.7)},ed=D.useRef(null),vE=D.useCallback(g=>{if(console.log("[GameScreen] handleEvolvePhaseChange:",g),g==="WHITE_FADE"&&ht("fon.mp3",.7),g==="LAND"&&ht("gan.mp3",.6),g==="DONE"){const _=mi.current;if(_&&!_.isRemote){const A={type:"EVOLVE",playerId:_.sourcePlayerId||L,payload:{followerIndex:_.followerIndex,useSep:_.useSep,targetId:_.targetId}};C(A),b&&n!=="CPU"&&b.send({type:"ACTION",payload:A})}hi(null)}else hi(_=>_?{..._,phase:g}:null)},[b,C,n,L,ht]),td=(g,_,E)=>{var Ue,de,Y,oe,ee,re;const P=gr.current.hand[g];if(!P){console.warn("[handlePlayCard] Card not found at index:",g);return}if(P.instanceId&&Eo.current===P.instanceId){console.warn("[handlePlayCard] Duplicate play blocked for instanceId:",P.instanceId);return}if(an.current){console.warn("[handlePlayCard] Card play locked, ignoring duplicate call");return}an.current=!0,Eo.current=P.instanceId||null,ht("card.mp3",.5);const H=(Ue=P.triggers)==null?void 0:Ue.find(z=>z.trigger==="FANFARE"),X=H==null?void 0:H.effects[0];let M=F;const N=(X==null?void 0:X.targetType)==="SELECT_ALLY_FOLLOWER"||(X==null?void 0:X.targetType)==="SELECT_OTHER_ALLY_FOLLOWER";X&&(N||["GRANT_PASSIVE","BUFF_STATS","HEAL_FOLLOWER"].includes(X.type))&&(M=L);const G=["SELECT_FOLLOWER","SELECT_ALLY_FOLLOWER","SELECT_OTHER_ALLY_FOLLOWER"],ae=P.type==="SPELL"&&((de=P.triggers)==null?void 0:de.some(z=>z.effects.some(ne=>ne.targetType&&G.includes(ne.targetType))))||P.type==="FOLLOWER"&&(((oe=(Y=P.triggerAbilities)==null?void 0:Y.FANFARE)==null?void 0:oe.targetType)&&G.includes(P.triggerAbilities.FANFARE.targetType)||((ee=P.triggers)==null?void 0:ee.some(z=>z.trigger==="FANFARE"&&z.effects.some(ne=>ne.targetType&&G.includes(ne.targetType))))),ue=qe.current.players[M].board.some(z=>{var ne,pe;return z&&(M===L||!((ne=z.passiveAbilities)!=null&&ne.includes("STEALTH"))&&!((pe=z.passiveAbilities)!=null&&pe.includes("AURA")))});if(console.log(`[handlePlayCard] needsTarget: ${ae}, allowedTarget: ${M}, hasValidTargets: ${ue}`),ae&&ue){Os({type:"PLAY",sourceIndex:g,sourceInstanceId:P.instanceId,allowedTargetPlayerId:M}),Tr(null);return}const ve=window.innerWidth/2,We=window.innerHeight/2;let xe,ze;if(P.type==="FOLLOWER"){const ne=qe.current.players[L].board.filter(Ie=>Ie!==null),pe=ne.length+1,Re=ne.length,Ee=Ds*d,Te=(Re-(pe-1)/2)*Ee,ge=(re=fi.current)==null?void 0:re.getBoundingClientRect();xe=(ge?ge.left+ge.width/2:window.innerWidth/2)+Te,ze=window.innerHeight/2+70*d}const Ke=()=>{P.type!=="SPELL"&&(ht("gan.mp3",.6),Dn()),Yr({type:"PLAY_CARD",playerId:L,payload:{cardIndex:g,instanceId:P.instanceId}}),Mn(null),setTimeout(()=>{an.current=!1},100)},Be=P.type==="FOLLOWER"?qe.current.players[L].board.filter(z=>z!==null).length:void 0;n!=="CPU"&&R&&b&&b.send({type:"PLAY_CARD_ANIM",payload:{playerId:L,cardIndex:g,card:P,targetBoardIndex:Be}}),Mn({card:P,sourceIndex:g,startX:_,startY:E,targetX:ve,targetY:We,finalX:xe,finalY:ze,playerClass:(se==null?void 0:se.class)||"SENKA",onComplete:Ke}),setTimeout(()=>{Mn(z=>(z==null?void 0:z.card.id)===P.id?(Ke(),null):z)},2e3)},Yr=g=>{C(g),n!=="CPU"&&R&&!g.isRemote&&(b==null||b.send({type:"ACTION",payload:g}))};D.useEffect(()=>{if(!At&&ed.current){const g=ed.current;ed.current=null,console.log("[GameScreen] Dispatching pending evolve action for:",g.playerId),Yr({type:"EVOLVE",playerId:g.playerId,payload:{followerIndex:g.followerIndex,useSep:g.useSep,targetId:g.targetId}})}},[At,L,Yr]);const gr=D.useRef(se),qe=D.useRef(y);D.useEffect(()=>{gr.current=se,qe.current=y},[se,y]);const er=D.useRef(!1);D.useEffect(()=>{const g=Wu.current,_=se.hand.length,E=Oe.hand.length;if(_>g.player){const A=_-g.player;vo({isPlayer:!0,count:A}),ht("card.mp3",.5),setTimeout(()=>vo(null),Hu)}if(E>g.opponent){const A=E-g.opponent;vo({isPlayer:!1,count:A}),ht("card.mp3",.5),setTimeout(()=>vo(null),Hu)}Wu.current={player:_,opponent:E}},[se.hand.length,Oe.hand.length,bt,ht]),U.useEffect(()=>{y.activePlayerId===L&&(console.log("[GameScreen] Player turn started - resetting card play lock and ending turn state"),an.current=!1,Eo.current=null,gi.current=!1)},[y.activePlayerId,y.turnCount,L]),U.useEffect(()=>{if(n==="CPU")return;const g=setInterval(()=>{an.current&&!bo.current&&!mi.current&&!Ze&&y.activePlayerId===L&&(console.warn("[GameScreen] Safety release: Card play lock was stuck, releasing"),an.current=!1)},3e3);return()=>clearInterval(g)},[n,Ze,y.activePlayerId,L]),U.useEffect(()=>{if(n!=="CPU")return;if(y.winnerId){Vr.current=!1;return}const g=`${y.turnCount}-${y.activePlayerId}`;if(y.activePlayerId===L){Vr.current=!1;return}if(y.activePlayerId===F){if(Vr.current||Ju.current===g)return;(async()=>{var xe,ze,Ke,Be,Ue,de;Vr.current=!0,Ju.current=g;const E=async(Y=300)=>{await new Promise(re=>setTimeout(re,Y));const oe=()=>{const re=qe.current,z=re.pendingEffects&&re.pendingEffects.length>0,ne=qu.current.length>0,pe=Zu.current.length>0,Re=bo.current!==null,Ee=mi.current!==null;return!z&&!ne&&!pe&&!Re&&!Ee};let ee=0;for(;!oe()&&ee<60;){await new Promise(z=>setTimeout(z,100)),ee++;const re=qe.current;if(re.pendingEffects&&re.pendingEffects.length>0&&!Cr.current){console.log("[waitForIdle] Forcing RESOLVE_EFFECT for stuck pending effect");const z=re.pendingEffects[0];C({type:"RESOLVE_EFFECT",playerId:z.sourcePlayerId,payload:{targetId:z.targetId}}),await new Promise(ne=>setTimeout(ne,200))}}},A=(Y,oe)=>{var ee;return Y?!!((ee=Y.passiveAbilities)!=null&&ee.includes("IMMUNE_TO_FOLLOWER_DAMAGE")):!1},P=(Y,oe)=>{var ee;return!oe||!Y?!1:(ee=oe.passiveAbilities)!=null&&ee.includes("BANE")&&!Y.hasBarrier?!0:(oe.currentAttack||0)>=Y.currentHealth},H=(Y,oe)=>{var ee;return!oe||!Y?!1:(ee=Y.passiveAbilities)!=null&&ee.includes("BANE")?!oe.hasBarrier:Y.currentAttack>=oe.currentHealth},X=Y=>{var ne,pe,Re;let oe=0;const ee=Y.players[F].board.filter(Ee=>Ee!==null),z=Y.players[L].board.filter(Ee=>Ee!==null).some(Ee=>{var Te,ge;return((Te=Ee.passiveAbilities)==null?void 0:Te.includes("WARD"))&&!((ge=Ee.passiveAbilities)!=null&&ge.includes("STEALTH"))});for(const Ee of ee)!Ee.canAttack||!((ne=Ee.passiveAbilities)!=null&&ne.includes("STORM")||Ee.turnPlayed!==Y.turnCount)||z&&!((pe=Ee.passiveAbilities)!=null&&pe.includes("STEALTH"))&&!Ee.hadStealth||(oe+=Ee.currentAttack||0,(Re=Ee.passiveAbilities)!=null&&Re.includes("DOUBLE_ATTACK")&&(oe+=Ee.currentAttack||0));return oe},M=Y=>{var re,z,ne;let oe=0;const ee=Y.players[L].board.filter(pe=>pe!==null);for(const pe of ee)oe+=pe.currentAttack||0,(re=pe.passiveAbilities)!=null&&re.includes("DOUBLE_ATTACK")&&(oe+=pe.currentAttack||0),(z=pe.passiveAbilities)!=null&&z.includes("BANE")&&(oe+=15),(ne=pe.passiveAbilities)!=null&&ne.includes("STORM")&&(oe+=10);return oe},N=(Y,oe)=>{var Te,ge,Ge,Ie;let ee=Y.cost*10;const re=oe.players[L].board.filter(Me=>Me!==null),z=oe.players[F].board.filter(Me=>Me!==null),ne=oe.players[L].hp,pe=oe.players[F].hp,Re=oe.players[F].pp;if((Te=Y.passiveAbilities)!=null&&Te.includes("STORM")){const Me=X(oe),Pe=Y.attack||0;Me+Pe>=ne?ee+=500:ne<=10?ee+=100:ee+=30}if(re.length>0){const Me=Y.triggers||[],Pe=M(oe);for(const _t of Me)if(_t.trigger==="FANFARE")for(const je of _t.effects||[]){if(je.type==="DESTROY"&&(ee+=60+(Pe>10?30:0)),je.type==="RANDOM_DESTROY"){const Ve=je.value||1;ee+=40*Ve+(Pe>10?20:0)}["DAMAGE","SELECT_DAMAGE"].includes(je.type)&&(ee+=35),je.type==="AOE_DAMAGE"&&(ee+=25*Math.min(re.length,3))}}pe<=10&&((ge=Y.passiveAbilities)!=null&&ge.includes("WARD")&&(ee+=80),ee+=20),Y.cost===Re?ee+=15:Re-Y.cost<=1&&(ee+=10);const Ee=Y.triggers||[];for(const Me of Ee)if(Me.trigger==="FANFARE")for(const Pe of Me.effects||[])Pe.type==="DRAW"&&(ee+=20*(Pe.value||1)),(Pe.type==="SUMMON_CARD"||Pe.type==="SUMMON_CARD_RUSH")&&(ee+=30),Pe.type==="GENERATE_CARD"&&(ee+=15),Pe.type==="HEAL"&&(ee+=pe<15?25:10);return Y.type==="FOLLOWER"&&((Y.attack||0)+(Y.health||0)>=Y.cost*2.5&&(ee+=15),(Ge=Y.passiveAbilities)!=null&&Ge.includes("WARD")&&re.length>0&&(ee+=25),(Ie=Y.passiveAbilities)!=null&&Ie.includes("BANE")&&(ee+=20)),Y.type==="FOLLOWER"&&z.length>=5&&(ee-=200),ee},G=(Y,oe,ee,re)=>{let z=0;const ne=ee.players[L].board.filter(ge=>ge!==null),pe=ee.players[F].board.filter(ge=>ge!==null),Re=Y.triggers||[],Ee=re?"SUPER_EVOLVE":"EVOLVE";let Te=!1;for(const ge of Re)if(ge.trigger===Ee){Te=!0;for(const Ge of ge.effects||[]){if(["DESTROY","RANDOM_DESTROY","DAMAGE","SELECT_DAMAGE","AOE_DAMAGE"].includes(Ge.type)&&(z+=ne.length>0?80:5),["SUMMON_CARD","SUMMON_CARD_RUSH"].includes(Ge.type)&&(z+=60),Ge.type==="BUFF_STATS"){const Ie=Ge.targetType||"SELF";Ie==="ALL_OTHER_FOLLOWERS"||Ie==="ALL_FOLLOWERS"?z+=25*Math.max(1,pe.length-1):z+=30}Ge.type==="DRAW"&&(z+=35),Ge.type==="GENERATE_CARD"&&(z+=25)}}return Y.canAttack?(z+=30,z+=(Y.currentAttack||0)*5):z+=(Y.currentAttack||0)*2,Y.cost>=6&&Te&&(z+=20),!Te&&Y.cost<=3&&(z-=30),z},ae=(Y,oe)=>{const re=Y.players[F].board.filter(Ie=>Ie!==null),z=Y.players[L].board.filter(Ie=>Ie!==null),ne=Y.players[L].hp,pe=Y.players[F].hp,Re=Y.turnCount,Ee=re.filter(Ie=>Ie&&!Ie.hasEvolved);if(Ee.length===0)return!1;const Te=Ee.map((Ie,Me)=>({c:Ie,i:Me,score:G(Ie,Me,Y,oe)})),ge=Math.max(...Te.map(Ie=>Ie.score));if(ne<=12&&re.some(Ie=>Ie&&Ie.canAttack)||pe<=10)return!0;const Ge=M(Y);return Ge>=8&&Ee.some(Me=>{const Pe=Me.triggers||[];for(const _t of Pe)if(_t.trigger===(oe?"SUPER_EVOLVE":"EVOLVE")){for(const je of _t.effects||[])if(["DESTROY","RANDOM_DESTROY","DAMAGE","AOE_DAMAGE"].includes(je.type))return!0}return!1})&&z.length>0||ge>=80||oe&&ge>=50?!0:Re<=5&&pe>=15&&Ge<8?ge>=100:ge<30?!1:ge>=50},Q=(Y,oe,ee)=>{var Re,Ee,Te,ge,Ge;const re=((Re=Y.passiveAbilities)==null?void 0:Re.includes("STORM"))||Y.turnPlayed!==ee.turnCount,z=oe.map((Ie,Me)=>({c:Ie,i:Me})).filter(({c:Ie})=>{var Me,Pe;return Ie!==null&&!((Me=Ie.passiveAbilities)!=null&&Me.includes("STEALTH"))&&!((Pe=Ie.passiveAbilities)!=null&&Pe.includes("AURA"))});if(!(((Ee=Y.passiveAbilities)==null?void 0:Ee.includes("STEALTH"))||Y.hadStealth)){const Ie=z.find(({c:Me})=>{var Pe;return(Pe=Me.passiveAbilities)==null?void 0:Pe.includes("WARD")});if(Ie)return A(Ie.c)?{index:-1,isLeader:!1}:{index:Ie.i,isLeader:!1}}let pe={index:-1,isLeader:re,score:re?0:-1e3};for(const{c:Ie,i:Me}of z){if(A(Ie))continue;let Pe=0;const _t=Y.isEvolved,je=(Te=Ie.passiveAbilities)==null?void 0:Te.includes("BANE"),Ve=P(Y,Ie);H(Y,Ie)?(Pe+=50,Pe+=(Ie.currentAttack||0)*5,Ve?je&&_t?Pe-=60:je&&(Pe-=30):Pe+=30,je&&!Ve&&(Pe+=40),(ge=Ie.passiveAbilities)!=null&&ge.includes("STORM")&&(Pe+=30),(Ge=Ie.passiveAbilities)!=null&&Ge.includes("DOUBLE_ATTACK")&&(Pe+=35)):!Ve&&Y.currentAttack>=Ie.currentHealth/2?Pe+=10:Ve&&(Pe-=50,_t&&(Pe-=40),(Ie.currentAttack||0)>=5&&(Pe+=10)),Pe>pe.score&&(pe={index:Me,isLeader:!1,score:Pe})}return re&&(pe.index===-1||pe.score<=0)?{index:-1,isLeader:!0}:pe},ue=u==="EASY"?1200:u==="HARD"?400:800;if(await new Promise(Y=>setTimeout(Y,ue)),!Vr.current)return;let ve=0;const We=u==="EASY"?1:u==="HARD"?5:3;for(;ve<We;){const Y=qe.current,oe=Y.players[F].hand,ee=Y.players[F].pp,z=Y.players[F].board.filter(je=>je!==null).length>=5;let ne=oe.map((je,Ve)=>({...je,originalIndex:Ve})).filter(je=>je.cost<=ee).filter(je=>!(je.type==="FOLLOWER"&&z));if(ne.length===0||(u==="HARD"?ne=ne.sort((je,Ve)=>N(Ve,Y)-N(je,Y)):ne=ne.sort((je,Ve)=>Ve.cost-je.cost),u==="EASY"&&Math.random()<.3&&ve>0))break;const pe=ne[0];let Re;const Te=Y.players[L].board.filter(je=>{var Ve,ft;return je&&!((Ve=je.passiveAbilities)!=null&&Ve.includes("STEALTH"))&&!((ft=je.passiveAbilities)!=null&&ft.includes("AURA"))});Te.length>0&&(u==="HARD"?Re=[...Te].sort((Ve,ft)=>{var gt,xt;let tt=(Ve.currentAttack||0)+(Ve.currentHealth||0),ut=(ft.currentAttack||0)+(ft.currentHealth||0);return(gt=Ve.passiveAbilities)!=null&&gt.includes("BANE")&&(tt+=10),(xt=ft.passiveAbilities)!=null&&xt.includes("BANE")&&(ut+=10),ut-tt})[0].instanceId:Re=Te[0].instanceId);const ge=window.innerWidth-20*d-80*d/2,Ge=20*d+110*d/2,Ie=window.innerWidth/2,Me=window.innerHeight/2;let Pe,_t;if(pe.type==="FOLLOWER"){const Ve=qe.current.players[F].board.filter(_l=>_l!==null),ft=Ve.length+1,tt=Ve.length,ut=Ds*d,gt=(tt-(ft-1)/2)*ut,xt=(xe=fi.current)==null?void 0:xe.getBoundingClientRect();Pe=(xt?xt.left+xt.width/2:window.innerWidth/2)+gt,_t=window.innerHeight/2-70*d}Mn({card:pe,sourceIndex:-1,startX:ge,startY:Ge,targetX:Ie,targetY:Me,finalX:Pe,finalY:_t,playerClass:(Oe==null?void 0:Oe.class)||"SENKA",onComplete:()=>{if(pe.type!=="SPELL"&&(ht("gan.mp3",.6),Dn()),C({type:"PLAY_CARD",playerId:F,payload:{cardIndex:pe.originalIndex,targetId:Re,instanceId:pe.instanceId}}),pe.id==="c_amandava"&&qe.current.players[L].board.forEach((Ve,ft)=>{if(Ve){const tt=Ve.instanceId;setTimeout(()=>{Bt("SHOT",L,ft,tt)},200)}}),pe.id==="c_azya"){if(setTimeout(()=>{Bt("THUNDER",L,-1)},200),Re){const Ve=qe.current.players[L].board.findIndex(ft=>(ft==null?void 0:ft.instanceId)===Re);Ve!==-1&&setTimeout(()=>{Bt("ICE",L,Ve,Re)},400)}setTimeout(()=>{const je=qe.current.players[L].board,Ve=je.filter(ft=>ft!==null);if(Ve.length>0){const ft=Ve[Math.floor(Math.random()*Ve.length)],tt=je.findIndex(ut=>(ut==null?void 0:ut.instanceId)===(ft==null?void 0:ft.instanceId));tt!==-1&&Bt("WATER",L,tt,ft==null?void 0:ft.instanceId)}},600)}Mn(null)}}),await E(600),ve++}{const Y=qe.current,oe=Y.players[F],ee=F===Y.firstPlayerId,re=Y.turnCount,z=yy(oe,re,ee);if((my(oe,re,ee)||z)&&oe.board.length>0){const pe=oe.board.map((Re,Ee)=>({c:Re,i:Ee})).filter(({c:Re})=>Re&&Re.type==="FOLLOWER"&&!Re.hasEvolved);if(pe.length>0){let Re;const Ee=z;if(u==="HARD"&&(ae(Y,Ee)||console.log("[AI HARD] Skipping evolution - saving EP for better opportunity")),u==="HARD"&&!ae(Y,Ee))Re=null;else if(u==="EASY")Re=pe[Math.floor(Math.random()*pe.length)];else{const ge=pe.map(({c:Ge,i:Ie})=>({c:Ge,i:Ie,score:G(Ge,Ie,Y,Ee)}));ge.sort((Ge,Ie)=>Ie.score-Ge.score),u==="HARD"&&ge[0].score<5?(console.log("[AI HARD] Evolution target score too low:",ge[0].score),Re=null):Re=ge[0]}if(Re){let ge;const Ie=Y.players[L].board.filter(Pe=>{var _t,je;return Pe!==null&&!((_t=Pe.passiveAbilities)!=null&&_t.includes("STEALTH"))&&!((je=Pe.passiveAbilities)!=null&&je.includes("AURA"))});Ie.length>0&&(u==="HARD"?ge=[...Ie].sort((_t,je)=>{var tt,ut,gt,xt;let Ve=(_t.currentAttack||0)*2+(_t.currentHealth||0),ft=(je.currentAttack||0)*2+(je.currentHealth||0);return(tt=_t.passiveAbilities)!=null&&tt.includes("BANE")&&(Ve+=10),(ut=je.passiveAbilities)!=null&&ut.includes("BANE")&&(ft+=10),(gt=_t.passiveAbilities)!=null&&gt.includes("DOUBLE_ATTACK")&&(Ve+=5),(xt=je.passiveAbilities)!=null&&xt.includes("DOUBLE_ATTACK")&&(ft+=5),ft-Ve})[0].instanceId:ge=Ie[0].instanceId);const Me=(ze=Zn.current[Re.i])==null?void 0:ze.getBoundingClientRect();Me?(hi({card:Re.c,evolvedImageUrl:Re.c.evolvedImageUrl,startX:Me.left+Me.width/2,startY:Me.top+Me.height/2,useSep:Ee,phase:"ZOOM_IN",followerIndex:Re.i,sourcePlayerId:F,targetId:ge}),await E(800)):(Yr({type:"EVOLVE",playerId:F,payload:{followerIndex:Re.i,useSep:Ee,targetId:ge}}),await E(400))}}}}{let Y=!0,oe=0;const ee=re=>{if(u!=="HARD")return!1;const z=re.players[L].hp;return X(re)>=z};for(;Y&&oe<15;){if(qe.current.winnerId){Y=!1;break}oe++;const re=qe.current,z=re.players[F].board,ne=re.players[L].board,pe=ee(re);let Re=!1;for(let Ee=0;Ee<z.length;Ee++){const Te=z[Ee];if(!Te||!Te.canAttack)continue;let ge=-1,Ge=!0;const Ie=((Ke=Te.passiveAbilities)==null?void 0:Ke.includes("STEALTH"))||Te.hadStealth,Me=Ie?-1:ne.findIndex(tt=>{var ut,gt;return tt&&((ut=tt.passiveAbilities)==null?void 0:ut.includes("WARD"))&&!((gt=tt.passiveAbilities)!=null&&gt.includes("STEALTH"))&&!A(tt)});if(pe&&Me===-1)if(((Be=Te.passiveAbilities)==null?void 0:Be.includes("STORM"))||Te.turnPlayed!==re.turnCount)ge=-1,Ge=!0;else{const gt=ne.map((xt,Jr)=>({c:xt,idx:Jr})).filter(({c:xt})=>{var Jr,_l;return xt&&!((Jr=xt.passiveAbilities)!=null&&Jr.includes("STEALTH"))&&!((_l=xt.passiveAbilities)!=null&&_l.includes("AURA"))&&!A(xt)});if(gt.length>0)ge=gt[0].idx,Ge=!1;else continue}else if(Me!==-1)ge=Me,Ge=!1;else if(u==="EASY"){const tt=ne.map((gt,xt)=>({c:gt,idx:xt})).filter(({c:gt})=>{var xt,Jr;return gt&&!((xt=gt.passiveAbilities)!=null&&xt.includes("STEALTH"))&&!((Jr=gt.passiveAbilities)!=null&&Jr.includes("AURA"))&&!A(gt)}),ut=((Ue=Te.passiveAbilities)==null?void 0:Ue.includes("STORM"))||Te.turnPlayed!==re.turnCount;if(!ut&&tt.length>0)ge=tt[Math.floor(Math.random()*tt.length)].idx,Ge=!1;else{if(!ut&&tt.length===0)continue;ut&&tt.length>0&&Math.random()<.5&&(ge=tt[Math.floor(Math.random()*tt.length)].idx,Ge=!1)}}else{const tt=Q(Te,ne,re);if(ge=tt.index,Ge=tt.isLeader,ge===-1&&!Ge)continue}const Pe=(de=Te.passiveAbilities)==null?void 0:de.includes("STORM"),_t=Te.turnPlayed===re.turnCount;if(!Pe&&_t&&Ge){const tt=ne.map((ut,gt)=>({c:ut,idx:gt})).filter(({c:ut})=>{var gt,xt;return ut&&!((gt=ut.passiveAbilities)!=null&&gt.includes("STEALTH"))&&!((xt=ut.passiveAbilities)!=null&&xt.includes("AURA"))&&!A(ut)});if(tt.length>0){const ut=Ie?null:tt.find(({c:gt})=>{var xt;return(xt=gt.passiveAbilities)==null?void 0:xt.includes("WARD")});ut?ge=ut.idx:ge=tt[0].idx,Ge=!1}else continue}const je=Ge?null:ne[ge],Ve=je?je.instanceId:void 0,ft=Te.instanceId;if(ft&&(sl(ft),setTimeout(()=>sl(null),300)),Bt(Te.attackEffectType||"SLASH",L,Ge?-1:ge,Ve),!Ge&&ge>=0){const tt=ne[ge];if(tt&&(tt.currentAttack||0)>0){const ut=tt.instanceId;setTimeout(()=>{ut&&(il(ut),setTimeout(()=>il(null),300)),Bt(tt.attackEffectType||"SLASH",F,Ee,ft)},200)}}Re=!0,await E(1e3),C({type:"ATTACK",playerId:F,payload:{attackerIndex:Ee,targetIndex:ge,targetIsLeader:Ge}}),await E(1e3);break}Re||(Y=!1)}}if(await E(300),qe.current.winnerId){Vr.current=!1;return}C({type:"END_TURN",playerId:F}),Vr.current=!1})()}},[y.activePlayerId,y.turnCount,n,y.phase,u,y.winnerId]);const P0=(g,_)=>{if(Tn.current||He||ui.length>0)return;const E=se.hand[_];g.stopPropagation();const A="touches"in g?g.touches[0].clientX:g.clientX,P="touches"in g?g.touches[0].clientY:g.clientY,H=g.currentTarget.getBoundingClientRect();if(!kr){Vu(!0),Ir({card:E,owner:"PLAYER",source:"HAND"}),Yu.current=!0;return}if(Ir({card:E,owner:"PLAYER",source:"HAND"}),y.activePlayerId!==L)return;if(an.current){console.warn("[handleHandMouseDown] Card play in progress, blocking drag start");return}const X=qe.current;if(X.winnerId){console.log("UI: Card play drag blocked - game has ended");return}if(X.pendingEffects&&X.pendingEffects.length>0){console.log("UI: Card play drag blocked - pendingEffects still processing");return}const M={sourceType:"HAND",sourceIndex:_,sourceInstanceId:E.instanceId,startX:H.left+H.width/2,startY:H.top+H.height/2,currentX:A,currentY:P,offsetX:0,offsetY:0,canDrag:!0};Tr(M),Tn.current=M},L0=(g,_,E)=>{g.stopPropagation();const A="touches"in g?g.touches[0].clientX:g.clientX,P="touches"in g?g.touches[0].clientY:g.clientY,H=qe.current;if(H.winnerId){console.log("UI: Attack drag blocked - game has ended");return}const X=H.players[L].board,M=E?X.findIndex(G=>G&&G.instanceId===E):_,N=M>=0?X[M]:null;if(Ze&&Ze.allowedTargetPlayerId===L&&N){nd("FOLLOWER",M,L,E);return}if(N&&Ir({card:N,owner:"PLAYER",source:"BOARD"}),H.pendingEffects&&H.pendingEffects.length>0){console.log("UI: Attack drag blocked - pendingEffects still processing");return}if(H.activePlayerId===L&&(N!=null&&N.canAttack)){const G=g.currentTarget.getBoundingClientRect(),ae={x:G.left+G.width/2,y:G.top+G.height/2},Q={sourceType:"BOARD",sourceIndex:M,sourceInstanceId:N.instanceId,startX:ae.x,startY:ae.y,currentX:A,currentY:P,offsetX:0,offsetY:0};Tr(Q),Tn.current=Q}},gl=(g,_=!1)=>{if(y.activePlayerId!==L)return;g.stopPropagation();const E="touches"in g?g.touches[0].clientX:g.clientX,A="touches"in g?g.touches[0].clientY:g.clientY,P=qe.current;if(P.winnerId){console.log("UI: Evolve drag blocked - game has ended");return}if(P.pendingEffects&&P.pendingEffects.length>0){console.log("UI: Evolve drag blocked - pendingEffects still processing");return}const H=L===y.firstPlayerId;if(_){if(!yy(se,y.turnCount,H))return}else if(!my(se,y.turnCount,H))return;const X=g.currentTarget.getBoundingClientRect(),M=X.left+X.width/2,N=X.top+X.height/2,G={sourceType:"EVOLVE",sourceIndex:0,startX:M,startY:N,currentX:E,currentY:A,offsetX:0,offsetY:0,useSep:_};Tr(G),Tn.current=G},D0=U.useCallback(g=>{fr.current&&(clearTimeout(fr.current),fr.current=null);const _={stampId:g,playerId:L,playerClass:As,timestamp:Date.now()},E=py(g);E&&ht(E,.6),ci(null),requestAnimationFrame(()=>{ci(_)}),e==="ONLINE"&&b&&b.send({type:"STAMP",stampId:g,playerClass:As}),fr.current=setTimeout(()=>{ci(A=>(A==null?void 0:A.timestamp)===_.timestamp?null:A),fr.current=null},3e3)},[L,As,e,b]),_E=U.useCallback(g=>{if(g.stopPropagation(),g.preventDefault(),Ps.current){const _=Ps.current.getBoundingClientRect();Sr.current={x:_.left+_.width/2,y:_.top+_.height/2}}else Sr.current={x:g.clientX,y:g.clientY};f0(!0),qa(null)},[]),M0=D.useRef(null);D.useEffect(()=>{M0.current=ju},[ju]),U.useEffect(()=>{if(!Nu)return;const g=E=>{if(!Sr.current)return;const A=E.clientX-Sr.current.x,P=E.clientY-Sr.current.y,H=Math.sqrt(A*A+P*P),X=Math.atan2(P,A)*(180/Math.PI);if(H>=200&&H<=320&&P<0){const ae=180- -X,Q=Math.floor(ae/22.5),ve=Math.max(0,Math.min(7,Q))+1;qa(ve)}else qa(null)},_=()=>{const E=M0.current;E&&D0(E),f0(!1),qa(null),Sr.current=null};return window.addEventListener("mousemove",g),window.addEventListener("mouseup",_),()=>{window.removeEventListener("mousemove",g),window.removeEventListener("mouseup",_)}},[Nu,D0]),U.useEffect(()=>{const g=(A,P,H=!1)=>{var N,G,ae,Q;if(!Tn.current)return;const{canDrag:X,sourceType:M}=Tn.current;if(!(M==="HAND"&&!X)&&(Tn.current={...Tn.current,currentX:A,currentY:P},Tr(ue=>ue?{...ue,currentX:A,currentY:P}:null),H&&(M==="BOARD"||M==="EVOLVE"))){const ue=pi.current;if(ue){const xe=ue.getBoundingClientRect();if(A>=xe.left&&A<=xe.right&&P>=xe.top&&P<=xe.bottom){Hn({type:"LEADER",index:0,playerId:F});return}}const ve=qe.current,We=((N=ve.players[F])==null?void 0:N.board)||[];for(let xe=0;xe<Zn.current.length;xe++){const ze=Zn.current[xe];if(ze&&We[xe]){const Ke=ze.getBoundingClientRect();if(A>=Ke.left&&A<=Ke.right&&P>=Ke.top&&P<=Ke.bottom){Hn({type:"FOLLOWER",index:xe,playerId:F,instanceId:(G=We[xe])==null?void 0:G.instanceId});return}}}if(M==="EVOLVE"){const xe=((ae=ve.players[L])==null?void 0:ae.board)||[];for(let ze=0;ze<hr.current.length;ze++){const Ke=hr.current[ze];if(Ke&&xe[ze]){const Be=Ke.getBoundingClientRect();if(A>=Be.left&&A<=Be.right&&P>=Be.top&&P<=Be.bottom){Hn({type:"FOLLOWER",index:ze,playerId:L,instanceId:(Q=xe[ze])==null?void 0:Q.instanceId});return}}}}Hn(null)}},_=A=>{g(A.clientX,A.clientY)},E=A=>{A.touches.length>0&&(Tn.current&&A.preventDefault(),g(A.touches[0].clientX,A.touches[0].clientY,!0))};return window.addEventListener("mousemove",_),window.addEventListener("touchmove",E,{passive:!1}),()=>{window.removeEventListener("mousemove",_),window.removeEventListener("touchmove",E)}},[]);const N0=D.useRef(null),xE=D.useRef(null);U.useEffect(()=>{N0.current=lt,xE.current=lt},[lt]),U.useEffect(()=>{const g=()=>{var P,H,X,M,N,G,ae,Q,ue,ve,We,xe,ze;const E=Tn.current,A=N0.current;if(qe.current.winnerId){console.log("[handleGlobalMouseUp] Game has ended, cancelling all actions"),Tr(null),Tn.current=null,Hn(null);return}if(E){if(E.sourceType==="HAND"){if(an.current){console.warn("[handleGlobalMouseUp] Card play in progress, cancelling drag"),Tn.current=null,Tr(null);return}const Ke=Math.sqrt(Math.pow(E.startX-E.currentX,2)+Math.pow(E.startY-E.currentY,2)),Be=E.currentY<window.innerHeight-200*d;if(E.canDrag&&Ke>30&&Be){const Ue=gr.current.hand[E.sourceIndex];if(gr.current.pp>=Ue.cost){const de=((H=(P=Ue.triggerAbilities)==null?void 0:P.FANFARE)==null?void 0:H.targetType)==="SELECT_FOLLOWER"||((X=Ue.triggers)==null?void 0:X.some(re=>re.trigger==="FANFARE"&&re.effects.some(z=>z.targetType==="SELECT_FOLLOWER"))),Y=((N=(M=Ue.triggerAbilities)==null?void 0:M.FANFARE)==null?void 0:N.targetType)==="SELECT_ALLY_FOLLOWER"||((G=Ue.triggers)==null?void 0:G.some(re=>re.trigger==="FANFARE"&&re.effects.some(z=>z.targetType==="SELECT_ALLY_FOLLOWER"))),oe=((Q=(ae=Ue.triggerAbilities)==null?void 0:ae.FANFARE)==null?void 0:Q.targetType)==="SELECT_OTHER_ALLY_FOLLOWER"||((ue=Ue.triggers)==null?void 0:ue.some(re=>re.trigger==="FANFARE"&&re.effects.some(z=>z.targetType==="SELECT_OTHER_ALLY_FOLLOWER")));if(de||Y||oe){const re=Y||oe?L:F;qe.current.players[re].board.some(pe=>{var Re,Ee;return!(!pe||re!==L&&((Re=pe.passiveAbilities)!=null&&Re.includes("STEALTH")||(Ee=pe.passiveAbilities)!=null&&Ee.includes("AURA")))})?(an.current=!0,Eo.current=Ue.instanceId||null,Os({type:"PLAY",sourceIndex:E.sourceIndex,sourceInstanceId:Ue.instanceId,allowedTargetPlayerId:re}),er.current=!0,setTimeout(()=>{er.current=!1},100)):(console.log("[handleGlobalMouseUp] No valid targets, skipping target selection"),td(E.sourceIndex,E.startX,E.startY),Ir(null),er.current=!0,setTimeout(()=>{er.current=!1},100))}else td(E.sourceIndex,E.startX,E.startY),Ir(null),er.current=!0,setTimeout(()=>{er.current=!1},100);Tn.current=null,Tr(null);return}}else E.canDrag||Vu(!0)}else if(E.sourceType==="BOARD"){if(A&&A.playerId===F){const Be=qe.current.players[F],Ue=Be.board.filter(z=>{var ne,pe;return z&&((ne=z.passiveAbilities)==null?void 0:ne.includes("WARD"))&&!((pe=z.passiveAbilities)!=null&&pe.includes("STEALTH"))});let de=!1;const Y=z=>z?Be.board.findIndex(ne=>ne&&ne.instanceId===z):-1,oe=A.type==="LEADER"?-1:Y(A.instanceId),ee=gr.current.board[E.sourceIndex],re=((ve=ee==null?void 0:ee.passiveAbilities)==null?void 0:ve.includes("STEALTH"))||(ee==null?void 0:ee.hadStealth);if(Ue.length>0&&!re){if(A.type==="LEADER")de=!0;else if(A.type==="FOLLOWER"&&oe>=0){const z=Be.board[oe];z&&!((We=z.passiveAbilities)!=null&&We.includes("WARD"))&&(de=!0)}}if(de)console.log("UI: Attack blocked by WARD");else{const z=gr.current.board.findIndex(Ge=>Ge&&Ge.instanceId===E.sourceInstanceId),ne=z>=0?gr.current.board[z]:null,pe=(xe=ne==null?void 0:ne.passiveAbilities)==null?void 0:xe.includes("RUSH"),Re=(ze=ne==null?void 0:ne.passiveAbilities)==null?void 0:ze.includes("STORM"),Ee=(ne==null?void 0:ne.turnPlayed)===qe.current.turnCount,Te=A.type==="LEADER",ge=oe;if(Te&&pe&&!Re&&Ee)console.log("UI: Attack blocked by RUSH rule (Cannot attack leader)");else{if(z<0||!ne){console.log("UI: Attack blocked - invalid attacker");return}const Ge=qe.current;if(Ge.pendingEffects&&Ge.pendingEffects.length>0){console.log("UI: Attack blocked - pendingEffects still processing");return}const Ie=A.instanceId,Me=E.sourceInstanceId,Pe=!Te&&ge>=0?Be.board[ge]:null;Yr({type:"ATTACK",playerId:L,payload:{attackerIndex:z,targetIndex:Te?-1:ge,targetIsLeader:Te}}),Me&&(sl(Me),setTimeout(()=>sl(null),300));const je=(ne==null?void 0:ne.attackEffectType)||"SLASH";if(Bt(je,F,Te?-1:ge,Ie),Dn(),!Te&&Pe&&(Pe.currentAttack||0)>0){const Ve=Pe.instanceId;setTimeout(()=>{Ve&&(il(Ve),setTimeout(()=>il(null),300)),Bt(Pe.attackEffectType||"SLASH",L,z,Me)},200)}}}}}else if(E.sourceType==="EVOLVE"&&A&&A.type==="FOLLOWER"&&A.playerId===L){const Ke=A.index,Ue=go.current[Ke],de=(Ue==null?void 0:Ue.instanceId)||A.instanceId,Y=gr.current.board,oe=de?Y.findIndex(Me=>Me&&Me.instanceId===de):Ke,ee=oe>=0?Y[oe]:null;if(!ee)return;if(ee.hasEvolved){console.log("[GameScreen] Cannot evolve: card already evolved (drag drop)");return}const z=E.useSep?["SUPER_EVOLVE","EVOLVE"]:["EVOLVE"],pe=(()=>{var Pe,_t;const Me=(_t=(Pe=ee==null?void 0:ee.triggerAbilities)==null?void 0:Pe.EVOLVE)==null?void 0:_t.targetType;if(Me)return Me;for(const je of(ee==null?void 0:ee.triggers)||[])if(z.includes(je.trigger)){for(const Ve of je.effects)if(Ve.targetType&&["SELECT_FOLLOWER","SELECT_ALLY_FOLLOWER","SELECT_OTHER_ALLY_FOLLOWER"].includes(Ve.targetType))return Ve.targetType}return null})(),Re=!!pe,Ee=pe==="SELECT_ALLY_FOLLOWER"||pe==="SELECT_OTHER_ALLY_FOLLOWER",Te=pe==="SELECT_OTHER_ALLY_FOLLOWER",ge=Ee?L:F,Ie=qe.current.players[ge].board.some(Me=>{var Pe,_t;return!(!Me||Ee&&Te&&Me.instanceId===de||!Ee&&((Pe=Me.passiveAbilities)!=null&&Pe.includes("STEALTH")||(_t=Me.passiveAbilities)!=null&&_t.includes("AURA")))});Re&&Ie?(Os({type:"EVOLVE",sourceIndex:oe,sourceInstanceId:de,sourceVisualIndex:Ke,useSep:E.useSep,allowedTargetPlayerId:ge,excludeInstanceId:Te?de:void 0}),er.current=!0,setTimeout(()=>{er.current=!1},100)):(hl(Ke,E.useSep,void 0,de),er.current=!0,setTimeout(()=>{er.current=!1},100))}}E&&E.sourceType==="HAND"&&E.canDrag&&(b0(E.sourceIndex),setTimeout(()=>b0(null),300)),Tr(null),Tn.current=null,Hn(null)},_=()=>{g()};return window.addEventListener("mouseup",g),window.addEventListener("touchend",_),()=>{window.removeEventListener("mouseup",g),window.removeEventListener("touchend",_)}},[F,L,kr,d]);const EE=()=>{if(!er.current){if(Ze){Ze.type==="PLAY"&&(an.current=!1),Os(null);return}if(kr){if(Yu.current){Yu.current=!1;return}Vu(!1),Ir(null),me(null)}}},Kr=()=>{if(!K||K.sourceType!=="BOARD"&&K.sourceType!=="EVOLVE")return"";const g=K.currentX-K.startX,_=K.currentY-K.startY,E=Math.sqrt(g*g+_*_);if(E<10)return"";const A=(K.startX+K.currentX)/2,P=(K.startY+K.currentY)/2,H=Math.min(200,E*.3),X=Math.abs(g),M=Math.min(150,X*.4),N=H+M,ae=-(g/(E+1))*N*.5,Q=-N*.8,ue=A+ae,ve=P+Q;return`M${K.startX},${K.startY} Q${ue},${ve} ${K.currentX},${K.currentY}`},nd=(g,_,E,A)=>{var X;if(!Ze)return;if(Ze.allowedTargetPlayerId&&Ze.allowedTargetPlayerId!==E){console.log("Invalid target side");return}if(Ze.excludeInstanceId&&A===Ze.excludeInstanceId){console.log("Cannot target self (SELECT_OTHER_ALLY_FOLLOWER)"),Dn();return}let P,H=_;if(g==="FOLLOWER"){if(A&&(H=y.players[E].board.findIndex(N=>N&&N.instanceId===A),H<0))return;const M=y.players[E].board[H];if(!M)return;if(P=M.instanceId,E!==L){const N=M.passiveAbilities||[];if(N.includes("STEALTH")){console.log("Cannot target unit with STEALTH"),ht("cancel"),Dn();return}if(N.includes("AURA")){console.log("Cannot target unit with AURA"),ht("cancel"),Dn();return}}}else return;if(Ze.type==="PLAY"){const M=gr.current;let N=Ze.sourceIndex,G=M.hand[N];if(Ze.sourceInstanceId){const Be=M.hand.findIndex(Ue=>Ue.instanceId===Ze.sourceInstanceId);if(Be>=0)N=Be,G=M.hand[Be],console.log(`[handleTargetClick] Using sourceInstanceId ${Ze.sourceInstanceId}, found at index ${Be} (was ${Ze.sourceIndex})`);else{console.error("[handleTargetClick] Card not found with instanceId:",Ze.sourceInstanceId),Os(null);return}}if(!G){console.error("[handleTargetClick] Card not found at index:",N),Os(null),an.current=!1;return}an.current=!0,Eo.current=G.instanceId||null,G.id==="c_y"&&(Bt("SUMI","p2",H,P),qe.current.players[F].board.forEach((Ue,de)=>{if(Ue){const Y=Ue.instanceId;setTimeout(()=>{Bt("SUMI",F,de,Y)},300)}})),G.id==="s_resignation_proxy"&&(Bt("SUMI",E,H,P),setTimeout(()=>{const Be=qe.current.players[L].board,Ue=[];if(Be.forEach((de,Y)=>{de&&Ue.push({index:Y,instanceId:de.instanceId})}),Ue.length>0){const de=Ue[Math.floor(Math.random()*Ue.length)];Bt("SUMI",L,de.index,de.instanceId)}},500)),G.id==="c_azya"&&(Bt("THUNDER",F,-1),setTimeout(()=>{Bt("ICE",E,H,P)},300),setTimeout(()=>{const Be=qe.current.players[F].board,Ue=Be.filter(de=>de!==null);if(Ue.length>0){const de=Ue[Math.floor(Math.random()*Ue.length)],Y=Be.findIndex(oe=>(oe==null?void 0:oe.instanceId)===(de==null?void 0:de.instanceId));Y!==-1&&Bt("WATER",F,Y,de==null?void 0:de.instanceId)}},600));const ae=window.innerWidth/2,Q=window.innerHeight-200*d/2,ue=window.innerWidth/2,ve=window.innerHeight/2,We=()=>{G.type==="SPELL"||Dn(),Yr({type:"PLAY_CARD",playerId:L,payload:{cardIndex:N,targetId:P,instanceId:G.instanceId}}),G.id==="c_amandava"&&qe.current.players[F].board.forEach((de,Y)=>{if(de){const oe=de.instanceId;setTimeout(()=>{Bt("SHOT",F,Y,oe)},200)}}),Mn(null),setTimeout(()=>{an.current=!1},100)};let xe,ze;if(G.type==="FOLLOWER"){const Ue=qe.current.players[L].board.filter(ne=>ne!==null),de=Ue.length+1,Y=Ue.length,oe=Ds*d,ee=(Y-(de-1)/2)*oe,re=(X=fi.current)==null?void 0:X.getBoundingClientRect();xe=(re?re.left+re.width/2:window.innerWidth/2)+ee,ze=window.innerHeight/2+70*d}const Ke=G.type==="FOLLOWER"?qe.current.players[L].board.filter(Be=>Be!==null).length:void 0;n!=="CPU"&&R&&b&&b.send({type:"PLAY_CARD_ANIM",payload:{playerId:L,cardIndex:N,card:G,targetBoardIndex:Ke}}),Mn({card:G,sourceIndex:Ze.sourceIndex??-1,startX:ae,startY:Q,targetX:ue,targetY:ve,finalX:xe,finalY:ze,playerClass:(se==null?void 0:se.class)||"SENKA",onComplete:We}),setTimeout(()=>{Mn(Be=>(Be==null?void 0:Be.card.id)===G.id?(We(),null):Be)},2e3)}else if(Ze.type==="EVOLVE"){const M=Ze.sourceVisualIndex??Ze.sourceIndex;hl(M,!!Ze.useSep,P,Ze.sourceInstanceId)}Os(null)},j0=()=>{if(!Ne||Ne.owner!=="PLAYER")return;if(an.current){console.warn("[handleUseButtonClick] Card play in progress, ignoring");return}const g=se.hand.findIndex(A=>A.id===Ne.card.id);if(g===-1)return;const _=window.innerWidth/2,E=window.innerHeight-200*d/2;td(g,_,E),Ir(null)},[yi,rd]=D.useState(!1),[ml,sd]=D.useState(!1),[Wt,id]=D.useState(null),bE=D.useRef(0);D.useEffect(()=>{if(!(Wt!=null&&Wt.active))return;const g=Date.now(),_=800,E=()=>{const A=Date.now()-g;if(A>=_){id(null);return}const P=A/_;id(H=>H?{...H,ringRadius:20+P*100,particles:H.particles.map(X=>({...X,x:X.x+X.vx,y:X.y+X.vy,opacity:1-P}))}:null),requestAnimationFrame(E)};requestAnimationFrame(E)},[Wt==null?void 0:Wt.active]);const F0=(g,_)=>{const E=[];for(let A=0;A<20;A++){const P=Math.random()*Math.PI*2,H=2+Math.random()*3;E.push({id:bE.current++,x:g,y:_,vx:Math.cos(P)*H,vy:Math.sin(P)*H,opacity:1,createdAt:Date.now()})}id({active:!0,x:g,y:_,ringRadius:20,particles:E})},od=async()=>{if(y.winnerId){console.log("[handleEndTurn] Game is over, ignoring");return}if(y.activePlayerId!==L){console.log("[handleEndTurn] Not my turn, ignoring");return}if(gi.current){console.log("[handleEndTurn] Already ending turn, ignoring");return}gi.current=!0,rd(!0);const g=qe.current.turnCount,_=qe.current.activePlayerId;if(!await(async()=>{const P=()=>{const G=qe.current,ae=G.pendingEffects&&G.pendingEffects.length>0,Q=qu.current.length>0,ue=Zu.current.length>0,ve=bo.current!==null,We=mi.current!==null,xe=Cr.current,ze=an.current;return!ae&&!Q&&!ue&&!ve&&!We&&!xe&&!ze};let M=0,N=0;for(;M<3e3;){if(qe.current.turnCount!==g||qe.current.activePlayerId!==_)return console.log("[handleEndTurn] Turn changed during wait, aborting local END_TURN"),!1;if(P()){if(N++,N>=2)break}else N=0;await new Promise(G=>setTimeout(G,50)),M+=50}return M>=3e3&&console.warn("[handleEndTurn] Timeout waiting for processing to complete - forcing end turn"),!0})()||qe.current.turnCount!==g||qe.current.activePlayerId!==_||qe.current.activePlayerId!==L){console.log("[handleEndTurn] Turn state changed, aborting END_TURN dispatch"),gi.current=!1,rd(!1);return}console.log("[handleEndTurn] Dispatching END_TURN"),Yr({type:"END_TURN",playerId:L}),gi.current=!1,rd(!1)},SE=U.useCallback(()=>{ht("sisiodosi.mp3",.6);const g=y0.current;if(g){const _=g.getBoundingClientRect();F0(_.left+_.width/2,_.top+_.height/2)}od()},[ht,od]),$0=2-((se==null?void 0:se.evolutionsUsed)||0),ad=L===y.firstPlayerId,B0=(g,_)=>_?Math.ceil(y.turnCount/2):Math.floor(y.turnCount/2),U0=B0(L,ad),CE=ad?3:2,TE=ad?4:3,yl=U0>=CE,vl=U0>=TE,Xr=(se==null?void 0:se.canEvolveThisTurn)&&$0>0&&y.activePlayerId===L&&yl,Qr=(se==null?void 0:se.canEvolveThisTurn)&&se.sep>0&&y.activePlayerId===L&&vl,ld=F===y.firstPlayerId,z0=B0(F,ld),IE=ld?3:2,kE=ld?4:3,cd=z0>=IE,ud=z0>=kE,dd=((X0=se==null?void 0:se.board)==null?void 0:X0.some(g=>{var _;return(_=g==null?void 0:g.passiveAbilities)==null?void 0:_.includes("LEADER_DAMAGE_CAP")}))??!1,fd=((Q0=Oe==null?void 0:Oe.board)==null?void 0:Q0.some(g=>{var _;return(_=g==null?void 0:g.passiveAbilities)==null?void 0:_.includes("LEADER_DAMAGE_CAP")}))??!1,wE=(se==null?void 0:se.leaderDamageShield)??!1,AE=(Oe==null?void 0:Oe.leaderDamageShield)??!1,H0=dd||wE,W0=fd||AE;return U.useLayoutEffect(()=>{window.scrollTo(0,0),fi.current&&(fi.current.scrollTop=0);const g=()=>{window.scrollTo(0,0)};return window.addEventListener("scroll",g,{passive:!1}),()=>{window.removeEventListener("scroll",g)}},[]),n==="JOIN"&&!x||T&&ie&&!x?l.jsxs("div",{style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",gap:"1rem"},children:[l.jsx("div",{style:{width:"50px",height:"50px",border:"4px solid rgba(233, 69, 96, 0.3)",borderTop:"4px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),l.jsx("p",{children:"..."}),l.jsx("button",{onClick:s,style:{marginTop:"1rem",padding:"0.5rem 1rem",background:"transparent",border:"1px solid #888",color:"#888",cursor:"pointer",borderRadius:"4px"},children:""}),l.jsx("style",{children:`
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                `})]}):T&&V&&x?l.jsxs("div",{style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",gap:"1rem"},children:[l.jsx("div",{style:{fontSize:"2rem",fontWeight:"bold",color:"#4ade80",textShadow:"0 0 10px rgba(74, 222, 128, 0.5)",marginBottom:"0.5rem"},children:""}),l.jsx("div",{style:{width:"50px",height:"50px",border:"4px solid rgba(74, 222, 128, 0.3)",borderTop:"4px solid #4ade80",borderRadius:"50%",animation:"spin 1s linear infinite"}}),l.jsx("p",{style:{color:"#a0aec0"},children:"..."}),l.jsx("style",{children:`
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                `})]}):l.jsxs("div",{className:"game-screen-wrapper",style:{width:"100vw",height:"100dvh",overflow:"hidden",background:"#000",position:"relative"},children:[w&&l.jsx(pw,{myPlayer:se,opponentPlayer:Oe,isFirstPlayer:dr,onComplete:yE,scale:d,onVsImpact:()=>ht("vs.mp3",.7),onCoinToss:()=>ht("coin.mp3",.7),onImpact:()=>ht("gan.mp3",.7),onOrbLand:()=>ht("gan.mp3",.8),onFadeInBoard:()=>j(!0),isMobile:$}),l.jsxs("div",{className:"game-screen",style:{width:"100%",height:"100%",transform:Qe>0?`translate(${it.x}px, ${it.y}px)`:"none",display:"flex",overflow:"hidden",background:"radial-gradient(circle at center, #1a202c 0%, #000 100%)",fontFamily:"'Helvetica Neue', sans-serif",userSelect:"none",color:"#fff",position:"absolute",top:0,left:0,opacity:w&&!q?0:1,transition:"opacity 0.5s ease-in"},onClick:EE,children:[l.jsx("style",{children:`
                    html, body {
                        margin: 0; padding: 0; height: 100%; background: #000;
                        overflow: hidden !important;
                        position: fixed !important;
                        width: 100% !important;
                        top: 0 !important;
                        left: 0 !important;
                    }
                    * { box-sizing: border-box; }
                    .shake-target { animation: shake 0.3s cubic-bezier(.36,.07,.19,.97) both; }
                    @keyframes shake {
                        10%, 90% { transform: translate3d(-1px, 0, 0); }
                        20%, 80% { transform: translate3d(2px, 0, 0); }
                        30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
                        40%, 60% { transform: translate3d(4px, 0, 0); }
                    }
                    @keyframes attackRotate {
                        0% { transform: rotateY(0deg); }
                        100% { transform: rotateY(360deg); }
                    }
                    .attack-rotating {
                        animation: attackRotate 0.2s linear forwards !important;
                        transform-style: preserve-3d;
                    }
                    @keyframes cardDie {
                        0% { transform: scale(1); filter: brightness(1) drop-shadow(0 0 0 white); opacity: 1; }
                        40% { transform: scale(1.15); filter: brightness(3) drop-shadow(0 0 20px white); opacity: 0.9; }
                        100% { transform: scale(0.4) rotate(8deg); filter: brightness(5) drop-shadow(0 0 40px white); opacity: 0; }
                    }
                    .card-dying { animation: cardDie 0.7s forwards; }
                    /* Necromance effect animations */
                    @keyframes necromanceFloat {
                        0% { transform: translateX(-50%) translateY(0) scale(1); opacity: 1; }
                        50% { transform: translateX(-50%) translateY(-20px) scale(1.2); opacity: 1; }
                        100% { transform: translateX(-50%) translateY(-40px) scale(0.8); opacity: 0; }
                    }
                    @keyframes necromanceFloatOpponent {
                        0% { transform: translateX(-50%) translateY(0) scale(1); opacity: 1; }
                        50% { transform: translateX(-50%) translateY(15px) scale(1.2); opacity: 1; }
                        100% { transform: translateX(-50%) translateY(30px) scale(0.8); opacity: 0; }
                    }
                    @keyframes necroPulse {
                        0%, 100% { box-shadow: 0 0 10px #d946ef, 0 0 20px #a855f7, inset 0 0 15px rgba(217, 70, 239, 0.3); }
                        50% { box-shadow: 0 0 25px #d946ef, 0 0 40px #a855f7, 0 0 60px #7c3aed, inset 0 0 25px rgba(217, 70, 239, 0.5); }
                    }
                    @keyframes leaderDamageCapPulse {
                        0%, 100% {
                            box-shadow: 0 0 20px rgba(103, 232, 249, 0.4), 0 0 40px rgba(103, 232, 249, 0.2);
                            border-color: #67e8f9;
                        }
                        50% {
                            box-shadow: 0 0 35px rgba(103, 232, 249, 0.7), 0 0 55px rgba(103, 232, 249, 0.4);
                            border-color: #a5f3fc;
                        }
                    }
                    @keyframes leaderDamageCapOverlay {
                        0%, 100% { opacity: 0.15; }
                        50% { opacity: 0.45; }
                    }
                    /* EP/SEP pulse animations for usable state - box-shadow only, no transform override */
                    @keyframes epPulse {
                        0%, 100% {
                            box-shadow: 0 0 12px #ffd700, 0 0 25px rgba(255,215,0,0.6);
                        }
                        50% {
                            box-shadow: 0 0 20px #ffd700, 0 0 40px rgba(255,215,0,0.8), 0 0 55px rgba(255,180,0,0.5);
                        }
                    }
                    @keyframes sepPulse {
                        0%, 100% {
                            box-shadow: 0 0 12px #b794f4, 0 0 25px rgba(159,122,234,0.6);
                        }
                        50% {
                            box-shadow: 0 0 20px #b794f4, 0 0 40px rgba(159,122,234,0.8), 0 0 55px rgba(180,0,255,0.5);
                        }
                    }
                `}),Ze&&l.jsx("div",{style:{position:"absolute",top:"15%",left:"50%",transform:"translate(-50%, -50%)",background:"rgba(0, 0, 0, 0.7)",color:"#fff",padding:"10px 20px",borderRadius:20,pointerEvents:"none",zIndex:1e3,fontWeight:"bold",border:Ze.allowedTargetPlayerId===L?"2px solid #48bb78":"2px solid #f56565"},children:Ze.allowedTargetPlayerId===L?"":""}),pE&&l.jsx(Ow,{onClose:()=>Gu(!1)}),fE&&l.jsx("div",{style:{position:"absolute",inset:0,zIndex:4e3,background:"rgba(0,0,0,0.8)",backdropFilter:"blur(5px)",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>ll(!1),children:l.jsxs("div",{style:{background:"#2d3748",padding:40,borderRadius:16,display:"flex",flexDirection:"column",gap:20,minWidth:300,border:"1px solid rgba(255,255,255,0.1)"},onClick:g=>g.stopPropagation(),children:[l.jsx("h2",{style:{margin:0,textAlign:"center",borderBottom:"1px solid #4a5568",paddingBottom:10,color:"#fff"},children:""}),dE?l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:15},children:[l.jsx("h3",{style:{margin:0,color:"#cbd5e0"},children:""}),l.jsxs("label",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",color:"white"},children:["BGM",l.jsx("input",{type:"checkbox",checked:bt.bgmEnabled,onChange:g=>_o(_=>({..._,bgmEnabled:g.target.checked})),style:{width:20,height:20}})]}),l.jsxs("label",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",color:"white"},children:["SE",l.jsx("input",{type:"checkbox",checked:bt.seEnabled,onChange:g=>_o(_=>({..._,seEnabled:g.target.checked})),style:{width:20,height:20}})]}),l.jsxs("div",{children:[l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",color:"#a0aec0",marginBottom:5},children:[l.jsx("span",{children:"BGM"}),l.jsxs("span",{children:[Math.round(bt.bgm*100),"%"]})]}),l.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:bt.bgm,onChange:g=>_o(_=>({..._,bgm:parseFloat(g.target.value)})),style:{width:"100%"}})]}),l.jsxs("div",{children:[l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",color:"#a0aec0",marginBottom:5},children:[l.jsx("span",{children:"SE"}),l.jsxs("span",{children:[Math.round(bt.se*100),"%"]})]}),l.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:bt.se,onChange:g=>_o(_=>({..._,se:parseFloat(g.target.value)})),style:{width:"100%"}})]}),l.jsxs("div",{children:[l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",color:"#a0aec0",marginBottom:5},children:[l.jsx("span",{children:""}),l.jsxs("span",{children:[Math.round(bt.voice*100),"%"]})]}),l.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:bt.voice,onChange:g=>_o(_=>({..._,voice:parseFloat(g.target.value)})),style:{width:"100%"}})]}),l.jsx("button",{onClick:()=>I0(!1),style:{padding:10,background:"#4a5568",border:"none",color:"white",borderRadius:8,cursor:"pointer",marginTop:10},children:""})]}):l.jsxs(l.Fragment,{children:[l.jsx("button",{onClick:()=>ll(!1),style:{padding:15,background:"#4a5568",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.2rem"},children:""}),l.jsx("button",{onClick:()=>I0(!0),style:{padding:15,background:"#2b6cb0",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.2rem"},children:""}),l.jsx("button",{onClick:()=>cl(!0),style:{padding:15,background:"#e53e3e",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.2rem"},children:""})]})]})}),hE&&l.jsx("div",{style:{position:"absolute",inset:0,zIndex:4100,background:"rgba(0,0,0,0.85)",backdropFilter:"blur(5px)",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>cl(!1),children:l.jsxs("div",{style:{background:"#2d3748",padding:40,borderRadius:16,display:"flex",flexDirection:"column",gap:20,minWidth:320,border:"2px solid #e53e3e",boxShadow:"0 0 30px rgba(229, 62, 62, 0.3)"},onClick:g=>g.stopPropagation(),children:[l.jsx("h2",{style:{margin:0,textAlign:"center",color:"#fff",fontSize:"1.5rem"},children:""}),l.jsx("p",{style:{margin:0,textAlign:"center",color:"#a0aec0",fontSize:"1rem"},children:""}),l.jsxs("div",{style:{display:"flex",gap:15,marginTop:10},children:[l.jsx("button",{onClick:()=>cl(!1),style:{flex:1,padding:15,background:"#4a5568",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.1rem"},children:""}),l.jsx("button",{onClick:gE,style:{flex:1,padding:15,background:"#e53e3e",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.1rem"},children:""})]})]})}),l.jsxs("div",{className:k0?"shake-target":"",style:{width:($?280:340)*d,borderRight:"1px solid rgba(255,255,255,0.1)",background:"rgba(0,0,0,0.3)",padding:$?`${10*d}px ${12*d}px`:`${20*d}px ${20*d}px ${20*d}px`,display:"flex",flexDirection:"column",zIndex:20,flexShrink:0},onClick:g=>g.stopPropagation(),children:[l.jsx("div",{style:{marginBottom:($?6:12)*d},children:l.jsxs("button",{onClick:()=>ll(!0),style:{background:"transparent",border:"none",cursor:"pointer",padding:$?3:5},children:[l.jsx("div",{style:{width:($?22:30)*d,height:($?2:3)*d,background:"#cbd5e0",marginBottom:($?4:6)*d}}),l.jsx("div",{style:{width:($?22:30)*d,height:($?2:3)*d,background:"#cbd5e0",marginBottom:($?4:6)*d}}),l.jsx("div",{style:{width:($?22:30)*d,height:($?2:3)*d,background:"#cbd5e0"}})]})}),l.jsx("h3",{style:{color:"#a0aec0",borderBottom:"1px solid #4a5568",paddingBottom:($?4:8)*d,marginTop:0,marginBottom:0,flexShrink:0,fontSize:$?`${.85*d}rem`:void 0},children:""}),Ne?l.jsx("div",{style:{marginTop:($?4:10)*d,display:"flex",flexDirection:"column",flex:1,overflow:"hidden",minHeight:0},children:l.jsxs("div",{style:{flex:1,overflow:"auto",minHeight:0,display:"flex",flexDirection:"column"},children:[l.jsxs("div",{style:{flexShrink:0},children:[l.jsx("div",{style:{width:"100%",aspectRatio:"1/1",marginBottom:($?6:12)*d,display:"flex",alignItems:"center",justifyContent:"center",...$?{maxHeight:"28vh"}:{}},children:l.jsx(xi,{card:Ne.card,style:{width:"100%",height:"100%",...$?{maxHeight:"28vh"}:{}},variant:"art-only"})}),l.jsx("div",{style:{fontSize:$?`${(Ne.card.name.length>12?.9:Ne.card.name.length>8?1:1.1)*d}rem`:`${Ne.card.name.length>12?1.1:Ne.card.name.length>8?1.2:1.4}rem`,fontWeight:"bold",marginBottom:($?4:6)*d,textAlign:"center"},children:Ne.card.name}),l.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:($?10:15)*d,marginBottom:($?6:10)*d},children:[l.jsx("div",{style:{width:24*d,height:24*d,borderRadius:"50%",background:"radial-gradient(circle at 30% 30%, #68d391, #276749)",border:"1px solid #fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${.85*d}rem`,fontWeight:900,color:"white",textShadow:"0 1px 2px rgba(0,0,0,0.5)",boxShadow:"0 2px 4px rgba(0,0,0,0.3)"},children:Ne.card.cost}),Ne.card.type==="FOLLOWER"&&l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:3*d},children:[l.jsx("svg",{width:18*d,height:18*d,viewBox:"0 0 24 24",fill:"none",children:l.jsx("polygon",{points:"12,2 22,22 2,22",fill:"#63b3ed",stroke:"none"})}),l.jsx("span",{style:{fontSize:`${.95*d}rem`,fontWeight:"bold",color:"#4299e1"},children:"currentAttack"in Ne.card?Ne.card.currentAttack:Ne.card.attack})]}),Ne.card.type==="FOLLOWER"&&l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:3*d},children:[l.jsx("svg",{width:18*d,height:18*d,viewBox:"0 0 24 24",fill:"#f56565",children:l.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})}),l.jsx("span",{style:{fontSize:`${.95*d}rem`,fontWeight:"bold",color:"#f56565"},children:"currentHealth"in Ne.card?Ne.card.currentHealth:Ne.card.health})]})]}),l.jsx("div",{style:{fontSize:`${((((J0=Ne.card.description)==null?void 0:J0.length)||0)>150?.7:(((q0=Ne.card.description)==null?void 0:q0.length)||0)>100?.8:.9)*d}rem`,color:"#cbd5e0",lineHeight:"1.4",whiteSpace:"pre-wrap",borderTop:"1px solid #4a5568",paddingTop:4*d},children:uE(Ne.card.description)})]}),Ne.card.flavorText&&l.jsx("div",{style:{marginTop:"auto",paddingTop:8*d,paddingBottom:4*d,flexShrink:0},children:l.jsx("div",{style:{fontSize:`${((((Z0=Ne.card.flavorText)==null?void 0:Z0.length)||0)>100?.6:.7)*d}rem`,color:"rgba(160, 174, 192, 0.6)",lineHeight:"1.3",fontStyle:"italic",whiteSpace:"pre-wrap",textAlign:"right"},children:Ne.card.flavorText})})]})}):l.jsx("div",{style:{marginTop:10*d,color:"#718096",fontStyle:"italic",flex:1,fontSize:`${.7*d}rem`},children:""})]}),l.jsxs("div",{ref:fi,className:k0?"shake-target":"",style:{flex:1,height:"100%",position:"relative",background:"rgba(0,0,0,0.1)",overflow:"hidden"},children:[l.jsxs("div",{ref:pi,onMouseEnter:()=>Hn({type:"LEADER",playerId:F}),onMouseLeave:()=>Hn(null),onClick:g=>{g.stopPropagation(),Ze&&nd("LEADER",-1,F)},style:{position:"absolute",top:-20*d,left:"50%",transform:"translateX(-50%)",width:Ei*d,height:Ei*d,borderRadius:"50%",zIndex:100,cursor:"default"},children:[l.jsx("div",{style:{position:"absolute",inset:0,borderRadius:"50%",background:Oe.class==="AJA"?`url(${ra(Oe.class)}) center top/cover`:`url(${ra(Oe.class)}) center/cover`,border:fd?"4px solid #67e8f9":(lt==null?void 0:lt.type)==="LEADER"&&lt.playerId===F&&!Ze?"4px solid #f56565":"4px solid #4a5568",boxShadow:fd?"0 0 20px rgba(103, 232, 249, 0.4), 0 0 40px rgba(103, 232, 249, 0.2)":"0 0 20px rgba(0,0,0,0.5)",transition:"border-color 0.3s, box-shadow 0.3s, filter 0.5s, opacity 0.5s",animation:W0?"leaderDamageCapPulse 2s ease-in-out infinite":"none",...y.winnerId===L&&($e||De)?{filter:$e==="white-fade"?"brightness(2) saturate(0.3)":$e==="explode"||$e==="result-text"||$e==="fade-out"||De?"brightness(3) saturate(0) blur(10px)":"none",opacity:$e==="explode"||$e==="result-text"||$e==="fade-out"||De?0:1}:{}},children:W0&&l.jsx("div",{style:{position:"absolute",inset:0,borderRadius:"50%",background:"radial-gradient(circle, rgba(103, 232, 249, 0.5) 0%, rgba(103, 232, 249, 0.2) 70%, rgba(103, 232, 249, 0.1) 100%)",pointerEvents:"none",animation:"leaderDamageCapOverlay 2s ease-in-out infinite",zIndex:1}})}),l.jsx("div",{style:{position:"absolute",bottom:0,left:"50%",transform:`translateX(-50%) translateX(${-140*d}px)`,width:55*d,height:55*d,background:"radial-gradient(circle at 30% 30%, #feb2b2, #c53030)",borderRadius:"50%",border:`${Math.max(2,3*d)}px solid #fff`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${1.2*d}rem`,fontWeight:900,color:"white",textShadow:"0 2px 2px rgba(0,0,0,0.5)",zIndex:10,boxShadow:"0 4px 6px rgba(0,0,0,0.4)",opacity:ye?1:0,transition:"opacity 0.3s ease-in"},children:Oe.hp}),l.jsx("div",{style:{position:"absolute",bottom:10*d,left:"50%",transform:`translateX(-50%) translateX(${-80*d}px)`,width:45*d,height:45*d,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,opacity:ye?cd?1:.5:0,filter:cd?"none":"grayscale(0.8)",transition:"opacity 0.3s ease-in"},children:l.jsx("div",{style:{display:"flex",gap:3*d},children:Array(2).fill(0).map((g,_)=>{const E=_<2-Oe.evolutionsUsed;return l.jsx("div",{style:{width:12*d,height:12*d,borderRadius:"50%",background:E?"#ecc94b":"#2d3748",boxShadow:E&&cd?"0 0 8px #ecc94b, 0 0 15px #ecc94b":"none",border:"2px solid rgba(0,0,0,0.5)"}},_)})})}),l.jsx("div",{style:{position:"absolute",bottom:10*d,left:"50%",transform:`translateX(-50%) translateX(${80*d}px)`,width:45*d,height:45*d,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,opacity:ye?ud?1:.5:0,filter:ud?"none":"grayscale(0.8)",transition:"opacity 0.3s ease-in"},children:l.jsx("div",{style:{display:"flex",gap:3*d},children:Array(2).fill(0).map((g,_)=>{const E=_<Oe.sep;return l.jsx("div",{style:{width:12*d,height:12*d,borderRadius:"50%",background:E?"#9f7aea":"#2d3748",boxShadow:E&&ud?"0 0 8px #9f7aea, 0 0 15px #9f7aea":"none",border:"2px solid rgba(0,0,0,0.5)"}},_)})})}),l.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:Ei*d*.75,height:Ei*d*.75,pointerEvents:"none",zIndex:20,opacity:(lt==null?void 0:lt.type)==="LEADER"&&lt.playerId===F&&K?1:0,transition:"opacity 0.1s ease-out"},children:[l.jsxs("svg",{width:"100%",height:"100%",viewBox:"0 0 100 100",children:[l.jsx("defs",{children:l.jsxs("filter",{id:"leaderCyanMarkerGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"4",result:"blur"}),l.jsxs("feMerge",{children:[l.jsx("feMergeNode",{in:"blur"}),l.jsx("feMergeNode",{in:"blur"}),l.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),l.jsxs("g",{style:{transformOrigin:"50% 50%",animation:"leaderMarkerSpin 2s linear infinite"},children:[l.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"rgba(100, 200, 255, 0.9)",strokeWidth:"3",strokeDasharray:"15 8",filter:"url(#leaderCyanMarkerGlow)"}),l.jsx("polygon",{points:"50,5 44,18 56,18",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"}),l.jsx("polygon",{points:"95,50 82,44 82,56",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"}),l.jsx("polygon",{points:"50,95 56,82 44,82",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"}),l.jsx("polygon",{points:"5,50 18,56 18,44",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"})]})]}),l.jsx("style",{children:`
                                @keyframes leaderMarkerSpin {
                                    0% { transform: rotate(0deg); }
                                    100% { transform: rotate(360deg); }
                                }
                            `})]})]}),l.jsxs("div",{style:{position:"absolute",top:20*d,left:20*d,width:60*d,height:85*d,zIndex:50},children:[[...Array(Math.min(5,Math.ceil(Oe.deck.length/5)))].map((g,_)=>l.jsx("div",{style:{position:"absolute",inset:0,transform:`translate(${_*2*d}px, ${-_*2*d}px)`,borderRadius:6,border:"1px solid #718096",overflow:"hidden"},children:l.jsx("img",{src:Ls((Oe==null?void 0:Oe.class)||"SENKA"),alt:"Deck",style:{width:"100%",height:"100%",objectFit:"cover"},onError:E=>{E.target.style.display="none",E.target.parentElement.style.background="linear-gradient(45deg, #2d3748, #1a202c)"}})},_)),l.jsx("div",{style:{position:"absolute",bottom:-20*d,width:"100%",textAlign:"center",fontWeight:"bold",color:"#a0aec0",fontSize:"0.9rem"},children:Oe.deck.length})]}),l.jsxs("div",{style:{position:"absolute",top:20*d,right:20*d,display:"flex",alignItems:"center",gap:8,zIndex:50,pointerEvents:"none"},children:[l.jsxs("div",{style:{position:"relative",width:24,height:30},children:[l.jsx("div",{style:{position:"absolute",inset:0,background:"#4a192c",borderRadius:2,border:"1px solid #742a3a",transform:"rotate(-15deg) translate(-3px, 0)"}}),l.jsx("div",{style:{position:"absolute",inset:0,background:"#3d1525",borderRadius:2,border:"1px solid #742a3a",transform:"rotate(-5deg) translate(-1px, 0)"}}),l.jsx("div",{style:{position:"absolute",inset:0,background:"#2d1a20",borderRadius:2,border:"1px solid #8b3a4a",transform:"rotate(5deg)"}})]}),l.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(74, 25, 44, 0.8), rgba(45, 26, 32, 0.9))",padding:"3px 8px",borderRadius:5,color:"#f0b8c4",fontSize:"0.64rem",fontWeight:"bold",border:"1px solid rgba(116, 42, 58, 0.5)",boxShadow:"0 2px 4px rgba(0,0,0,0.4)"},children:[" ",Oe.hand.length]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5,marginLeft:6},children:[l.jsx("div",{style:{fontSize:"0.9rem",filter:"drop-shadow(0 0 2px rgba(128, 90, 213, 0.6)) grayscale(30%)"},children:""}),l.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(128, 90, 213, 0.7), rgba(76, 29, 149, 0.8))",padding:"3px 8px",borderRadius:5,color:"#c4b5fd",fontSize:"0.64rem",fontWeight:"bold",border:"1px solid rgba(167, 139, 250, 0.4)",boxShadow:"0 2px 4px rgba(0,0,0,0.4)",position:"relative"},children:[" ",Oe.graveyard.length,Mu.filter(g=>g.playerId===F).map(g=>l.jsxs("div",{style:{position:"absolute",bottom:-25,left:"50%",transform:"translateX(-50%)",color:"#d946ef",fontSize:"1.2rem",fontWeight:"bold",textShadow:"0 0 8px #d946ef, 0 0 15px #a855f7, 0 0 25px #7c3aed",animation:"necromanceFloatOpponent 1.5s ease-out forwards",pointerEvents:"none",whiteSpace:"nowrap"},children:["-",g.amount]},g.key))]})]})]}),l.jsx("div",{style:{position:"absolute",top:`calc(50% - ${yn*d/2}px - ${70*d}px)`,left:"0",width:"100%",height:yn*d,pointerEvents:"none",zIndex:10},children:l.jsx("div",{style:{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center"},children:on.map((g,_)=>{const E=on.length,A=(_-(E-1)/2)*Ds*d;return l.jsxs("div",{ref:P=>Zn.current[_]=P,onMouseEnter:()=>{K&&Hn({type:"FOLLOWER",index:_,playerId:F,instanceId:g==null?void 0:g.instanceId})},onMouseLeave:()=>{K&&Hn(null)},onClick:P=>{if(P.stopPropagation(),Ze){if(!g)return;nd("FOLLOWER",_,F,g==null?void 0:g.instanceId)}else g&&Ir({card:g,owner:"OPPONENT",source:"BOARD"})},style:{position:"absolute",left:"50%",top:0,transform:`translateX(calc(-50% + ${A}px))`,transition:"transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1), left 0.4s ease",border:Ze&&g&&Ze.allowedTargetPlayerId===F?"2px solid #f56565":"none",boxShadow:Ze&&g&&Ze.allowedTargetPlayerId===F?"0 0 15px #f56565":"none",borderRadius:8,cursor:Ze?"crosshair":"default",width:en*d,height:yn*d,pointerEvents:"auto",opacity:At&&At.sourcePlayerId===F&&At.followerIndex===_?0:g!=null&&g.isDying?.8:1,transitionProperty:At&&At.sourcePlayerId===F&&At.followerIndex===_?"none":"transform, left, opacity"},children:[l.jsx("div",{style:{width:"100%",height:"100%",perspective:"800px"},children:l.jsxs("div",{className:x0===(g==null?void 0:g.instanceId)||E0===(g==null?void 0:g.instanceId)?"attack-rotating":"",style:{width:"100%",height:"100%",position:"relative",transformStyle:"preserve-3d"},children:[l.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},children:g?l.jsx(xi,{card:g,turnCount:y.turnCount,className:g.isDying?"card-dying":"",scale:d,style:{width:en*d,height:yn*d,opacity:1,filter:g.isDying?"grayscale(0.5) brightness(2)":"none",boxShadow:(lt==null?void 0:lt.type)==="FOLLOWER"&&lt.index===_&&(K==null?void 0:K.sourceType)==="BOARD"?"0 0 20px #f56565":(K==null?void 0:K.sourceType)==="BOARD"?"0 0 20px #f6e05e":void 0},isOnBoard:!0,isSpecialSummoning:_0.has(g.instanceId)}):l.jsx("div",{style:{width:en*d,height:yn*d,border:"1px dashed rgba(255,255,255,0.1)",borderRadius:8}})}),g&&l.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",transform:"rotateY(180deg)",borderRadius:12,overflow:"hidden"},children:l.jsx("img",{src:Ls((Oe==null?void 0:Oe.class)||"SENKA"),alt:"Card Sleeve",style:{width:"100%",height:"100%",objectFit:"cover"}})})]})}),g&&(K==null?void 0:K.sourceType)==="BOARD"&&l.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",width:"100%",height:"100%",transform:"translate(-50%, -50%)",pointerEvents:"none",zIndex:20,opacity:(lt==null?void 0:lt.type)==="FOLLOWER"&&lt.index===_&&lt.playerId===F?1:0,transition:"opacity 0.1s ease-out"},children:[l.jsxs("svg",{viewBox:"0 0 100 100",style:{width:"100%",height:"100%",filter:"drop-shadow(0 0 12px rgba(100, 200, 255, 0.9))"},children:[l.jsx("defs",{children:l.jsxs("filter",{id:"cyanMarkerGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"4",result:"blur"}),l.jsxs("feMerge",{children:[l.jsx("feMergeNode",{in:"blur"}),l.jsx("feMergeNode",{in:"blur"}),l.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),l.jsxs("g",{style:{transformOrigin:"50px 50px",animation:"attackMarkerSpin 1.5s linear infinite reverse"},children:[l.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:"rgba(100, 200, 255, 0.95)",strokeWidth:"4",strokeDasharray:"12 6",filter:"url(#cyanMarkerGlow)"}),l.jsx("polygon",{points:"50,10 45,20 55,20",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"}),l.jsx("polygon",{points:"90,50 80,45 80,55",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"}),l.jsx("polygon",{points:"50,90 55,80 45,80",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"}),l.jsx("polygon",{points:"10,50 20,55 20,45",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"})]})]}),l.jsx("style",{children:`
                                                    @keyframes attackMarkerSpin {
                                                        0% { transform: rotate(0deg); }
                                                        100% { transform: rotate(360deg); }
                                                    }
                                                `})]})]},(g==null?void 0:g.instanceId)||`empty-opp-${_}`)})})}),l.jsx("div",{style:{position:"absolute",bottom:`calc(50% - ${yn*d/2}px - ${70*d}px)`,left:"0",width:"100%",height:yn*d,pointerEvents:"none",zIndex:10},children:l.jsx("div",{style:{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center"},children:gn.map((g,_)=>{const E=gn.length,A=(_-(E-1)/2)*Ds*d;return l.jsxs("div",{ref:P=>hr.current[_]=P,onMouseDown:P=>L0(P,_,g==null?void 0:g.instanceId),onTouchStart:P=>L0(P,_,g==null?void 0:g.instanceId),onClick:P=>P.stopPropagation(),onMouseEnter:()=>{K&&Hn({type:"FOLLOWER",index:_,playerId:L,instanceId:g==null?void 0:g.instanceId})},onMouseLeave:()=>{K&&Hn(null)},style:{position:"absolute",left:"50%",top:0,"--offsetX":`calc(-50% + ${A}px)`,transform:`translateX(calc(-50% + ${A}px)) ${(K==null?void 0:K.sourceType)==="BOARD"&&K.sourceInstanceId===(g==null?void 0:g.instanceId)?"translateY(-20px) scale(1.1)":""}`,transition:"transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1), left 0.4s ease",cursor:"pointer",pointerEvents:"auto",width:en*d,height:yn*d,border:Ze&&g&&Ze.allowedTargetPlayerId===L?"2px solid #48bb78":"none",boxShadow:Ze&&g&&Ze.allowedTargetPlayerId===L?"0 0 15px #48bb78":"none",borderRadius:8,zIndex:(K==null?void 0:K.sourceType)==="BOARD"&&K.sourceInstanceId===(g==null?void 0:g.instanceId)?10:1,opacity:At&&At.sourcePlayerId===L&&At.followerIndex===_?0:g!=null&&g.isDying?.8:1,transitionProperty:At&&At.sourcePlayerId===L&&At.followerIndex===_?"none":"transform, left, opacity"},children:[l.jsx("div",{style:{width:"100%",height:"100%",perspective:"800px"},children:l.jsxs("div",{className:x0===(g==null?void 0:g.instanceId)||E0===(g==null?void 0:g.instanceId)?"attack-rotating":"",style:{width:"100%",height:"100%",position:"relative",transformStyle:"preserve-3d"},children:[l.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},children:g?l.jsx(xi,{card:g,turnCount:y.turnCount,className:g.isDying?"card-dying":"",scale:d,style:{width:en*d,height:yn*d,opacity:1,filter:g.isDying?"grayscale(0.5) brightness(2)":"none",boxShadow:(K==null?void 0:K.sourceType)==="BOARD"&&K.sourceInstanceId===(g==null?void 0:g.instanceId)&&(lt==null?void 0:lt.type)==="FOLLOWER"?"0 0 30px #f56565":(K==null?void 0:K.sourceType)==="BOARD"&&K.sourceInstanceId===(g==null?void 0:g.instanceId)?"0 20px 30px rgba(0,0,0,0.6)":void 0,pointerEvents:(K==null?void 0:K.sourceType)==="BOARD"&&K.sourceInstanceId===(g==null?void 0:g.instanceId)?"none":"auto"},isSelected:(Ne==null?void 0:Ne.card)===g,isOnBoard:!0,isSpecialSummoning:_0.has(g.instanceId),isMyTurn:y.activePlayerId===L}):l.jsx("div",{style:{width:en*d,height:yn*d,border:"1px dashed rgba(255,255,255,0.2)",borderRadius:8}})}),g&&l.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",transform:"rotateY(180deg)",borderRadius:12,overflow:"hidden"},children:l.jsx("img",{src:Ls((se==null?void 0:se.class)||"SENKA"),alt:"Card Sleeve",style:{width:"100%",height:"100%",objectFit:"cover"}})})]})}),g&&(K==null?void 0:K.sourceType)==="EVOLVE"&&!g.hasEvolved&&l.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",width:"120%",height:"120%",transform:"translate(-50%, -50%)",pointerEvents:"none",border:K.useSep?"2px dashed rgba(183, 148, 244, 0.9)":"2px dashed rgba(255, 230, 100, 0.9)",borderRadius:"50%",boxShadow:K.useSep?"0 0 15px rgba(159, 122, 234, 0.8)":"0 0 15px rgba(255, 200, 50, 0.8)",animation:"evolveMarkerSpin 1.5s linear infinite",zIndex:20,opacity:(lt==null?void 0:lt.type)==="FOLLOWER"&&lt.index===_&&lt.playerId===L?1:0,transition:"opacity 0.1s ease-out"},children:[l.jsxs("svg",{viewBox:"0 0 100 100",style:{width:"100%",height:"100%",filter:"drop-shadow(0 0 8px currentColor)"},children:[l.jsx("defs",{children:l.jsxs("filter",{id:K.useSep?"purpleMarkerGlow":"yellowMarkerGlow",x:"-30%",y:"-30%",width:"160%",height:"160%",children:[l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"3",result:"blur"}),l.jsxs("feMerge",{children:[l.jsx("feMergeNode",{in:"blur"}),l.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),l.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:K.useSep?"#b794f4":"#f6e05e",strokeWidth:"4",strokeDasharray:"15 8",filter:`url(#${K.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`,opacity:"0.95"}),l.jsx("polygon",{points:"50,5 45,15 55,15",fill:K.useSep?"#b794f4":"#f6e05e",filter:`url(#${K.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`}),l.jsx("polygon",{points:"95,50 85,45 85,55",fill:K.useSep?"#b794f4":"#f6e05e",filter:`url(#${K.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`}),l.jsx("polygon",{points:"50,95 55,85 45,85",fill:K.useSep?"#b794f4":"#f6e05e",filter:`url(#${K.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`}),l.jsx("polygon",{points:"5,50 15,55 15,45",fill:K.useSep?"#b794f4":"#f6e05e",filter:`url(#${K.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`})]}),l.jsx("style",{children:`
                                                @keyframes evolveMarkerSpin {
                                                    0% { transform: translate(-50%, -50%) rotate(0deg); }
                                                    100% { transform: translate(-50%, -50%) rotate(360deg); }
                                                }
                                            `})]})]},(g==null?void 0:g.instanceId)||`empty-plr-${_}`)})})}),l.jsxs("div",{style:{position:"absolute",right:30*d,top:"50%",transform:"translateY(-50%)",display:"flex",flexDirection:"column",alignItems:"center",gap:30*d,zIndex:50},children:[l.jsx("div",{style:{textAlign:"center"},children:l.jsxs("div",{style:{fontSize:`${1.2*d}rem`,fontWeight:700,color:"#a0aec0",fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif'},children:["Turn ",y.turnCount]})}),l.jsxs("div",{style:{textAlign:"center"},children:[l.jsxs("div",{style:{fontSize:`${1.8*d}rem`,fontWeight:900,color:"#f6e05e",fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif'},children:[Oe.pp,"/",Oe.maxPp]}),l.jsx("div",{style:{display:"flex",gap:4*d,justifyContent:"center"},children:Array(Math.min(10,Oe.maxPp)).fill(0).map((g,_)=>l.jsx("div",{style:{width:10*d,height:10*d,borderRadius:"50%",background:_<Oe.pp?"#f6e05e":"#2d3748"}},_))})]}),l.jsxs("div",{style:{position:"relative",width:160*d,height:160*d},children:[l.jsx(gw,{isMyTurn:y.activePlayerId===L,turnCount:y.turnCount,activePlayerId:y.activePlayerId,onTimeUp:SE,timerEnabled:h,isGameOver:!!y.winnerId,scale:d,buttonSize:160,timerDuration:60}),l.jsxs("button",{ref:y0,disabled:y.activePlayerId!==L||yi,onMouseDown:g=>{g.stopPropagation(),y.activePlayerId===L&&!yi&&sd(!0)},onMouseUp:g=>{var _;if(g.stopPropagation(),ml&&y.activePlayerId===L&&!yi){sd(!1),ht("sisiodosi.mp3",.6);const E=(_=g.target.closest("button"))==null?void 0:_.getBoundingClientRect();E&&F0(E.left+E.width/2,E.top+E.height/2),od()}},onMouseLeave:()=>{sd(!1)},style:{width:160*d,height:160*d,borderRadius:"50%",border:"4px solid rgba(255,255,255,0.2)",background:yi?"linear-gradient(135deg, #805ad5, #6b46c1)":ml?"linear-gradient(135deg, #5a9bd5, #4a7fb0)":y.activePlayerId===L?"linear-gradient(135deg, #3182ce, #2b6cb0)":"#2d3748",color:"white",fontWeight:900,fontSize:`${2*d}rem`,fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif',boxShadow:y.activePlayerId===L?ml?"0 0 20px rgba(66, 153, 225, 0.5)":"0 0 40px rgba(66, 153, 225, 0.8)":"none",opacity:ml?.8:1,cursor:y.activePlayerId===L&&!yi?"pointer":"default",transition:"all 0.1s",position:"relative",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",lineHeight:1.2},children:[l.jsx("img",{src:Je("/assets/tenfubu_mark.png"),alt:"",style:{position:"absolute",width:"80%",height:"80%",objectFit:"contain",opacity:.25,pointerEvents:"none"}}),yi?l.jsx("span",{style:{position:"relative",zIndex:1,whiteSpace:"nowrap"},children:"..."}):l.jsxs(l.Fragment,{children:[l.jsx("span",{style:{position:"relative",zIndex:1,whiteSpace:"nowrap"},children:""}),l.jsx("span",{style:{position:"relative",zIndex:1,whiteSpace:"nowrap"},children:""})]})]})]}),l.jsxs("div",{style:{textAlign:"center"},children:[l.jsx("div",{style:{fontSize:`${2.4*d}rem`,fontWeight:900,color:"#f6e05e",fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif'},children:se.extraPpActive?l.jsxs("span",{children:[Math.max(0,se.pp-1),"/",se.maxPp," ",l.jsx("span",{style:{color:"#ed8936"},children:"+1"})]}):l.jsxs("span",{children:[se.pp,"/",se.maxPp]})}),l.jsx("div",{style:{display:"flex",gap:3*d,justifyContent:"center"},children:Array(10).fill(0).map((g,_)=>{const E=_<se.pp,A=_<se.maxPp;let P;return E?P="#f6e05e":A?P="#744210":P="#2d3748",l.jsx("div",{style:{width:11*d,height:11*d,borderRadius:"50%",background:P}},_)})})]}),(()=>{const g=L!==y.firstPlayerId,_=y.activePlayerId===L,E=y.turnCount,A=E<=5&&!se.extraPpUsedEarly,P=E>=6&&!se.extraPpUsedLate,H=g&&_&&!se.extraPpActive&&(A||P),X=se.extraPpActive;if(!g)return null;const M=E<=5&&se.extraPpUsedEarly||E>=6&&se.extraPpUsedLate,N=!H&&!X;return l.jsxs("button",{disabled:N,onClick:G=>{G.stopPropagation(),N||Yr({type:"TOGGLE_EXTRA_PP",playerId:L})},style:{width:160*d,height:45*d,borderRadius:12*d,border:X?"3px solid #ed8936":"3px solid rgba(255,255,255,0.2)",background:X?"linear-gradient(135deg, #ed8936, #dd6b20)":H?"linear-gradient(135deg, #744210, #5a3510)":"#2d3748",color:X?"white":H?"#f6e05e":"#718096",fontWeight:700,fontSize:"1rem",boxShadow:X?"0 0 20px rgba(237, 137, 54, 0.6)":"none",cursor:N?"default":"pointer",transition:"all 0.3s",display:"flex",alignItems:"center",justifyContent:"center",gap:6*d,opacity:M&&!X?.5:1},children:[l.jsx("span",{children:"PP"}),l.jsx("span",{style:{fontSize:"1.3rem"},children:"+1"}),X&&l.jsx("span",{style:{fontSize:"0.8rem"},children:"ON"}),M&&!X&&l.jsx("span",{style:{fontSize:"0.7rem",marginLeft:2},children:""})]})})()]}),$?l.jsxs(l.Fragment,{children:[l.jsx("button",{onClick:g=>{g.stopPropagation(),Gu(!0)},style:{position:"absolute",left:15*d,top:120*d,width:64*d,height:64*d,minWidth:64*d,maxWidth:64*d,minHeight:64*d,maxHeight:64*d,borderRadius:"50%",background:"linear-gradient(135deg, #4a5568 0%, #2d3748 100%)",border:"3px solid #63b3ed",color:"#63b3ed",fontSize:`${1.8*d}rem`,fontWeight:"bold",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,padding:0,zIndex:16,boxShadow:"0 2px 8px rgba(0,0,0,0.4)",transition:"all 0.2s ease"},onMouseEnter:g=>{g.currentTarget.style.transform="scale(1.1)",g.currentTarget.style.boxShadow="0 0 15px rgba(99, 179, 237, 0.5)"},onMouseLeave:g=>{g.currentTarget.style.transform="scale(1)",g.currentTarget.style.boxShadow="0 2px 8px rgba(0,0,0,0.4)"},children:"?"}),l.jsx(Pw,{logs:y.logs||[],onCardNameClick:zu,scale:d,isMobile:$})]}):l.jsxs("div",{style:{position:"absolute",left:15,top:"50%",transform:"translateY(-50%)",display:"flex",flexDirection:"column",alignItems:"flex-start",gap:8,zIndex:16,pointerEvents:"none"},children:[l.jsx("button",{onClick:g=>{g.stopPropagation(),Gu(!0)},style:{width:36,height:36,borderRadius:"50%",background:"linear-gradient(135deg, #4a5568 0%, #2d3748 100%)",border:"2px solid #63b3ed",color:"#63b3ed",fontSize:"1.2rem",fontWeight:"bold",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",padding:0,boxShadow:"0 4px 12px rgba(0,0,0,0.4)",transition:"all 0.2s ease",pointerEvents:"auto"},onMouseEnter:g=>{g.currentTarget.style.transform="scale(1.1)",g.currentTarget.style.boxShadow="0 0 15px rgba(99, 179, 237, 0.5)"},onMouseLeave:g=>{g.currentTarget.style.transform="scale(1)",g.currentTarget.style.boxShadow="0 4px 12px rgba(0,0,0,0.4)"},children:"?"}),l.jsxs("div",{style:{width:Math.max(180,220*d),height:Math.max(200,280*d),overflowY:"auto",background:"linear-gradient(to right, rgba(0,0,0,0.8), rgba(0,0,0,0.0))",color:"#fff",fontSize:`${Math.max(.65,.75*d)}rem`,padding:`${8*d}px ${8*d}px ${8*d}px ${12*d}px`,borderLeft:"3px solid #63b3ed",pointerEvents:"auto",scrollbarWidth:"thin"},onMouseDown:g=>g.stopPropagation(),onClick:g=>g.stopPropagation(),ref:g=>{g&&(g.scrollTop=g.scrollHeight)},children:[l.jsx("div",{style:{fontWeight:"bold",marginBottom:4*d,color:"#a0aec0",borderBottom:"1px solid rgba(255,255,255,0.1)",paddingBottom:2,fontSize:`${Math.max(.55,.65*d)}rem`,textTransform:"uppercase",letterSpacing:1},children:"BATTLE LOG"}),l.jsx("div",{style:{display:"flex",flexDirection:"column",gap:3*d},children:(y.logs||[]).map((g,_)=>l.jsx("div",{style:{opacity:.9,lineHeight:"1.4",textShadow:"0 1px 2px black",animation:"fadeIn 0.3s ease-out"},children:g},_))})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,pointerEvents:"none"},children:[l.jsxs("div",{style:{position:"relative",width:32,height:40},children:[l.jsx("div",{style:{position:"absolute",inset:0,background:"#4a5568",borderRadius:4,border:"1px solid #718096",transform:"rotate(-15deg) translate(-5px, 0)"}}),l.jsx("div",{style:{position:"absolute",inset:0,background:"#2d3748",borderRadius:4,border:"1px solid #718096",transform:"rotate(-5deg) translate(-2px, 0)"}}),l.jsx("div",{style:{position:"absolute",inset:0,background:"#1a202c",borderRadius:4,border:"1px solid #cbd5e0",transform:"rotate(5deg)"}})]}),l.jsxs("div",{style:{background:"rgba(0,0,0,0.7)",padding:"4px 12px",borderRadius:8,color:"#e2e8f0",fontSize:"0.9rem",fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5)"},children:[" ",se.hand.length]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,marginLeft:6},children:[l.jsx("div",{style:{fontSize:"1.2rem",filter:"drop-shadow(0 0 3px rgba(128, 90, 213, 0.8))"},children:""}),l.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(128, 90, 213, 0.8), rgba(76, 29, 149, 0.9))",padding:"4px 12px",borderRadius:8,color:"#e2e8f0",fontSize:"0.9rem",fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5), inset 0 1px rgba(255,255,255,0.1)",border:"1px solid rgba(167, 139, 250, 0.5)",position:"relative"},children:[" ",se.graveyard.length,Mu.filter(g=>g.playerId===L).map(g=>l.jsxs("div",{style:{position:"absolute",top:-30,left:"50%",transform:"translateX(-50%)",color:"#d946ef",fontSize:"1.5rem",fontWeight:"bold",textShadow:"0 0 10px #d946ef, 0 0 20px #a855f7, 0 0 30px #7c3aed",animation:"necromanceFloat 1.5s ease-out forwards",pointerEvents:"none",whiteSpace:"nowrap"},children:["-",g.amount]},g.key))]})]})]}),Ne&&Ne.owner==="PLAYER"&&Ne.source==="HAND"&&kr&&(()=>{const E=(($?Math.max(140,180*d):Math.max(180,220*d))-6)/2,A=se.pp>=Ne.card.cost;return l.jsxs("button",{disabled:!A,onClick:P=>{P.stopPropagation(),j0()},className:A?"play-button-active":"",style:{width:E,background:A?"linear-gradient(to bottom, #48bb78, #38a169)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:"8px 4px",borderRadius:12,fontSize:"0.85rem",fontWeight:"bold",cursor:A?"pointer":"not-allowed",boxShadow:A?"0 0 15px rgba(72, 187, 120, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease",pointerEvents:"auto"},onMouseDown:P=>P.stopPropagation(),children:["",l.jsxs("div",{style:{fontSize:"0.6rem",opacity:.8,marginTop:2},children:["pp ",Ne.card.cost]})]})})(),Ne&&Ne.owner==="PLAYER"&&Ne.source==="BOARD"&&(()=>{const g=$?Math.max(140,180*d):Math.max(180,220*d),_=6,E=(g-_)/2,A=Ne.card,P=A==null?void 0:A.hasEvolved,H=!P&&Xr,X=!P&&Qr,M=A==null?void 0:A.instanceId,N=se.board.findIndex(Q=>Q&&Q.instanceId===M),G=se.board.slice(0,N+1).filter(Q=>Q).length-1,ae=Q=>{N<0||hl(G>=0?G:N,Q,void 0,M)};return l.jsxs("div",{style:{display:"flex",gap:_,pointerEvents:"auto"},onMouseDown:Q=>Q.stopPropagation(),children:[l.jsxs("button",{disabled:!H,onClick:Q=>{Q.stopPropagation(),ae(!1)},style:{width:E,background:H?"linear-gradient(to bottom, #faf089, #d69e2e)":"#718096",color:H?"#1a202c":"white",border:"2px solid rgba(255,255,255,0.2)",padding:"8px 4px",borderRadius:12,fontSize:"0.85rem",fontWeight:"bold",cursor:H?"pointer":"not-allowed",boxShadow:H?"0 0 15px rgba(250, 240, 137, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:H?"0 1px 1px rgba(255,255,255,0.3)":"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",l.jsx("div",{style:{fontSize:"0.6rem",opacity:.8,marginTop:2},children:"EP"})]}),l.jsxs("button",{disabled:!X,onClick:Q=>{Q.stopPropagation(),ae(!0)},style:{width:E,background:X?"linear-gradient(to bottom, #b794f4, #805ad5)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:"8px 4px",borderRadius:12,fontSize:"0.85rem",fontWeight:"bold",cursor:X?"pointer":"not-allowed",boxShadow:X?"0 0 15px rgba(183, 148, 244, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",l.jsx("div",{style:{fontSize:"0.6rem",opacity:.8,marginTop:2},children:"SEP"})]})]})})(),!(Ne&&Ne.owner==="PLAYER"&&(Ne.source==="HAND"||Ne.source==="BOARD"))&&(()=>{const g=$?Math.max(140,180*d):Math.max(180,220*d);return l.jsx("div",{style:{width:g,height:52,visibility:"hidden",pointerEvents:"none"}})})()]}),(at==="TOSSING"||at==="RESULT")&&l.jsxs("div",{style:{position:"absolute",inset:0,zIndex:4e3,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.85)",pointerEvents:"none"},children:[l.jsxs("div",{style:{textAlign:"center"},children:[l.jsx("div",{style:{width:120*d,height:120*d,margin:`0 auto ${30*d}px`,borderRadius:"50%",background:at==="RESULT"?Mt==="FIRST"?"linear-gradient(135deg, #ffd700, #ff8c00)":"linear-gradient(135deg, #c0c0c0, #808080)":"linear-gradient(135deg, #ffd700, #ff8c00)",boxShadow:at==="RESULT"?`0 0 ${40*d}px ${Mt==="FIRST"?"#ffd700":"#c0c0c0"}, 0 0 ${80*d}px ${Mt==="FIRST"?"rgba(255,215,0,0.5)":"rgba(192,192,192,0.5)"}`:`0 0 ${30*d}px #ffd700`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"3rem",fontWeight:900,color:"#1a202c",textShadow:"0 2px 2px rgba(0,0,0,0.5)",animation:at==="TOSSING"?"coinFlip 0.3s ease-in-out infinite":"coinLand 0.5s ease-out",border:"4px solid rgba(255,255,255,0.3)"},children:at==="RESULT"?Mt==="FIRST"?"":"":"?"}),l.jsxs("div",{style:{fontSize:at==="RESULT"?"2.5rem":"1.8rem",fontWeight:900,color:Mt==="FIRST"?"#ffd700":Mt==="SECOND"?"#c0c0c0":"white",textShadow:"0 0 20px currentColor, 0 2px 4px black",animation:at==="RESULT"?"textPop 0.5s ease-out":"none"},children:[at==="TOSSING"&&"...",at==="RESULT"&&(Mt==="FIRST"?"":"")]}),at==="RESULT"&&l.jsx("div",{style:{fontSize:"1rem",color:"#a0aec0",marginTop:10*d,animation:"fadeIn 0.5s ease-out 0.3s both"},children:Mt==="FIRST"?"":""})]}),l.jsx("style",{children:`
                            @keyframes coinFlip {
                                0%, 100% { transform: rotateY(0deg) scale(1); }
                                50% { transform: rotateY(180deg) scale(1.1); }
                            }
                            @keyframes coinLand {
                                0% { transform: rotateY(720deg) scale(0.5); }
                                70% { transform: rotateY(0deg) scale(1.2); }
                                100% { transform: rotateY(0deg) scale(1); }
                            }
                            @keyframes textPop {
                                0% { transform: scale(0.5); opacity: 0; }
                                70% { transform: scale(1.2); }
                                100% { transform: scale(1); opacity: 1; }
                            }
                        `})]}),Cn&&l.jsxs("div",{style:{position:"absolute",inset:0,zIndex:3e3,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.7)",pointerEvents:"none",animation:"fadeIn 0.2s ease-out"},children:[l.jsx("div",{style:{fontSize:`${3.5*d}rem`,fontWeight:900,fontFamily:"Tamanegi, sans-serif",background:"linear-gradient(135deg, #ffd700, #ff6b6b, #ffd700)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",textShadow:"none",filter:`drop-shadow(0 0 ${15*d}px rgba(255,215,0,0.8)) drop-shadow(0 0 ${30*d}px rgba(255,107,107,0.5))`,animation:"gameStartPop 0.8s ease-out",letterSpacing:"0.2em"},children:" "}),l.jsx("style",{children:`
                            @keyframes gameStartPop {
                                0% { transform: scale(0.3) rotate(-10deg); opacity: 0; }
                                50% { transform: scale(1.2) rotate(5deg); opacity: 1; }
                                70% { transform: scale(0.95) rotate(-2deg); }
                                100% { transform: scale(1) rotate(0deg); opacity: 1; }
                            }
                        `})]}),l.jsxs("div",{ref:Ps,style:{position:"absolute",bottom:-20*d,left:"50%",transform:"translateX(-50%)",width:Ei*d,height:Ei*d,borderRadius:"50%",zIndex:200},children:[l.jsxs("div",{onMouseDown:_E,style:{width:"100%",height:"100%",borderRadius:"50%",overflow:"hidden",border:dd?"4px solid #67e8f9":"4px solid #3182ce",boxShadow:dd?"0 0 20px rgba(103, 232, 249, 0.4), 0 0 40px rgba(103, 232, 249, 0.2)":"0 0 20px rgba(49, 130, 206, 0.4)",background:"#1a202c",cursor:"grab",transition:"border-color 0.3s, box-shadow 0.3s, filter 0.5s, opacity 0.5s",animation:H0?"leaderDamageCapPulse 2s ease-in-out infinite":"none",position:"relative",...y.winnerId&&y.winnerId!==L&&($e||De)?{filter:$e==="white-fade"?"brightness(2) saturate(0.3)":$e==="explode"||$e==="result-text"||$e==="fade-out"||De?"brightness(3) saturate(0) blur(10px)":"none",opacity:$e==="explode"||$e==="result-text"||$e==="fade-out"||De?0:1}:{}},children:[l.jsx("img",{src:ra(se.class),style:se.class==="AJA"?{width:"100%",height:"100%",objectFit:"cover",objectPosition:"center top",pointerEvents:"none"}:{width:"100%",height:"100%",objectFit:"cover",pointerEvents:"none"}}),H0&&l.jsx("div",{style:{position:"absolute",inset:0,borderRadius:"50%",background:"radial-gradient(circle, rgba(103, 232, 249, 0.5) 0%, rgba(103, 232, 249, 0.2) 70%, rgba(103, 232, 249, 0.1) 100%)",pointerEvents:"none",animation:"leaderDamageCapOverlay 2s ease-in-out infinite",zIndex:1}})]}),l.jsx("div",{style:{position:"absolute",top:0,left:"50%",transform:`translateX(-50%) translateX(${-140*d}px)`,width:55*d,height:55*d,background:"radial-gradient(circle at 30% 30%, #feb2b2, #c53030)",borderRadius:"50%",border:`${Math.max(2,3*d)}px solid #fff`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${1.2*d}rem`,fontWeight:900,color:"white",textShadow:"0 2px 2px rgba(0,0,0,0.5)",boxShadow:"0 4px 6px rgba(0,0,0,0.4)",zIndex:10,opacity:ye?1:0,transition:"opacity 0.3s ease-in"},children:se.hp}),l.jsx("div",{onMouseDown:g=>gl(g,!1),onTouchStart:g=>gl(g,!1),style:{position:"absolute",top:10*d,left:"50%",transform:`translateX(-50%) translateX(${-80*d}px)`,width:45*d,height:45*d,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:Xr?"rgba(255,235,100,0.2)":"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",cursor:Xr?"grab":"default",zIndex:10,opacity:ye?yl?1:.5:0,filter:yl?"none":"grayscale(0.8)",transition:"opacity 0.3s ease-in, filter 0.3s, background 0.3s",boxShadow:Xr?"0 0 12px #ffd700, 0 0 25px rgba(255,215,0,0.5)":"none",animation:Xr?"epPulse 1.5s ease-in-out infinite":"none"},children:l.jsx("div",{style:{display:"flex",gap:3*d},children:Array(2).fill(0).map((g,_)=>{const E=_<$0;let A="none";return E&&yl&&(A=Xr?"0 0 10px #fff59d, 0 0 20px #ffd700, 0 0 30px #ecc94b":"0 0 8px #ecc94b, 0 0 15px #ecc94b"),l.jsx("div",{style:{width:12*d,height:12*d,borderRadius:"50%",background:E?Xr?"#fff59d":"#ecc94b":"#2d3748",boxShadow:A,border:"2px solid rgba(0,0,0,0.5)",transition:"box-shadow 0.3s, background 0.3s"}},_)})})}),l.jsx("div",{onMouseDown:g=>gl(g,!0),onTouchStart:g=>gl(g,!0),style:{position:"absolute",top:10*d,left:"50%",transform:`translateX(-50%) translateX(${80*d}px)`,width:45*d,height:45*d,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:Qr?"rgba(200,160,255,0.2)":"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,cursor:Qr?"grab":"default",opacity:ye?vl?1:.5:0,filter:vl?"none":"grayscale(0.8)",transition:"opacity 0.3s ease-in, filter 0.3s, background 0.3s",boxShadow:Qr?"0 0 12px #b794f4, 0 0 25px rgba(159,122,234,0.5)":"none",animation:Qr?"sepPulse 1.5s ease-in-out infinite":"none"},children:l.jsx("div",{style:{display:"flex",gap:3*d},children:Array(2).fill(0).map((g,_)=>{const E=_<se.sep;let A="none";return E&&vl&&(A=Qr?"0 0 10px #d6bcfa, 0 0 20px #b794f4, 0 0 30px #9f7aea":"0 0 8px #9f7aea, 0 0 15px #9f7aea"),l.jsx("div",{style:{width:12*d,height:12*d,borderRadius:"50%",background:E?Qr?"#d6bcfa":"#9f7aea":"#2d3748",boxShadow:A,border:"2px solid rgba(0,0,0,0.5)",transition:"box-shadow 0.3s, background 0.3s"}},_)})})})]}),l.jsxs("div",{style:{position:"absolute",bottom:10*d,right:15*d,width:60*d,height:85*d,zIndex:50},children:[[...Array(Math.min(5,Math.ceil(se.deck.length/5)))].map((g,_)=>l.jsx("div",{style:{position:"absolute",inset:0,transform:`translate(${_*2*d}px, ${-_*2*d}px)`,borderRadius:6,border:"1px solid #718096",boxShadow:"1px 1px 3px rgba(0,0,0,0.5)",overflow:"hidden"},children:l.jsx("img",{src:Ls((se==null?void 0:se.class)||"SENKA"),alt:"Deck",style:{width:"100%",height:"100%",objectFit:"cover"},onError:E=>{E.target.style.display="none",E.target.parentElement.style.background="linear-gradient(45deg, #2d3748, #1a202c)"}})},_)),l.jsx("div",{style:{position:"absolute",top:-20*d,width:"100%",textAlign:"center",color:"#a0aec0",fontSize:"0.9rem",fontWeight:"bold",textShadow:"0 1px 2px black"},children:se.deck.length})]}),l.jsx("div",{style:{position:"absolute",bottom:0,left:0,width:"100%",height:200*d,display:"flex",justifyContent:"center",alignItems:"flex-end",pointerEvents:"none",zIndex:500},children:se.hand.map((g,_)=>{if(He!==null&&He.sourceIndex===_)return null;const A=se.hand.length;let P=0,H=0,X=0;if(kr){const N=100*d,G=window.innerWidth-40*d,ae=(A-1)*N+en*d;let Q=N;ae>G&&(Q=(G-en*d)/Math.max(1,A-1)),P=(_-(A-1)/2)*Q,H=J===_?-8*d:0,X=0}else{const N=45*d,G=160*d,ae=en*d/2,Q=window.innerWidth/2-G-ae,ue=window.innerWidth-340*d-G,ve=(A-1)*N+en*d;let We=N;ve>ue&&(We=(ue-en*d)/Math.max(1,A-1)),P=Q-(A-1-_)*We,H=0,X=(_-(A-1)/2)*3}const M=se.pp>=g.cost&&y.activePlayerId===L;return l.jsx("div",{onMouseDown:N=>{P0(N,_),kr&&me(_===J?null:_)},onTouchStart:N=>{P0(N,_),kr&&me(_===J?null:_)},style:{position:"absolute",left:"50%",bottom:5*d,transform:`translateX(calc(-50% + ${P}px)) translateY(${H}px) rotate(${X}deg) ${(K==null?void 0:K.sourceType)==="HAND"&&K.sourceIndex===_?"scale(1.05) translateY(-10px)":kr?"translateY(-3px)":""}`,transition:cE===_?"all 0.3s ease-in":(K==null?void 0:K.sourceType)==="HAND"&&K.sourceIndex===_?"none":"all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1)",zIndex:(K==null?void 0:K.sourceType)==="HAND"&&K.sourceIndex===_?1e3:_+100,width:($?80:en)*d,height:($?115:yn)*d,pointerEvents:"auto",cursor:M?"grab":"not-allowed"},onClick:N=>N.stopPropagation(),children:l.jsx(xi,{card:g,turnCount:y.turnCount,isMyTurn:y.activePlayerId===L,isPlayable:M,scale:d,variant:$?"mobile-hand":"normal",style:{width:$?80*d:en*d,height:$?115*d:yn*d,boxShadow:(K==null?void 0:K.sourceType)==="HAND"&&K.sourceIndex===_?"0 0 40px rgba(49, 130, 206, 0.8)":M?"0 0 15px rgba(40, 180, 100, 0.6)":"none"}})},g.instanceId)})}),$&&l.jsxs("div",{style:{position:"absolute",bottom:200*d,left:15*d,display:"flex",alignItems:"center",gap:10*d,zIndex:601,pointerEvents:"none"},children:[l.jsxs("div",{style:{position:"relative",width:50*d,height:62*d},children:[l.jsx("div",{style:{position:"absolute",inset:0,background:"#4a5568",borderRadius:6*d,border:"1px solid #718096",transform:"rotate(-15deg) translate(-5px, 0)"}}),l.jsx("div",{style:{position:"absolute",inset:0,background:"#2d3748",borderRadius:6*d,border:"1px solid #718096",transform:"rotate(-5deg) translate(-2px, 0)"}}),l.jsx("div",{style:{position:"absolute",inset:0,background:"#1a202c",borderRadius:6*d,border:"1px solid #cbd5e0",transform:"rotate(5deg)"}})]}),l.jsxs("div",{style:{background:"rgba(0,0,0,0.7)",padding:`${6*d}px ${16*d}px`,borderRadius:10*d,color:"#e2e8f0",fontSize:`${1.32*d}rem`,fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5)"},children:[" ",se.hand.length]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6*d,marginLeft:10*d},children:[l.jsx("div",{style:{fontSize:`${1.87*d}rem`,filter:"drop-shadow(0 0 3px rgba(128, 90, 213, 0.8))"},children:""}),l.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(128, 90, 213, 0.8), rgba(76, 29, 149, 0.9))",padding:`${6*d}px ${16*d}px`,borderRadius:10*d,color:"#e2e8f0",fontSize:`${1.32*d}rem`,fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5), inset 0 1px rgba(255,255,255,0.1)",border:"1px solid rgba(167, 139, 250, 0.5)",position:"relative"},children:[" ",se.graveyard.length,Mu.filter(g=>g.playerId===L).map(g=>l.jsxs("div",{style:{position:"absolute",top:-30,left:"50%",transform:"translateX(-50%)",color:"#d946ef",fontSize:"1.5rem",fontWeight:"bold",textShadow:"0 0 10px #d946ef, 0 0 20px #a855f7, 0 0 30px #7c3aed",animation:"necromanceFloat 1.5s ease-out forwards",pointerEvents:"none",whiteSpace:"nowrap"},children:["-",g.amount]},g.key))]})]})]}),$&&Ne&&Ne.owner==="PLAYER"&&Ne.source==="HAND"&&kr&&(()=>{const g=Math.max(140,180*d),_=4*d,E=(g-_)/2,A=se.pp>=Ne.card.cost;return l.jsxs("div",{style:{position:"absolute",left:15*d,bottom:135*d,zIndex:600,pointerEvents:"auto"},children:[l.jsxs("button",{disabled:!A,onClick:P=>{P.stopPropagation(),j0()},className:A?"play-button-active":"",style:{width:E,background:A?"linear-gradient(to bottom, #48bb78, #38a169)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:`${5*d}px ${3*d}px`,borderRadius:10*d,fontSize:`${.7*d}rem`,fontWeight:"bold",cursor:A?"pointer":"not-allowed",boxShadow:A?"0 0 12px rgba(72, 187, 120, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},onMouseDown:P=>P.stopPropagation(),children:["",l.jsxs("div",{style:{fontSize:`${.5*d}rem`,opacity:.8,marginTop:1},children:["pp ",Ne.card.cost]})]}),l.jsx("style",{children:`
                                @keyframes playGlowPulse {
                                    0% { box-shadow: 0 0 10px rgba(72, 187, 120, 0.4); }
                                    50% { box-shadow: 0 0 25px rgba(72, 187, 120, 0.8); }
                                    100% { box-shadow: 0 0 10px rgba(72, 187, 120, 0.4); }
                                }
                                .play-button-active {
                                    animation: playGlowPulse 2s infinite ease-in-out;
                                }
                            `})]})})(),$&&Ne&&Ne.owner==="PLAYER"&&Ne.source==="BOARD"&&(()=>{const g=Math.max(140,180*d),_=4*d,E=(g-_)/2,A=Ne.card,P=A==null?void 0:A.hasEvolved,H=!P&&Xr,X=!P&&Qr,M=A==null?void 0:A.instanceId,N=se.board.findIndex(Q=>Q&&Q.instanceId===M),G=se.board.slice(0,N+1).filter(Q=>Q).length-1,ae=Q=>{N<0||hl(G>=0?G:N,Q,void 0,M)};return l.jsxs("div",{style:{position:"absolute",left:15*d,bottom:135*d,zIndex:600,pointerEvents:"auto",display:"flex",gap:_},onMouseDown:Q=>Q.stopPropagation(),children:[l.jsxs("button",{disabled:!H,onClick:Q=>{Q.stopPropagation(),ae(!1)},style:{width:E,background:H?"linear-gradient(to bottom, #faf089, #d69e2e)":"#718096",color:H?"#1a202c":"white",border:"2px solid rgba(255,255,255,0.2)",padding:`${5*d}px ${3*d}px`,borderRadius:10*d,fontSize:`${.7*d}rem`,fontWeight:"bold",cursor:H?"pointer":"not-allowed",boxShadow:H?"0 0 12px rgba(250, 240, 137, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:H?"0 1px 1px rgba(255,255,255,0.3)":"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",l.jsx("div",{style:{fontSize:`${.5*d}rem`,opacity:.8,marginTop:1},children:"EP"})]}),l.jsxs("button",{disabled:!X,onClick:Q=>{Q.stopPropagation(),ae(!0)},style:{width:E,background:X?"linear-gradient(to bottom, #b794f4, #805ad5)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:`${5*d}px ${3*d}px`,borderRadius:10*d,fontSize:`${.7*d}rem`,fontWeight:"bold",cursor:X?"pointer":"not-allowed",boxShadow:X?"0 0 12px rgba(183, 148, 244, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",l.jsx("div",{style:{fontSize:`${.5*d}rem`,opacity:.8,marginTop:1},children:"SEP"})]})]})})(),Gr&&Array.from({length:Gr.count},(g,_)=>{const X=-(Gr.count*80+(Gr.count-1)*20-80)/2+_*100,M=Gr.isPlayer?Ls((se==null?void 0:se.class)||"SENKA"):Ls((Oe==null?void 0:Oe.class)||"SENKA");return l.jsx("div",{style:{position:"absolute",left:Gr.isPlayer?"calc(100% - 90px)":90,top:Gr.isPlayer?"calc(100% - 105px)":105,width:80,height:110,borderRadius:8,border:"2px solid white",overflow:"hidden",transform:`translateX(${X}px)`,animation:`drawCard${Gr.isPlayer?"Player":"Opponent"} ${Hu}ms cubic-bezier(0.2, 0.8, 0.2, 1) forwards`,zIndex:9e3+_,boxShadow:"0 0 10px rgba(255,255,255,0.5)"},children:l.jsx("img",{src:M,alt:"Card Back",style:{width:"100%",height:"100%",objectFit:"cover"},onError:N=>{N.target.style.display="none",N.target.parentElement.style.background="repeating-linear-gradient(45deg, #2d3748, #2d3748 10px, #1a202c 10px, #1a202c 20px)"}})},_)}),l.jsx("style",{children:`
                        @keyframes drawCardPlayer {
                            0% { opacity: 1; }
                            100% { transform: translate(-50vw, -100px) scale(0.5) rotate(-10deg); opacity: 0; }
                        }
                        @keyframes drawCardOpponent {
                            0% { opacity: 1; }
                            100% { transform: translate(50vw, 200px) scale(0.5) rotate(10deg); opacity: 0; }
                        }
                    `})]}),mE.map(g=>l.jsx(Aw,{value:g.value,x:g.x,y:g.y,color:g.color,scale:d,onComplete:()=>ul(_=>_.filter(E=>E.id!==g.id))},g.id)),Nu&&Sr.current&&(()=>{const g=Sr.current.x,_=Sr.current.y,E=200,A=320,H=180/8,X=(M,N,G,ae)=>{const Q=M*Math.PI/180,ue=N*Math.PI/180,ve=Math.cos(Q)*ae,We=-Math.sin(Q)*ae,xe=Math.cos(ue)*ae,ze=-Math.sin(ue)*ae,Ke=Math.cos(ue)*G,Be=-Math.sin(ue)*G,Ue=Math.cos(Q)*G,de=-Math.sin(Q)*G;return`M ${ve} ${We} A ${ae} ${ae} 0 0 0 ${xe} ${ze} L ${Ke} ${Be} A ${G} ${G} 0 0 1 ${Ue} ${de} Z`};return l.jsxs("div",{style:{position:"fixed",left:g,top:_,zIndex:2e3,pointerEvents:"none",animation:"stampUIFadeIn 0.15s ease-out"},children:[l.jsx("svg",{width:A*2+20,height:A+20,style:{position:"absolute",left:-330,top:-330,overflow:"visible"},children:l.jsx("g",{transform:`translate(${A+10}, ${A+10})`,children:i0.map((M,N)=>{const G=180-N*H,ae=G-H,Q=ju===M.id,ve=(G+ae)/2*Math.PI/180,We=(E+A)/2,xe=Math.cos(ve)*We,ze=-Math.sin(ve)*We,Ke=85;return l.jsxs("g",{children:[l.jsx("path",{d:X(G,ae,E,A),fill:Q?"rgba(255, 215, 0, 0.4)":"rgba(0, 0, 0, 0.7)",stroke:Q?"#ffd700":"rgba(255, 255, 255, 0.3)",strokeWidth:Q?3:1,style:{transition:"all 0.1s ease-out"}}),l.jsx("defs",{children:l.jsx("clipPath",{id:`stampClip-${M.id}`,children:l.jsx("circle",{cx:xe,cy:ze,r:Ke/2})})}),l.jsx("image",{href:Je(fy(M.id,As)),x:xe-Ke/2,y:ze-Ke/2,width:Ke,height:Ke,clipPath:`url(#stampClip-${M.id})`,style:{transform:Q?"scale(1.15)":"scale(1)",transformOrigin:`${xe}px ${ze}px`,transition:"transform 0.1s ease-out"}}),l.jsx("circle",{cx:xe,cy:ze,r:Ke/2,fill:"none",stroke:Q?"#ffd700":"rgba(255, 255, 255, 0.5)",strokeWidth:Q?2:1})]},M.id)})})}),l.jsx("style",{children:`
                                @keyframes stampUIFadeIn {
                                    from { opacity: 0; transform: scale(0.8); }
                                    to { opacity: 1; transform: scale(1); }
                                }
                            `})]})})(),po&&l.jsxs("div",{style:{position:"fixed",left:"50%",top:"40%",transform:"translate(-50%, -50%)",zIndex:2500,pointerEvents:"none",animation:"stampDisplay 3s ease-out forwards"},children:[l.jsx("div",{style:{width:250,height:250,borderRadius:20,overflow:"hidden",boxShadow:"0 0 40px rgba(0,0,0,0.5), 0 0 60px rgba(255,255,255,0.2)",border:"4px solid rgba(255,255,255,0.3)"},children:l.jsx("img",{src:Je(fy(po.stampId,po.playerClass)),alt:"",style:{width:"100%",height:"100%",objectFit:"cover"}})}),po.playerId!==L&&l.jsx("div",{style:{position:"absolute",bottom:-30,left:"50%",transform:"translateX(-50%)",background:"rgba(0,0,0,0.7)",padding:"5px 15px",borderRadius:15,color:"#fff",fontSize:"0.9rem",whiteSpace:"nowrap"},children:""}),l.jsx("style",{children:`
                            @keyframes stampDisplay {
                                0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
                                10% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
                                20% { transform: translate(-50%, -50%) scale(1); }
                                80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                                100% { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
                            }
                        `})]},po.timestamp),l.jsx("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:1e3},children:K&&(K.sourceType==="BOARD"||K.sourceType==="EVOLVE")&&l.jsxs(l.Fragment,{children:[l.jsxs("defs",{children:[l.jsxs("filter",{id:"cyanGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[l.jsx("feGaussianBlur",{stdDeviation:"10",result:"blur1"}),l.jsx("feFlood",{floodColor:"rgba(100, 200, 255, 0.7)",result:"color1"}),l.jsx("feComposite",{in:"color1",in2:"blur1",operator:"in",result:"glow1"}),l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"5",result:"blur2"}),l.jsx("feFlood",{floodColor:"rgba(150, 220, 255, 0.5)",result:"color2"}),l.jsx("feComposite",{in:"color2",in2:"blur2",operator:"in",result:"glow2"}),l.jsxs("feMerge",{children:[l.jsx("feMergeNode",{in:"glow1"}),l.jsx("feMergeNode",{in:"glow2"})]})]}),l.jsxs("filter",{id:"yellowGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[l.jsx("feGaussianBlur",{stdDeviation:"10",result:"blur1"}),l.jsx("feFlood",{floodColor:"rgba(255, 255, 50, 0.7)",result:"color1"}),l.jsx("feComposite",{in:"color1",in2:"blur1",operator:"in",result:"glow1"}),l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"5",result:"blur2"}),l.jsx("feFlood",{floodColor:"rgba(255, 240, 100, 0.5)",result:"color2"}),l.jsx("feComposite",{in:"color2",in2:"blur2",operator:"in",result:"glow2"}),l.jsxs("feMerge",{children:[l.jsx("feMergeNode",{in:"glow1"}),l.jsx("feMergeNode",{in:"glow2"})]})]}),l.jsxs("filter",{id:"softWhiteGlow",x:"-300%",y:"-300%",width:"700%",height:"700%",children:[l.jsx("feGaussianBlur",{stdDeviation:"20",result:"blur"}),l.jsx("feFlood",{floodColor:"rgba(255, 255, 255, 0.9)",result:"color"}),l.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),l.jsxs("feMerge",{children:[l.jsx("feMergeNode",{in:"glow"}),l.jsx("feMergeNode",{in:"glow"}),l.jsx("feMergeNode",{in:"glow"})]})]}),l.jsxs("filter",{id:"innerCoreGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[l.jsx("feGaussianBlur",{stdDeviation:"4",result:"blur"}),l.jsx("feFlood",{floodColor:"rgba(255, 255, 255, 0.8)",result:"color"}),l.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),l.jsx("feMerge",{children:l.jsx("feMergeNode",{in:"glow"})})]}),l.jsxs("filter",{id:"coloredBallGlow",x:"-150%",y:"-150%",width:"400%",height:"400%",children:[l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"6",result:"blur"}),l.jsxs("feMerge",{children:[l.jsx("feMergeNode",{in:"blur"}),l.jsx("feMergeNode",{in:"blur"})]})]}),l.jsxs("filter",{id:"particleGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"2",result:"blur"}),l.jsxs("feMerge",{children:[l.jsx("feMergeNode",{in:"blur"}),l.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),l.jsxs("filter",{id:"purpleGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[l.jsx("feGaussianBlur",{stdDeviation:"10",result:"blur1"}),l.jsx("feFlood",{floodColor:"rgba(183, 148, 244, 0.7)",result:"color1"}),l.jsx("feComposite",{in:"color1",in2:"blur1",operator:"in",result:"glow1"}),l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"5",result:"blur2"}),l.jsx("feFlood",{floodColor:"rgba(200, 170, 255, 0.5)",result:"color2"}),l.jsx("feComposite",{in:"color2",in2:"blur2",operator:"in",result:"glow2"}),l.jsxs("feMerge",{children:[l.jsx("feMergeNode",{in:"glow1"}),l.jsx("feMergeNode",{in:"glow2"})]})]})]}),K.sourceType==="BOARD"&&l.jsxs(l.Fragment,{children:[l.jsx("path",{d:Kr(),fill:"none",stroke:"rgba(100, 200, 255, 0.3)",strokeWidth:"20",strokeLinecap:"butt",filter:"url(#cyanGlow)"}),l.jsx("path",{d:Kr(),fill:"none",stroke:"rgba(150, 220, 255, 0.5)",strokeWidth:"10",strokeLinecap:"butt"}),l.jsx("path",{d:Kr(),fill:"none",stroke:"rgba(200, 240, 255, 0.9)",strokeWidth:"4",strokeLinecap:"butt"}),l.jsx("path",{d:Kr(),fill:"none",stroke:"rgba(255, 255, 255, 1)",strokeWidth:"2",strokeLinecap:"butt"})]}),K.sourceType==="EVOLVE"&&l.jsxs(l.Fragment,{children:[l.jsx("path",{d:Kr(),fill:"none",stroke:K.useSep?"rgba(159, 122, 234, 0.3)":"rgba(236, 201, 75, 0.3)",strokeWidth:"20",strokeLinecap:"butt",filter:K.useSep?"url(#purpleGlow)":"url(#yellowGlow)"}),l.jsx("path",{d:Kr(),fill:"none",stroke:K.useSep?"rgba(183, 148, 244, 0.5)":"rgba(246, 224, 94, 0.5)",strokeWidth:"10",strokeLinecap:"butt"}),l.jsx("path",{d:Kr(),fill:"none",stroke:K.useSep?"rgba(214, 188, 250, 0.9)":"rgba(250, 240, 137, 0.9)",strokeWidth:"4",strokeLinecap:"butt"}),l.jsx("path",{d:Kr(),fill:"none",stroke:"rgba(255, 255, 255, 1)",strokeWidth:"2",strokeLinecap:"butt"})]}),(K.sourceType==="BOARD"||K.sourceType==="EVOLVE")&&l.jsxs(l.Fragment,{children:[l.jsx("circle",{cx:K.startX,cy:K.startY,r:"15",fill:"rgba(255, 255, 255, 0.3)",filter:"url(#softWhiteGlow)"}),l.jsx("circle",{cx:K.startX,cy:K.startY,r:"8",fill:"rgba(255, 255, 255, 0.4)",filter:"url(#softWhiteGlow)"})]}),(K.sourceType==="BOARD"||K.sourceType==="EVOLVE")&&l.jsxs(l.Fragment,{children:[l.jsx("circle",{cx:K.currentX,cy:K.currentY,r:"18",fill:"rgba(255, 255, 255, 0.25)",filter:"url(#softWhiteGlow)"}),l.jsx("circle",{cx:K.currentX,cy:K.currentY,r:"8",fill:"rgba(255, 255, 255, 0.35)",filter:"url(#softWhiteGlow)"}),l.jsx("circle",{cx:K.currentX,cy:K.currentY,r:"3",fill:"rgba(255, 255, 255, 0.7)",filter:"url(#innerCoreGlow)"})]}),aE.map(g=>{const _=K.sourceType==="EVOLVE"?K.useSep?`rgba(230, 220, 255, ${g.opacity})`:`rgba(255, 255, 230, ${g.opacity})`:`rgba(220, 245, 255, ${g.opacity})`;return l.jsx("circle",{cx:g.x,cy:g.y,r:g.radius,fill:_,filter:"url(#particleGlow)"},g.id)})]})}),Wt&&l.jsxs("svg",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100dvh",pointerEvents:"none",zIndex:99999},children:[l.jsx("defs",{children:l.jsxs("filter",{id:"endTurnGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[l.jsx("feGaussianBlur",{stdDeviation:"6",result:"blur"}),l.jsx("feFlood",{floodColor:"rgba(100, 200, 255, 0.8)",result:"color"}),l.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),l.jsxs("feMerge",{children:[l.jsx("feMergeNode",{in:"glow"}),l.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),l.jsx("circle",{cx:Wt.x,cy:Wt.y,r:Wt.ringRadius,fill:"none",stroke:`rgba(100, 200, 255, ${Math.max(0,1-Wt.ringRadius/120)*.8})`,strokeWidth:"4",filter:"url(#endTurnGlow)"}),l.jsx("circle",{cx:Wt.x,cy:Wt.y,r:Wt.ringRadius*.8,fill:"none",stroke:`rgba(255, 255, 255, ${Math.max(0,1-Wt.ringRadius/120)*.6})`,strokeWidth:"2"}),l.jsx("circle",{cx:Wt.x,cy:Wt.y,r:20,fill:`rgba(255, 255, 255, ${Math.max(0,1-Wt.ringRadius/120)*.9})`}),Wt.particles.map(g=>l.jsx("circle",{cx:g.x,cy:g.y,r:4,fill:`rgba(255, 255, 255, ${g.opacity*.8})`},g.id))]}),He&&l.jsxs("div",{style:{position:"absolute",inset:0,zIndex:9999,pointerEvents:"auto",background:"rgba(0,0,0,0.5)",perspective:"1200px"},children:[l.jsx("style",{children:`
                                @keyframes playCardSequence {
                                    ${He.finalX!==void 0?`
                                    /* Phase 1: Start at hand position (0%) */
                                    0% {
                                        transform: translate(${He.startX-He.targetX}px, ${He.startY-He.targetY}px) translate(-50%, -50%) scale(1.0) rotateY(0deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Phase 1b: Mid-rotation during move (12.5%) - CRITICAL: explicit 180deg to force rotation direction */
                                    12.5% {
                                        transform: translate(${(He.startX-He.targetX)*.5}px, ${(He.startY-He.targetY)*.5}px) translate(-50%, -50%) scale(1.5) rotateY(180deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Phase 2: Arrive at center with rotation complete (25%) */
                                    25% {
                                        transform: translate(-50%, -50%) scale(1.8) rotateY(360deg);
                                        opacity: 1;
                                        animation-timing-function: ease-out;
                                    }
                                    /* Phase 3: Hold at center (25%-80%) */
                                    80% {
                                        transform: translate(-50%, -50%) scale(2.4) rotateY(360deg);
                                        opacity: 1;
                                    }
                                    /* Phase 4: Move to board position (80%-100%) */
                                    100% {
                                        transform: translate(calc(-50% + ${He.finalX-He.targetX}px), calc(-50% + ${He.finalY-He.targetY}px)) scale(1.0) rotateY(360deg);
                                        opacity: 1;
                                    }
                                    `:`
                                    /* Spell: Move to center while rotating, then fade */
                                    0% {
                                        transform: translate(${He.startX-He.targetX}px, ${He.startY-He.targetY}px) translate(-50%, -50%) scale(1.0) rotateY(0deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Mid-rotation during move (15%) - CRITICAL: explicit 180deg */
                                    15% {
                                        transform: translate(${(He.startX-He.targetX)*.5}px, ${(He.startY-He.targetY)*.5}px) translate(-50%, -50%) scale(1.7) rotateY(180deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    30% {
                                        transform: translate(-50%, -50%) scale(2.2) rotateY(360deg);
                                        opacity: 1;
                                        animation-timing-function: ease-out;
                                    }
                                    80% {
                                        transform: translate(-50%, -50%) scale(2.4) rotateY(360deg);
                                        opacity: 1;
                                    }
                                    100% {
                                        transform: translate(-50%, -50%) scale(3.0) rotateY(360deg);
                                        opacity: 0;
                                    }
                                    `}
                                }
                                @keyframes playSpellSequence {
                                    /* Move from hand to center while rotating (0-30%) */
                                    0% {
                                        transform: translate(${He.startX-He.targetX}px, ${He.startY-He.targetY}px) translate(-50%, -50%) scale(1.0) rotateY(0deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Mid-rotation during move (15%) - CRITICAL: explicit 180deg to force rotation direction */
                                    15% {
                                        transform: translate(${(He.startX-He.targetX)*.5}px, ${(He.startY-He.targetY)*.5}px) translate(-50%, -50%) scale(1.7) rotateY(180deg);
                                        opacity: 1;
                                        filter: brightness(1);
                                        animation-timing-function: linear;
                                    }
                                    /* Arrive at center with rotation complete (30%) */
                                    30% {
                                        transform: translate(-50%, -50%) scale(2.2) rotateY(360deg);
                                        opacity: 1;
                                        filter: brightness(1);
                                        animation-timing-function: ease-out;
                                    }
                                    /* Hold at center (30%-75%) */
                                    75% {
                                        transform: translate(-50%, -50%) scale(2.4) rotateY(360deg);
                                        opacity: 1;
                                        filter: brightness(1.2);
                                    }
                                    /* Fade out (75%-100%) */
                                    100% {
                                        transform: translate(-50%, -50%) scale(3.0) rotateY(360deg);
                                        opacity: 0;
                                        filter: brightness(3);
                                    }
                                }
                                .play-card-flipper {
                                    transform-style: preserve-3d !important;
                                }
                                .play-card-front, .play-card-back {
                                    backface-visibility: hidden !important;
                                    -webkit-backface-visibility: hidden !important;
                                    position: absolute;
                                    width: 100%;
                                    height: 100%;
                                }
                                .play-card-back {
                                    transform: rotateY(180deg) translateZ(1px);
                                }
                            `}),l.jsxs("div",{className:"play-card-flipper",onAnimationEnd:He.onComplete,style:{position:"absolute",left:He.targetX,top:He.targetY,width:en*d,height:yn*d,transformStyle:"preserve-3d",animation:He.card.type==="SPELL"?"playSpellSequence 1s forwards":"playCardSequence 0.8s forwards"},children:[l.jsx("div",{className:"play-card-front",children:l.jsx(xi,{card:He.card,isOnBoard:!0,suppressPassives:!0,scale:d,style:{width:en*d,height:yn*d,boxShadow:"0 0 50px rgba(255,215,0,0.8)"}})}),l.jsx("div",{className:"play-card-back",style:{borderRadius:12,boxShadow:"0 0 50px rgba(255,215,0,0.8)",overflow:"hidden"},children:l.jsx("img",{src:Ls(He.playerClass),alt:"Card Sleeve",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:12},onError:g=>{const _=g.target;_.style.display="none",_.parentElement&&(_.parentElement.style.background="linear-gradient(135deg, #1e3a5f 0%, #0d1b2a 50%, #1e3a5f 100%)")}})}),He.card.type==="SPELL"&&l.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none"},children:l.jsx(Rw,{x:0,y:0})})]})]}),ui.length>0&&ui.map((g,_)=>l.jsx("div",{style:{position:"absolute",left:g.status==="FLY"&&g.targetX!==void 0?g.targetX:window.innerWidth/2+g.xOffset,top:g.status==="FLY"&&g.targetY!==void 0?g.targetY:window.innerHeight/2,transform:g.status==="APPEAR"?"translate(-50%, -50%) scale(1.2)":"translate(-50%, -50%) scale(0.2)",zIndex:7e3+_,pointerEvents:"none",transition:g.status==="FLY"?"all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)":"none",opacity:g.status==="FLY"?.3:1,animation:g.status==="APPEAR"?"cardAppear 0.8s ease-out":void 0},children:l.jsx(xi,{card:g.card,scale:d,style:{width:en*d,height:yn*d}})},_)),l.jsx("style",{children:`
                    @keyframes cardAppear {
                        0% { transform: translate(-50%, -50%) scale(0) rotate(-10deg); opacity: 0; }
                        50% { transform: translate(-50%, -50%) scale(1.3) rotate(5deg); opacity: 1; }
                        100% { transform: translate(-50%, -50%) scale(1.2) rotate(0deg); opacity: 1; }
                    }
                `}),ol.map(g=>g.type==="BUFF"?l.jsx(Iw,{x:g.x,y:g.y,atkBuff:g.atkBuff??0,hpBuff:g.hpBuff??0,onComplete:()=>di(_=>_.filter(E=>E.key!==g.key))},g.key):l.jsx(ww,{type:g.type,x:g.x,y:g.y,onComplete:()=>di(_=>_.filter(E=>E.key!==g.key)),audioSettings:bt,scale:d},g.key)),At&&l.jsx(Lw,{card:At.card,evolvedImageUrl:At.evolvedImageUrl,startX:At.startX,startY:At.startY,phase:At.phase,onPhaseChange:vE,onShake:Dn,useSep:At.useSep,playSE:ht,scale:d,isLightMode:k}),Rs&&l.jsxs("div",{style:{position:"fixed",top:"45%",left:`${340*d}px`,width:`calc(100% - ${340*d}px)`,display:"flex",justifyContent:"center",alignItems:"center",transform:"translateY(-50%)",zIndex:9e3,pointerEvents:"none",animation:"notificationFade 2.5s forwards"},children:[l.jsx("div",{style:{padding:`${20*d}px ${90*d}px`,background:"rgba(0, 0, 0, 0.75)",backdropFilter:"blur(16px)",borderTop:`${3*d}px solid ${Rs==="EVOLVE_READY"?"rgba(255, 215, 0, 0.7)":"rgba(180, 0, 255, 0.7)"}`,borderBottom:`${3*d}px solid ${Rs==="EVOLVE_READY"?"rgba(255, 215, 0, 0.7)":"rgba(180, 0, 255, 0.7)"}`,boxShadow:Rs==="EVOLVE_READY"?`0 0 ${50*d}px rgba(255, 180, 0, 0.5), inset 0 0 ${30*d}px rgba(255, 215, 0, 0.2)`:`0 0 ${50*d}px rgba(180, 0, 255, 0.5), inset 0 0 ${30*d}px rgba(180, 0, 255, 0.2)`,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",borderRadius:`${4*d}px`},children:l.jsx("span",{style:{fontSize:`${5*d}rem`,fontWeight:"900",fontFamily:'"YuMincho", "Hiragino Mincho ProN", "MS Mincho", serif',color:"#fff",letterSpacing:`${.8*d}rem`,whiteSpace:"nowrap",textShadow:Rs==="EVOLVE_READY"?`0 0 ${15*d}px rgba(255, 215, 0, 1), 0 0 ${30*d}px rgba(255, 180, 0, 0.8), ${2*d}px ${2*d}px ${4*d}px rgba(0,0,0,0.9)`:`0 0 ${15*d}px rgba(180, 0, 255, 1), 0 0 ${30*d}px rgba(140, 0, 255, 0.8), ${2*d}px ${2*d}px ${4*d}px rgba(0,0,0,0.9)`,WebkitTextStroke:Rs==="EVOLVE_READY"?`${1.5*d}px #ffd700`:`${1.5*d}px #b400ff`},children:Rs==="EVOLVE_READY"?"":""})}),l.jsx("style",{children:`
                            @keyframes notificationFade {
                                0% { opacity: 0; transform: translateY(-40%) scale(0.8); filter: blur(15px); }
                                10% { opacity: 1; transform: translateY(-50%) scale(1); filter: blur(0px); }
                                90% { opacity: 1; transform: translateY(-50%) scale(1); filter: blur(0px); }
                                100% { opacity: 0; transform: translateY(-60%) scale(1.15); filter: blur(20px); }
                            }
                        `})]}),we&&y.winnerId&&l.jsx(hw,{isVictory:y.winnerId===L,loserLeaderRef:y.winnerId===L?pi:Ps,onComplete:()=>{Z(!1),vt(!0),pt(null),ot(0),(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&b&&(console.log("[GameScreen] Disconnecting after game over (casual match)"),b.disconnect())},onPhaseChange:pt,onShakeIntensityChange:ot,scale:d}),y.winnerId&&De&&l.jsx(Fw,{winnerId:y.winnerId,playerId:L,playerClass:(se==null?void 0:se.class)||"SENKA",isOnline:e==="ONLINE",isRoomMatch:n==="HOST"||n==="JOIN",myRematchRequested:Lu,opponentRematchRequested:a0,battleStats:{turnCount:y.turnCount,damageDealtToOpponent:Ja.damageDealtToOpponent,damageReceivedFromOpponent:Ja.damageReceivedFromOpponent,followersDestroyed:Ja.followersDestroyed,myFollowersDestroyed:Ja.myFollowersDestroyed},selectedCardInfo:iE,onCardInfoClick:Du,victoryReason:sE,onRematching:i,onRematch:g=>{e==="ONLINE"?(Qa(!0),a0?(b==null||b.send({type:"REMATCH_ACCEPT"}),Qu(g)):(b==null||b.send({type:"REMATCH_REQUEST"}),u0(g))):Qu(g)},onLeave:s})]})]})},Bw=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},Uw=Bw("/bgm/tenfubu.mp3"),Wl={bgm:.3,se:.5,voice:.5,bgmEnabled:!0,seEnabled:!0},zw=()=>{try{const t=localStorage.getItem("audioSettings");if(t){const e=JSON.parse(t);if(e.enabled!==void 0){const{enabled:n,...r}=e;return{...Wl,...r,bgmEnabled:n,seEnabled:n}}return{...Wl,...e}}return Wl}catch{return Wl}},Hw=()=>{const[t,e]=U.useState(!1);return U.useEffect(()=>{const n=()=>{const r="ontouchstart"in window||navigator.maxTouchPoints>0,s=window.innerHeight>window.innerWidth;e(r&&s)};return n(),window.addEventListener("resize",n),window.addEventListener("orientationchange",n),()=>{window.removeEventListener("resize",n),window.removeEventListener("orientationchange",n)}},[]),t};function Ww(){const[t,e]=U.useState("TITLE"),[n,r]=U.useState("SENKA"),[s,i]=U.useState("CPU"),[o,a]=U.useState(""),[c,u]=U.useState(void 0),[p,h]=U.useState("NORMAL"),[f,m]=U.useState(()=>{const ie=localStorage.getItem("timerEnabled");return ie!==null?JSON.parse(ie):!0}),[b,R]=U.useState(()=>localStorage.getItem("playerName")||""),W=Hw(),d=U.useRef(null),[I,S]=U.useState(!1),[k,$]=U.useState(zw);U.useEffect(()=>{localStorage.setItem("audioSettings",JSON.stringify(k))},[k]);const B=U.useCallback(ie=>{$(y=>({...y,...ie}))},[]),te=U.useRef(null),J=U.useRef(!1);U.useEffect(()=>{const ie=new Audio(Uw);return ie.loop=!0,ie.volume=k.bgmEnabled?k.bgm:0,te.current=ie,J.current=!0,()=>{ie.pause(),ie.src=""}},[]),U.useEffect(()=>{const ie=te.current;!ie||!J.current||(ie.volume=k.bgmEnabled?k.bgm:0,k.bgmEnabled?ie.paused&&(t==="TITLE"||t==="CLASS_SELECT")&&ie.play().catch(()=>{}):ie.pause())},[k.bgm,k.bgmEnabled,t]),U.useEffect(()=>{const ie=te.current;ie&&(t==="TITLE"||t==="CLASS_SELECT"||t==="LOBBY"?ie.paused&&k.bgmEnabled&&ie.play().catch(()=>{}):(ie.pause(),ie.currentTime=0))},[t,k.bgmEnabled]),U.useEffect(()=>{const ie=()=>{const y=te.current;y&&y.paused&&k.bgmEnabled&&(t==="TITLE"||t==="CLASS_SELECT"||t==="LOBBY")&&y.play().catch(()=>{})};return document.addEventListener("click",ie),()=>document.removeEventListener("click",ie)},[t,k.bgmEnabled]);const me=(ie,y)=>{i(ie),y&&a(y),e("CLASS_SELECT")},he=ie=>{r(ie),e(s==="CPU"?"GAME":s==="CASUAL_MATCH"||s==="RANKED_MATCH"?"MATCHMAKING":"LOBBY")},ke=(ie,y)=>{d.current=ie,S(!0),y&&u(y),e("GAME")},L=(ie,y,C)=>{d.current=ie,S(!0),u(y),e("GAME")},F=()=>{d.current&&(d.current.disconnect(),d.current=null),S(!1),e("TITLE"),a(""),i("CPU"),u(void 0)},fe=ie=>{d.current&&(d.current.disconnect(),d.current=null),S(!1),u(void 0),r(ie),e("MATCHMAKING")};return l.jsxs("div",{className:"app-container",children:[W&&l.jsxs("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100dvh",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:99999,color:"white",textAlign:"center",padding:20},children:[l.jsx("div",{style:{fontSize:"4rem",marginBottom:20,animation:"rotatePhone 2s ease-in-out infinite"},children:""}),l.jsx("h2",{style:{fontSize:"1.5rem",fontWeight:"bold",marginBottom:10,textShadow:"0 2px 4px rgba(0,0,0,0.5)"},children:""}),l.jsx("p",{style:{fontSize:"1rem",opacity:.8,maxWidth:280},children:""}),l.jsx("style",{children:`
                        @keyframes rotatePhone {
                            0%, 100% { transform: rotate(0deg); }
                            25% { transform: rotate(-30deg); }
                            75% { transform: rotate(30deg); }
                        }
                    `})]}),t==="TITLE"&&l.jsx(c2,{onStartConfig:me,audioSettings:k,onAudioSettingsChange:B}),t==="CLASS_SELECT"&&l.jsx(g2,{onSelectClass:he,onBack:F,gameMode:s,aiDifficulty:p,onDifficultyChange:h,playerName:b,onPlayerNameChange:ie=>{R(ie),localStorage.setItem("playerName",ie)},timerEnabled:f,onTimerEnabledChange:ie=>{m(ie),localStorage.setItem("timerEnabled",JSON.stringify(ie))}}),t==="LOBBY"&&l.jsx($2,{gameMode:s,targetRoomId:o,playerClass:n,onGameStart:ke,onBack:F}),t==="MATCHMAKING"&&l.jsx(qk,{matchType:s==="CASUAL_MATCH"?"casual":"ranked",playerClass:n,playerName:b||"",onGameStart:L,onCancel:F}),t==="GAME"&&l.jsx($w,{playerClass:n,opponentType:s==="CPU"?"CPU":"ONLINE",gameMode:s,targetRoomId:o,onLeave:F,onRematching:fe,networkAdapter:d.current,networkConnected:I,opponentClass:c,aiDifficulty:p,playerName:b||"",timerEnabled:s==="CASUAL_MATCH"||s==="RANKED_MATCH"?!0:f})]})}ef.createRoot(document.getElementById("root")).render(l.jsx(Ww,{}));
