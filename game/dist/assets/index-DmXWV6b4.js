var N2=Object.defineProperty;var j2=t=>{throw TypeError(t)};var $2=(t,e,n)=>e in t?N2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var un=(t,e,n)=>$2(t,typeof e!="symbol"?e+"":e,n);var Ta=(t,e,n)=>e.has(t)?j2("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n);function F2(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in t)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function Jx(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Qx={exports:{}},Au={},qx={exports:{}},pt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Gl=Symbol.for("react.element"),U2=Symbol.for("react.portal"),B2=Symbol.for("react.fragment"),z2=Symbol.for("react.strict_mode"),H2=Symbol.for("react.profiler"),W2=Symbol.for("react.provider"),G2=Symbol.for("react.context"),V2=Symbol.for("react.forward_ref"),Y2=Symbol.for("react.suspense"),K2=Symbol.for("react.memo"),X2=Symbol.for("react.lazy"),Qm=Symbol.iterator;function J2(t){return t===null||typeof t!="object"?null:(t=Qm&&t[Qm]||t["@@iterator"],typeof t=="function"?t:null)}var Zx={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},e_=Object.assign,t_={};function na(t,e,n){this.props=t,this.context=e,this.refs=t_,this.updater=n||Zx}na.prototype.isReactComponent={};na.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};na.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function n_(){}n_.prototype=na.prototype;function ug(t,e,n){this.props=t,this.context=e,this.refs=t_,this.updater=n||Zx}var fg=ug.prototype=new n_;fg.constructor=ug;e_(fg,na.prototype);fg.isPureReactComponent=!0;var qm=Array.isArray,r_=Object.prototype.hasOwnProperty,hg={current:null},s_={key:!0,ref:!0,__self:!0,__source:!0};function i_(t,e,n){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)r_.call(e,r)&&!s_.hasOwnProperty(r)&&(s[r]=e[r]);var l=arguments.length-2;if(l===1)s.children=n;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];s.children=c}if(t&&t.defaultProps)for(r in l=t.defaultProps,l)s[r]===void 0&&(s[r]=l[r]);return{$$typeof:Gl,type:t,key:i,ref:o,props:s,_owner:hg.current}}function Q2(t,e){return{$$typeof:Gl,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function pg(t){return typeof t=="object"&&t!==null&&t.$$typeof===Gl}function q2(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Zm=/\/+/g;function Xf(t,e){return typeof t=="object"&&t!==null&&t.key!=null?q2(""+t.key):e.toString(36)}function cd(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Gl:case U2:o=!0}}if(o)return o=t,s=s(o),t=r===""?"."+Xf(o,0):r,qm(s)?(n="",t!=null&&(n=t.replace(Zm,"$&/")+"/"),cd(s,e,n,"",function(d){return d})):s!=null&&(pg(s)&&(s=Q2(s,n+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(Zm,"$&/")+"/")+t)),e.push(s)),1;if(o=0,r=r===""?".":r+":",qm(t))for(var l=0;l<t.length;l++){i=t[l];var c=r+Xf(i,l);o+=cd(i,e,n,c,s)}else if(c=J2(t),typeof c=="function")for(t=c.call(t),l=0;!(i=t.next()).done;)i=i.value,c=r+Xf(i,l++),o+=cd(i,e,n,c,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Nc(t,e,n){if(t==null)return t;var r=[],s=0;return cd(t,r,"","",function(i){return e.call(n,i,s++)}),r}function Z2(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Ln={current:null},dd={transition:null},ew={ReactCurrentDispatcher:Ln,ReactCurrentBatchConfig:dd,ReactCurrentOwner:hg};function o_(){throw Error("act(...) is not supported in production builds of React.")}pt.Children={map:Nc,forEach:function(t,e,n){Nc(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Nc(t,function(){e++}),e},toArray:function(t){return Nc(t,function(e){return e})||[]},only:function(t){if(!pg(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};pt.Component=na;pt.Fragment=B2;pt.Profiler=H2;pt.PureComponent=ug;pt.StrictMode=z2;pt.Suspense=Y2;pt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ew;pt.act=o_;pt.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=e_({},t.props),s=t.key,i=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=hg.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(c in e)r_.call(e,c)&&!s_.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&l!==void 0?l[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];r.children=l}return{$$typeof:Gl,type:t.type,key:s,ref:i,props:r,_owner:o}};pt.createContext=function(t){return t={$$typeof:G2,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:W2,_context:t},t.Consumer=t};pt.createElement=i_;pt.createFactory=function(t){var e=i_.bind(null,t);return e.type=t,e};pt.createRef=function(){return{current:null}};pt.forwardRef=function(t){return{$$typeof:V2,render:t}};pt.isValidElement=pg;pt.lazy=function(t){return{$$typeof:X2,_payload:{_status:-1,_result:t},_init:Z2}};pt.memo=function(t,e){return{$$typeof:K2,type:t,compare:e===void 0?null:e}};pt.startTransition=function(t){var e=dd.transition;dd.transition={};try{t()}finally{dd.transition=e}};pt.unstable_act=o_;pt.useCallback=function(t,e){return Ln.current.useCallback(t,e)};pt.useContext=function(t){return Ln.current.useContext(t)};pt.useDebugValue=function(){};pt.useDeferredValue=function(t){return Ln.current.useDeferredValue(t)};pt.useEffect=function(t,e){return Ln.current.useEffect(t,e)};pt.useId=function(){return Ln.current.useId()};pt.useImperativeHandle=function(t,e,n){return Ln.current.useImperativeHandle(t,e,n)};pt.useInsertionEffect=function(t,e){return Ln.current.useInsertionEffect(t,e)};pt.useLayoutEffect=function(t,e){return Ln.current.useLayoutEffect(t,e)};pt.useMemo=function(t,e){return Ln.current.useMemo(t,e)};pt.useReducer=function(t,e,n){return Ln.current.useReducer(t,e,n)};pt.useRef=function(t){return Ln.current.useRef(t)};pt.useState=function(t){return Ln.current.useState(t)};pt.useSyncExternalStore=function(t,e,n){return Ln.current.useSyncExternalStore(t,e,n)};pt.useTransition=function(){return Ln.current.useTransition()};pt.version="18.3.1";qx.exports=pt;var A=qx.exports;const F=Jx(A);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tw=A,nw=Symbol.for("react.element"),rw=Symbol.for("react.fragment"),sw=Object.prototype.hasOwnProperty,iw=tw.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ow={key:!0,ref:!0,__self:!0,__source:!0};function a_(t,e,n){var r,s={},i=null,o=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)sw.call(e,r)&&!ow.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:nw,type:t,key:i,ref:o,props:s,_owner:iw.current}}Au.Fragment=rw;Au.jsx=a_;Au.jsxs=a_;Qx.exports=Au;var a=Qx.exports,$h={},l_={exports:{}},qn={},c_={exports:{}},d_={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(y,g){var I=y.length;y.push(g);e:for(;0<I;){var P=I-1>>>1,N=y[P];if(0<s(N,g))y[P]=g,y[I]=N,I=P;else break e}}function n(y){return y.length===0?null:y[0]}function r(y){if(y.length===0)return null;var g=y[0],I=y.pop();if(I!==g){y[0]=I;e:for(var P=0,N=y.length,J=N>>>1;P<J;){var U=2*(P+1)-1,ve=y[U],Re=U+1,Ie=y[Re];if(0>s(ve,I))Re<N&&0>s(Ie,ve)?(y[P]=Ie,y[Re]=I,P=Re):(y[P]=ve,y[U]=I,P=U);else if(Re<N&&0>s(Ie,I))y[P]=Ie,y[Re]=I,P=Re;else break e}}return g}function s(y,g){var I=y.sortIndex-g.sortIndex;return I!==0?I:y.id-g.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],d=[],u=1,p=null,f=3,S=!1,R=!1,C=!1,j=typeof setTimeout=="function"?setTimeout:null,_=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(y){for(var g=n(d);g!==null;){if(g.callback===null)r(d);else if(g.startTime<=y)r(d),g.sortIndex=g.expirationTime,e(c,g);else break;g=n(d)}}function h(y){if(C=!1,w(y),!R)if(n(c)!==null)R=!0,T(D);else{var g=n(d);g!==null&&k(h,g.startTime-y)}}function D(y,g){R=!1,C&&(C=!1,_(W),W=-1),S=!0;var I=f;try{for(w(g),p=n(c);p!==null&&(!(p.expirationTime>g)||y&&!xe());){var P=p.callback;if(typeof P=="function"){p.callback=null,f=p.priorityLevel;var N=P(p.expirationTime<=g);g=t.unstable_now(),typeof N=="function"?p.callback=N:p===n(c)&&r(c),w(g)}else r(c);p=n(c)}if(p!==null)var J=!0;else{var U=n(d);U!==null&&k(h,U.startTime-g),J=!1}return J}finally{p=null,f=I,S=!1}}var H=!1,re=null,W=-1,Z=5,he=-1;function xe(){return!(t.unstable_now()-he<Z)}function Ue(){if(re!==null){var y=t.unstable_now();he=y;var g=!0;try{g=re(!0,y)}finally{g?de():(H=!1,re=null)}}else H=!1}var de;if(typeof v=="function")de=function(){v(Ue)};else if(typeof MessageChannel<"u"){var ie=new MessageChannel,O=ie.port2;ie.port1.onmessage=Ue,de=function(){O.postMessage(null)}}else de=function(){j(Ue,0)};function T(y){re=y,H||(H=!0,de())}function k(y,g){W=j(function(){y(t.unstable_now())},g)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(y){y.callback=null},t.unstable_continueExecution=function(){R||S||(R=!0,T(D))},t.unstable_forceFrameRate=function(y){0>y||125<y?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Z=0<y?Math.floor(1e3/y):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(y){switch(f){case 1:case 2:case 3:var g=3;break;default:g=f}var I=f;f=g;try{return y()}finally{f=I}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(y,g){switch(y){case 1:case 2:case 3:case 4:case 5:break;default:y=3}var I=f;f=y;try{return g()}finally{f=I}},t.unstable_scheduleCallback=function(y,g,I){var P=t.unstable_now();switch(typeof I=="object"&&I!==null?(I=I.delay,I=typeof I=="number"&&0<I?P+I:P):I=P,y){case 1:var N=-1;break;case 2:N=250;break;case 5:N=1073741823;break;case 4:N=1e4;break;default:N=5e3}return N=I+N,y={id:u++,callback:g,priorityLevel:y,startTime:I,expirationTime:N,sortIndex:-1},I>P?(y.sortIndex=I,e(d,y),n(c)===null&&y===n(d)&&(C?(_(W),W=-1):C=!0,k(h,I-P))):(y.sortIndex=N,e(c,y),R||S||(R=!0,T(D))),y},t.unstable_shouldYield=xe,t.unstable_wrapCallback=function(y){var g=f;return function(){var I=f;f=g;try{return y.apply(this,arguments)}finally{f=I}}}})(d_);c_.exports=d_;var aw=c_.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lw=A,Jn=aw;function fe(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var u_=new Set,pl={};function Wi(t,e){Bo(t,e),Bo(t+"Capture",e)}function Bo(t,e){for(pl[t]=e,t=0;t<e.length;t++)u_.add(e[t])}var cs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Fh=Object.prototype.hasOwnProperty,cw=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,ey={},ty={};function dw(t){return Fh.call(ty,t)?!0:Fh.call(ey,t)?!1:cw.test(t)?ty[t]=!0:(ey[t]=!0,!1)}function uw(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function fw(t,e,n,r){if(e===null||typeof e>"u"||uw(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Dn(t,e,n,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var gn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){gn[t]=new Dn(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];gn[e]=new Dn(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){gn[t]=new Dn(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){gn[t]=new Dn(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){gn[t]=new Dn(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){gn[t]=new Dn(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){gn[t]=new Dn(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){gn[t]=new Dn(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){gn[t]=new Dn(t,5,!1,t.toLowerCase(),null,!1,!1)});var gg=/[\-:]([a-z])/g;function mg(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(gg,mg);gn[e]=new Dn(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(gg,mg);gn[e]=new Dn(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(gg,mg);gn[e]=new Dn(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){gn[t]=new Dn(t,1,!1,t.toLowerCase(),null,!1,!1)});gn.xlinkHref=new Dn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){gn[t]=new Dn(t,1,!1,t.toLowerCase(),null,!0,!0)});function yg(t,e,n,r){var s=gn.hasOwnProperty(e)?gn[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(fw(e,n,s,r)&&(n=null),r||s===null?dw(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var ms=lw.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,jc=Symbol.for("react.element"),go=Symbol.for("react.portal"),mo=Symbol.for("react.fragment"),vg=Symbol.for("react.strict_mode"),Uh=Symbol.for("react.profiler"),f_=Symbol.for("react.provider"),h_=Symbol.for("react.context"),xg=Symbol.for("react.forward_ref"),Bh=Symbol.for("react.suspense"),zh=Symbol.for("react.suspense_list"),_g=Symbol.for("react.memo"),ks=Symbol.for("react.lazy"),p_=Symbol.for("react.offscreen"),ny=Symbol.iterator;function Ca(t){return t===null||typeof t!="object"?null:(t=ny&&t[ny]||t["@@iterator"],typeof t=="function"?t:null)}var Gt=Object.assign,Jf;function Ba(t){if(Jf===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Jf=e&&e[1]||""}return`
`+Jf+t}var Qf=!1;function qf(t,e){if(!t||Qf)return"";Qf=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var r=d}Reflect.construct(t,[],e)}else{try{e.call()}catch(d){r=d}t.call(e.prototype)}else{try{throw Error()}catch(d){r=d}t()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var s=d.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,l=i.length-1;1<=o&&0<=l&&s[o]!==i[l];)l--;for(;1<=o&&0<=l;o--,l--)if(s[o]!==i[l]){if(o!==1||l!==1)do if(o--,l--,0>l||s[o]!==i[l]){var c=`
`+s[o].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=o&&0<=l);break}}}finally{Qf=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Ba(t):""}function hw(t){switch(t.tag){case 5:return Ba(t.type);case 16:return Ba("Lazy");case 13:return Ba("Suspense");case 19:return Ba("SuspenseList");case 0:case 2:case 15:return t=qf(t.type,!1),t;case 11:return t=qf(t.type.render,!1),t;case 1:return t=qf(t.type,!0),t;default:return""}}function Hh(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case mo:return"Fragment";case go:return"Portal";case Uh:return"Profiler";case vg:return"StrictMode";case Bh:return"Suspense";case zh:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case h_:return(t.displayName||"Context")+".Consumer";case f_:return(t._context.displayName||"Context")+".Provider";case xg:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case _g:return e=t.displayName||null,e!==null?e:Hh(t.type)||"Memo";case ks:e=t._payload,t=t._init;try{return Hh(t(e))}catch{}}return null}function pw(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Hh(e);case 8:return e===vg?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function ti(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function g_(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function gw(t){var e=g_(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function $c(t){t._valueTracker||(t._valueTracker=gw(t))}function m_(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=g_(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Dd(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Wh(t,e){var n=e.checked;return Gt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function ry(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=ti(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function y_(t,e){e=e.checked,e!=null&&yg(t,"checked",e,!1)}function Gh(t,e){y_(t,e);var n=ti(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Vh(t,e.type,n):e.hasOwnProperty("defaultValue")&&Vh(t,e.type,ti(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function sy(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Vh(t,e,n){(e!=="number"||Dd(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var za=Array.isArray;function Ro(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+ti(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function Yh(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(fe(91));return Gt({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function iy(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(fe(92));if(za(n)){if(1<n.length)throw Error(fe(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:ti(n)}}function v_(t,e){var n=ti(e.value),r=ti(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function oy(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function x_(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Kh(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?x_(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Fc,__=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Fc=Fc||document.createElement("div"),Fc.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Fc.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function gl(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Ka={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},mw=["Webkit","ms","Moz","O"];Object.keys(Ka).forEach(function(t){mw.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Ka[e]=Ka[t]})});function b_(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Ka.hasOwnProperty(t)&&Ka[t]?(""+e).trim():e+"px"}function E_(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=b_(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var yw=Gt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Xh(t,e){if(e){if(yw[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(fe(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(fe(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(fe(61))}if(e.style!=null&&typeof e.style!="object")throw Error(fe(62))}}function Jh(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Qh=null;function bg(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var qh=null,Ao=null,Po=null;function ay(t){if(t=Kl(t)){if(typeof qh!="function")throw Error(fe(280));var e=t.stateNode;e&&(e=Mu(e),qh(t.stateNode,t.type,e))}}function S_(t){Ao?Po?Po.push(t):Po=[t]:Ao=t}function w_(){if(Ao){var t=Ao,e=Po;if(Po=Ao=null,ay(t),e)for(t=0;t<e.length;t++)ay(e[t])}}function I_(t,e){return t(e)}function T_(){}var Zf=!1;function C_(t,e,n){if(Zf)return t(e,n);Zf=!0;try{return I_(t,e,n)}finally{Zf=!1,(Ao!==null||Po!==null)&&(T_(),w_())}}function ml(t,e){var n=t.stateNode;if(n===null)return null;var r=Mu(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(fe(231,e,typeof n));return n}var Zh=!1;if(cs)try{var ka={};Object.defineProperty(ka,"passive",{get:function(){Zh=!0}}),window.addEventListener("test",ka,ka),window.removeEventListener("test",ka,ka)}catch{Zh=!1}function vw(t,e,n,r,s,i,o,l,c){var d=Array.prototype.slice.call(arguments,3);try{e.apply(n,d)}catch(u){this.onError(u)}}var Xa=!1,Md=null,Nd=!1,ep=null,xw={onError:function(t){Xa=!0,Md=t}};function _w(t,e,n,r,s,i,o,l,c){Xa=!1,Md=null,vw.apply(xw,arguments)}function bw(t,e,n,r,s,i,o,l,c){if(_w.apply(this,arguments),Xa){if(Xa){var d=Md;Xa=!1,Md=null}else throw Error(fe(198));Nd||(Nd=!0,ep=d)}}function Gi(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function k_(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function ly(t){if(Gi(t)!==t)throw Error(fe(188))}function Ew(t){var e=t.alternate;if(!e){if(e=Gi(t),e===null)throw Error(fe(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return ly(s),t;if(i===r)return ly(s),e;i=i.sibling}throw Error(fe(188))}if(n.return!==r.return)n=s,r=i;else{for(var o=!1,l=s.child;l;){if(l===n){o=!0,n=s,r=i;break}if(l===r){o=!0,r=s,n=i;break}l=l.sibling}if(!o){for(l=i.child;l;){if(l===n){o=!0,n=i,r=s;break}if(l===r){o=!0,r=i,n=s;break}l=l.sibling}if(!o)throw Error(fe(189))}}if(n.alternate!==r)throw Error(fe(190))}if(n.tag!==3)throw Error(fe(188));return n.stateNode.current===n?t:e}function R_(t){return t=Ew(t),t!==null?A_(t):null}function A_(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=A_(t);if(e!==null)return e;t=t.sibling}return null}var P_=Jn.unstable_scheduleCallback,cy=Jn.unstable_cancelCallback,Sw=Jn.unstable_shouldYield,ww=Jn.unstable_requestPaint,Kt=Jn.unstable_now,Iw=Jn.unstable_getCurrentPriorityLevel,Eg=Jn.unstable_ImmediatePriority,O_=Jn.unstable_UserBlockingPriority,jd=Jn.unstable_NormalPriority,Tw=Jn.unstable_LowPriority,L_=Jn.unstable_IdlePriority,Pu=null,Br=null;function Cw(t){if(Br&&typeof Br.onCommitFiberRoot=="function")try{Br.onCommitFiberRoot(Pu,t,void 0,(t.current.flags&128)===128)}catch{}}var wr=Math.clz32?Math.clz32:Aw,kw=Math.log,Rw=Math.LN2;function Aw(t){return t>>>=0,t===0?32:31-(kw(t)/Rw|0)|0}var Uc=64,Bc=4194304;function Ha(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function $d(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,o=n&268435455;if(o!==0){var l=o&~s;l!==0?r=Ha(l):(i&=o,i!==0&&(r=Ha(i)))}else o=n&~s,o!==0?r=Ha(o):i!==0&&(r=Ha(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-wr(e),s=1<<n,r|=t[n],e&=~s;return r}function Pw(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ow(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var o=31-wr(i),l=1<<o,c=s[o];c===-1?(!(l&n)||l&r)&&(s[o]=Pw(l,e)):c<=e&&(t.expiredLanes|=l),i&=~l}}function tp(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function D_(){var t=Uc;return Uc<<=1,!(Uc&4194240)&&(Uc=64),t}function eh(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Vl(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-wr(e),t[e]=n}function Lw(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-wr(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function Sg(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-wr(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var It=0;function M_(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var N_,wg,j_,$_,F_,np=!1,zc=[],Bs=null,zs=null,Hs=null,yl=new Map,vl=new Map,As=[],Dw="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function dy(t,e){switch(t){case"focusin":case"focusout":Bs=null;break;case"dragenter":case"dragleave":zs=null;break;case"mouseover":case"mouseout":Hs=null;break;case"pointerover":case"pointerout":yl.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":vl.delete(e.pointerId)}}function Ra(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=Kl(e),e!==null&&wg(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function Mw(t,e,n,r,s){switch(e){case"focusin":return Bs=Ra(Bs,t,e,n,r,s),!0;case"dragenter":return zs=Ra(zs,t,e,n,r,s),!0;case"mouseover":return Hs=Ra(Hs,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return yl.set(i,Ra(yl.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,vl.set(i,Ra(vl.get(i)||null,t,e,n,r,s)),!0}return!1}function U_(t){var e=Ti(t.target);if(e!==null){var n=Gi(e);if(n!==null){if(e=n.tag,e===13){if(e=k_(n),e!==null){t.blockedOn=e,F_(t.priority,function(){j_(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function ud(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=rp(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);Qh=r,n.target.dispatchEvent(r),Qh=null}else return e=Kl(n),e!==null&&wg(e),t.blockedOn=n,!1;e.shift()}return!0}function uy(t,e,n){ud(t)&&n.delete(e)}function Nw(){np=!1,Bs!==null&&ud(Bs)&&(Bs=null),zs!==null&&ud(zs)&&(zs=null),Hs!==null&&ud(Hs)&&(Hs=null),yl.forEach(uy),vl.forEach(uy)}function Aa(t,e){t.blockedOn===e&&(t.blockedOn=null,np||(np=!0,Jn.unstable_scheduleCallback(Jn.unstable_NormalPriority,Nw)))}function xl(t){function e(s){return Aa(s,t)}if(0<zc.length){Aa(zc[0],t);for(var n=1;n<zc.length;n++){var r=zc[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Bs!==null&&Aa(Bs,t),zs!==null&&Aa(zs,t),Hs!==null&&Aa(Hs,t),yl.forEach(e),vl.forEach(e),n=0;n<As.length;n++)r=As[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<As.length&&(n=As[0],n.blockedOn===null);)U_(n),n.blockedOn===null&&As.shift()}var Oo=ms.ReactCurrentBatchConfig,Fd=!0;function jw(t,e,n,r){var s=It,i=Oo.transition;Oo.transition=null;try{It=1,Ig(t,e,n,r)}finally{It=s,Oo.transition=i}}function $w(t,e,n,r){var s=It,i=Oo.transition;Oo.transition=null;try{It=4,Ig(t,e,n,r)}finally{It=s,Oo.transition=i}}function Ig(t,e,n,r){if(Fd){var s=rp(t,e,n,r);if(s===null)dh(t,e,r,Ud,n),dy(t,r);else if(Mw(s,t,e,n,r))r.stopPropagation();else if(dy(t,r),e&4&&-1<Dw.indexOf(t)){for(;s!==null;){var i=Kl(s);if(i!==null&&N_(i),i=rp(t,e,n,r),i===null&&dh(t,e,r,Ud,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else dh(t,e,r,null,n)}}var Ud=null;function rp(t,e,n,r){if(Ud=null,t=bg(r),t=Ti(t),t!==null)if(e=Gi(t),e===null)t=null;else if(n=e.tag,n===13){if(t=k_(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Ud=t,null}function B_(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Iw()){case Eg:return 1;case O_:return 4;case jd:case Tw:return 16;case L_:return 536870912;default:return 16}default:return 16}}var Ns=null,Tg=null,fd=null;function z_(){if(fd)return fd;var t,e=Tg,n=e.length,r,s="value"in Ns?Ns.value:Ns.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===s[i-r];r++);return fd=s.slice(t,1<r?1-r:void 0)}function hd(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Hc(){return!0}function fy(){return!1}function Zn(t){function e(n,r,s,i,o){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(i):i[l]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Hc:fy,this.isPropagationStopped=fy,this}return Gt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Hc)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Hc)},persist:function(){},isPersistent:Hc}),e}var ra={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Cg=Zn(ra),Yl=Gt({},ra,{view:0,detail:0}),Fw=Zn(Yl),th,nh,Pa,Ou=Gt({},Yl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:kg,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Pa&&(Pa&&t.type==="mousemove"?(th=t.screenX-Pa.screenX,nh=t.screenY-Pa.screenY):nh=th=0,Pa=t),th)},movementY:function(t){return"movementY"in t?t.movementY:nh}}),hy=Zn(Ou),Uw=Gt({},Ou,{dataTransfer:0}),Bw=Zn(Uw),zw=Gt({},Yl,{relatedTarget:0}),rh=Zn(zw),Hw=Gt({},ra,{animationName:0,elapsedTime:0,pseudoElement:0}),Ww=Zn(Hw),Gw=Gt({},ra,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Vw=Zn(Gw),Yw=Gt({},ra,{data:0}),py=Zn(Yw),Kw={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Xw={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Jw={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Qw(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=Jw[t])?!!e[t]:!1}function kg(){return Qw}var qw=Gt({},Yl,{key:function(t){if(t.key){var e=Kw[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=hd(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Xw[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:kg,charCode:function(t){return t.type==="keypress"?hd(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?hd(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Zw=Zn(qw),eI=Gt({},Ou,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),gy=Zn(eI),tI=Gt({},Yl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:kg}),nI=Zn(tI),rI=Gt({},ra,{propertyName:0,elapsedTime:0,pseudoElement:0}),sI=Zn(rI),iI=Gt({},Ou,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),oI=Zn(iI),aI=[9,13,27,32],Rg=cs&&"CompositionEvent"in window,Ja=null;cs&&"documentMode"in document&&(Ja=document.documentMode);var lI=cs&&"TextEvent"in window&&!Ja,H_=cs&&(!Rg||Ja&&8<Ja&&11>=Ja),my=" ",yy=!1;function W_(t,e){switch(t){case"keyup":return aI.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function G_(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var yo=!1;function cI(t,e){switch(t){case"compositionend":return G_(e);case"keypress":return e.which!==32?null:(yy=!0,my);case"textInput":return t=e.data,t===my&&yy?null:t;default:return null}}function dI(t,e){if(yo)return t==="compositionend"||!Rg&&W_(t,e)?(t=z_(),fd=Tg=Ns=null,yo=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return H_&&e.locale!=="ko"?null:e.data;default:return null}}var uI={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function vy(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!uI[t.type]:e==="textarea"}function V_(t,e,n,r){S_(r),e=Bd(e,"onChange"),0<e.length&&(n=new Cg("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Qa=null,_l=null;function fI(t){r1(t,0)}function Lu(t){var e=_o(t);if(m_(e))return t}function hI(t,e){if(t==="change")return e}var Y_=!1;if(cs){var sh;if(cs){var ih="oninput"in document;if(!ih){var xy=document.createElement("div");xy.setAttribute("oninput","return;"),ih=typeof xy.oninput=="function"}sh=ih}else sh=!1;Y_=sh&&(!document.documentMode||9<document.documentMode)}function _y(){Qa&&(Qa.detachEvent("onpropertychange",K_),_l=Qa=null)}function K_(t){if(t.propertyName==="value"&&Lu(_l)){var e=[];V_(e,_l,t,bg(t)),C_(fI,e)}}function pI(t,e,n){t==="focusin"?(_y(),Qa=e,_l=n,Qa.attachEvent("onpropertychange",K_)):t==="focusout"&&_y()}function gI(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Lu(_l)}function mI(t,e){if(t==="click")return Lu(e)}function yI(t,e){if(t==="input"||t==="change")return Lu(e)}function vI(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Cr=typeof Object.is=="function"?Object.is:vI;function bl(t,e){if(Cr(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!Fh.call(e,s)||!Cr(t[s],e[s]))return!1}return!0}function by(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Ey(t,e){var n=by(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=by(n)}}function X_(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?X_(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function J_(){for(var t=window,e=Dd();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Dd(t.document)}return e}function Ag(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function xI(t){var e=J_(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&X_(n.ownerDocument.documentElement,n)){if(r!==null&&Ag(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=Ey(n,i);var o=Ey(n,r);s&&o&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var _I=cs&&"documentMode"in document&&11>=document.documentMode,vo=null,sp=null,qa=null,ip=!1;function Sy(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;ip||vo==null||vo!==Dd(r)||(r=vo,"selectionStart"in r&&Ag(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),qa&&bl(qa,r)||(qa=r,r=Bd(sp,"onSelect"),0<r.length&&(e=new Cg("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=vo)))}function Wc(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var xo={animationend:Wc("Animation","AnimationEnd"),animationiteration:Wc("Animation","AnimationIteration"),animationstart:Wc("Animation","AnimationStart"),transitionend:Wc("Transition","TransitionEnd")},oh={},Q_={};cs&&(Q_=document.createElement("div").style,"AnimationEvent"in window||(delete xo.animationend.animation,delete xo.animationiteration.animation,delete xo.animationstart.animation),"TransitionEvent"in window||delete xo.transitionend.transition);function Du(t){if(oh[t])return oh[t];if(!xo[t])return t;var e=xo[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in Q_)return oh[t]=e[n];return t}var q_=Du("animationend"),Z_=Du("animationiteration"),e1=Du("animationstart"),t1=Du("transitionend"),n1=new Map,wy="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function li(t,e){n1.set(t,e),Wi(e,[t])}for(var ah=0;ah<wy.length;ah++){var lh=wy[ah],bI=lh.toLowerCase(),EI=lh[0].toUpperCase()+lh.slice(1);li(bI,"on"+EI)}li(q_,"onAnimationEnd");li(Z_,"onAnimationIteration");li(e1,"onAnimationStart");li("dblclick","onDoubleClick");li("focusin","onFocus");li("focusout","onBlur");li(t1,"onTransitionEnd");Bo("onMouseEnter",["mouseout","mouseover"]);Bo("onMouseLeave",["mouseout","mouseover"]);Bo("onPointerEnter",["pointerout","pointerover"]);Bo("onPointerLeave",["pointerout","pointerover"]);Wi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Wi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Wi("onBeforeInput",["compositionend","keypress","textInput","paste"]);Wi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Wi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Wi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Wa="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),SI=new Set("cancel close invalid load scroll toggle".split(" ").concat(Wa));function Iy(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,bw(r,e,void 0,t),t.currentTarget=null}function r1(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var l=r[o],c=l.instance,d=l.currentTarget;if(l=l.listener,c!==i&&s.isPropagationStopped())break e;Iy(s,l,d),i=c}else for(o=0;o<r.length;o++){if(l=r[o],c=l.instance,d=l.currentTarget,l=l.listener,c!==i&&s.isPropagationStopped())break e;Iy(s,l,d),i=c}}}if(Nd)throw t=ep,Nd=!1,ep=null,t}function Mt(t,e){var n=e[dp];n===void 0&&(n=e[dp]=new Set);var r=t+"__bubble";n.has(r)||(s1(e,t,2,!1),n.add(r))}function ch(t,e,n){var r=0;e&&(r|=4),s1(n,t,r,e)}var Gc="_reactListening"+Math.random().toString(36).slice(2);function El(t){if(!t[Gc]){t[Gc]=!0,u_.forEach(function(n){n!=="selectionchange"&&(SI.has(n)||ch(n,!1,t),ch(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Gc]||(e[Gc]=!0,ch("selectionchange",!1,e))}}function s1(t,e,n,r){switch(B_(e)){case 1:var s=jw;break;case 4:s=$w;break;default:s=Ig}n=s.bind(null,e,n,t),s=void 0,!Zh||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function dh(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var l=r.stateNode.containerInfo;if(l===s||l.nodeType===8&&l.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===s||c.nodeType===8&&c.parentNode===s))return;o=o.return}for(;l!==null;){if(o=Ti(l),o===null)return;if(c=o.tag,c===5||c===6){r=i=o;continue e}l=l.parentNode}}r=r.return}C_(function(){var d=i,u=bg(n),p=[];e:{var f=n1.get(t);if(f!==void 0){var S=Cg,R=t;switch(t){case"keypress":if(hd(n)===0)break e;case"keydown":case"keyup":S=Zw;break;case"focusin":R="focus",S=rh;break;case"focusout":R="blur",S=rh;break;case"beforeblur":case"afterblur":S=rh;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":S=hy;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":S=Bw;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":S=nI;break;case q_:case Z_:case e1:S=Ww;break;case t1:S=sI;break;case"scroll":S=Fw;break;case"wheel":S=oI;break;case"copy":case"cut":case"paste":S=Vw;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":S=gy}var C=(e&4)!==0,j=!C&&t==="scroll",_=C?f!==null?f+"Capture":null:f;C=[];for(var v=d,w;v!==null;){w=v;var h=w.stateNode;if(w.tag===5&&h!==null&&(w=h,_!==null&&(h=ml(v,_),h!=null&&C.push(Sl(v,h,w)))),j)break;v=v.return}0<C.length&&(f=new S(f,R,null,n,u),p.push({event:f,listeners:C}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",S=t==="mouseout"||t==="pointerout",f&&n!==Qh&&(R=n.relatedTarget||n.fromElement)&&(Ti(R)||R[ds]))break e;if((S||f)&&(f=u.window===u?u:(f=u.ownerDocument)?f.defaultView||f.parentWindow:window,S?(R=n.relatedTarget||n.toElement,S=d,R=R?Ti(R):null,R!==null&&(j=Gi(R),R!==j||R.tag!==5&&R.tag!==6)&&(R=null)):(S=null,R=d),S!==R)){if(C=hy,h="onMouseLeave",_="onMouseEnter",v="mouse",(t==="pointerout"||t==="pointerover")&&(C=gy,h="onPointerLeave",_="onPointerEnter",v="pointer"),j=S==null?f:_o(S),w=R==null?f:_o(R),f=new C(h,v+"leave",S,n,u),f.target=j,f.relatedTarget=w,h=null,Ti(u)===d&&(C=new C(_,v+"enter",R,n,u),C.target=w,C.relatedTarget=j,h=C),j=h,S&&R)t:{for(C=S,_=R,v=0,w=C;w;w=uo(w))v++;for(w=0,h=_;h;h=uo(h))w++;for(;0<v-w;)C=uo(C),v--;for(;0<w-v;)_=uo(_),w--;for(;v--;){if(C===_||_!==null&&C===_.alternate)break t;C=uo(C),_=uo(_)}C=null}else C=null;S!==null&&Ty(p,f,S,C,!1),R!==null&&j!==null&&Ty(p,j,R,C,!0)}}e:{if(f=d?_o(d):window,S=f.nodeName&&f.nodeName.toLowerCase(),S==="select"||S==="input"&&f.type==="file")var D=hI;else if(vy(f))if(Y_)D=yI;else{D=gI;var H=pI}else(S=f.nodeName)&&S.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(D=mI);if(D&&(D=D(t,d))){V_(p,D,n,u);break e}H&&H(t,f,d),t==="focusout"&&(H=f._wrapperState)&&H.controlled&&f.type==="number"&&Vh(f,"number",f.value)}switch(H=d?_o(d):window,t){case"focusin":(vy(H)||H.contentEditable==="true")&&(vo=H,sp=d,qa=null);break;case"focusout":qa=sp=vo=null;break;case"mousedown":ip=!0;break;case"contextmenu":case"mouseup":case"dragend":ip=!1,Sy(p,n,u);break;case"selectionchange":if(_I)break;case"keydown":case"keyup":Sy(p,n,u)}var re;if(Rg)e:{switch(t){case"compositionstart":var W="onCompositionStart";break e;case"compositionend":W="onCompositionEnd";break e;case"compositionupdate":W="onCompositionUpdate";break e}W=void 0}else yo?W_(t,n)&&(W="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(W="onCompositionStart");W&&(H_&&n.locale!=="ko"&&(yo||W!=="onCompositionStart"?W==="onCompositionEnd"&&yo&&(re=z_()):(Ns=u,Tg="value"in Ns?Ns.value:Ns.textContent,yo=!0)),H=Bd(d,W),0<H.length&&(W=new py(W,t,null,n,u),p.push({event:W,listeners:H}),re?W.data=re:(re=G_(n),re!==null&&(W.data=re)))),(re=lI?cI(t,n):dI(t,n))&&(d=Bd(d,"onBeforeInput"),0<d.length&&(u=new py("onBeforeInput","beforeinput",null,n,u),p.push({event:u,listeners:d}),u.data=re))}r1(p,e)})}function Sl(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Bd(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=ml(t,n),i!=null&&r.unshift(Sl(t,i,s)),i=ml(t,e),i!=null&&r.push(Sl(t,i,s))),t=t.return}return r}function uo(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Ty(t,e,n,r,s){for(var i=e._reactName,o=[];n!==null&&n!==r;){var l=n,c=l.alternate,d=l.stateNode;if(c!==null&&c===r)break;l.tag===5&&d!==null&&(l=d,s?(c=ml(n,i),c!=null&&o.unshift(Sl(n,c,l))):s||(c=ml(n,i),c!=null&&o.push(Sl(n,c,l)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var wI=/\r\n?/g,II=/\u0000|\uFFFD/g;function Cy(t){return(typeof t=="string"?t:""+t).replace(wI,`
`).replace(II,"")}function Vc(t,e,n){if(e=Cy(e),Cy(t)!==e&&n)throw Error(fe(425))}function zd(){}var op=null,ap=null;function lp(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var cp=typeof setTimeout=="function"?setTimeout:void 0,TI=typeof clearTimeout=="function"?clearTimeout:void 0,ky=typeof Promise=="function"?Promise:void 0,CI=typeof queueMicrotask=="function"?queueMicrotask:typeof ky<"u"?function(t){return ky.resolve(null).then(t).catch(kI)}:cp;function kI(t){setTimeout(function(){throw t})}function uh(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),xl(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);xl(e)}function Ws(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Ry(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var sa=Math.random().toString(36).slice(2),jr="__reactFiber$"+sa,wl="__reactProps$"+sa,ds="__reactContainer$"+sa,dp="__reactEvents$"+sa,RI="__reactListeners$"+sa,AI="__reactHandles$"+sa;function Ti(t){var e=t[jr];if(e)return e;for(var n=t.parentNode;n;){if(e=n[ds]||n[jr]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Ry(t);t!==null;){if(n=t[jr])return n;t=Ry(t)}return e}t=n,n=t.parentNode}return null}function Kl(t){return t=t[jr]||t[ds],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function _o(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(fe(33))}function Mu(t){return t[wl]||null}var up=[],bo=-1;function ci(t){return{current:t}}function Nt(t){0>bo||(t.current=up[bo],up[bo]=null,bo--)}function Dt(t,e){bo++,up[bo]=t.current,t.current=e}var ni={},En=ci(ni),zn=ci(!1),Oi=ni;function zo(t,e){var n=t.type.contextTypes;if(!n)return ni;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function Hn(t){return t=t.childContextTypes,t!=null}function Hd(){Nt(zn),Nt(En)}function Ay(t,e,n){if(En.current!==ni)throw Error(fe(168));Dt(En,e),Dt(zn,n)}function i1(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(fe(108,pw(t)||"Unknown",s));return Gt({},n,r)}function Wd(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||ni,Oi=En.current,Dt(En,t),Dt(zn,zn.current),!0}function Py(t,e,n){var r=t.stateNode;if(!r)throw Error(fe(169));n?(t=i1(t,e,Oi),r.__reactInternalMemoizedMergedChildContext=t,Nt(zn),Nt(En),Dt(En,t)):Nt(zn),Dt(zn,n)}var qr=null,Nu=!1,fh=!1;function o1(t){qr===null?qr=[t]:qr.push(t)}function PI(t){Nu=!0,o1(t)}function di(){if(!fh&&qr!==null){fh=!0;var t=0,e=It;try{var n=qr;for(It=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}qr=null,Nu=!1}catch(s){throw qr!==null&&(qr=qr.slice(t+1)),P_(Eg,di),s}finally{It=e,fh=!1}}return null}var Eo=[],So=0,Gd=null,Vd=0,sr=[],ir=0,Li=null,ts=1,ns="";function bi(t,e){Eo[So++]=Vd,Eo[So++]=Gd,Gd=t,Vd=e}function a1(t,e,n){sr[ir++]=ts,sr[ir++]=ns,sr[ir++]=Li,Li=t;var r=ts;t=ns;var s=32-wr(r)-1;r&=~(1<<s),n+=1;var i=32-wr(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,ts=1<<32-wr(e)+s|n<<s|r,ns=i+t}else ts=1<<i|n<<s|r,ns=t}function Pg(t){t.return!==null&&(bi(t,1),a1(t,1,0))}function Og(t){for(;t===Gd;)Gd=Eo[--So],Eo[So]=null,Vd=Eo[--So],Eo[So]=null;for(;t===Li;)Li=sr[--ir],sr[ir]=null,ns=sr[--ir],sr[ir]=null,ts=sr[--ir],sr[ir]=null}var Xn=null,Kn=null,$t=!1,xr=null;function l1(t,e){var n=ar(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Oy(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Xn=t,Kn=Ws(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Xn=t,Kn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Li!==null?{id:ts,overflow:ns}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=ar(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Xn=t,Kn=null,!0):!1;default:return!1}}function fp(t){return(t.mode&1)!==0&&(t.flags&128)===0}function hp(t){if($t){var e=Kn;if(e){var n=e;if(!Oy(t,e)){if(fp(t))throw Error(fe(418));e=Ws(n.nextSibling);var r=Xn;e&&Oy(t,e)?l1(r,n):(t.flags=t.flags&-4097|2,$t=!1,Xn=t)}}else{if(fp(t))throw Error(fe(418));t.flags=t.flags&-4097|2,$t=!1,Xn=t}}}function Ly(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Xn=t}function Yc(t){if(t!==Xn)return!1;if(!$t)return Ly(t),$t=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!lp(t.type,t.memoizedProps)),e&&(e=Kn)){if(fp(t))throw c1(),Error(fe(418));for(;e;)l1(t,e),e=Ws(e.nextSibling)}if(Ly(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(fe(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Kn=Ws(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Kn=null}}else Kn=Xn?Ws(t.stateNode.nextSibling):null;return!0}function c1(){for(var t=Kn;t;)t=Ws(t.nextSibling)}function Ho(){Kn=Xn=null,$t=!1}function Lg(t){xr===null?xr=[t]:xr.push(t)}var OI=ms.ReactCurrentBatchConfig;function Oa(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(fe(309));var r=n.stateNode}if(!r)throw Error(fe(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var l=s.refs;o===null?delete l[i]:l[i]=o},e._stringRef=i,e)}if(typeof t!="string")throw Error(fe(284));if(!n._owner)throw Error(fe(290,t))}return t}function Kc(t,e){throw t=Object.prototype.toString.call(e),Error(fe(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Dy(t){var e=t._init;return e(t._payload)}function d1(t){function e(_,v){if(t){var w=_.deletions;w===null?(_.deletions=[v],_.flags|=16):w.push(v)}}function n(_,v){if(!t)return null;for(;v!==null;)e(_,v),v=v.sibling;return null}function r(_,v){for(_=new Map;v!==null;)v.key!==null?_.set(v.key,v):_.set(v.index,v),v=v.sibling;return _}function s(_,v){return _=Ks(_,v),_.index=0,_.sibling=null,_}function i(_,v,w){return _.index=w,t?(w=_.alternate,w!==null?(w=w.index,w<v?(_.flags|=2,v):w):(_.flags|=2,v)):(_.flags|=1048576,v)}function o(_){return t&&_.alternate===null&&(_.flags|=2),_}function l(_,v,w,h){return v===null||v.tag!==6?(v=xh(w,_.mode,h),v.return=_,v):(v=s(v,w),v.return=_,v)}function c(_,v,w,h){var D=w.type;return D===mo?u(_,v,w.props.children,h,w.key):v!==null&&(v.elementType===D||typeof D=="object"&&D!==null&&D.$$typeof===ks&&Dy(D)===v.type)?(h=s(v,w.props),h.ref=Oa(_,v,w),h.return=_,h):(h=_d(w.type,w.key,w.props,null,_.mode,h),h.ref=Oa(_,v,w),h.return=_,h)}function d(_,v,w,h){return v===null||v.tag!==4||v.stateNode.containerInfo!==w.containerInfo||v.stateNode.implementation!==w.implementation?(v=_h(w,_.mode,h),v.return=_,v):(v=s(v,w.children||[]),v.return=_,v)}function u(_,v,w,h,D){return v===null||v.tag!==7?(v=Pi(w,_.mode,h,D),v.return=_,v):(v=s(v,w),v.return=_,v)}function p(_,v,w){if(typeof v=="string"&&v!==""||typeof v=="number")return v=xh(""+v,_.mode,w),v.return=_,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case jc:return w=_d(v.type,v.key,v.props,null,_.mode,w),w.ref=Oa(_,null,v),w.return=_,w;case go:return v=_h(v,_.mode,w),v.return=_,v;case ks:var h=v._init;return p(_,h(v._payload),w)}if(za(v)||Ca(v))return v=Pi(v,_.mode,w,null),v.return=_,v;Kc(_,v)}return null}function f(_,v,w,h){var D=v!==null?v.key:null;if(typeof w=="string"&&w!==""||typeof w=="number")return D!==null?null:l(_,v,""+w,h);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case jc:return w.key===D?c(_,v,w,h):null;case go:return w.key===D?d(_,v,w,h):null;case ks:return D=w._init,f(_,v,D(w._payload),h)}if(za(w)||Ca(w))return D!==null?null:u(_,v,w,h,null);Kc(_,w)}return null}function S(_,v,w,h,D){if(typeof h=="string"&&h!==""||typeof h=="number")return _=_.get(w)||null,l(v,_,""+h,D);if(typeof h=="object"&&h!==null){switch(h.$$typeof){case jc:return _=_.get(h.key===null?w:h.key)||null,c(v,_,h,D);case go:return _=_.get(h.key===null?w:h.key)||null,d(v,_,h,D);case ks:var H=h._init;return S(_,v,w,H(h._payload),D)}if(za(h)||Ca(h))return _=_.get(w)||null,u(v,_,h,D,null);Kc(v,h)}return null}function R(_,v,w,h){for(var D=null,H=null,re=v,W=v=0,Z=null;re!==null&&W<w.length;W++){re.index>W?(Z=re,re=null):Z=re.sibling;var he=f(_,re,w[W],h);if(he===null){re===null&&(re=Z);break}t&&re&&he.alternate===null&&e(_,re),v=i(he,v,W),H===null?D=he:H.sibling=he,H=he,re=Z}if(W===w.length)return n(_,re),$t&&bi(_,W),D;if(re===null){for(;W<w.length;W++)re=p(_,w[W],h),re!==null&&(v=i(re,v,W),H===null?D=re:H.sibling=re,H=re);return $t&&bi(_,W),D}for(re=r(_,re);W<w.length;W++)Z=S(re,_,W,w[W],h),Z!==null&&(t&&Z.alternate!==null&&re.delete(Z.key===null?W:Z.key),v=i(Z,v,W),H===null?D=Z:H.sibling=Z,H=Z);return t&&re.forEach(function(xe){return e(_,xe)}),$t&&bi(_,W),D}function C(_,v,w,h){var D=Ca(w);if(typeof D!="function")throw Error(fe(150));if(w=D.call(w),w==null)throw Error(fe(151));for(var H=D=null,re=v,W=v=0,Z=null,he=w.next();re!==null&&!he.done;W++,he=w.next()){re.index>W?(Z=re,re=null):Z=re.sibling;var xe=f(_,re,he.value,h);if(xe===null){re===null&&(re=Z);break}t&&re&&xe.alternate===null&&e(_,re),v=i(xe,v,W),H===null?D=xe:H.sibling=xe,H=xe,re=Z}if(he.done)return n(_,re),$t&&bi(_,W),D;if(re===null){for(;!he.done;W++,he=w.next())he=p(_,he.value,h),he!==null&&(v=i(he,v,W),H===null?D=he:H.sibling=he,H=he);return $t&&bi(_,W),D}for(re=r(_,re);!he.done;W++,he=w.next())he=S(re,_,W,he.value,h),he!==null&&(t&&he.alternate!==null&&re.delete(he.key===null?W:he.key),v=i(he,v,W),H===null?D=he:H.sibling=he,H=he);return t&&re.forEach(function(Ue){return e(_,Ue)}),$t&&bi(_,W),D}function j(_,v,w,h){if(typeof w=="object"&&w!==null&&w.type===mo&&w.key===null&&(w=w.props.children),typeof w=="object"&&w!==null){switch(w.$$typeof){case jc:e:{for(var D=w.key,H=v;H!==null;){if(H.key===D){if(D=w.type,D===mo){if(H.tag===7){n(_,H.sibling),v=s(H,w.props.children),v.return=_,_=v;break e}}else if(H.elementType===D||typeof D=="object"&&D!==null&&D.$$typeof===ks&&Dy(D)===H.type){n(_,H.sibling),v=s(H,w.props),v.ref=Oa(_,H,w),v.return=_,_=v;break e}n(_,H);break}else e(_,H);H=H.sibling}w.type===mo?(v=Pi(w.props.children,_.mode,h,w.key),v.return=_,_=v):(h=_d(w.type,w.key,w.props,null,_.mode,h),h.ref=Oa(_,v,w),h.return=_,_=h)}return o(_);case go:e:{for(H=w.key;v!==null;){if(v.key===H)if(v.tag===4&&v.stateNode.containerInfo===w.containerInfo&&v.stateNode.implementation===w.implementation){n(_,v.sibling),v=s(v,w.children||[]),v.return=_,_=v;break e}else{n(_,v);break}else e(_,v);v=v.sibling}v=_h(w,_.mode,h),v.return=_,_=v}return o(_);case ks:return H=w._init,j(_,v,H(w._payload),h)}if(za(w))return R(_,v,w,h);if(Ca(w))return C(_,v,w,h);Kc(_,w)}return typeof w=="string"&&w!==""||typeof w=="number"?(w=""+w,v!==null&&v.tag===6?(n(_,v.sibling),v=s(v,w),v.return=_,_=v):(n(_,v),v=xh(w,_.mode,h),v.return=_,_=v),o(_)):n(_,v)}return j}var Wo=d1(!0),u1=d1(!1),Yd=ci(null),Kd=null,wo=null,Dg=null;function Mg(){Dg=wo=Kd=null}function Ng(t){var e=Yd.current;Nt(Yd),t._currentValue=e}function pp(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function Lo(t,e){Kd=t,Dg=wo=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Fn=!0),t.firstContext=null)}function dr(t){var e=t._currentValue;if(Dg!==t)if(t={context:t,memoizedValue:e,next:null},wo===null){if(Kd===null)throw Error(fe(308));wo=t,Kd.dependencies={lanes:0,firstContext:t}}else wo=wo.next=t;return e}var Ci=null;function jg(t){Ci===null?Ci=[t]:Ci.push(t)}function f1(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,jg(e)):(n.next=s.next,s.next=n),e.interleaved=n,us(t,r)}function us(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Rs=!1;function $g(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function h1(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function os(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Gs(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,yt&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,us(t,n)}return s=r.interleaved,s===null?(e.next=e,jg(r)):(e.next=s.next,s.next=e),r.interleaved=e,us(t,n)}function pd(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Sg(t,n)}}function My(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=o:i=i.next=o,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Xd(t,e,n,r){var s=t.updateQueue;Rs=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,l=s.shared.pending;if(l!==null){s.shared.pending=null;var c=l,d=c.next;c.next=null,o===null?i=d:o.next=d,o=c;var u=t.alternate;u!==null&&(u=u.updateQueue,l=u.lastBaseUpdate,l!==o&&(l===null?u.firstBaseUpdate=d:l.next=d,u.lastBaseUpdate=c))}if(i!==null){var p=s.baseState;o=0,u=d=c=null,l=i;do{var f=l.lane,S=l.eventTime;if((r&f)===f){u!==null&&(u=u.next={eventTime:S,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var R=t,C=l;switch(f=e,S=n,C.tag){case 1:if(R=C.payload,typeof R=="function"){p=R.call(S,p,f);break e}p=R;break e;case 3:R.flags=R.flags&-65537|128;case 0:if(R=C.payload,f=typeof R=="function"?R.call(S,p,f):R,f==null)break e;p=Gt({},p,f);break e;case 2:Rs=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,f=s.effects,f===null?s.effects=[l]:f.push(l))}else S={eventTime:S,lane:f,tag:l.tag,payload:l.payload,callback:l.callback,next:null},u===null?(d=u=S,c=p):u=u.next=S,o|=f;if(l=l.next,l===null){if(l=s.shared.pending,l===null)break;f=l,l=f.next,f.next=null,s.lastBaseUpdate=f,s.shared.pending=null}}while(!0);if(u===null&&(c=p),s.baseState=c,s.firstBaseUpdate=d,s.lastBaseUpdate=u,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);Mi|=o,t.lanes=o,t.memoizedState=p}}function Ny(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(fe(191,s));s.call(r)}}}var Xl={},zr=ci(Xl),Il=ci(Xl),Tl=ci(Xl);function ki(t){if(t===Xl)throw Error(fe(174));return t}function Fg(t,e){switch(Dt(Tl,e),Dt(Il,t),Dt(zr,Xl),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Kh(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Kh(e,t)}Nt(zr),Dt(zr,e)}function Go(){Nt(zr),Nt(Il),Nt(Tl)}function p1(t){ki(Tl.current);var e=ki(zr.current),n=Kh(e,t.type);e!==n&&(Dt(Il,t),Dt(zr,n))}function Ug(t){Il.current===t&&(Nt(zr),Nt(Il))}var Bt=ci(0);function Jd(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var hh=[];function Bg(){for(var t=0;t<hh.length;t++)hh[t]._workInProgressVersionPrimary=null;hh.length=0}var gd=ms.ReactCurrentDispatcher,ph=ms.ReactCurrentBatchConfig,Di=0,Wt=null,Zt=null,sn=null,Qd=!1,Za=!1,Cl=0,LI=0;function vn(){throw Error(fe(321))}function zg(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Cr(t[n],e[n]))return!1;return!0}function Hg(t,e,n,r,s,i){if(Di=i,Wt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,gd.current=t===null||t.memoizedState===null?jI:$I,t=n(r,s),Za){i=0;do{if(Za=!1,Cl=0,25<=i)throw Error(fe(301));i+=1,sn=Zt=null,e.updateQueue=null,gd.current=FI,t=n(r,s)}while(Za)}if(gd.current=qd,e=Zt!==null&&Zt.next!==null,Di=0,sn=Zt=Wt=null,Qd=!1,e)throw Error(fe(300));return t}function Wg(){var t=Cl!==0;return Cl=0,t}function Nr(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return sn===null?Wt.memoizedState=sn=t:sn=sn.next=t,sn}function ur(){if(Zt===null){var t=Wt.alternate;t=t!==null?t.memoizedState:null}else t=Zt.next;var e=sn===null?Wt.memoizedState:sn.next;if(e!==null)sn=e,Zt=t;else{if(t===null)throw Error(fe(310));Zt=t,t={memoizedState:Zt.memoizedState,baseState:Zt.baseState,baseQueue:Zt.baseQueue,queue:Zt.queue,next:null},sn===null?Wt.memoizedState=sn=t:sn=sn.next=t}return sn}function kl(t,e){return typeof e=="function"?e(t):e}function gh(t){var e=ur(),n=e.queue;if(n===null)throw Error(fe(311));n.lastRenderedReducer=t;var r=Zt,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var l=o=null,c=null,d=i;do{var u=d.lane;if((Di&u)===u)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:t(r,d.action);else{var p={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(l=c=p,o=r):c=c.next=p,Wt.lanes|=u,Mi|=u}d=d.next}while(d!==null&&d!==i);c===null?o=r:c.next=l,Cr(r,e.memoizedState)||(Fn=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=c,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,Wt.lanes|=i,Mi|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function mh(t){var e=ur(),n=e.queue;if(n===null)throw Error(fe(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var o=s=s.next;do i=t(i,o.action),o=o.next;while(o!==s);Cr(i,e.memoizedState)||(Fn=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function g1(){}function m1(t,e){var n=Wt,r=ur(),s=e(),i=!Cr(r.memoizedState,s);if(i&&(r.memoizedState=s,Fn=!0),r=r.queue,Gg(x1.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||sn!==null&&sn.memoizedState.tag&1){if(n.flags|=2048,Rl(9,v1.bind(null,n,r,s,e),void 0,null),ln===null)throw Error(fe(349));Di&30||y1(n,e,s)}return s}function y1(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Wt.updateQueue,e===null?(e={lastEffect:null,stores:null},Wt.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function v1(t,e,n,r){e.value=n,e.getSnapshot=r,_1(e)&&b1(t)}function x1(t,e,n){return n(function(){_1(e)&&b1(t)})}function _1(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Cr(t,n)}catch{return!0}}function b1(t){var e=us(t,1);e!==null&&Ir(e,t,1,-1)}function jy(t){var e=Nr();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:kl,lastRenderedState:t},e.queue=t,t=t.dispatch=NI.bind(null,Wt,t),[e.memoizedState,t]}function Rl(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=Wt.updateQueue,e===null?(e={lastEffect:null,stores:null},Wt.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function E1(){return ur().memoizedState}function md(t,e,n,r){var s=Nr();Wt.flags|=t,s.memoizedState=Rl(1|e,n,void 0,r===void 0?null:r)}function ju(t,e,n,r){var s=ur();r=r===void 0?null:r;var i=void 0;if(Zt!==null){var o=Zt.memoizedState;if(i=o.destroy,r!==null&&zg(r,o.deps)){s.memoizedState=Rl(e,n,i,r);return}}Wt.flags|=t,s.memoizedState=Rl(1|e,n,i,r)}function $y(t,e){return md(8390656,8,t,e)}function Gg(t,e){return ju(2048,8,t,e)}function S1(t,e){return ju(4,2,t,e)}function w1(t,e){return ju(4,4,t,e)}function I1(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function T1(t,e,n){return n=n!=null?n.concat([t]):null,ju(4,4,I1.bind(null,e,t),n)}function Vg(){}function C1(t,e){var n=ur();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&zg(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function k1(t,e){var n=ur();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&zg(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function R1(t,e,n){return Di&21?(Cr(n,e)||(n=D_(),Wt.lanes|=n,Mi|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Fn=!0),t.memoizedState=n)}function DI(t,e){var n=It;It=n!==0&&4>n?n:4,t(!0);var r=ph.transition;ph.transition={};try{t(!1),e()}finally{It=n,ph.transition=r}}function A1(){return ur().memoizedState}function MI(t,e,n){var r=Ys(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},P1(t))O1(e,n);else if(n=f1(t,e,n,r),n!==null){var s=Rn();Ir(n,t,r,s),L1(n,e,r)}}function NI(t,e,n){var r=Ys(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(P1(t))O1(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,l=i(o,n);if(s.hasEagerState=!0,s.eagerState=l,Cr(l,o)){var c=e.interleaved;c===null?(s.next=s,jg(e)):(s.next=c.next,c.next=s),e.interleaved=s;return}}catch{}finally{}n=f1(t,e,s,r),n!==null&&(s=Rn(),Ir(n,t,r,s),L1(n,e,r))}}function P1(t){var e=t.alternate;return t===Wt||e!==null&&e===Wt}function O1(t,e){Za=Qd=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function L1(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Sg(t,n)}}var qd={readContext:dr,useCallback:vn,useContext:vn,useEffect:vn,useImperativeHandle:vn,useInsertionEffect:vn,useLayoutEffect:vn,useMemo:vn,useReducer:vn,useRef:vn,useState:vn,useDebugValue:vn,useDeferredValue:vn,useTransition:vn,useMutableSource:vn,useSyncExternalStore:vn,useId:vn,unstable_isNewReconciler:!1},jI={readContext:dr,useCallback:function(t,e){return Nr().memoizedState=[t,e===void 0?null:e],t},useContext:dr,useEffect:$y,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,md(4194308,4,I1.bind(null,e,t),n)},useLayoutEffect:function(t,e){return md(4194308,4,t,e)},useInsertionEffect:function(t,e){return md(4,2,t,e)},useMemo:function(t,e){var n=Nr();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Nr();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=MI.bind(null,Wt,t),[r.memoizedState,t]},useRef:function(t){var e=Nr();return t={current:t},e.memoizedState=t},useState:jy,useDebugValue:Vg,useDeferredValue:function(t){return Nr().memoizedState=t},useTransition:function(){var t=jy(!1),e=t[0];return t=DI.bind(null,t[1]),Nr().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=Wt,s=Nr();if($t){if(n===void 0)throw Error(fe(407));n=n()}else{if(n=e(),ln===null)throw Error(fe(349));Di&30||y1(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,$y(x1.bind(null,r,i,t),[t]),r.flags|=2048,Rl(9,v1.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=Nr(),e=ln.identifierPrefix;if($t){var n=ns,r=ts;n=(r&~(1<<32-wr(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=Cl++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=LI++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},$I={readContext:dr,useCallback:C1,useContext:dr,useEffect:Gg,useImperativeHandle:T1,useInsertionEffect:S1,useLayoutEffect:w1,useMemo:k1,useReducer:gh,useRef:E1,useState:function(){return gh(kl)},useDebugValue:Vg,useDeferredValue:function(t){var e=ur();return R1(e,Zt.memoizedState,t)},useTransition:function(){var t=gh(kl)[0],e=ur().memoizedState;return[t,e]},useMutableSource:g1,useSyncExternalStore:m1,useId:A1,unstable_isNewReconciler:!1},FI={readContext:dr,useCallback:C1,useContext:dr,useEffect:Gg,useImperativeHandle:T1,useInsertionEffect:S1,useLayoutEffect:w1,useMemo:k1,useReducer:mh,useRef:E1,useState:function(){return mh(kl)},useDebugValue:Vg,useDeferredValue:function(t){var e=ur();return Zt===null?e.memoizedState=t:R1(e,Zt.memoizedState,t)},useTransition:function(){var t=mh(kl)[0],e=ur().memoizedState;return[t,e]},useMutableSource:g1,useSyncExternalStore:m1,useId:A1,unstable_isNewReconciler:!1};function yr(t,e){if(t&&t.defaultProps){e=Gt({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function gp(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:Gt({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var $u={isMounted:function(t){return(t=t._reactInternals)?Gi(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=Rn(),s=Ys(t),i=os(r,s);i.payload=e,n!=null&&(i.callback=n),e=Gs(t,i,s),e!==null&&(Ir(e,t,s,r),pd(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=Rn(),s=Ys(t),i=os(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=Gs(t,i,s),e!==null&&(Ir(e,t,s,r),pd(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Rn(),r=Ys(t),s=os(n,r);s.tag=2,e!=null&&(s.callback=e),e=Gs(t,s,r),e!==null&&(Ir(e,t,r,n),pd(e,t,r))}};function Fy(t,e,n,r,s,i,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!bl(n,r)||!bl(s,i):!0}function D1(t,e,n){var r=!1,s=ni,i=e.contextType;return typeof i=="object"&&i!==null?i=dr(i):(s=Hn(e)?Oi:En.current,r=e.contextTypes,i=(r=r!=null)?zo(t,s):ni),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=$u,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function Uy(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&$u.enqueueReplaceState(e,e.state,null)}function mp(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},$g(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=dr(i):(i=Hn(e)?Oi:En.current,s.context=zo(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(gp(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&$u.enqueueReplaceState(s,s.state,null),Xd(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function Vo(t,e){try{var n="",r=e;do n+=hw(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function yh(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function yp(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var UI=typeof WeakMap=="function"?WeakMap:Map;function M1(t,e,n){n=os(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){eu||(eu=!0,Cp=r),yp(t,e)},n}function N1(t,e,n){n=os(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){yp(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){yp(t,e),typeof r!="function"&&(Vs===null?Vs=new Set([this]):Vs.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function By(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new UI;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=eT.bind(null,t,e,n),e.then(t,t))}function zy(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Hy(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=os(-1,1),e.tag=2,Gs(n,e,1))),n.lanes|=1),t)}var BI=ms.ReactCurrentOwner,Fn=!1;function Cn(t,e,n,r){e.child=t===null?u1(e,null,n,r):Wo(e,t.child,n,r)}function Wy(t,e,n,r,s){n=n.render;var i=e.ref;return Lo(e,s),r=Hg(t,e,n,r,i,s),n=Wg(),t!==null&&!Fn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,fs(t,e,s)):($t&&n&&Pg(e),e.flags|=1,Cn(t,e,r,s),e.child)}function Gy(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!e0(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,j1(t,e,i,r,s)):(t=_d(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var o=i.memoizedProps;if(n=n.compare,n=n!==null?n:bl,n(o,r)&&t.ref===e.ref)return fs(t,e,s)}return e.flags|=1,t=Ks(i,r),t.ref=e.ref,t.return=e,e.child=t}function j1(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(bl(i,r)&&t.ref===e.ref)if(Fn=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(Fn=!0);else return e.lanes=t.lanes,fs(t,e,s)}return vp(t,e,n,r,s)}function $1(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Dt(To,Yn),Yn|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Dt(To,Yn),Yn|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,Dt(To,Yn),Yn|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,Dt(To,Yn),Yn|=r;return Cn(t,e,s,n),e.child}function F1(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function vp(t,e,n,r,s){var i=Hn(n)?Oi:En.current;return i=zo(e,i),Lo(e,s),n=Hg(t,e,n,r,i,s),r=Wg(),t!==null&&!Fn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,fs(t,e,s)):($t&&r&&Pg(e),e.flags|=1,Cn(t,e,n,s),e.child)}function Vy(t,e,n,r,s){if(Hn(n)){var i=!0;Wd(e)}else i=!1;if(Lo(e,s),e.stateNode===null)yd(t,e),D1(e,n,r),mp(e,n,r,s),r=!0;else if(t===null){var o=e.stateNode,l=e.memoizedProps;o.props=l;var c=o.context,d=n.contextType;typeof d=="object"&&d!==null?d=dr(d):(d=Hn(n)?Oi:En.current,d=zo(e,d));var u=n.getDerivedStateFromProps,p=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";p||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==r||c!==d)&&Uy(e,o,r,d),Rs=!1;var f=e.memoizedState;o.state=f,Xd(e,r,o,s),c=e.memoizedState,l!==r||f!==c||zn.current||Rs?(typeof u=="function"&&(gp(e,n,u,r),c=e.memoizedState),(l=Rs||Fy(e,n,l,r,f,c,d))?(p||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),o.props=r,o.state=c,o.context=d,r=l):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,h1(t,e),l=e.memoizedProps,d=e.type===e.elementType?l:yr(e.type,l),o.props=d,p=e.pendingProps,f=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=dr(c):(c=Hn(n)?Oi:En.current,c=zo(e,c));var S=n.getDerivedStateFromProps;(u=typeof S=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==p||f!==c)&&Uy(e,o,r,c),Rs=!1,f=e.memoizedState,o.state=f,Xd(e,r,o,s);var R=e.memoizedState;l!==p||f!==R||zn.current||Rs?(typeof S=="function"&&(gp(e,n,S,r),R=e.memoizedState),(d=Rs||Fy(e,n,d,r,f,R,c)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,R,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,R,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=R),o.props=r,o.state=R,o.context=c,r=d):(typeof o.componentDidUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),r=!1)}return xp(t,e,n,r,i,s)}function xp(t,e,n,r,s,i){F1(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&Py(e,n,!1),fs(t,e,i);r=e.stateNode,BI.current=e;var l=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=Wo(e,t.child,null,i),e.child=Wo(e,null,l,i)):Cn(t,e,l,i),e.memoizedState=r.state,s&&Py(e,n,!0),e.child}function U1(t){var e=t.stateNode;e.pendingContext?Ay(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Ay(t,e.context,!1),Fg(t,e.containerInfo)}function Yy(t,e,n,r,s){return Ho(),Lg(s),e.flags|=256,Cn(t,e,n,r),e.child}var _p={dehydrated:null,treeContext:null,retryLane:0};function bp(t){return{baseLanes:t,cachePool:null,transitions:null}}function B1(t,e,n){var r=e.pendingProps,s=Bt.current,i=!1,o=(e.flags&128)!==0,l;if((l=o)||(l=t!==null&&t.memoizedState===null?!1:(s&2)!==0),l?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),Dt(Bt,s&1),t===null)return hp(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=Bu(o,r,0,null),t=Pi(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=bp(n),e.memoizedState=_p,t):Yg(e,o));if(s=t.memoizedState,s!==null&&(l=s.dehydrated,l!==null))return zI(t,e,o,r,l,s,n);if(i){i=r.fallback,o=e.mode,s=t.child,l=s.sibling;var c={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=Ks(s,c),r.subtreeFlags=s.subtreeFlags&14680064),l!==null?i=Ks(l,i):(i=Pi(i,o,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=t.child.memoizedState,o=o===null?bp(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=t.childLanes&~n,e.memoizedState=_p,r}return i=t.child,t=i.sibling,r=Ks(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function Yg(t,e){return e=Bu({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Xc(t,e,n,r){return r!==null&&Lg(r),Wo(e,t.child,null,n),t=Yg(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function zI(t,e,n,r,s,i,o){if(n)return e.flags&256?(e.flags&=-257,r=yh(Error(fe(422))),Xc(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=Bu({mode:"visible",children:r.children},s,0,null),i=Pi(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&Wo(e,t.child,null,o),e.child.memoizedState=bp(o),e.memoizedState=_p,i);if(!(e.mode&1))return Xc(t,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var l=r.dgst;return r=l,i=Error(fe(419)),r=yh(i,r,void 0),Xc(t,e,o,r)}if(l=(o&t.childLanes)!==0,Fn||l){if(r=ln,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,us(t,s),Ir(r,t,s,-1))}return Zg(),r=yh(Error(fe(421))),Xc(t,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=tT.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,Kn=Ws(s.nextSibling),Xn=e,$t=!0,xr=null,t!==null&&(sr[ir++]=ts,sr[ir++]=ns,sr[ir++]=Li,ts=t.id,ns=t.overflow,Li=e),e=Yg(e,r.children),e.flags|=4096,e)}function Ky(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),pp(t.return,e,n)}function vh(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function z1(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(Cn(t,e,r.children,n),r=Bt.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Ky(t,n,e);else if(t.tag===19)Ky(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(Dt(Bt,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&Jd(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),vh(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&Jd(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}vh(e,!0,n,null,i);break;case"together":vh(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function yd(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function fs(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Mi|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(fe(153));if(e.child!==null){for(t=e.child,n=Ks(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Ks(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function HI(t,e,n){switch(e.tag){case 3:U1(e),Ho();break;case 5:p1(e);break;case 1:Hn(e.type)&&Wd(e);break;case 4:Fg(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;Dt(Yd,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Dt(Bt,Bt.current&1),e.flags|=128,null):n&e.child.childLanes?B1(t,e,n):(Dt(Bt,Bt.current&1),t=fs(t,e,n),t!==null?t.sibling:null);Dt(Bt,Bt.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return z1(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Dt(Bt,Bt.current),r)break;return null;case 22:case 23:return e.lanes=0,$1(t,e,n)}return fs(t,e,n)}var H1,Ep,W1,G1;H1=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Ep=function(){};W1=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,ki(zr.current);var i=null;switch(n){case"input":s=Wh(t,s),r=Wh(t,r),i=[];break;case"select":s=Gt({},s,{value:void 0}),r=Gt({},r,{value:void 0}),i=[];break;case"textarea":s=Yh(t,s),r=Yh(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=zd)}Xh(n,r);var o;n=null;for(d in s)if(!r.hasOwnProperty(d)&&s.hasOwnProperty(d)&&s[d]!=null)if(d==="style"){var l=s[d];for(o in l)l.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(pl.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in r){var c=r[d];if(l=s!=null?s[d]:void 0,r.hasOwnProperty(d)&&c!==l&&(c!=null||l!=null))if(d==="style")if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(i||(i=[]),i.push(d,n)),n=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(i=i||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(pl.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&Mt("scroll",t),i||l===c||(i=[])):(i=i||[]).push(d,c))}n&&(i=i||[]).push("style",n);var d=i;(e.updateQueue=d)&&(e.flags|=4)}};G1=function(t,e,n,r){n!==r&&(e.flags|=4)};function La(t,e){if(!$t)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function xn(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function WI(t,e,n){var r=e.pendingProps;switch(Og(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return xn(e),null;case 1:return Hn(e.type)&&Hd(),xn(e),null;case 3:return r=e.stateNode,Go(),Nt(zn),Nt(En),Bg(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(Yc(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,xr!==null&&(Ap(xr),xr=null))),Ep(t,e),xn(e),null;case 5:Ug(e);var s=ki(Tl.current);if(n=e.type,t!==null&&e.stateNode!=null)W1(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(fe(166));return xn(e),null}if(t=ki(zr.current),Yc(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[jr]=e,r[wl]=i,t=(e.mode&1)!==0,n){case"dialog":Mt("cancel",r),Mt("close",r);break;case"iframe":case"object":case"embed":Mt("load",r);break;case"video":case"audio":for(s=0;s<Wa.length;s++)Mt(Wa[s],r);break;case"source":Mt("error",r);break;case"img":case"image":case"link":Mt("error",r),Mt("load",r);break;case"details":Mt("toggle",r);break;case"input":ry(r,i),Mt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Mt("invalid",r);break;case"textarea":iy(r,i),Mt("invalid",r)}Xh(n,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var l=i[o];o==="children"?typeof l=="string"?r.textContent!==l&&(i.suppressHydrationWarning!==!0&&Vc(r.textContent,l,t),s=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(i.suppressHydrationWarning!==!0&&Vc(r.textContent,l,t),s=["children",""+l]):pl.hasOwnProperty(o)&&l!=null&&o==="onScroll"&&Mt("scroll",r)}switch(n){case"input":$c(r),sy(r,i,!0);break;case"textarea":$c(r),oy(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=zd)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=x_(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[jr]=e,t[wl]=r,H1(t,e,!1,!1),e.stateNode=t;e:{switch(o=Jh(n,r),n){case"dialog":Mt("cancel",t),Mt("close",t),s=r;break;case"iframe":case"object":case"embed":Mt("load",t),s=r;break;case"video":case"audio":for(s=0;s<Wa.length;s++)Mt(Wa[s],t);s=r;break;case"source":Mt("error",t),s=r;break;case"img":case"image":case"link":Mt("error",t),Mt("load",t),s=r;break;case"details":Mt("toggle",t),s=r;break;case"input":ry(t,r),s=Wh(t,r),Mt("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=Gt({},r,{value:void 0}),Mt("invalid",t);break;case"textarea":iy(t,r),s=Yh(t,r),Mt("invalid",t);break;default:s=r}Xh(n,s),l=s;for(i in l)if(l.hasOwnProperty(i)){var c=l[i];i==="style"?E_(t,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&__(t,c)):i==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&gl(t,c):typeof c=="number"&&gl(t,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(pl.hasOwnProperty(i)?c!=null&&i==="onScroll"&&Mt("scroll",t):c!=null&&yg(t,i,c,o))}switch(n){case"input":$c(t),sy(t,r,!1);break;case"textarea":$c(t),oy(t);break;case"option":r.value!=null&&t.setAttribute("value",""+ti(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?Ro(t,!!r.multiple,i,!1):r.defaultValue!=null&&Ro(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=zd)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return xn(e),null;case 6:if(t&&e.stateNode!=null)G1(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(fe(166));if(n=ki(Tl.current),ki(zr.current),Yc(e)){if(r=e.stateNode,n=e.memoizedProps,r[jr]=e,(i=r.nodeValue!==n)&&(t=Xn,t!==null))switch(t.tag){case 3:Vc(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Vc(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[jr]=e,e.stateNode=r}return xn(e),null;case 13:if(Nt(Bt),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if($t&&Kn!==null&&e.mode&1&&!(e.flags&128))c1(),Ho(),e.flags|=98560,i=!1;else if(i=Yc(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(fe(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(fe(317));i[jr]=e}else Ho(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;xn(e),i=!1}else xr!==null&&(Ap(xr),xr=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||Bt.current&1?tn===0&&(tn=3):Zg())),e.updateQueue!==null&&(e.flags|=4),xn(e),null);case 4:return Go(),Ep(t,e),t===null&&El(e.stateNode.containerInfo),xn(e),null;case 10:return Ng(e.type._context),xn(e),null;case 17:return Hn(e.type)&&Hd(),xn(e),null;case 19:if(Nt(Bt),i=e.memoizedState,i===null)return xn(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)La(i,!1);else{if(tn!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=Jd(t),o!==null){for(e.flags|=128,La(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,t=o.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Dt(Bt,Bt.current&1|2),e.child}t=t.sibling}i.tail!==null&&Kt()>Yo&&(e.flags|=128,r=!0,La(i,!1),e.lanes=4194304)}else{if(!r)if(t=Jd(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),La(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!$t)return xn(e),null}else 2*Kt()-i.renderingStartTime>Yo&&n!==1073741824&&(e.flags|=128,r=!0,La(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(n=i.last,n!==null?n.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Kt(),e.sibling=null,n=Bt.current,Dt(Bt,r?n&1|2:n&1),e):(xn(e),null);case 22:case 23:return qg(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Yn&1073741824&&(xn(e),e.subtreeFlags&6&&(e.flags|=8192)):xn(e),null;case 24:return null;case 25:return null}throw Error(fe(156,e.tag))}function GI(t,e){switch(Og(e),e.tag){case 1:return Hn(e.type)&&Hd(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Go(),Nt(zn),Nt(En),Bg(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Ug(e),null;case 13:if(Nt(Bt),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(fe(340));Ho()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Nt(Bt),null;case 4:return Go(),null;case 10:return Ng(e.type._context),null;case 22:case 23:return qg(),null;case 24:return null;default:return null}}var Jc=!1,bn=!1,VI=typeof WeakSet=="function"?WeakSet:Set,we=null;function Io(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){Yt(t,e,r)}else n.current=null}function Sp(t,e,n){try{n()}catch(r){Yt(t,e,r)}}var Xy=!1;function YI(t,e){if(op=Fd,t=J_(),Ag(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var o=0,l=-1,c=-1,d=0,u=0,p=t,f=null;t:for(;;){for(var S;p!==n||s!==0&&p.nodeType!==3||(l=o+s),p!==i||r!==0&&p.nodeType!==3||(c=o+r),p.nodeType===3&&(o+=p.nodeValue.length),(S=p.firstChild)!==null;)f=p,p=S;for(;;){if(p===t)break t;if(f===n&&++d===s&&(l=o),f===i&&++u===r&&(c=o),(S=p.nextSibling)!==null)break;p=f,f=p.parentNode}p=S}n=l===-1||c===-1?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(ap={focusedElem:t,selectionRange:n},Fd=!1,we=e;we!==null;)if(e=we,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,we=t;else for(;we!==null;){e=we;try{var R=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(R!==null){var C=R.memoizedProps,j=R.memoizedState,_=e.stateNode,v=_.getSnapshotBeforeUpdate(e.elementType===e.type?C:yr(e.type,C),j);_.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var w=e.stateNode.containerInfo;w.nodeType===1?w.textContent="":w.nodeType===9&&w.documentElement&&w.removeChild(w.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(fe(163))}}catch(h){Yt(e,e.return,h)}if(t=e.sibling,t!==null){t.return=e.return,we=t;break}we=e.return}return R=Xy,Xy=!1,R}function el(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&Sp(e,n,i)}s=s.next}while(s!==r)}}function Fu(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function wp(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function V1(t){var e=t.alternate;e!==null&&(t.alternate=null,V1(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[jr],delete e[wl],delete e[dp],delete e[RI],delete e[AI])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function Y1(t){return t.tag===5||t.tag===3||t.tag===4}function Jy(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Y1(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Ip(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=zd));else if(r!==4&&(t=t.child,t!==null))for(Ip(t,e,n),t=t.sibling;t!==null;)Ip(t,e,n),t=t.sibling}function Tp(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Tp(t,e,n),t=t.sibling;t!==null;)Tp(t,e,n),t=t.sibling}var hn=null,vr=!1;function Ts(t,e,n){for(n=n.child;n!==null;)K1(t,e,n),n=n.sibling}function K1(t,e,n){if(Br&&typeof Br.onCommitFiberUnmount=="function")try{Br.onCommitFiberUnmount(Pu,n)}catch{}switch(n.tag){case 5:bn||Io(n,e);case 6:var r=hn,s=vr;hn=null,Ts(t,e,n),hn=r,vr=s,hn!==null&&(vr?(t=hn,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):hn.removeChild(n.stateNode));break;case 18:hn!==null&&(vr?(t=hn,n=n.stateNode,t.nodeType===8?uh(t.parentNode,n):t.nodeType===1&&uh(t,n),xl(t)):uh(hn,n.stateNode));break;case 4:r=hn,s=vr,hn=n.stateNode.containerInfo,vr=!0,Ts(t,e,n),hn=r,vr=s;break;case 0:case 11:case 14:case 15:if(!bn&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&Sp(n,e,o),s=s.next}while(s!==r)}Ts(t,e,n);break;case 1:if(!bn&&(Io(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(l){Yt(n,e,l)}Ts(t,e,n);break;case 21:Ts(t,e,n);break;case 22:n.mode&1?(bn=(r=bn)||n.memoizedState!==null,Ts(t,e,n),bn=r):Ts(t,e,n);break;default:Ts(t,e,n)}}function Qy(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new VI),e.forEach(function(r){var s=nT.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function mr(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,o=e,l=o;e:for(;l!==null;){switch(l.tag){case 5:hn=l.stateNode,vr=!1;break e;case 3:hn=l.stateNode.containerInfo,vr=!0;break e;case 4:hn=l.stateNode.containerInfo,vr=!0;break e}l=l.return}if(hn===null)throw Error(fe(160));K1(i,o,s),hn=null,vr=!1;var c=s.alternate;c!==null&&(c.return=null),s.return=null}catch(d){Yt(s,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)X1(e,t),e=e.sibling}function X1(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(mr(e,t),Mr(t),r&4){try{el(3,t,t.return),Fu(3,t)}catch(C){Yt(t,t.return,C)}try{el(5,t,t.return)}catch(C){Yt(t,t.return,C)}}break;case 1:mr(e,t),Mr(t),r&512&&n!==null&&Io(n,n.return);break;case 5:if(mr(e,t),Mr(t),r&512&&n!==null&&Io(n,n.return),t.flags&32){var s=t.stateNode;try{gl(s,"")}catch(C){Yt(t,t.return,C)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,o=n!==null?n.memoizedProps:i,l=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{l==="input"&&i.type==="radio"&&i.name!=null&&y_(s,i),Jh(l,o);var d=Jh(l,i);for(o=0;o<c.length;o+=2){var u=c[o],p=c[o+1];u==="style"?E_(s,p):u==="dangerouslySetInnerHTML"?__(s,p):u==="children"?gl(s,p):yg(s,u,p,d)}switch(l){case"input":Gh(s,i);break;case"textarea":v_(s,i);break;case"select":var f=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var S=i.value;S!=null?Ro(s,!!i.multiple,S,!1):f!==!!i.multiple&&(i.defaultValue!=null?Ro(s,!!i.multiple,i.defaultValue,!0):Ro(s,!!i.multiple,i.multiple?[]:"",!1))}s[wl]=i}catch(C){Yt(t,t.return,C)}}break;case 6:if(mr(e,t),Mr(t),r&4){if(t.stateNode===null)throw Error(fe(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(C){Yt(t,t.return,C)}}break;case 3:if(mr(e,t),Mr(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{xl(e.containerInfo)}catch(C){Yt(t,t.return,C)}break;case 4:mr(e,t),Mr(t);break;case 13:mr(e,t),Mr(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(Jg=Kt())),r&4&&Qy(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(bn=(d=bn)||u,mr(e,t),bn=d):mr(e,t),Mr(t),r&8192){if(d=t.memoizedState!==null,(t.stateNode.isHidden=d)&&!u&&t.mode&1)for(we=t,u=t.child;u!==null;){for(p=we=u;we!==null;){switch(f=we,S=f.child,f.tag){case 0:case 11:case 14:case 15:el(4,f,f.return);break;case 1:Io(f,f.return);var R=f.stateNode;if(typeof R.componentWillUnmount=="function"){r=f,n=f.return;try{e=r,R.props=e.memoizedProps,R.state=e.memoizedState,R.componentWillUnmount()}catch(C){Yt(r,n,C)}}break;case 5:Io(f,f.return);break;case 22:if(f.memoizedState!==null){Zy(p);continue}}S!==null?(S.return=f,we=S):Zy(p)}u=u.sibling}e:for(u=null,p=t;;){if(p.tag===5){if(u===null){u=p;try{s=p.stateNode,d?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(l=p.stateNode,c=p.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=b_("display",o))}catch(C){Yt(t,t.return,C)}}}else if(p.tag===6){if(u===null)try{p.stateNode.nodeValue=d?"":p.memoizedProps}catch(C){Yt(t,t.return,C)}}else if((p.tag!==22&&p.tag!==23||p.memoizedState===null||p===t)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===t)break e;for(;p.sibling===null;){if(p.return===null||p.return===t)break e;u===p&&(u=null),p=p.return}u===p&&(u=null),p.sibling.return=p.return,p=p.sibling}}break;case 19:mr(e,t),Mr(t),r&4&&Qy(t);break;case 21:break;default:mr(e,t),Mr(t)}}function Mr(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(Y1(n)){var r=n;break e}n=n.return}throw Error(fe(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(gl(s,""),r.flags&=-33);var i=Jy(t);Tp(t,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,l=Jy(t);Ip(t,l,o);break;default:throw Error(fe(161))}}catch(c){Yt(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function KI(t,e,n){we=t,J1(t)}function J1(t,e,n){for(var r=(t.mode&1)!==0;we!==null;){var s=we,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||Jc;if(!o){var l=s.alternate,c=l!==null&&l.memoizedState!==null||bn;l=Jc;var d=bn;if(Jc=o,(bn=c)&&!d)for(we=s;we!==null;)o=we,c=o.child,o.tag===22&&o.memoizedState!==null?ev(s):c!==null?(c.return=o,we=c):ev(s);for(;i!==null;)we=i,J1(i),i=i.sibling;we=s,Jc=l,bn=d}qy(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,we=i):qy(t)}}function qy(t){for(;we!==null;){var e=we;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:bn||Fu(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!bn)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:yr(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&Ny(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Ny(e,o,n)}break;case 5:var l=e.stateNode;if(n===null&&e.flags&4){n=l;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var u=d.memoizedState;if(u!==null){var p=u.dehydrated;p!==null&&xl(p)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(fe(163))}bn||e.flags&512&&wp(e)}catch(f){Yt(e,e.return,f)}}if(e===t){we=null;break}if(n=e.sibling,n!==null){n.return=e.return,we=n;break}we=e.return}}function Zy(t){for(;we!==null;){var e=we;if(e===t){we=null;break}var n=e.sibling;if(n!==null){n.return=e.return,we=n;break}we=e.return}}function ev(t){for(;we!==null;){var e=we;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Fu(4,e)}catch(c){Yt(e,n,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(c){Yt(e,s,c)}}var i=e.return;try{wp(e)}catch(c){Yt(e,i,c)}break;case 5:var o=e.return;try{wp(e)}catch(c){Yt(e,o,c)}}}catch(c){Yt(e,e.return,c)}if(e===t){we=null;break}var l=e.sibling;if(l!==null){l.return=e.return,we=l;break}we=e.return}}var XI=Math.ceil,Zd=ms.ReactCurrentDispatcher,Kg=ms.ReactCurrentOwner,cr=ms.ReactCurrentBatchConfig,yt=0,ln=null,Qt=null,pn=0,Yn=0,To=ci(0),tn=0,Al=null,Mi=0,Uu=0,Xg=0,tl=null,jn=null,Jg=0,Yo=1/0,Qr=null,eu=!1,Cp=null,Vs=null,Qc=!1,js=null,tu=0,nl=0,kp=null,vd=-1,xd=0;function Rn(){return yt&6?Kt():vd!==-1?vd:vd=Kt()}function Ys(t){return t.mode&1?yt&2&&pn!==0?pn&-pn:OI.transition!==null?(xd===0&&(xd=D_()),xd):(t=It,t!==0||(t=window.event,t=t===void 0?16:B_(t.type)),t):1}function Ir(t,e,n,r){if(50<nl)throw nl=0,kp=null,Error(fe(185));Vl(t,n,r),(!(yt&2)||t!==ln)&&(t===ln&&(!(yt&2)&&(Uu|=n),tn===4&&Ps(t,pn)),Wn(t,r),n===1&&yt===0&&!(e.mode&1)&&(Yo=Kt()+500,Nu&&di()))}function Wn(t,e){var n=t.callbackNode;Ow(t,e);var r=$d(t,t===ln?pn:0);if(r===0)n!==null&&cy(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&cy(n),e===1)t.tag===0?PI(tv.bind(null,t)):o1(tv.bind(null,t)),CI(function(){!(yt&6)&&di()}),n=null;else{switch(M_(r)){case 1:n=Eg;break;case 4:n=O_;break;case 16:n=jd;break;case 536870912:n=L_;break;default:n=jd}n=sb(n,Q1.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function Q1(t,e){if(vd=-1,xd=0,yt&6)throw Error(fe(327));var n=t.callbackNode;if(Do()&&t.callbackNode!==n)return null;var r=$d(t,t===ln?pn:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=nu(t,r);else{e=r;var s=yt;yt|=2;var i=Z1();(ln!==t||pn!==e)&&(Qr=null,Yo=Kt()+500,Ai(t,e));do try{qI();break}catch(l){q1(t,l)}while(!0);Mg(),Zd.current=i,yt=s,Qt!==null?e=0:(ln=null,pn=0,e=tn)}if(e!==0){if(e===2&&(s=tp(t),s!==0&&(r=s,e=Rp(t,s))),e===1)throw n=Al,Ai(t,0),Ps(t,r),Wn(t,Kt()),n;if(e===6)Ps(t,r);else{if(s=t.current.alternate,!(r&30)&&!JI(s)&&(e=nu(t,r),e===2&&(i=tp(t),i!==0&&(r=i,e=Rp(t,i))),e===1))throw n=Al,Ai(t,0),Ps(t,r),Wn(t,Kt()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(fe(345));case 2:Ei(t,jn,Qr);break;case 3:if(Ps(t,r),(r&130023424)===r&&(e=Jg+500-Kt(),10<e)){if($d(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){Rn(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=cp(Ei.bind(null,t,jn,Qr),e);break}Ei(t,jn,Qr);break;case 4:if(Ps(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var o=31-wr(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=Kt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*XI(r/1960))-r,10<r){t.timeoutHandle=cp(Ei.bind(null,t,jn,Qr),r);break}Ei(t,jn,Qr);break;case 5:Ei(t,jn,Qr);break;default:throw Error(fe(329))}}}return Wn(t,Kt()),t.callbackNode===n?Q1.bind(null,t):null}function Rp(t,e){var n=tl;return t.current.memoizedState.isDehydrated&&(Ai(t,e).flags|=256),t=nu(t,e),t!==2&&(e=jn,jn=n,e!==null&&Ap(e)),t}function Ap(t){jn===null?jn=t:jn.push.apply(jn,t)}function JI(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!Cr(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Ps(t,e){for(e&=~Xg,e&=~Uu,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-wr(e),r=1<<n;t[n]=-1,e&=~r}}function tv(t){if(yt&6)throw Error(fe(327));Do();var e=$d(t,0);if(!(e&1))return Wn(t,Kt()),null;var n=nu(t,e);if(t.tag!==0&&n===2){var r=tp(t);r!==0&&(e=r,n=Rp(t,r))}if(n===1)throw n=Al,Ai(t,0),Ps(t,e),Wn(t,Kt()),n;if(n===6)throw Error(fe(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Ei(t,jn,Qr),Wn(t,Kt()),null}function Qg(t,e){var n=yt;yt|=1;try{return t(e)}finally{yt=n,yt===0&&(Yo=Kt()+500,Nu&&di())}}function Ni(t){js!==null&&js.tag===0&&!(yt&6)&&Do();var e=yt;yt|=1;var n=cr.transition,r=It;try{if(cr.transition=null,It=1,t)return t()}finally{It=r,cr.transition=n,yt=e,!(yt&6)&&di()}}function qg(){Yn=To.current,Nt(To)}function Ai(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,TI(n)),Qt!==null)for(n=Qt.return;n!==null;){var r=n;switch(Og(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Hd();break;case 3:Go(),Nt(zn),Nt(En),Bg();break;case 5:Ug(r);break;case 4:Go();break;case 13:Nt(Bt);break;case 19:Nt(Bt);break;case 10:Ng(r.type._context);break;case 22:case 23:qg()}n=n.return}if(ln=t,Qt=t=Ks(t.current,null),pn=Yn=e,tn=0,Al=null,Xg=Uu=Mi=0,jn=tl=null,Ci!==null){for(e=0;e<Ci.length;e++)if(n=Ci[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}n.pending=r}Ci=null}return t}function q1(t,e){do{var n=Qt;try{if(Mg(),gd.current=qd,Qd){for(var r=Wt.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Qd=!1}if(Di=0,sn=Zt=Wt=null,Za=!1,Cl=0,Kg.current=null,n===null||n.return===null){tn=1,Al=e,Qt=null;break}e:{var i=t,o=n.return,l=n,c=e;if(e=pn,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,u=l,p=u.tag;if(!(u.mode&1)&&(p===0||p===11||p===15)){var f=u.alternate;f?(u.updateQueue=f.updateQueue,u.memoizedState=f.memoizedState,u.lanes=f.lanes):(u.updateQueue=null,u.memoizedState=null)}var S=zy(o);if(S!==null){S.flags&=-257,Hy(S,o,l,i,e),S.mode&1&&By(i,d,e),e=S,c=d;var R=e.updateQueue;if(R===null){var C=new Set;C.add(c),e.updateQueue=C}else R.add(c);break e}else{if(!(e&1)){By(i,d,e),Zg();break e}c=Error(fe(426))}}else if($t&&l.mode&1){var j=zy(o);if(j!==null){!(j.flags&65536)&&(j.flags|=256),Hy(j,o,l,i,e),Lg(Vo(c,l));break e}}i=c=Vo(c,l),tn!==4&&(tn=2),tl===null?tl=[i]:tl.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var _=M1(i,c,e);My(i,_);break e;case 1:l=c;var v=i.type,w=i.stateNode;if(!(i.flags&128)&&(typeof v.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(Vs===null||!Vs.has(w)))){i.flags|=65536,e&=-e,i.lanes|=e;var h=N1(i,l,e);My(i,h);break e}}i=i.return}while(i!==null)}tb(n)}catch(D){e=D,Qt===n&&n!==null&&(Qt=n=n.return);continue}break}while(!0)}function Z1(){var t=Zd.current;return Zd.current=qd,t===null?qd:t}function Zg(){(tn===0||tn===3||tn===2)&&(tn=4),ln===null||!(Mi&268435455)&&!(Uu&268435455)||Ps(ln,pn)}function nu(t,e){var n=yt;yt|=2;var r=Z1();(ln!==t||pn!==e)&&(Qr=null,Ai(t,e));do try{QI();break}catch(s){q1(t,s)}while(!0);if(Mg(),yt=n,Zd.current=r,Qt!==null)throw Error(fe(261));return ln=null,pn=0,tn}function QI(){for(;Qt!==null;)eb(Qt)}function qI(){for(;Qt!==null&&!Sw();)eb(Qt)}function eb(t){var e=rb(t.alternate,t,Yn);t.memoizedProps=t.pendingProps,e===null?tb(t):Qt=e,Kg.current=null}function tb(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=GI(n,e),n!==null){n.flags&=32767,Qt=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{tn=6,Qt=null;return}}else if(n=WI(n,e,Yn),n!==null){Qt=n;return}if(e=e.sibling,e!==null){Qt=e;return}Qt=e=t}while(e!==null);tn===0&&(tn=5)}function Ei(t,e,n){var r=It,s=cr.transition;try{cr.transition=null,It=1,ZI(t,e,n,r)}finally{cr.transition=s,It=r}return null}function ZI(t,e,n,r){do Do();while(js!==null);if(yt&6)throw Error(fe(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(fe(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(Lw(t,i),t===ln&&(Qt=ln=null,pn=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Qc||(Qc=!0,sb(jd,function(){return Do(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=cr.transition,cr.transition=null;var o=It;It=1;var l=yt;yt|=4,Kg.current=null,YI(t,n),X1(n,t),xI(ap),Fd=!!op,ap=op=null,t.current=n,KI(n),ww(),yt=l,It=o,cr.transition=i}else t.current=n;if(Qc&&(Qc=!1,js=t,tu=s),i=t.pendingLanes,i===0&&(Vs=null),Cw(n.stateNode),Wn(t,Kt()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(eu)throw eu=!1,t=Cp,Cp=null,t;return tu&1&&t.tag!==0&&Do(),i=t.pendingLanes,i&1?t===kp?nl++:(nl=0,kp=t):nl=0,di(),null}function Do(){if(js!==null){var t=M_(tu),e=cr.transition,n=It;try{if(cr.transition=null,It=16>t?16:t,js===null)var r=!1;else{if(t=js,js=null,tu=0,yt&6)throw Error(fe(331));var s=yt;for(yt|=4,we=t.current;we!==null;){var i=we,o=i.child;if(we.flags&16){var l=i.deletions;if(l!==null){for(var c=0;c<l.length;c++){var d=l[c];for(we=d;we!==null;){var u=we;switch(u.tag){case 0:case 11:case 15:el(8,u,i)}var p=u.child;if(p!==null)p.return=u,we=p;else for(;we!==null;){u=we;var f=u.sibling,S=u.return;if(V1(u),u===d){we=null;break}if(f!==null){f.return=S,we=f;break}we=S}}}var R=i.alternate;if(R!==null){var C=R.child;if(C!==null){R.child=null;do{var j=C.sibling;C.sibling=null,C=j}while(C!==null)}}we=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,we=o;else e:for(;we!==null;){if(i=we,i.flags&2048)switch(i.tag){case 0:case 11:case 15:el(9,i,i.return)}var _=i.sibling;if(_!==null){_.return=i.return,we=_;break e}we=i.return}}var v=t.current;for(we=v;we!==null;){o=we;var w=o.child;if(o.subtreeFlags&2064&&w!==null)w.return=o,we=w;else e:for(o=v;we!==null;){if(l=we,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:Fu(9,l)}}catch(D){Yt(l,l.return,D)}if(l===o){we=null;break e}var h=l.sibling;if(h!==null){h.return=l.return,we=h;break e}we=l.return}}if(yt=s,di(),Br&&typeof Br.onPostCommitFiberRoot=="function")try{Br.onPostCommitFiberRoot(Pu,t)}catch{}r=!0}return r}finally{It=n,cr.transition=e}}return!1}function nv(t,e,n){e=Vo(n,e),e=M1(t,e,1),t=Gs(t,e,1),e=Rn(),t!==null&&(Vl(t,1,e),Wn(t,e))}function Yt(t,e,n){if(t.tag===3)nv(t,t,n);else for(;e!==null;){if(e.tag===3){nv(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Vs===null||!Vs.has(r))){t=Vo(n,t),t=N1(e,t,1),e=Gs(e,t,1),t=Rn(),e!==null&&(Vl(e,1,t),Wn(e,t));break}}e=e.return}}function eT(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=Rn(),t.pingedLanes|=t.suspendedLanes&n,ln===t&&(pn&n)===n&&(tn===4||tn===3&&(pn&130023424)===pn&&500>Kt()-Jg?Ai(t,0):Xg|=n),Wn(t,e)}function nb(t,e){e===0&&(t.mode&1?(e=Bc,Bc<<=1,!(Bc&130023424)&&(Bc=4194304)):e=1);var n=Rn();t=us(t,e),t!==null&&(Vl(t,e,n),Wn(t,n))}function tT(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),nb(t,n)}function nT(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(fe(314))}r!==null&&r.delete(e),nb(t,n)}var rb;rb=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||zn.current)Fn=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Fn=!1,HI(t,e,n);Fn=!!(t.flags&131072)}else Fn=!1,$t&&e.flags&1048576&&a1(e,Vd,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;yd(t,e),t=e.pendingProps;var s=zo(e,En.current);Lo(e,n),s=Hg(null,e,r,t,s,n);var i=Wg();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Hn(r)?(i=!0,Wd(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,$g(e),s.updater=$u,e.stateNode=s,s._reactInternals=e,mp(e,r,t,n),e=xp(null,e,r,!0,i,n)):(e.tag=0,$t&&i&&Pg(e),Cn(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(yd(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=sT(r),t=yr(r,t),s){case 0:e=vp(null,e,r,t,n);break e;case 1:e=Vy(null,e,r,t,n);break e;case 11:e=Wy(null,e,r,t,n);break e;case 14:e=Gy(null,e,r,yr(r.type,t),n);break e}throw Error(fe(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:yr(r,s),vp(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:yr(r,s),Vy(t,e,r,s,n);case 3:e:{if(U1(e),t===null)throw Error(fe(387));r=e.pendingProps,i=e.memoizedState,s=i.element,h1(t,e),Xd(e,r,null,n);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=Vo(Error(fe(423)),e),e=Yy(t,e,r,n,s);break e}else if(r!==s){s=Vo(Error(fe(424)),e),e=Yy(t,e,r,n,s);break e}else for(Kn=Ws(e.stateNode.containerInfo.firstChild),Xn=e,$t=!0,xr=null,n=u1(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Ho(),r===s){e=fs(t,e,n);break e}Cn(t,e,r,n)}e=e.child}return e;case 5:return p1(e),t===null&&hp(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,o=s.children,lp(r,s)?o=null:i!==null&&lp(r,i)&&(e.flags|=32),F1(t,e),Cn(t,e,o,n),e.child;case 6:return t===null&&hp(e),null;case 13:return B1(t,e,n);case 4:return Fg(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Wo(e,null,r,n):Cn(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:yr(r,s),Wy(t,e,r,s,n);case 7:return Cn(t,e,e.pendingProps,n),e.child;case 8:return Cn(t,e,e.pendingProps.children,n),e.child;case 12:return Cn(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,Dt(Yd,r._currentValue),r._currentValue=o,i!==null)if(Cr(i.value,o)){if(i.children===s.children&&!zn.current){e=fs(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var l=i.dependencies;if(l!==null){o=i.child;for(var c=l.firstContext;c!==null;){if(c.context===r){if(i.tag===1){c=os(-1,n&-n),c.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var u=d.pending;u===null?c.next=c:(c.next=u.next,u.next=c),d.pending=c}}i.lanes|=n,c=i.alternate,c!==null&&(c.lanes|=n),pp(i.return,n,e),l.lanes|=n;break}c=c.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(fe(341));o.lanes|=n,l=o.alternate,l!==null&&(l.lanes|=n),pp(o,n,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}Cn(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,Lo(e,n),s=dr(s),r=r(s),e.flags|=1,Cn(t,e,r,n),e.child;case 14:return r=e.type,s=yr(r,e.pendingProps),s=yr(r.type,s),Gy(t,e,r,s,n);case 15:return j1(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:yr(r,s),yd(t,e),e.tag=1,Hn(r)?(t=!0,Wd(e)):t=!1,Lo(e,n),D1(e,r,s),mp(e,r,s,n),xp(null,e,r,!0,t,n);case 19:return z1(t,e,n);case 22:return $1(t,e,n)}throw Error(fe(156,e.tag))};function sb(t,e){return P_(t,e)}function rT(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ar(t,e,n,r){return new rT(t,e,n,r)}function e0(t){return t=t.prototype,!(!t||!t.isReactComponent)}function sT(t){if(typeof t=="function")return e0(t)?1:0;if(t!=null){if(t=t.$$typeof,t===xg)return 11;if(t===_g)return 14}return 2}function Ks(t,e){var n=t.alternate;return n===null?(n=ar(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function _d(t,e,n,r,s,i){var o=2;if(r=t,typeof t=="function")e0(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case mo:return Pi(n.children,s,i,e);case vg:o=8,s|=8;break;case Uh:return t=ar(12,n,e,s|2),t.elementType=Uh,t.lanes=i,t;case Bh:return t=ar(13,n,e,s),t.elementType=Bh,t.lanes=i,t;case zh:return t=ar(19,n,e,s),t.elementType=zh,t.lanes=i,t;case p_:return Bu(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case f_:o=10;break e;case h_:o=9;break e;case xg:o=11;break e;case _g:o=14;break e;case ks:o=16,r=null;break e}throw Error(fe(130,t==null?t:typeof t,""))}return e=ar(o,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function Pi(t,e,n,r){return t=ar(7,t,r,e),t.lanes=n,t}function Bu(t,e,n,r){return t=ar(22,t,r,e),t.elementType=p_,t.lanes=n,t.stateNode={isHidden:!1},t}function xh(t,e,n){return t=ar(6,t,null,e),t.lanes=n,t}function _h(t,e,n){return e=ar(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function iT(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=eh(0),this.expirationTimes=eh(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=eh(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function t0(t,e,n,r,s,i,o,l,c){return t=new iT(t,e,n,l,c),e===1?(e=1,i===!0&&(e|=8)):e=0,i=ar(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},$g(i),t}function oT(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:go,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function ib(t){if(!t)return ni;t=t._reactInternals;e:{if(Gi(t)!==t||t.tag!==1)throw Error(fe(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Hn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(fe(171))}if(t.tag===1){var n=t.type;if(Hn(n))return i1(t,n,e)}return e}function ob(t,e,n,r,s,i,o,l,c){return t=t0(n,r,!0,t,s,i,o,l,c),t.context=ib(null),n=t.current,r=Rn(),s=Ys(n),i=os(r,s),i.callback=e??null,Gs(n,i,s),t.current.lanes=s,Vl(t,s,r),Wn(t,r),t}function zu(t,e,n,r){var s=e.current,i=Rn(),o=Ys(s);return n=ib(n),e.context===null?e.context=n:e.pendingContext=n,e=os(i,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Gs(s,e,o),t!==null&&(Ir(t,s,o,i),pd(t,s,o)),o}function ru(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function rv(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function n0(t,e){rv(t,e),(t=t.alternate)&&rv(t,e)}function aT(){return null}var ab=typeof reportError=="function"?reportError:function(t){console.error(t)};function r0(t){this._internalRoot=t}Hu.prototype.render=r0.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(fe(409));zu(t,e,null,null)};Hu.prototype.unmount=r0.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Ni(function(){zu(null,t,null,null)}),e[ds]=null}};function Hu(t){this._internalRoot=t}Hu.prototype.unstable_scheduleHydration=function(t){if(t){var e=$_();t={blockedOn:null,target:t,priority:e};for(var n=0;n<As.length&&e!==0&&e<As[n].priority;n++);As.splice(n,0,t),n===0&&U_(t)}};function s0(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Wu(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function sv(){}function lT(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var d=ru(o);i.call(d)}}var o=ob(e,r,t,0,null,!1,!1,"",sv);return t._reactRootContainer=o,t[ds]=o.current,El(t.nodeType===8?t.parentNode:t),Ni(),o}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var l=r;r=function(){var d=ru(c);l.call(d)}}var c=t0(t,0,!1,null,null,!1,!1,"",sv);return t._reactRootContainer=c,t[ds]=c.current,El(t.nodeType===8?t.parentNode:t),Ni(function(){zu(e,c,n,r)}),c}function Gu(t,e,n,r,s){var i=n._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var l=s;s=function(){var c=ru(o);l.call(c)}}zu(e,o,t,s)}else o=lT(n,e,t,s,r);return ru(o)}N_=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Ha(e.pendingLanes);n!==0&&(Sg(e,n|1),Wn(e,Kt()),!(yt&6)&&(Yo=Kt()+500,di()))}break;case 13:Ni(function(){var r=us(t,1);if(r!==null){var s=Rn();Ir(r,t,1,s)}}),n0(t,1)}};wg=function(t){if(t.tag===13){var e=us(t,134217728);if(e!==null){var n=Rn();Ir(e,t,134217728,n)}n0(t,134217728)}};j_=function(t){if(t.tag===13){var e=Ys(t),n=us(t,e);if(n!==null){var r=Rn();Ir(n,t,e,r)}n0(t,e)}};$_=function(){return It};F_=function(t,e){var n=It;try{return It=t,e()}finally{It=n}};qh=function(t,e,n){switch(e){case"input":if(Gh(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=Mu(r);if(!s)throw Error(fe(90));m_(r),Gh(r,s)}}}break;case"textarea":v_(t,n);break;case"select":e=n.value,e!=null&&Ro(t,!!n.multiple,e,!1)}};I_=Qg;T_=Ni;var cT={usingClientEntryPoint:!1,Events:[Kl,_o,Mu,S_,w_,Qg]},Da={findFiberByHostInstance:Ti,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},dT={bundleType:Da.bundleType,version:Da.version,rendererPackageName:Da.rendererPackageName,rendererConfig:Da.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ms.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=R_(t),t===null?null:t.stateNode},findFiberByHostInstance:Da.findFiberByHostInstance||aT,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var qc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!qc.isDisabled&&qc.supportsFiber)try{Pu=qc.inject(dT),Br=qc}catch{}}qn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=cT;qn.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!s0(e))throw Error(fe(200));return oT(t,e,null,n)};qn.createRoot=function(t,e){if(!s0(t))throw Error(fe(299));var n=!1,r="",s=ab;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=t0(t,1,!1,null,null,n,!1,r,s),t[ds]=e.current,El(t.nodeType===8?t.parentNode:t),new r0(e)};qn.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(fe(188)):(t=Object.keys(t).join(","),Error(fe(268,t)));return t=R_(e),t=t===null?null:t.stateNode,t};qn.flushSync=function(t){return Ni(t)};qn.hydrate=function(t,e,n){if(!Wu(e))throw Error(fe(200));return Gu(null,t,e,!0,n)};qn.hydrateRoot=function(t,e,n){if(!s0(t))throw Error(fe(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",o=ab;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=ob(e,null,t,1,n??null,s,!1,i,o),t[ds]=e.current,El(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new Hu(e)};qn.render=function(t,e,n){if(!Wu(e))throw Error(fe(200));return Gu(null,t,e,!1,n)};qn.unmountComponentAtNode=function(t){if(!Wu(t))throw Error(fe(40));return t._reactRootContainer?(Ni(function(){Gu(null,null,t,!1,function(){t._reactRootContainer=null,t[ds]=null})}),!0):!1};qn.unstable_batchedUpdates=Qg;qn.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Wu(n))throw Error(fe(200));if(t==null||t._reactInternals===void 0)throw Error(fe(38));return Gu(t,e,n,!1,r)};qn.version="18.3.1-next-f1338f8080-20240426";function lb(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(lb)}catch(t){console.error(t)}}lb(),l_.exports=qn;var uT=l_.exports,iv=uT;$h.createRoot=iv.createRoot,$h.hydrateRoot=iv.hydrateRoot;const ov=20,i0=[{id:1,filename:"1_yoroshiku.png",label:"",se:"pa.mp3"},{id:2,filename:"2_nandato.png",label:"",se:"shock.mp3"},{id:3,filename:"3_thank.png",label:"",se:"thanks.mp3"},{id:4,filename:"4_willwin.png",label:"",se:"nt.mp3"},{id:5,filename:"5_dontmind.png",label:"",se:"boyon.mp3"},{id:6,filename:"6_thinking.png",label:"",se:"thinking.mp3"},{id:7,filename:"7_gg.png",label:"GG",se:"kiri.mp3"},{id:8,filename:"8_sorry.png",label:"",se:"gomen.mp3"}],av=(t,e)=>{const n=i0.find(s=>s.id===t);return n?`/stamps/${e==="AJA"?"azya":e.toLowerCase()}/${n.filename}`:""},lv=t=>{const e=i0.find(n=>n.id===t);return(e==null?void 0:e.se)||null},$n=[{id:"s_3cats",name:"",cost:2,type:"SPELL",description:"1",flavorText:"",imageUrl:"/cards/chatora_three_cats.png",triggers:[{trigger:"FANFARE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_CHATORA"},{type:"GENERATE_CARD",targetCardId:"TOKEN_SABATORA"},{type:"GENERATE_CARD",targetCardId:"TOKEN_KIJITORA"}]}]},{id:"s_final_cannon",name:"",cost:10,type:"SPELL",description:"1",flavorText:'""""',imageUrl:"/cards/final_cannon.png",triggers:[{trigger:"FANFARE",effects:[{type:"SET_MAX_HP",value:1,targetType:"OPPONENT"}]}]},{id:"c_senka_knuckler",name:"",cost:8,type:"FOLLOWER",attack:3,health:5,description:`[] []
2
[]
1`,flavorText:`

`,imageUrl:"/cards/senka.png",evolvedImageUrl:"/cards/senka_2.png",tags:["Knuckler"],passiveAbilities:["STORM","DOUBLE_ATTACK"],attackEffectType:"IMPACT",triggers:[{trigger:"SUPER_EVOLVE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_FLICKER_JAB"},{type:"GENERATE_CARD",targetCardId:"TOKEN_QUAKE_HOWLING"},{type:"GENERATE_CARD",targetCardId:"TOKEN_BACKHAND_SMASH"}]}]},{id:"c_ruiyu",name:"",cost:7,type:"FOLLOWER",attack:5,health:5,description:`4cyoriena
14`,flavorText:`
`,imageUrl:"/cards/ruiyu.png",evolvedImageUrl:"/cards/ruiyu_2.png",attackEffectType:"BLUE_FIRE",relatedCards:["c_cyoriena"],triggers:[{trigger:"FANFARE",effects:[{type:"HEAL_LEADER",value:4,targetType:"SELF"},{type:"SUMMON_CARD",targetCardId:"c_cyoriena"}]},{trigger:"EVOLVE",effects:[{type:"DESTROY",targetType:"SELECT_FOLLOWER"},{type:"HEAL_LEADER",value:4,targetType:"SELF"}]}]},{id:"c_y",name:"Y",cost:6,type:"FOLLOWER",attack:3,health:3,description:`[]
142
3`,flavorText:"",imageUrl:"/cards/y.png",evolvedImageUrl:"/cards/y_2.png",passiveAbilities:["STEALTH"],attackEffectType:"SUMI",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:4,targetType:"SELECT_FOLLOWER"},{type:"AOE_DAMAGE",value:2,targetType:"ALL_FOLLOWERS"}]},{trigger:"EVOLVE",effects:[{type:"AOE_DAMAGE",value:3,targetType:"ALL_FOLLOWERS"}]}]},{id:"c_tsubumaru",name:"",cost:2,type:"FOLLOWER",attack:1,health:3,description:`[]
1
1`,flavorText:`

`,imageUrl:"/cards/tsubumaru.png",evolvedImageUrl:"/cards/tsubumaru_2.png",passiveAbilities:["WARD"],attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"GENERATE_CARD",targetCardId:"s_resignation_proxy"}]}]},{id:"c_barura",name:"",cost:4,type:"FOLLOWER",attack:3,health:4,description:`1
13`,flavorText:`

`,imageUrl:"/cards/barura.png",evolvedImageUrl:"/cards/barura_2.png",attackEffectType:"FIRE",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:3,targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_CHATORA",name:"",cost:0,type:"FOLLOWER",attack:1,health:1,description:"",flavorText:"",imageUrl:"/cards/chatora.png",attackEffectType:"SLASH"},{id:"TOKEN_SABATORA",name:"",cost:1,type:"FOLLOWER",attack:1,health:2,description:"[]",flavorText:"",passiveAbilities:["RUSH"],imageUrl:"/cards/sabatora.png",attackEffectType:"SLASH"},{id:"TOKEN_KIJITORA",name:"",cost:3,type:"FOLLOWER",attack:2,health:3,description:"[]",flavorText:"",passiveAbilities:["WARD"],imageUrl:"/cards/kijitora.png",attackEffectType:"SLASH"},{id:"TOKEN_RICE",name:"",cost:0,type:"SPELL",description:"1",flavorText:" ",imageUrl:"/cards/rice.png",triggers:[{trigger:"FANFARE",effects:[{type:"HEAL_LEADER",value:1,targetType:"SELF"}]}]},{id:"c_yunagi",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:`1
11`,flavorText:`


`,imageUrl:"/cards/yunagi.png",evolvedImageUrl:"/cards/yunagi_2.png",attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:1,targetType:"SELECT_FOLLOWER"},{type:"GENERATE_CARD",targetCardId:"TOKEN_OOMORI_RICE"}]}]},{id:"TOKEN_OOMORI_RICE",name:"",cost:1,type:"SPELL",description:"3",flavorText:"",imageUrl:"/cards/oomoririce.png",tags:["Token"],triggers:[{trigger:"FANFARE",effects:[{type:"HEAL_LEADER",value:3,targetType:"SELF"}]}]},{id:"c_nayuta",name:"",cost:4,type:"FOLLOWER",attack:3,health:3,description:`[]
1
1`,flavorText:"",imageUrl:"/cards/nayuta.png",evolvedImageUrl:"/cards/nayuta_2.png",attackEffectType:"RAY",passiveAbilities:["WARD"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]},{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]}]},{id:"c_yunagi_ward",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:`[]
1`,imageUrl:"/cards/yunagi.png",evolvedImageUrl:"/cards/yunagi_2.png",passiveAbilities:["WARD"],triggers:[{trigger:"FANFARE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_RICE"}]}]},{id:"c_nayuta_ward",name:"",cost:4,type:"FOLLOWER",attack:3,health:3,description:`[]
1
1`,imageUrl:"/cards/nayuta.png",evolvedImageUrl:"/cards/nayuta_2.png",passiveAbilities:["WARD"],attackEffectType:"RAY",triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]},{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]}]},{id:"c_azya",name:"",cost:8,type:"FOLLOWER",attack:4,health:4,description:`[]
3211-2
1+1/+2[][]0`,flavorText:`
&&`,imageUrl:"/cards/azya.png",evolvedImageUrl:"/cards/azya_2.png",attackEffectType:"THUNDER",passiveAbilities:["AURA"],relatedCards:["c_tsubumaru","c_yunagi","c_nayuta"],triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:3,targetType:"OPPONENT"},{type:"HEAL_LEADER",value:2,targetType:"SELF"},{type:"RANDOM_DESTROY",value:1},{type:"RANDOM_BOUNCE",value:1},{type:"REDUCE_HAND_COST",value:2,conditions:{nameIn:["","",""]}}]},{trigger:"SUPER_EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_tsubumaru"},{type:"SUMMON_CARD",targetCardId:"c_yunagi"},{type:"SUMMON_CARD",targetCardId:"c_nayuta"},{type:"BUFF_STATS",value:1,value2:2,targetType:"ALL_OTHER_FOLLOWERS"},{type:"GRANT_PASSIVE",targetPassive:"WARD",targetType:"ALL_OTHER_FOLLOWERS"},{type:"GRANT_PASSIVE",targetPassive:"RUSH",targetType:"ALL_OTHER_FOLLOWERS"},{type:"GENERATE_CARD",targetCardId:"s_yucho_of_the_abyss"},{type:"GENERATE_CARD",targetCardId:"s_thats_mine"},{type:"GRANT_LEADER_DAMAGE_SHIELD"}]}]},{id:"c_yuki",name:"",cost:3,type:"FOLLOWER",attack:3,health:2,description:`[]
+1/+1`,flavorText:"",imageUrl:"/cards/yuki.png",evolvedImageUrl:"/cards/yuki_2.png",tags:["Knuckler"],passiveAbilities:["RUSH"],attackEffectType:"IMPACT",triggers:[{trigger:"EVOLVE",effects:[{type:"BUFF_STATS",value:1,value2:1,targetType:"ALL_FOLLOWERS"}]}]},{id:"c_white_tsubaki",name:"",cost:4,type:"FOLLOWER",attack:4,health:3,description:`[]

01
1`,flavorText:`
`,imageUrl:"/cards/white_tsubaki.png",evolvedImageUrl:"/cards/white_tsubaki_2.png",tags:["Knuckler"],passiveAbilities:["RUSH","IMMUNE_TO_FOLLOWER_DAMAGE","GUTS_MY_TURN"],attackEffectType:"ICE",relatedCards:["c_shieko"],triggers:[{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_shieko"}]}]},{id:"c_shieko",name:"",cost:2,type:"FOLLOWER",attack:2,health:1,description:`[]
1+2/+2`,flavorText:`
`,imageUrl:"/cards/shieko.png",evolvedImageUrl:"/cards/shieko_2.png",tags:["Knuckler"],passiveAbilities:["RUSH"],attackEffectType:"IMPACT",triggers:[{trigger:"EVOLVE",effects:[{type:"BUFF_STATS",value:2,value2:2,targetType:"SELECT_OTHER_ALLY_FOLLOWER"}]}]},{id:"c_urara",name:"",cost:3,type:"FOLLOWER",attack:2,health:2,description:`[] []
2`,flavorText:`
`,imageUrl:"/cards/urara.png",evolvedImageUrl:"/cards/urara_2.png",passiveAbilities:["WARD","BARRIER"],attackEffectType:"WATER",triggers:[{trigger:"EVOLVE",effects:[{type:"HEAL_LEADER",value:2}]}]},{id:"c_kasuga",name:"",cost:10,type:"FOLLOWER",attack:8,health:8,description:"",flavorText:`

`,imageUrl:"/cards/kasuga.png",evolvedImageUrl:"/cards/kasuga_2.png",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY",targetType:"ALL_OTHER_FOLLOWERS"}]}],attackEffectType:"SLASH"},{id:"c_kyokune",name:"",cost:4,type:"FOLLOWER",attack:4,health:4,description:"1",imageUrl:"/cards/kyokune.jpg",relatedCards:["c_sia"],triggers:[{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_sia"}]}],attackEffectType:"SLASH"},{id:"c_sia",name:"",cost:2,type:"FOLLOWER",attack:2,health:1,description:"21",flavorText:"",imageUrl:"/cards/sia.png",evolvedImageUrl:"/cards/sia_2.png",attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DAMAGE",value:1,value2:2,targetType:"OPPONENT"}]}]},{id:"TOKEN_BACKHAND_SMASH",name:"",cost:0,type:"SPELL",description:"16",flavorText:`10
`,imageUrl:"/cards/BackhandSmash.jpg",tags:["Token"],attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:6,targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_QUAKE_HOWLING",name:"",cost:0,type:"SPELL",description:"2",flavorText:"",imageUrl:"/cards/QuakeHowling.png",tags:["Token"],attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"AOE_DAMAGE",value:2,targetType:"ALL_FOLLOWERS"}]}]},{id:"TOKEN_FLICKER_JAB",name:"",cost:0,type:"SPELL",description:"12",flavorText:`
BHS
`,imageUrl:"/cards/FlickerJab.png",tags:["Token"],attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:2,targetType:"SELECT_FOLLOWER"}]}]},{id:"c_bucchi",name:"",cost:5,type:"FOLLOWER",attack:1,health:3,description:"3",flavorText:`
`,imageUrl:"/cards/bucchi.png",evolvedImageUrl:"/cards/bucchi_2.png",attackEffectType:"SLASH",relatedCards:["c_manary"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_manary"},{type:"SUMMON_CARD",targetCardId:"c_manary"},{type:"SUMMON_CARD",targetCardId:"c_manary"}]}]},{id:"c_valkyrie",name:"",cost:6,type:"FOLLOWER",attack:6,health:6,description:`[] [] []
[]`,flavorText:"",imageUrl:"/cards/valkyrie.png",evolvedImageUrl:"/cards/valkyrie_2.png",passiveAbilities:["WARD","BARRIER","AURA"],attackEffectType:"RAY",triggers:[{trigger:"END_OF_TURN",effects:[{type:"GRANT_PASSIVE",targetPassive:"BARRIER",targetType:"SELF"}]}]},{id:"c_manary",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:"[]",flavorText:"^^",imageUrl:"/cards/manary.png",evolvedImageUrl:"/cards/manary_2.png",tags:["Token"],passiveAbilities:["WARD"],attackEffectType:"WATER"},{id:"c_potechi",name:"",cost:3,type:"FOLLOWER",attack:2,health:3,description:`[]
1`,flavorText:"",imageUrl:"/cards/potechi.png",evolvedImageUrl:"/cards/potechi_2.png",passiveAbilities:["WARD"],attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]}]},{id:"c_mono",name:"Mono",cost:3,type:"FOLLOWER",attack:2,health:1,description:`15
15`,flavorText:"",imageUrl:"/cards/Mono.png",evolvedImageUrl:"/cards/Mono_2.png",attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:5,targetType:"SELECT_FOLLOWER"}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:5,targetType:"SELECT_FOLLOWER"}]}]},{id:"c_sara",name:"sara",cost:7,type:"FOLLOWER",attack:4,health:6,description:`2111
1`,flavorText:"w",imageUrl:"/cards/sara.png",evolvedImageUrl:"/cards/sara_2.png",attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DESTROY",value:2,targetType:"OPPONENT"},{type:"GENERATE_CARD",targetCardId:"TOKEN_SORRY_THE_END",conditions:{minTurn:11}}]},{trigger:"SUPER_EVOLVE",effects:[{type:"DESTROY",targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_SORRY_THE_END",name:"",cost:3,type:"SPELL",description:"553sara1",flavorText:'""',imageUrl:"/cards/sorryTheEnd.png",tags:["Token"],attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"AOE_DAMAGE",value:5,targetType:"ALL_FOLLOWERS"},{type:"DAMAGE",value:5,targetType:"OPPONENT"},{type:"DRAW",value:3},{type:"SUMMON_CARD",targetCardId:"c_sara"}]}]},{id:"c_blue_tsubaki",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:`1
1`,flavorText:"",imageUrl:"/cards/blue_tsubaki.png",evolvedImageUrl:"/cards/blue_tsubaki_2.png",attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"RANDOM_DESTROY",value:1,targetType:"OPPONENT"}]}]},{id:"s_resignation_proxy",name:"",cost:0,type:"SPELL",description:"11",flavorText:"1",imageUrl:"/cards/taisyokudaiko.png",tags:["Token"],attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DESTROY",targetType:"OPPONENT",value:1},{type:"DRAW",value:1}]}]},{id:"s_yucho_of_the_abyss",name:"",cost:0,type:"SPELL",description:"11",flavorText:"",imageUrl:"/cards/yuchooftheabyss.png",tags:["Token"],attackEffectType:"THUNDER",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DAMAGE_BY_TURN",value:1,targetType:"OPPONENT"}]}]},{id:"s_thats_mine",name:"",cost:2,type:"SPELL",description:"1",flavorText:"",imageUrl:"/cards/thatsmine.png",tags:["Token"],attackEffectType:"ICE",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY_AND_GENERATE",value:0,targetType:"SELECT_FOLLOWER"}]}]},{id:"s_tenfubu_yabe_hutari",name:"2",cost:4,type:"SPELL",description:"11",flavorText:"",imageUrl:"/cards/tenfubuyabehutari.png",relatedCards:["c_yuki","c_potechi"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_yuki"},{type:"SUMMON_CARD",targetCardId:"c_potechi"}]}]},{id:"s_samurai_tea",name:"",cost:2,type:"SPELL",description:"1+1/+1",flavorText:'""""',imageUrl:"/cards/samuraitea.png",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1},{type:"BUFF_STATS",value:1,value2:1,targetType:"ALL_FOLLOWERS"}]}]},{id:"s_crazy_knucklers",name:"",cost:5,type:"SPELL",description:"+1/+11",flavorText:`
www www`,imageUrl:"/cards/crazy_knucklers.png",relatedCards:["c_white_tsubaki","c_shieko"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD_BUFFED",targetCardId:"c_white_tsubaki",value:1,value2:1},{type:"SUMMON_CARD_BUFFED",targetCardId:"c_shieko",value:1,value2:1},{type:"DRAW",value:1}]}]},{id:"s_knuckle_four",name:"",cost:10,type:"SPELL",description:"444",flavorText:"",imageUrl:"/cards/knucklefour.png",attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DESTROY",value:4,targetType:"OPPONENT"},{type:"DRAW",value:4},{type:"HEAL_LEADER",value:4,targetType:"SELF"}]}]},{id:"c_amandava",name:"amandava",cost:5,attack:2,health:3,type:"FOLLOWER",description:`21
1`,flavorText:"",imageUrl:"/cards/amandava.png",evolvedImageUrl:"/cards/amandava_2.png",attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_SET_HP",value:2,value2:1,targetType:"OPPONENT"}]},{trigger:"EVOLVE",effects:[{type:"AOE_DAMAGE",value:1,targetType:"ALL_FOLLOWERS"}]}]},{id:"c_alice",name:"",cost:3,attack:1,health:1,type:"FOLLOWER",description:`22
22`,flavorText:"",imageUrl:"/cards/alice.png",evolvedImageUrl:"/cards/alice_2.png",attackEffectType:"FIRE",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DAMAGE",value:2,value2:2,targetType:"OPPONENT"}]},{trigger:"EVOLVE",effects:[{type:"RANDOM_DAMAGE",value:2,value2:2,targetType:"OPPONENT"}]}]},{id:"c_yuri",name:"",cost:5,type:"FOLLOWER",attack:3,health:3,description:`1
13`,flavorText:`
`,imageUrl:"/cards/yuri.png",evolvedImageUrl:"/cards/yuri_2.png",attackEffectType:"WATER",relatedCards:["TOKEN_SUIHYORYU"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"TOKEN_SUIHYORYU"}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:3,targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_SUIHYORYU",name:"",cost:5,type:"FOLLOWER",attack:4,health:4,description:`[] []
`,flavorText:"",imageUrl:"/cards/suihyoryu.png",evolvedImageUrl:"/cards/suihyoryu.png",tags:["Token"],passiveAbilities:["RUSH","WARD"],attackEffectType:"ICE",triggers:[{trigger:"START_OF_TURN",effects:[{type:"DESTROY_SELF"}]}]},{id:"c_cyoriena",name:"cyoriena",cost:2,type:"FOLLOWER",attack:1,health:2,description:`[] []
HP2
`,flavorText:"7",imageUrl:"/cards/cyoriena.png",evolvedImageUrl:"/cards/cyoriena_2.png",tags:["Token"],passiveAbilities:["WARD","BARRIER"],attackEffectType:"RAY",triggers:[{trigger:"END_OF_TURN",effects:[{type:"HEAL_LEADER",value:2,targetType:"SELF"}]},{trigger:"EVOLVE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_TSUBASA"}]}]},{id:"TOKEN_TSUBASA",name:"",cost:1,type:"SPELL",description:"1[]",flavorText:"",imageUrl:"/cards/tsubasa.png",tags:["Token"],triggers:[{trigger:"FANFARE",effects:[{type:"GRANT_PASSIVE",targetPassive:"STORM",targetType:"SELECT_ALLY_FOLLOWER"}]}]},{id:"c_yamato",name:"",cost:5,type:"FOLLOWER",attack:5,health:1,description:"[]",imageUrl:"/cards/yamato.jpg",passiveAbilities:["STORM"],attackEffectType:"SLASH"},{id:"c_yoruka",name:"yoRuka",cost:8,type:"FOLLOWER",attack:5,health:5,description:`1
 8yoRuka1
2`,flavorText:"Y",imageUrl:"/cards/yoRuka.png",evolvedImageUrl:"/cards/yoRuka_2.png",attackEffectType:"SUMI",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY",targetType:"SELECT_FOLLOWER"}]},{trigger:"LAST_WORD",effects:[{type:"SUMMON_CARD",targetCardId:"c_yoruka",necromance:8}]},{trigger:"SUPER_EVOLVE",effects:[{type:"RANDOM_DESTROY",value:2,targetType:"OPPONENT"}]}]},{id:"c_haruka",name:"",cost:7,type:"FOLLOWER",attack:2,health:3,description:`[]
[]1
4
1 4+2/+0`,flavorText:"",imageUrl:"/cards/haruka.png",evolvedImageUrl:"/cards/haruka_2.png",passiveAbilities:["STEALTH"],attackEffectType:"SLASH",relatedCards:["c_yuka","c_setsuna"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD_RUSH",targetCardId:"c_yuka"},{type:"SUMMON_CARD",targetCardId:"c_setsuna"}]},{trigger:"LAST_WORD",effects:[{type:"ADD_GRAVEYARD",value:4}]},{trigger:"SUPER_EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_setsuna"},{type:"BUFF_STATS",value:2,value2:0,targetType:"ALL_OTHER_FOLLOWERS",necromance:4}]}]},{id:"c_setsuna",name:"",cost:3,type:"FOLLOWER",attack:1,health:1,description:`[] []
-12`,flavorText:"",imageUrl:"/cards/setsuna.png",evolvedImageUrl:"/cards/setsuna_2.png",passiveAbilities:["STORM","BANE"],attackEffectType:"SUMI",triggers:[{trigger:"LAST_WORD",effects:[{type:"BUFF_STATS",value:-1,value2:0,targetType:"RANDOM_FOLLOWER"},{type:"ADD_GRAVEYARD",value:2}]}]},{id:"c_yuka",name:"",cost:5,type:"FOLLOWER",attack:1,health:6,description:`[] []
1
3
132`,flavorText:"",imageUrl:"/cards/yuka.png",evolvedImageUrl:"/cards/yuka_2.png",passiveAbilities:["WARD","AURA"],attackEffectType:"SHOT",relatedCards:["c_setsuna"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_setsuna"}]},{trigger:"LAST_WORD",effects:[{type:"ADD_GRAVEYARD",value:3}]},{trigger:"EVOLVE",effects:[{type:"RANDOM_DAMAGE",value:3,value2:1,targetType:"OPPONENT"},{type:"RANDOM_DAMAGE",value:3,value2:1,targetType:"OPPONENT"}]}]},{id:"s_hayakikoto",name:"",cost:4,type:"SPELL",description:"21",flavorText:"",imageUrl:"/cards/hayakikoto.png",relatedCards:["c_setsuna"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_setsuna"},{type:"SUMMON_CARD",targetCardId:"c_setsuna"},{type:"DRAW",value:1}]}]},{id:"s_keishou",name:"",cost:9,type:"SPELL",description:"1-9",flavorText:`
`,imageUrl:"/cards/keisyopower.png",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY_AND_GENERATE",targetType:"RANDOM_ENEMY_FOLLOWER",value:-9}]}]},{id:"s_night_parade",name:"",cost:10,type:"SPELL",description:` 41
+1/+0`,flavorText:"",imageUrl:"/cards/nightparade.png",relatedCards:["c_setsuna"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD_FILL_BOARD",targetCardId:"c_setsuna",necromance:4},{type:"BUFF_STATS",value:1,value2:0,targetType:"ALL_FOLLOWERS"}]}]}];function o0(t){let e=t;return()=>(e=(e*1664525+1013904223)%4294967296,e/4294967296)}function fT(t,e){let n=t.length,r;for(;n!=0;)r=Math.floor(e()*n),n--,[t[n],t[r]]=[t[r],t[n]];return t}function hT(t){var s;const e=t.players.p1,n=t.players.p2;return[t.turnCount,t.activePlayerId,e.hp,e.maxHp,e.pp,e.maxPp,e.sep,e.evolutionsUsed,n.hp,n.maxHp,n.pp,n.maxPp,n.sep,n.evolutionsUsed,e.board.map(i=>i?`${i.id}_${i.instanceId}_${i.currentHealth}_${i.hasBarrier?"B":""}`:"null").join(","),n.board.map(i=>i?`${i.id}_${i.instanceId}_${i.currentHealth}_${i.hasBarrier?"B":""}`:"null").join(","),e.hand.length,n.hand.length,((s=t.pendingEffects)==null?void 0:s.length)||0,t.rngSeed].join("|")}const a0=[{cardId:"c_senka_knuckler",count:3},{cardId:"c_yuki",count:3},{cardId:"c_white_tsubaki",count:3},{cardId:"c_shieko",count:3},{cardId:"s_samurai_tea",count:3},{cardId:"c_bucchi",count:2},{cardId:"c_valkyrie",count:1},{cardId:"c_potechi",count:3},{cardId:"s_tenfubu_yabe_hutari",count:3},{cardId:"s_crazy_knucklers",count:2},{cardId:"c_sia",count:2},{cardId:"c_mono",count:3},{cardId:"c_ruiyu",count:1},{cardId:"c_kasuga",count:1},{cardId:"c_y",count:2},{cardId:"c_sara",count:1},{cardId:"s_knuckle_four",count:1},{cardId:"c_blue_tsubaki",count:3}],l0=[{cardId:"c_azya",count:3},{cardId:"c_ruiyu",count:2},{cardId:"c_y",count:2},{cardId:"c_sara",count:2},{cardId:"c_urara",count:3},{cardId:"c_yunagi",count:3},{cardId:"c_tsubumaru",count:3},{cardId:"c_nayuta",count:3},{cardId:"c_yuri",count:2},{cardId:"c_alice",count:3},{cardId:"c_kasuga",count:1},{cardId:"c_barura",count:3},{cardId:"c_valkyrie",count:3},{cardId:"s_3cats",count:2},{cardId:"s_final_cannon",count:1},{cardId:"c_amandava",count:2},{cardId:"c_mono",count:2}],c0=[{cardId:"c_yoruka",count:3},{cardId:"c_y",count:3},{cardId:"c_haruka",count:3},{cardId:"c_yuka",count:3},{cardId:"c_setsuna",count:3},{cardId:"s_hayakikoto",count:3},{cardId:"s_night_parade",count:1},{cardId:"c_kasuga",count:1},{cardId:"c_yunagi",count:3},{cardId:"c_tsubumaru",count:3},{cardId:"c_nayuta",count:3},{cardId:"c_mono",count:3},{cardId:"c_ruiyu",count:1},{cardId:"c_sara",count:1},{cardId:"s_3cats",count:2},{cardId:"c_yuri",count:2},{cardId:"c_sia",count:2}];function es(t){const e=$n.find(n=>n.id===t);return e||$n.find(n=>n.name===t)}function cb(){return $n.map(t=>t.name).sort((t,e)=>e.length-t.length)}function Zc(t){return{STORM:"",RUSH:"",WARD:"",BARRIER:"",AURA:"",STEALTH:"",BANE:"",DOUBLE_ATTACK:"",IMMUNE_TO_FOLLOWER_DAMAGE:"",GUTS_MY_TURN:""}[t]||t}function pT(t,e){const n=[];let r=0;return t.forEach(s=>{const i=es(s.cardId);if(i)for(let o=0;o<s.count;o++)n.push({...i,id:`${e}_c${r}`,instanceId:`inst_${e}_c${r}`}),r++;else console.warn(`Card definition not found: ${s.cardId}`)}),n}function cv(t,e,n,r){const i=pT(n==="SENKA"?a0:n==="AJA"?l0:c0,t);return{id:t,name:e,class:n,hp:ov,maxHp:ov,pp:0,maxPp:0,sep:2,deck:fT(i,r),hand:[],graveyard:[],board:[],evolutionsUsed:0,canEvolveThisTurn:!1,extraPpUsedEarly:!1,extraPpUsedLate:!1,extraPpActive:!1}}function bd(t,e,n,r,s,i=!0){const o=Math.floor(Math.random()*1e6),l=o0(o),c=cv("p1",t,e,l),d=cv("p2",n,r,l);c.hand=c.deck.splice(0,4),d.hand=d.deck.splice(0,4);let u,p;return i?(u="p1",p=t,c.maxPp=1,c.pp=1,d.maxPp=0,d.pp=0):(u="p2",p=n,c.maxPp=0,c.pp=0,d.maxPp=1,d.pp=1),{phase:"INIT",rngSeed:Math.floor(l()*1e6),activePlayerId:u,firstPlayerId:u,players:{p1:c,p2:d},turnCount:1,pendingEffects:[],logs:[` 1 - ${p} `],winnerId:void 0}}function Pp(t){return t==="p1"?"p2":"p1"}function gT(t,e,n,r,s,i){var p,f,S,R,C,j,_,v,w,h,D,H,re,W,Z,he,xe,Ue,de,ie,O;let o={...t,players:{p1:{...t.players.p1,hand:[...t.players.p1.hand],deck:[...t.players.p1.deck],board:t.players.p1.board.map(T=>T?{...T,passiveAbilities:T.passiveAbilities?[...T.passiveAbilities]:[]}:null),graveyard:[...t.players.p1.graveyard]},p2:{...t.players.p2,hand:[...t.players.p2.hand],deck:[...t.players.p2.deck],board:t.players.p2.board.map(T=>T?{...T,passiveAbilities:T.passiveAbilities?[...T.passiveAbilities]:[]}:null),graveyard:[...t.players.p2.graveyard]}},logs:[...t.logs||[]]};const l=o0(o.rngSeed||999);o.rngSeed=Math.floor(l()*1e6);const c=Pp(e),d=T=>{for(const k of["p1","p2"]){const y=o.players[k].board.findIndex(g=>(g==null?void 0:g.instanceId)===T);if(y!==-1&&o.players[k].board[y])return{card:o.players[k].board[y],player:o.players[k],index:y}}return null};if(r.necromance!==void 0&&r.necromance>0&&r.type!=="SUMMON_CARD_FILL_BOARD"){const T=o.players[e];if(T.graveyard.length<r.necromance)return console.log(`[Engine] : ${T.graveyard.length} < ${r.necromance}`),o;const k=T.graveyard.splice(-r.necromance,r.necromance);o.logs.push(`${T.name}  ${r.necromance} `),console.log(`[Engine] : ${k.map(y=>y.name).join(", ")} `)}const u=(T,k)=>{var g;const y=(g=T.triggers)==null?void 0:g.find(I=>I.trigger==="LAST_WORD");if(y){const I=y.effects.map(P=>({sourceCard:T,effect:P,sourcePlayerId:k}));o.pendingEffects=[...o.pendingEffects||[],...I],o.logs.push(`${T.name} `),console.log(`[Engine] processSingleEffect: Last Word triggered for ${T.name}. pendingEffects count: ${o.pendingEffects.length}`)}};switch(r.type){case"DAMAGE":{const T=r.value||0;if(r.targetType==="SELECT_FOLLOWER"&&s){const k=d(s);if(k){const{card:y,player:g,index:I}=k;if(y.hasBarrier)y.hasBarrier=!1,o.logs.push(`${y.name} `);else if(y.currentHealth-=T,o.logs.push(`${n.name}  ${y.name}  ${T} `),y.currentHealth<=0){y.currentHealth=Math.min(0,y.currentHealth);const P=Object.keys(o.players).find(N=>o.players[N]===g)||c;u(y,P),g.graveyard.push(y),g.board[I]=null,o.logs.push(`${y.name} `)}}}else if(r.targetType==="OPPONENT"){const k=o.players[c];if(k.leaderDamageShield)k.leaderDamageShield=!1,o.logs.push(`${n.name}  ${T} `);else{const y=k.board.some(I=>{var P;return(P=I==null?void 0:I.passiveAbilities)==null?void 0:P.includes("LEADER_DAMAGE_CAP")}),g=y?Math.min(T,1):T;k.hp-=g,y&&T>1?o.logs.push(`${n.name}  ${T} 1`):o.logs.push(`${n.name}  ${g} `),k.hp<=0&&(o.winnerId=e,o.logs.push(`${k.name} `))}}break}case"AOE_DAMAGE":{const T=r.value||0;if(r.targetType==="ALL_FOLLOWERS"){const k=o.players[c].board,y=i&&i.length>0?new Set(i):null;k.forEach(I=>{if(I){if(y&&!y.has(I.instanceId))return;I.hasBarrier?(I.hasBarrier=!1,o.logs.push(`${I.name} `)):I.currentHealth-=T}}),k.filter(I=>I&&I.currentHealth<=0).forEach(I=>{I&&(I.currentHealth=Math.min(0,I.currentHealth),u(I,c),o.players[c].graveyard.push(I),o.logs.push(`${I.name} `))}),o.logs.push(`${n.name}  ${T} `),k.forEach((I,P)=>{I&&I.currentHealth<=0&&(k[P]=null)})}break}case"DRAW":{const T=r.value||1,k=o.players[e];for(let y=0;y<T;y++)if(k.deck.length>0){const g=k.deck.pop();g&&(k.hand.length<9?k.hand.push(g):(k.graveyard.push(g),o.logs.push(`${k.name}${g.name}`)))}o.logs.push(`${k.name}  ${T} `);break}case"ADD_GRAVEYARD":{const T=r.value||1,k=o.players[e];for(let y=0;y<T;y++){const g={...n,instanceId:`grave_${o.rngSeed}_${Math.floor(l()*1e3)}_${y}`};k.graveyard.push(g)}o.logs.push(`${k.name}  ${T} `);break}case"HEAL_LEADER":{const T=r.value||0,k=o.players[e];k.hp=Math.min(k.maxHp,k.hp+T),o.logs.push(`${k.name}  ${T} HP`);break}case"DESTROY":{const T=(k,y)=>{var g;return((g=k.passiveAbilities)==null?void 0:g.includes("IMMUNE_TO_DAMAGE_MY_TURN"))===!0&&o.activePlayerId===y};if(r.targetType==="ALL_OTHER_FOLLOWERS"){const k=o.players[c].board,y=[];k.forEach(N=>{N&&(T(N,c)?(y.push(N),o.logs.push(`${N.name} `)):(u(N,c),o.players[c].graveyard.push(N)))}),o.players[c].board=y;const g=o.players[e].board,I=[],P=n.instanceId;g.forEach(N=>{N&&(P&&N.instanceId===P?I.push(N):T(N,e)?(I.push(N),o.logs.push(`${N.name} `)):(u(N,e),o.players[e].graveyard.push(N)))}),o.players[e].board=I,o.logs.push(`${n.name} `)}else if((r.targetType==="SELECT_FOLLOWER"||r.targetType==="SELECT_ALLY_FOLLOWER")&&s){const k=d(s);if(k){const{card:y,player:g,index:I}=k,P=Object.keys(o.players).find(N=>o.players[N].board.includes(y))||"";T(y,P)?o.logs.push(`${y.name} `):(y.currentHealth=1,u(y,P),g.graveyard.push(y),g.board[I]=null,o.logs.push(`${y.name}  ${n.name} `))}}break}case"GENERATE_CARD":{if((p=r.conditions)!=null&&p.minTurn&&t.turnCount<r.conditions.minTurn)break;const T=r.targetCardId,k=$n.find(y=>y.id===T);if(k){const y=o.players[e],g=`gen_${o.rngSeed}_${Date.now()}_${Math.floor(l()*1e4)}`,I={...k,id:`token_${o.rngSeed}_${Math.floor(l()*1e3)}`,instanceId:g};y.hand.length<9?(y.hand.push(I),o.logs.push(`${y.name}  ${k.name} `)):(y.graveyard.push(I),o.logs.push(`${y.name}${k.name}`))}break}case"REDUCE_HAND_COST":{const T=r.value||0,k=((f=r.conditions)==null?void 0:f.nameIn)||[],y=o.players[e];let g=0;y.hand.forEach(I=>{if(k.includes(I.name)){const P=I.cost,N=Math.max(0,P-T);N!==P&&(I.cost=N,I.baseCost=N,g++)}}),g>0&&o.logs.push(`${n.name} -${T}`);break}case"GRANT_LEADER_DAMAGE_SHIELD":{const T=o.players[e];T.leaderDamageShield=!0,o.logs.push(`${T.name} 0`);break}case"RANDOM_DESTROY":{const T=(I,P)=>{var N;return((N=I.passiveAbilities)==null?void 0:N.includes("IMMUNE_TO_DAMAGE_MY_TURN"))===!0&&o.activePlayerId===P},k=r.value||1,y=r.targetType==="SELF"?e:c,g=o.players[y].board;if(i&&i.length>0)i.forEach(I=>{const P=g.findIndex(N=>(N==null?void 0:N.instanceId)===I);if(P!==-1&&g[P]){const N=g[P];T(N,y)?o.logs.push(`${N.name} `):(N.currentHealth=1,u(N,y),o.players[y].graveyard.push(N),g[P]=null,o.logs.push(`${N.name}  ${n.name} `))}});else{const I=g.map((N,J)=>!N||T(N,y)?-1:J).filter(N=>N!==-1);for(let N=I.length-1;N>0;N--){const J=Math.floor(l()*(N+1));[I[N],I[J]]=[I[J],I[N]]}I.slice(0,k).forEach(N=>{const J=g[N];J&&(J.currentHealth=1,u(J,y),o.players[y].graveyard.push(J),g[N]=null,o.logs.push(`${J.name}  ${n.name} `))})}break}case"RANDOM_SET_HP":{const T=r.value||1,k=r.value2||1,y=r.targetType==="SELF"?e:c,g=o.players[y].board;if(i&&i.length>0)i.forEach(I=>{const P=g.findIndex(N=>(N==null?void 0:N.instanceId)===I);P!==-1&&g[P]&&(g[P].currentHealth=k,o.logs.push(`${g[P].name} HP ${k} `))});else{const I=g.map((N,J)=>N?J:-1).filter(N=>N!==-1);for(let N=I.length-1;N>0;N--){const J=Math.floor(l()*(N+1));[I[N],I[J]]=[I[J],I[N]]}I.slice(0,T).forEach(N=>{const J=g[N];J&&(J.currentHealth=k,o.logs.push(`${J.name} HP ${k} `))})}break}case"RANDOM_DAMAGE":{const T=r.value2||1,k=r.value||0,y=r.targetType==="SELF"?e:c,g=o.players[y].board,I=N=>{const J=g[N];J&&(J.hasBarrier?(J.hasBarrier=!1,o.logs.push(`${J.name} `)):(J.currentHealth-=k,o.logs.push(`${n.name}  ${J.name}  ${k} `)),J.currentHealth<=0&&(J.currentHealth=0,u(J,y),o.players[y].graveyard.push(J),g[N]=null,o.logs.push(`${J.name} `)))},P=new Set;if(i&&i.length>0)i.forEach(N=>{const J=g.findIndex(U=>(U==null?void 0:U.instanceId)===N);if(J!==-1&&g[J])P.add(N),I(J);else{const U=g.map((ve,Re)=>ve&&!P.has(ve.instanceId)?Re:-1).filter(ve=>ve!==-1);if(U.length>0){const ve=Math.floor(l()*U.length),Re=U[ve],Ie=g[Re];P.add(Ie.instanceId),I(Re)}}});else{const N=g.map((U,ve)=>U?ve:-1).filter(U=>U!==-1);for(let U=N.length-1;U>0;U--){const ve=Math.floor(l()*(U+1));[N[U],N[ve]]=[N[ve],N[U]]}N.slice(0,T).forEach(U=>{I(U)})}break}case"RANDOM_DAMAGE_BY_TURN":{const T=r.value||1,k=o.turnCount,y=r.targetType==="SELF"?e:c,g=o.players[y].board,I=P=>{var J;const N=g[P];if(!N)return!1;if(N.hasBarrier)return N.hasBarrier=!1,o.logs.push(`${N.name} `),!0;if(N.currentHealth-=T,o.logs.push(`${n.name}  ${N.name}  ${T} `),N.currentHealth<=0){N.currentHealth=0;const U=Object.keys(o.players).find(Re=>o.players[Re]===o.players[y])||y,ve=(J=N.triggers)==null?void 0:J.find(Re=>Re.trigger==="LASTWORD");return ve&&ve.effects.forEach(Re=>{o.pendingEffects.push({sourceCard:N,effect:Re,sourcePlayerId:U})}),o.players[y].graveyard.push(N),g[P]=null,o.logs.push(`${N.name} `),!1}return!0};if(i&&i.length>0)for(let P=0;P<i.length;P++){const N=i[P],J=g.findIndex(U=>(U==null?void 0:U.instanceId)===N);if(J!==-1&&g[J])I(J);else{const U=g.map((ve,Re)=>ve?Re:-1).filter(ve=>ve!==-1);if(U.length>0){const ve=Math.floor(l()*U.length);I(U[ve])}}}else for(let P=0;P<k;P++){const N=g.map((U,ve)=>U?ve:-1).filter(U=>U!==-1);if(N.length===0)break;const J=Math.floor(l()*N.length);I(N[J])}break}case"SET_MAX_HP":{const T=r.value||20;if(r.targetType==="OPPONENT"){const k=o.players[c];k.maxHp=T,k.hp>T&&(k.hp=T)}break}case"SUMMON_CARD":{const T=r.targetCardId,k=$n.find(y=>y.id===T);if(k){const y=o.players[e];if(y.board.filter(I=>I!==null).length<5){const I={...k,instanceId:`token_${o.rngSeed}_${Math.floor(l()*1e3)}`,canAttack:((S=k.passiveAbilities)==null?void 0:S.includes("STORM"))||((R=k.passiveAbilities)==null?void 0:R.includes("RUSH"))||!1,currentHealth:k.health||1,maxHealth:k.health||1,attack:k.attack||0,currentAttack:k.attack||0,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((C=k.passiveAbilities)==null?void 0:C.includes("BARRIER"))??!1,passiveAbilities:k.passiveAbilities?[...k.passiveAbilities]:[],hadStealth:((j=k.passiveAbilities)==null?void 0:j.includes("STEALTH"))??!1};(_=k.tags)!=null&&_.includes("Knuckler")&&!I.passiveAbilities.includes("STORM")&&y.board.some(N=>(N==null?void 0:N.name)==="")&&(I.passiveAbilities.push("STORM"),I.canAttack=!0,o.logs.push(`${k.name}   `)),y.board.push(I),o.logs.push(`${y.name}  ${k.name} `)}}break}case"SUMMON_CARD_RUSH":{const T=r.targetCardId,k=$n.find(y=>y.id===T);if(k){const y=o.players[e];if(y.board.filter(I=>I!==null).length<5){const I={...k,instanceId:`token_${o.rngSeed}_${Math.floor(l()*1e3)}`,canAttack:!0,currentHealth:k.health||1,maxHealth:k.health||1,attack:k.attack||0,currentAttack:k.attack||0,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((v=k.passiveAbilities)==null?void 0:v.includes("BARRIER"))??!1,passiveAbilities:k.passiveAbilities?[...k.passiveAbilities]:[],hadStealth:((w=k.passiveAbilities)==null?void 0:w.includes("STEALTH"))??!1};let P=!1;(h=k.tags)!=null&&h.includes("Knuckler")&&!I.passiveAbilities.includes("STORM")&&y.board.some(J=>(J==null?void 0:J.name)==="")&&(I.passiveAbilities.push("STORM"),P=!0,o.logs.push(`${k.name}   `)),!P&&!I.passiveAbilities.includes("RUSH")&&I.passiveAbilities.push("RUSH"),y.board.push(I),o.logs.push(`${y.name}  ${k.name} ${P?"":""}`)}}break}case"SUMMON_CARD_BUFFED":{const T=r.targetCardId,k=$n.find(I=>I.id===T),y=r.value||0,g=r.value2||0;if(k){const I=o.players[e];if(I.board.filter(N=>N!==null).length<5){const N=k.attack||0,J=k.health||1,U=N+y,ve=J+g,Re={...k,instanceId:`token_${o.rngSeed}_${Math.floor(l()*1e3)}`,canAttack:!1,currentHealth:ve,maxHealth:ve,health:ve,attack:U,currentAttack:U,baseAttack:N,baseHealth:J,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((D=k.passiveAbilities)==null?void 0:D.includes("BARRIER"))??!1,passiveAbilities:k.passiveAbilities?[...k.passiveAbilities]:[],hadStealth:((H=k.passiveAbilities)==null?void 0:H.includes("STEALTH"))??!1};(re=k.tags)!=null&&re.includes("Knuckler")&&!Re.passiveAbilities.includes("STORM")&&I.board.some(te=>(te==null?void 0:te.name)==="")&&(Re.passiveAbilities.push("STORM"),Re.canAttack=!0,o.logs.push(`${k.name}   `)),((W=Re.passiveAbilities)!=null&&W.includes("RUSH")||(Z=Re.passiveAbilities)!=null&&Z.includes("STORM"))&&(Re.canAttack=!0),I.board.push(Re),o.logs.push(`${I.name}  ${k.name} +${y}/+${g}`),o.pendingEffects=[...o.pendingEffects||[],{sourceCard:Re,effect:{type:"VISUAL_BUFF_ONLY",value:y,value2:g},sourcePlayerId:e}]}}break}case"SUMMON_CARD_FILL_BOARD":{const T=r.targetCardId,k=$n.find(g=>g.id===T),y=r.necromance||0;if(k){const g=o.players[e];let I=0;for(;!(g.board.filter(J=>J!==null).length>=5);){if(y>0&&g.graveyard.length<y){I===0&&o.logs.push(` ${k.name} `);break}if(y>0){const J=g.graveyard.splice(-y,y);o.logs.push(` ${y} ${J.map(U=>U.name).join(", ")} `)}const N={...k,instanceId:`token_${o.rngSeed}_${Math.floor(l()*1e3)}_${I}`,canAttack:((he=k.passiveAbilities)==null?void 0:he.includes("STORM"))||((xe=k.passiveAbilities)==null?void 0:xe.includes("RUSH"))||!1,currentHealth:k.health||1,maxHealth:k.health||1,attack:k.attack||0,currentAttack:k.attack||0,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((Ue=k.passiveAbilities)==null?void 0:Ue.includes("BARRIER"))??!1,passiveAbilities:k.passiveAbilities?[...k.passiveAbilities]:[],hadStealth:((de=k.passiveAbilities)==null?void 0:de.includes("STEALTH"))??!1};(ie=k.tags)!=null&&ie.includes("Knuckler")&&!N.passiveAbilities.includes("STORM")&&g.board.some(U=>(U==null?void 0:U.name)==="")&&(N.passiveAbilities.push("STORM"),N.canAttack=!0,o.logs.push(`${k.name}   `)),g.board.push(N),I++,o.logs.push(`${g.name}  ${k.name} `)}I>0&&o.logs.push(` ${I}  ${k.name} `)}break}case"DESTROY_AND_STEAL":{if(r.targetType==="SELECT_FOLLOWER"&&s){const T=d(s);if(T){const{card:k,player:y,index:g}=T,I=Object.keys(o.players).find(J=>o.players[J]===y)||c,P=o.players[e];if(P.board.filter(J=>J!==null).length<5){y.board[g]=null,o.logs.push(`${k.name}  ${n.name} `);const J={...k,instanceId:`stolen_${o.rngSeed}_${Math.floor(l()*1e3)}`,canAttack:!1,currentHealth:k.health||k.currentHealth,maxHealth:k.health||k.maxHealth,currentAttack:k.attack||k.currentAttack,attacksMade:0,turnPlayed:o.turnCount,hasEvolved:!1};P.board.push(J),o.logs.push(`${P.name}  ${J.name} `)}else u(k,I),y.graveyard.push(k),y.board[g]=null,o.logs.push(`${k.name}  ${n.name} `)}}break}case"DESTROY_AND_GENERATE":{let T=null;if(r.targetType==="SELECT_FOLLOWER"&&s)T=d(s);else if(r.targetType==="RANDOM_ENEMY_FOLLOWER"){const y=o.players[c].board.map((g,I)=>({card:g,index:I})).filter(g=>g.card!==null);if(y.length>0){const g=Math.floor(l()*y.length),I=y[g];T={card:I.card,player:o.players[c],index:I.index}}}if(T){const{card:k,player:y,index:g}=T,I=Object.keys(o.players).find(J=>o.players[J]===y)||c;u(k,I),y.graveyard.push(k),y.board[g]=null,o.logs.push(`${k.name}  ${n.name} `);const P=o.players[e],N=es(k.name);if(N){const J=Math.max(0,N.cost+(r.value||0)),U={...N,instanceId:`generated_${o.rngSeed}_${Math.floor(l()*1e3)}`,baseCost:J,cost:J,attackEffectType:N.attackEffectType};P.hand.push(U);const ve=r.value||0;o.logs.push(`${P.name}  ${U.name} ${ve>=0?"+":""}${ve}`)}}break}case"RETURN_TO_HAND":{const T=o.players[c].board;let k=-1;if(r.targetType==="SELECT_FOLLOWER"&&s?k=T.findIndex(y=>(y==null?void 0:y.instanceId)===s):(r.targetType==="RANDOM_FOLLOWER"||!s)&&T.length>0&&(k=Math.floor(l()*T.length)),k!==-1&&T[k]){const y=T[k];o.players[c].board[k]=null;const g=o.players[c],I=es(y.id)||es(y.name),{currentHealth:P,maxHealth:N,canAttack:J,attacksMade:U,hasEvolved:ve,baseAttack:Re,baseHealth:Ie,turnPlayed:te,hasBarrier:K,attack:Oe,health:_e,...ze}=y,Se={...ze,attack:(I==null?void 0:I.attack)??Oe,health:(I==null?void 0:I.health)??_e};g.hand.length<9?(g.hand.push(Se),o.logs.push(`${y.name} `)):(g.graveyard.push(Se),o.logs.push(`${y.name} `))}break}case"RANDOM_BOUNCE":{const T=r.value||1,k=o.players[c].board;for(let y=0;y<T;y++){const g=k.map((at,et)=>at?et:-1).filter(at=>at!==-1);if(g.length===0)break;const I=g[Math.floor(l()*g.length)],P=k[I];k[I]=null;const N=o.players[c],J=es(P.id)||es(P.name),{currentHealth:U,maxHealth:ve,canAttack:Re,attacksMade:Ie,hasEvolved:te,baseAttack:K,baseHealth:Oe,turnPlayed:_e,hasBarrier:ze,attack:Se,health:De,...vt}=P,st={...vt,attack:(J==null?void 0:J.attack)??Se,health:(J==null?void 0:J.health)??De};N.hand.length<9?(N.hand.push(st),o.logs.push(`${P.name} `)):(N.graveyard.push(st),o.logs.push(`${P.name} `))}break}case"GRANT_PASSIVE":{const T=r.targetPassive;if(!T)break;if(r.targetType==="SELF"){const k=n;if(k.instanceId){const g=o.players[e].board.find(I=>(I==null?void 0:I.instanceId)===k.instanceId);g&&(T==="BARRIER"?(g.hasBarrier=!0,o.logs.push(`${g.name} `)):(g.passiveAbilities||(g.passiveAbilities=[]),g.passiveAbilities.includes(T)||(g.passiveAbilities.push(T),o.logs.push(`${g.name}  ${Zc(T)} `)),(T==="STORM"||T==="RUSH")&&(g.canAttack=!0)))}}else if((r.targetType==="SELECT_FOLLOWER"||r.targetType==="SELECT_ALLY_FOLLOWER")&&s){const k=d(s);if(k){const{card:y}=k;T==="BARRIER"?(y.hasBarrier=!0,o.logs.push(`${y.name} `)):(y.passiveAbilities||(y.passiveAbilities=[]),y.passiveAbilities.includes(T)||(y.passiveAbilities.push(T),o.logs.push(`${y.name}  ${Zc(T)} `)),(T==="STORM"||T==="RUSH")&&(y.canAttack=!0))}}else if(r.targetType==="ALL_FOLLOWERS"){const k=o.players[e];let y=0;console.log(`[GRANT_PASSIVE] ALL_FOLLOWERS: Player board has ${k.board.filter(g=>g).length} units, condition tag=${(O=r.conditions)==null?void 0:O.tag}`),k.board.forEach(g=>{var I,P,N;if(g){if(console.log(`[GRANT_PASSIVE] Checking: ${g.name}, tags=${g.tags}, passives=${g.passiveAbilities}`),(I=r.conditions)!=null&&I.tag&&!((P=g.tags)!=null&&P.includes(r.conditions.tag))){console.log(`[GRANT_PASSIVE] Skipped ${g.name}: no matching tag`);return}if((N=r.conditions)!=null&&N.nameIn&&!r.conditions.nameIn.includes(g.name)){console.log(`[GRANT_PASSIVE] Skipped ${g.name}: no matching nameIn`);return}T==="BARRIER"?(g.hasBarrier=!0,y++):(g.passiveAbilities||(g.passiveAbilities=[]),g.passiveAbilities.includes(T)||(g.passiveAbilities.push(T),y++,console.log(`[GRANT_PASSIVE] Granted ${T} to ${g.name}`),(T==="STORM"||T==="RUSH")&&(g.canAttack=!0)))}}),y>0&&o.logs.push(`${y} ${Zc(T)} `),console.log(`[GRANT_PASSIVE] Total granted: ${y}`)}else if(r.targetType==="ALL_OTHER_FOLLOWERS"){const k=o.players[e];let y=0;k.board.forEach(g=>{var I,P,N;if(g&&g.instanceId!==n.instanceId){if((I=r.conditions)!=null&&I.tag&&!((P=g.tags)!=null&&P.includes(r.conditions.tag))||(N=r.conditions)!=null&&N.nameIn&&!r.conditions.nameIn.includes(g.name))return;T==="BARRIER"?(g.hasBarrier=!0,y++):(g.passiveAbilities||(g.passiveAbilities=[]),g.passiveAbilities.includes(T)||(g.passiveAbilities.push(T),y++,(T==="STORM"||T==="RUSH")&&(g.canAttack=!0)))}}),y>0&&o.logs.push(`${y} ${Zc(T)} `)}break}case"BUFF_STATS":{const T=r.value||0,k=r.value2||0;if(r.targetType==="ALL_FOLLOWERS")o.players[e].board.forEach(g=>{var I,P,N;if(g){if((I=r.conditions)!=null&&I.tag&&!((P=g.tags)!=null&&P.includes(r.conditions.tag))||(N=r.conditions)!=null&&N.nameIn&&!r.conditions.nameIn.includes(g.name))return;g.baseAttack||(g.baseAttack=g.attack||0),g.baseHealth||(g.baseHealth=g.health||0),g.attack=(g.attack||0)+T,g.currentAttack=(g.currentAttack||0)+T,g.health=(g.health||0)+k,g.maxHealth=(g.maxHealth||0)+k,g.currentHealth=(g.currentHealth||0)+k,o.logs.push(`${g.name}  +${T}/+${k} `)}});else if(r.targetType==="ALL_OTHER_FOLLOWERS")o.players[e].board.forEach(g=>{var I,P,N;if(g&&g.instanceId!==n.instanceId){if((I=r.conditions)!=null&&I.tag&&!((P=g.tags)!=null&&P.includes(r.conditions.tag))||(N=r.conditions)!=null&&N.nameIn&&!r.conditions.nameIn.includes(g.name))return;g.baseAttack||(g.baseAttack=g.attack||0),g.baseHealth||(g.baseHealth=g.health||0),g.attack=(g.attack||0)+T,g.currentAttack=(g.currentAttack||0)+T,g.health=(g.health||0)+k,g.maxHealth=(g.maxHealth||0)+k,g.currentHealth=(g.currentHealth||0)+k,o.logs.push(`${g.name}  +${T}/+${k} `)}});else if((r.targetType==="SELECT_FOLLOWER"||r.targetType==="SELECT_ALLY_FOLLOWER"||r.targetType==="SELECT_OTHER_ALLY_FOLLOWER")&&s){const y=d(s);if(y){const{card:g}=y;g.baseAttack||(g.baseAttack=g.attack||0),g.baseHealth||(g.baseHealth=g.health||0),g.attack=(g.attack||0)+T,g.currentAttack=(g.currentAttack||0)+T,g.health=(g.health||0)+k,g.maxHealth=(g.maxHealth||0)+k,g.currentHealth=(g.currentHealth||0)+k,o.logs.push(`${g.name}  +${T}/+${k} `)}}else if(r.targetType==="RANDOM_FOLLOWER"){const y=o.players[c].board,g=y.map((I,P)=>I?P:-1).filter(I=>I!==-1);if(g.length>0){const I=g[Math.floor(l()*g.length)],P=y[I];P.baseAttack||(P.baseAttack=P.attack||0),P.baseHealth||(P.baseHealth=P.health||0),P.attack=(P.attack||0)+T,P.currentAttack=(P.currentAttack||0)+T,P.health=(P.health||0)+k,P.maxHealth=(P.maxHealth||0)+k,P.currentHealth=(P.currentHealth||0)+k,P.currentAttack<0&&(P.currentAttack=0),P.attack&&P.attack<0&&(P.attack=0);const N=T>=0?`+${T}`:`${T}`,J=k>=0?`+${k}`:`${k}`;o.logs.push(`${P.name}  ${N}/${J} `)}else o.logs.push("")}break}}return o}const mT=t=>{const e=n=>{const r=n.board.some(i=>i&&i.name.includes("")),s=n.hand.map(i=>{var c;const o=i.baseCost!==void 0?i.baseCost:i.cost;let l=o;return r&&((c=i.tags)!=null&&c.includes("Knuckler"))&&(l=Math.max(0,o-2)),i.cost!==l?{...i,cost:l,baseCost:o}:i});return{...n,hand:s}};return{...t,players:{p1:e(t.players.p1),p2:e(t.players.p2)}}},yT=(t,e)=>{let n=vT(t,e);return n=mT(n),n.lastHash=hT(n),n},vT=(t,e)=>{var s,i,o,l,c,d,u,p,f,S,R,C,j,_,v,w,h,D,H,re,W,Z,he,xe,Ue;console.log(`[Reducer] Action: ${e.type}, isRemote: ${e.isRemote}`);let n={...t,players:{p1:{...t.players.p1,hand:[...t.players.p1.hand],deck:[...t.players.p1.deck],board:t.players.p1.board.map(de=>de?{...de,passiveAbilities:de.passiveAbilities?[...de.passiveAbilities]:[]}:null),graveyard:[...t.players.p1.graveyard]},p2:{...t.players.p2,hand:[...t.players.p2.hand],deck:[...t.players.p2.deck],board:t.players.p2.board.map(de=>de?{...de,passiveAbilities:de.passiveAbilities?[...de.passiveAbilities]:[]}:null),graveyard:[...t.players.p2.graveyard]}},logs:[...t.logs||[]]};const r=o0(n.rngSeed||999);switch(n.rngSeed=Math.floor(r()*1e6),e.type){case"START_GAME":return t;case"END_TURN":{const de=t.activePlayerId,ie=n.players[de];ie.extraPpActive&&(ie.id!==t.firstPlayerId&&(n.turnCount<=5?ie.extraPpUsedEarly=!0:ie.extraPpUsedLate=!0),ie.extraPpActive=!1);const O=[...n.pendingEffects||[]];ie.board.forEach(y=>{y&&y.triggers&&y.triggers.filter(g=>g.trigger==="END_OF_TURN").forEach(g=>{g.effects.forEach(I=>{O.push({sourceCard:y,effect:I,sourcePlayerId:de})})})});const T=Pp(de),k=n.players[T];if(k.board.forEach((y,g)=>{y&&y.triggers&&y.triggers.filter(I=>I.trigger==="START_OF_TURN").forEach(I=>{I.effects.forEach(P=>{P.type==="DESTROY_SELF"?y&&(n.players[T].graveyard.push(y),n.players[T].board[g]=null,n.logs.push(`${y.name} `)):O.push({sourceCard:y,effect:P,sourcePlayerId:T})})})}),n.players[T].board=n.players[T].board.filter(Boolean),k.maxPp=Math.min(10,k.maxPp+1),k.pp=k.maxPp,k.deck.length>0){const y=k.deck.pop();y&&(k.hand.length<9?k.hand.push(y):(k.graveyard.push(y),n.logs.push(`${k.name}${y.name}`)))}return k.board=k.board.filter(Boolean),k.board.forEach(y=>{y&&(y.canAttack=!0,y.attacksMade=0,y.turnPlayed=-1)}),k.canEvolveThisTurn=!0,n.activePlayerId=T,n.pendingEffects=O,T===t.firstPlayerId&&(n.turnCount+=1),n.logs.push(` ${n.turnCount} - ${k.name} `),n}case"CONCEDE":{const de=e.playerId,ie=n.players[de];if(!ie)return console.warn(`[Engine] CONCEDE: Unknown playerId: ${de}. Ignoring.`),t;if(t.phase==="GAME_OVER")return console.warn("[Engine] CONCEDE: Game already over. Ignoring."),t;const O=Pp(de);return n.phase="GAME_OVER",n.winnerId=O,n.logs.push(`${ie.name} `),console.log(`[Engine] CONCEDE: ${de} surrendered. Winner: ${O}`),n}case"RESOLVE_EFFECT":{if(!n.pendingEffects||n.pendingEffects.length===0)return n;const[de,...ie]=n.pendingEffects;console.log(`[Engine] RESOLVE_EFFECT: Processing ${de.effect.type} from ${de.sourceCard.name}. Remaining: ${ie.length}`);const O=((s=e.payload)==null?void 0:s.targetId)||de.targetId;let T=gT(n,de.sourcePlayerId,de.sourceCard,de.effect,O,de.targetIds);const k=(T.pendingEffects||[]).filter(g=>{var I;return!((I=n.pendingEffects)!=null&&I.includes(g))}),y=[...ie,...k];return console.log(`[Engine] RESOLVE_EFFECT done. Remaining: ${ie.length}, NewlyAdded: ${k.length}, Final: ${y.length}`),y.length===0&&Object.values(T.players).forEach(g=>{g.board=g.board.filter(Boolean)}),{...T,pendingEffects:y}}case"PLAY_CARD":{if(!e.isRemote&&n.activePlayerId!==e.playerId)return n;const{cardIndex:de,targetId:ie,instanceId:O}=e.payload,T={...n.players.p1,hand:[...n.players.p1.hand],deck:[...n.players.p1.deck],board:[...n.players.p1.board],graveyard:[...n.players.p1.graveyard]},k={...n.players.p2,hand:[...n.players.p2.hand],deck:[...n.players.p2.deck],board:[...n.players.p2.board],graveyard:[...n.players.p2.graveyard]},y=e.playerId==="p1"?T:k;console.log(`[Engine] PLAY_CARD: playerId=${e.playerId}, cardIndex=${de}, instanceId=${O}, handLength=${y.hand.length}, isRemote=${e.isRemote}`),console.log("[Engine] PLAY_CARD: hand cards:",y.hand.map(te=>`${te.name}(${te.instanceId})`));let g=de;if(O){const te=y.hand.findIndex(K=>K.instanceId===O);if(te>=0)g=te,console.log(`[Engine] PLAY_CARD: Using instanceId ${O}, found at index ${te} (was ${de})`);else return console.log(`[Engine] PLAY_CARD: instanceId ${O} not found in hand!`),n}if(g<0||g>=y.hand.length)return console.log("[Engine] PLAY_CARD: Invalid cardIndex! Returning unchanged state."),n;const I=y.hand[g];let P="";if(ie){const K=(e.playerId==="p1"?k:T).board.find(Oe=>(Oe==null?void 0:Oe.instanceId)===ie);K&&(P=` (: ${K.name})`)}if(n.logs.push(`${y.name}  ${I.name} ${P}`),y.pp<I.cost)return n;const N=y.board.filter(te=>te!==null).length;if(I.type==="FOLLOWER"&&N>=5)return n;const J=y.pp;y.pp-=I.cost,y.extraPpActive&&J-1<I.cost&&(y.id!==t.firstPlayerId&&(n.turnCount<=5?y.extraPpUsedEarly=!0:y.extraPpUsedLate=!0),y.extraPpActive=!1,y.pp<0&&(y.pp=0),console.log("[Engine] PLAY_CARD: Extra PP consumed, marked as used"),n.logs.push(`${y.name} PP`)),y.hand.splice(g,1);let U=I;if(I.type==="FOLLOWER"){const te={...I,instanceId:e.payload.instanceId||`inst_${n.rngSeed}_${Math.floor(r()*1e3)}`,currentAttack:I.attack||0,currentHealth:I.health||0,maxHealth:I.health||0,canAttack:!1,hasEvolved:!1,attacksMade:0,turnPlayed:n.turnCount,hasBarrier:((i=I.passiveAbilities)==null?void 0:i.includes("BARRIER"))??!1,passiveAbilities:I.passiveAbilities?[...I.passiveAbilities]:[],hadStealth:((o=I.passiveAbilities)==null?void 0:o.includes("STEALTH"))??!1};((l=I.passiveAbilities)!=null&&l.includes("STORM")||(c=I.passiveAbilities)!=null&&c.includes("RUSH"))&&(te.canAttack=!0),(d=te.tags)!=null&&d.includes("Knuckler")&&!te.passiveAbilities.includes("STORM")&&y.board.some(Oe=>(Oe==null?void 0:Oe.name)==="")&&(te.passiveAbilities.push("STORM"),te.canAttack=!0,n.logs.push(`${te.name}   `)),y.board.push(te),U=te,te.name===""&&y.board.forEach(K=>{var Oe,_e;K&&((Oe=K.tags)!=null&&Oe.includes("Knuckler"))&&K.instanceId!==te.instanceId&&((_e=K.passiveAbilities)!=null&&_e.includes("STORM")||(K.passiveAbilities||(K.passiveAbilities=[]),K.passiveAbilities.push("STORM"),K.canAttack=!0,n.logs.push(`${K.name}   `)))})}else y.graveyard.push({...I,instanceId:`spell_${n.rngSeed}_${Math.floor(r()*1e3)}`});const ve=[];(u=I.triggers)==null||u.filter(te=>te.trigger==="FANFARE").forEach(te=>ve.push(...te.effects)),(p=I.triggerAbilities)!=null&&p.FANFARE&&ve.push(I.triggerAbilities.FANFARE);let Re=[...n.pendingEffects||[]];return ve.forEach(te=>{if(te.conditions&&te.conditions.minTurn&&n.turnCount<te.conditions.minTurn)return;let K;if(te.targetType==="OPPONENT"||te.targetType==="SELF"||te.targetType==="ALL_FOLLOWERS"||te.targetType==="ALL_OTHER_FOLLOWERS"||te.type==="RANDOM_DESTROY"||te.type==="RANDOM_SET_HP"||te.type==="AOE_DAMAGE"||te.type==="RANDOM_DAMAGE"||te.type==="RANDOM_DAMAGE_BY_TURN"){const _e=e.playerId==="p1"?"p2":"p1",ze=e.playerId;if(te.type==="RANDOM_DAMAGE_BY_TURN"){const Se=te.targetType==="SELF"?ze:_e,De=n.players[Se].board,vt=n.turnCount;K=[];for(let st=0;st<vt;st++){const at=De.map(($e,nt)=>$e?nt:-1).filter($e=>$e!==-1);if(at.length===0)break;const et=Math.floor(r()*at.length);K.push(De[at[et]].instanceId)}}else if(te.type==="RANDOM_DESTROY"||te.type==="RANDOM_SET_HP"||te.type==="RANDOM_DAMAGE"){const Se=te.targetType==="SELF"?ze:_e,De=n.players[Se].board,vt=te.type==="RANDOM_DAMAGE"?te.value2||1:te.value||1,st=De.map((et,$e)=>et?$e:-1).filter(et=>et!==-1);for(let et=st.length-1;et>0;et--){const $e=Math.floor(r()*(et+1));[st[et],st[$e]]=[st[$e],st[et]]}K=st.slice(0,vt).map(et=>De[et].instanceId)}else if(te.targetType==="ALL_FOLLOWERS"||te.type==="AOE_DAMAGE"){const Se=te.type==="GRANT_PASSIVE"||te.type==="BUFF_STATS",De=Se?ze:_e;K=n.players[De].board.filter(st=>st!==null).map(st=>st.instanceId),console.log(`[Engine] Pre-calculated ALL_FOLLOWERS targets (${Se?"ally":"enemy"}): ${K.length} units`)}else te.targetType==="ALL_OTHER_FOLLOWERS"&&(K=n.players[ze].board.filter(De=>De!==null&&De.instanceId!==U.instanceId).map(De=>De.instanceId))}const Oe=te.targetType==="SELECT_FOLLOWER"||te.targetType==="SELECT_ALLY_FOLLOWER"||te.targetType==="SELECT_OTHER_ALLY_FOLLOWER";Re.push({sourceCard:U,effect:te,sourcePlayerId:e.playerId,targetId:Oe?ie:void 0,targetIds:K})}),console.log(`[Engine] PLAY_CARD: Queued ${ve.length} effects. Total pending: ${Re.length}`),{...n,players:{p1:T,p2:k},pendingEffects:Re}}case"EVOLVE":{const{followerIndex:de,targetId:ie,useSep:O}=e.payload,T={...n.players.p1,hand:[...n.players.p1.hand],deck:[...n.players.p1.deck],board:n.players.p1.board.map(U=>U?{...U,passiveAbilities:U.passiveAbilities?[...U.passiveAbilities]:void 0}:null),graveyard:[...n.players.p1.graveyard]},k={...n.players.p2,hand:[...n.players.p2.hand],deck:[...n.players.p2.deck],board:n.players.p2.board.map(U=>U?{...U,passiveAbilities:U.passiveAbilities?[...U.passiveAbilities]:void 0}:null),graveyard:[...n.players.p2.graveyard]},y=e.playerId==="p1"?T:k,g=y.board[de];if(!g||g.hasEvolved)return n;const I=e.isRemote;if(console.log(`[Engine] EVOLVE Logic: name=${g.name}, useSep=${O}, isRemote=${I}, turn=${t.turnCount}`),n.logs.push(`${y.name}  ${g.name} ${O?"":""}`),O){if(!I){if(t.turnCount<6)return console.log(`[Engine] Cannot Super Evolve: Turn ${t.turnCount} < 6`),n;if(y.sep<=0)return console.log("[Engine] Cannot Super Evolve: No SEP"),n;if(!y.canEvolveThisTurn)return console.log("[Engine] Cannot Super Evolve: Already evolved this turn"),n}y.sep=Math.max(0,y.sep-1),y.canEvolveThisTurn=!1,g.hasEvolved=!0,g.currentAttack+=3,g.currentHealth+=3,g.maxHealth+=3,g.canAttack=!0;const U=[...g.passiveAbilities||[]];U.includes("IMMUNE_TO_DAMAGE_MY_TURN")||U.push("IMMUNE_TO_DAMAGE_MY_TURN"),!U.includes("STORM")&&!U.includes("RUSH")&&U.push("RUSH"),g.passiveAbilities=U,console.log(`[Engine] Super Evolved ${g.name}! SEP remaining: ${y.sep}`)}else{if(!I){const Re=e.playerId===t.firstPlayerId?5:4;if(t.turnCount<Re)return console.log(`[Engine] Cannot Evolve: Turn ${t.turnCount} < ${Re}`),n;if(y.evolutionsUsed>=2)return console.log("[Engine] Cannot Evolve: Limit reached"),n;if(!y.canEvolveThisTurn)return console.log("[Engine] Cannot Evolve: Already evolved this turn"),n}y.evolutionsUsed+=1,y.canEvolveThisTurn=!1,g.hasEvolved=!0,g.currentAttack+=2,g.currentHealth+=2,g.maxHealth+=2,g.canAttack=!0;const U=[...g.passiveAbilities||[]];!U.includes("STORM")&&!U.includes("RUSH")&&U.push("RUSH"),g.passiveAbilities=U}const P=[];(f=g.triggers)==null||f.filter(U=>U.trigger==="EVOLVE").forEach(U=>P.push(...U.effects)),(S=g.triggerAbilities)!=null&&S.EVOLVE&&P.push(g.triggerAbilities.EVOLVE),O&&((R=g.triggers)==null||R.filter(U=>U.trigger==="SUPER_EVOLVE").forEach(U=>P.push(...U.effects)));let N=[...n.pendingEffects||[]];return P.forEach(U=>{if(U.conditions&&U.conditions.minTurn&&n.turnCount<U.conditions.minTurn)return;let ve;const Re=e.playerId==="p1"?"p2":"p1",Ie=e.playerId;if(U.type==="RANDOM_DESTROY"||U.type==="RANDOM_SET_HP"||U.type==="RANDOM_DAMAGE"){const te=U.targetType==="SELF"?Ie:Re,K=n.players[te].board,Oe=U.type==="RANDOM_DAMAGE"?U.value2||1:U.value||1,_e=K.map((Se,De)=>Se?De:-1).filter(Se=>Se!==-1);for(let Se=_e.length-1;Se>0;Se--){const De=Math.floor(r()*(Se+1));[_e[Se],_e[De]]=[_e[De],_e[Se]]}ve=_e.slice(0,Oe).map(Se=>K[Se].instanceId)}else U.targetType==="ALL_FOLLOWERS"||U.type==="AOE_DAMAGE"?(ve=n.players[Re].board.filter(K=>K!==null).map(K=>K.instanceId),console.log(`[Engine EVOLVE] Pre-calculated ALL_FOLLOWERS targets: ${ve.length} units`)):U.targetType==="ALL_OTHER_FOLLOWERS"&&(ve=n.players[Ie].board.filter(K=>K!==null&&K.instanceId!==g.instanceId).map(K=>K.instanceId));N.push({sourceCard:g,effect:U,sourcePlayerId:e.playerId,targetId:ie,targetIds:ve})}),console.log(`[Engine] EVOLVE: Queued ${P.length} effects. Total pending: ${N.length}`),{...n,players:{p1:T,p2:k},pendingEffects:N}}case"ATTACK":{console.log(`[Engine] ATTACK received. Incoming state P1 HP: ${t.players.p1.hp}, P2 HP: ${t.players.p2.hp}`);const{attackerIndex:de,targetIndex:ie,targetIsLeader:O}=e.payload,T={...n.players.p1,board:n.players.p1.board.map(K=>K?{...K,passiveAbilities:K.passiveAbilities?[...K.passiveAbilities]:void 0}:null),graveyard:[...n.players.p1.graveyard]},k={...n.players.p2,board:n.players.p2.board.map(K=>K?{...K,passiveAbilities:K.passiveAbilities?[...K.passiveAbilities]:void 0}:null),graveyard:[...n.players.p2.graveyard]},y=e.playerId==="p1",g=y?T:k,I=y?k:T,P=g.board[de];if(!P||!P.canAttack)return n;const N=I.board.filter(K=>{var Oe,_e;return K&&((Oe=K.passiveAbilities)==null?void 0:Oe.includes("WARD"))&&!((_e=K.passiveAbilities)!=null&&_e.includes("STEALTH"))}),J=((C=P.passiveAbilities)==null?void 0:C.includes("STEALTH"))||P.hadStealth;if(N.length>0&&!J){if(O)return console.log("[Engine] Attack blocked: Must attack Ward unit first."),n;const K=I.board[ie];if(K&&!((j=K.passiveAbilities)!=null&&j.includes("WARD")))return console.log("[Engine] Attack blocked: Must attack Ward unit first."),n}if(O===!1){const K=I.board[ie];if(K&&((_=K.passiveAbilities)!=null&&_.includes("STEALTH")))return console.log("[Engine] ATTACK blocked: Target has STEALTH"),n}const U=(v=P.passiveAbilities)==null?void 0:v.includes("RUSH"),ve=(w=P.passiveAbilities)==null?void 0:w.includes("STORM");if(U&&!ve&&O&&P.turnPlayed===n.turnCount)return console.log("[Engine] ATTACK blocked: RUSH unit cannot attack leader on the turn it was played"),n;(h=P.passiveAbilities)!=null&&h.includes("STEALTH")&&(P.passiveAbilities=P.passiveAbilities.filter(K=>K!=="STEALTH"),n.logs.push(`${P.name} `)),P.canAttack=!1,P.attacksMade=(P.attacksMade||0)+1,(D=P.passiveAbilities)!=null&&D.includes("DOUBLE_ATTACK")&&P.attacksMade<2&&(P.canAttack=!0);const Re=P.currentAttack;console.log(`[Engine] Attack: ${P.name} (${Re}) -> Target (Leader? ${O}). DefHP before: ${I.hp}`);const Ie=(K,Oe)=>{var ze;const _e=(ze=K.triggers)==null?void 0:ze.find(Se=>Se.trigger==="LAST_WORD");if(_e){const Se=_e.effects.map(De=>({sourceCard:K,effect:De,sourcePlayerId:Oe}));n.pendingEffects=[...n.pendingEffects||[],...Se],n.logs.push(`${K.name} `),console.log(`[Engine] Last Word triggered for ${K.name}. pendingEffects count: ${n.pendingEffects.length}`)}};if(O){const K="";if(n.logs.push(`${P.name}  ${K} `),I.leaderDamageShield)I.leaderDamageShield=!1,n.logs.push(`${P.name}  ${K}  ${Re} `);else{const Oe=I.board.some(ze=>{var Se;return(Se=ze==null?void 0:ze.passiveAbilities)==null?void 0:Se.includes("LEADER_DAMAGE_CAP")}),_e=Oe?Math.min(Re,1):Re;I.hp-=_e,Oe&&Re>1?n.logs.push(`${P.name}  ${K}  ${Re} 1`):n.logs.push(`${P.name}  ${K}  ${_e} `),I.hp<=0&&(n.winnerId=e.playerId)}}else{const K=I.board[ie];if(!K)return console.log(`[Engine] Attack target at index ${ie} no longer exists. Skipping.`),n;n.logs.push(`${P.name}  ${K.name} `);let Oe=Re;(H=K.passiveAbilities)!=null&&H.includes("IMMUNE_TO_FOLLOWER_DAMAGE")?(Oe=0,n.logs.push(`${K.name} `)):K.hasBarrier&&Oe>0?(Oe=0,K.hasBarrier=!1,n.logs.push(`${K.name} `)):n.logs.push(`${P.name}  ${K.name}  ${Oe} `),K.currentHealth-=Oe;const _e=y?"p2":"p1",ze=((re=K.passiveAbilities)==null?void 0:re.includes("IMMUNE_TO_DAMAGE_MY_TURN"))&&n.activePlayerId===_e;(W=P.passiveAbilities)!=null&&W.includes("BANE")&&K.currentHealth>0&&(ze?n.logs.push(`${K.name} `):(K.currentHealth=0,K.killedByBane=!0,n.logs.push(`${P.name}  ${K.name} `)));let Se=K.currentAttack;(Z=P.passiveAbilities)!=null&&Z.includes("IMMUNE_TO_DAMAGE_MY_TURN")&&(Se=0,n.logs.push(`${P.name} `)),P.hasBarrier&&Se>0?(Se=0,P.hasBarrier=!1,n.logs.push(`${P.name} `)):Se>0&&n.logs.push(`${K.name}  ${P.name}  ${Se} `),P.currentHealth-=Se;const De=y?"p1":"p2";P.currentHealth<=0&&((he=P.passiveAbilities)!=null&&he.includes("GUTS_MY_TURN"))&&n.activePlayerId===De&&(P.currentHealth=1,n.logs.push(`${P.name} 1`));const vt=((xe=P.passiveAbilities)==null?void 0:xe.includes("IMMUNE_TO_DAMAGE_MY_TURN"))&&n.activePlayerId===De;(Ue=K.passiveAbilities)!=null&&Ue.includes("BANE")&&P.currentHealth>0&&(vt?n.logs.push(`${P.name} `):(P.currentHealth=0,P.killedByBane=!0,n.logs.push(`${K.name}  ${P.name} `)));const st=K.currentHealth<=0,at=P.currentHealth<=0;st&&(K.currentHealth=Math.min(0,K.currentHealth),I.graveyard.push(K),I.board[ie]=null,n.logs.push(`${K.name} `)),at&&(P.currentHealth=Math.min(0,P.currentHealth),g.graveyard.push(P),g.board[de]=null,n.logs.push(`${P.name} `)),st&&Ie(K,y?"p2":"p1"),at&&Ie(P,y?"p1":"p2")}console.log(`[Engine] Committing state. P1 HP: ${T.hp}, P2 HP: ${k.hp}`);const te={...n,players:{p1:T,p2:k}};return console.log(`[Engine] After commit. finalState.players.p1.hp: ${te.players.p1.hp}, finalState.players.p2.hp: ${te.players.p2.hp}`),te}case"REINIT_GAME":{const{p1Class:de,p2Class:ie}=e.payload;return console.log(`[Engine] REINIT_GAME: p1=${de}, p2=${ie}`),bd("Player 1",de,"Player 2",ie)}case"SYNC_STATE":return console.log("[Engine] SYNC_STATE received"),e.payload;case"UPDATE_PLAYER_NAME":{const{playerId:de,name:ie}=e.payload;return console.log("[Engine] UPDATE_PLAYER_NAME:",de,ie),t.players[de]?{...t,players:{...t.players,[de]:{...t.players[de],name:ie}}}:(console.warn("[Engine] UPDATE_PLAYER_NAME: Unknown playerId:",de),t)}case"TOGGLE_EXTRA_PP":{const de=e.playerId,ie=n.players[de];if(!(de!==t.firstPlayerId))return console.log("[Engine] TOGGLE_EXTRA_PP: Only second player can use Extra PP"),t;if(t.activePlayerId!==de)return console.log("[Engine] TOGGLE_EXTRA_PP: Can only toggle on your turn"),t;if(ie.extraPpActive)return ie.extraPpActive=!1,ie.pp=Math.max(0,ie.pp-1),console.log("[Engine] TOGGLE_EXTRA_PP: Deactivated, PP now",ie.pp),n;if(n.turnCount<=5){if(ie.extraPpUsedEarly)return console.log("[Engine] TOGGLE_EXTRA_PP: Already used in early turns"),t}else if(ie.extraPpUsedLate)return console.log("[Engine] TOGGLE_EXTRA_PP: Already used in late turns"),t;return ie.extraPpActive=!0,ie.pp+=1,console.log("[Engine] TOGGLE_EXTRA_PP: Activated, PP now",ie.pp),n}default:return t}},Vu=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},xT=Vu("/leaders/azya_leader.png"),_T=Vu("/leaders/senka_leader.png"),bT=Vu("/leaders/yoRuka_leader.png"),ET=1280,ST=720,wT={SENKA:{primary:"#e94560",gradient:"linear-gradient(135deg, #2c0b0e 0%, #1a1a2e 100%)",shadow:"rgba(233, 69, 96, 0.3)"},AJA:{primary:"#45a2e9",gradient:"linear-gradient(135deg, #0f1c2e 0%, #1a1a2e 100%)",shadow:"rgba(69, 162, 233, 0.3)"},YORUKA:{primary:"#a855f7",gradient:"linear-gradient(135deg, #1a0f2e 0%, #1a1a2e 100%)",shadow:"rgba(168, 85, 247, 0.3)"}},IT={SENKA:"",AJA:"",YORUKA:"Y"},TT={SENKA:_T,AJA:xT,YORUKA:bT},Ma=["SENKA","AJA","YORUKA"],CT=({classType:t,onSelectCard:e})=>{const[n,r]=A.useState(1),[s,i]=A.useState(Ma.indexOf(t));A.useEffect(()=>{const D=()=>{const H=window.innerWidth/ET,re=window.innerHeight/ST;r(Math.min(H,re))};return D(),window.addEventListener("resize",D),()=>window.removeEventListener("resize",D)},[]);const o=D=>D==="SENKA"?a0:D==="AJA"?l0:c0,l=Ma[s],d=o(l).filter(D=>!D.cardId.startsWith("TOKEN_")).map(D=>({card:$n.find(H=>H.id===D.cardId),count:D.count})).filter(D=>D.card).sort((D,H)=>D.card.cost-H.card.cost),u=wT[l],p=IT[l],f=TT[l],S=180*n,R=250*n,C=110*n,j=155*n,_=.6*n,v=1.8*n,w=()=>{i(D=>(D-1+Ma.length)%Ma.length)},h=()=>{i(D=>(D+1)%Ma.length)};return a.jsxs("div",{style:{minHeight:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",background:u.gradient,color:"white",position:"relative",paddingBottom:`${40*n}px`},children:[a.jsxs("h2",{style:{fontSize:`${v}rem`,marginTop:`${80*n}px`,marginBottom:`${20*n}px`,fontFamily:"sans-serif",color:u.primary,textShadow:`0 0 20px ${u.shadow}`},children:[p," - "]}),a.jsxs("div",{style:{display:"flex",gap:`${2*n}rem`,width:"95%",maxWidth:`${1100*n}px`,alignItems:"flex-start",justifyContent:"center"},children:[a.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:`${.8*n}rem`},children:[a.jsx("button",{onClick:w,style:{width:`${45*n}px`,height:`${45*n}px`,background:"rgba(0, 0, 0, 0.5)",border:`2px solid ${u.primary}`,borderRadius:"50%",color:u.primary,fontSize:`${1.5*n}rem`,cursor:"pointer",fontWeight:"bold",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},onMouseOver:D=>{D.currentTarget.style.background=u.primary,D.currentTarget.style.color="white"},onMouseOut:D=>{D.currentTarget.style.background="rgba(0, 0, 0, 0.5)",D.currentTarget.style.color=u.primary},children:"<"}),a.jsxs("div",{style:{width:S,height:R,border:`3px solid ${u.primary}`,borderRadius:10*n,background:"linear-gradient(180deg, rgba(0,0,0,0.5) 0%, rgba(0,0,0,0.8) 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",boxShadow:`0 8px 30px ${u.shadow}`,overflow:"hidden",position:"relative"},children:[a.jsx("img",{src:f,alt:p,style:{width:"100%",height:"75%",objectFit:"cover"}}),a.jsx("div",{style:{padding:`${8*n}px`,display:"flex",flexDirection:"column",alignItems:"center",width:"100%",justifyContent:"center",flex:1},children:a.jsx("h3",{style:{fontSize:`${1.2*n}rem`,color:u.primary,margin:0,fontFamily:"sans-serif"},children:p})})]}),a.jsx("button",{onClick:h,style:{width:`${45*n}px`,height:`${45*n}px`,background:"rgba(0, 0, 0, 0.5)",border:`2px solid ${u.primary}`,borderRadius:"50%",color:u.primary,fontSize:`${1.5*n}rem`,cursor:"pointer",fontWeight:"bold",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},onMouseOver:D=>{D.currentTarget.style.background=u.primary,D.currentTarget.style.color="white"},onMouseOut:D=>{D.currentTarget.style.background="rgba(0, 0, 0, 0.5)",D.currentTarget.style.color=u.primary},children:">"})]}),a.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:`${1*n}rem`},children:[a.jsx("div",{style:{display:"grid",gridTemplateColumns:`repeat(auto-fill, minmax(${C}px, 1fr))`,gap:`${_}rem`,width:"100%",padding:`${10*n}px`,maxHeight:`${(j+_*16)*3+40*n}px`,overflowY:"auto",overflowX:"hidden"},children:d.map(({card:D,count:H})=>a.jsxs("div",{onClick:()=>e(D.id),style:{width:C,height:j,border:`2px solid ${u.primary}`,borderRadius:8*n,background:"linear-gradient(180deg, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.9) 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"all 0.2s",boxShadow:`0 4px 15px ${u.shadow}`,position:"relative",overflow:"hidden"},onMouseOver:re=>{re.currentTarget.style.transform="translateY(-5px) scale(1.05)",re.currentTarget.style.boxShadow=`0 8px 25px ${u.shadow}`},onMouseOut:re=>{re.currentTarget.style.transform="translateY(0) scale(1)",re.currentTarget.style.boxShadow=`0 4px 15px ${u.shadow}`},children:[a.jsx("div",{style:{width:"100%",height:"65%",overflow:"hidden",borderBottom:`1px solid ${u.primary}`},children:a.jsx("img",{src:Vu(D.imageUrl||`/cards/${D.id}.png`),alt:D.name,style:{width:"100%",height:"100%",objectFit:"cover"},onError:re=>{re.currentTarget.style.display="none"}})}),a.jsxs("div",{style:{padding:`${5*n}px`,textAlign:"center",flex:1,display:"flex",flexDirection:"column",justifyContent:"center",width:"100%"},children:[a.jsx("h3",{style:{fontSize:`${.7*n}rem`,margin:`0 0 ${3*n}px 0`,fontFamily:"sans-serif",color:u.primary,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:D.name}),a.jsxs("p",{style:{fontSize:`${.6*n}rem`,color:"#ffcc00",margin:0,fontFamily:"sans-serif",fontWeight:"bold"},children:[": ",D.cost]})]}),a.jsx("div",{style:{position:"absolute",bottom:`${5*n}px`,right:`${5*n}px`,background:"rgba(0, 0, 0, 0.8)",color:"white",borderRadius:50,width:`${22*n}px`,height:`${22*n}px`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${.7*n}rem`,fontWeight:"bold",fontFamily:"sans-serif",border:`2px solid ${u.primary}`,boxShadow:`0 0 10px ${u.shadow}`},children:H})]},D.id))}),a.jsxs("div",{style:{fontSize:`${.85*n}rem`,color:"#aaa",fontFamily:"sans-serif",textAlign:"center"},children:[" ",d.length," "]})]})]})]})},kT=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},RT=1280,AT=720,PT=({cardId:t,allCardIds:e=[],onNavigate:n,onOpenRelatedCard:r,onBack:s,onSetHomeCard:i})=>{const[o,l]=A.useState(1),[c,d]=A.useState(!1);A.useEffect(()=>{const h=()=>{const D=window.innerWidth/RT,H=window.innerHeight/AT;l(Math.min(D,H))};return h(),window.addEventListener("resize",h),()=>window.removeEventListener("resize",h)},[]);const u=$n.find(h=>h.id===t);if(!u)return a.jsx("div",{style:{minHeight:"100dvh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",fontFamily:"sans-serif",fontSize:`${1.5*o}rem`},children:""});const p=(h,D)=>kT(h||D),f=p(u.imageUrl,`/cards/${u.id}.png`),S=u.type==="FOLLOWER"?p(u.evolvedImageUrl,`/cards/${u.id}_evolved.png`):null,R=200*o,C=280*o,j=1*o,_="linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #1a1a2e 100%)",v=()=>{console.log(" GalleryCardDetailScreen handleSetHomeCard called with cardId:",t),i?(console.log(" Calling onSetHomeCard callback"),i(t),d(!0),setTimeout(()=>d(!1),1500)):console.warn(" onSetHomeCard callback is not provided")},w=e.length>1&&n;return a.jsxs("div",{style:{minHeight:"100dvh",display:"flex",flexDirection:"column",background:_,color:"white",fontFamily:"sans-serif",overflow:"auto",paddingTop:`${20*o}px`},children:[a.jsx("div",{style:{position:"absolute",top:`${15*o}px`,left:`${15*o}px`,zIndex:100},children:a.jsx("button",{onClick:s,style:{background:"rgba(255, 255, 255, 0.1)",padding:`${8*o}px ${16*o}px`,fontSize:`${.9*o}rem`,border:"1px solid rgba(255, 255, 255, 0.3)",borderRadius:`${6*o}px`,color:"white",cursor:"pointer",fontFamily:"sans-serif",transition:"all 0.2s"},onMouseOver:h=>h.currentTarget.style.background="rgba(255, 255, 255, 0.2)",onMouseOut:h=>h.currentTarget.style.background="rgba(255, 255, 255, 0.1)",children:""})}),w&&a.jsx("div",{style:{position:"absolute",left:`${20*o}px`,top:"50%",transform:"translateY(-50%)",zIndex:100},children:a.jsx("button",{onClick:()=>n("prev"),style:{width:`${60*o}px`,height:`${60*o}px`,background:"rgba(0, 0, 0, 0.6)",border:"2px solid rgba(255, 255, 255, 0.3)",borderRadius:"50%",color:"white",fontSize:`${2*o}rem`,cursor:"pointer",fontWeight:"bold",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},onMouseOver:h=>{h.currentTarget.style.background="rgba(255, 255, 255, 0.2)",h.currentTarget.style.transform="scale(1.1)"},onMouseOut:h=>{h.currentTarget.style.background="rgba(0, 0, 0, 0.6)",h.currentTarget.style.transform="scale(1)"},children:"<"})}),w&&a.jsx("div",{style:{position:"absolute",right:`${20*o}px`,top:"50%",transform:"translateY(-50%)",zIndex:100},children:a.jsx("button",{onClick:()=>n("next"),style:{width:`${60*o}px`,height:`${60*o}px`,background:"rgba(0, 0, 0, 0.6)",border:"2px solid rgba(255, 255, 255, 0.3)",borderRadius:"50%",color:"white",fontSize:`${2*o}rem`,cursor:"pointer",fontWeight:"bold",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},onMouseOver:h=>{h.currentTarget.style.background="rgba(255, 255, 255, 0.2)",h.currentTarget.style.transform="scale(1.1)"},onMouseOut:h=>{h.currentTarget.style.background="rgba(0, 0, 0, 0.6)",h.currentTarget.style.transform="scale(1)"},children:">"})}),a.jsxs("div",{style:{display:"flex",gap:`${2*o}rem`,padding:`${20*o}px ${30*o}px`,flex:1,justifyContent:"center",alignItems:"flex-start",maxWidth:`${1200*o}px`,width:"100%",margin:"0 auto"},children:[a.jsx("div",{style:{display:"flex",flexDirection:"row",alignItems:"flex-start",gap:`${j}rem`,flex:"0 0 auto"},children:u.type==="FOLLOWER"?a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*o}rem`},children:[a.jsx("div",{style:{width:R,height:C,border:"2px solid rgba(255, 255, 255, 0.3)",borderRadius:`${12*o}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.5)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:f,alt:`${u.name} `,style:{width:"100%",height:"100%",objectFit:"cover"}})}),a.jsx("div",{style:{fontSize:`${.75*o}rem`,color:"#aaa",textAlign:"center"},children:""})]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*o}rem`},children:[a.jsx("div",{style:{width:R,height:C,border:"2px solid rgba(255, 215, 0, 0.5)",borderRadius:`${12*o}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(255, 215, 0, 0.3)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:S||f,alt:`${u.name} `,style:{width:"100%",height:"100%",objectFit:"cover"}})}),a.jsx("div",{style:{fontSize:`${.75*o}rem`,color:"#ffd700",textAlign:"center"},children:""})]})]}):a.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*o}rem`},children:a.jsx("div",{style:{width:R,height:C,border:"2px solid rgba(138, 43, 226, 0.5)",borderRadius:`${12*o}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(138, 43, 226, 0.3)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:f,alt:u.name,style:{width:"100%",height:"100%",objectFit:"cover"}})})})}),a.jsxs("div",{style:{flex:"1 1 auto",maxWidth:`${450*o}px`,background:"rgba(0, 0, 0, 0.5)",padding:`${25*o}px`,borderRadius:`${12*o}px`,border:"1px solid rgba(255, 255, 255, 0.2)",display:"flex",flexDirection:"column",gap:`${18*o}px`,minHeight:`${450*o}px`,maxHeight:`${550*o}px`,overflowY:"auto"},children:[a.jsx("h2",{style:{fontSize:`${1.8*o}rem`,fontWeight:"bold",margin:0,color:"#fff",textAlign:"left"},children:u.name}),a.jsxs("div",{style:{display:"flex",gap:`${20*o}px`,fontSize:`${1.2*o}rem`,flexWrap:"wrap"},children:[a.jsxs("div",{style:{color:"#ffd700"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:u.cost})]}),u.type==="FOLLOWER"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{color:"#ff6b6b"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:u.attack})]}),a.jsxs("div",{style:{color:"#4ecdc4"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:u.health})]})]})]}),a.jsx("div",{style:{height:"1px",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)"}}),a.jsxs("div",{children:[a.jsx("h3",{style:{fontSize:`${1.1*o}rem`,margin:`0 0 ${8*o}px 0`,color:"#aaa"},children:""}),a.jsx("p",{style:{fontSize:`${1*o}rem`,margin:0,whiteSpace:"pre-wrap",lineHeight:1.7,color:"#fff"},children:u.description})]}),u.flavorText&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{height:"1px",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)"}}),a.jsxs("div",{children:[a.jsx("h3",{style:{fontSize:`${1.1*o}rem`,margin:`0 0 ${8*o}px 0`,color:"#aaa"},children:""}),a.jsx("p",{style:{fontSize:`${.95*o}rem`,margin:0,fontStyle:"italic",opacity:.7,lineHeight:1.7,whiteSpace:"pre-wrap",color:"#ccc"},children:u.flavorText})]})]}),a.jsxs("div",{style:{display:"flex",gap:`${12*o}px`,flexWrap:"wrap",marginTop:`${10*o}px`},children:[a.jsx("button",{onClick:v,disabled:c,style:{padding:`${.9*o}rem ${1.8*o}rem`,background:c?"#10b981":"#3b82f6",color:"white",border:"none",borderRadius:`${8*o}px`,fontSize:`${1*o}rem`,fontWeight:"bold",fontFamily:"sans-serif",cursor:c?"default":"pointer",transition:"all 0.2s",boxShadow:c?"0 4px 15px rgba(16, 185, 129, 0.3)":"0 4px 15px rgba(59, 130, 246, 0.3)",flex:1},onMouseOver:h=>{c||(h.currentTarget.style.background="#2563eb",h.currentTarget.style.transform="translateY(-2px)",h.currentTarget.style.boxShadow="0 6px 20px rgba(59, 130, 246, 0.4)")},onMouseOut:h=>{c||(h.currentTarget.style.background="#3b82f6",h.currentTarget.style.transform="translateY(0)",h.currentTarget.style.boxShadow="0 4px 15px rgba(59, 130, 246, 0.3)")},children:c?" ":""}),u.relatedCards&&u.relatedCards.length>0&&a.jsxs("button",{onClick:()=>r(t),style:{padding:`${.9*o}rem ${1.8*o}rem`,background:"#4ade80",color:"white",border:"none",borderRadius:`${8*o}px`,fontSize:`${1*o}rem`,fontWeight:"bold",fontFamily:"sans-serif",cursor:"pointer",transition:"all 0.2s",boxShadow:"0 4px 15px rgba(74, 222, 128, 0.3)",flex:1},onMouseOver:h=>{h.currentTarget.style.background="#22c55e",h.currentTarget.style.transform="translateY(-2px)",h.currentTarget.style.boxShadow="0 6px 20px rgba(74, 222, 128, 0.4)"},onMouseOut:h=>{h.currentTarget.style.background="#4ade80",h.currentTarget.style.transform="translateY(0)",h.currentTarget.style.boxShadow="0 4px 15px rgba(74, 222, 128, 0.3)"},children:[" (",u.relatedCards.length,")"]})]})]})]})]})},OT=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},LT=1280,DT=720,MT=({parentCardId:t,relatedCardIds:e,onBack:n})=>{const[r,s]=A.useState(1),[i,o]=A.useState(0);A.useEffect(()=>{const w=()=>{const h=window.innerWidth/LT,D=window.innerHeight/DT;s(Math.min(h,D))};return w(),window.addEventListener("resize",w),()=>window.removeEventListener("resize",w)},[]);const l=e[i],c=$n.find(w=>w.id===l),d=()=>{o(w=>w>0?w-1:e.length-1)},u=()=>{o(w=>w<e.length-1?w+1:0)};if(!c)return a.jsx("div",{style:{minHeight:"100dvh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",fontFamily:"Tamanegi, sans-serif",fontSize:`${1.5*r}rem`},children:""});const p=(w,h)=>OT(w||h),f=p(c.imageUrl,`/cards/${c.id}.png`),S=c.type==="FOLLOWER"?p(c.evolvedImageUrl,`/cards/${c.id}_evolved.png`):null,R=200*r,C=280*r,j=1*r,_="linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #1a1a2e 100%)",v={fontSize:`${2*r}rem`,background:"rgba(0, 0, 0, 0.5)",padding:`${.8*r}rem ${1.2*r}rem`,borderRadius:`${8*r}px`,cursor:"pointer",border:"1px solid rgba(255, 255, 255, 0.2)",color:"white",transition:"all 0.2s",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center"};return a.jsxs("div",{style:{minHeight:"100dvh",display:"flex",flexDirection:"column",background:_,color:"white",fontFamily:"sans-serif",overflow:"auto",paddingTop:`${20*r}px`},children:[a.jsx("div",{style:{position:"absolute",top:`${15*r}px`,left:`${15*r}px`,zIndex:100},children:a.jsx("button",{onClick:n,style:{background:"rgba(255, 255, 255, 0.1)",padding:`${8*r}px ${16*r}px`,fontSize:`${.9*r}rem`,border:"1px solid rgba(255, 255, 255, 0.3)",borderRadius:`${6*r}px`,color:"white",cursor:"pointer",fontFamily:"sans-serif",transition:"all 0.2s"},onMouseOver:w=>w.currentTarget.style.background="rgba(255, 255, 255, 0.2)",onMouseOut:w=>w.currentTarget.style.background="rgba(255, 255, 255, 0.1)",children:""})}),a.jsxs("div",{style:{position:"absolute",top:`${15*r}px`,right:`${15*r}px`,zIndex:100,fontSize:`${1*r}rem`,opacity:.8,fontWeight:"bold",background:"rgba(0, 0, 0, 0.5)",padding:`${8*r}px ${16*r}px`,borderRadius:`${6*r}px`,border:"1px solid rgba(255, 255, 255, 0.2)"},children:[i+1," / ",e.length]}),a.jsxs("div",{style:{display:"flex",gap:`${2*r}rem`,padding:`${20*r}px ${30*r}px`,flex:1,justifyContent:"center",alignItems:"flex-start",maxWidth:`${1200*r}px`,width:"100%",margin:"0 auto"},children:[a.jsx("div",{style:{display:"flex",alignItems:"center",flex:"0 0 auto"},children:a.jsx("button",{onClick:d,style:v,onMouseOver:w=>w.currentTarget.style.background="rgba(0, 0, 0, 0.7)",onMouseOut:w=>w.currentTarget.style.background="rgba(0, 0, 0, 0.5)",children:"<"})}),a.jsx("div",{style:{display:"flex",flexDirection:"row",alignItems:"flex-start",gap:`${j}rem`,flex:"0 0 auto"},children:c.type==="FOLLOWER"?a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*r}rem`},children:[a.jsx("div",{style:{width:R,height:C,border:"2px solid rgba(255, 255, 255, 0.3)",borderRadius:`${12*r}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.5)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:f,alt:`${c.name} `,style:{width:"100%",height:"100%",objectFit:"cover"}})}),a.jsx("div",{style:{fontSize:`${.75*r}rem`,color:"#aaa",textAlign:"center"},children:""})]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*r}rem`},children:[a.jsx("div",{style:{width:R,height:C,border:"2px solid rgba(255, 215, 0, 0.5)",borderRadius:`${12*r}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(255, 215, 0, 0.3)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:S||f,alt:`${c.name} `,style:{width:"100%",height:"100%",objectFit:"cover"}})}),a.jsx("div",{style:{fontSize:`${.75*r}rem`,color:"#ffd700",textAlign:"center"},children:""})]})]}):a.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*r}rem`},children:a.jsx("div",{style:{width:R,height:C,border:"2px solid rgba(138, 43, 226, 0.5)",borderRadius:`${12*r}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(138, 43, 226, 0.3)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:f,alt:c.name,style:{width:"100%",height:"100%",objectFit:"cover"}})})})}),a.jsx("div",{style:{display:"flex",alignItems:"center",flex:"0 0 auto"},children:a.jsx("button",{onClick:u,style:v,onMouseOver:w=>w.currentTarget.style.background="rgba(0, 0, 0, 0.7)",onMouseOut:w=>w.currentTarget.style.background="rgba(0, 0, 0, 0.5)",children:">"})}),a.jsxs("div",{style:{flex:"1 1 auto",maxWidth:`${450*r}px`,background:"rgba(0, 0, 0, 0.5)",padding:`${25*r}px`,borderRadius:`${12*r}px`,border:"1px solid rgba(255, 255, 255, 0.2)",display:"flex",flexDirection:"column",gap:`${18*r}px`,minHeight:`${450*r}px`,maxHeight:`${550*r}px`,overflowY:"auto"},children:[a.jsx("h2",{style:{fontSize:`${1.8*r}rem`,fontWeight:"bold",margin:0,color:"#fff",textAlign:"left"},children:c.name}),a.jsxs("div",{style:{display:"flex",gap:`${20*r}px`,fontSize:`${1.2*r}rem`,flexWrap:"wrap"},children:[a.jsxs("div",{style:{color:"#ffd700"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:c.cost})]}),c.type==="FOLLOWER"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{color:"#ff6b6b"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:c.attack})]}),a.jsxs("div",{style:{color:"#4ecdc4"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:c.health})]})]})]}),a.jsx("div",{style:{height:"1px",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)"}}),a.jsxs("div",{children:[a.jsx("h3",{style:{fontSize:`${1.1*r}rem`,margin:`0 0 ${8*r}px 0`,color:"#aaa"},children:""}),a.jsx("p",{style:{fontSize:`${1*r}rem`,margin:0,whiteSpace:"pre-wrap",lineHeight:1.7,color:"#fff"},children:c.description})]}),c.flavorText&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{height:"1px",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)"}}),a.jsxs("div",{children:[a.jsx("h3",{style:{fontSize:`${1.1*r}rem`,margin:`0 0 ${8*r}px 0`,color:"#aaa"},children:""}),a.jsx("p",{style:{fontSize:`${.95*r}rem`,margin:0,fontStyle:"italic",opacity:.7,lineHeight:1.7,whiteSpace:"pre-wrap",color:"#ccc"},children:c.flavorText})]})]})]})]})]})},NT=()=>{};var dv={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const db={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pe=function(t,e){if(!t)throw ia(e)},ia=function(t){return new Error("Firebase Database ("+db.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ub=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},jT=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=t[n++],o=t[n++],l=t[n++],c=((s&7)<<18|(i&63)<<12|(o&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{const i=t[n++],o=t[n++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},d0={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<t.length;s+=3){const i=t[s],o=s+1<t.length,l=o?t[s+1]:0,c=s+2<t.length,d=c?t[s+2]:0,u=i>>2,p=(i&3)<<4|l>>4;let f=(l&15)<<2|d>>6,S=d&63;c||(S=64,o||(f=64)),r.push(n[u],n[p],n[f],n[S])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(ub(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):jT(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<t.length;){const i=n[t.charAt(s++)],l=s<t.length?n[t.charAt(s)]:0;++s;const d=s<t.length?n[t.charAt(s)]:64;++s;const p=s<t.length?n[t.charAt(s)]:64;if(++s,i==null||l==null||d==null||p==null)throw new $T;const f=i<<2|l>>4;if(r.push(f),d!==64){const S=l<<4&240|d>>2;if(r.push(S),p!==64){const R=d<<6&192|p;r.push(R)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class $T extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const fb=function(t){const e=ub(t);return d0.encodeByteArray(e,!0)},su=function(t){return fb(t).replace(/\./g,"")},iu=function(t){try{return d0.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FT(t){return hb(void 0,t)}function hb(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const n=e;return new Date(n.getTime());case Object:t===void 0&&(t={});break;case Array:t=[];break;default:return e}for(const n in e)!e.hasOwnProperty(n)||!UT(n)||(t[n]=hb(t[n],e[n]));return t}function UT(t){return t!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BT(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zT=()=>BT().__FIREBASE_DEFAULTS__,HT=()=>{if(typeof process>"u"||typeof dv>"u")return;const t=dv.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},WT=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&iu(t[1]);return e&&JSON.parse(e)},u0=()=>{try{return NT()||zT()||HT()||WT()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},pb=t=>{var e,n;return(n=(e=u0())==null?void 0:e.emulatorHosts)==null?void 0:n[t]},GT=t=>{const e=pb(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},gb=()=>{var t;return(t=u0())==null?void 0:t.config},mb=t=>{var e;return(e=u0())==null?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _r{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oa(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function yb(t){return(await fetch(t,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VT(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",s=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...t};return[su(JSON.stringify(n)),su(JSON.stringify(o)),""].join(".")}const rl={};function YT(){const t={prod:[],emulator:[]};for(const e of Object.keys(rl))rl[e]?t.emulator.push(e):t.prod.push(e);return t}function KT(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let uv=!1;function vb(t,e){if(typeof window>"u"||typeof document>"u"||!oa(window.location.host)||rl[t]===e||rl[t]||uv)return;rl[t]=e;function n(f){return`__firebase__banner__${f}`}const r="__firebase__banner",i=YT().prod.length>0;function o(){const f=document.getElementById(r);f&&f.remove()}function l(f){f.style.display="flex",f.style.background="#7faaf0",f.style.position="fixed",f.style.bottom="5px",f.style.left="5px",f.style.padding=".5em",f.style.borderRadius="5px",f.style.alignItems="center"}function c(f,S){f.setAttribute("width","24"),f.setAttribute("id",S),f.setAttribute("height","24"),f.setAttribute("viewBox","0 0 24 24"),f.setAttribute("fill","none"),f.style.marginLeft="-6px"}function d(){const f=document.createElement("span");return f.style.cursor="pointer",f.style.marginLeft="16px",f.style.fontSize="24px",f.innerHTML=" &times;",f.onclick=()=>{uv=!0,o()},f}function u(f,S){f.setAttribute("id",S),f.innerText="Learn more",f.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",f.setAttribute("target","__blank"),f.style.paddingLeft="5px",f.style.textDecoration="underline"}function p(){const f=KT(r),S=n("text"),R=document.getElementById(S)||document.createElement("span"),C=n("learnmore"),j=document.getElementById(C)||document.createElement("a"),_=n("preprendIcon"),v=document.getElementById(_)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(f.created){const w=f.element;l(w),u(j,C);const h=d();c(v,_),w.append(v,R,j,h),document.body.appendChild(w)}i?(R.innerText="Preview backend disconnected.",v.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(v.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,R.innerText="Preview backend running in this workspace."),R.setAttribute("id",S)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",p):p()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function f0(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Pn())}function XT(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function JT(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function xb(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function QT(){const t=Pn();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function qT(){return db.NODE_ADMIN===!0}function ZT(){try{return typeof indexedDB=="object"}catch{return!1}}function e5(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var i;e(((i=s.error)==null?void 0:i.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t5="FirebaseError";class ui extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=t5,Object.setPrototypeOf(this,ui.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Jl.prototype.create)}}class Jl{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?n5(i,r):"Error",l=`${this.serviceName}: ${o} (${s}).`;return new ui(s,l,r)}}function n5(t,e){return t.replace(r5,(n,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const r5=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pl(t){return JSON.parse(t)}function en(t){return JSON.stringify(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _b=function(t){let e={},n={},r={},s="";try{const i=t.split(".");e=Pl(iu(i[0])||""),n=Pl(iu(i[1])||""),s=i[2],r=n.d||{},delete n.d}catch{}return{header:e,claims:n,data:r,signature:s}},s5=function(t){const e=_b(t),n=e.claims;return!!n&&typeof n=="object"&&n.hasOwnProperty("iat")},i5=function(t){const e=_b(t).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rr(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function ji(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}function ou(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function au(t,e,n){const r={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(r[s]=e.call(n,t[s],s,t));return r}function $i(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const i=t[s],o=e[s];if(fv(i)&&fv(o)){if(!$i(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function fv(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aa(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Ga(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Va(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o5{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,n){n||(n=0);const r=this.W_;if(typeof e=="string")for(let p=0;p<16;p++)r[p]=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),n+=4;else for(let p=0;p<16;p++)r[p]=e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3],n+=4;for(let p=16;p<80;p++){const f=r[p-3]^r[p-8]^r[p-14]^r[p-16];r[p]=(f<<1|f>>>31)&4294967295}let s=this.chain_[0],i=this.chain_[1],o=this.chain_[2],l=this.chain_[3],c=this.chain_[4],d,u;for(let p=0;p<80;p++){p<40?p<20?(d=l^i&(o^l),u=1518500249):(d=i^o^l,u=1859775393):p<60?(d=i&o|l&(i|o),u=2400959708):(d=i^o^l,u=3395469782);const f=(s<<5|s>>>27)+d+c+u+r[p]&4294967295;c=l,l=o,o=(i<<30|i>>>2)&4294967295,i=s,s=f}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+i&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,n){if(e==null)return;n===void 0&&(n=e.length);const r=n-this.blockSize;let s=0;const i=this.buf_;let o=this.inbuf_;for(;s<n;){if(o===0)for(;s<=r;)this.compress_(e,s),s+=this.blockSize;if(typeof e=="string"){for(;s<n;)if(i[o]=e.charCodeAt(s),++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}else for(;s<n;)if(i[o]=e[s],++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=n}digest(){const e=[];let n=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=n&255,n/=256;this.compress_(this.buf_);let r=0;for(let s=0;s<5;s++)for(let i=24;i>=0;i-=8)e[r]=this.chain_[s]>>i&255,++r;return e}}function a5(t,e){const n=new l5(t,e);return n.subscribe.bind(n)}class l5{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let s;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");c5(e,["next","error","complete"])?s=e:s={next:e,error:n,complete:r},s.next===void 0&&(s.next=bh),s.error===void 0&&(s.error=bh),s.complete===void 0&&(s.complete=bh);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function c5(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function bh(){}function Ko(t,e){return`${t} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d5=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);if(s>=55296&&s<=56319){const i=s-55296;r++,pe(r<t.length,"Surrogate pair missing trail surrogate.");const o=t.charCodeAt(r)-56320;s=65536+(i<<10)+o}s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):s<65536?(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},Yu=function(t){let e=0;for(let n=0;n<t.length;n++){const r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,n++):e+=3}return e};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nn(t){return t&&t._delegate?t._delegate:t}class Fi{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Si="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u5{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new _r;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:n});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(h5(e))try{this.getOrInitializeService({instanceIdentifier:Si})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(n);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Si){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Si){return this.instances.has(e)}getOptions(e=Si){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[i,o]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);r===l&&o.resolve(s)}return s}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const s of r)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:f5(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Si){return this.component?this.component.multipleInstances?e:Si:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function f5(t){return t===Si?void 0:t}function h5(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p5{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new u5(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Rt;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(Rt||(Rt={}));const g5={debug:Rt.DEBUG,verbose:Rt.VERBOSE,info:Rt.INFO,warn:Rt.WARN,error:Rt.ERROR,silent:Rt.SILENT},m5=Rt.INFO,y5={[Rt.DEBUG]:"log",[Rt.VERBOSE]:"log",[Rt.INFO]:"info",[Rt.WARN]:"warn",[Rt.ERROR]:"error"},v5=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),s=y5[e];if(s)console[s](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class h0{constructor(e){this.name=e,this._logLevel=m5,this._logHandler=v5,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Rt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?g5[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Rt.DEBUG,...e),this._logHandler(this,Rt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Rt.VERBOSE,...e),this._logHandler(this,Rt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Rt.INFO,...e),this._logHandler(this,Rt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Rt.WARN,...e),this._logHandler(this,Rt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Rt.ERROR,...e),this._logHandler(this,Rt.ERROR,...e)}}const x5=(t,e)=>e.some(n=>t instanceof n);let hv,pv;function _5(){return hv||(hv=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function b5(){return pv||(pv=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const bb=new WeakMap,Op=new WeakMap,Eb=new WeakMap,Eh=new WeakMap,p0=new WeakMap;function E5(t){const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("success",i),t.removeEventListener("error",o)},i=()=>{n(Xs(t.result)),s()},o=()=>{r(t.error),s()};t.addEventListener("success",i),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&bb.set(n,t)}).catch(()=>{}),p0.set(e,t),e}function S5(t){if(Op.has(t))return;const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",o),t.removeEventListener("abort",o)},i=()=>{n(),s()},o=()=>{r(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",i),t.addEventListener("error",o),t.addEventListener("abort",o)});Op.set(t,e)}let Lp={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return Op.get(t);if(e==="objectStoreNames")return t.objectStoreNames||Eb.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Xs(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function w5(t){Lp=t(Lp)}function I5(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(Sh(this),e,...n);return Eb.set(r,e.sort?e.sort():[e]),Xs(r)}:b5().includes(t)?function(...e){return t.apply(Sh(this),e),Xs(bb.get(this))}:function(...e){return Xs(t.apply(Sh(this),e))}}function T5(t){return typeof t=="function"?I5(t):(t instanceof IDBTransaction&&S5(t),x5(t,_5())?new Proxy(t,Lp):t)}function Xs(t){if(t instanceof IDBRequest)return E5(t);if(Eh.has(t))return Eh.get(t);const e=T5(t);return e!==t&&(Eh.set(t,e),p0.set(e,t)),e}const Sh=t=>p0.get(t);function C5(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(t,e),l=Xs(o);return r&&o.addEventListener("upgradeneeded",c=>{r(Xs(o.result),c.oldVersion,c.newVersion,Xs(o.transaction),c)}),n&&o.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),l.then(c=>{i&&c.addEventListener("close",()=>i()),s&&c.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),l}const k5=["get","getKey","getAll","getAllKeys","count"],R5=["put","add","delete","clear"],wh=new Map;function gv(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(wh.get(e))return wh.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=R5.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||k5.includes(n)))return;const i=async function(o,...l){const c=this.transaction(o,s?"readwrite":"readonly");let d=c.store;return r&&(d=d.index(l.shift())),(await Promise.all([d[n](...l),s&&c.done]))[0]};return wh.set(e,i),i}w5(t=>({...t,get:(e,n,r)=>gv(e,n)||t.get(e,n,r),has:(e,n)=>!!gv(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A5{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(P5(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function P5(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Dp="@firebase/app",mv="0.14.6";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hs=new h0("@firebase/app"),O5="@firebase/app-compat",L5="@firebase/analytics-compat",D5="@firebase/analytics",M5="@firebase/app-check-compat",N5="@firebase/app-check",j5="@firebase/auth",$5="@firebase/auth-compat",F5="@firebase/database",U5="@firebase/data-connect",B5="@firebase/database-compat",z5="@firebase/functions",H5="@firebase/functions-compat",W5="@firebase/installations",G5="@firebase/installations-compat",V5="@firebase/messaging",Y5="@firebase/messaging-compat",K5="@firebase/performance",X5="@firebase/performance-compat",J5="@firebase/remote-config",Q5="@firebase/remote-config-compat",q5="@firebase/storage",Z5="@firebase/storage-compat",eC="@firebase/firestore",tC="@firebase/ai",nC="@firebase/firestore-compat",rC="firebase",sC="12.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mp="[DEFAULT]",iC={[Dp]:"fire-core",[O5]:"fire-core-compat",[D5]:"fire-analytics",[L5]:"fire-analytics-compat",[N5]:"fire-app-check",[M5]:"fire-app-check-compat",[j5]:"fire-auth",[$5]:"fire-auth-compat",[F5]:"fire-rtdb",[U5]:"fire-data-connect",[B5]:"fire-rtdb-compat",[z5]:"fire-fn",[H5]:"fire-fn-compat",[W5]:"fire-iid",[G5]:"fire-iid-compat",[V5]:"fire-fcm",[Y5]:"fire-fcm-compat",[K5]:"fire-perf",[X5]:"fire-perf-compat",[J5]:"fire-rc",[Q5]:"fire-rc-compat",[q5]:"fire-gcs",[Z5]:"fire-gcs-compat",[eC]:"fire-fst",[nC]:"fire-fst-compat",[tC]:"fire-vertex","fire-js":"fire-js",[rC]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lu=new Map,oC=new Map,Np=new Map;function yv(t,e){try{t.container.addComponent(e)}catch(n){hs.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Xo(t){const e=t.name;if(Np.has(e))return hs.debug(`There were multiple attempts to register component ${e}.`),!1;Np.set(e,t);for(const n of lu.values())yv(n,t);for(const n of oC.values())yv(n,t);return!0}function g0(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function or(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aC={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Js=new Jl("app","Firebase",aC);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lC{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Fi("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Js.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const la=sC;function Sb(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:Mp,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw Js.create("bad-app-name",{appName:String(s)});if(n||(n=gb()),!n)throw Js.create("no-options");const i=lu.get(s);if(i){if($i(n,i.options)&&$i(r,i.config))return i;throw Js.create("duplicate-app",{appName:s})}const o=new p5(s);for(const c of Np.values())o.addComponent(c);const l=new lC(n,r,o);return lu.set(s,l),l}function wb(t=Mp){const e=lu.get(t);if(!e&&t===Mp&&gb())return Sb();if(!e)throw Js.create("no-app",{appName:t});return e}function Qs(t,e,n){let r=iC[t]??t;n&&(r+=`-${n}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const o=[`Unable to register library "${r}" with version "${e}":`];s&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),hs.warn(o.join(" "));return}Xo(new Fi(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cC="firebase-heartbeat-database",dC=1,Ol="firebase-heartbeat-store";let Ih=null;function Ib(){return Ih||(Ih=C5(cC,dC,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Ol)}catch(n){console.warn(n)}}}}).catch(t=>{throw Js.create("idb-open",{originalErrorMessage:t.message})})),Ih}async function uC(t){try{const n=(await Ib()).transaction(Ol),r=await n.objectStore(Ol).get(Tb(t));return await n.done,r}catch(e){if(e instanceof ui)hs.warn(e.message);else{const n=Js.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});hs.warn(n.message)}}}async function vv(t,e){try{const r=(await Ib()).transaction(Ol,"readwrite");await r.objectStore(Ol).put(e,Tb(t)),await r.done}catch(n){if(n instanceof ui)hs.warn(n.message);else{const r=Js.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});hs.warn(r.message)}}}function Tb(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fC=1024,hC=30;class pC{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new mC(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=xv();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)==null?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats.length>hC){const o=yC(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){hs.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=xv(),{heartbeatsToSend:r,unsentEntries:s}=gC(this._heartbeatsCache.heartbeats),i=su(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(n){return hs.warn(n),""}}}function xv(){return new Date().toISOString().substring(0,10)}function gC(t,e=fC){const n=[];let r=t.slice();for(const s of t){const i=n.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),_v(n)>e){i.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),_v(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class mC{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return ZT()?e5().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await uC(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return vv(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return vv(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function _v(t){return su(JSON.stringify({version:2,heartbeats:t})).length}function yC(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vC(t){Xo(new Fi("platform-logger",e=>new A5(e),"PRIVATE")),Xo(new Fi("heartbeat",e=>new pC(e),"PRIVATE")),Qs(Dp,mv,t),Qs(Dp,mv,"esm2020"),Qs("fire-js","")}vC("");var xC="firebase",_C="12.7.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Qs(xC,_C,"app");var bv={};const Ev="@firebase/database",Sv="1.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Cb="";function bC(t){Cb=t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EC{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,n){n==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),en(n))}get(e){const n=this.domStorage_.getItem(this.prefixedName_(e));return n==null?null:Pl(n)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SC{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,n){n==null?delete this.cache_[e]:this.cache_[e]=n}get(e){return Rr(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kb=function(t){try{if(typeof window<"u"&&typeof window[t]<"u"){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new EC(e)}}catch{}return new SC},Ri=kb("localStorage"),wC=kb("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mo=new h0("@firebase/database"),Rb=function(){let t=1;return function(){return t++}}(),Ab=function(t){const e=d5(t),n=new o5;n.update(e);const r=n.digest();return d0.encodeByteArray(r)},Ql=function(...t){let e="";for(let n=0;n<t.length;n++){const r=t[n];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=Ql.apply(null,r):typeof r=="object"?e+=en(r):e+=r,e+=" "}return e};let sl=null,wv=!0;const IC=function(t,e){pe(!0,"Can't turn on custom loggers persistently."),Mo.logLevel=Rt.VERBOSE,sl=Mo.log.bind(Mo)},an=function(...t){if(wv===!0&&(wv=!1,sl===null&&wC.get("logging_enabled")===!0&&IC()),sl){const e=Ql.apply(null,t);sl(e)}},ql=function(t){return function(...e){an(t,...e)}},jp=function(...t){const e="FIREBASE INTERNAL ERROR: "+Ql(...t);Mo.error(e)},ps=function(...t){const e=`FIREBASE FATAL ERROR: ${Ql(...t)}`;throw Mo.error(e),new Error(e)},An=function(...t){const e="FIREBASE WARNING: "+Ql(...t);Mo.warn(e)},TC=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&An("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Ku=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},CC=function(t){if(document.readyState==="complete")t();else{let e=!1;const n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&n()}),window.attachEvent("onload",n))}},Jo="[MIN_NAME]",Ui="[MAX_NAME]",Vi=function(t,e){if(t===e)return 0;if(t===Jo||e===Ui)return-1;if(e===Jo||t===Ui)return 1;{const n=Iv(t),r=Iv(e);return n!==null?r!==null?n-r===0?t.length-e.length:n-r:-1:r!==null?1:t<e?-1:1}},kC=function(t,e){return t===e?0:t<e?-1:1},Na=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+en(e))},m0=function(t){if(typeof t!="object"||t===null)return en(t);const e=[];for(const r in t)e.push(r);e.sort();let n="{";for(let r=0;r<e.length;r++)r!==0&&(n+=","),n+=en(e[r]),n+=":",n+=m0(t[e[r]]);return n+="}",n},Pb=function(t,e){const n=t.length;if(n<=e)return[t];const r=[];for(let s=0;s<n;s+=e)s+e>n?r.push(t.substring(s,n)):r.push(t.substring(s,s+e));return r};function cn(t,e){for(const n in t)t.hasOwnProperty(n)&&e(n,t[n])}const Ob=function(t){pe(!Ku(t),"Invalid JSON number");const e=11,n=52,r=(1<<e-1)-1;let s,i,o,l,c;t===0?(i=0,o=0,s=1/t===-1/0?1:0):(s=t<0,t=Math.abs(t),t>=Math.pow(2,1-r)?(l=Math.min(Math.floor(Math.log(t)/Math.LN2),r),i=l+r,o=Math.round(t*Math.pow(2,n-l)-Math.pow(2,n))):(i=0,o=Math.round(t/Math.pow(2,1-r-n))));const d=[];for(c=n;c;c-=1)d.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)d.push(i%2?1:0),i=Math.floor(i/2);d.push(s?1:0),d.reverse();const u=d.join("");let p="";for(c=0;c<64;c+=8){let f=parseInt(u.substr(c,8),2).toString(16);f.length===1&&(f="0"+f),p=p+f}return p.toLowerCase()},RC=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},AC=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function PC(t,e){let n="Unknown Error";t==="too_big"?n="The data requested exceeds the maximum size that can be accessed with a single request.":t==="permission_denied"?n="Client doesn't have permission to access the desired data.":t==="unavailable"&&(n="The service is unavailable");const r=new Error(t+" at "+e._path.toString()+": "+n);return r.code=t.toUpperCase(),r}const OC=new RegExp("^-?(0*)\\d{1,10}$"),LC=-2147483648,DC=2147483647,Iv=function(t){if(OC.test(t)){const e=Number(t);if(e>=LC&&e<=DC)return e}return null},ca=function(t){try{t()}catch(e){setTimeout(()=>{const n=e.stack||"";throw An("Exception was thrown by user callback.",n),e},Math.floor(0))}},MC=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},il=function(t,e){const n=setTimeout(t,e);return typeof n=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(n):typeof n=="object"&&n.unref&&n.unref(),n};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NC{constructor(e,n){this.appCheckProvider=n,this.appName=e.name,or(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=n==null?void 0:n.getImmediate({optional:!0}),this.appCheck||n==null||n.get().then(r=>this.appCheck=r)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((n,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(n,r):n(null)},0)})}addTokenChangeListener(e){var n;(n=this.appCheckProvider)==null||n.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){An(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jC{constructor(e,n,r){this.appName_=e,this.firebaseOptions_=n,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(n=>n&&n.code==="auth/token-not-initialized"?(an("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(n)):new Promise((n,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(n,r):n(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(n=>n.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(n=>n.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',An(e)}}class Ed{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Ed.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y0="5",Lb="v",Db="s",Mb="r",Nb="f",jb=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,$b="ls",Fb="p",$p="ac",Ub="websocket",Bb="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zb{constructor(e,n,r,s,i=!1,o="",l=!1,c=!1,d=null){this.secure=n,this.namespace=r,this.webSocketOnly=s,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=l,this.isUsingEmulator=c,this.emulatorOptions=d,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Ri.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Ri.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",n=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${n}`}}function $C(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function Hb(t,e,n){pe(typeof e=="string","typeof type must == string"),pe(typeof n=="object","typeof params must == object");let r;if(e===Ub)r=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===Bb)r=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);$C(t)&&(n.ns=t.namespace);const s=[];return cn(n,(i,o)=>{s.push(i+"="+o)}),r+s.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FC{constructor(){this.counters_={}}incrementCounter(e,n=1){Rr(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=n}get(){return FT(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Th={},Ch={};function v0(t){const e=t.toString();return Th[e]||(Th[e]=new FC),Th[e]}function UC(t,e){const n=t.toString();return Ch[n]||(Ch[n]=e()),Ch[n]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BC{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,n){this.closeAfterResponse=e,this.onClose=n,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,n){for(this.pendingResponses[e]=n;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<r.length;++s)r[s]&&ca(()=>{this.onMessage_(r[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tv="start",zC="close",HC="pLPCommand",WC="pRTLPCB",Wb="id",Gb="pw",Vb="ser",GC="cb",VC="seg",YC="ts",KC="d",XC="dframe",Yb=1870,Kb=30,JC=Yb-Kb,QC=25e3,qC=3e4;class Co{constructor(e,n,r,s,i,o,l){this.connId=e,this.repoInfo=n,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.transportSessionId=o,this.lastSessionId=l,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=ql(e),this.stats_=v0(n),this.urlFn=c=>(this.appCheckToken&&(c[$p]=this.appCheckToken),Hb(n,Bb,c))}open(e,n){this.curSegmentNum=0,this.onDisconnect_=n,this.myPacketOrderer=new BC(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(qC)),CC(()=>{if(this.isClosed_)return;this.scriptTagHolder=new x0((...i)=>{const[o,l,c,d,u]=i;if(this.incrementIncomingBytes_(i),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===Tv)this.id=l,this.password=c;else if(o===zC)l?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(l,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...i)=>{const[o,l]=i;this.incrementIncomingBytes_(i),this.myPacketOrderer.handleResponse(o,l)},()=>{this.onClosed_()},this.urlFn);const r={};r[Tv]="t",r[Vb]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[GC]=this.scriptTagHolder.uniqueCallbackIdentifier),r[Lb]=y0,this.transportSessionId&&(r[Db]=this.transportSessionId),this.lastSessionId&&(r[$b]=this.lastSessionId),this.applicationId&&(r[Fb]=this.applicationId),this.appCheckToken&&(r[$p]=this.appCheckToken),typeof location<"u"&&location.hostname&&jb.test(location.hostname)&&(r[Mb]=Nb);const s=this.urlFn(r);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Co.forceAllow_=!0}static forceDisallow(){Co.forceDisallow_=!0}static isAvailable(){return Co.forceAllow_?!0:!Co.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!RC()&&!AC()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const n=en(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const r=fb(n),s=Pb(r,JC);for(let i=0;i<s.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[i]),this.curSegmentNum++}addDisconnectPingFrame(e,n){this.myDisconnFrame=document.createElement("iframe");const r={};r[XC]="t",r[Wb]=e,r[Gb]=n,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const n=en(e).length;this.bytesReceived+=n,this.stats_.incrementCounter("bytes_received",n)}}class x0{constructor(e,n,r,s){this.onDisconnect=r,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=Rb(),window[HC+this.uniqueCallbackIdentifier]=e,window[WC+this.uniqueCallbackIdentifier]=n,this.myIFrame=x0.createIFrame_();let i="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(i='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(l){an("frame writing exception"),l.stack&&an(l.stack),an(l)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||an("No IE domain setting required")}catch{const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,n){for(this.myID=e,this.myPW=n,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[Wb]=this.myID,e[Gb]=this.myPW,e[Vb]=this.currentSerial;let n=this.urlFn(e),r="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+Kb+r.length<=Yb;){const o=this.pendingSegs.shift();r=r+"&"+VC+s+"="+o.seg+"&"+YC+s+"="+o.ts+"&"+KC+s+"="+o.d,s++}return n=n+r,this.addLongPollTag_(n,this.currentSerial),!0}else return!1}enqueueSegment(e,n,r){this.pendingSegs.push({seg:e,ts:n,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,n){this.outstandingRequests.add(n);const r=()=>{this.outstandingRequests.delete(n),this.newRequest_()},s=setTimeout(r,Math.floor(QC)),i=()=>{clearTimeout(s),r()};this.addTag(e,i)}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const s=r.readyState;(!s||s==="loaded"||s==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),n())},r.onerror=()=>{an("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZC=16384,ek=45e3;let cu=null;typeof MozWebSocket<"u"?cu=MozWebSocket:typeof WebSocket<"u"&&(cu=WebSocket);class br{constructor(e,n,r,s,i,o,l){this.connId=e,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=ql(this.connId),this.stats_=v0(n),this.connURL=br.connectionURL_(n,o,l,s,r),this.nodeAdmin=n.nodeAdmin}static connectionURL_(e,n,r,s,i){const o={};return o[Lb]=y0,typeof location<"u"&&location.hostname&&jb.test(location.hostname)&&(o[Mb]=Nb),n&&(o[Db]=n),r&&(o[$b]=r),s&&(o[$p]=s),i&&(o[Fb]=i),Hb(e,Ub,o)}open(e,n){this.onDisconnect=n,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Ri.set("previous_websocket_failure",!0);try{let r;qT(),this.mySock=new cu(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){br.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const n=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(n);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&cu!==null&&!br.forceDisallow_}static previouslyFailed(){return Ri.isInMemoryStorage||Ri.get("previous_websocket_failure")===!0}markConnectionHealthy(){Ri.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const n=this.frames.join("");this.frames=null;const r=Pl(n);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(pe(this.frames===null,"We already have a frame buffer"),e.length<=6){const n=Number(e);if(!isNaN(n))return this.handleNewFrameCount_(n),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const n=e.data;if(this.bytesReceived+=n.length,this.stats_.incrementCounter("bytes_received",n.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(n);else{const r=this.extractFrameCount_(n);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();const n=en(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const r=Pb(n,ZC);r.length>1&&this.sendString_(String(r.length));for(let s=0;s<r.length;s++)this.sendString_(r[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(ek))}sendString_(e){try{this.mySock.send(e)}catch(n){this.log_("Exception thrown from WebSocket.send():",n.message||n.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}br.responsesRequiredToBeHealthy=2;br.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ll{static get ALL_TRANSPORTS(){return[Co,br]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const n=br&&br.isAvailable();let r=n&&!br.previouslyFailed();if(e.webSocketOnly&&(n||An("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[br];else{const s=this.transports_=[];for(const i of Ll.ALL_TRANSPORTS)i&&i.isAvailable()&&s.push(i);Ll.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Ll.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tk=6e4,nk=5e3,rk=10*1024,sk=100*1024,kh="t",Cv="d",ik="s",kv="r",ok="e",Rv="o",Av="a",Pv="n",Ov="p",ak="h";class lk{constructor(e,n,r,s,i,o,l,c,d,u){this.id=e,this.repoInfo_=n,this.applicationId_=r,this.appCheckToken_=s,this.authToken_=i,this.onMessage_=o,this.onReady_=l,this.onDisconnect_=c,this.onKill_=d,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=ql("c:"+this.id+":"),this.transportManager_=new Ll(n),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(n,r)},Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=il(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>sk?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>rk?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return n=>{e===this.conn_?this.onConnectionLost_(n):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return n=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(n):e===this.secondaryConn_?this.onSecondaryMessageReceived_(n):this.log_("message on old connection"))}}sendRequest(e){const n={t:"d",d:e};this.sendData_(n)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(kh in e){const n=e[kh];n===Av?this.upgradeIfSecondaryHealthy_():n===kv?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):n===Rv&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const n=Na("t",e),r=Na("d",e);if(n==="c")this.onSecondaryControl_(r);else if(n==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+n)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:Ov,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Av,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:Pv,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const n=Na("t",e),r=Na("d",e);n==="c"?this.onControl_(r):n==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const n=Na(kh,e);if(Cv in e){const r=e[Cv];if(n===ak){const s={...r};this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(n===Pv){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else n===ik?this.onConnectionShutdown_(r):n===kv?this.onReset_(r):n===ok?jp("Server Error: "+r):n===Rv?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):jp("Unknown control packet command: "+n)}}onHandshake_(e){const n=e.ts,r=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,n),y0!==r&&An("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),il(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(tk))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,n){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(n,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):il(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(nk))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:Ov,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Ri.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xb{put(e,n,r,s){}merge(e,n,r,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,n,r){}onDisconnectMerge(e,n,r){}onDisconnectCancel(e,n){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jb{constructor(e){this.allowedEvents_=e,this.listeners_={},pe(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...n){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let s=0;s<r.length;s++)r[s].callback.apply(r[s].context,n)}}on(e,n,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:n,context:r});const s=this.getInitialEvent(e);s&&n.apply(r,s)}off(e,n,r){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let i=0;i<s.length;i++)if(s[i].callback===n&&(!r||r===s[i].context)){s.splice(i,1);return}}validateEventType_(e){pe(this.allowedEvents_.find(n=>n===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class du extends Jb{static getInstance(){return new du}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!f0()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return pe(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lv=32,Dv=768;class Tt{constructor(e,n){if(n===void 0){this.pieces_=e.split("/");let r=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[r]=this.pieces_[s],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=n}toString(){let e="";for(let n=this.pieceNum_;n<this.pieces_.length;n++)this.pieces_[n]!==""&&(e+="/"+this.pieces_[n]);return e||"/"}}function _t(){return new Tt("")}function dt(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function ri(t){return t.pieces_.length-t.pieceNum_}function Pt(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new Tt(t.pieces_,e)}function _0(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function ck(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)t.pieces_[n]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}function Dl(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function Qb(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new Tt(e,0)}function Ht(t,e){const n=[];for(let r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);if(e instanceof Tt)for(let r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);else{const r=e.split("/");for(let s=0;s<r.length;s++)r[s].length>0&&n.push(r[s])}return new Tt(n,0)}function ft(t){return t.pieceNum_>=t.pieces_.length}function kn(t,e){const n=dt(t),r=dt(e);if(n===null)return e;if(n===r)return kn(Pt(t),Pt(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function dk(t,e){const n=Dl(t,0),r=Dl(e,0);for(let s=0;s<n.length&&s<r.length;s++){const i=Vi(n[s],r[s]);if(i!==0)return i}return n.length===r.length?0:n.length<r.length?-1:1}function b0(t,e){if(ri(t)!==ri(e))return!1;for(let n=t.pieceNum_,r=e.pieceNum_;n<=t.pieces_.length;n++,r++)if(t.pieces_[n]!==e.pieces_[r])return!1;return!0}function lr(t,e){let n=t.pieceNum_,r=e.pieceNum_;if(ri(t)>ri(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[r])return!1;++n,++r}return!0}class uk{constructor(e,n){this.errorPrefix_=n,this.parts_=Dl(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=Yu(this.parts_[r]);qb(this)}}function fk(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=Yu(e),qb(t)}function hk(t){const e=t.parts_.pop();t.byteLength_-=Yu(e),t.parts_.length>0&&(t.byteLength_-=1)}function qb(t){if(t.byteLength_>Dv)throw new Error(t.errorPrefix_+"has a key path longer than "+Dv+" bytes ("+t.byteLength_+").");if(t.parts_.length>Lv)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Lv+") or object contains a cycle "+wi(t))}function wi(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E0 extends Jb{static getInstance(){return new E0}constructor(){super(["visible"]);let e,n;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(n="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(n="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(n="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(n="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,n&&document.addEventListener(n,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}getInitialEvent(e){return pe(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ja=1e3,pk=60*5*1e3,Mv=30*1e3,gk=1.3,mk=3e4,yk="server_kill",Nv=3;class as extends Xb{constructor(e,n,r,s,i,o,l,c){if(super(),this.repoInfo_=e,this.applicationId_=n,this.onDataUpdate_=r,this.onConnectStatus_=s,this.onServerInfoUpdate_=i,this.authTokenProvider_=o,this.appCheckTokenProvider_=l,this.authOverride_=c,this.id=as.nextPersistentConnectionId_++,this.log_=ql("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=ja,this.maxReconnectDelay_=pk,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");E0.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&du.getInstance().on("online",this.onOnline_,this)}sendRequest(e,n,r){const s=++this.requestNumber_,i={r:s,a:e,b:n};this.log_(en(i)),pe(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),r&&(this.requestCBHash_[s]=r)}get(e){this.initConnection_();const n=new _r,s={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const l=o.d;o.s==="ok"?n.resolve(l):n.reject(l)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),n.promise}listen(e,n,r,s){this.initConnection_();const i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),pe(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),pe(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");const l={onComplete:s,hashFn:n,query:e,tag:r};this.listens.get(o).set(i,l),this.connected_&&this.sendListen_(l)}sendGet_(e){const n=this.outstandingGets_[e];this.sendRequest("g",n.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(r)})}sendListen_(e){const n=e.query,r=n._path.toString(),s=n._queryIdentifier;this.log_("Listen on "+r+" for "+s);const i={p:r},o="q";e.tag&&(i.q=n._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest(o,i,l=>{const c=l.d,d=l.s;as.warnOnListenWarnings_(c,n),(this.listens.get(r)&&this.listens.get(r).get(s))===e&&(this.log_("listen response",l),d!=="ok"&&this.removeListen_(r,s),e.onComplete&&e.onComplete(d,c))})}static warnOnListenWarnings_(e,n){if(e&&typeof e=="object"&&Rr(e,"w")){const r=ji(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const s='".indexOn": "'+n._queryParams.getIndex().toString()+'"',i=n._path.toString();An(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${i} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||i5(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Mv)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,n=s5(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(n,r,s=>{const i=s.s,o=s.d||"error";this.authToken_===e&&(i==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(i,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const n=e.s,r=e.d||"error";n==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(n,r)})}unlisten(e,n){const r=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+s),pe(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,s)&&this.connected_&&this.sendUnlisten_(r,s,e._queryObject,n)}sendUnlisten_(e,n,r,s){this.log_("Unlisten on "+e+" for "+n);const i={p:e},o="n";s&&(i.q=r,i.t=s),this.sendRequest(o,i)}onDisconnectPut(e,n,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,n,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:n,onComplete:r})}onDisconnectMerge(e,n,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,n,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:n,onComplete:r})}onDisconnectCancel(e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:n})}sendOnDisconnect_(e,n,r,s){const i={p:n,d:r};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,o=>{s&&setTimeout(()=>{s(o.s,o.d)},Math.floor(0))})}put(e,n,r,s){this.putInternal("p",e,n,r,s)}merge(e,n,r,s){this.putInternal("m",e,n,r,s)}putInternal(e,n,r,s,i){this.initConnection_();const o={p:n,d:r};i!==void 0&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:s}),this.outstandingPutCount_++;const l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+n)}sendPut_(e){const n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,s=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,i=>{this.log_(n+" response",i),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(i.s,i.d)})}reportStats(e){if(this.connected_){const n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,r=>{if(r.s!=="ok"){const i=r.d;this.log_("reportStats","Error sending stats: "+i)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+en(e));const n=e.r,r=this.requestCBHash_[n];r&&(delete this.requestCBHash_[n],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,n){this.log_("handleServerMessage",e,n),e==="d"?this.onDataUpdate_(n.p,n.d,!1,n.t):e==="m"?this.onDataUpdate_(n.p,n.d,!0,n.t):e==="c"?this.onListenRevoked_(n.p,n.q):e==="ac"?this.onAuthRevoked_(n.s,n.d):e==="apc"?this.onAppCheckRevoked_(n.s,n.d):e==="sd"?this.onSecurityDebugPacket_(n):jp("Unrecognized action received from server: "+en(e)+`
Are you using the latest client?`)}onReady_(e,n){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=n,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){pe(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=ja,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=ja,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>mk&&(this.reconnectDelay_=ja),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let n=Math.max(0,this.reconnectDelay_-e);n=Math.random()*n,this.log_("Trying to reconnect in "+n+"ms"),this.scheduleConnect_(n),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*gk)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+as.nextConnectionId_++,i=this.lastSessionId;let o=!1,l=null;const c=function(){l?l.close():(o=!0,r())},d=function(p){pe(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(p)};this.realtime_={close:c,sendRequest:d};const u=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[p,f]=await Promise.all([this.authTokenProvider_.getToken(u),this.appCheckTokenProvider_.getToken(u)]);o?an("getToken() completed but was canceled"):(an("getToken() completed. Creating connection."),this.authToken_=p&&p.accessToken,this.appCheckToken_=f&&f.token,l=new lk(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,r,S=>{An(S+" ("+this.repoInfo_.toString()+")"),this.interrupt(yk)},i))}catch(p){this.log_("Failed to get token: "+p),o||(this.repoInfo_.nodeAdmin&&An(p),c())}}}interrupt(e){an("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){an("Resuming connection for reason: "+e),delete this.interruptReasons_[e],ou(this.interruptReasons_)&&(this.reconnectDelay_=ja,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const n=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:n})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const n=this.outstandingPuts_[e];n&&"h"in n.request&&n.queued&&(n.onComplete&&n.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,n){let r;n?r=n.map(i=>m0(i)).join("$"):r="default";const s=this.removeListen_(e,r);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(e,n){const r=new Tt(e).toString();let s;if(this.listens.has(r)){const i=this.listens.get(r);s=i.get(n),i.delete(n),i.size===0&&this.listens.delete(r)}else s=void 0;return s}onAuthRevoked_(e,n){an("Auth token revoked: "+e+"/"+n),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Nv&&(this.reconnectDelay_=Mv,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,n){an("App check token revoked: "+e+"/"+n),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Nv&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const n of e.values())this.sendListen_(n);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let n="js";e["sdk."+n+"."+Cb.replace(/\./g,"-")]=1,f0()?e["framework.cordova"]=1:xb()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=du.getInstance().currentlyOnline();return ou(this.interruptReasons_)&&e}}as.nextPersistentConnectionId_=0;as.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ht{constructor(e,n){this.name=e,this.node=n}static Wrap(e,n){return new ht(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xu{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,n){const r=new ht(Jo,e),s=new ht(Jo,n);return this.compare(r,s)!==0}minPost(){return ht.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ed;class Zb extends Xu{static get __EMPTY_NODE(){return ed}static set __EMPTY_NODE(e){ed=e}compare(e,n){return Vi(e.name,n.name)}isDefinedOn(e){throw ia("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,n){return!1}minPost(){return ht.MIN}maxPost(){return new ht(Ui,ed)}makePost(e,n){return pe(typeof e=="string","KeyIndex indexValue must always be a string."),new ht(e,ed)}toString(){return".key"}}const No=new Zb;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class td{constructor(e,n,r,s,i=null){this.isReverse_=s,this.resultGenerator_=i,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=n?r(e.key,n):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),n;if(this.resultGenerator_?n=this.resultGenerator_(e.key,e.value):n={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return n}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class on{constructor(e,n,r,s,i){this.key=e,this.value=n,this.color=r??on.RED,this.left=s??Un.EMPTY_NODE,this.right=i??Un.EMPTY_NODE}copy(e,n,r,s,i){return new on(e??this.key,n??this.value,r??this.color,s??this.left,i??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let s=this;const i=r(e,s.key);return i<0?s=s.copy(null,null,null,s.left.insert(e,n,r),null):i===0?s=s.copy(null,n,null,null,null):s=s.copy(null,null,null,null,s.right.insert(e,n,r)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return Un.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,n){let r,s;if(r=this,n(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,n),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),n(e,r.key)===0){if(r.right.isEmpty())return Un.EMPTY_NODE;s=r.right.min_(),r=r.copy(s.key,s.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,n))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,on.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,on.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}on.RED=!0;on.BLACK=!1;class vk{copy(e,n,r,s,i){return this}insert(e,n,r){return new on(e,n,null)}remove(e,n){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class Un{constructor(e,n=Un.EMPTY_NODE){this.comparator_=e,this.root_=n}insert(e,n){return new Un(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,on.BLACK,null,null))}remove(e){return new Un(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,on.BLACK,null,null))}get(e){let n,r=this.root_;for(;!r.isEmpty();){if(n=this.comparator_(e,r.key),n===0)return r.value;n<0?r=r.left:n>0&&(r=r.right)}return null}getPredecessorKey(e){let n,r=this.root_,s=null;for(;!r.isEmpty();)if(n=this.comparator_(e,r.key),n===0){if(r.left.isEmpty())return s?s.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else n<0?r=r.left:n>0&&(s=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new td(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,n){return new td(this.root_,e,this.comparator_,!1,n)}getReverseIteratorFrom(e,n){return new td(this.root_,e,this.comparator_,!0,n)}getReverseIterator(e){return new td(this.root_,null,this.comparator_,!0,e)}}Un.EMPTY_NODE=new vk;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xk(t,e){return Vi(t.name,e.name)}function S0(t,e){return Vi(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Fp;function _k(t){Fp=t}const eE=function(t){return typeof t=="number"?"number:"+Ob(t):"string:"+t},tE=function(t){if(t.isLeafNode()){const e=t.val();pe(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Rr(e,".sv"),"Priority must be a string or number.")}else pe(t===Fp||t.isEmpty(),"priority of unexpected type.");pe(t===Fp||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let jv;class rn{static set __childrenNodeConstructor(e){jv=e}static get __childrenNodeConstructor(){return jv}constructor(e,n=rn.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=n,this.lazyHash_=null,pe(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),tE(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new rn(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:rn.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return ft(e)?this:dt(e)===".priority"?this.priorityNode_:rn.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,n){return null}updateImmediateChild(e,n){return e===".priority"?this.updatePriority(n):n.isEmpty()&&e!==".priority"?this:rn.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)}updateChild(e,n){const r=dt(e);return r===null?n:n.isEmpty()&&r!==".priority"?this:(pe(r!==".priority"||ri(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,rn.__childrenNodeConstructor.EMPTY_NODE.updateChild(Pt(e),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,n){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+eE(this.priorityNode_.val())+":");const n=typeof this.value_;e+=n+":",n==="number"?e+=Ob(this.value_):e+=this.value_,this.lazyHash_=Ab(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===rn.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof rn.__childrenNodeConstructor?-1:(pe(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const n=typeof e.value_,r=typeof this.value_,s=rn.VALUE_TYPE_ORDER.indexOf(n),i=rn.VALUE_TYPE_ORDER.indexOf(r);return pe(s>=0,"Unknown leaf type: "+n),pe(i>=0,"Unknown leaf type: "+r),s===i?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const n=e;return this.value_===n.value_&&this.priorityNode_.equals(n.priorityNode_)}else return!1}}rn.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nE,rE;function bk(t){nE=t}function Ek(t){rE=t}class Sk extends Xu{compare(e,n){const r=e.node.getPriority(),s=n.node.getPriority(),i=r.compareTo(s);return i===0?Vi(e.name,n.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,n){return!e.getPriority().equals(n.getPriority())}minPost(){return ht.MIN}maxPost(){return new ht(Ui,new rn("[PRIORITY-POST]",rE))}makePost(e,n){const r=nE(e);return new ht(n,new rn("[PRIORITY-POST]",r))}toString(){return".priority"}}const Ft=new Sk;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wk=Math.log(2);class Ik{constructor(e){const n=i=>parseInt(Math.log(i)/wk,10),r=i=>parseInt(Array(i+1).join("1"),2);this.count=n(e+1),this.current_=this.count-1;const s=r(this.count);this.bits_=e+1&s}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const uu=function(t,e,n,r){t.sort(e);const s=function(c,d){const u=d-c;let p,f;if(u===0)return null;if(u===1)return p=t[c],f=n?n(p):p,new on(f,p.node,on.BLACK,null,null);{const S=parseInt(u/2,10)+c,R=s(c,S),C=s(S+1,d);return p=t[S],f=n?n(p):p,new on(f,p.node,on.BLACK,R,C)}},i=function(c){let d=null,u=null,p=t.length;const f=function(R,C){const j=p-R,_=p;p-=R;const v=s(j+1,_),w=t[j],h=n?n(w):w;S(new on(h,w.node,C,null,v))},S=function(R){d?(d.left=R,d=R):(u=R,d=R)};for(let R=0;R<c.count;++R){const C=c.nextBitIsOne(),j=Math.pow(2,c.count-(R+1));C?f(j,on.BLACK):(f(j,on.BLACK),f(j,on.RED))}return u},o=new Ik(t.length),l=i(o);return new Un(r||e,l)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Rh;const fo={};class rs{static get Default(){return pe(fo&&Ft,"ChildrenNode.ts has not been loaded"),Rh=Rh||new rs({".priority":fo},{".priority":Ft}),Rh}constructor(e,n){this.indexes_=e,this.indexSet_=n}get(e){const n=ji(this.indexes_,e);if(!n)throw new Error("No index defined for "+e);return n instanceof Un?n:null}hasIndex(e){return Rr(this.indexSet_,e.toString())}addIndex(e,n){pe(e!==No,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let s=!1;const i=n.getIterator(ht.Wrap);let o=i.getNext();for(;o;)s=s||e.isDefinedOn(o.node),r.push(o),o=i.getNext();let l;s?l=uu(r,e.getCompare()):l=fo;const c=e.toString(),d={...this.indexSet_};d[c]=e;const u={...this.indexes_};return u[c]=l,new rs(u,d)}addToIndexes(e,n){const r=au(this.indexes_,(s,i)=>{const o=ji(this.indexSet_,i);if(pe(o,"Missing index implementation for "+i),s===fo)if(o.isDefinedOn(e.node)){const l=[],c=n.getIterator(ht.Wrap);let d=c.getNext();for(;d;)d.name!==e.name&&l.push(d),d=c.getNext();return l.push(e),uu(l,o.getCompare())}else return fo;else{const l=n.get(e.name);let c=s;return l&&(c=c.remove(new ht(e.name,l))),c.insert(e,e.node)}});return new rs(r,this.indexSet_)}removeFromIndexes(e,n){const r=au(this.indexes_,s=>{if(s===fo)return s;{const i=n.get(e.name);return i?s.remove(new ht(e.name,i)):s}});return new rs(r,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let $a;class Ve{static get EMPTY_NODE(){return $a||($a=new Ve(new Un(S0),null,rs.Default))}constructor(e,n,r){this.children_=e,this.priorityNode_=n,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&tE(this.priorityNode_),this.children_.isEmpty()&&pe(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||$a}updatePriority(e){return this.children_.isEmpty()?this:new Ve(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const n=this.children_.get(e);return n===null?$a:n}}getChild(e){const n=dt(e);return n===null?this:this.getImmediateChild(n).getChild(Pt(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,n){if(pe(n,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(n);{const r=new ht(e,n);let s,i;n.isEmpty()?(s=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(r,this.children_)):(s=this.children_.insert(e,n),i=this.indexMap_.addToIndexes(r,this.children_));const o=s.isEmpty()?$a:this.priorityNode_;return new Ve(s,o,i)}}updateChild(e,n){const r=dt(e);if(r===null)return n;{pe(dt(e)!==".priority"||ri(e)===1,".priority must be the last token in a path");const s=this.getImmediateChild(r).updateChild(Pt(e),n);return this.updateImmediateChild(r,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const n={};let r=0,s=0,i=!0;if(this.forEachChild(Ft,(o,l)=>{n[o]=l.val(e),r++,i&&Ve.INTEGER_REGEXP_.test(o)?s=Math.max(s,Number(o)):i=!1}),!e&&i&&s<2*r){const o=[];for(const l in n)o[l]=n[l];return o}else return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+eE(this.getPriority().val())+":"),this.forEachChild(Ft,(n,r)=>{const s=r.hash();s!==""&&(e+=":"+n+":"+s)}),this.lazyHash_=e===""?"":Ab(e)}return this.lazyHash_}getPredecessorChildName(e,n,r){const s=this.resolveIndex_(r);if(s){const i=s.getPredecessorKey(new ht(e,n));return i?i.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const n=this.resolveIndex_(e);if(n){const r=n.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){const n=this.getFirstChildName(e);return n?new ht(n,this.children_.get(n)):null}getLastChildName(e){const n=this.resolveIndex_(e);if(n){const r=n.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){const n=this.getLastChildName(e);return n?new ht(n,this.children_.get(n)):null}forEachChild(e,n){const r=this.resolveIndex_(e);return r?r.inorderTraversal(s=>n(s.name,s.node)):this.children_.inorderTraversal(n)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,n){const r=this.resolveIndex_(n);if(r)return r.getIteratorFrom(e,s=>s);{const s=this.children_.getIteratorFrom(e.name,ht.Wrap);let i=s.peek();for(;i!=null&&n.compare(i,e)<0;)s.getNext(),i=s.peek();return s}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,n){const r=this.resolveIndex_(n);if(r)return r.getReverseIteratorFrom(e,s=>s);{const s=this.children_.getReverseIteratorFrom(e.name,ht.Wrap);let i=s.peek();for(;i!=null&&n.compare(i,e)>0;)s.getNext(),i=s.peek();return s}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Zl?-1:0}withIndex(e){if(e===No||this.indexMap_.hasIndex(e))return this;{const n=this.indexMap_.addIndex(e,this.children_);return new Ve(this.children_,this.priorityNode_,n)}}isIndexed(e){return e===No||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority()))if(this.children_.count()===n.children_.count()){const r=this.getIterator(Ft),s=n.getIterator(Ft);let i=r.getNext(),o=s.getNext();for(;i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=r.getNext(),o=s.getNext()}return i===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===No?null:this.indexMap_.get(e.toString())}}Ve.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class Tk extends Ve{constructor(){super(new Un(S0),Ve.EMPTY_NODE,rs.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Ve.EMPTY_NODE}isEmpty(){return!1}}const Zl=new Tk;Object.defineProperties(ht,{MIN:{value:new ht(Jo,Ve.EMPTY_NODE)},MAX:{value:new ht(Ui,Zl)}});Zb.__EMPTY_NODE=Ve.EMPTY_NODE;rn.__childrenNodeConstructor=Ve;_k(Zl);Ek(Zl);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ck=!0;function zt(t,e=null){if(t===null)return Ve.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),pe(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){const n=t;return new rn(n,zt(e))}if(!(t instanceof Array)&&Ck){const n=[];let r=!1;if(cn(t,(o,l)=>{if(o.substring(0,1)!=="."){const c=zt(l);c.isEmpty()||(r=r||!c.getPriority().isEmpty(),n.push(new ht(o,c)))}}),n.length===0)return Ve.EMPTY_NODE;const i=uu(n,xk,o=>o.name,S0);if(r){const o=uu(n,Ft.getCompare());return new Ve(i,zt(e),new rs({".priority":o},{".priority":Ft}))}else return new Ve(i,zt(e),rs.Default)}else{let n=Ve.EMPTY_NODE;return cn(t,(r,s)=>{if(Rr(t,r)&&r.substring(0,1)!=="."){const i=zt(s);(i.isLeafNode()||!i.isEmpty())&&(n=n.updateImmediateChild(r,i))}}),n.updatePriority(zt(e))}}bk(zt);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kk extends Xu{constructor(e){super(),this.indexPath_=e,pe(!ft(e)&&dt(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,n){const r=this.extractChild(e.node),s=this.extractChild(n.node),i=r.compareTo(s);return i===0?Vi(e.name,n.name):i}makePost(e,n){const r=zt(e),s=Ve.EMPTY_NODE.updateChild(this.indexPath_,r);return new ht(n,s)}maxPost(){const e=Ve.EMPTY_NODE.updateChild(this.indexPath_,Zl);return new ht(Ui,e)}toString(){return Dl(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rk extends Xu{compare(e,n){const r=e.node.compareTo(n.node);return r===0?Vi(e.name,n.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,n){return!e.equals(n)}minPost(){return ht.MIN}maxPost(){return ht.MAX}makePost(e,n){const r=zt(e);return new ht(n,r)}toString(){return".value"}}const Ak=new Rk;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sE(t){return{type:"value",snapshotNode:t}}function Qo(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function Ml(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function Nl(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}function Pk(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w0{constructor(e){this.index_=e}updateChild(e,n,r,s,i,o){pe(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const l=e.getImmediateChild(n);return l.getChild(s).equals(r.getChild(s))&&l.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(n)?o.trackChildChange(Ml(n,l)):pe(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):l.isEmpty()?o.trackChildChange(Qo(n,r)):o.trackChildChange(Nl(n,r,l))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(n,r).withIndex(this.index_)}updateFullNode(e,n,r){return r!=null&&(e.isLeafNode()||e.forEachChild(Ft,(s,i)=>{n.hasChild(s)||r.trackChildChange(Ml(s,i))}),n.isLeafNode()||n.forEachChild(Ft,(s,i)=>{if(e.hasChild(s)){const o=e.getImmediateChild(s);o.equals(i)||r.trackChildChange(Nl(s,i,o))}else r.trackChildChange(Qo(s,i))})),n.withIndex(this.index_)}updatePriority(e,n){return e.isEmpty()?Ve.EMPTY_NODE:e.updatePriority(n)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jl{constructor(e){this.indexedFilter_=new w0(e.getIndex()),this.index_=e.getIndex(),this.startPost_=jl.getStartPost_(e),this.endPost_=jl.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const n=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return n&&r}updateChild(e,n,r,s,i,o){return this.matches(new ht(n,r))||(r=Ve.EMPTY_NODE),this.indexedFilter_.updateChild(e,n,r,s,i,o)}updateFullNode(e,n,r){n.isLeafNode()&&(n=Ve.EMPTY_NODE);let s=n.withIndex(this.index_);s=s.updatePriority(Ve.EMPTY_NODE);const i=this;return n.forEachChild(Ft,(o,l)=>{i.matches(new ht(o,l))||(s=s.updateImmediateChild(o,Ve.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,r)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const n=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),n)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const n=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),n)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ok{constructor(e){this.withinDirectionalStart=n=>this.reverse_?this.withinEndPost(n):this.withinStartPost(n),this.withinDirectionalEnd=n=>this.reverse_?this.withinStartPost(n):this.withinEndPost(n),this.withinStartPost=n=>{const r=this.index_.compare(this.rangedFilter_.getStartPost(),n);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=n=>{const r=this.index_.compare(n,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new jl(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,n,r,s,i,o){return this.rangedFilter_.matches(new ht(n,r))||(r=Ve.EMPTY_NODE),e.getImmediateChild(n).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,n,r,s,i,o):this.fullLimitUpdateChild_(e,n,r,i,o)}updateFullNode(e,n,r){let s;if(n.isLeafNode()||n.isEmpty())s=Ve.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<n.numChildren()&&n.isIndexed(this.index_)){s=Ve.EMPTY_NODE.withIndex(this.index_);let i;this.reverse_?i=n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):i=n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;i.hasNext()&&o<this.limit_;){const l=i.getNext();if(this.withinDirectionalStart(l))if(this.withinDirectionalEnd(l))s=s.updateImmediateChild(l.name,l.node),o++;else break;else continue}}else{s=n.withIndex(this.index_),s=s.updatePriority(Ve.EMPTY_NODE);let i;this.reverse_?i=s.getReverseIterator(this.index_):i=s.getIterator(this.index_);let o=0;for(;i.hasNext();){const l=i.getNext();o<this.limit_&&this.withinDirectionalStart(l)&&this.withinDirectionalEnd(l)?o++:s=s.updateImmediateChild(l.name,Ve.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,r)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,n,r,s,i){let o;if(this.reverse_){const p=this.index_.getCompare();o=(f,S)=>p(S,f)}else o=this.index_.getCompare();const l=e;pe(l.numChildren()===this.limit_,"");const c=new ht(n,r),d=this.reverse_?l.getFirstChild(this.index_):l.getLastChild(this.index_),u=this.rangedFilter_.matches(c);if(l.hasChild(n)){const p=l.getImmediateChild(n);let f=s.getChildAfterChild(this.index_,d,this.reverse_);for(;f!=null&&(f.name===n||l.hasChild(f.name));)f=s.getChildAfterChild(this.index_,f,this.reverse_);const S=f==null?1:o(f,c);if(u&&!r.isEmpty()&&S>=0)return i!=null&&i.trackChildChange(Nl(n,r,p)),l.updateImmediateChild(n,r);{i!=null&&i.trackChildChange(Ml(n,p));const C=l.updateImmediateChild(n,Ve.EMPTY_NODE);return f!=null&&this.rangedFilter_.matches(f)?(i!=null&&i.trackChildChange(Qo(f.name,f.node)),C.updateImmediateChild(f.name,f.node)):C}}else return r.isEmpty()?e:u&&o(d,c)>=0?(i!=null&&(i.trackChildChange(Ml(d.name,d.node)),i.trackChildChange(Qo(n,r))),l.updateImmediateChild(n,r).updateImmediateChild(d.name,Ve.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I0{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Ft}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return pe(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return pe(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Jo}hasEnd(){return this.endSet_}getIndexEndValue(){return pe(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return pe(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Ui}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return pe(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Ft}copy(){const e=new I0;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function Lk(t){return t.loadsAllData()?new w0(t.getIndex()):t.hasLimit()?new Ok(t):new jl(t)}function $v(t){const e={};if(t.isDefault())return e;let n;if(t.index_===Ft?n="$priority":t.index_===Ak?n="$value":t.index_===No?n="$key":(pe(t.index_ instanceof kk,"Unrecognized index type!"),n=t.index_.toString()),e.orderBy=en(n),t.startSet_){const r=t.startAfterSet_?"startAfter":"startAt";e[r]=en(t.indexStartValue_),t.startNameSet_&&(e[r]+=","+en(t.indexStartName_))}if(t.endSet_){const r=t.endBeforeSet_?"endBefore":"endAt";e[r]=en(t.indexEndValue_),t.endNameSet_&&(e[r]+=","+en(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function Fv(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;n===""&&(t.isViewFromLeft()?n="l":n="r"),e.vf=n}return t.index_!==Ft&&(e.i=t.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fu extends Xb{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,n){return n!==void 0?"tag$"+n:(pe(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,n,r,s){super(),this.repoInfo_=e,this.onDataUpdate_=n,this.authTokenProvider_=r,this.appCheckTokenProvider_=s,this.log_=ql("p:rest:"),this.listens_={}}listen(e,n,r,s){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const o=fu.getListenId_(e,r),l={};this.listens_[o]=l;const c=$v(e._queryParams);this.restRequest_(i+".json",c,(d,u)=>{let p=u;if(d===404&&(p=null,d=null),d===null&&this.onDataUpdate_(i,p,!1,r),ji(this.listens_,o)===l){let f;d?d===401?f="permission_denied":f="rest_error:"+d:f="ok",s(f,null)}})}unlisten(e,n){const r=fu.getListenId_(e,n);delete this.listens_[r]}get(e){const n=$v(e._queryParams),r=e._path.toString(),s=new _r;return this.restRequest_(r+".json",n,(i,o)=>{let l=o;i===404&&(l=null,i=null),i===null?(this.onDataUpdate_(r,l,!1,null),s.resolve(l)):s.reject(new Error(l))}),s.promise}refreshAuthToken(e){}restRequest_(e,n={},r){return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,i])=>{s&&s.accessToken&&(n.auth=s.accessToken),i&&i.token&&(n.ac=i.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+aa(n);this.log_("Sending REST request for "+o);const l=new XMLHttpRequest;l.onreadystatechange=()=>{if(r&&l.readyState===4){this.log_("REST Response for "+o+" received. status:",l.status,"response:",l.responseText);let c=null;if(l.status>=200&&l.status<300){try{c=Pl(l.responseText)}catch{An("Failed to parse JSON response for "+o+": "+l.responseText)}r(null,c)}else l.status!==401&&l.status!==404&&An("Got unsuccessful REST response for "+o+" Status: "+l.status),r(l.status);r=null}},l.open("GET",o,!0),l.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dk{constructor(){this.rootNode_=Ve.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,n){this.rootNode_=this.rootNode_.updateChild(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hu(){return{value:null,children:new Map}}function da(t,e,n){if(ft(e))t.value=n,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,n);else{const r=dt(e);t.children.has(r)||t.children.set(r,hu());const s=t.children.get(r);e=Pt(e),da(s,e,n)}}function Up(t,e){if(ft(e))return t.value=null,t.children.clear(),!0;if(t.value!==null){if(t.value.isLeafNode())return!1;{const n=t.value;return t.value=null,n.forEachChild(Ft,(r,s)=>{da(t,new Tt(r),s)}),Up(t,e)}}else if(t.children.size>0){const n=dt(e);return e=Pt(e),t.children.has(n)&&Up(t.children.get(n),e)&&t.children.delete(n),t.children.size===0}else return!0}function Bp(t,e,n){t.value!==null?n(e,t.value):Mk(t,(r,s)=>{const i=new Tt(e.toString()+"/"+r);Bp(s,i,n)})}function Mk(t,e){t.children.forEach((n,r)=>{e(r,n)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nk{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),n={...e};return this.last_&&cn(this.last_,(r,s)=>{n[r]=n[r]-s}),this.last_=e,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uv=10*1e3,jk=30*1e3,$k=5*60*1e3;class Fk{constructor(e,n){this.server_=n,this.statsToReport_={},this.statsListener_=new Nk(e);const r=Uv+(jk-Uv)*Math.random();il(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),n={};let r=!1;cn(e,(s,i)=>{i>0&&Rr(this.statsToReport_,s)&&(n[s]=i,r=!0)}),r&&this.server_.reportStats(n),il(this.reportStats_.bind(this),Math.floor(Math.random()*2*$k))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Er;(function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Er||(Er={}));function T0(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function C0(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function k0(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pu{constructor(e,n,r){this.path=e,this.affectedTree=n,this.revert=r,this.type=Er.ACK_USER_WRITE,this.source=T0()}operationForChild(e){if(ft(this.path)){if(this.affectedTree.value!=null)return pe(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const n=this.affectedTree.subtree(new Tt(e));return new pu(_t(),n,this.revert)}}else return pe(dt(this.path)===e,"operationForChild called for unrelated child."),new pu(Pt(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $l{constructor(e,n){this.source=e,this.path=n,this.type=Er.LISTEN_COMPLETE}operationForChild(e){return ft(this.path)?new $l(this.source,_t()):new $l(this.source,Pt(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bi{constructor(e,n,r){this.source=e,this.path=n,this.snap=r,this.type=Er.OVERWRITE}operationForChild(e){return ft(this.path)?new Bi(this.source,_t(),this.snap.getImmediateChild(e)):new Bi(this.source,Pt(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qo{constructor(e,n,r){this.source=e,this.path=n,this.children=r,this.type=Er.MERGE}operationForChild(e){if(ft(this.path)){const n=this.children.subtree(new Tt(e));return n.isEmpty()?null:n.value?new Bi(this.source,_t(),n.value):new qo(this.source,_t(),n)}else return pe(dt(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new qo(this.source,Pt(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class si{constructor(e,n,r){this.node_=e,this.fullyInitialized_=n,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(ft(e))return this.isFullyInitialized()&&!this.filtered_;const n=dt(e);return this.isCompleteForChild(n)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uk{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Bk(t,e,n,r){const s=[],i=[];return e.forEach(o=>{o.type==="child_changed"&&t.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&i.push(Pk(o.childName,o.snapshotNode))}),Fa(t,s,"child_removed",e,r,n),Fa(t,s,"child_added",e,r,n),Fa(t,s,"child_moved",i,r,n),Fa(t,s,"child_changed",e,r,n),Fa(t,s,"value",e,r,n),s}function Fa(t,e,n,r,s,i){const o=r.filter(l=>l.type===n);o.sort((l,c)=>Hk(t,l,c)),o.forEach(l=>{const c=zk(t,l,i);s.forEach(d=>{d.respondsTo(l.type)&&e.push(d.createEvent(c,t.query_))})})}function zk(t,e,n){return e.type==="value"||e.type==="child_removed"||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function Hk(t,e,n){if(e.childName==null||n.childName==null)throw ia("Should only compare child_ events.");const r=new ht(e.childName,e.snapshotNode),s=new ht(n.childName,n.snapshotNode);return t.index_.compare(r,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ju(t,e){return{eventCache:t,serverCache:e}}function ol(t,e,n,r){return Ju(new si(e,n,r),t.serverCache)}function iE(t,e,n,r){return Ju(t.eventCache,new si(e,n,r))}function gu(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function zi(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ah;const Wk=()=>(Ah||(Ah=new Un(kC)),Ah);class Lt{static fromObject(e){let n=new Lt(null);return cn(e,(r,s)=>{n=n.set(new Tt(r),s)}),n}constructor(e,n=Wk()){this.value=e,this.children=n}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,n){if(this.value!=null&&n(this.value))return{path:_t(),value:this.value};if(ft(e))return null;{const r=dt(e),s=this.children.get(r);if(s!==null){const i=s.findRootMostMatchingPathAndValue(Pt(e),n);return i!=null?{path:Ht(new Tt(r),i.path),value:i.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(ft(e))return this;{const n=dt(e),r=this.children.get(n);return r!==null?r.subtree(Pt(e)):new Lt(null)}}set(e,n){if(ft(e))return new Lt(n,this.children);{const r=dt(e),i=(this.children.get(r)||new Lt(null)).set(Pt(e),n),o=this.children.insert(r,i);return new Lt(this.value,o)}}remove(e){if(ft(e))return this.children.isEmpty()?new Lt(null):new Lt(null,this.children);{const n=dt(e),r=this.children.get(n);if(r){const s=r.remove(Pt(e));let i;return s.isEmpty()?i=this.children.remove(n):i=this.children.insert(n,s),this.value===null&&i.isEmpty()?new Lt(null):new Lt(this.value,i)}else return this}}get(e){if(ft(e))return this.value;{const n=dt(e),r=this.children.get(n);return r?r.get(Pt(e)):null}}setTree(e,n){if(ft(e))return n;{const r=dt(e),i=(this.children.get(r)||new Lt(null)).setTree(Pt(e),n);let o;return i.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,i),new Lt(this.value,o)}}fold(e){return this.fold_(_t(),e)}fold_(e,n){const r={};return this.children.inorderTraversal((s,i)=>{r[s]=i.fold_(Ht(e,s),n)}),n(e,this.value,r)}findOnPath(e,n){return this.findOnPath_(e,_t(),n)}findOnPath_(e,n,r){const s=this.value?r(n,this.value):!1;if(s)return s;if(ft(e))return null;{const i=dt(e),o=this.children.get(i);return o?o.findOnPath_(Pt(e),Ht(n,i),r):null}}foreachOnPath(e,n){return this.foreachOnPath_(e,_t(),n)}foreachOnPath_(e,n,r){if(ft(e))return this;{this.value&&r(n,this.value);const s=dt(e),i=this.children.get(s);return i?i.foreachOnPath_(Pt(e),Ht(n,s),r):new Lt(null)}}foreach(e){this.foreach_(_t(),e)}foreach_(e,n){this.children.inorderTraversal((r,s)=>{s.foreach_(Ht(e,r),n)}),this.value&&n(e,this.value)}foreachChild(e){this.children.inorderTraversal((n,r)=>{r.value&&e(n,r.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tr{constructor(e){this.writeTree_=e}static empty(){return new Tr(new Lt(null))}}function al(t,e,n){if(ft(e))return new Tr(new Lt(n));{const r=t.writeTree_.findRootMostValueAndPath(e);if(r!=null){const s=r.path;let i=r.value;const o=kn(s,e);return i=i.updateChild(o,n),new Tr(t.writeTree_.set(s,i))}else{const s=new Lt(n),i=t.writeTree_.setTree(e,s);return new Tr(i)}}}function zp(t,e,n){let r=t;return cn(n,(s,i)=>{r=al(r,Ht(e,s),i)}),r}function Bv(t,e){if(ft(e))return Tr.empty();{const n=t.writeTree_.setTree(e,new Lt(null));return new Tr(n)}}function Hp(t,e){return Yi(t,e)!=null}function Yi(t,e){const n=t.writeTree_.findRootMostValueAndPath(e);return n!=null?t.writeTree_.get(n.path).getChild(kn(n.path,e)):null}function zv(t){const e=[],n=t.writeTree_.value;return n!=null?n.isLeafNode()||n.forEachChild(Ft,(r,s)=>{e.push(new ht(r,s))}):t.writeTree_.children.inorderTraversal((r,s)=>{s.value!=null&&e.push(new ht(r,s.value))}),e}function qs(t,e){if(ft(e))return t;{const n=Yi(t,e);return n!=null?new Tr(new Lt(n)):new Tr(t.writeTree_.subtree(e))}}function Wp(t){return t.writeTree_.isEmpty()}function Zo(t,e){return oE(_t(),t.writeTree_,e)}function oE(t,e,n){if(e.value!=null)return n.updateChild(t,e.value);{let r=null;return e.children.inorderTraversal((s,i)=>{s===".priority"?(pe(i.value!==null,"Priority writes must always be leaf nodes"),r=i.value):n=oE(Ht(t,s),i,n)}),!n.getChild(t).isEmpty()&&r!==null&&(n=n.updateChild(Ht(t,".priority"),r)),n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qu(t,e){return dE(e,t)}function Gk(t,e,n,r,s){pe(r>t.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),t.allWrites.push({path:e,snap:n,writeId:r,visible:s}),s&&(t.visibleWrites=al(t.visibleWrites,e,n)),t.lastWriteId=r}function Vk(t,e,n,r){pe(r>t.lastWriteId,"Stacking an older merge on top of newer ones"),t.allWrites.push({path:e,children:n,writeId:r,visible:!0}),t.visibleWrites=zp(t.visibleWrites,e,n),t.lastWriteId=r}function Yk(t,e){for(let n=0;n<t.allWrites.length;n++){const r=t.allWrites[n];if(r.writeId===e)return r}return null}function Kk(t,e){const n=t.allWrites.findIndex(l=>l.writeId===e);pe(n>=0,"removeWrite called with nonexistent writeId.");const r=t.allWrites[n];t.allWrites.splice(n,1);let s=r.visible,i=!1,o=t.allWrites.length-1;for(;s&&o>=0;){const l=t.allWrites[o];l.visible&&(o>=n&&Xk(l,r.path)?s=!1:lr(r.path,l.path)&&(i=!0)),o--}if(s){if(i)return Jk(t),!0;if(r.snap)t.visibleWrites=Bv(t.visibleWrites,r.path);else{const l=r.children;cn(l,c=>{t.visibleWrites=Bv(t.visibleWrites,Ht(r.path,c))})}return!0}else return!1}function Xk(t,e){if(t.snap)return lr(t.path,e);for(const n in t.children)if(t.children.hasOwnProperty(n)&&lr(Ht(t.path,n),e))return!0;return!1}function Jk(t){t.visibleWrites=aE(t.allWrites,Qk,_t()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function Qk(t){return t.visible}function aE(t,e,n){let r=Tr.empty();for(let s=0;s<t.length;++s){const i=t[s];if(e(i)){const o=i.path;let l;if(i.snap)lr(n,o)?(l=kn(n,o),r=al(r,l,i.snap)):lr(o,n)&&(l=kn(o,n),r=al(r,_t(),i.snap.getChild(l)));else if(i.children){if(lr(n,o))l=kn(n,o),r=zp(r,l,i.children);else if(lr(o,n))if(l=kn(o,n),ft(l))r=zp(r,_t(),i.children);else{const c=ji(i.children,dt(l));if(c){const d=c.getChild(Pt(l));r=al(r,_t(),d)}}}else throw ia("WriteRecord should have .snap or .children")}}return r}function lE(t,e,n,r,s){if(!r&&!s){const i=Yi(t.visibleWrites,e);if(i!=null)return i;{const o=qs(t.visibleWrites,e);if(Wp(o))return n;if(n==null&&!Hp(o,_t()))return null;{const l=n||Ve.EMPTY_NODE;return Zo(o,l)}}}else{const i=qs(t.visibleWrites,e);if(!s&&Wp(i))return n;if(!s&&n==null&&!Hp(i,_t()))return null;{const o=function(d){return(d.visible||s)&&(!r||!~r.indexOf(d.writeId))&&(lr(d.path,e)||lr(e,d.path))},l=aE(t.allWrites,o,e),c=n||Ve.EMPTY_NODE;return Zo(l,c)}}}function qk(t,e,n){let r=Ve.EMPTY_NODE;const s=Yi(t.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(Ft,(i,o)=>{r=r.updateImmediateChild(i,o)}),r;if(n){const i=qs(t.visibleWrites,e);return n.forEachChild(Ft,(o,l)=>{const c=Zo(qs(i,new Tt(o)),l);r=r.updateImmediateChild(o,c)}),zv(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{const i=qs(t.visibleWrites,e);return zv(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function Zk(t,e,n,r,s){pe(r||s,"Either existingEventSnap or existingServerSnap must exist");const i=Ht(e,n);if(Hp(t.visibleWrites,i))return null;{const o=qs(t.visibleWrites,i);return Wp(o)?s.getChild(n):Zo(o,s.getChild(n))}}function eR(t,e,n,r){const s=Ht(e,n),i=Yi(t.visibleWrites,s);if(i!=null)return i;if(r.isCompleteForChild(n)){const o=qs(t.visibleWrites,s);return Zo(o,r.getNode().getImmediateChild(n))}else return null}function tR(t,e){return Yi(t.visibleWrites,e)}function nR(t,e,n,r,s,i,o){let l;const c=qs(t.visibleWrites,e),d=Yi(c,_t());if(d!=null)l=d;else if(n!=null)l=Zo(c,n);else return[];if(l=l.withIndex(o),!l.isEmpty()&&!l.isLeafNode()){const u=[],p=o.getCompare(),f=i?l.getReverseIteratorFrom(r,o):l.getIteratorFrom(r,o);let S=f.getNext();for(;S&&u.length<s;)p(S,r)!==0&&u.push(S),S=f.getNext();return u}else return[]}function rR(){return{visibleWrites:Tr.empty(),allWrites:[],lastWriteId:-1}}function mu(t,e,n,r){return lE(t.writeTree,t.treePath,e,n,r)}function R0(t,e){return qk(t.writeTree,t.treePath,e)}function Hv(t,e,n,r){return Zk(t.writeTree,t.treePath,e,n,r)}function yu(t,e){return tR(t.writeTree,Ht(t.treePath,e))}function sR(t,e,n,r,s,i){return nR(t.writeTree,t.treePath,e,n,r,s,i)}function A0(t,e,n){return eR(t.writeTree,t.treePath,e,n)}function cE(t,e){return dE(Ht(t.treePath,e),t.writeTree)}function dE(t,e){return{treePath:t,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iR{constructor(){this.changeMap=new Map}trackChildChange(e){const n=e.type,r=e.childName;pe(n==="child_added"||n==="child_changed"||n==="child_removed","Only child changes supported for tracking"),pe(r!==".priority","Only non-priority child changes can be tracked.");const s=this.changeMap.get(r);if(s){const i=s.type;if(n==="child_added"&&i==="child_removed")this.changeMap.set(r,Nl(r,e.snapshotNode,s.snapshotNode));else if(n==="child_removed"&&i==="child_added")this.changeMap.delete(r);else if(n==="child_removed"&&i==="child_changed")this.changeMap.set(r,Ml(r,s.oldSnap));else if(n==="child_changed"&&i==="child_added")this.changeMap.set(r,Qo(r,e.snapshotNode));else if(n==="child_changed"&&i==="child_changed")this.changeMap.set(r,Nl(r,e.snapshotNode,s.oldSnap));else throw ia("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oR{getCompleteChild(e){return null}getChildAfterChild(e,n,r){return null}}const uE=new oR;class P0{constructor(e,n,r=null){this.writes_=e,this.viewCache_=n,this.optCompleteServerCache_=r}getCompleteChild(e){const n=this.viewCache_.eventCache;if(n.isCompleteForChild(e))return n.getNode().getImmediateChild(e);{const r=this.optCompleteServerCache_!=null?new si(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return A0(this.writes_,e,r)}}getChildAfterChild(e,n,r){const s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:zi(this.viewCache_),i=sR(this.writes_,s,n,1,r,e);return i.length===0?null:i[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aR(t){return{filter:t}}function lR(t,e){pe(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),pe(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function cR(t,e,n,r,s){const i=new iR;let o,l;if(n.type===Er.OVERWRITE){const d=n;d.source.fromUser?o=Gp(t,e,d.path,d.snap,r,s,i):(pe(d.source.fromServer,"Unknown source."),l=d.source.tagged||e.serverCache.isFiltered()&&!ft(d.path),o=vu(t,e,d.path,d.snap,r,s,l,i))}else if(n.type===Er.MERGE){const d=n;d.source.fromUser?o=uR(t,e,d.path,d.children,r,s,i):(pe(d.source.fromServer,"Unknown source."),l=d.source.tagged||e.serverCache.isFiltered(),o=Vp(t,e,d.path,d.children,r,s,l,i))}else if(n.type===Er.ACK_USER_WRITE){const d=n;d.revert?o=pR(t,e,d.path,r,s,i):o=fR(t,e,d.path,d.affectedTree,r,s,i)}else if(n.type===Er.LISTEN_COMPLETE)o=hR(t,e,n.path,r,i);else throw ia("Unknown operation type: "+n.type);const c=i.getChanges();return dR(e,o,c),{viewCache:o,changes:c}}function dR(t,e,n){const r=e.eventCache;if(r.isFullyInitialized()){const s=r.getNode().isLeafNode()||r.getNode().isEmpty(),i=gu(t);(n.length>0||!t.eventCache.isFullyInitialized()||s&&!r.getNode().equals(i)||!r.getNode().getPriority().equals(i.getPriority()))&&n.push(sE(gu(e)))}}function fE(t,e,n,r,s,i){const o=e.eventCache;if(yu(r,n)!=null)return e;{let l,c;if(ft(n))if(pe(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const d=zi(e),u=d instanceof Ve?d:Ve.EMPTY_NODE,p=R0(r,u);l=t.filter.updateFullNode(e.eventCache.getNode(),p,i)}else{const d=mu(r,zi(e));l=t.filter.updateFullNode(e.eventCache.getNode(),d,i)}else{const d=dt(n);if(d===".priority"){pe(ri(n)===1,"Can't have a priority with additional path components");const u=o.getNode();c=e.serverCache.getNode();const p=Hv(r,n,u,c);p!=null?l=t.filter.updatePriority(u,p):l=o.getNode()}else{const u=Pt(n);let p;if(o.isCompleteForChild(d)){c=e.serverCache.getNode();const f=Hv(r,n,o.getNode(),c);f!=null?p=o.getNode().getImmediateChild(d).updateChild(u,f):p=o.getNode().getImmediateChild(d)}else p=A0(r,d,e.serverCache);p!=null?l=t.filter.updateChild(o.getNode(),d,p,u,s,i):l=o.getNode()}}return ol(e,l,o.isFullyInitialized()||ft(n),t.filter.filtersNodes())}}function vu(t,e,n,r,s,i,o,l){const c=e.serverCache;let d;const u=o?t.filter:t.filter.getIndexedFilter();if(ft(n))d=u.updateFullNode(c.getNode(),r,null);else if(u.filtersNodes()&&!c.isFiltered()){const S=c.getNode().updateChild(n,r);d=u.updateFullNode(c.getNode(),S,null)}else{const S=dt(n);if(!c.isCompleteForPath(n)&&ri(n)>1)return e;const R=Pt(n),j=c.getNode().getImmediateChild(S).updateChild(R,r);S===".priority"?d=u.updatePriority(c.getNode(),j):d=u.updateChild(c.getNode(),S,j,R,uE,null)}const p=iE(e,d,c.isFullyInitialized()||ft(n),u.filtersNodes()),f=new P0(s,p,i);return fE(t,p,n,s,f,l)}function Gp(t,e,n,r,s,i,o){const l=e.eventCache;let c,d;const u=new P0(s,e,i);if(ft(n))d=t.filter.updateFullNode(e.eventCache.getNode(),r,o),c=ol(e,d,!0,t.filter.filtersNodes());else{const p=dt(n);if(p===".priority")d=t.filter.updatePriority(e.eventCache.getNode(),r),c=ol(e,d,l.isFullyInitialized(),l.isFiltered());else{const f=Pt(n),S=l.getNode().getImmediateChild(p);let R;if(ft(f))R=r;else{const C=u.getCompleteChild(p);C!=null?_0(f)===".priority"&&C.getChild(Qb(f)).isEmpty()?R=C:R=C.updateChild(f,r):R=Ve.EMPTY_NODE}if(S.equals(R))c=e;else{const C=t.filter.updateChild(l.getNode(),p,R,f,u,o);c=ol(e,C,l.isFullyInitialized(),t.filter.filtersNodes())}}}return c}function Wv(t,e){return t.eventCache.isCompleteForChild(e)}function uR(t,e,n,r,s,i,o){let l=e;return r.foreach((c,d)=>{const u=Ht(n,c);Wv(e,dt(u))&&(l=Gp(t,l,u,d,s,i,o))}),r.foreach((c,d)=>{const u=Ht(n,c);Wv(e,dt(u))||(l=Gp(t,l,u,d,s,i,o))}),l}function Gv(t,e,n){return n.foreach((r,s)=>{e=e.updateChild(r,s)}),e}function Vp(t,e,n,r,s,i,o,l){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,d;ft(n)?d=r:d=new Lt(null).setTree(n,r);const u=e.serverCache.getNode();return d.children.inorderTraversal((p,f)=>{if(u.hasChild(p)){const S=e.serverCache.getNode().getImmediateChild(p),R=Gv(t,S,f);c=vu(t,c,new Tt(p),R,s,i,o,l)}}),d.children.inorderTraversal((p,f)=>{const S=!e.serverCache.isCompleteForChild(p)&&f.value===null;if(!u.hasChild(p)&&!S){const R=e.serverCache.getNode().getImmediateChild(p),C=Gv(t,R,f);c=vu(t,c,new Tt(p),C,s,i,o,l)}}),c}function fR(t,e,n,r,s,i,o){if(yu(s,n)!=null)return e;const l=e.serverCache.isFiltered(),c=e.serverCache;if(r.value!=null){if(ft(n)&&c.isFullyInitialized()||c.isCompleteForPath(n))return vu(t,e,n,c.getNode().getChild(n),s,i,l,o);if(ft(n)){let d=new Lt(null);return c.getNode().forEachChild(No,(u,p)=>{d=d.set(new Tt(u),p)}),Vp(t,e,n,d,s,i,l,o)}else return e}else{let d=new Lt(null);return r.foreach((u,p)=>{const f=Ht(n,u);c.isCompleteForPath(f)&&(d=d.set(u,c.getNode().getChild(f)))}),Vp(t,e,n,d,s,i,l,o)}}function hR(t,e,n,r,s){const i=e.serverCache,o=iE(e,i.getNode(),i.isFullyInitialized()||ft(n),i.isFiltered());return fE(t,o,n,r,uE,s)}function pR(t,e,n,r,s,i){let o;if(yu(r,n)!=null)return e;{const l=new P0(r,e,s),c=e.eventCache.getNode();let d;if(ft(n)||dt(n)===".priority"){let u;if(e.serverCache.isFullyInitialized())u=mu(r,zi(e));else{const p=e.serverCache.getNode();pe(p instanceof Ve,"serverChildren would be complete if leaf node"),u=R0(r,p)}u=u,d=t.filter.updateFullNode(c,u,i)}else{const u=dt(n);let p=A0(r,u,e.serverCache);p==null&&e.serverCache.isCompleteForChild(u)&&(p=c.getImmediateChild(u)),p!=null?d=t.filter.updateChild(c,u,p,Pt(n),l,i):e.eventCache.getNode().hasChild(u)?d=t.filter.updateChild(c,u,Ve.EMPTY_NODE,Pt(n),l,i):d=c,d.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=mu(r,zi(e)),o.isLeafNode()&&(d=t.filter.updateFullNode(d,o,i)))}return o=e.serverCache.isFullyInitialized()||yu(r,_t())!=null,ol(e,d,o,t.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gR{constructor(e,n){this.query_=e,this.eventRegistrations_=[];const r=this.query_._queryParams,s=new w0(r.getIndex()),i=Lk(r);this.processor_=aR(i);const o=n.serverCache,l=n.eventCache,c=s.updateFullNode(Ve.EMPTY_NODE,o.getNode(),null),d=i.updateFullNode(Ve.EMPTY_NODE,l.getNode(),null),u=new si(c,o.isFullyInitialized(),s.filtersNodes()),p=new si(d,l.isFullyInitialized(),i.filtersNodes());this.viewCache_=Ju(p,u),this.eventGenerator_=new Uk(this.query_)}get query(){return this.query_}}function mR(t){return t.viewCache_.serverCache.getNode()}function yR(t){return gu(t.viewCache_)}function vR(t,e){const n=zi(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!ft(e)&&!n.getImmediateChild(dt(e)).isEmpty())?n.getChild(e):null}function Vv(t){return t.eventRegistrations_.length===0}function xR(t,e){t.eventRegistrations_.push(e)}function Yv(t,e,n){const r=[];if(n){pe(e==null,"A cancel should cancel all event registrations.");const s=t.query._path;t.eventRegistrations_.forEach(i=>{const o=i.createCancelEvent(n,s);o&&r.push(o)})}if(e){let s=[];for(let i=0;i<t.eventRegistrations_.length;++i){const o=t.eventRegistrations_[i];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(t.eventRegistrations_.slice(i+1));break}}t.eventRegistrations_=s}else t.eventRegistrations_=[];return r}function Kv(t,e,n,r){e.type===Er.MERGE&&e.source.queryId!==null&&(pe(zi(t.viewCache_),"We should always have a full cache before handling merges"),pe(gu(t.viewCache_),"Missing event cache, even though we have a server cache"));const s=t.viewCache_,i=cR(t.processor_,s,e,n,r);return lR(t.processor_,i.viewCache),pe(i.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=i.viewCache,hE(t,i.changes,i.viewCache.eventCache.getNode(),null)}function _R(t,e){const n=t.viewCache_.eventCache,r=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(Ft,(i,o)=>{r.push(Qo(i,o))}),n.isFullyInitialized()&&r.push(sE(n.getNode())),hE(t,r,n.getNode(),e)}function hE(t,e,n,r){const s=r?[r]:t.eventRegistrations_;return Bk(t.eventGenerator_,e,n,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let xu;class pE{constructor(){this.views=new Map}}function bR(t){pe(!xu,"__referenceConstructor has already been defined"),xu=t}function ER(){return pe(xu,"Reference.ts has not been loaded"),xu}function SR(t){return t.views.size===0}function O0(t,e,n,r){const s=e.source.queryId;if(s!==null){const i=t.views.get(s);return pe(i!=null,"SyncTree gave us an op for an invalid query."),Kv(i,e,n,r)}else{let i=[];for(const o of t.views.values())i=i.concat(Kv(o,e,n,r));return i}}function gE(t,e,n,r,s){const i=e._queryIdentifier,o=t.views.get(i);if(!o){let l=mu(n,s?r:null),c=!1;l?c=!0:r instanceof Ve?(l=R0(n,r),c=!1):(l=Ve.EMPTY_NODE,c=!1);const d=Ju(new si(l,c,!1),new si(r,s,!1));return new gR(e,d)}return o}function wR(t,e,n,r,s,i){const o=gE(t,e,r,s,i);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,o),xR(o,n),_R(o,n)}function IR(t,e,n,r){const s=e._queryIdentifier,i=[];let o=[];const l=ii(t);if(s==="default")for(const[c,d]of t.views.entries())o=o.concat(Yv(d,n,r)),Vv(d)&&(t.views.delete(c),d.query._queryParams.loadsAllData()||i.push(d.query));else{const c=t.views.get(s);c&&(o=o.concat(Yv(c,n,r)),Vv(c)&&(t.views.delete(s),c.query._queryParams.loadsAllData()||i.push(c.query)))}return l&&!ii(t)&&i.push(new(ER())(e._repo,e._path)),{removed:i,events:o}}function mE(t){const e=[];for(const n of t.views.values())n.query._queryParams.loadsAllData()||e.push(n);return e}function Zs(t,e){let n=null;for(const r of t.views.values())n=n||vR(r,e);return n}function yE(t,e){if(e._queryParams.loadsAllData())return qu(t);{const r=e._queryIdentifier;return t.views.get(r)}}function vE(t,e){return yE(t,e)!=null}function ii(t){return qu(t)!=null}function qu(t){for(const e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _u;function TR(t){pe(!_u,"__referenceConstructor has already been defined"),_u=t}function CR(){return pe(_u,"Reference.ts has not been loaded"),_u}let kR=1;class Xv{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Lt(null),this.pendingWriteTree_=rR(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function L0(t,e,n,r,s){return Gk(t.pendingWriteTree_,e,n,r,s),s?ua(t,new Bi(T0(),e,n)):[]}function RR(t,e,n,r){Vk(t.pendingWriteTree_,e,n,r);const s=Lt.fromObject(n);return ua(t,new qo(T0(),e,s))}function $s(t,e,n=!1){const r=Yk(t.pendingWriteTree_,e);if(Kk(t.pendingWriteTree_,e)){let i=new Lt(null);return r.snap!=null?i=i.set(_t(),!0):cn(r.children,o=>{i=i.set(new Tt(o),!0)}),ua(t,new pu(r.path,i,n))}else return[]}function ec(t,e,n){return ua(t,new Bi(C0(),e,n))}function AR(t,e,n){const r=Lt.fromObject(n);return ua(t,new qo(C0(),e,r))}function PR(t,e){return ua(t,new $l(C0(),e))}function OR(t,e,n){const r=D0(t,n);if(r){const s=M0(r),i=s.path,o=s.queryId,l=kn(i,e),c=new $l(k0(o),l);return N0(t,i,c)}else return[]}function bu(t,e,n,r,s=!1){const i=e._path,o=t.syncPointTree_.get(i);let l=[];if(o&&(e._queryIdentifier==="default"||vE(o,e))){const c=IR(o,e,n,r);SR(o)&&(t.syncPointTree_=t.syncPointTree_.remove(i));const d=c.removed;if(l=c.events,!s){const u=d.findIndex(f=>f._queryParams.loadsAllData())!==-1,p=t.syncPointTree_.findOnPath(i,(f,S)=>ii(S));if(u&&!p){const f=t.syncPointTree_.subtree(i);if(!f.isEmpty()){const S=MR(f);for(let R=0;R<S.length;++R){const C=S[R],j=C.query,_=EE(t,C);t.listenProvider_.startListening(ll(j),Fl(t,j),_.hashFn,_.onComplete)}}}!p&&d.length>0&&!r&&(u?t.listenProvider_.stopListening(ll(e),null):d.forEach(f=>{const S=t.queryToTagMap.get(ef(f));t.listenProvider_.stopListening(ll(f),S)}))}NR(t,d)}return l}function xE(t,e,n,r){const s=D0(t,r);if(s!=null){const i=M0(s),o=i.path,l=i.queryId,c=kn(o,e),d=new Bi(k0(l),c,n);return N0(t,o,d)}else return[]}function LR(t,e,n,r){const s=D0(t,r);if(s){const i=M0(s),o=i.path,l=i.queryId,c=kn(o,e),d=Lt.fromObject(n),u=new qo(k0(l),c,d);return N0(t,o,u)}else return[]}function Yp(t,e,n,r=!1){const s=e._path;let i=null,o=!1;t.syncPointTree_.foreachOnPath(s,(f,S)=>{const R=kn(f,s);i=i||Zs(S,R),o=o||ii(S)});let l=t.syncPointTree_.get(s);l?(o=o||ii(l),i=i||Zs(l,_t())):(l=new pE,t.syncPointTree_=t.syncPointTree_.set(s,l));let c;i!=null?c=!0:(c=!1,i=Ve.EMPTY_NODE,t.syncPointTree_.subtree(s).foreachChild((S,R)=>{const C=Zs(R,_t());C&&(i=i.updateImmediateChild(S,C))}));const d=vE(l,e);if(!d&&!e._queryParams.loadsAllData()){const f=ef(e);pe(!t.queryToTagMap.has(f),"View does not exist, but we have a tag");const S=jR();t.queryToTagMap.set(f,S),t.tagToQueryMap.set(S,f)}const u=Qu(t.pendingWriteTree_,s);let p=wR(l,e,n,u,i,c);if(!d&&!o&&!r){const f=yE(l,e);p=p.concat($R(t,e,f))}return p}function Zu(t,e,n){const s=t.pendingWriteTree_,i=t.syncPointTree_.findOnPath(e,(o,l)=>{const c=kn(o,e),d=Zs(l,c);if(d)return d});return lE(s,e,i,n,!0)}function DR(t,e){const n=e._path;let r=null;t.syncPointTree_.foreachOnPath(n,(d,u)=>{const p=kn(d,n);r=r||Zs(u,p)});let s=t.syncPointTree_.get(n);s?r=r||Zs(s,_t()):(s=new pE,t.syncPointTree_=t.syncPointTree_.set(n,s));const i=r!=null,o=i?new si(r,!0,!1):null,l=Qu(t.pendingWriteTree_,e._path),c=gE(s,e,l,i?o.getNode():Ve.EMPTY_NODE,i);return yR(c)}function ua(t,e){return _E(e,t.syncPointTree_,null,Qu(t.pendingWriteTree_,_t()))}function _E(t,e,n,r){if(ft(t.path))return bE(t,e,n,r);{const s=e.get(_t());n==null&&s!=null&&(n=Zs(s,_t()));let i=[];const o=dt(t.path),l=t.operationForChild(o),c=e.children.get(o);if(c&&l){const d=n?n.getImmediateChild(o):null,u=cE(r,o);i=i.concat(_E(l,c,d,u))}return s&&(i=i.concat(O0(s,t,r,n))),i}}function bE(t,e,n,r){const s=e.get(_t());n==null&&s!=null&&(n=Zs(s,_t()));let i=[];return e.children.inorderTraversal((o,l)=>{const c=n?n.getImmediateChild(o):null,d=cE(r,o),u=t.operationForChild(o);u&&(i=i.concat(bE(u,l,c,d)))}),s&&(i=i.concat(O0(s,t,r,n))),i}function EE(t,e){const n=e.query,r=Fl(t,n);return{hashFn:()=>(mR(e)||Ve.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return r?OR(t,n._path,r):PR(t,n._path);{const i=PC(s,n);return bu(t,n,null,i)}}}}function Fl(t,e){const n=ef(e);return t.queryToTagMap.get(n)}function ef(t){return t._path.toString()+"$"+t._queryIdentifier}function D0(t,e){return t.tagToQueryMap.get(e)}function M0(t){const e=t.indexOf("$");return pe(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new Tt(t.substr(0,e))}}function N0(t,e,n){const r=t.syncPointTree_.get(e);pe(r,"Missing sync point for query tag that we're tracking");const s=Qu(t.pendingWriteTree_,e);return O0(r,n,s,null)}function MR(t){return t.fold((e,n,r)=>{if(n&&ii(n))return[qu(n)];{let s=[];return n&&(s=mE(n)),cn(r,(i,o)=>{s=s.concat(o)}),s}})}function ll(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(CR())(t._repo,t._path):t}function NR(t,e){for(let n=0;n<e.length;++n){const r=e[n];if(!r._queryParams.loadsAllData()){const s=ef(r),i=t.queryToTagMap.get(s);t.queryToTagMap.delete(s),t.tagToQueryMap.delete(i)}}}function jR(){return kR++}function $R(t,e,n){const r=e._path,s=Fl(t,e),i=EE(t,n),o=t.listenProvider_.startListening(ll(e),s,i.hashFn,i.onComplete),l=t.syncPointTree_.subtree(r);if(s)pe(!ii(l.value),"If we're adding a query, it shouldn't be shadowed");else{const c=l.fold((d,u,p)=>{if(!ft(d)&&u&&ii(u))return[qu(u).query];{let f=[];return u&&(f=f.concat(mE(u).map(S=>S.query))),cn(p,(S,R)=>{f=f.concat(R)}),f}});for(let d=0;d<c.length;++d){const u=c[d];t.listenProvider_.stopListening(ll(u),Fl(t,u))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j0{constructor(e){this.node_=e}getImmediateChild(e){const n=this.node_.getImmediateChild(e);return new j0(n)}node(){return this.node_}}class $0{constructor(e,n){this.syncTree_=e,this.path_=n}getImmediateChild(e){const n=Ht(this.path_,e);return new $0(this.syncTree_,n)}node(){return Zu(this.syncTree_,this.path_)}}const FR=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},Jv=function(t,e,n){if(!t||typeof t!="object")return t;if(pe(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return UR(t[".sv"],e,n);if(typeof t[".sv"]=="object")return BR(t[".sv"],e);pe(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},UR=function(t,e,n){switch(t){case"timestamp":return n.timestamp;default:pe(!1,"Unexpected server value: "+t)}},BR=function(t,e,n){t.hasOwnProperty("increment")||pe(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const r=t.increment;typeof r!="number"&&pe(!1,"Unexpected increment value: "+r);const s=e.node();if(pe(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return r;const o=s.getValue();return typeof o!="number"?r:o+r},SE=function(t,e,n,r){return U0(e,new $0(n,t),r)},F0=function(t,e,n){return U0(t,new j0(e),n)};function U0(t,e,n){const r=t.getPriority().val(),s=Jv(r,e.getImmediateChild(".priority"),n);let i;if(t.isLeafNode()){const o=t,l=Jv(o.getValue(),e,n);return l!==o.getValue()||s!==o.getPriority().val()?new rn(l,zt(s)):t}else{const o=t;return i=o,s!==o.getPriority().val()&&(i=i.updatePriority(new rn(s))),o.forEachChild(Ft,(l,c)=>{const d=U0(c,e.getImmediateChild(l),n);d!==c&&(i=i.updateImmediateChild(l,d))}),i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B0{constructor(e="",n=null,r={children:{},childCount:0}){this.name=e,this.parent=n,this.node=r}}function tf(t,e){let n=e instanceof Tt?e:new Tt(e),r=t,s=dt(n);for(;s!==null;){const i=ji(r.node.children,s)||{children:{},childCount:0};r=new B0(s,r,i),n=Pt(n),s=dt(n)}return r}function Ki(t){return t.node.value}function z0(t,e){t.node.value=e,Kp(t)}function wE(t){return t.node.childCount>0}function zR(t){return Ki(t)===void 0&&!wE(t)}function nf(t,e){cn(t.node.children,(n,r)=>{e(new B0(n,t,r))})}function IE(t,e,n,r){n&&e(t),nf(t,s=>{IE(s,e,!0)})}function HR(t,e,n){let r=t.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function tc(t){return new Tt(t.parent===null?t.name:tc(t.parent)+"/"+t.name)}function Kp(t){t.parent!==null&&WR(t.parent,t.name,t)}function WR(t,e,n){const r=zR(n),s=Rr(t.node.children,e);r&&s?(delete t.node.children[e],t.node.childCount--,Kp(t)):!r&&!s&&(t.node.children[e]=n.node,t.node.childCount++,Kp(t))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GR=/[\[\].#$\/\u0000-\u001F\u007F]/,VR=/[\[\].#$\u0000-\u001F\u007F]/,Ph=10*1024*1024,H0=function(t){return typeof t=="string"&&t.length!==0&&!GR.test(t)},TE=function(t){return typeof t=="string"&&t.length!==0&&!VR.test(t)},YR=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),TE(t)},W0=function(t){return t===null||typeof t=="string"||typeof t=="number"&&!Ku(t)||t&&typeof t=="object"&&Rr(t,".sv")},Eu=function(t,e,n,r){r&&e===void 0||nc(Ko(t,"value"),e,n)},nc=function(t,e,n){const r=n instanceof Tt?new uk(n,t):n;if(e===void 0)throw new Error(t+"contains undefined "+wi(r));if(typeof e=="function")throw new Error(t+"contains a function "+wi(r)+" with contents = "+e.toString());if(Ku(e))throw new Error(t+"contains "+e.toString()+" "+wi(r));if(typeof e=="string"&&e.length>Ph/3&&Yu(e)>Ph)throw new Error(t+"contains a string greater than "+Ph+" utf8 bytes "+wi(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,i=!1;if(cn(e,(o,l)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(i=!0,!H0(o)))throw new Error(t+" contains an invalid key ("+o+") "+wi(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);fk(r,o),nc(t,l,r),hk(r)}),s&&i)throw new Error(t+' contains ".value" child '+wi(r)+" in addition to actual children.")}},KR=function(t,e){let n,r;for(n=0;n<e.length;n++){r=e[n];const i=Dl(r);for(let o=0;o<i.length;o++)if(!(i[o]===".priority"&&o===i.length-1)){if(!H0(i[o]))throw new Error(t+"contains an invalid key ("+i[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(dk);let s=null;for(n=0;n<e.length;n++){if(r=e[n],s!==null&&lr(s,r))throw new Error(t+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}},CE=function(t,e,n,r){const s=Ko(t,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");const i=[];cn(e,(o,l)=>{const c=new Tt(o);if(nc(s,l,Ht(n,c)),_0(c)===".priority"&&!W0(l))throw new Error(s+"contains an invalid value for '"+c.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");i.push(c)}),KR(s,i)},XR=function(t,e,n){if(Ku(e))throw new Error(Ko(t,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!W0(e))throw new Error(Ko(t,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")},kE=function(t,e,n,r){if(!TE(n))throw new Error(Ko(t,e)+'was an invalid path = "'+n+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},JR=function(t,e,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),kE(t,e,n)},Fs=function(t,e){if(dt(e)===".info")throw new Error(t+" failed = Can't modify data under /.info/")},QR=function(t,e){const n=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!H0(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||n.length!==0&&!YR(n))throw new Error(Ko(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qR{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function rf(t,e){let n=null;for(let r=0;r<e.length;r++){const s=e[r],i=s.getPath();n!==null&&!b0(i,n.path)&&(t.eventLists_.push(n),n=null),n===null&&(n={events:[],path:i}),n.events.push(s)}n&&t.eventLists_.push(n)}function RE(t,e,n){rf(t,n),AE(t,r=>b0(r,e))}function Qn(t,e,n){rf(t,n),AE(t,r=>lr(r,e)||lr(e,r))}function AE(t,e){t.recursionDepth_++;let n=!0;for(let r=0;r<t.eventLists_.length;r++){const s=t.eventLists_[r];if(s){const i=s.path;e(i)?(ZR(t.eventLists_[r]),t.eventLists_[r]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function ZR(t){for(let e=0;e<t.events.length;e++){const n=t.events[e];if(n!==null){t.events[e]=null;const r=n.getEventRunner();sl&&an("event: "+n.toString()),ca(r)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eA="repo_interrupt",tA=25;class nA{constructor(e,n,r,s){this.repoInfo_=e,this.forceRestClient_=n,this.authTokenProvider_=r,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new qR,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=hu(),this.transactionQueueTree_=new B0,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function rA(t,e,n){if(t.stats_=v0(t.repoInfo_),t.forceRestClient_||MC())t.server_=new fu(t.repoInfo_,(r,s,i,o)=>{Qv(t,r,s,i,o)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>qv(t,!0),0);else{if(typeof n<"u"&&n!==null){if(typeof n!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{en(n)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}t.persistentConnection_=new as(t.repoInfo_,e,(r,s,i,o)=>{Qv(t,r,s,i,o)},r=>{qv(t,r)},r=>{sA(t,r)},t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(r=>{t.server_.refreshAuthToken(r)}),t.appCheckProvider_.addTokenChangeListener(r=>{t.server_.refreshAppCheckToken(r.token)}),t.statsReporter_=UC(t.repoInfo_,()=>new Fk(t.stats_,t.server_)),t.infoData_=new Dk,t.infoSyncTree_=new Xv({startListening:(r,s,i,o)=>{let l=[];const c=t.infoData_.getNode(r._path);return c.isEmpty()||(l=ec(t.infoSyncTree_,r._path,c),setTimeout(()=>{o("ok")},0)),l},stopListening:()=>{}}),G0(t,"connected",!1),t.serverSyncTree_=new Xv({startListening:(r,s,i,o)=>(t.server_.listen(r,i,s,(l,c)=>{const d=o(l,c);Qn(t.eventQueue_,r._path,d)}),[]),stopListening:(r,s)=>{t.server_.unlisten(r,s)}})}function PE(t){const n=t.infoData_.getNode(new Tt(".info/serverTimeOffset")).val()||0;return new Date().getTime()+n}function rc(t){return FR({timestamp:PE(t)})}function Qv(t,e,n,r,s){t.dataUpdateCount++;const i=new Tt(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let o=[];if(s)if(r){const c=au(n,d=>zt(d));o=LR(t.serverSyncTree_,i,c,s)}else{const c=zt(n);o=xE(t.serverSyncTree_,i,c,s)}else if(r){const c=au(n,d=>zt(d));o=AR(t.serverSyncTree_,i,c)}else{const c=zt(n);o=ec(t.serverSyncTree_,i,c)}let l=i;o.length>0&&(l=ea(t,i)),Qn(t.eventQueue_,l,o)}function qv(t,e){G0(t,"connected",e),e===!1&&lA(t)}function sA(t,e){cn(e,(n,r)=>{G0(t,n,r)})}function G0(t,e,n){const r=new Tt("/.info/"+e),s=zt(n);t.infoData_.updateSnapshot(r,s);const i=ec(t.infoSyncTree_,r,s);Qn(t.eventQueue_,r,i)}function sf(t){return t.nextWriteId_++}function iA(t,e,n){const r=DR(t.serverSyncTree_,e);return r!=null?Promise.resolve(r):t.server_.get(e).then(s=>{const i=zt(s).withIndex(e._queryParams.getIndex());Yp(t.serverSyncTree_,e,n,!0);let o;if(e._queryParams.loadsAllData())o=ec(t.serverSyncTree_,e._path,i);else{const l=Fl(t.serverSyncTree_,e);o=xE(t.serverSyncTree_,e._path,i,l)}return Qn(t.eventQueue_,e._path,o),bu(t.serverSyncTree_,e,n,null,!0),i},s=>(fa(t,"get for query "+en(e)+" failed: "+s),Promise.reject(new Error(s))))}function oA(t,e,n,r,s){fa(t,"set",{path:e.toString(),value:n,priority:r});const i=rc(t),o=zt(n,r),l=Zu(t.serverSyncTree_,e),c=F0(o,l,i),d=sf(t),u=L0(t.serverSyncTree_,e,c,d,!0);rf(t.eventQueue_,u),t.server_.put(e.toString(),o.val(!0),(f,S)=>{const R=f==="ok";R||An("set at "+e+" failed: "+f);const C=$s(t.serverSyncTree_,d,!R);Qn(t.eventQueue_,e,C),oi(t,s,f,S)});const p=Y0(t,e);ea(t,p),Qn(t.eventQueue_,p,[])}function aA(t,e,n,r){fa(t,"update",{path:e.toString(),value:n});let s=!0;const i=rc(t),o={};if(cn(n,(l,c)=>{s=!1,o[l]=SE(Ht(e,l),zt(c),t.serverSyncTree_,i)}),s)an("update() called with empty data.  Don't do anything."),oi(t,r,"ok",void 0);else{const l=sf(t),c=RR(t.serverSyncTree_,e,o,l);rf(t.eventQueue_,c),t.server_.merge(e.toString(),n,(d,u)=>{const p=d==="ok";p||An("update at "+e+" failed: "+d);const f=$s(t.serverSyncTree_,l,!p),S=f.length>0?ea(t,e):e;Qn(t.eventQueue_,S,f),oi(t,r,d,u)}),cn(n,d=>{const u=Y0(t,Ht(e,d));ea(t,u)}),Qn(t.eventQueue_,e,[])}}function lA(t){fa(t,"onDisconnectEvents");const e=rc(t),n=hu();Bp(t.onDisconnect_,_t(),(s,i)=>{const o=SE(s,i,t.serverSyncTree_,e);da(n,s,o)});let r=[];Bp(n,_t(),(s,i)=>{r=r.concat(ec(t.serverSyncTree_,s,i));const o=Y0(t,s);ea(t,o)}),t.onDisconnect_=hu(),Qn(t.eventQueue_,_t(),r)}function cA(t,e,n){t.server_.onDisconnectCancel(e.toString(),(r,s)=>{r==="ok"&&Up(t.onDisconnect_,e),oi(t,n,r,s)})}function Zv(t,e,n,r){const s=zt(n);t.server_.onDisconnectPut(e.toString(),s.val(!0),(i,o)=>{i==="ok"&&da(t.onDisconnect_,e,s),oi(t,r,i,o)})}function dA(t,e,n,r,s){const i=zt(n,r);t.server_.onDisconnectPut(e.toString(),i.val(!0),(o,l)=>{o==="ok"&&da(t.onDisconnect_,e,i),oi(t,s,o,l)})}function uA(t,e,n,r){if(ou(n)){an("onDisconnect().update() called with empty data.  Don't do anything."),oi(t,r,"ok",void 0);return}t.server_.onDisconnectMerge(e.toString(),n,(s,i)=>{s==="ok"&&cn(n,(o,l)=>{const c=zt(l);da(t.onDisconnect_,Ht(e,o),c)}),oi(t,r,s,i)})}function fA(t,e,n){let r;dt(e._path)===".info"?r=Yp(t.infoSyncTree_,e,n):r=Yp(t.serverSyncTree_,e,n),RE(t.eventQueue_,e._path,r)}function hA(t,e,n){let r;dt(e._path)===".info"?r=bu(t.infoSyncTree_,e,n):r=bu(t.serverSyncTree_,e,n),RE(t.eventQueue_,e._path,r)}function pA(t){t.persistentConnection_&&t.persistentConnection_.interrupt(eA)}function fa(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),an(n,...e)}function oi(t,e,n,r){e&&ca(()=>{if(n==="ok")e(null);else{const s=(n||"error").toUpperCase();let i=s;r&&(i+=": "+r);const o=new Error(i);o.code=s,e(o)}})}function gA(t,e,n,r,s,i){fa(t,"transaction on "+e);const o={path:e,update:n,onComplete:r,status:null,order:Rb(),applyLocally:i,retryCount:0,unwatcher:s,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},l=V0(t,e,void 0);o.currentInputSnapshot=l;const c=o.update(l.val());if(c===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{nc("transaction failed: Data returned ",c,o.path),o.status=0;const d=tf(t.transactionQueueTree_,e),u=Ki(d)||[];u.push(o),z0(d,u);let p;typeof c=="object"&&c!==null&&Rr(c,".priority")?(p=ji(c,".priority"),pe(W0(p),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):p=(Zu(t.serverSyncTree_,e)||Ve.EMPTY_NODE).getPriority().val();const f=rc(t),S=zt(c,p),R=F0(S,l,f);o.currentOutputSnapshotRaw=S,o.currentOutputSnapshotResolved=R,o.currentWriteId=sf(t);const C=L0(t.serverSyncTree_,e,R,o.currentWriteId,o.applyLocally);Qn(t.eventQueue_,e,C),of(t,t.transactionQueueTree_)}}function V0(t,e,n){return Zu(t.serverSyncTree_,e,n)||Ve.EMPTY_NODE}function of(t,e=t.transactionQueueTree_){if(e||af(t,e),Ki(e)){const n=LE(t,e);pe(n.length>0,"Sending zero length transaction queue"),n.every(s=>s.status===0)&&mA(t,tc(e),n)}else wE(e)&&nf(e,n=>{of(t,n)})}function mA(t,e,n){const r=n.map(d=>d.currentWriteId),s=V0(t,e,r);let i=s;const o=s.hash();for(let d=0;d<n.length;d++){const u=n[d];pe(u.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;const p=kn(e,u.path);i=i.updateChild(p,u.currentOutputSnapshotRaw)}const l=i.val(!0),c=e;t.server_.put(c.toString(),l,d=>{fa(t,"transaction put response",{path:c.toString(),status:d});let u=[];if(d==="ok"){const p=[];for(let f=0;f<n.length;f++)n[f].status=2,u=u.concat($s(t.serverSyncTree_,n[f].currentWriteId)),n[f].onComplete&&p.push(()=>n[f].onComplete(null,!0,n[f].currentOutputSnapshotResolved)),n[f].unwatcher();af(t,tf(t.transactionQueueTree_,e)),of(t,t.transactionQueueTree_),Qn(t.eventQueue_,e,u);for(let f=0;f<p.length;f++)ca(p[f])}else{if(d==="datastale")for(let p=0;p<n.length;p++)n[p].status===3?n[p].status=4:n[p].status=0;else{An("transaction at "+c.toString()+" failed: "+d);for(let p=0;p<n.length;p++)n[p].status=4,n[p].abortReason=d}ea(t,e)}},o)}function ea(t,e){const n=OE(t,e),r=tc(n),s=LE(t,n);return yA(t,s,r),r}function yA(t,e,n){if(e.length===0)return;const r=[];let s=[];const o=e.filter(l=>l.status===0).map(l=>l.currentWriteId);for(let l=0;l<e.length;l++){const c=e[l],d=kn(n,c.path);let u=!1,p;if(pe(d!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)u=!0,p=c.abortReason,s=s.concat($s(t.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=tA)u=!0,p="maxretry",s=s.concat($s(t.serverSyncTree_,c.currentWriteId,!0));else{const f=V0(t,c.path,o);c.currentInputSnapshot=f;const S=e[l].update(f.val());if(S!==void 0){nc("transaction failed: Data returned ",S,c.path);let R=zt(S);typeof S=="object"&&S!=null&&Rr(S,".priority")||(R=R.updatePriority(f.getPriority()));const j=c.currentWriteId,_=rc(t),v=F0(R,f,_);c.currentOutputSnapshotRaw=R,c.currentOutputSnapshotResolved=v,c.currentWriteId=sf(t),o.splice(o.indexOf(j),1),s=s.concat(L0(t.serverSyncTree_,c.path,v,c.currentWriteId,c.applyLocally)),s=s.concat($s(t.serverSyncTree_,j,!0))}else u=!0,p="nodata",s=s.concat($s(t.serverSyncTree_,c.currentWriteId,!0))}Qn(t.eventQueue_,n,s),s=[],u&&(e[l].status=2,function(f){setTimeout(f,Math.floor(0))}(e[l].unwatcher),e[l].onComplete&&(p==="nodata"?r.push(()=>e[l].onComplete(null,!1,e[l].currentInputSnapshot)):r.push(()=>e[l].onComplete(new Error(p),!1,null))))}af(t,t.transactionQueueTree_);for(let l=0;l<r.length;l++)ca(r[l]);of(t,t.transactionQueueTree_)}function OE(t,e){let n,r=t.transactionQueueTree_;for(n=dt(e);n!==null&&Ki(r)===void 0;)r=tf(r,n),e=Pt(e),n=dt(e);return r}function LE(t,e){const n=[];return DE(t,e,n),n.sort((r,s)=>r.order-s.order),n}function DE(t,e,n){const r=Ki(e);if(r)for(let s=0;s<r.length;s++)n.push(r[s]);nf(e,s=>{DE(t,s,n)})}function af(t,e){const n=Ki(e);if(n){let r=0;for(let s=0;s<n.length;s++)n[s].status!==2&&(n[r]=n[s],r++);n.length=r,z0(e,n.length>0?n:void 0)}nf(e,r=>{af(t,r)})}function Y0(t,e){const n=tc(OE(t,e)),r=tf(t.transactionQueueTree_,e);return HR(r,s=>{Oh(t,s)}),Oh(t,r),IE(r,s=>{Oh(t,s)}),n}function Oh(t,e){const n=Ki(e);if(n){const r=[];let s=[],i=-1;for(let o=0;o<n.length;o++)n[o].status===3||(n[o].status===1?(pe(i===o-1,"All SENT items should be at beginning of queue."),i=o,n[o].status=3,n[o].abortReason="set"):(pe(n[o].status===0,"Unexpected transaction status in abort"),n[o].unwatcher(),s=s.concat($s(t.serverSyncTree_,n[o].currentWriteId,!0)),n[o].onComplete&&r.push(n[o].onComplete.bind(null,new Error("set"),!1,null))));i===-1?z0(e,void 0):n.length=i+1,Qn(t.eventQueue_,tc(e),s);for(let o=0;o<r.length;o++)ca(r[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vA(t){let e="";const n=t.split("/");for(let r=0;r<n.length;r++)if(n[r].length>0){let s=n[r];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function xA(t){const e={};t.charAt(0)==="?"&&(t=t.substring(1));for(const n of t.split("&")){if(n.length===0)continue;const r=n.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):An(`Invalid query segment '${n}' in query '${t}'`)}return e}const ex=function(t,e){const n=_A(t),r=n.namespace;n.domain==="firebase.com"&&ps(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&n.domain!=="localhost"&&ps("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||TC();const s=n.scheme==="ws"||n.scheme==="wss";return{repoInfo:new zb(n.host,n.secure,r,s,e,"",r!==n.subdomain),path:new Tt(n.pathString)}},_A=function(t){let e="",n="",r="",s="",i="",o=!0,l="https",c=443;if(typeof t=="string"){let d=t.indexOf("//");d>=0&&(l=t.substring(0,d-1),t=t.substring(d+2));let u=t.indexOf("/");u===-1&&(u=t.length);let p=t.indexOf("?");p===-1&&(p=t.length),e=t.substring(0,Math.min(u,p)),u<p&&(s=vA(t.substring(u,p)));const f=xA(t.substring(Math.min(t.length,p)));d=e.indexOf(":"),d>=0?(o=l==="https"||l==="wss",c=parseInt(e.substring(d+1),10)):d=e.length;const S=e.slice(0,d);if(S.toLowerCase()==="localhost")n="localhost";else if(S.split(".").length<=2)n=S;else{const R=e.indexOf(".");r=e.substring(0,R).toLowerCase(),n=e.substring(R+1),i=r}"ns"in f&&(i=f.ns)}return{host:e,port:c,domain:n,subdomain:r,secure:o,scheme:l,pathString:s,namespace:i}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tx="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",bA=function(){let t=0;const e=[];return function(n){const r=n===t;t=n;let s;const i=new Array(8);for(s=7;s>=0;s--)i[s]=tx.charAt(n%64),n=Math.floor(n/64);pe(n===0,"Cannot push at time == 0");let o=i.join("");if(r){for(s=11;s>=0&&e[s]===63;s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)o+=tx.charAt(e[s]);return pe(o.length===20,"nextPushId: Length should be 20."),o}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EA{constructor(e,n,r,s){this.eventType=e,this.eventRegistration=n,this.snapshot=r,this.prevName=s}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+en(this.snapshot.exportVal())}}class SA{constructor(e,n,r){this.eventRegistration=e,this.error=n,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ME{constructor(e,n){this.snapshotCallback=e,this.cancelCallback=n}onValue(e,n){this.snapshotCallback.call(null,e,n)}onCancel(e){return pe(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wA{constructor(e,n){this._repo=e,this._path=n}cancel(){const e=new _r;return cA(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Fs("OnDisconnect.remove",this._path);const e=new _r;return Zv(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Fs("OnDisconnect.set",this._path),Eu("OnDisconnect.set",e,this._path,!1);const n=new _r;return Zv(this._repo,this._path,e,n.wrapCallback(()=>{})),n.promise}setWithPriority(e,n){Fs("OnDisconnect.setWithPriority",this._path),Eu("OnDisconnect.setWithPriority",e,this._path,!1),XR("OnDisconnect.setWithPriority",n);const r=new _r;return dA(this._repo,this._path,e,n,r.wrapCallback(()=>{})),r.promise}update(e){Fs("OnDisconnect.update",this._path),CE("OnDisconnect.update",e,this._path);const n=new _r;return uA(this._repo,this._path,e,n.wrapCallback(()=>{})),n.promise}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K0{constructor(e,n,r,s){this._repo=e,this._path=n,this._queryParams=r,this._orderByCalled=s}get key(){return ft(this._path)?null:_0(this._path)}get ref(){return new Gr(this._repo,this._path)}get _queryIdentifier(){const e=Fv(this._queryParams),n=m0(e);return n==="{}"?"default":n}get _queryObject(){return Fv(this._queryParams)}isEqual(e){if(e=nn(e),!(e instanceof K0))return!1;const n=this._repo===e._repo,r=b0(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return n&&r&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+ck(this._path)}}class Gr extends K0{constructor(e,n){super(e,n,new I0,!1)}get parent(){const e=Qb(this._path);return e===null?null:new Gr(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class ta{constructor(e,n,r){this._node=e,this.ref=n,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const n=new Tt(e),r=Ul(this.ref,e);return new ta(this._node.getChild(n),r,Ft)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,s)=>e(new ta(s,Ul(this.ref,r),Ft)))}hasChild(e){const n=new Tt(e);return!this._node.getChild(n).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function $r(t,e){return t=nn(t),t._checkNotDeleted("ref"),e!==void 0?Ul(t._root,e):t._root}function Ul(t,e){return t=nn(t),dt(t._path)===null?JR("child","path",e):kE("child","path",e),new Gr(t._repo,Ht(t._path,e))}function IA(t){return t=nn(t),new wA(t._repo,t._path)}function TA(t,e){t=nn(t),Fs("push",t._path),Eu("push",e,t._path,!0);const n=PE(t._repo),r=bA(n),s=Ul(t,r),i=Ul(t,r);let o;return o=Promise.resolve(i),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function nd(t){return Fs("remove",t._path),lf(t,null)}function lf(t,e){t=nn(t),Fs("set",t._path),Eu("set",e,t._path,!1);const n=new _r;return oA(t._repo,t._path,e,null,n.wrapCallback(()=>{})),n.promise}function X0(t,e){CE("update",e,t._path);const n=new _r;return aA(t._repo,t._path,e,n.wrapCallback(()=>{})),n.promise}function cf(t){t=nn(t);const e=new ME(()=>{}),n=new df(e);return iA(t._repo,t,n).then(r=>new ta(r,new Gr(t._repo,t._path),t._queryParams.getIndex()))}class df{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,n){const r=n._queryParams.getIndex();return new EA("value",this,new ta(e.snapshotNode,new Gr(n._repo,n._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new SA(this,e,n):null}matches(e){return e instanceof df?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function CA(t,e,n,r,s){const i=new ME(n,void 0),o=new df(i);return fA(t._repo,t,o),()=>hA(t._repo,t,o)}function NE(t,e,n,r){return CA(t,"value",e)}bR(Gr);TR(Gr);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kA="FIREBASE_DATABASE_EMULATOR_HOST",Xp={};let RA=!1;function AA(t,e,n,r){const s=e.lastIndexOf(":"),i=e.substring(0,s),o=oa(i);t.repoInfo_=new zb(e,o,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0,n),r&&(t.authTokenProvider_=r)}function PA(t,e,n,r,s){let i=r||t.options.databaseURL;i===void 0&&(t.options.projectId||ps("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),an("Using default host for project ",t.options.projectId),i=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o=ex(i,s),l=o.repoInfo,c;typeof process<"u"&&bv&&(c=bv[kA]),c?(i=`http://${c}?ns=${l.namespace}`,o=ex(i,s),l=o.repoInfo):o.repoInfo.secure;const d=new jC(t.name,t.options,e);QR("Invalid Firebase Database URL",o),ft(o.path)||ps("Database URL must point to the root of a Firebase Database (not including a child path).");const u=LA(l,t,d,new NC(t,n));return new DA(u,t)}function OA(t,e){const n=Xp[e];(!n||n[t.key]!==t)&&ps(`Database ${e}(${t.repoInfo_}) has already been deleted.`),pA(t),delete n[t.key]}function LA(t,e,n,r){let s=Xp[e.name];s||(s={},Xp[e.name]=s);let i=s[t.toURLString()];return i&&ps("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new nA(t,RA,n,r),s[t.toURLString()]=i,i}class DA{constructor(e,n){this._repoInternal=e,this.app=n,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(rA(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Gr(this._repo,_t())),this._rootInternal}_delete(){return this._rootInternal!==null&&(OA(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&ps("Cannot call "+e+" on a deleted database.")}}function MA(t=wb(),e){const n=g0(t,"database").getImmediate({identifier:e});if(!n._instanceStarted){const r=GT("database");r&&NA(n,...r)}return n}function NA(t,e,n,r={}){t=nn(t),t._checkNotDeleted("useEmulator");const s=`${e}:${n}`,i=t._repoInternal;if(t._instanceStarted){if(s===t._repoInternal.repoInfo_.host&&$i(r,i.repoInfo_.emulatorOptions))return;ps("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&ps('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new Ed(Ed.OWNER);else if(r.mockUserToken){const l=typeof r.mockUserToken=="string"?r.mockUserToken:VT(r.mockUserToken,t.app.options.projectId);o=new Ed(l)}oa(e)&&(yb(e),vb("Database",!0)),AA(i,s,r,o)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jA(t){bC(la),Xo(new Fi("database",(e,{instanceIdentifier:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return PA(r,s,i,n)},"PUBLIC").setMultipleInstances(!0)),Qs(Ev,Sv,t),Qs(Ev,Sv,"esm2020")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $A{constructor(e,n){this.committed=e,this.snapshot=n}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function FA(t,e,n){if(t=nn(t),Fs("Reference.transaction",t._path),t.key===".length"||t.key===".keys")throw"Reference.transaction failed: "+t.key+" is a read-only object.";const r=!0,s=new _r,i=(l,c,d)=>{let u=null;l?s.reject(l):(u=new ta(d,new Gr(t._repo,t._path),Ft),s.resolve(new $A(c,u)))},o=NE(t,()=>{});return gA(t._repo,t._path,e,i,o,r),s.promise}as.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};as.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};jA();function jE(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const UA=jE,$E=new Jl("auth","Firebase",jE());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Su=new h0("@firebase/auth");function BA(t,...e){Su.logLevel<=Rt.WARN&&Su.warn(`Auth (${la}): ${t}`,...e)}function Sd(t,...e){Su.logLevel<=Rt.ERROR&&Su.error(`Auth (${la}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kr(t,...e){throw J0(t,...e)}function Hr(t,...e){return J0(t,...e)}function FE(t,e,n){const r={...UA(),[e]:n};return new Jl("auth","Firebase",r).create(e,{appName:t.name})}function ls(t){return FE(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function J0(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return $E.create(t,...e)}function Ge(t,e,...n){if(!t)throw J0(e,...n)}function ss(t){const e="INTERNAL ASSERTION FAILED: "+t;throw Sd(e),new Error(e)}function gs(t,e){t||ss(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jp(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.href)||""}function zA(){return nx()==="http:"||nx()==="https:"}function nx(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HA(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(zA()||JT()||"connection"in navigator)?navigator.onLine:!0}function WA(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sc{constructor(e,n){this.shortDelay=e,this.longDelay=n,gs(n>e,"Short delay should be less than long delay!"),this.isMobile=f0()||xb()}get(){return HA()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Q0(t,e){gs(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UE{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;ss("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;ss("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;ss("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GA={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VA=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],YA=new sc(3e4,6e4);function fi(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function hi(t,e,n,r,s={}){return BE(t,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const l=aa({key:t.config.apiKey,...o}).slice(1),c=await t._getAdditionalHeaders();c["Content-Type"]="application/json",t.languageCode&&(c["X-Firebase-Locale"]=t.languageCode);const d={method:e,headers:c,...i};return XT()||(d.referrerPolicy="no-referrer"),t.emulatorConfig&&oa(t.emulatorConfig.host)&&(d.credentials="include"),UE.fetch()(await zE(t,t.config.apiHost,n,l),d)})}async function BE(t,e,n){t._canInitEmulator=!1;const r={...GA,...e};try{const s=new XA(t),i=await Promise.race([n(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw rd(t,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const l=i.ok?o.errorMessage:o.error.message,[c,d]=l.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw rd(t,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw rd(t,"email-already-in-use",o);if(c==="USER_DISABLED")throw rd(t,"user-disabled",o);const u=r[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw FE(t,u,d);kr(t,u)}}catch(s){if(s instanceof ui)throw s;kr(t,"network-request-failed",{message:String(s)})}}async function ic(t,e,n,r,s={}){const i=await hi(t,e,n,r,s);return"mfaPendingCredential"in i&&kr(t,"multi-factor-auth-required",{_serverResponse:i}),i}async function zE(t,e,n,r){const s=`${e}${n}?${r}`,i=t,o=i.config.emulator?Q0(t.config,s):`${t.config.apiScheme}://${s}`;return VA.includes(n)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(o).toString():o}function KA(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class XA{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(Hr(this.auth,"network-request-failed")),YA.get())})}}function rd(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=Hr(t,e,r);return s.customData._tokenResponse=n,s}function rx(t){return t!==void 0&&t.enterprise!==void 0}class JA{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return KA(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function QA(t,e){return hi(t,"GET","/v2/recaptchaConfig",fi(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qA(t,e){return hi(t,"POST","/v1/accounts:delete",e)}async function wu(t,e){return hi(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cl(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function ZA(t,e=!1){const n=nn(t),r=await n.getIdToken(e),s=q0(r);Ge(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:cl(Lh(s.auth_time)),issuedAtTime:cl(Lh(s.iat)),expirationTime:cl(Lh(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Lh(t){return Number(t)*1e3}function q0(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return Sd("JWT malformed, contained fewer than 3 sections"),null;try{const s=iu(n);return s?JSON.parse(s):(Sd("Failed to decode base64 JWT payload"),null)}catch(s){return Sd("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function sx(t){const e=q0(t);return Ge(e,"internal-error"),Ge(typeof e.exp<"u","internal-error"),Ge(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bl(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof ui&&eP(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function eP({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tP{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qp{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=cl(this.lastLoginAt),this.creationTime=cl(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zl(t){var p;const e=t.auth,n=await t.getIdToken(),r=await Bl(t,wu(e,{idToken:n}));Ge(r==null?void 0:r.users.length,e,"internal-error");const s=r.users[0];t._notifyReloadListener(s);const i=(p=s.providerUserInfo)!=null&&p.length?HE(s.providerUserInfo):[],o=rP(t.providerData,i),l=t.isAnonymous,c=!(t.email&&s.passwordHash)&&!(o!=null&&o.length),d=l?c:!1,u={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new Qp(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(t,u)}async function nP(t){const e=nn(t);await zl(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function rP(t,e){return[...t.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function HE(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sP(t,e){const n=await BE(t,{},async()=>{const r=aa({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=t.config,o=await zE(t,s,"/v1/token",`key=${i}`),l=await t._getAdditionalHeaders();l["Content-Type"]="application/x-www-form-urlencoded";const c={method:"POST",headers:l,body:r};return t.emulatorConfig&&oa(t.emulatorConfig.host)&&(c.credentials="include"),UE.fetch()(o,c)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function iP(t,e){return hi(t,"POST","/v2/accounts:revokeToken",fi(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jo{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ge(e.idToken,"internal-error"),Ge(typeof e.idToken<"u","internal-error"),Ge(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):sx(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){Ge(e.length!==0,"internal-error");const n=sx(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(Ge(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:s,expiresIn:i}=await sP(e,n);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:s,expirationTime:i}=n,o=new jo;return r&&(Ge(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(Ge(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(Ge(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new jo,this.toJSON())}_performRefresh(){return ss("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cs(t,e){Ge(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class Sr{constructor({uid:e,auth:n,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new tP(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Qp(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const n=await Bl(this,this.stsTokenManager.getToken(this.auth,e));return Ge(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return ZA(this,e)}reload(){return nP(this)}_assign(e){this!==e&&(Ge(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new Sr({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){Ge(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await zl(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(or(this.auth.app))return Promise.reject(ls(this.auth));const e=await this.getIdToken();return await Bl(this,qA(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const r=n.displayName??void 0,s=n.email??void 0,i=n.phoneNumber??void 0,o=n.photoURL??void 0,l=n.tenantId??void 0,c=n._redirectEventId??void 0,d=n.createdAt??void 0,u=n.lastLoginAt??void 0,{uid:p,emailVerified:f,isAnonymous:S,providerData:R,stsTokenManager:C}=n;Ge(p&&C,e,"internal-error");const j=jo.fromJSON(this.name,C);Ge(typeof p=="string",e,"internal-error"),Cs(r,e.name),Cs(s,e.name),Ge(typeof f=="boolean",e,"internal-error"),Ge(typeof S=="boolean",e,"internal-error"),Cs(i,e.name),Cs(o,e.name),Cs(l,e.name),Cs(c,e.name),Cs(d,e.name),Cs(u,e.name);const _=new Sr({uid:p,auth:e,email:s,emailVerified:f,displayName:r,isAnonymous:S,photoURL:o,phoneNumber:i,tenantId:l,stsTokenManager:j,createdAt:d,lastLoginAt:u});return R&&Array.isArray(R)&&(_.providerData=R.map(v=>({...v}))),c&&(_._redirectEventId=c),_}static async _fromIdTokenResponse(e,n,r=!1){const s=new jo;s.updateFromServerResponse(n);const i=new Sr({uid:n.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await zl(i),i}static async _fromGetAccountInfoResponse(e,n,r){const s=n.users[0];Ge(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?HE(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),l=new jo;l.updateFromIdToken(r);const c=new Sr({uid:s.localId,auth:e,stsTokenManager:l,isAnonymous:o}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Qp(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(c,d),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ix=new Map;function is(t){gs(t instanceof Function,"Expected a class definition");let e=ix.get(t);return e?(gs(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,ix.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WE{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}WE.type="NONE";const ox=WE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wd(t,e,n){return`firebase:${t}:${e}:${n}`}class $o{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=wd(this.userKey,s.apiKey,i),this.fullPersistenceKey=wd("persistence",s.apiKey,i),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await wu(this.auth,{idToken:e}).catch(()=>{});return n?Sr._fromGetAccountInfoResponse(this.auth,n,e):null}return Sr._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new $o(is(ox),e,r);const s=(await Promise.all(n.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let i=s[0]||is(ox);const o=wd(r,e.config.apiKey,e.name);let l=null;for(const d of n)try{const u=await d._get(o);if(u){let p;if(typeof u=="string"){const f=await wu(e,{idToken:u}).catch(()=>{});if(!f)break;p=await Sr._fromGetAccountInfoResponse(e,f,u)}else p=Sr._fromJSON(e,u);d!==i&&(l=p),i=d;break}}catch{}const c=s.filter(d=>d._shouldAllowMigration);return!i._shouldAllowMigration||!c.length?new $o(i,e,r):(i=c[0],l&&await i._set(o,l.toJSON()),await Promise.all(n.map(async d=>{if(d!==i)try{await d._remove(o)}catch{}})),new $o(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ax(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(KE(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(GE(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(JE(e))return"Blackberry";if(QE(e))return"Webos";if(VE(e))return"Safari";if((e.includes("chrome/")||YE(e))&&!e.includes("edge/"))return"Chrome";if(XE(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function GE(t=Pn()){return/firefox\//i.test(t)}function VE(t=Pn()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function YE(t=Pn()){return/crios\//i.test(t)}function KE(t=Pn()){return/iemobile/i.test(t)}function XE(t=Pn()){return/android/i.test(t)}function JE(t=Pn()){return/blackberry/i.test(t)}function QE(t=Pn()){return/webos/i.test(t)}function Z0(t=Pn()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function oP(t=Pn()){var e;return Z0(t)&&!!((e=window.navigator)!=null&&e.standalone)}function aP(){return QT()&&document.documentMode===10}function qE(t=Pn()){return Z0(t)||XE(t)||QE(t)||JE(t)||/windows phone/i.test(t)||KE(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZE(t,e=[]){let n;switch(t){case"Browser":n=ax(Pn());break;case"Worker":n=`${ax(Pn())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${la}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lP{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=i=>new Promise((o,l)=>{try{const c=e(i);o(c)}catch(c){l(c)}});r.onAbort=n,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const s of n)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cP(t,e={}){return hi(t,"GET","/v2/passwordPolicy",fi(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dP=6;class uP{constructor(e){var r;const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??dP,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((r=e.allowedNonAlphanumericCharacters)==null?void 0:r.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),s&&(n.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fP{constructor(e,n,r,s){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new lx(this),this.idTokenSubscription=new lx(this),this.beforeStateQueue=new lP(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=$E,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=is(n)),this._initializationPromise=this.queue(async()=>{var r,s,i;if(!this._deleted&&(this.persistenceManager=await $o.create(this,e),(r=this._resolvePersistenceManagerAvailable)==null||r.call(this),!this._deleted)){if((s=this._popupRedirectResolver)!=null&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((i=this.currentUser)==null?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await wu(this,{idToken:e}),r=await Sr._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(or(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(l,l))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(i=this.redirectUser)==null?void 0:i._redirectEventId,l=r==null?void 0:r._redirectEventId,c=await this.tryRedirectSignIn(e);(!o||o===l)&&(c!=null&&c.user)&&(r=c.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Ge(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await zl(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=WA()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(or(this.app))return Promise.reject(ls(this));const n=e?nn(e):null;return n&&Ge(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&Ge(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return or(this.app)?Promise.reject(ls(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return or(this.app)?Promise.reject(ls(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(is(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await cP(this),n=new uP(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Jl("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await iP(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&is(e)||this._popupRedirectResolver;Ge(n,this,"argument-error"),this.redirectPersistenceManager=await $o.create(this,[is(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)==null?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)==null?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((n=this.currentUser)==null?void 0:n.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,s){if(this._deleted)return()=>{};const i=typeof n=="function"?n:n.next.bind(n);let o=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ge(l,this,"internal-error"),l.then(()=>{o||i(this.currentUser)}),typeof n=="function"){const c=e.addObserver(n,r,s);return()=>{o=!0,c()}}else{const c=e.addObserver(n);return()=>{o=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ge(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=ZE(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var s;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await((s=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getHeartbeatsHeader());n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var n;if(or(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((n=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:n.getToken());return e!=null&&e.error&&BA(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function Xi(t){return nn(t)}class lx{constructor(e){this.auth=e,this.observer=null,this.addObserver=a5(n=>this.observer=n)}get next(){return Ge(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let uf={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function hP(t){uf=t}function eS(t){return uf.loadJS(t)}function pP(){return uf.recaptchaEnterpriseScript}function gP(){return uf.gapiScript}function mP(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class yP{constructor(){this.enterprise=new vP}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class vP{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const xP="recaptcha-enterprise",tS="NO_RECAPTCHA";class _P{constructor(e){this.type=xP,this.auth=Xi(e)}async verify(e="verify",n=!1){async function r(i){if(!n){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,l)=>{QA(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const d=new JA(c);return i.tenantId==null?i._agentRecaptchaConfig=d:i._tenantRecaptchaConfigs[i.tenantId]=d,o(d.siteKey)}}).catch(c=>{l(c)})})}function s(i,o,l){const c=window.grecaptcha;rx(c)?c.enterprise.ready(()=>{c.enterprise.execute(i,{action:e}).then(d=>{o(d)}).catch(()=>{o(tS)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new yP().execute("siteKey",{action:"verify"}):new Promise((i,o)=>{r(this.auth).then(l=>{if(!n&&rx(window.grecaptcha))s(l,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let c=pP();c.length!==0&&(c+=l),eS(c).then(()=>{s(l,i,o)}).catch(d=>{o(d)})}}).catch(l=>{o(l)})})}}async function cx(t,e,n,r=!1,s=!1){const i=new _P(t);let o;if(s)o=tS;else try{o=await i.verify(n)}catch{o=await i.verify(n,!0)}const l={...e};if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in l){const c=l.phoneEnrollmentInfo.phoneNumber,d=l.phoneEnrollmentInfo.recaptchaToken;Object.assign(l,{phoneEnrollmentInfo:{phoneNumber:c,recaptchaToken:d,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in l){const c=l.phoneSignInInfo.recaptchaToken;Object.assign(l,{phoneSignInInfo:{recaptchaToken:c,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return l}return r?Object.assign(l,{captchaResp:o}):Object.assign(l,{captchaResponse:o}),Object.assign(l,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(l,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),l}async function dx(t,e,n,r,s){var i;if((i=t._getRecaptchaConfig())!=null&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await cx(t,e,n,n==="getOobCode");return r(t,o)}else return r(t,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await cx(t,e,n,n==="getOobCode");return r(t,l)}else return Promise.reject(o)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bP(t,e){const n=g0(t,"auth");if(n.isInitialized()){const s=n.getImmediate(),i=n.getOptions();if($i(i,e??{}))return s;kr(s,"already-initialized")}return n.initialize({options:e})}function EP(t,e){const n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(is);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function SP(t,e,n){const r=Xi(t);Ge(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,i=nS(e),{host:o,port:l}=wP(e),c=l===null?"":`:${l}`,d={url:`${i}//${o}${c}/`},u=Object.freeze({host:o,port:l,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){Ge(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),Ge($i(d,r.config.emulator)&&$i(u,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=d,r.emulatorConfig=u,r.settings.appVerificationDisabledForTesting=!0,oa(o)?(yb(`${i}//${o}${c}`),vb("Auth",!0)):IP()}function nS(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function wP(t){const e=nS(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:ux(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:ux(o)}}}function ux(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function IP(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class em{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return ss("not implemented")}_getIdTokenResponse(e){return ss("not implemented")}_linkToIdToken(e,n){return ss("not implemented")}_getReauthenticationResolver(e){return ss("not implemented")}}async function TP(t,e){return hi(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function CP(t,e){return ic(t,"POST","/v1/accounts:signInWithPassword",fi(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kP(t,e){return ic(t,"POST","/v1/accounts:signInWithEmailLink",fi(t,e))}async function RP(t,e){return ic(t,"POST","/v1/accounts:signInWithEmailLink",fi(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hl extends em{constructor(e,n,r,s=null){super("password",r),this._email=e,this._password=n,this._tenantId=s}static _fromEmailAndPassword(e,n){return new Hl(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new Hl(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return dx(e,n,"signInWithPassword",CP);case"emailLink":return kP(e,{email:this._email,oobCode:this._password});default:kr(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return dx(e,r,"signUpPassword",TP);case"emailLink":return RP(e,{idToken:n,email:this._email,oobCode:this._password});default:kr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Fo(t,e){return ic(t,"POST","/v1/accounts:signInWithIdp",fi(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AP="http://localhost";class Hi extends em{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Hi(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):kr("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=n;if(!r||!s)return null;const o=new Hi(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const n=this.buildRequest();return Fo(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,Fo(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,Fo(e,n)}buildRequest(){const e={requestUri:AP,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=aa(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PP(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function OP(t){const e=Ga(Va(t)).link,n=e?Ga(Va(e)).deep_link_id:null,r=Ga(Va(t)).deep_link_id;return(r?Ga(Va(r)).link:null)||r||n||e||t}class tm{constructor(e){const n=Ga(Va(e)),r=n.apiKey??null,s=n.oobCode??null,i=PP(n.mode??null);Ge(r&&s&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=s,this.continueUrl=n.continueUrl??null,this.languageCode=n.lang??null,this.tenantId=n.tenantId??null}static parseLink(e){const n=OP(e);try{return new tm(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ji{constructor(){this.providerId=Ji.PROVIDER_ID}static credential(e,n){return Hl._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=tm.parseLink(n);return Ge(r,"argument-error"),Hl._fromEmailAndCode(e,r.code,r.tenantId)}}Ji.PROVIDER_ID="password";Ji.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Ji.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rS{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oc extends rS{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Os extends oc{constructor(){super("facebook.com")}static credential(e){return Hi._fromParams({providerId:Os.PROVIDER_ID,signInMethod:Os.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Os.credentialFromTaggedObject(e)}static credentialFromError(e){return Os.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Os.credential(e.oauthAccessToken)}catch{return null}}}Os.FACEBOOK_SIGN_IN_METHOD="facebook.com";Os.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ls extends oc{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Hi._fromParams({providerId:Ls.PROVIDER_ID,signInMethod:Ls.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return Ls.credentialFromTaggedObject(e)}static credentialFromError(e){return Ls.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return Ls.credential(n,r)}catch{return null}}}Ls.GOOGLE_SIGN_IN_METHOD="google.com";Ls.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ds extends oc{constructor(){super("github.com")}static credential(e){return Hi._fromParams({providerId:Ds.PROVIDER_ID,signInMethod:Ds.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ds.credentialFromTaggedObject(e)}static credentialFromError(e){return Ds.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ds.credential(e.oauthAccessToken)}catch{return null}}}Ds.GITHUB_SIGN_IN_METHOD="github.com";Ds.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ms extends oc{constructor(){super("twitter.com")}static credential(e,n){return Hi._fromParams({providerId:Ms.PROVIDER_ID,signInMethod:Ms.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return Ms.credentialFromTaggedObject(e)}static credentialFromError(e){return Ms.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return Ms.credential(n,r)}catch{return null}}}Ms.TWITTER_SIGN_IN_METHOD="twitter.com";Ms.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function LP(t,e){return ic(t,"POST","/v1/accounts:signUp",fi(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ai{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,s=!1){const i=await Sr._fromIdTokenResponse(e,r,s),o=fx(r);return new ai({user:i,providerId:o,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const s=fx(r);return new ai({user:e,providerId:s,_tokenResponse:r,operationType:n})}}function fx(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function DP(t){var s;if(or(t.app))return Promise.reject(ls(t));const e=Xi(t);if(await e._initializationPromise,(s=e.currentUser)!=null&&s.isAnonymous)return new ai({user:e.currentUser,providerId:null,operationType:"signIn"});const n=await LP(e,{returnSecureToken:!0}),r=await ai._fromIdTokenResponse(e,"signIn",n,!0);return await e._updateCurrentUser(r.user),r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iu extends ui{constructor(e,n,r,s){super(n.code,n.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Iu.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,s){return new Iu(e,n,r,s)}}function sS(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Iu._fromErrorAndOperation(t,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MP(t){return new Set(t.map(({providerId:e})=>e).filter(e=>!!e))}async function iS(t,e,n=!1){const r=await Bl(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return ai._forOperation(t,"link",r)}async function NP(t,e,n){await zl(e);const r=MP(e.providerData);Ge(r.has(n)===t,e.auth,"provider-already-linked")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jP(t,e,n=!1){const{auth:r}=t;if(or(r.app))return Promise.reject(ls(r));const s="reauthenticate";try{const i=await Bl(t,sS(r,s,e,t),n);Ge(i.idToken,r,"internal-error");const o=q0(i.idToken);Ge(o,r,"internal-error");const{sub:l}=o;return Ge(t.uid===l,r,"user-mismatch"),ai._forOperation(t,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&kr(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oS(t,e,n=!1){if(or(t.app))return Promise.reject(ls(t));const r="signIn",s=await sS(t,r,e),i=await ai._fromIdTokenResponse(t,r,s);return n||await t._updateCurrentUser(i.user),i}async function $P(t,e){return oS(Xi(t),e)}async function FP(t,e){const n=nn(t);return await NP(!1,n,e.providerId),iS(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function UP(t){const e=Xi(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}function BP(t,e,n){return or(t.app)?Promise.reject(ls(t)):$P(nn(t),Ji.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&UP(t),r})}function zP(t,e,n,r){return nn(t).onIdTokenChanged(e,n,r)}function HP(t,e,n){return nn(t).beforeAuthStateChanged(e,n)}function WP(t,e,n,r){return nn(t).onAuthStateChanged(e,n,r)}function GP(t){return nn(t).signOut()}const Tu="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aS{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(Tu,"1"),this.storage.removeItem(Tu),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VP=1e3,YP=10;class lS extends aS{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=qE(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),s=this.localCache[n];r!==s&&e(n,s,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((o,l,c)=>{this.notifyListeners(o,c)});return}const r=e.key;n?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!n&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);aP()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,YP):s()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},VP)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}lS.type="LOCAL";const KP=lS;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cS extends aS{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}cS.type="SESSION";const dS=cS;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XP(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ff{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(s=>s.isListeningto(e));if(n)return n;const r=new ff(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:s,data:i}=n.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const l=Array.from(o).map(async d=>d(n.origin,i)),c=await XP(l);n.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:c})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}ff.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nm(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JP{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((l,c)=>{const d=nm("",20);s.port1.start();const u=setTimeout(()=>{c(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(p){const f=p;if(f.data.eventId===d)switch(f.data.status){case"ack":clearTimeout(u),i=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),l(f.data.response);break;default:clearTimeout(u),clearTimeout(i),c(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:d,data:n},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wr(){return window}function QP(t){Wr().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uS(){return typeof Wr().WorkerGlobalScope<"u"&&typeof Wr().importScripts=="function"}async function qP(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function ZP(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)==null?void 0:t.controller)||null}function eO(){return uS()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fS="firebaseLocalStorageDb",tO=1,Cu="firebaseLocalStorage",hS="fbase_key";class ac{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function hf(t,e){return t.transaction([Cu],e?"readwrite":"readonly").objectStore(Cu)}function nO(){const t=indexedDB.deleteDatabase(fS);return new ac(t).toPromise()}function qp(){const t=indexedDB.open(fS,tO);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(Cu,{keyPath:hS})}catch(s){n(s)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(Cu)?e(r):(r.close(),await nO(),e(await qp()))})})}async function hx(t,e,n){const r=hf(t,!0).put({[hS]:e,value:n});return new ac(r).toPromise()}async function rO(t,e){const n=hf(t,!1).get(e),r=await new ac(n).toPromise();return r===void 0?null:r.value}function px(t,e){const n=hf(t,!0).delete(e);return new ac(n).toPromise()}const sO=800,iO=3;class pS{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await qp(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>iO)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return uS()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ff._getInstance(eO()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var n,r;if(this.activeServiceWorker=await qP(),!this.activeServiceWorker)return;this.sender=new JP(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(n=e[0])!=null&&n.fulfilled&&(r=e[0])!=null&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||ZP()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await qp();return await hx(e,Tu,"1"),await px(e,Tu),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>hx(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>rO(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>px(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=hf(s,!1).getAll();return new ac(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),n.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),n.push(s));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),sO)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}pS.type="LOCAL";const oO=pS;new sc(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aO(t,e){return e?is(e):(Ge(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rm extends em{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Fo(e,this._buildIdpRequest())}_linkToIdToken(e,n){return Fo(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return Fo(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function lO(t){return oS(t.auth,new rm(t),t.bypassAuthState)}function cO(t){const{auth:e,user:n}=t;return Ge(n,e,"internal-error"),jP(n,new rm(t),t.bypassAuthState)}async function dO(t){const{auth:e,user:n}=t;return Ge(n,e,"internal-error"),iS(n,new rm(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gS{constructor(e,n,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:s,tenantId:i,error:o,type:l}=e;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:n,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(c))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return lO;case"linkViaPopup":case"linkViaRedirect":return dO;case"reauthViaPopup":case"reauthViaRedirect":return cO;default:kr(this.auth,"internal-error")}}resolve(e){gs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){gs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uO=new sc(2e3,1e4);class ko extends gS{constructor(e,n,r,s,i){super(e,n,s,i),this.provider=r,this.authWindow=null,this.pollId=null,ko.currentPopupAction&&ko.currentPopupAction.cancel(),ko.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ge(e,this.auth,"internal-error"),e}async onExecution(){gs(this.filter.length===1,"Popup operations only handle one event");const e=nm();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Hr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(Hr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,ko.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if((r=(n=this.authWindow)==null?void 0:n.window)!=null&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Hr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,uO.get())};e()}}ko.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fO="pendingRedirect",Id=new Map;class hO extends gS{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=Id.get(this.auth._key());if(!e){try{const r=await pO(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}Id.set(this.auth._key(),e)}return this.bypassAuthState||Id.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function pO(t,e){const n=yO(e),r=mO(t);if(!await r._isAvailable())return!1;const s=await r._get(n)==="true";return await r._remove(n),s}function gO(t,e){Id.set(t._key(),e)}function mO(t){return is(t._redirectPersistence)}function yO(t){return wd(fO,t.config.apiKey,t.name)}async function vO(t,e,n=!1){if(or(t.app))return Promise.reject(ls(t));const r=Xi(t),s=aO(r,e),o=await new hO(r,s,n).execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xO=10*60*1e3;class _O{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!bO(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!mS(e)){const s=((r=e.error.code)==null?void 0:r.split("auth/")[1])||"internal-error";n.onError(Hr(this.auth,s))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=xO&&this.cachedEventUids.clear(),this.cachedEventUids.has(gx(e))}saveEventToCache(e){this.cachedEventUids.add(gx(e)),this.lastProcessedEventTime=Date.now()}}function gx(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function mS({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function bO(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return mS(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function EO(t,e={}){return hi(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SO=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,wO=/^https?/;async function IO(t){if(t.config.emulator)return;const{authorizedDomains:e}=await EO(t);for(const n of e)try{if(TO(n))return}catch{}kr(t,"unauthorized-domain")}function TO(t){const e=Jp(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const o=new URL(t);return o.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&o.hostname===r}if(!wO.test(n))return!1;if(SO.test(t))return r===t;const s=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CO=new sc(3e4,6e4);function mx(){const t=Wr().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function kO(t){return new Promise((e,n)=>{var s,i,o;function r(){mx(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{mx(),n(Hr(t,"network-request-failed"))},timeout:CO.get()})}if((i=(s=Wr().gapi)==null?void 0:s.iframes)!=null&&i.Iframe)e(gapi.iframes.getContext());else if((o=Wr().gapi)!=null&&o.load)r();else{const l=mP("iframefcb");return Wr()[l]=()=>{gapi.load?r():n(Hr(t,"network-request-failed"))},eS(`${gP()}?onload=${l}`).catch(c=>n(c))}}).catch(e=>{throw Td=null,e})}let Td=null;function RO(t){return Td=Td||kO(t),Td}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AO=new sc(5e3,15e3),PO="__/auth/iframe",OO="emulator/auth/iframe",LO={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},DO=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function MO(t){const e=t.config;Ge(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?Q0(e,OO):`https://${t.config.authDomain}/${PO}`,r={apiKey:e.apiKey,appName:t.name,v:la},s=DO.get(t.config.apiHost);s&&(r.eid=s);const i=t._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${aa(r).slice(1)}`}async function NO(t){const e=await RO(t),n=Wr().gapi;return Ge(n,t,"internal-error"),e.open({where:document.body,url:MO(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:LO,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=Hr(t,"network-request-failed"),l=Wr().setTimeout(()=>{i(o)},AO.get());function c(){Wr().clearTimeout(l),s(r)}r.ping(c).then(c,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jO={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},$O=500,FO=600,UO="_blank",BO="http://localhost";class yx{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function zO(t,e,n,r=$O,s=FO){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const c={...jO,width:r.toString(),height:s.toString(),top:i,left:o},d=Pn().toLowerCase();n&&(l=YE(d)?UO:n),GE(d)&&(e=e||BO,c.scrollbars="yes");const u=Object.entries(c).reduce((f,[S,R])=>`${f}${S}=${R},`,"");if(oP(d)&&l!=="_self")return HO(e||"",l),new yx(null);const p=window.open(e||"",l,u);Ge(p,t,"popup-blocked");try{p.focus()}catch{}return new yx(p)}function HO(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WO="__/auth/handler",GO="emulator/auth/handler",VO=encodeURIComponent("fac");async function vx(t,e,n,r,s,i){Ge(t.config.authDomain,t,"auth-domain-config-required"),Ge(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:la,eventId:s};if(e instanceof rS){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",ou(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[u,p]of Object.entries({}))o[u]=p}if(e instanceof oc){const u=e.getScopes().filter(p=>p!=="");u.length>0&&(o.scopes=u.join(","))}t.tenantId&&(o.tid=t.tenantId);const l=o;for(const u of Object.keys(l))l[u]===void 0&&delete l[u];const c=await t._getAppCheckToken(),d=c?`#${VO}=${encodeURIComponent(c)}`:"";return`${YO(t)}?${aa(l).slice(1)}${d}`}function YO({config:t}){return t.emulator?Q0(t,GO):`https://${t.authDomain}/${WO}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dh="webStorageSupport";class KO{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=dS,this._completeRedirectFn=vO,this._overrideRedirectResult=gO}async _openPopup(e,n,r,s){var o;gs((o=this.eventManagers[e._key()])==null?void 0:o.manager,"_initialize() not called before _openPopup()");const i=await vx(e,n,r,Jp(),s);return zO(e,i,nm())}async _openRedirect(e,n,r,s){await this._originValidation(e);const i=await vx(e,n,r,Jp(),s);return QP(i),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:s,promise:i}=this.eventManagers[n];return s?Promise.resolve(s):(gs(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await NO(e),r=new _O(e);return n.register("authEvent",s=>(Ge(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(Dh,{type:Dh},s=>{var o;const i=(o=s==null?void 0:s[0])==null?void 0:o[Dh];i!==void 0&&n(!!i),kr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=IO(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return qE()||VE()||Z0()}}const XO=KO;var xx="@firebase/auth",_x="1.12.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JO{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){Ge(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QO(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function qO(t){Xo(new Fi("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:l}=r.options;Ge(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:o,authDomain:l,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:ZE(t)},d=new fP(r,s,i,c);return EP(d,n),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),Xo(new Fi("auth-internal",e=>{const n=Xi(e.getProvider("auth").getImmediate());return(r=>new JO(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Qs(xx,_x,QO(t)),Qs(xx,_x,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZO=5*60,eL=mb("authIdTokenMaxAge")||ZO;let bx=null;const tL=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>eL)return;const s=n==null?void 0:n.token;bx!==s&&(bx=s,await fetch(t,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function nL(t=wb()){const e=g0(t,"auth");if(e.isInitialized())return e.getImmediate();const n=bP(t,{popupRedirectResolver:XO,persistence:[oO,KP,dS]}),r=mb("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=tL(i.toString());HP(n,o,()=>o(n.currentUser)),zP(n,l=>o(l))}}const s=pb("auth");return s&&SP(n,`http://${s}`),n}function rL(){var t;return((t=document.getElementsByTagName("head"))==null?void 0:t[0])??document}hP({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=s=>{const i=Hr("internal-error");i.customData=s,n(i)},r.type="text/javascript",r.charset="UTF-8",rL().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});qO("Browser");const sL={apiKey:"AIzaSyCqXssa5oOaWY3CiN7ti53Qt1F_AGpBrVE",authDomain:"tenfubu-verse.firebaseapp.com",databaseURL:"https://tenfubu-verse-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"tenfubu-verse",storageBucket:"tenfubu-verse.firebasestorage.app",messagingSenderId:"1047996014362",appId:"1:1047996014362:web:729f6b715d929087e296a3"},yS=Sb(sL),Fr=MA(yS),lc=nL(yS),sm=[{rank:"BRONZE",min:0,max:2e3,lossPoints:0},{rank:"SILVER",min:2001,max:4e3,lossPoints:20},{rank:"GOLD",min:4001,max:6e3,lossPoints:40},{rank:"PLATINUM",min:6001,max:8e3,lossPoints:60},{rank:"DIAMOND",min:8001,max:1e4,lossPoints:80},{rank:"MASTER",min:10001,max:1/0,lossPoints:100}],Ur={BRONZE:"",SILVER:"",GOLD:"",PLATINUM:"",DIAMOND:"",MASTER:""},Bn=t=>{for(const e of sm)if(t>=e.min&&t<=e.max)return e.rank;return"BRONZE"},dl=t=>sm.findIndex(e=>e.rank===t),vS=()=>({rating:0,winStreak:0,totalMatches:0,wins:0,losses:0}),sd=200,Ex=100,iL=10,oL=20,aL=(t,e,n)=>{const r=Bn(t),s=Bn(n),i=dl(r),o=dl(s),l=e+1,c=Math.min((l-1)*iL,Ex),d=Math.max(0,o-i),u=Math.min(d*oL,Ex),p=100+c+u,f=Math.floor(sd*p/100),S=t+f,R=Bn(S),C=dl(R);return{newRating:S,ratingChange:f,newWinStreak:l,newRank:R,oldRank:r,isRankUp:C>i,isRankDown:!1,bonusBreakdown:{base:sd,winStreakBonus:Math.floor(sd*c/100),rankDiffBonus:Math.floor(sd*u/100),total:f}}},lL=t=>{const e=Bn(t),r=-sm.find(c=>c.rank===e).lossPoints,s=Math.max(0,t+r),i=Bn(s),o=dl(e),l=dl(i);return{newRating:s,ratingChange:r,newWinStreak:0,newRank:i,oldRank:e,isRankUp:!1,isRankDown:l<o,bonusBreakdown:{base:r,winStreakBonus:0,rankDiffBonus:0,total:r}}},Sx=async(t,e,n)=>{const r=$r(Fr,`players/${t}`),s=await cf(r);if(s.exists()){const o=s.val();return o.userId||(await X0(r,{userId:e}),o.userId=e),o}const i={userId:e,playerName:n||"",createdAt:Date.now(),lastMatchAt:Date.now(),ratings:{}};return await lf(r,i),i},xS=async(t,e)=>{const n=$r(Fr,`players/${t}/ratings/${e}`),r=await cf(n);if(r.exists())return r.val();const s=vS();return await lf(n,s),s},_S=async t=>{const e=$r(Fr,`players/${t}/ratings`),n=await cf(e);return n.exists()?n.val():{}},cL=async(t,e,n,r)=>{const s=$r(Fr,`players/${t}/ratings/${e}`),i=$r(Fr,`players/${t}`);await FA(s,o=>{const l=o||vS();return{rating:n.newRating,winStreak:n.newWinStreak,totalMatches:l.totalMatches+1,wins:l.wins+(r?1:0),losses:l.losses+(r?0:1)}}),await X0(i,{lastMatchAt:Date.now()})},dL=async(t,e)=>{const n=$r(Fr,`players/${t}`);await X0(n,{playerName:e})},Zr=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},uL=1280,fL=720,wx=Zr("/leaders/azya_leader.png"),Ix=Zr("/leaders/senka_leader.png"),Tx=Zr("/leaders/yoRuka_leader.png"),id={BRONZE:"#cd7f32",SILVER:"#c0c0c0",GOLD:"#ffd700",PLATINUM:"#e5e4e2",DIAMOND:"#b9f2ff",MASTER:"#ff4500"},hL=({onStartConfig:t,audioSettings:e,onAudioSettingsChange:n,playerId:r,onSetHomeCard:s,homeCardId:i=null,isAnonymous:o=!0,userId:l=null,onNavigateToRegister:c,onNavigateToLogin:d,onNavigateToProfile:u,onLogout:p})=>{const[f,S]=A.useState("title"),[R,C]=A.useState(!1);A.useEffect(()=>{console.log(" TitleScreen auth state:",{isAnonymous:o,userId:l})},[o,l]),A.useEffect(()=>{console.log(" TitleScreen homeCardId changed:",i)},[i]);const[j,_]=A.useState("home"),[v,w]=A.useState("home"),[h,D]=A.useState(!1),[H,re]=A.useState(!1),[W,Z]=A.useState(""),[he,xe]=A.useState(!1),[Ue,de]=A.useState("class"),[ie,O]=A.useState(null),[T,k]=A.useState(null),[y,g]=A.useState([]),[I,P]=A.useState([]),[N,J]=A.useState(!1),[U,ve]=A.useState("CPU"),[Re,Ie]=A.useState("NORMAL"),[te,K]=A.useState({}),[Oe,_e]=A.useState(!1),[ze,Se]=A.useState(25),[De,vt]=A.useState(!1),[st,at]=A.useState(!1),et=A.useRef(0),$e=A.useRef(0),nt=A.useRef(0),mt=A.useRef(0),Ct=A.useRef(0),ne=A.useRef(null),Me=A.useRef(null),Ye=A.useRef(Date.now()),[E,Ut]=A.useState(1);A.useEffect(()=>{const M=()=>{const Fe=window.innerWidth/uL,lt=window.innerHeight/fL;Ut(Math.min(Fe,lt))};return M(),window.addEventListener("resize",M),()=>window.removeEventListener("resize",M)},[]),A.useEffect(()=>{(async()=>{if(!r){_e(!1);return}_e(!0);try{const Fe=await _S(r);K(Fe)}catch(Fe){console.error("Failed to fetch class ratings:",Fe)}finally{_e(!1)}})()},[r]);const ys=()=>{C(!0),setTimeout(()=>{S("home"),C(!1)},600)},ha=M=>{M===j||h||(_(M),D(!0),setTimeout(()=>{w(M),D(!1)},150))},pi=M=>{const Fe=M%360;return Fe<0?Fe+360:Fe},fr=()=>{ne.current!==null&&(cancelAnimationFrame(ne.current),ne.current=null)},eo=()=>{Me.current!==null&&(cancelAnimationFrame(Me.current),Me.current=null),at(!1)},gf=()=>{eo(),at(!0);const M=.2,Fe=()=>{Se(lt=>pi(lt+M)),Me.current=requestAnimationFrame(Fe)};Me.current=requestAnimationFrame(Fe)},cc=M=>{fr(),eo(),Ye.current=Date.now(),vt(!0),et.current=M.clientX,$e.current=ze,nt.current=Date.now(),mt.current=M.clientX,Ct.current=0},dc=M=>{if(!De)return;const Fe=Date.now(),lt=Fe-nt.current,Et=M.clientX-mt.current;lt>0&&(Ct.current=Et/lt);const Vt=M.clientX-et.current,tr=$e.current+Vt*.5;Se(pi(tr)),nt.current=Fe,mt.current=M.clientX},pa=()=>{vt(!1),Ye.current=Date.now();let M=Ct.current*.5;const Fe=.95,lt=.1,Et=()=>{Math.abs(M)>lt?(Se(Vt=>pi(Vt+M)),M*=Fe,ne.current=requestAnimationFrame(Et)):(ne.current=null,Ye.current=Date.now())};Math.abs(M)>lt&&Et()};A.useEffect(()=>()=>{fr(),eo()},[]),A.useEffect(()=>{if(j!=="home")return;const M=setInterval(()=>{Date.now()-Ye.current>=2e3&&!De&&!ne.current&&!st&&gf()},100);return()=>clearInterval(M)},[j,De,st]);const uc=M=>{Ar(M==="casual"?"CASUAL_MATCH":"RANKED_MATCH")},fc=()=>{xe(!0)},er=()=>{xe(!1),p&&p()},hc=()=>{xe(!1)},vs=M=>{O(M);const lt=(M==="SENKA"?a0:M==="AJA"?l0:c0).filter(Et=>!Et.cardId.startsWith("TOKEN_")).map(Et=>{var Vt;return{cardId:Et.cardId,cost:((Vt=$n.find(tr=>tr.id===Et.cardId))==null?void 0:Vt.cost)||0}}).sort((Et,Vt)=>Et.cost-Vt.cost).map(Et=>Et.cardId);P(lt),de("card-list")},gi=M=>{k(M),de("card-detail")},mf=M=>{if(!T||I.length===0)return;const Fe=I.indexOf(T);if(Fe===-1)return;let lt;M==="prev"?lt=Fe===0?I.length-1:Fe-1:lt=Fe===I.length-1?0:Fe+1,k(I[lt])},ga=M=>{const Fe=$n.find(lt=>lt.id===M);Fe&&Fe.relatedCards&&Fe.relatedCards.length>0&&(k(M),g(Fe.relatedCards),de("related-card"))},yf=()=>{k(null),de("card-list")},vf=()=>{g([]),de("card-detail")},Ar=(M,Fe,lt)=>{ve(M),Fe&&Z(Fe),lt&&Ie(lt),J(!0)},to=M=>{J(!1),t(U,U==="JOIN"?W:void 0,M,U==="CPU"?Re:void 0),re(!1)},ma=()=>{J(!1)};A.useEffect(()=>{j!=="gallery"&&(de("class"),O(null),k(null),g([]))},[j]);const pc=9*E;if(f==="title")return a.jsxs("div",{className:"screen title-screen",onClick:ys,style:{height:"100dvh",width:"100vw",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative",overflow:"hidden",color:"white",cursor:"pointer"},children:[a.jsx("div",{style:{position:"absolute",inset:0,backgroundImage:`url(${Zr("/title/background.png")})`,backgroundSize:"cover",backgroundPosition:"center",zIndex:0}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",zIndex:-1}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(0, 0, 0, 0.3)",zIndex:1}}),a.jsxs("div",{style:{position:"relative",zIndex:2,display:"flex",flexDirection:"column",alignItems:"center",transform:R?"translateY(-100vh)":"translateY(0)",transition:R?"transform 0.6s ease-out":"none"},children:[a.jsx("div",{style:{fontFamily:"Tamanegi, sans-serif",fontSize:`${pc}rem`,color:"#fff",textShadow:"0 0 30px rgba(233, 69, 96, 0.9), 0 0 60px rgba(233, 69, 96, 0.5), 3px 3px 6px rgba(0,0,0,0.9)",letterSpacing:`${.5*E}rem`,whiteSpace:"nowrap",marginBottom:`${2*E}rem`},children:""}),a.jsx("div",{style:{fontSize:`${2*E}rem`,color:"#fff",fontWeight:"bold",letterSpacing:`${.3*E}rem`,animation:"blink 1.5s ease-in-out infinite",textShadow:"0 0 10px rgba(255, 255, 255, 0.8)"},children:"GAME START"})]}),a.jsx("p",{style:{position:"absolute",bottom:20*E,opacity:.5,fontSize:`${.8*E}rem`,zIndex:2},children:"Ver 1.04 Beta"}),a.jsx("style",{children:`
                    @keyframes blink {
                        0%, 100% { opacity: 1; }
                        50% { opacity: 0.3; }
                    }
                `})]});const xf=[{id:"solo",label:"",color:"#e94560"},{id:"room",label:"",color:"#60a5fa"},{id:"random",label:"",color:"#4ade80"},{id:"home",label:"",color:"#f59e0b"},{id:"ranking",label:"",color:"#a855f7"},{id:"gallery",label:"",color:"#ec4899"},{id:"settings",label:"",color:"#6b7280"}];return a.jsxs("div",{className:"screen home-screen",style:{height:"100dvh",width:"100vw",display:"flex",flexDirection:"column",position:"relative",overflow:"hidden",color:"white"},onMouseMove:dc,onMouseUp:pa,onMouseLeave:pa,children:[a.jsx("div",{style:{position:"absolute",inset:0,backgroundImage:`url(${Zr("/title/background.png")})`,backgroundSize:"cover",backgroundPosition:"center",zIndex:0}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",zIndex:-1}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(0, 0, 0, 0.5)",zIndex:1}}),a.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",paddingBottom:80*E,position:"relative",zIndex:2},children:[v==="home"&&(()=>{console.log(" Rendering home card, homeCardId:",i);const M=i?$n.find(Et=>Et.id===i):null,Fe=(M==null?void 0:M.imageUrl)||`/cards/${i}.png`,lt=(M==null?void 0:M.type)==="FOLLOWER"?(M==null?void 0:M.evolvedImageUrl)||`/cards/${i}_evolved.png`:null;return a.jsxs("div",{style:{position:"absolute",left:150*E,top:"50%",transform:"translateY(-50%)",perspective:1e3},children:[a.jsxs("div",{onMouseDown:cc,style:{width:439*E,height:615*E,transformStyle:"preserve-3d",transform:`rotateY(${ze}deg)`,transition:De?"none":"transform 0.3s ease-out",cursor:De?"grabbing":"grab"},children:[a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",borderRadius:12*E,background:i?`#2d3748 url(${Zr(Fe)}) center/cover no-repeat`:"linear-gradient(135deg, #2d3748 0%, #1a202c 100%)",border:`3px solid ${i?"#e94560":"#4a5568"}`,boxShadow:"0 10px 30px rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center"},children:!i&&a.jsxs("span",{style:{fontSize:`${.9*E}rem`,color:"#718096",textAlign:"center",padding:20*E},children:["",a.jsx("br",{}),"",a.jsx("br",{}),""]})}),a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",transform:"rotateY(180deg)",borderRadius:12*E,background:i&&lt?`#2d3748 url(${Zr(lt)}) center/cover no-repeat`:i?`#2d3748 url(${Zr(Fe)}) center/cover no-repeat`:`url(${Zr("/cards/sleeve_default.png")}) center/cover no-repeat`,border:`3px solid ${i?"#a855f7":"#4a5568"}`,boxShadow:"0 10px 30px rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center"},children:!i&&a.jsx("span",{style:{fontSize:`${.8*E}rem`,color:"#718096"},children:""})})]}),a.jsx("p",{style:{textAlign:"center",marginTop:10*E,fontSize:`${.75*E}rem`,color:"#888"},children:""})]})})(),v==="home"&&a.jsxs("div",{style:{position:"absolute",right:100*E,top:"50%",transform:"translateY(-50%)",display:"flex",flexDirection:"column",gap:`${2*E}rem`,width:350*E},children:[a.jsxs("div",{style:{background:"rgba(0, 0, 0, 0.6)",border:"2px solid rgba(255, 255, 255, 0.2)",borderRadius:`${12*E}px`,padding:`${20*E}px`,boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)"},children:[a.jsx("h3",{style:{margin:0,marginBottom:`${10*E}px`,fontSize:`${1.2*E}rem`,color:"#fff",borderBottom:"1px solid rgba(255, 255, 255, 0.2)",paddingBottom:`${8*E}px`},children:""}),a.jsx("div",{style:{fontSize:`${1*E}rem`,color:"#e2e8f0"},children:a.jsxs("div",{style:{marginBottom:`${8*E}px`},children:[a.jsx("span",{style:{color:"#aaa"},children:":"})," ",l||""]})})]}),a.jsxs("div",{style:{background:"rgba(0, 0, 0, 0.6)",border:"2px solid rgba(255, 255, 255, 0.2)",borderRadius:`${12*E}px`,padding:`${20*E}px`,boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)"},children:[a.jsx("h3",{style:{margin:0,marginBottom:`${15*E}px`,fontSize:`${1.2*E}rem`,color:"#fff",borderBottom:"1px solid rgba(255, 255, 255, 0.2)",paddingBottom:`${8*E}px`,textAlign:"center"},children:""}),Oe?a.jsx("div",{style:{textAlign:"center",color:"#aaa",fontSize:`${.9*E}rem`},children:"..."}):a.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:`${10*E}px`},children:[(()=>{const M=te.SENKA,Fe=(M==null?void 0:M.rating)??0,lt=Bn(Fe),Et=id[lt],Vt=Ur[lt];return a.jsxs("div",{style:{background:"rgba(233, 69, 96, 0.1)",border:"1px solid rgba(233, 69, 96, 0.3)",borderRadius:`${8*E}px`,padding:`${10*E}px`,textAlign:"center"},children:[a.jsx("div",{style:{fontSize:`${.85*E}rem`,color:"#e94560",fontWeight:"bold",marginBottom:`${5*E}px`},children:""}),a.jsx("div",{style:{fontSize:`${.75*E}rem`,color:Et,marginBottom:`${3*E}px`},children:Vt}),a.jsx("div",{style:{fontSize:`${1*E}rem`,color:"#4ade80",fontWeight:"bold"},children:Fe})]})})(),(()=>{const M=te.AJA,Fe=(M==null?void 0:M.rating)??0,lt=Bn(Fe),Et=id[lt],Vt=Ur[lt];return a.jsxs("div",{style:{background:"rgba(69, 162, 233, 0.1)",border:"1px solid rgba(69, 162, 233, 0.3)",borderRadius:`${8*E}px`,padding:`${10*E}px`,textAlign:"center"},children:[a.jsx("div",{style:{fontSize:`${.85*E}rem`,color:"#45a2e9",fontWeight:"bold",marginBottom:`${5*E}px`},children:""}),a.jsx("div",{style:{fontSize:`${.75*E}rem`,color:Et,marginBottom:`${3*E}px`},children:Vt}),a.jsx("div",{style:{fontSize:`${1*E}rem`,color:"#4ade80",fontWeight:"bold"},children:Fe})]})})(),(()=>{const M=te.YORUKA,Fe=(M==null?void 0:M.rating)??0,lt=Bn(Fe),Et=id[lt],Vt=Ur[lt];return a.jsxs("div",{style:{background:"rgba(168, 85, 247, 0.1)",border:"1px solid rgba(168, 85, 247, 0.3)",borderRadius:`${8*E}px`,padding:`${10*E}px`,textAlign:"center"},children:[a.jsx("div",{style:{fontSize:`${.85*E}rem`,color:"#a855f7",fontWeight:"bold",marginBottom:`${5*E}px`},children:"Y"}),a.jsx("div",{style:{fontSize:`${.75*E}rem`,color:Et,marginBottom:`${3*E}px`},children:Vt}),a.jsx("div",{style:{fontSize:`${1*E}rem`,color:"#4ade80",fontWeight:"bold"},children:Fe})]})})()]})]})]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",maxWidth:600*E,opacity:h?0:1,transition:"opacity 0.3s ease-in-out"},children:[v==="home"&&a.jsx("div",{style:{textAlign:"center"}}),v==="solo"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*E}rem`,marginBottom:`${1.5*E}rem`,color:"#e94560"},children:""}),a.jsxs("div",{style:{display:"flex",gap:`${3*E}rem`,perspective:1200},children:[a.jsxs("div",{onClick:()=>Ar("CPU",void 0,"EASY"),style:{width:200*E,height:280*E,background:"linear-gradient(135deg, #1a3a2a 0%, #0d2d1a 100%)",border:"3px solid #4ade80",borderRadius:16*E,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(74, 222, 128, 0.3)"},onMouseOver:M=>{M.currentTarget.style.transform="rotateY(0deg) scale(1.05)",M.currentTarget.style.boxShadow="0 15px 40px rgba(74, 222, 128, 0.5)"},onMouseOut:M=>{M.currentTarget.style.transform="rotateY(15deg)",M.currentTarget.style.boxShadow="0 10px 30px rgba(74, 222, 128, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*E}rem`,marginBottom:`${.5*E}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*E}rem`,color:"#4ade80",margin:0,marginBottom:`${.5*E}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*E}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*E}rem`},children:["",a.jsx("br",{}),"CPU"]})]}),a.jsxs("div",{onClick:()=>Ar("CPU",void 0,"NORMAL"),style:{width:200*E,height:280*E,background:"linear-gradient(135deg, #1a2a3a 0%, #0d1a2a 100%)",border:"3px solid #60a5fa",borderRadius:16*E,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(0deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(96, 165, 250, 0.3)"},onMouseOver:M=>{M.currentTarget.style.transform="scale(1.05)",M.currentTarget.style.boxShadow="0 15px 40px rgba(96, 165, 250, 0.5)"},onMouseOut:M=>{M.currentTarget.style.transform="rotateY(0deg)",M.currentTarget.style.boxShadow="0 10px 30px rgba(96, 165, 250, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*E}rem`,marginBottom:`${.5*E}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*E}rem`,color:"#60a5fa",margin:0,marginBottom:`${.5*E}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*E}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*E}rem`},children:["",a.jsx("br",{}),"CPU"]})]}),a.jsxs("div",{onClick:()=>Ar("CPU",void 0,"HARD"),style:{width:200*E,height:280*E,background:"linear-gradient(135deg, #3a1a1a 0%, #2d0d0d 100%)",border:"3px solid #e94560",borderRadius:16*E,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(-15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(233, 69, 96, 0.3)"},onMouseOver:M=>{M.currentTarget.style.transform="rotateY(0deg) scale(1.05)",M.currentTarget.style.boxShadow="0 15px 40px rgba(233, 69, 96, 0.5)"},onMouseOut:M=>{M.currentTarget.style.transform="rotateY(-15deg)",M.currentTarget.style.boxShadow="0 10px 30px rgba(233, 69, 96, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*E}rem`,marginBottom:`${.5*E}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*E}rem`,color:"#e94560",margin:0,marginBottom:`${.5*E}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*E}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*E}rem`},children:["",a.jsx("br",{}),"CPU"]})]})]})]}),v==="room"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*E}rem`,marginBottom:`${1.5*E}rem`,color:"#60a5fa"},children:""}),H?a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:`${1*E}rem`,alignItems:"center"},children:[a.jsx("input",{type:"text",placeholder:"ID",value:W,onChange:M=>Z(M.target.value),style:{padding:`${.8*E}rem`,fontSize:`${1*E}rem`,width:250*E,background:"rgba(255,255,255,0.1)",border:"2px solid #a855f7",borderRadius:8*E,color:"white",textAlign:"center",userSelect:"text"}}),a.jsxs("div",{style:{display:"flex",gap:`${.5*E}rem`},children:[a.jsx("button",{onClick:()=>re(!1),style:{padding:`${.6*E}rem ${1.5*E}rem`,fontSize:`${1*E}rem`,background:"transparent",border:"1px solid #666",borderRadius:6*E,color:"#888",cursor:"pointer"},children:""}),a.jsx("button",{onClick:()=>Ar("JOIN",W),disabled:!W,style:{padding:`${.6*E}rem ${1.5*E}rem`,fontSize:`${1*E}rem`,background:W?"#a855f7":"#333",border:"none",borderRadius:6*E,color:"white",cursor:W?"pointer":"not-allowed",opacity:W?1:.5},children:""})]})]}):a.jsxs("div",{style:{display:"flex",gap:`${3*E}rem`,perspective:1200},children:[a.jsxs("div",{onClick:()=>Ar("HOST"),style:{width:200*E,height:280*E,background:"linear-gradient(135deg, #1a2a3a 0%, #0d1a2a 100%)",border:"3px solid #60a5fa",borderRadius:16*E,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(96, 165, 250, 0.3)"},onMouseOver:M=>{M.currentTarget.style.transform="rotateY(0deg) scale(1.05)",M.currentTarget.style.boxShadow="0 15px 40px rgba(96, 165, 250, 0.5)"},onMouseOut:M=>{M.currentTarget.style.transform="rotateY(15deg)",M.currentTarget.style.boxShadow="0 10px 30px rgba(96, 165, 250, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*E}rem`,marginBottom:`${.5*E}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*E}rem`,color:"#60a5fa",margin:0,marginBottom:`${.5*E}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*E}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*E}rem`},children:["ID",a.jsx("br",{}),""]})]}),a.jsxs("div",{onClick:()=>re(!0),style:{width:200*E,height:280*E,background:"linear-gradient(135deg, #2a1a3a 0%, #1a0d2a 100%)",border:"3px solid #a855f7",borderRadius:16*E,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(-15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(168, 85, 247, 0.3)"},onMouseOver:M=>{M.currentTarget.style.transform="rotateY(0deg) scale(1.05)",M.currentTarget.style.boxShadow="0 15px 40px rgba(168, 85, 247, 0.5)"},onMouseOut:M=>{M.currentTarget.style.transform="rotateY(-15deg)",M.currentTarget.style.boxShadow="0 10px 30px rgba(168, 85, 247, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*E}rem`,marginBottom:`${.5*E}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*E}rem`,color:"#a855f7",margin:0,marginBottom:`${.5*E}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*E}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*E}rem`},children:["ID",a.jsx("br",{}),""]})]})]})]}),v==="random"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*E}rem`,marginBottom:`${1.5*E}rem`,color:"#4ade80"},children:""}),a.jsxs("div",{style:{display:"flex",gap:`${3*E}rem`,perspective:1200},children:[a.jsxs("div",{onClick:()=>uc("casual"),style:{width:200*E,height:280*E,background:"linear-gradient(135deg, #1a3a1a 0%, #0d2d0d 100%)",border:"3px solid #4ade80",borderRadius:16*E,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(74, 222, 128, 0.3)"},onMouseOver:M=>{M.currentTarget.style.transform="rotateY(0deg) scale(1.05)",M.currentTarget.style.boxShadow="0 15px 40px rgba(74, 222, 128, 0.5)"},onMouseOut:M=>{M.currentTarget.style.transform="rotateY(15deg)",M.currentTarget.style.boxShadow="0 10px 30px rgba(74, 222, 128, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*E}rem`,marginBottom:`${.5*E}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*E}rem`,color:"#4ade80",margin:0,marginBottom:`${.5*E}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*E}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*E}rem`},children:["",a.jsx("br",{}),""]})]}),a.jsxs("div",{onClick:()=>uc("ranked"),style:{width:200*E,height:280*E,background:"linear-gradient(135deg, #3a1a1a 0%, #2d0d0d 100%)",border:"3px solid #e94560",borderRadius:16*E,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(-15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(233, 69, 96, 0.3)"},onMouseOver:M=>{M.currentTarget.style.transform="rotateY(0deg) scale(1.05)",M.currentTarget.style.boxShadow="0 15px 40px rgba(233, 69, 96, 0.5)"},onMouseOut:M=>{M.currentTarget.style.transform="rotateY(-15deg)",M.currentTarget.style.boxShadow="0 10px 30px rgba(233, 69, 96, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*E}rem`,marginBottom:`${.5*E}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*E}rem`,color:"#e94560",margin:0,marginBottom:`${.5*E}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*E}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*E}rem`},children:["",a.jsx("br",{}),""]})]})]})]}),v==="ranking"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*E}rem`,marginBottom:`${1*E}rem`,color:"#a855f7"},children:""}),a.jsx("p",{style:{fontSize:`${1*E}rem`,color:"#888"},children:"Coming Soon..."})]}),v==="gallery"&&a.jsxs(a.Fragment,{children:[Ue==="class"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*E}rem`,marginBottom:`${1.5*E}rem`,color:"#ec4899"},children:" - "}),a.jsxs("div",{style:{display:"flex",gap:`${1.2*E}rem`,justifyContent:"center",marginBottom:`${1*E}rem`},children:[a.jsxs("div",{onClick:()=>vs("SENKA"),style:{width:200*E,height:280*E,border:"1px solid #444",borderRadius:10*E,background:"linear-gradient(180deg, #2c0b0e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:"0 4px 20px rgba(233, 69, 96, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:M=>{M.currentTarget.style.transform="scale(1.05)",M.currentTarget.style.boxShadow="0 8px 30px rgba(233, 69, 96, 0.4)"},onMouseOut:M=>{M.currentTarget.style.transform="scale(1)",M.currentTarget.style.boxShadow="0 4px 20px rgba(233, 69, 96, 0.2)"},children:[a.jsx("img",{src:Ix,alt:"Senka",style:{width:"100%",height:"75%",objectFit:"cover"}}),a.jsx("div",{style:{padding:`${8*E}px`,display:"flex",flexDirection:"column",alignItems:"center",width:"100%",justifyContent:"center",flex:1},children:a.jsx("h3",{style:{fontSize:`${1.4*E}rem`,color:"#e94560",margin:0,fontFamily:"sans-serif"},children:""})})]}),a.jsxs("div",{onClick:()=>vs("AJA"),style:{width:200*E,height:280*E,border:"1px solid #444",borderRadius:10*E,background:"linear-gradient(180deg, #0f1c2e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:"0 4px 20px rgba(69, 162, 233, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:M=>{M.currentTarget.style.transform="scale(1.05)",M.currentTarget.style.boxShadow="0 8px 30px rgba(69, 162, 233, 0.4)"},onMouseOut:M=>{M.currentTarget.style.transform="scale(1)",M.currentTarget.style.boxShadow="0 4px 20px rgba(69, 162, 233, 0.2)"},children:[a.jsx("img",{src:wx,alt:"Azya",style:{width:"100%",height:"75%",objectFit:"cover",objectPosition:"center top"}}),a.jsx("div",{style:{padding:`${8*E}px`,display:"flex",flexDirection:"column",alignItems:"center",width:"100%",justifyContent:"center",flex:1},children:a.jsx("h3",{style:{fontSize:`${1.4*E}rem`,color:"#45a2e9",margin:0,fontFamily:"sans-serif"},children:""})})]}),a.jsxs("div",{onClick:()=>vs("YORUKA"),style:{width:200*E,height:280*E,border:"1px solid #444",borderRadius:10*E,background:"linear-gradient(180deg, #1a0f2e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:"0 4px 20px rgba(168, 85, 247, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:M=>{M.currentTarget.style.transform="scale(1.05)",M.currentTarget.style.boxShadow="0 8px 30px rgba(168, 85, 247, 0.4)"},onMouseOut:M=>{M.currentTarget.style.transform="scale(1)",M.currentTarget.style.boxShadow="0 4px 20px rgba(168, 85, 247, 0.2)"},children:[a.jsx("img",{src:Tx,alt:"Yoruka",style:{width:"100%",height:"75%",objectFit:"cover"}}),a.jsx("div",{style:{padding:`${8*E}px`,display:"flex",flexDirection:"column",alignItems:"center",width:"100%",justifyContent:"center",flex:1},children:a.jsx("h3",{style:{fontSize:`${1.4*E}rem`,color:"#a855f7",margin:0,fontFamily:"sans-serif"},children:"Y"})})]})]})]}),Ue==="card-list"&&ie&&a.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"auto"},children:a.jsx(CT,{classType:ie,onSelectCard:gi})}),Ue==="card-detail"&&T&&a.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"auto"},children:a.jsx(PT,{cardId:T,allCardIds:I,onNavigate:mf,onOpenRelatedCard:ga,onBack:yf,onSetHomeCard:s})}),Ue==="related-card"&&T&&a.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"auto"},children:a.jsx(MT,{parentCardId:T,relatedCardIds:y,onBack:vf})})]}),v==="settings"&&a.jsxs("div",{style:{background:"rgba(0, 0, 0, 0.3)",borderRadius:12*E,padding:`${2*E}rem`,minWidth:400*E},children:[a.jsx("h2",{style:{fontSize:`${1.8*E}rem`,marginBottom:`${1.5*E}rem`,color:"#6b7280",textAlign:"center"},children:""}),a.jsxs("div",{style:{marginBottom:`${1.5*E}rem`},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:`${.5*E}rem`},children:[a.jsx("span",{style:{fontSize:`${1*E}rem`},children:"BGM"}),a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8*E,cursor:"pointer"},children:[a.jsx("input",{type:"checkbox",checked:e.bgmEnabled,onChange:M=>n({bgmEnabled:M.target.checked}),style:{width:18*E,height:18*E}}),a.jsx("span",{style:{color:e.bgmEnabled?"#4ade80":"#888",fontSize:`${.9*E}rem`},children:e.bgmEnabled?"ON":"OFF"})]})]}),a.jsx("input",{type:"range",min:0,max:1,step:.05,value:e.bgm,onChange:M=>n({bgm:parseFloat(M.target.value)}),disabled:!e.bgmEnabled,style:{width:"100%",opacity:e.bgmEnabled?1:.5}})]}),a.jsxs("div",{style:{marginBottom:`${1.5*E}rem`},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:`${.5*E}rem`},children:[a.jsx("span",{style:{fontSize:`${1*E}rem`},children:""}),a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8*E,cursor:"pointer"},children:[a.jsx("input",{type:"checkbox",checked:e.seEnabled,onChange:M=>n({seEnabled:M.target.checked}),style:{width:18*E,height:18*E}}),a.jsx("span",{style:{color:e.seEnabled?"#4ade80":"#888",fontSize:`${.9*E}rem`},children:e.seEnabled?"ON":"OFF"})]})]}),a.jsx("input",{type:"range",min:0,max:1,step:.05,value:e.se,onChange:M=>n({se:parseFloat(M.target.value)}),disabled:!e.seEnabled,style:{width:"100%",opacity:e.seEnabled?1:.5}})]}),a.jsxs("div",{style:{borderTop:"1px solid rgba(255, 255, 255, 0.1)",paddingTop:`${1.5*E}rem`,marginTop:`${1*E}rem`,marginBottom:`${1.5*E}rem`},children:[a.jsx("h3",{style:{fontSize:`${1.2*E}rem`,marginBottom:`${1*E}rem`,color:"#fff"},children:""}),a.jsx("button",{onClick:u,style:{width:"100%",padding:`${.6*E}rem ${1*E}rem`,fontSize:`${.9*E}rem`,background:"linear-gradient(135deg, #a855f7 0%, #7c3aed 100%)",border:"none",borderRadius:6*E,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s"},onMouseEnter:M=>M.currentTarget.style.transform="scale(1.05)",onMouseLeave:M=>M.currentTarget.style.transform="scale(1)",children:""})]}),a.jsxs("div",{style:{borderTop:"1px solid rgba(255, 255, 255, 0.1)",paddingTop:`${1.5*E}rem`,marginTop:`${1*E}rem`},children:[a.jsx("h3",{style:{fontSize:`${1.2*E}rem`,marginBottom:`${1*E}rem`,color:"#fff"},children:""}),o?a.jsxs("div",{children:[a.jsx("p",{style:{fontSize:`${.9*E}rem`,color:"#aaa",marginBottom:`${1*E}rem`},children:""}),a.jsxs("div",{style:{display:"flex",gap:10*E,marginBottom:`${1*E}rem`},children:[a.jsx("button",{onClick:c,style:{flex:1,padding:`${.6*E}rem ${1*E}rem`,fontSize:`${.9*E}rem`,background:"linear-gradient(135deg, #4a9eff 0%, #357abd 100%)",border:"none",borderRadius:6*E,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s"},onMouseEnter:M=>M.currentTarget.style.transform="scale(1.05)",onMouseLeave:M=>M.currentTarget.style.transform="scale(1)",children:""}),a.jsx("button",{onClick:d,style:{flex:1,padding:`${.6*E}rem ${1*E}rem`,fontSize:`${.9*E}rem`,background:"#555",border:"none",borderRadius:6*E,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s"},onMouseEnter:M=>M.currentTarget.style.background="#666",onMouseLeave:M=>M.currentTarget.style.background="#555",children:""})]}),a.jsx("p",{style:{fontSize:`${.75*E}rem`,color:"#888",textAlign:"center",lineHeight:1.4},children:""})]}):a.jsxs("div",{children:[a.jsx("p",{style:{fontSize:`${.9*E}rem`,color:"#4ade80",marginBottom:`${.5*E}rem`,fontWeight:"bold"},children:""}),a.jsxs("p",{style:{fontSize:`${.85*E}rem`,color:"#fff",marginBottom:`${.3*E}rem`},children:["ID: ",a.jsx("span",{style:{color:"#4a9eff",fontWeight:"bold"},children:l||""})]}),a.jsx("button",{onClick:fc,style:{width:"100%",padding:`${.6*E}rem ${1*E}rem`,fontSize:`${.9*E}rem`,background:"#d32f2f",border:"none",borderRadius:6*E,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s",marginTop:`${.5*E}rem`},onMouseEnter:M=>M.currentTarget.style.background="#b71c1c",onMouseLeave:M=>M.currentTarget.style.background="#d32f2f",children:""})]})]})]})]})]}),a.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:70*E,background:"rgba(0, 0, 0, 0.8)",borderTop:"2px solid rgba(255, 255, 255, 0.1)",display:"flex",justifyContent:"center",alignItems:"center",gap:`${.5*E}rem`,padding:`0 ${1*E}rem`,zIndex:3},children:xf.map(M=>a.jsx("button",{onClick:()=>ha(M.id),style:{flex:1,maxWidth:140*E,padding:`${.6*E}rem ${.5*E}rem`,fontSize:`${.85*E}rem`,background:j===M.id?M.color:"transparent",border:j===M.id?"none":`2px solid ${M.color}`,borderRadius:8*E,color:j===M.id?"white":M.color,cursor:"pointer",transition:"all 0.2s",fontWeight:j===M.id?"bold":"normal"},children:M.label},M.id))}),a.jsx("p",{style:{position:"absolute",bottom:75*E,right:20*E,opacity:.5,fontSize:`${.7*E}rem`,zIndex:2},children:"Ver 1.04 Beta"}),he&&a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0, 0, 0, 0.7)",zIndex:100},children:a.jsxs("div",{style:{background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",borderRadius:12*E,padding:`${2*E}rem`,minWidth:300*E,border:"2px solid rgba(255, 255, 255, 0.2)",boxShadow:"0 10px 30px rgba(0, 0, 0, 0.5)"},children:[a.jsx("h3",{style:{fontSize:`${1.2*E}rem`,marginBottom:`${1*E}rem`,color:"#fff",textAlign:"center"},children:""}),a.jsxs("div",{style:{display:"flex",gap:10*E,marginTop:`${1.5*E}rem`},children:[a.jsx("button",{onClick:hc,style:{flex:1,padding:`${.6*E}rem ${1*E}rem`,fontSize:`${.9*E}rem`,background:"#555",border:"none",borderRadius:6*E,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s"},onMouseEnter:M=>M.currentTarget.style.background="#666",onMouseLeave:M=>M.currentTarget.style.background="#555",children:""}),a.jsx("button",{onClick:er,style:{flex:1,padding:`${.6*E}rem ${1*E}rem`,fontSize:`${.9*E}rem`,background:"#d32f2f",border:"none",borderRadius:6*E,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s"},onMouseEnter:M=>M.currentTarget.style.background="#b71c1c",onMouseLeave:M=>M.currentTarget.style.background="#d32f2f",children:""})]})]})}),N&&a.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"rgba(0, 0, 0, 0.85)",zIndex:200,padding:`${2*E}rem`},children:[a.jsx("h2",{style:{fontSize:`${2*E}rem`,marginBottom:`${2*E}rem`,color:"#fff"},children:""}),a.jsxs("div",{style:{display:"flex",gap:`${1.5*E}rem`,marginBottom:`${1*E}rem`},children:[a.jsxs("div",{onClick:()=>to("SENKA"),style:{width:200*E,borderRadius:12*E,overflow:"hidden",cursor:"pointer",border:"3px solid rgba(255, 255, 255, 0.3)",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:"0 4px 15px rgba(0, 0, 0, 0.5)",background:"linear-gradient(180deg, #2c0b0e 0%, #1a1a2e 100%)"},onMouseOver:M=>{M.currentTarget.style.transform="translateY(-10px) scale(1.05)",M.currentTarget.style.boxShadow="0 8px 25px rgba(255, 100, 100, 0.5)"},onMouseOut:M=>{M.currentTarget.style.transform="translateY(0) scale(1)",M.currentTarget.style.boxShadow="0 4px 15px rgba(0, 0, 0, 0.5)"},children:[a.jsx("img",{src:Ix,alt:"",style:{width:"100%",height:168*E,objectFit:"cover"}}),a.jsxs("div",{style:{padding:`${8*E}px`,textAlign:"center"},children:[a.jsx("h3",{style:{fontSize:`${1.4*E}rem`,color:"#e94560",margin:0},children:""}),a.jsx("p",{style:{color:"#aaa",margin:`${4*E}px 0`,fontSize:`${.75*E}rem`},children:" / "}),a.jsxs("p",{style:{fontSize:`${.65*E}rem`,opacity:.8,lineHeight:1.3,margin:0},children:["",a.jsx("br",{}),""]})]})]}),a.jsxs("div",{onClick:()=>to("AJA"),style:{width:200*E,borderRadius:12*E,overflow:"hidden",cursor:"pointer",border:"3px solid rgba(255, 255, 255, 0.3)",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:"0 4px 15px rgba(0, 0, 0, 0.5)",background:"linear-gradient(180deg, #0f1c2e 0%, #1a1a2e 100%)"},onMouseOver:M=>{M.currentTarget.style.transform="translateY(-10px) scale(1.05)",M.currentTarget.style.boxShadow="0 8px 25px rgba(100, 200, 255, 0.5)"},onMouseOut:M=>{M.currentTarget.style.transform="translateY(0) scale(1)",M.currentTarget.style.boxShadow="0 4px 15px rgba(0, 0, 0, 0.5)"},children:[a.jsx("img",{src:wx,alt:"",style:{width:"100%",height:168*E,objectFit:"cover",objectPosition:"center top"}}),a.jsxs("div",{style:{padding:`${8*E}px`,textAlign:"center"},children:[a.jsx("h3",{style:{fontSize:`${1.4*E}rem`,color:"#45a2e9",margin:0},children:""}),a.jsx("p",{style:{color:"#aaa",margin:`${4*E}px 0`,fontSize:`${.75*E}rem`},children:" / "}),a.jsxs("p",{style:{fontSize:`${.65*E}rem`,opacity:.8,lineHeight:1.3,margin:0},children:["",a.jsx("br",{}),""]})]})]}),a.jsxs("div",{onClick:()=>to("YORUKA"),style:{width:200*E,borderRadius:12*E,overflow:"hidden",cursor:"pointer",border:"3px solid rgba(255, 255, 255, 0.3)",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:"0 4px 15px rgba(0, 0, 0, 0.5)",background:"linear-gradient(180deg, #1a0f2e 0%, #1a1a2e 100%)"},onMouseOver:M=>{M.currentTarget.style.transform="translateY(-10px) scale(1.05)",M.currentTarget.style.boxShadow="0 8px 25px rgba(200, 100, 255, 0.5)"},onMouseOut:M=>{M.currentTarget.style.transform="translateY(0) scale(1)",M.currentTarget.style.boxShadow="0 4px 15px rgba(0, 0, 0, 0.5)"},children:[a.jsx("img",{src:Tx,alt:"Y",style:{width:"100%",height:168*E,objectFit:"cover"}}),a.jsxs("div",{style:{padding:`${8*E}px`,textAlign:"center"},children:[a.jsx("h3",{style:{fontSize:`${1.4*E}rem`,color:"#a855f7",margin:0},children:"Y"}),a.jsx("p",{style:{color:"#aaa",margin:`${4*E}px 0`,fontSize:`${.75*E}rem`},children:" / "}),a.jsxs("p",{style:{fontSize:`${.65*E}rem`,opacity:.8,lineHeight:1.3,margin:0},children:["",a.jsx("br",{}),""]})]})]})]}),U==="RANKED_MATCH"&&!Oe&&a.jsx("div",{style:{display:"flex",gap:`${1.5*E}rem`,marginBottom:`${2*E}rem`},children:["SENKA","AJA","YORUKA"].map(M=>{const Fe=te[M],lt=(Fe==null?void 0:Fe.rating)??0,Et=Bn(lt),Vt=id[Et],tr=Ur[Et];return a.jsxs("div",{style:{width:200*E,textAlign:"center",color:"#fff"},children:[a.jsx("div",{style:{fontSize:`${1*E}rem`,color:Vt,fontWeight:"bold"},children:tr}),a.jsx("div",{style:{fontSize:`${1.2*E}rem`,color:"#4ade80",fontWeight:"bold"},children:lt})]},M)})}),a.jsx("button",{onClick:ma,style:{padding:`${.8*E}rem ${2*E}rem`,fontSize:`${1*E}rem`,background:"transparent",border:"2px solid rgba(255, 255, 255, 0.3)",borderRadius:8*E,color:"white",cursor:"pointer",transition:"all 0.2s"},onMouseOver:M=>{M.currentTarget.style.background="rgba(255, 255, 255, 0.1)",M.currentTarget.style.borderColor="rgba(255, 255, 255, 0.5)"},onMouseOut:M=>{M.currentTarget.style.background="transparent",M.currentTarget.style.borderColor="rgba(255, 255, 255, 0.3)"},children:""})]})]})},im=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},pL=im("/leaders/azya_leader.png"),gL=im("/leaders/senka_leader.png"),mL=im("/leaders/yoRuka_leader.png"),yL=1280,vL=720,xL={BRONZE:"#cd7f32",SILVER:"#c0c0c0",GOLD:"#ffd700",PLATINUM:"#e5e4e2",DIAMOND:"#b9f2ff",MASTER:"#ff4500"},_L=({onSelectClass:t,onBack:e,gameMode:n="CPU",aiDifficulty:r="NORMAL",onDifficultyChange:s,playerName:i,onPlayerNameChange:o,timerEnabled:l=!0,onTimerEnabledChange:c,playerId:d})=>{const[u,p]=A.useState(1),[f,S]=A.useState({}),[R,C]=A.useState(!1);A.useEffect(()=>{const Z=()=>{const he=window.innerWidth/yL,xe=window.innerHeight/vL;p(Math.min(he,xe))};return Z(),window.addEventListener("resize",Z),()=>window.removeEventListener("resize",Z)},[]),A.useEffect(()=>{(async()=>{if(!d){C(!1);return}C(!0);try{const he=await _S(d);S(he)}catch(he){console.error("Failed to fetch class ratings:",he)}finally{C(!1)}})()},[d]);const j=200*u,_=280*u,v=2*u,w=1.4*u,h=.75*u,D=.65*u,H=1.2*u,re=`${8*u}px ${16*u}px`,W=Z=>{if(n!=="RANKED_MATCH"||!d||R)return null;const he=f[Z];if(!he)return null;const xe=Bn(he.rating),Ue=Ur[xe],de=xL[xe];return a.jsxs("div",{style:{marginTop:`${4*u}px`,padding:`${4*u}px ${8*u}px`,background:"rgba(0, 0, 0, 0.3)",borderRadius:4*u,display:"flex",alignItems:"center",gap:`${6*u}px`},children:[a.jsx("span",{style:{fontSize:`${.7*u}rem`,fontWeight:"bold",color:de,fontFamily:"Tamanegi, sans-serif"},children:Ue}),a.jsx("span",{style:{fontSize:`${.75*u}rem`,color:"#fff",fontFamily:"Tamanegi, sans-serif"},children:he.rating})]})};return a.jsxs("div",{className:"screen",style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"#1a1a2e",color:"white"},children:[a.jsx("h2",{style:{fontSize:`${v}rem`,marginBottom:`${.5*u}rem`,marginTop:0},children:""}),a.jsxs("div",{style:{marginBottom:`${.8*u}rem`,display:"flex",flexDirection:"column",alignItems:"center",gap:`${.3*u}rem`},children:[a.jsx("label",{style:{fontSize:`${.9*u}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif"},children:""}),a.jsx("input",{type:"text",value:i,onChange:Z=>o(Z.target.value),maxLength:12,placeholder:"",style:{padding:`${6*u}px ${12*u}px`,fontSize:`${.9*u}rem`,background:"#2d3748",border:"2px solid #4a5568",borderRadius:6*u,color:"white",outline:"none",width:180*u,textAlign:"center",fontFamily:"Tamanegi, sans-serif"},onFocus:Z=>Z.target.style.borderColor="#63b3ed",onBlur:Z=>Z.target.style.borderColor="#4a5568"})]}),a.jsxs("div",{style:{display:"flex",gap:`${H}rem`,marginBottom:`${1*u}rem`},children:[a.jsxs("div",{onClick:()=>t("SENKA"),style:{width:j,height:_,border:"1px solid #444",borderRadius:10*u,background:"linear-gradient(180deg, #2c0b0e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s",boxShadow:"0 4px 20px rgba(233, 69, 96, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:Z=>Z.currentTarget.style.transform="scale(1.05)",onMouseOut:Z=>Z.currentTarget.style.transform="scale(1)",children:[a.jsx("img",{src:gL,alt:"Senka",style:{width:"100%",height:"60%",objectFit:"cover"}}),a.jsxs("div",{style:{padding:`${6*u}px`,display:"flex",flexDirection:"column",alignItems:"center"},children:[a.jsx("h3",{style:{fontSize:`${w}rem`,color:"#e94560",margin:0},children:""}),a.jsx("p",{style:{color:"#aaa",margin:`${3*u}px 0`,fontSize:`${h}rem`,fontFamily:"Tamanegi, sans-serif"},children:" / "}),a.jsxs("p",{style:{padding:`0 ${.5*u}rem`,textAlign:"center",fontSize:`${D}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",lineHeight:1.3},children:["",a.jsx("br",{}),""]}),W("SENKA")]})]}),a.jsxs("div",{onClick:()=>t("AJA"),style:{width:j,height:_,border:"1px solid #444",borderRadius:10*u,background:"linear-gradient(180deg, #0f1c2e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s",boxShadow:"0 4px 20px rgba(69, 162, 233, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:Z=>Z.currentTarget.style.transform="scale(1.05)",onMouseOut:Z=>Z.currentTarget.style.transform="scale(1)",children:[a.jsx("img",{src:pL,alt:"Azya",style:{width:"100%",height:"60%",objectFit:"cover",objectPosition:"center top"}}),a.jsxs("div",{style:{padding:`${6*u}px`,display:"flex",flexDirection:"column",alignItems:"center"},children:[a.jsx("h3",{style:{fontSize:`${w}rem`,color:"#45a2e9",margin:0},children:""}),a.jsx("p",{style:{color:"#aaa",margin:`${3*u}px 0`,fontSize:`${h}rem`,fontFamily:"Tamanegi, sans-serif"},children:" / "}),a.jsxs("p",{style:{padding:`${.5*u}rem`,textAlign:"center",fontSize:`${D}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",lineHeight:1.3},children:["",a.jsx("br",{}),""]}),W("AJA")]})]}),a.jsxs("div",{onClick:()=>t("YORUKA"),style:{width:j,height:_,border:"1px solid #444",borderRadius:10*u,background:"linear-gradient(180deg, #1a0f2e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s",boxShadow:"0 4px 20px rgba(168, 85, 247, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:Z=>Z.currentTarget.style.transform="scale(1.05)",onMouseOut:Z=>Z.currentTarget.style.transform="scale(1)",children:[a.jsx("img",{src:mL,alt:"Yoruka",style:{width:"100%",height:"60%",objectFit:"cover"}}),a.jsxs("div",{style:{padding:`${6*u}px`,display:"flex",flexDirection:"column",alignItems:"center"},children:[a.jsx("h3",{style:{fontSize:`${w}rem`,color:"#a855f7",margin:0},children:"Y"}),a.jsx("p",{style:{color:"#aaa",margin:`${3*u}px 0`,fontSize:`${h}rem`,fontFamily:"Tamanegi, sans-serif"},children:" / "}),a.jsxs("p",{style:{padding:`0 ${.5*u}rem`,textAlign:"center",fontSize:`${D}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",lineHeight:1.3},children:["",a.jsx("br",{}),""]}),W("YORUKA")]})]})]}),n==="CPU"&&s&&a.jsxs("div",{style:{marginBottom:`${.6*u}rem`,display:"flex",flexDirection:"column",alignItems:"center",gap:`${.3*u}rem`},children:[a.jsx("p",{style:{fontSize:`${.85*u}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",margin:0},children:""}),a.jsx("div",{style:{display:"flex",gap:`${.6*u}rem`},children:["EASY","NORMAL","HARD"].map(Z=>a.jsx("button",{onClick:()=>s(Z),style:{padding:`${6*u}px ${14*u}px`,fontSize:`${.8*u}rem`,background:r===Z?Z==="EASY"?"#48bb78":Z==="NORMAL"?"#e94560":"#9f7aea":"transparent",border:`2px solid ${Z==="EASY"?"#48bb78":Z==="NORMAL"?"#e94560":"#9f7aea"}`,color:"#fff",cursor:"pointer",borderRadius:4*u,fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s"},children:Z==="EASY"?"":Z==="NORMAL"?"":""},Z))}),a.jsxs("p",{style:{fontSize:`${.65*u}rem`,opacity:.6,fontFamily:"Tamanegi, sans-serif",margin:0},children:[r==="EASY"&&"CPU",r==="NORMAL"&&"CPU",r==="HARD"&&"CPU"]})]}),c&&a.jsxs("div",{style:{marginBottom:`${.6*u}rem`,display:"flex",flexDirection:"column",alignItems:"center",gap:`${.3*u}rem`},children:[a.jsx("p",{style:{fontSize:`${.85*u}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",margin:0},children:""}),a.jsxs("div",{style:{display:"flex",gap:`${.6*u}rem`},children:[a.jsx("button",{onClick:()=>c(!0),style:{padding:`${6*u}px ${14*u}px`,fontSize:`${.8*u}rem`,background:l?"#3182ce":"transparent",border:"2px solid #3182ce",color:"#fff",cursor:"pointer",borderRadius:4*u,fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s"},children:"ON (60)"}),a.jsx("button",{onClick:()=>c(!1),style:{padding:`${6*u}px ${14*u}px`,fontSize:`${.8*u}rem`,background:l?"transparent":"#718096",border:"2px solid #718096",color:"#fff",cursor:"pointer",borderRadius:4*u,fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s"},children:"OFF"})]}),a.jsx("p",{style:{fontSize:`${.65*u}rem`,opacity:.6,fontFamily:"Tamanegi, sans-serif",margin:0},children:l?"600":""})]}),a.jsx("button",{onClick:e,style:{background:"#333",padding:re,fontSize:`${.9*u}rem`,marginBottom:`${.5*u}rem`},children:""})]})};class bL{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(e){this.flush(),this._parts.push(e)}append(e){this._pieces.push(e)}flush(){if(this._pieces.length>0){const e=new Uint8Array(this._pieces);this._parts.push(e),this._pieces=[]}}toArrayBuffer(){const e=[];for(const n of this._parts)e.push(n);return EL(e).buffer}}function EL(t){let e=0;for(const s of t)e+=s.byteLength;const n=new Uint8Array(e);let r=0;for(const s of t){const i=new Uint8Array(s.buffer,s.byteOffset,s.byteLength);n.set(i,r),r+=s.byteLength}return n}function bS(t){return new SL(t).unpack()}function ES(t){const e=new wL,n=e.pack(t);return n instanceof Promise?n.then(()=>e.getBuffer()):e.getBuffer()}class SL{constructor(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){const e=this.unpack_uint8();if(e<128)return e;if((e^224)<32)return(e^224)-32;let n;if((n=e^160)<=15)return this.unpack_raw(n);if((n=e^176)<=15)return this.unpack_string(n);if((n=e^144)<=15)return this.unpack_array(n);if((n=e^128)<=15)return this.unpack_map(n);switch(e){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return n=this.unpack_uint16(),this.unpack_string(n);case 217:return n=this.unpack_uint32(),this.unpack_string(n);case 218:return n=this.unpack_uint16(),this.unpack_raw(n);case 219:return n=this.unpack_uint32(),this.unpack_raw(n);case 220:return n=this.unpack_uint16(),this.unpack_array(n);case 221:return n=this.unpack_uint32(),this.unpack_array(n);case 222:return n=this.unpack_uint16(),this.unpack_map(n);case 223:return n=this.unpack_uint32(),this.unpack_map(n)}}unpack_uint8(){const e=this.dataView[this.index]&255;return this.index++,e}unpack_uint16(){const e=this.read(2),n=(e[0]&255)*256+(e[1]&255);return this.index+=2,n}unpack_uint32(){const e=this.read(4),n=((e[0]*256+e[1])*256+e[2])*256+e[3];return this.index+=4,n}unpack_uint64(){const e=this.read(8),n=((((((e[0]*256+e[1])*256+e[2])*256+e[3])*256+e[4])*256+e[5])*256+e[6])*256+e[7];return this.index+=8,n}unpack_int8(){const e=this.unpack_uint8();return e<128?e:e-256}unpack_int16(){const e=this.unpack_uint16();return e<32768?e:e-65536}unpack_int32(){const e=this.unpack_uint32();return e<2**31?e:e-2**32}unpack_int64(){const e=this.unpack_uint64();return e<2**63?e:e-2**64}unpack_raw(e){if(this.length<this.index+e)throw new Error(`BinaryPackFailure: index is out of range ${this.index} ${e} ${this.length}`);const n=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,n}unpack_string(e){const n=this.read(e);let r=0,s="",i,o;for(;r<e;)i=n[r],i<160?(o=i,r++):(i^192)<32?(o=(i&31)<<6|n[r+1]&63,r+=2):(i^224)<16?(o=(i&15)<<12|(n[r+1]&63)<<6|n[r+2]&63,r+=3):(o=(i&7)<<18|(n[r+1]&63)<<12|(n[r+2]&63)<<6|n[r+3]&63,r+=4),s+=String.fromCodePoint(o);return this.index+=e,s}unpack_array(e){const n=new Array(e);for(let r=0;r<e;r++)n[r]=this.unpack();return n}unpack_map(e){const n={};for(let r=0;r<e;r++){const s=this.unpack();n[s]=this.unpack()}return n}unpack_float(){const e=this.unpack_uint32(),n=e>>31,r=(e>>23&255)-127,s=e&8388607|8388608;return(n===0?1:-1)*s*2**(r-23)}unpack_double(){const e=this.unpack_uint32(),n=this.unpack_uint32(),r=e>>31,s=(e>>20&2047)-1023,o=(e&1048575|1048576)*2**(s-20)+n*2**(s-52);return(r===0?1:-1)*o}read(e){const n=this.index;if(n+e<=this.length)return this.dataView.subarray(n,n+e);throw new Error("BinaryPackFailure: read index out of range")}}class wL{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(e){if(typeof e=="string")this.pack_string(e);else if(typeof e=="number")Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if(typeof e=="boolean")e===!0?this._bufferBuilder.append(195):e===!1&&this._bufferBuilder.append(194);else if(e===void 0)this._bufferBuilder.append(192);else if(typeof e=="object")if(e===null)this._bufferBuilder.append(192);else{const n=e.constructor;if(e instanceof Array){const r=this.pack_array(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else if(e instanceof ArrayBuffer)this.pack_bin(new Uint8Array(e));else if("BYTES_PER_ELEMENT"in e){const r=e;this.pack_bin(new Uint8Array(r.buffer,r.byteOffset,r.byteLength))}else if(e instanceof Date)this.pack_string(e.toString());else{if(e instanceof Blob)return e.arrayBuffer().then(r=>{this.pack_bin(new Uint8Array(r)),this._bufferBuilder.flush()});if(n==Object||n.toString().startsWith("class")){const r=this.pack_object(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else throw new Error(`Type "${n.toString()}" not yet supported`)}}else throw new Error(`Type "${typeof e}" not yet supported`);this._bufferBuilder.flush()}pack_bin(e){const n=e.length;if(n<=15)this.pack_uint8(160+n);else if(n<=65535)this._bufferBuilder.append(218),this.pack_uint16(n);else if(n<=4294967295)this._bufferBuilder.append(219),this.pack_uint32(n);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(e)}pack_string(e){const n=this._textEncoder.encode(e),r=n.length;if(r<=15)this.pack_uint8(176+r);else if(r<=65535)this._bufferBuilder.append(216),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(217),this.pack_uint32(r);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(n)}pack_array(e){const n=e.length;if(n<=15)this.pack_uint8(144+n);else if(n<=65535)this._bufferBuilder.append(220),this.pack_uint16(n);else if(n<=4294967295)this._bufferBuilder.append(221),this.pack_uint32(n);else throw new Error("Invalid length");const r=s=>{if(s<n){const i=this.pack(e[s]);return i instanceof Promise?i.then(()=>r(s+1)):r(s+1)}};return r(0)}pack_integer(e){if(e>=-32&&e<=127)this._bufferBuilder.append(e&255);else if(e>=0&&e<=255)this._bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&e<=127)this._bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&e<=65535)this._bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&e<=32767)this._bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&e<=4294967295)this._bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-2147483648&&e<=2147483647)this._bufferBuilder.append(210),this.pack_int32(e);else if(e>=-9223372036854776e3&&e<=9223372036854776e3)this._bufferBuilder.append(211),this.pack_int64(e);else if(e>=0&&e<=18446744073709552e3)this._bufferBuilder.append(207),this.pack_uint64(e);else throw new Error("Invalid integer")}pack_double(e){let n=0;e<0&&(n=1,e=-e);const r=Math.floor(Math.log(e)/Math.LN2),s=e/2**r-1,i=Math.floor(s*2**52),o=2**32,l=n<<31|r+1023<<20|i/o&1048575,c=i%o;this._bufferBuilder.append(203),this.pack_int32(l),this.pack_int32(c)}pack_object(e){const n=Object.keys(e),r=n.length;if(r<=15)this.pack_uint8(128+r);else if(r<=65535)this._bufferBuilder.append(222),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(223),this.pack_uint32(r);else throw new Error("Invalid length");const s=i=>{if(i<n.length){const o=n[i];if(e.hasOwnProperty(o)){this.pack(o);const l=this.pack(e[o]);if(l instanceof Promise)return l.then(()=>s(i+1))}return s(i+1)}};return s(0)}pack_uint8(e){this._bufferBuilder.append(e)}pack_uint16(e){this._bufferBuilder.append(e>>8),this._bufferBuilder.append(e&255)}pack_uint32(e){const n=e&4294967295;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255)}pack_uint64(e){const n=e/4294967296,r=e%2**32;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}pack_int8(e){this._bufferBuilder.append(e&255)}pack_int16(e){this._bufferBuilder.append((e&65280)>>8),this._bufferBuilder.append(e&255)}pack_int32(e){this._bufferBuilder.append(e>>>24&255),this._bufferBuilder.append((e&16711680)>>>16),this._bufferBuilder.append((e&65280)>>>8),this._bufferBuilder.append(e&255)}pack_int64(e){const n=Math.floor(e/4294967296),r=e%2**32;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}constructor(){this._bufferBuilder=new bL,this._textEncoder=new TextEncoder}}let SS=!0,wS=!0;function Ya(t,e,n){const r=t.match(e);return r&&r.length>=n&&parseFloat(r[n],10)}function Qi(t,e,n){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,s=r.addEventListener;r.addEventListener=function(o,l){if(o!==e)return s.apply(this,arguments);const c=d=>{const u=n(d);u&&(l.handleEvent?l.handleEvent(u):l(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(l,c),s.apply(this,[o,c])};const i=r.removeEventListener;r.removeEventListener=function(o,l){if(o!==e||!this._eventMap||!this._eventMap[e])return i.apply(this,arguments);if(!this._eventMap[e].has(l))return i.apply(this,arguments);const c=this._eventMap[e].get(l);return this._eventMap[e].delete(l),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,i.apply(this,[o,c])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function IL(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(SS=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function TL(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(wS=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function IS(){if(typeof window=="object"){if(SS)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function om(t,e){wS&&console.warn(t+" is deprecated, please use "+e+" instead.")}function CL(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const r=n.userAgentData.brands.find(s=>s.brand==="Chromium");if(r)return{browser:"chrome",version:parseInt(r.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(Ya(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(Ya(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(Ya(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=Ya(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function Cx(t){return Object.prototype.toString.call(t)==="[object Object]"}function TS(t){return Cx(t)?Object.keys(t).reduce(function(e,n){const r=Cx(t[n]),s=r?TS(t[n]):t[n],i=r&&!Object.keys(s).length;return s===void 0||i?e:Object.assign(e,{[n]:s})},{}):t}function Zp(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?Zp(t,t.get(e[r]),n):r.endsWith("Ids")&&e[r].forEach(s=>{Zp(t,t.get(s),n)})}))}function kx(t,e,n){const r=n?"outbound-rtp":"inbound-rtp",s=new Map;if(e===null)return s;const i=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&i.push(o)}),i.forEach(o=>{t.forEach(l=>{l.type===r&&l.trackId===o.id&&Zp(t,l,s)})}),s}const Rx=IS;function CS(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const r=function(l){if(typeof l!="object"||l.mandatory||l.optional)return l;const c={};return Object.keys(l).forEach(d=>{if(d==="require"||d==="advanced"||d==="mediaSource")return;const u=typeof l[d]=="object"?l[d]:{ideal:l[d]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const p=function(f,S){return f?f+S.charAt(0).toUpperCase()+S.slice(1):S==="deviceId"?"sourceId":S};if(u.ideal!==void 0){c.optional=c.optional||[];let f={};typeof u.ideal=="number"?(f[p("min",d)]=u.ideal,c.optional.push(f),f={},f[p("max",d)]=u.ideal,c.optional.push(f)):(f[p("",d)]=u.ideal,c.optional.push(f))}u.exact!==void 0&&typeof u.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[p("",d)]=u.exact):["min","max"].forEach(f=>{u[f]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[p(f,d)]=u[f])})}),l.advanced&&(c.optional=(c.optional||[]).concat(l.advanced)),c},s=function(l,c){if(e.version>=61)return c(l);if(l=JSON.parse(JSON.stringify(l)),l&&typeof l.audio=="object"){const d=function(u,p,f){p in u&&!(f in u)&&(u[f]=u[p],delete u[p])};l=JSON.parse(JSON.stringify(l)),d(l.audio,"autoGainControl","googAutoGainControl"),d(l.audio,"noiseSuppression","googNoiseSuppression"),l.audio=r(l.audio)}if(l&&typeof l.video=="object"){let d=l.video.facingMode;d=d&&(typeof d=="object"?d:{ideal:d});const u=e.version<66;if(d&&(d.exact==="user"||d.exact==="environment"||d.ideal==="user"||d.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete l.video.facingMode;let p;if(d.exact==="environment"||d.ideal==="environment"?p=["back","rear"]:(d.exact==="user"||d.ideal==="user")&&(p=["front"]),p)return n.mediaDevices.enumerateDevices().then(f=>{f=f.filter(R=>R.kind==="videoinput");let S=f.find(R=>p.some(C=>R.label.toLowerCase().includes(C)));return!S&&f.length&&p.includes("back")&&(S=f[f.length-1]),S&&(l.video.deviceId=d.exact?{exact:S.deviceId}:{ideal:S.deviceId}),l.video=r(l.video),Rx("chrome: "+JSON.stringify(l)),c(l)})}l.video=r(l.video)}return Rx("chrome: "+JSON.stringify(l)),c(l)},i=function(l){return e.version>=64?l:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[l.name]||l.name,message:l.message,constraint:l.constraint||l.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(l,c,d){s(l,u=>{n.webkitGetUserMedia(u,c,p=>{d&&d(i(p))})})};if(n.getUserMedia=o.bind(n),n.mediaDevices.getUserMedia){const l=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return s(c,d=>l(d).then(u=>{if(d.audio&&!u.getAudioTracks().length||d.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(p=>{p.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(i(u))))}}}function kS(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function RS(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",s=>{let i;t.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(l=>l.track&&l.track.id===s.track.id):i={track:s.track};const o=new Event("track");o.track=s.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[r.stream],this.dispatchEvent(o)}),r.stream.getTracks().forEach(s=>{let i;t.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(l=>l.track&&l.track.id===s.id):i={track:s};const o=new Event("track");o.track=s,o.receiver=i,o.transceiver={receiver:i},o.streams=[r.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Qi(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function AS(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(s,i){return{track:i,get dtmf(){return this._dtmf===void 0&&(i.kind==="audio"?this._dtmf=s.createDTMFSender(i):this._dtmf=null),this._dtmf},_pc:s}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const s=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(l,c){let d=s.apply(this,arguments);return d||(d=e(this,l),this._senders.push(d)),d};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(l){i.apply(this,arguments);const c=this._senders.indexOf(l);c!==-1&&this._senders.splice(c,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],n.apply(this,[i]),i.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach(o=>{const l=this._senders.find(c=>c.track===o);l&&this._senders.splice(this._senders.indexOf(l),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function PS(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=n.apply(this,[]);return i.forEach(o=>o._pc=this),i});const r=t.RTCPeerConnection.prototype.addTrack;r&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=r.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){const i=this;return this._pc.getStats().then(o=>kx(o,i.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const s=n.apply(this,[]);return s.forEach(i=>i._pc=this),s}),Qi(t,"track",r=>(r.receiver._pc=r.srcElement,r)),t.RTCRtpReceiver.prototype.getStats=function(){const s=this;return this._pc.getStats().then(i=>kx(i,s.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const r=arguments[0];let s,i,o;return this.getSenders().forEach(l=>{l.track===r&&(s?o=!0:s=l)}),this.getReceivers().forEach(l=>(l.track===r&&(i?o=!0:i=l),l.track===r)),o||s&&i?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function OS(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,l){if(!l)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[l.id]?this._shimmedLocalStreams[l.id].indexOf(c)===-1&&this._shimmedLocalStreams[l.id].push(c):this._shimmedLocalStreams[l.id]=[l,c],c};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(d=>{if(this.getSenders().find(p=>p.track===d))throw new DOMException("Track already exists.","InvalidAccessError")});const l=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(d=>l.indexOf(d)===-1);this._shimmedLocalStreams[o.id]=[o].concat(c)};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],r.apply(this,arguments)};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(l=>{const c=this._shimmedLocalStreams[l].indexOf(o);c!==-1&&this._shimmedLocalStreams[l].splice(c,1),this._shimmedLocalStreams[l].length===1&&delete this._shimmedLocalStreams[l]}),s.apply(this,arguments)}}function LS(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return OS(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const u=n.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(p=>this._reverseStreams[p.id])};const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(p=>{if(this.getSenders().find(S=>S.track===p))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const p=new t.MediaStream(u.getTracks());this._streams[u.id]=p,this._reverseStreams[p.id]=u,u=p}r.apply(this,[u])};const s=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},t.RTCPeerConnection.prototype.addTrack=function(u,p){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const f=[].slice.call(arguments,1);if(f.length!==1||!f[0].getTracks().find(C=>C===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(C=>C.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const R=this._streams[p.id];if(R)R.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const C=new t.MediaStream([u]);this._streams[p.id]=C,this._reverseStreams[C.id]=p,this.addStream(C)}return this.getSenders().find(C=>C.track===u)};function i(d,u){let p=u.sdp;return Object.keys(d._reverseStreams||[]).forEach(f=>{const S=d._reverseStreams[f],R=d._streams[S.id];p=p.replace(new RegExp(R.id,"g"),S.id)}),new RTCSessionDescription({type:u.type,sdp:p})}function o(d,u){let p=u.sdp;return Object.keys(d._reverseStreams||[]).forEach(f=>{const S=d._reverseStreams[f],R=d._streams[S.id];p=p.replace(new RegExp(S.id,"g"),R.id)}),new RTCSessionDescription({type:u.type,sdp:p})}["createOffer","createAnswer"].forEach(function(d){const u=t.RTCPeerConnection.prototype[d],p={[d](){const f=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[R=>{const C=i(this,R);f[0].apply(null,[C])},R=>{f[1]&&f[1].apply(null,R)},arguments[2]]):u.apply(this,arguments).then(R=>i(this,R))}};t.RTCPeerConnection.prototype[d]=p[d]});const l=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?l.apply(this,arguments):(arguments[0]=o(this,arguments[0]),l.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const d=c.get.apply(this);return d.type===""?d:i(this,d)}}),t.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let f;Object.keys(this._streams).forEach(S=>{this._streams[S].getTracks().find(C=>u.track===C)&&(f=this._streams[S])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function eg(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=t.RTCPeerConnection.prototype[n],s={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=s[n]})}function DS(t,e){Qi(t,"negotiationneeded",n=>{const r=n.target;if(!((e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return n})}const Ax=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:DS,shimAddTrackRemoveTrack:LS,shimAddTrackRemoveTrackWithNative:OS,shimGetSendersWithDtmf:AS,shimGetUserMedia:CS,shimMediaStream:kS,shimOnTrack:RS,shimPeerConnection:eg,shimSenderReceiverGetStats:PS},Symbol.toStringTag,{value:"Module"}));function MS(t,e){const n=t&&t.navigator,r=t&&t.MediaStreamTrack;if(n.getUserMedia=function(s,i,o){om("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(s).then(i,o)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const s=function(o,l,c){l in o&&!(c in o)&&(o[c]=o[l],delete o[l])},i=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),s(o.audio,"autoGainControl","mozAutoGainControl"),s(o.audio,"noiseSuppression","mozNoiseSuppression")),i(o)},r&&r.prototype.getSettings){const o=r.prototype.getSettings;r.prototype.getSettings=function(){const l=o.apply(this,arguments);return s(l,"mozAutoGainControl","autoGainControl"),s(l,"mozNoiseSuppression","noiseSuppression"),l}}if(r&&r.prototype.applyConstraints){const o=r.prototype.applyConstraints;r.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),s(l,"autoGainControl","mozAutoGainControl"),s(l,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[l])}}}}function kL(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,Promise.reject(s)}return r.video===!0?r.video={mediaSource:e}:r.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(r)})}function NS(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function tg(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const i=t.RTCPeerConnection.prototype[s],o={[s](){return arguments[0]=new(s==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[s]=o[s]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[i,o,l]=arguments;return r.apply(this,[i||null]).then(c=>{if(e.version<53&&!o)try{c.forEach(d=>{d.type=n[d.type]||d.type})}catch(d){if(d.name!=="TypeError")throw d;c.forEach((u,p)=>{c.set(p,Object.assign({},u,{type:n[u.type]||u.type}))})}return c}).then(o,l)}}function jS(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=e.apply(this,[]);return s.forEach(i=>i._pc=this),s});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=n.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function $S(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r}),Qi(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function FS(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){om("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&n.getTracks().includes(r.track)&&this.removeTrack(r)})})}function US(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function BS(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const s=r.length>0;s&&r.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=e.apply(this,arguments);if(s){const{sender:o}=i,l=o.getParameters();(!("encodings"in l)||l.encodings.length===1&&Object.keys(l.encodings[0]).length===0)&&(l.encodings=r,o.sendEncodings=r,this.setParametersPromises.push(o.setParameters(l).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return i})}function zS(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const r=e.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function HS(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function WS(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}const Px=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:BS,shimCreateAnswer:WS,shimCreateOffer:HS,shimGetDisplayMedia:kL,shimGetParameters:zS,shimGetUserMedia:MS,shimOnTrack:NS,shimPeerConnection:tg,shimRTCDataChannel:US,shimReceiverGetStats:$S,shimRemoveStream:FS,shimSenderGetStats:jS},Symbol.toStringTag,{value:"Module"}));function GS(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(s=>e.call(this,s,r)),r.getVideoTracks().forEach(s=>e.call(this,s,r))},t.RTCPeerConnection.prototype.addTrack=function(r,...s){return s&&s.forEach(i=>{this._localStreams?this._localStreams.includes(i)||this._localStreams.push(i):this._localStreams=[i]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(n);if(r===-1)return;this._localStreams.splice(r,1);const s=n.getTracks();this.getSenders().forEach(i=>{s.includes(i.track)&&this.removeTrack(i)})})}}function VS(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(s=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(s))return;this._remoteStreams.push(s);const i=new Event("addstream");i.stream=s,this.dispatchEvent(i)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){s.streams.forEach(i=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(i)>=0)return;r._remoteStreams.push(i);const o=new Event("addstream");o.stream=i,r.dispatchEvent(o)})}),e.apply(r,arguments)}}}function YS(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,r=e.createAnswer,s=e.setLocalDescription,i=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(d,u){const p=arguments.length>=2?arguments[2]:arguments[0],f=n.apply(this,[p]);return u?(f.then(d,u),Promise.resolve()):f},e.createAnswer=function(d,u){const p=arguments.length>=2?arguments[2]:arguments[0],f=r.apply(this,[p]);return u?(f.then(d,u),Promise.resolve()):f};let l=function(c,d,u){const p=s.apply(this,[c]);return u?(p.then(d,u),Promise.resolve()):p};e.setLocalDescription=l,l=function(c,d,u){const p=i.apply(this,[c]);return u?(p.then(d,u),Promise.resolve()):p},e.setRemoteDescription=l,l=function(c,d,u){const p=o.apply(this,[c]);return u?(p.then(d,u),Promise.resolve()):p},e.addIceCandidate=l}function KS(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,r=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=s=>r(XS(s))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(r,s,i){e.mediaDevices.getUserMedia(r).then(s,i)}).bind(e))}function XS(t){return t&&t.video!==void 0?Object.assign({},t,{video:TS(t.video)}):t}function JS(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(r,s){if(r&&r.iceServers){const i=[];for(let o=0;o<r.iceServers.length;o++){let l=r.iceServers[o];l.urls===void 0&&l.url?(om("RTCIceServer.url","RTCIceServer.urls"),l=JSON.parse(JSON.stringify(l)),l.urls=l.url,delete l.url,i.push(l)):i.push(r.iceServers[o])}r.iceServers=i}return new e(r,s)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function QS(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function qS(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):r.offerToReceiveAudio===!0&&!s&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const i=this.getTransceivers().find(o=>o.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveVideo===!0&&!i&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function ZS(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}const Ox=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:ZS,shimCallbacksAPI:YS,shimConstraints:XS,shimCreateOfferLegacy:qS,shimGetUserMedia:KS,shimLocalStreamsAPI:GS,shimRTCIceServerUrls:JS,shimRemoteStreamsAPI:VS,shimTrackEventTransceiver:QS},Symbol.toStringTag,{value:"Module"}));var e2={exports:{}};(function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},e.splitSections=function(n){return n.split(`
m=`).map((s,i)=>(i>0?"m="+s:s).trim()+`\r
`)},e.getDescription=function(n){const r=e.splitSections(n);return r&&r[0]},e.getMediaSections=function(n){const r=e.splitSections(n);return r.shift(),r},e.matchPrefix=function(n,r){return e.splitLines(n).filter(s=>s.indexOf(r)===0)},e.parseCandidate=function(n){let r;n.indexOf("a=candidate:")===0?r=n.substring(12).split(" "):r=n.substring(10).split(" ");const s={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let i=8;i<r.length;i+=2)switch(r[i]){case"raddr":s.relatedAddress=r[i+1];break;case"rport":s.relatedPort=parseInt(r[i+1],10);break;case"tcptype":s.tcpType=r[i+1];break;case"ufrag":s.ufrag=r[i+1],s.usernameFragment=r[i+1];break;default:s[r[i]]===void 0&&(s[r[i]]=r[i+1]);break}return s},e.writeCandidate=function(n){const r=[];r.push(n.foundation);const s=n.component;s==="rtp"?r.push(1):s==="rtcp"?r.push(2):r.push(s),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const i=n.type;return r.push("typ"),r.push(i),i!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let r=n.substring(9).split(" ");const s={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),s.name=r[0],s.clockRate=parseInt(r[1],10),s.channels=r.length===3?parseInt(r[2],10):1,s.numChannels=s.channels,s},e.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const s=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(s!==1?"/"+s:"")+`\r
`},e.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const r={};let s;const i=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<i.length;o++)s=i[o].trim().split("="),r[s[0].trim()]=s[1];return r},e.writeFmtp=function(n){let r="",s=n.payloadType;if(n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const i=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?i.push(o+"="+n.parameters[o]):i.push(o)}),r+="a=fmtp:"+s+" "+i.join(";")+`\r
`}return r},e.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},e.writeRtcpFb=function(n){let r="",s=n.payloadType;return n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(i=>{r+="a=rtcp-fb:"+s+" "+i.type+(i.parameter&&i.parameter.length?" "+i.parameter:"")+`\r
`}),r},e.parseSsrcMedia=function(n){const r=n.indexOf(" "),s={ssrc:parseInt(n.substring(7,r),10)},i=n.indexOf(":",r);return i>-1?(s.attribute=n.substring(r+1,i),s.value=n.substring(i+1)):s.attribute=n.substring(r+1),s},e.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(s=>parseInt(s,10))}},e.getMid=function(n){const r=e.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},e.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:e.matchPrefix(n+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,r){let s="a=setup:"+r+`\r
`;return n.fingerprints.forEach(i=>{s+="a=fingerprint:"+i.algorithm+" "+i.value+`\r
`}),s},e.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,r){return e.matchPrefix(n+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,r){const s=e.matchPrefix(n+r,"a=ice-ufrag:")[0],i=e.matchPrefix(n+r,"a=ice-pwd:")[0];return s&&i?{usernameFragment:s.substring(12),password:i.substring(10)}:null},e.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},e.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=e.splitLines(n)[0].split(" ");r.profile=i[2];for(let l=3;l<i.length;l++){const c=i[l],d=e.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(d){const u=e.parseRtpMap(d),p=e.matchPrefix(n,"a=fmtp:"+c+" ");switch(u.parameters=p.length?e.parseFmtp(p[0]):{},u.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),r.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(l=>{r.headerExtensions.push(e.parseExtmap(l))});const o=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(l=>{o.forEach(c=>{l.rtcpFeedback.find(u=>u.type===c.type&&u.parameter===c.parameter)||l.rtcpFeedback.push(c)})}),r},e.writeRtpDescription=function(n,r){let s="";s+="m="+n+" ",s+=r.codecs.length>0?"9":"0",s+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",s+=r.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,s+=`c=IN IP4 0.0.0.0\r
`,s+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(o=>{s+=e.writeRtpMap(o),s+=e.writeFmtp(o),s+=e.writeRtcpFb(o)});let i=0;return r.codecs.forEach(o=>{o.maxptime>i&&(i=o.maxptime)}),i>0&&(s+="a=maxptime:"+i+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(o=>{s+=e.writeExtmap(o)}),s},e.parseRtpEncodingParameters=function(n){const r=[],s=e.parseRtpParameters(n),i=s.fecMechanisms.indexOf("RED")!==-1,o=s.fecMechanisms.indexOf("ULPFEC")!==-1,l=e.matchPrefix(n,"a=ssrc:").map(f=>e.parseSsrcMedia(f)).filter(f=>f.attribute==="cname"),c=l.length>0&&l[0].ssrc;let d;const u=e.matchPrefix(n,"a=ssrc-group:FID").map(f=>f.substring(17).split(" ").map(R=>parseInt(R,10)));u.length>0&&u[0].length>1&&u[0][0]===c&&(d=u[0][1]),s.codecs.forEach(f=>{if(f.name.toUpperCase()==="RTX"&&f.parameters.apt){let S={ssrc:c,codecPayloadType:parseInt(f.parameters.apt,10)};c&&d&&(S.rtx={ssrc:d}),r.push(S),i&&(S=JSON.parse(JSON.stringify(S)),S.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},r.push(S))}}),r.length===0&&c&&r.push({ssrc:c});let p=e.matchPrefix(n,"b=");return p.length&&(p[0].indexOf("b=TIAS:")===0?p=parseInt(p[0].substring(7),10):p[0].indexOf("b=AS:")===0?p=parseInt(p[0].substring(5),10)*1e3*.95-50*40*8:p=void 0,r.forEach(f=>{f.maxBitrate=p})),r},e.parseRtcpParameters=function(n){const r={},s=e.matchPrefix(n,"a=ssrc:").map(l=>e.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];s&&(r.cname=s.value,r.ssrc=s.ssrc);const i=e.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=i.length>0,r.compound=i.length===0;const o=e.matchPrefix(n,"a=rtcp-mux");return r.mux=o.length>0,r},e.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},e.parseMsid=function(n){let r;const s=e.matchPrefix(n,"a=msid:");if(s.length===1)return r=s[0].substring(7).split(" "),{stream:r[0],track:r[1]};const i=e.matchPrefix(n,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(i.length>0)return r=i[0].value.split(" "),{stream:r[0],track:r[1]}},e.parseSctpDescription=function(n){const r=e.parseMLine(n),s=e.matchPrefix(n,"a=max-message-size:");let i;s.length>0&&(i=parseInt(s[0].substring(19),10)),isNaN(i)&&(i=65536);const o=e.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:r.fmt,maxMessageSize:i};const l=e.matchPrefix(n,"a=sctpmap:");if(l.length>0){const c=l[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:i}}},e.writeSctpDescription=function(n,r){let s=[];return n.protocol!=="DTLS/SCTP"?s=["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:s=["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&s.push("a=max-message-size:"+r.maxMessageSize+`\r
`),s.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,r,s){let i;const o=r!==void 0?r:2;return n?i=n:i=e.generateSessionId(),`v=0\r
o=`+(s||"thisisadapterortc")+" "+i+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,r){const s=e.splitLines(n);for(let i=0;i<s.length;i++)switch(s[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[i].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const s=e.splitLines(n)[0].substring(2).split(" ");return{kind:s[0],port:parseInt(s[1],10),protocol:s[2],fmt:s.slice(3).join(" ")}},e.parseOLine=function(n){const s=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:s[0],sessionId:s[1],sessionVersion:parseInt(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=e.splitLines(n);for(let s=0;s<r.length;s++)if(r[s].length<2||r[s].charAt(1)!=="=")return!1;return!0},t.exports=e})(e2);var t2=e2.exports;const Uo=Jx(t2),RL=F2({__proto__:null,default:Uo},[t2]);function Cd(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const s=new e(r),i=Uo.parseCandidate(r.candidate);for(const o in i)o in s||Object.defineProperty(s,o,{value:i[o]});return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new e(r)},t.RTCIceCandidate.prototype=e.prototype,Qi(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function ng(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Qi(t,"icecandidate",e=>{if(e.candidate){const n=Uo.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function kd(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(l){if(!l||!l.sdp)return!1;const c=Uo.splitSections(l.sdp);return c.shift(),c.some(d=>{const u=Uo.parseMLine(d);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},r=function(l){const c=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const d=parseInt(c[1],10);return d!==d?-1:d},s=function(l){let c=65536;return e.browser==="firefox"&&(e.version<57?l===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},i=function(l,c){let d=65536;e.browser==="firefox"&&e.version===57&&(d=65535);const u=Uo.matchPrefix(l.sdp,"a=max-message-size:");return u.length>0?d=parseInt(u[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(d=2147483637),d},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=r(arguments[0]),d=s(c),u=i(arguments[0],c);let p;d===0&&u===0?p=Number.POSITIVE_INFINITY:d===0||u===0?p=Math.max(d,u):p=Math.min(d,u);const f={};Object.defineProperty(f,"maxMessageSize",{get(){return p}}),this._sctp=f}return o.apply(this,arguments)}}function Rd(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(r,s){const i=r.send;r.send=function(){const l=arguments[0],c=l.length||l.size||l.byteLength;if(r.readyState==="open"&&s.sctp&&c>s.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+s.sctp.maxMessageSize+" bytes)");return i.apply(r,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const s=n.apply(this,arguments);return e(s,this),s},Qi(t,"datachannel",r=>(e(r.channel,r.target),r))}function rg(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=s=>{const i=s.target;if(i._lastConnectionState!==i.connectionState){i._lastConnectionState=i.connectionState;const o=new Event("connectionstatechange",s);i.dispatchEvent(o)}return s},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function sg(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(s){if(s&&s.sdp&&s.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i=s.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&s instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:s.type,sdp:i}):s.sdp=i}return n.apply(this,arguments)}}function Ad(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Pd(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let s=arguments[0]||{};if(typeof s!="object"||s.type&&s.sdp)return n.apply(this,arguments);if(s={type:s.type,sdp:s.sdp},!s.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":s.type="offer";break;default:s.type="answer";break}return s.sdp||s.type!=="offer"&&s.type!=="answer"?n.apply(this,[s]):(s.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}const AL=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:sg,shimAddIceCandidateNullOrEmpty:Ad,shimConnectionState:rg,shimMaxMessageSize:kd,shimParameterlessSetLocalDescription:Pd,shimRTCIceCandidate:Cd,shimRTCIceCandidateRelayProtocol:ng,shimSendThrowTypeError:Rd},Symbol.toStringTag,{value:"Module"}));function PL({window:t}={},e={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const n=IS,r=CL(t),s={browserDetails:r,commonShim:AL,extractVersion:Ya,disableLog:IL,disableWarnings:TL,sdp:RL};switch(r.browser){case"chrome":if(!Ax||!eg||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),s;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),s;n("adapter.js shimming chrome."),s.browserShim=Ax,Ad(t,r),Pd(t),CS(t,r),kS(t),eg(t,r),RS(t),LS(t,r),AS(t),PS(t),DS(t,r),Cd(t),ng(t),rg(t),kd(t,r),Rd(t),sg(t,r);break;case"firefox":if(!Px||!tg||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),s;n("adapter.js shimming firefox."),s.browserShim=Px,Ad(t,r),Pd(t),MS(t,r),tg(t,r),NS(t),FS(t),jS(t),$S(t),US(t),BS(t),zS(t),HS(t),WS(t),Cd(t),rg(t),kd(t,r),Rd(t);break;case"safari":if(!Ox||!e.shimSafari)return n("Safari shim is not included in this adapter release."),s;n("adapter.js shimming safari."),s.browserShim=Ox,Ad(t,r),Pd(t),JS(t),qS(t),YS(t),GS(t),VS(t),QS(t),KS(t),ZS(t),Cd(t),ng(t),kd(t,r),Rd(t),sg(t,r);break;default:n("Unsupported browser!");break}return s}const Lx=PL({window:typeof window>"u"?void 0:window});function qi(t,e,n,r){Object.defineProperty(t,e,{get:n,set:r,enumerable:!0,configurable:!0})}class n2{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=e=>{const n=[],r=e.byteLength,s=Math.ceil(r/this.chunkedMTU);let i=0,o=0;for(;o<r;){const l=Math.min(r,o+this.chunkedMTU),c=e.slice(o,l),d={__peerData:this._dataCount,n:i,data:c,total:s};n.push(d),o=l,i++}return this._dataCount++,n}}}function OL(t){let e=0;for(const s of t)e+=s.byteLength;const n=new Uint8Array(e);let r=0;for(const s of t)n.set(s,r),r+=s.byteLength;return n}const Mh=Lx.default||Lx,Ua=new class{isWebRTCSupported(){return typeof RTCPeerConnection<"u"}isBrowserSupported(){const t=this.getBrowser(),e=this.getVersion();return this.supportedBrowsers.includes(t)?t==="chrome"?e>=this.minChromeVersion:t==="firefox"?e>=this.minFirefoxVersion:t==="safari"?!this.isIOS&&e>=this.minSafariVersion:!1:!1}getBrowser(){return Mh.browserDetails.browser}getVersion(){return Mh.browserDetails.version||0}isUnifiedPlanSupported(){const t=this.getBrowser(),e=Mh.browserDetails.version||0;if(t==="chrome"&&e<this.minChromeVersion)return!1;if(t==="firefox"&&e>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let n,r=!1;try{n=new RTCPeerConnection,n.addTransceiver("audio"),r=!0}catch{}finally{n&&n.close()}return r}toString(){return`Supports:
    browser:${this.getBrowser()}
    version:${this.getVersion()}
    isIOS:${this.isIOS}
    isWebRTCSupported:${this.isWebRTCSupported()}
    isBrowserSupported:${this.isBrowserSupported()}
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS=typeof navigator<"u"?["iPad","iPhone","iPod"].includes(navigator.platform):!1,this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},LL=t=>!t||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(t),r2=()=>Math.random().toString(36).slice(2),Dx={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};class DL extends n2{noop(){}blobToArrayBuffer(e,n){const r=new FileReader;return r.onload=function(s){s.target&&n(s.target.result)},r.readAsArrayBuffer(e),r}binaryStringToArrayBuffer(e){const n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r)&255;return n.buffer}isSecure(){return location.protocol==="https:"}constructor(...e){super(...e),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=Dx,this.browser=Ua.getBrowser(),this.browserVersion=Ua.getVersion(),this.pack=ES,this.unpack=bS,this.supports=function(){const n={browser:Ua.isBrowserSupported(),webRTC:Ua.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!n.webRTC)return n;let r;try{r=new RTCPeerConnection(Dx),n.audioVideo=!0;let s;try{s=r.createDataChannel("_PEERJSTEST",{ordered:!0}),n.data=!0,n.reliable=!!s.ordered;try{s.binaryType="blob",n.binaryBlob=!Ua.isIOS}catch{}}catch{}finally{s&&s.close()}}catch{}finally{r&&r.close()}return n}(),this.validateId=LL,this.randomToken=r2}}const Nn=new DL,ML="PeerJS: ";class NL{get logLevel(){return this._logLevel}set logLevel(e){this._logLevel=e}log(...e){this._logLevel>=3&&this._print(3,...e)}warn(...e){this._logLevel>=2&&this._print(2,...e)}error(...e){this._logLevel>=1&&this._print(1,...e)}setLogFunction(e){this._print=e}_print(e,...n){const r=[ML,...n];for(const s in r)r[s]instanceof Error&&(r[s]="("+r[s].name+") "+r[s].message);e>=3?console.log(...r):e>=2?console.warn("WARNING",...r):e>=1&&console.error("ERROR",...r)}constructor(){this._logLevel=0}}var ke=new NL,am={},jL=Object.prototype.hasOwnProperty,On="~";function Wl(){}Object.create&&(Wl.prototype=Object.create(null),new Wl().__proto__||(On=!1));function $L(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function s2(t,e,n,r,s){if(typeof n!="function")throw new TypeError("The listener must be a function");var i=new $L(n,r||t,s),o=On?On+e:e;return t._events[o]?t._events[o].fn?t._events[o]=[t._events[o],i]:t._events[o].push(i):(t._events[o]=i,t._eventsCount++),t}function Od(t,e){--t._eventsCount===0?t._events=new Wl:delete t._events[e]}function Sn(){this._events=new Wl,this._eventsCount=0}Sn.prototype.eventNames=function(){var e=[],n,r;if(this._eventsCount===0)return e;for(r in n=this._events)jL.call(n,r)&&e.push(On?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(n)):e};Sn.prototype.listeners=function(e){var n=On?On+e:e,r=this._events[n];if(!r)return[];if(r.fn)return[r.fn];for(var s=0,i=r.length,o=new Array(i);s<i;s++)o[s]=r[s].fn;return o};Sn.prototype.listenerCount=function(e){var n=On?On+e:e,r=this._events[n];return r?r.fn?1:r.length:0};Sn.prototype.emit=function(e,n,r,s,i,o){var l=On?On+e:e;if(!this._events[l])return!1;var c=this._events[l],d=arguments.length,u,p;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,n),!0;case 3:return c.fn.call(c.context,n,r),!0;case 4:return c.fn.call(c.context,n,r,s),!0;case 5:return c.fn.call(c.context,n,r,s,i),!0;case 6:return c.fn.call(c.context,n,r,s,i,o),!0}for(p=1,u=new Array(d-1);p<d;p++)u[p-1]=arguments[p];c.fn.apply(c.context,u)}else{var f=c.length,S;for(p=0;p<f;p++)switch(c[p].once&&this.removeListener(e,c[p].fn,void 0,!0),d){case 1:c[p].fn.call(c[p].context);break;case 2:c[p].fn.call(c[p].context,n);break;case 3:c[p].fn.call(c[p].context,n,r);break;case 4:c[p].fn.call(c[p].context,n,r,s);break;default:if(!u)for(S=1,u=new Array(d-1);S<d;S++)u[S-1]=arguments[S];c[p].fn.apply(c[p].context,u)}}return!0};Sn.prototype.on=function(e,n,r){return s2(this,e,n,r,!1)};Sn.prototype.once=function(e,n,r){return s2(this,e,n,r,!0)};Sn.prototype.removeListener=function(e,n,r,s){var i=On?On+e:e;if(!this._events[i])return this;if(!n)return Od(this,i),this;var o=this._events[i];if(o.fn)o.fn===n&&(!s||o.once)&&(!r||o.context===r)&&Od(this,i);else{for(var l=0,c=[],d=o.length;l<d;l++)(o[l].fn!==n||s&&!o[l].once||r&&o[l].context!==r)&&c.push(o[l]);c.length?this._events[i]=c.length===1?c[0]:c:Od(this,i)}return this};Sn.prototype.removeAllListeners=function(e){var n;return e?(n=On?On+e:e,this._events[n]&&Od(this,n)):(this._events=new Wl,this._eventsCount=0),this};Sn.prototype.off=Sn.prototype.removeListener;Sn.prototype.addListener=Sn.prototype.on;Sn.prefixed=On;Sn.EventEmitter=Sn;am=Sn;var Zi={};qi(Zi,"ConnectionType",()=>ei);qi(Zi,"PeerErrorType",()=>Jt);qi(Zi,"BaseConnectionErrorType",()=>ig);qi(Zi,"DataConnectionErrorType",()=>lm);qi(Zi,"SerializationType",()=>pf);qi(Zi,"SocketEventType",()=>Us);qi(Zi,"ServerMessageType",()=>_n);var ei=function(t){return t.Data="data",t.Media="media",t}({}),Jt=function(t){return t.BrowserIncompatible="browser-incompatible",t.Disconnected="disconnected",t.InvalidID="invalid-id",t.InvalidKey="invalid-key",t.Network="network",t.PeerUnavailable="peer-unavailable",t.SslUnavailable="ssl-unavailable",t.ServerError="server-error",t.SocketError="socket-error",t.SocketClosed="socket-closed",t.UnavailableID="unavailable-id",t.WebRTC="webrtc",t}({}),ig=function(t){return t.NegotiationFailed="negotiation-failed",t.ConnectionClosed="connection-closed",t}({}),lm=function(t){return t.NotOpenYet="not-open-yet",t.MessageToBig="message-too-big",t}({}),pf=function(t){return t.Binary="binary",t.BinaryUTF8="binary-utf8",t.JSON="json",t.None="raw",t}({}),Us=function(t){return t.Message="message",t.Disconnected="disconnected",t.Error="error",t.Close="close",t}({}),_n=function(t){return t.Heartbeat="HEARTBEAT",t.Candidate="CANDIDATE",t.Offer="OFFER",t.Answer="ANSWER",t.Open="OPEN",t.Error="ERROR",t.IdTaken="ID-TAKEN",t.InvalidKey="INVALID-KEY",t.Leave="LEAVE",t.Expire="EXPIRE",t}({});const i2="1.5.5";class FL extends am.EventEmitter{constructor(e,n,r,s,i,o=5e3){super(),this.pingInterval=o,this._disconnected=!0,this._messagesQueue=[];const l=e?"wss://":"ws://";this._baseUrl=l+n+":"+r+s+"peerjs?key="+i}start(e,n){this._id=e;const r=`${this._baseUrl}&id=${e}&token=${n}`;this._socket||!this._disconnected||(this._socket=new WebSocket(r+"&version="+i2),this._disconnected=!1,this._socket.onmessage=s=>{let i;try{i=JSON.parse(s.data),ke.log("Server message received:",i)}catch{ke.log("Invalid server message",s.data);return}this.emit(Us.Message,i)},this._socket.onclose=s=>{this._disconnected||(ke.log("Socket closed.",s),this._cleanup(),this._disconnected=!0,this.emit(Us.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),ke.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen()){ke.log("Cannot send heartbeat, because socket closed");return}const e=JSON.stringify({type:_n.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&this._socket.readyState===1}_sendQueuedMessages(){const e=[...this._messagesQueue];this._messagesQueue=[];for(const n of e)this.send(n)}send(e){if(this._disconnected)return;if(!this._id){this._messagesQueue.push(e);return}if(!e.type){this.emit(Us.Error,"Invalid message");return}if(!this._wsOpen())return;const n=JSON.stringify(e);this._socket.send(n)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}class o2{constructor(e){this.connection=e}startConnection(e){const n=this._startPeerConnection();if(this.connection.peerConnection=n,this.connection.type===ei.Media&&e._stream&&this._addTracksToConnection(e._stream,n),e.originator){const r=this.connection,s={ordered:!!e.reliable},i=n.createDataChannel(r.label,s);r._initializeDataChannel(i),this._makeOffer()}else this.handleSDP("OFFER",e.sdp)}_startPeerConnection(){ke.log("Creating RTCPeerConnection.");const e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e}_setupListeners(e){const n=this.connection.peer,r=this.connection.connectionId,s=this.connection.type,i=this.connection.provider;ke.log("Listening for ICE candidates."),e.onicecandidate=o=>{!o.candidate||!o.candidate.candidate||(ke.log(`Received ICE candidates for ${n}:`,o.candidate),i.socket.send({type:_n.Candidate,payload:{candidate:o.candidate,type:s,connectionId:r},dst:n}))},e.oniceconnectionstatechange=()=>{switch(e.iceConnectionState){case"failed":ke.log("iceConnectionState is failed, closing connections to "+n),this.connection.emitError(ig.NegotiationFailed,"Negotiation of connection to "+n+" failed."),this.connection.close();break;case"closed":ke.log("iceConnectionState is closed, closing connections to "+n),this.connection.emitError(ig.ConnectionClosed,"Connection to "+n+" closed."),this.connection.close();break;case"disconnected":ke.log("iceConnectionState changed to disconnected on the connection with "+n);break;case"completed":e.onicecandidate=()=>{};break}this.connection.emit("iceStateChanged",e.iceConnectionState)},ke.log("Listening for data channel"),e.ondatachannel=o=>{ke.log("Received data channel");const l=o.channel;i.getConnection(n,r)._initializeDataChannel(l)},ke.log("Listening for remote stream"),e.ontrack=o=>{ke.log("Received remote stream");const l=o.streams[0],c=i.getConnection(n,r);if(c.type===ei.Media){const d=c;this._addStreamToMediaConnection(l,d)}}}cleanup(){ke.log("Cleaning up PeerConnection to "+this.connection.peer);const e=this.connection.peerConnection;if(!e)return;this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=()=>{};const n=e.signalingState!=="closed";let r=!1;const s=this.connection.dataChannel;s&&(r=!!s.readyState&&s.readyState!=="closed"),(n||r)&&e.close()}async _makeOffer(){const e=this.connection.peerConnection,n=this.connection.provider;try{const r=await e.createOffer(this.connection.options.constraints);ke.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),ke.log("Set localDescription:",r,`for:${this.connection.peer}`);let s={sdp:r,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===ei.Data){const i=this.connection;s={...s,label:i.label,reliable:i.reliable,serialization:i.serialization}}n.socket.send({type:_n.Offer,payload:s,dst:this.connection.peer})}catch(s){s!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(n.emitError(Jt.WebRTC,s),ke.log("Failed to setLocalDescription, ",s))}}catch(r){n.emitError(Jt.WebRTC,r),ke.log("Failed to createOffer, ",r)}}async _makeAnswer(){const e=this.connection.peerConnection,n=this.connection.provider;try{const r=await e.createAnswer();ke.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),ke.log("Set localDescription:",r,`for:${this.connection.peer}`),n.socket.send({type:_n.Answer,payload:{sdp:r,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(s){n.emitError(Jt.WebRTC,s),ke.log("Failed to setLocalDescription, ",s)}}catch(r){n.emitError(Jt.WebRTC,r),ke.log("Failed to create answer, ",r)}}async handleSDP(e,n){n=new RTCSessionDescription(n);const r=this.connection.peerConnection,s=this.connection.provider;ke.log("Setting remote description",n);const i=this;try{await r.setRemoteDescription(n),ke.log(`Set remoteDescription:${e} for:${this.connection.peer}`),e==="OFFER"&&await i._makeAnswer()}catch(o){s.emitError(Jt.WebRTC,o),ke.log("Failed to setRemoteDescription, ",o)}}async handleCandidate(e){ke.log("handleCandidate:",e);try{await this.connection.peerConnection.addIceCandidate(e),ke.log(`Added ICE candidate for:${this.connection.peer}`)}catch(n){this.connection.provider.emitError(Jt.WebRTC,n),ke.log("Failed to handleCandidate, ",n)}}_addTracksToConnection(e,n){if(ke.log(`add tracks from stream ${e.id} to peer connection`),!n.addTrack)return ke.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(r=>{n.addTrack(r,e)})}_addStreamToMediaConnection(e,n){ke.log(`add stream ${e.id} to media connection ${n.connectionId}`),n.addStream(e)}}class a2 extends am.EventEmitter{emitError(e,n){ke.error("Error:",n),this.emit("error",new UL(`${e}`,n))}}class UL extends Error{constructor(e,n){typeof n=="string"?super(n):(super(),Object.assign(this,n)),this.type=e}}class l2 extends a2{get open(){return this._open}constructor(e,n,r){super(),this.peer=e,this.provider=n,this.options=r,this._open=!1,this.metadata=r.metadata}}var ag;const fl=class fl extends l2{get type(){return ei.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(e,n,r){super(e,n,r),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||fl.ID_PREFIX+Nn.randomToken(),this._negotiator=new o2(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{ke.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{ke.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(e){ke.log("Receiving stream",e),this._remoteStream=e,super.emit("stream",e)}handleMessage(e){const n=e.type,r=e.payload;switch(e.type){case _n.Answer:this._negotiator.handleSDP(n,r.sdp),this._open=!0;break;case _n.Candidate:this._negotiator.handleCandidate(r.candidate);break;default:ke.warn(`Unrecognized message type:${n} from peer:${this.peer}`);break}}answer(e,n={}){if(this._localStream){ke.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=e,n&&n.sdpTransform&&(this.options.sdpTransform=n.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:e});const r=this.provider._getMessages(this.connectionId);for(const s of r)this.handleMessage(s);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit("close"))}};ag=new WeakMap,Ta(fl,ag,fl.ID_PREFIX="mc_");let ku=fl;class BL{constructor(e){this._options=e}_buildRequest(e){const n=this._options.secure?"https":"http",{host:r,port:s,path:i,key:o}=this._options,l=new URL(`${n}://${r}:${s}${i}${o}/${e}`);return l.searchParams.set("ts",`${Date.now()}${Math.random()}`),l.searchParams.set("version",i2),fetch(l.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{const e=await this._buildRequest("id");if(e.status!==200)throw new Error(`Error. Status:${e.status}`);return e.text()}catch(e){ke.error("Error retrieving ID",e);let n="";throw this._options.path==="/"&&this._options.host!==Nn.CLOUD_HOST&&(n=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+n)}}async listAllPeers(){try{const e=await this._buildRequest("peers");if(e.status!==200){if(e.status===401){let n="";throw this._options.host===Nn.CLOUD_HOST?n="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":n="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+n)}throw new Error(`Error. Status:${e.status}`)}return e.json()}catch(e){throw ke.error("Error retrieving list peers",e),new Error("Could not get list peers from the server."+e)}}}var lg,cg;const Ii=class Ii extends l2{get type(){return ei.Data}constructor(e,n,r){super(e,n,r),this.connectionId=this.options.connectionId||Ii.ID_PREFIX+r2(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new o2(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{ke.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=n=>{ke.log(`DC#${this.connectionId} dc onmessage:`,n.data)},this.dataChannel.onclose=()=>{ke.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(e){if(e!=null&&e.flush){this.send({__peerData:{type:"close"}});return}this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null),this.open&&(this._open=!1,super.emit("close"))}send(e,n=!1){if(!this.open){this.emitError(lm.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.");return}return this._send(e,n)}async handleMessage(e){const n=e.payload;switch(e.type){case _n.Answer:await this._negotiator.handleSDP(e.type,n.sdp);break;case _n.Candidate:await this._negotiator.handleCandidate(n.candidate);break;default:ke.warn("Unrecognized message type:",e.type,"from peer:",this.peer);break}}};lg=new WeakMap,cg=new WeakMap,Ta(Ii,lg,Ii.ID_PREFIX="dc_"),Ta(Ii,cg,Ii.MAX_BUFFERED_AMOUNT=8388608);let Ru=Ii;class cm extends Ru{get bufferSize(){return this._bufferSize}_initializeDataChannel(e){super._initializeDataChannel(e),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",n=>this._handleDataMessage(n))}_bufferedSend(e){(this._buffering||!this._trySend(e))&&(this._buffer.push(e),this._bufferSize=this._buffer.length)}_trySend(e){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>Ru.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(e)}catch(n){return ke.error(`DC#:${this.connectionId} Error when sending:`,n),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open||this._buffer.length===0)return;const e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(e){if(e!=null&&e.flush){this.send({__peerData:{type:"close"}});return}this._buffer=[],this._bufferSize=0,super.close()}constructor(...e){super(...e),this._buffer=[],this._bufferSize=0,this._buffering=!1}}class Nh extends cm{close(e){super.close(e),this._chunkedData={}}constructor(e,n,r){super(e,n,r),this.chunker=new n2,this.serialization=pf.Binary,this._chunkedData={}}_handleDataMessage({data:e}){const n=bS(e),r=n.__peerData;if(r){if(r.type==="close"){this.close();return}this._handleChunk(n);return}this.emit("data",n)}_handleChunk(e){const n=e.__peerData,r=this._chunkedData[n]||{data:[],count:0,total:e.total};if(r.data[e.n]=new Uint8Array(e.data),r.count++,this._chunkedData[n]=r,r.total===r.count){delete this._chunkedData[n];const s=OL(r.data);this._handleDataMessage({data:s})}}_send(e,n){const r=ES(e);if(r instanceof Promise)return this._send_blob(r);if(!n&&r.byteLength>this.chunker.chunkedMTU){this._sendChunks(r);return}this._bufferedSend(r)}async _send_blob(e){const n=await e;if(n.byteLength>this.chunker.chunkedMTU){this._sendChunks(n);return}this._bufferedSend(n)}_sendChunks(e){const n=this.chunker.chunk(e);ke.log(`DC#${this.connectionId} Try to send ${n.length} chunks...`);for(const r of n)this.send(r,!0)}}class zL extends cm{_handleDataMessage({data:e}){super.emit("data",e)}_send(e,n){this._bufferedSend(e)}constructor(...e){super(...e),this.serialization=pf.None}}class HL extends cm{_handleDataMessage({data:e}){const n=this.parse(this.decoder.decode(e)),r=n.__peerData;if(r&&r.type==="close"){this.close();return}this.emit("data",n)}_send(e,n){const r=this.encoder.encode(this.stringify(e));if(r.byteLength>=Nn.chunkedMTU){this.emitError(lm.MessageToBig,"Message too big for JSON channel");return}this._bufferedSend(r)}constructor(...e){super(...e),this.serialization=pf.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}var dg;const hl=class hl extends a2{get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){const e=Object.create(null);for(const[n,r]of this._connections)e[n]=r;return e}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(e,n){super(),this._serializers={raw:zL,json:HL,binary:Nh,"binary-utf8":Nh,default:Nh},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map;let r;if(e&&e.constructor==Object?n=e:e&&(r=e.toString()),n={debug:0,host:Nn.CLOUD_HOST,port:Nn.CLOUD_PORT,path:"/",key:hl.DEFAULT_KEY,token:Nn.randomToken(),config:Nn.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...n},this._options=n,this._serializers={...this._serializers,...this.options.serializers},this._options.host==="/"&&(this._options.host=window.location.hostname),this._options.path&&(this._options.path[0]!=="/"&&(this._options.path="/"+this._options.path),this._options.path[this._options.path.length-1]!=="/"&&(this._options.path+="/")),this._options.secure===void 0&&this._options.host!==Nn.CLOUD_HOST?this._options.secure=Nn.isSecure():this._options.host==Nn.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&ke.setLogFunction(this._options.logFunction),ke.logLevel=this._options.debug||0,this._api=new BL(n),this._socket=this._createServerConnection(),!Nn.supports.audioVideo&&!Nn.supports.data){this._delayedAbort(Jt.BrowserIncompatible,"The current browser does not support WebRTC");return}if(r&&!Nn.validateId(r)){this._delayedAbort(Jt.InvalidID,`ID "${r}" is invalid`);return}r?this._initialize(r):this._api.retrieveId().then(s=>this._initialize(s)).catch(s=>this._abort(Jt.ServerError,s))}_createServerConnection(){const e=new FL(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return e.on(Us.Message,n=>{this._handleMessage(n)}),e.on(Us.Error,n=>{this._abort(Jt.SocketError,n)}),e.on(Us.Disconnected,()=>{this.disconnected||(this.emitError(Jt.Network,"Lost connection to server."),this.disconnect())}),e.on(Us.Close,()=>{this.disconnected||this._abort(Jt.SocketClosed,"Underlying socket is already closed.")}),e}_initialize(e){this._id=e,this.socket.start(e,this._options.token)}_handleMessage(e){const n=e.type,r=e.payload,s=e.src;switch(n){case _n.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case _n.Error:this._abort(Jt.ServerError,r.msg);break;case _n.IdTaken:this._abort(Jt.UnavailableID,`ID "${this.id}" is taken`);break;case _n.InvalidKey:this._abort(Jt.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case _n.Leave:ke.log(`Received leave message from ${s}`),this._cleanupPeer(s),this._connections.delete(s);break;case _n.Expire:this.emitError(Jt.PeerUnavailable,`Could not connect to peer ${s}`);break;case _n.Offer:{const i=r.connectionId;let o=this.getConnection(s,i);if(o&&(o.close(),ke.warn(`Offer received for existing Connection ID:${i}`)),r.type===ei.Media){const c=new ku(s,this,{connectionId:i,_payload:r,metadata:r.metadata});o=c,this._addConnection(s,o),this.emit("call",c)}else if(r.type===ei.Data){const c=new this._serializers[r.serialization](s,this,{connectionId:i,_payload:r,metadata:r.metadata,label:r.label,serialization:r.serialization,reliable:r.reliable});o=c,this._addConnection(s,o),this.emit("connection",c)}else{ke.warn(`Received malformed connection type:${r.type}`);return}const l=this._getMessages(i);for(const c of l)o.handleMessage(c);break}default:{if(!r){ke.warn(`You received a malformed message from ${s} of type ${n}`);return}const i=r.connectionId,o=this.getConnection(s,i);o&&o.peerConnection?o.handleMessage(e):i?this._storeMessage(i,e):ke.warn("You received an unrecognized message:",e);break}}}_storeMessage(e,n){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(n)}_getMessages(e){const n=this._lostMessages.get(e);return n?(this._lostMessages.delete(e),n):[]}connect(e,n={}){if(n={serialization:"default",...n},this.disconnected){ke.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(Jt.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}const r=new this._serializers[n.serialization](e,this,n);return this._addConnection(e,r),r}call(e,n,r={}){if(this.disconnected){ke.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(Jt.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!n){ke.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}const s=new ku(e,this,{...r,_stream:n});return this._addConnection(e,s),s}_addConnection(e,n){ke.log(`add connection ${n.type}:${n.connectionId} to peerId:${e}`),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(n)}_removeConnection(e){const n=this._connections.get(e.peer);if(n){const r=n.indexOf(e);r!==-1&&n.splice(r,1)}this._lostMessages.delete(e.connectionId)}getConnection(e,n){const r=this._connections.get(e);if(!r)return null;for(const s of r)if(s.connectionId===n)return s;return null}_delayedAbort(e,n){setTimeout(()=>{this._abort(e,n)},0)}_abort(e,n){ke.error("Aborting!"),this.emitError(e,n),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||(ke.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))}_cleanup(){for(const e of this._connections.keys())this._cleanupPeer(e),this._connections.delete(e);this.socket.removeAllListeners()}_cleanupPeer(e){const n=this._connections.get(e);if(n)for(const r of n)r.close()}disconnect(){if(this.disconnected)return;const e=this.id;ke.log(`Disconnect peer with ID:${e}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit("disconnected",e)}reconnect(){if(this.disconnected&&!this.destroyed)ke.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)ke.error("In a hurry? We're still trying to make the initial connection!");else throw new Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`)}}listAllPeers(e=n=>{}){this._api.listAllPeers().then(n=>e(n)).catch(n=>this._abort(Jt.ServerError,n))}};dg=new WeakMap,Ta(hl,dg,hl.DEFAULT_KEY="peerjs");let og=hl;var c2=og;class d2{constructor(){un(this,"peer",null);un(this,"conn",null);un(this,"isHost",!1);un(this,"messageCallback",null);un(this,"connectionCallback",null);un(this,"closeCallback",null)}async connect(e){return this.peer=new c2,new Promise((n,r)=>{if(!this.peer)return r("Peer not initialized");this.peer.on("open",s=>{console.log("My Peer ID is:",s),e?(this.isHost=!1,this.connectToPeer(e),n(s)):(this.isHost=!0,this.peer.on("connection",i=>{console.log("Incoming connection..."),this.setupConnection(i)}),n(s))}),this.peer.on("error",s=>{console.error(s),r(s)})})}connectToPeer(e){if(!this.peer)return;const n=this.peer.connect(e);this.setupConnection(n)}setupConnection(e){this.conn=e,e.on("open",()=>{console.log("Connection established!"),this.connectionCallback&&this.connectionCallback()}),e.on("data",n=>{this.messageCallback&&this.messageCallback(n)}),e.on("close",()=>{console.log("Connection closed"),this.closeCallback&&this.closeCallback()}),e.on("error",n=>console.error("Connection Error:",n))}onConnection(e){this.connectionCallback=e}onClose(e){this.closeCallback=e}isConnected(){return this.conn!==null&&this.conn.open}send(e){this.conn&&this.conn.open?this.conn.send(e):console.warn("Connection not open, cannot send message")}onMessage(e){this.messageCallback=e}disconnect(){var e,n;(e=this.conn)==null||e.close(),(n=this.peer)==null||n.destroy()}}const WL=({gameMode:t,targetRoomId:e,playerClass:n,onGameStart:r,onBack:s})=>{const[i,o]=A.useState(""),[l,c]=A.useState(!1),[d,u]=A.useState(!0),[p,f]=A.useState(null),[S,R]=A.useState(!1),[C,j]=A.useState(null),[_,v]=A.useState(!1),w=A.useRef(null);A.useEffect(()=>{const H=new d2;return w.current=H,(async()=>{try{const W=await H.connect(t==="JOIN"?e:void 0);o(W),u(!1),H.onMessage(Z=>{console.log("[LobbyScreen] Received message:",Z),Z.type==="CLASS_INFO"&&(console.log("[LobbyScreen] Received opponent class:",Z.playerClass),j(Z.playerClass))}),H.onConnection(()=>{console.log("[LobbyScreen] Connection established!"),c(!0)})}catch(W){console.error("[LobbyScreen] Connection error:",W),f(W.toString()),u(!1)}})(),()=>{var W;(W=w.current)!=null&&W.isConnected()||H.disconnect()}},[t,e]),A.useEffect(()=>{l&&w.current&&!_&&(console.log("[LobbyScreen] Sending class info:",n),setTimeout(()=>{var H;(H=w.current)==null||H.send({type:"CLASS_INFO",playerClass:n}),v(!0)},100))},[l,n,_]),A.useEffect(()=>{if(l&&w.current&&C){const H=setTimeout(()=>{console.log("[LobbyScreen] Starting game with opponent class:",C),r(w.current,C)},500);return()=>clearTimeout(H)}},[l,r,C]);const h=async()=>{if(i)try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(i);else{const H=document.createElement("textarea");H.value=i,H.style.position="fixed",H.style.left="-999999px",H.style.top="-999999px",document.body.appendChild(H),H.focus(),H.select(),document.execCommand("copy"),document.body.removeChild(H)}R(!0),setTimeout(()=>R(!1),2e3)}catch(H){console.error("Failed to copy:",H),alert(`Room ID: ${i}

()`)}},D=()=>{w.current&&(w.current.disconnect(),w.current=null),s()};return a.jsxs("div",{className:"screen lobby-screen",style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",gap:"2rem"},children:[a.jsx("h1",{style:{fontSize:"2.5rem",marginBottom:"1rem",textShadow:"0 0 10px #e94560",fontFamily:"Tamanegi, sans-serif",letterSpacing:"2px"},children:t==="HOST"?"":"..."}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1.5rem",padding:"2rem",background:"rgba(0,0,0,0.3)",borderRadius:"10px",minWidth:"400px"},children:[p&&a.jsxs("div",{style:{color:"#ff6b6b",fontSize:"1.2rem",textAlign:"center",fontFamily:"Tamanegi, sans-serif"},children:[a.jsx("p",{children:""}),a.jsx("p",{style:{fontSize:"0.9rem",opacity:.7},children:p})]}),d&&!p&&a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1rem"},children:[a.jsx("div",{className:"loading-spinner",style:{width:"50px",height:"50px",border:"4px solid rgba(233, 69, 96, 0.3)",borderTop:"4px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),a.jsx("p",{style:{opacity:.8,fontFamily:"Tamanegi, sans-serif"},children:t==="HOST"?"...":"..."})]}),t==="HOST"&&i&&!d&&!l&&!p&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.5rem"},children:[a.jsx("p",{style:{fontSize:"1rem",opacity:.7,fontFamily:"Tamanegi, sans-serif"},children:"ID:"}),a.jsx("div",{style:{fontSize:"2rem",fontFamily:"monospace",fontWeight:"bold",padding:"0.5rem 1rem",background:"rgba(233, 69, 96, 0.2)",borderRadius:"8px",border:"1px solid #e94560",letterSpacing:"2px"},children:i})]}),a.jsx("button",{onClick:h,style:{fontSize:"1rem",padding:"0.8rem 2rem",background:S?"#48bb78":"transparent",border:"2px solid "+(S?"#48bb78":"#e94560"),color:"#fff",cursor:"pointer",transition:"all 0.3s",borderRadius:"4px",fontWeight:"bold",fontFamily:"Tamanegi, sans-serif"},children:S?" ":"ID"}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginTop:"1rem",opacity:.7},children:[a.jsx("div",{className:"loading-spinner",style:{width:"20px",height:"20px",border:"2px solid rgba(233, 69, 96, 0.3)",borderTop:"2px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),a.jsx("span",{style:{fontFamily:"Tamanegi, sans-serif"},children:"..."})]})]}),t==="JOIN"&&!d&&!l&&!p&&a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[a.jsx("div",{className:"loading-spinner",style:{width:"20px",height:"20px",border:"2px solid rgba(233, 69, 96, 0.3)",borderTop:"2px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),a.jsxs("span",{style:{fontFamily:"Tamanegi, sans-serif"},children:[" ",e," ..."]})]}),l&&a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1rem"},children:[a.jsx("p",{style:{fontSize:"1.5rem",color:"#48bb78",fontFamily:"Tamanegi, sans-serif"},children:" "}),a.jsx("p",{style:{fontFamily:"Tamanegi, sans-serif"},children:"..."})]}),a.jsxs("div",{style:{marginTop:"1rem",padding:"0.5rem 1rem",background:"rgba(255,255,255,0.1)",borderRadius:"4px",fontSize:"0.9rem",opacity:.7,fontFamily:"Tamanegi, sans-serif"},children:[": ",n==="SENKA"?"":n==="AJA"?"":"yoRuka"]})]}),a.jsx("button",{onClick:D,style:{fontSize:"1rem",padding:"0.8rem 2rem",background:"transparent",border:"1px solid #888",color:"#888",cursor:"pointer",transition:"all 0.3s",borderRadius:"4px",marginTop:"1rem",fontFamily:"Tamanegi, sans-serif"},onMouseOver:H=>{H.currentTarget.style.color="#fff",H.currentTarget.style.borderColor="#fff"},onMouseOut:H=>{H.currentTarget.style.color="#888",H.currentTarget.style.borderColor="#888"},children:" "}),a.jsx("style",{children:`
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `})]})};class GL{constructor(){un(this,"myEntryRef",null);un(this,"listenerUnsubscribe",null);un(this,"myId","");un(this,"myPeerId","");un(this,"hasMatched",!1)}async startMatchmaking(e,n,r,s,i,o,l,c){this.myPeerId=e,this.hasMatched=!1;const d=$r(Fr,`matchmaking/${s}`);try{const u=await cf(d),p=[];if(u.exists()&&u.forEach(C=>{const j=C.val(),_=Date.now()-j.timestamp<5*60*1e3;j.peerId!==e&&_&&p.push({key:C.key,data:j})}),p.length>0){const C=p.sort((j,_)=>j.data.timestamp-_.data.timestamp)[0];await nd($r(Fr,`matchmaking/${s}/${C.key}`)),i("matched"),o({peerId:C.data.peerId,playerName:C.data.playerName,playerClass:C.data.playerClass,isHost:!1,playerId:C.data.playerId,rating:C.data.rating});return}i("searching");const f=TA(d);this.myEntryRef=f,this.myId=f.key;const S={id:this.myId,peerId:e,playerName:n,playerClass:r,matchType:s,...l!=null&&{playerId:l},...c!=null&&{rating:c},timestamp:Date.now()};await lf(f,S),IA(f).remove();const R=s;this.listenerUnsubscribe=NE(d,async C=>{if(this.hasMatched||!C.exists())return;let j=!1,_=null;if(C.forEach(v=>{const w=v.val();v.key===this.myId?j=!0:w.peerId!==this.myPeerId&&(!_||w.timestamp>_.data.timestamp)&&(_={key:v.key,data:w})}),!j&&this.myEntryRef){if(this.hasMatched)return;this.hasMatched=!0,i("matched"),this.cleanup();return}if(_!==null&&j){const v=C.child(this.myId).val(),w=_;if(v&&v.timestamp<w.data.timestamp){if(this.hasMatched)return;this.hasMatched=!0,await nd($r(Fr,`matchmaking/${R}/${w.key}`)),await nd($r(Fr,`matchmaking/${R}/${this.myId}`)),this.cleanup(),i("matched"),o({peerId:w.data.peerId,playerName:w.data.playerName,playerClass:w.data.playerClass,isHost:!0,playerId:w.data.playerId,rating:w.data.rating})}}})}catch(u){console.error("[Matchmaking] Error:",u),i("error"),this.cleanup()}}async cancelMatchmaking(){if(this.myEntryRef)try{await nd(this.myEntryRef)}catch(e){console.error("[Matchmaking] Error removing entry:",e)}this.cleanup()}cleanup(){this.listenerUnsubscribe&&(this.listenerUnsubscribe(),this.listenerUnsubscribe=null),this.myEntryRef=null,this.myId=""}}const od=new GL;class Mx{constructor(e,n,r=!1){un(this,"peer");un(this,"conn");un(this,"isHost",!1);un(this,"messageCallback",null);un(this,"closeCallback",null);this.peer=e,this.conn=n,this.isHost=r,n.on("data",s=>{this.messageCallback&&this.messageCallback(s)}),n.on("close",()=>{console.log("[PeerJSAdapter] Connection closed"),this.closeCallback&&this.closeCallback()}),n.on("error",s=>console.error("[PeerJSAdapter] Connection Error:",s))}async connect(e){return this.peer.id}onConnection(e){}onClose(e){this.closeCallback=e}isConnected(){return this.conn!==null&&this.conn.open}send(e){this.conn&&this.conn.open?this.conn.send(e):console.warn("[PeerJSAdapter] Connection not open, cannot send message")}onMessage(e){this.messageCallback=e}disconnect(){var e,n;(e=this.conn)==null||e.close(),(n=this.peer)==null||n.destroy()}}const VL=1280,YL=720,Nx={BRONZE:"#cd7f32",SILVER:"#c0c0c0",GOLD:"#ffd700",PLATINUM:"#e5e4e2",DIAMOND:"#b9f2ff",MASTER:"#ff4500"},KL=({matchType:t,playerClass:e,playerName:n,playerId:r,onGameStart:s,onCancel:i})=>{const[o,l]=A.useState("idle"),[c,d]=A.useState("..."),[u,p]=A.useState(0),f=A.useRef(null),S=A.useRef(null),R=A.useRef(null),C=A.useRef(!1),j=A.useRef(!1),[_,v]=A.useState(0),[w,h]=A.useState(void 0),[D,H]=A.useState(1);A.useEffect(()=>{const Z=()=>{const he=window.innerWidth/VL,xe=window.innerHeight/YL;H(Math.min(he,xe))};return Z(),window.addEventListener("resize",Z),()=>window.removeEventListener("resize",Z)},[]),A.useEffect(()=>{if(o!=="searching")return;const Z=setInterval(()=>{p(he=>{const xe=he+1;return xe>=60&&(l("error"),d(""),od.cancelMatchmaking(),S.current&&S.current.close(),f.current&&f.current.destroy()),xe})},1e3);return()=>clearInterval(Z)},[o]),A.useEffect(()=>{let Z=!0,he=0;return(async()=>{try{if(t==="ranked"&&r)try{he=(await xS(r,e)).rating,v(he)}catch(ie){console.error("[Matchmaking] Failed to get rating:",ie)}const Ue=new c2({debug:1,config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]}});if(f.current=Ue,await new Promise((ie,O)=>{Ue.on("open",()=>ie()),Ue.on("error",T=>O(T))}),!Z)return;const de=Ue.id;console.log("[Matchmaking] My PeerJS ID:",de),Ue.on("connection",ie=>{console.log("[Matchmaking] Incoming connection from:",ie.peer),S.current=ie,ie.on("open",()=>{console.log("[Matchmaking] Connection opened (as HOST)"),ie.on("data",O=>{if(O.type==="PLAYER_INFO"){console.log("[Matchmaking] Received player info:",O),ie.send({type:"PLAYER_INFO",playerName:n,playerClass:e,playerId:t==="ranked"?r:void 0,rating:t==="ranked"?he:void 0}),Z&&t==="ranked"&&h(O.rating),j.current=!0;const T=new Mx(Ue,ie,!0);s(T,O.playerClass,!0,O.playerId,O.rating)}})})}),od.startMatchmaking(de,n,e,t,ie=>{if(Z)switch(l(ie),ie){case"searching":d("...");break;case"matched":d("...");break;case"error":d("");break}},async ie=>{if(Z)if(console.log("[Matchmaking] Match found:",ie),R.current=ie,C.current=ie.isHost,ie.isHost)d("...");else{d("...");const O=Ue.connect(ie.peerId,{reliable:!0});S.current=O,O.on("open",()=>{console.log("[Matchmaking] Connection opened (as JOIN)"),O.send({type:"PLAYER_INFO",playerName:n,playerClass:e,playerId:t==="ranked"?r:void 0,rating:t==="ranked"?he:void 0}),O.on("data",T=>{if(T.type==="PLAYER_INFO"){console.log("[Matchmaking] Received player info:",T),Z&&t==="ranked"&&h(T.rating),j.current=!0;const k=new Mx(Ue,O,!1);s(k,T.playerClass,!1,T.playerId,T.rating)}})}),O.on("error",T=>{console.error("[Matchmaking] Connection error:",T),l("error"),d("")})}},t==="ranked"&&r?r:void 0,t==="ranked"?he:void 0)}catch(Ue){console.error("[Matchmaking] Init error:",Ue),Z&&(l("error"),d(""))}})(),()=>{Z=!1,od.cancelMatchmaking(),j.current||(S.current&&S.current.close(),f.current&&f.current.destroy())}},[t,e,n,r,s]);const re=async()=>{await od.cancelMatchmaking(),S.current&&S.current.close(),f.current&&f.current.destroy(),i()},W=Z=>{const he=Math.floor(Z/60),xe=Z%60;return`${he}:${xe.toString().padStart(2,"0")}`};return a.jsxs("div",{className:"screen",style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white"},children:[a.jsx("div",{style:{fontSize:`${1.2*D}rem`,color:"#4ade80",marginBottom:`${1*D}rem`,fontWeight:"bold"},children:t==="casual"?"":""}),a.jsx("div",{style:{fontSize:`${2*D}rem`,fontWeight:"bold",marginBottom:`${1*D}rem`,textAlign:"center"},children:c}),o==="searching"&&a.jsxs("div",{style:{fontSize:`${1.5*D}rem`,color:"#888",marginBottom:`${2*D}rem`},children:[": ",W(u)]}),(o==="searching"||o==="matched")&&a.jsx("div",{style:{width:80*D,height:80*D,border:"4px solid rgba(255,255,255,0.2)",borderTop:"4px solid #4ade80",borderRadius:"50%",animation:"spin 1s linear infinite",marginBottom:`${2*D}rem`}}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*D}rem`,marginBottom:`${2*D}rem`,padding:`${1*D}rem`,background:"rgba(255,255,255,0.1)",borderRadius:8*D},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:`${1*D}rem`},children:[a.jsx("div",{style:{fontSize:`${1*D}rem`},children:n||""}),a.jsx("div",{style:{fontSize:`${.9*D}rem`,color:e==="SENKA"?"#e94560":e==="AJA"?"#45a2e9":"#a855f7"},children:e==="SENKA"?"":e==="AJA"?"":"Y"})]}),t==="ranked"&&_>0&&a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:`${.5*D}rem`,fontSize:`${.85*D}rem`,color:"#aaa"},children:[a.jsx("span",{style:{fontWeight:"bold",color:Nx[Bn(_)],fontFamily:"Tamanegi, sans-serif"},children:Ur[Bn(_)]}),a.jsx("span",{style:{fontFamily:"Tamanegi, sans-serif"},children:_})]}),t==="ranked"&&o==="matched"&&w!==void 0&&a.jsxs("div",{style:{marginTop:`${.5*D}rem`,padding:`${.5*D}rem ${1*D}rem`,background:"rgba(0, 0, 0, 0.3)",borderRadius:4*D,fontSize:`${.8*D}rem`,color:"#aaa"},children:[": ",a.jsx("span",{style:{fontWeight:"bold",color:Nx[Bn(w)],fontFamily:"Tamanegi, sans-serif"},children:Ur[Bn(w)]})," ",w]})]}),o!=="error"&&a.jsx("button",{onClick:re,style:{padding:`${.8*D}rem ${2*D}rem`,fontSize:`${1*D}rem`,background:"transparent",border:"2px solid #e94560",color:"#e94560",borderRadius:8*D,cursor:"pointer",transition:"all 0.2s"},onMouseOver:Z=>{Z.currentTarget.style.background="#e94560",Z.currentTarget.style.color="white"},onMouseOut:Z=>{Z.currentTarget.style.background="transparent",Z.currentTarget.style.color="#e94560"},children:""}),o==="error"&&a.jsx("button",{onClick:i,style:{padding:`${.8*D}rem ${2*D}rem`,fontSize:`${1*D}rem`,background:"#e94560",border:"none",color:"white",borderRadius:8*D,cursor:"pointer"},children:""}),a.jsx("style",{children:`
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `})]})},XL=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},ho=({card:t,onClick:e,style:n,isSelected:r,isPlayable:s,variant:i="normal",turnCount:o,isOnBoard:l,isSpecialSummoning:c,className:d,suppressPassives:u,isMyTurn:p,scale:f=1})=>{const S="currentAttack"in t?t.currentAttack:t.attack,R="currentHealth"in t?t.currentHealth:t.health,C="maxHealth"in t?t.maxHealth:t.health,j="canAttack"in t?t.canAttack:!1,_="turnPlayed"in t?t.turnPlayed:void 0,[v,w]=F.useState(!1);F.useEffect(()=>{if(c&&l){w(!0);const N=setTimeout(()=>w(!1),800);return()=>clearTimeout(N)}},[c,l]);const h="baseAttack"in t?t.baseAttack:void 0,D="baseHealth"in t?t.baseHealth:void 0,H=h!==void 0&&S>h,re=D!==void 0&&(R>D||C>D),W="hasEvolved"in t?t.hasEvolved:!1,Z="evolvedImageUrl"in t?t.evolvedImageUrl:void 0,he=W&&Z?Z:t.imageUrl,xe=he?XL(he):void 0;let Ue=n==null?void 0:n.boxShadow,de;const ie=t.passiveAbilities||t.abilities||[],O=ie.includes("WARD"),T=ie.includes("AURA"),k=ie.includes("STEALTH"),y=t.hasBarrier===!0||ie.includes("BARRIER")&&t.hasBarrier!==!1;if(r)Ue="0 0 15px rgba(255, 255, 255, 0.8)";else if(s)Ue="0 0 10px #48bb78",de="2px solid #48bb78";else if(j&&p){const N=ie.includes("STORM"),J=ie.includes("RUSH"),U=o!==void 0&&_!==void 0&&_===o;let ve=!1;N||(U?ve=!0:(o===void 0||_===void 0)&&(ve=J)),ve?Ue="0 0 10px #f6e05e":Ue="0 0 10px #48bb78"}const g=R<C;if(i==="art-only")return a.jsx("div",{className:"card art-only",style:{width:140,height:200,...n,borderRadius:8,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",background:"#2d3748",position:"relative",boxShadow:"0 4px 6px rgba(0,0,0,0.3)"},children:xe?a.jsx("img",{src:xe,alt:t.name,draggable:!1,style:{width:"100%",height:"100%",objectFit:"cover"}}):a.jsx("div",{style:{fontSize:"1.5rem",opacity:.5,color:"white",fontWeight:"bold"},children:t.type})});if(i==="mobile-hand"){const J=t.type==="SPELL"?16:6,U=28*f,ve=.85*f;return a.jsxs("div",{className:`card mobile-hand ${d||""}`,style:{width:80,height:115,...n,position:"relative",cursor:e?"pointer":"default",transform:r?"translateY(-8px)":n==null?void 0:n.transform,boxShadow:Ue||(n==null?void 0:n.boxShadow),border:de||(s?"2px solid #48bb78":void 0),transition:"transform 0.2s, box-shadow 0.2s",background:"#1a202c",overflow:"hidden",borderRadius:`${J}px ${J}px 6px 6px`,backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},onClick:e,children:[a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"hidden",borderRadius:`${J}px ${J}px 6px 6px`},children:xe?a.jsx("img",{src:xe,alt:t.name,draggable:!1,style:{width:"100%",height:"100%",objectFit:"cover"}}):a.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"#4a5568",color:"#a0aec0",fontSize:"0.6rem"},children:t.type})}),a.jsxs("div",{style:{position:"absolute",top:3,left:4,display:"flex",flexDirection:"column",gap:2,zIndex:10},children:[a.jsx("div",{style:{width:U,height:U,borderRadius:"50%",background:"#48bb78",border:"1px solid rgba(255,255,255,0.8)",color:"white",fontSize:`${ve}rem`,fontWeight:900,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.6)"},children:t.cost}),t.type==="FOLLOWER"&&a.jsxs("div",{style:{width:U,height:U,display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[a.jsx("svg",{width:U,height:U,viewBox:"0 0 24 24",fill:"none",style:{position:"absolute",filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.8))"},children:a.jsx("polygon",{points:"12,2 22,22 2,22",fill:"#4299e1",stroke:"rgba(255,255,255,0.8)",strokeWidth:"1",strokeLinejoin:"round"})}),a.jsx("span",{style:{zIndex:1,color:H?"#faf089":"white",fontWeight:"bold",fontSize:`${ve}rem`,textShadow:"0 1px 2px black"},children:S})]}),t.type==="FOLLOWER"&&a.jsxs("div",{style:{width:U,height:U,display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[a.jsx("svg",{width:U,height:U,viewBox:"0 0 24 24",style:{position:"absolute",filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.8))"},children:a.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z",fill:"#c53030",stroke:"rgba(255,255,255,0.8)",strokeWidth:"1"})}),a.jsx("span",{style:{zIndex:1,color:re?"#faf089":g?"#fc8181":"white",fontWeight:"bold",fontSize:`${ve}rem`,textShadow:"0 1px 2px black"},children:R})]})]})]})}const I=t.type==="SPELL"&&!l,P=I?20:8;return a.jsxs("div",{className:`card card-container ${j?"ready":""} ${l?"on-board":""} ${d||""}`,style:{width:140,height:200,...n,position:"relative",cursor:e?"pointer":"default",transform:r?"translateY(-10px)":n==null?void 0:n.transform,boxShadow:Ue||(j?"0 0 10px #f6e05e":n==null?void 0:n.boxShadow),border:de||(s?"2px solid #48bb78":void 0),transition:"transform 0.2s, box-shadow 0.2s",display:"flex",flexDirection:"column",background:"#1a202c",overflow:"visible",animation:v?"cardSummonAppear 0.8s cubic-bezier(0.22, 1, 0.36, 1) forwards":n==null?void 0:n.animation,backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",borderRadius:I?`${P}px ${P}px 8px 8px`:"8px"},onClick:e,children:[!l&&a.jsx("div",{style:{height:20,background:"rgba(0,0,0,0.8)",color:"#e2e8f0",fontSize:t.name.length>10?"0.6rem":"0.7rem",fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid rgba(255,255,255,0.2)",zIndex:2,transform:t.name.length>15?"scaleX(0.9)":"none",borderRadius:I?`${P}px ${P}px 0 0`:"8px 8px 0 0"},children:t.name}),a.jsxs("div",{style:{flex:1,position:"relative",width:"100%",background:"#2d3748",borderRadius:l?"8px":"0 0 8px 8px",minHeight:0},children:[a.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"hidden",borderRadius:l?"8px":"0 0 8px 8px",zIndex:1},children:[xe?a.jsx("img",{src:xe,alt:t.name,draggable:!1,style:{width:"100%",height:"100%",objectFit:"cover",display:"block"}}):a.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"#4a5568",color:"#a0aec0",fontSize:"0.8rem"},children:t.type}),a.jsx("div",{style:{position:"absolute",bottom:0,left:0,width:"100%",height:40,background:"linear-gradient(to top, rgba(0,0,0,0.8), transparent)",pointerEvents:"none",zIndex:3}})]}),!l&&a.jsx("div",{style:{position:"absolute",top:2*f,left:2*f,width:24*f,height:24*f,borderRadius:"50%",background:"#48bb78",border:`${Math.max(1,2*f)}px solid #fff`,color:"white",fontSize:`${.9*f}rem`,fontWeight:900,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 2px 4px rgba(0,0,0,0.5), inset 0 2px 5px rgba(255,255,255,0.3)",zIndex:10},children:t.cost}),t.type==="FOLLOWER"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{position:"absolute",bottom:l?2*f:40*f,left:2*f,width:32*f,height:32*f,zIndex:10,display:"flex",alignItems:"center",justifyContent:"center"},children:[a.jsxs("svg",{width:40*f,height:40*f,viewBox:"0 0 24 24",fill:"none",style:{position:"absolute",filter:"drop-shadow(0 2px 2px rgba(0,0,0,0.8))"},children:[a.jsx("defs",{children:a.jsxs("linearGradient",{id:"blueGrad",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[a.jsx("stop",{offset:"0%",stopColor:"#63b3ed"}),a.jsx("stop",{offset:"100%",stopColor:"#4299e1"})]})}),a.jsx("polygon",{points:"12,2 22,22 2,22",fill:"url(#blueGrad)",stroke:"white",strokeWidth:"1",strokeLinejoin:"round"})]}),a.jsx("span",{style:{zIndex:11,color:H?"#faf089":"white",fontWeight:"bold",fontSize:`${1.2*f}rem`,textShadow:"0 2px 2px black"},children:S})]}),a.jsxs("div",{style:{position:"absolute",bottom:2*f,right:l?2*f:"auto",left:l?"auto":2*f,width:32*f,height:32*f,zIndex:10,display:"flex",alignItems:"center",justifyContent:"center"},children:[a.jsxs("svg",{width:36*f,height:36*f,viewBox:"0 0 24 24",style:{position:"absolute",filter:"drop-shadow(0 2px 2px rgba(0,0,0,0.8))"},children:[a.jsx("defs",{children:a.jsxs("linearGradient",{id:"redGrad",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[a.jsx("stop",{offset:"0%",stopColor:"#f56565"}),a.jsx("stop",{offset:"100%",stopColor:"#c53030"})]})}),a.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z",fill:"url(#redGrad)",stroke:"white",strokeWidth:"1.5"})]}),a.jsx("span",{style:{zIndex:11,color:re?"#faf089":g?"#fc8181":"white",fontWeight:"bold",fontSize:`${1.2*f}rem`,textShadow:"0 2px 2px black"},children:R})]})]}),l&&a.jsx("div",{style:{position:"absolute",top:-6*f,left:-6*f,right:-6*f,bottom:-6*f,zIndex:50,pointerEvents:"none",opacity:O&&!u?1:0,transition:"opacity 0.2s ease-in-out"},children:a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,animation:"wardPulseLoop 2.5s infinite ease-in-out"},children:a.jsxs("svg",{viewBox:"0 0 100 120",preserveAspectRatio:"none",style:{width:"100%",height:"100%"},children:[a.jsx("defs",{children:a.jsxs("filter",{id:"wardGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{stdDeviation:"2",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsx("path",{d:"M50 2 L96 20 V60 C96 90 50 116 50 116 C50 116 4 90 4 60 V20 Z",fill:"rgba(255, 255, 255, 0.12)",stroke:"#ECC94B",strokeWidth:"3",filter:"url(#wardGlow)"})]})})}),l&&a.jsxs("div",{style:{position:"absolute",top:-5*f,left:-5*f,right:-5*f,bottom:-5*f,zIndex:21,pointerEvents:"none",opacity:y&&!v&&!u?1:0,transition:"opacity 0.2s ease-in-out"},children:[a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,borderRadius:"50%",background:"radial-gradient(ellipse at center, rgba(99, 179, 237, 0.12) 0%, transparent 60%)",animation:"barrierGlowLoop 3s infinite ease-in-out"}}),a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,borderRadius:"50%",border:`${Math.max(1.5,2*f)}px solid rgba(99, 179, 237, 0.9)`,boxShadow:"0 0 6px rgba(66, 153, 225, 0.5), inset 0 0 8px rgba(99, 179, 237, 0.15)",animation:"barrierPulseLoop 3s infinite ease-in-out"}})]}),l&&a.jsx("div",{style:{position:"absolute",top:-6*f,left:-6*f,right:-6*f,bottom:-6*f,zIndex:22,pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center",opacity:T&&!v&&!u?1:0,transition:"opacity 0.2s ease-in-out"},children:a.jsx("div",{style:{width:"100%",height:"100%",position:"relative",animation:"auraPulseLoop 3s infinite ease-in-out"},children:a.jsxs("svg",{viewBox:"0 0 100 100",style:{width:"100%",height:"100%"},children:[a.jsx("defs",{children:a.jsxs("filter",{id:"auraGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{stdDeviation:"1.5",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsx("path",{d:"M40 5 L60 5 L60 30 L95 30 L95 45 L60 45 L60 95 L40 95 L40 45 L5 45 L5 30 L40 30 Z",fill:"rgba(255, 204, 0, 0.2)",stroke:"#f6ad55",strokeWidth:"2.5",filter:"url(#auraGlow)"})]})})}),l&&a.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:13,pointerEvents:"none",overflow:"hidden",borderRadius:"0 0 8px 8px",opacity:k&&!v&&!u?1:0,transition:"opacity 0.2s ease-in-out"},children:[a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:"120%",height:"120%",transform:"translate(-50%, -50%)",background:"radial-gradient(circle, rgba(0, 0, 0, 0.9) 0%, rgba(0, 0, 0, 0.6) 30%, rgba(0, 0, 0, 0.2) 60%, transparent 80%)",filter:"blur(10px)",animation:"stealthInkMove 3s infinite ease-in-out",mixBlendMode:"multiply"}}),a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:"100%",height:"100%",transform:"translate(-50%, -50%)",background:"radial-gradient(circle, rgba(20, 20, 30, 0.85) 0%, rgba(10, 10, 20, 0.4) 40%, transparent 70%)",filter:"blur(8px)",animation:"stealthInkPulse 1.5s infinite ease-in-out",mixBlendMode:"multiply"}}),a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:"70%",height:"70%",transform:"translate(-50%, -50%)",background:"radial-gradient(circle, rgba(255, 255, 255, 0.4) 0%, rgba(200, 200, 200, 0.25) 30%, transparent 60%)",filter:"blur(8px)",animation:"stealthMistMove 4s infinite ease-in-out",mixBlendMode:"screen"}}),a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,boxShadow:"inset 0 0 30px rgba(0, 0, 0, 0.85), 0 0 20px rgba(0, 0, 0, 0.6)",animation:"stealthPulse 1.5s infinite ease-in-out"}})]})]}),v&&a.jsx("div",{style:{position:"absolute",inset:0,borderRadius:8,background:"radial-gradient(circle, rgba(255,255,255,0.8) 0%, transparent 70%)",mixBlendMode:"overlay",animation:"cardSummonFlash 0.8s ease-out forwards",pointerEvents:"none",zIndex:100}}),a.jsx("style",{children:`
                @keyframes cardSummonAppear {
                    0% { opacity: 0; transform: scale(1.5); filter: brightness(2) blur(4px); }
                    100% { opacity: 1; transform: scale(1); filter: brightness(1) blur(0px); }
                }
                @keyframes cardSummonFlash {
                    0% { opacity: 0.8; transform: scale(1.2); }
                    100% { opacity: 0; transform: scale(1); }
                }
                @keyframes wardPulseLoop {
                    0% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(255, 255, 255, 0.5)); }
                    50% { transform: scale(1.08); opacity: 0.5; filter: blur(3px) drop-shadow(0 0 15px rgba(255, 255, 255, 0.8)); }
                    100% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(255, 255, 255, 0.5)); }
                }
                @keyframes barrierPulseLoop {
                    0% { transform: scale(1); opacity: 1; box-shadow: 0 0 8px rgba(66, 153, 225, 0.6), inset 0 0 10px rgba(99, 179, 237, 0.2); }
                    50% { transform: scale(1.03); opacity: 0.85; box-shadow: 0 0 12px rgba(99, 179, 237, 0.8), inset 0 0 15px rgba(99, 179, 237, 0.3); }
                    100% { transform: scale(1); opacity: 1; box-shadow: 0 0 8px rgba(66, 153, 225, 0.6), inset 0 0 10px rgba(99, 179, 237, 0.2); }
                }
                @keyframes barrierGlowLoop {
                    0% { transform: scale(1); opacity: 0.6; }
                    50% { transform: scale(1.05); opacity: 0.4; }
                    100% { transform: scale(1); opacity: 0.6; }
                }
                @keyframes auraPulseLoop {
                    0% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(246, 173, 85, 0.5)); }
                    50% { transform: scale(1.12); opacity: 0.4; filter: blur(4px) drop-shadow(0 0 20px rgba(255, 204, 0, 0.8)); }
                    100% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(246, 173, 85, 0.5)); }
                }
                @keyframes stealthInkMove {
                    0%, 100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 0.7; }
                    25% { transform: translate(-45%, -55%) scale(1.15) rotate(3deg); opacity: 1; }
                    50% { transform: translate(-50%, -50%) scale(0.95) rotate(0deg); opacity: 0.5; }
                    75% { transform: translate(-55%, -45%) scale(1.1) rotate(-3deg); opacity: 0.9; }
                }
                @keyframes stealthInkPulse {
                    0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.8; }
                    50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.4; }
                }
                @keyframes stealthMistMove {
                    0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.5; }
                    25% { transform: translate(-48%, -52%) scale(1.1); opacity: 0.8; }
                    50% { transform: translate(-52%, -48%) scale(1.2); opacity: 0.3; }
                    75% { transform: translate(-50%, -50%) scale(0.9); opacity: 0.7; }
                }
                @keyframes stealthPulse {
                    0%, 100% { opacity: 0.6; box-shadow: inset 0 0 50px rgba(0, 0, 0, 0.9), 0 0 30px rgba(0, 0, 0, 0.7); }
                    50% { opacity: 1; box-shadow: inset 0 0 70px rgba(0, 0, 0, 1), 0 0 40px rgba(0, 0, 0, 0.9); }
                }
                /* 3D flip support - ensure all child elements inherit backface-visibility */
                .card, .card * {
                    backface-visibility: hidden !important;
                    -webkit-backface-visibility: hidden !important;
                }
            `})]})},JL=35e5;function u2(){const[t,e]=A.useState(()=>jx());return A.useEffect(()=>{const n=()=>{e(jx())};return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),t}function jx(){const t=window.innerWidth*window.devicePixelRatio,e=window.innerHeight*window.devicePixelRatio,n=t*e,r=n>JL;let s="HD";return n>8e6?s="4K":n>35e5?s="1440p":n>2e6&&(s="1080p"),{isHighRes:r,isLightMode:r,pixelCount:n,resolution:s}}function QL(t){return t?{glowShadow:(e,n)=>`0 0 ${10*n}px ${e}`,blurAmount:4,enableGlowPulse:!1,dropShadow:e=>`drop-shadow(0 0 ${10*e}px rgba(255,255,255,0.6))`}:{glowShadow:(e,n)=>`
            0 0 ${15*n}px ${e},
            0 0 ${30*n}px ${e}80,
            0 0 ${60*n}px ${e}50
        `,blurAmount:8,enableGlowPulse:!0,dropShadow:e=>`drop-shadow(0 0 ${20*e}px rgba(255,255,255,0.8)) drop-shadow(0 0 ${40*e}px rgba(255,255,255,0.6))`}}const Ld=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},ad=t=>Ld(t==="YORUKA"?"/leaders/yoRuka_leader.png":t==="AJA"?"/leaders/azya_leader.png":"/leaders/senka_leader.png"),qL=Ld("/assets/VS.png"),rr=8,jh=240,ZL=({myPlayer:t,opponentPlayer:e,isFirstPlayer:n,onComplete:r,scale:s=1,onVsImpact:i,onCoinToss:o,onImpact:l,onOrbLand:c,onFadeInBoard:d,isMobile:u=!1})=>{const[p,f]=A.useState("fade-in"),[S,R]=A.useState(!1),{isLightMode:C}=u2(),j=QL(C),[_,v]=A.useState(1),[w,h]=A.useState(1),[D,H]=A.useState(0),[re,W]=A.useState(0),[Z,he]=A.useState(1),[xe,Ue]=A.useState({myX:0,myY:0,opX:0,opY:0}),[de,ie]=A.useState(0),[O,T]=A.useState(0),[k,y]=A.useState([]),g=A.useMemo(()=>{const K=window.innerWidth,Oe=window.innerHeight,_e=s,ze=(u?280:340)*_e,Se=K-ze,De=ze+Se/2,vt=De,st=Oe- -20*_e-jh*_e/2,at=De,et=-20*_e+jh*_e/2;return{player:{x:vt,y:st},opponent:{x:at,y:et},leaderSize:jh*_e}},[u,s]),I=A.useMemo(()=>{const K=window.innerWidth,Oe=window.innerHeight,_e=K*.25,ze=Oe*.5,Se=K*.75,De=Oe*.5;return{myX:_e,myY:ze,opX:Se,opY:De}},[]),P=C?`0 0 ${10*s}px rgba(103, 232, 249, 0.8)`:`0 0 ${15*s}px rgba(103, 232, 249, 1), 0 0 ${30*s}px rgba(34, 211, 238, 0.8), 0 0 ${60*s}px rgba(6, 182, 212, 0.5)`,N=C?`0 0 ${10*s}px rgba(249, 168, 212, 0.8)`:`0 0 ${15*s}px rgba(249, 168, 212, 1), 0 0 ${30*s}px rgba(244, 114, 182, 0.8), 0 0 ${60*s}px rgba(236, 72, 153, 0.5)`,J=j.enableGlowPulse?"glowPulse 2s ease-in-out infinite":"none";A.useEffect(()=>{const K={"fade-in":500,"leaders-enter":1200,nameplate:800,"vs-display":1500,"coin-toss":1500,"turn-order":1e3,"leader-to-orb":800,"orb-pause":1e3,"orb-fly":900,"leader-appear":600};if(p==="complete"){d==null||d();const ze=setTimeout(()=>{r()},700);return()=>clearTimeout(ze)}const Oe={"fade-in":"leaders-enter","leaders-enter":"nameplate",nameplate:"vs-display","vs-display":"coin-toss","coin-toss":"turn-order","turn-order":"leader-to-orb","leader-to-orb":"orb-pause","orb-pause":"orb-fly","orb-fly":"leader-appear","leader-appear":"complete"},_e=setTimeout(()=>{const ze=Oe[p];ze&&f(ze)},K[p]||1e3);return()=>clearTimeout(_e)},[p,r,n]),A.useEffect(()=>{if(p==="vs-display"){const K=setTimeout(()=>{R(!0),i==null||i(),setTimeout(()=>R(!1),300)},800);return()=>clearTimeout(K)}},[p,i]),A.useEffect(()=>{p==="coin-toss"&&(o==null||o())},[p,o]),A.useEffect(()=>{if(p==="leaders-enter"){const K=setTimeout(()=>{l==null||l()},1e3);return()=>clearTimeout(K)}},[p,l]),A.useEffect(()=>{p==="nameplate"&&(l==null||l())},[p,l]),A.useEffect(()=>{if(p==="leader-to-orb"){const Oe=Date.now();let _e;const ze=()=>{const Se=Date.now()-Oe,De=Math.min(Se/800,1),vt=1-Math.pow(1-De,3);v(1-vt*.7),h(1-vt),H(vt*1.5),W(Math.min(vt*1.5,1)),De<1&&(_e=requestAnimationFrame(ze))};return Ue(I),_e=requestAnimationFrame(ze),()=>cancelAnimationFrame(_e)}},[p,I]),A.useEffect(()=>{if(p==="orb-pause"){const Oe=Date.now();let _e;const ze=()=>{const Se=Date.now()-Oe,De=Math.min(Se/800,1);he(1-De),De<1&&(_e=requestAnimationFrame(ze))};return _e=requestAnimationFrame(ze),()=>cancelAnimationFrame(_e)}},[p]),A.useEffect(()=>{if(p==="orb-fly"){const Oe=Date.now();let _e;const ze=I.myX,Se=I.myY,De=I.opX,vt=I.opY,st=g.player.x,at=g.player.y,et=g.opponent.x,$e=g.opponent.y,nt=()=>{const mt=Date.now()-Oe,Ct=Math.min(mt/900,1),ne=Ct*Ct*Ct,Me=ze-200*s,Ye=(Se+at)/2+100*s,E=(1-ne)*(1-ne)*ze+2*(1-ne)*ne*Me+ne*ne*st,Ut=(1-ne)*(1-ne)*Se+2*(1-ne)*ne*Ye+ne*ne*at,ys=De+200*s,ha=(vt+$e)/2-100*s,pi=(1-ne)*(1-ne)*De+2*(1-ne)*ne*ys+ne*ne*et,fr=(1-ne)*(1-ne)*vt+2*(1-ne)*ne*ha+ne*ne*$e;Ue({myX:E,myY:Ut,opX:pi,opY:fr}),H(1.5-ne*1),Ct<1&&(_e=requestAnimationFrame(nt))};return _e=requestAnimationFrame(nt),()=>cancelAnimationFrame(_e)}},[p,I,g,s]),A.useEffect(()=>{if(p==="leader-appear"){const Oe=Date.now();let _e;c==null||c(),R(!0),setTimeout(()=>R(!1),300);const ze=g.player.x,Se=g.player.y,De=g.opponent.x,vt=g.opponent.y,st=24,at=[];for(let nt=0;nt<st;nt++){const mt=nt/st*360+(Math.random()-.5)*15;at.push({id:nt,x:ze,y:Se,angle:mt,dist:80+Math.random()*120,size:8+Math.random()*12,delay:Math.random()*.1,color:`hsl(${200+Math.random()*40}, 80%, ${60+Math.random()*20}%)`})}for(let nt=0;nt<st;nt++){const mt=nt/st*360+(Math.random()-.5)*15;at.push({id:st+nt,x:De,y:vt,angle:mt,dist:80+Math.random()*120,size:8+Math.random()*12,delay:Math.random()*.1,color:`hsl(${0+Math.random()*30}, 80%, ${55+Math.random()*20}%)`})}y(at);const et=setTimeout(()=>{y([])},800),$e=()=>{const nt=Date.now()-Oe,mt=Math.min(nt/600,1),Ct=1-Math.pow(1-mt,3);W(1-Ct),ie(Ct),T(Ct),mt<1&&(_e=requestAnimationFrame($e))};return _e=requestAnimationFrame($e),()=>{cancelAnimationFrame(_e),clearTimeout(et)}}},[p,c,g]);const U=["fade-in","leaders-enter","nameplate","vs-display","coin-toss","turn-order","leader-to-orb","orb-pause","orb-fly","leader-appear","complete"].indexOf(p),ve=U>=3&&U<=9,Re=U>=0&&U<=7,Ie=`polygon(0 0, ${50+rr}% 0, ${50-rr}% 100%, 0 100%)`,te=`polygon(${50+rr}% 0, 100% 0, 100% 100%, ${50-rr}% 100%)`;return a.jsxs("div",{style:{position:"fixed",inset:0,background:U>=7?"transparent":"#0a0a0f",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",animation:S?"screenShake 0.3s ease-in-out":void 0,pointerEvents:U>=9?"none":"auto"},children:[a.jsx("div",{style:{position:"absolute",inset:0,background:"black",opacity:p==="fade-in"?1:0,transition:"opacity 0.5s ease-out",pointerEvents:"none",zIndex:1e4}}),Re&&a.jsxs("div",{style:{opacity:Z,transition:"opacity 0.3s"},children:[U>=0&&a.jsxs("div",{style:{position:"absolute",inset:0,clipPath:Ie,background:"linear-gradient(135deg, #0a1628 0%, #1a2a4a 50%, #0d1a30 100%)",transform:`translateX(${U>=1?"0":"-100%"})`,transition:"transform 1.2s cubic-bezier(0.22, 1, 0.36, 1)",zIndex:50,overflow:"hidden"},children:[a.jsx("div",{style:{position:"fixed",top:"50%",left:"25%",transform:"translate(-50%, -50%)",opacity:w},children:a.jsx("img",{src:ad(t.class),alt:t.name,style:{height:"120vh",width:"auto",objectFit:"cover",objectPosition:t.class==="AJA"?"center top":"center",filter:"brightness(0.85) contrast(1.1)",transform:`scale(${_})`,transformOrigin:"center center"}})}),a.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(135deg, rgba(59, 130, 246, 0.3) 0%, transparent 60%)",pointerEvents:"none"}}),U>=2&&U<6&&a.jsx("div",{style:{position:"absolute",bottom:"12%",left:"15%",padding:`${16*s}px ${40*s}px`,background:"rgba(0,0,0,0.85)",borderRadius:8*s,borderLeft:"4px solid #3b82f6",animation:"nameplateSlideUp 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)",whiteSpace:"nowrap",boxShadow:"0 4px 30px rgba(59, 130, 246, 0.4)"},children:a.jsx("div",{style:{color:"white",fontSize:2.2*s+"rem",fontWeight:"bold",textShadow:"0 0 20px rgba(59, 130, 246, 0.8)"},children:t.name})}),U>=5&&U<6&&a.jsx("div",{style:{position:"absolute",top:"10%",left:"15%",padding:`${12*s}px ${32*s}px`,background:n?"rgba(239, 68, 68, 0.9)":"rgba(59, 130, 246, 0.9)",borderRadius:8*s,animation:"turnOrderFadeIn 1s ease-out",boxShadow:n?"0 0 30px rgba(239, 68, 68, 0.6)":"0 0 30px rgba(59, 130, 246, 0.6)"},children:a.jsx("div",{style:{color:"white",fontSize:1.8*s+"rem",fontWeight:"bold",letterSpacing:"0.1em"},children:n?"":""})})]}),U>=0&&a.jsxs("div",{style:{position:"absolute",inset:0,clipPath:te,background:"linear-gradient(225deg, #280a0a 0%, #4a1a1a 50%, #300d0d 100%)",transform:`translateX(${U>=1?"0":"100%"})`,transition:"transform 1.2s cubic-bezier(0.22, 1, 0.36, 1)",zIndex:50,overflow:"hidden"},children:[a.jsx("div",{style:{position:"fixed",top:"50%",left:"75%",transform:"translate(-50%, -50%)",opacity:w},children:a.jsx("img",{src:ad(e.class),alt:e.name,style:{height:"120vh",width:"auto",objectFit:"cover",objectPosition:e.class==="AJA"?"center top":"center",filter:"brightness(0.85) contrast(1.1)",transform:`scale(${_})`,transformOrigin:"center center"}})}),a.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(225deg, rgba(239, 68, 68, 0.3) 0%, transparent 60%)",pointerEvents:"none"}}),U>=2&&U<6&&a.jsx("div",{style:{position:"absolute",bottom:"12%",right:"15%",padding:`${16*s}px ${40*s}px`,background:"rgba(0,0,0,0.85)",borderRadius:8*s,borderRight:"4px solid #ef4444",animation:"nameplateSlideUp 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)",whiteSpace:"nowrap",boxShadow:"0 4px 30px rgba(239, 68, 68, 0.4)"},children:a.jsx("div",{style:{color:"white",fontSize:2.2*s+"rem",fontWeight:"bold",textShadow:"0 0 20px rgba(239, 68, 68, 0.8)"},children:e.name})}),U>=5&&U<6&&a.jsx("div",{style:{position:"absolute",top:"10%",right:"15%",padding:`${12*s}px ${32*s}px`,background:n?"rgba(59, 130, 246, 0.9)":"rgba(239, 68, 68, 0.9)",borderRadius:8*s,animation:"turnOrderFadeIn 1s ease-out",boxShadow:n?"0 0 30px rgba(59, 130, 246, 0.6)":"0 0 30px rgba(239, 68, 68, 0.6)"},children:a.jsx("div",{style:{color:"white",fontSize:1.8*s+"rem",fontWeight:"bold",letterSpacing:"0.1em"},children:n?"":""})})]}),U>=1&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{position:"absolute",top:0,left:0,width:4*s,height:"100%",background:"linear-gradient(180deg, #67e8f9 0%, #22d3ee 30%, #06b6d4 50%, #22d3ee 70%, #67e8f9 100%)",boxShadow:P,zIndex:100,animation:J}}),a.jsx("div",{style:{position:"absolute",top:0,left:0,width:`calc(${50+rr}% + ${2*s}px)`,height:4*s,background:"linear-gradient(90deg, #67e8f9 0%, #22d3ee 30%, #06b6d4 50%, #22d3ee 70%, #67e8f9 100%)",boxShadow:P,zIndex:100,animation:J}}),a.jsx("div",{style:{position:"absolute",bottom:0,left:0,width:`calc(${50-rr}% + ${2*s}px)`,height:4*s,background:"linear-gradient(90deg, #67e8f9 0%, #22d3ee 30%, #06b6d4 50%, #22d3ee 70%, #67e8f9 100%)",boxShadow:P,zIndex:100,animation:J}}),a.jsxs("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:100,pointerEvents:"none",overflow:"visible"},children:[a.jsxs("defs",{children:[a.jsxs("linearGradient",{id:"cyanGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[a.jsx("stop",{offset:"0%",stopColor:"#67e8f9"}),a.jsx("stop",{offset:"30%",stopColor:"#22d3ee"}),a.jsx("stop",{offset:"50%",stopColor:"#06b6d4"}),a.jsx("stop",{offset:"70%",stopColor:"#22d3ee"}),a.jsx("stop",{offset:"100%",stopColor:"#67e8f9"})]}),a.jsxs("filter",{id:"cyanGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{stdDeviation:j.blurAmount,result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),a.jsx("line",{x1:`${50+rr-.2}%`,y1:"0",x2:`${50-rr-.2}%`,y2:"100%",stroke:"url(#cyanGradient)",strokeWidth:4*s,filter:C?void 0:"url(#cyanGlow)",style:{animation:J}})]})]}),U>=1&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{position:"absolute",top:0,right:0,width:4*s,height:"100%",background:"linear-gradient(180deg, #f9a8d4 0%, #f472b6 30%, #ec4899 50%, #f472b6 70%, #f9a8d4 100%)",boxShadow:N,zIndex:100,animation:J,animationDelay:"0.3s"}}),a.jsx("div",{style:{position:"absolute",top:0,right:0,width:`calc(${50-rr}% + ${2*s}px)`,height:4*s,background:"linear-gradient(90deg, #f9a8d4 0%, #f472b6 30%, #ec4899 50%, #f472b6 70%, #f9a8d4 100%)",boxShadow:N,zIndex:100,animation:J,animationDelay:"0.3s"}}),a.jsx("div",{style:{position:"absolute",bottom:0,right:0,width:`calc(${50+rr}% + ${2*s}px)`,height:4*s,background:"linear-gradient(90deg, #f9a8d4 0%, #f472b6 30%, #ec4899 50%, #f472b6 70%, #f9a8d4 100%)",boxShadow:N,zIndex:100,animation:J,animationDelay:"0.3s"}}),a.jsxs("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:100,pointerEvents:"none",overflow:"visible"},children:[a.jsxs("defs",{children:[a.jsxs("linearGradient",{id:"pinkGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[a.jsx("stop",{offset:"0%",stopColor:"#f9a8d4"}),a.jsx("stop",{offset:"30%",stopColor:"#f472b6"}),a.jsx("stop",{offset:"50%",stopColor:"#ec4899"}),a.jsx("stop",{offset:"70%",stopColor:"#f472b6"}),a.jsx("stop",{offset:"100%",stopColor:"#f9a8d4"})]}),a.jsxs("filter",{id:"pinkGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{stdDeviation:j.blurAmount,result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),a.jsx("line",{x1:`${50+rr+.2}%`,y1:"0",x2:`${50-rr+.2}%`,y2:"100%",stroke:"url(#pinkGradient)",strokeWidth:4*s,filter:C?void 0:"url(#pinkGlow)",style:{animation:J,animationDelay:"0.3s"}})]})]})]}),U>=6&&U<=9&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{position:"fixed",left:xe.myX,top:xe.myY,transform:`translate(-50%, -50%) scale(${D})`,opacity:re,width:150*s,height:150*s,borderRadius:"50%",background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(100,180,255,0.8) 40%, rgba(59,130,246,0.4) 70%, transparent 100%)",boxShadow:C?`0 0 ${30*s}px rgba(59, 130, 246, 0.8)`:`0 0 ${40*s}px rgba(255,255,255,0.9), 0 0 ${80*s}px rgba(59, 130, 246, 0.8), 0 0 ${120*s}px rgba(59, 130, 246, 0.5)`,zIndex:500,pointerEvents:"none"}}),a.jsx("div",{style:{position:"fixed",left:xe.opX,top:xe.opY,transform:`translate(-50%, -50%) scale(${D})`,opacity:re,width:150*s,height:150*s,borderRadius:"50%",background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(255,150,150,0.8) 40%, rgba(239,68,68,0.4) 70%, transparent 100%)",boxShadow:C?`0 0 ${30*s}px rgba(239, 68, 68, 0.8)`:`0 0 ${40*s}px rgba(255,255,255,0.9), 0 0 ${80*s}px rgba(239, 68, 68, 0.8), 0 0 ${120*s}px rgba(239, 68, 68, 0.5)`,zIndex:500,pointerEvents:"none"}})]}),U>=9&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{position:"fixed",left:g.player.x,top:g.player.y,transform:`translate(-50%, -50%) scale(${de})`,opacity:O,width:g.leaderSize,height:g.leaderSize,borderRadius:"50%",overflow:"hidden",border:"4px solid #3182ce",boxShadow:"0 0 20px rgba(49, 130, 206, 0.4)",background:"#1a202c",zIndex:500,pointerEvents:"none"},children:a.jsx("img",{src:ad(t.class),alt:t.name,style:{width:"100%",height:"100%",objectFit:"cover",objectPosition:t.class==="AJA"?"center top":"center"}})}),a.jsx("div",{style:{position:"fixed",left:g.opponent.x,top:g.opponent.y,transform:`translate(-50%, -50%) scale(${de})`,opacity:O,width:g.leaderSize,height:g.leaderSize,borderRadius:"50%",overflow:"hidden",border:"4px solid #c53030",boxShadow:"0 0 20px rgba(197, 48, 48, 0.4)",background:"#1a202c",zIndex:500,pointerEvents:"none"},children:a.jsx("img",{src:ad(e.class),alt:e.name,style:{width:"100%",height:"100%",objectFit:"cover",objectPosition:e.class==="AJA"?"center top":"center"}})})]}),k.map(K=>a.jsx("div",{style:{position:"fixed",left:K.x,top:K.y,width:K.size*s,height:K.size*s,borderRadius:"50%",background:K.color,boxShadow:`0 0 ${K.size*.5*s}px ${K.color}`,pointerEvents:"none",zIndex:600,animation:`landingParticleBurst 0.6s ease-out ${K.delay}s forwards`,transform:"translate(-50%, -50%)","--particle-angle":`${K.angle}deg`,"--particle-dist":`${K.dist*s}px`}},K.id)),ve&&a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",animation:U===3?"vsZoomIn 1.5s cubic-bezier(0.34, 1.56, 0.64, 1)":void 0,opacity:U>=7?Math.max(0,Z):1,zIndex:200,pointerEvents:"none"},children:a.jsx("img",{src:qL,alt:"VS",style:{height:300*s,width:"auto",filter:`drop-shadow(0 0 ${20*s}px rgba(255,255,255,0.8)) drop-shadow(0 0 ${40*s}px rgba(255,255,255,0.6))`}})}),U>=4&&U<5&&a.jsx("div",{style:{position:"absolute",top:"20%",left:"50%",transform:"translate(-50%, -50%)",zIndex:150},children:a.jsx("div",{style:{width:100*s,height:100*s,borderRadius:"50%",background:"linear-gradient(45deg, #f6ad55 0%, #fbd38d 100%)",border:"4px solid white",display:"flex",alignItems:"center",justifyContent:"center",fontSize:2*s+"rem",fontWeight:"bold",color:"white",animation:"coinFlip 1.5s ease-in-out",boxShadow:`0 0 ${30*s}px rgba(246, 173, 85, 0.8)`},children:""})}),a.jsx("style",{children:`
                @keyframes screenShake {
                    0%, 100% { transform: translate(0, 0); }
                    10% { transform: translate(-10px, -10px); }
                    20% { transform: translate(10px, 10px); }
                    30% { transform: translate(-10px, 10px); }
                    40% { transform: translate(10px, -10px); }
                    50% { transform: translate(-10px, -10px); }
                    60% { transform: translate(10px, 10px); }
                    70% { transform: translate(-10px, 10px); }
                    80% { transform: translate(10px, -10px); }
                    90% { transform: translate(-10px, 0); }
                }

                @keyframes nameplateSlideUp {
                    0% {
                        transform: translateY(50px);
                        opacity: 0;
                    }
                    60% {
                        transform: translateY(-10px);
                    }
                    100% {
                        transform: translateY(0);
                        opacity: 1;
                    }
                }

                @keyframes vsZoomIn {
                    0% {
                        transform: translate(-50%, -50%) scale(3) translateZ(0);
                        opacity: 0;
                        filter: blur(20px);
                    }
                    50% {
                        transform: translate(-50%, -50%) scale(1.2) translateZ(0);
                        opacity: 1;
                        filter: blur(0px);
                    }
                    100% {
                        transform: translate(-50%, -50%) scale(1) translateZ(0);
                        opacity: 1;
                        filter: blur(0px);
                    }
                }

                @keyframes coinFlip {
                    0% {
                        transform: rotateY(0deg) scale(1);
                    }
                    50% {
                        transform: rotateY(1800deg) scale(1.2);
                    }
                    100% {
                        transform: rotateY(3600deg) scale(1);
                    }
                }

                @keyframes turnOrderFadeIn {
                    0% {
                        opacity: 0;
                        transform: scale(0.5);
                    }
                    50% {
                        transform: scale(1.2);
                    }
                    100% {
                        opacity: 1;
                        transform: scale(1);
                    }
                }

                @keyframes glowPulse {
                    0%, 100% {
                        opacity: 0.8;
                        filter: brightness(1);
                    }
                    50% {
                        opacity: 1;
                        filter: brightness(1.3);
                    }
                }

                @keyframes landingParticleBurst {
                    0% {
                        transform: translate(-50%, -50%) rotate(var(--particle-angle)) translateX(0);
                        opacity: 1;
                    }
                    100% {
                        transform: translate(-50%, -50%) rotate(var(--particle-angle)) translateX(var(--particle-dist));
                        opacity: 0;
                    }
                }
            `})]})},e3=({isVictory:t,loserLeaderRef:e,onComplete:n,onPhaseChange:r,onShakeIntensityChange:s,scale:i=1})=>{const[o,l]=A.useState("start"),[c,d]=A.useState(null),[u,p]=A.useState([]);A.useEffect(()=>{if(e.current){const S=e.current.getBoundingClientRect();d({x:S.left+S.width/2,y:S.top+S.height/2,size:S.width})}},[e]),A.useEffect(()=>{r==null||r(o)},[o,r]),A.useEffect(()=>{const S={start:200,zoom:600,"white-fade":800,explode:1200,"result-text":1800,"fade-out":600};if(o==="complete"){n();return}const R={start:"zoom",zoom:"white-fade","white-fade":"explode",explode:"result-text","result-text":"fade-out","fade-out":"complete"},C=setTimeout(()=>{const j=R[o];j&&l(j)},S[o]||1e3);return()=>clearTimeout(C)},[o,n]),A.useEffect(()=>{if(o==="explode"&&c){const R=Array.from({length:60},(v,w)=>{const h=w/60*360,D=(Math.random()-.5)*12,H=h+D,re=150+Math.random()*250,W=12+Math.random()*20;return{id:w,x:c.x,y:c.y,angle:H,distance:re,size:W,delay:Math.random()*.1,duration:.6+Math.random()*.4}});p(R),s==null||s(1);const C=1e3,j=Date.now(),_=setInterval(()=>{const w=(Date.now()-j)/C;if(w>=1)s==null||s(0),clearInterval(_);else{const h=1-Math.pow(w,2);s==null||s(h)}},16);return()=>clearInterval(_)}},[o,c,s]);const f=["start","zoom","white-fade","explode","result-text","fade-out","complete"].indexOf(o);return c?a.jsxs("div",{style:{position:"fixed",inset:0,zIndex:8e3,pointerEvents:"none",overflow:"hidden"},children:[a.jsx("div",{style:{position:"absolute",inset:0,background:"black",opacity:f>=1?f>=5?1:.5:0,transition:"opacity 0.5s ease-out"}}),f>=1&&f<4&&a.jsx("div",{style:{position:"absolute",left:c.x,top:c.y,transform:"translate(-50%, -50%)",width:c.size*1.8,height:c.size*1.8,borderRadius:"50%",background:"radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 60%)",transition:"all 0.4s ease-out"}}),f>=3&&u.map(S=>a.jsx("div",{style:{position:"absolute",left:S.x,top:S.y,width:S.size*i,height:S.size*i,borderRadius:"50%",background:"white",boxShadow:"0 0 15px white, 0 0 30px rgba(255,255,255,0.5)",transform:"translate(-50%, -50%)",animation:`particleFly-${S.id} ${S.duration}s ease-out ${S.delay}s forwards`}},S.id)),f>=3&&a.jsx("style",{children:u.map(S=>{const R=S.angle*Math.PI/180,C=Math.cos(R)*S.distance,j=Math.sin(R)*S.distance;return`
                            @keyframes particleFly-${S.id} {
                                0% {
                                    transform: translate(-50%, -50%) scale(1);
                                    opacity: 1;
                                }
                                100% {
                                    transform: translate(calc(-50% + ${C}px), calc(-50% + ${j}px)) scale(0);
                                    opacity: 0;
                                }
                            }
                        `}).join(`
`)}),f>=4&&f<6&&a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",animation:"resultTextPop 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)"},children:a.jsx("div",{style:{fontSize:`${7*i}rem`,fontWeight:900,fontFamily:"Tamanegi, sans-serif",color:t?"#ffd700":"#718096",textShadow:t?"0 0 30px rgba(255,215,0,0.8), 0 0 60px rgba(255,215,0,0.6), 0 0 90px rgba(255,215,0,0.4), 4px 4px 8px rgba(0,0,0,0.8)":"0 0 20px rgba(113,128,150,0.5), 4px 4px 8px rgba(0,0,0,0.8)",letterSpacing:"0.15em"},children:t?"":"..."})}),a.jsx("style",{children:`
                @keyframes resultTextPop {
                    0% {
                        transform: translate(-50%, -50%) scale(2.5);
                        opacity: 0;
                        filter: blur(20px);
                    }
                    60% {
                        transform: translate(-50%, -50%) scale(0.95);
                        opacity: 1;
                        filter: blur(0px);
                    }
                    100% {
                        transform: translate(-50%, -50%) scale(1);
                        opacity: 1;
                        filter: blur(0px);
                    }
                }
            `})]}):null},t3=({isMyTurn:t,turnCount:e,activePlayerId:n,onTimeUp:r,timerEnabled:s,isGameOver:i=!1,isPaused:o=!1,scale:l=1,buttonSize:c=160,timerDuration:d=60})=>{const[u,p]=A.useState(d),[f,S]=A.useState(!1),[R,C]=A.useState(!1),j=A.useRef(null),_=A.useRef(""),v=A.useRef(0),w=A.useRef(r),h=A.useRef(!1),D=A.useId().replace(/:/g,"_");A.useEffect(()=>{w.current=r},[r]);const H=`${e}-${n}`,re=A.useCallback(()=>{p(d),S(!1),C(!1),v.current=Date.now()+d*1e3,h.current=!1},[d]);if(A.useEffect(()=>{H!==_.current&&(_.current=H,re())},[H,re]),A.useEffect(()=>{if(!s||!t||i||o){j.current&&(clearInterval(j.current),j.current=null);return}return v.current===0&&(v.current=Date.now()+d*1e3),j.current=window.setInterval(()=>{const g=Date.now(),I=Math.max(0,(v.current-g)/1e3);p(I);const P=Math.ceil(I);P<=15&&P>10?(S(!0),C(!1)):P<=10?(S(!0),C(!0)):(S(!1),C(!1)),I<=0&&!h.current&&(h.current=!0,j.current&&(clearInterval(j.current),j.current=null),setTimeout(()=>w.current(),0))},16),()=>{j.current&&(clearInterval(j.current),j.current=null)}},[s,t,i,o,d]),!s||o)return null;const W=u/d,Z=(c/2+12)*l,he=6*l,xe=2*Math.PI*Z,Ue=-xe*(1-W),de=Math.ceil(u),ie=R?Math.min(1,(10-de)/10):0,O=Math.max(.05,.15-ie*.1);let T="#4299e1";f&&!R?T="#f6ad55":R&&(T="#e53e3e");const k=20*l,y=Z*2+he+k*2;return a.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:y,height:y,pointerEvents:"none",zIndex:10,animation:R?`timerShake${D} ${O}s ease-in-out infinite`:void 0},children:[a.jsxs("svg",{width:y,height:y,style:{position:"absolute",top:0,left:0,overflow:"visible"},children:[a.jsx("circle",{cx:y/2,cy:y/2,r:Z,fill:"none",stroke:"rgba(0,0,0,0.3)",strokeWidth:he}),a.jsx("circle",{cx:y/2,cy:y/2,r:Z,fill:"none",stroke:T,strokeWidth:he,strokeLinecap:"round",strokeDasharray:xe,strokeDashoffset:Ue,style:{transform:"rotate(-90deg)",transformOrigin:"center"}}),f&&a.jsx("circle",{cx:y/2,cy:y/2,r:Z,fill:"none",stroke:T,strokeWidth:he*3,opacity:.4,style:{filter:`blur(${12*l}px)`,animation:R?`timerPulse${D} 0.5s ease-in-out infinite`:`timerPulse${D} 1s ease-in-out infinite`}})]}),a.jsx("style",{children:`
                @keyframes timerPulse${D} {
                    0%, 100% { opacity: 0.4; }
                    50% { opacity: 0.7; }
                }
                @keyframes timerShake${D} {
                    0%, 100% { transform: translate(-50%, -50%) translate(0, 0); }
                    25% { transform: translate(-50%, -50%) translate(${2*l}px, ${-2*l}px); }
                    50% { transform: translate(-50%, -50%) translate(${-2*l}px, ${2*l}px); }
                    75% { transform: translate(-50%, -50%) translate(${2*l}px, ${1*l}px); }
                }
            `})]})};function n3(t,e){const[n,r]=A.useState(null),[s,i]=A.useState(""),[o,l]=A.useState(!1),[c,d]=A.useState(null),[u,p]=A.useState(!1);return A.useEffect(()=>{if(t==="CPU")return;const f=new d2;return p(!0),(async()=>{try{const R=await f.connect(t==="JOIN"?e:void 0);i(R),r(f),f.onConnection(()=>{console.log("[useGameNetwork] Connection established!"),l(!0),p(!1)})}catch(R){d(R.toString()),p(!1)}})(),()=>{f.disconnect()}},[t,e]),{adapter:n,myId:s,connected:o,connecting:u,error:c,setConnected:l}}function $x(t,e,n){return!(!t.canEvolveThisTurn||t.evolutionsUsed>=2||e<(n?5:4))}function Fx(t,e,n){return!(!t.canEvolveThisTurn||t.sep<=0||e<(n?7:6))}const it=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},r3=it("/leaders/azya_leader.png"),s3=it("/leaders/senka_leader.png"),i3=it("/leaders/yoRuka_leader.png"),o3=it("/sleeves/azya_sleeve.png"),a3=it("/sleeves/senka_sleeve.png"),l3=it("/sleeves/yoruka_sleeve.png"),ul=t=>t==="YORUKA"?i3:t==="AJA"?r3:s3,xi=t=>t==="YORUKA"?l3:t==="AJA"?o3:a3,c3=1920,f2=1080,d3=()=>{const[t,e]=A.useState({scale:1,toGameX:r=>r,toGameY:r=>r}),n=A.useCallback(()=>{const r=window.visualViewport?window.visualViewport.width:window.innerWidth,s=window.visualViewport?window.visualViewport.height:window.innerHeight;let i=Math.min(r/c3,s/f2);i*=1.5,e({scale:i,toGameX:c=>c,toGameY:c=>c})},[]);return A.useEffect(()=>{n(),window.addEventListener("resize",n),window.addEventListener("orientationchange",()=>{setTimeout(n,150)}),window.visualViewport&&window.visualViewport.addEventListener("resize",n);const r=()=>{document.visibilityState==="visible"&&setTimeout(n,100)};return document.addEventListener("visibilitychange",r),()=>{window.removeEventListener("resize",n),window.removeEventListener("orientationchange",n),window.visualViewport&&window.visualViewport.removeEventListener("resize",n),document.removeEventListener("visibilitychange",r)}},[n]),t},fn=90,Tn=120,_i=fn+18,po=240,u3=({x:t,y:e,onComplete:n,scale:r=1})=>{F.useEffect(()=>{const i=setTimeout(n,2e3);return()=>clearTimeout(i)},[n]);const s=F.useMemo(()=>Array(20).fill(0).map((i,o)=>({id:o,angle:Math.random()*360,dist:(30+Math.random()*60)*r,size:(10+Math.random()*15)*r,delay:Math.random()*.5})),[r]);return a.jsxs("div",{style:{position:"absolute",left:t,top:e,pointerEvents:"none",zIndex:6e3},children:[a.jsx("style",{children:`
                @keyframes healGlowFade {
                    0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; filter: blur(10px); }
                    30% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.8; filter: blur(15px); }
                    100% { transform: translate(-50%, -50%) scale(1.6); opacity: 0; filter: blur(30px); }
                }
                @keyframes healParticleRise {
                    0% { transform: translate(-50%, -50%) rotate(var(--angle)) translate(0, 0) scale(0); opacity: 0; }
                    20% { transform: translate(-50%, -50%) rotate(var(--angle)) translate(0, 0) opacity: 0.7; }
                    100% { transform: translate(-50%, -50%) rotate(var(--angle)) translate(calc(var(--dist) * 1px), 0) scale(1.5); opacity: 0; }
                }
            `}),a.jsx("div",{style:{position:"absolute",left:0,top:0,width:150*r,height:150*r,background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(200,255,240,0.5) 50%, transparent 80%)",borderRadius:"50%",transform:"translate(-50%, -50%)",animation:"healGlowFade 1.5s ease-out forwards",filter:`blur(${8*r}px)`}}),s.map(i=>a.jsx("div",{style:{position:"absolute",left:0,top:0,width:i.size,height:i.size,background:"rgba(255,250,240,0.6)",borderRadius:"50%",filter:`blur(${4*r}px)`,"--angle":`${i.angle}deg`,"--dist":i.dist,animation:`healParticleRise 1.2s ease-out ${i.delay}s forwards`,pointerEvents:"none"}},i.id))]})},f3=({x:t,y:e,atkBuff:n,hpBuff:r,onComplete:s})=>{F.useEffect(()=>{const S=setTimeout(s,1500);return()=>clearTimeout(S)},[s]);const i=n<0||r<0,o=i?"radial-gradient(circle, rgba(180,50,50,0.9) 0%, rgba(150,30,30,0.4) 50%, transparent 80%)":"radial-gradient(circle, rgba(255,230,100,0.9) 0%, rgba(255,200,50,0.4) 50%, transparent 80%)",l=i?"#ff4444":"#ffd93d",c="#ffd93d",d="rgba(255,217,61,0.8)",u=S=>S>=0?`+${S}`:`${S}`,p=80,f=110;return a.jsxs("div",{style:{position:"absolute",left:t,top:e,pointerEvents:"none",zIndex:6e3},children:[a.jsx("style",{children:`
                @keyframes buffGlow {
                    0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
                    30% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
                    100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
                }
                @keyframes buffNumberRise {
                    0% { transform: translateY(0); opacity: 0; }
                    20% { opacity: 1; }
                    100% { transform: translateY(-30px); opacity: 0; }
                }
                @keyframes buffSparkle {
                    0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
                    50% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
                    100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
                }
            `}),a.jsx("div",{style:{position:"absolute",left:0,top:0,width:150,height:150,background:o,borderRadius:"50%",transform:"translate(-50%, -50%)",animation:"buffGlow 1.2s ease-out forwards",filter:"blur(8px)"}}),n!==0&&a.jsx("div",{style:{position:"absolute",left:-p/2+12,top:f/2-20,fontSize:"24px",fontWeight:"bold",color:c,textShadow:`0 0 10px ${d}, 2px 2px 4px rgba(0,0,0,0.8)`,fontFamily:"Tamanegi, sans-serif",animation:"buffNumberRise 1.2s ease-out forwards",textAlign:"center"},children:u(n)}),r!==0&&a.jsx("div",{style:{position:"absolute",left:p/2-28,top:f/2-20,fontSize:"24px",fontWeight:"bold",color:c,textShadow:`0 0 10px ${d}, 2px 2px 4px rgba(0,0,0,0.8)`,fontFamily:"Tamanegi, sans-serif",animation:"buffNumberRise 1.2s ease-out forwards",textAlign:"center"},children:u(r)}),[...Array(8)].map((S,R)=>a.jsx("div",{style:{position:"absolute",left:Math.cos(R*Math.PI/4)*60,top:Math.sin(R*Math.PI/4)*60,width:12,height:12,background:l,borderRadius:"50%",boxShadow:`0 0 10px ${l}, 0 0 20px ${l}`,animation:`buffSparkle 0.8s ease-out ${R*.1}s forwards`}},R))]})},h3=({x:t,y:e,onComplete:n,scale:r=1})=>(F.useEffect(()=>{const s=setTimeout(n,1200);return()=>clearTimeout(s)},[n]),a.jsxs("div",{style:{position:"absolute",left:t,top:e,transform:"translate(-50%, -50%)",width:130*r,height:130*r,pointerEvents:"none",zIndex:5e3,display:"flex",alignItems:"center",justifyContent:"center"},children:[a.jsx("div",{style:{fontSize:`${80*r}px`,animation:"baneSkullAppear 1.2s ease-out forwards",textShadow:`0 0 ${20*r}px #9b59b6, 0 0 ${40*r}px #8e44ad, 0 0 ${60*r}px #6c3483`,filter:`drop-shadow(0 0 ${15*r}px #9b59b6) hue-rotate(-10deg)`},children:""}),[...Array(12)].map((s,i)=>a.jsx("div",{style:{position:"absolute",left:"50%",top:"50%",width:6*r,height:6*r,background:"radial-gradient(circle, #9b59b6, #6c3483)",borderRadius:"50%",boxShadow:`0 0 ${8*r}px #9b59b6, 0 0 ${15*r}px #8e44ad`,animation:`baneParticle 1s ease-out ${i*.08}s forwards`,transform:`rotate(${i*30}deg) translateX(0)`}},i)),a.jsx("style",{children:`
                @keyframes baneSkullAppear {
                    0% { transform: scale(0) rotate(-30deg); opacity: 0; }
                    20% { transform: scale(1.3) rotate(10deg); opacity: 1; }
                    40% { transform: scale(1) rotate(-5deg); opacity: 1; }
                    60% { transform: scale(1.1) rotate(0deg); opacity: 1; }
                    80% { transform: scale(1) rotate(0deg); opacity: 0.8; }
                    100% { transform: scale(1.5) rotate(0deg); opacity: 0; }
                }
                @keyframes baneParticle {
                    0% { transform: rotate(0deg) translateX(0); opacity: 1; }
                    100% { transform: rotate(0deg) translateX(${70*r}px); opacity: 0; }
                }
            `})]})),p3=({type:t,x:e,y:n,onComplete:r,audioSettings:s,scale:i=1})=>{const o=F.useMemo(()=>{let f=8,S=8,R=100,C=256;return t==="SHOT"&&(C=128),{cols:f,rows:S,fps:R,size:C}},[t]);if(F.useEffect(()=>{const S=["LIGHTNING","THUNDER","IMPACT","SUMI","SHOT","ICE","WATER","RAY","FIRE","SLASH","BLUE_FIRE"].includes(t)?o.cols*o.rows/o.fps*1e3:t==="FIREBALL"?500:t==="HEAL"?2e3:400,R=setTimeout(r,S);return()=>clearTimeout(R)},[r,t,o]),F.useEffect(()=>{if(!s||!s.seEnabled)return;const f=(S,R=.5,C=0)=>{setTimeout(()=>{const j=new Audio(it(`/se/${S}`));j.volume=(s.se||.5)*R,j.play().catch(_=>console.warn("SE Play prevented",_))},C)};t==="SHOT"?(f("shot.mp3",.6),f("hibi.mp3",.4,400)):t==="IMPACT"?(f("panch1.mp3",.6,100),f("panch2.mp3",.6,500)):t==="LIGHTNING"||t==="THUNDER"?f("thunder.mp3",.5):t==="FIREBALL"?f("explosion.mp3",.5):t==="FIRE"?f("fire.mp3",.5):t==="SLASH"?f("slash.mp3",.5):t==="ICE"?f("ice.mp3",.5):t==="WATER"?f("water.mp3",.5):t==="RAY"?f("ray.mp3",.6):t==="SUMI"?f("yami.mp3",.6):t==="HEAL"?f("heal.mp3",.6):t==="BLUE_FIRE"?f("fire.mp3",.5):t==="BANE"&&f("yami.mp3",.7)},[t,s]),t==="HEAL")return a.jsx(u3,{x:e,y:n,onComplete:r,scale:i});if(t==="BANE")return a.jsx(h3,{x:e,y:n,onComplete:r,scale:i});const l=100*i,c={position:"absolute",left:e,top:n,transform:"translate(-50%, -50%)",width:l,height:l,pointerEvents:"none",zIndex:5e3,display:"flex",alignItems:"center",justifyContent:"center"};if(["LIGHTNING","THUNDER","IMPACT","SUMI","SHOT","ICE","WATER","RAY","FIRE","SLASH","BLUE_FIRE"].includes(t)){let f=it("/effects/thunder.png");t==="IMPACT"&&(f=it("/effects/impact.png")),t==="SUMI"&&(f=it("/effects/sumi.png")),t==="SHOT"&&(f=it("/effects/shot.png")),t==="ICE"&&(f=it("/effects/ice.png")),t==="WATER"&&(f=it("/effects/water.png")),t==="RAY"&&(f=it("/effects/ray.png")),t==="FIRE"&&(f=it("/effects/fire.png")),t==="SLASH"&&(f=it("/effects/slash.png")),t==="BLUE_FIRE"&&(f=it("/effects/blue_fire.png"));const S=o.cols*o.rows,R=Math.min(160,o.size)*i;return a.jsxs("div",{style:{...c,width:R,height:R,transform:`${(c==null?void 0:c.transform)||""}`},children:[a.jsx("div",{style:{width:"100%",height:"100%",backgroundImage:`url(${f})`,backgroundSize:`${o.cols*100}% ${o.rows*100}%`,animation:`spriteAnimation ${S/o.fps}s steps(1) forwards`}}),a.jsx("style",{children:`
                    @keyframes spriteAnimation {
                        ${Array.from({length:S}).map((C,j)=>{const _=j%o.cols,v=Math.floor(j/o.cols),w=_*(100/(o.cols-1)),h=v*(100/(o.rows-1));return`${j/(S-1)*100}% { background-position: ${w}% ${h}%; }`}).join(`
`)}
                    }
                `})]})}let u="",p="";if(t==="FIREBALL")u=it("/effects/fireball.png"),p="explode 0.5s ease-out forwards";else if(t==="BEAM")return a.jsx("div",{style:{position:"fixed",left:e,top:n,width:400,height:30,background:"linear-gradient(90deg, transparent, #faf089, #fff, #faf089, transparent)",transform:"translate(-50%, -50%) rotate(-45deg)",boxShadow:"0 0 20px #faf089",opacity:0,animation:"beamShoot 0.4s ease-out forwards",pointerEvents:"none",zIndex:5e3},children:a.jsx("style",{children:`
                    @keyframes beamShoot {
                        0% { width: 0; opacity: 1; transform: translate(-50%, -50%) rotate(-45deg) scaleX(0); }
                        20% { width: 400px; opacity: 1; transform: translate(-50%, -50%) rotate(-45deg) scaleX(1); }
                        100% { width: 400px; opacity: 0; transform: translate(-50%, -50%) rotate(-45deg) scaleX(1.2); }
                    }
                `})});return u?a.jsxs("div",{style:c,children:[a.jsx("img",{src:u,style:{width:"100%",height:"100%",objectFit:"contain",animation:p}}),a.jsx("style",{children:`
                @keyframes explode { 0% { transform: scale(0.5); opacity: 0; } 20% { opacity: 1; } 100% { transform: scale(2); opacity: 0; } }
            `})]}):null},g3=({value:t,x:e,y:n,color:r,onComplete:s,scale:i=1})=>{F.useEffect(()=>{const d=setTimeout(s,1200);return()=>clearTimeout(d)},[s]);const o=r==="#48bb78",l=r||"#e53e3e",c=o?"linear-gradient(180deg, #68d391 0%, #38a169 50%, #276749 100%)":"linear-gradient(180deg, #fc8181 0%, #e53e3e 50%, #c53030 100%)";return a.jsxs("div",{style:{position:"absolute",left:e,top:n,transform:"translate(-50%, -50%)",pointerEvents:"none",zIndex:6e3,fontSize:`${4*i}rem`,fontWeight:"900",fontFamily:'"Impact", "Arial Black", sans-serif',letterSpacing:`${-2*i}px`,background:c,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",filter:`drop-shadow(0 0 ${8*i}px ${l}) drop-shadow(0 ${2*i}px ${4*i}px rgba(0,0,0,0.8))`,animation:"floatUp 1.2s ease-out forwards"},children:[t,a.jsx("style",{children:`
                @keyframes floatUp {
                    0% { transform: translate(-50%, -50%) scale(0.3); opacity: 0; }
                    15% { transform: translate(-50%, -70%) scale(1.8); opacity: 1; }
                    30% { transform: translate(-50%, -90%) scale(1.4); opacity: 1; }
                    100% { transform: translate(-50%, -180%) scale(1); opacity: 0; }
                }
            `})]})},m3=({x:t,y:e})=>{const n=F.useMemo(()=>Array(16).fill(0).map((r,s)=>({id:s,angle:Math.random()*360,dist:60+Math.random()*120,size:4+Math.random()*8,delay:Math.random()*.3,color:Math.random()>.5?"#f6e05e":"#ffffff"})),[]);return a.jsxs("div",{style:{position:"absolute",left:t,top:e,pointerEvents:"none",zIndex:6e3},children:[a.jsx("style",{children:`
                @keyframes sparkleMove {
                    0% { transform: rotate(var(--angle)) translate(0, 0) scale(0); opacity: 0; }
                    20% { opacity: 1; transform: rotate(var(--angle)) translate(calc(var(--dist) * 0.2px), 0) scale(1.5); }
                    100% { transform: rotate(var(--angle)) translate(calc(var(--dist) * 1px), 0) scale(0); opacity: 0; }
                }
            `}),n.map(r=>a.jsx("div",{style:{position:"absolute",left:0,top:0,width:r.size,height:r.size,background:r.color,borderRadius:"50%",boxShadow:`0 0 10px ${r.color}, 0 0 20px ${r.color}`,"--angle":`${r.angle}deg`,"--dist":r.dist,animation:`sparkleMove 0.8s ease-out ${r.delay}s forwards`,pointerEvents:"none"}},r.id))]})},y3=({onClose:t})=>a.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(0,0,0,0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:t,children:a.jsxs("div",{style:{background:"linear-gradient(135deg, #1a202c 0%, #2d3748 100%)",borderRadius:16,padding:30,maxWidth:700,maxHeight:"80vh",overflowY:"auto",color:"#fff",boxShadow:"0 20px 60px rgba(0,0,0,0.5)",border:"1px solid #4a5568"},onClick:e=>e.stopPropagation(),children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[a.jsx("h2",{style:{margin:0,color:"#63b3ed"},children:""}),a.jsx("button",{onClick:t,style:{background:"transparent",border:"none",color:"#a0aec0",fontSize:"1.5rem",cursor:"pointer"},children:""})]}),a.jsxs("section",{style:{marginBottom:25},children:[a.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),a.jsxs("ul",{style:{lineHeight:1.8,paddingLeft:20,color:"#e2e8f0"},children:[a.jsx("li",{children:"0"}),a.jsx("li",{children:"1PP110"}),a.jsx("li",{children:"PP"}),a.jsx("li",{children:""}),a.jsx("li",{children:"5"}),a.jsx("li",{children:"910"})]})]}),a.jsxs("section",{style:{marginBottom:25},children:[a.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[a.jsxs("div",{children:[a.jsx("span",{style:{color:"#48bb78",fontWeight:"bold"},children:"[]"}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#ed8936",fontWeight:"bold"},children:"[]"}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#4299e1",fontWeight:"bold"},children:"[]"}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#9f7aea",fontWeight:"bold"},children:"[]"}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#f56565",fontWeight:"bold"},children:"[]"}),"12"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#38b2ac",fontWeight:"bold"},children:"[]"}),"1"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#718096",fontWeight:"bold"},children:"[]"}),"AoE"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#d69e2e",fontWeight:"bold"},children:"[]"}),"AoE"]})]})]}),a.jsxs("section",{style:{marginBottom:25},children:[a.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[a.jsxs("div",{children:[a.jsx("span",{style:{color:"#63b3ed",fontWeight:"bold"},children:""}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#f687b3",fontWeight:"bold"},children:""}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#faf089",fontWeight:"bold"},children:""}),"EP"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#b794f4",fontWeight:"bold"},children:""}),"SEP"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#68d391",fontWeight:"bold"},children:""}),""]})]})]}),a.jsxs("section",{style:{marginBottom:25},children:[a.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),a.jsxs("ul",{style:{lineHeight:1.8,paddingLeft:20,color:"#e2e8f0"},children:[a.jsxs("li",{children:[a.jsx("span",{style:{color:"#faf089"},children:"EP"}),"54112"]}),a.jsxs("li",{children:[a.jsx("span",{style:{color:"#b794f4"},children:"SEP"}),"76112"]}),a.jsx("li",{children:"1111"}),a.jsx("li",{children:"+2/+2"}),a.jsx("li",{children:"+3/+3"})]})]}),a.jsxs("section",{children:[a.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),a.jsxs("ul",{style:{lineHeight:1.8,paddingLeft:20,color:"#e2e8f0"},children:[a.jsxs("li",{children:[a.jsx("span",{style:{color:"#ed8936"},children:"PP"}),""]}),a.jsx("li",{children:"151612PP +1"})]})]})]})}),v3=({logs:t,onCardNameClick:e,scale:n=1,isMobile:r=!1})=>{const s=F.useRef(null);F.useEffect(()=>{s.current&&(s.current.scrollTop=s.current.scrollHeight)},[t.length]);const i=(c,d)=>{const u={color:"#ffd700",cursor:"pointer",textDecoration:"underline",textUnderlineOffset:"2px",fontWeight:"bold"},p=h=>{h.target.style.color="#ffec8b",h.target.style.textShadow="0 0 8px rgba(255, 215, 0, 0.8)"},f=h=>{h.target.style.color="#ffd700",h.target.style.textShadow="none"},S=(h,D)=>a.jsx("span",{style:u,onMouseEnter:p,onMouseLeave:f,onClick:H=>{H.stopPropagation(),e==null||e(h)},children:h},D),R=cb(),C=h=>h?!(/[a-zA-Z0-9]/.test(h)||/[\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/.test(h)):!0,j=[];for(const h of R){let D=0;for(;;){const H=c.indexOf(h,D);if(H===-1)break;const re=H>0?c[H-1]:void 0,W=H+h.length<c.length?c[H+h.length]:void 0,Z=C(re)&&C(W),he=j.some(xe=>H>=xe.start&&H<xe.end||H+h.length>xe.start&&H+h.length<=xe.end||H<=xe.start&&H+h.length>=xe.end);Z&&!he&&j.push({start:H,end:H+h.length,name:h}),D=H+1}}if(j.length===0)return a.jsx("span",{children:c});j.sort((h,D)=>h.start-D.start);const _=[];let v=0,w=0;for(const h of j)h.start>v&&_.push(a.jsx("span",{children:c.slice(v,h.start)},w++)),_.push(S(h.name,w++)),v=h.end;return v<c.length&&_.push(a.jsx("span",{children:c.slice(v)},w++)),a.jsx(a.Fragment,{children:_})},o=r?Math.max(100,140*n):Math.max(150,200*n),l=r?Math.max(140,180*n):Math.max(180,220*n);return a.jsxs("div",{ref:s,style:{position:"absolute",left:0,top:"45%",transform:"translateY(-50%)",width:l,height:o,overflowY:"auto",background:"linear-gradient(to right, rgba(0,0,0,0.8), rgba(0,0,0,0.0))",color:"#fff",fontSize:r?`${Math.max(.55,.65*n)}rem`:`${Math.max(.65,.75*n)}rem`,padding:r?`${6*n}px ${6*n}px ${6*n}px ${10*n}px`:`${8*n}px ${8*n}px ${8*n}px ${12*n}px`,borderLeft:r?"2px solid #63b3ed":"3px solid #63b3ed",zIndex:15,pointerEvents:"auto",scrollbarWidth:"thin"},onMouseDown:c=>c.stopPropagation(),onClick:c=>c.stopPropagation(),children:[a.jsx("div",{style:{fontWeight:"bold",marginBottom:(r?3:4)*n,color:"#a0aec0",borderBottom:"1px solid rgba(255,255,255,0.1)",paddingBottom:2,fontSize:r?`${Math.max(.5,.55*n)}rem`:`${Math.max(.55,.65*n)}rem`,textTransform:"uppercase",letterSpacing:1},children:r?"LOG":"BATTLE LOG"}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:(r?2:3)*n},children:t.map((c,d)=>a.jsx("div",{style:{opacity:.9,lineHeight:r?"1.3":"1.4",textShadow:"0 1px 2px black",animation:"fadeIn 0.3s ease-out"},children:i(c)},d))})]})},x3=({card:t,evolvedImageUrl:e,startX:n,startY:r,phase:s,onPhaseChange:i,onShake:o,useSep:l,playSE:c,scale:d,isLightMode:u=!1})=>{const[p,f]=F.useState(0),[S,R]=F.useState(0),[C,j]=F.useState(0),[_,v]=F.useState(0),[w,h]=F.useState(0),[D,H]=F.useState(.25),[re,W]=F.useState({x:n,y:r}),[Z,he]=F.useState(!1),[xe,Ue]=F.useState([]),[de,ie]=F.useState([]),[O,T]=F.useState(!1),k=F.useRef(!1),y=F.useRef(null),g=F.useRef(i),I=F.useRef(o),P=F.useRef(c);F.useEffect(()=>{g.current=i,I.current=o,P.current=c},[i,o,c]);const N=360*d,J=480*d;F.useEffect(()=>{var K,Oe,_e;console.log("[EvolutionAnimation] Phase:",s);let Ie,te=null;switch(s){case"ZOOM_IN":{W({x:n,y:r}),H(.25),R(0);const et=Date.now(),$e=650,nt=.25,mt=.75,Ct=setInterval(()=>{const Ye=Date.now()-et,E=Math.min(Ye/$e,1),Ut=1-Math.pow(1-E,2);R(-5*Ut),H(nt+(mt-nt)*Ut),E>=1&&clearInterval(Ct)},16);Ie=setTimeout(()=>{const Ye=280*d,E=window.innerWidth-Ye,Ut=Ye+E*.4;W({x:Ut,y:window.innerHeight/2-30*d})},50);const ne=setTimeout(()=>{const Ye=new Audio(it("/se/kirakira.mp3"));Ye.volume=.35,Ye.play().catch(()=>{}),y.current=Ye},600),Me=setTimeout(()=>{g.current("WHITE_FADE")},700);return()=>{clearTimeout(Ie),clearTimeout(Me),clearTimeout(ne),clearInterval(Ct)}}case"WHITE_FADE":(K=P.current)==null||K.call(P,"magic_charge.mp3",.3);const ze=Array(80).fill(0).map((et,$e)=>{const nt=$e/80*360,mt=(Math.random()-.5)*10,Ct=nt+mt,ne=200+Math.random()*600,Me=Math.random()*1.8,E=.5+(ne-200)/600*.5,Ut=24+Math.random()*48;return{id:$e,angle:Ct,dist:ne,delay:Me,duration:E,size:Ut}});Ue(ze),T(!0);let Se=0;return te=setInterval(()=>{Se+=.025,v(Math.min(Se,1)),h(Math.min(Se*80,80)),j(Se*15),Se>=1.2&&(te&&clearInterval(te),T(!1),g.current("FLIP"))},40),()=>{te&&clearInterval(te)};case"FLIP":if((Oe=P.current)==null||Oe.call(P,"syakin.mp3",.8),(_e=P.current)==null||_e.call(P,"KO.mp3",.7),y.current){const et=y.current,$e=300,nt=30,mt=$e/nt,Ct=et.volume/mt;let ne=0;const Me=setInterval(()=>{ne++,et.volume=Math.max(0,et.volume-Ct),ne>=mt&&(clearInterval(Me),et.pause(),y.current=null)},nt)}Ue([]);const De=Date.now(),vt=400,st=1200;return te=setInterval(()=>{const et=Date.now()-De;if(et<vt){const $e=et/vt,nt=1-Math.pow(1-$e,3),mt=10+nt*160;if(f(mt),H(.75+nt*((l?1.2:1.1)-.75)),R(-5+nt*2),v(Math.max(1-$e*3,0)),mt>90&&!k.current){k.current=!0;const ne=Array(120).fill(0).map((Me,Ye)=>{const E=Ye/120*360,Ut=(Math.random()-.5)*8,ys=18+Math.random()*42;return{id:Ye,angle:E+Ut,dist:200+Math.random()*400,size:ys*3,delay:Math.random()*.05}});ie(ne)}}else{const $e=Math.min((et-vt)/st,1),nt=$e<.5?2*$e*$e:1-Math.pow(-2*$e+2,2)/2;if(f(170+nt*10),v(0),!k.current){k.current=!0;const mt=Array(120).fill(0).map((Ct,ne)=>{const Me=ne/120*360,Ye=(Math.random()-.5)*8,E=18+Math.random()*42;return{id:ne,angle:Me+Ye,dist:200+Math.random()*400,size:E*3,delay:Math.random()*.05}});ie(mt)}$e>=1&&(te&&clearInterval(te),g.current("REVEAL"))}},16),()=>{te&&clearInterval(te)};case"REVEAL":let at=0;return te=setInterval(()=>{at+=.25,v(Math.max(1-at,0)),h(Math.max(60-at*60,0)),at>=1&&(te&&clearInterval(te),ie([]),g.current("ZOOM_OUT"))},40),()=>{te&&clearInterval(te)};case"ZOOM_OUT":{W({x:n,y:r});const et=Date.now(),$e=250,nt=D,mt=-3;return te=setInterval(()=>{const Ct=Date.now()-et,ne=Math.min(Ct/$e,1),Me=1-Math.pow(1-ne,3);H(nt-(nt-.25)*Me),R(mt*(1-Me)),ne>=1&&(te&&clearInterval(te),f(180),j(0),H(.25),R(0),g.current("LAND"))},16),()=>{te&&clearInterval(te)}}case"LAND":return I.current(),he(!0),Ie=setTimeout(()=>{g.current("DONE")},600),()=>clearTimeout(Ie)}return()=>{Ie&&clearTimeout(Ie),te&&clearInterval(te),y.current&&(y.current.pause(),y.current=null)}},[s]);const U=p+C,ve=S,Re=O?{x:(Math.random()-.5)*4,y:(Math.random()-.5)*4}:{x:0,y:0};return a.jsxs("div",{style:{position:"fixed",inset:0,zIndex:1e4,background:"rgba(0,0,0,0.75)",pointerEvents:"none"},children:[a.jsx("style",{children:`
                ${xe.map(Ie=>`
                    @keyframes chargeParticleIn-${Ie.id} {
                        0% { opacity: 0; transform: rotate(${Ie.angle}deg) translateX(${Ie.dist}px) scale(0.5); }
                        20% { opacity: 0.8; transform: rotate(${Ie.angle}deg) translateX(${Ie.dist*.8}px) scale(1.2); }
                        100% { opacity: 1; transform: rotate(${Ie.angle}deg) translateX(0) scale(0.2); } /* Keep visible at end */
                    }
                `).join("")}
                ${de.map(Ie=>`
                    @keyframes burstParticleOut-${Ie.id} {
                        0% { opacity: 1; transform: translate(-50%, -50%) rotate(${Ie.angle}deg) translateX(0) scale(1.5); }
                        100% { opacity: 0; transform: translate(-50%, -50%) rotate(${Ie.angle}deg) translateX(${Ie.dist*1.5}px) scale(0); }
                    }
                `).join("")}
            `}),(u?xe.filter((Ie,te)=>te%2===0):xe).map(Ie=>a.jsx("div",{style:{position:"absolute",left:re.x,top:re.y,width:Ie.size*d,height:Ie.size*d,borderRadius:"50%",background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(200,230,255,0.6) 40%, transparent 70%)",boxShadow:u?"0 0 8px white":"0 0 10px white, 0 0 20px rgba(100,200,255,0.5)",filter:u?void 0:"blur(1px)",animation:`chargeParticleIn-${Ie.id} ${Ie.duration}s ease-in ${Ie.delay}s forwards`,transform:`rotate(${Ie.angle}deg) translateX(${Ie.dist*d}px)`,opacity:0,pointerEvents:"none"}},`charge-${Ie.id}`)),s==="WHITE_FADE"&&a.jsxs("div",{style:{position:"absolute",left:re.x+Re.x,top:re.y+Re.y,width:0,height:0,transformStyle:"preserve-3d"},children:[a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:500*d,height:500*d,border:"8px solid rgba(255, 255, 255, 0.6)",borderRadius:"50%",transform:"translate(-50%, -50%) rotateX(75deg)",boxShadow:u?"0 0 15px rgba(255, 255, 255, 0.6)":"0 0 30px rgba(255, 255, 255, 0.8), inset 0 0 30px rgba(255, 255, 255, 0.8)",animation:"ringSpin 2s linear infinite"}}),!u&&a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:600*d,height:600*d,border:"6px dashed rgba(100, 200, 255, 0.7)",borderRadius:"50%",transform:"translate(-50%, -50%) rotateX(80deg) rotateY(10deg)",boxShadow:"0 0 40px rgba(100, 200, 255, 0.5)",animation:"ringSpinReverse 3s linear infinite"}}),a.jsx("style",{children:`
                        @keyframes ringSpin {
                            0% { transform: translate(-50%, -50%) rotateX(75deg) rotate(0deg); opacity: 0; scale: 0.5; }
                            20% { opacity: 1; scale: 1; }
                            100% { transform: translate(-50%, -50%) rotateX(75deg) rotate(360deg); opacity: 1; scale: 1; }
                        }
                        @keyframes ringSpinReverse {
                            0% { transform: translate(-50%, -50%) rotateX(80deg) rotateY(10deg) rotate(0deg); opacity: 0; scale: 0.6; }
                            20% { opacity: 0.8; scale: 1; }
                            100% { transform: translate(-50%, -50%) rotateX(80deg) rotateY(10deg) rotate(-360deg); opacity: 0.8; scale: 1; }
                        }
                    `})]}),(u?de.filter((Ie,te)=>te%2===0):de).map(Ie=>a.jsx("div",{style:{position:"absolute",left:re.x,top:re.y,width:Ie.size*d,height:Ie.size*d,borderRadius:"50%",background:l?"radial-gradient(circle, rgba(183, 148, 244, 1) 0%, rgba(159, 122, 234, 0.8) 50%, transparent 100%)":"radial-gradient(circle, rgba(255, 251, 235, 1) 0%, rgba(251, 211, 141, 0.8) 50%, transparent 100%)",boxShadow:u?l?"0 0 8px #b794f4":"0 0 8px #fbd38d":l?"0 0 10px #b794f4, 0 0 20px rgba(159,122,234,0.6)":"0 0 10px #fbd38d, 0 0 20px rgba(251,211,141,0.6)",animation:`burstParticleOut-${Ie.id} 0.4s ease-out ${Ie.delay}s forwards`,pointerEvents:"none"}},`burst-${Ie.id}`)),a.jsxs("div",{style:{position:"absolute",left:re.x+Re.x,top:re.y+Re.y,transform:`translate(-50%, -50%) scale(${D}) perspective(1200px) rotateY(${U}deg) rotateZ(${ve}deg)`,transition:s==="ZOOM_IN"||s==="ZOOM_OUT"?"left 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), top 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)":"none",transformStyle:"preserve-3d"},children:[!u&&a.jsx("div",{style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:N*1.3,height:J*1.2,background:l?"radial-gradient(ellipse, rgba(159, 122, 234, 0.4) 0%, transparent 70%)":"radial-gradient(ellipse, rgba(251, 211, 141, 0.4) 0%, transparent 70%)",filter:"blur(20px)",pointerEvents:"none",opacity:w>1?1:0,transition:"opacity 0.4s"}}),a.jsxs("div",{style:{width:N,height:J,borderRadius:16,overflow:"hidden",boxShadow:u?l?"0 0 20px rgba(159, 122, 234, 0.5)":"0 0 20px rgba(251, 211, 141, 0.5)":l?"0 0 40px rgba(159, 122, 234, 0.7)":"0 0 40px rgba(251, 211, 141, 0.7)",position:"relative",transformStyle:"preserve-3d"},children:[a.jsxs("div",{style:{position:"absolute",inset:0,borderRadius:16,overflow:"hidden",background:"#1a202c",zIndex:U<=90?2:1,opacity:U<=90?1:0},children:[a.jsx("img",{src:it(t.imageUrl||""),alt:t.name,style:{width:"100%",height:"100%",objectFit:"cover",filter:`brightness(${1+_*.5}) contrast(${1-_*.2})`}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"white",opacity:_,pointerEvents:"none"}})]}),a.jsxs("div",{style:{position:"absolute",inset:0,transform:"rotateY(180deg)",borderRadius:16,overflow:"hidden",background:"#1a202c",zIndex:U>90?2:1,opacity:U>90?1:0},children:[a.jsx("img",{src:it(e&&e!==""?e:t.imageUrl||""),alt:`${t.name} Evolved`,style:{width:"100%",height:"100%",objectFit:"cover",filter:`brightness(${1+_*.5}) contrast(${1-_*.2})`}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"white",opacity:_,pointerEvents:"none"}})]})]})]}),Z&&a.jsxs("div",{style:{position:"absolute",left:n,top:r,pointerEvents:"none"},children:[a.jsx("style",{children:`
                        @keyframes landParticleMove {
                            0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                            100% { opacity: 0; transform: translate(-50%, -50%) rotate(var(--angle)) translateX(calc(var(--dist) * 1px)) scale(0); }
                        }
                    `}),Array(20).fill(0).map((Ie,te)=>{const K=te/20*360,Oe=40+Math.random()*100;return a.jsx("div",{style:{position:"absolute",left:0,top:0,width:8*d,height:8*d,borderRadius:"50%",background:"white","--angle":`${K}deg`,"--dist":Oe,animation:"landParticleMove 0.5s ease-out forwards"}},`land-${te}`)})]})]})},Ux=it("/leaders/yoRuka_win.png"),Bx=it("/leaders/yoRuka_lose.png"),_3=it("/leaders/senka_win.png"),b3=it("/leaders/senka_lose.png"),E3=it("/leaders/azya_win.png"),S3=it("/leaders/azya_lose.png"),w3=t=>({BRONZE:"#cd7f32",SILVER:"#c0c0c0",GOLD:"#ffd700",PLATINUM:"#e5e4e2",DIAMOND:"#b9f2ff",MASTER:"#ff4500"})[t],I3=({winnerId:t,playerId:e,playerClass:n,onRematch:r,onRematching:s,onLeave:i,isOnline:o,isRoomMatch:l=!0,myRematchRequested:c,opponentRematchRequested:d,battleStats:u,selectedCardInfo:p,onCardInfoClick:f,victoryReason:S="normal",isRankedMatch:R=!1,ratingResult:C})=>{const j=t===e,v=(()=>{if(!j)return null;switch(S){case"disconnect":return"";case"surrender":return"";default:return null}})(),[w,h]=F.useState("bg-fade"),D=["bg-fade","image","result-text","stats","rate","buttons","complete"].indexOf(w);F.useEffect(()=>{const y={"bg-fade":300,image:600,"result-text":400,stats:400,rate:300,buttons:0};if(w==="complete")return;const g={"bg-fade":"image",image:"result-text","result-text":"stats",stats:"rate",rate:"buttons",buttons:"complete"},I=setTimeout(()=>{const P=g[w];P&&h(P)},y[w]||0);return()=>clearTimeout(I)},[w]);const H=()=>n==="SENKA"?j?_3:b3:n==="AJA"?j?E3:S3:j?Ux:Bx,[re,W]=F.useState(15),[Z,he]=F.useState(!1),[xe,Ue]=F.useState(null),de=o?c||d:c||Z;F.useEffect(()=>{if(de)return;const y=setInterval(()=>{W(g=>g<=1?(clearInterval(y),i(),0):g-1)},1e3);return()=>clearInterval(y)},[i,de]);const ie=y=>{Ue(y),o&&!l&&s?s(y):r(y)},O=()=>{const y=!o||l?"":"";return o?c&&d?"...":c?"...":d?`${y}`:y:c?"...":y},T=()=>{const y={padding:"15px 40px",fontSize:"1.5rem",fontWeight:"bold",border:"none",borderRadius:12,cursor:c?"default":"pointer",transform:"scale(1)",transition:"transform 0.1s, background 0.2s"};return d&&!c?{...y,background:"linear-gradient(135deg, #f6e05e, #d69e2e)",color:"black",boxShadow:"0 4px 15px rgba(246, 224, 94, 0.6)",animation:"pulse 1s infinite"}:c?{...y,background:"linear-gradient(135deg, #718096, #4a5568)",color:"white",boxShadow:"none"}:{...y,background:"linear-gradient(135deg, #48bb78, #38a169)",color:"white",boxShadow:"0 4px 15px rgba(72, 187, 120, 0.4)"}},k=(y,g)=>({width:220,height:220,borderRadius:"50%",border:xe===y?"5px solid #f6e05e":"4px solid rgba(255,255,255,0.4)",background:y==="AJA"?`url(${ul(y)}) center top/cover`:`url(${ul(y)}) center/cover`,cursor:"pointer",transform:g?"scale(1.1)":"scale(1)",transition:"all 0.2s ease",boxShadow:g?"0 0 30px rgba(246, 224, 94, 0.7)":"0 6px 15px rgba(0,0,0,0.5)"});return a.jsxs("div",{style:{position:"absolute",inset:0,zIndex:5e3,background:"rgba(0,0,0,0.85)",backdropFilter:"blur(10px)",display:"flex",flexDirection:"row",alignItems:"stretch",opacity:D>=0?1:0,transition:"opacity 0.3s ease-out"},onClick:()=>{},children:[a.jsx("style",{children:`
                @keyframes pulse {
                    0%, 100% { transform: scale(1); }
                    50% { transform: scale(1.05); }
                }
                @keyframes float {
                    0%, 100% { transform: translateY(0); }
                    50% { transform: translateY(-10px); }
                }
                @keyframes slideUpFadeIn {
                    0% { opacity: 0; transform: translateY(30px); }
                    100% { opacity: 1; transform: translateY(0); }
                }
                @keyframes imageFadeIn {
                    0% { opacity: 0; transform: scale(0.95); }
                    100% { opacity: 0.9; transform: scale(1); }
                }
            `}),a.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:40,borderRight:"1px solid rgba(255,255,255,0.1)"},children:p?a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:16,maxWidth:320},children:[a.jsx("div",{style:{width:200,height:280,backgroundImage:`url(${it(`/cards/${p.id}.png`)})`,backgroundSize:"cover",backgroundPosition:"center",borderRadius:12,boxShadow:"0 8px 30px rgba(0,0,0,0.6)"}}),a.jsx("div",{style:{fontFamily:"var(--font-tamanegi)",fontSize:"1.6rem",color:"white",textShadow:"0 2px 6px rgba(0,0,0,0.6)",textAlign:"center"},children:p.name}),a.jsxs("div",{style:{display:"flex",gap:20,fontSize:"1.2rem",color:"rgba(255,255,255,0.9)"},children:[a.jsxs("span",{children:[": ",p.cost]}),p.type==="FOLLOWER"&&a.jsxs(a.Fragment,{children:[a.jsxs("span",{children:[": ",p.attack]}),a.jsxs("span",{children:[": ",p.health]})]})]}),a.jsx("div",{style:{fontSize:"1rem",color:"rgba(255,255,255,0.7)",textAlign:"center",lineHeight:1.5,maxHeight:120,overflow:"auto"},children:p.description||""}),a.jsx("button",{onClick:()=>f(null),style:{padding:"8px 24px",fontSize:"1rem",background:"transparent",border:"1px solid rgba(255,255,255,0.3)",color:"white",borderRadius:8,cursor:"pointer",marginTop:10},children:""})]}):a.jsx("div",{style:{width:"100%",height:"100%",backgroundImage:`url(${H()})`,backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat",opacity:D>=1?.9:0,transform:D>=1?"scale(1)":"scale(0.95)",transition:"opacity 0.6s ease-out, transform 0.6s ease-out"}})}),a.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:40,position:"relative"},children:[a.jsx("div",{style:{fontFamily:"var(--font-tamanegi)",fontSize:"5rem",color:j?"#f6e05e":"#a0aec0",textShadow:j?"0 0 40px rgba(246, 224, 94, 0.7), 4px 4px 8px rgba(0,0,0,0.6)":"0 0 20px rgba(160, 174, 192, 0.5), 4px 4px 8px rgba(0,0,0,0.6)",marginBottom:20,opacity:D>=2?1:0,transform:D>=2?"translateY(0)":"translateY(30px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out",animation:D>=2?"float 3s ease-in-out infinite":"none"},children:j?"":""}),v&&a.jsx("div",{style:{fontSize:"1.1rem",color:"rgba(255, 255, 255, 0.8)",marginTop:-10,marginBottom:20,opacity:D>=2?1:0,transform:D>=2?"translateY(0)":"translateY(20px)",transition:"opacity 0.4s ease-out 0.2s, transform 0.4s ease-out 0.2s"},children:v}),a.jsxs("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"center",gap:16,marginBottom:30,padding:"16px 24px",background:"rgba(0,0,0,0.3)",borderRadius:12,border:"1px solid rgba(255,255,255,0.1)",opacity:D>=3?1:0,transform:D>=3?"translateY(0)":"translateY(30px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out"},children:[a.jsxs("div",{style:{textAlign:"center",minWidth:80},children:[a.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#f6e05e"},children:u.turnCount}),a.jsx("div",{style:{fontSize:"0.9rem",color:"rgba(255,255,255,0.6)"},children:""})]}),a.jsxs("div",{style:{textAlign:"center",minWidth:80},children:[a.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#48bb78"},children:u.damageDealtToOpponent}),a.jsx("div",{style:{fontSize:"0.9rem",color:"rgba(255,255,255,0.6)"},children:""})]}),a.jsxs("div",{style:{textAlign:"center",minWidth:80},children:[a.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#e53e3e"},children:u.damageReceivedFromOpponent}),a.jsx("div",{style:{fontSize:"0.9rem",color:"rgba(255,255,255,0.6)"},children:""})]}),a.jsxs("div",{style:{textAlign:"center",minWidth:80},children:[a.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#63b3ed"},children:u.followersDestroyed}),a.jsx("div",{style:{fontSize:"0.9rem",color:"rgba(255,255,255,0.6)"},children:""})]})]}),R&&C&&a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:8,marginTop:16,opacity:D>=4?1:0,transform:D>=4?"translateY(0)":"translateY(20px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out"},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,background:"rgba(0, 0, 0, 0.5)",padding:"12px 24px",borderRadius:12,border:`2px solid ${C.ratingChange>=0?"#48bb78":"#e53e3e"}`},children:[a.jsx("span",{style:{fontSize:"1.2rem",color:"rgba(255,255,255,0.8)",fontFamily:"var(--font-tamanegi)"},children:""}),a.jsxs("span",{style:{fontSize:"2rem",fontWeight:"bold",color:C.ratingChange>=0?"#48bb78":"#e53e3e",fontFamily:"var(--font-tamanegi)"},children:[C.ratingChange>=0?"+":"",C.ratingChange]})]}),C.ratingChange>0&&(C.bonusBreakdown.winStreakBonus>0||C.bonusBreakdown.rankDiffBonus>0)&&a.jsxs("div",{style:{display:"flex",gap:16,fontSize:"0.85rem",color:"rgba(255,255,255,0.6)",fontFamily:"var(--font-tamanegi)"},children:[a.jsxs("span",{children:[": +",C.bonusBreakdown.base]}),C.bonusBreakdown.winStreakBonus>0&&a.jsxs("span",{style:{color:"#f6e05e"},children:[": +",C.bonusBreakdown.winStreakBonus]}),C.bonusBreakdown.rankDiffBonus>0&&a.jsxs("span",{style:{color:"#63b3ed"},children:[": +",C.bonusBreakdown.rankDiffBonus]})]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,fontSize:"1rem",color:"rgba(255,255,255,0.8)",fontFamily:"var(--font-tamanegi)"},children:[a.jsx("span",{style:{color:w3(C.newRank),fontWeight:"bold"},children:Ur[C.newRank]}),a.jsx("span",{children:C.newRating})]}),C.isRankUp&&a.jsxs("div",{style:{fontSize:"1.4rem",fontWeight:"bold",color:"#f6e05e",textShadow:"0 0 20px rgba(246, 224, 94, 0.8)",fontFamily:"var(--font-tamanegi)",animation:"pulse 1s ease-in-out infinite"},children:[Ur[C.newRank],""]}),C.isRankDown&&a.jsxs("div",{style:{fontSize:"1.2rem",color:"#e53e3e",fontFamily:"var(--font-tamanegi)"},children:[Ur[C.newRank],""]})]}),a.jsx("div",{style:{position:"absolute",right:20,bottom:270,width:180,textAlign:"center",fontFamily:"var(--font-tamanegi)",fontSize:"1.4rem",color:j?"#f6e05e":"#e53e3e",textShadow:j?"0 0 20px rgba(246, 224, 94, 0.8), 2px 2px 4px rgba(0,0,0,0.8)":"0 0 20px rgba(229, 62, 62, 0.8), 2px 2px 4px rgba(0,0,0,0.8)",zIndex:10,opacity:D>=5?1:0,transition:"opacity 0.4s ease-out"},children:j?"":""}),Z&&!c?a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",animation:"fadeIn 0.3s ease-out"},children:[a.jsx("div",{style:{fontFamily:"var(--font-tamanegi)",fontSize:"1.6rem",color:"white",marginBottom:24,textShadow:"0 2px 6px rgba(0,0,0,0.6)"},children:""}),a.jsxs("div",{style:{display:"flex",gap:40,marginBottom:24},children:[a.jsx(zx,{deckType:"SENKA",label:"",onSelect:ie,getStyle:k}),a.jsx(zx,{deckType:"AJA",label:"",onSelect:ie,getStyle:k})]}),a.jsx("button",{onClick:()=>he(!1),style:{padding:"10px 36px",fontSize:"1.1rem",fontWeight:"bold",background:"transparent",border:"2px solid rgba(255,255,255,0.3)",color:"white",borderRadius:10,cursor:"pointer",marginTop:8},children:""})]}):a.jsxs("div",{style:{display:"flex",gap:20,opacity:D>=5?1:0,transform:D>=5?"translateY(0)":"translateY(30px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out"},children:[a.jsx("button",{onClick:()=>{c||he(!0)},disabled:c,style:T(),onMouseDown:y=>{c||(y.currentTarget.style.transform="scale(0.95)")},onMouseUp:y=>y.currentTarget.style.transform="scale(1)",children:O()}),a.jsxs("button",{onClick:i,style:{padding:"15px 40px",fontSize:"1.5rem",fontWeight:"bold",background:"transparent",border:"2px solid rgba(255,255,255,0.3)",color:"white",borderRadius:12,cursor:"pointer"},children:[" ",!de&&`(${re})`]})]}),a.jsx("div",{onClick:()=>{Z&&!c&&ie("YORUKA")},style:{position:"absolute",right:20,bottom:20,width:180,height:240,backgroundImage:`url(${j?Ux:Bx})`,backgroundSize:"cover",backgroundPosition:"center",borderRadius:12,cursor:Z&&!c?"pointer":"default",opacity:D>=5?.7:0,transition:"opacity 0.4s ease",boxShadow:"0 8px 20px rgba(0,0,0,0.4)"}})]})]})},zx=({deckType:t,label:e,onSelect:n,getStyle:r})=>{const[s,i]=F.useState(!1);return a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:12},children:[a.jsx("button",{onClick:()=>n(t),onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),style:r(t,s)}),a.jsx("span",{style:{color:"white",fontFamily:"var(--font-tamanegi)",fontSize:"1.4rem",textShadow:"0 2px 6px rgba(0,0,0,0.6)"},children:e})]})},Hx=(t,e)=>{const[n,r]=F.useState([]),s=F.useRef(!1);return F.useEffect(()=>{r(i=>{const o=[],l=new Map((t||[]).filter(c=>c).map(c=>[c.instanceId,c]));return i.forEach(c=>{var u;if(!c)return;const d=l.get(c.instanceId);d?(o.push({...d,passiveAbilities:d.passiveAbilities?[...d.passiveAbilities]:[],hasBarrier:d.hasBarrier??((u=d.passiveAbilities)==null?void 0:u.includes("BARRIER"))??!1,isDying:!1}),l.delete(c.instanceId)):o.push({...c,isDying:!0,killedByBane:c.killedByBane})}),l.forEach(c=>{var d;o.push({...c,passiveAbilities:c.passiveAbilities?[...c.passiveAbilities]:[],hasBarrier:c.hasBarrier??((d=c.passiveAbilities)==null?void 0:d.includes("BARRIER"))??!1,isDying:!1})}),o})},[t]),F.useEffect(()=>{if(n.some(o=>o.isDying)){if(e!=null&&e.current){s.current=!0;return}const o=setTimeout(()=>{r(l=>l.filter(c=>!c.isDying))},700);return()=>clearTimeout(o)}},[n,e]),F.useEffect(()=>{const o=setInterval(()=>{if(!(e!=null&&e.current)&&s.current){s.current=!1;const l=setTimeout(()=>{r(c=>c.filter(d=>!d.isDying))},300);return()=>clearTimeout(l)}},100);return()=>clearInterval(o)},[e]),n},T3=({playerClass:t,opponentType:e,gameMode:n,targetRoomId:r,onLeave:s,onRematching:i,networkAdapter:o,networkConnected:l,opponentClass:c,aiDifficulty:d="NORMAL",playerName:u,timerEnabled:p=!0,playerId:f,opponentPlayerId:S,opponentRating:R})=>{var zm,Hm,Wm,Gm,Vm,Ym,Km,Xm,Jm;const C=n==="CPU"||!o,j=n3(C?n==="CPU"?"CPU":n:"CPU",C?r:void 0),_=o||j.adapter,v=l!==void 0?l:j.connected,w=d3(),{scale:h,toGameX:D,toGameY:H}=w,{isLightMode:re}=u2(),[W,Z]=A.useState(!1);A.useEffect(()=>{(()=>{Z("ontouchstart"in window||navigator.maxTouchPoints>0)})()},[]);const he=A.useCallback((m,x)=>({x:D(m),y:H(x)}),[D,H]),[xe,Ue]=A.useState(null),de=F.useRef(w);A.useEffect(()=>{de.current=w},[w]);const ie=n==="CPU"||n==="HOST"||(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&(_==null?void 0:_.isHost)===!0,O=ie?"p1":"p2",T=ie?"p2":"p1";console.log("[GameScreen INIT]",{gameMode:n,"adapter?.isHost":_==null?void 0:_.isHost,isHost:ie,currentPlayerId:O,connected:v,"networkAdapter provided":!!o,networkConnected:l});const k=c||(t==="YORUKA"?Math.random()<.5?"SENKA":"AJA":t==="SENKA"?"AJA":"SENKA"),y=n==="JOIN"||(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&!ie,[g,I]=A.useReducer(yT,null,()=>{const m=n==="CPU"?"CPU":"";return y?bd(m,k,u,t):bd(u,t,m,k)}),[P,N]=A.useState(!y),J=n==="CASUAL_MATCH"||n==="RANKED_MATCH",[U,ve]=F.useState(J?!1:!y),[Re,Ie]=F.useState(!1),[te,K]=F.useState(!1),[Oe,_e]=F.useState(!1),[ze,Se]=F.useState(J),[De,vt]=F.useState(!1),st=F.useRef(!1);console.log("[GameScreen SYNC STATE]",{isCasualOrRanked:J,isJoinSide:y,gameSynced:P,waitingForIntroSync:ze,opponentReadyForIntro:De,showBattleIntro:U,"introSyncSentRef.current":st.current});const[at,et]=F.useState(!1),[$e,nt]=F.useState(null),[mt,Ct]=F.useState(0),[ne,Me]=F.useState({x:0,y:0}),[Ye,E]=F.useState("IDLE"),[Ut,ys]=F.useState(null),[ha,pi]=F.useState(!1),[fr,eo]=F.useState(()=>Math.random()>.5),[gf,cc]=F.useState(!1),[dc,pa]=F.useState(!1),[uc,fc]=F.useState("normal"),[er,hc]=F.useState(t),[vs,gi]=F.useState({turnCount:0,damageDealtToOpponent:0,damageReceivedFromOpponent:0,followersDestroyed:0,myFollowersDestroyed:0}),[mf,ga]=F.useState(null),[yf,vf]=F.useState(null),[Ar,to]=F.useState(!1);F.useEffect(()=>{if(n!=="RANKED_MATCH"||!f||!g.winnerId||Ar)return;(async()=>{try{const x=await xS(f,er),b=g.winnerId===O;let L;b?L=aL(x.rating,x.winStreak,R??0):L=lL(x.rating),await cL(f,er,L,b),vf(L),to(!0),console.log("[RatingUpdate] Rating updated:",L)}catch(x){console.error("[RatingUpdate] Failed to update rating:",x),to(!0)}})()},[n,f,g.winnerId,O,er,R,Ar]),F.useEffect(()=>{g.winnerId&&!at&&!Oe&&_e(!0)},[g.winnerId,at,Oe]),F.useEffect(()=>{if(mt<=0){Me({x:0,y:0});return}let m;const x=()=>{const b=Date.now()*.03,L=25*mt*h,$=Math.sin(b*7)*L+Math.sin(b*13)*L*.5,V=Math.cos(b*11)*L+Math.cos(b*17)*L*.3;Me({x:$,y:V}),m=requestAnimationFrame(x)};return m=requestAnimationFrame(x),()=>cancelAnimationFrame(m)},[mt,h]);const[ma,pc]=F.useState([]),xf=F.useRef(0),[M,Fe]=F.useState(!1),[lt,Et]=F.useState(null),[Vt,tr]=F.useState(null),Vr=F.useRef(null),Pr=F.useRef(null),Or=F.useRef(null),_f=F.useRef(g.logs.length),gc=A.useRef(!1),dm=A.useRef(!1),mc=A.useRef(null);A.useEffect(()=>{const m=n==="HOST"||(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&ie,x=J?v&&_:v&&_&&Ye==="DONE";if(console.log("[GameScreen INIT_GAME useEffect]",{isHostSide:m,isCasualOrRanked:J,connected:v,"adapter exists":!!_,coinTossPhase:Ye,canSendInitGame:x,"initialStateSentRef.current":gc.current}),m&&x&&!gc.current){console.log("[GameScreen] HOST side: Sending initial game state to JOIN"),gc.current=!0;const b=()=>{console.log("[GameScreen] HOST side: Actually sending INIT_GAME now, isFirstPlayer:",fr);const L=J?{...g,firstPlayerId:fr?"p1":"p2"}:g;_.send({type:"INIT_GAME",payload:L}),(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&(console.log("[GameScreen] HOST side: Sending READY_FOR_INTRO"),_.send({type:"READY_FOR_INTRO"}),st.current=!0)};setTimeout(b,500),(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&setTimeout(()=>{De||(console.log("[GameScreen] HOST side: Retrying INIT_GAME (no response yet)"),b())},2500)}},[n,v,_,g,Ye,ie,J,De]),A.useEffect(()=>{!J||!_||!P||st.current||y&&(console.log("[GameScreen] JOIN side: Sending READY_FOR_INTRO after game sync"),_.send({type:"READY_FOR_INTRO"}),st.current=!0)},[J,_,P,y]),A.useEffect(()=>{!J||!_||!ze||ie&&De&&st.current&&(console.log("[GameScreen] HOST side: Both ready, sending START_INTRO"),_.send({type:"START_INTRO"}),Se(!1),ve(!0))},[J,_,ie,De,ze]);const le=g.players[O],Ne=g.players[T];A.useEffect(()=>{var x,b;const m=g.logs.length;if(m>_f.current)for(let L=_f.current;L<m;L++){const $=g.logs[L],V=$.match(/(.+?)  (\d+) /);if(V){const B=V[1],z=parseInt(V[2],10),Y=(le==null?void 0:le.name)===B?O:T,ue=xf.current++;pc(ee=>[...ee,{playerId:Y,amount:z,key:ue}]),setTimeout(()=>{pc(ee=>ee.filter(ge=>ge.key!==ue))},1500)}const q=$.match(/(.+?) (?:)?/);if(q){const B=q[1],z=(x=g.players[O])==null?void 0:x.board.find(ge=>(ge==null?void 0:ge.name)===B),Y=(b=g.players[T])==null?void 0:b.board.find(ge=>(ge==null?void 0:ge.name)===B),ue=z||Y,ee=z?O:T;if(ue){const ge=g.players[ee].board.findIndex(Te=>(Te==null?void 0:Te.instanceId)===ue.instanceId),qe=(ee===O?Lr.current:pr.current)[ge];if(qe){const Te=qe.getBoundingClientRect(),Je=Te.left+Te.width/2,rt=Te.top+Te.height/2;Tc(Ke=>[...Ke,{id:Date.now()+Math.random(),value:0,x:Je,y:rt,color:"#e53e3e"}])}}}}_f.current=m},[g.logs.length,O,T,le==null?void 0:le.name,g.players]);const[bf,ya]=F.useState(!1),Yr=F.useRef(!1),wn=Hx(((zm=g.players[O])==null?void 0:zm.board)||[],Yr),mn=Hx(((Hm=g.players[T])==null?void 0:Hm.board)||[],Yr),va=F.useRef(wn),yc=F.useRef(mn),[mi,vc]=F.useState(null),[Ef,um]=F.useState(-1),xc=F.useRef(null),[no,xa]=F.useState([]),[Q,Kr]=F.useState(null),[gt,nr]=F.useState(null),[h2,fm]=F.useState([]),p2=F.useRef(0),hm=F.useRef(0),pm=F.useRef(null),gm=F.useRef(Q);gm.current=Q,F.useEffect(()=>{const m=Q==null?void 0:Q.sourceType;if(!m||m!=="BOARD"&&m!=="EVOLVE"){fm([]);return}const x=400,b=setInterval(()=>{const L=gm.current;if(!L||L.sourceType!=="BOARD"&&L.sourceType!=="EVOLVE")return;const $=Date.now(),V=Math.PI*(3-Math.sqrt(5));hm.current+=V+(Math.random()-.5)*.3;const q=hm.current,B=4+Math.random()*3,z={id:p2.current++,x:L.currentX,y:L.currentY,vx:Math.cos(q)*B,vy:Math.sin(q)*B,opacity:1,radius:3+Math.random()*2,createdAt:$};fm(Y=>[...Y.filter(ee=>$-ee.createdAt<x).map(ee=>({...ee,x:ee.x+ee.vx,y:ee.y+ee.vy,opacity:Math.max(0,1-($-ee.createdAt)/x)})),z])},80);return()=>clearInterval(b)},[Q==null?void 0:Q.sourceType]),F.useEffect(()=>{const m=(Q==null?void 0:Q.sourceType)==="EVOLVE";if(m&&!Or.current){const x=new Audio(it("/se/aura.mp3"));x.loop=!0,x.volume=0,x.play().catch(()=>{}),Or.current=x;const b=300,L=30,$=b/L,V=.25/$;let q=0;const B=setInterval(()=>{q++,Or.current&&(Or.current.volume=Math.min(q*V,.25)),q>=$&&clearInterval(B)},L)}else if(!m&&Or.current){const x=Or.current,b=200,L=20,$=b/L,V=x.volume/$;let q=0;const B=setInterval(()=>{q++,x.volume=Math.max(0,x.volume-V),q>=$&&(clearInterval(B),x.pause(),x.currentTime=0)},L);Or.current=null}return()=>{!Q&&Or.current&&(Or.current.pause(),Or.current=null)}},[Q==null?void 0:Q.sourceType]);const[mm,Sf]=F.useState(new Set),[ym,_c]=F.useState(null),[vm,bc]=F.useState(null),[g2,xm]=F.useState(null),[He,Xr]=F.useState(null),wf=F.useCallback(m=>{const x=es(m);x&&(g.winnerId?ga(x):Xr({card:x,owner:"OPPONENT",source:"LOG"}))},[g.winnerId]),m2=F.useCallback(m=>{const x=/([^]+)/g,b=[];let L=0,$,V=0;const q=cb();for(;($=x.exec(m))!==null;){$.index>L&&b.push(a.jsx("span",{children:m.slice(L,$.index)},V++));const B=$[1];q.includes(B)?b.push(a.jsxs("span",{style:{color:"#ffd700",cursor:"pointer",textDecoration:"underline",textUnderlineOffset:"2px",fontWeight:"bold"},onMouseEnter:Y=>{Y.target.style.color="#ffec8b",Y.target.style.textShadow="0 0 8px rgba(255, 215, 0, 0.8)"},onMouseLeave:Y=>{Y.target.style.color="#ffd700",Y.target.style.textShadow="none"},onClick:Y=>{Y.stopPropagation(),wf(B)},children:["",B,""]},V++)):b.push(a.jsxs("span",{children:["",B,""]},V++)),L=$.index+$[0].length}return L<m.length&&b.push(a.jsx("span",{children:m.slice(L)},V++)),b.length>0?a.jsx(a.Fragment,{children:b}):m},[wf]),[Ec,ro]=F.useState([]),Xt=(m,x,b,L)=>{if(!m)return;let $=window.innerWidth/2,V=window.innerHeight/2;const q=x===T;if(b===void 0||b===-1){const z=q?io:vi;if(z.current){const Y=z.current.getBoundingClientRect(),ue=he(Y.left+Y.width/2,Y.top+Y.height/2);$=ue.x,V=ue.y}else V=q?150:f2-250}else if(b!==void 0&&b>=0){const z=q?pr:Lr,Y=q?yc.current:va.current;let ue=b;if(L){const ge=Y.findIndex(Ee=>Ee&&Ee.instanceId===L);ge>=0&&(ue=ge)}const ee=z.current[ue];if(ee){const ge=ee.getBoundingClientRect(),Ee=he(ge.left+ge.width/2,ge.top+ge.height/2);$=Ee.x,V=Ee.y}}ro(z=>[...z,{type:m,x:$,y:V,key:Date.now()+Math.random()}])},_m=(m,x,b,L,$)=>{let V=window.innerWidth/2,q=window.innerHeight/2;const B=m===T,z=B?pr:Lr,Y=B?yc.current:va.current;let ue=x;if($){const ge=Y.findIndex(Ee=>Ee&&Ee.instanceId===$);ge>=0&&(ue=ge)}const ee=z.current[ue];if(ee){const ge=ee.getBoundingClientRect(),Ee=he(ge.left+ge.width/2,ge.top+ge.height/2);V=Ee.x,q=Ee.y}ro(ge=>[...ge,{type:"BUFF",x:V,y:q,key:Date.now()+Math.random(),atkBuff:b,hpBuff:L}])},hr=(m,x,b,L)=>{Xt(m,x,b,L),n==="HOST"&&v&&_&&_.send({type:"EFFECT",payload:{effectType:m,targetPlayerId:x||"",targetIndex:b??-1,targetInstanceId:L}})},_a=(m,x,b,L,$)=>{_m(m,x,b,L,$),n==="HOST"&&v&&_&&_.send({type:"EFFECT",payload:{effectType:"BUFF",targetPlayerId:m,targetIndex:x,targetInstanceId:$,isBuff:!0,atkBuff:b,hpBuff:L}})},bm=F.useRef([]),Em=F.useRef([]);F.useEffect(()=>{var L,$;const m=(V,q,B)=>{q.forEach(z=>{if(!z)return;if(!V.find(ue=>ue&&ue.instanceId===z.instanceId)&&z.killedByBane){const ue=B===T,ee=ue?pr:Lr,Ee=(ue?yc.current:va.current).findIndex(qe=>qe&&qe.instanceId===z.instanceId);if(Ee>=0&&ee.current[Ee]){const Te=ee.current[Ee].getBoundingClientRect(),Je=he(Te.left+Te.width/2,Te.top+Te.height/2);ro(rt=>[...rt,{type:"BANE",x:Je.x,y:Je.y,key:Date.now()+Math.random()}])}}})},x=((L=g.players[O])==null?void 0:L.board)||[],b=(($=g.players[T])==null?void 0:$.board)||[];m(x,bm.current,O),m(b,Em.current,T),bm.current=x.map(V=>V?{...V}:null),Em.current=b.map(V=>V?{...V}:null)},[g.players,O,T]);const If=600,[xs,ba]=F.useState(null),Tf=F.useRef({player:0,opponent:0}),[Ot,Ea]=F.useState(()=>{try{const m=localStorage.getItem("audioSettings");if(m){const x=JSON.parse(m);if(x.enabled!==void 0){const{enabled:b,...L}=x;return{...L,bgmEnabled:b,seEnabled:b}}return x}return{bgm:.3,se:.5,voice:.5,bgmEnabled:!0,seEnabled:!0}}catch{return{bgm:.3,se:.5,voice:.5,bgmEnabled:!0,seEnabled:!0}}}),St=F.useCallback((m,x=.5)=>{if(!Ot.seEnabled)return;const b=new Audio(it(`/se/${m}`));b.volume=Ot.se*x,b.play().catch(L=>console.warn("SE Play prevented",L))},[Ot]),Sc=F.useRef(null);F.useEffect(()=>{if(Q&&gt&&!Sc.current)St("Buon.mp3",.25);else if(Q&&gt&&Sc.current){const m=Sc.current;(m.instanceId!==gt.instanceId||m.index!==gt.index||m.playerId!==gt.playerId)&&St("Buon.mp3",.25)}Sc.current=gt},[gt,Q,St]);const In=F.useRef(null),[y2,Sm]=F.useState(!1);F.useEffect(()=>{localStorage.setItem("audioSettings",JSON.stringify(Ot)),In.current&&(In.current.volume=Ot.bgmEnabled?Ot.bgm:0,Ot.bgmEnabled?In.current.paused&&In.current.play().catch(m=>console.warn("Auto-play prevented",m)):In.current.pause())},[Ot]);const[v2,wc]=F.useState(!1),[x2,Cf]=F.useState(!1),[_2,Ic]=F.useState(!1),b2=F.useCallback(()=>{console.log("[GameScreen] handleSurrender called"),Ic(!1),wc(!1),n!=="CPU"&&_&&_.send({type:"SURRENDER",payload:{playerId:O}}),I({type:"CONCEDE",playerId:O})},[n,_,O]),[Jr,kf]=F.useState(!1),Rf=F.useRef(!1),[wm,Im]=F.useState(!1),[ct,yi]=F.useState(null),so=F.useRef(null),io=F.useRef(null),pr=F.useRef([]),Lr=F.useRef([]),vi=F.useRef(null),[E2,Tc]=F.useState([]),Cc=F.useRef({player:20,opponent:20}),kc=F.useRef({player:0,opponent:0}),Sa=F.useRef(new Map);F.useEffect(()=>{var $,V,q,B;if(!le||!Ne)return;const m=Cc.current.opponent-Ne.hp;m>0&&gi(z=>({...z,damageDealtToOpponent:z.damageDealtToOpponent+m}));const x=Cc.current.player-le.hp;x>0&&gi(z=>({...z,damageReceivedFromOpponent:z.damageReceivedFromOpponent+x}));const b=kc.current.opponent-((($=Ne.board)==null?void 0:$.filter(z=>z).length)||0);b>0&&gi(z=>({...z,followersDestroyed:z.followersDestroyed+b}));const L=kc.current.player-(((V=le.board)==null?void 0:V.filter(z=>z).length)||0);L>0&&gi(z=>({...z,myFollowersDestroyed:z.myFollowersDestroyed+L})),Cc.current={player:le.hp,opponent:Ne.hp},kc.current={player:((q=le.board)==null?void 0:q.filter(z=>z).length)||0,opponent:((B=Ne.board)==null?void 0:B.filter(z=>z).length)||0}},[le==null?void 0:le.hp,Ne==null?void 0:Ne.hp,(Wm=le==null?void 0:le.board)==null?void 0:Wm.length,(Gm=Ne==null?void 0:Ne.board)==null?void 0:Gm.length]);const dn=F.useRef(null),Tm="lastPlayedBgm",Cm=F.useCallback(m=>{const x={AJA:[it("/bgm/Green Misty Mountains.mp3"),it("/bgm/Jade Moon.mp3"),it("/bgm/amaama.mp3"),it("/bgm/kingetsu.mp3")],SENKA:[it("/bgm/ouka.mp3"),it("/bgm/Jade Moon.mp3"),it("/bgm/amaama.mp3"),it("/bgm/kingetsu.mp3")]},b=x[m]||x.SENKA,L=sessionStorage.getItem(Tm),$=b.length>1?b.filter(q=>q!==L):b,V=$[Math.floor(Math.random()*$.length)];return sessionStorage.setItem(Tm,V),encodeURI(V)},[]),[Af,km]=F.useState(null);F.useEffect(()=>{var m,x;if(console.log(`[PendingEffects] useEffect fired. isProcessingEffect=${bf}, pendingEffects.length=${((m=g.pendingEffects)==null?void 0:m.length)||0}, gameMode=${n}`),n==="JOIN"){console.log("[PendingEffects] Early return: JOIN mode waits for EFFECT messages from HOST");return}if(bf){console.log("[PendingEffects] Early return: isProcessingEffect=true");return}if(g.pendingEffects&&g.pendingEffects.length>0){const b=g.pendingEffects[0];if(console.log(`[PendingEffects] Processing effect: ${b.effect.type} from ${b.sourceCard.name}`),xc.current===b){console.log("[PendingEffects] Early return: same effect already processed");return}if(xc.current=b,ya(!0),Yr.current=!0,b.effect.type==="GENERATE_CARD"&&b.effect.targetCardId){const me=[b],X=g.pendingEffects||[];for(let Ae=1;Ae<X.length;Ae++){const be=X[Ae];if(be.effect.type==="GENERATE_CARD"&&be.sourceCard.id===b.sourceCard.id&&be.sourcePlayerId===b.sourcePlayerId)me.push(be);else break}const ce=120,se=20,G=-(me.length*ce+(me.length-1)*se-ce)/2,oe=b.sourcePlayerId===O,ye=oe?window.innerWidth-200*h:200*h,Le=oe?window.innerHeight-100*h:100*h,Ce=me.map((Ae,be)=>({card:es(Ae.effect.targetCardId),status:"APPEAR",targetX:ye,targetY:Le,xOffset:G+be*(ce+se)})).filter(Ae=>Ae.card);if(Ce.length>0){xa(Ce),dn.current&&clearTimeout(dn.current),dn.current=setTimeout(()=>{xa(Ae=>Ae.map(be=>({...be,status:"FLY"}))),dn.current=setTimeout(()=>{xa([]),ya(!1),Yr.current=!1,(n==="CPU"||n==="HOST")&&(me.forEach(Ae=>{I({type:"RESOLVE_EFFECT",playerId:Ae.sourcePlayerId,payload:{targetId:Ae.targetId}})}),n==="HOST"&&v&&_&&setTimeout(()=>{const Ae=ot.current;_.send({type:"GAME_STATE",payload:Ae})},50)),dn.current=null},600)},800);return}}const L=b.effect.type==="DAMAGE"||b.effect.type==="AOE_DAMAGE"||b.effect.type==="RANDOM_DAMAGE"||b.effect.type==="RANDOM_DAMAGE_BY_TURN",$=b.effect.type==="DESTROY"||b.effect.type==="RANDOM_DESTROY",V=b.effect.type==="HEAL_LEADER",q=b.effect.type==="RANDOM_SET_HP",B=b.effect.type==="SET_MAX_HP",z=b.effect.type==="RETURN_TO_HAND",Y=b.effect.type==="SUMMON_CARD"||b.effect.type==="SUMMON_CARD_RUSH",ue=b.effect.type==="VISUAL_BUFF_ONLY",ee=b.effect.type==="BUFF_STATS",ge=V||z||Y||ue||ee?600:50;if(L){let me=b.sourceCard.attackEffectType||"SLASH";b.sourceCard.id==="c_alice"&&b.effect.targetType==="SELECT_FOLLOWER"&&(me="WATER");const X=b.sourcePlayerId===O?T:O,ce=X===O?wn:mn;if(b.effect.type==="AOE_DAMAGE")g.players[X].board.forEach(ae=>{if(ae){const G=ce.findIndex(oe=>(oe==null?void 0:oe.instanceId)===ae.instanceId);G!==-1&&hr(me,X,G,ae.instanceId)}});else if(b.targetIds)b.effect.type==="RANDOM_DAMAGE_BY_TURN"?b.targetIds.forEach((ae,G)=>{setTimeout(()=>{const oe=ce.findIndex(ye=>(ye==null?void 0:ye.instanceId)===ae);oe!==-1&&hr(me,X,oe,ae)},G*300)}):b.targetIds.forEach(se=>{const ae=ce.findIndex(G=>(G==null?void 0:G.instanceId)===se);ae!==-1&&hr(me,X,ae,se)});else if(b.effect.targetType==="OPPONENT")hr(me,X,-1),Gn();else if(b.targetId){const se=ce.findIndex(ae=>(ae==null?void 0:ae.instanceId)===b.targetId);se!==-1&&hr(me,X,se,b.targetId)}}else if($){let me=b.sourceCard.attackEffectType||"IMPACT";const X=b.sourcePlayerId===O?T:O,ce=X===O?wn:mn;if(b.effect.targetType==="ALL_OTHER_FOLLOWERS"){ce.forEach((G,oe)=>{G&&G.instanceId!==b.sourceCard.instanceId&&hr(me,X,oe,G.instanceId)});const se=b.sourcePlayerId;(se===O?wn:mn).forEach((G,oe)=>{G&&G.instanceId!==b.sourceCard.instanceId&&hr(me,se,oe,G.instanceId)}),Gn()}else if(b.targetIds)b.targetIds.forEach(se=>{const ae=ce.findIndex(G=>(G==null?void 0:G.instanceId)===se);ae!==-1&&hr(me,X,ae,se)});else if(b.targetId){const se=ce.findIndex(ae=>(ae==null?void 0:ae.instanceId)===b.targetId);se!==-1&&hr(me,X,se,b.targetId)}}else if(V){const me=b.sourcePlayerId;hr("HEAL",me)}else if(B){const me=b.sourcePlayerId===O?T:O;hr("RAY",me,-1),Gn()}if(b.effect.type==="BUFF_STATS"){const me=b.effect.value??0,X=b.effect.value2??0,ce=b.sourcePlayerId;if(b.effect.targetType==="SELF"){const ae=(ce===O?wn:mn).findIndex(G=>(G==null?void 0:G.instanceId)===b.sourceCard.instanceId);ae!==-1&&_a(ce,ae,me,X,b.sourceCard.instanceId)}else if(b.effect.targetType==="ALL_FOLLOWERS"){const se=ce===O?wn:mn,ae=g.players[ce].board,G=b.effect.conditions;ae.forEach(oe=>{var ye;if(oe){if(G!=null&&G.tag&&!((ye=oe.tags)!=null&&ye.includes(G.tag))||G!=null&&G.nameIn&&!G.nameIn.includes(oe.name))return;const Le=se.findIndex(Ce=>(Ce==null?void 0:Ce.instanceId)===oe.instanceId);Le!==-1&&_a(ce,Le,me,X,oe.instanceId)}})}else if(b.effect.targetType==="ALL_OTHER_FOLLOWERS"){const se=ce===O?wn:mn,ae=g.players[ce].board,G=b.effect.conditions;ae.forEach(oe=>{var ye;if(oe&&oe.instanceId!==b.sourceCard.instanceId){if(G!=null&&G.tag&&!((ye=oe.tags)!=null&&ye.includes(G.tag))||G!=null&&G.nameIn&&!G.nameIn.includes(oe.name))return;const Le=se.findIndex(Ce=>(Ce==null?void 0:Ce.instanceId)===oe.instanceId);Le!==-1&&_a(ce,Le,me,X,oe.instanceId)}})}else if(b.targetId){const ae=(ce===O?wn:mn).findIndex(G=>(G==null?void 0:G.instanceId)===b.targetId);ae!==-1&&_a(ce,ae,me,X,b.targetId)}}if(ue){const me=b.effect.value??0,X=b.effect.value2??0,ce=b.sourcePlayerId,se=b.sourceCard;setTimeout(()=>{const ae=ce===O?wn:mn;if(se!=null&&se.instanceId){const G=ae.findIndex(oe=>(oe==null?void 0:oe.instanceId)===se.instanceId);G!==-1&&_a(ce,G,me,X,se.instanceId)}},300)}dn.current&&clearTimeout(dn.current);const qe=L||$||q||B,Te=b.effect.type==="RANDOM_DAMAGE_BY_TURN",Je=Te?((x=b.targetIds)==null?void 0:x.length)||g.turnCount:1,rt=Te?Je*300+300:0,Ke=Te?rt:qe?700:ge,Xe=Te?200:qe?700:0;dn.current=setTimeout(()=>{(n==="CPU"||n==="HOST")&&(I({type:"RESOLVE_EFFECT",playerId:b.sourcePlayerId,payload:{targetId:b.targetId}}),n==="HOST"&&v&&_&&setTimeout(()=>{const me=ot.current;_.send({type:"GAME_STATE",payload:me})},50)),Xe>0?dn.current=setTimeout(()=>{ya(!1),Yr.current=!1,dn.current=null},Xe):(ya(!1),Yr.current=!1,dn.current=null)},Ke)}else xc.current=null,dn.current&&(clearTimeout(dn.current),dn.current=null)},[g.pendingEffects,bf,O,T,n,v,_]),F.useEffect(()=>{if(g.activePlayerId!==O)return;const m=O===g.firstPlayerId,x=g.turnCount,b=m?5:4;if(x===(m?7:6)){if(Ef===x)return;vc("SUPER_EVOLVE_READY"),um(x),setTimeout(()=>vc(null),2500)}else if(x===b){if(Ef===x)return;vc("EVOLVE_READY"),um(x),setTimeout(()=>vc(null),2500)}},[g.turnCount,g.activePlayerId,O,Ef,g.firstPlayerId]);const Rc=F.useRef(g.players);F.useEffect(()=>{const m=Rc.current,x=new Set;if(Object.keys(g.players).forEach(b=>{const L=g.players[b],$=m[b];if(!$)return;const V=new Set($.board.filter(B=>B).map(B=>B.instanceId)),q=new Set($.hand.filter(B=>B).map(B=>B.instanceId));L.board.forEach(B=>{if(!B)return;const z=B.instanceId;!V.has(z)&&!q.has(z)&&x.add(z)})}),x.size>0){Sf(L=>new Set([...L,...x]));const b=setTimeout(()=>{Sf(new Set)},1e3);return()=>clearTimeout(b)}},[g.players]),F.useEffect(()=>{const m=Rc.current,x=g.players;let b=[];const L=$=>{const V=$.getBoundingClientRect();return{x:V.left+V.width/2,y:V.top+V.height/2}};Object.keys(x).forEach($=>{const V=x[$],q=m[$];if(q&&V.hp<q.hp){const B=q.hp-V.hp,Y=$===O?vi.current:io.current;if(Y){const ue=L(Y);b.push({id:Date.now()+Math.random(),value:B,x:ue.x,y:ue.y,color:"#e53e3e"})}}else if(q&&V.hp>q.hp){const B=V.hp-q.hp,Y=$===O?vi.current:io.current;if(Y){const ue=L(Y);b.push({id:Date.now()+Math.random(),value:"+"+B,x:ue.x,y:ue.y,color:"#48bb78"})}}q==null||q.board.forEach(B=>{if(!B)return;const z=V.board.find(Y=>(Y==null?void 0:Y.instanceId)===B.instanceId);if(z){const Y=V.board.findIndex(Ee=>(Ee==null?void 0:Ee.instanceId)===z.instanceId),ge=($===O?Lr.current:pr.current)[Y];if(ge){const Ee=L(ge);if(Sa.current.set(B.instanceId,Ee),z.currentHealth<B.currentHealth){const qe=B.currentHealth-z.currentHealth;b.push({id:Date.now()+Math.random(),value:qe,x:Ee.x,y:Ee.y,color:"#e53e3e"})}else if(z.currentHealth>B.currentHealth){const qe=z.hasEvolved&&!B.hasEvolved,Te=z.currentAttack!==B.currentAttack||z.maxHealth!==B.maxHealth;if(!qe&&!Te){const Je=z.currentHealth-B.currentHealth;b.push({id:Date.now()+Math.random(),value:"+"+Je,x:Ee.x,y:Ee.y,color:"#48bb78"})}}else z.currentHealth===B.currentHealth&&B.hasBarrier&&!z.hasBarrier&&b.push({id:Date.now()+Math.random(),value:0,x:Ee.x,y:Ee.y,color:"#e53e3e"})}}else{const Y=V.graveyard.find(ee=>ee.instanceId===B.instanceId);let ue=0;if(Y){const ee=Y.currentHealth||0;ee<=0?ue=B.currentHealth-ee:ue=0}else ue=B.currentHealth;if(ue>0){const ee=Sa.current.get(B.instanceId);ee&&(ee.x!==0||ee.y!==0)&&b.push({id:Date.now()+Math.random(),value:ue,x:ee.x,y:ee.y,color:"#e53e3e"})}Sa.current.delete(B.instanceId)}})}),b.length>0&&(Tc(V=>[...V,...b]),b.some(V=>V.color!=="#48bb78")&&Gn()),Rc.current=x},[g.players,O,T]);const Pf=F.useRef(null),Gn=()=>{Pf.current||(Im(!0),Pf.current=setTimeout(()=>{Im(!1),Pf.current=null},300))},Of=A.useCallback(m=>{Tc([]),ro([]),xa([]),Vn(null),oo(null),ba(null),Sf(new Set),_s.current=!1,Lf.current=null,gi({turnCount:0,damageDealtToOpponent:0,damageReceivedFromOpponent:0,followersDestroyed:0,myFollowersDestroyed:0}),Cc.current={player:20,opponent:20},kc.current={player:0,opponent:0},ga(null),_e(!1),et(!1),nt(null),cc(!1),pa(!1);const x=m||er;m&&hc(m);let b=k;e==="CPU"&&(x==="YORUKA"?b=Math.random()<.5?"SENKA":"AJA":b=x==="SENKA"?"AJA":"SENKA");const $=bd(u,x,e==="ONLINE"?"":"CPU",b);Rc.current=$.players,Tf.current={player:$.players.p1.hand.length,opponent:$.players.p2.hand.length},km(null),ve(n!=="JOIN"),eo(Math.random()>.5),E("IDLE"),ys(null),pi(!1),n==="HOST"&&(gc.current=!1),I({type:"SYNC_STATE",payload:$})},[er,k,e,n]),S2=A.useCallback(()=>{if(ve(!1),Ie(!1),K(!0),ys(fr?"FIRST":"SECOND"),!fr){const m={...g,activePlayerId:"p2",firstPlayerId:"p2",players:{p1:{...g.players.p1,maxPp:0,pp:0},p2:{...g.players.p2,maxPp:1,pp:1}},logs:[` 1 - ${g.players.p2.name} `]};I({type:"SYNC_STATE",payload:m})}E("DONE")},[g,fr]);A.useEffect(()=>{},[g.phase,Ye,n,St,v]),F.useEffect(()=>{if(Af===le.class&&In.current)return;const m=Cm(le.class);console.log(`[BGM] Initializing track: ${m} for class: ${le.class}`),In.current&&(In.current.pause(),In.current=null);const x=new Audio(m);x.loop=!0,x.volume=Ot.bgm,In.current=x,km(le.class)},[le.class,Cm,Af]),F.useEffect(()=>()=>{In.current&&(console.log("[GameScreen] Stopping BGM on unmount"),In.current.pause(),In.current=null)},[]),F.useEffect(()=>{if(!In.current)return;const m=In.current,x=()=>{m.paused&&Ot.bgmEnabled&&(console.log("[BGM] Attempting play on interaction..."),m.play().then(()=>{console.log("[BGM] Play success"),b()}).catch(L=>console.warn("[BGM] Play failed on interaction:",L)))},b=()=>{document.removeEventListener("click",x),document.removeEventListener("keydown",x),document.removeEventListener("touchstart",x)};return Ot.bgmEnabled?(document.addEventListener("click",x),document.addEventListener("keydown",x),document.addEventListener("touchstart",x),m.play().then(()=>{console.log("[BGM] Immediate play success"),b()}).catch(()=>console.log("[BGM] Immediate play blocked, waiting for interaction"))):(m.pause(),b()),()=>{b()}},[Ot.bgmEnabled,Ot.bgm,Af]),A.useEffect(()=>{if(!_){console.log("[GameScreen] Message handler setup skipped - no adapter yet");return}console.log("[GameScreen] Setting up message handler, adapter.isHost:",_.isHost);const m=x=>{var b,L,$,V,q;if(console.log("[GameScreen] Received message:",x.type,x),x.type==="HANDSHAKE"){const B=(b=x.payload)==null?void 0:b.name,z=typeof B=="string"&&B.trim().slice(0,12)||"";console.log("[GameScreen] Received HANDSHAKE from opponent:",z),mc.current=z,I({type:"UPDATE_PLAYER_NAME",payload:{playerId:O==="p1"?"p2":"p1",name:z}});return}if(x.type==="INIT_GAME"){console.log("[GameScreen] JOIN side: Received initial game state from HOST"),I({type:"SYNC_STATE",payload:x.payload}),I({type:"UPDATE_PLAYER_NAME",payload:{playerId:O,name:u}});const B=O==="p1"?"p2":"p1";mc.current&&(console.log("[GameScreen] Re-applying opponent name after INIT_GAME:",mc.current),I({type:"UPDATE_PLAYER_NAME",payload:{playerId:B,name:mc.current}})),N(!0);const z=x.payload.firstPlayerId===O;console.log("[GameScreen] JOIN side: Setting isFirstPlayer, firstPlayerId:",x.payload.firstPlayerId,"currentPlayerId:",O,"isJoinSideFirst:",z),eo(z),n==="CASUAL_MATCH"||n==="RANKED_MATCH"?console.log("[GameScreen] CASUAL_MATCH JOIN side: Waiting for intro sync"):ve(!0);return}if(x.type==="READY_FOR_INTRO"){console.log("[GameScreen] Received READY_FOR_INTRO from opponent"),vt(!0);return}if(x.type==="START_INTRO"){console.log("[GameScreen] Received START_INTRO - starting BattleIntro now"),Se(!1),ve(!0);return}if(x.type==="GAME_STATE"){console.log("[GameScreen] JOIN: Received GAME_STATE sync from HOST"),I({type:"SYNC_STATE",payload:x.payload}),ya(!1),Yr.current=!1,xc.current=null,xa([]),dn.current&&(clearTimeout(dn.current),dn.current=null),!Ia.current&&!lo.current&&(yn.current=!1);return}if(x.type==="EFFECT"){const{effectType:B,targetPlayerId:z,targetIndex:Y,targetInstanceId:ue,isBuff:ee,atkBuff:ge,hpBuff:Ee}=x.payload;console.log("[GameScreen] JOIN: Received EFFECT from HOST:",B,z,Y,ue),setTimeout(()=>{ee&&ge!==void 0&&Ee!==void 0?_m(z,Y,ge,Ee,ue):Xt(B,z,Y,ue)},50);return}if(x.type==="EVOLVE_ANIM"){const{playerId:B,followerIndex:z,useSep:Y,targetId:ue,instanceId:ee}=x.payload,ge=(L=g.players[B])==null?void 0:L.board[z];if(ge){const Ee=ge.evolvedImageUrl||(($=es(ge.id))==null?void 0:$.evolvedImageUrl),qe=ee||ge.instanceId,Te=mn.findIndex(X=>X&&X.instanceId===qe),Je=Te>=0?pr.current[Te]:null,rt=de.current.scale,Ke=window.innerHeight/2;let Xe=window.innerWidth/2,me=Ke-70*rt;if(Je){const X=Je.getBoundingClientRect();Xe=X.left+X.width/2,me=X.top+X.height/2}oo({card:ge,evolvedImageUrl:Ee,startX:Xe,startY:me,phase:"ZOOM_IN",followerIndex:z,sourcePlayerId:B,useSep:Y||!1,targetId:ue,isRemote:!0}),St("fon.mp3",.7)}return}if(x.type==="PLAY_CARD_ANIM"){const{playerId:B,card:z,targetBoardIndex:Y}=x.payload;if(z){const ue=((V=g.players[B])==null?void 0:V.board)||[],ee=typeof Y=="number"?Y:ue.filter(G=>G!==null).length,ge=de.current.scale,Ee=window.innerWidth/2,qe=window.innerHeight/2,Te=Ee,Je=80*ge,rt=Ee,Ke=qe-100*ge,ce=-((Math.max(1,ee+1)-1)*_i*ge)/2+ee*_i*ge,se=Ee+ce,ae=qe-70*ge;z.type==="SPELL"?Vn({card:z,sourceIndex:-1,startX:Te,startY:Je,targetX:rt,targetY:Ke,playerClass:(Ne==null?void 0:Ne.class)||"SENKA",onComplete:()=>{Vn(null)}}):Vn({card:z,sourceIndex:-1,startX:Te,startY:Je,targetX:rt,targetY:Ke,finalX:se,finalY:ae,playerClass:(Ne==null?void 0:Ne.class)||"SENKA",onComplete:()=>{St("gan.mp3",.6),Gn(),Vn(null)}})}return}if(x.type==="REMATCH_REQUEST"){console.log("[GameScreen] Opponent requested rematch"),pa(!0);return}if(x.type==="REMATCH_ACCEPT"){console.log("[GameScreen] Opponent accepted rematch - starting new game"),Of(er);return}if(x.type==="SURRENDER"){const B=(q=x.payload)==null?void 0:q.playerId;if(g.phase==="GAME_OVER"){console.warn("[GameScreen] Ignoring SURRENDER - game already over");return}if(B===O){console.warn(`[GameScreen] Security Alert: Received SURRENDER message targeting self (${O}). Ignoring.`);return}if(B!==T){console.warn(`[GameScreen] Security Alert: Invalid playerId in SURRENDER: ${B}. Expected: ${T}. Ignoring.`);return}console.log("[GameScreen] Opponent surrendered:",B),fc("surrender"),I({type:"CONCEDE",playerId:B});return}if(x.type==="STAMP"){console.log("[GameScreen] Opponent sent stamp:",x.stampId),Pr.current&&(clearTimeout(Pr.current),Pr.current=null);const B=lv(x.stampId);B&&St(B,.6);const z={stampId:x.stampId,playerId:T,playerClass:x.playerClass||(Ne==null?void 0:Ne.class)||"SENKA",timestamp:Date.now()};tr(null),requestAnimationFrame(()=>{tr(z)}),Pr.current=setTimeout(()=>{tr(Y=>(Y==null?void 0:Y.timestamp)===z.timestamp?null:Y),Pr.current=null},3e3);return}if(x.type==="ACTION"){const B=x.payload;if(console.log("[GameScreen] Processing remote action:",B.type,"from player:",B.playerId),I({...B,isRemote:!0}),B.type==="ATTACK"){const{playerId:z,payload:Y}=B,ue=g.players[z],ee=ue==null?void 0:ue.board[Y.attackerIndex],ge=Y.targetIsLeader?-1:Y.targetIndex,Ee=z==="p1"?"p2":"p1";if(ee){const qe=g.players[Ee],Te=Y.targetIsLeader?null:qe==null?void 0:qe.board[Y.targetIndex],Je=Te?Te.instanceId:void 0;Xt(ee.attackEffectType,Ee,ge,Je)}}else B.type==="PLAY_CARD"||B.type==="EVOLVE"||B.type==="END_TURN"&&(console.log("[GameScreen] Remote END_TURN received, turn switching to:",B.playerId==="p1"?"p2":"p1"),ao.current=!1)}};return _.onMessage(m),n!=="CPU"&&!dm.current&&(dm.current=!0,_.send({type:"HANDSHAKE",payload:{name:u,class:t}}),console.log("[GameScreen] Sent HANDSHAKE:",u,t)),_.onClose(()=>{if((n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&g.phase==="GAME_OVER"){console.log("[GameScreen] Connection closed after game over (casual match) - silent disconnect");return}if(n!=="CPU"&&g.phase!=="GAME_OVER"){console.log("[GameScreen] Opponent disconnected during game - treating as surrender, player wins"),fc("disconnect");const x={...g,phase:"GAME_OVER",winnerId:O,logs:[...g.logs,""]};I({type:"SYNC_STATE",payload:x});return}alert(`
`),s()}),()=>{}},[_,g,St,Xt,n,s,O]);const _s=F.useRef(!1),Lf=F.useRef(null),Mn=F.useRef(null),[Qe,Vn]=F.useState(null),[jt,oo]=F.useState(null),yn=F.useRef(!1),wa=F.useRef(null),ao=F.useRef(!1),Df=F.useRef(Ec),Mf=F.useRef(no),Ia=F.useRef(Qe),lo=F.useRef(jt);A.useEffect(()=>{Df.current=Ec,Mf.current=no,Ia.current=Qe,lo.current=jt},[Ec,no,Qe,jt]),A.useEffect(()=>{if(Qe&&Qe.card.name===""&&Ot.seEnabled){const m=new Audio(it("/se/beam.mp3"));m.volume=Ot.se*.8,m.play().catch(x=>console.warn("SE Play prevented",x))}},[Qe,Ot]),A.useEffect(()=>{va.current=wn,yc.current=mn},[wn,mn]),A.useEffect(()=>{const m=x=>{const b=x.getBoundingClientRect();return{x:b.left+b.width/2,y:b.top}};wn.forEach((x,b)=>{if(x&&x.instanceId){const L=Lr.current[b];if(L){const $=m(L);($.x!==0||$.y!==0)&&Sa.current.set(x.instanceId,$)}}}),mn.forEach((x,b)=>{if(x&&x.instanceId){const L=pr.current[b];if(L){const $=m(L);($.x!==0||$.y!==0)&&Sa.current.set(x.instanceId,$)}}})},[wn,mn]);const Ac=(m,x,b,L)=>{const $=Dr.current.board,V=L?$.findIndex(ee=>ee&&ee.instanceId===L):m,q=V>=0?$[V]:null;if(!q)return;if(q.hasEvolved){console.log("[GameScreen] Cannot evolve: card already evolved");return}const B=Lr.current[m];let z=window.innerWidth/2,Y=window.innerHeight/2;if(B){const ee=B.getBoundingClientRect();z=ee.left+ee.width/2,Y=ee.top+ee.height/2}const ue=q.instanceId;n!=="CPU"&&v&&_&&_.send({type:"EVOLVE_ANIM",payload:{playerId:O,followerIndex:V,useSep:x,targetId:b,instanceId:ue}}),oo({card:q,evolvedImageUrl:q.evolvedImageUrl,startX:z,startY:Y,phase:"ZOOM_IN",followerIndex:V,useSep:x,targetId:b,sourcePlayerId:O}),St("fon.mp3",.7)},Nf=F.useRef(null),w2=F.useCallback(m=>{if(console.log("[GameScreen] handleEvolvePhaseChange:",m),m==="WHITE_FADE"&&St("fon.mp3",.7),m==="LAND"&&St("gan.mp3",.6),m==="DONE"){const x=lo.current;if(x&&!x.isRemote){const L={type:"EVOLVE",playerId:x.sourcePlayerId||O,payload:{followerIndex:x.followerIndex,useSep:x.useSep,targetId:x.targetId}};I(L),_&&n!=="CPU"&&_.send({type:"ACTION",payload:L})}oo(null)}else oo(x=>x?{...x,phase:m}:null)},[_,I,n,O,St]),jf=(m,x,b)=>{var Xe,me,X,ce,se,ae;const $=Dr.current.hand[m];if(!$){console.warn("[handlePlayCard] Card not found at index:",m);return}if($.instanceId&&wa.current===$.instanceId){console.warn("[handlePlayCard] Duplicate play blocked for instanceId:",$.instanceId);return}if(yn.current){console.warn("[handlePlayCard] Card play locked, ignoring duplicate call");return}yn.current=!0,wa.current=$.instanceId||null,St("card.mp3",.5);const V=(Xe=$.triggers)==null?void 0:Xe.find(G=>G.trigger==="FANFARE"),q=V==null?void 0:V.effects[0];let B=T;const z=(q==null?void 0:q.targetType)==="SELECT_ALLY_FOLLOWER"||(q==null?void 0:q.targetType)==="SELECT_OTHER_ALLY_FOLLOWER";q&&(z||["GRANT_PASSIVE","BUFF_STATS","HEAL_FOLLOWER"].includes(q.type))&&(B=O);const Y=["SELECT_FOLLOWER","SELECT_ALLY_FOLLOWER","SELECT_OTHER_ALLY_FOLLOWER"],ue=$.type==="SPELL"&&((me=$.triggers)==null?void 0:me.some(G=>G.effects.some(oe=>oe.targetType&&Y.includes(oe.targetType))))||$.type==="FOLLOWER"&&(((ce=(X=$.triggerAbilities)==null?void 0:X.FANFARE)==null?void 0:ce.targetType)&&Y.includes($.triggerAbilities.FANFARE.targetType)||((se=$.triggers)==null?void 0:se.some(G=>G.trigger==="FANFARE"&&G.effects.some(oe=>oe.targetType&&Y.includes(oe.targetType))))),ge=ot.current.players[B].board.some(G=>{var oe,ye;return G&&(B===O||!((oe=G.passiveAbilities)!=null&&oe.includes("STEALTH"))&&!((ye=G.passiveAbilities)!=null&&ye.includes("AURA")))});if(console.log(`[handlePlayCard] needsTarget: ${ue}, allowedTarget: ${B}, hasValidTargets: ${ge}`),ue&&ge){yi({type:"PLAY",sourceIndex:m,sourceInstanceId:$.instanceId,allowedTargetPlayerId:B}),Kr(null);return}const Ee=window.innerWidth/2,qe=window.innerHeight/2;let Te,Je;if($.type==="FOLLOWER"){const oe=ot.current.players[O].board.filter(Pe=>Pe!==null),ye=oe.length+1,Le=oe.length,Ce=_i*h,Ae=(Le-(ye-1)/2)*Ce,be=(ae=so.current)==null?void 0:ae.getBoundingClientRect();Te=(be?be.left+be.width/2:window.innerWidth/2)+Ae,Je=window.innerHeight/2+70*h}const rt=()=>{$.type!=="SPELL"&&(St("gan.mp3",.6),Gn()),bs({type:"PLAY_CARD",playerId:O,payload:{cardIndex:m,instanceId:$.instanceId}}),Vn(null),setTimeout(()=>{yn.current=!1},100)},Ke=$.type==="FOLLOWER"?ot.current.players[O].board.filter(G=>G!==null).length:void 0;n!=="CPU"&&v&&_&&_.send({type:"PLAY_CARD_ANIM",payload:{playerId:O,cardIndex:m,card:$,targetBoardIndex:Ke}}),Vn({card:$,sourceIndex:m,startX:x,startY:b,targetX:Ee,targetY:qe,finalX:Te,finalY:Je,playerClass:(le==null?void 0:le.class)||"SENKA",onComplete:rt}),setTimeout(()=>{Vn(G=>(G==null?void 0:G.card.id)===$.id?(rt(),null):G)},2e3)},bs=m=>{I(m),n!=="CPU"&&v&&!m.isRemote&&(_==null||_.send({type:"ACTION",payload:m}))};F.useEffect(()=>{if(!jt&&Nf.current){const m=Nf.current;Nf.current=null,console.log("[GameScreen] Dispatching pending evolve action for:",m.playerId),bs({type:"EVOLVE",playerId:m.playerId,payload:{followerIndex:m.followerIndex,useSep:m.useSep,targetId:m.targetId}})}},[jt,O,bs]);const Dr=F.useRef(le),ot=F.useRef(g);F.useEffect(()=>{Dr.current=le,ot.current=g},[le,g]);const gr=F.useRef(!1);F.useEffect(()=>{const m=Tf.current,x=le.hand.length,b=Ne.hand.length;if(x>m.player){const L=x-m.player;ba({isPlayer:!0,count:L}),St("card.mp3",.5),setTimeout(()=>ba(null),If)}if(b>m.opponent){const L=b-m.opponent;ba({isPlayer:!1,count:L}),St("card.mp3",.5),setTimeout(()=>ba(null),If)}Tf.current={player:x,opponent:b}},[le.hand.length,Ne.hand.length,Ot,St]),A.useEffect(()=>{g.activePlayerId===O&&(console.log("[GameScreen] Player turn started - resetting card play lock and ending turn state"),yn.current=!1,wa.current=null,ao.current=!1)},[g.activePlayerId,g.turnCount,O]),A.useEffect(()=>{if(n==="CPU")return;const m=setInterval(()=>{yn.current&&!Ia.current&&!lo.current&&!ct&&g.activePlayerId===O&&(console.warn("[GameScreen] Safety release: Card play lock was stuck, releasing"),yn.current=!1)},3e3);return()=>clearInterval(m)},[n,ct,g.activePlayerId,O]),A.useEffect(()=>{if(n!=="CPU")return;if(g.winnerId){_s.current=!1;return}const m=`${g.turnCount}-${g.activePlayerId}`;if(g.activePlayerId===O){_s.current=!1;return}if(g.activePlayerId===T){if(_s.current||Lf.current===m)return;(async()=>{var Te,Je,rt,Ke,Xe,me;_s.current=!0,Lf.current=m;const b=async(X=300)=>{await new Promise(ae=>setTimeout(ae,X));const ce=()=>{const ae=ot.current,G=ae.pendingEffects&&ae.pendingEffects.length>0,oe=Df.current.length>0,ye=Mf.current.length>0,Le=Ia.current!==null,Ce=lo.current!==null;return!G&&!oe&&!ye&&!Le&&!Ce};let se=0;for(;!ce()&&se<60;){await new Promise(G=>setTimeout(G,100)),se++;const ae=ot.current;if(ae.pendingEffects&&ae.pendingEffects.length>0&&!Yr.current){console.log("[waitForIdle] Forcing RESOLVE_EFFECT for stuck pending effect");const G=ae.pendingEffects[0];I({type:"RESOLVE_EFFECT",playerId:G.sourcePlayerId,payload:{targetId:G.targetId}}),await new Promise(oe=>setTimeout(oe,200))}}},L=(X,ce)=>{var se;return X?!!((se=X.passiveAbilities)!=null&&se.includes("IMMUNE_TO_FOLLOWER_DAMAGE")):!1},$=(X,ce)=>{var se;return!ce||!X?!1:(se=ce.passiveAbilities)!=null&&se.includes("BANE")&&!X.hasBarrier?!0:(ce.currentAttack||0)>=X.currentHealth},V=(X,ce)=>{var se;return!ce||!X?!1:(se=X.passiveAbilities)!=null&&se.includes("BANE")?!ce.hasBarrier:X.currentAttack>=ce.currentHealth},q=X=>{var oe,ye,Le;let ce=0;const se=X.players[T].board.filter(Ce=>Ce!==null),G=X.players[O].board.filter(Ce=>Ce!==null).some(Ce=>{var Ae,be;return((Ae=Ce.passiveAbilities)==null?void 0:Ae.includes("WARD"))&&!((be=Ce.passiveAbilities)!=null&&be.includes("STEALTH"))});for(const Ce of se)!Ce.canAttack||!((oe=Ce.passiveAbilities)!=null&&oe.includes("STORM")||Ce.turnPlayed!==X.turnCount)||G&&!((ye=Ce.passiveAbilities)!=null&&ye.includes("STEALTH"))&&!Ce.hadStealth||(ce+=Ce.currentAttack||0,(Le=Ce.passiveAbilities)!=null&&Le.includes("DOUBLE_ATTACK")&&(ce+=Ce.currentAttack||0));return ce},B=X=>{var ae,G,oe;let ce=0;const se=X.players[O].board.filter(ye=>ye!==null);for(const ye of se)ce+=ye.currentAttack||0,(ae=ye.passiveAbilities)!=null&&ae.includes("DOUBLE_ATTACK")&&(ce+=ye.currentAttack||0),(G=ye.passiveAbilities)!=null&&G.includes("BANE")&&(ce+=15),(oe=ye.passiveAbilities)!=null&&oe.includes("STORM")&&(ce+=10);return ce},z=(X,ce)=>{var Ae,be,Ze,Pe;let se=X.cost*10;const ae=ce.players[O].board.filter(Be=>Be!==null),G=ce.players[T].board.filter(Be=>Be!==null),oe=ce.players[O].hp,ye=ce.players[T].hp,Le=ce.players[T].pp;if((Ae=X.passiveAbilities)!=null&&Ae.includes("STORM")){const Be=q(ce),je=X.attack||0;Be+je>=oe?se+=500:oe<=10?se+=100:se+=30}if(ae.length>0){const Be=X.triggers||[],je=B(ce);for(const kt of Be)if(kt.trigger==="FANFARE")for(const We of kt.effects||[]){if(We.type==="DESTROY"&&(se+=60+(je>10?30:0)),We.type==="RANDOM_DESTROY"){const tt=We.value||1;se+=40*tt+(je>10?20:0)}["DAMAGE","SELECT_DAMAGE"].includes(We.type)&&(se+=35),We.type==="AOE_DAMAGE"&&(se+=25*Math.min(ae.length,3))}}ye<=10&&((be=X.passiveAbilities)!=null&&be.includes("WARD")&&(se+=80),se+=20),X.cost===Le?se+=15:Le-X.cost<=1&&(se+=10);const Ce=X.triggers||[];for(const Be of Ce)if(Be.trigger==="FANFARE")for(const je of Be.effects||[])je.type==="DRAW"&&(se+=20*(je.value||1)),(je.type==="SUMMON_CARD"||je.type==="SUMMON_CARD_RUSH")&&(se+=30),je.type==="GENERATE_CARD"&&(se+=15),je.type==="HEAL"&&(se+=ye<15?25:10);return X.type==="FOLLOWER"&&((X.attack||0)+(X.health||0)>=X.cost*2.5&&(se+=15),(Ze=X.passiveAbilities)!=null&&Ze.includes("WARD")&&ae.length>0&&(se+=25),(Pe=X.passiveAbilities)!=null&&Pe.includes("BANE")&&(se+=20)),X.type==="FOLLOWER"&&G.length>=5&&(se-=200),se},Y=(X,ce,se,ae)=>{let G=0;const oe=se.players[O].board.filter(be=>be!==null),ye=se.players[T].board.filter(be=>be!==null),Le=X.triggers||[],Ce=ae?"SUPER_EVOLVE":"EVOLVE";let Ae=!1;for(const be of Le)if(be.trigger===Ce){Ae=!0;for(const Ze of be.effects||[]){if(["DESTROY","RANDOM_DESTROY","DAMAGE","SELECT_DAMAGE","AOE_DAMAGE"].includes(Ze.type)&&(G+=oe.length>0?80:5),["SUMMON_CARD","SUMMON_CARD_RUSH"].includes(Ze.type)&&(G+=60),Ze.type==="BUFF_STATS"){const Pe=Ze.targetType||"SELF";Pe==="ALL_OTHER_FOLLOWERS"||Pe==="ALL_FOLLOWERS"?G+=25*Math.max(1,ye.length-1):G+=30}Ze.type==="DRAW"&&(G+=35),Ze.type==="GENERATE_CARD"&&(G+=25)}}return X.canAttack?(G+=30,G+=(X.currentAttack||0)*5):G+=(X.currentAttack||0)*2,X.cost>=6&&Ae&&(G+=20),!Ae&&X.cost<=3&&(G-=30),G},ue=(X,ce)=>{const ae=X.players[T].board.filter(Pe=>Pe!==null),G=X.players[O].board.filter(Pe=>Pe!==null),oe=X.players[O].hp,ye=X.players[T].hp,Le=X.turnCount,Ce=ae.filter(Pe=>Pe&&!Pe.hasEvolved);if(Ce.length===0)return!1;const Ae=Ce.map((Pe,Be)=>({c:Pe,i:Be,score:Y(Pe,Be,X,ce)})),be=Math.max(...Ae.map(Pe=>Pe.score));if(oe<=12&&ae.some(Pe=>Pe&&Pe.canAttack)||ye<=10)return!0;const Ze=B(X);return Ze>=8&&Ce.some(Be=>{const je=Be.triggers||[];for(const kt of je)if(kt.trigger===(ce?"SUPER_EVOLVE":"EVOLVE")){for(const We of kt.effects||[])if(["DESTROY","RANDOM_DESTROY","DAMAGE","AOE_DAMAGE"].includes(We.type))return!0}return!1})&&G.length>0||be>=80||ce&&be>=50?!0:Le<=5&&ye>=15&&Ze<8?be>=100:be<30?!1:be>=50},ee=(X,ce,se)=>{var Le,Ce,Ae,be,Ze;const ae=((Le=X.passiveAbilities)==null?void 0:Le.includes("STORM"))||X.turnPlayed!==se.turnCount,G=ce.map((Pe,Be)=>({c:Pe,i:Be})).filter(({c:Pe})=>{var Be,je;return Pe!==null&&!((Be=Pe.passiveAbilities)!=null&&Be.includes("STEALTH"))&&!((je=Pe.passiveAbilities)!=null&&je.includes("AURA"))});if(!(((Ce=X.passiveAbilities)==null?void 0:Ce.includes("STEALTH"))||X.hadStealth)){const Pe=G.find(({c:Be})=>{var je;return(je=Be.passiveAbilities)==null?void 0:je.includes("WARD")});if(Pe)return L(Pe.c)?{index:-1,isLeader:!1}:{index:Pe.i,isLeader:!1}}let ye={index:-1,isLeader:ae,score:ae?0:-1e3};for(const{c:Pe,i:Be}of G){if(L(Pe))continue;let je=0;const kt=X.isEvolved,We=(Ae=Pe.passiveAbilities)==null?void 0:Ae.includes("BANE"),tt=$(X,Pe);V(X,Pe)?(je+=50,je+=(Pe.currentAttack||0)*5,tt?We&&kt?je-=60:We&&(je-=30):je+=30,We&&!tt&&(je+=40),(be=Pe.passiveAbilities)!=null&&be.includes("STORM")&&(je+=30),(Ze=Pe.passiveAbilities)!=null&&Ze.includes("DOUBLE_ATTACK")&&(je+=35)):!tt&&X.currentAttack>=Pe.currentHealth/2?je+=10:tt&&(je-=50,kt&&(je-=40),(Pe.currentAttack||0)>=5&&(je+=10)),je>ye.score&&(ye={index:Be,isLeader:!1,score:je})}return ae&&(ye.index===-1||ye.score<=0)?{index:-1,isLeader:!0}:ye},ge=d==="EASY"?1200:d==="HARD"?400:800;if(await new Promise(X=>setTimeout(X,ge)),!_s.current)return;let Ee=0;const qe=d==="EASY"?1:d==="HARD"?5:3;for(;Ee<qe;){const X=ot.current,ce=X.players[T].hand,se=X.players[T].pp,G=X.players[T].board.filter(We=>We!==null).length>=5;let oe=ce.map((We,tt)=>({...We,originalIndex:tt})).filter(We=>We.cost<=se).filter(We=>!(We.type==="FOLLOWER"&&G));if(oe.length===0||(d==="HARD"?oe=oe.sort((We,tt)=>z(tt,X)-z(We,X)):oe=oe.sort((We,tt)=>tt.cost-We.cost),d==="EASY"&&Math.random()<.3&&Ee>0))break;const ye=oe[0];let Le;const Ae=X.players[O].board.filter(We=>{var tt,bt;return We&&!((tt=We.passiveAbilities)!=null&&tt.includes("STEALTH"))&&!((bt=We.passiveAbilities)!=null&&bt.includes("AURA"))});Ae.length>0&&(d==="HARD"?Le=[...Ae].sort((tt,bt)=>{var wt,At;let ut=(tt.currentAttack||0)+(tt.currentHealth||0),xt=(bt.currentAttack||0)+(bt.currentHealth||0);return(wt=tt.passiveAbilities)!=null&&wt.includes("BANE")&&(ut+=10),(At=bt.passiveAbilities)!=null&&At.includes("BANE")&&(xt+=10),xt-ut})[0].instanceId:Le=Ae[0].instanceId);const be=window.innerWidth-20*h-80*h/2,Ze=20*h+110*h/2,Pe=window.innerWidth/2,Be=window.innerHeight/2;let je,kt;if(ye.type==="FOLLOWER"){const tt=ot.current.players[T].board.filter(Mc=>Mc!==null),bt=tt.length+1,ut=tt.length,xt=_i*h,wt=(ut-(bt-1)/2)*xt,At=(Te=so.current)==null?void 0:Te.getBoundingClientRect();je=(At?At.left+At.width/2:window.innerWidth/2)+wt,kt=window.innerHeight/2-70*h}Vn({card:ye,sourceIndex:-1,startX:be,startY:Ze,targetX:Pe,targetY:Be,finalX:je,finalY:kt,playerClass:(Ne==null?void 0:Ne.class)||"SENKA",onComplete:()=>{if(ye.type!=="SPELL"&&(St("gan.mp3",.6),Gn()),I({type:"PLAY_CARD",playerId:T,payload:{cardIndex:ye.originalIndex,targetId:Le,instanceId:ye.instanceId}}),ye.id==="c_amandava"&&ot.current.players[O].board.forEach((tt,bt)=>{if(tt){const ut=tt.instanceId;setTimeout(()=>{Xt("SHOT",O,bt,ut)},200)}}),ye.id==="c_azya"){if(setTimeout(()=>{Xt("THUNDER",O,-1)},200),Le){const tt=ot.current.players[O].board.findIndex(bt=>(bt==null?void 0:bt.instanceId)===Le);tt!==-1&&setTimeout(()=>{Xt("ICE",O,tt,Le)},400)}setTimeout(()=>{const We=ot.current.players[O].board,tt=We.filter(bt=>bt!==null);if(tt.length>0){const bt=tt[Math.floor(Math.random()*tt.length)],ut=We.findIndex(xt=>(xt==null?void 0:xt.instanceId)===(bt==null?void 0:bt.instanceId));ut!==-1&&Xt("WATER",O,ut,bt==null?void 0:bt.instanceId)}},600)}Vn(null)}}),await b(600),Ee++}{const X=ot.current,ce=X.players[T],se=T===X.firstPlayerId,ae=X.turnCount,G=Fx(ce,ae,se);if(($x(ce,ae,se)||G)&&ce.board.length>0){const ye=ce.board.map((Le,Ce)=>({c:Le,i:Ce})).filter(({c:Le})=>Le&&Le.type==="FOLLOWER"&&!Le.hasEvolved);if(ye.length>0){let Le;const Ce=G;if(d==="HARD"&&(ue(X,Ce)||console.log("[AI HARD] Skipping evolution - saving EP for better opportunity")),d==="HARD"&&!ue(X,Ce))Le=null;else if(d==="EASY")Le=ye[Math.floor(Math.random()*ye.length)];else{const be=ye.map(({c:Ze,i:Pe})=>({c:Ze,i:Pe,score:Y(Ze,Pe,X,Ce)}));be.sort((Ze,Pe)=>Pe.score-Ze.score),d==="HARD"&&be[0].score<5?(console.log("[AI HARD] Evolution target score too low:",be[0].score),Le=null):Le=be[0]}if(Le){let be;const Pe=X.players[O].board.filter(je=>{var kt,We;return je!==null&&!((kt=je.passiveAbilities)!=null&&kt.includes("STEALTH"))&&!((We=je.passiveAbilities)!=null&&We.includes("AURA"))});Pe.length>0&&(d==="HARD"?be=[...Pe].sort((kt,We)=>{var ut,xt,wt,At;let tt=(kt.currentAttack||0)*2+(kt.currentHealth||0),bt=(We.currentAttack||0)*2+(We.currentHealth||0);return(ut=kt.passiveAbilities)!=null&&ut.includes("BANE")&&(tt+=10),(xt=We.passiveAbilities)!=null&&xt.includes("BANE")&&(bt+=10),(wt=kt.passiveAbilities)!=null&&wt.includes("DOUBLE_ATTACK")&&(tt+=5),(At=We.passiveAbilities)!=null&&At.includes("DOUBLE_ATTACK")&&(bt+=5),bt-tt})[0].instanceId:be=Pe[0].instanceId);const Be=(Je=pr.current[Le.i])==null?void 0:Je.getBoundingClientRect();Be?(oo({card:Le.c,evolvedImageUrl:Le.c.evolvedImageUrl,startX:Be.left+Be.width/2,startY:Be.top+Be.height/2,useSep:Ce,phase:"ZOOM_IN",followerIndex:Le.i,sourcePlayerId:T,targetId:be}),await b(800)):(bs({type:"EVOLVE",playerId:T,payload:{followerIndex:Le.i,useSep:Ce,targetId:be}}),await b(400))}}}}{let X=!0,ce=0;const se=ae=>{if(d!=="HARD")return!1;const G=ae.players[O].hp;return q(ae)>=G};for(;X&&ce<15;){if(ot.current.winnerId){X=!1;break}ce++;const ae=ot.current,G=ae.players[T].board,oe=ae.players[O].board,ye=se(ae);let Le=!1;for(let Ce=0;Ce<G.length;Ce++){const Ae=G[Ce];if(!Ae||!Ae.canAttack)continue;let be=-1,Ze=!0;const Pe=((rt=Ae.passiveAbilities)==null?void 0:rt.includes("STEALTH"))||Ae.hadStealth,Be=Pe?-1:oe.findIndex(ut=>{var xt,wt;return ut&&((xt=ut.passiveAbilities)==null?void 0:xt.includes("WARD"))&&!((wt=ut.passiveAbilities)!=null&&wt.includes("STEALTH"))&&!L(ut)});if(ye&&Be===-1)if(((Ke=Ae.passiveAbilities)==null?void 0:Ke.includes("STORM"))||Ae.turnPlayed!==ae.turnCount)be=-1,Ze=!0;else{const wt=oe.map((At,Is)=>({c:At,idx:Is})).filter(({c:At})=>{var Is,Mc;return At&&!((Is=At.passiveAbilities)!=null&&Is.includes("STEALTH"))&&!((Mc=At.passiveAbilities)!=null&&Mc.includes("AURA"))&&!L(At)});if(wt.length>0)be=wt[0].idx,Ze=!1;else continue}else if(Be!==-1)be=Be,Ze=!1;else if(d==="EASY"){const ut=oe.map((wt,At)=>({c:wt,idx:At})).filter(({c:wt})=>{var At,Is;return wt&&!((At=wt.passiveAbilities)!=null&&At.includes("STEALTH"))&&!((Is=wt.passiveAbilities)!=null&&Is.includes("AURA"))&&!L(wt)}),xt=((Xe=Ae.passiveAbilities)==null?void 0:Xe.includes("STORM"))||Ae.turnPlayed!==ae.turnCount;if(!xt&&ut.length>0)be=ut[Math.floor(Math.random()*ut.length)].idx,Ze=!1;else{if(!xt&&ut.length===0)continue;xt&&ut.length>0&&Math.random()<.5&&(be=ut[Math.floor(Math.random()*ut.length)].idx,Ze=!1)}}else{const ut=ee(Ae,oe,ae);if(be=ut.index,Ze=ut.isLeader,be===-1&&!Ze)continue}const je=(me=Ae.passiveAbilities)==null?void 0:me.includes("STORM"),kt=Ae.turnPlayed===ae.turnCount;if(!je&&kt&&Ze){const ut=oe.map((xt,wt)=>({c:xt,idx:wt})).filter(({c:xt})=>{var wt,At;return xt&&!((wt=xt.passiveAbilities)!=null&&wt.includes("STEALTH"))&&!((At=xt.passiveAbilities)!=null&&At.includes("AURA"))&&!L(xt)});if(ut.length>0){const xt=Pe?null:ut.find(({c:wt})=>{var At;return(At=wt.passiveAbilities)==null?void 0:At.includes("WARD")});xt?be=xt.idx:be=ut[0].idx,Ze=!1}else continue}const We=Ze?null:oe[be],tt=We?We.instanceId:void 0,bt=Ae.instanceId;if(bt&&(_c(bt),setTimeout(()=>_c(null),300)),Xt(Ae.attackEffectType||"SLASH",O,Ze?-1:be,tt),!Ze&&be>=0){const ut=oe[be];if(ut&&(ut.currentAttack||0)>0){const xt=ut.instanceId;setTimeout(()=>{xt&&(bc(xt),setTimeout(()=>bc(null),300)),Xt(ut.attackEffectType||"SLASH",T,Ce,bt)},200)}}Le=!0,await b(1e3),I({type:"ATTACK",playerId:T,payload:{attackerIndex:Ce,targetIndex:be,targetIsLeader:Ze}}),await b(1e3);break}Le||(X=!1)}}if(await b(300),ot.current.winnerId){_s.current=!1;return}I({type:"END_TURN",playerId:T}),_s.current=!1})()}},[g.activePlayerId,g.turnCount,n,g.phase,d,g.winnerId]);const Rm=(m,x)=>{if(Mn.current||Qe||no.length>0)return;const b=le.hand[x];m.stopPropagation();const L="touches"in m?m.touches[0].clientX:m.clientX,$="touches"in m?m.touches[0].clientY:m.clientY,V=m.currentTarget.getBoundingClientRect();if(!Jr){kf(!0),Xr({card:b,owner:"PLAYER",source:"HAND"}),Rf.current=!0;return}if(Xr({card:b,owner:"PLAYER",source:"HAND"}),g.activePlayerId!==O)return;if(yn.current){console.warn("[handleHandMouseDown] Card play in progress, blocking drag start");return}const q=ot.current;if(q.winnerId){console.log("UI: Card play drag blocked - game has ended");return}if(q.pendingEffects&&q.pendingEffects.length>0){console.log("UI: Card play drag blocked - pendingEffects still processing");return}const B={sourceType:"HAND",sourceIndex:x,sourceInstanceId:b.instanceId,startX:V.left+V.width/2,startY:V.top+V.height/2,currentX:L,currentY:$,offsetX:0,offsetY:0,canDrag:!0};Kr(B),Mn.current=B},Am=(m,x,b)=>{m.stopPropagation();const L="touches"in m?m.touches[0].clientX:m.clientX,$="touches"in m?m.touches[0].clientY:m.clientY,V=ot.current;if(V.winnerId){console.log("UI: Attack drag blocked - game has ended");return}const q=V.players[O].board,B=b?q.findIndex(Y=>Y&&Y.instanceId===b):x,z=B>=0?q[B]:null;if(ct&&ct.allowedTargetPlayerId===O&&z){$f("FOLLOWER",B,O,b);return}if(z&&Xr({card:z,owner:"PLAYER",source:"BOARD"}),V.pendingEffects&&V.pendingEffects.length>0){console.log("UI: Attack drag blocked - pendingEffects still processing");return}if(V.activePlayerId===O&&(z!=null&&z.canAttack)){const Y=m.currentTarget.getBoundingClientRect(),ue={x:Y.left+Y.width/2,y:Y.top+Y.height/2},ee={sourceType:"BOARD",sourceIndex:B,sourceInstanceId:z.instanceId,startX:ue.x,startY:ue.y,currentX:L,currentY:$,offsetX:0,offsetY:0};Kr(ee),Mn.current=ee}},Pc=(m,x=!1)=>{if(g.activePlayerId!==O)return;m.stopPropagation();const b="touches"in m?m.touches[0].clientX:m.clientX,L="touches"in m?m.touches[0].clientY:m.clientY,$=ot.current;if($.winnerId){console.log("UI: Evolve drag blocked - game has ended");return}if($.pendingEffects&&$.pendingEffects.length>0){console.log("UI: Evolve drag blocked - pendingEffects still processing");return}const V=O===g.firstPlayerId;if(x){if(!Fx(le,g.turnCount,V))return}else if(!$x(le,g.turnCount,V))return;const q=m.currentTarget.getBoundingClientRect(),B=q.left+q.width/2,z=q.top+q.height/2,Y={sourceType:"EVOLVE",sourceIndex:0,startX:B,startY:z,currentX:b,currentY:L,offsetX:0,offsetY:0,useSep:x};Kr(Y),Mn.current=Y},Pm=A.useCallback(m=>{Pr.current&&(clearTimeout(Pr.current),Pr.current=null);const x={stampId:m,playerId:O,playerClass:er,timestamp:Date.now()},b=lv(m);b&&St(b,.6),tr(null),requestAnimationFrame(()=>{tr(x)}),e==="ONLINE"&&_&&_.send({type:"STAMP",stampId:m,playerClass:er}),Pr.current=setTimeout(()=>{tr(L=>(L==null?void 0:L.timestamp)===x.timestamp?null:L),Pr.current=null},3e3)},[O,er,e,_]),I2=A.useCallback(m=>{if(m.stopPropagation(),m.preventDefault(),vi.current){const x=vi.current.getBoundingClientRect();Vr.current={x:x.left+x.width/2,y:x.top+x.height/2}}else Vr.current={x:m.clientX,y:m.clientY};Fe(!0),Et(null)},[]),Om=F.useRef(null);F.useEffect(()=>{Om.current=lt},[lt]),A.useEffect(()=>{if(!M)return;const m=b=>{if(!Vr.current)return;const L=b.clientX-Vr.current.x,$=b.clientY-Vr.current.y,V=Math.sqrt(L*L+$*$),q=Math.atan2($,L)*(180/Math.PI);if(V>=200&&V<=320&&$<0){const ue=180- -q,ee=Math.floor(ue/22.5),Ee=Math.max(0,Math.min(7,ee))+1;Et(Ee)}else Et(null)},x=()=>{const b=Om.current;b&&Pm(b),Fe(!1),Et(null),Vr.current=null};return window.addEventListener("mousemove",m),window.addEventListener("mouseup",x),()=>{window.removeEventListener("mousemove",m),window.removeEventListener("mouseup",x)}},[M,Pm]),A.useEffect(()=>{const m=(L,$,V=!1)=>{var z,Y,ue,ee;if(!Mn.current)return;const{canDrag:q,sourceType:B}=Mn.current;if(!(B==="HAND"&&!q)&&(Mn.current={...Mn.current,currentX:L,currentY:$},Kr(ge=>ge?{...ge,currentX:L,currentY:$}:null),V&&(B==="BOARD"||B==="EVOLVE"))){const ge=io.current;if(ge){const Te=ge.getBoundingClientRect();if(L>=Te.left&&L<=Te.right&&$>=Te.top&&$<=Te.bottom){nr({type:"LEADER",index:0,playerId:T});return}}const Ee=ot.current,qe=((z=Ee.players[T])==null?void 0:z.board)||[];for(let Te=0;Te<pr.current.length;Te++){const Je=pr.current[Te];if(Je&&qe[Te]){const rt=Je.getBoundingClientRect();if(L>=rt.left&&L<=rt.right&&$>=rt.top&&$<=rt.bottom){nr({type:"FOLLOWER",index:Te,playerId:T,instanceId:(Y=qe[Te])==null?void 0:Y.instanceId});return}}}if(B==="EVOLVE"){const Te=((ue=Ee.players[O])==null?void 0:ue.board)||[];for(let Je=0;Je<Lr.current.length;Je++){const rt=Lr.current[Je];if(rt&&Te[Je]){const Ke=rt.getBoundingClientRect();if(L>=Ke.left&&L<=Ke.right&&$>=Ke.top&&$<=Ke.bottom){nr({type:"FOLLOWER",index:Je,playerId:O,instanceId:(ee=Te[Je])==null?void 0:ee.instanceId});return}}}}nr(null)}},x=L=>{m(L.clientX,L.clientY)},b=L=>{L.touches.length>0&&(Mn.current&&L.preventDefault(),m(L.touches[0].clientX,L.touches[0].clientY,!0))};return window.addEventListener("mousemove",x),window.addEventListener("touchmove",b,{passive:!1}),()=>{window.removeEventListener("mousemove",x),window.removeEventListener("touchmove",b)}},[]);const Lm=F.useRef(null),T2=F.useRef(null);A.useEffect(()=>{Lm.current=gt,T2.current=gt},[gt]),A.useEffect(()=>{const m=()=>{var $,V,q,B,z,Y,ue,ee,ge,Ee,qe,Te,Je;const b=Mn.current,L=Lm.current;if(ot.current.winnerId){console.log("[handleGlobalMouseUp] Game has ended, cancelling all actions"),Kr(null),Mn.current=null,nr(null);return}if(b){if(b.sourceType==="HAND"){if(yn.current){console.warn("[handleGlobalMouseUp] Card play in progress, cancelling drag"),Mn.current=null,Kr(null);return}const rt=Math.sqrt(Math.pow(b.startX-b.currentX,2)+Math.pow(b.startY-b.currentY,2)),Ke=b.currentY<window.innerHeight-200*h;if(b.canDrag&&rt>30&&Ke){const Xe=Dr.current.hand[b.sourceIndex];if(Dr.current.pp>=Xe.cost){const me=((V=($=Xe.triggerAbilities)==null?void 0:$.FANFARE)==null?void 0:V.targetType)==="SELECT_FOLLOWER"||((q=Xe.triggers)==null?void 0:q.some(ae=>ae.trigger==="FANFARE"&&ae.effects.some(G=>G.targetType==="SELECT_FOLLOWER"))),X=((z=(B=Xe.triggerAbilities)==null?void 0:B.FANFARE)==null?void 0:z.targetType)==="SELECT_ALLY_FOLLOWER"||((Y=Xe.triggers)==null?void 0:Y.some(ae=>ae.trigger==="FANFARE"&&ae.effects.some(G=>G.targetType==="SELECT_ALLY_FOLLOWER"))),ce=((ee=(ue=Xe.triggerAbilities)==null?void 0:ue.FANFARE)==null?void 0:ee.targetType)==="SELECT_OTHER_ALLY_FOLLOWER"||((ge=Xe.triggers)==null?void 0:ge.some(ae=>ae.trigger==="FANFARE"&&ae.effects.some(G=>G.targetType==="SELECT_OTHER_ALLY_FOLLOWER")));if(me||X||ce){const ae=X||ce?O:T;ot.current.players[ae].board.some(ye=>{var Le,Ce;return!(!ye||ae!==O&&((Le=ye.passiveAbilities)!=null&&Le.includes("STEALTH")||(Ce=ye.passiveAbilities)!=null&&Ce.includes("AURA")))})?(yn.current=!0,wa.current=Xe.instanceId||null,yi({type:"PLAY",sourceIndex:b.sourceIndex,sourceInstanceId:Xe.instanceId,allowedTargetPlayerId:ae}),gr.current=!0,setTimeout(()=>{gr.current=!1},100)):(console.log("[handleGlobalMouseUp] No valid targets, skipping target selection"),jf(b.sourceIndex,b.startX,b.startY),Xr(null),gr.current=!0,setTimeout(()=>{gr.current=!1},100))}else jf(b.sourceIndex,b.startX,b.startY),Xr(null),gr.current=!0,setTimeout(()=>{gr.current=!1},100);Mn.current=null,Kr(null);return}}else b.canDrag||kf(!0)}else if(b.sourceType==="BOARD"){if(L&&L.playerId===T){const Ke=ot.current.players[T],Xe=Ke.board.filter(G=>{var oe,ye;return G&&((oe=G.passiveAbilities)==null?void 0:oe.includes("WARD"))&&!((ye=G.passiveAbilities)!=null&&ye.includes("STEALTH"))});let me=!1;const X=G=>G?Ke.board.findIndex(oe=>oe&&oe.instanceId===G):-1,ce=L.type==="LEADER"?-1:X(L.instanceId),se=Dr.current.board[b.sourceIndex],ae=((Ee=se==null?void 0:se.passiveAbilities)==null?void 0:Ee.includes("STEALTH"))||(se==null?void 0:se.hadStealth);if(Xe.length>0&&!ae){if(L.type==="LEADER")me=!0;else if(L.type==="FOLLOWER"&&ce>=0){const G=Ke.board[ce];G&&!((qe=G.passiveAbilities)!=null&&qe.includes("WARD"))&&(me=!0)}}if(me)console.log("UI: Attack blocked by WARD");else{const G=Dr.current.board.findIndex(Ze=>Ze&&Ze.instanceId===b.sourceInstanceId),oe=G>=0?Dr.current.board[G]:null,ye=(Te=oe==null?void 0:oe.passiveAbilities)==null?void 0:Te.includes("RUSH"),Le=(Je=oe==null?void 0:oe.passiveAbilities)==null?void 0:Je.includes("STORM"),Ce=(oe==null?void 0:oe.turnPlayed)===ot.current.turnCount,Ae=L.type==="LEADER",be=ce;if(Ae&&ye&&!Le&&Ce)console.log("UI: Attack blocked by RUSH rule (Cannot attack leader)");else{if(G<0||!oe){console.log("UI: Attack blocked - invalid attacker");return}const Ze=ot.current;if(Ze.pendingEffects&&Ze.pendingEffects.length>0){console.log("UI: Attack blocked - pendingEffects still processing");return}const Pe=L.instanceId,Be=b.sourceInstanceId,je=!Ae&&be>=0?Ke.board[be]:null;bs({type:"ATTACK",playerId:O,payload:{attackerIndex:G,targetIndex:Ae?-1:be,targetIsLeader:Ae}}),Be&&(_c(Be),setTimeout(()=>_c(null),300));const We=(oe==null?void 0:oe.attackEffectType)||"SLASH";if(Xt(We,T,Ae?-1:be,Pe),Gn(),!Ae&&je&&(je.currentAttack||0)>0){const tt=je.instanceId;setTimeout(()=>{tt&&(bc(tt),setTimeout(()=>bc(null),300)),Xt(je.attackEffectType||"SLASH",O,G,Be)},200)}}}}}else if(b.sourceType==="EVOLVE"&&L&&L.type==="FOLLOWER"&&L.playerId===O){const rt=L.index,Xe=va.current[rt],me=(Xe==null?void 0:Xe.instanceId)||L.instanceId,X=Dr.current.board,ce=me?X.findIndex(Be=>Be&&Be.instanceId===me):rt,se=ce>=0?X[ce]:null;if(!se)return;if(se.hasEvolved){console.log("[GameScreen] Cannot evolve: card already evolved (drag drop)");return}const G=b.useSep?["SUPER_EVOLVE","EVOLVE"]:["EVOLVE"],ye=(()=>{var je,kt;const Be=(kt=(je=se==null?void 0:se.triggerAbilities)==null?void 0:je.EVOLVE)==null?void 0:kt.targetType;if(Be)return Be;for(const We of(se==null?void 0:se.triggers)||[])if(G.includes(We.trigger)){for(const tt of We.effects)if(tt.targetType&&["SELECT_FOLLOWER","SELECT_ALLY_FOLLOWER","SELECT_OTHER_ALLY_FOLLOWER"].includes(tt.targetType))return tt.targetType}return null})(),Le=!!ye,Ce=ye==="SELECT_ALLY_FOLLOWER"||ye==="SELECT_OTHER_ALLY_FOLLOWER",Ae=ye==="SELECT_OTHER_ALLY_FOLLOWER",be=Ce?O:T,Pe=ot.current.players[be].board.some(Be=>{var je,kt;return!(!Be||Ce&&Ae&&Be.instanceId===me||!Ce&&((je=Be.passiveAbilities)!=null&&je.includes("STEALTH")||(kt=Be.passiveAbilities)!=null&&kt.includes("AURA")))});Le&&Pe?(yi({type:"EVOLVE",sourceIndex:ce,sourceInstanceId:me,sourceVisualIndex:rt,useSep:b.useSep,allowedTargetPlayerId:be,excludeInstanceId:Ae?me:void 0}),gr.current=!0,setTimeout(()=>{gr.current=!1},100)):(Ac(rt,b.useSep,void 0,me),gr.current=!0,setTimeout(()=>{gr.current=!1},100))}}b&&b.sourceType==="HAND"&&b.canDrag&&(xm(b.sourceIndex),setTimeout(()=>xm(null),300)),Kr(null),Mn.current=null,nr(null)},x=()=>{m()};return window.addEventListener("mouseup",m),window.addEventListener("touchend",x),()=>{window.removeEventListener("mouseup",m),window.removeEventListener("touchend",x)}},[T,O,Jr,h]);const C2=()=>{if(!gr.current){if(ct){ct.type==="PLAY"&&(yn.current=!1),yi(null);return}if(Jr){if(Rf.current){Rf.current=!1;return}kf(!1),Xr(null),Ue(null)}}},Es=()=>{if(!Q||Q.sourceType!=="BOARD"&&Q.sourceType!=="EVOLVE")return"";const m=Q.currentX-Q.startX,x=Q.currentY-Q.startY,b=Math.sqrt(m*m+x*x);if(b<10)return"";const L=(Q.startX+Q.currentX)/2,$=(Q.startY+Q.currentY)/2,V=Math.min(200,b*.3),q=Math.abs(m),B=Math.min(150,q*.4),z=V+B,ue=-(m/(b+1))*z*.5,ee=-z*.8,ge=L+ue,Ee=$+ee;return`M${Q.startX},${Q.startY} Q${ge},${Ee} ${Q.currentX},${Q.currentY}`},$f=(m,x,b,L)=>{var q;if(!ct)return;if(ct.allowedTargetPlayerId&&ct.allowedTargetPlayerId!==b){console.log("Invalid target side");return}if(ct.excludeInstanceId&&L===ct.excludeInstanceId){console.log("Cannot target self (SELECT_OTHER_ALLY_FOLLOWER)"),Gn();return}let $,V=x;if(m==="FOLLOWER"){if(L&&(V=g.players[b].board.findIndex(z=>z&&z.instanceId===L),V<0))return;const B=g.players[b].board[V];if(!B)return;if($=B.instanceId,b!==O){const z=B.passiveAbilities||[];if(z.includes("STEALTH")){console.log("Cannot target unit with STEALTH"),St("cancel"),Gn();return}if(z.includes("AURA")){console.log("Cannot target unit with AURA"),St("cancel"),Gn();return}}}else return;if(ct.type==="PLAY"){const B=Dr.current;let z=ct.sourceIndex,Y=B.hand[z];if(ct.sourceInstanceId){const Ke=B.hand.findIndex(Xe=>Xe.instanceId===ct.sourceInstanceId);if(Ke>=0)z=Ke,Y=B.hand[Ke],console.log(`[handleTargetClick] Using sourceInstanceId ${ct.sourceInstanceId}, found at index ${Ke} (was ${ct.sourceIndex})`);else{console.error("[handleTargetClick] Card not found with instanceId:",ct.sourceInstanceId),yi(null);return}}if(!Y){console.error("[handleTargetClick] Card not found at index:",z),yi(null),yn.current=!1;return}yn.current=!0,wa.current=Y.instanceId||null,Y.id==="c_y"&&(Xt("SUMI","p2",V,$),ot.current.players[T].board.forEach((Xe,me)=>{if(Xe){const X=Xe.instanceId;setTimeout(()=>{Xt("SUMI",T,me,X)},300)}})),Y.id==="s_resignation_proxy"&&(Xt("SUMI",b,V,$),setTimeout(()=>{const Ke=ot.current.players[O].board,Xe=[];if(Ke.forEach((me,X)=>{me&&Xe.push({index:X,instanceId:me.instanceId})}),Xe.length>0){const me=Xe[Math.floor(Math.random()*Xe.length)];Xt("SUMI",O,me.index,me.instanceId)}},500)),Y.id==="c_azya"&&(Xt("THUNDER",T,-1),setTimeout(()=>{Xt("ICE",b,V,$)},300),setTimeout(()=>{const Ke=ot.current.players[T].board,Xe=Ke.filter(me=>me!==null);if(Xe.length>0){const me=Xe[Math.floor(Math.random()*Xe.length)],X=Ke.findIndex(ce=>(ce==null?void 0:ce.instanceId)===(me==null?void 0:me.instanceId));X!==-1&&Xt("WATER",T,X,me==null?void 0:me.instanceId)}},600));const ue=window.innerWidth/2,ee=window.innerHeight-200*h/2,ge=window.innerWidth/2,Ee=window.innerHeight/2,qe=()=>{Y.type==="SPELL"||Gn(),bs({type:"PLAY_CARD",playerId:O,payload:{cardIndex:z,targetId:$,instanceId:Y.instanceId}}),Y.id==="c_amandava"&&ot.current.players[T].board.forEach((me,X)=>{if(me){const ce=me.instanceId;setTimeout(()=>{Xt("SHOT",T,X,ce)},200)}}),Vn(null),setTimeout(()=>{yn.current=!1},100)};let Te,Je;if(Y.type==="FOLLOWER"){const Xe=ot.current.players[O].board.filter(oe=>oe!==null),me=Xe.length+1,X=Xe.length,ce=_i*h,se=(X-(me-1)/2)*ce,ae=(q=so.current)==null?void 0:q.getBoundingClientRect();Te=(ae?ae.left+ae.width/2:window.innerWidth/2)+se,Je=window.innerHeight/2+70*h}const rt=Y.type==="FOLLOWER"?ot.current.players[O].board.filter(Ke=>Ke!==null).length:void 0;n!=="CPU"&&v&&_&&_.send({type:"PLAY_CARD_ANIM",payload:{playerId:O,cardIndex:z,card:Y,targetBoardIndex:rt}}),Vn({card:Y,sourceIndex:ct.sourceIndex??-1,startX:ue,startY:ee,targetX:ge,targetY:Ee,finalX:Te,finalY:Je,playerClass:(le==null?void 0:le.class)||"SENKA",onComplete:qe}),setTimeout(()=>{Vn(Ke=>(Ke==null?void 0:Ke.card.id)===Y.id?(qe(),null):Ke)},2e3)}else if(ct.type==="EVOLVE"){const B=ct.sourceVisualIndex??ct.sourceIndex;Ac(B,!!ct.useSep,$,ct.sourceInstanceId)}yi(null)},Dm=()=>{if(!He||He.owner!=="PLAYER")return;if(yn.current){console.warn("[handleUseButtonClick] Card play in progress, ignoring");return}const m=le.hand.findIndex(L=>L.id===He.card.id);if(m===-1)return;const x=window.innerWidth/2,b=window.innerHeight-200*h/2;jf(m,x,b),Xr(null)},[co,Ff]=F.useState(!1),[Oc,Uf]=F.useState(!1),[qt,Bf]=F.useState(null),k2=F.useRef(0);F.useEffect(()=>{if(!(qt!=null&&qt.active))return;const m=Date.now(),x=800,b=()=>{const L=Date.now()-m;if(L>=x){Bf(null);return}const $=L/x;Bf(V=>V?{...V,ringRadius:20+$*100,particles:V.particles.map(q=>({...q,x:q.x+q.vx,y:q.y+q.vy,opacity:1-$}))}:null),requestAnimationFrame(b)};requestAnimationFrame(b)},[qt==null?void 0:qt.active]);const Mm=(m,x)=>{const b=[];for(let L=0;L<20;L++){const $=Math.random()*Math.PI*2,V=2+Math.random()*3;b.push({id:k2.current++,x:m,y:x,vx:Math.cos($)*V,vy:Math.sin($)*V,opacity:1,createdAt:Date.now()})}Bf({active:!0,x:m,y:x,ringRadius:20,particles:b})},zf=async()=>{if(g.winnerId){console.log("[handleEndTurn] Game is over, ignoring");return}if(g.activePlayerId!==O){console.log("[handleEndTurn] Not my turn, ignoring");return}if(ao.current){console.log("[handleEndTurn] Already ending turn, ignoring");return}ao.current=!0,Ff(!0);const m=ot.current.turnCount,x=ot.current.activePlayerId;if(!await(async()=>{const $=()=>{const Y=ot.current,ue=Y.pendingEffects&&Y.pendingEffects.length>0,ee=Df.current.length>0,ge=Mf.current.length>0,Ee=Ia.current!==null,qe=lo.current!==null,Te=Yr.current,Je=yn.current;return!ue&&!ee&&!ge&&!Ee&&!qe&&!Te&&!Je};let B=0,z=0;for(;B<3e3;){if(ot.current.turnCount!==m||ot.current.activePlayerId!==x)return console.log("[handleEndTurn] Turn changed during wait, aborting local END_TURN"),!1;if($()){if(z++,z>=2)break}else z=0;await new Promise(Y=>setTimeout(Y,50)),B+=50}return B>=3e3&&console.warn("[handleEndTurn] Timeout waiting for processing to complete - forcing end turn"),!0})()||ot.current.turnCount!==m||ot.current.activePlayerId!==x||ot.current.activePlayerId!==O){console.log("[handleEndTurn] Turn state changed, aborting END_TURN dispatch"),ao.current=!1,Ff(!1);return}console.log("[handleEndTurn] Dispatching END_TURN"),bs({type:"END_TURN",playerId:O}),ao.current=!1,Ff(!1)},R2=A.useCallback(()=>{St("sisiodosi.mp3",.6);const m=pm.current;if(m){const x=m.getBoundingClientRect();Mm(x.left+x.width/2,x.top+x.height/2)}zf()},[St,zf]),Nm=2-((le==null?void 0:le.evolutionsUsed)||0),Hf=O===g.firstPlayerId,jm=(m,x)=>x?Math.ceil(g.turnCount/2):Math.floor(g.turnCount/2),$m=jm(O,Hf),A2=Hf?3:2,P2=Hf?4:3,Lc=$m>=A2,Dc=$m>=P2,Ss=(le==null?void 0:le.canEvolveThisTurn)&&Nm>0&&g.activePlayerId===O&&Lc,ws=(le==null?void 0:le.canEvolveThisTurn)&&le.sep>0&&g.activePlayerId===O&&Dc,Wf=T===g.firstPlayerId,Fm=jm(T,Wf),O2=Wf?3:2,L2=Wf?4:3,Gf=Fm>=O2,Vf=Fm>=L2,Yf=((Vm=le==null?void 0:le.board)==null?void 0:Vm.some(m=>{var x;return(x=m==null?void 0:m.passiveAbilities)==null?void 0:x.includes("LEADER_DAMAGE_CAP")}))??!1,Kf=((Ym=Ne==null?void 0:Ne.board)==null?void 0:Ym.some(m=>{var x;return(x=m==null?void 0:m.passiveAbilities)==null?void 0:x.includes("LEADER_DAMAGE_CAP")}))??!1,D2=(le==null?void 0:le.leaderDamageShield)??!1,M2=(Ne==null?void 0:Ne.leaderDamageShield)??!1,Um=Yf||D2,Bm=Kf||M2;return A.useLayoutEffect(()=>{window.scrollTo(0,0),so.current&&(so.current.scrollTop=0);const m=()=>{window.scrollTo(0,0)};return window.addEventListener("scroll",m,{passive:!1}),()=>{window.removeEventListener("scroll",m)}},[]),n==="JOIN"&&!P||J&&y&&!P?a.jsxs("div",{style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",gap:"1rem"},children:[a.jsx("div",{style:{width:"50px",height:"50px",border:"4px solid rgba(233, 69, 96, 0.3)",borderTop:"4px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),a.jsx("p",{children:"..."}),a.jsx("button",{onClick:s,style:{marginTop:"1rem",padding:"0.5rem 1rem",background:"transparent",border:"1px solid #888",color:"#888",cursor:"pointer",borderRadius:"4px"},children:""}),a.jsx("style",{children:`
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                `})]}):J&&ze&&P?a.jsxs("div",{style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",gap:"1rem"},children:[a.jsx("div",{style:{fontSize:"2rem",fontWeight:"bold",color:"#4ade80",textShadow:"0 0 10px rgba(74, 222, 128, 0.5)",marginBottom:"0.5rem"},children:""}),a.jsx("div",{style:{width:"50px",height:"50px",border:"4px solid rgba(74, 222, 128, 0.3)",borderTop:"4px solid #4ade80",borderRadius:"50%",animation:"spin 1s linear infinite"}}),a.jsx("p",{style:{color:"#a0aec0"},children:"..."}),a.jsx("style",{children:`
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                `})]}):a.jsxs("div",{className:"game-screen-wrapper",style:{width:"100vw",height:"100dvh",overflow:"hidden",background:"#000",position:"relative"},children:[U&&a.jsx(ZL,{myPlayer:le,opponentPlayer:Ne,isFirstPlayer:fr,onComplete:S2,scale:h,onVsImpact:()=>St("vs.mp3",.7),onCoinToss:()=>St("coin.mp3",.7),onImpact:()=>St("gan.mp3",.7),onOrbLand:()=>St("gan.mp3",.8),onFadeInBoard:()=>Ie(!0),isMobile:W}),a.jsxs("div",{className:"game-screen",style:{width:"100%",height:"100%",transform:mt>0?`translate(${ne.x}px, ${ne.y}px)`:"none",display:"flex",overflow:"hidden",background:"radial-gradient(circle at center, #1a202c 0%, #000 100%)",fontFamily:"'Helvetica Neue', sans-serif",userSelect:"none",color:"#fff",position:"absolute",top:0,left:0,opacity:U&&!Re?0:1,transition:"opacity 0.5s ease-in"},onClick:C2,children:[a.jsx("style",{children:`
                    html, body {
                        margin: 0; padding: 0; height: 100%; background: #000;
                        overflow: hidden !important;
                        position: fixed !important;
                        width: 100% !important;
                        top: 0 !important;
                        left: 0 !important;
                    }
                    * { box-sizing: border-box; }
                    .shake-target { animation: shake 0.3s cubic-bezier(.36,.07,.19,.97) both; }
                    @keyframes shake {
                        10%, 90% { transform: translate3d(-1px, 0, 0); }
                        20%, 80% { transform: translate3d(2px, 0, 0); }
                        30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
                        40%, 60% { transform: translate3d(4px, 0, 0); }
                    }
                    @keyframes attackRotate {
                        0% { transform: rotateY(0deg); }
                        100% { transform: rotateY(360deg); }
                    }
                    .attack-rotating {
                        animation: attackRotate 0.2s linear forwards !important;
                        transform-style: preserve-3d;
                    }
                    @keyframes cardDie {
                        0% { transform: scale(1); filter: brightness(1) drop-shadow(0 0 0 white); opacity: 1; }
                        40% { transform: scale(1.15); filter: brightness(3) drop-shadow(0 0 20px white); opacity: 0.9; }
                        100% { transform: scale(0.4) rotate(8deg); filter: brightness(5) drop-shadow(0 0 40px white); opacity: 0; }
                    }
                    .card-dying { animation: cardDie 0.7s forwards; }
                    /* Necromance effect animations */
                    @keyframes necromanceFloat {
                        0% { transform: translateX(-50%) translateY(0) scale(1); opacity: 1; }
                        50% { transform: translateX(-50%) translateY(-20px) scale(1.2); opacity: 1; }
                        100% { transform: translateX(-50%) translateY(-40px) scale(0.8); opacity: 0; }
                    }
                    @keyframes necromanceFloatOpponent {
                        0% { transform: translateX(-50%) translateY(0) scale(1); opacity: 1; }
                        50% { transform: translateX(-50%) translateY(15px) scale(1.2); opacity: 1; }
                        100% { transform: translateX(-50%) translateY(30px) scale(0.8); opacity: 0; }
                    }
                    @keyframes necroPulse {
                        0%, 100% { box-shadow: 0 0 10px #d946ef, 0 0 20px #a855f7, inset 0 0 15px rgba(217, 70, 239, 0.3); }
                        50% { box-shadow: 0 0 25px #d946ef, 0 0 40px #a855f7, 0 0 60px #7c3aed, inset 0 0 25px rgba(217, 70, 239, 0.5); }
                    }
                    @keyframes leaderDamageCapPulse {
                        0%, 100% {
                            box-shadow: 0 0 20px rgba(103, 232, 249, 0.4), 0 0 40px rgba(103, 232, 249, 0.2);
                            border-color: #67e8f9;
                        }
                        50% {
                            box-shadow: 0 0 35px rgba(103, 232, 249, 0.7), 0 0 55px rgba(103, 232, 249, 0.4);
                            border-color: #a5f3fc;
                        }
                    }
                    @keyframes leaderDamageCapOverlay {
                        0%, 100% { opacity: 0.15; }
                        50% { opacity: 0.45; }
                    }
                    /* EP/SEP pulse animations for usable state - box-shadow only, no transform override */
                    @keyframes epPulse {
                        0%, 100% {
                            box-shadow: 0 0 12px #ffd700, 0 0 25px rgba(255,215,0,0.6);
                        }
                        50% {
                            box-shadow: 0 0 20px #ffd700, 0 0 40px rgba(255,215,0,0.8), 0 0 55px rgba(255,180,0,0.5);
                        }
                    }
                    @keyframes sepPulse {
                        0%, 100% {
                            box-shadow: 0 0 12px #b794f4, 0 0 25px rgba(159,122,234,0.6);
                        }
                        50% {
                            box-shadow: 0 0 20px #b794f4, 0 0 40px rgba(159,122,234,0.8), 0 0 55px rgba(180,0,255,0.5);
                        }
                    }
                `}),ct&&a.jsx("div",{style:{position:"absolute",top:"15%",left:"50%",transform:"translate(-50%, -50%)",background:"rgba(0, 0, 0, 0.7)",color:"#fff",padding:"10px 20px",borderRadius:20,pointerEvents:"none",zIndex:1e3,fontWeight:"bold",border:ct.allowedTargetPlayerId===O?"2px solid #48bb78":"2px solid #f56565"},children:ct.allowedTargetPlayerId===O?"":""}),x2&&a.jsx(y3,{onClose:()=>Cf(!1)}),v2&&a.jsx("div",{style:{position:"absolute",inset:0,zIndex:4e3,background:"rgba(0,0,0,0.8)",backdropFilter:"blur(5px)",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>wc(!1),children:a.jsxs("div",{style:{background:"#2d3748",padding:40,borderRadius:16,display:"flex",flexDirection:"column",gap:20,minWidth:300,border:"1px solid rgba(255,255,255,0.1)"},onClick:m=>m.stopPropagation(),children:[a.jsx("h2",{style:{margin:0,textAlign:"center",borderBottom:"1px solid #4a5568",paddingBottom:10,color:"#fff"},children:""}),y2?a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:15},children:[a.jsx("h3",{style:{margin:0,color:"#cbd5e0"},children:""}),a.jsxs("label",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",color:"white"},children:["BGM",a.jsx("input",{type:"checkbox",checked:Ot.bgmEnabled,onChange:m=>Ea(x=>({...x,bgmEnabled:m.target.checked})),style:{width:20,height:20}})]}),a.jsxs("label",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",color:"white"},children:["SE",a.jsx("input",{type:"checkbox",checked:Ot.seEnabled,onChange:m=>Ea(x=>({...x,seEnabled:m.target.checked})),style:{width:20,height:20}})]}),a.jsxs("div",{children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",color:"#a0aec0",marginBottom:5},children:[a.jsx("span",{children:"BGM"}),a.jsxs("span",{children:[Math.round(Ot.bgm*100),"%"]})]}),a.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:Ot.bgm,onChange:m=>Ea(x=>({...x,bgm:parseFloat(m.target.value)})),style:{width:"100%"}})]}),a.jsxs("div",{children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",color:"#a0aec0",marginBottom:5},children:[a.jsx("span",{children:"SE"}),a.jsxs("span",{children:[Math.round(Ot.se*100),"%"]})]}),a.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:Ot.se,onChange:m=>Ea(x=>({...x,se:parseFloat(m.target.value)})),style:{width:"100%"}})]}),a.jsxs("div",{children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",color:"#a0aec0",marginBottom:5},children:[a.jsx("span",{children:""}),a.jsxs("span",{children:[Math.round(Ot.voice*100),"%"]})]}),a.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:Ot.voice,onChange:m=>Ea(x=>({...x,voice:parseFloat(m.target.value)})),style:{width:"100%"}})]}),a.jsx("button",{onClick:()=>Sm(!1),style:{padding:10,background:"#4a5568",border:"none",color:"white",borderRadius:8,cursor:"pointer",marginTop:10},children:""})]}):a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:()=>wc(!1),style:{padding:15,background:"#4a5568",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.2rem"},children:""}),a.jsx("button",{onClick:()=>Sm(!0),style:{padding:15,background:"#2b6cb0",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.2rem"},children:""}),a.jsx("button",{onClick:()=>Ic(!0),style:{padding:15,background:"#e53e3e",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.2rem"},children:""})]})]})}),_2&&a.jsx("div",{style:{position:"absolute",inset:0,zIndex:4100,background:"rgba(0,0,0,0.85)",backdropFilter:"blur(5px)",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>Ic(!1),children:a.jsxs("div",{style:{background:"#2d3748",padding:40,borderRadius:16,display:"flex",flexDirection:"column",gap:20,minWidth:320,border:"2px solid #e53e3e",boxShadow:"0 0 30px rgba(229, 62, 62, 0.3)"},onClick:m=>m.stopPropagation(),children:[a.jsx("h2",{style:{margin:0,textAlign:"center",color:"#fff",fontSize:"1.5rem"},children:""}),a.jsx("p",{style:{margin:0,textAlign:"center",color:"#a0aec0",fontSize:"1rem"},children:""}),a.jsxs("div",{style:{display:"flex",gap:15,marginTop:10},children:[a.jsx("button",{onClick:()=>Ic(!1),style:{flex:1,padding:15,background:"#4a5568",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.1rem"},children:""}),a.jsx("button",{onClick:b2,style:{flex:1,padding:15,background:"#e53e3e",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.1rem"},children:""})]})]})}),a.jsxs("div",{className:wm?"shake-target":"",style:{width:(W?280:340)*h,borderRight:"1px solid rgba(255,255,255,0.1)",background:"rgba(0,0,0,0.3)",padding:W?`${10*h}px ${12*h}px`:`${20*h}px ${20*h}px ${20*h}px`,display:"flex",flexDirection:"column",zIndex:20,flexShrink:0},onClick:m=>m.stopPropagation(),children:[a.jsx("div",{style:{marginBottom:(W?6:12)*h},children:a.jsxs("button",{onClick:()=>wc(!0),style:{background:"transparent",border:"none",cursor:"pointer",padding:W?3:5},children:[a.jsx("div",{style:{width:(W?22:30)*h,height:(W?2:3)*h,background:"#cbd5e0",marginBottom:(W?4:6)*h}}),a.jsx("div",{style:{width:(W?22:30)*h,height:(W?2:3)*h,background:"#cbd5e0",marginBottom:(W?4:6)*h}}),a.jsx("div",{style:{width:(W?22:30)*h,height:(W?2:3)*h,background:"#cbd5e0"}})]})}),a.jsx("h3",{style:{color:"#a0aec0",borderBottom:"1px solid #4a5568",paddingBottom:(W?4:8)*h,marginTop:0,marginBottom:0,flexShrink:0,fontSize:W?`${.85*h}rem`:void 0},children:""}),He?a.jsx("div",{style:{marginTop:(W?4:10)*h,display:"flex",flexDirection:"column",flex:1,overflow:"hidden",minHeight:0},children:a.jsxs("div",{style:{flex:1,overflow:"auto",minHeight:0,display:"flex",flexDirection:"column"},children:[a.jsxs("div",{style:{flexShrink:0},children:[a.jsx("div",{style:{width:"100%",aspectRatio:"1/1",marginBottom:(W?6:12)*h,display:"flex",alignItems:"center",justifyContent:"center",...W?{maxHeight:"28vh"}:{}},children:a.jsx(ho,{card:He.card,style:{width:"100%",height:"100%",...W?{maxHeight:"28vh"}:{}},variant:"art-only"})}),a.jsx("div",{style:{fontSize:W?`${(He.card.name.length>12?.9:He.card.name.length>8?1:1.1)*h}rem`:`${He.card.name.length>12?1.1:He.card.name.length>8?1.2:1.4}rem`,fontWeight:"bold",marginBottom:(W?4:6)*h,textAlign:"center"},children:He.card.name}),a.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:(W?10:15)*h,marginBottom:(W?6:10)*h},children:[a.jsx("div",{style:{width:24*h,height:24*h,borderRadius:"50%",background:"radial-gradient(circle at 30% 30%, #68d391, #276749)",border:"1px solid #fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${.85*h}rem`,fontWeight:900,color:"white",textShadow:"0 1px 2px rgba(0,0,0,0.5)",boxShadow:"0 2px 4px rgba(0,0,0,0.3)"},children:He.card.cost}),He.card.type==="FOLLOWER"&&a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:3*h},children:[a.jsx("svg",{width:18*h,height:18*h,viewBox:"0 0 24 24",fill:"none",children:a.jsx("polygon",{points:"12,2 22,22 2,22",fill:"#63b3ed",stroke:"none"})}),a.jsx("span",{style:{fontSize:`${.95*h}rem`,fontWeight:"bold",color:"#4299e1"},children:"currentAttack"in He.card?He.card.currentAttack:He.card.attack})]}),He.card.type==="FOLLOWER"&&a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:3*h},children:[a.jsx("svg",{width:18*h,height:18*h,viewBox:"0 0 24 24",fill:"#f56565",children:a.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})}),a.jsx("span",{style:{fontSize:`${.95*h}rem`,fontWeight:"bold",color:"#f56565"},children:"currentHealth"in He.card?He.card.currentHealth:He.card.health})]})]}),a.jsx("div",{style:{fontSize:`${((((Km=He.card.description)==null?void 0:Km.length)||0)>150?.7:(((Xm=He.card.description)==null?void 0:Xm.length)||0)>100?.8:.9)*h}rem`,color:"#cbd5e0",lineHeight:"1.4",whiteSpace:"pre-wrap",borderTop:"1px solid #4a5568",paddingTop:4*h},children:m2(He.card.description)})]}),He.card.flavorText&&a.jsx("div",{style:{marginTop:"auto",paddingTop:8*h,paddingBottom:4*h,flexShrink:0},children:a.jsx("div",{style:{fontSize:`${((((Jm=He.card.flavorText)==null?void 0:Jm.length)||0)>100?.6:.7)*h}rem`,color:"rgba(160, 174, 192, 0.6)",lineHeight:"1.3",fontStyle:"italic",whiteSpace:"pre-wrap",textAlign:"right"},children:He.card.flavorText})})]})}):a.jsx("div",{style:{marginTop:10*h,color:"#718096",fontStyle:"italic",flex:1,fontSize:`${.7*h}rem`},children:""})]}),a.jsxs("div",{ref:so,className:wm?"shake-target":"",style:{flex:1,height:"100%",position:"relative",background:"rgba(0,0,0,0.1)",overflow:"hidden"},children:[a.jsxs("div",{ref:io,onMouseEnter:()=>nr({type:"LEADER",playerId:T}),onMouseLeave:()=>nr(null),onClick:m=>{m.stopPropagation(),ct&&$f("LEADER",-1,T)},style:{position:"absolute",top:-20*h,left:"50%",transform:"translateX(-50%)",width:po*h,height:po*h,borderRadius:"50%",zIndex:100,cursor:"default"},children:[a.jsx("div",{style:{position:"absolute",inset:0,borderRadius:"50%",background:Ne.class==="AJA"?`url(${ul(Ne.class)}) center top/cover`:`url(${ul(Ne.class)}) center/cover`,border:Kf?"4px solid #67e8f9":(gt==null?void 0:gt.type)==="LEADER"&&gt.playerId===T&&!ct?"4px solid #f56565":"4px solid #4a5568",boxShadow:Kf?"0 0 20px rgba(103, 232, 249, 0.4), 0 0 40px rgba(103, 232, 249, 0.2)":"0 0 20px rgba(0,0,0,0.5)",transition:"border-color 0.3s, box-shadow 0.3s, filter 0.5s, opacity 0.5s",animation:Bm?"leaderDamageCapPulse 2s ease-in-out infinite":"none",...g.winnerId===O&&($e||at)?{filter:$e==="white-fade"?"brightness(2) saturate(0.3)":$e==="explode"||$e==="result-text"||$e==="fade-out"||at?"brightness(3) saturate(0) blur(10px)":"none",opacity:$e==="explode"||$e==="result-text"||$e==="fade-out"||at?0:1}:{}},children:Bm&&a.jsx("div",{style:{position:"absolute",inset:0,borderRadius:"50%",background:"radial-gradient(circle, rgba(103, 232, 249, 0.5) 0%, rgba(103, 232, 249, 0.2) 70%, rgba(103, 232, 249, 0.1) 100%)",pointerEvents:"none",animation:"leaderDamageCapOverlay 2s ease-in-out infinite",zIndex:1}})}),a.jsx("div",{style:{position:"absolute",bottom:0,left:"50%",transform:`translateX(-50%) translateX(${-140*h}px)`,width:55*h,height:55*h,background:"radial-gradient(circle at 30% 30%, #feb2b2, #c53030)",borderRadius:"50%",border:`${Math.max(2,3*h)}px solid #fff`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${1.2*h}rem`,fontWeight:900,color:"white",textShadow:"0 2px 2px rgba(0,0,0,0.5)",zIndex:10,boxShadow:"0 4px 6px rgba(0,0,0,0.4)",opacity:te?1:0,transition:"opacity 0.3s ease-in"},children:Ne.hp}),a.jsx("div",{style:{position:"absolute",bottom:10*h,left:"50%",transform:`translateX(-50%) translateX(${-80*h}px)`,width:45*h,height:45*h,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,opacity:te?Gf?1:.5:0,filter:Gf?"none":"grayscale(0.8)",transition:"opacity 0.3s ease-in"},children:a.jsx("div",{style:{display:"flex",gap:3*h},children:Array(2).fill(0).map((m,x)=>{const b=x<2-Ne.evolutionsUsed;return a.jsx("div",{style:{width:12*h,height:12*h,borderRadius:"50%",background:b?"#ecc94b":"#2d3748",boxShadow:b&&Gf?"0 0 8px #ecc94b, 0 0 15px #ecc94b":"none",border:"2px solid rgba(0,0,0,0.5)"}},x)})})}),a.jsx("div",{style:{position:"absolute",bottom:10*h,left:"50%",transform:`translateX(-50%) translateX(${80*h}px)`,width:45*h,height:45*h,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,opacity:te?Vf?1:.5:0,filter:Vf?"none":"grayscale(0.8)",transition:"opacity 0.3s ease-in"},children:a.jsx("div",{style:{display:"flex",gap:3*h},children:Array(2).fill(0).map((m,x)=>{const b=x<Ne.sep;return a.jsx("div",{style:{width:12*h,height:12*h,borderRadius:"50%",background:b?"#9f7aea":"#2d3748",boxShadow:b&&Vf?"0 0 8px #9f7aea, 0 0 15px #9f7aea":"none",border:"2px solid rgba(0,0,0,0.5)"}},x)})})}),a.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:po*h*.75,height:po*h*.75,pointerEvents:"none",zIndex:20,opacity:(gt==null?void 0:gt.type)==="LEADER"&&gt.playerId===T&&Q?1:0,transition:"opacity 0.1s ease-out"},children:[a.jsxs("svg",{width:"100%",height:"100%",viewBox:"0 0 100 100",children:[a.jsx("defs",{children:a.jsxs("filter",{id:"leaderCyanMarkerGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"4",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsxs("g",{style:{transformOrigin:"50% 50%",animation:"leaderMarkerSpin 2s linear infinite"},children:[a.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"rgba(100, 200, 255, 0.9)",strokeWidth:"3",strokeDasharray:"15 8",filter:"url(#leaderCyanMarkerGlow)"}),a.jsx("polygon",{points:"50,5 44,18 56,18",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"}),a.jsx("polygon",{points:"95,50 82,44 82,56",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"}),a.jsx("polygon",{points:"50,95 56,82 44,82",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"}),a.jsx("polygon",{points:"5,50 18,56 18,44",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"})]})]}),a.jsx("style",{children:`
                                @keyframes leaderMarkerSpin {
                                    0% { transform: rotate(0deg); }
                                    100% { transform: rotate(360deg); }
                                }
                            `})]})]}),a.jsxs("div",{style:{position:"absolute",top:20*h,left:20*h,width:60*h,height:85*h,zIndex:50},children:[[...Array(Math.min(5,Math.ceil(Ne.deck.length/5)))].map((m,x)=>a.jsx("div",{style:{position:"absolute",inset:0,transform:`translate(${x*2*h}px, ${-x*2*h}px)`,borderRadius:6,border:"1px solid #718096",overflow:"hidden"},children:a.jsx("img",{src:xi((Ne==null?void 0:Ne.class)||"SENKA"),alt:"Deck",style:{width:"100%",height:"100%",objectFit:"cover"},onError:b=>{b.target.style.display="none",b.target.parentElement.style.background="linear-gradient(45deg, #2d3748, #1a202c)"}})},x)),a.jsx("div",{style:{position:"absolute",bottom:-20*h,width:"100%",textAlign:"center",fontWeight:"bold",color:"#a0aec0",fontSize:"0.9rem"},children:Ne.deck.length})]}),a.jsxs("div",{style:{position:"absolute",top:20*h,right:20*h,display:"flex",alignItems:"center",gap:8,zIndex:50,pointerEvents:"none"},children:[a.jsxs("div",{style:{position:"relative",width:24,height:30},children:[a.jsx("div",{style:{position:"absolute",inset:0,background:"#4a192c",borderRadius:2,border:"1px solid #742a3a",transform:"rotate(-15deg) translate(-3px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#3d1525",borderRadius:2,border:"1px solid #742a3a",transform:"rotate(-5deg) translate(-1px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#2d1a20",borderRadius:2,border:"1px solid #8b3a4a",transform:"rotate(5deg)"}})]}),a.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(74, 25, 44, 0.8), rgba(45, 26, 32, 0.9))",padding:"3px 8px",borderRadius:5,color:"#f0b8c4",fontSize:"0.64rem",fontWeight:"bold",border:"1px solid rgba(116, 42, 58, 0.5)",boxShadow:"0 2px 4px rgba(0,0,0,0.4)"},children:[" ",Ne.hand.length]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5,marginLeft:6},children:[a.jsx("div",{style:{fontSize:"0.9rem",filter:"drop-shadow(0 0 2px rgba(128, 90, 213, 0.6)) grayscale(30%)"},children:""}),a.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(128, 90, 213, 0.7), rgba(76, 29, 149, 0.8))",padding:"3px 8px",borderRadius:5,color:"#c4b5fd",fontSize:"0.64rem",fontWeight:"bold",border:"1px solid rgba(167, 139, 250, 0.4)",boxShadow:"0 2px 4px rgba(0,0,0,0.4)",position:"relative"},children:[" ",Ne.graveyard.length,ma.filter(m=>m.playerId===T).map(m=>a.jsxs("div",{style:{position:"absolute",bottom:-25,left:"50%",transform:"translateX(-50%)",color:"#d946ef",fontSize:"1.2rem",fontWeight:"bold",textShadow:"0 0 8px #d946ef, 0 0 15px #a855f7, 0 0 25px #7c3aed",animation:"necromanceFloatOpponent 1.5s ease-out forwards",pointerEvents:"none",whiteSpace:"nowrap"},children:["-",m.amount]},m.key))]})]})]}),a.jsx("div",{style:{position:"absolute",top:`calc(50% - ${Tn*h/2}px - ${70*h}px)`,left:"0",width:"100%",height:Tn*h,pointerEvents:"none",zIndex:10},children:a.jsx("div",{style:{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center"},children:mn.map((m,x)=>{const b=mn.length,L=(x-(b-1)/2)*_i*h;return a.jsxs("div",{ref:$=>pr.current[x]=$,onMouseEnter:()=>{Q&&nr({type:"FOLLOWER",index:x,playerId:T,instanceId:m==null?void 0:m.instanceId})},onMouseLeave:()=>{Q&&nr(null)},onClick:$=>{if($.stopPropagation(),ct){if(!m)return;$f("FOLLOWER",x,T,m==null?void 0:m.instanceId)}else m&&Xr({card:m,owner:"OPPONENT",source:"BOARD"})},style:{position:"absolute",left:"50%",top:0,transform:`translateX(calc(-50% + ${L}px))`,transition:"transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1), left 0.4s ease",border:ct&&m&&ct.allowedTargetPlayerId===T?"2px solid #f56565":"none",boxShadow:ct&&m&&ct.allowedTargetPlayerId===T?"0 0 15px #f56565":"none",borderRadius:8,cursor:ct?"crosshair":"default",width:fn*h,height:Tn*h,pointerEvents:"auto",opacity:jt&&jt.sourcePlayerId===T&&jt.followerIndex===x?0:m!=null&&m.isDying?.8:1,transitionProperty:jt&&jt.sourcePlayerId===T&&jt.followerIndex===x?"none":"transform, left, opacity"},children:[a.jsx("div",{style:{width:"100%",height:"100%",perspective:"800px"},children:a.jsxs("div",{className:ym===(m==null?void 0:m.instanceId)||vm===(m==null?void 0:m.instanceId)?"attack-rotating":"",style:{width:"100%",height:"100%",position:"relative",transformStyle:"preserve-3d"},children:[a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},children:m?a.jsx(ho,{card:m,turnCount:g.turnCount,className:m.isDying?"card-dying":"",scale:h,style:{width:fn*h,height:Tn*h,opacity:1,filter:m.isDying?"grayscale(0.5) brightness(2)":"none",boxShadow:(gt==null?void 0:gt.type)==="FOLLOWER"&&gt.index===x&&(Q==null?void 0:Q.sourceType)==="BOARD"?"0 0 20px #f56565":(Q==null?void 0:Q.sourceType)==="BOARD"?"0 0 20px #f6e05e":void 0},isOnBoard:!0,isSpecialSummoning:mm.has(m.instanceId)}):a.jsx("div",{style:{width:fn*h,height:Tn*h,border:"1px dashed rgba(255,255,255,0.1)",borderRadius:8}})}),m&&a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",transform:"rotateY(180deg)",borderRadius:12,overflow:"hidden"},children:a.jsx("img",{src:xi((Ne==null?void 0:Ne.class)||"SENKA"),alt:"Card Sleeve",style:{width:"100%",height:"100%",objectFit:"cover"}})})]})}),m&&(Q==null?void 0:Q.sourceType)==="BOARD"&&a.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",width:"100%",height:"100%",transform:"translate(-50%, -50%)",pointerEvents:"none",zIndex:20,opacity:(gt==null?void 0:gt.type)==="FOLLOWER"&&gt.index===x&&gt.playerId===T?1:0,transition:"opacity 0.1s ease-out"},children:[a.jsxs("svg",{viewBox:"0 0 100 100",style:{width:"100%",height:"100%",filter:"drop-shadow(0 0 12px rgba(100, 200, 255, 0.9))"},children:[a.jsx("defs",{children:a.jsxs("filter",{id:"cyanMarkerGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"4",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsxs("g",{style:{transformOrigin:"50px 50px",animation:"attackMarkerSpin 1.5s linear infinite reverse"},children:[a.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:"rgba(100, 200, 255, 0.95)",strokeWidth:"4",strokeDasharray:"12 6",filter:"url(#cyanMarkerGlow)"}),a.jsx("polygon",{points:"50,10 45,20 55,20",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"}),a.jsx("polygon",{points:"90,50 80,45 80,55",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"}),a.jsx("polygon",{points:"50,90 55,80 45,80",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"}),a.jsx("polygon",{points:"10,50 20,55 20,45",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"})]})]}),a.jsx("style",{children:`
                                                    @keyframes attackMarkerSpin {
                                                        0% { transform: rotate(0deg); }
                                                        100% { transform: rotate(360deg); }
                                                    }
                                                `})]})]},(m==null?void 0:m.instanceId)||`empty-opp-${x}`)})})}),a.jsx("div",{style:{position:"absolute",bottom:`calc(50% - ${Tn*h/2}px - ${70*h}px)`,left:"0",width:"100%",height:Tn*h,pointerEvents:"none",zIndex:10},children:a.jsx("div",{style:{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center"},children:wn.map((m,x)=>{const b=wn.length,L=(x-(b-1)/2)*_i*h;return a.jsxs("div",{ref:$=>Lr.current[x]=$,onMouseDown:$=>Am($,x,m==null?void 0:m.instanceId),onTouchStart:$=>Am($,x,m==null?void 0:m.instanceId),onClick:$=>$.stopPropagation(),onMouseEnter:()=>{Q&&nr({type:"FOLLOWER",index:x,playerId:O,instanceId:m==null?void 0:m.instanceId})},onMouseLeave:()=>{Q&&nr(null)},style:{position:"absolute",left:"50%",top:0,"--offsetX":`calc(-50% + ${L}px)`,transform:`translateX(calc(-50% + ${L}px)) ${(Q==null?void 0:Q.sourceType)==="BOARD"&&Q.sourceInstanceId===(m==null?void 0:m.instanceId)?"translateY(-20px) scale(1.1)":""}`,transition:"transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1), left 0.4s ease",cursor:"pointer",pointerEvents:"auto",width:fn*h,height:Tn*h,border:ct&&m&&ct.allowedTargetPlayerId===O?"2px solid #48bb78":"none",boxShadow:ct&&m&&ct.allowedTargetPlayerId===O?"0 0 15px #48bb78":"none",borderRadius:8,zIndex:(Q==null?void 0:Q.sourceType)==="BOARD"&&Q.sourceInstanceId===(m==null?void 0:m.instanceId)?10:1,opacity:jt&&jt.sourcePlayerId===O&&jt.followerIndex===x?0:m!=null&&m.isDying?.8:1,transitionProperty:jt&&jt.sourcePlayerId===O&&jt.followerIndex===x?"none":"transform, left, opacity"},children:[a.jsx("div",{style:{width:"100%",height:"100%",perspective:"800px"},children:a.jsxs("div",{className:ym===(m==null?void 0:m.instanceId)||vm===(m==null?void 0:m.instanceId)?"attack-rotating":"",style:{width:"100%",height:"100%",position:"relative",transformStyle:"preserve-3d"},children:[a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},children:m?a.jsx(ho,{card:m,turnCount:g.turnCount,className:m.isDying?"card-dying":"",scale:h,style:{width:fn*h,height:Tn*h,opacity:1,filter:m.isDying?"grayscale(0.5) brightness(2)":"none",boxShadow:(Q==null?void 0:Q.sourceType)==="BOARD"&&Q.sourceInstanceId===(m==null?void 0:m.instanceId)&&(gt==null?void 0:gt.type)==="FOLLOWER"?"0 0 30px #f56565":(Q==null?void 0:Q.sourceType)==="BOARD"&&Q.sourceInstanceId===(m==null?void 0:m.instanceId)?"0 20px 30px rgba(0,0,0,0.6)":void 0,pointerEvents:(Q==null?void 0:Q.sourceType)==="BOARD"&&Q.sourceInstanceId===(m==null?void 0:m.instanceId)?"none":"auto"},isSelected:(He==null?void 0:He.card)===m,isOnBoard:!0,isSpecialSummoning:mm.has(m.instanceId),isMyTurn:g.activePlayerId===O}):a.jsx("div",{style:{width:fn*h,height:Tn*h,border:"1px dashed rgba(255,255,255,0.2)",borderRadius:8}})}),m&&a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",transform:"rotateY(180deg)",borderRadius:12,overflow:"hidden"},children:a.jsx("img",{src:xi((le==null?void 0:le.class)||"SENKA"),alt:"Card Sleeve",style:{width:"100%",height:"100%",objectFit:"cover"}})})]})}),m&&(Q==null?void 0:Q.sourceType)==="EVOLVE"&&!m.hasEvolved&&a.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",width:"120%",height:"120%",transform:"translate(-50%, -50%)",pointerEvents:"none",border:Q.useSep?"2px dashed rgba(183, 148, 244, 0.9)":"2px dashed rgba(255, 230, 100, 0.9)",borderRadius:"50%",boxShadow:Q.useSep?"0 0 15px rgba(159, 122, 234, 0.8)":"0 0 15px rgba(255, 200, 50, 0.8)",animation:"evolveMarkerSpin 1.5s linear infinite",zIndex:20,opacity:(gt==null?void 0:gt.type)==="FOLLOWER"&&gt.index===x&&gt.playerId===O?1:0,transition:"opacity 0.1s ease-out"},children:[a.jsxs("svg",{viewBox:"0 0 100 100",style:{width:"100%",height:"100%",filter:"drop-shadow(0 0 8px currentColor)"},children:[a.jsx("defs",{children:a.jsxs("filter",{id:Q.useSep?"purpleMarkerGlow":"yellowMarkerGlow",x:"-30%",y:"-30%",width:"160%",height:"160%",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"3",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:Q.useSep?"#b794f4":"#f6e05e",strokeWidth:"4",strokeDasharray:"15 8",filter:`url(#${Q.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`,opacity:"0.95"}),a.jsx("polygon",{points:"50,5 45,15 55,15",fill:Q.useSep?"#b794f4":"#f6e05e",filter:`url(#${Q.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`}),a.jsx("polygon",{points:"95,50 85,45 85,55",fill:Q.useSep?"#b794f4":"#f6e05e",filter:`url(#${Q.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`}),a.jsx("polygon",{points:"50,95 55,85 45,85",fill:Q.useSep?"#b794f4":"#f6e05e",filter:`url(#${Q.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`}),a.jsx("polygon",{points:"5,50 15,55 15,45",fill:Q.useSep?"#b794f4":"#f6e05e",filter:`url(#${Q.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`})]}),a.jsx("style",{children:`
                                                @keyframes evolveMarkerSpin {
                                                    0% { transform: translate(-50%, -50%) rotate(0deg); }
                                                    100% { transform: translate(-50%, -50%) rotate(360deg); }
                                                }
                                            `})]})]},(m==null?void 0:m.instanceId)||`empty-plr-${x}`)})})}),a.jsxs("div",{style:{position:"absolute",right:30*h,top:"50%",transform:"translateY(-50%)",display:"flex",flexDirection:"column",alignItems:"center",gap:30*h,zIndex:50},children:[a.jsx("div",{style:{textAlign:"center"},children:a.jsxs("div",{style:{fontSize:`${1.2*h}rem`,fontWeight:700,color:"#a0aec0",fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif'},children:["Turn ",g.turnCount]})}),a.jsxs("div",{style:{textAlign:"center"},children:[a.jsxs("div",{style:{fontSize:`${1.8*h}rem`,fontWeight:900,color:"#f6e05e",fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif'},children:[Ne.pp,"/",Ne.maxPp]}),a.jsx("div",{style:{display:"flex",gap:4*h,justifyContent:"center"},children:Array(Math.min(10,Ne.maxPp)).fill(0).map((m,x)=>a.jsx("div",{style:{width:10*h,height:10*h,borderRadius:"50%",background:x<Ne.pp?"#f6e05e":"#2d3748"}},x))})]}),a.jsxs("div",{style:{position:"relative",width:160*h,height:160*h},children:[a.jsx(t3,{isMyTurn:g.activePlayerId===O,turnCount:g.turnCount,activePlayerId:g.activePlayerId,onTimeUp:R2,timerEnabled:p,isGameOver:!!g.winnerId,isPaused:U,scale:h,buttonSize:160,timerDuration:60}),a.jsxs("button",{ref:pm,disabled:g.activePlayerId!==O||co,onMouseDown:m=>{m.stopPropagation(),g.activePlayerId===O&&!co&&Uf(!0)},onMouseUp:m=>{var x;if(m.stopPropagation(),Oc&&g.activePlayerId===O&&!co){Uf(!1),St("sisiodosi.mp3",.6);const b=(x=m.target.closest("button"))==null?void 0:x.getBoundingClientRect();b&&Mm(b.left+b.width/2,b.top+b.height/2),zf()}},onMouseLeave:()=>{Uf(!1)},style:{width:160*h,height:160*h,borderRadius:"50%",border:"4px solid rgba(255,255,255,0.2)",background:co?"linear-gradient(135deg, #805ad5, #6b46c1)":Oc?"linear-gradient(135deg, #5a9bd5, #4a7fb0)":g.activePlayerId===O?"linear-gradient(135deg, #3182ce, #2b6cb0)":"#2d3748",color:"white",fontWeight:900,fontSize:`${2*h}rem`,fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif',boxShadow:g.activePlayerId===O?Oc?"0 0 20px rgba(66, 153, 225, 0.5)":"0 0 40px rgba(66, 153, 225, 0.8)":"none",opacity:Oc?.8:1,cursor:g.activePlayerId===O&&!co?"pointer":"default",transition:"all 0.1s",position:"relative",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",lineHeight:1.2},children:[a.jsx("img",{src:it("/assets/tenfubu_mark.png"),alt:"",style:{position:"absolute",width:"80%",height:"80%",objectFit:"contain",opacity:.25,pointerEvents:"none"}}),co?a.jsx("span",{style:{position:"relative",zIndex:1,whiteSpace:"nowrap"},children:"..."}):a.jsxs(a.Fragment,{children:[a.jsx("span",{style:{position:"relative",zIndex:1,whiteSpace:"nowrap"},children:""}),a.jsx("span",{style:{position:"relative",zIndex:1,whiteSpace:"nowrap"},children:""})]})]})]}),a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("div",{style:{fontSize:`${2.4*h}rem`,fontWeight:900,color:"#f6e05e",fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif'},children:le.extraPpActive?a.jsxs("span",{children:[Math.max(0,le.pp-1),"/",le.maxPp," ",a.jsx("span",{style:{color:"#ed8936"},children:"+1"})]}):a.jsxs("span",{children:[le.pp,"/",le.maxPp]})}),a.jsx("div",{style:{display:"flex",gap:3*h,justifyContent:"center"},children:Array(10).fill(0).map((m,x)=>{const b=x<le.pp,L=x<le.maxPp;let $;return b?$="#f6e05e":L?$="#744210":$="#2d3748",a.jsx("div",{style:{width:11*h,height:11*h,borderRadius:"50%",background:$}},x)})})]}),(()=>{const m=O!==g.firstPlayerId,x=g.activePlayerId===O,b=g.turnCount,L=b<=5&&!le.extraPpUsedEarly,$=b>=6&&!le.extraPpUsedLate,V=m&&x&&!le.extraPpActive&&(L||$),q=le.extraPpActive;if(!m)return null;const B=b<=5&&le.extraPpUsedEarly||b>=6&&le.extraPpUsedLate,z=!V&&!q;return a.jsxs("button",{disabled:z,onClick:Y=>{Y.stopPropagation(),z||bs({type:"TOGGLE_EXTRA_PP",playerId:O})},style:{width:160*h,height:45*h,borderRadius:12*h,border:q?"3px solid #ed8936":"3px solid rgba(255,255,255,0.2)",background:q?"linear-gradient(135deg, #ed8936, #dd6b20)":V?"linear-gradient(135deg, #744210, #5a3510)":"#2d3748",color:q?"white":V?"#f6e05e":"#718096",fontWeight:700,fontSize:"1rem",boxShadow:q?"0 0 20px rgba(237, 137, 54, 0.6)":"none",cursor:z?"default":"pointer",transition:"all 0.3s",display:"flex",alignItems:"center",justifyContent:"center",gap:6*h,opacity:B&&!q?.5:1},children:[a.jsx("span",{children:"PP"}),a.jsx("span",{style:{fontSize:"1.3rem"},children:"+1"}),q&&a.jsx("span",{style:{fontSize:"0.8rem"},children:"ON"}),B&&!q&&a.jsx("span",{style:{fontSize:"0.7rem",marginLeft:2},children:""})]})})()]}),W?a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:m=>{m.stopPropagation(),Cf(!0)},style:{position:"absolute",left:15*h,top:120*h,width:64*h,height:64*h,minWidth:64*h,maxWidth:64*h,minHeight:64*h,maxHeight:64*h,borderRadius:"50%",background:"linear-gradient(135deg, #4a5568 0%, #2d3748 100%)",border:"3px solid #63b3ed",color:"#63b3ed",fontSize:`${1.8*h}rem`,fontWeight:"bold",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,padding:0,zIndex:16,boxShadow:"0 2px 8px rgba(0,0,0,0.4)",transition:"all 0.2s ease"},onMouseEnter:m=>{m.currentTarget.style.transform="scale(1.1)",m.currentTarget.style.boxShadow="0 0 15px rgba(99, 179, 237, 0.5)"},onMouseLeave:m=>{m.currentTarget.style.transform="scale(1)",m.currentTarget.style.boxShadow="0 2px 8px rgba(0,0,0,0.4)"},children:"?"}),a.jsx(v3,{logs:g.logs||[],onCardNameClick:wf,scale:h,isMobile:W})]}):a.jsxs("div",{style:{position:"absolute",left:15,top:"50%",transform:"translateY(-50%)",display:"flex",flexDirection:"column",alignItems:"flex-start",gap:8,zIndex:16,pointerEvents:"none"},children:[a.jsx("button",{onClick:m=>{m.stopPropagation(),Cf(!0)},style:{width:36,height:36,borderRadius:"50%",background:"linear-gradient(135deg, #4a5568 0%, #2d3748 100%)",border:"2px solid #63b3ed",color:"#63b3ed",fontSize:"1.2rem",fontWeight:"bold",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",padding:0,boxShadow:"0 4px 12px rgba(0,0,0,0.4)",transition:"all 0.2s ease",pointerEvents:"auto"},onMouseEnter:m=>{m.currentTarget.style.transform="scale(1.1)",m.currentTarget.style.boxShadow="0 0 15px rgba(99, 179, 237, 0.5)"},onMouseLeave:m=>{m.currentTarget.style.transform="scale(1)",m.currentTarget.style.boxShadow="0 4px 12px rgba(0,0,0,0.4)"},children:"?"}),a.jsxs("div",{style:{width:Math.max(180,220*h),height:Math.max(200,280*h),overflowY:"auto",background:"linear-gradient(to right, rgba(0,0,0,0.8), rgba(0,0,0,0.0))",color:"#fff",fontSize:`${Math.max(.65,.75*h)}rem`,padding:`${8*h}px ${8*h}px ${8*h}px ${12*h}px`,borderLeft:"3px solid #63b3ed",pointerEvents:"auto",scrollbarWidth:"thin"},onMouseDown:m=>m.stopPropagation(),onClick:m=>m.stopPropagation(),ref:m=>{m&&(m.scrollTop=m.scrollHeight)},children:[a.jsx("div",{style:{fontWeight:"bold",marginBottom:4*h,color:"#a0aec0",borderBottom:"1px solid rgba(255,255,255,0.1)",paddingBottom:2,fontSize:`${Math.max(.55,.65*h)}rem`,textTransform:"uppercase",letterSpacing:1},children:"BATTLE LOG"}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:3*h},children:(g.logs||[]).map((m,x)=>a.jsx("div",{style:{opacity:.9,lineHeight:"1.4",textShadow:"0 1px 2px black",animation:"fadeIn 0.3s ease-out"},children:m},x))})]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,pointerEvents:"none"},children:[a.jsxs("div",{style:{position:"relative",width:32,height:40},children:[a.jsx("div",{style:{position:"absolute",inset:0,background:"#4a5568",borderRadius:4,border:"1px solid #718096",transform:"rotate(-15deg) translate(-5px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#2d3748",borderRadius:4,border:"1px solid #718096",transform:"rotate(-5deg) translate(-2px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#1a202c",borderRadius:4,border:"1px solid #cbd5e0",transform:"rotate(5deg)"}})]}),a.jsxs("div",{style:{background:"rgba(0,0,0,0.7)",padding:"4px 12px",borderRadius:8,color:"#e2e8f0",fontSize:"0.9rem",fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5)"},children:[" ",le.hand.length]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,marginLeft:6},children:[a.jsx("div",{style:{fontSize:"1.2rem",filter:"drop-shadow(0 0 3px rgba(128, 90, 213, 0.8))"},children:""}),a.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(128, 90, 213, 0.8), rgba(76, 29, 149, 0.9))",padding:"4px 12px",borderRadius:8,color:"#e2e8f0",fontSize:"0.9rem",fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5), inset 0 1px rgba(255,255,255,0.1)",border:"1px solid rgba(167, 139, 250, 0.5)",position:"relative"},children:[" ",le.graveyard.length,ma.filter(m=>m.playerId===O).map(m=>a.jsxs("div",{style:{position:"absolute",top:-30,left:"50%",transform:"translateX(-50%)",color:"#d946ef",fontSize:"1.5rem",fontWeight:"bold",textShadow:"0 0 10px #d946ef, 0 0 20px #a855f7, 0 0 30px #7c3aed",animation:"necromanceFloat 1.5s ease-out forwards",pointerEvents:"none",whiteSpace:"nowrap"},children:["-",m.amount]},m.key))]})]})]}),He&&He.owner==="PLAYER"&&He.source==="HAND"&&Jr&&(()=>{const b=((W?Math.max(140,180*h):Math.max(180,220*h))-6)/2,L=le.pp>=He.card.cost;return a.jsxs("button",{disabled:!L,onClick:$=>{$.stopPropagation(),Dm()},className:L?"play-button-active":"",style:{width:b,background:L?"linear-gradient(to bottom, #48bb78, #38a169)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:"8px 4px",borderRadius:12,fontSize:"0.85rem",fontWeight:"bold",cursor:L?"pointer":"not-allowed",boxShadow:L?"0 0 15px rgba(72, 187, 120, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease",pointerEvents:"auto"},onMouseDown:$=>$.stopPropagation(),children:["",a.jsxs("div",{style:{fontSize:"0.6rem",opacity:.8,marginTop:2},children:["pp ",He.card.cost]})]})})(),He&&He.owner==="PLAYER"&&He.source==="BOARD"&&(()=>{const m=W?Math.max(140,180*h):Math.max(180,220*h),x=6,b=(m-x)/2,L=He.card,$=L==null?void 0:L.hasEvolved,V=!$&&Ss,q=!$&&ws,B=L==null?void 0:L.instanceId,z=le.board.findIndex(ee=>ee&&ee.instanceId===B),Y=le.board.slice(0,z+1).filter(ee=>ee).length-1,ue=ee=>{z<0||Ac(Y>=0?Y:z,ee,void 0,B)};return a.jsxs("div",{style:{display:"flex",gap:x,pointerEvents:"auto"},onMouseDown:ee=>ee.stopPropagation(),children:[a.jsxs("button",{disabled:!V,onClick:ee=>{ee.stopPropagation(),ue(!1)},style:{width:b,background:V?"linear-gradient(to bottom, #faf089, #d69e2e)":"#718096",color:V?"#1a202c":"white",border:"2px solid rgba(255,255,255,0.2)",padding:"8px 4px",borderRadius:12,fontSize:"0.85rem",fontWeight:"bold",cursor:V?"pointer":"not-allowed",boxShadow:V?"0 0 15px rgba(250, 240, 137, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:V?"0 1px 1px rgba(255,255,255,0.3)":"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",a.jsx("div",{style:{fontSize:"0.6rem",opacity:.8,marginTop:2},children:"EP"})]}),a.jsxs("button",{disabled:!q,onClick:ee=>{ee.stopPropagation(),ue(!0)},style:{width:b,background:q?"linear-gradient(to bottom, #b794f4, #805ad5)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:"8px 4px",borderRadius:12,fontSize:"0.85rem",fontWeight:"bold",cursor:q?"pointer":"not-allowed",boxShadow:q?"0 0 15px rgba(183, 148, 244, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",a.jsx("div",{style:{fontSize:"0.6rem",opacity:.8,marginTop:2},children:"SEP"})]})]})})(),!(He&&He.owner==="PLAYER"&&(He.source==="HAND"||He.source==="BOARD"))&&(()=>{const m=W?Math.max(140,180*h):Math.max(180,220*h);return a.jsx("div",{style:{width:m,height:52,visibility:"hidden",pointerEvents:"none"}})})()]}),(Ye==="TOSSING"||Ye==="RESULT")&&a.jsxs("div",{style:{position:"absolute",inset:0,zIndex:4e3,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.85)",pointerEvents:"none"},children:[a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("div",{style:{width:120*h,height:120*h,margin:`0 auto ${30*h}px`,borderRadius:"50%",background:Ye==="RESULT"?Ut==="FIRST"?"linear-gradient(135deg, #ffd700, #ff8c00)":"linear-gradient(135deg, #c0c0c0, #808080)":"linear-gradient(135deg, #ffd700, #ff8c00)",boxShadow:Ye==="RESULT"?`0 0 ${40*h}px ${Ut==="FIRST"?"#ffd700":"#c0c0c0"}, 0 0 ${80*h}px ${Ut==="FIRST"?"rgba(255,215,0,0.5)":"rgba(192,192,192,0.5)"}`:`0 0 ${30*h}px #ffd700`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"3rem",fontWeight:900,color:"#1a202c",textShadow:"0 2px 2px rgba(0,0,0,0.5)",animation:Ye==="TOSSING"?"coinFlip 0.3s ease-in-out infinite":"coinLand 0.5s ease-out",border:"4px solid rgba(255,255,255,0.3)"},children:Ye==="RESULT"?Ut==="FIRST"?"":"":"?"}),a.jsxs("div",{style:{fontSize:Ye==="RESULT"?"2.5rem":"1.8rem",fontWeight:900,color:Ut==="FIRST"?"#ffd700":Ut==="SECOND"?"#c0c0c0":"white",textShadow:"0 0 20px currentColor, 0 2px 4px black",animation:Ye==="RESULT"?"textPop 0.5s ease-out":"none"},children:[Ye==="TOSSING"&&"...",Ye==="RESULT"&&(Ut==="FIRST"?"":"")]}),Ye==="RESULT"&&a.jsx("div",{style:{fontSize:"1rem",color:"#a0aec0",marginTop:10*h,animation:"fadeIn 0.5s ease-out 0.3s both"},children:Ut==="FIRST"?"":""})]}),a.jsx("style",{children:`
                            @keyframes coinFlip {
                                0%, 100% { transform: rotateY(0deg) scale(1); }
                                50% { transform: rotateY(180deg) scale(1.1); }
                            }
                            @keyframes coinLand {
                                0% { transform: rotateY(720deg) scale(0.5); }
                                70% { transform: rotateY(0deg) scale(1.2); }
                                100% { transform: rotateY(0deg) scale(1); }
                            }
                            @keyframes textPop {
                                0% { transform: scale(0.5); opacity: 0; }
                                70% { transform: scale(1.2); }
                                100% { transform: scale(1); opacity: 1; }
                            }
                        `})]}),ha&&a.jsxs("div",{style:{position:"absolute",inset:0,zIndex:3e3,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.7)",pointerEvents:"none",animation:"fadeIn 0.2s ease-out"},children:[a.jsx("div",{style:{fontSize:`${3.5*h}rem`,fontWeight:900,fontFamily:"Tamanegi, sans-serif",background:"linear-gradient(135deg, #ffd700, #ff6b6b, #ffd700)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",textShadow:"none",filter:`drop-shadow(0 0 ${15*h}px rgba(255,215,0,0.8)) drop-shadow(0 0 ${30*h}px rgba(255,107,107,0.5))`,animation:"gameStartPop 0.8s ease-out",letterSpacing:"0.2em"},children:" "}),a.jsx("style",{children:`
                            @keyframes gameStartPop {
                                0% { transform: scale(0.3) rotate(-10deg); opacity: 0; }
                                50% { transform: scale(1.2) rotate(5deg); opacity: 1; }
                                70% { transform: scale(0.95) rotate(-2deg); }
                                100% { transform: scale(1) rotate(0deg); opacity: 1; }
                            }
                        `})]}),a.jsxs("div",{ref:vi,style:{position:"absolute",bottom:-20*h,left:"50%",transform:"translateX(-50%)",width:po*h,height:po*h,borderRadius:"50%",zIndex:200},children:[a.jsxs("div",{onMouseDown:I2,style:{width:"100%",height:"100%",borderRadius:"50%",overflow:"hidden",border:Yf?"4px solid #67e8f9":"4px solid #3182ce",boxShadow:Yf?"0 0 20px rgba(103, 232, 249, 0.4), 0 0 40px rgba(103, 232, 249, 0.2)":"0 0 20px rgba(49, 130, 206, 0.4)",background:"#1a202c",cursor:"grab",transition:"border-color 0.3s, box-shadow 0.3s, filter 0.5s, opacity 0.5s",animation:Um?"leaderDamageCapPulse 2s ease-in-out infinite":"none",position:"relative",...g.winnerId&&g.winnerId!==O&&($e||at)?{filter:$e==="white-fade"?"brightness(2) saturate(0.3)":$e==="explode"||$e==="result-text"||$e==="fade-out"||at?"brightness(3) saturate(0) blur(10px)":"none",opacity:$e==="explode"||$e==="result-text"||$e==="fade-out"||at?0:1}:{}},children:[a.jsx("img",{src:ul(le.class),style:le.class==="AJA"?{width:"100%",height:"100%",objectFit:"cover",objectPosition:"center top",pointerEvents:"none"}:{width:"100%",height:"100%",objectFit:"cover",pointerEvents:"none"}}),Um&&a.jsx("div",{style:{position:"absolute",inset:0,borderRadius:"50%",background:"radial-gradient(circle, rgba(103, 232, 249, 0.5) 0%, rgba(103, 232, 249, 0.2) 70%, rgba(103, 232, 249, 0.1) 100%)",pointerEvents:"none",animation:"leaderDamageCapOverlay 2s ease-in-out infinite",zIndex:1}})]}),a.jsx("div",{style:{position:"absolute",top:0,left:"50%",transform:`translateX(-50%) translateX(${-140*h}px)`,width:55*h,height:55*h,background:"radial-gradient(circle at 30% 30%, #feb2b2, #c53030)",borderRadius:"50%",border:`${Math.max(2,3*h)}px solid #fff`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${1.2*h}rem`,fontWeight:900,color:"white",textShadow:"0 2px 2px rgba(0,0,0,0.5)",boxShadow:"0 4px 6px rgba(0,0,0,0.4)",zIndex:10,opacity:te?1:0,transition:"opacity 0.3s ease-in"},children:le.hp}),a.jsx("div",{onMouseDown:m=>Pc(m,!1),onTouchStart:m=>Pc(m,!1),style:{position:"absolute",top:10*h,left:"50%",transform:`translateX(-50%) translateX(${-80*h}px)`,width:45*h,height:45*h,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:Ss?"rgba(255,235,100,0.2)":"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",cursor:Ss?"grab":"default",zIndex:10,opacity:te?Lc?1:.5:0,filter:Lc?"none":"grayscale(0.8)",transition:"opacity 0.3s ease-in, filter 0.3s, background 0.3s",boxShadow:Ss?"0 0 12px #ffd700, 0 0 25px rgba(255,215,0,0.5)":"none",animation:Ss?"epPulse 1.5s ease-in-out infinite":"none"},children:a.jsx("div",{style:{display:"flex",gap:3*h},children:Array(2).fill(0).map((m,x)=>{const b=x<Nm;let L="none";return b&&Lc&&(L=Ss?"0 0 10px #fff59d, 0 0 20px #ffd700, 0 0 30px #ecc94b":"0 0 8px #ecc94b, 0 0 15px #ecc94b"),a.jsx("div",{style:{width:12*h,height:12*h,borderRadius:"50%",background:b?Ss?"#fff59d":"#ecc94b":"#2d3748",boxShadow:L,border:"2px solid rgba(0,0,0,0.5)",transition:"box-shadow 0.3s, background 0.3s"}},x)})})}),a.jsx("div",{onMouseDown:m=>Pc(m,!0),onTouchStart:m=>Pc(m,!0),style:{position:"absolute",top:10*h,left:"50%",transform:`translateX(-50%) translateX(${80*h}px)`,width:45*h,height:45*h,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:ws?"rgba(200,160,255,0.2)":"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,cursor:ws?"grab":"default",opacity:te?Dc?1:.5:0,filter:Dc?"none":"grayscale(0.8)",transition:"opacity 0.3s ease-in, filter 0.3s, background 0.3s",boxShadow:ws?"0 0 12px #b794f4, 0 0 25px rgba(159,122,234,0.5)":"none",animation:ws?"sepPulse 1.5s ease-in-out infinite":"none"},children:a.jsx("div",{style:{display:"flex",gap:3*h},children:Array(2).fill(0).map((m,x)=>{const b=x<le.sep;let L="none";return b&&Dc&&(L=ws?"0 0 10px #d6bcfa, 0 0 20px #b794f4, 0 0 30px #9f7aea":"0 0 8px #9f7aea, 0 0 15px #9f7aea"),a.jsx("div",{style:{width:12*h,height:12*h,borderRadius:"50%",background:b?ws?"#d6bcfa":"#9f7aea":"#2d3748",boxShadow:L,border:"2px solid rgba(0,0,0,0.5)",transition:"box-shadow 0.3s, background 0.3s"}},x)})})})]}),a.jsxs("div",{style:{position:"absolute",bottom:10*h,right:15*h,width:60*h,height:85*h,zIndex:50},children:[[...Array(Math.min(5,Math.ceil(le.deck.length/5)))].map((m,x)=>a.jsx("div",{style:{position:"absolute",inset:0,transform:`translate(${x*2*h}px, ${-x*2*h}px)`,borderRadius:6,border:"1px solid #718096",boxShadow:"1px 1px 3px rgba(0,0,0,0.5)",overflow:"hidden"},children:a.jsx("img",{src:xi((le==null?void 0:le.class)||"SENKA"),alt:"Deck",style:{width:"100%",height:"100%",objectFit:"cover"},onError:b=>{b.target.style.display="none",b.target.parentElement.style.background="linear-gradient(45deg, #2d3748, #1a202c)"}})},x)),a.jsx("div",{style:{position:"absolute",top:-20*h,width:"100%",textAlign:"center",color:"#a0aec0",fontSize:"0.9rem",fontWeight:"bold",textShadow:"0 1px 2px black"},children:le.deck.length})]}),a.jsx("div",{style:{position:"absolute",bottom:0,left:0,width:"100%",height:200*h,display:"flex",justifyContent:"center",alignItems:"flex-end",pointerEvents:"none",zIndex:500},children:le.hand.map((m,x)=>{if(Qe!==null&&Qe.sourceIndex===x)return null;const L=le.hand.length;let $=0,V=0,q=0;if(Jr){const z=100*h,Y=window.innerWidth-40*h,ue=(L-1)*z+fn*h;let ee=z;ue>Y&&(ee=(Y-fn*h)/Math.max(1,L-1)),$=(x-(L-1)/2)*ee,V=xe===x?-8*h:0,q=0}else{const z=45*h,Y=160*h,ue=fn*h/2,ee=window.innerWidth/2-Y-ue,ge=window.innerWidth-340*h-Y,Ee=(L-1)*z+fn*h;let qe=z;Ee>ge&&(qe=(ge-fn*h)/Math.max(1,L-1)),$=ee-(L-1-x)*qe,V=0,q=(x-(L-1)/2)*3}const B=le.pp>=m.cost&&g.activePlayerId===O;return a.jsx("div",{onMouseDown:z=>{Rm(z,x),Jr&&Ue(x===xe?null:x)},onTouchStart:z=>{Rm(z,x),Jr&&Ue(x===xe?null:x)},style:{position:"absolute",left:"50%",bottom:5*h,transform:`translateX(calc(-50% + ${$}px)) translateY(${V}px) rotate(${q}deg) ${(Q==null?void 0:Q.sourceType)==="HAND"&&Q.sourceIndex===x?"scale(1.05) translateY(-10px)":Jr?"translateY(-3px)":""}`,transition:g2===x?"all 0.3s ease-in":(Q==null?void 0:Q.sourceType)==="HAND"&&Q.sourceIndex===x?"none":"all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1)",zIndex:(Q==null?void 0:Q.sourceType)==="HAND"&&Q.sourceIndex===x?1e3:x+100,width:(W?80:fn)*h,height:(W?115:Tn)*h,pointerEvents:"auto",cursor:B?"grab":"not-allowed"},onClick:z=>z.stopPropagation(),children:a.jsx(ho,{card:m,turnCount:g.turnCount,isMyTurn:g.activePlayerId===O,isPlayable:B,scale:h,variant:W?"mobile-hand":"normal",style:{width:W?80*h:fn*h,height:W?115*h:Tn*h,boxShadow:(Q==null?void 0:Q.sourceType)==="HAND"&&Q.sourceIndex===x?"0 0 40px rgba(49, 130, 206, 0.8)":B?"0 0 15px rgba(40, 180, 100, 0.6)":"none"}})},m.instanceId)})}),W&&a.jsxs("div",{style:{position:"absolute",bottom:200*h,left:15*h,display:"flex",alignItems:"center",gap:10*h,zIndex:601,pointerEvents:"none"},children:[a.jsxs("div",{style:{position:"relative",width:50*h,height:62*h},children:[a.jsx("div",{style:{position:"absolute",inset:0,background:"#4a5568",borderRadius:6*h,border:"1px solid #718096",transform:"rotate(-15deg) translate(-5px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#2d3748",borderRadius:6*h,border:"1px solid #718096",transform:"rotate(-5deg) translate(-2px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#1a202c",borderRadius:6*h,border:"1px solid #cbd5e0",transform:"rotate(5deg)"}})]}),a.jsxs("div",{style:{background:"rgba(0,0,0,0.7)",padding:`${6*h}px ${16*h}px`,borderRadius:10*h,color:"#e2e8f0",fontSize:`${1.32*h}rem`,fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5)"},children:[" ",le.hand.length]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6*h,marginLeft:10*h},children:[a.jsx("div",{style:{fontSize:`${1.87*h}rem`,filter:"drop-shadow(0 0 3px rgba(128, 90, 213, 0.8))"},children:""}),a.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(128, 90, 213, 0.8), rgba(76, 29, 149, 0.9))",padding:`${6*h}px ${16*h}px`,borderRadius:10*h,color:"#e2e8f0",fontSize:`${1.32*h}rem`,fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5), inset 0 1px rgba(255,255,255,0.1)",border:"1px solid rgba(167, 139, 250, 0.5)",position:"relative"},children:[" ",le.graveyard.length,ma.filter(m=>m.playerId===O).map(m=>a.jsxs("div",{style:{position:"absolute",top:-30,left:"50%",transform:"translateX(-50%)",color:"#d946ef",fontSize:"1.5rem",fontWeight:"bold",textShadow:"0 0 10px #d946ef, 0 0 20px #a855f7, 0 0 30px #7c3aed",animation:"necromanceFloat 1.5s ease-out forwards",pointerEvents:"none",whiteSpace:"nowrap"},children:["-",m.amount]},m.key))]})]})]}),W&&He&&He.owner==="PLAYER"&&He.source==="HAND"&&Jr&&(()=>{const m=Math.max(140,180*h),x=4*h,b=(m-x)/2,L=le.pp>=He.card.cost;return a.jsxs("div",{style:{position:"absolute",left:15*h,bottom:135*h,zIndex:600,pointerEvents:"auto"},children:[a.jsxs("button",{disabled:!L,onClick:$=>{$.stopPropagation(),Dm()},className:L?"play-button-active":"",style:{width:b,background:L?"linear-gradient(to bottom, #48bb78, #38a169)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:`${5*h}px ${3*h}px`,borderRadius:10*h,fontSize:`${.7*h}rem`,fontWeight:"bold",cursor:L?"pointer":"not-allowed",boxShadow:L?"0 0 12px rgba(72, 187, 120, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},onMouseDown:$=>$.stopPropagation(),children:["",a.jsxs("div",{style:{fontSize:`${.5*h}rem`,opacity:.8,marginTop:1},children:["pp ",He.card.cost]})]}),a.jsx("style",{children:`
                                @keyframes playGlowPulse {
                                    0% { box-shadow: 0 0 10px rgba(72, 187, 120, 0.4); }
                                    50% { box-shadow: 0 0 25px rgba(72, 187, 120, 0.8); }
                                    100% { box-shadow: 0 0 10px rgba(72, 187, 120, 0.4); }
                                }
                                .play-button-active {
                                    animation: playGlowPulse 2s infinite ease-in-out;
                                }
                            `})]})})(),W&&He&&He.owner==="PLAYER"&&He.source==="BOARD"&&(()=>{const m=Math.max(140,180*h),x=4*h,b=(m-x)/2,L=He.card,$=L==null?void 0:L.hasEvolved,V=!$&&Ss,q=!$&&ws,B=L==null?void 0:L.instanceId,z=le.board.findIndex(ee=>ee&&ee.instanceId===B),Y=le.board.slice(0,z+1).filter(ee=>ee).length-1,ue=ee=>{z<0||Ac(Y>=0?Y:z,ee,void 0,B)};return a.jsxs("div",{style:{position:"absolute",left:15*h,bottom:135*h,zIndex:600,pointerEvents:"auto",display:"flex",gap:x},onMouseDown:ee=>ee.stopPropagation(),children:[a.jsxs("button",{disabled:!V,onClick:ee=>{ee.stopPropagation(),ue(!1)},style:{width:b,background:V?"linear-gradient(to bottom, #faf089, #d69e2e)":"#718096",color:V?"#1a202c":"white",border:"2px solid rgba(255,255,255,0.2)",padding:`${5*h}px ${3*h}px`,borderRadius:10*h,fontSize:`${.7*h}rem`,fontWeight:"bold",cursor:V?"pointer":"not-allowed",boxShadow:V?"0 0 12px rgba(250, 240, 137, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:V?"0 1px 1px rgba(255,255,255,0.3)":"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",a.jsx("div",{style:{fontSize:`${.5*h}rem`,opacity:.8,marginTop:1},children:"EP"})]}),a.jsxs("button",{disabled:!q,onClick:ee=>{ee.stopPropagation(),ue(!0)},style:{width:b,background:q?"linear-gradient(to bottom, #b794f4, #805ad5)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:`${5*h}px ${3*h}px`,borderRadius:10*h,fontSize:`${.7*h}rem`,fontWeight:"bold",cursor:q?"pointer":"not-allowed",boxShadow:q?"0 0 12px rgba(183, 148, 244, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",a.jsx("div",{style:{fontSize:`${.5*h}rem`,opacity:.8,marginTop:1},children:"SEP"})]})]})})(),xs&&Array.from({length:xs.count},(m,x)=>{const q=-(xs.count*80+(xs.count-1)*20-80)/2+x*100,B=xs.isPlayer?xi((le==null?void 0:le.class)||"SENKA"):xi((Ne==null?void 0:Ne.class)||"SENKA");return a.jsx("div",{style:{position:"absolute",left:xs.isPlayer?"calc(100% - 90px)":90,top:xs.isPlayer?"calc(100% - 105px)":105,width:80,height:110,borderRadius:8,border:"2px solid white",overflow:"hidden",transform:`translateX(${q}px)`,animation:`drawCard${xs.isPlayer?"Player":"Opponent"} ${If}ms cubic-bezier(0.2, 0.8, 0.2, 1) forwards`,zIndex:9e3+x,boxShadow:"0 0 10px rgba(255,255,255,0.5)"},children:a.jsx("img",{src:B,alt:"Card Back",style:{width:"100%",height:"100%",objectFit:"cover"},onError:z=>{z.target.style.display="none",z.target.parentElement.style.background="repeating-linear-gradient(45deg, #2d3748, #2d3748 10px, #1a202c 10px, #1a202c 20px)"}})},x)}),a.jsx("style",{children:`
                        @keyframes drawCardPlayer {
                            0% { opacity: 1; }
                            100% { transform: translate(-50vw, -100px) scale(0.5) rotate(-10deg); opacity: 0; }
                        }
                        @keyframes drawCardOpponent {
                            0% { opacity: 1; }
                            100% { transform: translate(50vw, 200px) scale(0.5) rotate(10deg); opacity: 0; }
                        }
                    `})]}),E2.map(m=>a.jsx(g3,{value:m.value,x:m.x,y:m.y,color:m.color,scale:h,onComplete:()=>Tc(x=>x.filter(b=>b.id!==m.id))},m.id)),M&&Vr.current&&(()=>{const m=Vr.current.x,x=Vr.current.y,b=200,L=320,V=180/8,q=(B,z,Y,ue)=>{const ee=B*Math.PI/180,ge=z*Math.PI/180,Ee=Math.cos(ee)*ue,qe=-Math.sin(ee)*ue,Te=Math.cos(ge)*ue,Je=-Math.sin(ge)*ue,rt=Math.cos(ge)*Y,Ke=-Math.sin(ge)*Y,Xe=Math.cos(ee)*Y,me=-Math.sin(ee)*Y;return`M ${Ee} ${qe} A ${ue} ${ue} 0 0 0 ${Te} ${Je} L ${rt} ${Ke} A ${Y} ${Y} 0 0 1 ${Xe} ${me} Z`};return a.jsxs("div",{style:{position:"fixed",left:m,top:x,zIndex:2e3,pointerEvents:"none",animation:"stampUIFadeIn 0.15s ease-out"},children:[a.jsx("svg",{width:L*2+20,height:L+20,style:{position:"absolute",left:-330,top:-330,overflow:"visible"},children:a.jsx("g",{transform:`translate(${L+10}, ${L+10})`,children:i0.map((B,z)=>{const Y=180-z*V,ue=Y-V,ee=lt===B.id,Ee=(Y+ue)/2*Math.PI/180,qe=(b+L)/2,Te=Math.cos(Ee)*qe,Je=-Math.sin(Ee)*qe,rt=85;return a.jsxs("g",{children:[a.jsx("path",{d:q(Y,ue,b,L),fill:ee?"rgba(255, 215, 0, 0.4)":"rgba(0, 0, 0, 0.7)",stroke:ee?"#ffd700":"rgba(255, 255, 255, 0.3)",strokeWidth:ee?3:1,style:{transition:"all 0.1s ease-out"}}),a.jsx("defs",{children:a.jsx("clipPath",{id:`stampClip-${B.id}`,children:a.jsx("circle",{cx:Te,cy:Je,r:rt/2})})}),a.jsx("image",{href:it(av(B.id,er)),x:Te-rt/2,y:Je-rt/2,width:rt,height:rt,clipPath:`url(#stampClip-${B.id})`,style:{transform:ee?"scale(1.15)":"scale(1)",transformOrigin:`${Te}px ${Je}px`,transition:"transform 0.1s ease-out"}}),a.jsx("circle",{cx:Te,cy:Je,r:rt/2,fill:"none",stroke:ee?"#ffd700":"rgba(255, 255, 255, 0.5)",strokeWidth:ee?2:1})]},B.id)})})}),a.jsx("style",{children:`
                                @keyframes stampUIFadeIn {
                                    from { opacity: 0; transform: scale(0.8); }
                                    to { opacity: 1; transform: scale(1); }
                                }
                            `})]})})(),Vt&&a.jsxs("div",{style:{position:"fixed",left:"50%",top:"40%",transform:"translate(-50%, -50%)",zIndex:2500,pointerEvents:"none",animation:"stampDisplay 3s ease-out forwards"},children:[a.jsx("div",{style:{width:250,height:250,borderRadius:20,overflow:"hidden",boxShadow:"0 0 40px rgba(0,0,0,0.5), 0 0 60px rgba(255,255,255,0.2)",border:"4px solid rgba(255,255,255,0.3)"},children:a.jsx("img",{src:it(av(Vt.stampId,Vt.playerClass)),alt:"",style:{width:"100%",height:"100%",objectFit:"cover"}})}),Vt.playerId!==O&&a.jsx("div",{style:{position:"absolute",bottom:-30,left:"50%",transform:"translateX(-50%)",background:"rgba(0,0,0,0.7)",padding:"5px 15px",borderRadius:15,color:"#fff",fontSize:"0.9rem",whiteSpace:"nowrap"},children:""}),a.jsx("style",{children:`
                            @keyframes stampDisplay {
                                0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
                                10% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
                                20% { transform: translate(-50%, -50%) scale(1); }
                                80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                                100% { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
                            }
                        `})]},Vt.timestamp),a.jsx("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:1e3},children:Q&&(Q.sourceType==="BOARD"||Q.sourceType==="EVOLVE")&&a.jsxs(a.Fragment,{children:[a.jsxs("defs",{children:[a.jsxs("filter",{id:"cyanGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{stdDeviation:"10",result:"blur1"}),a.jsx("feFlood",{floodColor:"rgba(100, 200, 255, 0.7)",result:"color1"}),a.jsx("feComposite",{in:"color1",in2:"blur1",operator:"in",result:"glow1"}),a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"5",result:"blur2"}),a.jsx("feFlood",{floodColor:"rgba(150, 220, 255, 0.5)",result:"color2"}),a.jsx("feComposite",{in:"color2",in2:"blur2",operator:"in",result:"glow2"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"glow1"}),a.jsx("feMergeNode",{in:"glow2"})]})]}),a.jsxs("filter",{id:"yellowGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{stdDeviation:"10",result:"blur1"}),a.jsx("feFlood",{floodColor:"rgba(255, 255, 50, 0.7)",result:"color1"}),a.jsx("feComposite",{in:"color1",in2:"blur1",operator:"in",result:"glow1"}),a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"5",result:"blur2"}),a.jsx("feFlood",{floodColor:"rgba(255, 240, 100, 0.5)",result:"color2"}),a.jsx("feComposite",{in:"color2",in2:"blur2",operator:"in",result:"glow2"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"glow1"}),a.jsx("feMergeNode",{in:"glow2"})]})]}),a.jsxs("filter",{id:"softWhiteGlow",x:"-300%",y:"-300%",width:"700%",height:"700%",children:[a.jsx("feGaussianBlur",{stdDeviation:"20",result:"blur"}),a.jsx("feFlood",{floodColor:"rgba(255, 255, 255, 0.9)",result:"color"}),a.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"glow"}),a.jsx("feMergeNode",{in:"glow"}),a.jsx("feMergeNode",{in:"glow"})]})]}),a.jsxs("filter",{id:"innerCoreGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{stdDeviation:"4",result:"blur"}),a.jsx("feFlood",{floodColor:"rgba(255, 255, 255, 0.8)",result:"color"}),a.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),a.jsx("feMerge",{children:a.jsx("feMergeNode",{in:"glow"})})]}),a.jsxs("filter",{id:"coloredBallGlow",x:"-150%",y:"-150%",width:"400%",height:"400%",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"6",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"blur"})]})]}),a.jsxs("filter",{id:"particleGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"2",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),a.jsxs("filter",{id:"purpleGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{stdDeviation:"10",result:"blur1"}),a.jsx("feFlood",{floodColor:"rgba(183, 148, 244, 0.7)",result:"color1"}),a.jsx("feComposite",{in:"color1",in2:"blur1",operator:"in",result:"glow1"}),a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"5",result:"blur2"}),a.jsx("feFlood",{floodColor:"rgba(200, 170, 255, 0.5)",result:"color2"}),a.jsx("feComposite",{in:"color2",in2:"blur2",operator:"in",result:"glow2"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"glow1"}),a.jsx("feMergeNode",{in:"glow2"})]})]})]}),Q.sourceType==="BOARD"&&a.jsxs(a.Fragment,{children:[a.jsx("path",{d:Es(),fill:"none",stroke:"rgba(100, 200, 255, 0.3)",strokeWidth:"20",strokeLinecap:"butt",filter:"url(#cyanGlow)"}),a.jsx("path",{d:Es(),fill:"none",stroke:"rgba(150, 220, 255, 0.5)",strokeWidth:"10",strokeLinecap:"butt"}),a.jsx("path",{d:Es(),fill:"none",stroke:"rgba(200, 240, 255, 0.9)",strokeWidth:"4",strokeLinecap:"butt"}),a.jsx("path",{d:Es(),fill:"none",stroke:"rgba(255, 255, 255, 1)",strokeWidth:"2",strokeLinecap:"butt"})]}),Q.sourceType==="EVOLVE"&&a.jsxs(a.Fragment,{children:[a.jsx("path",{d:Es(),fill:"none",stroke:Q.useSep?"rgba(159, 122, 234, 0.3)":"rgba(236, 201, 75, 0.3)",strokeWidth:"20",strokeLinecap:"butt",filter:Q.useSep?"url(#purpleGlow)":"url(#yellowGlow)"}),a.jsx("path",{d:Es(),fill:"none",stroke:Q.useSep?"rgba(183, 148, 244, 0.5)":"rgba(246, 224, 94, 0.5)",strokeWidth:"10",strokeLinecap:"butt"}),a.jsx("path",{d:Es(),fill:"none",stroke:Q.useSep?"rgba(214, 188, 250, 0.9)":"rgba(250, 240, 137, 0.9)",strokeWidth:"4",strokeLinecap:"butt"}),a.jsx("path",{d:Es(),fill:"none",stroke:"rgba(255, 255, 255, 1)",strokeWidth:"2",strokeLinecap:"butt"})]}),(Q.sourceType==="BOARD"||Q.sourceType==="EVOLVE")&&a.jsxs(a.Fragment,{children:[a.jsx("circle",{cx:Q.startX,cy:Q.startY,r:"15",fill:"rgba(255, 255, 255, 0.3)",filter:"url(#softWhiteGlow)"}),a.jsx("circle",{cx:Q.startX,cy:Q.startY,r:"8",fill:"rgba(255, 255, 255, 0.4)",filter:"url(#softWhiteGlow)"})]}),(Q.sourceType==="BOARD"||Q.sourceType==="EVOLVE")&&a.jsxs(a.Fragment,{children:[a.jsx("circle",{cx:Q.currentX,cy:Q.currentY,r:"18",fill:"rgba(255, 255, 255, 0.25)",filter:"url(#softWhiteGlow)"}),a.jsx("circle",{cx:Q.currentX,cy:Q.currentY,r:"8",fill:"rgba(255, 255, 255, 0.35)",filter:"url(#softWhiteGlow)"}),a.jsx("circle",{cx:Q.currentX,cy:Q.currentY,r:"3",fill:"rgba(255, 255, 255, 0.7)",filter:"url(#innerCoreGlow)"})]}),h2.map(m=>{const x=Q.sourceType==="EVOLVE"?Q.useSep?`rgba(230, 220, 255, ${m.opacity})`:`rgba(255, 255, 230, ${m.opacity})`:`rgba(220, 245, 255, ${m.opacity})`;return a.jsx("circle",{cx:m.x,cy:m.y,r:m.radius,fill:x,filter:"url(#particleGlow)"},m.id)})]})}),qt&&a.jsxs("svg",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100dvh",pointerEvents:"none",zIndex:99999},children:[a.jsx("defs",{children:a.jsxs("filter",{id:"endTurnGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{stdDeviation:"6",result:"blur"}),a.jsx("feFlood",{floodColor:"rgba(100, 200, 255, 0.8)",result:"color"}),a.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"glow"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsx("circle",{cx:qt.x,cy:qt.y,r:qt.ringRadius,fill:"none",stroke:`rgba(100, 200, 255, ${Math.max(0,1-qt.ringRadius/120)*.8})`,strokeWidth:"4",filter:"url(#endTurnGlow)"}),a.jsx("circle",{cx:qt.x,cy:qt.y,r:qt.ringRadius*.8,fill:"none",stroke:`rgba(255, 255, 255, ${Math.max(0,1-qt.ringRadius/120)*.6})`,strokeWidth:"2"}),a.jsx("circle",{cx:qt.x,cy:qt.y,r:20,fill:`rgba(255, 255, 255, ${Math.max(0,1-qt.ringRadius/120)*.9})`}),qt.particles.map(m=>a.jsx("circle",{cx:m.x,cy:m.y,r:4,fill:`rgba(255, 255, 255, ${m.opacity*.8})`},m.id))]}),Qe&&a.jsxs("div",{style:{position:"absolute",inset:0,zIndex:9999,pointerEvents:"auto",background:"rgba(0,0,0,0.5)",perspective:"1200px"},children:[a.jsx("style",{children:`
                                @keyframes playCardSequence {
                                    ${Qe.finalX!==void 0?`
                                    /* Phase 1: Start at hand position (0%) */
                                    0% {
                                        transform: translate(${Qe.startX-Qe.targetX}px, ${Qe.startY-Qe.targetY}px) translate(-50%, -50%) scale(1.0) rotateY(0deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Phase 1b: Mid-rotation during move (12.5%) - CRITICAL: explicit 180deg to force rotation direction */
                                    12.5% {
                                        transform: translate(${(Qe.startX-Qe.targetX)*.5}px, ${(Qe.startY-Qe.targetY)*.5}px) translate(-50%, -50%) scale(1.5) rotateY(180deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Phase 2: Arrive at center with rotation complete (25%) */
                                    25% {
                                        transform: translate(-50%, -50%) scale(1.8) rotateY(360deg);
                                        opacity: 1;
                                        animation-timing-function: ease-out;
                                    }
                                    /* Phase 3: Hold at center (25%-80%) */
                                    80% {
                                        transform: translate(-50%, -50%) scale(2.4) rotateY(360deg);
                                        opacity: 1;
                                    }
                                    /* Phase 4: Move to board position (80%-100%) */
                                    100% {
                                        transform: translate(calc(-50% + ${Qe.finalX-Qe.targetX}px), calc(-50% + ${Qe.finalY-Qe.targetY}px)) scale(1.0) rotateY(360deg);
                                        opacity: 1;
                                    }
                                    `:`
                                    /* Spell: Move to center while rotating, then fade */
                                    0% {
                                        transform: translate(${Qe.startX-Qe.targetX}px, ${Qe.startY-Qe.targetY}px) translate(-50%, -50%) scale(1.0) rotateY(0deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Mid-rotation during move (15%) - CRITICAL: explicit 180deg */
                                    15% {
                                        transform: translate(${(Qe.startX-Qe.targetX)*.5}px, ${(Qe.startY-Qe.targetY)*.5}px) translate(-50%, -50%) scale(1.7) rotateY(180deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    30% {
                                        transform: translate(-50%, -50%) scale(2.2) rotateY(360deg);
                                        opacity: 1;
                                        animation-timing-function: ease-out;
                                    }
                                    80% {
                                        transform: translate(-50%, -50%) scale(2.4) rotateY(360deg);
                                        opacity: 1;
                                    }
                                    100% {
                                        transform: translate(-50%, -50%) scale(3.0) rotateY(360deg);
                                        opacity: 0;
                                    }
                                    `}
                                }
                                @keyframes playSpellSequence {
                                    /* Move from hand to center while rotating (0-30%) */
                                    0% {
                                        transform: translate(${Qe.startX-Qe.targetX}px, ${Qe.startY-Qe.targetY}px) translate(-50%, -50%) scale(1.0) rotateY(0deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Mid-rotation during move (15%) - CRITICAL: explicit 180deg to force rotation direction */
                                    15% {
                                        transform: translate(${(Qe.startX-Qe.targetX)*.5}px, ${(Qe.startY-Qe.targetY)*.5}px) translate(-50%, -50%) scale(1.7) rotateY(180deg);
                                        opacity: 1;
                                        filter: brightness(1);
                                        animation-timing-function: linear;
                                    }
                                    /* Arrive at center with rotation complete (30%) */
                                    30% {
                                        transform: translate(-50%, -50%) scale(2.2) rotateY(360deg);
                                        opacity: 1;
                                        filter: brightness(1);
                                        animation-timing-function: ease-out;
                                    }
                                    /* Hold at center (30%-75%) */
                                    75% {
                                        transform: translate(-50%, -50%) scale(2.4) rotateY(360deg);
                                        opacity: 1;
                                        filter: brightness(1.2);
                                    }
                                    /* Fade out (75%-100%) */
                                    100% {
                                        transform: translate(-50%, -50%) scale(3.0) rotateY(360deg);
                                        opacity: 0;
                                        filter: brightness(3);
                                    }
                                }
                                .play-card-flipper {
                                    transform-style: preserve-3d !important;
                                }
                                .play-card-front, .play-card-back {
                                    backface-visibility: hidden !important;
                                    -webkit-backface-visibility: hidden !important;
                                    position: absolute;
                                    width: 100%;
                                    height: 100%;
                                }
                                .play-card-back {
                                    transform: rotateY(180deg) translateZ(1px);
                                }
                            `}),a.jsxs("div",{className:"play-card-flipper",onAnimationEnd:Qe.onComplete,style:{position:"absolute",left:Qe.targetX,top:Qe.targetY,width:fn*h,height:Tn*h,transformStyle:"preserve-3d",animation:Qe.card.type==="SPELL"?"playSpellSequence 1s forwards":"playCardSequence 0.8s forwards"},children:[a.jsx("div",{className:"play-card-front",children:a.jsx(ho,{card:Qe.card,isOnBoard:!0,suppressPassives:!0,scale:h,style:{width:fn*h,height:Tn*h,boxShadow:"0 0 50px rgba(255,215,0,0.8)"}})}),a.jsx("div",{className:"play-card-back",style:{borderRadius:12,boxShadow:"0 0 50px rgba(255,215,0,0.8)",overflow:"hidden"},children:a.jsx("img",{src:xi(Qe.playerClass),alt:"Card Sleeve",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:12},onError:m=>{const x=m.target;x.style.display="none",x.parentElement&&(x.parentElement.style.background="linear-gradient(135deg, #1e3a5f 0%, #0d1b2a 50%, #1e3a5f 100%)")}})}),Qe.card.type==="SPELL"&&a.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none"},children:a.jsx(m3,{x:0,y:0})})]})]}),no.length>0&&no.map((m,x)=>a.jsx("div",{style:{position:"absolute",left:m.status==="FLY"&&m.targetX!==void 0?m.targetX:window.innerWidth/2+m.xOffset,top:m.status==="FLY"&&m.targetY!==void 0?m.targetY:window.innerHeight/2,transform:m.status==="APPEAR"?"translate(-50%, -50%) scale(1.2)":"translate(-50%, -50%) scale(0.2)",zIndex:7e3+x,pointerEvents:"none",transition:m.status==="FLY"?"all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)":"none",opacity:m.status==="FLY"?.3:1,animation:m.status==="APPEAR"?"cardAppear 0.8s ease-out":void 0},children:a.jsx(ho,{card:m.card,scale:h,style:{width:fn*h,height:Tn*h}})},x)),a.jsx("style",{children:`
                    @keyframes cardAppear {
                        0% { transform: translate(-50%, -50%) scale(0) rotate(-10deg); opacity: 0; }
                        50% { transform: translate(-50%, -50%) scale(1.3) rotate(5deg); opacity: 1; }
                        100% { transform: translate(-50%, -50%) scale(1.2) rotate(0deg); opacity: 1; }
                    }
                `}),Ec.map(m=>m.type==="BUFF"?a.jsx(f3,{x:m.x,y:m.y,atkBuff:m.atkBuff??0,hpBuff:m.hpBuff??0,onComplete:()=>ro(x=>x.filter(b=>b.key!==m.key))},m.key):a.jsx(p3,{type:m.type,x:m.x,y:m.y,onComplete:()=>ro(x=>x.filter(b=>b.key!==m.key)),audioSettings:Ot,scale:h},m.key)),jt&&a.jsx(x3,{card:jt.card,evolvedImageUrl:jt.evolvedImageUrl,startX:jt.startX,startY:jt.startY,phase:jt.phase,onPhaseChange:w2,onShake:Gn,useSep:jt.useSep,playSE:St,scale:h,isLightMode:re}),mi&&a.jsxs("div",{style:{position:"fixed",top:"45%",left:`${340*h}px`,width:`calc(100% - ${340*h}px)`,display:"flex",justifyContent:"center",alignItems:"center",transform:"translateY(-50%)",zIndex:9e3,pointerEvents:"none",animation:"notificationFade 2.5s forwards"},children:[a.jsx("div",{style:{padding:`${20*h}px ${90*h}px`,background:"rgba(0, 0, 0, 0.75)",backdropFilter:"blur(16px)",borderTop:`${3*h}px solid ${mi==="EVOLVE_READY"?"rgba(255, 215, 0, 0.7)":"rgba(180, 0, 255, 0.7)"}`,borderBottom:`${3*h}px solid ${mi==="EVOLVE_READY"?"rgba(255, 215, 0, 0.7)":"rgba(180, 0, 255, 0.7)"}`,boxShadow:mi==="EVOLVE_READY"?`0 0 ${50*h}px rgba(255, 180, 0, 0.5), inset 0 0 ${30*h}px rgba(255, 215, 0, 0.2)`:`0 0 ${50*h}px rgba(180, 0, 255, 0.5), inset 0 0 ${30*h}px rgba(180, 0, 255, 0.2)`,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",borderRadius:`${4*h}px`},children:a.jsx("span",{style:{fontSize:`${5*h}rem`,fontWeight:"900",fontFamily:'"YuMincho", "Hiragino Mincho ProN", "MS Mincho", serif',color:"#fff",letterSpacing:`${.8*h}rem`,whiteSpace:"nowrap",textShadow:mi==="EVOLVE_READY"?`0 0 ${15*h}px rgba(255, 215, 0, 1), 0 0 ${30*h}px rgba(255, 180, 0, 0.8), ${2*h}px ${2*h}px ${4*h}px rgba(0,0,0,0.9)`:`0 0 ${15*h}px rgba(180, 0, 255, 1), 0 0 ${30*h}px rgba(140, 0, 255, 0.8), ${2*h}px ${2*h}px ${4*h}px rgba(0,0,0,0.9)`,WebkitTextStroke:mi==="EVOLVE_READY"?`${1.5*h}px #ffd700`:`${1.5*h}px #b400ff`},children:mi==="EVOLVE_READY"?"":""})}),a.jsx("style",{children:`
                            @keyframes notificationFade {
                                0% { opacity: 0; transform: translateY(-40%) scale(0.8); filter: blur(15px); }
                                10% { opacity: 1; transform: translateY(-50%) scale(1); filter: blur(0px); }
                                90% { opacity: 1; transform: translateY(-50%) scale(1); filter: blur(0px); }
                                100% { opacity: 0; transform: translateY(-60%) scale(1.15); filter: blur(20px); }
                            }
                        `})]}),Oe&&g.winnerId&&a.jsx(e3,{isVictory:g.winnerId===O,loserLeaderRef:g.winnerId===O?io:vi,onComplete:()=>{_e(!1),et(!0),nt(null),Ct(0),(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&_&&(console.log("[GameScreen] Disconnecting after game over (casual match)"),_.disconnect())},onPhaseChange:nt,onShakeIntensityChange:Ct,scale:h}),g.winnerId&&at&&a.jsx(I3,{winnerId:g.winnerId,playerId:O,playerClass:(le==null?void 0:le.class)||"SENKA",isOnline:e==="ONLINE",isRoomMatch:n==="HOST"||n==="JOIN",myRematchRequested:gf,opponentRematchRequested:dc,battleStats:{turnCount:g.turnCount,damageDealtToOpponent:vs.damageDealtToOpponent,damageReceivedFromOpponent:vs.damageReceivedFromOpponent,followersDestroyed:vs.followersDestroyed,myFollowersDestroyed:vs.myFollowersDestroyed},selectedCardInfo:mf,onCardInfoClick:ga,victoryReason:uc,isRankedMatch:n==="RANKED_MATCH",ratingResult:yf,onRematching:i,onRematch:m=>{e==="ONLINE"?(cc(!0),dc?(_==null||_.send({type:"REMATCH_ACCEPT"}),Of(m)):(_==null||_.send({type:"REMATCH_REQUEST"}),hc(m))):Of(m)},onLeave:s})]})]})},C3=async()=>(await DP(lc)).user,k3=async(t,e)=>(await BP(lc,t,e)).user,R3=async(t,e)=>{const n=lc.currentUser;if(!n)throw new Error("No user logged in");const r=Ji.credential(t,e);return(await FP(n,r)).user},A3=async()=>{await GP(lc)},P3=t=>WP(lc,t),Wx=1280,Gx=720,O3=({onRegisterSuccess:t,onBack:e})=>{const[n,r]=A.useState(""),[s,i]=A.useState(""),[o,l]=A.useState(""),[c,d]=A.useState(""),[u,p]=A.useState(!1),[f,S]=A.useState(1);A.useEffect(()=>{const v=()=>{const w=window.innerWidth/Wx,h=window.innerHeight/Gx;S(Math.min(w,h))};return v(),window.addEventListener("resize",v),()=>window.removeEventListener("resize",v)},[]);const R=v=>/^[a-zA-Z0-9_]{3,20}$/.test(v),C=v=>`${v}@tenfubu-game.local`,j=async()=>{if(d(""),!n||!s||!o){d("");return}if(!R(n)){d("ID3-20");return}if(s.length<6){d("6");return}if(s!==o){d("");return}p(!0);try{const v=C(n);await R3(v,s),t()}catch(v){console.error("Registration error:",v),console.error("Error code:",v==null?void 0:v.code),console.error("Error message:",v==null?void 0:v.message);const w=(v==null?void 0:v.code)||"";d(w==="auth/email-already-in-use"?"ID":w==="auth/invalid-email"?"ID":w==="auth/weak-password"?"6":w==="auth/requires-recent-login"?"":w==="auth/provider-already-linked"?"ID":w==="auth/credential-already-in-use"?"ID":` (${w||"unknown error"})`)}finally{p(!1)}},_=v=>{v.key==="Enter"&&!u&&j()};return a.jsx("div",{style:{width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",overflow:"hidden"},children:a.jsxs("div",{style:{width:Wx*f,height:Gx*f,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative"},children:[a.jsx("h1",{style:{fontSize:48*f,fontWeight:"bold",color:"#fff",marginBottom:40*f,textShadow:"0 4px 8px rgba(0,0,0,0.5)"},children:""}),a.jsxs("div",{style:{width:400*f,display:"flex",flexDirection:"column",gap:20*f},children:[a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*f,color:"#fff",marginBottom:8*f,fontWeight:"bold"},children:"ID"}),a.jsx("input",{type:"text",value:n,onChange:v=>r(v.target.value),onKeyPress:_,placeholder:"player123",disabled:u,style:{width:"100%",padding:`${12*f}px ${16*f}px`,fontSize:16*f,borderRadius:8*f,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:v=>v.currentTarget.style.borderColor="#4a9eff",onBlur:v=>v.currentTarget.style.borderColor="#444"}),a.jsx("p",{style:{fontSize:12*f,color:"#888",marginTop:4*f,marginBottom:0},children:"3-20"})]}),a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*f,color:"#fff",marginBottom:8*f,fontWeight:"bold"},children:"6"}),a.jsx("input",{type:"password",value:s,onChange:v=>i(v.target.value),onKeyPress:_,placeholder:"",disabled:u,style:{width:"100%",padding:`${12*f}px ${16*f}px`,fontSize:16*f,borderRadius:8*f,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:v=>v.currentTarget.style.borderColor="#4a9eff",onBlur:v=>v.currentTarget.style.borderColor="#444"})]}),a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*f,color:"#fff",marginBottom:8*f,fontWeight:"bold"},children:""}),a.jsx("input",{type:"password",value:o,onChange:v=>l(v.target.value),onKeyPress:_,placeholder:"",disabled:u,style:{width:"100%",padding:`${12*f}px ${16*f}px`,fontSize:16*f,borderRadius:8*f,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:v=>v.currentTarget.style.borderColor="#4a9eff",onBlur:v=>v.currentTarget.style.borderColor="#444"})]}),c&&a.jsx("div",{style:{padding:`${12*f}px ${16*f}px`,borderRadius:8*f,background:"rgba(255, 80, 80, 0.2)",border:"2px solid #ff5050",color:"#ff5050",fontSize:14*f,textAlign:"center"},children:c}),a.jsxs("div",{style:{display:"flex",gap:16*f,marginTop:20*f},children:[a.jsx("button",{onClick:e,disabled:u,style:{flex:1,padding:`${16*f}px ${32*f}px`,fontSize:18*f,fontWeight:"bold",borderRadius:8*f,border:"none",background:"#555",color:"#fff",cursor:u?"not-allowed":"pointer",transition:"all 0.3s",opacity:u?.5:1},onMouseEnter:v=>!u&&(v.currentTarget.style.background="#666"),onMouseLeave:v=>!u&&(v.currentTarget.style.background="#555"),children:""}),a.jsx("button",{onClick:j,disabled:u,style:{flex:1,padding:`${16*f}px ${32*f}px`,fontSize:18*f,fontWeight:"bold",borderRadius:8*f,border:"none",background:u?"#555":"linear-gradient(135deg, #4a9eff 0%, #357abd 100%)",color:"#fff",cursor:u?"not-allowed":"pointer",transition:"all 0.3s",boxShadow:u?"none":"0 4px 8px rgba(0,0,0,0.3)"},onMouseEnter:v=>!u&&(v.currentTarget.style.transform="scale(1.05)"),onMouseLeave:v=>!u&&(v.currentTarget.style.transform="scale(1)"),children:u?"...":""})]}),a.jsxs("div",{style:{marginTop:20*f,padding:`${12*f}px ${16*f}px`,borderRadius:8*f,background:"rgba(74, 158, 255, 0.1)",border:"1px solid rgba(74, 158, 255, 0.3)",fontSize:13*f,color:"#aaa",textAlign:"center",lineHeight:1.6},children:["ID",a.jsx("br",{}),""]})]})]})})},Vx=1280,Yx=720,L3=({onLoginSuccess:t,onBack:e})=>{const[n,r]=A.useState(""),[s,i]=A.useState(""),[o,l]=A.useState(""),[c,d]=A.useState(!1),[u,p]=A.useState(1);A.useEffect(()=>{const C=()=>{const j=window.innerWidth/Vx,_=window.innerHeight/Yx;p(Math.min(j,_))};return C(),window.addEventListener("resize",C),()=>window.removeEventListener("resize",C)},[]);const f=C=>`${C}@tenfubu-game.local`,S=async()=>{if(l(""),!n||!s){l("ID");return}d(!0);try{const C=f(n);await k3(C,s),t()}catch(C){const j=(C==null?void 0:C.code)||"";l(j==="auth/user-not-found"?"":j==="auth/wrong-password"?"":j==="auth/invalid-email"?"ID":j==="auth/invalid-credential"?"ID":"")}finally{d(!1)}},R=C=>{C.key==="Enter"&&!c&&S()};return a.jsx("div",{style:{width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",overflow:"hidden"},children:a.jsxs("div",{style:{width:Vx*u,height:Yx*u,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative"},children:[a.jsx("h1",{style:{fontSize:48*u,fontWeight:"bold",color:"#fff",marginBottom:40*u,textShadow:"0 4px 8px rgba(0,0,0,0.5)"},children:""}),a.jsxs("div",{style:{width:400*u,display:"flex",flexDirection:"column",gap:20*u},children:[a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*u,color:"#fff",marginBottom:8*u,fontWeight:"bold"},children:"ID"}),a.jsx("input",{type:"text",value:n,onChange:C=>r(C.target.value),onKeyPress:R,placeholder:"player123",disabled:c,style:{width:"100%",padding:`${12*u}px ${16*u}px`,fontSize:16*u,borderRadius:8*u,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:C=>C.currentTarget.style.borderColor="#4a9eff",onBlur:C=>C.currentTarget.style.borderColor="#444"})]}),a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*u,color:"#fff",marginBottom:8*u,fontWeight:"bold"},children:""}),a.jsx("input",{type:"password",value:s,onChange:C=>i(C.target.value),onKeyPress:R,placeholder:"",disabled:c,style:{width:"100%",padding:`${12*u}px ${16*u}px`,fontSize:16*u,borderRadius:8*u,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:C=>C.currentTarget.style.borderColor="#4a9eff",onBlur:C=>C.currentTarget.style.borderColor="#444"})]}),o&&a.jsx("div",{style:{padding:`${12*u}px ${16*u}px`,borderRadius:8*u,background:"rgba(255, 80, 80, 0.2)",border:"2px solid #ff5050",color:"#ff5050",fontSize:14*u,textAlign:"center"},children:o}),a.jsxs("div",{style:{display:"flex",gap:16*u,marginTop:20*u},children:[a.jsx("button",{onClick:e,disabled:c,style:{flex:1,padding:`${16*u}px ${32*u}px`,fontSize:18*u,fontWeight:"bold",borderRadius:8*u,border:"none",background:"#555",color:"#fff",cursor:c?"not-allowed":"pointer",transition:"all 0.3s",opacity:c?.5:1},onMouseEnter:C=>!c&&(C.currentTarget.style.background="#666"),onMouseLeave:C=>!c&&(C.currentTarget.style.background="#555"),children:""}),a.jsx("button",{onClick:S,disabled:c,style:{flex:1,padding:`${16*u}px ${32*u}px`,fontSize:18*u,fontWeight:"bold",borderRadius:8*u,border:"none",background:c?"#555":"linear-gradient(135deg, #4a9eff 0%, #357abd 100%)",color:"#fff",cursor:c?"not-allowed":"pointer",transition:"all 0.3s",boxShadow:c?"none":"0 4px 8px rgba(0,0,0,0.3)"},onMouseEnter:C=>!c&&(C.currentTarget.style.transform="scale(1.05)"),onMouseLeave:C=>!c&&(C.currentTarget.style.transform="scale(1)"),children:c?"...":""})]}),a.jsx("div",{style:{marginTop:20*u,padding:`${12*u}px ${16*u}px`,borderRadius:8*u,background:"rgba(255, 200, 80, 0.1)",border:"1px solid rgba(255, 200, 80, 0.3)",fontSize:13*u,color:"#ffcc80",textAlign:"center",lineHeight:1.6},children:" "})]})]})})},Kx=1280,Xx=720,D3=({playerId:t,currentPlayerName:e,onUpdateSuccess:n,onBack:r})=>{const[s,i]=A.useState(e),[o,l]=A.useState(""),[c,d]=A.useState(!1),[u,p]=A.useState(!1),[f,S]=A.useState(1);A.useEffect(()=>{const j=()=>{const _=window.innerWidth/Kx,v=window.innerHeight/Xx;S(Math.min(_,v))};return j(),window.addEventListener("resize",j),()=>window.removeEventListener("resize",j)},[]);const R=async()=>{if(l(""),p(!1),!s.trim()){l("");return}if(s.length>20){l("20");return}if(!t){l("ID");return}d(!0);try{await dL(t,s.trim()),p(!0),setTimeout(()=>{n(s.trim())},1e3)}catch(j){console.error("Failed to update player name:",j),l("")}finally{d(!1)}},C=j=>{j.key==="Enter"&&!c&&R()};return a.jsx("div",{style:{width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",overflow:"hidden"},children:a.jsxs("div",{style:{width:Kx*f,height:Xx*f,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative"},children:[a.jsx("h1",{style:{fontSize:48*f,fontWeight:"bold",color:"#fff",marginBottom:40*f,textShadow:"0 4px 8px rgba(0,0,0,0.5)"},children:""}),a.jsxs("div",{style:{width:400*f,display:"flex",flexDirection:"column",gap:20*f},children:[a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*f,color:"#fff",marginBottom:8*f,fontWeight:"bold"},children:""}),a.jsx("input",{type:"text",value:s,onChange:j=>i(j.target.value),onKeyPress:C,placeholder:"",disabled:c,maxLength:20,style:{width:"100%",padding:`${12*f}px ${16*f}px`,fontSize:16*f,borderRadius:8*f,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:j=>j.currentTarget.style.borderColor="#4a9eff",onBlur:j=>j.currentTarget.style.borderColor="#444"}),a.jsx("p",{style:{fontSize:12*f,color:"#888",marginTop:4*f,marginBottom:0},children:"20"})]}),o&&a.jsx("div",{style:{padding:`${12*f}px ${16*f}px`,borderRadius:8*f,background:"rgba(255, 80, 80, 0.2)",border:"2px solid #ff5050",color:"#ff5050",fontSize:14*f,textAlign:"center"},children:o}),u&&a.jsx("div",{style:{padding:`${12*f}px ${16*f}px`,borderRadius:8*f,background:"rgba(80, 255, 120, 0.2)",border:"2px solid #50ff78",color:"#50ff78",fontSize:14*f,textAlign:"center"},children:" "}),a.jsxs("div",{style:{display:"flex",gap:16*f,marginTop:20*f},children:[a.jsx("button",{onClick:r,disabled:c,style:{flex:1,padding:`${16*f}px ${32*f}px`,fontSize:18*f,fontWeight:"bold",borderRadius:8*f,border:"none",background:"#555",color:"#fff",cursor:c?"not-allowed":"pointer",transition:"all 0.3s",opacity:c?.5:1},onMouseEnter:j=>!c&&(j.currentTarget.style.background="#666"),onMouseLeave:j=>!c&&(j.currentTarget.style.background="#555"),children:""}),a.jsx("button",{onClick:R,disabled:c,style:{flex:1,padding:`${16*f}px ${32*f}px`,fontSize:18*f,fontWeight:"bold",borderRadius:8*f,border:"none",background:c?"#555":"linear-gradient(135deg, #4a9eff 0%, #357abd 100%)",color:"#fff",cursor:c?"not-allowed":"pointer",transition:"all 0.3s",boxShadow:c?"none":"0 4px 8px rgba(0,0,0,0.3)"},onMouseEnter:j=>!c&&(j.currentTarget.style.transform="scale(1.05)"),onMouseLeave:j=>!c&&(j.currentTarget.style.transform="scale(1)"),children:c?"...":""})]})]})]})})},M3=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},N3=M3("/bgm/tenfubu.mp3"),ld={bgm:.3,se:.5,voice:.5,bgmEnabled:!0,seEnabled:!0},j3=()=>{try{const t=localStorage.getItem("audioSettings");if(t){const e=JSON.parse(t);if(e.enabled!==void 0){const{enabled:n,...r}=e;return{...ld,...r,bgmEnabled:n,seEnabled:n}}return{...ld,...e}}return ld}catch{return ld}},$3=()=>{const[t,e]=A.useState(!1);return A.useEffect(()=>{const n=()=>{const r="ontouchstart"in window||navigator.maxTouchPoints>0,s=window.innerHeight>window.innerWidth;e(r&&s)};return n(),window.addEventListener("resize",n),window.addEventListener("orientationchange",n),()=>{window.removeEventListener("resize",n),window.removeEventListener("orientationchange",n)}},[]),t};function F3(){const[t,e]=A.useState("TITLE"),[n,r]=A.useState("SENKA"),[s,i]=A.useState("CPU"),[o,l]=A.useState(""),[c,d]=A.useState(void 0),[u,p]=A.useState("NORMAL"),[f,S]=A.useState(null),[R,C]=A.useState(!0),[j,_]=A.useState(null),[v,w]=A.useState(null),[h,D]=A.useState(!0),[H,re]=A.useState(()=>{const ne=localStorage.getItem("timerEnabled");return ne!==null?JSON.parse(ne):!0}),[W,Z]=A.useState(()=>localStorage.getItem("playerName")||""),[he,xe]=A.useState(void 0),[Ue,de]=A.useState(void 0),ie=$3(),O=A.useRef(null),[T,k]=A.useState(!1),[y,g]=A.useState(j3),[I,P]=A.useState(()=>localStorage.getItem("homeCardId")),N=ne=>ne&&ne.endsWith("@tenfubu-game.local")?ne.replace("@tenfubu-game.local",""):null;A.useEffect(()=>{const ne=P3(async Me=>{if(console.log(" Auth state changed:",{uid:Me==null?void 0:Me.uid,email:Me==null?void 0:Me.email,isAnonymous:Me==null?void 0:Me.isAnonymous}),Me){S(Me.uid),C(Me.isAnonymous),_(Me.email),w(N(Me.email));const Ye=N(Me.email);console.log(" State updated:",{playerId:Me.uid,isAnonymous:Me.isAnonymous,userId:Ye});try{await Sx(Me.uid,Ye||"anonymous",W||"")}catch(E){console.error("Failed to create player data:",E)}}else try{const Ye=await C3();S(Ye.uid),C(!0),_(null),w(null),await Sx(Ye.uid,"anonymous",W||"")}catch(Ye){console.error("Failed to sign in:",Ye)}D(!1)});return()=>ne()},[]),A.useEffect(()=>{localStorage.setItem("audioSettings",JSON.stringify(y))},[y]);const J=A.useCallback(ne=>{g(Me=>({...Me,...ne}))},[]),U=A.useCallback((ne,Me)=>{O.current=ne,k(!0),Me&&d(Me),e("GAME")},[]),ve=A.useCallback((ne,Me,Ye,E,Ut)=>{O.current=ne,k(!0),d(Me),xe(E),de(Ut),e("GAME")},[]),Re=A.useCallback(ne=>{O.current&&(O.current.disconnect(),O.current=null),k(!1),d(void 0),xe(void 0),de(void 0),r(ne),e("MATCHMAKING")},[]),Ie=A.useRef(null),te=A.useRef(!1);A.useEffect(()=>{const ne=new Audio(N3);return ne.loop=!0,ne.volume=y.bgmEnabled?y.bgm:0,Ie.current=ne,te.current=!0,()=>{ne.pause(),ne.src=""}},[]),A.useEffect(()=>{const ne=Ie.current;!ne||!te.current||(ne.volume=y.bgmEnabled?y.bgm:0,y.bgmEnabled?ne.paused&&(t==="TITLE"||t==="CLASS_SELECT")&&ne.play().catch(()=>{}):ne.pause())},[y.bgm,y.bgmEnabled,t]),A.useEffect(()=>{const ne=Ie.current;ne&&(t==="TITLE"||t==="CLASS_SELECT"||t==="LOBBY"?ne.paused&&y.bgmEnabled&&ne.play().catch(()=>{}):(ne.pause(),ne.currentTime=0))},[t,y.bgmEnabled]),A.useEffect(()=>{const ne=()=>{const Me=Ie.current;Me&&Me.paused&&y.bgmEnabled&&(t==="TITLE"||t==="CLASS_SELECT"||t==="LOBBY")&&Me.play().catch(()=>{})};return document.addEventListener("click",ne),()=>document.removeEventListener("click",ne)},[t,y.bgmEnabled]);const K=A.useCallback((ne,Me,Ye,E)=>{i(ne),Me&&l(Me),E&&p(E),Ye?(r(Ye),e(ne==="CPU"?"GAME":ne==="CASUAL_MATCH"||ne==="RANKED_MATCH"?"MATCHMAKING":"LOBBY")):e("CLASS_SELECT")},[]),Oe=A.useCallback(ne=>{r(ne),e(s==="CPU"?"GAME":s==="CASUAL_MATCH"||s==="RANKED_MATCH"?"MATCHMAKING":"LOBBY")},[s]),_e=A.useCallback(()=>{O.current&&(O.current.disconnect(),O.current=null),k(!1),e("TITLE"),l(""),i("CPU"),d(void 0),xe(void 0),de(void 0)},[]),ze=A.useCallback(ne=>{console.log(" App handleSetHomeCard called with cardId:",ne),P(ne),localStorage.setItem("homeCardId",ne),console.log(" localStorage updated:",localStorage.getItem("homeCardId"))},[]),Se=A.useCallback(()=>{e("REGISTER")},[]),De=A.useCallback(()=>{e("LOGIN")},[]),vt=A.useCallback(()=>{e("TITLE")},[]),st=A.useCallback(()=>{e("TITLE")},[]),at=A.useCallback(async()=>{try{await A3(),e("TITLE")}catch(ne){console.error("Failed to logout:",ne)}},[]),et=A.useCallback(()=>{e("TITLE")},[]),$e=A.useCallback(()=>{e("TITLE")},[]),nt=A.useCallback(()=>{e("PROFILE")},[]),mt=A.useCallback(ne=>{Z(ne),localStorage.setItem("playerName",ne),e("TITLE")},[]),Ct=A.useCallback(()=>{e("TITLE")},[]);return h?a.jsx("div",{style:{width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",color:"white",fontSize:"1.5rem",fontWeight:"bold"},children:"Loading..."}):a.jsxs("div",{className:"app-container",style:{userSelect:"none"},children:[ie&&a.jsxs("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100dvh",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:99999,color:"white",textAlign:"center",padding:20},children:[a.jsx("div",{style:{fontSize:"4rem",marginBottom:20,animation:"rotatePhone 2s ease-in-out infinite"},children:""}),a.jsx("h2",{style:{fontSize:"1.5rem",fontWeight:"bold",marginBottom:10,textShadow:"0 2px 4px rgba(0,0,0,0.5)"},children:""}),a.jsx("p",{style:{fontSize:"1rem",opacity:.8,maxWidth:280},children:""}),a.jsx("style",{children:`
                        @keyframes rotatePhone {
                            0%, 100% { transform: rotate(0deg); }
                            25% { transform: rotate(-30deg); }
                            75% { transform: rotate(30deg); }
                        }
                    `})]}),t==="TITLE"&&a.jsx(hL,{onStartConfig:K,audioSettings:y,onAudioSettingsChange:J,playerId:f,onSetHomeCard:ze,homeCardId:I,isAnonymous:R,userId:v,onNavigateToRegister:Se,onNavigateToLogin:De,onNavigateToProfile:nt,onLogout:at}),t==="CLASS_SELECT"&&a.jsx(_L,{onSelectClass:Oe,onBack:_e,gameMode:s,aiDifficulty:u,onDifficultyChange:p,playerName:W,onPlayerNameChange:ne=>{Z(ne),localStorage.setItem("playerName",ne)},timerEnabled:H,onTimerEnabledChange:ne=>{re(ne),localStorage.setItem("timerEnabled",JSON.stringify(ne))},playerId:f}),t==="LOBBY"&&a.jsx(WL,{gameMode:s,targetRoomId:o,playerClass:n,onGameStart:U,onBack:_e}),t==="MATCHMAKING"&&a.jsx(KL,{matchType:s==="CASUAL_MATCH"?"casual":"ranked",playerClass:n,playerName:W||"",playerId:f,onGameStart:ve,onCancel:_e}),t==="GAME"&&a.jsx(T3,{playerClass:n,opponentType:s==="CPU"?"CPU":"ONLINE",gameMode:s,targetRoomId:o,onLeave:_e,onRematching:Re,networkAdapter:O.current,networkConnected:T,opponentClass:c,aiDifficulty:u,playerName:W||"",timerEnabled:s==="CASUAL_MATCH"||s==="RANKED_MATCH"?!0:H,playerId:f,opponentPlayerId:he,opponentRating:Ue}),t==="REGISTER"&&a.jsx(O3,{onRegisterSuccess:vt,onBack:et}),t==="LOGIN"&&a.jsx(L3,{onLoginSuccess:st,onBack:$e}),t==="PROFILE"&&a.jsx(D3,{playerId:f,currentPlayerName:W,onUpdateSuccess:mt,onBack:Ct})]})}$h.createRoot(document.getElementById("root")).render(a.jsx(F3,{}));
