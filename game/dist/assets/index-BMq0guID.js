var G2=Object.defineProperty;var V2=t=>{throw TypeError(t)};var Y2=(t,e,n)=>e in t?G2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var _n=(t,e,n)=>Y2(t,typeof e!="symbol"?e+"":e,n);var za=(t,e,n)=>e.has(t)?V2("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n);function K2(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in t)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function s1(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var i1={exports:{}},Wu={},o1={exports:{}},mt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cc=Symbol.for("react.element"),X2=Symbol.for("react.portal"),J2=Symbol.for("react.fragment"),Q2=Symbol.for("react.strict_mode"),q2=Symbol.for("react.profiler"),Z2=Symbol.for("react.provider"),ew=Symbol.for("react.context"),tw=Symbol.for("react.forward_ref"),nw=Symbol.for("react.suspense"),rw=Symbol.for("react.memo"),sw=Symbol.for("react.lazy"),oy=Symbol.iterator;function iw(t){return t===null||typeof t!="object"?null:(t=oy&&t[oy]||t["@@iterator"],typeof t=="function"?t:null)}var a1={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},l1=Object.assign,c1={};function ma(t,e,n){this.props=t,this.context=e,this.refs=c1,this.updater=n||a1}ma.prototype.isReactComponent={};ma.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};ma.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function d1(){}d1.prototype=ma.prototype;function Eg(t,e,n){this.props=t,this.context=e,this.refs=c1,this.updater=n||a1}var Sg=Eg.prototype=new d1;Sg.constructor=Eg;l1(Sg,ma.prototype);Sg.isPureReactComponent=!0;var ay=Array.isArray,u1=Object.prototype.hasOwnProperty,wg={current:null},f1={key:!0,ref:!0,__self:!0,__source:!0};function h1(t,e,n){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)u1.call(e,r)&&!f1.hasOwnProperty(r)&&(s[r]=e[r]);var l=arguments.length-2;if(l===1)s.children=n;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];s.children=c}if(t&&t.defaultProps)for(r in l=t.defaultProps,l)s[r]===void 0&&(s[r]=l[r]);return{$$typeof:cc,type:t,key:i,ref:o,props:s,_owner:wg.current}}function ow(t,e){return{$$typeof:cc,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Ig(t){return typeof t=="object"&&t!==null&&t.$$typeof===cc}function aw(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var ly=/\/+/g;function sh(t,e){return typeof t=="object"&&t!==null&&t.key!=null?aw(""+t.key):e.toString(36)}function Sd(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case cc:case X2:o=!0}}if(o)return o=t,s=s(o),t=r===""?"."+sh(o,0):r,ay(s)?(n="",t!=null&&(n=t.replace(ly,"$&/")+"/"),Sd(s,e,n,"",function(d){return d})):s!=null&&(Ig(s)&&(s=ow(s,n+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(ly,"$&/")+"/")+t)),e.push(s)),1;if(o=0,r=r===""?".":r+":",ay(t))for(var l=0;l<t.length;l++){i=t[l];var c=r+sh(i,l);o+=Sd(i,e,n,c,s)}else if(c=iw(t),typeof c=="function")for(t=c.call(t),l=0;!(i=t.next()).done;)i=i.value,c=r+sh(i,l++),o+=Sd(i,e,n,c,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Qc(t,e,n){if(t==null)return t;var r=[],s=0;return Sd(t,r,"","",function(i){return e.call(n,i,s++)}),r}function lw(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Hn={current:null},wd={transition:null},cw={ReactCurrentDispatcher:Hn,ReactCurrentBatchConfig:wd,ReactCurrentOwner:wg};function p1(){throw Error("act(...) is not supported in production builds of React.")}mt.Children={map:Qc,forEach:function(t,e,n){Qc(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Qc(t,function(){e++}),e},toArray:function(t){return Qc(t,function(e){return e})||[]},only:function(t){if(!Ig(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};mt.Component=ma;mt.Fragment=J2;mt.Profiler=q2;mt.PureComponent=Eg;mt.StrictMode=Q2;mt.Suspense=nw;mt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=cw;mt.act=p1;mt.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=l1({},t.props),s=t.key,i=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=wg.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(c in e)u1.call(e,c)&&!f1.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&l!==void 0?l[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];r.children=l}return{$$typeof:cc,type:t.type,key:s,ref:i,props:r,_owner:o}};mt.createContext=function(t){return t={$$typeof:ew,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:Z2,_context:t},t.Consumer=t};mt.createElement=h1;mt.createFactory=function(t){var e=h1.bind(null,t);return e.type=t,e};mt.createRef=function(){return{current:null}};mt.forwardRef=function(t){return{$$typeof:tw,render:t}};mt.isValidElement=Ig;mt.lazy=function(t){return{$$typeof:sw,_payload:{_status:-1,_result:t},_init:lw}};mt.memo=function(t,e){return{$$typeof:rw,type:t,compare:e===void 0?null:e}};mt.startTransition=function(t){var e=wd.transition;wd.transition={};try{t()}finally{wd.transition=e}};mt.unstable_act=p1;mt.useCallback=function(t,e){return Hn.current.useCallback(t,e)};mt.useContext=function(t){return Hn.current.useContext(t)};mt.useDebugValue=function(){};mt.useDeferredValue=function(t){return Hn.current.useDeferredValue(t)};mt.useEffect=function(t,e){return Hn.current.useEffect(t,e)};mt.useId=function(){return Hn.current.useId()};mt.useImperativeHandle=function(t,e,n){return Hn.current.useImperativeHandle(t,e,n)};mt.useInsertionEffect=function(t,e){return Hn.current.useInsertionEffect(t,e)};mt.useLayoutEffect=function(t,e){return Hn.current.useLayoutEffect(t,e)};mt.useMemo=function(t,e){return Hn.current.useMemo(t,e)};mt.useReducer=function(t,e,n){return Hn.current.useReducer(t,e,n)};mt.useRef=function(t){return Hn.current.useRef(t)};mt.useState=function(t){return Hn.current.useState(t)};mt.useSyncExternalStore=function(t,e,n){return Hn.current.useSyncExternalStore(t,e,n)};mt.useTransition=function(){return Hn.current.useTransition()};mt.version="18.3.1";o1.exports=mt;var P=o1.exports;const j=s1(P);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dw=P,uw=Symbol.for("react.element"),fw=Symbol.for("react.fragment"),hw=Object.prototype.hasOwnProperty,pw=dw.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,gw={key:!0,ref:!0,__self:!0,__source:!0};function g1(t,e,n){var r,s={},i=null,o=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)hw.call(e,r)&&!gw.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:uw,type:t,key:i,ref:o,props:s,_owner:pw.current}}Wu.Fragment=fw;Wu.jsx=g1;Wu.jsxs=g1;i1.exports=Wu;var a=i1.exports,Kh={},m1={exports:{}},ur={},y1={exports:{}},v1={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(x,I){var y=x.length;x.push(I);e:for(;0<y;){var O=y-1>>>1,N=x[O];if(0<s(N,I))x[O]=I,x[y]=N,y=O;else break e}}function n(x){return x.length===0?null:x[0]}function r(x){if(x.length===0)return null;var I=x[0],y=x.pop();if(y!==I){x[0]=y;e:for(var O=0,N=x.length,ne=N>>>1;O<ne;){var B=2*(O+1)-1,ye=x[B],te=B+1,xe=x[te];if(0>s(ye,y))te<N&&0>s(xe,ye)?(x[O]=xe,x[te]=y,O=te):(x[O]=ye,x[B]=y,O=B);else if(te<N&&0>s(xe,y))x[O]=xe,x[te]=y,O=te;else break e}}return I}function s(x,I){var y=x.sortIndex-I.sortIndex;return y!==0?y:x.id-I.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],d=[],u=1,h=null,f=3,b=!1,C=!1,k=!1,A=typeof setTimeout=="function"?setTimeout:null,R=typeof clearTimeout=="function"?clearTimeout:null,m=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function T(x){for(var I=n(d);I!==null;){if(I.callback===null)r(d);else if(I.startTime<=x)r(d),I.sortIndex=I.expirationTime,e(c,I);else break;I=n(d)}}function L(x){if(k=!1,T(x),!C)if(n(c)!==null)C=!0,v(g);else{var I=n(d);I!==null&&_(L,I.startTime-x)}}function g(x,I){C=!1,k&&(k=!1,R(W),W=-1),b=!0;var y=f;try{for(T(I),h=n(c);h!==null&&(!(h.expirationTime>I)||x&&!fe());){var O=h.callback;if(typeof O=="function"){h.callback=null,f=h.priorityLevel;var N=O(h.expirationTime<=I);I=t.unstable_now(),typeof N=="function"?h.callback=N:h===n(c)&&r(c),T(I)}else r(c);h=n(c)}if(h!==null)var ne=!0;else{var B=n(d);B!==null&&_(L,B.startTime-I),ne=!1}return ne}finally{h=null,f=y,b=!1}}var H=!1,Q=null,W=-1,G=5,de=-1;function fe(){return!(t.unstable_now()-de<G)}function Ee(){if(Q!==null){var x=t.unstable_now();de=x;var I=!0;try{I=Q(!0,x)}finally{I?ae():(H=!1,Q=null)}}else H=!1}var ae;if(typeof m=="function")ae=function(){m(Ee)};else if(typeof MessageChannel<"u"){var he=new MessageChannel,be=he.port2;he.port1.onmessage=Ee,ae=function(){be.postMessage(null)}}else ae=function(){A(Ee,0)};function v(x){Q=x,H||(H=!0,ae())}function _(x,I){W=A(function(){x(t.unstable_now())},I)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(x){x.callback=null},t.unstable_continueExecution=function(){C||b||(C=!0,v(g))},t.unstable_forceFrameRate=function(x){0>x||125<x?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):G=0<x?Math.floor(1e3/x):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(x){switch(f){case 1:case 2:case 3:var I=3;break;default:I=f}var y=f;f=I;try{return x()}finally{f=y}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(x,I){switch(x){case 1:case 2:case 3:case 4:case 5:break;default:x=3}var y=f;f=x;try{return I()}finally{f=y}},t.unstable_scheduleCallback=function(x,I,y){var O=t.unstable_now();switch(typeof y=="object"&&y!==null?(y=y.delay,y=typeof y=="number"&&0<y?O+y:O):y=O,x){case 1:var N=-1;break;case 2:N=250;break;case 5:N=1073741823;break;case 4:N=1e4;break;default:N=5e3}return N=y+N,x={id:u++,callback:I,priorityLevel:x,startTime:y,expirationTime:N,sortIndex:-1},y>O?(x.sortIndex=y,e(d,x),n(c)===null&&x===n(d)&&(k?(R(W),W=-1):k=!0,_(L,y-O))):(x.sortIndex=N,e(c,x),C||b||(C=!0,v(g))),x},t.unstable_shouldYield=fe,t.unstable_wrapCallback=function(x){var I=f;return function(){var y=f;f=I;try{return x.apply(this,arguments)}finally{f=y}}}})(v1);y1.exports=v1;var mw=y1.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yw=P,cr=mw;function ue(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var x1=new Set,Pl={};function qi(t,e){ta(t,e),ta(t+"Capture",e)}function ta(t,e){for(Pl[t]=e,t=0;t<e.length;t++)x1.add(e[t])}var gs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Xh=Object.prototype.hasOwnProperty,vw=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,cy={},dy={};function xw(t){return Xh.call(dy,t)?!0:Xh.call(cy,t)?!1:vw.test(t)?dy[t]=!0:(cy[t]=!0,!1)}function _w(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function bw(t,e,n,r){if(e===null||typeof e>"u"||_w(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Wn(t,e,n,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var Tn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Tn[t]=new Wn(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Tn[e]=new Wn(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Tn[t]=new Wn(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Tn[t]=new Wn(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Tn[t]=new Wn(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Tn[t]=new Wn(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Tn[t]=new Wn(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Tn[t]=new Wn(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Tn[t]=new Wn(t,5,!1,t.toLowerCase(),null,!1,!1)});var Tg=/[\-:]([a-z])/g;function Cg(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Tg,Cg);Tn[e]=new Wn(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Tg,Cg);Tn[e]=new Wn(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Tg,Cg);Tn[e]=new Wn(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Tn[t]=new Wn(t,1,!1,t.toLowerCase(),null,!1,!1)});Tn.xlinkHref=new Wn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Tn[t]=new Wn(t,1,!1,t.toLowerCase(),null,!0,!0)});function kg(t,e,n,r){var s=Tn.hasOwnProperty(e)?Tn[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(bw(e,n,s,r)&&(n=null),r||s===null?xw(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var Es=yw.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,qc=Symbol.for("react.element"),Ro=Symbol.for("react.portal"),Ao=Symbol.for("react.fragment"),Rg=Symbol.for("react.strict_mode"),Jh=Symbol.for("react.profiler"),_1=Symbol.for("react.provider"),b1=Symbol.for("react.context"),Ag=Symbol.for("react.forward_ref"),Qh=Symbol.for("react.suspense"),qh=Symbol.for("react.suspense_list"),Pg=Symbol.for("react.memo"),Ns=Symbol.for("react.lazy"),E1=Symbol.for("react.offscreen"),uy=Symbol.iterator;function Ha(t){return t===null||typeof t!="object"?null:(t=uy&&t[uy]||t["@@iterator"],typeof t=="function"?t:null)}var qt=Object.assign,ih;function sl(t){if(ih===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);ih=e&&e[1]||""}return`
`+ih+t}var oh=!1;function ah(t,e){if(!t||oh)return"";oh=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var r=d}Reflect.construct(t,[],e)}else{try{e.call()}catch(d){r=d}t.call(e.prototype)}else{try{throw Error()}catch(d){r=d}t()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var s=d.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,l=i.length-1;1<=o&&0<=l&&s[o]!==i[l];)l--;for(;1<=o&&0<=l;o--,l--)if(s[o]!==i[l]){if(o!==1||l!==1)do if(o--,l--,0>l||s[o]!==i[l]){var c=`
`+s[o].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=o&&0<=l);break}}}finally{oh=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?sl(t):""}function Ew(t){switch(t.tag){case 5:return sl(t.type);case 16:return sl("Lazy");case 13:return sl("Suspense");case 19:return sl("SuspenseList");case 0:case 2:case 15:return t=ah(t.type,!1),t;case 11:return t=ah(t.type.render,!1),t;case 1:return t=ah(t.type,!0),t;default:return""}}function Zh(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Ao:return"Fragment";case Ro:return"Portal";case Jh:return"Profiler";case Rg:return"StrictMode";case Qh:return"Suspense";case qh:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case b1:return(t.displayName||"Context")+".Consumer";case _1:return(t._context.displayName||"Context")+".Provider";case Ag:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Pg:return e=t.displayName||null,e!==null?e:Zh(t.type)||"Memo";case Ns:e=t._payload,t=t._init;try{return Zh(t(e))}catch{}}return null}function Sw(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Zh(e);case 8:return e===Rg?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function di(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function S1(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function ww(t){var e=S1(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Zc(t){t._valueTracker||(t._valueTracker=ww(t))}function w1(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=S1(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Kd(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function ep(t,e){var n=e.checked;return qt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function fy(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=di(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function I1(t,e){e=e.checked,e!=null&&kg(t,"checked",e,!1)}function tp(t,e){I1(t,e);var n=di(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?np(t,e.type,n):e.hasOwnProperty("defaultValue")&&np(t,e.type,di(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function hy(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function np(t,e,n){(e!=="number"||Kd(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var il=Array.isArray;function Ho(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+di(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function rp(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ue(91));return qt({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function py(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(ue(92));if(il(n)){if(1<n.length)throw Error(ue(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:di(n)}}function T1(t,e){var n=di(e.value),r=di(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function gy(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function C1(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function sp(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?C1(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var ed,k1=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(ed=ed||document.createElement("div"),ed.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ed.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Ol(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var ul={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Iw=["Webkit","ms","Moz","O"];Object.keys(ul).forEach(function(t){Iw.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),ul[e]=ul[t]})});function R1(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||ul.hasOwnProperty(t)&&ul[t]?(""+e).trim():e+"px"}function A1(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=R1(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var Tw=qt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ip(t,e){if(e){if(Tw[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ue(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ue(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ue(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ue(62))}}function op(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ap=null;function Og(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var lp=null,Wo=null,Go=null;function my(t){if(t=fc(t)){if(typeof lp!="function")throw Error(ue(280));var e=t.stateNode;e&&(e=Xu(e),lp(t.stateNode,t.type,e))}}function P1(t){Wo?Go?Go.push(t):Go=[t]:Wo=t}function O1(){if(Wo){var t=Wo,e=Go;if(Go=Wo=null,my(t),e)for(t=0;t<e.length;t++)my(e[t])}}function L1(t,e){return t(e)}function M1(){}var lh=!1;function D1(t,e,n){if(lh)return t(e,n);lh=!0;try{return L1(t,e,n)}finally{lh=!1,(Wo!==null||Go!==null)&&(M1(),O1())}}function Ll(t,e){var n=t.stateNode;if(n===null)return null;var r=Xu(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(ue(231,e,typeof n));return n}var cp=!1;if(gs)try{var Wa={};Object.defineProperty(Wa,"passive",{get:function(){cp=!0}}),window.addEventListener("test",Wa,Wa),window.removeEventListener("test",Wa,Wa)}catch{cp=!1}function Cw(t,e,n,r,s,i,o,l,c){var d=Array.prototype.slice.call(arguments,3);try{e.apply(n,d)}catch(u){this.onError(u)}}var fl=!1,Xd=null,Jd=!1,dp=null,kw={onError:function(t){fl=!0,Xd=t}};function Rw(t,e,n,r,s,i,o,l,c){fl=!1,Xd=null,Cw.apply(kw,arguments)}function Aw(t,e,n,r,s,i,o,l,c){if(Rw.apply(this,arguments),fl){if(fl){var d=Xd;fl=!1,Xd=null}else throw Error(ue(198));Jd||(Jd=!0,dp=d)}}function Zi(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function N1(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function yy(t){if(Zi(t)!==t)throw Error(ue(188))}function Pw(t){var e=t.alternate;if(!e){if(e=Zi(t),e===null)throw Error(ue(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return yy(s),t;if(i===r)return yy(s),e;i=i.sibling}throw Error(ue(188))}if(n.return!==r.return)n=s,r=i;else{for(var o=!1,l=s.child;l;){if(l===n){o=!0,n=s,r=i;break}if(l===r){o=!0,r=s,n=i;break}l=l.sibling}if(!o){for(l=i.child;l;){if(l===n){o=!0,n=i,r=s;break}if(l===r){o=!0,r=i,n=s;break}l=l.sibling}if(!o)throw Error(ue(189))}}if(n.alternate!==r)throw Error(ue(190))}if(n.tag!==3)throw Error(ue(188));return n.stateNode.current===n?t:e}function $1(t){return t=Pw(t),t!==null?j1(t):null}function j1(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=j1(t);if(e!==null)return e;t=t.sibling}return null}var F1=cr.unstable_scheduleCallback,vy=cr.unstable_cancelCallback,Ow=cr.unstable_shouldYield,Lw=cr.unstable_requestPaint,tn=cr.unstable_now,Mw=cr.unstable_getCurrentPriorityLevel,Lg=cr.unstable_ImmediatePriority,U1=cr.unstable_UserBlockingPriority,Qd=cr.unstable_NormalPriority,Dw=cr.unstable_LowPriority,B1=cr.unstable_IdlePriority,Gu=null,Xr=null;function Nw(t){if(Xr&&typeof Xr.onCommitFiberRoot=="function")try{Xr.onCommitFiberRoot(Gu,t,void 0,(t.current.flags&128)===128)}catch{}}var jr=Math.clz32?Math.clz32:Fw,$w=Math.log,jw=Math.LN2;function Fw(t){return t>>>=0,t===0?32:31-($w(t)/jw|0)|0}var td=64,nd=4194304;function ol(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function qd(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,o=n&268435455;if(o!==0){var l=o&~s;l!==0?r=ol(l):(i&=o,i!==0&&(r=ol(i)))}else o=n&~s,o!==0?r=ol(o):i!==0&&(r=ol(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-jr(e),s=1<<n,r|=t[n],e&=~s;return r}function Uw(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Bw(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var o=31-jr(i),l=1<<o,c=s[o];c===-1?(!(l&n)||l&r)&&(s[o]=Uw(l,e)):c<=e&&(t.expiredLanes|=l),i&=~l}}function up(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function z1(){var t=td;return td<<=1,!(td&4194240)&&(td=64),t}function ch(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function dc(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-jr(e),t[e]=n}function zw(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-jr(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function Mg(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-jr(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var Rt=0;function H1(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var W1,Dg,G1,V1,Y1,fp=!1,rd=[],Js=null,Qs=null,qs=null,Ml=new Map,Dl=new Map,js=[],Hw="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function xy(t,e){switch(t){case"focusin":case"focusout":Js=null;break;case"dragenter":case"dragleave":Qs=null;break;case"mouseover":case"mouseout":qs=null;break;case"pointerover":case"pointerout":Ml.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Dl.delete(e.pointerId)}}function Ga(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=fc(e),e!==null&&Dg(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function Ww(t,e,n,r,s){switch(e){case"focusin":return Js=Ga(Js,t,e,n,r,s),!0;case"dragenter":return Qs=Ga(Qs,t,e,n,r,s),!0;case"mouseover":return qs=Ga(qs,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return Ml.set(i,Ga(Ml.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,Dl.set(i,Ga(Dl.get(i)||null,t,e,n,r,s)),!0}return!1}function K1(t){var e=Mi(t.target);if(e!==null){var n=Zi(e);if(n!==null){if(e=n.tag,e===13){if(e=N1(n),e!==null){t.blockedOn=e,Y1(t.priority,function(){G1(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Id(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=hp(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);ap=r,n.target.dispatchEvent(r),ap=null}else return e=fc(n),e!==null&&Dg(e),t.blockedOn=n,!1;e.shift()}return!0}function _y(t,e,n){Id(t)&&n.delete(e)}function Gw(){fp=!1,Js!==null&&Id(Js)&&(Js=null),Qs!==null&&Id(Qs)&&(Qs=null),qs!==null&&Id(qs)&&(qs=null),Ml.forEach(_y),Dl.forEach(_y)}function Va(t,e){t.blockedOn===e&&(t.blockedOn=null,fp||(fp=!0,cr.unstable_scheduleCallback(cr.unstable_NormalPriority,Gw)))}function Nl(t){function e(s){return Va(s,t)}if(0<rd.length){Va(rd[0],t);for(var n=1;n<rd.length;n++){var r=rd[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Js!==null&&Va(Js,t),Qs!==null&&Va(Qs,t),qs!==null&&Va(qs,t),Ml.forEach(e),Dl.forEach(e),n=0;n<js.length;n++)r=js[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<js.length&&(n=js[0],n.blockedOn===null);)K1(n),n.blockedOn===null&&js.shift()}var Vo=Es.ReactCurrentBatchConfig,Zd=!0;function Vw(t,e,n,r){var s=Rt,i=Vo.transition;Vo.transition=null;try{Rt=1,Ng(t,e,n,r)}finally{Rt=s,Vo.transition=i}}function Yw(t,e,n,r){var s=Rt,i=Vo.transition;Vo.transition=null;try{Rt=4,Ng(t,e,n,r)}finally{Rt=s,Vo.transition=i}}function Ng(t,e,n,r){if(Zd){var s=hp(t,e,n,r);if(s===null)xh(t,e,r,eu,n),xy(t,r);else if(Ww(s,t,e,n,r))r.stopPropagation();else if(xy(t,r),e&4&&-1<Hw.indexOf(t)){for(;s!==null;){var i=fc(s);if(i!==null&&W1(i),i=hp(t,e,n,r),i===null&&xh(t,e,r,eu,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else xh(t,e,r,null,n)}}var eu=null;function hp(t,e,n,r){if(eu=null,t=Og(r),t=Mi(t),t!==null)if(e=Zi(t),e===null)t=null;else if(n=e.tag,n===13){if(t=N1(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return eu=t,null}function X1(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Mw()){case Lg:return 1;case U1:return 4;case Qd:case Dw:return 16;case B1:return 536870912;default:return 16}default:return 16}}var Gs=null,$g=null,Td=null;function J1(){if(Td)return Td;var t,e=$g,n=e.length,r,s="value"in Gs?Gs.value:Gs.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===s[i-r];r++);return Td=s.slice(t,1<r?1-r:void 0)}function Cd(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function sd(){return!0}function by(){return!1}function fr(t){function e(n,r,s,i,o){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(i):i[l]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?sd:by,this.isPropagationStopped=by,this}return qt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=sd)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=sd)},persist:function(){},isPersistent:sd}),e}var ya={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},jg=fr(ya),uc=qt({},ya,{view:0,detail:0}),Kw=fr(uc),dh,uh,Ya,Vu=qt({},uc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Fg,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Ya&&(Ya&&t.type==="mousemove"?(dh=t.screenX-Ya.screenX,uh=t.screenY-Ya.screenY):uh=dh=0,Ya=t),dh)},movementY:function(t){return"movementY"in t?t.movementY:uh}}),Ey=fr(Vu),Xw=qt({},Vu,{dataTransfer:0}),Jw=fr(Xw),Qw=qt({},uc,{relatedTarget:0}),fh=fr(Qw),qw=qt({},ya,{animationName:0,elapsedTime:0,pseudoElement:0}),Zw=fr(qw),eI=qt({},ya,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),tI=fr(eI),nI=qt({},ya,{data:0}),Sy=fr(nI),rI={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},sI={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},iI={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function oI(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=iI[t])?!!e[t]:!1}function Fg(){return oI}var aI=qt({},uc,{key:function(t){if(t.key){var e=rI[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Cd(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?sI[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Fg,charCode:function(t){return t.type==="keypress"?Cd(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Cd(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),lI=fr(aI),cI=qt({},Vu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),wy=fr(cI),dI=qt({},uc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Fg}),uI=fr(dI),fI=qt({},ya,{propertyName:0,elapsedTime:0,pseudoElement:0}),hI=fr(fI),pI=qt({},Vu,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),gI=fr(pI),mI=[9,13,27,32],Ug=gs&&"CompositionEvent"in window,hl=null;gs&&"documentMode"in document&&(hl=document.documentMode);var yI=gs&&"TextEvent"in window&&!hl,Q1=gs&&(!Ug||hl&&8<hl&&11>=hl),Iy=" ",Ty=!1;function q1(t,e){switch(t){case"keyup":return mI.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Z1(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Po=!1;function vI(t,e){switch(t){case"compositionend":return Z1(e);case"keypress":return e.which!==32?null:(Ty=!0,Iy);case"textInput":return t=e.data,t===Iy&&Ty?null:t;default:return null}}function xI(t,e){if(Po)return t==="compositionend"||!Ug&&q1(t,e)?(t=J1(),Td=$g=Gs=null,Po=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Q1&&e.locale!=="ko"?null:e.data;default:return null}}var _I={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Cy(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!_I[t.type]:e==="textarea"}function e_(t,e,n,r){P1(r),e=tu(e,"onChange"),0<e.length&&(n=new jg("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var pl=null,$l=null;function bI(t){u_(t,0)}function Yu(t){var e=Mo(t);if(w1(e))return t}function EI(t,e){if(t==="change")return e}var t_=!1;if(gs){var hh;if(gs){var ph="oninput"in document;if(!ph){var ky=document.createElement("div");ky.setAttribute("oninput","return;"),ph=typeof ky.oninput=="function"}hh=ph}else hh=!1;t_=hh&&(!document.documentMode||9<document.documentMode)}function Ry(){pl&&(pl.detachEvent("onpropertychange",n_),$l=pl=null)}function n_(t){if(t.propertyName==="value"&&Yu($l)){var e=[];e_(e,$l,t,Og(t)),D1(bI,e)}}function SI(t,e,n){t==="focusin"?(Ry(),pl=e,$l=n,pl.attachEvent("onpropertychange",n_)):t==="focusout"&&Ry()}function wI(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Yu($l)}function II(t,e){if(t==="click")return Yu(e)}function TI(t,e){if(t==="input"||t==="change")return Yu(e)}function CI(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Br=typeof Object.is=="function"?Object.is:CI;function jl(t,e){if(Br(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!Xh.call(e,s)||!Br(t[s],e[s]))return!1}return!0}function Ay(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Py(t,e){var n=Ay(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Ay(n)}}function r_(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?r_(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function s_(){for(var t=window,e=Kd();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Kd(t.document)}return e}function Bg(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function kI(t){var e=s_(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&r_(n.ownerDocument.documentElement,n)){if(r!==null&&Bg(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=Py(n,i);var o=Py(n,r);s&&o&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var RI=gs&&"documentMode"in document&&11>=document.documentMode,Oo=null,pp=null,gl=null,gp=!1;function Oy(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;gp||Oo==null||Oo!==Kd(r)||(r=Oo,"selectionStart"in r&&Bg(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),gl&&jl(gl,r)||(gl=r,r=tu(pp,"onSelect"),0<r.length&&(e=new jg("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=Oo)))}function id(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Lo={animationend:id("Animation","AnimationEnd"),animationiteration:id("Animation","AnimationIteration"),animationstart:id("Animation","AnimationStart"),transitionend:id("Transition","TransitionEnd")},gh={},i_={};gs&&(i_=document.createElement("div").style,"AnimationEvent"in window||(delete Lo.animationend.animation,delete Lo.animationiteration.animation,delete Lo.animationstart.animation),"TransitionEvent"in window||delete Lo.transitionend.transition);function Ku(t){if(gh[t])return gh[t];if(!Lo[t])return t;var e=Lo[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in i_)return gh[t]=e[n];return t}var o_=Ku("animationend"),a_=Ku("animationiteration"),l_=Ku("animationstart"),c_=Ku("transitionend"),d_=new Map,Ly="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function yi(t,e){d_.set(t,e),qi(e,[t])}for(var mh=0;mh<Ly.length;mh++){var yh=Ly[mh],AI=yh.toLowerCase(),PI=yh[0].toUpperCase()+yh.slice(1);yi(AI,"on"+PI)}yi(o_,"onAnimationEnd");yi(a_,"onAnimationIteration");yi(l_,"onAnimationStart");yi("dblclick","onDoubleClick");yi("focusin","onFocus");yi("focusout","onBlur");yi(c_,"onTransitionEnd");ta("onMouseEnter",["mouseout","mouseover"]);ta("onMouseLeave",["mouseout","mouseover"]);ta("onPointerEnter",["pointerout","pointerover"]);ta("onPointerLeave",["pointerout","pointerover"]);qi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));qi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));qi("onBeforeInput",["compositionend","keypress","textInput","paste"]);qi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));qi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));qi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var al="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),OI=new Set("cancel close invalid load scroll toggle".split(" ").concat(al));function My(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,Aw(r,e,void 0,t),t.currentTarget=null}function u_(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var l=r[o],c=l.instance,d=l.currentTarget;if(l=l.listener,c!==i&&s.isPropagationStopped())break e;My(s,l,d),i=c}else for(o=0;o<r.length;o++){if(l=r[o],c=l.instance,d=l.currentTarget,l=l.listener,c!==i&&s.isPropagationStopped())break e;My(s,l,d),i=c}}}if(Jd)throw t=dp,Jd=!1,dp=null,t}function zt(t,e){var n=e[_p];n===void 0&&(n=e[_p]=new Set);var r=t+"__bubble";n.has(r)||(f_(e,t,2,!1),n.add(r))}function vh(t,e,n){var r=0;e&&(r|=4),f_(n,t,r,e)}var od="_reactListening"+Math.random().toString(36).slice(2);function Fl(t){if(!t[od]){t[od]=!0,x1.forEach(function(n){n!=="selectionchange"&&(OI.has(n)||vh(n,!1,t),vh(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[od]||(e[od]=!0,vh("selectionchange",!1,e))}}function f_(t,e,n,r){switch(X1(e)){case 1:var s=Vw;break;case 4:s=Yw;break;default:s=Ng}n=s.bind(null,e,n,t),s=void 0,!cp||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function xh(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var l=r.stateNode.containerInfo;if(l===s||l.nodeType===8&&l.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===s||c.nodeType===8&&c.parentNode===s))return;o=o.return}for(;l!==null;){if(o=Mi(l),o===null)return;if(c=o.tag,c===5||c===6){r=i=o;continue e}l=l.parentNode}}r=r.return}D1(function(){var d=i,u=Og(n),h=[];e:{var f=d_.get(t);if(f!==void 0){var b=jg,C=t;switch(t){case"keypress":if(Cd(n)===0)break e;case"keydown":case"keyup":b=lI;break;case"focusin":C="focus",b=fh;break;case"focusout":C="blur",b=fh;break;case"beforeblur":case"afterblur":b=fh;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":b=Ey;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":b=Jw;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":b=uI;break;case o_:case a_:case l_:b=Zw;break;case c_:b=hI;break;case"scroll":b=Kw;break;case"wheel":b=gI;break;case"copy":case"cut":case"paste":b=tI;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":b=wy}var k=(e&4)!==0,A=!k&&t==="scroll",R=k?f!==null?f+"Capture":null:f;k=[];for(var m=d,T;m!==null;){T=m;var L=T.stateNode;if(T.tag===5&&L!==null&&(T=L,R!==null&&(L=Ll(m,R),L!=null&&k.push(Ul(m,L,T)))),A)break;m=m.return}0<k.length&&(f=new b(f,C,null,n,u),h.push({event:f,listeners:k}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",b=t==="mouseout"||t==="pointerout",f&&n!==ap&&(C=n.relatedTarget||n.fromElement)&&(Mi(C)||C[ms]))break e;if((b||f)&&(f=u.window===u?u:(f=u.ownerDocument)?f.defaultView||f.parentWindow:window,b?(C=n.relatedTarget||n.toElement,b=d,C=C?Mi(C):null,C!==null&&(A=Zi(C),C!==A||C.tag!==5&&C.tag!==6)&&(C=null)):(b=null,C=d),b!==C)){if(k=Ey,L="onMouseLeave",R="onMouseEnter",m="mouse",(t==="pointerout"||t==="pointerover")&&(k=wy,L="onPointerLeave",R="onPointerEnter",m="pointer"),A=b==null?f:Mo(b),T=C==null?f:Mo(C),f=new k(L,m+"leave",b,n,u),f.target=A,f.relatedTarget=T,L=null,Mi(u)===d&&(k=new k(R,m+"enter",C,n,u),k.target=T,k.relatedTarget=A,L=k),A=L,b&&C)t:{for(k=b,R=C,m=0,T=k;T;T=So(T))m++;for(T=0,L=R;L;L=So(L))T++;for(;0<m-T;)k=So(k),m--;for(;0<T-m;)R=So(R),T--;for(;m--;){if(k===R||R!==null&&k===R.alternate)break t;k=So(k),R=So(R)}k=null}else k=null;b!==null&&Dy(h,f,b,k,!1),C!==null&&A!==null&&Dy(h,A,C,k,!0)}}e:{if(f=d?Mo(d):window,b=f.nodeName&&f.nodeName.toLowerCase(),b==="select"||b==="input"&&f.type==="file")var g=EI;else if(Cy(f))if(t_)g=TI;else{g=wI;var H=SI}else(b=f.nodeName)&&b.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(g=II);if(g&&(g=g(t,d))){e_(h,g,n,u);break e}H&&H(t,f,d),t==="focusout"&&(H=f._wrapperState)&&H.controlled&&f.type==="number"&&np(f,"number",f.value)}switch(H=d?Mo(d):window,t){case"focusin":(Cy(H)||H.contentEditable==="true")&&(Oo=H,pp=d,gl=null);break;case"focusout":gl=pp=Oo=null;break;case"mousedown":gp=!0;break;case"contextmenu":case"mouseup":case"dragend":gp=!1,Oy(h,n,u);break;case"selectionchange":if(RI)break;case"keydown":case"keyup":Oy(h,n,u)}var Q;if(Ug)e:{switch(t){case"compositionstart":var W="onCompositionStart";break e;case"compositionend":W="onCompositionEnd";break e;case"compositionupdate":W="onCompositionUpdate";break e}W=void 0}else Po?q1(t,n)&&(W="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(W="onCompositionStart");W&&(Q1&&n.locale!=="ko"&&(Po||W!=="onCompositionStart"?W==="onCompositionEnd"&&Po&&(Q=J1()):(Gs=u,$g="value"in Gs?Gs.value:Gs.textContent,Po=!0)),H=tu(d,W),0<H.length&&(W=new Sy(W,t,null,n,u),h.push({event:W,listeners:H}),Q?W.data=Q:(Q=Z1(n),Q!==null&&(W.data=Q)))),(Q=yI?vI(t,n):xI(t,n))&&(d=tu(d,"onBeforeInput"),0<d.length&&(u=new Sy("onBeforeInput","beforeinput",null,n,u),h.push({event:u,listeners:d}),u.data=Q))}u_(h,e)})}function Ul(t,e,n){return{instance:t,listener:e,currentTarget:n}}function tu(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=Ll(t,n),i!=null&&r.unshift(Ul(t,i,s)),i=Ll(t,e),i!=null&&r.push(Ul(t,i,s))),t=t.return}return r}function So(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Dy(t,e,n,r,s){for(var i=e._reactName,o=[];n!==null&&n!==r;){var l=n,c=l.alternate,d=l.stateNode;if(c!==null&&c===r)break;l.tag===5&&d!==null&&(l=d,s?(c=Ll(n,i),c!=null&&o.unshift(Ul(n,c,l))):s||(c=Ll(n,i),c!=null&&o.push(Ul(n,c,l)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var LI=/\r\n?/g,MI=/\u0000|\uFFFD/g;function Ny(t){return(typeof t=="string"?t:""+t).replace(LI,`
`).replace(MI,"")}function ad(t,e,n){if(e=Ny(e),Ny(t)!==e&&n)throw Error(ue(425))}function nu(){}var mp=null,yp=null;function vp(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var xp=typeof setTimeout=="function"?setTimeout:void 0,DI=typeof clearTimeout=="function"?clearTimeout:void 0,$y=typeof Promise=="function"?Promise:void 0,NI=typeof queueMicrotask=="function"?queueMicrotask:typeof $y<"u"?function(t){return $y.resolve(null).then(t).catch($I)}:xp;function $I(t){setTimeout(function(){throw t})}function _h(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),Nl(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);Nl(e)}function Zs(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function jy(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var va=Math.random().toString(36).slice(2),Kr="__reactFiber$"+va,Bl="__reactProps$"+va,ms="__reactContainer$"+va,_p="__reactEvents$"+va,jI="__reactListeners$"+va,FI="__reactHandles$"+va;function Mi(t){var e=t[Kr];if(e)return e;for(var n=t.parentNode;n;){if(e=n[ms]||n[Kr]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=jy(t);t!==null;){if(n=t[Kr])return n;t=jy(t)}return e}t=n,n=t.parentNode}return null}function fc(t){return t=t[Kr]||t[ms],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Mo(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(ue(33))}function Xu(t){return t[Bl]||null}var bp=[],Do=-1;function vi(t){return{current:t}}function Ht(t){0>Do||(t.current=bp[Do],bp[Do]=null,Do--)}function Ut(t,e){Do++,bp[Do]=t.current,t.current=e}var ui={},Ln=vi(ui),Jn=vi(!1),Ui=ui;function na(t,e){var n=t.type.contextTypes;if(!n)return ui;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function Qn(t){return t=t.childContextTypes,t!=null}function ru(){Ht(Jn),Ht(Ln)}function Fy(t,e,n){if(Ln.current!==ui)throw Error(ue(168));Ut(Ln,e),Ut(Jn,n)}function h_(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(ue(108,Sw(t)||"Unknown",s));return qt({},n,r)}function su(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||ui,Ui=Ln.current,Ut(Ln,t),Ut(Jn,Jn.current),!0}function Uy(t,e,n){var r=t.stateNode;if(!r)throw Error(ue(169));n?(t=h_(t,e,Ui),r.__reactInternalMemoizedMergedChildContext=t,Ht(Jn),Ht(Ln),Ut(Ln,t)):Ht(Jn),Ut(Jn,n)}var is=null,Ju=!1,bh=!1;function p_(t){is===null?is=[t]:is.push(t)}function UI(t){Ju=!0,p_(t)}function xi(){if(!bh&&is!==null){bh=!0;var t=0,e=Rt;try{var n=is;for(Rt=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}is=null,Ju=!1}catch(s){throw is!==null&&(is=is.slice(t+1)),F1(Lg,xi),s}finally{Rt=e,bh=!1}}return null}var No=[],$o=0,iu=null,ou=0,vr=[],xr=0,Bi=null,as=1,ls="";function Ri(t,e){No[$o++]=ou,No[$o++]=iu,iu=t,ou=e}function g_(t,e,n){vr[xr++]=as,vr[xr++]=ls,vr[xr++]=Bi,Bi=t;var r=as;t=ls;var s=32-jr(r)-1;r&=~(1<<s),n+=1;var i=32-jr(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,as=1<<32-jr(e)+s|n<<s|r,ls=i+t}else as=1<<i|n<<s|r,ls=t}function zg(t){t.return!==null&&(Ri(t,1),g_(t,1,0))}function Hg(t){for(;t===iu;)iu=No[--$o],No[$o]=null,ou=No[--$o],No[$o]=null;for(;t===Bi;)Bi=vr[--xr],vr[xr]=null,ls=vr[--xr],vr[xr]=null,as=vr[--xr],vr[xr]=null}var lr=null,ar=null,Vt=!1,Lr=null;function m_(t,e){var n=br(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function By(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,lr=t,ar=Zs(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,lr=t,ar=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Bi!==null?{id:as,overflow:ls}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=br(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,lr=t,ar=null,!0):!1;default:return!1}}function Ep(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Sp(t){if(Vt){var e=ar;if(e){var n=e;if(!By(t,e)){if(Ep(t))throw Error(ue(418));e=Zs(n.nextSibling);var r=lr;e&&By(t,e)?m_(r,n):(t.flags=t.flags&-4097|2,Vt=!1,lr=t)}}else{if(Ep(t))throw Error(ue(418));t.flags=t.flags&-4097|2,Vt=!1,lr=t}}}function zy(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;lr=t}function ld(t){if(t!==lr)return!1;if(!Vt)return zy(t),Vt=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!vp(t.type,t.memoizedProps)),e&&(e=ar)){if(Ep(t))throw y_(),Error(ue(418));for(;e;)m_(t,e),e=Zs(e.nextSibling)}if(zy(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(ue(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){ar=Zs(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}ar=null}}else ar=lr?Zs(t.stateNode.nextSibling):null;return!0}function y_(){for(var t=ar;t;)t=Zs(t.nextSibling)}function ra(){ar=lr=null,Vt=!1}function Wg(t){Lr===null?Lr=[t]:Lr.push(t)}var BI=Es.ReactCurrentBatchConfig;function Ka(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(ue(309));var r=n.stateNode}if(!r)throw Error(ue(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var l=s.refs;o===null?delete l[i]:l[i]=o},e._stringRef=i,e)}if(typeof t!="string")throw Error(ue(284));if(!n._owner)throw Error(ue(290,t))}return t}function cd(t,e){throw t=Object.prototype.toString.call(e),Error(ue(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Hy(t){var e=t._init;return e(t._payload)}function v_(t){function e(R,m){if(t){var T=R.deletions;T===null?(R.deletions=[m],R.flags|=16):T.push(m)}}function n(R,m){if(!t)return null;for(;m!==null;)e(R,m),m=m.sibling;return null}function r(R,m){for(R=new Map;m!==null;)m.key!==null?R.set(m.key,m):R.set(m.index,m),m=m.sibling;return R}function s(R,m){return R=ri(R,m),R.index=0,R.sibling=null,R}function i(R,m,T){return R.index=T,t?(T=R.alternate,T!==null?(T=T.index,T<m?(R.flags|=2,m):T):(R.flags|=2,m)):(R.flags|=1048576,m)}function o(R){return t&&R.alternate===null&&(R.flags|=2),R}function l(R,m,T,L){return m===null||m.tag!==6?(m=kh(T,R.mode,L),m.return=R,m):(m=s(m,T),m.return=R,m)}function c(R,m,T,L){var g=T.type;return g===Ao?u(R,m,T.props.children,L,T.key):m!==null&&(m.elementType===g||typeof g=="object"&&g!==null&&g.$$typeof===Ns&&Hy(g)===m.type)?(L=s(m,T.props),L.ref=Ka(R,m,T),L.return=R,L):(L=Md(T.type,T.key,T.props,null,R.mode,L),L.ref=Ka(R,m,T),L.return=R,L)}function d(R,m,T,L){return m===null||m.tag!==4||m.stateNode.containerInfo!==T.containerInfo||m.stateNode.implementation!==T.implementation?(m=Rh(T,R.mode,L),m.return=R,m):(m=s(m,T.children||[]),m.return=R,m)}function u(R,m,T,L,g){return m===null||m.tag!==7?(m=Fi(T,R.mode,L,g),m.return=R,m):(m=s(m,T),m.return=R,m)}function h(R,m,T){if(typeof m=="string"&&m!==""||typeof m=="number")return m=kh(""+m,R.mode,T),m.return=R,m;if(typeof m=="object"&&m!==null){switch(m.$$typeof){case qc:return T=Md(m.type,m.key,m.props,null,R.mode,T),T.ref=Ka(R,null,m),T.return=R,T;case Ro:return m=Rh(m,R.mode,T),m.return=R,m;case Ns:var L=m._init;return h(R,L(m._payload),T)}if(il(m)||Ha(m))return m=Fi(m,R.mode,T,null),m.return=R,m;cd(R,m)}return null}function f(R,m,T,L){var g=m!==null?m.key:null;if(typeof T=="string"&&T!==""||typeof T=="number")return g!==null?null:l(R,m,""+T,L);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case qc:return T.key===g?c(R,m,T,L):null;case Ro:return T.key===g?d(R,m,T,L):null;case Ns:return g=T._init,f(R,m,g(T._payload),L)}if(il(T)||Ha(T))return g!==null?null:u(R,m,T,L,null);cd(R,T)}return null}function b(R,m,T,L,g){if(typeof L=="string"&&L!==""||typeof L=="number")return R=R.get(T)||null,l(m,R,""+L,g);if(typeof L=="object"&&L!==null){switch(L.$$typeof){case qc:return R=R.get(L.key===null?T:L.key)||null,c(m,R,L,g);case Ro:return R=R.get(L.key===null?T:L.key)||null,d(m,R,L,g);case Ns:var H=L._init;return b(R,m,T,H(L._payload),g)}if(il(L)||Ha(L))return R=R.get(T)||null,u(m,R,L,g,null);cd(m,L)}return null}function C(R,m,T,L){for(var g=null,H=null,Q=m,W=m=0,G=null;Q!==null&&W<T.length;W++){Q.index>W?(G=Q,Q=null):G=Q.sibling;var de=f(R,Q,T[W],L);if(de===null){Q===null&&(Q=G);break}t&&Q&&de.alternate===null&&e(R,Q),m=i(de,m,W),H===null?g=de:H.sibling=de,H=de,Q=G}if(W===T.length)return n(R,Q),Vt&&Ri(R,W),g;if(Q===null){for(;W<T.length;W++)Q=h(R,T[W],L),Q!==null&&(m=i(Q,m,W),H===null?g=Q:H.sibling=Q,H=Q);return Vt&&Ri(R,W),g}for(Q=r(R,Q);W<T.length;W++)G=b(Q,R,W,T[W],L),G!==null&&(t&&G.alternate!==null&&Q.delete(G.key===null?W:G.key),m=i(G,m,W),H===null?g=G:H.sibling=G,H=G);return t&&Q.forEach(function(fe){return e(R,fe)}),Vt&&Ri(R,W),g}function k(R,m,T,L){var g=Ha(T);if(typeof g!="function")throw Error(ue(150));if(T=g.call(T),T==null)throw Error(ue(151));for(var H=g=null,Q=m,W=m=0,G=null,de=T.next();Q!==null&&!de.done;W++,de=T.next()){Q.index>W?(G=Q,Q=null):G=Q.sibling;var fe=f(R,Q,de.value,L);if(fe===null){Q===null&&(Q=G);break}t&&Q&&fe.alternate===null&&e(R,Q),m=i(fe,m,W),H===null?g=fe:H.sibling=fe,H=fe,Q=G}if(de.done)return n(R,Q),Vt&&Ri(R,W),g;if(Q===null){for(;!de.done;W++,de=T.next())de=h(R,de.value,L),de!==null&&(m=i(de,m,W),H===null?g=de:H.sibling=de,H=de);return Vt&&Ri(R,W),g}for(Q=r(R,Q);!de.done;W++,de=T.next())de=b(Q,R,W,de.value,L),de!==null&&(t&&de.alternate!==null&&Q.delete(de.key===null?W:de.key),m=i(de,m,W),H===null?g=de:H.sibling=de,H=de);return t&&Q.forEach(function(Ee){return e(R,Ee)}),Vt&&Ri(R,W),g}function A(R,m,T,L){if(typeof T=="object"&&T!==null&&T.type===Ao&&T.key===null&&(T=T.props.children),typeof T=="object"&&T!==null){switch(T.$$typeof){case qc:e:{for(var g=T.key,H=m;H!==null;){if(H.key===g){if(g=T.type,g===Ao){if(H.tag===7){n(R,H.sibling),m=s(H,T.props.children),m.return=R,R=m;break e}}else if(H.elementType===g||typeof g=="object"&&g!==null&&g.$$typeof===Ns&&Hy(g)===H.type){n(R,H.sibling),m=s(H,T.props),m.ref=Ka(R,H,T),m.return=R,R=m;break e}n(R,H);break}else e(R,H);H=H.sibling}T.type===Ao?(m=Fi(T.props.children,R.mode,L,T.key),m.return=R,R=m):(L=Md(T.type,T.key,T.props,null,R.mode,L),L.ref=Ka(R,m,T),L.return=R,R=L)}return o(R);case Ro:e:{for(H=T.key;m!==null;){if(m.key===H)if(m.tag===4&&m.stateNode.containerInfo===T.containerInfo&&m.stateNode.implementation===T.implementation){n(R,m.sibling),m=s(m,T.children||[]),m.return=R,R=m;break e}else{n(R,m);break}else e(R,m);m=m.sibling}m=Rh(T,R.mode,L),m.return=R,R=m}return o(R);case Ns:return H=T._init,A(R,m,H(T._payload),L)}if(il(T))return C(R,m,T,L);if(Ha(T))return k(R,m,T,L);cd(R,T)}return typeof T=="string"&&T!==""||typeof T=="number"?(T=""+T,m!==null&&m.tag===6?(n(R,m.sibling),m=s(m,T),m.return=R,R=m):(n(R,m),m=kh(T,R.mode,L),m.return=R,R=m),o(R)):n(R,m)}return A}var sa=v_(!0),x_=v_(!1),au=vi(null),lu=null,jo=null,Gg=null;function Vg(){Gg=jo=lu=null}function Yg(t){var e=au.current;Ht(au),t._currentValue=e}function wp(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function Yo(t,e){lu=t,Gg=jo=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Kn=!0),t.firstContext=null)}function wr(t){var e=t._currentValue;if(Gg!==t)if(t={context:t,memoizedValue:e,next:null},jo===null){if(lu===null)throw Error(ue(308));jo=t,lu.dependencies={lanes:0,firstContext:t}}else jo=jo.next=t;return e}var Di=null;function Kg(t){Di===null?Di=[t]:Di.push(t)}function __(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,Kg(e)):(n.next=s.next,s.next=n),e.interleaved=n,ys(t,r)}function ys(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var $s=!1;function Xg(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function b_(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function fs(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function ei(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,_t&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,ys(t,n)}return s=r.interleaved,s===null?(e.next=e,Kg(r)):(e.next=s.next,s.next=e),r.interleaved=e,ys(t,n)}function kd(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Mg(t,n)}}function Wy(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=o:i=i.next=o,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function cu(t,e,n,r){var s=t.updateQueue;$s=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,l=s.shared.pending;if(l!==null){s.shared.pending=null;var c=l,d=c.next;c.next=null,o===null?i=d:o.next=d,o=c;var u=t.alternate;u!==null&&(u=u.updateQueue,l=u.lastBaseUpdate,l!==o&&(l===null?u.firstBaseUpdate=d:l.next=d,u.lastBaseUpdate=c))}if(i!==null){var h=s.baseState;o=0,u=d=c=null,l=i;do{var f=l.lane,b=l.eventTime;if((r&f)===f){u!==null&&(u=u.next={eventTime:b,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var C=t,k=l;switch(f=e,b=n,k.tag){case 1:if(C=k.payload,typeof C=="function"){h=C.call(b,h,f);break e}h=C;break e;case 3:C.flags=C.flags&-65537|128;case 0:if(C=k.payload,f=typeof C=="function"?C.call(b,h,f):C,f==null)break e;h=qt({},h,f);break e;case 2:$s=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,f=s.effects,f===null?s.effects=[l]:f.push(l))}else b={eventTime:b,lane:f,tag:l.tag,payload:l.payload,callback:l.callback,next:null},u===null?(d=u=b,c=h):u=u.next=b,o|=f;if(l=l.next,l===null){if(l=s.shared.pending,l===null)break;f=l,l=f.next,f.next=null,s.lastBaseUpdate=f,s.shared.pending=null}}while(!0);if(u===null&&(c=h),s.baseState=c,s.firstBaseUpdate=d,s.lastBaseUpdate=u,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);Hi|=o,t.lanes=o,t.memoizedState=h}}function Gy(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(ue(191,s));s.call(r)}}}var hc={},Jr=vi(hc),zl=vi(hc),Hl=vi(hc);function Ni(t){if(t===hc)throw Error(ue(174));return t}function Jg(t,e){switch(Ut(Hl,e),Ut(zl,t),Ut(Jr,hc),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:sp(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=sp(e,t)}Ht(Jr),Ut(Jr,e)}function ia(){Ht(Jr),Ht(zl),Ht(Hl)}function E_(t){Ni(Hl.current);var e=Ni(Jr.current),n=sp(e,t.type);e!==n&&(Ut(zl,t),Ut(Jr,n))}function Qg(t){zl.current===t&&(Ht(Jr),Ht(zl))}var Kt=vi(0);function du(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Eh=[];function qg(){for(var t=0;t<Eh.length;t++)Eh[t]._workInProgressVersionPrimary=null;Eh.length=0}var Rd=Es.ReactCurrentDispatcher,Sh=Es.ReactCurrentBatchConfig,zi=0,Qt=null,an=null,fn=null,uu=!1,ml=!1,Wl=0,zI=0;function Rn(){throw Error(ue(321))}function Zg(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Br(t[n],e[n]))return!1;return!0}function e0(t,e,n,r,s,i){if(zi=i,Qt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Rd.current=t===null||t.memoizedState===null?VI:YI,t=n(r,s),ml){i=0;do{if(ml=!1,Wl=0,25<=i)throw Error(ue(301));i+=1,fn=an=null,e.updateQueue=null,Rd.current=KI,t=n(r,s)}while(ml)}if(Rd.current=fu,e=an!==null&&an.next!==null,zi=0,fn=an=Qt=null,uu=!1,e)throw Error(ue(300));return t}function t0(){var t=Wl!==0;return Wl=0,t}function Yr(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return fn===null?Qt.memoizedState=fn=t:fn=fn.next=t,fn}function Ir(){if(an===null){var t=Qt.alternate;t=t!==null?t.memoizedState:null}else t=an.next;var e=fn===null?Qt.memoizedState:fn.next;if(e!==null)fn=e,an=t;else{if(t===null)throw Error(ue(310));an=t,t={memoizedState:an.memoizedState,baseState:an.baseState,baseQueue:an.baseQueue,queue:an.queue,next:null},fn===null?Qt.memoizedState=fn=t:fn=fn.next=t}return fn}function Gl(t,e){return typeof e=="function"?e(t):e}function wh(t){var e=Ir(),n=e.queue;if(n===null)throw Error(ue(311));n.lastRenderedReducer=t;var r=an,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var l=o=null,c=null,d=i;do{var u=d.lane;if((zi&u)===u)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:t(r,d.action);else{var h={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(l=c=h,o=r):c=c.next=h,Qt.lanes|=u,Hi|=u}d=d.next}while(d!==null&&d!==i);c===null?o=r:c.next=l,Br(r,e.memoizedState)||(Kn=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=c,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,Qt.lanes|=i,Hi|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Ih(t){var e=Ir(),n=e.queue;if(n===null)throw Error(ue(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var o=s=s.next;do i=t(i,o.action),o=o.next;while(o!==s);Br(i,e.memoizedState)||(Kn=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function S_(){}function w_(t,e){var n=Qt,r=Ir(),s=e(),i=!Br(r.memoizedState,s);if(i&&(r.memoizedState=s,Kn=!0),r=r.queue,n0(C_.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||fn!==null&&fn.memoizedState.tag&1){if(n.flags|=2048,Vl(9,T_.bind(null,n,r,s,e),void 0,null),gn===null)throw Error(ue(349));zi&30||I_(n,e,s)}return s}function I_(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Qt.updateQueue,e===null?(e={lastEffect:null,stores:null},Qt.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function T_(t,e,n,r){e.value=n,e.getSnapshot=r,k_(e)&&R_(t)}function C_(t,e,n){return n(function(){k_(e)&&R_(t)})}function k_(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Br(t,n)}catch{return!0}}function R_(t){var e=ys(t,1);e!==null&&Fr(e,t,1,-1)}function Vy(t){var e=Yr();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Gl,lastRenderedState:t},e.queue=t,t=t.dispatch=GI.bind(null,Qt,t),[e.memoizedState,t]}function Vl(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=Qt.updateQueue,e===null?(e={lastEffect:null,stores:null},Qt.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function A_(){return Ir().memoizedState}function Ad(t,e,n,r){var s=Yr();Qt.flags|=t,s.memoizedState=Vl(1|e,n,void 0,r===void 0?null:r)}function Qu(t,e,n,r){var s=Ir();r=r===void 0?null:r;var i=void 0;if(an!==null){var o=an.memoizedState;if(i=o.destroy,r!==null&&Zg(r,o.deps)){s.memoizedState=Vl(e,n,i,r);return}}Qt.flags|=t,s.memoizedState=Vl(1|e,n,i,r)}function Yy(t,e){return Ad(8390656,8,t,e)}function n0(t,e){return Qu(2048,8,t,e)}function P_(t,e){return Qu(4,2,t,e)}function O_(t,e){return Qu(4,4,t,e)}function L_(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function M_(t,e,n){return n=n!=null?n.concat([t]):null,Qu(4,4,L_.bind(null,e,t),n)}function r0(){}function D_(t,e){var n=Ir();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Zg(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function N_(t,e){var n=Ir();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Zg(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function $_(t,e,n){return zi&21?(Br(n,e)||(n=z1(),Qt.lanes|=n,Hi|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Kn=!0),t.memoizedState=n)}function HI(t,e){var n=Rt;Rt=n!==0&&4>n?n:4,t(!0);var r=Sh.transition;Sh.transition={};try{t(!1),e()}finally{Rt=n,Sh.transition=r}}function j_(){return Ir().memoizedState}function WI(t,e,n){var r=ni(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},F_(t))U_(e,n);else if(n=__(t,e,n,r),n!==null){var s=Fn();Fr(n,t,r,s),B_(n,e,r)}}function GI(t,e,n){var r=ni(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(F_(t))U_(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,l=i(o,n);if(s.hasEagerState=!0,s.eagerState=l,Br(l,o)){var c=e.interleaved;c===null?(s.next=s,Kg(e)):(s.next=c.next,c.next=s),e.interleaved=s;return}}catch{}finally{}n=__(t,e,s,r),n!==null&&(s=Fn(),Fr(n,t,r,s),B_(n,e,r))}}function F_(t){var e=t.alternate;return t===Qt||e!==null&&e===Qt}function U_(t,e){ml=uu=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function B_(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Mg(t,n)}}var fu={readContext:wr,useCallback:Rn,useContext:Rn,useEffect:Rn,useImperativeHandle:Rn,useInsertionEffect:Rn,useLayoutEffect:Rn,useMemo:Rn,useReducer:Rn,useRef:Rn,useState:Rn,useDebugValue:Rn,useDeferredValue:Rn,useTransition:Rn,useMutableSource:Rn,useSyncExternalStore:Rn,useId:Rn,unstable_isNewReconciler:!1},VI={readContext:wr,useCallback:function(t,e){return Yr().memoizedState=[t,e===void 0?null:e],t},useContext:wr,useEffect:Yy,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Ad(4194308,4,L_.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Ad(4194308,4,t,e)},useInsertionEffect:function(t,e){return Ad(4,2,t,e)},useMemo:function(t,e){var n=Yr();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Yr();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=WI.bind(null,Qt,t),[r.memoizedState,t]},useRef:function(t){var e=Yr();return t={current:t},e.memoizedState=t},useState:Vy,useDebugValue:r0,useDeferredValue:function(t){return Yr().memoizedState=t},useTransition:function(){var t=Vy(!1),e=t[0];return t=HI.bind(null,t[1]),Yr().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=Qt,s=Yr();if(Vt){if(n===void 0)throw Error(ue(407));n=n()}else{if(n=e(),gn===null)throw Error(ue(349));zi&30||I_(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,Yy(C_.bind(null,r,i,t),[t]),r.flags|=2048,Vl(9,T_.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=Yr(),e=gn.identifierPrefix;if(Vt){var n=ls,r=as;n=(r&~(1<<32-jr(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=Wl++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=zI++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},YI={readContext:wr,useCallback:D_,useContext:wr,useEffect:n0,useImperativeHandle:M_,useInsertionEffect:P_,useLayoutEffect:O_,useMemo:N_,useReducer:wh,useRef:A_,useState:function(){return wh(Gl)},useDebugValue:r0,useDeferredValue:function(t){var e=Ir();return $_(e,an.memoizedState,t)},useTransition:function(){var t=wh(Gl)[0],e=Ir().memoizedState;return[t,e]},useMutableSource:S_,useSyncExternalStore:w_,useId:j_,unstable_isNewReconciler:!1},KI={readContext:wr,useCallback:D_,useContext:wr,useEffect:n0,useImperativeHandle:M_,useInsertionEffect:P_,useLayoutEffect:O_,useMemo:N_,useReducer:Ih,useRef:A_,useState:function(){return Ih(Gl)},useDebugValue:r0,useDeferredValue:function(t){var e=Ir();return an===null?e.memoizedState=t:$_(e,an.memoizedState,t)},useTransition:function(){var t=Ih(Gl)[0],e=Ir().memoizedState;return[t,e]},useMutableSource:S_,useSyncExternalStore:w_,useId:j_,unstable_isNewReconciler:!1};function Pr(t,e){if(t&&t.defaultProps){e=qt({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Ip(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:qt({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var qu={isMounted:function(t){return(t=t._reactInternals)?Zi(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=Fn(),s=ni(t),i=fs(r,s);i.payload=e,n!=null&&(i.callback=n),e=ei(t,i,s),e!==null&&(Fr(e,t,s,r),kd(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=Fn(),s=ni(t),i=fs(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=ei(t,i,s),e!==null&&(Fr(e,t,s,r),kd(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Fn(),r=ni(t),s=fs(n,r);s.tag=2,e!=null&&(s.callback=e),e=ei(t,s,r),e!==null&&(Fr(e,t,r,n),kd(e,t,r))}};function Ky(t,e,n,r,s,i,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!jl(n,r)||!jl(s,i):!0}function z_(t,e,n){var r=!1,s=ui,i=e.contextType;return typeof i=="object"&&i!==null?i=wr(i):(s=Qn(e)?Ui:Ln.current,r=e.contextTypes,i=(r=r!=null)?na(t,s):ui),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=qu,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function Xy(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&qu.enqueueReplaceState(e,e.state,null)}function Tp(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},Xg(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=wr(i):(i=Qn(e)?Ui:Ln.current,s.context=na(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(Ip(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&qu.enqueueReplaceState(s,s.state,null),cu(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function oa(t,e){try{var n="",r=e;do n+=Ew(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function Th(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Cp(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var XI=typeof WeakMap=="function"?WeakMap:Map;function H_(t,e,n){n=fs(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){pu||(pu=!0,$p=r),Cp(t,e)},n}function W_(t,e,n){n=fs(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){Cp(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){Cp(t,e),typeof r!="function"&&(ti===null?ti=new Set([this]):ti.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function Jy(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new XI;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=c5.bind(null,t,e,n),e.then(t,t))}function Qy(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function qy(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=fs(-1,1),e.tag=2,ei(n,e,1))),n.lanes|=1),t)}var JI=Es.ReactCurrentOwner,Kn=!1;function $n(t,e,n,r){e.child=t===null?x_(e,null,n,r):sa(e,t.child,n,r)}function Zy(t,e,n,r,s){n=n.render;var i=e.ref;return Yo(e,s),r=e0(t,e,n,r,i,s),n=t0(),t!==null&&!Kn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,vs(t,e,s)):(Vt&&n&&zg(e),e.flags|=1,$n(t,e,r,s),e.child)}function ev(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!u0(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,G_(t,e,i,r,s)):(t=Md(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var o=i.memoizedProps;if(n=n.compare,n=n!==null?n:jl,n(o,r)&&t.ref===e.ref)return vs(t,e,s)}return e.flags|=1,t=ri(i,r),t.ref=e.ref,t.return=e,e.child=t}function G_(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(jl(i,r)&&t.ref===e.ref)if(Kn=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(Kn=!0);else return e.lanes=t.lanes,vs(t,e,s)}return kp(t,e,n,r,s)}function V_(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ut(Uo,rr),rr|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Ut(Uo,rr),rr|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,Ut(Uo,rr),rr|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,Ut(Uo,rr),rr|=r;return $n(t,e,s,n),e.child}function Y_(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function kp(t,e,n,r,s){var i=Qn(n)?Ui:Ln.current;return i=na(e,i),Yo(e,s),n=e0(t,e,n,r,i,s),r=t0(),t!==null&&!Kn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,vs(t,e,s)):(Vt&&r&&zg(e),e.flags|=1,$n(t,e,n,s),e.child)}function tv(t,e,n,r,s){if(Qn(n)){var i=!0;su(e)}else i=!1;if(Yo(e,s),e.stateNode===null)Pd(t,e),z_(e,n,r),Tp(e,n,r,s),r=!0;else if(t===null){var o=e.stateNode,l=e.memoizedProps;o.props=l;var c=o.context,d=n.contextType;typeof d=="object"&&d!==null?d=wr(d):(d=Qn(n)?Ui:Ln.current,d=na(e,d));var u=n.getDerivedStateFromProps,h=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==r||c!==d)&&Xy(e,o,r,d),$s=!1;var f=e.memoizedState;o.state=f,cu(e,r,o,s),c=e.memoizedState,l!==r||f!==c||Jn.current||$s?(typeof u=="function"&&(Ip(e,n,u,r),c=e.memoizedState),(l=$s||Ky(e,n,l,r,f,c,d))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),o.props=r,o.state=c,o.context=d,r=l):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,b_(t,e),l=e.memoizedProps,d=e.type===e.elementType?l:Pr(e.type,l),o.props=d,h=e.pendingProps,f=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=wr(c):(c=Qn(n)?Ui:Ln.current,c=na(e,c));var b=n.getDerivedStateFromProps;(u=typeof b=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==h||f!==c)&&Xy(e,o,r,c),$s=!1,f=e.memoizedState,o.state=f,cu(e,r,o,s);var C=e.memoizedState;l!==h||f!==C||Jn.current||$s?(typeof b=="function"&&(Ip(e,n,b,r),C=e.memoizedState),(d=$s||Ky(e,n,d,r,f,C,c)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,C,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,C,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=C),o.props=r,o.state=C,o.context=c,r=d):(typeof o.componentDidUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),r=!1)}return Rp(t,e,n,r,i,s)}function Rp(t,e,n,r,s,i){Y_(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&Uy(e,n,!1),vs(t,e,i);r=e.stateNode,JI.current=e;var l=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=sa(e,t.child,null,i),e.child=sa(e,null,l,i)):$n(t,e,l,i),e.memoizedState=r.state,s&&Uy(e,n,!0),e.child}function K_(t){var e=t.stateNode;e.pendingContext?Fy(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Fy(t,e.context,!1),Jg(t,e.containerInfo)}function nv(t,e,n,r,s){return ra(),Wg(s),e.flags|=256,$n(t,e,n,r),e.child}var Ap={dehydrated:null,treeContext:null,retryLane:0};function Pp(t){return{baseLanes:t,cachePool:null,transitions:null}}function X_(t,e,n){var r=e.pendingProps,s=Kt.current,i=!1,o=(e.flags&128)!==0,l;if((l=o)||(l=t!==null&&t.memoizedState===null?!1:(s&2)!==0),l?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),Ut(Kt,s&1),t===null)return Sp(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=tf(o,r,0,null),t=Fi(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=Pp(n),e.memoizedState=Ap,t):s0(e,o));if(s=t.memoizedState,s!==null&&(l=s.dehydrated,l!==null))return QI(t,e,o,r,l,s,n);if(i){i=r.fallback,o=e.mode,s=t.child,l=s.sibling;var c={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=ri(s,c),r.subtreeFlags=s.subtreeFlags&14680064),l!==null?i=ri(l,i):(i=Fi(i,o,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=t.child.memoizedState,o=o===null?Pp(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=t.childLanes&~n,e.memoizedState=Ap,r}return i=t.child,t=i.sibling,r=ri(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function s0(t,e){return e=tf({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function dd(t,e,n,r){return r!==null&&Wg(r),sa(e,t.child,null,n),t=s0(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function QI(t,e,n,r,s,i,o){if(n)return e.flags&256?(e.flags&=-257,r=Th(Error(ue(422))),dd(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=tf({mode:"visible",children:r.children},s,0,null),i=Fi(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&sa(e,t.child,null,o),e.child.memoizedState=Pp(o),e.memoizedState=Ap,i);if(!(e.mode&1))return dd(t,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var l=r.dgst;return r=l,i=Error(ue(419)),r=Th(i,r,void 0),dd(t,e,o,r)}if(l=(o&t.childLanes)!==0,Kn||l){if(r=gn,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,ys(t,s),Fr(r,t,s,-1))}return d0(),r=Th(Error(ue(421))),dd(t,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=d5.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,ar=Zs(s.nextSibling),lr=e,Vt=!0,Lr=null,t!==null&&(vr[xr++]=as,vr[xr++]=ls,vr[xr++]=Bi,as=t.id,ls=t.overflow,Bi=e),e=s0(e,r.children),e.flags|=4096,e)}function rv(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),wp(t.return,e,n)}function Ch(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function J_(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if($n(t,e,r.children,n),r=Kt.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&rv(t,n,e);else if(t.tag===19)rv(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(Ut(Kt,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&du(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),Ch(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&du(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}Ch(e,!0,n,null,i);break;case"together":Ch(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Pd(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function vs(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Hi|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(ue(153));if(e.child!==null){for(t=e.child,n=ri(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=ri(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function qI(t,e,n){switch(e.tag){case 3:K_(e),ra();break;case 5:E_(e);break;case 1:Qn(e.type)&&su(e);break;case 4:Jg(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;Ut(au,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Ut(Kt,Kt.current&1),e.flags|=128,null):n&e.child.childLanes?X_(t,e,n):(Ut(Kt,Kt.current&1),t=vs(t,e,n),t!==null?t.sibling:null);Ut(Kt,Kt.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return J_(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Ut(Kt,Kt.current),r)break;return null;case 22:case 23:return e.lanes=0,V_(t,e,n)}return vs(t,e,n)}var Q_,Op,q_,Z_;Q_=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Op=function(){};q_=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,Ni(Jr.current);var i=null;switch(n){case"input":s=ep(t,s),r=ep(t,r),i=[];break;case"select":s=qt({},s,{value:void 0}),r=qt({},r,{value:void 0}),i=[];break;case"textarea":s=rp(t,s),r=rp(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=nu)}ip(n,r);var o;n=null;for(d in s)if(!r.hasOwnProperty(d)&&s.hasOwnProperty(d)&&s[d]!=null)if(d==="style"){var l=s[d];for(o in l)l.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(Pl.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in r){var c=r[d];if(l=s!=null?s[d]:void 0,r.hasOwnProperty(d)&&c!==l&&(c!=null||l!=null))if(d==="style")if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(i||(i=[]),i.push(d,n)),n=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(i=i||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(Pl.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&zt("scroll",t),i||l===c||(i=[])):(i=i||[]).push(d,c))}n&&(i=i||[]).push("style",n);var d=i;(e.updateQueue=d)&&(e.flags|=4)}};Z_=function(t,e,n,r){n!==r&&(e.flags|=4)};function Xa(t,e){if(!Vt)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function An(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function ZI(t,e,n){var r=e.pendingProps;switch(Hg(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return An(e),null;case 1:return Qn(e.type)&&ru(),An(e),null;case 3:return r=e.stateNode,ia(),Ht(Jn),Ht(Ln),qg(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(ld(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Lr!==null&&(Up(Lr),Lr=null))),Op(t,e),An(e),null;case 5:Qg(e);var s=Ni(Hl.current);if(n=e.type,t!==null&&e.stateNode!=null)q_(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(ue(166));return An(e),null}if(t=Ni(Jr.current),ld(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[Kr]=e,r[Bl]=i,t=(e.mode&1)!==0,n){case"dialog":zt("cancel",r),zt("close",r);break;case"iframe":case"object":case"embed":zt("load",r);break;case"video":case"audio":for(s=0;s<al.length;s++)zt(al[s],r);break;case"source":zt("error",r);break;case"img":case"image":case"link":zt("error",r),zt("load",r);break;case"details":zt("toggle",r);break;case"input":fy(r,i),zt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},zt("invalid",r);break;case"textarea":py(r,i),zt("invalid",r)}ip(n,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var l=i[o];o==="children"?typeof l=="string"?r.textContent!==l&&(i.suppressHydrationWarning!==!0&&ad(r.textContent,l,t),s=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(i.suppressHydrationWarning!==!0&&ad(r.textContent,l,t),s=["children",""+l]):Pl.hasOwnProperty(o)&&l!=null&&o==="onScroll"&&zt("scroll",r)}switch(n){case"input":Zc(r),hy(r,i,!0);break;case"textarea":Zc(r),gy(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=nu)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=C1(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[Kr]=e,t[Bl]=r,Q_(t,e,!1,!1),e.stateNode=t;e:{switch(o=op(n,r),n){case"dialog":zt("cancel",t),zt("close",t),s=r;break;case"iframe":case"object":case"embed":zt("load",t),s=r;break;case"video":case"audio":for(s=0;s<al.length;s++)zt(al[s],t);s=r;break;case"source":zt("error",t),s=r;break;case"img":case"image":case"link":zt("error",t),zt("load",t),s=r;break;case"details":zt("toggle",t),s=r;break;case"input":fy(t,r),s=ep(t,r),zt("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=qt({},r,{value:void 0}),zt("invalid",t);break;case"textarea":py(t,r),s=rp(t,r),zt("invalid",t);break;default:s=r}ip(n,s),l=s;for(i in l)if(l.hasOwnProperty(i)){var c=l[i];i==="style"?A1(t,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&k1(t,c)):i==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&Ol(t,c):typeof c=="number"&&Ol(t,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Pl.hasOwnProperty(i)?c!=null&&i==="onScroll"&&zt("scroll",t):c!=null&&kg(t,i,c,o))}switch(n){case"input":Zc(t),hy(t,r,!1);break;case"textarea":Zc(t),gy(t);break;case"option":r.value!=null&&t.setAttribute("value",""+di(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?Ho(t,!!r.multiple,i,!1):r.defaultValue!=null&&Ho(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=nu)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return An(e),null;case 6:if(t&&e.stateNode!=null)Z_(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(ue(166));if(n=Ni(Hl.current),Ni(Jr.current),ld(e)){if(r=e.stateNode,n=e.memoizedProps,r[Kr]=e,(i=r.nodeValue!==n)&&(t=lr,t!==null))switch(t.tag){case 3:ad(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&ad(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Kr]=e,e.stateNode=r}return An(e),null;case 13:if(Ht(Kt),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Vt&&ar!==null&&e.mode&1&&!(e.flags&128))y_(),ra(),e.flags|=98560,i=!1;else if(i=ld(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(ue(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(ue(317));i[Kr]=e}else ra(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;An(e),i=!1}else Lr!==null&&(Up(Lr),Lr=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||Kt.current&1?cn===0&&(cn=3):d0())),e.updateQueue!==null&&(e.flags|=4),An(e),null);case 4:return ia(),Op(t,e),t===null&&Fl(e.stateNode.containerInfo),An(e),null;case 10:return Yg(e.type._context),An(e),null;case 17:return Qn(e.type)&&ru(),An(e),null;case 19:if(Ht(Kt),i=e.memoizedState,i===null)return An(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)Xa(i,!1);else{if(cn!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=du(t),o!==null){for(e.flags|=128,Xa(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,t=o.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Ut(Kt,Kt.current&1|2),e.child}t=t.sibling}i.tail!==null&&tn()>aa&&(e.flags|=128,r=!0,Xa(i,!1),e.lanes=4194304)}else{if(!r)if(t=du(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Xa(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!Vt)return An(e),null}else 2*tn()-i.renderingStartTime>aa&&n!==1073741824&&(e.flags|=128,r=!0,Xa(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(n=i.last,n!==null?n.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=tn(),e.sibling=null,n=Kt.current,Ut(Kt,r?n&1|2:n&1),e):(An(e),null);case 22:case 23:return c0(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?rr&1073741824&&(An(e),e.subtreeFlags&6&&(e.flags|=8192)):An(e),null;case 24:return null;case 25:return null}throw Error(ue(156,e.tag))}function e5(t,e){switch(Hg(e),e.tag){case 1:return Qn(e.type)&&ru(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return ia(),Ht(Jn),Ht(Ln),qg(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Qg(e),null;case 13:if(Ht(Kt),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(ue(340));ra()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Ht(Kt),null;case 4:return ia(),null;case 10:return Yg(e.type._context),null;case 22:case 23:return c0(),null;case 24:return null;default:return null}}var ud=!1,On=!1,t5=typeof WeakSet=="function"?WeakSet:Set,ke=null;function Fo(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){en(t,e,r)}else n.current=null}function Lp(t,e,n){try{n()}catch(r){en(t,e,r)}}var sv=!1;function n5(t,e){if(mp=Zd,t=s_(),Bg(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var o=0,l=-1,c=-1,d=0,u=0,h=t,f=null;t:for(;;){for(var b;h!==n||s!==0&&h.nodeType!==3||(l=o+s),h!==i||r!==0&&h.nodeType!==3||(c=o+r),h.nodeType===3&&(o+=h.nodeValue.length),(b=h.firstChild)!==null;)f=h,h=b;for(;;){if(h===t)break t;if(f===n&&++d===s&&(l=o),f===i&&++u===r&&(c=o),(b=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=b}n=l===-1||c===-1?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(yp={focusedElem:t,selectionRange:n},Zd=!1,ke=e;ke!==null;)if(e=ke,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,ke=t;else for(;ke!==null;){e=ke;try{var C=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(C!==null){var k=C.memoizedProps,A=C.memoizedState,R=e.stateNode,m=R.getSnapshotBeforeUpdate(e.elementType===e.type?k:Pr(e.type,k),A);R.__reactInternalSnapshotBeforeUpdate=m}break;case 3:var T=e.stateNode.containerInfo;T.nodeType===1?T.textContent="":T.nodeType===9&&T.documentElement&&T.removeChild(T.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ue(163))}}catch(L){en(e,e.return,L)}if(t=e.sibling,t!==null){t.return=e.return,ke=t;break}ke=e.return}return C=sv,sv=!1,C}function yl(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&Lp(e,n,i)}s=s.next}while(s!==r)}}function Zu(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Mp(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function eb(t){var e=t.alternate;e!==null&&(t.alternate=null,eb(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Kr],delete e[Bl],delete e[_p],delete e[jI],delete e[FI])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function tb(t){return t.tag===5||t.tag===3||t.tag===4}function iv(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||tb(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Dp(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=nu));else if(r!==4&&(t=t.child,t!==null))for(Dp(t,e,n),t=t.sibling;t!==null;)Dp(t,e,n),t=t.sibling}function Np(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Np(t,e,n),t=t.sibling;t!==null;)Np(t,e,n),t=t.sibling}var En=null,Or=!1;function Ms(t,e,n){for(n=n.child;n!==null;)nb(t,e,n),n=n.sibling}function nb(t,e,n){if(Xr&&typeof Xr.onCommitFiberUnmount=="function")try{Xr.onCommitFiberUnmount(Gu,n)}catch{}switch(n.tag){case 5:On||Fo(n,e);case 6:var r=En,s=Or;En=null,Ms(t,e,n),En=r,Or=s,En!==null&&(Or?(t=En,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):En.removeChild(n.stateNode));break;case 18:En!==null&&(Or?(t=En,n=n.stateNode,t.nodeType===8?_h(t.parentNode,n):t.nodeType===1&&_h(t,n),Nl(t)):_h(En,n.stateNode));break;case 4:r=En,s=Or,En=n.stateNode.containerInfo,Or=!0,Ms(t,e,n),En=r,Or=s;break;case 0:case 11:case 14:case 15:if(!On&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&Lp(n,e,o),s=s.next}while(s!==r)}Ms(t,e,n);break;case 1:if(!On&&(Fo(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(l){en(n,e,l)}Ms(t,e,n);break;case 21:Ms(t,e,n);break;case 22:n.mode&1?(On=(r=On)||n.memoizedState!==null,Ms(t,e,n),On=r):Ms(t,e,n);break;default:Ms(t,e,n)}}function ov(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new t5),e.forEach(function(r){var s=u5.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function Ar(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,o=e,l=o;e:for(;l!==null;){switch(l.tag){case 5:En=l.stateNode,Or=!1;break e;case 3:En=l.stateNode.containerInfo,Or=!0;break e;case 4:En=l.stateNode.containerInfo,Or=!0;break e}l=l.return}if(En===null)throw Error(ue(160));nb(i,o,s),En=null,Or=!1;var c=s.alternate;c!==null&&(c.return=null),s.return=null}catch(d){en(s,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)rb(e,t),e=e.sibling}function rb(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Ar(e,t),Vr(t),r&4){try{yl(3,t,t.return),Zu(3,t)}catch(k){en(t,t.return,k)}try{yl(5,t,t.return)}catch(k){en(t,t.return,k)}}break;case 1:Ar(e,t),Vr(t),r&512&&n!==null&&Fo(n,n.return);break;case 5:if(Ar(e,t),Vr(t),r&512&&n!==null&&Fo(n,n.return),t.flags&32){var s=t.stateNode;try{Ol(s,"")}catch(k){en(t,t.return,k)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,o=n!==null?n.memoizedProps:i,l=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{l==="input"&&i.type==="radio"&&i.name!=null&&I1(s,i),op(l,o);var d=op(l,i);for(o=0;o<c.length;o+=2){var u=c[o],h=c[o+1];u==="style"?A1(s,h):u==="dangerouslySetInnerHTML"?k1(s,h):u==="children"?Ol(s,h):kg(s,u,h,d)}switch(l){case"input":tp(s,i);break;case"textarea":T1(s,i);break;case"select":var f=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var b=i.value;b!=null?Ho(s,!!i.multiple,b,!1):f!==!!i.multiple&&(i.defaultValue!=null?Ho(s,!!i.multiple,i.defaultValue,!0):Ho(s,!!i.multiple,i.multiple?[]:"",!1))}s[Bl]=i}catch(k){en(t,t.return,k)}}break;case 6:if(Ar(e,t),Vr(t),r&4){if(t.stateNode===null)throw Error(ue(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(k){en(t,t.return,k)}}break;case 3:if(Ar(e,t),Vr(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Nl(e.containerInfo)}catch(k){en(t,t.return,k)}break;case 4:Ar(e,t),Vr(t);break;case 13:Ar(e,t),Vr(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(a0=tn())),r&4&&ov(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(On=(d=On)||u,Ar(e,t),On=d):Ar(e,t),Vr(t),r&8192){if(d=t.memoizedState!==null,(t.stateNode.isHidden=d)&&!u&&t.mode&1)for(ke=t,u=t.child;u!==null;){for(h=ke=u;ke!==null;){switch(f=ke,b=f.child,f.tag){case 0:case 11:case 14:case 15:yl(4,f,f.return);break;case 1:Fo(f,f.return);var C=f.stateNode;if(typeof C.componentWillUnmount=="function"){r=f,n=f.return;try{e=r,C.props=e.memoizedProps,C.state=e.memoizedState,C.componentWillUnmount()}catch(k){en(r,n,k)}}break;case 5:Fo(f,f.return);break;case 22:if(f.memoizedState!==null){lv(h);continue}}b!==null?(b.return=f,ke=b):lv(h)}u=u.sibling}e:for(u=null,h=t;;){if(h.tag===5){if(u===null){u=h;try{s=h.stateNode,d?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(l=h.stateNode,c=h.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=R1("display",o))}catch(k){en(t,t.return,k)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=d?"":h.memoizedProps}catch(k){en(t,t.return,k)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===t)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===t)break e;for(;h.sibling===null;){if(h.return===null||h.return===t)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:Ar(e,t),Vr(t),r&4&&ov(t);break;case 21:break;default:Ar(e,t),Vr(t)}}function Vr(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(tb(n)){var r=n;break e}n=n.return}throw Error(ue(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(Ol(s,""),r.flags&=-33);var i=iv(t);Np(t,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,l=iv(t);Dp(t,l,o);break;default:throw Error(ue(161))}}catch(c){en(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function r5(t,e,n){ke=t,sb(t)}function sb(t,e,n){for(var r=(t.mode&1)!==0;ke!==null;){var s=ke,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||ud;if(!o){var l=s.alternate,c=l!==null&&l.memoizedState!==null||On;l=ud;var d=On;if(ud=o,(On=c)&&!d)for(ke=s;ke!==null;)o=ke,c=o.child,o.tag===22&&o.memoizedState!==null?cv(s):c!==null?(c.return=o,ke=c):cv(s);for(;i!==null;)ke=i,sb(i),i=i.sibling;ke=s,ud=l,On=d}av(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,ke=i):av(t)}}function av(t){for(;ke!==null;){var e=ke;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:On||Zu(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!On)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:Pr(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&Gy(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Gy(e,o,n)}break;case 5:var l=e.stateNode;if(n===null&&e.flags&4){n=l;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var u=d.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&Nl(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ue(163))}On||e.flags&512&&Mp(e)}catch(f){en(e,e.return,f)}}if(e===t){ke=null;break}if(n=e.sibling,n!==null){n.return=e.return,ke=n;break}ke=e.return}}function lv(t){for(;ke!==null;){var e=ke;if(e===t){ke=null;break}var n=e.sibling;if(n!==null){n.return=e.return,ke=n;break}ke=e.return}}function cv(t){for(;ke!==null;){var e=ke;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Zu(4,e)}catch(c){en(e,n,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(c){en(e,s,c)}}var i=e.return;try{Mp(e)}catch(c){en(e,i,c)}break;case 5:var o=e.return;try{Mp(e)}catch(c){en(e,o,c)}}}catch(c){en(e,e.return,c)}if(e===t){ke=null;break}var l=e.sibling;if(l!==null){l.return=e.return,ke=l;break}ke=e.return}}var s5=Math.ceil,hu=Es.ReactCurrentDispatcher,i0=Es.ReactCurrentOwner,Sr=Es.ReactCurrentBatchConfig,_t=0,gn=null,sn=null,In=0,rr=0,Uo=vi(0),cn=0,Yl=null,Hi=0,ef=0,o0=0,vl=null,Yn=null,a0=0,aa=1/0,ss=null,pu=!1,$p=null,ti=null,fd=!1,Vs=null,gu=0,xl=0,jp=null,Od=-1,Ld=0;function Fn(){return _t&6?tn():Od!==-1?Od:Od=tn()}function ni(t){return t.mode&1?_t&2&&In!==0?In&-In:BI.transition!==null?(Ld===0&&(Ld=z1()),Ld):(t=Rt,t!==0||(t=window.event,t=t===void 0?16:X1(t.type)),t):1}function Fr(t,e,n,r){if(50<xl)throw xl=0,jp=null,Error(ue(185));dc(t,n,r),(!(_t&2)||t!==gn)&&(t===gn&&(!(_t&2)&&(ef|=n),cn===4&&Fs(t,In)),qn(t,r),n===1&&_t===0&&!(e.mode&1)&&(aa=tn()+500,Ju&&xi()))}function qn(t,e){var n=t.callbackNode;Bw(t,e);var r=qd(t,t===gn?In:0);if(r===0)n!==null&&vy(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&vy(n),e===1)t.tag===0?UI(dv.bind(null,t)):p_(dv.bind(null,t)),NI(function(){!(_t&6)&&xi()}),n=null;else{switch(H1(r)){case 1:n=Lg;break;case 4:n=U1;break;case 16:n=Qd;break;case 536870912:n=B1;break;default:n=Qd}n=fb(n,ib.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function ib(t,e){if(Od=-1,Ld=0,_t&6)throw Error(ue(327));var n=t.callbackNode;if(Ko()&&t.callbackNode!==n)return null;var r=qd(t,t===gn?In:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=mu(t,r);else{e=r;var s=_t;_t|=2;var i=ab();(gn!==t||In!==e)&&(ss=null,aa=tn()+500,ji(t,e));do try{a5();break}catch(l){ob(t,l)}while(!0);Vg(),hu.current=i,_t=s,sn!==null?e=0:(gn=null,In=0,e=cn)}if(e!==0){if(e===2&&(s=up(t),s!==0&&(r=s,e=Fp(t,s))),e===1)throw n=Yl,ji(t,0),Fs(t,r),qn(t,tn()),n;if(e===6)Fs(t,r);else{if(s=t.current.alternate,!(r&30)&&!i5(s)&&(e=mu(t,r),e===2&&(i=up(t),i!==0&&(r=i,e=Fp(t,i))),e===1))throw n=Yl,ji(t,0),Fs(t,r),qn(t,tn()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(ue(345));case 2:Ai(t,Yn,ss);break;case 3:if(Fs(t,r),(r&130023424)===r&&(e=a0+500-tn(),10<e)){if(qd(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){Fn(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=xp(Ai.bind(null,t,Yn,ss),e);break}Ai(t,Yn,ss);break;case 4:if(Fs(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var o=31-jr(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=tn()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*s5(r/1960))-r,10<r){t.timeoutHandle=xp(Ai.bind(null,t,Yn,ss),r);break}Ai(t,Yn,ss);break;case 5:Ai(t,Yn,ss);break;default:throw Error(ue(329))}}}return qn(t,tn()),t.callbackNode===n?ib.bind(null,t):null}function Fp(t,e){var n=vl;return t.current.memoizedState.isDehydrated&&(ji(t,e).flags|=256),t=mu(t,e),t!==2&&(e=Yn,Yn=n,e!==null&&Up(e)),t}function Up(t){Yn===null?Yn=t:Yn.push.apply(Yn,t)}function i5(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!Br(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Fs(t,e){for(e&=~o0,e&=~ef,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-jr(e),r=1<<n;t[n]=-1,e&=~r}}function dv(t){if(_t&6)throw Error(ue(327));Ko();var e=qd(t,0);if(!(e&1))return qn(t,tn()),null;var n=mu(t,e);if(t.tag!==0&&n===2){var r=up(t);r!==0&&(e=r,n=Fp(t,r))}if(n===1)throw n=Yl,ji(t,0),Fs(t,e),qn(t,tn()),n;if(n===6)throw Error(ue(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Ai(t,Yn,ss),qn(t,tn()),null}function l0(t,e){var n=_t;_t|=1;try{return t(e)}finally{_t=n,_t===0&&(aa=tn()+500,Ju&&xi())}}function Wi(t){Vs!==null&&Vs.tag===0&&!(_t&6)&&Ko();var e=_t;_t|=1;var n=Sr.transition,r=Rt;try{if(Sr.transition=null,Rt=1,t)return t()}finally{Rt=r,Sr.transition=n,_t=e,!(_t&6)&&xi()}}function c0(){rr=Uo.current,Ht(Uo)}function ji(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,DI(n)),sn!==null)for(n=sn.return;n!==null;){var r=n;switch(Hg(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&ru();break;case 3:ia(),Ht(Jn),Ht(Ln),qg();break;case 5:Qg(r);break;case 4:ia();break;case 13:Ht(Kt);break;case 19:Ht(Kt);break;case 10:Yg(r.type._context);break;case 22:case 23:c0()}n=n.return}if(gn=t,sn=t=ri(t.current,null),In=rr=e,cn=0,Yl=null,o0=ef=Hi=0,Yn=vl=null,Di!==null){for(e=0;e<Di.length;e++)if(n=Di[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}n.pending=r}Di=null}return t}function ob(t,e){do{var n=sn;try{if(Vg(),Rd.current=fu,uu){for(var r=Qt.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}uu=!1}if(zi=0,fn=an=Qt=null,ml=!1,Wl=0,i0.current=null,n===null||n.return===null){cn=1,Yl=e,sn=null;break}e:{var i=t,o=n.return,l=n,c=e;if(e=In,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,u=l,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var f=u.alternate;f?(u.updateQueue=f.updateQueue,u.memoizedState=f.memoizedState,u.lanes=f.lanes):(u.updateQueue=null,u.memoizedState=null)}var b=Qy(o);if(b!==null){b.flags&=-257,qy(b,o,l,i,e),b.mode&1&&Jy(i,d,e),e=b,c=d;var C=e.updateQueue;if(C===null){var k=new Set;k.add(c),e.updateQueue=k}else C.add(c);break e}else{if(!(e&1)){Jy(i,d,e),d0();break e}c=Error(ue(426))}}else if(Vt&&l.mode&1){var A=Qy(o);if(A!==null){!(A.flags&65536)&&(A.flags|=256),qy(A,o,l,i,e),Wg(oa(c,l));break e}}i=c=oa(c,l),cn!==4&&(cn=2),vl===null?vl=[i]:vl.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var R=H_(i,c,e);Wy(i,R);break e;case 1:l=c;var m=i.type,T=i.stateNode;if(!(i.flags&128)&&(typeof m.getDerivedStateFromError=="function"||T!==null&&typeof T.componentDidCatch=="function"&&(ti===null||!ti.has(T)))){i.flags|=65536,e&=-e,i.lanes|=e;var L=W_(i,l,e);Wy(i,L);break e}}i=i.return}while(i!==null)}cb(n)}catch(g){e=g,sn===n&&n!==null&&(sn=n=n.return);continue}break}while(!0)}function ab(){var t=hu.current;return hu.current=fu,t===null?fu:t}function d0(){(cn===0||cn===3||cn===2)&&(cn=4),gn===null||!(Hi&268435455)&&!(ef&268435455)||Fs(gn,In)}function mu(t,e){var n=_t;_t|=2;var r=ab();(gn!==t||In!==e)&&(ss=null,ji(t,e));do try{o5();break}catch(s){ob(t,s)}while(!0);if(Vg(),_t=n,hu.current=r,sn!==null)throw Error(ue(261));return gn=null,In=0,cn}function o5(){for(;sn!==null;)lb(sn)}function a5(){for(;sn!==null&&!Ow();)lb(sn)}function lb(t){var e=ub(t.alternate,t,rr);t.memoizedProps=t.pendingProps,e===null?cb(t):sn=e,i0.current=null}function cb(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=e5(n,e),n!==null){n.flags&=32767,sn=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{cn=6,sn=null;return}}else if(n=ZI(n,e,rr),n!==null){sn=n;return}if(e=e.sibling,e!==null){sn=e;return}sn=e=t}while(e!==null);cn===0&&(cn=5)}function Ai(t,e,n){var r=Rt,s=Sr.transition;try{Sr.transition=null,Rt=1,l5(t,e,n,r)}finally{Sr.transition=s,Rt=r}return null}function l5(t,e,n,r){do Ko();while(Vs!==null);if(_t&6)throw Error(ue(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(ue(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(zw(t,i),t===gn&&(sn=gn=null,In=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||fd||(fd=!0,fb(Qd,function(){return Ko(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=Sr.transition,Sr.transition=null;var o=Rt;Rt=1;var l=_t;_t|=4,i0.current=null,n5(t,n),rb(n,t),kI(yp),Zd=!!mp,yp=mp=null,t.current=n,r5(n),Lw(),_t=l,Rt=o,Sr.transition=i}else t.current=n;if(fd&&(fd=!1,Vs=t,gu=s),i=t.pendingLanes,i===0&&(ti=null),Nw(n.stateNode),qn(t,tn()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(pu)throw pu=!1,t=$p,$p=null,t;return gu&1&&t.tag!==0&&Ko(),i=t.pendingLanes,i&1?t===jp?xl++:(xl=0,jp=t):xl=0,xi(),null}function Ko(){if(Vs!==null){var t=H1(gu),e=Sr.transition,n=Rt;try{if(Sr.transition=null,Rt=16>t?16:t,Vs===null)var r=!1;else{if(t=Vs,Vs=null,gu=0,_t&6)throw Error(ue(331));var s=_t;for(_t|=4,ke=t.current;ke!==null;){var i=ke,o=i.child;if(ke.flags&16){var l=i.deletions;if(l!==null){for(var c=0;c<l.length;c++){var d=l[c];for(ke=d;ke!==null;){var u=ke;switch(u.tag){case 0:case 11:case 15:yl(8,u,i)}var h=u.child;if(h!==null)h.return=u,ke=h;else for(;ke!==null;){u=ke;var f=u.sibling,b=u.return;if(eb(u),u===d){ke=null;break}if(f!==null){f.return=b,ke=f;break}ke=b}}}var C=i.alternate;if(C!==null){var k=C.child;if(k!==null){C.child=null;do{var A=k.sibling;k.sibling=null,k=A}while(k!==null)}}ke=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,ke=o;else e:for(;ke!==null;){if(i=ke,i.flags&2048)switch(i.tag){case 0:case 11:case 15:yl(9,i,i.return)}var R=i.sibling;if(R!==null){R.return=i.return,ke=R;break e}ke=i.return}}var m=t.current;for(ke=m;ke!==null;){o=ke;var T=o.child;if(o.subtreeFlags&2064&&T!==null)T.return=o,ke=T;else e:for(o=m;ke!==null;){if(l=ke,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:Zu(9,l)}}catch(g){en(l,l.return,g)}if(l===o){ke=null;break e}var L=l.sibling;if(L!==null){L.return=l.return,ke=L;break e}ke=l.return}}if(_t=s,xi(),Xr&&typeof Xr.onPostCommitFiberRoot=="function")try{Xr.onPostCommitFiberRoot(Gu,t)}catch{}r=!0}return r}finally{Rt=n,Sr.transition=e}}return!1}function uv(t,e,n){e=oa(n,e),e=H_(t,e,1),t=ei(t,e,1),e=Fn(),t!==null&&(dc(t,1,e),qn(t,e))}function en(t,e,n){if(t.tag===3)uv(t,t,n);else for(;e!==null;){if(e.tag===3){uv(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(ti===null||!ti.has(r))){t=oa(n,t),t=W_(e,t,1),e=ei(e,t,1),t=Fn(),e!==null&&(dc(e,1,t),qn(e,t));break}}e=e.return}}function c5(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=Fn(),t.pingedLanes|=t.suspendedLanes&n,gn===t&&(In&n)===n&&(cn===4||cn===3&&(In&130023424)===In&&500>tn()-a0?ji(t,0):o0|=n),qn(t,e)}function db(t,e){e===0&&(t.mode&1?(e=nd,nd<<=1,!(nd&130023424)&&(nd=4194304)):e=1);var n=Fn();t=ys(t,e),t!==null&&(dc(t,e,n),qn(t,n))}function d5(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),db(t,n)}function u5(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(ue(314))}r!==null&&r.delete(e),db(t,n)}var ub;ub=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Jn.current)Kn=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Kn=!1,qI(t,e,n);Kn=!!(t.flags&131072)}else Kn=!1,Vt&&e.flags&1048576&&g_(e,ou,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Pd(t,e),t=e.pendingProps;var s=na(e,Ln.current);Yo(e,n),s=e0(null,e,r,t,s,n);var i=t0();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Qn(r)?(i=!0,su(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Xg(e),s.updater=qu,e.stateNode=s,s._reactInternals=e,Tp(e,r,t,n),e=Rp(null,e,r,!0,i,n)):(e.tag=0,Vt&&i&&zg(e),$n(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(Pd(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=h5(r),t=Pr(r,t),s){case 0:e=kp(null,e,r,t,n);break e;case 1:e=tv(null,e,r,t,n);break e;case 11:e=Zy(null,e,r,t,n);break e;case 14:e=ev(null,e,r,Pr(r.type,t),n);break e}throw Error(ue(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Pr(r,s),kp(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Pr(r,s),tv(t,e,r,s,n);case 3:e:{if(K_(e),t===null)throw Error(ue(387));r=e.pendingProps,i=e.memoizedState,s=i.element,b_(t,e),cu(e,r,null,n);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=oa(Error(ue(423)),e),e=nv(t,e,r,n,s);break e}else if(r!==s){s=oa(Error(ue(424)),e),e=nv(t,e,r,n,s);break e}else for(ar=Zs(e.stateNode.containerInfo.firstChild),lr=e,Vt=!0,Lr=null,n=x_(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(ra(),r===s){e=vs(t,e,n);break e}$n(t,e,r,n)}e=e.child}return e;case 5:return E_(e),t===null&&Sp(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,o=s.children,vp(r,s)?o=null:i!==null&&vp(r,i)&&(e.flags|=32),Y_(t,e),$n(t,e,o,n),e.child;case 6:return t===null&&Sp(e),null;case 13:return X_(t,e,n);case 4:return Jg(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=sa(e,null,r,n):$n(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Pr(r,s),Zy(t,e,r,s,n);case 7:return $n(t,e,e.pendingProps,n),e.child;case 8:return $n(t,e,e.pendingProps.children,n),e.child;case 12:return $n(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,Ut(au,r._currentValue),r._currentValue=o,i!==null)if(Br(i.value,o)){if(i.children===s.children&&!Jn.current){e=vs(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var l=i.dependencies;if(l!==null){o=i.child;for(var c=l.firstContext;c!==null;){if(c.context===r){if(i.tag===1){c=fs(-1,n&-n),c.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var u=d.pending;u===null?c.next=c:(c.next=u.next,u.next=c),d.pending=c}}i.lanes|=n,c=i.alternate,c!==null&&(c.lanes|=n),wp(i.return,n,e),l.lanes|=n;break}c=c.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(ue(341));o.lanes|=n,l=o.alternate,l!==null&&(l.lanes|=n),wp(o,n,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}$n(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,Yo(e,n),s=wr(s),r=r(s),e.flags|=1,$n(t,e,r,n),e.child;case 14:return r=e.type,s=Pr(r,e.pendingProps),s=Pr(r.type,s),ev(t,e,r,s,n);case 15:return G_(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Pr(r,s),Pd(t,e),e.tag=1,Qn(r)?(t=!0,su(e)):t=!1,Yo(e,n),z_(e,r,s),Tp(e,r,s,n),Rp(null,e,r,!0,t,n);case 19:return J_(t,e,n);case 22:return V_(t,e,n)}throw Error(ue(156,e.tag))};function fb(t,e){return F1(t,e)}function f5(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function br(t,e,n,r){return new f5(t,e,n,r)}function u0(t){return t=t.prototype,!(!t||!t.isReactComponent)}function h5(t){if(typeof t=="function")return u0(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Ag)return 11;if(t===Pg)return 14}return 2}function ri(t,e){var n=t.alternate;return n===null?(n=br(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Md(t,e,n,r,s,i){var o=2;if(r=t,typeof t=="function")u0(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Ao:return Fi(n.children,s,i,e);case Rg:o=8,s|=8;break;case Jh:return t=br(12,n,e,s|2),t.elementType=Jh,t.lanes=i,t;case Qh:return t=br(13,n,e,s),t.elementType=Qh,t.lanes=i,t;case qh:return t=br(19,n,e,s),t.elementType=qh,t.lanes=i,t;case E1:return tf(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case _1:o=10;break e;case b1:o=9;break e;case Ag:o=11;break e;case Pg:o=14;break e;case Ns:o=16,r=null;break e}throw Error(ue(130,t==null?t:typeof t,""))}return e=br(o,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function Fi(t,e,n,r){return t=br(7,t,r,e),t.lanes=n,t}function tf(t,e,n,r){return t=br(22,t,r,e),t.elementType=E1,t.lanes=n,t.stateNode={isHidden:!1},t}function kh(t,e,n){return t=br(6,t,null,e),t.lanes=n,t}function Rh(t,e,n){return e=br(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function p5(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ch(0),this.expirationTimes=ch(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ch(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function f0(t,e,n,r,s,i,o,l,c){return t=new p5(t,e,n,l,c),e===1?(e=1,i===!0&&(e|=8)):e=0,i=br(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Xg(i),t}function g5(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ro,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function hb(t){if(!t)return ui;t=t._reactInternals;e:{if(Zi(t)!==t||t.tag!==1)throw Error(ue(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Qn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ue(171))}if(t.tag===1){var n=t.type;if(Qn(n))return h_(t,n,e)}return e}function pb(t,e,n,r,s,i,o,l,c){return t=f0(n,r,!0,t,s,i,o,l,c),t.context=hb(null),n=t.current,r=Fn(),s=ni(n),i=fs(r,s),i.callback=e??null,ei(n,i,s),t.current.lanes=s,dc(t,s,r),qn(t,r),t}function nf(t,e,n,r){var s=e.current,i=Fn(),o=ni(s);return n=hb(n),e.context===null?e.context=n:e.pendingContext=n,e=fs(i,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=ei(s,e,o),t!==null&&(Fr(t,s,o,i),kd(t,s,o)),o}function yu(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function fv(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function h0(t,e){fv(t,e),(t=t.alternate)&&fv(t,e)}function m5(){return null}var gb=typeof reportError=="function"?reportError:function(t){console.error(t)};function p0(t){this._internalRoot=t}rf.prototype.render=p0.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(ue(409));nf(t,e,null,null)};rf.prototype.unmount=p0.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Wi(function(){nf(null,t,null,null)}),e[ms]=null}};function rf(t){this._internalRoot=t}rf.prototype.unstable_scheduleHydration=function(t){if(t){var e=V1();t={blockedOn:null,target:t,priority:e};for(var n=0;n<js.length&&e!==0&&e<js[n].priority;n++);js.splice(n,0,t),n===0&&K1(t)}};function g0(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function sf(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function hv(){}function y5(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var d=yu(o);i.call(d)}}var o=pb(e,r,t,0,null,!1,!1,"",hv);return t._reactRootContainer=o,t[ms]=o.current,Fl(t.nodeType===8?t.parentNode:t),Wi(),o}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var l=r;r=function(){var d=yu(c);l.call(d)}}var c=f0(t,0,!1,null,null,!1,!1,"",hv);return t._reactRootContainer=c,t[ms]=c.current,Fl(t.nodeType===8?t.parentNode:t),Wi(function(){nf(e,c,n,r)}),c}function of(t,e,n,r,s){var i=n._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var l=s;s=function(){var c=yu(o);l.call(c)}}nf(e,o,t,s)}else o=y5(n,e,t,s,r);return yu(o)}W1=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=ol(e.pendingLanes);n!==0&&(Mg(e,n|1),qn(e,tn()),!(_t&6)&&(aa=tn()+500,xi()))}break;case 13:Wi(function(){var r=ys(t,1);if(r!==null){var s=Fn();Fr(r,t,1,s)}}),h0(t,1)}};Dg=function(t){if(t.tag===13){var e=ys(t,134217728);if(e!==null){var n=Fn();Fr(e,t,134217728,n)}h0(t,134217728)}};G1=function(t){if(t.tag===13){var e=ni(t),n=ys(t,e);if(n!==null){var r=Fn();Fr(n,t,e,r)}h0(t,e)}};V1=function(){return Rt};Y1=function(t,e){var n=Rt;try{return Rt=t,e()}finally{Rt=n}};lp=function(t,e,n){switch(e){case"input":if(tp(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=Xu(r);if(!s)throw Error(ue(90));w1(r),tp(r,s)}}}break;case"textarea":T1(t,n);break;case"select":e=n.value,e!=null&&Ho(t,!!n.multiple,e,!1)}};L1=l0;M1=Wi;var v5={usingClientEntryPoint:!1,Events:[fc,Mo,Xu,P1,O1,l0]},Ja={findFiberByHostInstance:Mi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},x5={bundleType:Ja.bundleType,version:Ja.version,rendererPackageName:Ja.rendererPackageName,rendererConfig:Ja.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Es.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=$1(t),t===null?null:t.stateNode},findFiberByHostInstance:Ja.findFiberByHostInstance||m5,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var hd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!hd.isDisabled&&hd.supportsFiber)try{Gu=hd.inject(x5),Xr=hd}catch{}}ur.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=v5;ur.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!g0(e))throw Error(ue(200));return g5(t,e,null,n)};ur.createRoot=function(t,e){if(!g0(t))throw Error(ue(299));var n=!1,r="",s=gb;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=f0(t,1,!1,null,null,n,!1,r,s),t[ms]=e.current,Fl(t.nodeType===8?t.parentNode:t),new p0(e)};ur.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(ue(188)):(t=Object.keys(t).join(","),Error(ue(268,t)));return t=$1(e),t=t===null?null:t.stateNode,t};ur.flushSync=function(t){return Wi(t)};ur.hydrate=function(t,e,n){if(!sf(e))throw Error(ue(200));return of(null,t,e,!0,n)};ur.hydrateRoot=function(t,e,n){if(!g0(t))throw Error(ue(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",o=gb;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=pb(e,null,t,1,n??null,s,!1,i,o),t[ms]=e.current,Fl(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new rf(e)};ur.render=function(t,e,n){if(!sf(e))throw Error(ue(200));return of(null,t,e,!1,n)};ur.unmountComponentAtNode=function(t){if(!sf(t))throw Error(ue(40));return t._reactRootContainer?(Wi(function(){of(null,null,t,!1,function(){t._reactRootContainer=null,t[ms]=null})}),!0):!1};ur.unstable_batchedUpdates=l0;ur.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!sf(n))throw Error(ue(200));if(t==null||t._reactInternals===void 0)throw Error(ue(38));return of(t,e,n,!1,r)};ur.version="18.3.1-next-f1338f8080-20240426";function mb(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(mb)}catch(t){console.error(t)}}mb(),m1.exports=ur;var _5=m1.exports,pv=_5;Kh.createRoot=pv.createRoot,Kh.hydrateRoot=pv.hydrateRoot;const gv=20,m0=[{id:1,filename:"1_yoroshiku.png",label:"",se:"pa.mp3"},{id:2,filename:"2_nandato.png",label:"",se:"shock.mp3"},{id:3,filename:"3_thank.png",label:"",se:"thanks.mp3"},{id:4,filename:"4_willwin.png",label:"",se:"nt.mp3"},{id:5,filename:"5_dontmind.png",label:"",se:"boyon.mp3"},{id:6,filename:"6_thinking.png",label:"",se:"thinking.mp3"},{id:7,filename:"7_gg.png",label:"GG",se:"kiri.mp3"},{id:8,filename:"8_sorry.png",label:"",se:"gomen.mp3"}],mv=(t,e)=>{const n=m0.find(s=>s.id===t);return n?`/stamps/${e==="AJA"?"azya":e.toLowerCase()}/${n.filename}`:""},yv=t=>{const e=m0.find(n=>n.id===t);return(e==null?void 0:e.se)||null},Sn=[{id:"s_3cats",name:"",cost:2,type:"SPELL",description:"1",flavorText:"",imageUrl:"/cards/chatora_three_cats.png",relatedCards:["TOKEN_CHATORA","TOKEN_SABATORA","TOKEN_KIJITORA"],triggers:[{trigger:"FANFARE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_CHATORA"},{type:"GENERATE_CARD",targetCardId:"TOKEN_SABATORA"},{type:"GENERATE_CARD",targetCardId:"TOKEN_KIJITORA"}]}]},{id:"s_final_cannon",name:"",cost:10,type:"SPELL",description:"1",flavorText:'""""',imageUrl:"/cards/final_cannon.png",triggers:[{trigger:"FANFARE",effects:[{type:"SET_MAX_HP",value:1,targetType:"OPPONENT"}]}]},{id:"c_senka_knuckler",name:"",cost:8,type:"FOLLOWER",attack:3,health:5,description:`[] []
2
[]
1`,flavorText:`

`,imageUrl:"/cards/senka.png",evolvedImageUrl:"/cards/senka_2.png",tags:["Knuckler"],passiveAbilities:["STORM","DOUBLE_ATTACK"],attackEffectType:"IMPACT",triggers:[{trigger:"SUPER_EVOLVE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_FLICKER_JAB"},{type:"GENERATE_CARD",targetCardId:"TOKEN_QUAKE_HOWLING"},{type:"GENERATE_CARD",targetCardId:"TOKEN_BACKHAND_SMASH"}]}]},{id:"c_ruiyu",name:"",cost:7,type:"FOLLOWER",attack:5,health:5,description:`4cyoriena
14`,flavorText:`
`,imageUrl:"/cards/ruiyu.png",evolvedImageUrl:"/cards/ruiyu_2.png",attackEffectType:"BLUE_FIRE",relatedCards:["c_cyoriena"],triggers:[{trigger:"FANFARE",effects:[{type:"HEAL_LEADER",value:4,targetType:"SELF"},{type:"SUMMON_CARD",targetCardId:"c_cyoriena"}]},{trigger:"EVOLVE",effects:[{type:"DESTROY",targetType:"SELECT_FOLLOWER"},{type:"HEAL_LEADER",value:4,targetType:"SELF"}]}]},{id:"c_y",name:"Y",cost:6,type:"FOLLOWER",attack:3,health:3,description:`[]
142
3`,flavorText:"",imageUrl:"/cards/y.png",evolvedImageUrl:"/cards/y_2.png",passiveAbilities:["STEALTH"],attackEffectType:"SUMI",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:4,targetType:"SELECT_FOLLOWER"},{type:"AOE_DAMAGE",value:2,targetType:"ALL_FOLLOWERS"}]},{trigger:"EVOLVE",effects:[{type:"AOE_DAMAGE",value:3,targetType:"ALL_FOLLOWERS"}]}]},{id:"c_tsubumaru",name:"",cost:2,type:"FOLLOWER",attack:1,health:3,description:`[]
1
1`,flavorText:`

`,imageUrl:"/cards/tsubumaru.png",evolvedImageUrl:"/cards/tsubumaru_2.png",relatedCards:["s_resignation_proxy"],passiveAbilities:["WARD"],attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"GENERATE_CARD",targetCardId:"s_resignation_proxy"}]}]},{id:"c_barura",name:"",cost:4,type:"FOLLOWER",attack:3,health:4,description:`1
13`,flavorText:`

`,imageUrl:"/cards/barura.png",evolvedImageUrl:"/cards/barura_2.png",attackEffectType:"FIRE",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:3,targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_CHATORA",name:"",cost:0,type:"FOLLOWER",attack:1,health:1,description:"",flavorText:"",imageUrl:"/cards/chatora.png",attackEffectType:"SLASH"},{id:"TOKEN_SABATORA",name:"",cost:1,type:"FOLLOWER",attack:1,health:2,description:"[]",flavorText:"",passiveAbilities:["RUSH"],imageUrl:"/cards/sabatora.png",attackEffectType:"SLASH"},{id:"TOKEN_KIJITORA",name:"",cost:3,type:"FOLLOWER",attack:2,health:3,description:"[]",flavorText:"",passiveAbilities:["WARD"],imageUrl:"/cards/kijitora.png",attackEffectType:"SLASH"},{id:"TOKEN_RICE",name:"",cost:0,type:"SPELL",description:"1",flavorText:" ",imageUrl:"/cards/rice.png",triggers:[{trigger:"FANFARE",effects:[{type:"HEAL_LEADER",value:1,targetType:"SELF"}]}]},{id:"c_yunagi",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:`1
11`,flavorText:`


`,imageUrl:"/cards/yunagi.png",evolvedImageUrl:"/cards/yunagi_2.png",relatedCards:["TOKEN_OOMORI_RICE"],attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:1,targetType:"SELECT_FOLLOWER"},{type:"GENERATE_CARD",targetCardId:"TOKEN_OOMORI_RICE"}]}]},{id:"TOKEN_OOMORI_RICE",name:"",cost:1,type:"SPELL",description:"3",flavorText:"",imageUrl:"/cards/oomoririce.png",tags:["Token"],triggers:[{trigger:"FANFARE",effects:[{type:"HEAL_LEADER",value:3,targetType:"SELF"}]}]},{id:"c_nayuta",name:"",cost:4,type:"FOLLOWER",attack:3,health:3,description:`[]
1
1`,flavorText:"",imageUrl:"/cards/nayuta.png",evolvedImageUrl:"/cards/nayuta_2.png",attackEffectType:"RAY",passiveAbilities:["WARD"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]},{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]}]},{id:"c_yunagi_ward",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:`[]
1`,imageUrl:"/cards/yunagi.png",evolvedImageUrl:"/cards/yunagi_2.png",relatedCards:["TOKEN_RICE"],passiveAbilities:["WARD"],triggers:[{trigger:"FANFARE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_RICE"}]}]},{id:"c_nayuta_ward",name:"",cost:4,type:"FOLLOWER",attack:3,health:3,description:`[]
1
1`,imageUrl:"/cards/nayuta.png",evolvedImageUrl:"/cards/nayuta_2.png",passiveAbilities:["WARD"],attackEffectType:"RAY",triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]},{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]}]},{id:"c_azya",name:"",cost:8,type:"FOLLOWER",attack:4,health:4,description:`[]
3211-2
1+1/+2[][]0`,flavorText:`
&&`,imageUrl:"/cards/azya.png",evolvedImageUrl:"/cards/azya_2.png",attackEffectType:"THUNDER",passiveAbilities:["AURA"],relatedCards:["c_tsubumaru","c_yunagi","c_nayuta","s_yucho_of_the_abyss","s_thats_mine"],triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:3,targetType:"OPPONENT"},{type:"HEAL_LEADER",value:2,targetType:"SELF"},{type:"RANDOM_DESTROY",value:1},{type:"RANDOM_BOUNCE",value:1},{type:"REDUCE_HAND_COST",value:2,conditions:{nameIn:["","",""]}}]},{trigger:"SUPER_EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_tsubumaru"},{type:"SUMMON_CARD",targetCardId:"c_yunagi"},{type:"SUMMON_CARD",targetCardId:"c_nayuta"},{type:"BUFF_STATS",value:1,value2:2,targetType:"ALL_OTHER_FOLLOWERS"},{type:"GRANT_PASSIVE",targetPassive:"WARD",targetType:"ALL_OTHER_FOLLOWERS"},{type:"GRANT_PASSIVE",targetPassive:"RUSH",targetType:"ALL_OTHER_FOLLOWERS"},{type:"GENERATE_CARD",targetCardId:"s_yucho_of_the_abyss"},{type:"GENERATE_CARD",targetCardId:"s_thats_mine"},{type:"GRANT_LEADER_DAMAGE_SHIELD"}]}]},{id:"c_yuki",name:"",cost:3,type:"FOLLOWER",attack:3,health:2,description:`[]
+1/+1`,flavorText:"",imageUrl:"/cards/yuki.png",evolvedImageUrl:"/cards/yuki_2.png",tags:["Knuckler"],passiveAbilities:["RUSH"],attackEffectType:"IMPACT",triggers:[{trigger:"EVOLVE",effects:[{type:"BUFF_STATS",value:1,value2:1,targetType:"ALL_FOLLOWERS"}]}]},{id:"c_white_tsubaki",name:"",cost:4,type:"FOLLOWER",attack:4,health:3,description:`[]

01
1`,flavorText:`
`,imageUrl:"/cards/white_tsubaki.png",evolvedImageUrl:"/cards/white_tsubaki_2.png",tags:["Knuckler"],passiveAbilities:["RUSH","IMMUNE_TO_FOLLOWER_DAMAGE","GUTS_MY_TURN"],attackEffectType:"ICE",relatedCards:["c_shieko"],triggers:[{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_shieko"}]}]},{id:"c_shieko",name:"",cost:2,type:"FOLLOWER",attack:2,health:1,description:`[]
1+2/+2`,flavorText:`
`,imageUrl:"/cards/shieko.png",evolvedImageUrl:"/cards/shieko_2.png",tags:["Knuckler"],passiveAbilities:["RUSH"],attackEffectType:"IMPACT",triggers:[{trigger:"EVOLVE",effects:[{type:"BUFF_STATS",value:2,value2:2,targetType:"SELECT_OTHER_ALLY_FOLLOWER"}]}]},{id:"c_urara",name:"",cost:3,type:"FOLLOWER",attack:2,health:2,description:`[] []
2`,flavorText:`
`,imageUrl:"/cards/urara.png",evolvedImageUrl:"/cards/urara_2.png",passiveAbilities:["WARD","BARRIER"],attackEffectType:"WATER",triggers:[{trigger:"EVOLVE",effects:[{type:"HEAL_LEADER",value:2}]}]},{id:"c_kasuga",name:"",cost:10,type:"FOLLOWER",attack:8,health:8,description:"",flavorText:`

`,imageUrl:"/cards/kasuga.png",evolvedImageUrl:"/cards/kasuga_2.png",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY",targetType:"ALL_OTHER_FOLLOWERS"}]}],attackEffectType:"SLASH"},{id:"c_kyokune",name:"",cost:4,type:"FOLLOWER",attack:4,health:4,description:"1",imageUrl:"/cards/kyokune.jpg",relatedCards:["c_sia"],triggers:[{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_sia"}]}],attackEffectType:"SLASH"},{id:"c_sia",name:"",cost:2,type:"FOLLOWER",attack:2,health:1,description:"21",flavorText:"",imageUrl:"/cards/sia.png",evolvedImageUrl:"/cards/sia_2.png",attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DAMAGE",value:1,value2:2,targetType:"OPPONENT"}]}]},{id:"TOKEN_BACKHAND_SMASH",name:"",cost:0,type:"SPELL",description:"16",flavorText:`10
`,imageUrl:"/cards/BackhandSmash.jpg",tags:["Token"],attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:6,targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_QUAKE_HOWLING",name:"",cost:0,type:"SPELL",description:"2",flavorText:"",imageUrl:"/cards/QuakeHowling.png",tags:["Token"],attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"AOE_DAMAGE",value:2,targetType:"ALL_FOLLOWERS"}]}]},{id:"TOKEN_FLICKER_JAB",name:"",cost:0,type:"SPELL",description:"12",flavorText:`
BHS
`,imageUrl:"/cards/FlickerJab.png",tags:["Token"],attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:2,targetType:"SELECT_FOLLOWER"}]}]},{id:"c_bucchi",name:"",cost:5,type:"FOLLOWER",attack:1,health:3,description:"3",flavorText:`
`,imageUrl:"/cards/bucchi.png",evolvedImageUrl:"/cards/bucchi_2.png",attackEffectType:"SLASH",relatedCards:["c_manary"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_manary"},{type:"SUMMON_CARD",targetCardId:"c_manary"},{type:"SUMMON_CARD",targetCardId:"c_manary"}]}]},{id:"c_valkyrie",name:"",cost:6,type:"FOLLOWER",attack:6,health:6,description:`[] [] []
[]`,flavorText:"",imageUrl:"/cards/valkyrie.png",evolvedImageUrl:"/cards/valkyrie_2.png",passiveAbilities:["WARD","BARRIER","AURA"],attackEffectType:"RAY",triggers:[{trigger:"END_OF_TURN",effects:[{type:"GRANT_PASSIVE",targetPassive:"BARRIER",targetType:"SELF"}]}]},{id:"c_manary",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:"[]",flavorText:"^^",imageUrl:"/cards/manary.png",evolvedImageUrl:"/cards/manary_2.png",tags:["Token"],passiveAbilities:["WARD"],attackEffectType:"WATER"},{id:"c_potechi",name:"",cost:3,type:"FOLLOWER",attack:2,health:3,description:`[]
1`,flavorText:"",imageUrl:"/cards/potechi.png",evolvedImageUrl:"/cards/potechi_2.png",passiveAbilities:["WARD"],attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]}]},{id:"c_mono",name:"Mono",cost:3,type:"FOLLOWER",attack:2,health:1,description:`15
15`,flavorText:"",imageUrl:"/cards/Mono.png",evolvedImageUrl:"/cards/Mono_2.png",attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:5,targetType:"SELECT_FOLLOWER"}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:5,targetType:"SELECT_FOLLOWER"}]}]},{id:"c_sara",name:"sara",cost:7,type:"FOLLOWER",attack:4,health:6,description:`2111
1`,flavorText:"w",imageUrl:"/cards/sara.png",evolvedImageUrl:"/cards/sara_2.png",relatedCards:["TOKEN_SORRY_THE_END"],attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DESTROY",value:2,targetType:"OPPONENT"},{type:"GENERATE_CARD",targetCardId:"TOKEN_SORRY_THE_END",conditions:{minTurn:11}}]},{trigger:"SUPER_EVOLVE",effects:[{type:"DESTROY",targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_SORRY_THE_END",name:"",cost:3,type:"SPELL",description:"553sara1",flavorText:'""',imageUrl:"/cards/sorryTheEnd.png",tags:["Token"],attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"AOE_DAMAGE",value:5,targetType:"ALL_FOLLOWERS"},{type:"DAMAGE",value:5,targetType:"OPPONENT"},{type:"DRAW",value:3},{type:"SUMMON_CARD",targetCardId:"c_sara"}]}]},{id:"c_blue_tsubaki",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:`1
1`,flavorText:"",imageUrl:"/cards/blue_tsubaki.png",evolvedImageUrl:"/cards/blue_tsubaki_2.png",attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"RANDOM_DESTROY",value:1,targetType:"OPPONENT"}]}]},{id:"s_resignation_proxy",name:"",cost:0,type:"SPELL",description:"11",flavorText:"1",imageUrl:"/cards/taisyokudaiko.png",tags:["Token"],attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DESTROY",targetType:"OPPONENT",value:1},{type:"DRAW",value:1}]}]},{id:"s_yucho_of_the_abyss",name:"",cost:0,type:"SPELL",description:"11",flavorText:"",imageUrl:"/cards/yuchooftheabyss.png",tags:["Token"],attackEffectType:"THUNDER",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DAMAGE_BY_TURN",value:1,targetType:"OPPONENT"}]}]},{id:"s_thats_mine",name:"",cost:2,type:"SPELL",description:"1",flavorText:"",imageUrl:"/cards/thatsmine.png",tags:["Token"],attackEffectType:"ICE",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY_AND_GENERATE",value:0,targetType:"SELECT_FOLLOWER"}]}]},{id:"s_tenfubu_yabe_hutari",name:"2",cost:4,type:"SPELL",description:"11",flavorText:"",imageUrl:"/cards/tenfubuyabehutari.png",relatedCards:["c_yuki","c_potechi"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_yuki"},{type:"SUMMON_CARD",targetCardId:"c_potechi"}]}]},{id:"s_samurai_tea",name:"",cost:2,type:"SPELL",description:"1+1/+1",flavorText:'""""',imageUrl:"/cards/samuraitea.png",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1},{type:"BUFF_STATS",value:1,value2:1,targetType:"ALL_FOLLOWERS"}]}]},{id:"s_crazy_knucklers",name:"",cost:5,type:"SPELL",description:"+1/+11",flavorText:`
www www`,imageUrl:"/cards/crazy_knucklers.png",relatedCards:["c_white_tsubaki","c_shieko"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD_BUFFED",targetCardId:"c_white_tsubaki",value:1,value2:1},{type:"SUMMON_CARD_BUFFED",targetCardId:"c_shieko",value:1,value2:1},{type:"DRAW",value:1}]}]},{id:"s_knuckle_four",name:"",cost:10,type:"SPELL",description:"444",flavorText:"",imageUrl:"/cards/knucklefour.png",attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DESTROY",value:4,targetType:"OPPONENT"},{type:"DRAW",value:4},{type:"HEAL_LEADER",value:4,targetType:"SELF"}]}]},{id:"c_amandava",name:"amandava",cost:5,attack:2,health:3,type:"FOLLOWER",description:`21
1`,flavorText:"",imageUrl:"/cards/amandava.png",evolvedImageUrl:"/cards/amandava_2.png",attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_SET_HP",value:2,value2:1,targetType:"OPPONENT"}]},{trigger:"EVOLVE",effects:[{type:"AOE_DAMAGE",value:1,targetType:"ALL_FOLLOWERS"}]}]},{id:"c_alice",name:"",cost:3,attack:1,health:1,type:"FOLLOWER",description:`22
22`,flavorText:"",imageUrl:"/cards/alice.png",evolvedImageUrl:"/cards/alice_2.png",attackEffectType:"FIRE",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DAMAGE",value:2,value2:2,targetType:"OPPONENT"}]},{trigger:"EVOLVE",effects:[{type:"RANDOM_DAMAGE",value:2,value2:2,targetType:"OPPONENT"}]}]},{id:"c_yuri",name:"",cost:5,type:"FOLLOWER",attack:3,health:3,description:`1
13`,flavorText:`
`,imageUrl:"/cards/yuri.png",evolvedImageUrl:"/cards/yuri_2.png",attackEffectType:"WATER",relatedCards:["TOKEN_SUIHYORYU"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"TOKEN_SUIHYORYU"}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:3,targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_SUIHYORYU",name:"",cost:5,type:"FOLLOWER",attack:4,health:4,description:`[] []
`,flavorText:"",imageUrl:"/cards/suihyoryu.png",evolvedImageUrl:"/cards/suihyoryu.png",tags:["Token"],passiveAbilities:["RUSH","WARD"],attackEffectType:"ICE",triggers:[{trigger:"START_OF_TURN",effects:[{type:"DESTROY_SELF"}]}]},{id:"c_cyoriena",name:"cyoriena",cost:2,type:"FOLLOWER",attack:1,health:2,description:`[] []
HP2
`,flavorText:"7",imageUrl:"/cards/cyoriena.png",evolvedImageUrl:"/cards/cyoriena_2.png",relatedCards:["TOKEN_TSUBASA"],tags:["Token"],passiveAbilities:["WARD","BARRIER"],attackEffectType:"RAY",triggers:[{trigger:"END_OF_TURN",effects:[{type:"HEAL_LEADER",value:2,targetType:"SELF"}]},{trigger:"EVOLVE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_TSUBASA"}]}]},{id:"TOKEN_TSUBASA",name:"",cost:1,type:"SPELL",description:"1[]",flavorText:"",imageUrl:"/cards/tsubasa.png",tags:["Token"],triggers:[{trigger:"FANFARE",effects:[{type:"GRANT_PASSIVE",targetPassive:"STORM",targetType:"SELECT_ALLY_FOLLOWER"}]}]},{id:"c_yamato",name:"",cost:5,type:"FOLLOWER",attack:5,health:1,description:"[]",imageUrl:"/cards/yamato.jpg",passiveAbilities:["STORM"],attackEffectType:"SLASH"},{id:"c_yoruka",name:"yoRuka",cost:8,type:"FOLLOWER",attack:5,health:5,description:`1
 8yoRuka1
2`,flavorText:"Y",imageUrl:"/cards/yoRuka.png",evolvedImageUrl:"/cards/yoRuka_2.png",attackEffectType:"SUMI",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY",targetType:"SELECT_FOLLOWER"}]},{trigger:"LAST_WORD",effects:[{type:"SUMMON_CARD",targetCardId:"c_yoruka",necromance:8}]},{trigger:"SUPER_EVOLVE",effects:[{type:"RANDOM_DESTROY",value:2,targetType:"OPPONENT"}]}]},{id:"c_haruka",name:"",cost:7,type:"FOLLOWER",attack:2,health:3,description:`[]
[]1
4
1 4+2/+0`,flavorText:"",imageUrl:"/cards/haruka.png",evolvedImageUrl:"/cards/haruka_2.png",passiveAbilities:["STEALTH"],attackEffectType:"SLASH",relatedCards:["c_yuka","c_setsuna"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD_RUSH",targetCardId:"c_yuka"},{type:"SUMMON_CARD",targetCardId:"c_setsuna"}]},{trigger:"LAST_WORD",effects:[{type:"ADD_GRAVEYARD",value:4}]},{trigger:"SUPER_EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_setsuna"},{type:"BUFF_STATS",value:2,value2:0,targetType:"ALL_OTHER_FOLLOWERS",necromance:4}]}]},{id:"c_setsuna",name:"",cost:3,type:"FOLLOWER",attack:1,health:1,description:`[] []
-12`,flavorText:"",imageUrl:"/cards/setsuna.png",evolvedImageUrl:"/cards/setsuna_2.png",passiveAbilities:["STORM","BANE"],attackEffectType:"SUMI",triggers:[{trigger:"LAST_WORD",effects:[{type:"BUFF_STATS",value:-1,value2:0,targetType:"RANDOM_FOLLOWER"},{type:"ADD_GRAVEYARD",value:2}]}]},{id:"c_yuka",name:"",cost:5,type:"FOLLOWER",attack:1,health:6,description:`[] []
1
3
132`,flavorText:"",imageUrl:"/cards/yuka.png",evolvedImageUrl:"/cards/yuka_2.png",passiveAbilities:["WARD","AURA"],attackEffectType:"SHOT",relatedCards:["c_setsuna"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_setsuna"}]},{trigger:"LAST_WORD",effects:[{type:"ADD_GRAVEYARD",value:3}]},{trigger:"EVOLVE",effects:[{type:"RANDOM_DAMAGE",value:3,value2:1,targetType:"OPPONENT"},{type:"RANDOM_DAMAGE",value:3,value2:1,targetType:"OPPONENT"}]}]},{id:"s_hayakikoto",name:"",cost:4,type:"SPELL",description:"21",flavorText:"",imageUrl:"/cards/hayakikoto.png",relatedCards:["c_setsuna"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_setsuna"},{type:"SUMMON_CARD",targetCardId:"c_setsuna"},{type:"DRAW",value:1}]}]},{id:"s_keishou",name:"",cost:9,type:"SPELL",description:"1-9",flavorText:`
`,imageUrl:"/cards/keisyopower.png",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY_AND_GENERATE",targetType:"RANDOM_ENEMY_FOLLOWER",value:-9}]}]},{id:"s_night_parade",name:"",cost:10,type:"SPELL",description:` 41
+1/+0`,flavorText:"",imageUrl:"/cards/nightparade.png",relatedCards:["c_setsuna"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD_FILL_BOARD",targetCardId:"c_setsuna",necromance:4},{type:"BUFF_STATS",value:1,value2:0,targetType:"ALL_FOLLOWERS"}]}]}];function y0(t){let e=t;return()=>(e=(e*1664525+1013904223)%4294967296,e/4294967296)}function b5(t,e){let n=t.length,r;for(;n!=0;)r=Math.floor(e()*n),n--,[t[n],t[r]]=[t[r],t[n]];return t}function E5(t){var s;const e=t.players.p1,n=t.players.p2;return[t.turnCount,t.activePlayerId,e.hp,e.maxHp,e.pp,e.maxPp,e.sep,e.evolutionsUsed,n.hp,n.maxHp,n.pp,n.maxPp,n.sep,n.evolutionsUsed,e.board.map(i=>i?`${i.id}_${i.instanceId}_${i.currentHealth}_${i.hasBarrier?"B":""}`:"null").join(","),n.board.map(i=>i?`${i.id}_${i.instanceId}_${i.currentHealth}_${i.hasBarrier?"B":""}`:"null").join(","),e.hand.length,n.hand.length,((s=t.pendingEffects)==null?void 0:s.length)||0,t.rngSeed].join("|")}const v0=[{cardId:"c_senka_knuckler",count:3},{cardId:"c_yuki",count:3},{cardId:"c_white_tsubaki",count:3},{cardId:"c_shieko",count:3},{cardId:"s_samurai_tea",count:3},{cardId:"c_bucchi",count:2},{cardId:"c_valkyrie",count:1},{cardId:"c_potechi",count:3},{cardId:"s_tenfubu_yabe_hutari",count:3},{cardId:"s_crazy_knucklers",count:2},{cardId:"c_sia",count:2},{cardId:"c_mono",count:3},{cardId:"c_ruiyu",count:1},{cardId:"c_kasuga",count:1},{cardId:"c_y",count:2},{cardId:"c_sara",count:1},{cardId:"s_knuckle_four",count:1},{cardId:"c_blue_tsubaki",count:3}],x0=[{cardId:"c_azya",count:3},{cardId:"c_ruiyu",count:2},{cardId:"c_y",count:2},{cardId:"c_sara",count:2},{cardId:"c_urara",count:3},{cardId:"c_yunagi",count:3},{cardId:"c_tsubumaru",count:3},{cardId:"c_nayuta",count:3},{cardId:"c_yuri",count:2},{cardId:"c_alice",count:3},{cardId:"c_kasuga",count:1},{cardId:"c_barura",count:3},{cardId:"c_valkyrie",count:3},{cardId:"s_3cats",count:2},{cardId:"s_final_cannon",count:1},{cardId:"c_amandava",count:2},{cardId:"c_mono",count:2}],_0=[{cardId:"c_yoruka",count:3},{cardId:"c_y",count:3},{cardId:"c_haruka",count:3},{cardId:"c_yuka",count:3},{cardId:"c_setsuna",count:3},{cardId:"s_hayakikoto",count:3},{cardId:"s_night_parade",count:1},{cardId:"c_kasuga",count:1},{cardId:"c_blue_tsubaki",count:3},{cardId:"c_tsubumaru",count:3},{cardId:"c_nayuta",count:3},{cardId:"c_mono",count:2},{cardId:"c_ruiyu",count:1},{cardId:"c_sara",count:1},{cardId:"s_3cats",count:3},{cardId:"c_bucchi",count:2},{cardId:"c_alice",count:2}];function os(t){const e=Sn.find(n=>n.id===t);return e||Sn.find(n=>n.name===t)}function yb(){return Sn.map(t=>t.name).sort((t,e)=>e.length-t.length)}function pd(t){return{STORM:"",RUSH:"",WARD:"",BARRIER:"",AURA:"",STEALTH:"",BANE:"",DOUBLE_ATTACK:"",IMMUNE_TO_FOLLOWER_DAMAGE:"",GUTS_MY_TURN:""}[t]||t}function S5(t,e){const n=[];let r=0;return t.forEach(s=>{const i=os(s.cardId);if(i)for(let o=0;o<s.count;o++)n.push({...i,id:`${e}_c${r}`,instanceId:`inst_${e}_c${r}`}),r++;else console.warn(`Card definition not found: ${s.cardId}`)}),n}function vv(t,e,n,r){const i=S5(n==="SENKA"?v0:n==="AJA"?x0:_0,t);return{id:t,name:e,class:n,hp:gv,maxHp:gv,pp:0,maxPp:0,sep:2,deck:b5(i,r),hand:[],graveyard:[],board:[],evolutionsUsed:0,canEvolveThisTurn:!1,extraPpUsedEarly:!1,extraPpUsedLate:!1,extraPpActive:!1}}function Dd(t,e,n,r,s,i=!0){const o=Math.floor(Math.random()*1e6),l=y0(o),c=vv("p1",t,e,l),d=vv("p2",n,r,l);c.hand=c.deck.splice(0,4),d.hand=d.deck.splice(0,4);let u,h;return i?(u="p1",h=t,c.maxPp=1,c.pp=1,d.maxPp=0,d.pp=0):(u="p2",h=n,c.maxPp=0,c.pp=0,d.maxPp=1,d.pp=1),{phase:"INIT",rngSeed:Math.floor(l()*1e6),activePlayerId:u,firstPlayerId:u,players:{p1:c,p2:d},turnCount:1,pendingEffects:[],logs:[` 1 - ${h} `],winnerId:void 0}}function Bp(t){return t==="p1"?"p2":"p1"}function w5(t,e,n,r,s,i){var h,f,b,C,k,A,R,m,T,L,g,H,Q,W,G,de,fe,Ee,ae,he,be;let o={...t,players:{p1:{...t.players.p1,hand:[...t.players.p1.hand],deck:[...t.players.p1.deck],board:t.players.p1.board.map(v=>v?{...v,passiveAbilities:v.passiveAbilities?[...v.passiveAbilities]:[]}:null),graveyard:[...t.players.p1.graveyard]},p2:{...t.players.p2,hand:[...t.players.p2.hand],deck:[...t.players.p2.deck],board:t.players.p2.board.map(v=>v?{...v,passiveAbilities:v.passiveAbilities?[...v.passiveAbilities]:[]}:null),graveyard:[...t.players.p2.graveyard]}},logs:[...t.logs||[]]};const l=y0(o.rngSeed||999);o.rngSeed=Math.floor(l()*1e6);const c=Bp(e),d=v=>{for(const _ of["p1","p2"]){const x=o.players[_].board.findIndex(I=>(I==null?void 0:I.instanceId)===v);if(x!==-1&&o.players[_].board[x])return{card:o.players[_].board[x],player:o.players[_],index:x}}return null};if(r.necromance!==void 0&&r.necromance>0&&r.type!=="SUMMON_CARD_FILL_BOARD"){const v=o.players[e];if(v.graveyard.length<r.necromance)return console.log(`[Engine] : ${v.graveyard.length} < ${r.necromance}`),o;const _=v.graveyard.splice(-r.necromance,r.necromance);o.logs.push(`${v.name}  ${r.necromance} `),console.log(`[Engine] : ${_.map(x=>x.name).join(", ")} `)}const u=(v,_)=>{var I;const x=(I=v.triggers)==null?void 0:I.find(y=>y.trigger==="LAST_WORD");if(x){const y=x.effects.map(O=>({sourceCard:v,effect:O,sourcePlayerId:_}));o.pendingEffects=[...o.pendingEffects||[],...y],o.logs.push(`${v.name} `),console.log(`[Engine] processSingleEffect: Last Word triggered for ${v.name}. pendingEffects count: ${o.pendingEffects.length}`)}};switch(r.type){case"DAMAGE":{const v=r.value||0;if(r.targetType==="SELECT_FOLLOWER"&&s){const _=d(s);if(_){const{card:x,player:I,index:y}=_;if(x.hasBarrier)x.hasBarrier=!1,o.logs.push(`${x.name} `);else if(x.currentHealth-=v,o.logs.push(`${n.name}  ${x.name}  ${v} `),x.currentHealth<=0){x.currentHealth=Math.min(0,x.currentHealth);const O=Object.keys(o.players).find(N=>o.players[N]===I)||c;u(x,O),I.graveyard.push(x),I.board[y]=null,o.logs.push(`${x.name} `)}}}else if(r.targetType==="OPPONENT"){const _=o.players[c];if(_.leaderDamageShield)_.leaderDamageShield=!1,o.logs.push(`${n.name}  ${v} `);else{const x=_.board.some(y=>{var O;return(O=y==null?void 0:y.passiveAbilities)==null?void 0:O.includes("LEADER_DAMAGE_CAP")}),I=x?Math.min(v,1):v;_.hp-=I,x&&v>1?o.logs.push(`${n.name}  ${v} 1`):o.logs.push(`${n.name}  ${I} `),_.hp<=0&&(o.winnerId=e,o.logs.push(`${_.name} `))}}break}case"AOE_DAMAGE":{const v=r.value||0;if(r.targetType==="ALL_FOLLOWERS"){const _=o.players[c].board,x=i&&i.length>0?new Set(i):null;_.forEach(y=>{if(y){if(x&&!x.has(y.instanceId))return;y.hasBarrier?(y.hasBarrier=!1,o.logs.push(`${y.name} `)):y.currentHealth-=v}}),_.filter(y=>y&&y.currentHealth<=0).forEach(y=>{y&&(y.currentHealth=Math.min(0,y.currentHealth),u(y,c),o.players[c].graveyard.push(y),o.logs.push(`${y.name} `))}),o.logs.push(`${n.name}  ${v} `),_.forEach((y,O)=>{y&&y.currentHealth<=0&&(_[O]=null)})}break}case"DRAW":{const v=r.value||1,_=o.players[e];for(let x=0;x<v;x++)if(_.deck.length>0){const I=_.deck.pop();I&&(_.hand.length<9?_.hand.push(I):(_.graveyard.push(I),o.logs.push(`${_.name}${I.name}`)))}o.logs.push(`${_.name}  ${v} `);break}case"ADD_GRAVEYARD":{const v=r.value||1,_=o.players[e];for(let x=0;x<v;x++){const I={...n,instanceId:`grave_${o.rngSeed}_${Math.floor(l()*1e3)}_${x}`};_.graveyard.push(I)}o.logs.push(`${_.name}  ${v} `);break}case"HEAL_LEADER":{const v=r.value||0,_=o.players[e];_.hp=Math.min(_.maxHp,_.hp+v),o.logs.push(`${_.name}  ${v} HP`);break}case"DESTROY":{const v=(_,x)=>{var I;return((I=_.passiveAbilities)==null?void 0:I.includes("IMMUNE_TO_DAMAGE_MY_TURN"))===!0&&o.activePlayerId===x};if(r.targetType==="ALL_OTHER_FOLLOWERS"){const _=o.players[c].board,x=[];_.forEach(N=>{N&&(v(N,c)?(x.push(N),o.logs.push(`${N.name} `)):(u(N,c),o.players[c].graveyard.push(N)))}),o.players[c].board=x;const I=o.players[e].board,y=[],O=n.instanceId;I.forEach(N=>{N&&(O&&N.instanceId===O?y.push(N):v(N,e)?(y.push(N),o.logs.push(`${N.name} `)):(u(N,e),o.players[e].graveyard.push(N)))}),o.players[e].board=y,o.logs.push(`${n.name} `)}else if((r.targetType==="SELECT_FOLLOWER"||r.targetType==="SELECT_ALLY_FOLLOWER")&&s){const _=d(s);if(_){const{card:x,player:I,index:y}=_,O=Object.keys(o.players).find(N=>o.players[N].board.includes(x))||"";v(x,O)?o.logs.push(`${x.name} `):(x.currentHealth=1,u(x,O),I.graveyard.push(x),I.board[y]=null,o.logs.push(`${x.name}  ${n.name} `))}}break}case"GENERATE_CARD":{if((h=r.conditions)!=null&&h.minTurn&&t.turnCount<r.conditions.minTurn)break;const v=r.targetCardId,_=Sn.find(x=>x.id===v);if(_){const x=o.players[e],I=`gen_${o.rngSeed}_${Date.now()}_${Math.floor(l()*1e4)}`,y={..._,id:`token_${o.rngSeed}_${Math.floor(l()*1e3)}`,instanceId:I};x.hand.length<9?(x.hand.push(y),o.logs.push(`${x.name}  ${_.name} `)):(x.graveyard.push(y),o.logs.push(`${x.name}${_.name}`))}break}case"REDUCE_HAND_COST":{const v=r.value||0,_=((f=r.conditions)==null?void 0:f.nameIn)||[],x=o.players[e];let I=0;x.hand.forEach(y=>{if(_.includes(y.name)){const O=y.cost,N=Math.max(0,O-v);N!==O&&(y.cost=N,y.baseCost=N,I++)}}),I>0&&o.logs.push(`${n.name} -${v}`);break}case"GRANT_LEADER_DAMAGE_SHIELD":{const v=o.players[e];v.leaderDamageShield=!0,o.logs.push(`${v.name} 0`);break}case"RANDOM_DESTROY":{const v=(y,O)=>{var N;return((N=y.passiveAbilities)==null?void 0:N.includes("IMMUNE_TO_DAMAGE_MY_TURN"))===!0&&o.activePlayerId===O},_=r.value||1,x=r.targetType==="SELF"?e:c,I=o.players[x].board;if(i&&i.length>0)i.forEach(y=>{const O=I.findIndex(N=>(N==null?void 0:N.instanceId)===y);if(O!==-1&&I[O]){const N=I[O];v(N,x)?o.logs.push(`${N.name} `):(N.currentHealth=1,u(N,x),o.players[x].graveyard.push(N),I[O]=null,o.logs.push(`${N.name}  ${n.name} `))}});else{const y=I.map((N,ne)=>!N||v(N,x)?-1:ne).filter(N=>N!==-1);for(let N=y.length-1;N>0;N--){const ne=Math.floor(l()*(N+1));[y[N],y[ne]]=[y[ne],y[N]]}y.slice(0,_).forEach(N=>{const ne=I[N];ne&&(ne.currentHealth=1,u(ne,x),o.players[x].graveyard.push(ne),I[N]=null,o.logs.push(`${ne.name}  ${n.name} `))})}break}case"RANDOM_SET_HP":{const v=r.value||1,_=r.value2||1,x=r.targetType==="SELF"?e:c,I=o.players[x].board;if(i&&i.length>0)i.forEach(y=>{const O=I.findIndex(N=>(N==null?void 0:N.instanceId)===y);O!==-1&&I[O]&&(I[O].currentHealth=_,o.logs.push(`${I[O].name} HP ${_} `))});else{const y=I.map((N,ne)=>N?ne:-1).filter(N=>N!==-1);for(let N=y.length-1;N>0;N--){const ne=Math.floor(l()*(N+1));[y[N],y[ne]]=[y[ne],y[N]]}y.slice(0,v).forEach(N=>{const ne=I[N];ne&&(ne.currentHealth=_,o.logs.push(`${ne.name} HP ${_} `))})}break}case"RANDOM_DAMAGE":{const v=r.value2||1,_=r.value||0,x=r.targetType==="SELF"?e:c,I=o.players[x].board,y=N=>{const ne=I[N];ne&&(ne.hasBarrier?(ne.hasBarrier=!1,o.logs.push(`${ne.name} `)):(ne.currentHealth-=_,o.logs.push(`${n.name}  ${ne.name}  ${_} `)),ne.currentHealth<=0&&(ne.currentHealth=0,u(ne,x),o.players[x].graveyard.push(ne),I[N]=null,o.logs.push(`${ne.name} `)))},O=new Set;if(i&&i.length>0)i.forEach(N=>{const ne=I.findIndex(B=>(B==null?void 0:B.instanceId)===N);if(ne!==-1&&I[ne])O.add(N),y(ne);else{const B=I.map((ye,te)=>ye&&!O.has(ye.instanceId)?te:-1).filter(ye=>ye!==-1);if(B.length>0){const ye=Math.floor(l()*B.length),te=B[ye],xe=I[te];O.add(xe.instanceId),y(te)}}});else{const N=I.map((B,ye)=>B?ye:-1).filter(B=>B!==-1);for(let B=N.length-1;B>0;B--){const ye=Math.floor(l()*(B+1));[N[B],N[ye]]=[N[ye],N[B]]}N.slice(0,v).forEach(B=>{y(B)})}break}case"RANDOM_DAMAGE_BY_TURN":{const v=r.value||1,_=o.turnCount,x=r.targetType==="SELF"?e:c,I=o.players[x].board,y=O=>{var ne;const N=I[O];if(!N)return!1;if(N.hasBarrier)return N.hasBarrier=!1,o.logs.push(`${N.name} `),!0;if(N.currentHealth-=v,o.logs.push(`${n.name}  ${N.name}  ${v} `),N.currentHealth<=0){N.currentHealth=0;const B=Object.keys(o.players).find(te=>o.players[te]===o.players[x])||x,ye=(ne=N.triggers)==null?void 0:ne.find(te=>te.trigger==="LAST_WORD");return ye&&ye.effects.forEach(te=>{o.pendingEffects.push({sourceCard:N,effect:te,sourcePlayerId:B})}),o.players[x].graveyard.push(N),I[O]=null,o.logs.push(`${N.name} `),!1}return!0};if(i&&i.length>0)for(let O=0;O<i.length;O++){const N=i[O],ne=I.findIndex(B=>(B==null?void 0:B.instanceId)===N);if(ne!==-1&&I[ne])y(ne);else{const B=I.map((ye,te)=>ye?te:-1).filter(ye=>ye!==-1);if(B.length>0){const ye=Math.floor(l()*B.length);y(B[ye])}}}else for(let O=0;O<_;O++){const N=I.map((B,ye)=>B?ye:-1).filter(B=>B!==-1);if(N.length===0)break;const ne=Math.floor(l()*N.length);y(N[ne])}break}case"SET_MAX_HP":{const v=r.value||20;if(r.targetType==="OPPONENT"){const _=o.players[c];_.maxHp=v,_.hp>v&&(_.hp=v)}break}case"SUMMON_CARD":{const v=r.targetCardId,_=Sn.find(x=>x.id===v);if(_){const x=o.players[e];if(x.board.filter(y=>y!==null).length<5){const y={..._,instanceId:`token_${o.rngSeed}_${Math.floor(l()*1e3)}`,canAttack:((b=_.passiveAbilities)==null?void 0:b.includes("STORM"))||((C=_.passiveAbilities)==null?void 0:C.includes("RUSH"))||!1,currentHealth:_.health||1,maxHealth:_.health||1,attack:_.attack||0,currentAttack:_.attack||0,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((k=_.passiveAbilities)==null?void 0:k.includes("BARRIER"))??!1,passiveAbilities:_.passiveAbilities?[..._.passiveAbilities]:[],hadStealth:((A=_.passiveAbilities)==null?void 0:A.includes("STEALTH"))??!1};(R=_.tags)!=null&&R.includes("Knuckler")&&!y.passiveAbilities.includes("STORM")&&x.board.some(N=>(N==null?void 0:N.name)==="")&&(y.passiveAbilities.push("STORM"),y.canAttack=!0,o.logs.push(`${_.name}   `)),x.board.push(y),o.logs.push(`${x.name}  ${_.name} `)}}break}case"SUMMON_CARD_RUSH":{const v=r.targetCardId,_=Sn.find(x=>x.id===v);if(_){const x=o.players[e];if(x.board.filter(y=>y!==null).length<5){const y={..._,instanceId:`token_${o.rngSeed}_${Math.floor(l()*1e3)}`,canAttack:!0,currentHealth:_.health||1,maxHealth:_.health||1,attack:_.attack||0,currentAttack:_.attack||0,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((m=_.passiveAbilities)==null?void 0:m.includes("BARRIER"))??!1,passiveAbilities:_.passiveAbilities?[..._.passiveAbilities]:[],hadStealth:((T=_.passiveAbilities)==null?void 0:T.includes("STEALTH"))??!1};let O=!1;(L=_.tags)!=null&&L.includes("Knuckler")&&!y.passiveAbilities.includes("STORM")&&x.board.some(ne=>(ne==null?void 0:ne.name)==="")&&(y.passiveAbilities.push("STORM"),O=!0,o.logs.push(`${_.name}   `)),!O&&!y.passiveAbilities.includes("RUSH")&&y.passiveAbilities.push("RUSH"),x.board.push(y),o.logs.push(`${x.name}  ${_.name} ${O?"":""}`)}}break}case"SUMMON_CARD_BUFFED":{const v=r.targetCardId,_=Sn.find(y=>y.id===v),x=r.value||0,I=r.value2||0;if(_){const y=o.players[e];if(y.board.filter(N=>N!==null).length<5){const N=_.attack||0,ne=_.health||1,B=N+x,ye=ne+I,te={..._,instanceId:`token_${o.rngSeed}_${Math.floor(l()*1e3)}`,canAttack:!1,currentHealth:ye,maxHealth:ye,health:ye,attack:B,currentAttack:B,baseAttack:N,baseHealth:ne,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((g=_.passiveAbilities)==null?void 0:g.includes("BARRIER"))??!1,passiveAbilities:_.passiveAbilities?[..._.passiveAbilities]:[],hadStealth:((H=_.passiveAbilities)==null?void 0:H.includes("STEALTH"))??!1};(Q=_.tags)!=null&&Q.includes("Knuckler")&&!te.passiveAbilities.includes("STORM")&&y.board.some(J=>(J==null?void 0:J.name)==="")&&(te.passiveAbilities.push("STORM"),te.canAttack=!0,o.logs.push(`${_.name}   `)),((W=te.passiveAbilities)!=null&&W.includes("RUSH")||(G=te.passiveAbilities)!=null&&G.includes("STORM"))&&(te.canAttack=!0),y.board.push(te),o.logs.push(`${y.name}  ${_.name} +${x}/+${I}`),o.pendingEffects=[...o.pendingEffects||[],{sourceCard:te,effect:{type:"VISUAL_BUFF_ONLY",value:x,value2:I},sourcePlayerId:e}]}}break}case"SUMMON_CARD_FILL_BOARD":{const v=r.targetCardId,_=Sn.find(I=>I.id===v),x=r.necromance||0;if(_){const I=o.players[e];let y=0;for(;!(I.board.filter(ne=>ne!==null).length>=5);){if(x>0&&I.graveyard.length<x){y===0&&o.logs.push(` ${_.name} `);break}if(x>0){const ne=I.graveyard.splice(-x,x);o.logs.push(` ${x} ${ne.map(B=>B.name).join(", ")} `)}const N={..._,instanceId:`token_${o.rngSeed}_${Math.floor(l()*1e3)}_${y}`,canAttack:((de=_.passiveAbilities)==null?void 0:de.includes("STORM"))||((fe=_.passiveAbilities)==null?void 0:fe.includes("RUSH"))||!1,currentHealth:_.health||1,maxHealth:_.health||1,attack:_.attack||0,currentAttack:_.attack||0,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((Ee=_.passiveAbilities)==null?void 0:Ee.includes("BARRIER"))??!1,passiveAbilities:_.passiveAbilities?[..._.passiveAbilities]:[],hadStealth:((ae=_.passiveAbilities)==null?void 0:ae.includes("STEALTH"))??!1};(he=_.tags)!=null&&he.includes("Knuckler")&&!N.passiveAbilities.includes("STORM")&&I.board.some(B=>(B==null?void 0:B.name)==="")&&(N.passiveAbilities.push("STORM"),N.canAttack=!0,o.logs.push(`${_.name}   `)),I.board.push(N),y++,o.logs.push(`${I.name}  ${_.name} `)}y>0&&o.logs.push(` ${y}  ${_.name} `)}break}case"DESTROY_AND_STEAL":{if(r.targetType==="SELECT_FOLLOWER"&&s){const v=d(s);if(v){const{card:_,player:x,index:I}=v,y=Object.keys(o.players).find(ne=>o.players[ne]===x)||c,O=o.players[e];if(O.board.filter(ne=>ne!==null).length<5){x.board[I]=null,o.logs.push(`${_.name}  ${n.name} `);const ne={..._,instanceId:`stolen_${o.rngSeed}_${Math.floor(l()*1e3)}`,canAttack:!1,currentHealth:_.health||_.currentHealth,maxHealth:_.health||_.maxHealth,currentAttack:_.attack||_.currentAttack,attacksMade:0,turnPlayed:o.turnCount,hasEvolved:!1};O.board.push(ne),o.logs.push(`${O.name}  ${ne.name} `)}else u(_,y),x.graveyard.push(_),x.board[I]=null,o.logs.push(`${_.name}  ${n.name} `)}}break}case"DESTROY_AND_GENERATE":{let v=null;if(r.targetType==="SELECT_FOLLOWER"&&s)v=d(s);else if(r.targetType==="RANDOM_ENEMY_FOLLOWER"){const x=o.players[c].board.map((I,y)=>({card:I,index:y})).filter(I=>I.card!==null);if(x.length>0){const I=Math.floor(l()*x.length),y=x[I];v={card:y.card,player:o.players[c],index:y.index}}}if(v){const{card:_,player:x,index:I}=v,y=Object.keys(o.players).find(ne=>o.players[ne]===x)||c;u(_,y),x.graveyard.push(_),x.board[I]=null,o.logs.push(`${_.name}  ${n.name} `);const O=o.players[e],N=os(_.name);if(N){const ne=Math.max(0,N.cost+(r.value||0)),B={...N,instanceId:`generated_${o.rngSeed}_${Math.floor(l()*1e3)}`,baseCost:ne,cost:ne,attackEffectType:N.attackEffectType};O.hand.push(B);const ye=r.value||0;o.logs.push(`${O.name}  ${B.name} ${ye>=0?"+":""}${ye}`)}}break}case"RETURN_TO_HAND":{const v=o.players[c].board;let _=-1;if(r.targetType==="SELECT_FOLLOWER"&&s?_=v.findIndex(x=>(x==null?void 0:x.instanceId)===s):(r.targetType==="RANDOM_FOLLOWER"||!s)&&v.length>0&&(_=Math.floor(l()*v.length)),_!==-1&&v[_]){const x=v[_];o.players[c].board[_]=null;const I=o.players[c],y=os(x.id)||os(x.name),{currentHealth:O,maxHealth:N,canAttack:ne,attacksMade:B,hasEvolved:ye,baseAttack:te,baseHealth:xe,turnPlayed:J,hasBarrier:V,attack:Qe,health:tt,...Ae}=x,Se={...Ae,attack:(y==null?void 0:y.attack)??Qe,health:(y==null?void 0:y.health)??tt};I.hand.length<9?(I.hand.push(Se),o.logs.push(`${x.name} `)):(I.graveyard.push(Se),o.logs.push(`${x.name} `))}break}case"RANDOM_BOUNCE":{const v=r.value||1,_=o.players[c].board;for(let x=0;x<v;x++){const I=_.map((nt,Ue)=>nt?Ue:-1).filter(nt=>nt!==-1);if(I.length===0)break;const y=I[Math.floor(l()*I.length)],O=_[y];_[y]=null;const N=o.players[c],ne=os(O.id)||os(O.name),{currentHealth:B,maxHealth:ye,canAttack:te,attacksMade:xe,hasEvolved:J,baseAttack:V,baseHealth:Qe,turnPlayed:tt,hasBarrier:Ae,attack:Se,health:Pe,...et}=O,at={...et,attack:(ne==null?void 0:ne.attack)??Se,health:(ne==null?void 0:ne.health)??Pe};N.hand.length<9?(N.hand.push(at),o.logs.push(`${O.name} `)):(N.graveyard.push(at),o.logs.push(`${O.name} `))}break}case"GRANT_PASSIVE":{const v=r.targetPassive;if(!v)break;if(r.targetType==="SELF"){const _=n;if(_.instanceId){const I=o.players[e].board.find(y=>(y==null?void 0:y.instanceId)===_.instanceId);I&&(v==="BARRIER"?(I.hasBarrier=!0,o.logs.push(`${I.name} `)):(I.passiveAbilities||(I.passiveAbilities=[]),I.passiveAbilities.includes(v)||(I.passiveAbilities.push(v),o.logs.push(`${I.name}  ${pd(v)} `)),(v==="STORM"||v==="RUSH")&&(I.canAttack=!0)))}}else if((r.targetType==="SELECT_FOLLOWER"||r.targetType==="SELECT_ALLY_FOLLOWER")&&s){const _=d(s);if(_){const{card:x}=_;v==="BARRIER"?(x.hasBarrier=!0,o.logs.push(`${x.name} `)):(x.passiveAbilities||(x.passiveAbilities=[]),x.passiveAbilities.includes(v)||(x.passiveAbilities.push(v),o.logs.push(`${x.name}  ${pd(v)} `)),(v==="STORM"||v==="RUSH")&&(x.canAttack=!0))}}else if(r.targetType==="ALL_FOLLOWERS"){const _=o.players[e];let x=0;console.log(`[GRANT_PASSIVE] ALL_FOLLOWERS: Player board has ${_.board.filter(I=>I).length} units, condition tag=${(be=r.conditions)==null?void 0:be.tag}`),_.board.forEach(I=>{var y,O,N;if(I){if(console.log(`[GRANT_PASSIVE] Checking: ${I.name}, tags=${I.tags}, passives=${I.passiveAbilities}`),(y=r.conditions)!=null&&y.tag&&!((O=I.tags)!=null&&O.includes(r.conditions.tag))){console.log(`[GRANT_PASSIVE] Skipped ${I.name}: no matching tag`);return}if((N=r.conditions)!=null&&N.nameIn&&!r.conditions.nameIn.includes(I.name)){console.log(`[GRANT_PASSIVE] Skipped ${I.name}: no matching nameIn`);return}v==="BARRIER"?(I.hasBarrier=!0,x++):(I.passiveAbilities||(I.passiveAbilities=[]),I.passiveAbilities.includes(v)||(I.passiveAbilities.push(v),x++,console.log(`[GRANT_PASSIVE] Granted ${v} to ${I.name}`),(v==="STORM"||v==="RUSH")&&(I.canAttack=!0)))}}),x>0&&o.logs.push(`${x} ${pd(v)} `),console.log(`[GRANT_PASSIVE] Total granted: ${x}`)}else if(r.targetType==="ALL_OTHER_FOLLOWERS"){const _=o.players[e];let x=0;_.board.forEach(I=>{var y,O,N;if(I&&I.instanceId!==n.instanceId){if((y=r.conditions)!=null&&y.tag&&!((O=I.tags)!=null&&O.includes(r.conditions.tag))||(N=r.conditions)!=null&&N.nameIn&&!r.conditions.nameIn.includes(I.name))return;v==="BARRIER"?(I.hasBarrier=!0,x++):(I.passiveAbilities||(I.passiveAbilities=[]),I.passiveAbilities.includes(v)||(I.passiveAbilities.push(v),x++,(v==="STORM"||v==="RUSH")&&(I.canAttack=!0)))}}),x>0&&o.logs.push(`${x} ${pd(v)} `)}break}case"BUFF_STATS":{const v=r.value||0,_=r.value2||0;if(r.targetType==="ALL_FOLLOWERS")o.players[e].board.forEach(I=>{var y,O,N;if(I){if((y=r.conditions)!=null&&y.tag&&!((O=I.tags)!=null&&O.includes(r.conditions.tag))||(N=r.conditions)!=null&&N.nameIn&&!r.conditions.nameIn.includes(I.name))return;I.baseAttack||(I.baseAttack=I.attack||0),I.baseHealth||(I.baseHealth=I.health||0),I.attack=(I.attack||0)+v,I.currentAttack=(I.currentAttack||0)+v,I.health=(I.health||0)+_,I.maxHealth=(I.maxHealth||0)+_,I.currentHealth=(I.currentHealth||0)+_,o.logs.push(`${I.name}  +${v}/+${_} `)}});else if(r.targetType==="ALL_OTHER_FOLLOWERS")o.players[e].board.forEach(I=>{var y,O,N;if(I&&I.instanceId!==n.instanceId){if((y=r.conditions)!=null&&y.tag&&!((O=I.tags)!=null&&O.includes(r.conditions.tag))||(N=r.conditions)!=null&&N.nameIn&&!r.conditions.nameIn.includes(I.name))return;I.baseAttack||(I.baseAttack=I.attack||0),I.baseHealth||(I.baseHealth=I.health||0),I.attack=(I.attack||0)+v,I.currentAttack=(I.currentAttack||0)+v,I.health=(I.health||0)+_,I.maxHealth=(I.maxHealth||0)+_,I.currentHealth=(I.currentHealth||0)+_,o.logs.push(`${I.name}  +${v}/+${_} `)}});else if((r.targetType==="SELECT_FOLLOWER"||r.targetType==="SELECT_ALLY_FOLLOWER"||r.targetType==="SELECT_OTHER_ALLY_FOLLOWER")&&s){const x=d(s);if(x){const{card:I}=x;I.baseAttack||(I.baseAttack=I.attack||0),I.baseHealth||(I.baseHealth=I.health||0),I.attack=(I.attack||0)+v,I.currentAttack=(I.currentAttack||0)+v,I.health=(I.health||0)+_,I.maxHealth=(I.maxHealth||0)+_,I.currentHealth=(I.currentHealth||0)+_,o.logs.push(`${I.name}  +${v}/+${_} `)}}else if(r.targetType==="RANDOM_FOLLOWER"){const x=o.players[c].board,I=x.map((y,O)=>y?O:-1).filter(y=>y!==-1);if(I.length>0){const y=I[Math.floor(l()*I.length)],O=x[y];O.baseAttack||(O.baseAttack=O.attack||0),O.baseHealth||(O.baseHealth=O.health||0),O.attack=(O.attack||0)+v,O.currentAttack=(O.currentAttack||0)+v,O.health=(O.health||0)+_,O.maxHealth=(O.maxHealth||0)+_,O.currentHealth=(O.currentHealth||0)+_,O.currentAttack<0&&(O.currentAttack=0),O.attack&&O.attack<0&&(O.attack=0);const N=v>=0?`+${v}`:`${v}`,ne=_>=0?`+${_}`:`${_}`;o.logs.push(`${O.name}  ${N}/${ne} `)}else o.logs.push("")}break}}return o}const I5=t=>{const e=n=>{const r=n.board.some(i=>i&&i.name.includes("")),s=n.hand.map(i=>{var c;const o=i.baseCost!==void 0?i.baseCost:i.cost;let l=o;return r&&((c=i.tags)!=null&&c.includes("Knuckler"))&&(l=Math.max(0,o-2)),i.cost!==l?{...i,cost:l,baseCost:o}:i});return{...n,hand:s}};return{...t,players:{p1:e(t.players.p1),p2:e(t.players.p2)}}},T5=(t,e)=>{let n=C5(t,e);return n=I5(n),n.lastHash=E5(n),n},C5=(t,e)=>{var s,i,o,l,c,d,u,h,f,b,C,k,A,R,m,T,L,g,H,Q,W,G,de,fe,Ee;console.log(`[Reducer] Action: ${e.type}, isRemote: ${e.isRemote}`);let n={...t,players:{p1:{...t.players.p1,hand:[...t.players.p1.hand],deck:[...t.players.p1.deck],board:t.players.p1.board.map(ae=>ae?{...ae,passiveAbilities:ae.passiveAbilities?[...ae.passiveAbilities]:[]}:null),graveyard:[...t.players.p1.graveyard]},p2:{...t.players.p2,hand:[...t.players.p2.hand],deck:[...t.players.p2.deck],board:t.players.p2.board.map(ae=>ae?{...ae,passiveAbilities:ae.passiveAbilities?[...ae.passiveAbilities]:[]}:null),graveyard:[...t.players.p2.graveyard]}},logs:[...t.logs||[]]};const r=y0(n.rngSeed||999);switch(n.rngSeed=Math.floor(r()*1e6),e.type){case"START_GAME":return t;case"END_TURN":{const ae=t.activePlayerId,he=n.players[ae];he.extraPpActive&&(he.id!==t.firstPlayerId&&(n.turnCount<=5?he.extraPpUsedEarly=!0:he.extraPpUsedLate=!0),he.extraPpActive=!1);const be=[...n.pendingEffects||[]];he.board.forEach(x=>{x&&x.triggers&&x.triggers.filter(I=>I.trigger==="END_OF_TURN").forEach(I=>{I.effects.forEach(y=>{be.push({sourceCard:x,effect:y,sourcePlayerId:ae})})})});const v=Bp(ae),_=n.players[v];if(_.board.forEach((x,I)=>{x&&x.triggers&&x.triggers.filter(y=>y.trigger==="START_OF_TURN").forEach(y=>{y.effects.forEach(O=>{O.type==="DESTROY_SELF"?x&&(n.players[v].graveyard.push(x),n.players[v].board[I]=null,n.logs.push(`${x.name} `)):be.push({sourceCard:x,effect:O,sourcePlayerId:v})})})}),n.players[v].board=n.players[v].board.filter(Boolean),_.maxPp=Math.min(10,_.maxPp+1),_.pp=_.maxPp,_.deck.length>0){const x=_.deck.pop();x&&(_.hand.length<9?_.hand.push(x):(_.graveyard.push(x),n.logs.push(`${_.name}${x.name}`)))}return _.board=_.board.filter(Boolean),_.board.forEach(x=>{x&&(x.canAttack=!0,x.attacksMade=0,x.turnPlayed=-1)}),_.canEvolveThisTurn=!0,n.activePlayerId=v,n.pendingEffects=be,v===t.firstPlayerId&&(n.turnCount+=1),n.logs.push(` ${n.turnCount} - ${_.name} `),n}case"CONCEDE":{const ae=e.playerId,he=n.players[ae];if(!he)return console.warn(`[Engine] CONCEDE: Unknown playerId: ${ae}. Ignoring.`),t;if(t.phase==="GAME_OVER")return console.warn("[Engine] CONCEDE: Game already over. Ignoring."),t;const be=Bp(ae);return n.phase="GAME_OVER",n.winnerId=be,n.logs.push(`${he.name} `),console.log(`[Engine] CONCEDE: ${ae} surrendered. Winner: ${be}`),n}case"RESOLVE_EFFECT":{if(!n.pendingEffects||n.pendingEffects.length===0)return n;const[ae,...he]=n.pendingEffects;console.log(`[Engine] RESOLVE_EFFECT: Processing ${ae.effect.type} from ${ae.sourceCard.name}. Remaining: ${he.length}`);const be=((s=e.payload)==null?void 0:s.targetId)||ae.targetId;let v=w5(n,ae.sourcePlayerId,ae.sourceCard,ae.effect,be,ae.targetIds);const _=(v.pendingEffects||[]).filter(I=>{var y;return!((y=n.pendingEffects)!=null&&y.includes(I))}),x=[...he,..._];return console.log(`[Engine] RESOLVE_EFFECT done. Remaining: ${he.length}, NewlyAdded: ${_.length}, Final: ${x.length}`),x.length===0&&Object.values(v.players).forEach(I=>{I.board=I.board.filter(Boolean)}),{...v,pendingEffects:x}}case"PLAY_CARD":{if(!e.isRemote&&n.activePlayerId!==e.playerId)return n;const{cardIndex:ae,targetId:he,instanceId:be}=e.payload,v={...n.players.p1,hand:[...n.players.p1.hand],deck:[...n.players.p1.deck],board:[...n.players.p1.board],graveyard:[...n.players.p1.graveyard]},_={...n.players.p2,hand:[...n.players.p2.hand],deck:[...n.players.p2.deck],board:[...n.players.p2.board],graveyard:[...n.players.p2.graveyard]},x=e.playerId==="p1"?v:_;console.log(`[Engine] PLAY_CARD: playerId=${e.playerId}, cardIndex=${ae}, instanceId=${be}, handLength=${x.hand.length}, isRemote=${e.isRemote}`),console.log("[Engine] PLAY_CARD: hand cards:",x.hand.map(J=>`${J.name}(${J.instanceId})`));let I=ae;if(be){const J=x.hand.findIndex(V=>V.instanceId===be);if(J>=0)I=J,console.log(`[Engine] PLAY_CARD: Using instanceId ${be}, found at index ${J} (was ${ae})`);else return console.log(`[Engine] PLAY_CARD: instanceId ${be} not found in hand!`),n}if(I<0||I>=x.hand.length)return console.log("[Engine] PLAY_CARD: Invalid cardIndex! Returning unchanged state."),n;const y=x.hand[I];let O="";if(he){const V=(e.playerId==="p1"?_:v).board.find(Qe=>(Qe==null?void 0:Qe.instanceId)===he);V&&(O=` (: ${V.name})`)}if(n.logs.push(`${x.name}  ${y.name} ${O}`),x.pp<y.cost)return n;const N=x.board.filter(J=>J!==null).length;if(y.type==="FOLLOWER"&&N>=5)return n;const ne=x.pp;x.pp-=y.cost,x.extraPpActive&&ne-1<y.cost&&(x.id!==t.firstPlayerId&&(n.turnCount<=5?x.extraPpUsedEarly=!0:x.extraPpUsedLate=!0),x.extraPpActive=!1,x.pp<0&&(x.pp=0),console.log("[Engine] PLAY_CARD: Extra PP consumed, marked as used"),n.logs.push(`${x.name} PP`)),x.hand.splice(I,1);let B=y;if(y.type==="FOLLOWER"){const J={...y,instanceId:e.payload.instanceId||`inst_${n.rngSeed}_${Math.floor(r()*1e3)}`,currentAttack:y.attack||0,currentHealth:y.health||0,maxHealth:y.health||0,canAttack:!1,hasEvolved:!1,attacksMade:0,turnPlayed:n.turnCount,hasBarrier:((i=y.passiveAbilities)==null?void 0:i.includes("BARRIER"))??!1,passiveAbilities:y.passiveAbilities?[...y.passiveAbilities]:[],hadStealth:((o=y.passiveAbilities)==null?void 0:o.includes("STEALTH"))??!1};((l=y.passiveAbilities)!=null&&l.includes("STORM")||(c=y.passiveAbilities)!=null&&c.includes("RUSH"))&&(J.canAttack=!0),(d=J.tags)!=null&&d.includes("Knuckler")&&!J.passiveAbilities.includes("STORM")&&x.board.some(Qe=>(Qe==null?void 0:Qe.name)==="")&&(J.passiveAbilities.push("STORM"),J.canAttack=!0,n.logs.push(`${J.name}   `)),x.board.push(J),B=J,J.name===""&&x.board.forEach(V=>{var Qe,tt;V&&((Qe=V.tags)!=null&&Qe.includes("Knuckler"))&&V.instanceId!==J.instanceId&&((tt=V.passiveAbilities)!=null&&tt.includes("STORM")||(V.passiveAbilities||(V.passiveAbilities=[]),V.passiveAbilities.push("STORM"),V.canAttack=!0,n.logs.push(`${V.name}   `)))})}else x.graveyard.push({...y,instanceId:`spell_${n.rngSeed}_${Math.floor(r()*1e3)}`});const ye=[];(u=y.triggers)==null||u.filter(J=>J.trigger==="FANFARE").forEach(J=>ye.push(...J.effects)),(h=y.triggerAbilities)!=null&&h.FANFARE&&ye.push(y.triggerAbilities.FANFARE);let te=[...n.pendingEffects||[]];return ye.forEach(J=>{if(J.conditions&&J.conditions.minTurn&&n.turnCount<J.conditions.minTurn)return;let V;if(J.targetType==="OPPONENT"||J.targetType==="SELF"||J.targetType==="ALL_FOLLOWERS"||J.targetType==="ALL_OTHER_FOLLOWERS"||J.type==="RANDOM_DESTROY"||J.type==="RANDOM_SET_HP"||J.type==="AOE_DAMAGE"||J.type==="RANDOM_DAMAGE"||J.type==="RANDOM_DAMAGE_BY_TURN"){const tt=e.playerId==="p1"?"p2":"p1",Ae=e.playerId;if(J.type==="RANDOM_DAMAGE_BY_TURN"){const Se=J.targetType==="SELF"?Ae:tt,Pe=n.players[Se].board,et=n.turnCount;V=[];for(let at=0;at<et;at++){const nt=Pe.map((Pt,lt)=>Pt?lt:-1).filter(Pt=>Pt!==-1);if(nt.length===0)break;const Ue=Math.floor(r()*nt.length);V.push(Pe[nt[Ue]].instanceId)}console.log(`[Engine PLAY_CARD] RANDOM_DAMAGE_BY_TURN: Pre-calculated ${V.length} targets (turn ${et}):`,V)}else if(J.type==="RANDOM_DESTROY"||J.type==="RANDOM_SET_HP"||J.type==="RANDOM_DAMAGE"){const Se=J.targetType==="SELF"?Ae:tt,Pe=n.players[Se].board,et=J.type==="RANDOM_DAMAGE"?J.value2||1:J.value||1,at=Pe.map((Ue,Pt)=>Ue?Pt:-1).filter(Ue=>Ue!==-1);for(let Ue=at.length-1;Ue>0;Ue--){const Pt=Math.floor(r()*(Ue+1));[at[Ue],at[Pt]]=[at[Pt],at[Ue]]}V=at.slice(0,et).map(Ue=>Pe[Ue].instanceId),console.log(`[Engine PLAY_CARD] ${J.type}: Pre-calculated ${V.length} targets:`,V)}else if(J.targetType==="ALL_FOLLOWERS"||J.type==="AOE_DAMAGE"){const Se=J.type==="GRANT_PASSIVE"||J.type==="BUFF_STATS",Pe=Se?Ae:tt;V=n.players[Pe].board.filter(at=>at!==null).map(at=>at.instanceId),console.log(`[Engine] Pre-calculated ALL_FOLLOWERS targets (${Se?"ally":"enemy"}): ${V.length} units`)}else J.targetType==="ALL_OTHER_FOLLOWERS"&&(V=n.players[Ae].board.filter(Pe=>Pe!==null&&Pe.instanceId!==B.instanceId).map(Pe=>Pe.instanceId))}const Qe=J.targetType==="SELECT_FOLLOWER"||J.targetType==="SELECT_ALLY_FOLLOWER"||J.targetType==="SELECT_OTHER_ALLY_FOLLOWER";te.push({sourceCard:B,effect:J,sourcePlayerId:e.playerId,targetId:Qe?he:void 0,targetIds:V})}),console.log(`[Engine] PLAY_CARD: Queued ${ye.length} effects. Total pending: ${te.length}`),{...n,players:{p1:v,p2:_},pendingEffects:te}}case"EVOLVE":{const{followerIndex:ae,targetId:he,useSep:be}=e.payload,v={...n.players.p1,hand:[...n.players.p1.hand],deck:[...n.players.p1.deck],board:n.players.p1.board.map(B=>B?{...B,passiveAbilities:B.passiveAbilities?[...B.passiveAbilities]:void 0}:null),graveyard:[...n.players.p1.graveyard]},_={...n.players.p2,hand:[...n.players.p2.hand],deck:[...n.players.p2.deck],board:n.players.p2.board.map(B=>B?{...B,passiveAbilities:B.passiveAbilities?[...B.passiveAbilities]:void 0}:null),graveyard:[...n.players.p2.graveyard]},x=e.playerId==="p1"?v:_,I=x.board[ae];if(!I||I.hasEvolved)return n;const y=e.isRemote;if(console.log(`[Engine] EVOLVE Logic: name=${I.name}, useSep=${be}, isRemote=${y}, turn=${t.turnCount}`),n.logs.push(`${x.name}  ${I.name} ${be?"":""}`),be){if(!y){if(t.turnCount<6)return console.log(`[Engine] Cannot Super Evolve: Turn ${t.turnCount} < 6`),n;if(x.sep<=0)return console.log("[Engine] Cannot Super Evolve: No SEP"),n;if(!x.canEvolveThisTurn)return console.log("[Engine] Cannot Super Evolve: Already evolved this turn"),n}x.sep=Math.max(0,x.sep-1),x.canEvolveThisTurn=!1,I.hasEvolved=!0,I.currentAttack+=3,I.currentHealth+=3,I.maxHealth+=3,I.canAttack=!0;const B=[...I.passiveAbilities||[]];B.includes("IMMUNE_TO_DAMAGE_MY_TURN")||B.push("IMMUNE_TO_DAMAGE_MY_TURN"),!B.includes("STORM")&&!B.includes("RUSH")&&B.push("RUSH"),I.passiveAbilities=B,console.log(`[Engine] Super Evolved ${I.name}! SEP remaining: ${x.sep}`)}else{if(!y){const te=e.playerId===t.firstPlayerId?5:4;if(t.turnCount<te)return console.log(`[Engine] Cannot Evolve: Turn ${t.turnCount} < ${te}`),n;if(x.evolutionsUsed>=2)return console.log("[Engine] Cannot Evolve: Limit reached"),n;if(!x.canEvolveThisTurn)return console.log("[Engine] Cannot Evolve: Already evolved this turn"),n}x.evolutionsUsed+=1,x.canEvolveThisTurn=!1,I.hasEvolved=!0,I.currentAttack+=2,I.currentHealth+=2,I.maxHealth+=2,I.canAttack=!0;const B=[...I.passiveAbilities||[]];!B.includes("STORM")&&!B.includes("RUSH")&&B.push("RUSH"),I.passiveAbilities=B}const O=[];(f=I.triggers)==null||f.filter(B=>B.trigger==="EVOLVE").forEach(B=>O.push(...B.effects)),(b=I.triggerAbilities)!=null&&b.EVOLVE&&O.push(I.triggerAbilities.EVOLVE),be&&((C=I.triggers)==null||C.filter(B=>B.trigger==="SUPER_EVOLVE").forEach(B=>O.push(...B.effects)));let N=[...n.pendingEffects||[]];return O.forEach(B=>{if(B.conditions&&B.conditions.minTurn&&n.turnCount<B.conditions.minTurn)return;let ye;const te=e.playerId==="p1"?"p2":"p1",xe=e.playerId;if(B.type==="RANDOM_DESTROY"||B.type==="RANDOM_SET_HP"||B.type==="RANDOM_DAMAGE"){const J=B.targetType==="SELF"?xe:te,V=n.players[J].board,Qe=B.type==="RANDOM_DAMAGE"?B.value2||1:B.value||1,tt=V.map((Se,Pe)=>Se?Pe:-1).filter(Se=>Se!==-1);for(let Se=tt.length-1;Se>0;Se--){const Pe=Math.floor(r()*(Se+1));[tt[Se],tt[Pe]]=[tt[Pe],tt[Se]]}ye=tt.slice(0,Qe).map(Se=>V[Se].instanceId),console.log(`[Engine EVOLVE] ${B.type}: Pre-calculated ${ye.length} targets:`,ye)}else B.targetType==="ALL_FOLLOWERS"||B.type==="AOE_DAMAGE"?(ye=n.players[te].board.filter(V=>V!==null).map(V=>V.instanceId),console.log(`[Engine EVOLVE] Pre-calculated ALL_FOLLOWERS targets: ${ye.length} units`)):B.targetType==="ALL_OTHER_FOLLOWERS"&&(ye=n.players[xe].board.filter(V=>V!==null&&V.instanceId!==I.instanceId).map(V=>V.instanceId));N.push({sourceCard:I,effect:B,sourcePlayerId:e.playerId,targetId:he,targetIds:ye})}),console.log(`[Engine] EVOLVE: Queued ${O.length} effects. Total pending: ${N.length}`),{...n,players:{p1:v,p2:_},pendingEffects:N}}case"ATTACK":{console.log(`[Engine] ATTACK received. Incoming state P1 HP: ${t.players.p1.hp}, P2 HP: ${t.players.p2.hp}`);const{attackerIndex:ae,targetIndex:he,targetIsLeader:be}=e.payload,v={...n.players.p1,board:n.players.p1.board.map(V=>V?{...V,passiveAbilities:V.passiveAbilities?[...V.passiveAbilities]:void 0}:null),graveyard:[...n.players.p1.graveyard]},_={...n.players.p2,board:n.players.p2.board.map(V=>V?{...V,passiveAbilities:V.passiveAbilities?[...V.passiveAbilities]:void 0}:null),graveyard:[...n.players.p2.graveyard]},x=e.playerId==="p1",I=x?v:_,y=x?_:v,O=I.board[ae];if(!O||!O.canAttack)return n;const N=y.board.filter(V=>{var Qe,tt;return V&&((Qe=V.passiveAbilities)==null?void 0:Qe.includes("WARD"))&&!((tt=V.passiveAbilities)!=null&&tt.includes("STEALTH"))}),ne=((k=O.passiveAbilities)==null?void 0:k.includes("STEALTH"))||O.hadStealth;if(N.length>0&&!ne){if(be)return console.log("[Engine] Attack blocked: Must attack Ward unit first."),n;const V=y.board[he];if(V&&!((A=V.passiveAbilities)!=null&&A.includes("WARD")))return console.log("[Engine] Attack blocked: Must attack Ward unit first."),n}if(be===!1){const V=y.board[he];if(V&&((R=V.passiveAbilities)!=null&&R.includes("STEALTH")))return console.log("[Engine] ATTACK blocked: Target has STEALTH"),n}const B=(m=O.passiveAbilities)==null?void 0:m.includes("RUSH"),ye=(T=O.passiveAbilities)==null?void 0:T.includes("STORM");if(B&&!ye&&be&&O.turnPlayed===n.turnCount)return console.log("[Engine] ATTACK blocked: RUSH unit cannot attack leader on the turn it was played"),n;(L=O.passiveAbilities)!=null&&L.includes("STEALTH")&&(O.passiveAbilities=O.passiveAbilities.filter(V=>V!=="STEALTH"),n.logs.push(`${O.name} `)),O.canAttack=!1,O.attacksMade=(O.attacksMade||0)+1,(g=O.passiveAbilities)!=null&&g.includes("DOUBLE_ATTACK")&&O.attacksMade<2&&(O.canAttack=!0);const te=O.currentAttack;console.log(`[Engine] Attack: ${O.name} (${te}) -> Target (Leader? ${be}). DefHP before: ${y.hp}`);const xe=(V,Qe)=>{var Ae;const tt=(Ae=V.triggers)==null?void 0:Ae.find(Se=>Se.trigger==="LAST_WORD");if(tt){const Se=tt.effects.map(Pe=>({sourceCard:V,effect:Pe,sourcePlayerId:Qe}));n.pendingEffects=[...n.pendingEffects||[],...Se],n.logs.push(`${V.name} `),console.log(`[Engine] Last Word triggered for ${V.name}. pendingEffects count: ${n.pendingEffects.length}`)}};if(be){const V="";if(n.logs.push(`${O.name}  ${V} `),y.leaderDamageShield)y.leaderDamageShield=!1,n.logs.push(`${O.name}  ${V}  ${te} `);else{const Qe=y.board.some(Ae=>{var Se;return(Se=Ae==null?void 0:Ae.passiveAbilities)==null?void 0:Se.includes("LEADER_DAMAGE_CAP")}),tt=Qe?Math.min(te,1):te;y.hp-=tt,Qe&&te>1?n.logs.push(`${O.name}  ${V}  ${te} 1`):n.logs.push(`${O.name}  ${V}  ${tt} `),y.hp<=0&&(n.winnerId=e.playerId)}}else{const V=y.board[he];if(!V)return console.log(`[Engine] Attack target at index ${he} no longer exists. Skipping.`),n;n.logs.push(`${O.name}  ${V.name} `);let Qe=te;(H=V.passiveAbilities)!=null&&H.includes("IMMUNE_TO_FOLLOWER_DAMAGE")?(Qe=0,n.logs.push(`${V.name} `)):V.hasBarrier&&Qe>0?(Qe=0,V.hasBarrier=!1,n.logs.push(`${V.name} `)):n.logs.push(`${O.name}  ${V.name}  ${Qe} `),V.currentHealth-=Qe;const tt=x?"p2":"p1",Ae=((Q=V.passiveAbilities)==null?void 0:Q.includes("IMMUNE_TO_DAMAGE_MY_TURN"))&&n.activePlayerId===tt;(W=O.passiveAbilities)!=null&&W.includes("BANE")&&V.currentHealth>0&&(Ae?n.logs.push(`${V.name} `):(V.currentHealth=0,V.killedByBane=!0,n.logs.push(`${O.name}  ${V.name} `)));let Se=V.currentAttack;(G=O.passiveAbilities)!=null&&G.includes("IMMUNE_TO_DAMAGE_MY_TURN")&&(Se=0,n.logs.push(`${O.name} `)),O.hasBarrier&&Se>0?(Se=0,O.hasBarrier=!1,n.logs.push(`${O.name} `)):Se>0&&n.logs.push(`${V.name}  ${O.name}  ${Se} `),O.currentHealth-=Se;const Pe=x?"p1":"p2";O.currentHealth<=0&&((de=O.passiveAbilities)!=null&&de.includes("GUTS_MY_TURN"))&&n.activePlayerId===Pe&&(O.currentHealth=1,n.logs.push(`${O.name} 1`));const et=((fe=O.passiveAbilities)==null?void 0:fe.includes("IMMUNE_TO_DAMAGE_MY_TURN"))&&n.activePlayerId===Pe;(Ee=V.passiveAbilities)!=null&&Ee.includes("BANE")&&O.currentHealth>0&&(et?n.logs.push(`${O.name} `):(O.currentHealth=0,O.killedByBane=!0,n.logs.push(`${V.name}  ${O.name} `)));const at=V.currentHealth<=0,nt=O.currentHealth<=0;at&&(V.currentHealth=Math.min(0,V.currentHealth),y.graveyard.push(V),y.board[he]=null,n.logs.push(`${V.name} `)),nt&&(O.currentHealth=Math.min(0,O.currentHealth),I.graveyard.push(O),I.board[ae]=null,n.logs.push(`${O.name} `)),at&&xe(V,x?"p2":"p1"),nt&&xe(O,x?"p1":"p2")}console.log(`[Engine] Committing state. P1 HP: ${v.hp}, P2 HP: ${_.hp}`);const J={...n,players:{p1:v,p2:_}};return console.log(`[Engine] After commit. finalState.players.p1.hp: ${J.players.p1.hp}, finalState.players.p2.hp: ${J.players.p2.hp}`),J}case"REINIT_GAME":{const{p1Class:ae,p2Class:he}=e.payload;return console.log(`[Engine] REINIT_GAME: p1=${ae}, p2=${he}`),Dd("Player 1",ae,"Player 2",he)}case"SYNC_STATE":return console.log("[Engine] SYNC_STATE received"),e.payload;case"UPDATE_PLAYER_NAME":{const{playerId:ae,name:he}=e.payload;return console.log("[Engine] UPDATE_PLAYER_NAME:",ae,he),t.players[ae]?{...t,players:{...t.players,[ae]:{...t.players[ae],name:he}}}:(console.warn("[Engine] UPDATE_PLAYER_NAME: Unknown playerId:",ae),t)}case"SET_FIRST_PLAYER_ID":{const{firstPlayerId:ae}=e.payload;return console.log("[Engine] SET_FIRST_PLAYER_ID:",ae),{...t,firstPlayerId:ae}}case"TOGGLE_EXTRA_PP":{const ae=e.playerId,he=n.players[ae];if(!(ae!==t.firstPlayerId))return console.log("[Engine] TOGGLE_EXTRA_PP: Only second player can use Extra PP"),t;if(t.activePlayerId!==ae)return console.log("[Engine] TOGGLE_EXTRA_PP: Can only toggle on your turn"),t;if(he.extraPpActive)return he.extraPpActive=!1,he.pp=Math.max(0,he.pp-1),console.log("[Engine] TOGGLE_EXTRA_PP: Deactivated, PP now",he.pp),n;if(n.turnCount<=5){if(he.extraPpUsedEarly)return console.log("[Engine] TOGGLE_EXTRA_PP: Already used in early turns"),t}else if(he.extraPpUsedLate)return console.log("[Engine] TOGGLE_EXTRA_PP: Already used in late turns"),t;return he.extraPpActive=!0,he.pp+=1,console.log("[Engine] TOGGLE_EXTRA_PP: Activated, PP now",he.pp),n}default:return t}},af=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},k5=af("/leaders/azya_leader.png"),R5=af("/leaders/senka_leader.png"),A5=af("/leaders/yoRuka_leader.png"),P5=1280,O5=720,L5={SENKA:{primary:"#e94560",gradient:"linear-gradient(135deg, #2c0b0e 0%, #1a1a2e 100%)",shadow:"rgba(233, 69, 96, 0.3)"},AJA:{primary:"#45a2e9",gradient:"linear-gradient(135deg, #0f1c2e 0%, #1a1a2e 100%)",shadow:"rgba(69, 162, 233, 0.3)"},YORUKA:{primary:"#a855f7",gradient:"linear-gradient(135deg, #1a0f2e 0%, #1a1a2e 100%)",shadow:"rgba(168, 85, 247, 0.3)"}},M5={SENKA:"",AJA:"",YORUKA:"Y"},D5={SENKA:R5,AJA:k5,YORUKA:A5},wo=["SENKA","AJA","YORUKA"],N5=({classType:t,onSelectCard:e})=>{const[n,r]=P.useState(1),[s,i]=P.useState(wo.indexOf(t));P.useEffect(()=>{const W=()=>{const G=window.innerWidth/P5,de=window.innerHeight/O5;r(Math.min(G,de))};return W(),window.addEventListener("resize",W),()=>window.removeEventListener("resize",W)},[]);const o=W=>W==="SENKA"?v0:W==="AJA"?x0:_0,l=wo[s],d=o(l).filter(W=>!W.cardId.startsWith("TOKEN_")).map(W=>({card:Sn.find(G=>G.id===W.cardId),count:W.count})).filter(W=>W.card).sort((W,G)=>W.card.cost-G.card.cost),u={};d.forEach(({card:W,count:G})=>{u[W.cost]=(u[W.cost]||0)+G});const h=Math.max(...Object.keys(u).map(Number),10),f=j.useMemo(()=>{let W=1;for(const G of wo){const de=o(G),fe={};de.filter(ae=>!ae.cardId.startsWith("TOKEN_")).forEach(ae=>{const he=Sn.find(be=>be.id===ae.cardId);he&&(fe[he.cost]=(fe[he.cost]||0)+ae.count)});const Ee=Math.max(...Object.values(fe),0);Ee>W&&(W=Ee)}return W},[]),b=L5[l],C=M5[l],k=D5[l],A=180*n,R=250*n,m=110*n,T=155*n,L=.6*n,g=1.8*n,H=()=>{i(W=>(W-1+wo.length)%wo.length)},Q=()=>{i(W=>(W+1)%wo.length)};return a.jsxs("div",{style:{minHeight:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",background:b.gradient,color:"white",position:"relative",paddingTop:`${10*n}px`,paddingBottom:`${120*n}px`},children:[a.jsxs("h2",{style:{fontSize:`${g}rem`,marginTop:"0px",marginBottom:`${10*n}px`,fontFamily:"sans-serif",color:b.primary,textShadow:`0 0 20px ${b.shadow}`},children:[C," - "]}),a.jsxs("div",{style:{display:"flex",gap:`${2*n}rem`,width:"95%",maxWidth:`${1100*n}px`,alignItems:"flex-start",justifyContent:"center"},children:[a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${1.5*n}rem`},children:[a.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:`${.8*n}rem`},children:[a.jsx("button",{onClick:H,style:{width:`${45*n}px`,height:`${45*n}px`,background:"rgba(0, 0, 0, 0.5)",border:`2px solid ${b.primary}`,borderRadius:"50%",color:b.primary,fontSize:`${1.5*n}rem`,cursor:"pointer",fontWeight:"bold",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},onMouseOver:W=>{W.currentTarget.style.background=b.primary,W.currentTarget.style.color="white"},onMouseOut:W=>{W.currentTarget.style.background="rgba(0, 0, 0, 0.5)",W.currentTarget.style.color=b.primary},children:"<"}),a.jsxs("div",{style:{width:A,height:R,border:`3px solid ${b.primary}`,borderRadius:10*n,background:"linear-gradient(180deg, rgba(0,0,0,0.5) 0%, rgba(0,0,0,0.8) 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",boxShadow:`0 8px 30px ${b.shadow}`,overflow:"hidden",position:"relative"},children:[a.jsx("img",{src:k,alt:C,style:{width:"100%",height:"75%",objectFit:"cover"}}),a.jsx("div",{style:{padding:`${8*n}px`,display:"flex",flexDirection:"column",alignItems:"center",width:"100%",justifyContent:"center",flex:1},children:a.jsx("h3",{style:{fontSize:`${1.2*n}rem`,color:b.primary,margin:0,fontFamily:"sans-serif"},children:C})})]}),a.jsx("button",{onClick:Q,style:{width:`${45*n}px`,height:`${45*n}px`,background:"rgba(0, 0, 0, 0.5)",border:`2px solid ${b.primary}`,borderRadius:"50%",color:b.primary,fontSize:`${1.5*n}rem`,cursor:"pointer",fontWeight:"bold",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},onMouseOver:W=>{W.currentTarget.style.background=b.primary,W.currentTarget.style.color="white"},onMouseOut:W=>{W.currentTarget.style.background="rgba(0, 0, 0, 0.5)",W.currentTarget.style.color=b.primary},children:">"})]}),a.jsxs("div",{style:{width:A+45*2*n+.8*2*n*16,padding:`${12*n}px`,background:"rgba(0, 0, 0, 0.5)",borderRadius:8*n,border:`1px solid ${b.primary}30`},children:[a.jsx("h4",{style:{fontSize:`${.8*n}rem`,margin:`0 0 ${8*n}px 0`,color:b.primary,textAlign:"center",fontFamily:"sans-serif"},children:""}),a.jsx("div",{style:{display:"flex",alignItems:"flex-end",justifyContent:"space-between",height:`${100*n}px`,gap:`${2*n}px`,borderBottom:`1px solid ${b.primary}40`,paddingBottom:`${4*n}px`},children:Array.from({length:h+1},(W,G)=>{const de=u[G]||0,fe=f>0?de/f*80*n:0;return a.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:`${2*n}px`},children:[de>0&&a.jsx("div",{style:{fontSize:`${.6*n}rem`,color:b.primary,fontWeight:"bold",fontFamily:"sans-serif"},children:de}),a.jsx("div",{style:{width:"100%",height:`${fe}px`,background:de>0?`linear-gradient(180deg, ${b.primary} 0%, ${b.primary}80 100%)`:"transparent",borderRadius:`${2*n}px`,transition:"all 0.3s",boxShadow:de>0?`0 0 8px ${b.shadow}`:"none"}}),a.jsx("div",{style:{fontSize:`${.65*n}rem`,color:"#aaa",fontFamily:"sans-serif"},children:G})]},G)})})]})]}),a.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:`${1*n}rem`},children:[a.jsx("div",{style:{display:"grid",gridTemplateColumns:`repeat(auto-fill, minmax(${m}px, 1fr))`,gap:`${L}rem`,width:"100%",padding:`${10*n}px`,maxHeight:`${(T+L*16)*3+40*n}px`,overflowY:"auto",overflowX:"hidden"},children:d.map(({card:W,count:G})=>a.jsxs("div",{onClick:()=>e(W.id),style:{width:m,height:T,border:`2px solid ${b.primary}`,borderRadius:8*n,background:"linear-gradient(180deg, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.9) 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"all 0.2s",boxShadow:`0 4px 15px ${b.shadow}`,position:"relative",overflow:"hidden"},onMouseOver:de=>{de.currentTarget.style.transform="translateY(-5px) scale(1.05)",de.currentTarget.style.boxShadow=`0 8px 25px ${b.shadow}`},onMouseOut:de=>{de.currentTarget.style.transform="translateY(0) scale(1)",de.currentTarget.style.boxShadow=`0 4px 15px ${b.shadow}`},children:[a.jsx("div",{style:{width:"100%",height:"65%",overflow:"hidden",borderBottom:`1px solid ${b.primary}`},children:a.jsx("img",{src:af(W.imageUrl||`/cards/${W.id}.png`),alt:W.name,style:{width:"100%",height:"100%",objectFit:"cover"},onError:de=>{de.currentTarget.style.display="none"}})}),a.jsxs("div",{style:{padding:`${5*n}px`,textAlign:"center",flex:1,display:"flex",flexDirection:"column",justifyContent:"center",width:"100%"},children:[a.jsx("h3",{style:{fontSize:`${.7*n}rem`,margin:`0 0 ${3*n}px 0`,fontFamily:"sans-serif",color:b.primary,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:W.name}),a.jsxs("p",{style:{fontSize:`${.6*n}rem`,color:"#ffcc00",margin:0,fontFamily:"sans-serif",fontWeight:"bold"},children:[": ",W.cost]})]}),a.jsx("div",{style:{position:"absolute",bottom:`${5*n}px`,right:`${5*n}px`,background:"rgba(0, 0, 0, 0.8)",color:"white",borderRadius:50,width:`${22*n}px`,height:`${22*n}px`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${.7*n}rem`,fontWeight:"bold",fontFamily:"sans-serif",border:`2px solid ${b.primary}`,boxShadow:`0 0 10px ${b.shadow}`},children:G})]},W.id))}),a.jsxs("div",{style:{fontSize:`${.85*n}rem`,color:"#aaa",fontFamily:"sans-serif",textAlign:"center"},children:[" ",d.length," "]})]})]})]})},$5=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},j5=1280,F5=720,U5=({cardId:t,allCardIds:e=[],onNavigate:n,onOpenRelatedCard:r,onBack:s,onSetHomeCard:i})=>{const[o,l]=P.useState(1),[c,d]=P.useState(!1);P.useEffect(()=>{const L=()=>{const g=window.innerWidth/j5,H=window.innerHeight/F5;l(Math.min(g,H))};return L(),window.addEventListener("resize",L),()=>window.removeEventListener("resize",L)},[]);const u=Sn.find(L=>L.id===t);if(!u)return a.jsx("div",{style:{minHeight:"100dvh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",fontFamily:"sans-serif",fontSize:`${1.5*o}rem`},children:""});const h=(L,g)=>$5(L||g),f=h(u.imageUrl,`/cards/${u.id}.png`),b=u.type==="FOLLOWER"?h(u.evolvedImageUrl,`/cards/${u.id}_evolved.png`):null,C=200*o,k=280*o,A=1*o,R="linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #1a1a2e 100%)",m=()=>{console.log(" GalleryCardDetailScreen handleSetHomeCard called with cardId:",t),i?(console.log(" Calling onSetHomeCard callback"),i(t),d(!0),setTimeout(()=>d(!1),1500)):console.warn(" onSetHomeCard callback is not provided")},T=e.length>1&&n;return a.jsxs("div",{style:{minHeight:"100dvh",display:"flex",flexDirection:"column",background:R,color:"white",fontFamily:"sans-serif",overflow:"auto",paddingTop:`${20*o}px`},children:[a.jsx("div",{style:{position:"absolute",top:`${15*o}px`,left:`${15*o}px`,zIndex:100},children:a.jsx("button",{onClick:s,style:{background:"rgba(255, 255, 255, 0.1)",padding:`${8*o}px ${16*o}px`,fontSize:`${.9*o}rem`,border:"1px solid rgba(255, 255, 255, 0.3)",borderRadius:`${6*o}px`,color:"white",cursor:"pointer",fontFamily:"sans-serif",transition:"all 0.2s"},onMouseOver:L=>L.currentTarget.style.background="rgba(255, 255, 255, 0.2)",onMouseOut:L=>L.currentTarget.style.background="rgba(255, 255, 255, 0.1)",children:""})}),T&&a.jsx("div",{style:{position:"absolute",left:`${20*o}px`,top:"50%",transform:"translateY(-50%)",zIndex:100},children:a.jsx("button",{onClick:()=>n("prev"),style:{width:`${60*o}px`,height:`${60*o}px`,background:"rgba(0, 0, 0, 0.6)",border:"2px solid rgba(255, 255, 255, 0.3)",borderRadius:"50%",color:"white",fontSize:`${2*o}rem`,cursor:"pointer",fontWeight:"bold",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},onMouseOver:L=>{L.currentTarget.style.background="rgba(255, 255, 255, 0.2)",L.currentTarget.style.transform="scale(1.1)"},onMouseOut:L=>{L.currentTarget.style.background="rgba(0, 0, 0, 0.6)",L.currentTarget.style.transform="scale(1)"},children:"<"})}),T&&a.jsx("div",{style:{position:"absolute",right:`${20*o}px`,top:"50%",transform:"translateY(-50%)",zIndex:100},children:a.jsx("button",{onClick:()=>n("next"),style:{width:`${60*o}px`,height:`${60*o}px`,background:"rgba(0, 0, 0, 0.6)",border:"2px solid rgba(255, 255, 255, 0.3)",borderRadius:"50%",color:"white",fontSize:`${2*o}rem`,cursor:"pointer",fontWeight:"bold",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},onMouseOver:L=>{L.currentTarget.style.background="rgba(255, 255, 255, 0.2)",L.currentTarget.style.transform="scale(1.1)"},onMouseOut:L=>{L.currentTarget.style.background="rgba(0, 0, 0, 0.6)",L.currentTarget.style.transform="scale(1)"},children:">"})}),a.jsxs("div",{style:{display:"flex",gap:`${2*o}rem`,padding:`${20*o}px ${30*o}px`,flex:1,justifyContent:"center",alignItems:"flex-start",maxWidth:`${1200*o}px`,width:"100%",margin:"0 auto"},children:[a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${1*o}rem`,flex:"0 0 auto",width:`${C*2+A*16}px`},children:[a.jsx("div",{style:{display:"flex",flexDirection:"row",alignItems:"flex-start",justifyContent:u.type==="SPELL"?"center":"flex-start",gap:`${A}rem`,width:"100%"},children:u.type==="FOLLOWER"?a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*o}rem`},children:[a.jsx("div",{style:{width:C,height:k,border:"2px solid rgba(255, 255, 255, 0.3)",borderRadius:`${12*o}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.5)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:f,alt:`${u.name} `,style:{width:"100%",height:"100%",objectFit:"cover"}})}),a.jsx("div",{style:{fontSize:`${.75*o}rem`,color:"#aaa",textAlign:"center"},children:""})]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*o}rem`},children:[a.jsx("div",{style:{width:C,height:k,border:"2px solid rgba(255, 215, 0, 0.5)",borderRadius:`${12*o}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(255, 215, 0, 0.3)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:b||f,alt:`${u.name} `,style:{width:"100%",height:"100%",objectFit:"cover"}})}),a.jsx("div",{style:{fontSize:`${.75*o}rem`,color:"#ffd700",textAlign:"center"},children:""})]})]}):a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*o}rem`},children:[a.jsx("div",{style:{width:C,height:k,border:"2px solid rgba(138, 43, 226, 0.5)",borderRadius:`${12*o}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(138, 43, 226, 0.3)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:f,alt:u.name,style:{width:"100%",height:"100%",objectFit:"cover"}})}),a.jsx("div",{style:{fontSize:`${.75*o}rem`,height:`${.75*o*1.5}rem`,visibility:"hidden"}})]})}),a.jsxs("div",{style:{display:"flex",gap:`${12*o}px`,flexWrap:"wrap",width:"100%",justifyContent:"center"},children:[a.jsx("button",{onClick:m,disabled:c,style:{padding:`${.9*o}rem ${1.8*o}rem`,background:c?"#10b981":"#3b82f6",color:"white",border:"none",borderRadius:`${8*o}px`,fontSize:`${1*o}rem`,fontWeight:"bold",fontFamily:"sans-serif",cursor:c?"default":"pointer",transition:"all 0.2s",boxShadow:c?"0 4px 15px rgba(16, 185, 129, 0.3)":"0 4px 15px rgba(59, 130, 246, 0.3)",flex:1,minWidth:`${150*o}px`},onMouseOver:L=>{c||(L.currentTarget.style.background="#2563eb",L.currentTarget.style.transform="translateY(-2px)",L.currentTarget.style.boxShadow="0 6px 20px rgba(59, 130, 246, 0.4)")},onMouseOut:L=>{c||(L.currentTarget.style.background="#3b82f6",L.currentTarget.style.transform="translateY(0)",L.currentTarget.style.boxShadow="0 4px 15px rgba(59, 130, 246, 0.3)")},children:c?" ":""}),u.relatedCards&&u.relatedCards.length>0&&a.jsxs("button",{onClick:()=>r(t),style:{padding:`${.9*o}rem ${1.8*o}rem`,background:"#4ade80",color:"white",border:"none",borderRadius:`${8*o}px`,fontSize:`${1*o}rem`,fontWeight:"bold",fontFamily:"sans-serif",cursor:"pointer",transition:"all 0.2s",boxShadow:"0 4px 15px rgba(74, 222, 128, 0.3)",flex:1,minWidth:`${150*o}px`},onMouseOver:L=>{L.currentTarget.style.background="#22c55e",L.currentTarget.style.transform="translateY(-2px)",L.currentTarget.style.boxShadow="0 6px 20px rgba(74, 222, 128, 0.4)"},onMouseOut:L=>{L.currentTarget.style.background="#4ade80",L.currentTarget.style.transform="translateY(0)",L.currentTarget.style.boxShadow="0 4px 15px rgba(74, 222, 128, 0.3)"},children:[" (",u.relatedCards.length,")"]})]})]}),a.jsxs("div",{style:{flex:"0 0 auto",width:`${450*o}px`,background:"rgba(0, 0, 0, 0.5)",padding:`${25*o}px`,borderRadius:`${12*o}px`,border:"1px solid rgba(255, 255, 255, 0.2)",display:"flex",flexDirection:"column",gap:`${18*o}px`,minHeight:`${450*o}px`,maxHeight:`${550*o}px`,overflowY:"auto"},children:[a.jsx("h2",{style:{fontSize:`${1.8*o}rem`,fontWeight:"bold",margin:0,color:"#fff",textAlign:"left"},children:u.name}),a.jsxs("div",{style:{display:"flex",gap:`${20*o}px`,fontSize:`${1.2*o}rem`,flexWrap:"wrap"},children:[a.jsxs("div",{style:{color:"#ffd700"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:u.cost})]}),u.type==="FOLLOWER"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{color:"#ff6b6b"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:u.attack})]}),a.jsxs("div",{style:{color:"#4ecdc4"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:u.health})]})]})]}),a.jsx("div",{style:{height:"1px",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)"}}),a.jsxs("div",{children:[a.jsx("h3",{style:{fontSize:`${1.1*o}rem`,margin:`0 0 ${8*o}px 0`,color:"#aaa"},children:""}),a.jsx("p",{style:{fontSize:`${1*o}rem`,margin:0,whiteSpace:"pre-wrap",lineHeight:1.7,color:"#fff"},children:u.description})]}),u.flavorText&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{height:"1px",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)"}}),a.jsxs("div",{children:[a.jsx("h3",{style:{fontSize:`${1.1*o}rem`,margin:`0 0 ${8*o}px 0`,color:"#aaa"},children:""}),a.jsx("p",{style:{fontSize:`${.95*o}rem`,margin:0,fontStyle:"italic",opacity:.7,lineHeight:1.7,whiteSpace:"pre-wrap",color:"#ccc"},children:u.flavorText})]})]})]})]})]})},B5=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},z5=1280,H5=720,W5=({parentCardId:t,relatedCardIds:e,onBack:n})=>{const[r,s]=P.useState(1),[i,o]=P.useState(0);P.useEffect(()=>{const T=()=>{const L=window.innerWidth/z5,g=window.innerHeight/H5;s(Math.min(L,g))};return T(),window.addEventListener("resize",T),()=>window.removeEventListener("resize",T)},[]);const l=e[i],c=Sn.find(T=>T.id===l),d=()=>{o(T=>T>0?T-1:e.length-1)},u=()=>{o(T=>T<e.length-1?T+1:0)};if(!c)return a.jsx("div",{style:{minHeight:"100dvh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",fontFamily:"Tamanegi, sans-serif",fontSize:`${1.5*r}rem`},children:""});const h=(T,L)=>B5(T||L),f=h(c.imageUrl,`/cards/${c.id}.png`),b=c.type==="FOLLOWER"?h(c.evolvedImageUrl,`/cards/${c.id}_evolved.png`):null,C=200*r,k=280*r,A=1*r,R="linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #1a1a2e 100%)",m={fontSize:`${2*r}rem`,background:"rgba(0, 0, 0, 0.5)",padding:`${.8*r}rem ${1.2*r}rem`,borderRadius:`${8*r}px`,cursor:"pointer",border:"1px solid rgba(255, 255, 255, 0.2)",color:"white",transition:"all 0.2s",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center"};return a.jsxs("div",{style:{minHeight:"100dvh",display:"flex",flexDirection:"column",background:R,color:"white",fontFamily:"sans-serif",overflow:"auto",paddingTop:`${20*r}px`},children:[a.jsx("div",{style:{position:"absolute",top:`${15*r}px`,left:`${15*r}px`,zIndex:100},children:a.jsx("button",{onClick:n,style:{background:"rgba(255, 255, 255, 0.1)",padding:`${8*r}px ${16*r}px`,fontSize:`${.9*r}rem`,border:"1px solid rgba(255, 255, 255, 0.3)",borderRadius:`${6*r}px`,color:"white",cursor:"pointer",fontFamily:"sans-serif",transition:"all 0.2s"},onMouseOver:T=>T.currentTarget.style.background="rgba(255, 255, 255, 0.2)",onMouseOut:T=>T.currentTarget.style.background="rgba(255, 255, 255, 0.1)",children:""})}),a.jsxs("div",{style:{position:"absolute",top:`${15*r}px`,right:`${15*r}px`,zIndex:100,fontSize:`${1*r}rem`,opacity:.8,fontWeight:"bold",background:"rgba(0, 0, 0, 0.5)",padding:`${8*r}px ${16*r}px`,borderRadius:`${6*r}px`,border:"1px solid rgba(255, 255, 255, 0.2)"},children:[i+1," / ",e.length]}),a.jsx("button",{onClick:d,style:{...m,position:"absolute",left:`${15*r}px`,top:"50%",transform:"translateY(-50%)",zIndex:100},onMouseOver:T=>T.currentTarget.style.background="rgba(0, 0, 0, 0.7)",onMouseOut:T=>T.currentTarget.style.background="rgba(0, 0, 0, 0.5)",children:"<"}),a.jsx("button",{onClick:u,style:{...m,position:"absolute",right:`${15*r}px`,top:"50%",transform:"translateY(-50%)",zIndex:100},onMouseOver:T=>T.currentTarget.style.background="rgba(0, 0, 0, 0.7)",onMouseOut:T=>T.currentTarget.style.background="rgba(0, 0, 0, 0.5)",children:">"}),a.jsxs("div",{style:{display:"flex",gap:`${2*r}rem`,padding:`${20*r}px ${30*r}px`,flex:1,justifyContent:"center",alignItems:"flex-start",maxWidth:`${1200*r}px`,width:"100%",margin:"0 auto"},children:[a.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${1*r}rem`,flex:"0 0 auto",width:`${C*2+A*16}px`},children:a.jsx("div",{style:{display:"flex",flexDirection:"row",alignItems:"flex-start",justifyContent:c.type==="SPELL"?"center":"flex-start",gap:`${A}rem`,width:"100%"},children:c.type==="FOLLOWER"?a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*r}rem`},children:[a.jsx("div",{style:{width:C,height:k,border:"2px solid rgba(255, 255, 255, 0.3)",borderRadius:`${12*r}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.5)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:f,alt:`${c.name} `,style:{width:"100%",height:"100%",objectFit:"cover"}})}),a.jsx("div",{style:{fontSize:`${.75*r}rem`,color:"#aaa",textAlign:"center"},children:""})]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*r}rem`},children:[a.jsx("div",{style:{width:C,height:k,border:"2px solid rgba(255, 215, 0, 0.5)",borderRadius:`${12*r}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(255, 215, 0, 0.3)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:b||f,alt:`${c.name} `,style:{width:"100%",height:"100%",objectFit:"cover"}})}),a.jsx("div",{style:{fontSize:`${.75*r}rem`,color:"#ffd700",textAlign:"center"},children:""})]})]}):a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*r}rem`},children:[a.jsx("div",{style:{width:C,height:k,border:"2px solid rgba(138, 43, 226, 0.5)",borderRadius:`${12*r}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(138, 43, 226, 0.3)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:f,alt:c.name,style:{width:"100%",height:"100%",objectFit:"cover"}})}),a.jsx("div",{style:{fontSize:`${.75*r}rem`,height:`${.75*r*1.5}rem`,visibility:"hidden"}})]})})}),a.jsxs("div",{style:{flex:"0 0 auto",width:`${450*r}px`,background:"rgba(0, 0, 0, 0.5)",padding:`${25*r}px`,borderRadius:`${12*r}px`,border:"1px solid rgba(255, 255, 255, 0.2)",display:"flex",flexDirection:"column",gap:`${18*r}px`,minHeight:`${450*r}px`,maxHeight:`${550*r}px`,overflowY:"auto"},children:[a.jsx("h2",{style:{fontSize:`${1.8*r}rem`,fontWeight:"bold",margin:0,color:"#fff",textAlign:"left"},children:c.name}),a.jsxs("div",{style:{display:"flex",gap:`${20*r}px`,fontSize:`${1.2*r}rem`,flexWrap:"wrap"},children:[a.jsxs("div",{style:{color:"#ffd700"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:c.cost})]}),c.type==="FOLLOWER"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{color:"#ff6b6b"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:c.attack})]}),a.jsxs("div",{style:{color:"#4ecdc4"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:c.health})]})]})]}),a.jsx("div",{style:{height:"1px",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)"}}),a.jsxs("div",{children:[a.jsx("h3",{style:{fontSize:`${1.1*r}rem`,margin:`0 0 ${8*r}px 0`,color:"#aaa"},children:""}),a.jsx("p",{style:{fontSize:`${1*r}rem`,margin:0,whiteSpace:"pre-wrap",lineHeight:1.7,color:"#fff"},children:c.description})]}),c.flavorText&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{height:"1px",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)"}}),a.jsxs("div",{children:[a.jsx("h3",{style:{fontSize:`${1.1*r}rem`,margin:`0 0 ${8*r}px 0`,color:"#aaa"},children:""}),a.jsx("p",{style:{fontSize:`${.95*r}rem`,margin:0,fontStyle:"italic",opacity:.7,lineHeight:1.7,whiteSpace:"pre-wrap",color:"#ccc"},children:c.flavorText})]})]})]})]})]})},G5=()=>{};var xv={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vb={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ge=function(t,e){if(!t)throw xa(e)},xa=function(t){return new Error("Firebase Database ("+vb.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xb=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},V5=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=t[n++],o=t[n++],l=t[n++],c=((s&7)<<18|(i&63)<<12|(o&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{const i=t[n++],o=t[n++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},b0={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<t.length;s+=3){const i=t[s],o=s+1<t.length,l=o?t[s+1]:0,c=s+2<t.length,d=c?t[s+2]:0,u=i>>2,h=(i&3)<<4|l>>4;let f=(l&15)<<2|d>>6,b=d&63;c||(b=64,o||(f=64)),r.push(n[u],n[h],n[f],n[b])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(xb(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):V5(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<t.length;){const i=n[t.charAt(s++)],l=s<t.length?n[t.charAt(s)]:0;++s;const d=s<t.length?n[t.charAt(s)]:64;++s;const h=s<t.length?n[t.charAt(s)]:64;if(++s,i==null||l==null||d==null||h==null)throw new Y5;const f=i<<2|l>>4;if(r.push(f),d!==64){const b=l<<4&240|d>>2;if(r.push(b),h!==64){const C=d<<6&192|h;r.push(C)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class Y5 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const _b=function(t){const e=xb(t);return b0.encodeByteArray(e,!0)},vu=function(t){return _b(t).replace(/\./g,"")},xu=function(t){try{return b0.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K5(t){return bb(void 0,t)}function bb(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const n=e;return new Date(n.getTime());case Object:t===void 0&&(t={});break;case Array:t=[];break;default:return e}for(const n in e)!e.hasOwnProperty(n)||!X5(n)||(t[n]=bb(t[n],e[n]));return t}function X5(t){return t!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function J5(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q5=()=>J5().__FIREBASE_DEFAULTS__,q5=()=>{if(typeof process>"u"||typeof xv>"u")return;const t=xv.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},Z5=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&xu(t[1]);return e&&JSON.parse(e)},E0=()=>{try{return G5()||Q5()||q5()||Z5()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},Eb=t=>{var e,n;return(n=(e=E0())==null?void 0:e.emulatorHosts)==null?void 0:n[t]},eT=t=>{const e=Eb(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},Sb=()=>{var t;return(t=E0())==null?void 0:t.config},wb=t=>{var e;return(e=E0())==null?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mr{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _a(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Ib(t){return(await fetch(t,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tT(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",s=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...t};return[vu(JSON.stringify(n)),vu(JSON.stringify(o)),""].join(".")}const _l={};function nT(){const t={prod:[],emulator:[]};for(const e of Object.keys(_l))_l[e]?t.emulator.push(e):t.prod.push(e);return t}function rT(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let _v=!1;function Tb(t,e){if(typeof window>"u"||typeof document>"u"||!_a(window.location.host)||_l[t]===e||_l[t]||_v)return;_l[t]=e;function n(f){return`__firebase__banner__${f}`}const r="__firebase__banner",i=nT().prod.length>0;function o(){const f=document.getElementById(r);f&&f.remove()}function l(f){f.style.display="flex",f.style.background="#7faaf0",f.style.position="fixed",f.style.bottom="5px",f.style.left="5px",f.style.padding=".5em",f.style.borderRadius="5px",f.style.alignItems="center"}function c(f,b){f.setAttribute("width","24"),f.setAttribute("id",b),f.setAttribute("height","24"),f.setAttribute("viewBox","0 0 24 24"),f.setAttribute("fill","none"),f.style.marginLeft="-6px"}function d(){const f=document.createElement("span");return f.style.cursor="pointer",f.style.marginLeft="16px",f.style.fontSize="24px",f.innerHTML=" &times;",f.onclick=()=>{_v=!0,o()},f}function u(f,b){f.setAttribute("id",b),f.innerText="Learn more",f.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",f.setAttribute("target","__blank"),f.style.paddingLeft="5px",f.style.textDecoration="underline"}function h(){const f=rT(r),b=n("text"),C=document.getElementById(b)||document.createElement("span"),k=n("learnmore"),A=document.getElementById(k)||document.createElement("a"),R=n("preprendIcon"),m=document.getElementById(R)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(f.created){const T=f.element;l(T),u(A,k);const L=d();c(m,R),T.append(m,C,A,L),document.body.appendChild(T)}i?(C.innerText="Preview backend disconnected.",m.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(m.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,C.innerText="Preview backend running in this workspace."),C.setAttribute("id",b)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",h):h()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function S0(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Bn())}function sT(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function iT(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function Cb(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function oT(){const t=Bn();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function aT(){return vb.NODE_ADMIN===!0}function lT(){try{return typeof indexedDB=="object"}catch{return!1}}function cT(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var i;e(((i=s.error)==null?void 0:i.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dT="FirebaseError";class _i extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=dT,Object.setPrototypeOf(this,_i.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,pc.prototype.create)}}class pc{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?uT(i,r):"Error",l=`${this.serviceName}: ${o} (${s}).`;return new _i(s,l,r)}}function uT(t,e){return t.replace(fT,(n,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const fT=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kl(t){return JSON.parse(t)}function ln(t){return JSON.stringify(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kb=function(t){let e={},n={},r={},s="";try{const i=t.split(".");e=Kl(xu(i[0])||""),n=Kl(xu(i[1])||""),s=i[2],r=n.d||{},delete n.d}catch{}return{header:e,claims:n,data:r,signature:s}},hT=function(t){const e=kb(t),n=e.claims;return!!n&&typeof n=="object"&&n.hasOwnProperty("iat")},pT=function(t){const e=kb(t).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hr(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Gi(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}function _u(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function bu(t,e,n){const r={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(r[s]=e.call(n,t[s],s,t));return r}function Vi(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const i=t[s],o=e[s];if(bv(i)&&bv(o)){if(!Vi(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function bv(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ba(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function ll(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function cl(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gT{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,n){n||(n=0);const r=this.W_;if(typeof e=="string")for(let h=0;h<16;h++)r[h]=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),n+=4;else for(let h=0;h<16;h++)r[h]=e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3],n+=4;for(let h=16;h<80;h++){const f=r[h-3]^r[h-8]^r[h-14]^r[h-16];r[h]=(f<<1|f>>>31)&4294967295}let s=this.chain_[0],i=this.chain_[1],o=this.chain_[2],l=this.chain_[3],c=this.chain_[4],d,u;for(let h=0;h<80;h++){h<40?h<20?(d=l^i&(o^l),u=1518500249):(d=i^o^l,u=1859775393):h<60?(d=i&o|l&(i|o),u=2400959708):(d=i^o^l,u=3395469782);const f=(s<<5|s>>>27)+d+c+u+r[h]&4294967295;c=l,l=o,o=(i<<30|i>>>2)&4294967295,i=s,s=f}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+i&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,n){if(e==null)return;n===void 0&&(n=e.length);const r=n-this.blockSize;let s=0;const i=this.buf_;let o=this.inbuf_;for(;s<n;){if(o===0)for(;s<=r;)this.compress_(e,s),s+=this.blockSize;if(typeof e=="string"){for(;s<n;)if(i[o]=e.charCodeAt(s),++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}else for(;s<n;)if(i[o]=e[s],++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=n}digest(){const e=[];let n=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=n&255,n/=256;this.compress_(this.buf_);let r=0;for(let s=0;s<5;s++)for(let i=24;i>=0;i-=8)e[r]=this.chain_[s]>>i&255,++r;return e}}function mT(t,e){const n=new yT(t,e);return n.subscribe.bind(n)}class yT{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let s;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");vT(e,["next","error","complete"])?s=e:s={next:e,error:n,complete:r},s.next===void 0&&(s.next=Ah),s.error===void 0&&(s.error=Ah),s.complete===void 0&&(s.complete=Ah);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function vT(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function Ah(){}function la(t,e){return`${t} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xT=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);if(s>=55296&&s<=56319){const i=s-55296;r++,ge(r<t.length,"Surrogate pair missing trail surrogate.");const o=t.charCodeAt(r)-56320;s=65536+(i<<10)+o}s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):s<65536?(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},lf=function(t){let e=0;for(let n=0;n<t.length;n++){const r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,n++):e+=3}return e};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dn(t){return t&&t._delegate?t._delegate:t}class Yi{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pi="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _T{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new Mr;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:n});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(ET(e))try{this.getOrInitializeService({instanceIdentifier:Pi})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(n);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Pi){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Pi){return this.instances.has(e)}getOptions(e=Pi){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[i,o]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);r===l&&o.resolve(s)}return s}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const s of r)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:bT(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Pi){return this.component?this.component.multipleInstances?e:Pi:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function bT(t){return t===Pi?void 0:t}function ET(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ST{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new _T(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Dt;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(Dt||(Dt={}));const wT={debug:Dt.DEBUG,verbose:Dt.VERBOSE,info:Dt.INFO,warn:Dt.WARN,error:Dt.ERROR,silent:Dt.SILENT},IT=Dt.INFO,TT={[Dt.DEBUG]:"log",[Dt.VERBOSE]:"log",[Dt.INFO]:"info",[Dt.WARN]:"warn",[Dt.ERROR]:"error"},CT=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),s=TT[e];if(s)console[s](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class w0{constructor(e){this.name=e,this._logLevel=IT,this._logHandler=CT,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Dt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?wT[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Dt.DEBUG,...e),this._logHandler(this,Dt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Dt.VERBOSE,...e),this._logHandler(this,Dt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Dt.INFO,...e),this._logHandler(this,Dt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Dt.WARN,...e),this._logHandler(this,Dt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Dt.ERROR,...e),this._logHandler(this,Dt.ERROR,...e)}}const kT=(t,e)=>e.some(n=>t instanceof n);let Ev,Sv;function RT(){return Ev||(Ev=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function AT(){return Sv||(Sv=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Rb=new WeakMap,zp=new WeakMap,Ab=new WeakMap,Ph=new WeakMap,I0=new WeakMap;function PT(t){const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("success",i),t.removeEventListener("error",o)},i=()=>{n(si(t.result)),s()},o=()=>{r(t.error),s()};t.addEventListener("success",i),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&Rb.set(n,t)}).catch(()=>{}),I0.set(e,t),e}function OT(t){if(zp.has(t))return;const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",o),t.removeEventListener("abort",o)},i=()=>{n(),s()},o=()=>{r(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",i),t.addEventListener("error",o),t.addEventListener("abort",o)});zp.set(t,e)}let Hp={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return zp.get(t);if(e==="objectStoreNames")return t.objectStoreNames||Ab.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return si(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function LT(t){Hp=t(Hp)}function MT(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(Oh(this),e,...n);return Ab.set(r,e.sort?e.sort():[e]),si(r)}:AT().includes(t)?function(...e){return t.apply(Oh(this),e),si(Rb.get(this))}:function(...e){return si(t.apply(Oh(this),e))}}function DT(t){return typeof t=="function"?MT(t):(t instanceof IDBTransaction&&OT(t),kT(t,RT())?new Proxy(t,Hp):t)}function si(t){if(t instanceof IDBRequest)return PT(t);if(Ph.has(t))return Ph.get(t);const e=DT(t);return e!==t&&(Ph.set(t,e),I0.set(e,t)),e}const Oh=t=>I0.get(t);function NT(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(t,e),l=si(o);return r&&o.addEventListener("upgradeneeded",c=>{r(si(o.result),c.oldVersion,c.newVersion,si(o.transaction),c)}),n&&o.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),l.then(c=>{i&&c.addEventListener("close",()=>i()),s&&c.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),l}const $T=["get","getKey","getAll","getAllKeys","count"],jT=["put","add","delete","clear"],Lh=new Map;function wv(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Lh.get(e))return Lh.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=jT.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||$T.includes(n)))return;const i=async function(o,...l){const c=this.transaction(o,s?"readwrite":"readonly");let d=c.store;return r&&(d=d.index(l.shift())),(await Promise.all([d[n](...l),s&&c.done]))[0]};return Lh.set(e,i),i}LT(t=>({...t,get:(e,n,r)=>wv(e,n)||t.get(e,n,r),has:(e,n)=>!!wv(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FT{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(UT(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function UT(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Wp="@firebase/app",Iv="0.14.6";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xs=new w0("@firebase/app"),BT="@firebase/app-compat",zT="@firebase/analytics-compat",HT="@firebase/analytics",WT="@firebase/app-check-compat",GT="@firebase/app-check",VT="@firebase/auth",YT="@firebase/auth-compat",KT="@firebase/database",XT="@firebase/data-connect",JT="@firebase/database-compat",QT="@firebase/functions",qT="@firebase/functions-compat",ZT="@firebase/installations",eC="@firebase/installations-compat",tC="@firebase/messaging",nC="@firebase/messaging-compat",rC="@firebase/performance",sC="@firebase/performance-compat",iC="@firebase/remote-config",oC="@firebase/remote-config-compat",aC="@firebase/storage",lC="@firebase/storage-compat",cC="@firebase/firestore",dC="@firebase/ai",uC="@firebase/firestore-compat",fC="firebase",hC="12.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gp="[DEFAULT]",pC={[Wp]:"fire-core",[BT]:"fire-core-compat",[HT]:"fire-analytics",[zT]:"fire-analytics-compat",[GT]:"fire-app-check",[WT]:"fire-app-check-compat",[VT]:"fire-auth",[YT]:"fire-auth-compat",[KT]:"fire-rtdb",[XT]:"fire-data-connect",[JT]:"fire-rtdb-compat",[QT]:"fire-fn",[qT]:"fire-fn-compat",[ZT]:"fire-iid",[eC]:"fire-iid-compat",[tC]:"fire-fcm",[nC]:"fire-fcm-compat",[rC]:"fire-perf",[sC]:"fire-perf-compat",[iC]:"fire-rc",[oC]:"fire-rc-compat",[aC]:"fire-gcs",[lC]:"fire-gcs-compat",[cC]:"fire-fst",[uC]:"fire-fst-compat",[dC]:"fire-vertex","fire-js":"fire-js",[fC]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Eu=new Map,gC=new Map,Vp=new Map;function Tv(t,e){try{t.container.addComponent(e)}catch(n){xs.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function ca(t){const e=t.name;if(Vp.has(e))return xs.debug(`There were multiple attempts to register component ${e}.`),!1;Vp.set(e,t);for(const n of Eu.values())Tv(n,t);for(const n of gC.values())Tv(n,t);return!0}function T0(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function _r(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mC={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ii=new pc("app","Firebase",mC);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yC{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Yi("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ii.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ea=hC;function Pb(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:Gp,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw ii.create("bad-app-name",{appName:String(s)});if(n||(n=Sb()),!n)throw ii.create("no-options");const i=Eu.get(s);if(i){if(Vi(n,i.options)&&Vi(r,i.config))return i;throw ii.create("duplicate-app",{appName:s})}const o=new ST(s);for(const c of Vp.values())o.addComponent(c);const l=new yC(n,r,o);return Eu.set(s,l),l}function Ob(t=Gp){const e=Eu.get(t);if(!e&&t===Gp&&Sb())return Pb();if(!e)throw ii.create("no-app",{appName:t});return e}function oi(t,e,n){let r=pC[t]??t;n&&(r+=`-${n}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const o=[`Unable to register library "${r}" with version "${e}":`];s&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),xs.warn(o.join(" "));return}ca(new Yi(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vC="firebase-heartbeat-database",xC=1,Xl="firebase-heartbeat-store";let Mh=null;function Lb(){return Mh||(Mh=NT(vC,xC,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Xl)}catch(n){console.warn(n)}}}}).catch(t=>{throw ii.create("idb-open",{originalErrorMessage:t.message})})),Mh}async function _C(t){try{const n=(await Lb()).transaction(Xl),r=await n.objectStore(Xl).get(Mb(t));return await n.done,r}catch(e){if(e instanceof _i)xs.warn(e.message);else{const n=ii.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});xs.warn(n.message)}}}async function Cv(t,e){try{const r=(await Lb()).transaction(Xl,"readwrite");await r.objectStore(Xl).put(e,Mb(t)),await r.done}catch(n){if(n instanceof _i)xs.warn(n.message);else{const r=ii.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});xs.warn(r.message)}}}function Mb(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bC=1024,EC=30;class SC{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new IC(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=kv();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)==null?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats.length>EC){const o=TC(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){xs.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=kv(),{heartbeatsToSend:r,unsentEntries:s}=wC(this._heartbeatsCache.heartbeats),i=vu(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(n){return xs.warn(n),""}}}function kv(){return new Date().toISOString().substring(0,10)}function wC(t,e=bC){const n=[];let r=t.slice();for(const s of t){const i=n.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),Rv(n)>e){i.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),Rv(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class IC{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return lT()?cT().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await _C(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Cv(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Cv(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function Rv(t){return vu(JSON.stringify({version:2,heartbeats:t})).length}function TC(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CC(t){ca(new Yi("platform-logger",e=>new FT(e),"PRIVATE")),ca(new Yi("heartbeat",e=>new SC(e),"PRIVATE")),oi(Wp,Iv,t),oi(Wp,Iv,"esm2020"),oi("fire-js","")}CC("");var kC="firebase",RC="12.7.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */oi(kC,RC,"app");var Av={};const Pv="@firebase/database",Ov="1.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Db="";function AC(t){Db=t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PC{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,n){n==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),ln(n))}get(e){const n=this.domStorage_.getItem(this.prefixedName_(e));return n==null?null:Kl(n)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OC{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,n){n==null?delete this.cache_[e]:this.cache_[e]=n}get(e){return Hr(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nb=function(t){try{if(typeof window<"u"&&typeof window[t]<"u"){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new PC(e)}}catch{}return new OC},$i=Nb("localStorage"),LC=Nb("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xo=new w0("@firebase/database"),$b=function(){let t=1;return function(){return t++}}(),jb=function(t){const e=xT(t),n=new gT;n.update(e);const r=n.digest();return b0.encodeByteArray(r)},gc=function(...t){let e="";for(let n=0;n<t.length;n++){const r=t[n];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=gc.apply(null,r):typeof r=="object"?e+=ln(r):e+=r,e+=" "}return e};let bl=null,Lv=!0;const MC=function(t,e){ge(!0,"Can't turn on custom loggers persistently."),Xo.logLevel=Dt.VERBOSE,bl=Xo.log.bind(Xo)},pn=function(...t){if(Lv===!0&&(Lv=!1,bl===null&&LC.get("logging_enabled")===!0&&MC()),bl){const e=gc.apply(null,t);bl(e)}},mc=function(t){return function(...e){pn(t,...e)}},Yp=function(...t){const e="FIREBASE INTERNAL ERROR: "+gc(...t);Xo.error(e)},_s=function(...t){const e=`FIREBASE FATAL ERROR: ${gc(...t)}`;throw Xo.error(e),new Error(e)},Un=function(...t){const e="FIREBASE WARNING: "+gc(...t);Xo.warn(e)},DC=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Un("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},cf=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},NC=function(t){if(document.readyState==="complete")t();else{let e=!1;const n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&n()}),window.attachEvent("onload",n))}},da="[MIN_NAME]",Ki="[MAX_NAME]",eo=function(t,e){if(t===e)return 0;if(t===da||e===Ki)return-1;if(e===da||t===Ki)return 1;{const n=Mv(t),r=Mv(e);return n!==null?r!==null?n-r===0?t.length-e.length:n-r:-1:r!==null?1:t<e?-1:1}},$C=function(t,e){return t===e?0:t<e?-1:1},Qa=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+ln(e))},C0=function(t){if(typeof t!="object"||t===null)return ln(t);const e=[];for(const r in t)e.push(r);e.sort();let n="{";for(let r=0;r<e.length;r++)r!==0&&(n+=","),n+=ln(e[r]),n+=":",n+=C0(t[e[r]]);return n+="}",n},Fb=function(t,e){const n=t.length;if(n<=e)return[t];const r=[];for(let s=0;s<n;s+=e)s+e>n?r.push(t.substring(s,n)):r.push(t.substring(s,s+e));return r};function mn(t,e){for(const n in t)t.hasOwnProperty(n)&&e(n,t[n])}const Ub=function(t){ge(!cf(t),"Invalid JSON number");const e=11,n=52,r=(1<<e-1)-1;let s,i,o,l,c;t===0?(i=0,o=0,s=1/t===-1/0?1:0):(s=t<0,t=Math.abs(t),t>=Math.pow(2,1-r)?(l=Math.min(Math.floor(Math.log(t)/Math.LN2),r),i=l+r,o=Math.round(t*Math.pow(2,n-l)-Math.pow(2,n))):(i=0,o=Math.round(t/Math.pow(2,1-r-n))));const d=[];for(c=n;c;c-=1)d.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)d.push(i%2?1:0),i=Math.floor(i/2);d.push(s?1:0),d.reverse();const u=d.join("");let h="";for(c=0;c<64;c+=8){let f=parseInt(u.substr(c,8),2).toString(16);f.length===1&&(f="0"+f),h=h+f}return h.toLowerCase()},jC=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},FC=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function UC(t,e){let n="Unknown Error";t==="too_big"?n="The data requested exceeds the maximum size that can be accessed with a single request.":t==="permission_denied"?n="Client doesn't have permission to access the desired data.":t==="unavailable"&&(n="The service is unavailable");const r=new Error(t+" at "+e._path.toString()+": "+n);return r.code=t.toUpperCase(),r}const BC=new RegExp("^-?(0*)\\d{1,10}$"),zC=-2147483648,HC=2147483647,Mv=function(t){if(BC.test(t)){const e=Number(t);if(e>=zC&&e<=HC)return e}return null},Sa=function(t){try{t()}catch(e){setTimeout(()=>{const n=e.stack||"";throw Un("Exception was thrown by user callback.",n),e},Math.floor(0))}},WC=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},El=function(t,e){const n=setTimeout(t,e);return typeof n=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(n):typeof n=="object"&&n.unref&&n.unref(),n};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GC{constructor(e,n){this.appCheckProvider=n,this.appName=e.name,_r(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=n==null?void 0:n.getImmediate({optional:!0}),this.appCheck||n==null||n.get().then(r=>this.appCheck=r)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((n,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(n,r):n(null)},0)})}addTokenChangeListener(e){var n;(n=this.appCheckProvider)==null||n.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){Un(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VC{constructor(e,n,r){this.appName_=e,this.firebaseOptions_=n,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(n=>n&&n.code==="auth/token-not-initialized"?(pn("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(n)):new Promise((n,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(n,r):n(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(n=>n.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(n=>n.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Un(e)}}class Nd{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Nd.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k0="5",Bb="v",zb="s",Hb="r",Wb="f",Gb=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Vb="ls",Yb="p",Kp="ac",Kb="websocket",Xb="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jb{constructor(e,n,r,s,i=!1,o="",l=!1,c=!1,d=null){this.secure=n,this.namespace=r,this.webSocketOnly=s,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=l,this.isUsingEmulator=c,this.emulatorOptions=d,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=$i.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&$i.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",n=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${n}`}}function YC(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function Qb(t,e,n){ge(typeof e=="string","typeof type must == string"),ge(typeof n=="object","typeof params must == object");let r;if(e===Kb)r=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===Xb)r=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);YC(t)&&(n.ns=t.namespace);const s=[];return mn(n,(i,o)=>{s.push(i+"="+o)}),r+s.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KC{constructor(){this.counters_={}}incrementCounter(e,n=1){Hr(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=n}get(){return K5(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dh={},Nh={};function R0(t){const e=t.toString();return Dh[e]||(Dh[e]=new KC),Dh[e]}function XC(t,e){const n=t.toString();return Nh[n]||(Nh[n]=e()),Nh[n]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JC{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,n){this.closeAfterResponse=e,this.onClose=n,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,n){for(this.pendingResponses[e]=n;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<r.length;++s)r[s]&&Sa(()=>{this.onMessage_(r[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dv="start",QC="close",qC="pLPCommand",ZC="pRTLPCB",qb="id",Zb="pw",eE="ser",ek="cb",tk="seg",nk="ts",rk="d",sk="dframe",tE=1870,nE=30,ik=tE-nE,ok=25e3,ak=3e4;class Bo{constructor(e,n,r,s,i,o,l){this.connId=e,this.repoInfo=n,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.transportSessionId=o,this.lastSessionId=l,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=mc(e),this.stats_=R0(n),this.urlFn=c=>(this.appCheckToken&&(c[Kp]=this.appCheckToken),Qb(n,Xb,c))}open(e,n){this.curSegmentNum=0,this.onDisconnect_=n,this.myPacketOrderer=new JC(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(ak)),NC(()=>{if(this.isClosed_)return;this.scriptTagHolder=new A0((...i)=>{const[o,l,c,d,u]=i;if(this.incrementIncomingBytes_(i),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===Dv)this.id=l,this.password=c;else if(o===QC)l?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(l,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...i)=>{const[o,l]=i;this.incrementIncomingBytes_(i),this.myPacketOrderer.handleResponse(o,l)},()=>{this.onClosed_()},this.urlFn);const r={};r[Dv]="t",r[eE]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[ek]=this.scriptTagHolder.uniqueCallbackIdentifier),r[Bb]=k0,this.transportSessionId&&(r[zb]=this.transportSessionId),this.lastSessionId&&(r[Vb]=this.lastSessionId),this.applicationId&&(r[Yb]=this.applicationId),this.appCheckToken&&(r[Kp]=this.appCheckToken),typeof location<"u"&&location.hostname&&Gb.test(location.hostname)&&(r[Hb]=Wb);const s=this.urlFn(r);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Bo.forceAllow_=!0}static forceDisallow(){Bo.forceDisallow_=!0}static isAvailable(){return Bo.forceAllow_?!0:!Bo.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!jC()&&!FC()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const n=ln(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const r=_b(n),s=Fb(r,ik);for(let i=0;i<s.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[i]),this.curSegmentNum++}addDisconnectPingFrame(e,n){this.myDisconnFrame=document.createElement("iframe");const r={};r[sk]="t",r[qb]=e,r[Zb]=n,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const n=ln(e).length;this.bytesReceived+=n,this.stats_.incrementCounter("bytes_received",n)}}class A0{constructor(e,n,r,s){this.onDisconnect=r,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=$b(),window[qC+this.uniqueCallbackIdentifier]=e,window[ZC+this.uniqueCallbackIdentifier]=n,this.myIFrame=A0.createIFrame_();let i="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(i='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(l){pn("frame writing exception"),l.stack&&pn(l.stack),pn(l)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||pn("No IE domain setting required")}catch{const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,n){for(this.myID=e,this.myPW=n,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[qb]=this.myID,e[Zb]=this.myPW,e[eE]=this.currentSerial;let n=this.urlFn(e),r="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+nE+r.length<=tE;){const o=this.pendingSegs.shift();r=r+"&"+tk+s+"="+o.seg+"&"+nk+s+"="+o.ts+"&"+rk+s+"="+o.d,s++}return n=n+r,this.addLongPollTag_(n,this.currentSerial),!0}else return!1}enqueueSegment(e,n,r){this.pendingSegs.push({seg:e,ts:n,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,n){this.outstandingRequests.add(n);const r=()=>{this.outstandingRequests.delete(n),this.newRequest_()},s=setTimeout(r,Math.floor(ok)),i=()=>{clearTimeout(s),r()};this.addTag(e,i)}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const s=r.readyState;(!s||s==="loaded"||s==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),n())},r.onerror=()=>{pn("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lk=16384,ck=45e3;let Su=null;typeof MozWebSocket<"u"?Su=MozWebSocket:typeof WebSocket<"u"&&(Su=WebSocket);class Dr{constructor(e,n,r,s,i,o,l){this.connId=e,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=mc(this.connId),this.stats_=R0(n),this.connURL=Dr.connectionURL_(n,o,l,s,r),this.nodeAdmin=n.nodeAdmin}static connectionURL_(e,n,r,s,i){const o={};return o[Bb]=k0,typeof location<"u"&&location.hostname&&Gb.test(location.hostname)&&(o[Hb]=Wb),n&&(o[zb]=n),r&&(o[Vb]=r),s&&(o[Kp]=s),i&&(o[Yb]=i),Qb(e,Kb,o)}open(e,n){this.onDisconnect=n,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,$i.set("previous_websocket_failure",!0);try{let r;aT(),this.mySock=new Su(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){Dr.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const n=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(n);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&Su!==null&&!Dr.forceDisallow_}static previouslyFailed(){return $i.isInMemoryStorage||$i.get("previous_websocket_failure")===!0}markConnectionHealthy(){$i.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const n=this.frames.join("");this.frames=null;const r=Kl(n);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(ge(this.frames===null,"We already have a frame buffer"),e.length<=6){const n=Number(e);if(!isNaN(n))return this.handleNewFrameCount_(n),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const n=e.data;if(this.bytesReceived+=n.length,this.stats_.incrementCounter("bytes_received",n.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(n);else{const r=this.extractFrameCount_(n);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();const n=ln(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const r=Fb(n,lk);r.length>1&&this.sendString_(String(r.length));for(let s=0;s<r.length;s++)this.sendString_(r[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(ck))}sendString_(e){try{this.mySock.send(e)}catch(n){this.log_("Exception thrown from WebSocket.send():",n.message||n.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Dr.responsesRequiredToBeHealthy=2;Dr.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jl{static get ALL_TRANSPORTS(){return[Bo,Dr]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const n=Dr&&Dr.isAvailable();let r=n&&!Dr.previouslyFailed();if(e.webSocketOnly&&(n||Un("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[Dr];else{const s=this.transports_=[];for(const i of Jl.ALL_TRANSPORTS)i&&i.isAvailable()&&s.push(i);Jl.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Jl.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dk=6e4,uk=5e3,fk=10*1024,hk=100*1024,$h="t",Nv="d",pk="s",$v="r",gk="e",jv="o",Fv="a",Uv="n",Bv="p",mk="h";class yk{constructor(e,n,r,s,i,o,l,c,d,u){this.id=e,this.repoInfo_=n,this.applicationId_=r,this.appCheckToken_=s,this.authToken_=i,this.onMessage_=o,this.onReady_=l,this.onDisconnect_=c,this.onKill_=d,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=mc("c:"+this.id+":"),this.transportManager_=new Jl(n),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(n,r)},Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=El(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>hk?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>fk?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return n=>{e===this.conn_?this.onConnectionLost_(n):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return n=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(n):e===this.secondaryConn_?this.onSecondaryMessageReceived_(n):this.log_("message on old connection"))}}sendRequest(e){const n={t:"d",d:e};this.sendData_(n)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if($h in e){const n=e[$h];n===Fv?this.upgradeIfSecondaryHealthy_():n===$v?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):n===jv&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const n=Qa("t",e),r=Qa("d",e);if(n==="c")this.onSecondaryControl_(r);else if(n==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+n)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:Bv,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Fv,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:Uv,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const n=Qa("t",e),r=Qa("d",e);n==="c"?this.onControl_(r):n==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const n=Qa($h,e);if(Nv in e){const r=e[Nv];if(n===mk){const s={...r};this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(n===Uv){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else n===pk?this.onConnectionShutdown_(r):n===$v?this.onReset_(r):n===gk?Yp("Server Error: "+r):n===jv?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Yp("Unknown control packet command: "+n)}}onHandshake_(e){const n=e.ts,r=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,n),k0!==r&&Un("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),El(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(dk))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,n){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(n,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):El(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(uk))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:Bv,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&($i.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rE{put(e,n,r,s){}merge(e,n,r,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,n,r){}onDisconnectMerge(e,n,r){}onDisconnectCancel(e,n){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sE{constructor(e){this.allowedEvents_=e,this.listeners_={},ge(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...n){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let s=0;s<r.length;s++)r[s].callback.apply(r[s].context,n)}}on(e,n,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:n,context:r});const s=this.getInitialEvent(e);s&&n.apply(r,s)}off(e,n,r){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let i=0;i<s.length;i++)if(s[i].callback===n&&(!r||r===s[i].context)){s.splice(i,1);return}}validateEventType_(e){ge(this.allowedEvents_.find(n=>n===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wu extends sE{static getInstance(){return new wu}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!S0()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return ge(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zv=32,Hv=768;class At{constructor(e,n){if(n===void 0){this.pieces_=e.split("/");let r=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[r]=this.pieces_[s],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=n}toString(){let e="";for(let n=this.pieceNum_;n<this.pieces_.length;n++)this.pieces_[n]!==""&&(e+="/"+this.pieces_[n]);return e||"/"}}function St(){return new At("")}function ut(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function fi(t){return t.pieces_.length-t.pieceNum_}function $t(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new At(t.pieces_,e)}function P0(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function vk(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)t.pieces_[n]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}function Ql(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function iE(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new At(e,0)}function Jt(t,e){const n=[];for(let r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);if(e instanceof At)for(let r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);else{const r=e.split("/");for(let s=0;s<r.length;s++)r[s].length>0&&n.push(r[s])}return new At(n,0)}function pt(t){return t.pieceNum_>=t.pieces_.length}function jn(t,e){const n=ut(t),r=ut(e);if(n===null)return e;if(n===r)return jn($t(t),$t(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function xk(t,e){const n=Ql(t,0),r=Ql(e,0);for(let s=0;s<n.length&&s<r.length;s++){const i=eo(n[s],r[s]);if(i!==0)return i}return n.length===r.length?0:n.length<r.length?-1:1}function O0(t,e){if(fi(t)!==fi(e))return!1;for(let n=t.pieceNum_,r=e.pieceNum_;n<=t.pieces_.length;n++,r++)if(t.pieces_[n]!==e.pieces_[r])return!1;return!0}function Er(t,e){let n=t.pieceNum_,r=e.pieceNum_;if(fi(t)>fi(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[r])return!1;++n,++r}return!0}class _k{constructor(e,n){this.errorPrefix_=n,this.parts_=Ql(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=lf(this.parts_[r]);oE(this)}}function bk(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=lf(e),oE(t)}function Ek(t){const e=t.parts_.pop();t.byteLength_-=lf(e),t.parts_.length>0&&(t.byteLength_-=1)}function oE(t){if(t.byteLength_>Hv)throw new Error(t.errorPrefix_+"has a key path longer than "+Hv+" bytes ("+t.byteLength_+").");if(t.parts_.length>zv)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+zv+") or object contains a cycle "+Oi(t))}function Oi(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L0 extends sE{static getInstance(){return new L0}constructor(){super(["visible"]);let e,n;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(n="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(n="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(n="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(n="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,n&&document.addEventListener(n,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}getInitialEvent(e){return ge(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qa=1e3,Sk=60*5*1e3,Wv=30*1e3,wk=1.3,Ik=3e4,Tk="server_kill",Gv=3;class hs extends rE{constructor(e,n,r,s,i,o,l,c){if(super(),this.repoInfo_=e,this.applicationId_=n,this.onDataUpdate_=r,this.onConnectStatus_=s,this.onServerInfoUpdate_=i,this.authTokenProvider_=o,this.appCheckTokenProvider_=l,this.authOverride_=c,this.id=hs.nextPersistentConnectionId_++,this.log_=mc("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=qa,this.maxReconnectDelay_=Sk,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");L0.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&wu.getInstance().on("online",this.onOnline_,this)}sendRequest(e,n,r){const s=++this.requestNumber_,i={r:s,a:e,b:n};this.log_(ln(i)),ge(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),r&&(this.requestCBHash_[s]=r)}get(e){this.initConnection_();const n=new Mr,s={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const l=o.d;o.s==="ok"?n.resolve(l):n.reject(l)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),n.promise}listen(e,n,r,s){this.initConnection_();const i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),ge(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),ge(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");const l={onComplete:s,hashFn:n,query:e,tag:r};this.listens.get(o).set(i,l),this.connected_&&this.sendListen_(l)}sendGet_(e){const n=this.outstandingGets_[e];this.sendRequest("g",n.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(r)})}sendListen_(e){const n=e.query,r=n._path.toString(),s=n._queryIdentifier;this.log_("Listen on "+r+" for "+s);const i={p:r},o="q";e.tag&&(i.q=n._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest(o,i,l=>{const c=l.d,d=l.s;hs.warnOnListenWarnings_(c,n),(this.listens.get(r)&&this.listens.get(r).get(s))===e&&(this.log_("listen response",l),d!=="ok"&&this.removeListen_(r,s),e.onComplete&&e.onComplete(d,c))})}static warnOnListenWarnings_(e,n){if(e&&typeof e=="object"&&Hr(e,"w")){const r=Gi(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const s='".indexOn": "'+n._queryParams.getIndex().toString()+'"',i=n._path.toString();Un(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${i} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||pT(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Wv)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,n=hT(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(n,r,s=>{const i=s.s,o=s.d||"error";this.authToken_===e&&(i==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(i,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const n=e.s,r=e.d||"error";n==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(n,r)})}unlisten(e,n){const r=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+s),ge(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,s)&&this.connected_&&this.sendUnlisten_(r,s,e._queryObject,n)}sendUnlisten_(e,n,r,s){this.log_("Unlisten on "+e+" for "+n);const i={p:e},o="n";s&&(i.q=r,i.t=s),this.sendRequest(o,i)}onDisconnectPut(e,n,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,n,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:n,onComplete:r})}onDisconnectMerge(e,n,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,n,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:n,onComplete:r})}onDisconnectCancel(e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:n})}sendOnDisconnect_(e,n,r,s){const i={p:n,d:r};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,o=>{s&&setTimeout(()=>{s(o.s,o.d)},Math.floor(0))})}put(e,n,r,s){this.putInternal("p",e,n,r,s)}merge(e,n,r,s){this.putInternal("m",e,n,r,s)}putInternal(e,n,r,s,i){this.initConnection_();const o={p:n,d:r};i!==void 0&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:s}),this.outstandingPutCount_++;const l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+n)}sendPut_(e){const n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,s=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,i=>{this.log_(n+" response",i),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(i.s,i.d)})}reportStats(e){if(this.connected_){const n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,r=>{if(r.s!=="ok"){const i=r.d;this.log_("reportStats","Error sending stats: "+i)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+ln(e));const n=e.r,r=this.requestCBHash_[n];r&&(delete this.requestCBHash_[n],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,n){this.log_("handleServerMessage",e,n),e==="d"?this.onDataUpdate_(n.p,n.d,!1,n.t):e==="m"?this.onDataUpdate_(n.p,n.d,!0,n.t):e==="c"?this.onListenRevoked_(n.p,n.q):e==="ac"?this.onAuthRevoked_(n.s,n.d):e==="apc"?this.onAppCheckRevoked_(n.s,n.d):e==="sd"?this.onSecurityDebugPacket_(n):Yp("Unrecognized action received from server: "+ln(e)+`
Are you using the latest client?`)}onReady_(e,n){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=n,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){ge(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=qa,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=qa,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>Ik&&(this.reconnectDelay_=qa),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let n=Math.max(0,this.reconnectDelay_-e);n=Math.random()*n,this.log_("Trying to reconnect in "+n+"ms"),this.scheduleConnect_(n),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*wk)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+hs.nextConnectionId_++,i=this.lastSessionId;let o=!1,l=null;const c=function(){l?l.close():(o=!0,r())},d=function(h){ge(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(h)};this.realtime_={close:c,sendRequest:d};const u=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[h,f]=await Promise.all([this.authTokenProvider_.getToken(u),this.appCheckTokenProvider_.getToken(u)]);o?pn("getToken() completed but was canceled"):(pn("getToken() completed. Creating connection."),this.authToken_=h&&h.accessToken,this.appCheckToken_=f&&f.token,l=new yk(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,r,b=>{Un(b+" ("+this.repoInfo_.toString()+")"),this.interrupt(Tk)},i))}catch(h){this.log_("Failed to get token: "+h),o||(this.repoInfo_.nodeAdmin&&Un(h),c())}}}interrupt(e){pn("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){pn("Resuming connection for reason: "+e),delete this.interruptReasons_[e],_u(this.interruptReasons_)&&(this.reconnectDelay_=qa,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const n=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:n})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const n=this.outstandingPuts_[e];n&&"h"in n.request&&n.queued&&(n.onComplete&&n.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,n){let r;n?r=n.map(i=>C0(i)).join("$"):r="default";const s=this.removeListen_(e,r);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(e,n){const r=new At(e).toString();let s;if(this.listens.has(r)){const i=this.listens.get(r);s=i.get(n),i.delete(n),i.size===0&&this.listens.delete(r)}else s=void 0;return s}onAuthRevoked_(e,n){pn("Auth token revoked: "+e+"/"+n),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Gv&&(this.reconnectDelay_=Wv,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,n){pn("App check token revoked: "+e+"/"+n),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Gv&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const n of e.values())this.sendListen_(n);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let n="js";e["sdk."+n+"."+Db.replace(/\./g,"-")]=1,S0()?e["framework.cordova"]=1:Cb()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=wu.getInstance().currentlyOnline();return _u(this.interruptReasons_)&&e}}hs.nextPersistentConnectionId_=0;hs.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gt{constructor(e,n){this.name=e,this.node=n}static Wrap(e,n){return new gt(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class df{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,n){const r=new gt(da,e),s=new gt(da,n);return this.compare(r,s)!==0}minPost(){return gt.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gd;class aE extends df{static get __EMPTY_NODE(){return gd}static set __EMPTY_NODE(e){gd=e}compare(e,n){return eo(e.name,n.name)}isDefinedOn(e){throw xa("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,n){return!1}minPost(){return gt.MIN}maxPost(){return new gt(Ki,gd)}makePost(e,n){return ge(typeof e=="string","KeyIndex indexValue must always be a string."),new gt(e,gd)}toString(){return".key"}}const Jo=new aE;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class md{constructor(e,n,r,s,i=null){this.isReverse_=s,this.resultGenerator_=i,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=n?r(e.key,n):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),n;if(this.resultGenerator_?n=this.resultGenerator_(e.key,e.value):n={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return n}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class hn{constructor(e,n,r,s,i){this.key=e,this.value=n,this.color=r??hn.RED,this.left=s??Xn.EMPTY_NODE,this.right=i??Xn.EMPTY_NODE}copy(e,n,r,s,i){return new hn(e??this.key,n??this.value,r??this.color,s??this.left,i??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let s=this;const i=r(e,s.key);return i<0?s=s.copy(null,null,null,s.left.insert(e,n,r),null):i===0?s=s.copy(null,n,null,null,null):s=s.copy(null,null,null,null,s.right.insert(e,n,r)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return Xn.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,n){let r,s;if(r=this,n(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,n),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),n(e,r.key)===0){if(r.right.isEmpty())return Xn.EMPTY_NODE;s=r.right.min_(),r=r.copy(s.key,s.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,n))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,hn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,hn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}hn.RED=!0;hn.BLACK=!1;class Ck{copy(e,n,r,s,i){return this}insert(e,n,r){return new hn(e,n,null)}remove(e,n){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class Xn{constructor(e,n=Xn.EMPTY_NODE){this.comparator_=e,this.root_=n}insert(e,n){return new Xn(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,hn.BLACK,null,null))}remove(e){return new Xn(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,hn.BLACK,null,null))}get(e){let n,r=this.root_;for(;!r.isEmpty();){if(n=this.comparator_(e,r.key),n===0)return r.value;n<0?r=r.left:n>0&&(r=r.right)}return null}getPredecessorKey(e){let n,r=this.root_,s=null;for(;!r.isEmpty();)if(n=this.comparator_(e,r.key),n===0){if(r.left.isEmpty())return s?s.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else n<0?r=r.left:n>0&&(s=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new md(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,n){return new md(this.root_,e,this.comparator_,!1,n)}getReverseIteratorFrom(e,n){return new md(this.root_,e,this.comparator_,!0,n)}getReverseIterator(e){return new md(this.root_,null,this.comparator_,!0,e)}}Xn.EMPTY_NODE=new Ck;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kk(t,e){return eo(t.name,e.name)}function M0(t,e){return eo(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Xp;function Rk(t){Xp=t}const lE=function(t){return typeof t=="number"?"number:"+Ub(t):"string:"+t},cE=function(t){if(t.isLeafNode()){const e=t.val();ge(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Hr(e,".sv"),"Priority must be a string or number.")}else ge(t===Xp||t.isEmpty(),"priority of unexpected type.");ge(t===Xp||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Vv;class un{static set __childrenNodeConstructor(e){Vv=e}static get __childrenNodeConstructor(){return Vv}constructor(e,n=un.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=n,this.lazyHash_=null,ge(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),cE(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new un(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:un.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return pt(e)?this:ut(e)===".priority"?this.priorityNode_:un.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,n){return null}updateImmediateChild(e,n){return e===".priority"?this.updatePriority(n):n.isEmpty()&&e!==".priority"?this:un.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)}updateChild(e,n){const r=ut(e);return r===null?n:n.isEmpty()&&r!==".priority"?this:(ge(r!==".priority"||fi(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,un.__childrenNodeConstructor.EMPTY_NODE.updateChild($t(e),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,n){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+lE(this.priorityNode_.val())+":");const n=typeof this.value_;e+=n+":",n==="number"?e+=Ub(this.value_):e+=this.value_,this.lazyHash_=jb(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===un.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof un.__childrenNodeConstructor?-1:(ge(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const n=typeof e.value_,r=typeof this.value_,s=un.VALUE_TYPE_ORDER.indexOf(n),i=un.VALUE_TYPE_ORDER.indexOf(r);return ge(s>=0,"Unknown leaf type: "+n),ge(i>=0,"Unknown leaf type: "+r),s===i?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const n=e;return this.value_===n.value_&&this.priorityNode_.equals(n.priorityNode_)}else return!1}}un.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let dE,uE;function Ak(t){dE=t}function Pk(t){uE=t}class Ok extends df{compare(e,n){const r=e.node.getPriority(),s=n.node.getPriority(),i=r.compareTo(s);return i===0?eo(e.name,n.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,n){return!e.getPriority().equals(n.getPriority())}minPost(){return gt.MIN}maxPost(){return new gt(Ki,new un("[PRIORITY-POST]",uE))}makePost(e,n){const r=dE(e);return new gt(n,new un("[PRIORITY-POST]",r))}toString(){return".priority"}}const Yt=new Ok;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lk=Math.log(2);class Mk{constructor(e){const n=i=>parseInt(Math.log(i)/Lk,10),r=i=>parseInt(Array(i+1).join("1"),2);this.count=n(e+1),this.current_=this.count-1;const s=r(this.count);this.bits_=e+1&s}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Iu=function(t,e,n,r){t.sort(e);const s=function(c,d){const u=d-c;let h,f;if(u===0)return null;if(u===1)return h=t[c],f=n?n(h):h,new hn(f,h.node,hn.BLACK,null,null);{const b=parseInt(u/2,10)+c,C=s(c,b),k=s(b+1,d);return h=t[b],f=n?n(h):h,new hn(f,h.node,hn.BLACK,C,k)}},i=function(c){let d=null,u=null,h=t.length;const f=function(C,k){const A=h-C,R=h;h-=C;const m=s(A+1,R),T=t[A],L=n?n(T):T;b(new hn(L,T.node,k,null,m))},b=function(C){d?(d.left=C,d=C):(u=C,d=C)};for(let C=0;C<c.count;++C){const k=c.nextBitIsOne(),A=Math.pow(2,c.count-(C+1));k?f(A,hn.BLACK):(f(A,hn.BLACK),f(A,hn.RED))}return u},o=new Mk(t.length),l=i(o);return new Xn(r||e,l)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let jh;const Io={};class cs{static get Default(){return ge(Io&&Yt,"ChildrenNode.ts has not been loaded"),jh=jh||new cs({".priority":Io},{".priority":Yt}),jh}constructor(e,n){this.indexes_=e,this.indexSet_=n}get(e){const n=Gi(this.indexes_,e);if(!n)throw new Error("No index defined for "+e);return n instanceof Xn?n:null}hasIndex(e){return Hr(this.indexSet_,e.toString())}addIndex(e,n){ge(e!==Jo,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let s=!1;const i=n.getIterator(gt.Wrap);let o=i.getNext();for(;o;)s=s||e.isDefinedOn(o.node),r.push(o),o=i.getNext();let l;s?l=Iu(r,e.getCompare()):l=Io;const c=e.toString(),d={...this.indexSet_};d[c]=e;const u={...this.indexes_};return u[c]=l,new cs(u,d)}addToIndexes(e,n){const r=bu(this.indexes_,(s,i)=>{const o=Gi(this.indexSet_,i);if(ge(o,"Missing index implementation for "+i),s===Io)if(o.isDefinedOn(e.node)){const l=[],c=n.getIterator(gt.Wrap);let d=c.getNext();for(;d;)d.name!==e.name&&l.push(d),d=c.getNext();return l.push(e),Iu(l,o.getCompare())}else return Io;else{const l=n.get(e.name);let c=s;return l&&(c=c.remove(new gt(e.name,l))),c.insert(e,e.node)}});return new cs(r,this.indexSet_)}removeFromIndexes(e,n){const r=bu(this.indexes_,s=>{if(s===Io)return s;{const i=n.get(e.name);return i?s.remove(new gt(e.name,i)):s}});return new cs(r,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Za;class Je{static get EMPTY_NODE(){return Za||(Za=new Je(new Xn(M0),null,cs.Default))}constructor(e,n,r){this.children_=e,this.priorityNode_=n,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&cE(this.priorityNode_),this.children_.isEmpty()&&ge(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Za}updatePriority(e){return this.children_.isEmpty()?this:new Je(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const n=this.children_.get(e);return n===null?Za:n}}getChild(e){const n=ut(e);return n===null?this:this.getImmediateChild(n).getChild($t(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,n){if(ge(n,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(n);{const r=new gt(e,n);let s,i;n.isEmpty()?(s=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(r,this.children_)):(s=this.children_.insert(e,n),i=this.indexMap_.addToIndexes(r,this.children_));const o=s.isEmpty()?Za:this.priorityNode_;return new Je(s,o,i)}}updateChild(e,n){const r=ut(e);if(r===null)return n;{ge(ut(e)!==".priority"||fi(e)===1,".priority must be the last token in a path");const s=this.getImmediateChild(r).updateChild($t(e),n);return this.updateImmediateChild(r,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const n={};let r=0,s=0,i=!0;if(this.forEachChild(Yt,(o,l)=>{n[o]=l.val(e),r++,i&&Je.INTEGER_REGEXP_.test(o)?s=Math.max(s,Number(o)):i=!1}),!e&&i&&s<2*r){const o=[];for(const l in n)o[l]=n[l];return o}else return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+lE(this.getPriority().val())+":"),this.forEachChild(Yt,(n,r)=>{const s=r.hash();s!==""&&(e+=":"+n+":"+s)}),this.lazyHash_=e===""?"":jb(e)}return this.lazyHash_}getPredecessorChildName(e,n,r){const s=this.resolveIndex_(r);if(s){const i=s.getPredecessorKey(new gt(e,n));return i?i.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const n=this.resolveIndex_(e);if(n){const r=n.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){const n=this.getFirstChildName(e);return n?new gt(n,this.children_.get(n)):null}getLastChildName(e){const n=this.resolveIndex_(e);if(n){const r=n.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){const n=this.getLastChildName(e);return n?new gt(n,this.children_.get(n)):null}forEachChild(e,n){const r=this.resolveIndex_(e);return r?r.inorderTraversal(s=>n(s.name,s.node)):this.children_.inorderTraversal(n)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,n){const r=this.resolveIndex_(n);if(r)return r.getIteratorFrom(e,s=>s);{const s=this.children_.getIteratorFrom(e.name,gt.Wrap);let i=s.peek();for(;i!=null&&n.compare(i,e)<0;)s.getNext(),i=s.peek();return s}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,n){const r=this.resolveIndex_(n);if(r)return r.getReverseIteratorFrom(e,s=>s);{const s=this.children_.getReverseIteratorFrom(e.name,gt.Wrap);let i=s.peek();for(;i!=null&&n.compare(i,e)>0;)s.getNext(),i=s.peek();return s}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===yc?-1:0}withIndex(e){if(e===Jo||this.indexMap_.hasIndex(e))return this;{const n=this.indexMap_.addIndex(e,this.children_);return new Je(this.children_,this.priorityNode_,n)}}isIndexed(e){return e===Jo||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority()))if(this.children_.count()===n.children_.count()){const r=this.getIterator(Yt),s=n.getIterator(Yt);let i=r.getNext(),o=s.getNext();for(;i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=r.getNext(),o=s.getNext()}return i===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===Jo?null:this.indexMap_.get(e.toString())}}Je.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class Dk extends Je{constructor(){super(new Xn(M0),Je.EMPTY_NODE,cs.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Je.EMPTY_NODE}isEmpty(){return!1}}const yc=new Dk;Object.defineProperties(gt,{MIN:{value:new gt(da,Je.EMPTY_NODE)},MAX:{value:new gt(Ki,yc)}});aE.__EMPTY_NODE=Je.EMPTY_NODE;un.__childrenNodeConstructor=Je;Rk(yc);Pk(yc);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nk=!0;function Xt(t,e=null){if(t===null)return Je.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),ge(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){const n=t;return new un(n,Xt(e))}if(!(t instanceof Array)&&Nk){const n=[];let r=!1;if(mn(t,(o,l)=>{if(o.substring(0,1)!=="."){const c=Xt(l);c.isEmpty()||(r=r||!c.getPriority().isEmpty(),n.push(new gt(o,c)))}}),n.length===0)return Je.EMPTY_NODE;const i=Iu(n,kk,o=>o.name,M0);if(r){const o=Iu(n,Yt.getCompare());return new Je(i,Xt(e),new cs({".priority":o},{".priority":Yt}))}else return new Je(i,Xt(e),cs.Default)}else{let n=Je.EMPTY_NODE;return mn(t,(r,s)=>{if(Hr(t,r)&&r.substring(0,1)!=="."){const i=Xt(s);(i.isLeafNode()||!i.isEmpty())&&(n=n.updateImmediateChild(r,i))}}),n.updatePriority(Xt(e))}}Ak(Xt);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $k extends df{constructor(e){super(),this.indexPath_=e,ge(!pt(e)&&ut(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,n){const r=this.extractChild(e.node),s=this.extractChild(n.node),i=r.compareTo(s);return i===0?eo(e.name,n.name):i}makePost(e,n){const r=Xt(e),s=Je.EMPTY_NODE.updateChild(this.indexPath_,r);return new gt(n,s)}maxPost(){const e=Je.EMPTY_NODE.updateChild(this.indexPath_,yc);return new gt(Ki,e)}toString(){return Ql(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jk extends df{compare(e,n){const r=e.node.compareTo(n.node);return r===0?eo(e.name,n.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,n){return!e.equals(n)}minPost(){return gt.MIN}maxPost(){return gt.MAX}makePost(e,n){const r=Xt(e);return new gt(n,r)}toString(){return".value"}}const Fk=new jk;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fE(t){return{type:"value",snapshotNode:t}}function ua(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function ql(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function Zl(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}function Uk(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D0{constructor(e){this.index_=e}updateChild(e,n,r,s,i,o){ge(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const l=e.getImmediateChild(n);return l.getChild(s).equals(r.getChild(s))&&l.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(n)?o.trackChildChange(ql(n,l)):ge(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):l.isEmpty()?o.trackChildChange(ua(n,r)):o.trackChildChange(Zl(n,r,l))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(n,r).withIndex(this.index_)}updateFullNode(e,n,r){return r!=null&&(e.isLeafNode()||e.forEachChild(Yt,(s,i)=>{n.hasChild(s)||r.trackChildChange(ql(s,i))}),n.isLeafNode()||n.forEachChild(Yt,(s,i)=>{if(e.hasChild(s)){const o=e.getImmediateChild(s);o.equals(i)||r.trackChildChange(Zl(s,i,o))}else r.trackChildChange(ua(s,i))})),n.withIndex(this.index_)}updatePriority(e,n){return e.isEmpty()?Je.EMPTY_NODE:e.updatePriority(n)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ec{constructor(e){this.indexedFilter_=new D0(e.getIndex()),this.index_=e.getIndex(),this.startPost_=ec.getStartPost_(e),this.endPost_=ec.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const n=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return n&&r}updateChild(e,n,r,s,i,o){return this.matches(new gt(n,r))||(r=Je.EMPTY_NODE),this.indexedFilter_.updateChild(e,n,r,s,i,o)}updateFullNode(e,n,r){n.isLeafNode()&&(n=Je.EMPTY_NODE);let s=n.withIndex(this.index_);s=s.updatePriority(Je.EMPTY_NODE);const i=this;return n.forEachChild(Yt,(o,l)=>{i.matches(new gt(o,l))||(s=s.updateImmediateChild(o,Je.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,r)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const n=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),n)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const n=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),n)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bk{constructor(e){this.withinDirectionalStart=n=>this.reverse_?this.withinEndPost(n):this.withinStartPost(n),this.withinDirectionalEnd=n=>this.reverse_?this.withinStartPost(n):this.withinEndPost(n),this.withinStartPost=n=>{const r=this.index_.compare(this.rangedFilter_.getStartPost(),n);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=n=>{const r=this.index_.compare(n,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new ec(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,n,r,s,i,o){return this.rangedFilter_.matches(new gt(n,r))||(r=Je.EMPTY_NODE),e.getImmediateChild(n).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,n,r,s,i,o):this.fullLimitUpdateChild_(e,n,r,i,o)}updateFullNode(e,n,r){let s;if(n.isLeafNode()||n.isEmpty())s=Je.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<n.numChildren()&&n.isIndexed(this.index_)){s=Je.EMPTY_NODE.withIndex(this.index_);let i;this.reverse_?i=n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):i=n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;i.hasNext()&&o<this.limit_;){const l=i.getNext();if(this.withinDirectionalStart(l))if(this.withinDirectionalEnd(l))s=s.updateImmediateChild(l.name,l.node),o++;else break;else continue}}else{s=n.withIndex(this.index_),s=s.updatePriority(Je.EMPTY_NODE);let i;this.reverse_?i=s.getReverseIterator(this.index_):i=s.getIterator(this.index_);let o=0;for(;i.hasNext();){const l=i.getNext();o<this.limit_&&this.withinDirectionalStart(l)&&this.withinDirectionalEnd(l)?o++:s=s.updateImmediateChild(l.name,Je.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,r)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,n,r,s,i){let o;if(this.reverse_){const h=this.index_.getCompare();o=(f,b)=>h(b,f)}else o=this.index_.getCompare();const l=e;ge(l.numChildren()===this.limit_,"");const c=new gt(n,r),d=this.reverse_?l.getFirstChild(this.index_):l.getLastChild(this.index_),u=this.rangedFilter_.matches(c);if(l.hasChild(n)){const h=l.getImmediateChild(n);let f=s.getChildAfterChild(this.index_,d,this.reverse_);for(;f!=null&&(f.name===n||l.hasChild(f.name));)f=s.getChildAfterChild(this.index_,f,this.reverse_);const b=f==null?1:o(f,c);if(u&&!r.isEmpty()&&b>=0)return i!=null&&i.trackChildChange(Zl(n,r,h)),l.updateImmediateChild(n,r);{i!=null&&i.trackChildChange(ql(n,h));const k=l.updateImmediateChild(n,Je.EMPTY_NODE);return f!=null&&this.rangedFilter_.matches(f)?(i!=null&&i.trackChildChange(ua(f.name,f.node)),k.updateImmediateChild(f.name,f.node)):k}}else return r.isEmpty()?e:u&&o(d,c)>=0?(i!=null&&(i.trackChildChange(ql(d.name,d.node)),i.trackChildChange(ua(n,r))),l.updateImmediateChild(n,r).updateImmediateChild(d.name,Je.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N0{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Yt}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return ge(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return ge(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:da}hasEnd(){return this.endSet_}getIndexEndValue(){return ge(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return ge(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Ki}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return ge(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Yt}copy(){const e=new N0;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function zk(t){return t.loadsAllData()?new D0(t.getIndex()):t.hasLimit()?new Bk(t):new ec(t)}function Yv(t){const e={};if(t.isDefault())return e;let n;if(t.index_===Yt?n="$priority":t.index_===Fk?n="$value":t.index_===Jo?n="$key":(ge(t.index_ instanceof $k,"Unrecognized index type!"),n=t.index_.toString()),e.orderBy=ln(n),t.startSet_){const r=t.startAfterSet_?"startAfter":"startAt";e[r]=ln(t.indexStartValue_),t.startNameSet_&&(e[r]+=","+ln(t.indexStartName_))}if(t.endSet_){const r=t.endBeforeSet_?"endBefore":"endAt";e[r]=ln(t.indexEndValue_),t.endNameSet_&&(e[r]+=","+ln(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function Kv(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;n===""&&(t.isViewFromLeft()?n="l":n="r"),e.vf=n}return t.index_!==Yt&&(e.i=t.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tu extends rE{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,n){return n!==void 0?"tag$"+n:(ge(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,n,r,s){super(),this.repoInfo_=e,this.onDataUpdate_=n,this.authTokenProvider_=r,this.appCheckTokenProvider_=s,this.log_=mc("p:rest:"),this.listens_={}}listen(e,n,r,s){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const o=Tu.getListenId_(e,r),l={};this.listens_[o]=l;const c=Yv(e._queryParams);this.restRequest_(i+".json",c,(d,u)=>{let h=u;if(d===404&&(h=null,d=null),d===null&&this.onDataUpdate_(i,h,!1,r),Gi(this.listens_,o)===l){let f;d?d===401?f="permission_denied":f="rest_error:"+d:f="ok",s(f,null)}})}unlisten(e,n){const r=Tu.getListenId_(e,n);delete this.listens_[r]}get(e){const n=Yv(e._queryParams),r=e._path.toString(),s=new Mr;return this.restRequest_(r+".json",n,(i,o)=>{let l=o;i===404&&(l=null,i=null),i===null?(this.onDataUpdate_(r,l,!1,null),s.resolve(l)):s.reject(new Error(l))}),s.promise}refreshAuthToken(e){}restRequest_(e,n={},r){return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,i])=>{s&&s.accessToken&&(n.auth=s.accessToken),i&&i.token&&(n.ac=i.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+ba(n);this.log_("Sending REST request for "+o);const l=new XMLHttpRequest;l.onreadystatechange=()=>{if(r&&l.readyState===4){this.log_("REST Response for "+o+" received. status:",l.status,"response:",l.responseText);let c=null;if(l.status>=200&&l.status<300){try{c=Kl(l.responseText)}catch{Un("Failed to parse JSON response for "+o+": "+l.responseText)}r(null,c)}else l.status!==401&&l.status!==404&&Un("Got unsuccessful REST response for "+o+" Status: "+l.status),r(l.status);r=null}},l.open("GET",o,!0),l.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hk{constructor(){this.rootNode_=Je.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,n){this.rootNode_=this.rootNode_.updateChild(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cu(){return{value:null,children:new Map}}function wa(t,e,n){if(pt(e))t.value=n,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,n);else{const r=ut(e);t.children.has(r)||t.children.set(r,Cu());const s=t.children.get(r);e=$t(e),wa(s,e,n)}}function Jp(t,e){if(pt(e))return t.value=null,t.children.clear(),!0;if(t.value!==null){if(t.value.isLeafNode())return!1;{const n=t.value;return t.value=null,n.forEachChild(Yt,(r,s)=>{wa(t,new At(r),s)}),Jp(t,e)}}else if(t.children.size>0){const n=ut(e);return e=$t(e),t.children.has(n)&&Jp(t.children.get(n),e)&&t.children.delete(n),t.children.size===0}else return!0}function Qp(t,e,n){t.value!==null?n(e,t.value):Wk(t,(r,s)=>{const i=new At(e.toString()+"/"+r);Qp(s,i,n)})}function Wk(t,e){t.children.forEach((n,r)=>{e(r,n)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gk{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),n={...e};return this.last_&&mn(this.last_,(r,s)=>{n[r]=n[r]-s}),this.last_=e,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xv=10*1e3,Vk=30*1e3,Yk=5*60*1e3;class Kk{constructor(e,n){this.server_=n,this.statsToReport_={},this.statsListener_=new Gk(e);const r=Xv+(Vk-Xv)*Math.random();El(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),n={};let r=!1;mn(e,(s,i)=>{i>0&&Hr(this.statsToReport_,s)&&(n[s]=i,r=!0)}),r&&this.server_.reportStats(n),El(this.reportStats_.bind(this),Math.floor(Math.random()*2*Yk))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Nr;(function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Nr||(Nr={}));function $0(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function j0(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function F0(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ku{constructor(e,n,r){this.path=e,this.affectedTree=n,this.revert=r,this.type=Nr.ACK_USER_WRITE,this.source=$0()}operationForChild(e){if(pt(this.path)){if(this.affectedTree.value!=null)return ge(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const n=this.affectedTree.subtree(new At(e));return new ku(St(),n,this.revert)}}else return ge(ut(this.path)===e,"operationForChild called for unrelated child."),new ku($t(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tc{constructor(e,n){this.source=e,this.path=n,this.type=Nr.LISTEN_COMPLETE}operationForChild(e){return pt(this.path)?new tc(this.source,St()):new tc(this.source,$t(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xi{constructor(e,n,r){this.source=e,this.path=n,this.snap=r,this.type=Nr.OVERWRITE}operationForChild(e){return pt(this.path)?new Xi(this.source,St(),this.snap.getImmediateChild(e)):new Xi(this.source,$t(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fa{constructor(e,n,r){this.source=e,this.path=n,this.children=r,this.type=Nr.MERGE}operationForChild(e){if(pt(this.path)){const n=this.children.subtree(new At(e));return n.isEmpty()?null:n.value?new Xi(this.source,St(),n.value):new fa(this.source,St(),n)}else return ge(ut(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new fa(this.source,$t(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hi{constructor(e,n,r){this.node_=e,this.fullyInitialized_=n,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(pt(e))return this.isFullyInitialized()&&!this.filtered_;const n=ut(e);return this.isCompleteForChild(n)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xk{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Jk(t,e,n,r){const s=[],i=[];return e.forEach(o=>{o.type==="child_changed"&&t.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&i.push(Uk(o.childName,o.snapshotNode))}),el(t,s,"child_removed",e,r,n),el(t,s,"child_added",e,r,n),el(t,s,"child_moved",i,r,n),el(t,s,"child_changed",e,r,n),el(t,s,"value",e,r,n),s}function el(t,e,n,r,s,i){const o=r.filter(l=>l.type===n);o.sort((l,c)=>qk(t,l,c)),o.forEach(l=>{const c=Qk(t,l,i);s.forEach(d=>{d.respondsTo(l.type)&&e.push(d.createEvent(c,t.query_))})})}function Qk(t,e,n){return e.type==="value"||e.type==="child_removed"||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function qk(t,e,n){if(e.childName==null||n.childName==null)throw xa("Should only compare child_ events.");const r=new gt(e.childName,e.snapshotNode),s=new gt(n.childName,n.snapshotNode);return t.index_.compare(r,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uf(t,e){return{eventCache:t,serverCache:e}}function Sl(t,e,n,r){return uf(new hi(e,n,r),t.serverCache)}function hE(t,e,n,r){return uf(t.eventCache,new hi(e,n,r))}function Ru(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function Ji(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Fh;const Zk=()=>(Fh||(Fh=new Xn($C)),Fh);class Ft{static fromObject(e){let n=new Ft(null);return mn(e,(r,s)=>{n=n.set(new At(r),s)}),n}constructor(e,n=Zk()){this.value=e,this.children=n}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,n){if(this.value!=null&&n(this.value))return{path:St(),value:this.value};if(pt(e))return null;{const r=ut(e),s=this.children.get(r);if(s!==null){const i=s.findRootMostMatchingPathAndValue($t(e),n);return i!=null?{path:Jt(new At(r),i.path),value:i.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(pt(e))return this;{const n=ut(e),r=this.children.get(n);return r!==null?r.subtree($t(e)):new Ft(null)}}set(e,n){if(pt(e))return new Ft(n,this.children);{const r=ut(e),i=(this.children.get(r)||new Ft(null)).set($t(e),n),o=this.children.insert(r,i);return new Ft(this.value,o)}}remove(e){if(pt(e))return this.children.isEmpty()?new Ft(null):new Ft(null,this.children);{const n=ut(e),r=this.children.get(n);if(r){const s=r.remove($t(e));let i;return s.isEmpty()?i=this.children.remove(n):i=this.children.insert(n,s),this.value===null&&i.isEmpty()?new Ft(null):new Ft(this.value,i)}else return this}}get(e){if(pt(e))return this.value;{const n=ut(e),r=this.children.get(n);return r?r.get($t(e)):null}}setTree(e,n){if(pt(e))return n;{const r=ut(e),i=(this.children.get(r)||new Ft(null)).setTree($t(e),n);let o;return i.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,i),new Ft(this.value,o)}}fold(e){return this.fold_(St(),e)}fold_(e,n){const r={};return this.children.inorderTraversal((s,i)=>{r[s]=i.fold_(Jt(e,s),n)}),n(e,this.value,r)}findOnPath(e,n){return this.findOnPath_(e,St(),n)}findOnPath_(e,n,r){const s=this.value?r(n,this.value):!1;if(s)return s;if(pt(e))return null;{const i=ut(e),o=this.children.get(i);return o?o.findOnPath_($t(e),Jt(n,i),r):null}}foreachOnPath(e,n){return this.foreachOnPath_(e,St(),n)}foreachOnPath_(e,n,r){if(pt(e))return this;{this.value&&r(n,this.value);const s=ut(e),i=this.children.get(s);return i?i.foreachOnPath_($t(e),Jt(n,s),r):new Ft(null)}}foreach(e){this.foreach_(St(),e)}foreach_(e,n){this.children.inorderTraversal((r,s)=>{s.foreach_(Jt(e,r),n)}),this.value&&n(e,this.value)}foreachChild(e){this.children.inorderTraversal((n,r)=>{r.value&&e(n,r.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ur{constructor(e){this.writeTree_=e}static empty(){return new Ur(new Ft(null))}}function wl(t,e,n){if(pt(e))return new Ur(new Ft(n));{const r=t.writeTree_.findRootMostValueAndPath(e);if(r!=null){const s=r.path;let i=r.value;const o=jn(s,e);return i=i.updateChild(o,n),new Ur(t.writeTree_.set(s,i))}else{const s=new Ft(n),i=t.writeTree_.setTree(e,s);return new Ur(i)}}}function qp(t,e,n){let r=t;return mn(n,(s,i)=>{r=wl(r,Jt(e,s),i)}),r}function Jv(t,e){if(pt(e))return Ur.empty();{const n=t.writeTree_.setTree(e,new Ft(null));return new Ur(n)}}function Zp(t,e){return to(t,e)!=null}function to(t,e){const n=t.writeTree_.findRootMostValueAndPath(e);return n!=null?t.writeTree_.get(n.path).getChild(jn(n.path,e)):null}function Qv(t){const e=[],n=t.writeTree_.value;return n!=null?n.isLeafNode()||n.forEachChild(Yt,(r,s)=>{e.push(new gt(r,s))}):t.writeTree_.children.inorderTraversal((r,s)=>{s.value!=null&&e.push(new gt(r,s.value))}),e}function ai(t,e){if(pt(e))return t;{const n=to(t,e);return n!=null?new Ur(new Ft(n)):new Ur(t.writeTree_.subtree(e))}}function eg(t){return t.writeTree_.isEmpty()}function ha(t,e){return pE(St(),t.writeTree_,e)}function pE(t,e,n){if(e.value!=null)return n.updateChild(t,e.value);{let r=null;return e.children.inorderTraversal((s,i)=>{s===".priority"?(ge(i.value!==null,"Priority writes must always be leaf nodes"),r=i.value):n=pE(Jt(t,s),i,n)}),!n.getChild(t).isEmpty()&&r!==null&&(n=n.updateChild(Jt(t,".priority"),r)),n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ff(t,e){return vE(e,t)}function eR(t,e,n,r,s){ge(r>t.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),t.allWrites.push({path:e,snap:n,writeId:r,visible:s}),s&&(t.visibleWrites=wl(t.visibleWrites,e,n)),t.lastWriteId=r}function tR(t,e,n,r){ge(r>t.lastWriteId,"Stacking an older merge on top of newer ones"),t.allWrites.push({path:e,children:n,writeId:r,visible:!0}),t.visibleWrites=qp(t.visibleWrites,e,n),t.lastWriteId=r}function nR(t,e){for(let n=0;n<t.allWrites.length;n++){const r=t.allWrites[n];if(r.writeId===e)return r}return null}function rR(t,e){const n=t.allWrites.findIndex(l=>l.writeId===e);ge(n>=0,"removeWrite called with nonexistent writeId.");const r=t.allWrites[n];t.allWrites.splice(n,1);let s=r.visible,i=!1,o=t.allWrites.length-1;for(;s&&o>=0;){const l=t.allWrites[o];l.visible&&(o>=n&&sR(l,r.path)?s=!1:Er(r.path,l.path)&&(i=!0)),o--}if(s){if(i)return iR(t),!0;if(r.snap)t.visibleWrites=Jv(t.visibleWrites,r.path);else{const l=r.children;mn(l,c=>{t.visibleWrites=Jv(t.visibleWrites,Jt(r.path,c))})}return!0}else return!1}function sR(t,e){if(t.snap)return Er(t.path,e);for(const n in t.children)if(t.children.hasOwnProperty(n)&&Er(Jt(t.path,n),e))return!0;return!1}function iR(t){t.visibleWrites=gE(t.allWrites,oR,St()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function oR(t){return t.visible}function gE(t,e,n){let r=Ur.empty();for(let s=0;s<t.length;++s){const i=t[s];if(e(i)){const o=i.path;let l;if(i.snap)Er(n,o)?(l=jn(n,o),r=wl(r,l,i.snap)):Er(o,n)&&(l=jn(o,n),r=wl(r,St(),i.snap.getChild(l)));else if(i.children){if(Er(n,o))l=jn(n,o),r=qp(r,l,i.children);else if(Er(o,n))if(l=jn(o,n),pt(l))r=qp(r,St(),i.children);else{const c=Gi(i.children,ut(l));if(c){const d=c.getChild($t(l));r=wl(r,St(),d)}}}else throw xa("WriteRecord should have .snap or .children")}}return r}function mE(t,e,n,r,s){if(!r&&!s){const i=to(t.visibleWrites,e);if(i!=null)return i;{const o=ai(t.visibleWrites,e);if(eg(o))return n;if(n==null&&!Zp(o,St()))return null;{const l=n||Je.EMPTY_NODE;return ha(o,l)}}}else{const i=ai(t.visibleWrites,e);if(!s&&eg(i))return n;if(!s&&n==null&&!Zp(i,St()))return null;{const o=function(d){return(d.visible||s)&&(!r||!~r.indexOf(d.writeId))&&(Er(d.path,e)||Er(e,d.path))},l=gE(t.allWrites,o,e),c=n||Je.EMPTY_NODE;return ha(l,c)}}}function aR(t,e,n){let r=Je.EMPTY_NODE;const s=to(t.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(Yt,(i,o)=>{r=r.updateImmediateChild(i,o)}),r;if(n){const i=ai(t.visibleWrites,e);return n.forEachChild(Yt,(o,l)=>{const c=ha(ai(i,new At(o)),l);r=r.updateImmediateChild(o,c)}),Qv(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{const i=ai(t.visibleWrites,e);return Qv(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function lR(t,e,n,r,s){ge(r||s,"Either existingEventSnap or existingServerSnap must exist");const i=Jt(e,n);if(Zp(t.visibleWrites,i))return null;{const o=ai(t.visibleWrites,i);return eg(o)?s.getChild(n):ha(o,s.getChild(n))}}function cR(t,e,n,r){const s=Jt(e,n),i=to(t.visibleWrites,s);if(i!=null)return i;if(r.isCompleteForChild(n)){const o=ai(t.visibleWrites,s);return ha(o,r.getNode().getImmediateChild(n))}else return null}function dR(t,e){return to(t.visibleWrites,e)}function uR(t,e,n,r,s,i,o){let l;const c=ai(t.visibleWrites,e),d=to(c,St());if(d!=null)l=d;else if(n!=null)l=ha(c,n);else return[];if(l=l.withIndex(o),!l.isEmpty()&&!l.isLeafNode()){const u=[],h=o.getCompare(),f=i?l.getReverseIteratorFrom(r,o):l.getIteratorFrom(r,o);let b=f.getNext();for(;b&&u.length<s;)h(b,r)!==0&&u.push(b),b=f.getNext();return u}else return[]}function fR(){return{visibleWrites:Ur.empty(),allWrites:[],lastWriteId:-1}}function Au(t,e,n,r){return mE(t.writeTree,t.treePath,e,n,r)}function U0(t,e){return aR(t.writeTree,t.treePath,e)}function qv(t,e,n,r){return lR(t.writeTree,t.treePath,e,n,r)}function Pu(t,e){return dR(t.writeTree,Jt(t.treePath,e))}function hR(t,e,n,r,s,i){return uR(t.writeTree,t.treePath,e,n,r,s,i)}function B0(t,e,n){return cR(t.writeTree,t.treePath,e,n)}function yE(t,e){return vE(Jt(t.treePath,e),t.writeTree)}function vE(t,e){return{treePath:t,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pR{constructor(){this.changeMap=new Map}trackChildChange(e){const n=e.type,r=e.childName;ge(n==="child_added"||n==="child_changed"||n==="child_removed","Only child changes supported for tracking"),ge(r!==".priority","Only non-priority child changes can be tracked.");const s=this.changeMap.get(r);if(s){const i=s.type;if(n==="child_added"&&i==="child_removed")this.changeMap.set(r,Zl(r,e.snapshotNode,s.snapshotNode));else if(n==="child_removed"&&i==="child_added")this.changeMap.delete(r);else if(n==="child_removed"&&i==="child_changed")this.changeMap.set(r,ql(r,s.oldSnap));else if(n==="child_changed"&&i==="child_added")this.changeMap.set(r,ua(r,e.snapshotNode));else if(n==="child_changed"&&i==="child_changed")this.changeMap.set(r,Zl(r,e.snapshotNode,s.oldSnap));else throw xa("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gR{getCompleteChild(e){return null}getChildAfterChild(e,n,r){return null}}const xE=new gR;class z0{constructor(e,n,r=null){this.writes_=e,this.viewCache_=n,this.optCompleteServerCache_=r}getCompleteChild(e){const n=this.viewCache_.eventCache;if(n.isCompleteForChild(e))return n.getNode().getImmediateChild(e);{const r=this.optCompleteServerCache_!=null?new hi(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return B0(this.writes_,e,r)}}getChildAfterChild(e,n,r){const s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Ji(this.viewCache_),i=hR(this.writes_,s,n,1,r,e);return i.length===0?null:i[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mR(t){return{filter:t}}function yR(t,e){ge(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),ge(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function vR(t,e,n,r,s){const i=new pR;let o,l;if(n.type===Nr.OVERWRITE){const d=n;d.source.fromUser?o=tg(t,e,d.path,d.snap,r,s,i):(ge(d.source.fromServer,"Unknown source."),l=d.source.tagged||e.serverCache.isFiltered()&&!pt(d.path),o=Ou(t,e,d.path,d.snap,r,s,l,i))}else if(n.type===Nr.MERGE){const d=n;d.source.fromUser?o=_R(t,e,d.path,d.children,r,s,i):(ge(d.source.fromServer,"Unknown source."),l=d.source.tagged||e.serverCache.isFiltered(),o=ng(t,e,d.path,d.children,r,s,l,i))}else if(n.type===Nr.ACK_USER_WRITE){const d=n;d.revert?o=SR(t,e,d.path,r,s,i):o=bR(t,e,d.path,d.affectedTree,r,s,i)}else if(n.type===Nr.LISTEN_COMPLETE)o=ER(t,e,n.path,r,i);else throw xa("Unknown operation type: "+n.type);const c=i.getChanges();return xR(e,o,c),{viewCache:o,changes:c}}function xR(t,e,n){const r=e.eventCache;if(r.isFullyInitialized()){const s=r.getNode().isLeafNode()||r.getNode().isEmpty(),i=Ru(t);(n.length>0||!t.eventCache.isFullyInitialized()||s&&!r.getNode().equals(i)||!r.getNode().getPriority().equals(i.getPriority()))&&n.push(fE(Ru(e)))}}function _E(t,e,n,r,s,i){const o=e.eventCache;if(Pu(r,n)!=null)return e;{let l,c;if(pt(n))if(ge(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const d=Ji(e),u=d instanceof Je?d:Je.EMPTY_NODE,h=U0(r,u);l=t.filter.updateFullNode(e.eventCache.getNode(),h,i)}else{const d=Au(r,Ji(e));l=t.filter.updateFullNode(e.eventCache.getNode(),d,i)}else{const d=ut(n);if(d===".priority"){ge(fi(n)===1,"Can't have a priority with additional path components");const u=o.getNode();c=e.serverCache.getNode();const h=qv(r,n,u,c);h!=null?l=t.filter.updatePriority(u,h):l=o.getNode()}else{const u=$t(n);let h;if(o.isCompleteForChild(d)){c=e.serverCache.getNode();const f=qv(r,n,o.getNode(),c);f!=null?h=o.getNode().getImmediateChild(d).updateChild(u,f):h=o.getNode().getImmediateChild(d)}else h=B0(r,d,e.serverCache);h!=null?l=t.filter.updateChild(o.getNode(),d,h,u,s,i):l=o.getNode()}}return Sl(e,l,o.isFullyInitialized()||pt(n),t.filter.filtersNodes())}}function Ou(t,e,n,r,s,i,o,l){const c=e.serverCache;let d;const u=o?t.filter:t.filter.getIndexedFilter();if(pt(n))d=u.updateFullNode(c.getNode(),r,null);else if(u.filtersNodes()&&!c.isFiltered()){const b=c.getNode().updateChild(n,r);d=u.updateFullNode(c.getNode(),b,null)}else{const b=ut(n);if(!c.isCompleteForPath(n)&&fi(n)>1)return e;const C=$t(n),A=c.getNode().getImmediateChild(b).updateChild(C,r);b===".priority"?d=u.updatePriority(c.getNode(),A):d=u.updateChild(c.getNode(),b,A,C,xE,null)}const h=hE(e,d,c.isFullyInitialized()||pt(n),u.filtersNodes()),f=new z0(s,h,i);return _E(t,h,n,s,f,l)}function tg(t,e,n,r,s,i,o){const l=e.eventCache;let c,d;const u=new z0(s,e,i);if(pt(n))d=t.filter.updateFullNode(e.eventCache.getNode(),r,o),c=Sl(e,d,!0,t.filter.filtersNodes());else{const h=ut(n);if(h===".priority")d=t.filter.updatePriority(e.eventCache.getNode(),r),c=Sl(e,d,l.isFullyInitialized(),l.isFiltered());else{const f=$t(n),b=l.getNode().getImmediateChild(h);let C;if(pt(f))C=r;else{const k=u.getCompleteChild(h);k!=null?P0(f)===".priority"&&k.getChild(iE(f)).isEmpty()?C=k:C=k.updateChild(f,r):C=Je.EMPTY_NODE}if(b.equals(C))c=e;else{const k=t.filter.updateChild(l.getNode(),h,C,f,u,o);c=Sl(e,k,l.isFullyInitialized(),t.filter.filtersNodes())}}}return c}function Zv(t,e){return t.eventCache.isCompleteForChild(e)}function _R(t,e,n,r,s,i,o){let l=e;return r.foreach((c,d)=>{const u=Jt(n,c);Zv(e,ut(u))&&(l=tg(t,l,u,d,s,i,o))}),r.foreach((c,d)=>{const u=Jt(n,c);Zv(e,ut(u))||(l=tg(t,l,u,d,s,i,o))}),l}function ex(t,e,n){return n.foreach((r,s)=>{e=e.updateChild(r,s)}),e}function ng(t,e,n,r,s,i,o,l){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,d;pt(n)?d=r:d=new Ft(null).setTree(n,r);const u=e.serverCache.getNode();return d.children.inorderTraversal((h,f)=>{if(u.hasChild(h)){const b=e.serverCache.getNode().getImmediateChild(h),C=ex(t,b,f);c=Ou(t,c,new At(h),C,s,i,o,l)}}),d.children.inorderTraversal((h,f)=>{const b=!e.serverCache.isCompleteForChild(h)&&f.value===null;if(!u.hasChild(h)&&!b){const C=e.serverCache.getNode().getImmediateChild(h),k=ex(t,C,f);c=Ou(t,c,new At(h),k,s,i,o,l)}}),c}function bR(t,e,n,r,s,i,o){if(Pu(s,n)!=null)return e;const l=e.serverCache.isFiltered(),c=e.serverCache;if(r.value!=null){if(pt(n)&&c.isFullyInitialized()||c.isCompleteForPath(n))return Ou(t,e,n,c.getNode().getChild(n),s,i,l,o);if(pt(n)){let d=new Ft(null);return c.getNode().forEachChild(Jo,(u,h)=>{d=d.set(new At(u),h)}),ng(t,e,n,d,s,i,l,o)}else return e}else{let d=new Ft(null);return r.foreach((u,h)=>{const f=Jt(n,u);c.isCompleteForPath(f)&&(d=d.set(u,c.getNode().getChild(f)))}),ng(t,e,n,d,s,i,l,o)}}function ER(t,e,n,r,s){const i=e.serverCache,o=hE(e,i.getNode(),i.isFullyInitialized()||pt(n),i.isFiltered());return _E(t,o,n,r,xE,s)}function SR(t,e,n,r,s,i){let o;if(Pu(r,n)!=null)return e;{const l=new z0(r,e,s),c=e.eventCache.getNode();let d;if(pt(n)||ut(n)===".priority"){let u;if(e.serverCache.isFullyInitialized())u=Au(r,Ji(e));else{const h=e.serverCache.getNode();ge(h instanceof Je,"serverChildren would be complete if leaf node"),u=U0(r,h)}u=u,d=t.filter.updateFullNode(c,u,i)}else{const u=ut(n);let h=B0(r,u,e.serverCache);h==null&&e.serverCache.isCompleteForChild(u)&&(h=c.getImmediateChild(u)),h!=null?d=t.filter.updateChild(c,u,h,$t(n),l,i):e.eventCache.getNode().hasChild(u)?d=t.filter.updateChild(c,u,Je.EMPTY_NODE,$t(n),l,i):d=c,d.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Au(r,Ji(e)),o.isLeafNode()&&(d=t.filter.updateFullNode(d,o,i)))}return o=e.serverCache.isFullyInitialized()||Pu(r,St())!=null,Sl(e,d,o,t.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wR{constructor(e,n){this.query_=e,this.eventRegistrations_=[];const r=this.query_._queryParams,s=new D0(r.getIndex()),i=zk(r);this.processor_=mR(i);const o=n.serverCache,l=n.eventCache,c=s.updateFullNode(Je.EMPTY_NODE,o.getNode(),null),d=i.updateFullNode(Je.EMPTY_NODE,l.getNode(),null),u=new hi(c,o.isFullyInitialized(),s.filtersNodes()),h=new hi(d,l.isFullyInitialized(),i.filtersNodes());this.viewCache_=uf(h,u),this.eventGenerator_=new Xk(this.query_)}get query(){return this.query_}}function IR(t){return t.viewCache_.serverCache.getNode()}function TR(t){return Ru(t.viewCache_)}function CR(t,e){const n=Ji(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!pt(e)&&!n.getImmediateChild(ut(e)).isEmpty())?n.getChild(e):null}function tx(t){return t.eventRegistrations_.length===0}function kR(t,e){t.eventRegistrations_.push(e)}function nx(t,e,n){const r=[];if(n){ge(e==null,"A cancel should cancel all event registrations.");const s=t.query._path;t.eventRegistrations_.forEach(i=>{const o=i.createCancelEvent(n,s);o&&r.push(o)})}if(e){let s=[];for(let i=0;i<t.eventRegistrations_.length;++i){const o=t.eventRegistrations_[i];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(t.eventRegistrations_.slice(i+1));break}}t.eventRegistrations_=s}else t.eventRegistrations_=[];return r}function rx(t,e,n,r){e.type===Nr.MERGE&&e.source.queryId!==null&&(ge(Ji(t.viewCache_),"We should always have a full cache before handling merges"),ge(Ru(t.viewCache_),"Missing event cache, even though we have a server cache"));const s=t.viewCache_,i=vR(t.processor_,s,e,n,r);return yR(t.processor_,i.viewCache),ge(i.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=i.viewCache,bE(t,i.changes,i.viewCache.eventCache.getNode(),null)}function RR(t,e){const n=t.viewCache_.eventCache,r=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(Yt,(i,o)=>{r.push(ua(i,o))}),n.isFullyInitialized()&&r.push(fE(n.getNode())),bE(t,r,n.getNode(),e)}function bE(t,e,n,r){const s=r?[r]:t.eventRegistrations_;return Jk(t.eventGenerator_,e,n,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Lu;class EE{constructor(){this.views=new Map}}function AR(t){ge(!Lu,"__referenceConstructor has already been defined"),Lu=t}function PR(){return ge(Lu,"Reference.ts has not been loaded"),Lu}function OR(t){return t.views.size===0}function H0(t,e,n,r){const s=e.source.queryId;if(s!==null){const i=t.views.get(s);return ge(i!=null,"SyncTree gave us an op for an invalid query."),rx(i,e,n,r)}else{let i=[];for(const o of t.views.values())i=i.concat(rx(o,e,n,r));return i}}function SE(t,e,n,r,s){const i=e._queryIdentifier,o=t.views.get(i);if(!o){let l=Au(n,s?r:null),c=!1;l?c=!0:r instanceof Je?(l=U0(n,r),c=!1):(l=Je.EMPTY_NODE,c=!1);const d=uf(new hi(l,c,!1),new hi(r,s,!1));return new wR(e,d)}return o}function LR(t,e,n,r,s,i){const o=SE(t,e,r,s,i);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,o),kR(o,n),RR(o,n)}function MR(t,e,n,r){const s=e._queryIdentifier,i=[];let o=[];const l=pi(t);if(s==="default")for(const[c,d]of t.views.entries())o=o.concat(nx(d,n,r)),tx(d)&&(t.views.delete(c),d.query._queryParams.loadsAllData()||i.push(d.query));else{const c=t.views.get(s);c&&(o=o.concat(nx(c,n,r)),tx(c)&&(t.views.delete(s),c.query._queryParams.loadsAllData()||i.push(c.query)))}return l&&!pi(t)&&i.push(new(PR())(e._repo,e._path)),{removed:i,events:o}}function wE(t){const e=[];for(const n of t.views.values())n.query._queryParams.loadsAllData()||e.push(n);return e}function li(t,e){let n=null;for(const r of t.views.values())n=n||CR(r,e);return n}function IE(t,e){if(e._queryParams.loadsAllData())return hf(t);{const r=e._queryIdentifier;return t.views.get(r)}}function TE(t,e){return IE(t,e)!=null}function pi(t){return hf(t)!=null}function hf(t){for(const e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Mu;function DR(t){ge(!Mu,"__referenceConstructor has already been defined"),Mu=t}function NR(){return ge(Mu,"Reference.ts has not been loaded"),Mu}let $R=1;class sx{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Ft(null),this.pendingWriteTree_=fR(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function W0(t,e,n,r,s){return eR(t.pendingWriteTree_,e,n,r,s),s?Ia(t,new Xi($0(),e,n)):[]}function jR(t,e,n,r){tR(t.pendingWriteTree_,e,n,r);const s=Ft.fromObject(n);return Ia(t,new fa($0(),e,s))}function Ys(t,e,n=!1){const r=nR(t.pendingWriteTree_,e);if(rR(t.pendingWriteTree_,e)){let i=new Ft(null);return r.snap!=null?i=i.set(St(),!0):mn(r.children,o=>{i=i.set(new At(o),!0)}),Ia(t,new ku(r.path,i,n))}else return[]}function vc(t,e,n){return Ia(t,new Xi(j0(),e,n))}function FR(t,e,n){const r=Ft.fromObject(n);return Ia(t,new fa(j0(),e,r))}function UR(t,e){return Ia(t,new tc(j0(),e))}function BR(t,e,n){const r=G0(t,n);if(r){const s=V0(r),i=s.path,o=s.queryId,l=jn(i,e),c=new tc(F0(o),l);return Y0(t,i,c)}else return[]}function Du(t,e,n,r,s=!1){const i=e._path,o=t.syncPointTree_.get(i);let l=[];if(o&&(e._queryIdentifier==="default"||TE(o,e))){const c=MR(o,e,n,r);OR(o)&&(t.syncPointTree_=t.syncPointTree_.remove(i));const d=c.removed;if(l=c.events,!s){const u=d.findIndex(f=>f._queryParams.loadsAllData())!==-1,h=t.syncPointTree_.findOnPath(i,(f,b)=>pi(b));if(u&&!h){const f=t.syncPointTree_.subtree(i);if(!f.isEmpty()){const b=WR(f);for(let C=0;C<b.length;++C){const k=b[C],A=k.query,R=AE(t,k);t.listenProvider_.startListening(Il(A),nc(t,A),R.hashFn,R.onComplete)}}}!h&&d.length>0&&!r&&(u?t.listenProvider_.stopListening(Il(e),null):d.forEach(f=>{const b=t.queryToTagMap.get(gf(f));t.listenProvider_.stopListening(Il(f),b)}))}GR(t,d)}return l}function CE(t,e,n,r){const s=G0(t,r);if(s!=null){const i=V0(s),o=i.path,l=i.queryId,c=jn(o,e),d=new Xi(F0(l),c,n);return Y0(t,o,d)}else return[]}function zR(t,e,n,r){const s=G0(t,r);if(s){const i=V0(s),o=i.path,l=i.queryId,c=jn(o,e),d=Ft.fromObject(n),u=new fa(F0(l),c,d);return Y0(t,o,u)}else return[]}function rg(t,e,n,r=!1){const s=e._path;let i=null,o=!1;t.syncPointTree_.foreachOnPath(s,(f,b)=>{const C=jn(f,s);i=i||li(b,C),o=o||pi(b)});let l=t.syncPointTree_.get(s);l?(o=o||pi(l),i=i||li(l,St())):(l=new EE,t.syncPointTree_=t.syncPointTree_.set(s,l));let c;i!=null?c=!0:(c=!1,i=Je.EMPTY_NODE,t.syncPointTree_.subtree(s).foreachChild((b,C)=>{const k=li(C,St());k&&(i=i.updateImmediateChild(b,k))}));const d=TE(l,e);if(!d&&!e._queryParams.loadsAllData()){const f=gf(e);ge(!t.queryToTagMap.has(f),"View does not exist, but we have a tag");const b=VR();t.queryToTagMap.set(f,b),t.tagToQueryMap.set(b,f)}const u=ff(t.pendingWriteTree_,s);let h=LR(l,e,n,u,i,c);if(!d&&!o&&!r){const f=IE(l,e);h=h.concat(YR(t,e,f))}return h}function pf(t,e,n){const s=t.pendingWriteTree_,i=t.syncPointTree_.findOnPath(e,(o,l)=>{const c=jn(o,e),d=li(l,c);if(d)return d});return mE(s,e,i,n,!0)}function HR(t,e){const n=e._path;let r=null;t.syncPointTree_.foreachOnPath(n,(d,u)=>{const h=jn(d,n);r=r||li(u,h)});let s=t.syncPointTree_.get(n);s?r=r||li(s,St()):(s=new EE,t.syncPointTree_=t.syncPointTree_.set(n,s));const i=r!=null,o=i?new hi(r,!0,!1):null,l=ff(t.pendingWriteTree_,e._path),c=SE(s,e,l,i?o.getNode():Je.EMPTY_NODE,i);return TR(c)}function Ia(t,e){return kE(e,t.syncPointTree_,null,ff(t.pendingWriteTree_,St()))}function kE(t,e,n,r){if(pt(t.path))return RE(t,e,n,r);{const s=e.get(St());n==null&&s!=null&&(n=li(s,St()));let i=[];const o=ut(t.path),l=t.operationForChild(o),c=e.children.get(o);if(c&&l){const d=n?n.getImmediateChild(o):null,u=yE(r,o);i=i.concat(kE(l,c,d,u))}return s&&(i=i.concat(H0(s,t,r,n))),i}}function RE(t,e,n,r){const s=e.get(St());n==null&&s!=null&&(n=li(s,St()));let i=[];return e.children.inorderTraversal((o,l)=>{const c=n?n.getImmediateChild(o):null,d=yE(r,o),u=t.operationForChild(o);u&&(i=i.concat(RE(u,l,c,d)))}),s&&(i=i.concat(H0(s,t,r,n))),i}function AE(t,e){const n=e.query,r=nc(t,n);return{hashFn:()=>(IR(e)||Je.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return r?BR(t,n._path,r):UR(t,n._path);{const i=UC(s,n);return Du(t,n,null,i)}}}}function nc(t,e){const n=gf(e);return t.queryToTagMap.get(n)}function gf(t){return t._path.toString()+"$"+t._queryIdentifier}function G0(t,e){return t.tagToQueryMap.get(e)}function V0(t){const e=t.indexOf("$");return ge(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new At(t.substr(0,e))}}function Y0(t,e,n){const r=t.syncPointTree_.get(e);ge(r,"Missing sync point for query tag that we're tracking");const s=ff(t.pendingWriteTree_,e);return H0(r,n,s,null)}function WR(t){return t.fold((e,n,r)=>{if(n&&pi(n))return[hf(n)];{let s=[];return n&&(s=wE(n)),mn(r,(i,o)=>{s=s.concat(o)}),s}})}function Il(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(NR())(t._repo,t._path):t}function GR(t,e){for(let n=0;n<e.length;++n){const r=e[n];if(!r._queryParams.loadsAllData()){const s=gf(r),i=t.queryToTagMap.get(s);t.queryToTagMap.delete(s),t.tagToQueryMap.delete(i)}}}function VR(){return $R++}function YR(t,e,n){const r=e._path,s=nc(t,e),i=AE(t,n),o=t.listenProvider_.startListening(Il(e),s,i.hashFn,i.onComplete),l=t.syncPointTree_.subtree(r);if(s)ge(!pi(l.value),"If we're adding a query, it shouldn't be shadowed");else{const c=l.fold((d,u,h)=>{if(!pt(d)&&u&&pi(u))return[hf(u).query];{let f=[];return u&&(f=f.concat(wE(u).map(b=>b.query))),mn(h,(b,C)=>{f=f.concat(C)}),f}});for(let d=0;d<c.length;++d){const u=c[d];t.listenProvider_.stopListening(Il(u),nc(t,u))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K0{constructor(e){this.node_=e}getImmediateChild(e){const n=this.node_.getImmediateChild(e);return new K0(n)}node(){return this.node_}}class X0{constructor(e,n){this.syncTree_=e,this.path_=n}getImmediateChild(e){const n=Jt(this.path_,e);return new X0(this.syncTree_,n)}node(){return pf(this.syncTree_,this.path_)}}const KR=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},ix=function(t,e,n){if(!t||typeof t!="object")return t;if(ge(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return XR(t[".sv"],e,n);if(typeof t[".sv"]=="object")return JR(t[".sv"],e);ge(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},XR=function(t,e,n){switch(t){case"timestamp":return n.timestamp;default:ge(!1,"Unexpected server value: "+t)}},JR=function(t,e,n){t.hasOwnProperty("increment")||ge(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const r=t.increment;typeof r!="number"&&ge(!1,"Unexpected increment value: "+r);const s=e.node();if(ge(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return r;const o=s.getValue();return typeof o!="number"?r:o+r},PE=function(t,e,n,r){return Q0(e,new X0(n,t),r)},J0=function(t,e,n){return Q0(t,new K0(e),n)};function Q0(t,e,n){const r=t.getPriority().val(),s=ix(r,e.getImmediateChild(".priority"),n);let i;if(t.isLeafNode()){const o=t,l=ix(o.getValue(),e,n);return l!==o.getValue()||s!==o.getPriority().val()?new un(l,Xt(s)):t}else{const o=t;return i=o,s!==o.getPriority().val()&&(i=i.updatePriority(new un(s))),o.forEachChild(Yt,(l,c)=>{const d=Q0(c,e.getImmediateChild(l),n);d!==c&&(i=i.updateImmediateChild(l,d))}),i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q0{constructor(e="",n=null,r={children:{},childCount:0}){this.name=e,this.parent=n,this.node=r}}function mf(t,e){let n=e instanceof At?e:new At(e),r=t,s=ut(n);for(;s!==null;){const i=Gi(r.node.children,s)||{children:{},childCount:0};r=new q0(s,r,i),n=$t(n),s=ut(n)}return r}function no(t){return t.node.value}function Z0(t,e){t.node.value=e,sg(t)}function OE(t){return t.node.childCount>0}function QR(t){return no(t)===void 0&&!OE(t)}function yf(t,e){mn(t.node.children,(n,r)=>{e(new q0(n,t,r))})}function LE(t,e,n,r){n&&e(t),yf(t,s=>{LE(s,e,!0)})}function qR(t,e,n){let r=t.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function xc(t){return new At(t.parent===null?t.name:xc(t.parent)+"/"+t.name)}function sg(t){t.parent!==null&&ZR(t.parent,t.name,t)}function ZR(t,e,n){const r=QR(n),s=Hr(t.node.children,e);r&&s?(delete t.node.children[e],t.node.childCount--,sg(t)):!r&&!s&&(t.node.children[e]=n.node,t.node.childCount++,sg(t))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eA=/[\[\].#$\/\u0000-\u001F\u007F]/,tA=/[\[\].#$\u0000-\u001F\u007F]/,Uh=10*1024*1024,em=function(t){return typeof t=="string"&&t.length!==0&&!eA.test(t)},ME=function(t){return typeof t=="string"&&t.length!==0&&!tA.test(t)},nA=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),ME(t)},tm=function(t){return t===null||typeof t=="string"||typeof t=="number"&&!cf(t)||t&&typeof t=="object"&&Hr(t,".sv")},Nu=function(t,e,n,r){r&&e===void 0||_c(la(t,"value"),e,n)},_c=function(t,e,n){const r=n instanceof At?new _k(n,t):n;if(e===void 0)throw new Error(t+"contains undefined "+Oi(r));if(typeof e=="function")throw new Error(t+"contains a function "+Oi(r)+" with contents = "+e.toString());if(cf(e))throw new Error(t+"contains "+e.toString()+" "+Oi(r));if(typeof e=="string"&&e.length>Uh/3&&lf(e)>Uh)throw new Error(t+"contains a string greater than "+Uh+" utf8 bytes "+Oi(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,i=!1;if(mn(e,(o,l)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(i=!0,!em(o)))throw new Error(t+" contains an invalid key ("+o+") "+Oi(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);bk(r,o),_c(t,l,r),Ek(r)}),s&&i)throw new Error(t+' contains ".value" child '+Oi(r)+" in addition to actual children.")}},rA=function(t,e){let n,r;for(n=0;n<e.length;n++){r=e[n];const i=Ql(r);for(let o=0;o<i.length;o++)if(!(i[o]===".priority"&&o===i.length-1)){if(!em(i[o]))throw new Error(t+"contains an invalid key ("+i[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(xk);let s=null;for(n=0;n<e.length;n++){if(r=e[n],s!==null&&Er(s,r))throw new Error(t+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}},DE=function(t,e,n,r){const s=la(t,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");const i=[];mn(e,(o,l)=>{const c=new At(o);if(_c(s,l,Jt(n,c)),P0(c)===".priority"&&!tm(l))throw new Error(s+"contains an invalid value for '"+c.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");i.push(c)}),rA(s,i)},sA=function(t,e,n){if(cf(e))throw new Error(la(t,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!tm(e))throw new Error(la(t,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")},NE=function(t,e,n,r){if(!ME(n))throw new Error(la(t,e)+'was an invalid path = "'+n+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},iA=function(t,e,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),NE(t,e,n)},Ks=function(t,e){if(ut(e)===".info")throw new Error(t+" failed = Can't modify data under /.info/")},oA=function(t,e){const n=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!em(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||n.length!==0&&!nA(n))throw new Error(la(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aA{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function vf(t,e){let n=null;for(let r=0;r<e.length;r++){const s=e[r],i=s.getPath();n!==null&&!O0(i,n.path)&&(t.eventLists_.push(n),n=null),n===null&&(n={events:[],path:i}),n.events.push(s)}n&&t.eventLists_.push(n)}function $E(t,e,n){vf(t,n),jE(t,r=>O0(r,e))}function dr(t,e,n){vf(t,n),jE(t,r=>Er(r,e)||Er(e,r))}function jE(t,e){t.recursionDepth_++;let n=!0;for(let r=0;r<t.eventLists_.length;r++){const s=t.eventLists_[r];if(s){const i=s.path;e(i)?(lA(t.eventLists_[r]),t.eventLists_[r]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function lA(t){for(let e=0;e<t.events.length;e++){const n=t.events[e];if(n!==null){t.events[e]=null;const r=n.getEventRunner();bl&&pn("event: "+n.toString()),Sa(r)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cA="repo_interrupt",dA=25;class uA{constructor(e,n,r,s){this.repoInfo_=e,this.forceRestClient_=n,this.authTokenProvider_=r,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new aA,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Cu(),this.transactionQueueTree_=new q0,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function fA(t,e,n){if(t.stats_=R0(t.repoInfo_),t.forceRestClient_||WC())t.server_=new Tu(t.repoInfo_,(r,s,i,o)=>{ox(t,r,s,i,o)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>ax(t,!0),0);else{if(typeof n<"u"&&n!==null){if(typeof n!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{ln(n)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}t.persistentConnection_=new hs(t.repoInfo_,e,(r,s,i,o)=>{ox(t,r,s,i,o)},r=>{ax(t,r)},r=>{hA(t,r)},t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(r=>{t.server_.refreshAuthToken(r)}),t.appCheckProvider_.addTokenChangeListener(r=>{t.server_.refreshAppCheckToken(r.token)}),t.statsReporter_=XC(t.repoInfo_,()=>new Kk(t.stats_,t.server_)),t.infoData_=new Hk,t.infoSyncTree_=new sx({startListening:(r,s,i,o)=>{let l=[];const c=t.infoData_.getNode(r._path);return c.isEmpty()||(l=vc(t.infoSyncTree_,r._path,c),setTimeout(()=>{o("ok")},0)),l},stopListening:()=>{}}),nm(t,"connected",!1),t.serverSyncTree_=new sx({startListening:(r,s,i,o)=>(t.server_.listen(r,i,s,(l,c)=>{const d=o(l,c);dr(t.eventQueue_,r._path,d)}),[]),stopListening:(r,s)=>{t.server_.unlisten(r,s)}})}function FE(t){const n=t.infoData_.getNode(new At(".info/serverTimeOffset")).val()||0;return new Date().getTime()+n}function bc(t){return KR({timestamp:FE(t)})}function ox(t,e,n,r,s){t.dataUpdateCount++;const i=new At(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let o=[];if(s)if(r){const c=bu(n,d=>Xt(d));o=zR(t.serverSyncTree_,i,c,s)}else{const c=Xt(n);o=CE(t.serverSyncTree_,i,c,s)}else if(r){const c=bu(n,d=>Xt(d));o=FR(t.serverSyncTree_,i,c)}else{const c=Xt(n);o=vc(t.serverSyncTree_,i,c)}let l=i;o.length>0&&(l=pa(t,i)),dr(t.eventQueue_,l,o)}function ax(t,e){nm(t,"connected",e),e===!1&&yA(t)}function hA(t,e){mn(e,(n,r)=>{nm(t,n,r)})}function nm(t,e,n){const r=new At("/.info/"+e),s=Xt(n);t.infoData_.updateSnapshot(r,s);const i=vc(t.infoSyncTree_,r,s);dr(t.eventQueue_,r,i)}function xf(t){return t.nextWriteId_++}function pA(t,e,n){const r=HR(t.serverSyncTree_,e);return r!=null?Promise.resolve(r):t.server_.get(e).then(s=>{const i=Xt(s).withIndex(e._queryParams.getIndex());rg(t.serverSyncTree_,e,n,!0);let o;if(e._queryParams.loadsAllData())o=vc(t.serverSyncTree_,e._path,i);else{const l=nc(t.serverSyncTree_,e);o=CE(t.serverSyncTree_,e._path,i,l)}return dr(t.eventQueue_,e._path,o),Du(t.serverSyncTree_,e,n,null,!0),i},s=>(Ta(t,"get for query "+ln(e)+" failed: "+s),Promise.reject(new Error(s))))}function gA(t,e,n,r,s){Ta(t,"set",{path:e.toString(),value:n,priority:r});const i=bc(t),o=Xt(n,r),l=pf(t.serverSyncTree_,e),c=J0(o,l,i),d=xf(t),u=W0(t.serverSyncTree_,e,c,d,!0);vf(t.eventQueue_,u),t.server_.put(e.toString(),o.val(!0),(f,b)=>{const C=f==="ok";C||Un("set at "+e+" failed: "+f);const k=Ys(t.serverSyncTree_,d,!C);dr(t.eventQueue_,e,k),gi(t,s,f,b)});const h=sm(t,e);pa(t,h),dr(t.eventQueue_,h,[])}function mA(t,e,n,r){Ta(t,"update",{path:e.toString(),value:n});let s=!0;const i=bc(t),o={};if(mn(n,(l,c)=>{s=!1,o[l]=PE(Jt(e,l),Xt(c),t.serverSyncTree_,i)}),s)pn("update() called with empty data.  Don't do anything."),gi(t,r,"ok",void 0);else{const l=xf(t),c=jR(t.serverSyncTree_,e,o,l);vf(t.eventQueue_,c),t.server_.merge(e.toString(),n,(d,u)=>{const h=d==="ok";h||Un("update at "+e+" failed: "+d);const f=Ys(t.serverSyncTree_,l,!h),b=f.length>0?pa(t,e):e;dr(t.eventQueue_,b,f),gi(t,r,d,u)}),mn(n,d=>{const u=sm(t,Jt(e,d));pa(t,u)}),dr(t.eventQueue_,e,[])}}function yA(t){Ta(t,"onDisconnectEvents");const e=bc(t),n=Cu();Qp(t.onDisconnect_,St(),(s,i)=>{const o=PE(s,i,t.serverSyncTree_,e);wa(n,s,o)});let r=[];Qp(n,St(),(s,i)=>{r=r.concat(vc(t.serverSyncTree_,s,i));const o=sm(t,s);pa(t,o)}),t.onDisconnect_=Cu(),dr(t.eventQueue_,St(),r)}function vA(t,e,n){t.server_.onDisconnectCancel(e.toString(),(r,s)=>{r==="ok"&&Jp(t.onDisconnect_,e),gi(t,n,r,s)})}function lx(t,e,n,r){const s=Xt(n);t.server_.onDisconnectPut(e.toString(),s.val(!0),(i,o)=>{i==="ok"&&wa(t.onDisconnect_,e,s),gi(t,r,i,o)})}function xA(t,e,n,r,s){const i=Xt(n,r);t.server_.onDisconnectPut(e.toString(),i.val(!0),(o,l)=>{o==="ok"&&wa(t.onDisconnect_,e,i),gi(t,s,o,l)})}function _A(t,e,n,r){if(_u(n)){pn("onDisconnect().update() called with empty data.  Don't do anything."),gi(t,r,"ok",void 0);return}t.server_.onDisconnectMerge(e.toString(),n,(s,i)=>{s==="ok"&&mn(n,(o,l)=>{const c=Xt(l);wa(t.onDisconnect_,Jt(e,o),c)}),gi(t,r,s,i)})}function bA(t,e,n){let r;ut(e._path)===".info"?r=rg(t.infoSyncTree_,e,n):r=rg(t.serverSyncTree_,e,n),$E(t.eventQueue_,e._path,r)}function EA(t,e,n){let r;ut(e._path)===".info"?r=Du(t.infoSyncTree_,e,n):r=Du(t.serverSyncTree_,e,n),$E(t.eventQueue_,e._path,r)}function SA(t){t.persistentConnection_&&t.persistentConnection_.interrupt(cA)}function Ta(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),pn(n,...e)}function gi(t,e,n,r){e&&Sa(()=>{if(n==="ok")e(null);else{const s=(n||"error").toUpperCase();let i=s;r&&(i+=": "+r);const o=new Error(i);o.code=s,e(o)}})}function wA(t,e,n,r,s,i){Ta(t,"transaction on "+e);const o={path:e,update:n,onComplete:r,status:null,order:$b(),applyLocally:i,retryCount:0,unwatcher:s,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},l=rm(t,e,void 0);o.currentInputSnapshot=l;const c=o.update(l.val());if(c===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{_c("transaction failed: Data returned ",c,o.path),o.status=0;const d=mf(t.transactionQueueTree_,e),u=no(d)||[];u.push(o),Z0(d,u);let h;typeof c=="object"&&c!==null&&Hr(c,".priority")?(h=Gi(c,".priority"),ge(tm(h),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):h=(pf(t.serverSyncTree_,e)||Je.EMPTY_NODE).getPriority().val();const f=bc(t),b=Xt(c,h),C=J0(b,l,f);o.currentOutputSnapshotRaw=b,o.currentOutputSnapshotResolved=C,o.currentWriteId=xf(t);const k=W0(t.serverSyncTree_,e,C,o.currentWriteId,o.applyLocally);dr(t.eventQueue_,e,k),_f(t,t.transactionQueueTree_)}}function rm(t,e,n){return pf(t.serverSyncTree_,e,n)||Je.EMPTY_NODE}function _f(t,e=t.transactionQueueTree_){if(e||bf(t,e),no(e)){const n=BE(t,e);ge(n.length>0,"Sending zero length transaction queue"),n.every(s=>s.status===0)&&IA(t,xc(e),n)}else OE(e)&&yf(e,n=>{_f(t,n)})}function IA(t,e,n){const r=n.map(d=>d.currentWriteId),s=rm(t,e,r);let i=s;const o=s.hash();for(let d=0;d<n.length;d++){const u=n[d];ge(u.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;const h=jn(e,u.path);i=i.updateChild(h,u.currentOutputSnapshotRaw)}const l=i.val(!0),c=e;t.server_.put(c.toString(),l,d=>{Ta(t,"transaction put response",{path:c.toString(),status:d});let u=[];if(d==="ok"){const h=[];for(let f=0;f<n.length;f++)n[f].status=2,u=u.concat(Ys(t.serverSyncTree_,n[f].currentWriteId)),n[f].onComplete&&h.push(()=>n[f].onComplete(null,!0,n[f].currentOutputSnapshotResolved)),n[f].unwatcher();bf(t,mf(t.transactionQueueTree_,e)),_f(t,t.transactionQueueTree_),dr(t.eventQueue_,e,u);for(let f=0;f<h.length;f++)Sa(h[f])}else{if(d==="datastale")for(let h=0;h<n.length;h++)n[h].status===3?n[h].status=4:n[h].status=0;else{Un("transaction at "+c.toString()+" failed: "+d);for(let h=0;h<n.length;h++)n[h].status=4,n[h].abortReason=d}pa(t,e)}},o)}function pa(t,e){const n=UE(t,e),r=xc(n),s=BE(t,n);return TA(t,s,r),r}function TA(t,e,n){if(e.length===0)return;const r=[];let s=[];const o=e.filter(l=>l.status===0).map(l=>l.currentWriteId);for(let l=0;l<e.length;l++){const c=e[l],d=jn(n,c.path);let u=!1,h;if(ge(d!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)u=!0,h=c.abortReason,s=s.concat(Ys(t.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=dA)u=!0,h="maxretry",s=s.concat(Ys(t.serverSyncTree_,c.currentWriteId,!0));else{const f=rm(t,c.path,o);c.currentInputSnapshot=f;const b=e[l].update(f.val());if(b!==void 0){_c("transaction failed: Data returned ",b,c.path);let C=Xt(b);typeof b=="object"&&b!=null&&Hr(b,".priority")||(C=C.updatePriority(f.getPriority()));const A=c.currentWriteId,R=bc(t),m=J0(C,f,R);c.currentOutputSnapshotRaw=C,c.currentOutputSnapshotResolved=m,c.currentWriteId=xf(t),o.splice(o.indexOf(A),1),s=s.concat(W0(t.serverSyncTree_,c.path,m,c.currentWriteId,c.applyLocally)),s=s.concat(Ys(t.serverSyncTree_,A,!0))}else u=!0,h="nodata",s=s.concat(Ys(t.serverSyncTree_,c.currentWriteId,!0))}dr(t.eventQueue_,n,s),s=[],u&&(e[l].status=2,function(f){setTimeout(f,Math.floor(0))}(e[l].unwatcher),e[l].onComplete&&(h==="nodata"?r.push(()=>e[l].onComplete(null,!1,e[l].currentInputSnapshot)):r.push(()=>e[l].onComplete(new Error(h),!1,null))))}bf(t,t.transactionQueueTree_);for(let l=0;l<r.length;l++)Sa(r[l]);_f(t,t.transactionQueueTree_)}function UE(t,e){let n,r=t.transactionQueueTree_;for(n=ut(e);n!==null&&no(r)===void 0;)r=mf(r,n),e=$t(e),n=ut(e);return r}function BE(t,e){const n=[];return zE(t,e,n),n.sort((r,s)=>r.order-s.order),n}function zE(t,e,n){const r=no(e);if(r)for(let s=0;s<r.length;s++)n.push(r[s]);yf(e,s=>{zE(t,s,n)})}function bf(t,e){const n=no(e);if(n){let r=0;for(let s=0;s<n.length;s++)n[s].status!==2&&(n[r]=n[s],r++);n.length=r,Z0(e,n.length>0?n:void 0)}yf(e,r=>{bf(t,r)})}function sm(t,e){const n=xc(UE(t,e)),r=mf(t.transactionQueueTree_,e);return qR(r,s=>{Bh(t,s)}),Bh(t,r),LE(r,s=>{Bh(t,s)}),n}function Bh(t,e){const n=no(e);if(n){const r=[];let s=[],i=-1;for(let o=0;o<n.length;o++)n[o].status===3||(n[o].status===1?(ge(i===o-1,"All SENT items should be at beginning of queue."),i=o,n[o].status=3,n[o].abortReason="set"):(ge(n[o].status===0,"Unexpected transaction status in abort"),n[o].unwatcher(),s=s.concat(Ys(t.serverSyncTree_,n[o].currentWriteId,!0)),n[o].onComplete&&r.push(n[o].onComplete.bind(null,new Error("set"),!1,null))));i===-1?Z0(e,void 0):n.length=i+1,dr(t.eventQueue_,xc(e),s);for(let o=0;o<r.length;o++)Sa(r[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CA(t){let e="";const n=t.split("/");for(let r=0;r<n.length;r++)if(n[r].length>0){let s=n[r];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function kA(t){const e={};t.charAt(0)==="?"&&(t=t.substring(1));for(const n of t.split("&")){if(n.length===0)continue;const r=n.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):Un(`Invalid query segment '${n}' in query '${t}'`)}return e}const cx=function(t,e){const n=RA(t),r=n.namespace;n.domain==="firebase.com"&&_s(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&n.domain!=="localhost"&&_s("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||DC();const s=n.scheme==="ws"||n.scheme==="wss";return{repoInfo:new Jb(n.host,n.secure,r,s,e,"",r!==n.subdomain),path:new At(n.pathString)}},RA=function(t){let e="",n="",r="",s="",i="",o=!0,l="https",c=443;if(typeof t=="string"){let d=t.indexOf("//");d>=0&&(l=t.substring(0,d-1),t=t.substring(d+2));let u=t.indexOf("/");u===-1&&(u=t.length);let h=t.indexOf("?");h===-1&&(h=t.length),e=t.substring(0,Math.min(u,h)),u<h&&(s=CA(t.substring(u,h)));const f=kA(t.substring(Math.min(t.length,h)));d=e.indexOf(":"),d>=0?(o=l==="https"||l==="wss",c=parseInt(e.substring(d+1),10)):d=e.length;const b=e.slice(0,d);if(b.toLowerCase()==="localhost")n="localhost";else if(b.split(".").length<=2)n=b;else{const C=e.indexOf(".");r=e.substring(0,C).toLowerCase(),n=e.substring(C+1),i=r}"ns"in f&&(i=f.ns)}return{host:e,port:c,domain:n,subdomain:r,secure:o,scheme:l,pathString:s,namespace:i}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dx="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",AA=function(){let t=0;const e=[];return function(n){const r=n===t;t=n;let s;const i=new Array(8);for(s=7;s>=0;s--)i[s]=dx.charAt(n%64),n=Math.floor(n/64);ge(n===0,"Cannot push at time == 0");let o=i.join("");if(r){for(s=11;s>=0&&e[s]===63;s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)o+=dx.charAt(e[s]);return ge(o.length===20,"nextPushId: Length should be 20."),o}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PA{constructor(e,n,r,s){this.eventType=e,this.eventRegistration=n,this.snapshot=r,this.prevName=s}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+ln(this.snapshot.exportVal())}}class OA{constructor(e,n,r){this.eventRegistration=e,this.error=n,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HE{constructor(e,n){this.snapshotCallback=e,this.cancelCallback=n}onValue(e,n){this.snapshotCallback.call(null,e,n)}onCancel(e){return ge(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LA{constructor(e,n){this._repo=e,this._path=n}cancel(){const e=new Mr;return vA(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Ks("OnDisconnect.remove",this._path);const e=new Mr;return lx(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Ks("OnDisconnect.set",this._path),Nu("OnDisconnect.set",e,this._path,!1);const n=new Mr;return lx(this._repo,this._path,e,n.wrapCallback(()=>{})),n.promise}setWithPriority(e,n){Ks("OnDisconnect.setWithPriority",this._path),Nu("OnDisconnect.setWithPriority",e,this._path,!1),sA("OnDisconnect.setWithPriority",n);const r=new Mr;return xA(this._repo,this._path,e,n,r.wrapCallback(()=>{})),r.promise}update(e){Ks("OnDisconnect.update",this._path),DE("OnDisconnect.update",e,this._path);const n=new Mr;return _A(this._repo,this._path,e,n.wrapCallback(()=>{})),n.promise}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class im{constructor(e,n,r,s){this._repo=e,this._path=n,this._queryParams=r,this._orderByCalled=s}get key(){return pt(this._path)?null:P0(this._path)}get ref(){return new Zr(this._repo,this._path)}get _queryIdentifier(){const e=Kv(this._queryParams),n=C0(e);return n==="{}"?"default":n}get _queryObject(){return Kv(this._queryParams)}isEqual(e){if(e=dn(e),!(e instanceof im))return!1;const n=this._repo===e._repo,r=O0(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return n&&r&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+vk(this._path)}}class Zr extends im{constructor(e,n){super(e,n,new N0,!1)}get parent(){const e=iE(this._path);return e===null?null:new Zr(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class ga{constructor(e,n,r){this._node=e,this.ref=n,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const n=new At(e),r=rc(this.ref,e);return new ga(this._node.getChild(n),r,Yt)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,s)=>e(new ga(s,rc(this.ref,r),Yt)))}hasChild(e){const n=new At(e);return!this._node.getChild(n).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function sr(t,e){return t=dn(t),t._checkNotDeleted("ref"),e!==void 0?rc(t._root,e):t._root}function rc(t,e){return t=dn(t),ut(t._path)===null?iA("child","path",e):NE("child","path",e),new Zr(t._repo,Jt(t._path,e))}function MA(t){return t=dn(t),new LA(t._repo,t._path)}function WE(t,e){t=dn(t),Ks("push",t._path),Nu("push",e,t._path,!0);const n=FE(t._repo),r=AA(n),s=rc(t,r),i=rc(t,r);let o;return o=Promise.resolve(i),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function tl(t){return Ks("remove",t._path),Ec(t,null)}function Ec(t,e){t=dn(t),Ks("set",t._path),Nu("set",e,t._path,!1);const n=new Mr;return gA(t._repo,t._path,e,null,n.wrapCallback(()=>{})),n.promise}function om(t,e){DE("update",e,t._path);const n=new Mr;return mA(t._repo,t._path,e,n.wrapCallback(()=>{})),n.promise}function Sc(t){t=dn(t);const e=new HE(()=>{}),n=new Ef(e);return pA(t._repo,t,n).then(r=>new ga(r,new Zr(t._repo,t._path),t._queryParams.getIndex()))}class Ef{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,n){const r=n._queryParams.getIndex();return new PA("value",this,new ga(e.snapshotNode,new Zr(n._repo,n._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new OA(this,e,n):null}matches(e){return e instanceof Ef?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function DA(t,e,n,r,s){const i=new HE(n,void 0),o=new Ef(i);return bA(t._repo,t,o),()=>EA(t._repo,t,o)}function GE(t,e,n,r){return DA(t,"value",e)}AR(Zr);DR(Zr);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NA="FIREBASE_DATABASE_EMULATOR_HOST",ig={};let $A=!1;function jA(t,e,n,r){const s=e.lastIndexOf(":"),i=e.substring(0,s),o=_a(i);t.repoInfo_=new Jb(e,o,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0,n),r&&(t.authTokenProvider_=r)}function FA(t,e,n,r,s){let i=r||t.options.databaseURL;i===void 0&&(t.options.projectId||_s("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),pn("Using default host for project ",t.options.projectId),i=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o=cx(i,s),l=o.repoInfo,c;typeof process<"u"&&Av&&(c=Av[NA]),c?(i=`http://${c}?ns=${l.namespace}`,o=cx(i,s),l=o.repoInfo):o.repoInfo.secure;const d=new VC(t.name,t.options,e);oA("Invalid Firebase Database URL",o),pt(o.path)||_s("Database URL must point to the root of a Firebase Database (not including a child path).");const u=BA(l,t,d,new GC(t,n));return new zA(u,t)}function UA(t,e){const n=ig[e];(!n||n[t.key]!==t)&&_s(`Database ${e}(${t.repoInfo_}) has already been deleted.`),SA(t),delete n[t.key]}function BA(t,e,n,r){let s=ig[e.name];s||(s={},ig[e.name]=s);let i=s[t.toURLString()];return i&&_s("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new uA(t,$A,n,r),s[t.toURLString()]=i,i}class zA{constructor(e,n){this._repoInternal=e,this.app=n,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(fA(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Zr(this._repo,St())),this._rootInternal}_delete(){return this._rootInternal!==null&&(UA(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&_s("Cannot call "+e+" on a deleted database.")}}function HA(t=Ob(),e){const n=T0(t,"database").getImmediate({identifier:e});if(!n._instanceStarted){const r=eT("database");r&&WA(n,...r)}return n}function WA(t,e,n,r={}){t=dn(t),t._checkNotDeleted("useEmulator");const s=`${e}:${n}`,i=t._repoInternal;if(t._instanceStarted){if(s===t._repoInternal.repoInfo_.host&&Vi(r,i.repoInfo_.emulatorOptions))return;_s("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&_s('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new Nd(Nd.OWNER);else if(r.mockUserToken){const l=typeof r.mockUserToken=="string"?r.mockUserToken:tT(r.mockUserToken,t.app.options.projectId);o=new Nd(l)}_a(e)&&(Ib(e),Tb("Database",!0)),jA(i,s,r,o)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GA(t){AC(Ea),ca(new Yi("database",(e,{instanceIdentifier:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return FA(r,s,i,n)},"PUBLIC").setMultipleInstances(!0)),oi(Pv,Ov,t),oi(Pv,Ov,"esm2020")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VA{constructor(e,n){this.committed=e,this.snapshot=n}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function YA(t,e,n){if(t=dn(t),Ks("Reference.transaction",t._path),t.key===".length"||t.key===".keys")throw"Reference.transaction failed: "+t.key+" is a read-only object.";const r=!0,s=new Mr,i=(l,c,d)=>{let u=null;l?s.reject(l):(u=new ga(d,new Zr(t._repo,t._path),Yt),s.resolve(new VA(c,u)))},o=GE(t,()=>{});return wA(t._repo,t._path,e,i,o,r),s.promise}hs.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};hs.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};GA();function VE(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const KA=VE,YE=new pc("auth","Firebase",VE());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $u=new w0("@firebase/auth");function XA(t,...e){$u.logLevel<=Dt.WARN&&$u.warn(`Auth (${Ea}): ${t}`,...e)}function $d(t,...e){$u.logLevel<=Dt.ERROR&&$u.error(`Auth (${Ea}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zr(t,...e){throw am(t,...e)}function Qr(t,...e){return am(t,...e)}function KE(t,e,n){const r={...KA(),[e]:n};return new pc("auth","Firebase",r).create(e,{appName:t.name})}function ps(t){return KE(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function am(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return YE.create(t,...e)}function Xe(t,e,...n){if(!t)throw am(e,...n)}function ds(t){const e="INTERNAL ASSERTION FAILED: "+t;throw $d(e),new Error(e)}function bs(t,e){t||ds(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function og(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.href)||""}function JA(){return ux()==="http:"||ux()==="https:"}function ux(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QA(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(JA()||iT()||"connection"in navigator)?navigator.onLine:!0}function qA(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wc{constructor(e,n){this.shortDelay=e,this.longDelay=n,bs(n>e,"Short delay should be less than long delay!"),this.isMobile=S0()||Cb()}get(){return QA()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lm(t,e){bs(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XE{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;ds("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;ds("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;ds("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZA={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eP=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],tP=new wc(3e4,6e4);function bi(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function Ei(t,e,n,r,s={}){return JE(t,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const l=ba({key:t.config.apiKey,...o}).slice(1),c=await t._getAdditionalHeaders();c["Content-Type"]="application/json",t.languageCode&&(c["X-Firebase-Locale"]=t.languageCode);const d={method:e,headers:c,...i};return sT()||(d.referrerPolicy="no-referrer"),t.emulatorConfig&&_a(t.emulatorConfig.host)&&(d.credentials="include"),XE.fetch()(await QE(t,t.config.apiHost,n,l),d)})}async function JE(t,e,n){t._canInitEmulator=!1;const r={...ZA,...e};try{const s=new rP(t),i=await Promise.race([n(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw yd(t,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const l=i.ok?o.errorMessage:o.error.message,[c,d]=l.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw yd(t,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw yd(t,"email-already-in-use",o);if(c==="USER_DISABLED")throw yd(t,"user-disabled",o);const u=r[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw KE(t,u,d);zr(t,u)}}catch(s){if(s instanceof _i)throw s;zr(t,"network-request-failed",{message:String(s)})}}async function Ic(t,e,n,r,s={}){const i=await Ei(t,e,n,r,s);return"mfaPendingCredential"in i&&zr(t,"multi-factor-auth-required",{_serverResponse:i}),i}async function QE(t,e,n,r){const s=`${e}${n}?${r}`,i=t,o=i.config.emulator?lm(t.config,s):`${t.config.apiScheme}://${s}`;return eP.includes(n)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(o).toString():o}function nP(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class rP{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(Qr(this.auth,"network-request-failed")),tP.get())})}}function yd(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=Qr(t,e,r);return s.customData._tokenResponse=n,s}function fx(t){return t!==void 0&&t.enterprise!==void 0}class sP{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return nP(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function iP(t,e){return Ei(t,"GET","/v2/recaptchaConfig",bi(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oP(t,e){return Ei(t,"POST","/v1/accounts:delete",e)}async function ju(t,e){return Ei(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tl(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function aP(t,e=!1){const n=dn(t),r=await n.getIdToken(e),s=cm(r);Xe(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:Tl(zh(s.auth_time)),issuedAtTime:Tl(zh(s.iat)),expirationTime:Tl(zh(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function zh(t){return Number(t)*1e3}function cm(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return $d("JWT malformed, contained fewer than 3 sections"),null;try{const s=xu(n);return s?JSON.parse(s):($d("Failed to decode base64 JWT payload"),null)}catch(s){return $d("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function hx(t){const e=cm(t);return Xe(e,"internal-error"),Xe(typeof e.exp<"u","internal-error"),Xe(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sc(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof _i&&lP(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function lP({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cP{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ag{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Tl(this.lastLoginAt),this.creationTime=Tl(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ic(t){var h;const e=t.auth,n=await t.getIdToken(),r=await sc(t,ju(e,{idToken:n}));Xe(r==null?void 0:r.users.length,e,"internal-error");const s=r.users[0];t._notifyReloadListener(s);const i=(h=s.providerUserInfo)!=null&&h.length?qE(s.providerUserInfo):[],o=uP(t.providerData,i),l=t.isAnonymous,c=!(t.email&&s.passwordHash)&&!(o!=null&&o.length),d=l?c:!1,u={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new ag(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(t,u)}async function dP(t){const e=dn(t);await ic(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function uP(t,e){return[...t.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function qE(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fP(t,e){const n=await JE(t,{},async()=>{const r=ba({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=t.config,o=await QE(t,s,"/v1/token",`key=${i}`),l=await t._getAdditionalHeaders();l["Content-Type"]="application/x-www-form-urlencoded";const c={method:"POST",headers:l,body:r};return t.emulatorConfig&&_a(t.emulatorConfig.host)&&(c.credentials="include"),XE.fetch()(o,c)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function hP(t,e){return Ei(t,"POST","/v2/accounts:revokeToken",bi(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qo{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Xe(e.idToken,"internal-error"),Xe(typeof e.idToken<"u","internal-error"),Xe(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):hx(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){Xe(e.length!==0,"internal-error");const n=hx(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(Xe(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:s,expiresIn:i}=await fP(e,n);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:s,expirationTime:i}=n,o=new Qo;return r&&(Xe(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(Xe(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(Xe(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Qo,this.toJSON())}_performRefresh(){return ds("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ds(t,e){Xe(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class $r{constructor({uid:e,auth:n,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new cP(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new ag(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const n=await sc(this,this.stsTokenManager.getToken(this.auth,e));return Xe(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return aP(this,e)}reload(){return dP(this)}_assign(e){this!==e&&(Xe(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new $r({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){Xe(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await ic(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(_r(this.auth.app))return Promise.reject(ps(this.auth));const e=await this.getIdToken();return await sc(this,oP(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const r=n.displayName??void 0,s=n.email??void 0,i=n.phoneNumber??void 0,o=n.photoURL??void 0,l=n.tenantId??void 0,c=n._redirectEventId??void 0,d=n.createdAt??void 0,u=n.lastLoginAt??void 0,{uid:h,emailVerified:f,isAnonymous:b,providerData:C,stsTokenManager:k}=n;Xe(h&&k,e,"internal-error");const A=Qo.fromJSON(this.name,k);Xe(typeof h=="string",e,"internal-error"),Ds(r,e.name),Ds(s,e.name),Xe(typeof f=="boolean",e,"internal-error"),Xe(typeof b=="boolean",e,"internal-error"),Ds(i,e.name),Ds(o,e.name),Ds(l,e.name),Ds(c,e.name),Ds(d,e.name),Ds(u,e.name);const R=new $r({uid:h,auth:e,email:s,emailVerified:f,displayName:r,isAnonymous:b,photoURL:o,phoneNumber:i,tenantId:l,stsTokenManager:A,createdAt:d,lastLoginAt:u});return C&&Array.isArray(C)&&(R.providerData=C.map(m=>({...m}))),c&&(R._redirectEventId=c),R}static async _fromIdTokenResponse(e,n,r=!1){const s=new Qo;s.updateFromServerResponse(n);const i=new $r({uid:n.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await ic(i),i}static async _fromGetAccountInfoResponse(e,n,r){const s=n.users[0];Xe(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?qE(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),l=new Qo;l.updateFromIdToken(r);const c=new $r({uid:s.localId,auth:e,stsTokenManager:l,isAnonymous:o}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new ag(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(c,d),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const px=new Map;function us(t){bs(t instanceof Function,"Expected a class definition");let e=px.get(t);return e?(bs(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,px.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZE{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}ZE.type="NONE";const gx=ZE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jd(t,e,n){return`firebase:${t}:${e}:${n}`}class qo{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=jd(this.userKey,s.apiKey,i),this.fullPersistenceKey=jd("persistence",s.apiKey,i),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await ju(this.auth,{idToken:e}).catch(()=>{});return n?$r._fromGetAccountInfoResponse(this.auth,n,e):null}return $r._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new qo(us(gx),e,r);const s=(await Promise.all(n.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let i=s[0]||us(gx);const o=jd(r,e.config.apiKey,e.name);let l=null;for(const d of n)try{const u=await d._get(o);if(u){let h;if(typeof u=="string"){const f=await ju(e,{idToken:u}).catch(()=>{});if(!f)break;h=await $r._fromGetAccountInfoResponse(e,f,u)}else h=$r._fromJSON(e,u);d!==i&&(l=h),i=d;break}}catch{}const c=s.filter(d=>d._shouldAllowMigration);return!i._shouldAllowMigration||!c.length?new qo(i,e,r):(i=c[0],l&&await i._set(o,l.toJSON()),await Promise.all(n.map(async d=>{if(d!==i)try{await d._remove(o)}catch{}})),new qo(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mx(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(rS(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(eS(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(iS(e))return"Blackberry";if(oS(e))return"Webos";if(tS(e))return"Safari";if((e.includes("chrome/")||nS(e))&&!e.includes("edge/"))return"Chrome";if(sS(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function eS(t=Bn()){return/firefox\//i.test(t)}function tS(t=Bn()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function nS(t=Bn()){return/crios\//i.test(t)}function rS(t=Bn()){return/iemobile/i.test(t)}function sS(t=Bn()){return/android/i.test(t)}function iS(t=Bn()){return/blackberry/i.test(t)}function oS(t=Bn()){return/webos/i.test(t)}function dm(t=Bn()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function pP(t=Bn()){var e;return dm(t)&&!!((e=window.navigator)!=null&&e.standalone)}function gP(){return oT()&&document.documentMode===10}function aS(t=Bn()){return dm(t)||sS(t)||oS(t)||iS(t)||/windows phone/i.test(t)||rS(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lS(t,e=[]){let n;switch(t){case"Browser":n=mx(Bn());break;case"Worker":n=`${mx(Bn())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${Ea}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mP{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=i=>new Promise((o,l)=>{try{const c=e(i);o(c)}catch(c){l(c)}});r.onAbort=n,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const s of n)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yP(t,e={}){return Ei(t,"GET","/v2/passwordPolicy",bi(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vP=6;class xP{constructor(e){var r;const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??vP,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((r=e.allowedNonAlphanumericCharacters)==null?void 0:r.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),s&&(n.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _P{constructor(e,n,r,s){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new yx(this),this.idTokenSubscription=new yx(this),this.beforeStateQueue=new mP(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=YE,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=us(n)),this._initializationPromise=this.queue(async()=>{var r,s,i;if(!this._deleted&&(this.persistenceManager=await qo.create(this,e),(r=this._resolvePersistenceManagerAvailable)==null||r.call(this),!this._deleted)){if((s=this._popupRedirectResolver)!=null&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((i=this.currentUser)==null?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await ju(this,{idToken:e}),r=await $r._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(_r(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(l,l))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(i=this.redirectUser)==null?void 0:i._redirectEventId,l=r==null?void 0:r._redirectEventId,c=await this.tryRedirectSignIn(e);(!o||o===l)&&(c!=null&&c.user)&&(r=c.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Xe(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await ic(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=qA()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(_r(this.app))return Promise.reject(ps(this));const n=e?dn(e):null;return n&&Xe(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&Xe(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return _r(this.app)?Promise.reject(ps(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return _r(this.app)?Promise.reject(ps(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(us(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await yP(this),n=new xP(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new pc("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await hP(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&us(e)||this._popupRedirectResolver;Xe(n,this,"argument-error"),this.redirectPersistenceManager=await qo.create(this,[us(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)==null?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)==null?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((n=this.currentUser)==null?void 0:n.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,s){if(this._deleted)return()=>{};const i=typeof n=="function"?n:n.next.bind(n);let o=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(Xe(l,this,"internal-error"),l.then(()=>{o||i(this.currentUser)}),typeof n=="function"){const c=e.addObserver(n,r,s);return()=>{o=!0,c()}}else{const c=e.addObserver(n);return()=>{o=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Xe(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=lS(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var s;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await((s=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getHeartbeatsHeader());n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var n;if(_r(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((n=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:n.getToken());return e!=null&&e.error&&XA(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function ro(t){return dn(t)}class yx{constructor(e){this.auth=e,this.observer=null,this.addObserver=mT(n=>this.observer=n)}get next(){return Xe(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Sf={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function bP(t){Sf=t}function cS(t){return Sf.loadJS(t)}function EP(){return Sf.recaptchaEnterpriseScript}function SP(){return Sf.gapiScript}function wP(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class IP{constructor(){this.enterprise=new TP}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class TP{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const CP="recaptcha-enterprise",dS="NO_RECAPTCHA";class kP{constructor(e){this.type=CP,this.auth=ro(e)}async verify(e="verify",n=!1){async function r(i){if(!n){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,l)=>{iP(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const d=new sP(c);return i.tenantId==null?i._agentRecaptchaConfig=d:i._tenantRecaptchaConfigs[i.tenantId]=d,o(d.siteKey)}}).catch(c=>{l(c)})})}function s(i,o,l){const c=window.grecaptcha;fx(c)?c.enterprise.ready(()=>{c.enterprise.execute(i,{action:e}).then(d=>{o(d)}).catch(()=>{o(dS)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new IP().execute("siteKey",{action:"verify"}):new Promise((i,o)=>{r(this.auth).then(l=>{if(!n&&fx(window.grecaptcha))s(l,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let c=EP();c.length!==0&&(c+=l),cS(c).then(()=>{s(l,i,o)}).catch(d=>{o(d)})}}).catch(l=>{o(l)})})}}async function vx(t,e,n,r=!1,s=!1){const i=new kP(t);let o;if(s)o=dS;else try{o=await i.verify(n)}catch{o=await i.verify(n,!0)}const l={...e};if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in l){const c=l.phoneEnrollmentInfo.phoneNumber,d=l.phoneEnrollmentInfo.recaptchaToken;Object.assign(l,{phoneEnrollmentInfo:{phoneNumber:c,recaptchaToken:d,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in l){const c=l.phoneSignInInfo.recaptchaToken;Object.assign(l,{phoneSignInInfo:{recaptchaToken:c,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return l}return r?Object.assign(l,{captchaResp:o}):Object.assign(l,{captchaResponse:o}),Object.assign(l,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(l,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),l}async function xx(t,e,n,r,s){var i;if((i=t._getRecaptchaConfig())!=null&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await vx(t,e,n,n==="getOobCode");return r(t,o)}else return r(t,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await vx(t,e,n,n==="getOobCode");return r(t,l)}else return Promise.reject(o)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RP(t,e){const n=T0(t,"auth");if(n.isInitialized()){const s=n.getImmediate(),i=n.getOptions();if(Vi(i,e??{}))return s;zr(s,"already-initialized")}return n.initialize({options:e})}function AP(t,e){const n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(us);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function PP(t,e,n){const r=ro(t);Xe(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,i=uS(e),{host:o,port:l}=OP(e),c=l===null?"":`:${l}`,d={url:`${i}//${o}${c}/`},u=Object.freeze({host:o,port:l,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){Xe(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),Xe(Vi(d,r.config.emulator)&&Vi(u,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=d,r.emulatorConfig=u,r.settings.appVerificationDisabledForTesting=!0,_a(o)?(Ib(`${i}//${o}${c}`),Tb("Auth",!0)):LP()}function uS(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function OP(t){const e=uS(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:_x(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:_x(o)}}}function _x(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function LP(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class um{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return ds("not implemented")}_getIdTokenResponse(e){return ds("not implemented")}_linkToIdToken(e,n){return ds("not implemented")}_getReauthenticationResolver(e){return ds("not implemented")}}async function MP(t,e){return Ei(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function DP(t,e){return Ic(t,"POST","/v1/accounts:signInWithPassword",bi(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function NP(t,e){return Ic(t,"POST","/v1/accounts:signInWithEmailLink",bi(t,e))}async function $P(t,e){return Ic(t,"POST","/v1/accounts:signInWithEmailLink",bi(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oc extends um{constructor(e,n,r,s=null){super("password",r),this._email=e,this._password=n,this._tenantId=s}static _fromEmailAndPassword(e,n){return new oc(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new oc(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return xx(e,n,"signInWithPassword",DP);case"emailLink":return NP(e,{email:this._email,oobCode:this._password});default:zr(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return xx(e,r,"signUpPassword",MP);case"emailLink":return $P(e,{idToken:n,email:this._email,oobCode:this._password});default:zr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Zo(t,e){return Ic(t,"POST","/v1/accounts:signInWithIdp",bi(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jP="http://localhost";class Qi extends um{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Qi(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):zr("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=n;if(!r||!s)return null;const o=new Qi(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const n=this.buildRequest();return Zo(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,Zo(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,Zo(e,n)}buildRequest(){const e={requestUri:jP,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=ba(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FP(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function UP(t){const e=ll(cl(t)).link,n=e?ll(cl(e)).deep_link_id:null,r=ll(cl(t)).deep_link_id;return(r?ll(cl(r)).link:null)||r||n||e||t}class fm{constructor(e){const n=ll(cl(e)),r=n.apiKey??null,s=n.oobCode??null,i=FP(n.mode??null);Xe(r&&s&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=s,this.continueUrl=n.continueUrl??null,this.languageCode=n.lang??null,this.tenantId=n.tenantId??null}static parseLink(e){const n=UP(e);try{return new fm(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class so{constructor(){this.providerId=so.PROVIDER_ID}static credential(e,n){return oc._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=fm.parseLink(n);return Xe(r,"argument-error"),oc._fromEmailAndCode(e,r.code,r.tenantId)}}so.PROVIDER_ID="password";so.EMAIL_PASSWORD_SIGN_IN_METHOD="password";so.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fS{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tc extends fS{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Us extends Tc{constructor(){super("facebook.com")}static credential(e){return Qi._fromParams({providerId:Us.PROVIDER_ID,signInMethod:Us.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Us.credentialFromTaggedObject(e)}static credentialFromError(e){return Us.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Us.credential(e.oauthAccessToken)}catch{return null}}}Us.FACEBOOK_SIGN_IN_METHOD="facebook.com";Us.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bs extends Tc{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Qi._fromParams({providerId:Bs.PROVIDER_ID,signInMethod:Bs.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return Bs.credentialFromTaggedObject(e)}static credentialFromError(e){return Bs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return Bs.credential(n,r)}catch{return null}}}Bs.GOOGLE_SIGN_IN_METHOD="google.com";Bs.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zs extends Tc{constructor(){super("github.com")}static credential(e){return Qi._fromParams({providerId:zs.PROVIDER_ID,signInMethod:zs.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return zs.credentialFromTaggedObject(e)}static credentialFromError(e){return zs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return zs.credential(e.oauthAccessToken)}catch{return null}}}zs.GITHUB_SIGN_IN_METHOD="github.com";zs.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hs extends Tc{constructor(){super("twitter.com")}static credential(e,n){return Qi._fromParams({providerId:Hs.PROVIDER_ID,signInMethod:Hs.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return Hs.credentialFromTaggedObject(e)}static credentialFromError(e){return Hs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return Hs.credential(n,r)}catch{return null}}}Hs.TWITTER_SIGN_IN_METHOD="twitter.com";Hs.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BP(t,e){return Ic(t,"POST","/v1/accounts:signUp",bi(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mi{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,s=!1){const i=await $r._fromIdTokenResponse(e,r,s),o=bx(r);return new mi({user:i,providerId:o,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const s=bx(r);return new mi({user:e,providerId:s,_tokenResponse:r,operationType:n})}}function bx(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zP(t){var s;if(_r(t.app))return Promise.reject(ps(t));const e=ro(t);if(await e._initializationPromise,(s=e.currentUser)!=null&&s.isAnonymous)return new mi({user:e.currentUser,providerId:null,operationType:"signIn"});const n=await BP(e,{returnSecureToken:!0}),r=await mi._fromIdTokenResponse(e,"signIn",n,!0);return await e._updateCurrentUser(r.user),r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fu extends _i{constructor(e,n,r,s){super(n.code,n.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Fu.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,s){return new Fu(e,n,r,s)}}function hS(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Fu._fromErrorAndOperation(t,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HP(t){return new Set(t.map(({providerId:e})=>e).filter(e=>!!e))}async function pS(t,e,n=!1){const r=await sc(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return mi._forOperation(t,"link",r)}async function WP(t,e,n){await ic(e);const r=HP(e.providerData);Xe(r.has(n)===t,e.auth,"provider-already-linked")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function GP(t,e,n=!1){const{auth:r}=t;if(_r(r.app))return Promise.reject(ps(r));const s="reauthenticate";try{const i=await sc(t,hS(r,s,e,t),n);Xe(i.idToken,r,"internal-error");const o=cm(i.idToken);Xe(o,r,"internal-error");const{sub:l}=o;return Xe(t.uid===l,r,"user-mismatch"),mi._forOperation(t,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&zr(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gS(t,e,n=!1){if(_r(t.app))return Promise.reject(ps(t));const r="signIn",s=await hS(t,r,e),i=await mi._fromIdTokenResponse(t,r,s);return n||await t._updateCurrentUser(i.user),i}async function VP(t,e){return gS(ro(t),e)}async function YP(t,e){const n=dn(t);return await WP(!1,n,e.providerId),pS(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function KP(t){const e=ro(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}function XP(t,e,n){return _r(t.app)?Promise.reject(ps(t)):VP(dn(t),so.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&KP(t),r})}function JP(t,e,n,r){return dn(t).onIdTokenChanged(e,n,r)}function QP(t,e,n){return dn(t).beforeAuthStateChanged(e,n)}function qP(t,e,n,r){return dn(t).onAuthStateChanged(e,n,r)}function ZP(t){return dn(t).signOut()}const Uu="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mS{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(Uu,"1"),this.storage.removeItem(Uu),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eO=1e3,tO=10;class yS extends mS{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=aS(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),s=this.localCache[n];r!==s&&e(n,s,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((o,l,c)=>{this.notifyListeners(o,c)});return}const r=e.key;n?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!n&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);gP()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,tO):s()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},eO)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}yS.type="LOCAL";const nO=yS;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vS extends mS{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}vS.type="SESSION";const xS=vS;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rO(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wf{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(s=>s.isListeningto(e));if(n)return n;const r=new wf(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:s,data:i}=n.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const l=Array.from(o).map(async d=>d(n.origin,i)),c=await rO(l);n.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:c})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}wf.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hm(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sO{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((l,c)=>{const d=hm("",20);s.port1.start();const u=setTimeout(()=>{c(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(h){const f=h;if(f.data.eventId===d)switch(f.data.status){case"ack":clearTimeout(u),i=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),l(f.data.response);break;default:clearTimeout(u),clearTimeout(i),c(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:d,data:n},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qr(){return window}function iO(t){qr().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _S(){return typeof qr().WorkerGlobalScope<"u"&&typeof qr().importScripts=="function"}async function oO(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function aO(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)==null?void 0:t.controller)||null}function lO(){return _S()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bS="firebaseLocalStorageDb",cO=1,Bu="firebaseLocalStorage",ES="fbase_key";class Cc{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function If(t,e){return t.transaction([Bu],e?"readwrite":"readonly").objectStore(Bu)}function dO(){const t=indexedDB.deleteDatabase(bS);return new Cc(t).toPromise()}function lg(){const t=indexedDB.open(bS,cO);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(Bu,{keyPath:ES})}catch(s){n(s)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(Bu)?e(r):(r.close(),await dO(),e(await lg()))})})}async function Ex(t,e,n){const r=If(t,!0).put({[ES]:e,value:n});return new Cc(r).toPromise()}async function uO(t,e){const n=If(t,!1).get(e),r=await new Cc(n).toPromise();return r===void 0?null:r.value}function Sx(t,e){const n=If(t,!0).delete(e);return new Cc(n).toPromise()}const fO=800,hO=3;class SS{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await lg(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>hO)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return _S()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=wf._getInstance(lO()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var n,r;if(this.activeServiceWorker=await oO(),!this.activeServiceWorker)return;this.sender=new sO(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(n=e[0])!=null&&n.fulfilled&&(r=e[0])!=null&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||aO()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await lg();return await Ex(e,Uu,"1"),await Sx(e,Uu),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>Ex(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>uO(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>Sx(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=If(s,!1).getAll();return new Cc(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),n.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),n.push(s));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),fO)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}SS.type="LOCAL";const pO=SS;new wc(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gO(t,e){return e?us(e):(Xe(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pm extends um{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Zo(e,this._buildIdpRequest())}_linkToIdToken(e,n){return Zo(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return Zo(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function mO(t){return gS(t.auth,new pm(t),t.bypassAuthState)}function yO(t){const{auth:e,user:n}=t;return Xe(n,e,"internal-error"),GP(n,new pm(t),t.bypassAuthState)}async function vO(t){const{auth:e,user:n}=t;return Xe(n,e,"internal-error"),pS(n,new pm(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wS{constructor(e,n,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:s,tenantId:i,error:o,type:l}=e;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:n,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(c))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return mO;case"linkViaPopup":case"linkViaRedirect":return vO;case"reauthViaPopup":case"reauthViaRedirect":return yO;default:zr(this.auth,"internal-error")}}resolve(e){bs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){bs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xO=new wc(2e3,1e4);class zo extends wS{constructor(e,n,r,s,i){super(e,n,s,i),this.provider=r,this.authWindow=null,this.pollId=null,zo.currentPopupAction&&zo.currentPopupAction.cancel(),zo.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Xe(e,this.auth,"internal-error"),e}async onExecution(){bs(this.filter.length===1,"Popup operations only handle one event");const e=hm();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Qr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(Qr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,zo.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if((r=(n=this.authWindow)==null?void 0:n.window)!=null&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Qr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,xO.get())};e()}}zo.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _O="pendingRedirect",Fd=new Map;class bO extends wS{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=Fd.get(this.auth._key());if(!e){try{const r=await EO(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}Fd.set(this.auth._key(),e)}return this.bypassAuthState||Fd.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function EO(t,e){const n=IO(e),r=wO(t);if(!await r._isAvailable())return!1;const s=await r._get(n)==="true";return await r._remove(n),s}function SO(t,e){Fd.set(t._key(),e)}function wO(t){return us(t._redirectPersistence)}function IO(t){return jd(_O,t.config.apiKey,t.name)}async function TO(t,e,n=!1){if(_r(t.app))return Promise.reject(ps(t));const r=ro(t),s=gO(r,e),o=await new bO(r,s,n).execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CO=10*60*1e3;class kO{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!RO(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!IS(e)){const s=((r=e.error.code)==null?void 0:r.split("auth/")[1])||"internal-error";n.onError(Qr(this.auth,s))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=CO&&this.cachedEventUids.clear(),this.cachedEventUids.has(wx(e))}saveEventToCache(e){this.cachedEventUids.add(wx(e)),this.lastProcessedEventTime=Date.now()}}function wx(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function IS({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function RO(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return IS(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function AO(t,e={}){return Ei(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PO=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,OO=/^https?/;async function LO(t){if(t.config.emulator)return;const{authorizedDomains:e}=await AO(t);for(const n of e)try{if(MO(n))return}catch{}zr(t,"unauthorized-domain")}function MO(t){const e=og(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const o=new URL(t);return o.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&o.hostname===r}if(!OO.test(n))return!1;if(PO.test(t))return r===t;const s=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DO=new wc(3e4,6e4);function Ix(){const t=qr().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function NO(t){return new Promise((e,n)=>{var s,i,o;function r(){Ix(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Ix(),n(Qr(t,"network-request-failed"))},timeout:DO.get()})}if((i=(s=qr().gapi)==null?void 0:s.iframes)!=null&&i.Iframe)e(gapi.iframes.getContext());else if((o=qr().gapi)!=null&&o.load)r();else{const l=wP("iframefcb");return qr()[l]=()=>{gapi.load?r():n(Qr(t,"network-request-failed"))},cS(`${SP()}?onload=${l}`).catch(c=>n(c))}}).catch(e=>{throw Ud=null,e})}let Ud=null;function $O(t){return Ud=Ud||NO(t),Ud}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jO=new wc(5e3,15e3),FO="__/auth/iframe",UO="emulator/auth/iframe",BO={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},zO=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function HO(t){const e=t.config;Xe(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?lm(e,UO):`https://${t.config.authDomain}/${FO}`,r={apiKey:e.apiKey,appName:t.name,v:Ea},s=zO.get(t.config.apiHost);s&&(r.eid=s);const i=t._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${ba(r).slice(1)}`}async function WO(t){const e=await $O(t),n=qr().gapi;return Xe(n,t,"internal-error"),e.open({where:document.body,url:HO(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:BO,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=Qr(t,"network-request-failed"),l=qr().setTimeout(()=>{i(o)},jO.get());function c(){qr().clearTimeout(l),s(r)}r.ping(c).then(c,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GO={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},VO=500,YO=600,KO="_blank",XO="http://localhost";class Tx{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function JO(t,e,n,r=VO,s=YO){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const c={...GO,width:r.toString(),height:s.toString(),top:i,left:o},d=Bn().toLowerCase();n&&(l=nS(d)?KO:n),eS(d)&&(e=e||XO,c.scrollbars="yes");const u=Object.entries(c).reduce((f,[b,C])=>`${f}${b}=${C},`,"");if(pP(d)&&l!=="_self")return QO(e||"",l),new Tx(null);const h=window.open(e||"",l,u);Xe(h,t,"popup-blocked");try{h.focus()}catch{}return new Tx(h)}function QO(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qO="__/auth/handler",ZO="emulator/auth/handler",eL=encodeURIComponent("fac");async function Cx(t,e,n,r,s,i){Xe(t.config.authDomain,t,"auth-domain-config-required"),Xe(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:Ea,eventId:s};if(e instanceof fS){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",_u(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[u,h]of Object.entries({}))o[u]=h}if(e instanceof Tc){const u=e.getScopes().filter(h=>h!=="");u.length>0&&(o.scopes=u.join(","))}t.tenantId&&(o.tid=t.tenantId);const l=o;for(const u of Object.keys(l))l[u]===void 0&&delete l[u];const c=await t._getAppCheckToken(),d=c?`#${eL}=${encodeURIComponent(c)}`:"";return`${tL(t)}?${ba(l).slice(1)}${d}`}function tL({config:t}){return t.emulator?lm(t,ZO):`https://${t.authDomain}/${qO}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hh="webStorageSupport";class nL{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=xS,this._completeRedirectFn=TO,this._overrideRedirectResult=SO}async _openPopup(e,n,r,s){var o;bs((o=this.eventManagers[e._key()])==null?void 0:o.manager,"_initialize() not called before _openPopup()");const i=await Cx(e,n,r,og(),s);return JO(e,i,hm())}async _openRedirect(e,n,r,s){await this._originValidation(e);const i=await Cx(e,n,r,og(),s);return iO(i),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:s,promise:i}=this.eventManagers[n];return s?Promise.resolve(s):(bs(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await WO(e),r=new kO(e);return n.register("authEvent",s=>(Xe(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(Hh,{type:Hh},s=>{var o;const i=(o=s==null?void 0:s[0])==null?void 0:o[Hh];i!==void 0&&n(!!i),zr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=LO(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return aS()||tS()||dm()}}const rL=nL;var kx="@firebase/auth",Rx="1.12.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sL{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){Xe(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iL(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function oL(t){ca(new Yi("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:l}=r.options;Xe(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:o,authDomain:l,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:lS(t)},d=new _P(r,s,i,c);return AP(d,n),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),ca(new Yi("auth-internal",e=>{const n=ro(e.getProvider("auth").getImmediate());return(r=>new sL(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),oi(kx,Rx,iL(t)),oi(kx,Rx,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aL=5*60,lL=wb("authIdTokenMaxAge")||aL;let Ax=null;const cL=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>lL)return;const s=n==null?void 0:n.token;Ax!==s&&(Ax=s,await fetch(t,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function dL(t=Ob()){const e=T0(t,"auth");if(e.isInitialized())return e.getImmediate();const n=RP(t,{popupRedirectResolver:rL,persistence:[pO,nO,xS]}),r=wb("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=cL(i.toString());QP(n,o,()=>o(n.currentUser)),JP(n,l=>o(l))}}const s=Eb("auth");return s&&PP(n,`http://${s}`),n}function uL(){var t;return((t=document.getElementsByTagName("head"))==null?void 0:t[0])??document}bP({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=s=>{const i=Qr("internal-error");i.customData=s,n(i)},r.type="text/javascript",r.charset="UTF-8",uL().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});oL("Browser");const fL={apiKey:"AIzaSyCqXssa5oOaWY3CiN7ti53Qt1F_AGpBrVE",authDomain:"tenfubu-verse.firebaseapp.com",databaseURL:"https://tenfubu-verse-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"tenfubu-verse",storageBucket:"tenfubu-verse.firebasestorage.app",messagingSenderId:"1047996014362",appId:"1:1047996014362:web:729f6b715d929087e296a3"},TS=Pb(fL),ir=HA(TS),kc=dL(TS),ac=[{rank:"BRONZE",min:0,max:2e3,lossPoints:0},{rank:"SILVER",min:2001,max:4e3,lossPoints:20},{rank:"GOLD",min:4001,max:6e3,lossPoints:40},{rank:"PLATINUM",min:6001,max:8e3,lossPoints:60},{rank:"DIAMOND",min:8001,max:1e4,lossPoints:80},{rank:"MASTER",min:10001,max:1/0,lossPoints:100}],or={BRONZE:"",SILVER:"",GOLD:"",PLATINUM:"",DIAMOND:"",MASTER:""},wn=t=>{for(const e of ac)if(t>=e.min&&t<=e.max)return e.rank;return"BRONZE"},Cl=t=>ac.findIndex(e=>e.rank===t),CS=()=>({rating:0,winStreak:0,totalMatches:0,wins:0,losses:0}),vd=200,Px=100,hL=10,pL=20,Ox=(t,e,n)=>{const r=wn(t),s=wn(n),i=Cl(r),o=Cl(s),l=e+1,c=Math.min((l-1)*hL,Px),d=Math.max(0,o-i),u=Math.min(d*pL,Px),h=100+c+u,f=Math.floor(vd*h/100),b=t+f,C=wn(b),k=Cl(C);return{newRating:b,ratingChange:f,newWinStreak:l,newRank:C,oldRank:r,isRankUp:k>i,isRankDown:!1,bonusBreakdown:{base:vd,winStreakBonus:Math.floor(vd*c/100),rankDiffBonus:Math.floor(vd*u/100),total:f}}},Lx=t=>{const e=wn(t),r=-ac.find(c=>c.rank===e).lossPoints,s=Math.max(0,t+r),i=wn(s),o=Cl(e),l=Cl(i);return{newRating:s,ratingChange:r,newWinStreak:0,newRank:i,oldRank:e,isRankUp:!1,isRankDown:l<o,bonusBreakdown:{base:r,winStreakBonus:0,rankDiffBonus:0,total:r}}},Mx=async(t,e,n)=>{const r=sr(ir,`players/${t}`),s=await Sc(r);if(s.exists()){const o=s.val();return o.userId||(await om(r,{userId:e}),o.userId=e),o}const i={userId:e,playerName:n||"",createdAt:Date.now(),lastMatchAt:Date.now(),ratings:{}};return await Ec(r,i),i},cg=async(t,e)=>{const n=sr(ir,`players/${t}/ratings/${e}`),r=await Sc(n);if(r.exists())return r.val();const s=CS();return await Ec(n,s),s},kS=async t=>{const e=sr(ir,`players/${t}/ratings`),n=await Sc(e);return n.exists()?n.val():{}},gL=async(t,e,n,r)=>{const s=sr(ir,`players/${t}/ratings/${e}`),i=sr(ir,`players/${t}`);await YA(s,o=>{const l=o||CS();return{rating:n.newRating,winStreak:n.newWinStreak,totalMatches:l.totalMatches+1,wins:l.wins+(r?1:0),losses:l.losses+(r?0:1)}}),await om(i,{lastMatchAt:Date.now()})},RS=async(t,e)=>{const n=sr(ir,`players/${t}`);await om(n,{playerName:e})},mL=async t=>{const e=sr(ir,"matches"),n=WE(e),r=n.key,s={playerId:t.myPlayerId,playerName:t.myPlayerName,playerClass:t.myPlayerClass,ratingBefore:t.myRatingBefore,ratingAfter:t.myRatingAfter,isFirst:t.myIsFirst},i={playerId:t.opponentPlayerId,playerName:t.opponentPlayerName,playerClass:t.opponentPlayerClass,ratingBefore:t.opponentRatingBefore,ratingAfter:t.opponentRatingAfter,isFirst:!t.myIsFirst},o={matchId:r,timestamp:Date.now(),gameMode:t.gameMode,player1:s,player2:i,winnerId:t.winnerId,winnerSide:t.winnerId===t.myPlayerId?"player1":"player2",duration:t.duration};return await Ec(n,o),console.log("[MatchHistory] Saved match record:",r,o),r},yL=async(t=5)=>{const e=["SENKA","AJA","YORUKA"],n={SENKA:[],AJA:[],YORUKA:[]},r=sr(ir,"players"),s=await Sc(r);if(!s.exists())return n;for(const i of e){const o=[];s.forEach(l=>{var h;const c=l.key,d=l.val(),u=(h=d.ratings)==null?void 0:h[i];u&&u.totalMatches>0&&o.push({playerId:c,playerName:d.playerName||"",rating:u.rating,rank:wn(u.rating),totalMatches:u.totalMatches,wins:u.wins,losses:u.losses})}),o.sort((l,c)=>c.rating-l.rating),n[i]=o.slice(0,t)}return n},Ws=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},vL=1280,xL=720,Dx=Ws("/leaders/azya_leader.png"),Nx=Ws("/leaders/senka_leader.png"),$x=Ws("/leaders/yoRuka_leader.png"),To={BRONZE:"#cd7f32",SILVER:"#c0c0c0",GOLD:"#ffd700",PLATINUM:"#e5e4e2",DIAMOND:"#b9f2ff",MASTER:"#ff4500"},_L=({onStartConfig:t,audioSettings:e,onAudioSettingsChange:n,playerId:r,onSetHomeCard:s,homeCardId:i=null,isAnonymous:o=!0,userId:l=null,currentPlayerName:c="",onPlayerNameUpdate:d,onNavigateToRegister:u,onNavigateToLogin:h,onNavigateToProfile:f,onLogout:b,returnToHome:C=!1})=>{const[k,A]=P.useState(C?"home":"title"),[R,m]=P.useState(!1);P.useEffect(()=>{console.log(" TitleScreen auth state:",{isAnonymous:o,userId:l})},[o,l]),P.useEffect(()=>{console.log(" TitleScreen homeCardId changed:",i)},[i]);const[T]=P.useState(()=>{const D=Math.floor(Math.random()*Sn.length);return Sn[D].id}),[L,g]=P.useState("home"),[H,Q]=P.useState("home"),[W,G]=P.useState(!1),[de,fe]=P.useState(!1),[Ee,ae]=P.useState(""),[he,be]=P.useState(!1),[v,_]=P.useState("class"),[x,I]=P.useState(null),[y,O]=P.useState(null),[N,ne]=P.useState([]),[B,ye]=P.useState([]),[te,xe]=P.useState(!1),[J,V]=P.useState("CPU"),[Qe,tt]=P.useState("NORMAL"),[Ae,Se]=P.useState({}),[Pe,et]=P.useState(!1),[at,nt]=P.useState(25),[Ue,Pt]=P.useState(!1),[lt,Ot]=P.useState(!1),vt=P.useRef(0),ct=P.useRef(0),wt=P.useRef(0),Lt=P.useRef(0),Oe=P.useRef(0),Bt=P.useRef(null),xt=P.useRef(null),me=P.useRef(Date.now()),[qe,Wt]=P.useState(!1),[It,Zt]=P.useState(c),[es,Zn]=P.useState(""),[Cn,Ca]=P.useState(!1),[Cf,ka]=P.useState({SENKA:[],AJA:[],YORUKA:[]}),[yn,Ra]=P.useState(!1),[Ss,ws]=P.useState(""),[S,Aa]=P.useState(1);P.useEffect(()=>{const D=()=>{const ve=window.innerWidth/vL,je=window.innerHeight/xL;Aa(Math.min(ve,je))};return D(),window.addEventListener("resize",D),()=>window.removeEventListener("resize",D)},[]),P.useEffect(()=>{(async()=>{if(!r){et(!1);return}et(!0);try{const ve=await kS(r);Se(ve)}catch(ve){console.error("Failed to fetch class ratings:",ve)}finally{et(!1)}})()},[r]),P.useEffect(()=>{(async()=>{if(H==="ranking"){Ra(!0),ws("");try{const ve=await yL(5);ka(ve)}catch(ve){console.error("Failed to fetch rankings:",ve),ws("")}finally{Ra(!1)}}})()},[H]);const kf=()=>{m(!0),setTimeout(()=>{A("home"),m(!1)},600)},Rc=D=>{D===L||W||(g(D),G(!0),setTimeout(()=>{Q(D),G(!1)},150))},Tr=D=>{const ve=D%360;return ve<0?ve+360:ve},Si=()=>{Bt.current!==null&&(cancelAnimationFrame(Bt.current),Bt.current=null)},Pa=()=>{xt.current!==null&&(cancelAnimationFrame(xt.current),xt.current=null),Ot(!1)},Ac=()=>{Pa(),Ot(!0);const D=.2,ve=()=>{nt(je=>Tr(je+D)),xt.current=requestAnimationFrame(ve)};xt.current=requestAnimationFrame(ve)},Rf=D=>{Si(),Pa(),me.current=Date.now(),Pt(!0),vt.current=D.clientX,ct.current=at,wt.current=Date.now(),Lt.current=D.clientX,Oe.current=0},Pc=D=>{if(!Ue)return;const ve=Date.now(),je=ve-wt.current,ft=D.clientX-Lt.current;je>0&&(Oe.current=ft/je);const bt=D.clientX-vt.current,vn=ct.current+bt*.5;nt(Tr(vn)),wt.current=ve,Lt.current=D.clientX},lo=()=>{Pt(!1),me.current=Date.now();let D=Oe.current*.5;const ve=.95,je=.1,ft=()=>{Math.abs(D)>je?(nt(bt=>Tr(bt+D)),D*=ve,Bt.current=requestAnimationFrame(ft)):(Bt.current=null,me.current=Date.now())};Math.abs(D)>je&&ft()};P.useEffect(()=>()=>{Si(),Pa()},[]),P.useEffect(()=>{if(L!=="home")return;const D=setInterval(()=>{Date.now()-me.current>=2e3&&!Ue&&!Bt.current&&!lt&&Ac()},100);return()=>clearInterval(D)},[L,Ue,lt]);const Oa=async()=>{if(Zn(""),!It.trim()){Zn("");return}if(It.length>20){Zn("20");return}if(!r){Zn("");return}Ca(!0);try{await RS(r,It.trim()),d==null||d(It.trim()),Wt(!1),Zn("")}catch(D){console.error("Failed to update player name:",D),Zn("")}finally{Ca(!1)}},Af=()=>{Zt(c),Zn(""),Wt(!0)},co=()=>{Zt(c),Zn(""),Wt(!1)},Oc=D=>{D.key==="Enter"&&!Cn?Oa():D.key==="Escape"&&co()},uo=D=>{gr(D==="casual"?"CASUAL_MATCH":"RANKED_MATCH")},fo=()=>{be(!0)},wi=()=>{be(!1),b&&b()},Is=()=>{be(!1)},er=D=>{I(D);const je=(D==="SENKA"?v0:D==="AJA"?x0:_0).filter(ft=>!ft.cardId.startsWith("TOKEN_")).map(ft=>{var bt;return{cardId:ft.cardId,cost:((bt=Sn.find(vn=>vn.id===ft.cardId))==null?void 0:bt.cost)||0}}).sort((ft,bt)=>ft.cost-bt.cost).map(ft=>ft.cardId);ye(je),_("card-list")},hr=D=>{O(D),_("card-detail")},pr=D=>{if(!y||B.length===0)return;const ve=B.indexOf(y);if(ve===-1)return;let je;D==="prev"?je=ve===0?B.length-1:ve-1:je=ve===B.length-1?0:ve+1,O(B[je])},La=D=>{const ve=Sn.find(je=>je.id===D);ve&&ve.relatedCards&&ve.relatedCards.length>0&&(O(D),ne(ve.relatedCards),_("related-card"))},ho=()=>{O(null),_("card-list")},Lc=()=>{ne([]),_("card-detail")},gr=(D,ve,je)=>{V(D),ve&&ae(ve),je&&tt(je),xe(!0)},le=D=>{xe(!1),t(J,J==="JOIN"?Ee:void 0,D,J==="CPU"?Qe:void 0),fe(!1)},Ne=()=>{xe(!1)};P.useEffect(()=>{L!=="gallery"&&(_("class"),I(null),O(null),ne([]))},[L]);const Ma=9*S;if(k==="title")return a.jsxs("div",{className:"screen title-screen",onClick:kf,style:{height:"100dvh",width:"100vw",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative",overflow:"hidden",color:"white",cursor:"pointer"},children:[a.jsx("div",{style:{position:"absolute",inset:0,backgroundImage:`url(${Ws("/title/background.png")})`,backgroundSize:"cover",backgroundPosition:"center",zIndex:0}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",zIndex:-1}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(0, 0, 0, 0.3)",zIndex:1}}),a.jsxs("div",{style:{position:"relative",zIndex:2,display:"flex",flexDirection:"column",alignItems:"center",transform:R?"translateY(-100vh)":"translateY(0)",transition:R?"transform 0.6s ease-out":"none"},children:[a.jsx("div",{style:{fontFamily:"Tamanegi, sans-serif",fontSize:`${Ma}rem`,color:"#fff",textShadow:"0 0 30px rgba(233, 69, 96, 0.9), 0 0 60px rgba(233, 69, 96, 0.5), 3px 3px 6px rgba(0,0,0,0.9)",letterSpacing:`${.5*S}rem`,whiteSpace:"nowrap",marginBottom:`${2*S}rem`},children:""}),a.jsx("div",{style:{fontSize:`${2*S}rem`,color:"#fff",fontWeight:"bold",letterSpacing:`${.3*S}rem`,animation:"blink 1.5s ease-in-out infinite",textShadow:"0 0 10px rgba(255, 255, 255, 0.8)"},children:"GAME START"})]}),a.jsx("p",{style:{position:"absolute",bottom:20*S,opacity:.5,fontSize:`${.8*S}rem`,zIndex:2},children:"Ver 1.04 Beta"}),a.jsx("style",{children:`
                    @keyframes blink {
                        0%, 100% { opacity: 1; }
                        50% { opacity: 0.3; }
                    }
                `})]});const Ii=[{id:"solo",label:"",color:"#e94560"},{id:"room",label:"",color:"#60a5fa"},{id:"random",label:"",color:"#4ade80"},{id:"home",label:"",color:"#f59e0b"},{id:"ranking",label:"",color:"#a855f7"},{id:"gallery",label:"",color:"#ec4899"},{id:"settings",label:"",color:"#6b7280"}];return a.jsxs("div",{className:"screen home-screen",style:{height:"100dvh",width:"100vw",display:"flex",flexDirection:"column",position:"relative",overflow:"hidden",color:"white"},onMouseMove:Pc,onMouseUp:lo,onMouseLeave:lo,children:[a.jsx("div",{style:{position:"absolute",inset:0,backgroundImage:`url(${Ws("/title/background.png")})`,backgroundSize:"cover",backgroundPosition:"center",zIndex:0}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",zIndex:-1}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(0, 0, 0, 0.5)",zIndex:1}}),a.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",paddingBottom:80*S,position:"relative",zIndex:2},children:[H==="home"&&(()=>{console.log(" Rendering home card, homeCardId:",i,"randomCardId:",T);const D=i||T,ve=Sn.find(vn=>vn.id===D)||null,je=(ve==null?void 0:ve.imageUrl)||`/cards/${D}.png`,ft=(ve==null?void 0:ve.type)==="FOLLOWER"?(ve==null?void 0:ve.evolvedImageUrl)||`/cards/${D}_evolved.png`:null,bt=!i;return a.jsxs("div",{style:{position:"absolute",left:150*S,top:"50%",transform:"translateY(-50%)",perspective:1e3},children:[a.jsxs("div",{onMouseDown:Rf,style:{width:439*S,height:615*S,transformStyle:"preserve-3d",transform:`rotateY(${at}deg)`,transition:Ue?"none":"transform 0.3s ease-out",cursor:Ue?"grabbing":"grab"},children:[a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",borderRadius:12*S,background:`#2d3748 url(${Ws(je)}) center/cover no-repeat`,border:`3px solid ${bt?"#718096":"#e94560"}`,boxShadow:"0 10px 30px rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center"}}),a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",transform:"rotateY(180deg)",borderRadius:12*S,background:ft?`#2d3748 url(${Ws(ft)}) center/cover no-repeat`:`#2d3748 url(${Ws(je)}) center/cover no-repeat`,border:`3px solid ${bt?"#718096":"#a855f7"}`,boxShadow:"0 10px 30px rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center"}})]}),a.jsx("p",{style:{textAlign:"center",marginTop:10*S,fontSize:`${.75*S}rem`,color:bt?"#a0aec0":"#888"},children:bt?a.jsxs(a.Fragment,{children:["",a.jsx("br",{}),a.jsx("span",{style:{fontSize:`${.65*S}rem`},children:""})]}):""})]})})(),H==="home"&&a.jsxs("div",{style:{position:"absolute",right:100*S,top:"50%",transform:"translateY(-50%)",display:"flex",flexDirection:"column",gap:`${2*S}rem`,width:350*S},children:[a.jsxs("div",{style:{background:"rgba(0, 0, 0, 0.6)",border:"2px solid rgba(255, 255, 255, 0.2)",borderRadius:`${12*S}px`,padding:`${20*S}px`,boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)"},children:[a.jsx("h3",{style:{margin:0,marginBottom:`${10*S}px`,fontSize:`${1.2*S}rem`,color:"#fff",borderBottom:"1px solid rgba(255, 255, 255, 0.2)",paddingBottom:`${8*S}px`},children:""}),a.jsx("div",{style:{fontSize:`${1*S}rem`,color:"#e2e8f0"},children:a.jsxs("div",{style:{marginBottom:`${8*S}px`},children:[a.jsx("span",{style:{color:"#aaa"},children:":"})," ",c||""]})})]}),a.jsxs("div",{style:{background:"rgba(0, 0, 0, 0.6)",border:"2px solid rgba(255, 255, 255, 0.2)",borderRadius:`${12*S}px`,padding:`${20*S}px`,boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)"},children:[a.jsx("h3",{style:{margin:0,marginBottom:`${15*S}px`,fontSize:`${1.2*S}rem`,color:"#fff",borderBottom:"1px solid rgba(255, 255, 255, 0.2)",paddingBottom:`${8*S}px`,textAlign:"center"},children:""}),Pe?a.jsx("div",{style:{textAlign:"center",color:"#aaa",fontSize:`${.9*S}rem`},children:"..."}):a.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:`${10*S}px`},children:[(()=>{const D=Ae.SENKA,ve=(D==null?void 0:D.rating)??0,je=wn(ve),ft=To[je],bt=or[je];return a.jsxs("div",{style:{background:"rgba(233, 69, 96, 0.1)",border:"1px solid rgba(233, 69, 96, 0.3)",borderRadius:`${8*S}px`,padding:`${10*S}px`,textAlign:"center"},children:[a.jsx("div",{style:{fontSize:`${.85*S}rem`,color:"#e94560",fontWeight:"bold",marginBottom:`${5*S}px`},children:""}),a.jsx("div",{style:{fontSize:`${.75*S}rem`,color:ft,marginBottom:`${3*S}px`},children:bt}),a.jsx("div",{style:{fontSize:`${1*S}rem`,color:"#4ade80",fontWeight:"bold"},children:ve})]})})(),(()=>{const D=Ae.AJA,ve=(D==null?void 0:D.rating)??0,je=wn(ve),ft=To[je],bt=or[je];return a.jsxs("div",{style:{background:"rgba(69, 162, 233, 0.1)",border:"1px solid rgba(69, 162, 233, 0.3)",borderRadius:`${8*S}px`,padding:`${10*S}px`,textAlign:"center"},children:[a.jsx("div",{style:{fontSize:`${.85*S}rem`,color:"#45a2e9",fontWeight:"bold",marginBottom:`${5*S}px`},children:""}),a.jsx("div",{style:{fontSize:`${.75*S}rem`,color:ft,marginBottom:`${3*S}px`},children:bt}),a.jsx("div",{style:{fontSize:`${1*S}rem`,color:"#4ade80",fontWeight:"bold"},children:ve})]})})(),(()=>{const D=Ae.YORUKA,ve=(D==null?void 0:D.rating)??0,je=wn(ve),ft=To[je],bt=or[je];return a.jsxs("div",{style:{background:"rgba(168, 85, 247, 0.1)",border:"1px solid rgba(168, 85, 247, 0.3)",borderRadius:`${8*S}px`,padding:`${10*S}px`,textAlign:"center"},children:[a.jsx("div",{style:{fontSize:`${.85*S}rem`,color:"#a855f7",fontWeight:"bold",marginBottom:`${5*S}px`},children:"Y"}),a.jsx("div",{style:{fontSize:`${.75*S}rem`,color:ft,marginBottom:`${3*S}px`},children:bt}),a.jsx("div",{style:{fontSize:`${1*S}rem`,color:"#4ade80",fontWeight:"bold"},children:ve})]})})()]})]})]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",maxWidth:600*S,opacity:W?0:1,transition:"opacity 0.3s ease-in-out"},children:[H==="home"&&a.jsx("div",{style:{textAlign:"center"}}),H==="solo"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*S}rem`,marginBottom:`${1.5*S}rem`,color:"#e94560"},children:""}),a.jsxs("div",{style:{display:"flex",gap:`${3*S}rem`,perspective:1200},children:[a.jsxs("div",{onClick:()=>gr("CPU",void 0,"EASY"),style:{width:200*S,height:280*S,background:"linear-gradient(135deg, #1a3a2a 0%, #0d2d1a 100%)",border:"3px solid #4ade80",borderRadius:16*S,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(74, 222, 128, 0.3)"},onMouseOver:D=>{D.currentTarget.style.transform="rotateY(0deg) scale(1.05)",D.currentTarget.style.boxShadow="0 15px 40px rgba(74, 222, 128, 0.5)"},onMouseOut:D=>{D.currentTarget.style.transform="rotateY(15deg)",D.currentTarget.style.boxShadow="0 10px 30px rgba(74, 222, 128, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*S}rem`,marginBottom:`${.5*S}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*S}rem`,color:"#4ade80",margin:0,marginBottom:`${.5*S}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*S}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*S}rem`},children:["",a.jsx("br",{}),"CPU"]})]}),a.jsxs("div",{onClick:()=>gr("CPU",void 0,"NORMAL"),style:{width:200*S,height:280*S,background:"linear-gradient(135deg, #1a2a3a 0%, #0d1a2a 100%)",border:"3px solid #60a5fa",borderRadius:16*S,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(0deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(96, 165, 250, 0.3)"},onMouseOver:D=>{D.currentTarget.style.transform="scale(1.05)",D.currentTarget.style.boxShadow="0 15px 40px rgba(96, 165, 250, 0.5)"},onMouseOut:D=>{D.currentTarget.style.transform="rotateY(0deg)",D.currentTarget.style.boxShadow="0 10px 30px rgba(96, 165, 250, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*S}rem`,marginBottom:`${.5*S}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*S}rem`,color:"#60a5fa",margin:0,marginBottom:`${.5*S}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*S}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*S}rem`},children:["",a.jsx("br",{}),"CPU"]})]}),a.jsxs("div",{onClick:()=>gr("CPU",void 0,"HARD"),style:{width:200*S,height:280*S,background:"linear-gradient(135deg, #3a1a1a 0%, #2d0d0d 100%)",border:"3px solid #e94560",borderRadius:16*S,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(-15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(233, 69, 96, 0.3)"},onMouseOver:D=>{D.currentTarget.style.transform="rotateY(0deg) scale(1.05)",D.currentTarget.style.boxShadow="0 15px 40px rgba(233, 69, 96, 0.5)"},onMouseOut:D=>{D.currentTarget.style.transform="rotateY(-15deg)",D.currentTarget.style.boxShadow="0 10px 30px rgba(233, 69, 96, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*S}rem`,marginBottom:`${.5*S}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*S}rem`,color:"#e94560",margin:0,marginBottom:`${.5*S}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*S}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*S}rem`},children:["",a.jsx("br",{}),"CPU"]})]})]})]}),H==="room"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*S}rem`,marginBottom:`${1.5*S}rem`,color:"#60a5fa"},children:""}),de?a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:`${1*S}rem`,alignItems:"center"},children:[a.jsx("input",{type:"text",placeholder:"ID",value:Ee,onChange:D=>ae(D.target.value),style:{padding:`${.8*S}rem`,fontSize:`${1*S}rem`,width:250*S,background:"rgba(255,255,255,0.1)",border:"2px solid #a855f7",borderRadius:8*S,color:"white",textAlign:"center",userSelect:"text"}}),a.jsxs("div",{style:{display:"flex",gap:`${.5*S}rem`},children:[a.jsx("button",{onClick:()=>fe(!1),style:{padding:`${.6*S}rem ${1.5*S}rem`,fontSize:`${1*S}rem`,background:"transparent",border:"1px solid #666",borderRadius:6*S,color:"#888",cursor:"pointer"},children:""}),a.jsx("button",{onClick:()=>gr("JOIN",Ee),disabled:!Ee,style:{padding:`${.6*S}rem ${1.5*S}rem`,fontSize:`${1*S}rem`,background:Ee?"#a855f7":"#333",border:"none",borderRadius:6*S,color:"white",cursor:Ee?"pointer":"not-allowed",opacity:Ee?1:.5},children:""})]})]}):a.jsxs("div",{style:{display:"flex",gap:`${3*S}rem`,perspective:1200},children:[a.jsxs("div",{onClick:()=>gr("HOST"),style:{width:200*S,height:280*S,background:"linear-gradient(135deg, #1a2a3a 0%, #0d1a2a 100%)",border:"3px solid #60a5fa",borderRadius:16*S,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(96, 165, 250, 0.3)"},onMouseOver:D=>{D.currentTarget.style.transform="rotateY(0deg) scale(1.05)",D.currentTarget.style.boxShadow="0 15px 40px rgba(96, 165, 250, 0.5)"},onMouseOut:D=>{D.currentTarget.style.transform="rotateY(15deg)",D.currentTarget.style.boxShadow="0 10px 30px rgba(96, 165, 250, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*S}rem`,marginBottom:`${.5*S}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*S}rem`,color:"#60a5fa",margin:0,marginBottom:`${.5*S}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*S}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*S}rem`},children:["ID",a.jsx("br",{}),""]})]}),a.jsxs("div",{onClick:()=>fe(!0),style:{width:200*S,height:280*S,background:"linear-gradient(135deg, #2a1a3a 0%, #1a0d2a 100%)",border:"3px solid #a855f7",borderRadius:16*S,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(-15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(168, 85, 247, 0.3)"},onMouseOver:D=>{D.currentTarget.style.transform="rotateY(0deg) scale(1.05)",D.currentTarget.style.boxShadow="0 15px 40px rgba(168, 85, 247, 0.5)"},onMouseOut:D=>{D.currentTarget.style.transform="rotateY(-15deg)",D.currentTarget.style.boxShadow="0 10px 30px rgba(168, 85, 247, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*S}rem`,marginBottom:`${.5*S}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*S}rem`,color:"#a855f7",margin:0,marginBottom:`${.5*S}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*S}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*S}rem`},children:["ID",a.jsx("br",{}),""]})]})]})]}),H==="random"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*S}rem`,marginBottom:`${1.5*S}rem`,color:"#4ade80"},children:""}),a.jsxs("div",{style:{display:"flex",gap:`${3*S}rem`,perspective:1200},children:[a.jsxs("div",{onClick:()=>uo("casual"),style:{width:200*S,height:280*S,background:"linear-gradient(135deg, #1a3a1a 0%, #0d2d0d 100%)",border:"3px solid #4ade80",borderRadius:16*S,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(74, 222, 128, 0.3)"},onMouseOver:D=>{D.currentTarget.style.transform="rotateY(0deg) scale(1.05)",D.currentTarget.style.boxShadow="0 15px 40px rgba(74, 222, 128, 0.5)"},onMouseOut:D=>{D.currentTarget.style.transform="rotateY(15deg)",D.currentTarget.style.boxShadow="0 10px 30px rgba(74, 222, 128, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*S}rem`,marginBottom:`${.5*S}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*S}rem`,color:"#4ade80",margin:0,marginBottom:`${.5*S}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*S}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*S}rem`},children:["",a.jsx("br",{}),""]})]}),a.jsxs("div",{onClick:()=>uo("ranked"),style:{width:200*S,height:280*S,background:"linear-gradient(135deg, #3a1a1a 0%, #2d0d0d 100%)",border:"3px solid #e94560",borderRadius:16*S,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(-15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(233, 69, 96, 0.3)"},onMouseOver:D=>{D.currentTarget.style.transform="rotateY(0deg) scale(1.05)",D.currentTarget.style.boxShadow="0 15px 40px rgba(233, 69, 96, 0.5)"},onMouseOut:D=>{D.currentTarget.style.transform="rotateY(-15deg)",D.currentTarget.style.boxShadow="0 10px 30px rgba(233, 69, 96, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*S}rem`,marginBottom:`${.5*S}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*S}rem`,color:"#e94560",margin:0,marginBottom:`${.5*S}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*S}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*S}rem`},children:["",a.jsx("br",{}),""]})]})]})]}),H==="ranking"&&a.jsxs("div",{style:{width:"100%"},children:[a.jsx("h2",{style:{fontSize:`${1.8*S}rem`,marginBottom:`${1*S}rem`,color:"#a855f7",textAlign:"center"},children:""}),yn&&a.jsx("p",{style:{fontSize:`${1*S}rem`,color:"#888",textAlign:"center"},children:"..."}),Ss&&!yn&&a.jsx("p",{style:{fontSize:`${1*S}rem`,color:"#ff5050",textAlign:"center"},children:Ss}),!yn&&!Ss&&a.jsx("div",{style:{display:"flex",gap:`${1.2*S}rem`,justifyContent:"center",flexWrap:"wrap"},children:["SENKA","AJA","YORUKA"].map(D=>{const ve={SENKA:"",AJA:"",YORUKA:""},je=Cf[D];return a.jsxs("div",{style:{minWidth:280*S,background:"rgba(30, 30, 50, 0.8)",borderRadius:12*S,padding:`${16*S}px`,boxShadow:"0 4px 16px rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.1)"},children:[a.jsx("h3",{style:{fontSize:`${1.2*S}rem`,fontWeight:"bold",color:"#fff",marginBottom:`${.8*S}rem`,textAlign:"center",textShadow:"0 2px 4px rgba(0,0,0,0.5)"},children:ve[D]}),a.jsxs("div",{style:{display:"flex",padding:`${6*S}px ${10*S}px`,borderBottom:"2px solid rgba(255,255,255,0.2)",marginBottom:`${6*S}px`},children:[a.jsx("div",{style:{width:32*S,fontSize:`${.7*S}rem`,color:"#888",fontWeight:"bold"},children:"#"}),a.jsx("div",{style:{flex:1,fontSize:`${.7*S}rem`,color:"#888",fontWeight:"bold"},children:""}),a.jsx("div",{style:{width:60*S,fontSize:`${.7*S}rem`,color:"#888",fontWeight:"bold",textAlign:"center"},children:""}),a.jsx("div",{style:{width:50*S,fontSize:`${.7*S}rem`,color:"#888",fontWeight:"bold",textAlign:"right"},children:""})]}),je.length===0?a.jsx("div",{style:{padding:`${16*S}px`,textAlign:"center",color:"#666",fontSize:`${.8*S}rem`},children:""}):je.map((ft,bt)=>{const vn=["#FFD700","#C0C0C0","#CD7F32","#888","#888"],po=["linear-gradient(90deg, rgba(255,215,0,0.2) 0%, transparent 100%)","linear-gradient(90deg, rgba(192,192,192,0.15) 0%, transparent 100%)","linear-gradient(90deg, rgba(205,127,50,0.15) 0%, transparent 100%)"];return a.jsxs("div",{style:{display:"flex",alignItems:"center",padding:`${10*S}px ${10*S}px`,borderRadius:6*S,marginBottom:3*S,background:po[bt]||"transparent"},children:[a.jsx("div",{style:{width:32*S,fontSize:`${1*S}rem`,fontWeight:"bold",color:vn[bt]||"#888",textShadow:bt<3?"0 1px 2px rgba(0,0,0,0.5)":"none"},children:bt+1}),a.jsx("div",{style:{flex:1,fontSize:`${.9*S}rem`,color:"#fff",fontWeight:bt<3?"bold":"normal",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:ft.playerName}),a.jsx("div",{style:{width:60*S,textAlign:"center"},children:a.jsx("span",{style:{display:"inline-block",padding:`${3*S}px ${6*S}px`,borderRadius:4*S,fontSize:`${.65*S}rem`,fontWeight:"bold",color:"#fff",background:To[ft.rank],textShadow:"0 1px 2px rgba(0,0,0,0.5)"},children:or[ft.rank]})}),a.jsx("div",{style:{width:50*S,fontSize:`${.9*S}rem`,fontWeight:"bold",color:To[ft.rank],textAlign:"right"},children:ft.rating})]},ft.playerId)})]},D)})})]}),H==="gallery"&&a.jsxs(a.Fragment,{children:[v==="class"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*S}rem`,marginBottom:`${1.5*S}rem`,color:"#ec4899"},children:" - "}),a.jsxs("div",{style:{display:"flex",gap:`${1.2*S}rem`,justifyContent:"center",marginBottom:`${1*S}rem`},children:[a.jsxs("div",{onClick:()=>er("SENKA"),style:{width:200*S,height:280*S,border:"1px solid #444",borderRadius:10*S,background:"linear-gradient(180deg, #2c0b0e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:"0 4px 20px rgba(233, 69, 96, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:D=>{D.currentTarget.style.transform="scale(1.05)",D.currentTarget.style.boxShadow="0 8px 30px rgba(233, 69, 96, 0.4)"},onMouseOut:D=>{D.currentTarget.style.transform="scale(1)",D.currentTarget.style.boxShadow="0 4px 20px rgba(233, 69, 96, 0.2)"},children:[a.jsx("img",{src:Nx,alt:"Senka",style:{width:"100%",height:"75%",objectFit:"cover"}}),a.jsx("div",{style:{padding:`${8*S}px`,display:"flex",flexDirection:"column",alignItems:"center",width:"100%",justifyContent:"center",flex:1},children:a.jsx("h3",{style:{fontSize:`${1.4*S}rem`,color:"#e94560",margin:0,fontFamily:"sans-serif"},children:""})})]}),a.jsxs("div",{onClick:()=>er("AJA"),style:{width:200*S,height:280*S,border:"1px solid #444",borderRadius:10*S,background:"linear-gradient(180deg, #0f1c2e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:"0 4px 20px rgba(69, 162, 233, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:D=>{D.currentTarget.style.transform="scale(1.05)",D.currentTarget.style.boxShadow="0 8px 30px rgba(69, 162, 233, 0.4)"},onMouseOut:D=>{D.currentTarget.style.transform="scale(1)",D.currentTarget.style.boxShadow="0 4px 20px rgba(69, 162, 233, 0.2)"},children:[a.jsx("img",{src:Dx,alt:"Azya",style:{width:"100%",height:"75%",objectFit:"cover",objectPosition:"center top"}}),a.jsx("div",{style:{padding:`${8*S}px`,display:"flex",flexDirection:"column",alignItems:"center",width:"100%",justifyContent:"center",flex:1},children:a.jsx("h3",{style:{fontSize:`${1.4*S}rem`,color:"#45a2e9",margin:0,fontFamily:"sans-serif"},children:""})})]}),a.jsxs("div",{onClick:()=>er("YORUKA"),style:{width:200*S,height:280*S,border:"1px solid #444",borderRadius:10*S,background:"linear-gradient(180deg, #1a0f2e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:"0 4px 20px rgba(168, 85, 247, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:D=>{D.currentTarget.style.transform="scale(1.05)",D.currentTarget.style.boxShadow="0 8px 30px rgba(168, 85, 247, 0.4)"},onMouseOut:D=>{D.currentTarget.style.transform="scale(1)",D.currentTarget.style.boxShadow="0 4px 20px rgba(168, 85, 247, 0.2)"},children:[a.jsx("img",{src:$x,alt:"Yoruka",style:{width:"100%",height:"75%",objectFit:"cover"}}),a.jsx("div",{style:{padding:`${8*S}px`,display:"flex",flexDirection:"column",alignItems:"center",width:"100%",justifyContent:"center",flex:1},children:a.jsx("h3",{style:{fontSize:`${1.4*S}rem`,color:"#a855f7",margin:0,fontFamily:"sans-serif"},children:"Y"})})]})]})]}),v==="card-list"&&x&&a.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"auto"},children:a.jsx(N5,{classType:x,onSelectCard:hr})}),v==="card-detail"&&y&&a.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"auto"},children:a.jsx(U5,{cardId:y,allCardIds:B,onNavigate:pr,onOpenRelatedCard:La,onBack:ho,onSetHomeCard:s})}),v==="related-card"&&y&&a.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"auto"},children:a.jsx(W5,{parentCardId:y,relatedCardIds:N,onBack:Lc})})]}),H==="settings"&&a.jsxs("div",{style:{background:"rgba(0, 0, 0, 0.3)",borderRadius:12*S,padding:`${2*S}rem`,minWidth:400*S},children:[a.jsx("h2",{style:{fontSize:`${1.8*S}rem`,marginBottom:`${1.5*S}rem`,color:"#6b7280",textAlign:"center"},children:""}),a.jsxs("div",{style:{marginBottom:`${1.5*S}rem`},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:`${.5*S}rem`},children:[a.jsx("span",{style:{fontSize:`${1*S}rem`},children:"BGM"}),a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8*S,cursor:"pointer"},children:[a.jsx("input",{type:"checkbox",checked:e.bgmEnabled,onChange:D=>n({bgmEnabled:D.target.checked}),style:{width:18*S,height:18*S}}),a.jsx("span",{style:{color:e.bgmEnabled?"#4ade80":"#888",fontSize:`${.9*S}rem`},children:e.bgmEnabled?"ON":"OFF"})]})]}),a.jsx("input",{type:"range",min:0,max:1,step:.05,value:e.bgm,onChange:D=>n({bgm:parseFloat(D.target.value)}),disabled:!e.bgmEnabled,style:{width:"100%",opacity:e.bgmEnabled?1:.5}})]}),a.jsxs("div",{style:{marginBottom:`${1.5*S}rem`},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:`${.5*S}rem`},children:[a.jsx("span",{style:{fontSize:`${1*S}rem`},children:""}),a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8*S,cursor:"pointer"},children:[a.jsx("input",{type:"checkbox",checked:e.seEnabled,onChange:D=>n({seEnabled:D.target.checked}),style:{width:18*S,height:18*S}}),a.jsx("span",{style:{color:e.seEnabled?"#4ade80":"#888",fontSize:`${.9*S}rem`},children:e.seEnabled?"ON":"OFF"})]})]}),a.jsx("input",{type:"range",min:0,max:1,step:.05,value:e.se,onChange:D=>n({se:parseFloat(D.target.value)}),disabled:!e.seEnabled,style:{width:"100%",opacity:e.seEnabled?1:.5}})]}),a.jsxs("div",{style:{borderTop:"1px solid rgba(255, 255, 255, 0.1)",paddingTop:`${1.5*S}rem`,marginTop:`${1*S}rem`,marginBottom:`${1.5*S}rem`},children:[a.jsx("h3",{style:{fontSize:`${1.2*S}rem`,marginBottom:`${1*S}rem`,color:"#fff"},children:""}),qe?a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:`${.5*S}rem`},children:[a.jsx("input",{type:"text",value:It,onChange:D=>Zt(D.target.value),onKeyDown:Oc,disabled:Cn,maxLength:20,autoFocus:!0,style:{width:"100%",padding:`${.6*S}rem ${1*S}rem`,fontSize:`${.9*S}rem`,borderRadius:6*S,border:es?"2px solid #ff5050":"2px solid #a855f7",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"}}),a.jsx("div",{style:{fontSize:`${.65*S}rem`,color:"#888",marginTop:`${.2*S}rem`},children:"120"}),es&&a.jsx("div",{style:{fontSize:`${.7*S}rem`,color:"#ff5050",marginTop:`${-.2*S}rem`},children:es}),a.jsxs("div",{style:{display:"flex",gap:`${.5*S}rem`},children:[a.jsx("button",{onClick:co,disabled:Cn,style:{flex:1,padding:`${.5*S}rem`,fontSize:`${.8*S}rem`,background:"#555",border:"none",borderRadius:4*S,color:"white",cursor:Cn?"not-allowed":"pointer",fontWeight:"bold",opacity:Cn?.5:1,transition:"all 0.2s"},onMouseEnter:D=>!Cn&&(D.currentTarget.style.background="#666"),onMouseLeave:D=>!Cn&&(D.currentTarget.style.background="#555"),children:""}),a.jsx("button",{onClick:Oa,disabled:Cn,style:{flex:1,padding:`${.5*S}rem`,fontSize:`${.8*S}rem`,background:Cn?"#555":"linear-gradient(135deg, #a855f7 0%, #7c3aed 100%)",border:"none",borderRadius:4*S,color:"white",cursor:Cn?"not-allowed":"pointer",fontWeight:"bold",transition:"all 0.2s"},onMouseEnter:D=>!Cn&&(D.currentTarget.style.transform="scale(1.05)"),onMouseLeave:D=>!Cn&&(D.currentTarget.style.transform="scale(1)"),children:Cn?"...":""})]})]}):a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:`${.5*S}rem`},children:a.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:`${.6*S}rem ${1*S}rem`,background:"rgba(255, 255, 255, 0.05)",borderRadius:6*S,border:"1px solid rgba(255, 255, 255, 0.1)"},children:[a.jsx("span",{style:{fontSize:`${.9*S}rem`,color:"#fff"},children:c}),a.jsx("button",{onClick:Af,style:{padding:`${.4*S}rem ${.8*S}rem`,fontSize:`${.75*S}rem`,background:"linear-gradient(135deg, #a855f7 0%, #7c3aed 100%)",border:"none",borderRadius:4*S,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.2s"},onMouseEnter:D=>D.currentTarget.style.transform="scale(1.05)",onMouseLeave:D=>D.currentTarget.style.transform="scale(1)",children:""})]})})]}),a.jsxs("div",{style:{borderTop:"1px solid rgba(255, 255, 255, 0.1)",paddingTop:`${1.5*S}rem`,marginTop:`${1*S}rem`},children:[a.jsx("h3",{style:{fontSize:`${1.2*S}rem`,marginBottom:`${1*S}rem`,color:"#fff"},children:""}),o?a.jsxs("div",{children:[a.jsx("p",{style:{fontSize:`${.9*S}rem`,color:"#aaa",marginBottom:`${1*S}rem`},children:""}),a.jsxs("div",{style:{display:"flex",gap:10*S,marginBottom:`${1*S}rem`},children:[a.jsx("button",{onClick:u,style:{flex:1,padding:`${.6*S}rem ${1*S}rem`,fontSize:`${.9*S}rem`,background:"linear-gradient(135deg, #4a9eff 0%, #357abd 100%)",border:"none",borderRadius:6*S,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s"},onMouseEnter:D=>D.currentTarget.style.transform="scale(1.05)",onMouseLeave:D=>D.currentTarget.style.transform="scale(1)",children:""}),a.jsx("button",{onClick:h,style:{flex:1,padding:`${.6*S}rem ${1*S}rem`,fontSize:`${.9*S}rem`,background:"#555",border:"none",borderRadius:6*S,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s"},onMouseEnter:D=>D.currentTarget.style.background="#666",onMouseLeave:D=>D.currentTarget.style.background="#555",children:""})]}),a.jsx("p",{style:{fontSize:`${.75*S}rem`,color:"#888",textAlign:"center",lineHeight:1.4},children:""})]}):a.jsxs("div",{children:[a.jsx("p",{style:{fontSize:`${.9*S}rem`,color:"#4ade80",marginBottom:`${.5*S}rem`,fontWeight:"bold"},children:""}),a.jsxs("p",{style:{fontSize:`${.85*S}rem`,color:"#fff",marginBottom:`${.3*S}rem`},children:["ID: ",a.jsx("span",{style:{color:"#4a9eff",fontWeight:"bold"},children:l||""})]}),a.jsx("button",{onClick:fo,style:{width:"100%",padding:`${.6*S}rem ${1*S}rem`,fontSize:`${.9*S}rem`,background:"#d32f2f",border:"none",borderRadius:6*S,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s",marginTop:`${.5*S}rem`},onMouseEnter:D=>D.currentTarget.style.background="#b71c1c",onMouseLeave:D=>D.currentTarget.style.background="#d32f2f",children:""})]})]})]})]})]}),a.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:Math.max(70*S,44),background:"rgba(0, 0, 0, 0.8)",borderTop:"2px solid rgba(255, 255, 255, 0.1)",display:"flex",justifyContent:"center",alignItems:"center",gap:Math.max(.5*S,.25)+"rem",padding:`0 ${Math.max(1*S,.5)}rem`,zIndex:3},children:Ii.map(D=>a.jsx("button",{onClick:()=>Rc(D.id),style:{flex:1,maxWidth:Math.max(140*S,70),padding:`${Math.max(.6*S,.35)}rem ${Math.max(.5*S,.25)}rem`,fontSize:Math.max(.85*S,.55)+"rem",background:L===D.id?D.color:"transparent",border:L===D.id?"none":`2px solid ${D.color}`,borderRadius:Math.max(8*S,4),color:L===D.id?"white":D.color,cursor:"pointer",transition:"all 0.2s",fontWeight:L===D.id?"bold":"normal",minHeight:32},children:D.label},D.id))}),a.jsx("p",{style:{position:"absolute",bottom:75*S,right:20*S,opacity:.5,fontSize:`${.7*S}rem`,zIndex:2},children:"Ver 1.04 Beta"}),he&&a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0, 0, 0, 0.7)",zIndex:100},children:a.jsxs("div",{style:{background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",borderRadius:12*S,padding:`${2*S}rem`,minWidth:300*S,border:"2px solid rgba(255, 255, 255, 0.2)",boxShadow:"0 10px 30px rgba(0, 0, 0, 0.5)"},children:[a.jsx("h3",{style:{fontSize:`${1.2*S}rem`,marginBottom:`${1*S}rem`,color:"#fff",textAlign:"center"},children:""}),a.jsxs("div",{style:{display:"flex",gap:10*S,marginTop:`${1.5*S}rem`},children:[a.jsx("button",{onClick:Is,style:{flex:1,padding:`${.6*S}rem ${1*S}rem`,fontSize:`${.9*S}rem`,background:"#555",border:"none",borderRadius:6*S,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s"},onMouseEnter:D=>D.currentTarget.style.background="#666",onMouseLeave:D=>D.currentTarget.style.background="#555",children:""}),a.jsx("button",{onClick:wi,style:{flex:1,padding:`${.6*S}rem ${1*S}rem`,fontSize:`${.9*S}rem`,background:"#d32f2f",border:"none",borderRadius:6*S,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s"},onMouseEnter:D=>D.currentTarget.style.background="#b71c1c",onMouseLeave:D=>D.currentTarget.style.background="#d32f2f",children:""})]})]})}),te&&a.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"rgba(0, 0, 0, 0.85)",zIndex:200,padding:`${2*S}rem`},children:[a.jsx("h2",{style:{fontSize:`${2*S}rem`,marginBottom:`${2*S}rem`,color:"#fff"},children:""}),a.jsxs("div",{style:{display:"flex",gap:`${1.5*S}rem`,marginBottom:`${1*S}rem`},children:[a.jsxs("div",{onClick:()=>le("SENKA"),style:{width:200*S,borderRadius:12*S,overflow:"hidden",cursor:"pointer",border:"3px solid rgba(255, 255, 255, 0.3)",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:"0 4px 15px rgba(0, 0, 0, 0.5)",background:"linear-gradient(180deg, #2c0b0e 0%, #1a1a2e 100%)"},onMouseOver:D=>{D.currentTarget.style.transform="translateY(-10px) scale(1.05)",D.currentTarget.style.boxShadow="0 8px 25px rgba(255, 100, 100, 0.5)"},onMouseOut:D=>{D.currentTarget.style.transform="translateY(0) scale(1)",D.currentTarget.style.boxShadow="0 4px 15px rgba(0, 0, 0, 0.5)"},children:[a.jsx("img",{src:Nx,alt:"",style:{width:"100%",height:168*S,objectFit:"cover"}}),a.jsxs("div",{style:{padding:`${8*S}px`,textAlign:"center"},children:[a.jsx("h3",{style:{fontSize:`${1.4*S}rem`,color:"#e94560",margin:0},children:""}),a.jsx("p",{style:{color:"#aaa",margin:`${4*S}px 0`,fontSize:`${.75*S}rem`},children:" / "}),a.jsxs("p",{style:{fontSize:`${.65*S}rem`,opacity:.8,lineHeight:1.3,margin:0},children:["",a.jsx("br",{}),""]})]})]}),a.jsxs("div",{onClick:()=>le("AJA"),style:{width:200*S,borderRadius:12*S,overflow:"hidden",cursor:"pointer",border:"3px solid rgba(255, 255, 255, 0.3)",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:"0 4px 15px rgba(0, 0, 0, 0.5)",background:"linear-gradient(180deg, #0f1c2e 0%, #1a1a2e 100%)"},onMouseOver:D=>{D.currentTarget.style.transform="translateY(-10px) scale(1.05)",D.currentTarget.style.boxShadow="0 8px 25px rgba(100, 200, 255, 0.5)"},onMouseOut:D=>{D.currentTarget.style.transform="translateY(0) scale(1)",D.currentTarget.style.boxShadow="0 4px 15px rgba(0, 0, 0, 0.5)"},children:[a.jsx("img",{src:Dx,alt:"",style:{width:"100%",height:168*S,objectFit:"cover",objectPosition:"center top"}}),a.jsxs("div",{style:{padding:`${8*S}px`,textAlign:"center"},children:[a.jsx("h3",{style:{fontSize:`${1.4*S}rem`,color:"#45a2e9",margin:0},children:""}),a.jsx("p",{style:{color:"#aaa",margin:`${4*S}px 0`,fontSize:`${.75*S}rem`},children:" / "}),a.jsxs("p",{style:{fontSize:`${.65*S}rem`,opacity:.8,lineHeight:1.3,margin:0},children:["",a.jsx("br",{}),""]})]})]}),a.jsxs("div",{onClick:()=>le("YORUKA"),style:{width:200*S,borderRadius:12*S,overflow:"hidden",cursor:"pointer",border:"3px solid rgba(255, 255, 255, 0.3)",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:"0 4px 15px rgba(0, 0, 0, 0.5)",background:"linear-gradient(180deg, #1a0f2e 0%, #1a1a2e 100%)"},onMouseOver:D=>{D.currentTarget.style.transform="translateY(-10px) scale(1.05)",D.currentTarget.style.boxShadow="0 8px 25px rgba(200, 100, 255, 0.5)"},onMouseOut:D=>{D.currentTarget.style.transform="translateY(0) scale(1)",D.currentTarget.style.boxShadow="0 4px 15px rgba(0, 0, 0, 0.5)"},children:[a.jsx("img",{src:$x,alt:"Y",style:{width:"100%",height:168*S,objectFit:"cover"}}),a.jsxs("div",{style:{padding:`${8*S}px`,textAlign:"center"},children:[a.jsx("h3",{style:{fontSize:`${1.4*S}rem`,color:"#a855f7",margin:0},children:"Y"}),a.jsx("p",{style:{color:"#aaa",margin:`${4*S}px 0`,fontSize:`${.75*S}rem`},children:" / "}),a.jsxs("p",{style:{fontSize:`${.65*S}rem`,opacity:.8,lineHeight:1.3,margin:0},children:["",a.jsx("br",{}),""]})]})]})]}),J==="RANKED_MATCH"&&!Pe&&a.jsx("div",{style:{display:"flex",gap:`${1.5*S}rem`,marginBottom:`${2*S}rem`},children:["SENKA","AJA","YORUKA"].map(D=>{const ve=Ae[D],je=(ve==null?void 0:ve.rating)??0,ft=wn(je),bt=To[ft],vn=or[ft];return a.jsxs("div",{style:{width:200*S,textAlign:"center",color:"#fff"},children:[a.jsx("div",{style:{fontSize:`${1*S}rem`,color:bt,fontWeight:"bold"},children:vn}),a.jsx("div",{style:{fontSize:`${1.2*S}rem`,color:"#4ade80",fontWeight:"bold"},children:je})]},D)})}),a.jsx("button",{onClick:Ne,style:{padding:`${.8*S}rem ${2*S}rem`,fontSize:`${1*S}rem`,background:"transparent",border:"2px solid rgba(255, 255, 255, 0.3)",borderRadius:8*S,color:"white",cursor:"pointer",transition:"all 0.2s"},onMouseOver:D=>{D.currentTarget.style.background="rgba(255, 255, 255, 0.1)",D.currentTarget.style.borderColor="rgba(255, 255, 255, 0.5)"},onMouseOut:D=>{D.currentTarget.style.background="transparent",D.currentTarget.style.borderColor="rgba(255, 255, 255, 0.3)"},children:""})]})]})},gm=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},bL=gm("/leaders/azya_leader.png"),EL=gm("/leaders/senka_leader.png"),SL=gm("/leaders/yoRuka_leader.png"),wL=1280,IL=720,TL={BRONZE:"#cd7f32",SILVER:"#c0c0c0",GOLD:"#ffd700",PLATINUM:"#e5e4e2",DIAMOND:"#b9f2ff",MASTER:"#ff4500"},CL=({onSelectClass:t,onBack:e,gameMode:n="CPU",aiDifficulty:r="NORMAL",onDifficultyChange:s,playerName:i,onPlayerNameChange:o,timerEnabled:l=!0,onTimerEnabledChange:c,playerId:d})=>{const[u,h]=P.useState(1),[f,b]=P.useState({}),[C,k]=P.useState(!1);P.useEffect(()=>{const G=()=>{const de=window.innerWidth/wL,fe=window.innerHeight/IL;h(Math.min(de,fe))};return G(),window.addEventListener("resize",G),()=>window.removeEventListener("resize",G)},[]),P.useEffect(()=>{(async()=>{if(!d){k(!1);return}k(!0);try{const de=await kS(d);b(de)}catch(de){console.error("Failed to fetch class ratings:",de)}finally{k(!1)}})()},[d]);const A=200*u,R=280*u,m=2*u,T=1.4*u,L=.75*u,g=.65*u,H=1.2*u,Q=`${8*u}px ${16*u}px`,W=G=>{if(n!=="RANKED_MATCH"||!d||C)return null;const de=f[G];if(!de)return null;const fe=wn(de.rating),Ee=or[fe],ae=TL[fe];return a.jsxs("div",{style:{marginTop:`${4*u}px`,padding:`${4*u}px ${8*u}px`,background:"rgba(0, 0, 0, 0.3)",borderRadius:4*u,display:"flex",alignItems:"center",gap:`${6*u}px`},children:[a.jsx("span",{style:{fontSize:`${.7*u}rem`,fontWeight:"bold",color:ae,fontFamily:"Tamanegi, sans-serif"},children:Ee}),a.jsx("span",{style:{fontSize:`${.75*u}rem`,color:"#fff",fontFamily:"Tamanegi, sans-serif"},children:de.rating})]})};return a.jsxs("div",{className:"screen",style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"#1a1a2e",color:"white"},children:[a.jsx("h2",{style:{fontSize:`${m}rem`,marginBottom:`${.5*u}rem`,marginTop:0},children:""}),a.jsxs("div",{style:{marginBottom:`${.8*u}rem`,display:"flex",flexDirection:"column",alignItems:"center",gap:`${.3*u}rem`},children:[a.jsx("label",{style:{fontSize:`${.9*u}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif"},children:""}),a.jsx("input",{type:"text",value:i,onChange:G=>o(G.target.value),maxLength:12,placeholder:"",style:{padding:`${6*u}px ${12*u}px`,fontSize:`${.9*u}rem`,background:"#2d3748",border:"2px solid #4a5568",borderRadius:6*u,color:"white",outline:"none",width:180*u,textAlign:"center",fontFamily:"Tamanegi, sans-serif"},onFocus:G=>G.target.style.borderColor="#63b3ed",onBlur:G=>G.target.style.borderColor="#4a5568"})]}),a.jsxs("div",{style:{display:"flex",gap:`${H}rem`,marginBottom:`${1*u}rem`},children:[a.jsxs("div",{onClick:()=>t("SENKA"),style:{width:A,height:R,border:"1px solid #444",borderRadius:10*u,background:"linear-gradient(180deg, #2c0b0e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s",boxShadow:"0 4px 20px rgba(233, 69, 96, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:G=>G.currentTarget.style.transform="scale(1.05)",onMouseOut:G=>G.currentTarget.style.transform="scale(1)",children:[a.jsx("img",{src:EL,alt:"Senka",style:{width:"100%",height:"60%",objectFit:"cover"}}),a.jsxs("div",{style:{padding:`${6*u}px`,display:"flex",flexDirection:"column",alignItems:"center"},children:[a.jsx("h3",{style:{fontSize:`${T}rem`,color:"#e94560",margin:0},children:""}),a.jsx("p",{style:{color:"#aaa",margin:`${3*u}px 0`,fontSize:`${L}rem`,fontFamily:"Tamanegi, sans-serif"},children:" / "}),a.jsxs("p",{style:{padding:`0 ${.5*u}rem`,textAlign:"center",fontSize:`${g}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",lineHeight:1.3},children:["",a.jsx("br",{}),""]}),W("SENKA")]})]}),a.jsxs("div",{onClick:()=>t("AJA"),style:{width:A,height:R,border:"1px solid #444",borderRadius:10*u,background:"linear-gradient(180deg, #0f1c2e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s",boxShadow:"0 4px 20px rgba(69, 162, 233, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:G=>G.currentTarget.style.transform="scale(1.05)",onMouseOut:G=>G.currentTarget.style.transform="scale(1)",children:[a.jsx("img",{src:bL,alt:"Azya",style:{width:"100%",height:"60%",objectFit:"cover",objectPosition:"center top"}}),a.jsxs("div",{style:{padding:`${6*u}px`,display:"flex",flexDirection:"column",alignItems:"center"},children:[a.jsx("h3",{style:{fontSize:`${T}rem`,color:"#45a2e9",margin:0},children:""}),a.jsx("p",{style:{color:"#aaa",margin:`${3*u}px 0`,fontSize:`${L}rem`,fontFamily:"Tamanegi, sans-serif"},children:" / "}),a.jsxs("p",{style:{padding:`${.5*u}rem`,textAlign:"center",fontSize:`${g}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",lineHeight:1.3},children:["",a.jsx("br",{}),""]}),W("AJA")]})]}),a.jsxs("div",{onClick:()=>t("YORUKA"),style:{width:A,height:R,border:"1px solid #444",borderRadius:10*u,background:"linear-gradient(180deg, #1a0f2e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s",boxShadow:"0 4px 20px rgba(168, 85, 247, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:G=>G.currentTarget.style.transform="scale(1.05)",onMouseOut:G=>G.currentTarget.style.transform="scale(1)",children:[a.jsx("img",{src:SL,alt:"Yoruka",style:{width:"100%",height:"60%",objectFit:"cover"}}),a.jsxs("div",{style:{padding:`${6*u}px`,display:"flex",flexDirection:"column",alignItems:"center"},children:[a.jsx("h3",{style:{fontSize:`${T}rem`,color:"#a855f7",margin:0},children:"Y"}),a.jsx("p",{style:{color:"#aaa",margin:`${3*u}px 0`,fontSize:`${L}rem`,fontFamily:"Tamanegi, sans-serif"},children:" / "}),a.jsxs("p",{style:{padding:`0 ${.5*u}rem`,textAlign:"center",fontSize:`${g}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",lineHeight:1.3},children:["",a.jsx("br",{}),""]}),W("YORUKA")]})]})]}),n==="CPU"&&s&&a.jsxs("div",{style:{marginBottom:`${.6*u}rem`,display:"flex",flexDirection:"column",alignItems:"center",gap:`${.3*u}rem`},children:[a.jsx("p",{style:{fontSize:`${.85*u}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",margin:0},children:""}),a.jsx("div",{style:{display:"flex",gap:`${.6*u}rem`},children:["EASY","NORMAL","HARD"].map(G=>a.jsx("button",{onClick:()=>s(G),style:{padding:`${6*u}px ${14*u}px`,fontSize:`${.8*u}rem`,background:r===G?G==="EASY"?"#48bb78":G==="NORMAL"?"#e94560":"#9f7aea":"transparent",border:`2px solid ${G==="EASY"?"#48bb78":G==="NORMAL"?"#e94560":"#9f7aea"}`,color:"#fff",cursor:"pointer",borderRadius:4*u,fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s"},children:G==="EASY"?"":G==="NORMAL"?"":""},G))}),a.jsxs("p",{style:{fontSize:`${.65*u}rem`,opacity:.6,fontFamily:"Tamanegi, sans-serif",margin:0},children:[r==="EASY"&&"CPU",r==="NORMAL"&&"CPU",r==="HARD"&&"CPU"]})]}),c&&a.jsxs("div",{style:{marginBottom:`${.6*u}rem`,display:"flex",flexDirection:"column",alignItems:"center",gap:`${.3*u}rem`},children:[a.jsx("p",{style:{fontSize:`${.85*u}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",margin:0},children:""}),a.jsxs("div",{style:{display:"flex",gap:`${.6*u}rem`},children:[a.jsx("button",{onClick:()=>c(!0),style:{padding:`${6*u}px ${14*u}px`,fontSize:`${.8*u}rem`,background:l?"#3182ce":"transparent",border:"2px solid #3182ce",color:"#fff",cursor:"pointer",borderRadius:4*u,fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s"},children:"ON (60)"}),a.jsx("button",{onClick:()=>c(!1),style:{padding:`${6*u}px ${14*u}px`,fontSize:`${.8*u}rem`,background:l?"transparent":"#718096",border:"2px solid #718096",color:"#fff",cursor:"pointer",borderRadius:4*u,fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s"},children:"OFF"})]}),a.jsx("p",{style:{fontSize:`${.65*u}rem`,opacity:.6,fontFamily:"Tamanegi, sans-serif",margin:0},children:l?"600":""})]}),a.jsx("button",{onClick:e,style:{background:"#333",padding:Q,fontSize:`${.9*u}rem`,marginBottom:`${.5*u}rem`},children:""})]})};class kL{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(e){this.flush(),this._parts.push(e)}append(e){this._pieces.push(e)}flush(){if(this._pieces.length>0){const e=new Uint8Array(this._pieces);this._parts.push(e),this._pieces=[]}}toArrayBuffer(){const e=[];for(const n of this._parts)e.push(n);return RL(e).buffer}}function RL(t){let e=0;for(const s of t)e+=s.byteLength;const n=new Uint8Array(e);let r=0;for(const s of t){const i=new Uint8Array(s.buffer,s.byteOffset,s.byteLength);n.set(i,r),r+=s.byteLength}return n}function AS(t){return new AL(t).unpack()}function PS(t){const e=new PL,n=e.pack(t);return n instanceof Promise?n.then(()=>e.getBuffer()):e.getBuffer()}class AL{constructor(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){const e=this.unpack_uint8();if(e<128)return e;if((e^224)<32)return(e^224)-32;let n;if((n=e^160)<=15)return this.unpack_raw(n);if((n=e^176)<=15)return this.unpack_string(n);if((n=e^144)<=15)return this.unpack_array(n);if((n=e^128)<=15)return this.unpack_map(n);switch(e){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return n=this.unpack_uint16(),this.unpack_string(n);case 217:return n=this.unpack_uint32(),this.unpack_string(n);case 218:return n=this.unpack_uint16(),this.unpack_raw(n);case 219:return n=this.unpack_uint32(),this.unpack_raw(n);case 220:return n=this.unpack_uint16(),this.unpack_array(n);case 221:return n=this.unpack_uint32(),this.unpack_array(n);case 222:return n=this.unpack_uint16(),this.unpack_map(n);case 223:return n=this.unpack_uint32(),this.unpack_map(n)}}unpack_uint8(){const e=this.dataView[this.index]&255;return this.index++,e}unpack_uint16(){const e=this.read(2),n=(e[0]&255)*256+(e[1]&255);return this.index+=2,n}unpack_uint32(){const e=this.read(4),n=((e[0]*256+e[1])*256+e[2])*256+e[3];return this.index+=4,n}unpack_uint64(){const e=this.read(8),n=((((((e[0]*256+e[1])*256+e[2])*256+e[3])*256+e[4])*256+e[5])*256+e[6])*256+e[7];return this.index+=8,n}unpack_int8(){const e=this.unpack_uint8();return e<128?e:e-256}unpack_int16(){const e=this.unpack_uint16();return e<32768?e:e-65536}unpack_int32(){const e=this.unpack_uint32();return e<2**31?e:e-2**32}unpack_int64(){const e=this.unpack_uint64();return e<2**63?e:e-2**64}unpack_raw(e){if(this.length<this.index+e)throw new Error(`BinaryPackFailure: index is out of range ${this.index} ${e} ${this.length}`);const n=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,n}unpack_string(e){const n=this.read(e);let r=0,s="",i,o;for(;r<e;)i=n[r],i<160?(o=i,r++):(i^192)<32?(o=(i&31)<<6|n[r+1]&63,r+=2):(i^224)<16?(o=(i&15)<<12|(n[r+1]&63)<<6|n[r+2]&63,r+=3):(o=(i&7)<<18|(n[r+1]&63)<<12|(n[r+2]&63)<<6|n[r+3]&63,r+=4),s+=String.fromCodePoint(o);return this.index+=e,s}unpack_array(e){const n=new Array(e);for(let r=0;r<e;r++)n[r]=this.unpack();return n}unpack_map(e){const n={};for(let r=0;r<e;r++){const s=this.unpack();n[s]=this.unpack()}return n}unpack_float(){const e=this.unpack_uint32(),n=e>>31,r=(e>>23&255)-127,s=e&8388607|8388608;return(n===0?1:-1)*s*2**(r-23)}unpack_double(){const e=this.unpack_uint32(),n=this.unpack_uint32(),r=e>>31,s=(e>>20&2047)-1023,o=(e&1048575|1048576)*2**(s-20)+n*2**(s-52);return(r===0?1:-1)*o}read(e){const n=this.index;if(n+e<=this.length)return this.dataView.subarray(n,n+e);throw new Error("BinaryPackFailure: read index out of range")}}class PL{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(e){if(typeof e=="string")this.pack_string(e);else if(typeof e=="number")Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if(typeof e=="boolean")e===!0?this._bufferBuilder.append(195):e===!1&&this._bufferBuilder.append(194);else if(e===void 0)this._bufferBuilder.append(192);else if(typeof e=="object")if(e===null)this._bufferBuilder.append(192);else{const n=e.constructor;if(e instanceof Array){const r=this.pack_array(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else if(e instanceof ArrayBuffer)this.pack_bin(new Uint8Array(e));else if("BYTES_PER_ELEMENT"in e){const r=e;this.pack_bin(new Uint8Array(r.buffer,r.byteOffset,r.byteLength))}else if(e instanceof Date)this.pack_string(e.toString());else{if(e instanceof Blob)return e.arrayBuffer().then(r=>{this.pack_bin(new Uint8Array(r)),this._bufferBuilder.flush()});if(n==Object||n.toString().startsWith("class")){const r=this.pack_object(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else throw new Error(`Type "${n.toString()}" not yet supported`)}}else throw new Error(`Type "${typeof e}" not yet supported`);this._bufferBuilder.flush()}pack_bin(e){const n=e.length;if(n<=15)this.pack_uint8(160+n);else if(n<=65535)this._bufferBuilder.append(218),this.pack_uint16(n);else if(n<=4294967295)this._bufferBuilder.append(219),this.pack_uint32(n);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(e)}pack_string(e){const n=this._textEncoder.encode(e),r=n.length;if(r<=15)this.pack_uint8(176+r);else if(r<=65535)this._bufferBuilder.append(216),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(217),this.pack_uint32(r);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(n)}pack_array(e){const n=e.length;if(n<=15)this.pack_uint8(144+n);else if(n<=65535)this._bufferBuilder.append(220),this.pack_uint16(n);else if(n<=4294967295)this._bufferBuilder.append(221),this.pack_uint32(n);else throw new Error("Invalid length");const r=s=>{if(s<n){const i=this.pack(e[s]);return i instanceof Promise?i.then(()=>r(s+1)):r(s+1)}};return r(0)}pack_integer(e){if(e>=-32&&e<=127)this._bufferBuilder.append(e&255);else if(e>=0&&e<=255)this._bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&e<=127)this._bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&e<=65535)this._bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&e<=32767)this._bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&e<=4294967295)this._bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-2147483648&&e<=2147483647)this._bufferBuilder.append(210),this.pack_int32(e);else if(e>=-9223372036854776e3&&e<=9223372036854776e3)this._bufferBuilder.append(211),this.pack_int64(e);else if(e>=0&&e<=18446744073709552e3)this._bufferBuilder.append(207),this.pack_uint64(e);else throw new Error("Invalid integer")}pack_double(e){let n=0;e<0&&(n=1,e=-e);const r=Math.floor(Math.log(e)/Math.LN2),s=e/2**r-1,i=Math.floor(s*2**52),o=2**32,l=n<<31|r+1023<<20|i/o&1048575,c=i%o;this._bufferBuilder.append(203),this.pack_int32(l),this.pack_int32(c)}pack_object(e){const n=Object.keys(e),r=n.length;if(r<=15)this.pack_uint8(128+r);else if(r<=65535)this._bufferBuilder.append(222),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(223),this.pack_uint32(r);else throw new Error("Invalid length");const s=i=>{if(i<n.length){const o=n[i];if(e.hasOwnProperty(o)){this.pack(o);const l=this.pack(e[o]);if(l instanceof Promise)return l.then(()=>s(i+1))}return s(i+1)}};return s(0)}pack_uint8(e){this._bufferBuilder.append(e)}pack_uint16(e){this._bufferBuilder.append(e>>8),this._bufferBuilder.append(e&255)}pack_uint32(e){const n=e&4294967295;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255)}pack_uint64(e){const n=e/4294967296,r=e%2**32;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}pack_int8(e){this._bufferBuilder.append(e&255)}pack_int16(e){this._bufferBuilder.append((e&65280)>>8),this._bufferBuilder.append(e&255)}pack_int32(e){this._bufferBuilder.append(e>>>24&255),this._bufferBuilder.append((e&16711680)>>>16),this._bufferBuilder.append((e&65280)>>>8),this._bufferBuilder.append(e&255)}pack_int64(e){const n=Math.floor(e/4294967296),r=e%2**32;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}constructor(){this._bufferBuilder=new kL,this._textEncoder=new TextEncoder}}let OS=!0,LS=!0;function dl(t,e,n){const r=t.match(e);return r&&r.length>=n&&parseFloat(r[n],10)}function io(t,e,n){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,s=r.addEventListener;r.addEventListener=function(o,l){if(o!==e)return s.apply(this,arguments);const c=d=>{const u=n(d);u&&(l.handleEvent?l.handleEvent(u):l(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(l,c),s.apply(this,[o,c])};const i=r.removeEventListener;r.removeEventListener=function(o,l){if(o!==e||!this._eventMap||!this._eventMap[e])return i.apply(this,arguments);if(!this._eventMap[e].has(l))return i.apply(this,arguments);const c=this._eventMap[e].get(l);return this._eventMap[e].delete(l),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,i.apply(this,[o,c])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function OL(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(OS=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function LL(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(LS=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function MS(){if(typeof window=="object"){if(OS)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function mm(t,e){LS&&console.warn(t+" is deprecated, please use "+e+" instead.")}function ML(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const r=n.userAgentData.brands.find(s=>s.brand==="Chromium");if(r)return{browser:"chrome",version:parseInt(r.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(dl(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(dl(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(dl(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=dl(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function jx(t){return Object.prototype.toString.call(t)==="[object Object]"}function DS(t){return jx(t)?Object.keys(t).reduce(function(e,n){const r=jx(t[n]),s=r?DS(t[n]):t[n],i=r&&!Object.keys(s).length;return s===void 0||i?e:Object.assign(e,{[n]:s})},{}):t}function dg(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?dg(t,t.get(e[r]),n):r.endsWith("Ids")&&e[r].forEach(s=>{dg(t,t.get(s),n)})}))}function Fx(t,e,n){const r=n?"outbound-rtp":"inbound-rtp",s=new Map;if(e===null)return s;const i=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&i.push(o)}),i.forEach(o=>{t.forEach(l=>{l.type===r&&l.trackId===o.id&&dg(t,l,s)})}),s}const Ux=MS;function NS(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const r=function(l){if(typeof l!="object"||l.mandatory||l.optional)return l;const c={};return Object.keys(l).forEach(d=>{if(d==="require"||d==="advanced"||d==="mediaSource")return;const u=typeof l[d]=="object"?l[d]:{ideal:l[d]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const h=function(f,b){return f?f+b.charAt(0).toUpperCase()+b.slice(1):b==="deviceId"?"sourceId":b};if(u.ideal!==void 0){c.optional=c.optional||[];let f={};typeof u.ideal=="number"?(f[h("min",d)]=u.ideal,c.optional.push(f),f={},f[h("max",d)]=u.ideal,c.optional.push(f)):(f[h("",d)]=u.ideal,c.optional.push(f))}u.exact!==void 0&&typeof u.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[h("",d)]=u.exact):["min","max"].forEach(f=>{u[f]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[h(f,d)]=u[f])})}),l.advanced&&(c.optional=(c.optional||[]).concat(l.advanced)),c},s=function(l,c){if(e.version>=61)return c(l);if(l=JSON.parse(JSON.stringify(l)),l&&typeof l.audio=="object"){const d=function(u,h,f){h in u&&!(f in u)&&(u[f]=u[h],delete u[h])};l=JSON.parse(JSON.stringify(l)),d(l.audio,"autoGainControl","googAutoGainControl"),d(l.audio,"noiseSuppression","googNoiseSuppression"),l.audio=r(l.audio)}if(l&&typeof l.video=="object"){let d=l.video.facingMode;d=d&&(typeof d=="object"?d:{ideal:d});const u=e.version<66;if(d&&(d.exact==="user"||d.exact==="environment"||d.ideal==="user"||d.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete l.video.facingMode;let h;if(d.exact==="environment"||d.ideal==="environment"?h=["back","rear"]:(d.exact==="user"||d.ideal==="user")&&(h=["front"]),h)return n.mediaDevices.enumerateDevices().then(f=>{f=f.filter(C=>C.kind==="videoinput");let b=f.find(C=>h.some(k=>C.label.toLowerCase().includes(k)));return!b&&f.length&&h.includes("back")&&(b=f[f.length-1]),b&&(l.video.deviceId=d.exact?{exact:b.deviceId}:{ideal:b.deviceId}),l.video=r(l.video),Ux("chrome: "+JSON.stringify(l)),c(l)})}l.video=r(l.video)}return Ux("chrome: "+JSON.stringify(l)),c(l)},i=function(l){return e.version>=64?l:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[l.name]||l.name,message:l.message,constraint:l.constraint||l.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(l,c,d){s(l,u=>{n.webkitGetUserMedia(u,c,h=>{d&&d(i(h))})})};if(n.getUserMedia=o.bind(n),n.mediaDevices.getUserMedia){const l=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return s(c,d=>l(d).then(u=>{if(d.audio&&!u.getAudioTracks().length||d.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(h=>{h.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(i(u))))}}}function $S(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function jS(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",s=>{let i;t.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(l=>l.track&&l.track.id===s.track.id):i={track:s.track};const o=new Event("track");o.track=s.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[r.stream],this.dispatchEvent(o)}),r.stream.getTracks().forEach(s=>{let i;t.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(l=>l.track&&l.track.id===s.id):i={track:s};const o=new Event("track");o.track=s,o.receiver=i,o.transceiver={receiver:i},o.streams=[r.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else io(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function FS(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(s,i){return{track:i,get dtmf(){return this._dtmf===void 0&&(i.kind==="audio"?this._dtmf=s.createDTMFSender(i):this._dtmf=null),this._dtmf},_pc:s}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const s=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(l,c){let d=s.apply(this,arguments);return d||(d=e(this,l),this._senders.push(d)),d};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(l){i.apply(this,arguments);const c=this._senders.indexOf(l);c!==-1&&this._senders.splice(c,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],n.apply(this,[i]),i.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach(o=>{const l=this._senders.find(c=>c.track===o);l&&this._senders.splice(this._senders.indexOf(l),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function US(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=n.apply(this,[]);return i.forEach(o=>o._pc=this),i});const r=t.RTCPeerConnection.prototype.addTrack;r&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=r.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){const i=this;return this._pc.getStats().then(o=>Fx(o,i.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const s=n.apply(this,[]);return s.forEach(i=>i._pc=this),s}),io(t,"track",r=>(r.receiver._pc=r.srcElement,r)),t.RTCRtpReceiver.prototype.getStats=function(){const s=this;return this._pc.getStats().then(i=>Fx(i,s.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const r=arguments[0];let s,i,o;return this.getSenders().forEach(l=>{l.track===r&&(s?o=!0:s=l)}),this.getReceivers().forEach(l=>(l.track===r&&(i?o=!0:i=l),l.track===r)),o||s&&i?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function BS(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,l){if(!l)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[l.id]?this._shimmedLocalStreams[l.id].indexOf(c)===-1&&this._shimmedLocalStreams[l.id].push(c):this._shimmedLocalStreams[l.id]=[l,c],c};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(d=>{if(this.getSenders().find(h=>h.track===d))throw new DOMException("Track already exists.","InvalidAccessError")});const l=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(d=>l.indexOf(d)===-1);this._shimmedLocalStreams[o.id]=[o].concat(c)};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],r.apply(this,arguments)};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(l=>{const c=this._shimmedLocalStreams[l].indexOf(o);c!==-1&&this._shimmedLocalStreams[l].splice(c,1),this._shimmedLocalStreams[l].length===1&&delete this._shimmedLocalStreams[l]}),s.apply(this,arguments)}}function zS(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return BS(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const u=n.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(h=>this._reverseStreams[h.id])};const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(h=>{if(this.getSenders().find(b=>b.track===h))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const h=new t.MediaStream(u.getTracks());this._streams[u.id]=h,this._reverseStreams[h.id]=u,u=h}r.apply(this,[u])};const s=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},t.RTCPeerConnection.prototype.addTrack=function(u,h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const f=[].slice.call(arguments,1);if(f.length!==1||!f[0].getTracks().find(k=>k===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(k=>k.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const C=this._streams[h.id];if(C)C.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const k=new t.MediaStream([u]);this._streams[h.id]=k,this._reverseStreams[k.id]=h,this.addStream(k)}return this.getSenders().find(k=>k.track===u)};function i(d,u){let h=u.sdp;return Object.keys(d._reverseStreams||[]).forEach(f=>{const b=d._reverseStreams[f],C=d._streams[b.id];h=h.replace(new RegExp(C.id,"g"),b.id)}),new RTCSessionDescription({type:u.type,sdp:h})}function o(d,u){let h=u.sdp;return Object.keys(d._reverseStreams||[]).forEach(f=>{const b=d._reverseStreams[f],C=d._streams[b.id];h=h.replace(new RegExp(b.id,"g"),C.id)}),new RTCSessionDescription({type:u.type,sdp:h})}["createOffer","createAnswer"].forEach(function(d){const u=t.RTCPeerConnection.prototype[d],h={[d](){const f=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[C=>{const k=i(this,C);f[0].apply(null,[k])},C=>{f[1]&&f[1].apply(null,C)},arguments[2]]):u.apply(this,arguments).then(C=>i(this,C))}};t.RTCPeerConnection.prototype[d]=h[d]});const l=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?l.apply(this,arguments):(arguments[0]=o(this,arguments[0]),l.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const d=c.get.apply(this);return d.type===""?d:i(this,d)}}),t.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let f;Object.keys(this._streams).forEach(b=>{this._streams[b].getTracks().find(k=>u.track===k)&&(f=this._streams[b])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function ug(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=t.RTCPeerConnection.prototype[n],s={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=s[n]})}function HS(t,e){io(t,"negotiationneeded",n=>{const r=n.target;if(!((e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return n})}const Bx=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:HS,shimAddTrackRemoveTrack:zS,shimAddTrackRemoveTrackWithNative:BS,shimGetSendersWithDtmf:FS,shimGetUserMedia:NS,shimMediaStream:$S,shimOnTrack:jS,shimPeerConnection:ug,shimSenderReceiverGetStats:US},Symbol.toStringTag,{value:"Module"}));function WS(t,e){const n=t&&t.navigator,r=t&&t.MediaStreamTrack;if(n.getUserMedia=function(s,i,o){mm("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(s).then(i,o)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const s=function(o,l,c){l in o&&!(c in o)&&(o[c]=o[l],delete o[l])},i=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),s(o.audio,"autoGainControl","mozAutoGainControl"),s(o.audio,"noiseSuppression","mozNoiseSuppression")),i(o)},r&&r.prototype.getSettings){const o=r.prototype.getSettings;r.prototype.getSettings=function(){const l=o.apply(this,arguments);return s(l,"mozAutoGainControl","autoGainControl"),s(l,"mozNoiseSuppression","noiseSuppression"),l}}if(r&&r.prototype.applyConstraints){const o=r.prototype.applyConstraints;r.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),s(l,"autoGainControl","mozAutoGainControl"),s(l,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[l])}}}}function DL(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,Promise.reject(s)}return r.video===!0?r.video={mediaSource:e}:r.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(r)})}function GS(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function fg(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const i=t.RTCPeerConnection.prototype[s],o={[s](){return arguments[0]=new(s==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[s]=o[s]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[i,o,l]=arguments;return r.apply(this,[i||null]).then(c=>{if(e.version<53&&!o)try{c.forEach(d=>{d.type=n[d.type]||d.type})}catch(d){if(d.name!=="TypeError")throw d;c.forEach((u,h)=>{c.set(h,Object.assign({},u,{type:n[u.type]||u.type}))})}return c}).then(o,l)}}function VS(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=e.apply(this,[]);return s.forEach(i=>i._pc=this),s});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=n.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function YS(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r}),io(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function KS(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){mm("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&n.getTracks().includes(r.track)&&this.removeTrack(r)})})}function XS(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function JS(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const s=r.length>0;s&&r.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=e.apply(this,arguments);if(s){const{sender:o}=i,l=o.getParameters();(!("encodings"in l)||l.encodings.length===1&&Object.keys(l.encodings[0]).length===0)&&(l.encodings=r,o.sendEncodings=r,this.setParametersPromises.push(o.setParameters(l).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return i})}function QS(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const r=e.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function qS(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function ZS(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}const zx=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:JS,shimCreateAnswer:ZS,shimCreateOffer:qS,shimGetDisplayMedia:DL,shimGetParameters:QS,shimGetUserMedia:WS,shimOnTrack:GS,shimPeerConnection:fg,shimRTCDataChannel:XS,shimReceiverGetStats:YS,shimRemoveStream:KS,shimSenderGetStats:VS},Symbol.toStringTag,{value:"Module"}));function e2(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(s=>e.call(this,s,r)),r.getVideoTracks().forEach(s=>e.call(this,s,r))},t.RTCPeerConnection.prototype.addTrack=function(r,...s){return s&&s.forEach(i=>{this._localStreams?this._localStreams.includes(i)||this._localStreams.push(i):this._localStreams=[i]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(n);if(r===-1)return;this._localStreams.splice(r,1);const s=n.getTracks();this.getSenders().forEach(i=>{s.includes(i.track)&&this.removeTrack(i)})})}}function t2(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(s=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(s))return;this._remoteStreams.push(s);const i=new Event("addstream");i.stream=s,this.dispatchEvent(i)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){s.streams.forEach(i=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(i)>=0)return;r._remoteStreams.push(i);const o=new Event("addstream");o.stream=i,r.dispatchEvent(o)})}),e.apply(r,arguments)}}}function n2(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,r=e.createAnswer,s=e.setLocalDescription,i=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(d,u){const h=arguments.length>=2?arguments[2]:arguments[0],f=n.apply(this,[h]);return u?(f.then(d,u),Promise.resolve()):f},e.createAnswer=function(d,u){const h=arguments.length>=2?arguments[2]:arguments[0],f=r.apply(this,[h]);return u?(f.then(d,u),Promise.resolve()):f};let l=function(c,d,u){const h=s.apply(this,[c]);return u?(h.then(d,u),Promise.resolve()):h};e.setLocalDescription=l,l=function(c,d,u){const h=i.apply(this,[c]);return u?(h.then(d,u),Promise.resolve()):h},e.setRemoteDescription=l,l=function(c,d,u){const h=o.apply(this,[c]);return u?(h.then(d,u),Promise.resolve()):h},e.addIceCandidate=l}function r2(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,r=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=s=>r(s2(s))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(r,s,i){e.mediaDevices.getUserMedia(r).then(s,i)}).bind(e))}function s2(t){return t&&t.video!==void 0?Object.assign({},t,{video:DS(t.video)}):t}function i2(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(r,s){if(r&&r.iceServers){const i=[];for(let o=0;o<r.iceServers.length;o++){let l=r.iceServers[o];l.urls===void 0&&l.url?(mm("RTCIceServer.url","RTCIceServer.urls"),l=JSON.parse(JSON.stringify(l)),l.urls=l.url,delete l.url,i.push(l)):i.push(r.iceServers[o])}r.iceServers=i}return new e(r,s)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function o2(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function a2(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):r.offerToReceiveAudio===!0&&!s&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const i=this.getTransceivers().find(o=>o.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveVideo===!0&&!i&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function l2(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}const Hx=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:l2,shimCallbacksAPI:n2,shimConstraints:s2,shimCreateOfferLegacy:a2,shimGetUserMedia:r2,shimLocalStreamsAPI:e2,shimRTCIceServerUrls:i2,shimRemoteStreamsAPI:t2,shimTrackEventTransceiver:o2},Symbol.toStringTag,{value:"Module"}));var c2={exports:{}};(function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},e.splitSections=function(n){return n.split(`
m=`).map((s,i)=>(i>0?"m="+s:s).trim()+`\r
`)},e.getDescription=function(n){const r=e.splitSections(n);return r&&r[0]},e.getMediaSections=function(n){const r=e.splitSections(n);return r.shift(),r},e.matchPrefix=function(n,r){return e.splitLines(n).filter(s=>s.indexOf(r)===0)},e.parseCandidate=function(n){let r;n.indexOf("a=candidate:")===0?r=n.substring(12).split(" "):r=n.substring(10).split(" ");const s={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let i=8;i<r.length;i+=2)switch(r[i]){case"raddr":s.relatedAddress=r[i+1];break;case"rport":s.relatedPort=parseInt(r[i+1],10);break;case"tcptype":s.tcpType=r[i+1];break;case"ufrag":s.ufrag=r[i+1],s.usernameFragment=r[i+1];break;default:s[r[i]]===void 0&&(s[r[i]]=r[i+1]);break}return s},e.writeCandidate=function(n){const r=[];r.push(n.foundation);const s=n.component;s==="rtp"?r.push(1):s==="rtcp"?r.push(2):r.push(s),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const i=n.type;return r.push("typ"),r.push(i),i!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let r=n.substring(9).split(" ");const s={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),s.name=r[0],s.clockRate=parseInt(r[1],10),s.channels=r.length===3?parseInt(r[2],10):1,s.numChannels=s.channels,s},e.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const s=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(s!==1?"/"+s:"")+`\r
`},e.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const r={};let s;const i=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<i.length;o++)s=i[o].trim().split("="),r[s[0].trim()]=s[1];return r},e.writeFmtp=function(n){let r="",s=n.payloadType;if(n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const i=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?i.push(o+"="+n.parameters[o]):i.push(o)}),r+="a=fmtp:"+s+" "+i.join(";")+`\r
`}return r},e.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},e.writeRtcpFb=function(n){let r="",s=n.payloadType;return n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(i=>{r+="a=rtcp-fb:"+s+" "+i.type+(i.parameter&&i.parameter.length?" "+i.parameter:"")+`\r
`}),r},e.parseSsrcMedia=function(n){const r=n.indexOf(" "),s={ssrc:parseInt(n.substring(7,r),10)},i=n.indexOf(":",r);return i>-1?(s.attribute=n.substring(r+1,i),s.value=n.substring(i+1)):s.attribute=n.substring(r+1),s},e.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(s=>parseInt(s,10))}},e.getMid=function(n){const r=e.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},e.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:e.matchPrefix(n+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,r){let s="a=setup:"+r+`\r
`;return n.fingerprints.forEach(i=>{s+="a=fingerprint:"+i.algorithm+" "+i.value+`\r
`}),s},e.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,r){return e.matchPrefix(n+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,r){const s=e.matchPrefix(n+r,"a=ice-ufrag:")[0],i=e.matchPrefix(n+r,"a=ice-pwd:")[0];return s&&i?{usernameFragment:s.substring(12),password:i.substring(10)}:null},e.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},e.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=e.splitLines(n)[0].split(" ");r.profile=i[2];for(let l=3;l<i.length;l++){const c=i[l],d=e.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(d){const u=e.parseRtpMap(d),h=e.matchPrefix(n,"a=fmtp:"+c+" ");switch(u.parameters=h.length?e.parseFmtp(h[0]):{},u.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),r.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(l=>{r.headerExtensions.push(e.parseExtmap(l))});const o=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(l=>{o.forEach(c=>{l.rtcpFeedback.find(u=>u.type===c.type&&u.parameter===c.parameter)||l.rtcpFeedback.push(c)})}),r},e.writeRtpDescription=function(n,r){let s="";s+="m="+n+" ",s+=r.codecs.length>0?"9":"0",s+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",s+=r.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,s+=`c=IN IP4 0.0.0.0\r
`,s+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(o=>{s+=e.writeRtpMap(o),s+=e.writeFmtp(o),s+=e.writeRtcpFb(o)});let i=0;return r.codecs.forEach(o=>{o.maxptime>i&&(i=o.maxptime)}),i>0&&(s+="a=maxptime:"+i+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(o=>{s+=e.writeExtmap(o)}),s},e.parseRtpEncodingParameters=function(n){const r=[],s=e.parseRtpParameters(n),i=s.fecMechanisms.indexOf("RED")!==-1,o=s.fecMechanisms.indexOf("ULPFEC")!==-1,l=e.matchPrefix(n,"a=ssrc:").map(f=>e.parseSsrcMedia(f)).filter(f=>f.attribute==="cname"),c=l.length>0&&l[0].ssrc;let d;const u=e.matchPrefix(n,"a=ssrc-group:FID").map(f=>f.substring(17).split(" ").map(C=>parseInt(C,10)));u.length>0&&u[0].length>1&&u[0][0]===c&&(d=u[0][1]),s.codecs.forEach(f=>{if(f.name.toUpperCase()==="RTX"&&f.parameters.apt){let b={ssrc:c,codecPayloadType:parseInt(f.parameters.apt,10)};c&&d&&(b.rtx={ssrc:d}),r.push(b),i&&(b=JSON.parse(JSON.stringify(b)),b.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},r.push(b))}}),r.length===0&&c&&r.push({ssrc:c});let h=e.matchPrefix(n,"b=");return h.length&&(h[0].indexOf("b=TIAS:")===0?h=parseInt(h[0].substring(7),10):h[0].indexOf("b=AS:")===0?h=parseInt(h[0].substring(5),10)*1e3*.95-50*40*8:h=void 0,r.forEach(f=>{f.maxBitrate=h})),r},e.parseRtcpParameters=function(n){const r={},s=e.matchPrefix(n,"a=ssrc:").map(l=>e.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];s&&(r.cname=s.value,r.ssrc=s.ssrc);const i=e.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=i.length>0,r.compound=i.length===0;const o=e.matchPrefix(n,"a=rtcp-mux");return r.mux=o.length>0,r},e.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},e.parseMsid=function(n){let r;const s=e.matchPrefix(n,"a=msid:");if(s.length===1)return r=s[0].substring(7).split(" "),{stream:r[0],track:r[1]};const i=e.matchPrefix(n,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(i.length>0)return r=i[0].value.split(" "),{stream:r[0],track:r[1]}},e.parseSctpDescription=function(n){const r=e.parseMLine(n),s=e.matchPrefix(n,"a=max-message-size:");let i;s.length>0&&(i=parseInt(s[0].substring(19),10)),isNaN(i)&&(i=65536);const o=e.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:r.fmt,maxMessageSize:i};const l=e.matchPrefix(n,"a=sctpmap:");if(l.length>0){const c=l[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:i}}},e.writeSctpDescription=function(n,r){let s=[];return n.protocol!=="DTLS/SCTP"?s=["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:s=["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&s.push("a=max-message-size:"+r.maxMessageSize+`\r
`),s.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,r,s){let i;const o=r!==void 0?r:2;return n?i=n:i=e.generateSessionId(),`v=0\r
o=`+(s||"thisisadapterortc")+" "+i+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,r){const s=e.splitLines(n);for(let i=0;i<s.length;i++)switch(s[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[i].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const s=e.splitLines(n)[0].substring(2).split(" ");return{kind:s[0],port:parseInt(s[1],10),protocol:s[2],fmt:s.slice(3).join(" ")}},e.parseOLine=function(n){const s=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:s[0],sessionId:s[1],sessionVersion:parseInt(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=e.splitLines(n);for(let s=0;s<r.length;s++)if(r[s].length<2||r[s].charAt(1)!=="=")return!1;return!0},t.exports=e})(c2);var d2=c2.exports;const ea=s1(d2),NL=K2({__proto__:null,default:ea},[d2]);function Bd(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const s=new e(r),i=ea.parseCandidate(r.candidate);for(const o in i)o in s||Object.defineProperty(s,o,{value:i[o]});return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new e(r)},t.RTCIceCandidate.prototype=e.prototype,io(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function hg(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||io(t,"icecandidate",e=>{if(e.candidate){const n=ea.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function zd(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(l){if(!l||!l.sdp)return!1;const c=ea.splitSections(l.sdp);return c.shift(),c.some(d=>{const u=ea.parseMLine(d);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},r=function(l){const c=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const d=parseInt(c[1],10);return d!==d?-1:d},s=function(l){let c=65536;return e.browser==="firefox"&&(e.version<57?l===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},i=function(l,c){let d=65536;e.browser==="firefox"&&e.version===57&&(d=65535);const u=ea.matchPrefix(l.sdp,"a=max-message-size:");return u.length>0?d=parseInt(u[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(d=2147483637),d},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=r(arguments[0]),d=s(c),u=i(arguments[0],c);let h;d===0&&u===0?h=Number.POSITIVE_INFINITY:d===0||u===0?h=Math.max(d,u):h=Math.min(d,u);const f={};Object.defineProperty(f,"maxMessageSize",{get(){return h}}),this._sctp=f}return o.apply(this,arguments)}}function Hd(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(r,s){const i=r.send;r.send=function(){const l=arguments[0],c=l.length||l.size||l.byteLength;if(r.readyState==="open"&&s.sctp&&c>s.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+s.sctp.maxMessageSize+" bytes)");return i.apply(r,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const s=n.apply(this,arguments);return e(s,this),s},io(t,"datachannel",r=>(e(r.channel,r.target),r))}function pg(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=s=>{const i=s.target;if(i._lastConnectionState!==i.connectionState){i._lastConnectionState=i.connectionState;const o=new Event("connectionstatechange",s);i.dispatchEvent(o)}return s},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function gg(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(s){if(s&&s.sdp&&s.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i=s.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&s instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:s.type,sdp:i}):s.sdp=i}return n.apply(this,arguments)}}function Wd(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Gd(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let s=arguments[0]||{};if(typeof s!="object"||s.type&&s.sdp)return n.apply(this,arguments);if(s={type:s.type,sdp:s.sdp},!s.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":s.type="offer";break;default:s.type="answer";break}return s.sdp||s.type!=="offer"&&s.type!=="answer"?n.apply(this,[s]):(s.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}const $L=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:gg,shimAddIceCandidateNullOrEmpty:Wd,shimConnectionState:pg,shimMaxMessageSize:zd,shimParameterlessSetLocalDescription:Gd,shimRTCIceCandidate:Bd,shimRTCIceCandidateRelayProtocol:hg,shimSendThrowTypeError:Hd},Symbol.toStringTag,{value:"Module"}));function jL({window:t}={},e={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const n=MS,r=ML(t),s={browserDetails:r,commonShim:$L,extractVersion:dl,disableLog:OL,disableWarnings:LL,sdp:NL};switch(r.browser){case"chrome":if(!Bx||!ug||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),s;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),s;n("adapter.js shimming chrome."),s.browserShim=Bx,Wd(t,r),Gd(t),NS(t,r),$S(t),ug(t,r),jS(t),zS(t,r),FS(t),US(t),HS(t,r),Bd(t),hg(t),pg(t),zd(t,r),Hd(t),gg(t,r);break;case"firefox":if(!zx||!fg||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),s;n("adapter.js shimming firefox."),s.browserShim=zx,Wd(t,r),Gd(t),WS(t,r),fg(t,r),GS(t),KS(t),VS(t),YS(t),XS(t),JS(t),QS(t),qS(t),ZS(t),Bd(t),pg(t),zd(t,r),Hd(t);break;case"safari":if(!Hx||!e.shimSafari)return n("Safari shim is not included in this adapter release."),s;n("adapter.js shimming safari."),s.browserShim=Hx,Wd(t,r),Gd(t),i2(t),a2(t),n2(t),e2(t),t2(t),o2(t),r2(t),l2(t),Bd(t),hg(t),zd(t,r),Hd(t),gg(t,r);break;default:n("Unsupported browser!");break}return s}const Wx=jL({window:typeof window>"u"?void 0:window});function oo(t,e,n,r){Object.defineProperty(t,e,{get:n,set:r,enumerable:!0,configurable:!0})}class u2{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=e=>{const n=[],r=e.byteLength,s=Math.ceil(r/this.chunkedMTU);let i=0,o=0;for(;o<r;){const l=Math.min(r,o+this.chunkedMTU),c=e.slice(o,l),d={__peerData:this._dataCount,n:i,data:c,total:s};n.push(d),o=l,i++}return this._dataCount++,n}}}function FL(t){let e=0;for(const s of t)e+=s.byteLength;const n=new Uint8Array(e);let r=0;for(const s of t)n.set(s,r),r+=s.byteLength;return n}const Wh=Wx.default||Wx,nl=new class{isWebRTCSupported(){return typeof RTCPeerConnection<"u"}isBrowserSupported(){const t=this.getBrowser(),e=this.getVersion();return this.supportedBrowsers.includes(t)?t==="chrome"?e>=this.minChromeVersion:t==="firefox"?e>=this.minFirefoxVersion:t==="safari"?!this.isIOS&&e>=this.minSafariVersion:!1:!1}getBrowser(){return Wh.browserDetails.browser}getVersion(){return Wh.browserDetails.version||0}isUnifiedPlanSupported(){const t=this.getBrowser(),e=Wh.browserDetails.version||0;if(t==="chrome"&&e<this.minChromeVersion)return!1;if(t==="firefox"&&e>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let n,r=!1;try{n=new RTCPeerConnection,n.addTransceiver("audio"),r=!0}catch{}finally{n&&n.close()}return r}toString(){return`Supports:
    browser:${this.getBrowser()}
    version:${this.getVersion()}
    isIOS:${this.isIOS}
    isWebRTCSupported:${this.isWebRTCSupported()}
    isBrowserSupported:${this.isBrowserSupported()}
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS=typeof navigator<"u"?["iPad","iPhone","iPod"].includes(navigator.platform):!1,this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},UL=t=>!t||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(t),f2=()=>Math.random().toString(36).slice(2),Gx={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};class BL extends u2{noop(){}blobToArrayBuffer(e,n){const r=new FileReader;return r.onload=function(s){s.target&&n(s.target.result)},r.readAsArrayBuffer(e),r}binaryStringToArrayBuffer(e){const n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r)&255;return n.buffer}isSecure(){return location.protocol==="https:"}constructor(...e){super(...e),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=Gx,this.browser=nl.getBrowser(),this.browserVersion=nl.getVersion(),this.pack=PS,this.unpack=AS,this.supports=function(){const n={browser:nl.isBrowserSupported(),webRTC:nl.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!n.webRTC)return n;let r;try{r=new RTCPeerConnection(Gx),n.audioVideo=!0;let s;try{s=r.createDataChannel("_PEERJSTEST",{ordered:!0}),n.data=!0,n.reliable=!!s.ordered;try{s.binaryType="blob",n.binaryBlob=!nl.isIOS}catch{}}catch{}finally{s&&s.close()}}catch{}finally{r&&r.close()}return n}(),this.validateId=UL,this.randomToken=f2}}const Vn=new BL,zL="PeerJS: ";class HL{get logLevel(){return this._logLevel}set logLevel(e){this._logLevel=e}log(...e){this._logLevel>=3&&this._print(3,...e)}warn(...e){this._logLevel>=2&&this._print(2,...e)}error(...e){this._logLevel>=1&&this._print(1,...e)}setLogFunction(e){this._print=e}_print(e,...n){const r=[zL,...n];for(const s in r)r[s]instanceof Error&&(r[s]="("+r[s].name+") "+r[s].message);e>=3?console.log(...r):e>=2?console.warn("WARNING",...r):e>=1&&console.error("ERROR",...r)}constructor(){this._logLevel=0}}var Le=new HL,ym={},WL=Object.prototype.hasOwnProperty,zn="~";function lc(){}Object.create&&(lc.prototype=Object.create(null),new lc().__proto__||(zn=!1));function GL(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function h2(t,e,n,r,s){if(typeof n!="function")throw new TypeError("The listener must be a function");var i=new GL(n,r||t,s),o=zn?zn+e:e;return t._events[o]?t._events[o].fn?t._events[o]=[t._events[o],i]:t._events[o].push(i):(t._events[o]=i,t._eventsCount++),t}function Vd(t,e){--t._eventsCount===0?t._events=new lc:delete t._events[e]}function Mn(){this._events=new lc,this._eventsCount=0}Mn.prototype.eventNames=function(){var e=[],n,r;if(this._eventsCount===0)return e;for(r in n=this._events)WL.call(n,r)&&e.push(zn?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(n)):e};Mn.prototype.listeners=function(e){var n=zn?zn+e:e,r=this._events[n];if(!r)return[];if(r.fn)return[r.fn];for(var s=0,i=r.length,o=new Array(i);s<i;s++)o[s]=r[s].fn;return o};Mn.prototype.listenerCount=function(e){var n=zn?zn+e:e,r=this._events[n];return r?r.fn?1:r.length:0};Mn.prototype.emit=function(e,n,r,s,i,o){var l=zn?zn+e:e;if(!this._events[l])return!1;var c=this._events[l],d=arguments.length,u,h;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,n),!0;case 3:return c.fn.call(c.context,n,r),!0;case 4:return c.fn.call(c.context,n,r,s),!0;case 5:return c.fn.call(c.context,n,r,s,i),!0;case 6:return c.fn.call(c.context,n,r,s,i,o),!0}for(h=1,u=new Array(d-1);h<d;h++)u[h-1]=arguments[h];c.fn.apply(c.context,u)}else{var f=c.length,b;for(h=0;h<f;h++)switch(c[h].once&&this.removeListener(e,c[h].fn,void 0,!0),d){case 1:c[h].fn.call(c[h].context);break;case 2:c[h].fn.call(c[h].context,n);break;case 3:c[h].fn.call(c[h].context,n,r);break;case 4:c[h].fn.call(c[h].context,n,r,s);break;default:if(!u)for(b=1,u=new Array(d-1);b<d;b++)u[b-1]=arguments[b];c[h].fn.apply(c[h].context,u)}}return!0};Mn.prototype.on=function(e,n,r){return h2(this,e,n,r,!1)};Mn.prototype.once=function(e,n,r){return h2(this,e,n,r,!0)};Mn.prototype.removeListener=function(e,n,r,s){var i=zn?zn+e:e;if(!this._events[i])return this;if(!n)return Vd(this,i),this;var o=this._events[i];if(o.fn)o.fn===n&&(!s||o.once)&&(!r||o.context===r)&&Vd(this,i);else{for(var l=0,c=[],d=o.length;l<d;l++)(o[l].fn!==n||s&&!o[l].once||r&&o[l].context!==r)&&c.push(o[l]);c.length?this._events[i]=c.length===1?c[0]:c:Vd(this,i)}return this};Mn.prototype.removeAllListeners=function(e){var n;return e?(n=zn?zn+e:e,this._events[n]&&Vd(this,n)):(this._events=new lc,this._eventsCount=0),this};Mn.prototype.off=Mn.prototype.removeListener;Mn.prototype.addListener=Mn.prototype.on;Mn.prefixed=zn;Mn.EventEmitter=Mn;ym=Mn;var ao={};oo(ao,"ConnectionType",()=>ci);oo(ao,"PeerErrorType",()=>rn);oo(ao,"BaseConnectionErrorType",()=>mg);oo(ao,"DataConnectionErrorType",()=>vm);oo(ao,"SerializationType",()=>Tf);oo(ao,"SocketEventType",()=>Xs);oo(ao,"ServerMessageType",()=>Pn);var ci=function(t){return t.Data="data",t.Media="media",t}({}),rn=function(t){return t.BrowserIncompatible="browser-incompatible",t.Disconnected="disconnected",t.InvalidID="invalid-id",t.InvalidKey="invalid-key",t.Network="network",t.PeerUnavailable="peer-unavailable",t.SslUnavailable="ssl-unavailable",t.ServerError="server-error",t.SocketError="socket-error",t.SocketClosed="socket-closed",t.UnavailableID="unavailable-id",t.WebRTC="webrtc",t}({}),mg=function(t){return t.NegotiationFailed="negotiation-failed",t.ConnectionClosed="connection-closed",t}({}),vm=function(t){return t.NotOpenYet="not-open-yet",t.MessageToBig="message-too-big",t}({}),Tf=function(t){return t.Binary="binary",t.BinaryUTF8="binary-utf8",t.JSON="json",t.None="raw",t}({}),Xs=function(t){return t.Message="message",t.Disconnected="disconnected",t.Error="error",t.Close="close",t}({}),Pn=function(t){return t.Heartbeat="HEARTBEAT",t.Candidate="CANDIDATE",t.Offer="OFFER",t.Answer="ANSWER",t.Open="OPEN",t.Error="ERROR",t.IdTaken="ID-TAKEN",t.InvalidKey="INVALID-KEY",t.Leave="LEAVE",t.Expire="EXPIRE",t}({});const p2="1.5.5";class VL extends ym.EventEmitter{constructor(e,n,r,s,i,o=5e3){super(),this.pingInterval=o,this._disconnected=!0,this._messagesQueue=[];const l=e?"wss://":"ws://";this._baseUrl=l+n+":"+r+s+"peerjs?key="+i}start(e,n){this._id=e;const r=`${this._baseUrl}&id=${e}&token=${n}`;this._socket||!this._disconnected||(this._socket=new WebSocket(r+"&version="+p2),this._disconnected=!1,this._socket.onmessage=s=>{let i;try{i=JSON.parse(s.data),Le.log("Server message received:",i)}catch{Le.log("Invalid server message",s.data);return}this.emit(Xs.Message,i)},this._socket.onclose=s=>{this._disconnected||(Le.log("Socket closed.",s),this._cleanup(),this._disconnected=!0,this.emit(Xs.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),Le.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen()){Le.log("Cannot send heartbeat, because socket closed");return}const e=JSON.stringify({type:Pn.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&this._socket.readyState===1}_sendQueuedMessages(){const e=[...this._messagesQueue];this._messagesQueue=[];for(const n of e)this.send(n)}send(e){if(this._disconnected)return;if(!this._id){this._messagesQueue.push(e);return}if(!e.type){this.emit(Xs.Error,"Invalid message");return}if(!this._wsOpen())return;const n=JSON.stringify(e);this._socket.send(n)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}class g2{constructor(e){this.connection=e}startConnection(e){const n=this._startPeerConnection();if(this.connection.peerConnection=n,this.connection.type===ci.Media&&e._stream&&this._addTracksToConnection(e._stream,n),e.originator){const r=this.connection,s={ordered:!!e.reliable},i=n.createDataChannel(r.label,s);r._initializeDataChannel(i),this._makeOffer()}else this.handleSDP("OFFER",e.sdp)}_startPeerConnection(){Le.log("Creating RTCPeerConnection.");const e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e}_setupListeners(e){const n=this.connection.peer,r=this.connection.connectionId,s=this.connection.type,i=this.connection.provider;Le.log("Listening for ICE candidates."),e.onicecandidate=o=>{!o.candidate||!o.candidate.candidate||(Le.log(`Received ICE candidates for ${n}:`,o.candidate),i.socket.send({type:Pn.Candidate,payload:{candidate:o.candidate,type:s,connectionId:r},dst:n}))},e.oniceconnectionstatechange=()=>{switch(e.iceConnectionState){case"failed":Le.log("iceConnectionState is failed, closing connections to "+n),this.connection.emitError(mg.NegotiationFailed,"Negotiation of connection to "+n+" failed."),this.connection.close();break;case"closed":Le.log("iceConnectionState is closed, closing connections to "+n),this.connection.emitError(mg.ConnectionClosed,"Connection to "+n+" closed."),this.connection.close();break;case"disconnected":Le.log("iceConnectionState changed to disconnected on the connection with "+n);break;case"completed":e.onicecandidate=()=>{};break}this.connection.emit("iceStateChanged",e.iceConnectionState)},Le.log("Listening for data channel"),e.ondatachannel=o=>{Le.log("Received data channel");const l=o.channel;i.getConnection(n,r)._initializeDataChannel(l)},Le.log("Listening for remote stream"),e.ontrack=o=>{Le.log("Received remote stream");const l=o.streams[0],c=i.getConnection(n,r);if(c.type===ci.Media){const d=c;this._addStreamToMediaConnection(l,d)}}}cleanup(){Le.log("Cleaning up PeerConnection to "+this.connection.peer);const e=this.connection.peerConnection;if(!e)return;this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=()=>{};const n=e.signalingState!=="closed";let r=!1;const s=this.connection.dataChannel;s&&(r=!!s.readyState&&s.readyState!=="closed"),(n||r)&&e.close()}async _makeOffer(){const e=this.connection.peerConnection,n=this.connection.provider;try{const r=await e.createOffer(this.connection.options.constraints);Le.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),Le.log("Set localDescription:",r,`for:${this.connection.peer}`);let s={sdp:r,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===ci.Data){const i=this.connection;s={...s,label:i.label,reliable:i.reliable,serialization:i.serialization}}n.socket.send({type:Pn.Offer,payload:s,dst:this.connection.peer})}catch(s){s!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(n.emitError(rn.WebRTC,s),Le.log("Failed to setLocalDescription, ",s))}}catch(r){n.emitError(rn.WebRTC,r),Le.log("Failed to createOffer, ",r)}}async _makeAnswer(){const e=this.connection.peerConnection,n=this.connection.provider;try{const r=await e.createAnswer();Le.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),Le.log("Set localDescription:",r,`for:${this.connection.peer}`),n.socket.send({type:Pn.Answer,payload:{sdp:r,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(s){n.emitError(rn.WebRTC,s),Le.log("Failed to setLocalDescription, ",s)}}catch(r){n.emitError(rn.WebRTC,r),Le.log("Failed to create answer, ",r)}}async handleSDP(e,n){n=new RTCSessionDescription(n);const r=this.connection.peerConnection,s=this.connection.provider;Le.log("Setting remote description",n);const i=this;try{await r.setRemoteDescription(n),Le.log(`Set remoteDescription:${e} for:${this.connection.peer}`),e==="OFFER"&&await i._makeAnswer()}catch(o){s.emitError(rn.WebRTC,o),Le.log("Failed to setRemoteDescription, ",o)}}async handleCandidate(e){Le.log("handleCandidate:",e);try{await this.connection.peerConnection.addIceCandidate(e),Le.log(`Added ICE candidate for:${this.connection.peer}`)}catch(n){this.connection.provider.emitError(rn.WebRTC,n),Le.log("Failed to handleCandidate, ",n)}}_addTracksToConnection(e,n){if(Le.log(`add tracks from stream ${e.id} to peer connection`),!n.addTrack)return Le.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(r=>{n.addTrack(r,e)})}_addStreamToMediaConnection(e,n){Le.log(`add stream ${e.id} to media connection ${n.connectionId}`),n.addStream(e)}}class m2 extends ym.EventEmitter{emitError(e,n){Le.error("Error:",n),this.emit("error",new YL(`${e}`,n))}}class YL extends Error{constructor(e,n){typeof n=="string"?super(n):(super(),Object.assign(this,n)),this.type=e}}class y2 extends m2{get open(){return this._open}constructor(e,n,r){super(),this.peer=e,this.provider=n,this.options=r,this._open=!1,this.metadata=r.metadata}}var vg;const Rl=class Rl extends y2{get type(){return ci.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(e,n,r){super(e,n,r),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||Rl.ID_PREFIX+Vn.randomToken(),this._negotiator=new g2(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{Le.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{Le.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(e){Le.log("Receiving stream",e),this._remoteStream=e,super.emit("stream",e)}handleMessage(e){const n=e.type,r=e.payload;switch(e.type){case Pn.Answer:this._negotiator.handleSDP(n,r.sdp),this._open=!0;break;case Pn.Candidate:this._negotiator.handleCandidate(r.candidate);break;default:Le.warn(`Unrecognized message type:${n} from peer:${this.peer}`);break}}answer(e,n={}){if(this._localStream){Le.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=e,n&&n.sdpTransform&&(this.options.sdpTransform=n.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:e});const r=this.provider._getMessages(this.connectionId);for(const s of r)this.handleMessage(s);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit("close"))}};vg=new WeakMap,za(Rl,vg,Rl.ID_PREFIX="mc_");let zu=Rl;class KL{constructor(e){this._options=e}_buildRequest(e){const n=this._options.secure?"https":"http",{host:r,port:s,path:i,key:o}=this._options,l=new URL(`${n}://${r}:${s}${i}${o}/${e}`);return l.searchParams.set("ts",`${Date.now()}${Math.random()}`),l.searchParams.set("version",p2),fetch(l.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{const e=await this._buildRequest("id");if(e.status!==200)throw new Error(`Error. Status:${e.status}`);return e.text()}catch(e){Le.error("Error retrieving ID",e);let n="";throw this._options.path==="/"&&this._options.host!==Vn.CLOUD_HOST&&(n=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+n)}}async listAllPeers(){try{const e=await this._buildRequest("peers");if(e.status!==200){if(e.status===401){let n="";throw this._options.host===Vn.CLOUD_HOST?n="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":n="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+n)}throw new Error(`Error. Status:${e.status}`)}return e.json()}catch(e){throw Le.error("Error retrieving list peers",e),new Error("Could not get list peers from the server."+e)}}}var xg,_g;const Li=class Li extends y2{get type(){return ci.Data}constructor(e,n,r){super(e,n,r),this.connectionId=this.options.connectionId||Li.ID_PREFIX+f2(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new g2(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{Le.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=n=>{Le.log(`DC#${this.connectionId} dc onmessage:`,n.data)},this.dataChannel.onclose=()=>{Le.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(e){if(e!=null&&e.flush){this.send({__peerData:{type:"close"}});return}this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null),this.open&&(this._open=!1,super.emit("close"))}send(e,n=!1){if(!this.open){this.emitError(vm.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.");return}return this._send(e,n)}async handleMessage(e){const n=e.payload;switch(e.type){case Pn.Answer:await this._negotiator.handleSDP(e.type,n.sdp);break;case Pn.Candidate:await this._negotiator.handleCandidate(n.candidate);break;default:Le.warn("Unrecognized message type:",e.type,"from peer:",this.peer);break}}};xg=new WeakMap,_g=new WeakMap,za(Li,xg,Li.ID_PREFIX="dc_"),za(Li,_g,Li.MAX_BUFFERED_AMOUNT=8388608);let Hu=Li;class xm extends Hu{get bufferSize(){return this._bufferSize}_initializeDataChannel(e){super._initializeDataChannel(e),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",n=>this._handleDataMessage(n))}_bufferedSend(e){(this._buffering||!this._trySend(e))&&(this._buffer.push(e),this._bufferSize=this._buffer.length)}_trySend(e){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>Hu.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(e)}catch(n){return Le.error(`DC#:${this.connectionId} Error when sending:`,n),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open||this._buffer.length===0)return;const e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(e){if(e!=null&&e.flush){this.send({__peerData:{type:"close"}});return}this._buffer=[],this._bufferSize=0,super.close()}constructor(...e){super(...e),this._buffer=[],this._bufferSize=0,this._buffering=!1}}class Gh extends xm{close(e){super.close(e),this._chunkedData={}}constructor(e,n,r){super(e,n,r),this.chunker=new u2,this.serialization=Tf.Binary,this._chunkedData={}}_handleDataMessage({data:e}){const n=AS(e),r=n.__peerData;if(r){if(r.type==="close"){this.close();return}this._handleChunk(n);return}this.emit("data",n)}_handleChunk(e){const n=e.__peerData,r=this._chunkedData[n]||{data:[],count:0,total:e.total};if(r.data[e.n]=new Uint8Array(e.data),r.count++,this._chunkedData[n]=r,r.total===r.count){delete this._chunkedData[n];const s=FL(r.data);this._handleDataMessage({data:s})}}_send(e,n){const r=PS(e);if(r instanceof Promise)return this._send_blob(r);if(!n&&r.byteLength>this.chunker.chunkedMTU){this._sendChunks(r);return}this._bufferedSend(r)}async _send_blob(e){const n=await e;if(n.byteLength>this.chunker.chunkedMTU){this._sendChunks(n);return}this._bufferedSend(n)}_sendChunks(e){const n=this.chunker.chunk(e);Le.log(`DC#${this.connectionId} Try to send ${n.length} chunks...`);for(const r of n)this.send(r,!0)}}class XL extends xm{_handleDataMessage({data:e}){super.emit("data",e)}_send(e,n){this._bufferedSend(e)}constructor(...e){super(...e),this.serialization=Tf.None}}class JL extends xm{_handleDataMessage({data:e}){const n=this.parse(this.decoder.decode(e)),r=n.__peerData;if(r&&r.type==="close"){this.close();return}this.emit("data",n)}_send(e,n){const r=this.encoder.encode(this.stringify(e));if(r.byteLength>=Vn.chunkedMTU){this.emitError(vm.MessageToBig,"Message too big for JSON channel");return}this._bufferedSend(r)}constructor(...e){super(...e),this.serialization=Tf.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}var bg;const Al=class Al extends m2{get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){const e=Object.create(null);for(const[n,r]of this._connections)e[n]=r;return e}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(e,n){super(),this._serializers={raw:XL,json:JL,binary:Gh,"binary-utf8":Gh,default:Gh},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map;let r;if(e&&e.constructor==Object?n=e:e&&(r=e.toString()),n={debug:0,host:Vn.CLOUD_HOST,port:Vn.CLOUD_PORT,path:"/",key:Al.DEFAULT_KEY,token:Vn.randomToken(),config:Vn.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...n},this._options=n,this._serializers={...this._serializers,...this.options.serializers},this._options.host==="/"&&(this._options.host=window.location.hostname),this._options.path&&(this._options.path[0]!=="/"&&(this._options.path="/"+this._options.path),this._options.path[this._options.path.length-1]!=="/"&&(this._options.path+="/")),this._options.secure===void 0&&this._options.host!==Vn.CLOUD_HOST?this._options.secure=Vn.isSecure():this._options.host==Vn.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&Le.setLogFunction(this._options.logFunction),Le.logLevel=this._options.debug||0,this._api=new KL(n),this._socket=this._createServerConnection(),!Vn.supports.audioVideo&&!Vn.supports.data){this._delayedAbort(rn.BrowserIncompatible,"The current browser does not support WebRTC");return}if(r&&!Vn.validateId(r)){this._delayedAbort(rn.InvalidID,`ID "${r}" is invalid`);return}r?this._initialize(r):this._api.retrieveId().then(s=>this._initialize(s)).catch(s=>this._abort(rn.ServerError,s))}_createServerConnection(){const e=new VL(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return e.on(Xs.Message,n=>{this._handleMessage(n)}),e.on(Xs.Error,n=>{this._abort(rn.SocketError,n)}),e.on(Xs.Disconnected,()=>{this.disconnected||(this.emitError(rn.Network,"Lost connection to server."),this.disconnect())}),e.on(Xs.Close,()=>{this.disconnected||this._abort(rn.SocketClosed,"Underlying socket is already closed.")}),e}_initialize(e){this._id=e,this.socket.start(e,this._options.token)}_handleMessage(e){const n=e.type,r=e.payload,s=e.src;switch(n){case Pn.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case Pn.Error:this._abort(rn.ServerError,r.msg);break;case Pn.IdTaken:this._abort(rn.UnavailableID,`ID "${this.id}" is taken`);break;case Pn.InvalidKey:this._abort(rn.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case Pn.Leave:Le.log(`Received leave message from ${s}`),this._cleanupPeer(s),this._connections.delete(s);break;case Pn.Expire:this.emitError(rn.PeerUnavailable,`Could not connect to peer ${s}`);break;case Pn.Offer:{const i=r.connectionId;let o=this.getConnection(s,i);if(o&&(o.close(),Le.warn(`Offer received for existing Connection ID:${i}`)),r.type===ci.Media){const c=new zu(s,this,{connectionId:i,_payload:r,metadata:r.metadata});o=c,this._addConnection(s,o),this.emit("call",c)}else if(r.type===ci.Data){const c=new this._serializers[r.serialization](s,this,{connectionId:i,_payload:r,metadata:r.metadata,label:r.label,serialization:r.serialization,reliable:r.reliable});o=c,this._addConnection(s,o),this.emit("connection",c)}else{Le.warn(`Received malformed connection type:${r.type}`);return}const l=this._getMessages(i);for(const c of l)o.handleMessage(c);break}default:{if(!r){Le.warn(`You received a malformed message from ${s} of type ${n}`);return}const i=r.connectionId,o=this.getConnection(s,i);o&&o.peerConnection?o.handleMessage(e):i?this._storeMessage(i,e):Le.warn("You received an unrecognized message:",e);break}}}_storeMessage(e,n){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(n)}_getMessages(e){const n=this._lostMessages.get(e);return n?(this._lostMessages.delete(e),n):[]}connect(e,n={}){if(n={serialization:"default",...n},this.disconnected){Le.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(rn.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}const r=new this._serializers[n.serialization](e,this,n);return this._addConnection(e,r),r}call(e,n,r={}){if(this.disconnected){Le.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(rn.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!n){Le.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}const s=new zu(e,this,{...r,_stream:n});return this._addConnection(e,s),s}_addConnection(e,n){Le.log(`add connection ${n.type}:${n.connectionId} to peerId:${e}`),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(n)}_removeConnection(e){const n=this._connections.get(e.peer);if(n){const r=n.indexOf(e);r!==-1&&n.splice(r,1)}this._lostMessages.delete(e.connectionId)}getConnection(e,n){const r=this._connections.get(e);if(!r)return null;for(const s of r)if(s.connectionId===n)return s;return null}_delayedAbort(e,n){setTimeout(()=>{this._abort(e,n)},0)}_abort(e,n){Le.error("Aborting!"),this.emitError(e,n),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||(Le.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))}_cleanup(){for(const e of this._connections.keys())this._cleanupPeer(e),this._connections.delete(e);this.socket.removeAllListeners()}_cleanupPeer(e){const n=this._connections.get(e);if(n)for(const r of n)r.close()}disconnect(){if(this.disconnected)return;const e=this.id;Le.log(`Disconnect peer with ID:${e}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit("disconnected",e)}reconnect(){if(this.disconnected&&!this.destroyed)Le.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)Le.error("In a hurry? We're still trying to make the initial connection!");else throw new Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`)}}listAllPeers(e=n=>{}){this._api.listAllPeers().then(n=>e(n)).catch(n=>this._abort(rn.ServerError,n))}};bg=new WeakMap,za(Al,bg,Al.DEFAULT_KEY="peerjs");let yg=Al;var v2=yg;class x2{constructor(){_n(this,"peer",null);_n(this,"conn",null);_n(this,"isHost",!1);_n(this,"messageCallback",null);_n(this,"connectionCallback",null);_n(this,"closeCallback",null)}async connect(e){return this.peer=new v2,new Promise((n,r)=>{if(!this.peer)return r("Peer not initialized");this.peer.on("open",s=>{console.log("My Peer ID is:",s),e?(this.isHost=!1,this.connectToPeer(e),n(s)):(this.isHost=!0,this.peer.on("connection",i=>{console.log("Incoming connection..."),this.setupConnection(i)}),n(s))}),this.peer.on("error",s=>{console.error(s),r(s)})})}connectToPeer(e){if(!this.peer)return;const n=this.peer.connect(e);this.setupConnection(n)}setupConnection(e){this.conn=e,e.on("open",()=>{console.log("Connection established!"),this.connectionCallback&&this.connectionCallback()}),e.on("data",n=>{this.messageCallback&&this.messageCallback(n)}),e.on("close",()=>{console.log("Connection closed"),this.closeCallback&&this.closeCallback()}),e.on("error",n=>console.error("Connection Error:",n))}onConnection(e){this.connectionCallback=e}onClose(e){this.closeCallback=e}isConnected(){return this.conn!==null&&this.conn.open}send(e){this.conn&&this.conn.open?this.conn.send(e):console.warn("Connection not open, cannot send message")}onMessage(e){this.messageCallback=e}disconnect(){var e,n;(e=this.conn)==null||e.close(),(n=this.peer)==null||n.destroy()}}const QL=({gameMode:t,targetRoomId:e,playerClass:n,onGameStart:r,onBack:s})=>{const[i,o]=P.useState(""),[l,c]=P.useState(!1),[d,u]=P.useState(!0),[h,f]=P.useState(null),[b,C]=P.useState(!1),[k,A]=P.useState(null),[R,m]=P.useState(!1),T=P.useRef(null);P.useEffect(()=>{const H=new x2;return T.current=H,(async()=>{try{const W=await H.connect(t==="JOIN"?e:void 0);o(W),u(!1),H.onMessage(G=>{console.log("[LobbyScreen] Received message:",G),G.type==="CLASS_INFO"&&(console.log("[LobbyScreen] Received opponent class:",G.playerClass),A(G.playerClass))}),H.onConnection(()=>{console.log("[LobbyScreen] Connection established!"),c(!0)})}catch(W){console.error("[LobbyScreen] Connection error:",W),f(W.toString()),u(!1)}})(),()=>{var W;(W=T.current)!=null&&W.isConnected()||H.disconnect()}},[t,e]),P.useEffect(()=>{l&&T.current&&!R&&(console.log("[LobbyScreen] Sending class info:",n),setTimeout(()=>{var H;(H=T.current)==null||H.send({type:"CLASS_INFO",playerClass:n}),m(!0)},100))},[l,n,R]),P.useEffect(()=>{if(l&&T.current&&k){const H=setTimeout(()=>{console.log("[LobbyScreen] Starting game with opponent class:",k),r(T.current,k)},500);return()=>clearTimeout(H)}},[l,r,k]);const L=async()=>{if(i)try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(i);else{const H=document.createElement("textarea");H.value=i,H.style.position="fixed",H.style.left="-999999px",H.style.top="-999999px",document.body.appendChild(H),H.focus(),H.select(),document.execCommand("copy"),document.body.removeChild(H)}C(!0),setTimeout(()=>C(!1),2e3)}catch(H){console.error("Failed to copy:",H),alert(`Room ID: ${i}

()`)}},g=()=>{T.current&&(T.current.disconnect(),T.current=null),s()};return a.jsxs("div",{className:"screen lobby-screen",style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",gap:"2rem"},children:[a.jsx("h1",{style:{fontSize:"2.5rem",marginBottom:"1rem",textShadow:"0 0 10px #e94560",fontFamily:"Tamanegi, sans-serif",letterSpacing:"2px"},children:t==="HOST"?"":"..."}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1.5rem",padding:"2rem",background:"rgba(0,0,0,0.3)",borderRadius:"10px",minWidth:"400px"},children:[h&&a.jsxs("div",{style:{color:"#ff6b6b",fontSize:"1.2rem",textAlign:"center",fontFamily:"Tamanegi, sans-serif"},children:[a.jsx("p",{children:""}),a.jsx("p",{style:{fontSize:"0.9rem",opacity:.7},children:h})]}),d&&!h&&a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1rem"},children:[a.jsx("div",{className:"loading-spinner",style:{width:"50px",height:"50px",border:"4px solid rgba(233, 69, 96, 0.3)",borderTop:"4px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),a.jsx("p",{style:{opacity:.8,fontFamily:"Tamanegi, sans-serif"},children:t==="HOST"?"...":"..."})]}),t==="HOST"&&i&&!d&&!l&&!h&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.5rem"},children:[a.jsx("p",{style:{fontSize:"1rem",opacity:.7,fontFamily:"Tamanegi, sans-serif"},children:"ID:"}),a.jsx("div",{style:{fontSize:"2rem",fontFamily:"monospace",fontWeight:"bold",padding:"0.5rem 1rem",background:"rgba(233, 69, 96, 0.2)",borderRadius:"8px",border:"1px solid #e94560",letterSpacing:"2px"},children:i})]}),a.jsx("button",{onClick:L,style:{fontSize:"1rem",padding:"0.8rem 2rem",background:b?"#48bb78":"transparent",border:"2px solid "+(b?"#48bb78":"#e94560"),color:"#fff",cursor:"pointer",transition:"all 0.3s",borderRadius:"4px",fontWeight:"bold",fontFamily:"Tamanegi, sans-serif"},children:b?" ":"ID"}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginTop:"1rem",opacity:.7},children:[a.jsx("div",{className:"loading-spinner",style:{width:"20px",height:"20px",border:"2px solid rgba(233, 69, 96, 0.3)",borderTop:"2px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),a.jsx("span",{style:{fontFamily:"Tamanegi, sans-serif"},children:"..."})]})]}),t==="JOIN"&&!d&&!l&&!h&&a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[a.jsx("div",{className:"loading-spinner",style:{width:"20px",height:"20px",border:"2px solid rgba(233, 69, 96, 0.3)",borderTop:"2px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),a.jsxs("span",{style:{fontFamily:"Tamanegi, sans-serif"},children:[" ",e," ..."]})]}),l&&a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1rem"},children:[a.jsx("p",{style:{fontSize:"1.5rem",color:"#48bb78",fontFamily:"Tamanegi, sans-serif"},children:" "}),a.jsx("p",{style:{fontFamily:"Tamanegi, sans-serif"},children:"..."})]}),a.jsxs("div",{style:{marginTop:"1rem",padding:"0.5rem 1rem",background:"rgba(255,255,255,0.1)",borderRadius:"4px",fontSize:"0.9rem",opacity:.7,fontFamily:"Tamanegi, sans-serif"},children:[": ",n==="SENKA"?"":n==="AJA"?"":"yoRuka"]})]}),a.jsx("button",{onClick:g,style:{fontSize:"1rem",padding:"0.8rem 2rem",background:"transparent",border:"1px solid #888",color:"#888",cursor:"pointer",transition:"all 0.3s",borderRadius:"4px",marginTop:"1rem",fontFamily:"Tamanegi, sans-serif"},onMouseOver:H=>{H.currentTarget.style.color="#fff",H.currentTarget.style.borderColor="#fff"},onMouseOut:H=>{H.currentTarget.style.color="#888",H.currentTarget.style.borderColor="#888"},children:" "}),a.jsx("style",{children:`
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `})]})};class qL{constructor(){_n(this,"myEntryRef",null);_n(this,"listenerUnsubscribe",null);_n(this,"myId","");_n(this,"myPeerId","");_n(this,"hasMatched",!1)}async startMatchmaking(e,n,r,s,i,o,l,c){this.myPeerId=e,this.hasMatched=!1;const d=sr(ir,`matchmaking/${s}`);try{const u=await Sc(d),h=[];if(u.exists()){const k=[];u.forEach(A=>{const R=A.val(),m=Date.now()-R.timestamp<5*60*1e3;if(s==="ranked"&&l&&R.playerId===l){console.log(`[Matchmaking] Found duplicate entry for playerId: ${l}, removing...`),k.push(A.key);return}R.peerId!==e&&m&&h.push({key:A.key,data:R})});for(const A of k)await tl(sr(ir,`matchmaking/${s}/${A}`)),console.log(`[Matchmaking] Removed duplicate entry: ${A}`)}if(h.length>0){const k=h.sort((A,R)=>A.data.timestamp-R.data.timestamp)[0];await tl(sr(ir,`matchmaking/${s}/${k.key}`)),i("matched"),o({peerId:k.data.peerId,playerName:k.data.playerName,playerClass:k.data.playerClass,isHost:!1,playerId:k.data.playerId,rating:k.data.rating});return}i("searching");const f=WE(d);this.myEntryRef=f,this.myId=f.key;const b={id:this.myId,peerId:e,playerName:n,playerClass:r,matchType:s,...l!=null&&{playerId:l},...c!=null&&{rating:c},timestamp:Date.now()};await Ec(f,b),MA(f).remove();const C=s;this.listenerUnsubscribe=GE(d,async k=>{if(this.hasMatched||!k.exists())return;let A=!1,R=null;if(k.forEach(m=>{const T=m.val();m.key===this.myId?A=!0:T.peerId!==this.myPeerId&&(!R||T.timestamp>R.data.timestamp)&&(R={key:m.key,data:T})}),!A&&this.myEntryRef){if(this.hasMatched)return;this.hasMatched=!0,i("matched"),this.cleanup();return}if(R!==null&&A){const m=k.child(this.myId).val(),T=R;if(m&&m.timestamp<T.data.timestamp){if(this.hasMatched)return;this.hasMatched=!0,await tl(sr(ir,`matchmaking/${C}/${T.key}`)),await tl(sr(ir,`matchmaking/${C}/${this.myId}`)),this.cleanup(),i("matched"),o({peerId:T.data.peerId,playerName:T.data.playerName,playerClass:T.data.playerClass,isHost:!0,playerId:T.data.playerId,rating:T.data.rating})}}})}catch(u){console.error("[Matchmaking] Error:",u),i("error"),this.cleanup()}}async cancelMatchmaking(){if(this.myEntryRef)try{await tl(this.myEntryRef)}catch(e){console.error("[Matchmaking] Error removing entry:",e)}this.cleanup()}cleanup(){this.listenerUnsubscribe&&(this.listenerUnsubscribe(),this.listenerUnsubscribe=null),this.myEntryRef=null,this.myId=""}}const xd=new qL;class Vx{constructor(e,n,r=!1){_n(this,"peer");_n(this,"conn");_n(this,"isHost",!1);_n(this,"messageCallback",null);_n(this,"closeCallback",null);this.peer=e,this.conn=n,this.isHost=r,n.on("data",s=>{this.messageCallback&&this.messageCallback(s)}),n.on("close",()=>{console.log("[PeerJSAdapter] Connection closed"),this.closeCallback&&this.closeCallback()}),n.on("error",s=>console.error("[PeerJSAdapter] Connection Error:",s))}async connect(e){return this.peer.id}onConnection(e){}onClose(e){this.closeCallback=e}isConnected(){return this.conn!==null&&this.conn.open}send(e){this.conn&&this.conn.open?this.conn.send(e):console.warn("[PeerJSAdapter] Connection not open, cannot send message")}onMessage(e){this.messageCallback=e}disconnect(){var e,n;(e=this.conn)==null||e.close(),(n=this.peer)==null||n.destroy()}}const ZL=1280,eM=720,Yx={BRONZE:"#cd7f32",SILVER:"#c0c0c0",GOLD:"#ffd700",PLATINUM:"#e5e4e2",DIAMOND:"#b9f2ff",MASTER:"#ff4500"},tM=({matchType:t,playerClass:e,playerName:n,playerId:r,onGameStart:s,onCancel:i})=>{const[o,l]=P.useState("idle"),[c,d]=P.useState("..."),[u,h]=P.useState(0),[f,b]=P.useState(0),C=P.useRef(null),k=P.useRef(null),A=P.useRef(null),R=P.useRef(!1),m=P.useRef(!1),[T,L]=P.useState(0),[g,H]=P.useState(void 0),[Q,W]=P.useState(1);P.useEffect(()=>{const fe=()=>{const Ee=window.innerWidth/ZL,ae=window.innerHeight/eM;W(Math.min(Ee,ae))};return fe(),window.addEventListener("resize",fe),()=>window.removeEventListener("resize",fe)},[]),P.useEffect(()=>{if(u<=0)return;const fe=setInterval(()=>{h(Ee=>{const ae=Ee-1;return ae<=0?(localStorage.removeItem("rankedSurrenderCooldownEnd"),localStorage.removeItem("rankedSurrenderTimestamps"),d(""),0):(d(`${Math.ceil(ae/60)}${ae%60}`),ae)})},1e3);return()=>clearInterval(fe)},[u>0]),P.useEffect(()=>{if(o!=="searching")return;const fe=setInterval(()=>{b(Ee=>{const ae=Ee+1;return ae>=60&&(l("error"),d(""),xd.cancelMatchmaking(),k.current&&k.current.close(),C.current&&C.current.destroy()),ae})},1e3);return()=>clearInterval(fe)},[o]),P.useEffect(()=>{let fe=!0,Ee=0;return(async()=>{try{if(t==="ranked"){const v=localStorage.getItem("rankedSurrenderCooldownEnd");if(v){const x=parseInt(v,10)-Date.now();if(x>0){l("error");const I=Math.ceil(x/1e3);h(I),d(`${Math.ceil(I/60)}`),console.log("%c[Matchmaking] Surrender cooldown active","background: #ff0000; color: #ffffff;",{remainingMs:x,remainingMin:Math.ceil(x/6e4)});return}else localStorage.removeItem("rankedSurrenderCooldownEnd"),localStorage.removeItem("rankedSurrenderTimestamps")}}if(t==="ranked"&&r)try{Ee=(await cg(r,e)).rating,L(Ee)}catch(v){console.error("[Matchmaking] Failed to get rating:",v)}const he=new v2({debug:1,config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]}});if(C.current=he,await new Promise((v,_)=>{he.on("open",()=>v()),he.on("error",x=>_(x))}),!fe)return;const be=he.id;console.log("[Matchmaking] My PeerJS ID:",be),he.on("connection",v=>{console.log("[Matchmaking] Incoming connection from:",v.peer),k.current=v,v.on("open",()=>{console.log("[Matchmaking] Connection opened (as HOST)"),v.on("data",_=>{if(_.type==="PLAYER_INFO"){console.log("[Matchmaking] Received player info:",_),v.send({type:"PLAYER_INFO",playerName:n,playerClass:e,playerId:t==="ranked"?r:void 0,rating:t==="ranked"?Ee:void 0}),fe&&t==="ranked"&&H(_.rating),m.current=!0;const x=new Vx(he,v,!0);s(x,_.playerClass,!0,_.playerId,_.rating,_.playerName)}})})}),xd.startMatchmaking(be,n,e,t,v=>{if(fe)switch(l(v),v){case"searching":d("...");break;case"matched":d("...");break;case"error":d("");break}},async v=>{if(fe)if(console.log("[Matchmaking] Match found:",v),A.current=v,R.current=v.isHost,v.isHost)d("...");else{d("...");const _=he.connect(v.peerId,{reliable:!0});k.current=_,_.on("open",()=>{console.log("[Matchmaking] Connection opened (as JOIN)"),_.send({type:"PLAYER_INFO",playerName:n,playerClass:e,playerId:t==="ranked"?r:void 0,rating:t==="ranked"?Ee:void 0}),_.on("data",x=>{if(x.type==="PLAYER_INFO"){console.log("[Matchmaking] Received player info:",x),fe&&t==="ranked"&&H(x.rating),m.current=!0;const I=new Vx(he,_,!1);s(I,x.playerClass,!1,x.playerId,x.rating,x.playerName)}})}),_.on("error",x=>{console.error("[Matchmaking] Connection error:",x),l("error"),d("")})}},t==="ranked"&&r?r:void 0,t==="ranked"?Ee:void 0)}catch(he){console.error("[Matchmaking] Init error:",he),fe&&(l("error"),d(""))}})(),()=>{fe=!1,xd.cancelMatchmaking(),m.current||(k.current&&k.current.close(),C.current&&C.current.destroy())}},[t,e,n,r,s]);const G=async()=>{await xd.cancelMatchmaking(),k.current&&k.current.close(),C.current&&C.current.destroy(),i()},de=fe=>{const Ee=Math.floor(fe/60),ae=fe%60;return`${Ee}:${ae.toString().padStart(2,"0")}`};return a.jsxs("div",{className:"screen",style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white"},children:[a.jsx("div",{style:{fontSize:`${1.2*Q}rem`,color:"#4ade80",marginBottom:`${1*Q}rem`,fontWeight:"bold"},children:t==="casual"?"":""}),a.jsx("div",{style:{fontSize:`${2*Q}rem`,fontWeight:"bold",marginBottom:`${1*Q}rem`,textAlign:"center"},children:c}),o==="searching"&&a.jsxs("div",{style:{fontSize:`${1.5*Q}rem`,color:"#888",marginBottom:`${2*Q}rem`},children:[": ",de(f)]}),(o==="searching"||o==="matched")&&a.jsx("div",{style:{width:80*Q,height:80*Q,border:"4px solid rgba(255,255,255,0.2)",borderTop:"4px solid #4ade80",borderRadius:"50%",animation:"spin 1s linear infinite",marginBottom:`${2*Q}rem`}}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*Q}rem`,marginBottom:`${2*Q}rem`,padding:`${1*Q}rem`,background:"rgba(255,255,255,0.1)",borderRadius:8*Q},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:`${1*Q}rem`},children:[a.jsx("div",{style:{fontSize:`${1*Q}rem`},children:n||""}),a.jsx("div",{style:{fontSize:`${.9*Q}rem`,color:e==="SENKA"?"#e94560":e==="AJA"?"#45a2e9":"#a855f7"},children:e==="SENKA"?"":e==="AJA"?"":"Y"})]}),t==="ranked"&&T>0&&a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:`${.5*Q}rem`,fontSize:`${.85*Q}rem`,color:"#aaa"},children:[a.jsx("span",{style:{fontWeight:"bold",color:Yx[wn(T)],fontFamily:"Tamanegi, sans-serif"},children:or[wn(T)]}),a.jsx("span",{style:{fontFamily:"Tamanegi, sans-serif"},children:T})]}),t==="ranked"&&o==="matched"&&g!==void 0&&a.jsxs("div",{style:{marginTop:`${.5*Q}rem`,padding:`${.5*Q}rem ${1*Q}rem`,background:"rgba(0, 0, 0, 0.3)",borderRadius:4*Q,fontSize:`${.8*Q}rem`,color:"#aaa"},children:[": ",a.jsx("span",{style:{fontWeight:"bold",color:Yx[wn(g)],fontFamily:"Tamanegi, sans-serif"},children:or[wn(g)]})," ",g]})]}),o!=="error"&&a.jsx("button",{onClick:G,style:{padding:`${.8*Q}rem ${2*Q}rem`,fontSize:`${1*Q}rem`,background:"transparent",border:"2px solid #e94560",color:"#e94560",borderRadius:8*Q,cursor:"pointer",transition:"all 0.2s"},onMouseOver:fe=>{fe.currentTarget.style.background="#e94560",fe.currentTarget.style.color="white"},onMouseOut:fe=>{fe.currentTarget.style.background="transparent",fe.currentTarget.style.color="#e94560"},children:""}),o==="error"&&a.jsx("button",{onClick:i,style:{padding:`${.8*Q}rem ${2*Q}rem`,fontSize:`${1*Q}rem`,background:"#e94560",border:"none",color:"white",borderRadius:8*Q,cursor:"pointer"},children:""}),a.jsx("style",{children:`
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `})]})},nM=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},Co=({card:t,onClick:e,style:n,isSelected:r,isPlayable:s,variant:i="normal",turnCount:o,isOnBoard:l,isSpecialSummoning:c,className:d,suppressPassives:u,isMyTurn:h,scale:f=1})=>{const b="currentAttack"in t?t.currentAttack:t.attack,C="currentHealth"in t?t.currentHealth:t.health,k="maxHealth"in t?t.maxHealth:t.health,A="canAttack"in t?t.canAttack:!1,R="turnPlayed"in t?t.turnPlayed:void 0,[m,T]=j.useState(!1);j.useEffect(()=>{if(c&&l){T(!0);const N=setTimeout(()=>T(!1),800);return()=>clearTimeout(N)}},[c,l]);const L="baseAttack"in t?t.baseAttack:void 0,g="baseHealth"in t?t.baseHealth:void 0,H=L!==void 0&&b>L,Q=g!==void 0&&(C>g||k>g),W="hasEvolved"in t?t.hasEvolved:!1,G="evolvedImageUrl"in t?t.evolvedImageUrl:void 0,de=W&&G?G:t.imageUrl,fe=de?nM(de):void 0;let Ee=n==null?void 0:n.boxShadow,ae;const he=t.passiveAbilities||t.abilities||[],be=he.includes("WARD"),v=he.includes("AURA"),_=he.includes("STEALTH"),x=t.hasBarrier===!0||he.includes("BARRIER")&&t.hasBarrier!==!1;if(r)Ee="0 0 15px rgba(255, 255, 255, 0.8)";else if(s)Ee="0 0 10px #48bb78",ae="2px solid #48bb78";else if(A&&h){const N=he.includes("STORM"),ne=he.includes("RUSH"),B=o!==void 0&&R!==void 0&&R===o;let ye=!1;N||(B?ye=!0:(o===void 0||R===void 0)&&(ye=ne)),ye?Ee="0 0 10px #f6e05e":Ee="0 0 10px #48bb78"}const I=C<k;if(i==="art-only")return a.jsx("div",{className:"card art-only",style:{width:140,height:200,...n,borderRadius:8,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",background:"#2d3748",position:"relative",boxShadow:"0 4px 6px rgba(0,0,0,0.3)"},children:fe?a.jsx("img",{src:fe,alt:t.name,draggable:!1,style:{width:"100%",height:"100%",objectFit:"cover"}}):a.jsx("div",{style:{fontSize:"1.5rem",opacity:.5,color:"white",fontWeight:"bold"},children:t.type})});if(i==="mobile-hand"){const ne=t.type==="SPELL"?16:6,B=28*f,ye=.85*f;return a.jsxs("div",{className:`card mobile-hand ${d||""}`,style:{width:80,height:115,...n,position:"relative",cursor:e?"pointer":"default",transform:r?"translateY(-8px)":n==null?void 0:n.transform,boxShadow:Ee||(n==null?void 0:n.boxShadow),border:ae||(s?"2px solid #48bb78":void 0),transition:"transform 0.2s, box-shadow 0.2s",background:"#1a202c",overflow:"hidden",borderRadius:`${ne}px ${ne}px 6px 6px`,backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},onClick:e,children:[a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"hidden",borderRadius:`${ne}px ${ne}px 6px 6px`},children:fe?a.jsx("img",{src:fe,alt:t.name,draggable:!1,style:{width:"100%",height:"100%",objectFit:"cover"}}):a.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"#4a5568",color:"#a0aec0",fontSize:"0.6rem"},children:t.type})}),a.jsxs("div",{style:{position:"absolute",top:3,left:4,display:"flex",flexDirection:"column",gap:2,zIndex:10},children:[a.jsx("div",{style:{width:B,height:B,borderRadius:"50%",background:"#48bb78",border:"1px solid rgba(255,255,255,0.8)",color:"white",fontSize:`${ye}rem`,fontWeight:900,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.6)"},children:t.cost}),t.type==="FOLLOWER"&&a.jsxs("div",{style:{width:B,height:B,display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[a.jsx("svg",{width:B,height:B,viewBox:"0 0 24 24",fill:"none",style:{position:"absolute",filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.8))"},children:a.jsx("polygon",{points:"12,2 22,22 2,22",fill:"#4299e1",stroke:"rgba(255,255,255,0.8)",strokeWidth:"1",strokeLinejoin:"round"})}),a.jsx("span",{style:{zIndex:1,color:H?"#faf089":"white",fontWeight:"bold",fontSize:`${ye}rem`,textShadow:"0 1px 2px black"},children:b})]}),t.type==="FOLLOWER"&&a.jsxs("div",{style:{width:B,height:B,display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[a.jsx("svg",{width:B,height:B,viewBox:"0 0 24 24",style:{position:"absolute",filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.8))"},children:a.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z",fill:"#c53030",stroke:"rgba(255,255,255,0.8)",strokeWidth:"1"})}),a.jsx("span",{style:{zIndex:1,color:Q?"#faf089":I?"#fc8181":"white",fontWeight:"bold",fontSize:`${ye}rem`,textShadow:"0 1px 2px black"},children:C})]})]})]})}const y=t.type==="SPELL"&&!l,O=y?20:8;return a.jsxs("div",{className:`card card-container ${A?"ready":""} ${l?"on-board":""} ${d||""}`,style:{width:140,height:200,...n,position:"relative",cursor:e?"pointer":"default",transform:r?"translateY(-10px)":n==null?void 0:n.transform,boxShadow:Ee||(A?"0 0 10px #f6e05e":n==null?void 0:n.boxShadow),border:ae||(s?"2px solid #48bb78":void 0),transition:"transform 0.2s, box-shadow 0.2s",display:"flex",flexDirection:"column",background:"#1a202c",overflow:"visible",animation:m?"cardSummonAppear 0.8s cubic-bezier(0.22, 1, 0.36, 1) forwards":n==null?void 0:n.animation,backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",borderRadius:y?`${O}px ${O}px 8px 8px`:"8px"},onClick:e,children:[!l&&a.jsx("div",{style:{height:20,background:"rgba(0,0,0,0.8)",color:"#e2e8f0",fontSize:t.name.length>10?"0.6rem":"0.7rem",fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid rgba(255,255,255,0.2)",zIndex:2,transform:t.name.length>15?"scaleX(0.9)":"none",borderRadius:y?`${O}px ${O}px 0 0`:"8px 8px 0 0"},children:t.name}),a.jsxs("div",{style:{flex:1,position:"relative",width:"100%",background:"#2d3748",borderRadius:l?"8px":"0 0 8px 8px",minHeight:0},children:[a.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"hidden",borderRadius:l?"8px":"0 0 8px 8px",zIndex:1},children:[fe?a.jsx("img",{src:fe,alt:t.name,draggable:!1,style:{width:"100%",height:"100%",objectFit:"cover",display:"block"}}):a.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"#4a5568",color:"#a0aec0",fontSize:"0.8rem"},children:t.type}),a.jsx("div",{style:{position:"absolute",bottom:0,left:0,width:"100%",height:40,background:"linear-gradient(to top, rgba(0,0,0,0.8), transparent)",pointerEvents:"none",zIndex:3}})]}),!l&&a.jsx("div",{style:{position:"absolute",top:2*f,left:2*f,width:24*f,height:24*f,borderRadius:"50%",background:"#48bb78",border:`${Math.max(1,2*f)}px solid #fff`,color:"white",fontSize:`${.9*f}rem`,fontWeight:900,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 2px 4px rgba(0,0,0,0.5), inset 0 2px 5px rgba(255,255,255,0.3)",zIndex:10},children:t.cost}),t.type==="FOLLOWER"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{position:"absolute",bottom:l?2*f:40*f,left:2*f,width:32*f,height:32*f,zIndex:10,display:"flex",alignItems:"center",justifyContent:"center"},children:[a.jsxs("svg",{width:40*f,height:40*f,viewBox:"0 0 24 24",fill:"none",style:{position:"absolute",filter:"drop-shadow(0 2px 2px rgba(0,0,0,0.8))"},children:[a.jsx("defs",{children:a.jsxs("linearGradient",{id:"blueGrad",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[a.jsx("stop",{offset:"0%",stopColor:"#63b3ed"}),a.jsx("stop",{offset:"100%",stopColor:"#4299e1"})]})}),a.jsx("polygon",{points:"12,2 22,22 2,22",fill:"url(#blueGrad)",stroke:"white",strokeWidth:"1",strokeLinejoin:"round"})]}),a.jsx("span",{style:{zIndex:11,color:H?"#faf089":"white",fontWeight:"bold",fontSize:`${1.2*f}rem`,textShadow:"0 2px 2px black"},children:b})]}),a.jsxs("div",{style:{position:"absolute",bottom:2*f,right:l?2*f:"auto",left:l?"auto":2*f,width:32*f,height:32*f,zIndex:10,display:"flex",alignItems:"center",justifyContent:"center"},children:[a.jsxs("svg",{width:36*f,height:36*f,viewBox:"0 0 24 24",style:{position:"absolute",filter:"drop-shadow(0 2px 2px rgba(0,0,0,0.8))"},children:[a.jsx("defs",{children:a.jsxs("linearGradient",{id:"redGrad",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[a.jsx("stop",{offset:"0%",stopColor:"#f56565"}),a.jsx("stop",{offset:"100%",stopColor:"#c53030"})]})}),a.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z",fill:"url(#redGrad)",stroke:"white",strokeWidth:"1.5"})]}),a.jsx("span",{style:{zIndex:11,color:Q?"#faf089":I?"#fc8181":"white",fontWeight:"bold",fontSize:`${1.2*f}rem`,textShadow:"0 2px 2px black"},children:C})]})]}),l&&a.jsx("div",{style:{position:"absolute",top:-6*f,left:-6*f,right:-6*f,bottom:-6*f,zIndex:50,pointerEvents:"none",opacity:be&&!u?1:0,transition:"opacity 0.2s ease-in-out"},children:a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,animation:"wardPulseLoop 2.5s infinite ease-in-out"},children:a.jsxs("svg",{viewBox:"0 0 100 120",preserveAspectRatio:"none",style:{width:"100%",height:"100%"},children:[a.jsx("defs",{children:a.jsxs("filter",{id:"wardGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{stdDeviation:"2",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsx("path",{d:"M50 2 L96 20 V60 C96 90 50 116 50 116 C50 116 4 90 4 60 V20 Z",fill:"rgba(255, 255, 255, 0.12)",stroke:"#ECC94B",strokeWidth:"3",filter:"url(#wardGlow)"})]})})}),l&&a.jsxs("div",{style:{position:"absolute",top:-5*f,left:-5*f,right:-5*f,bottom:-5*f,zIndex:21,pointerEvents:"none",opacity:x&&!m&&!u?1:0,transition:"opacity 0.2s ease-in-out"},children:[a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,borderRadius:"50%",background:"radial-gradient(ellipse at center, rgba(99, 179, 237, 0.12) 0%, transparent 60%)",animation:"barrierGlowLoop 3s infinite ease-in-out"}}),a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,borderRadius:"50%",border:`${Math.max(1.5,2*f)}px solid rgba(99, 179, 237, 0.9)`,boxShadow:"0 0 6px rgba(66, 153, 225, 0.5), inset 0 0 8px rgba(99, 179, 237, 0.15)",animation:"barrierPulseLoop 3s infinite ease-in-out"}})]}),l&&a.jsx("div",{style:{position:"absolute",top:-6*f,left:-6*f,right:-6*f,bottom:-6*f,zIndex:22,pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center",opacity:v&&!m&&!u?1:0,transition:"opacity 0.2s ease-in-out"},children:a.jsx("div",{style:{width:"100%",height:"100%",position:"relative",animation:"auraPulseLoop 3s infinite ease-in-out"},children:a.jsxs("svg",{viewBox:"0 0 100 100",style:{width:"100%",height:"100%"},children:[a.jsx("defs",{children:a.jsxs("filter",{id:"auraGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{stdDeviation:"1.5",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsx("path",{d:"M40 5 L60 5 L60 30 L95 30 L95 45 L60 45 L60 95 L40 95 L40 45 L5 45 L5 30 L40 30 Z",fill:"rgba(255, 204, 0, 0.2)",stroke:"#f6ad55",strokeWidth:"2.5",filter:"url(#auraGlow)"})]})})}),l&&a.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:13,pointerEvents:"none",overflow:"hidden",borderRadius:"0 0 8px 8px",opacity:_&&!m&&!u?1:0,transition:"opacity 0.2s ease-in-out"},children:[a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:"120%",height:"120%",transform:"translate(-50%, -50%)",background:"radial-gradient(circle, rgba(0, 0, 0, 0.9) 0%, rgba(0, 0, 0, 0.6) 30%, rgba(0, 0, 0, 0.2) 60%, transparent 80%)",filter:"blur(10px)",animation:"stealthInkMove 3s infinite ease-in-out",mixBlendMode:"multiply"}}),a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:"100%",height:"100%",transform:"translate(-50%, -50%)",background:"radial-gradient(circle, rgba(20, 20, 30, 0.85) 0%, rgba(10, 10, 20, 0.4) 40%, transparent 70%)",filter:"blur(8px)",animation:"stealthInkPulse 1.5s infinite ease-in-out",mixBlendMode:"multiply"}}),a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:"70%",height:"70%",transform:"translate(-50%, -50%)",background:"radial-gradient(circle, rgba(255, 255, 255, 0.4) 0%, rgba(200, 200, 200, 0.25) 30%, transparent 60%)",filter:"blur(8px)",animation:"stealthMistMove 4s infinite ease-in-out",mixBlendMode:"screen"}}),a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,boxShadow:"inset 0 0 30px rgba(0, 0, 0, 0.85), 0 0 20px rgba(0, 0, 0, 0.6)",animation:"stealthPulse 1.5s infinite ease-in-out"}})]})]}),m&&a.jsx("div",{style:{position:"absolute",inset:0,borderRadius:8,background:"radial-gradient(circle, rgba(255,255,255,0.8) 0%, transparent 70%)",mixBlendMode:"overlay",animation:"cardSummonFlash 0.8s ease-out forwards",pointerEvents:"none",zIndex:100}}),a.jsx("style",{children:`
                @keyframes cardSummonAppear {
                    0% { opacity: 0; transform: scale(1.5); filter: brightness(2) blur(4px); }
                    100% { opacity: 1; transform: scale(1); filter: brightness(1) blur(0px); }
                }
                @keyframes cardSummonFlash {
                    0% { opacity: 0.8; transform: scale(1.2); }
                    100% { opacity: 0; transform: scale(1); }
                }
                @keyframes wardPulseLoop {
                    0% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(255, 255, 255, 0.5)); }
                    50% { transform: scale(1.08); opacity: 0.5; filter: blur(3px) drop-shadow(0 0 15px rgba(255, 255, 255, 0.8)); }
                    100% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(255, 255, 255, 0.5)); }
                }
                @keyframes barrierPulseLoop {
                    0% { transform: scale(1); opacity: 1; box-shadow: 0 0 8px rgba(66, 153, 225, 0.6), inset 0 0 10px rgba(99, 179, 237, 0.2); }
                    50% { transform: scale(1.03); opacity: 0.85; box-shadow: 0 0 12px rgba(99, 179, 237, 0.8), inset 0 0 15px rgba(99, 179, 237, 0.3); }
                    100% { transform: scale(1); opacity: 1; box-shadow: 0 0 8px rgba(66, 153, 225, 0.6), inset 0 0 10px rgba(99, 179, 237, 0.2); }
                }
                @keyframes barrierGlowLoop {
                    0% { transform: scale(1); opacity: 0.6; }
                    50% { transform: scale(1.05); opacity: 0.4; }
                    100% { transform: scale(1); opacity: 0.6; }
                }
                @keyframes auraPulseLoop {
                    0% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(246, 173, 85, 0.5)); }
                    50% { transform: scale(1.12); opacity: 0.4; filter: blur(4px) drop-shadow(0 0 20px rgba(255, 204, 0, 0.8)); }
                    100% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(246, 173, 85, 0.5)); }
                }
                @keyframes stealthInkMove {
                    0%, 100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 0.7; }
                    25% { transform: translate(-45%, -55%) scale(1.15) rotate(3deg); opacity: 1; }
                    50% { transform: translate(-50%, -50%) scale(0.95) rotate(0deg); opacity: 0.5; }
                    75% { transform: translate(-55%, -45%) scale(1.1) rotate(-3deg); opacity: 0.9; }
                }
                @keyframes stealthInkPulse {
                    0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.8; }
                    50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.4; }
                }
                @keyframes stealthMistMove {
                    0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.5; }
                    25% { transform: translate(-48%, -52%) scale(1.1); opacity: 0.8; }
                    50% { transform: translate(-52%, -48%) scale(1.2); opacity: 0.3; }
                    75% { transform: translate(-50%, -50%) scale(0.9); opacity: 0.7; }
                }
                @keyframes stealthPulse {
                    0%, 100% { opacity: 0.6; box-shadow: inset 0 0 50px rgba(0, 0, 0, 0.9), 0 0 30px rgba(0, 0, 0, 0.7); }
                    50% { opacity: 1; box-shadow: inset 0 0 70px rgba(0, 0, 0, 1), 0 0 40px rgba(0, 0, 0, 0.9); }
                }
                /* 3D flip support - ensure all child elements inherit backface-visibility */
                .card, .card * {
                    backface-visibility: hidden !important;
                    -webkit-backface-visibility: hidden !important;
                }
            `})]})},rM=35e5;function _2(){const[t,e]=P.useState(()=>Kx());return P.useEffect(()=>{const n=()=>{e(Kx())};return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),t}function Kx(){const t=window.innerWidth*window.devicePixelRatio,e=window.innerHeight*window.devicePixelRatio,n=t*e,r=n>rM;let s="HD";return n>8e6?s="4K":n>35e5?s="1440p":n>2e6&&(s="1080p"),{isHighRes:r,isLightMode:r,pixelCount:n,resolution:s}}function sM(t){return t?{glowShadow:(e,n)=>`0 0 ${10*n}px ${e}`,blurAmount:4,enableGlowPulse:!1,dropShadow:e=>`drop-shadow(0 0 ${10*e}px rgba(255,255,255,0.6))`}:{glowShadow:(e,n)=>`
            0 0 ${15*n}px ${e},
            0 0 ${30*n}px ${e}80,
            0 0 ${60*n}px ${e}50
        `,blurAmount:8,enableGlowPulse:!0,dropShadow:e=>`drop-shadow(0 0 ${20*e}px rgba(255,255,255,0.8)) drop-shadow(0 0 ${40*e}px rgba(255,255,255,0.6))`}}const Yd=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},_d=t=>Yd(t==="YORUKA"?"/leaders/yoRuka_leader.png":t==="AJA"?"/leaders/azya_leader.png":"/leaders/senka_leader.png"),iM=Yd("/assets/VS.png"),yr=8,Vh=240,bd=t=>{switch(t){case"BRONZE":return"#cd7f32";case"SILVER":return"#c0c0c0";case"GOLD":return"#ffd700";case"PLATINUM":return"#e5e4e2";case"DIAMOND":return"#b9f2ff";case"MASTER":return"#ff1493";default:return"#ffffff"}},oM=({myPlayer:t,opponentPlayer:e,isFirstPlayer:n,onComplete:r,scale:s=1,onVsImpact:i,onCoinToss:o,onImpact:l,onOrbLand:c,onFadeInBoard:d,isMobile:u=!1,isRankedMatch:h=!1,myRank:f,opponentRank:b})=>{const[C,k]=P.useState("fade-in"),[A,R]=P.useState(!1),{isLightMode:m}=_2(),T=sM(m),[L,g]=P.useState(1),[H,Q]=P.useState(1),[W,G]=P.useState(0),[de,fe]=P.useState(0),[Ee,ae]=P.useState(1),[he,be]=P.useState({myX:0,myY:0,opX:0,opY:0}),[v,_]=P.useState(0),[x,I]=P.useState(0),[y,O]=P.useState([]),N=P.useMemo(()=>{const Ae=window.innerWidth,Se=window.innerHeight,Pe=s,et=(u?280:340)*Pe,at=Ae-et,nt=et+at/2,Ue=nt,Pt=Se- -20*Pe-Vh*Pe/2,lt=nt,Ot=-20*Pe+Vh*Pe/2;return{player:{x:Ue,y:Pt},opponent:{x:lt,y:Ot},leaderSize:Vh*Pe}},[u,s]),ne=P.useMemo(()=>{const Ae=window.innerWidth,Se=window.innerHeight,Pe=Ae*.25,et=Se*.5,at=Ae*.75,nt=Se*.5;return{myX:Pe,myY:et,opX:at,opY:nt}},[]),B=m?`0 0 ${10*s}px rgba(103, 232, 249, 0.8)`:`0 0 ${15*s}px rgba(103, 232, 249, 1), 0 0 ${30*s}px rgba(34, 211, 238, 0.8), 0 0 ${60*s}px rgba(6, 182, 212, 0.5)`,ye=m?`0 0 ${10*s}px rgba(249, 168, 212, 0.8)`:`0 0 ${15*s}px rgba(249, 168, 212, 1), 0 0 ${30*s}px rgba(244, 114, 182, 0.8), 0 0 ${60*s}px rgba(236, 72, 153, 0.5)`,te=T.enableGlowPulse?"glowPulse 2s ease-in-out infinite":"none";P.useEffect(()=>{const Ae={"fade-in":500,"leaders-enter":1200,nameplate:800,"vs-display":1500,"coin-toss":1500,"turn-order":1e3,"leader-to-orb":800,"orb-pause":1e3,"orb-fly":900,"leader-appear":600};if(C==="complete"){d==null||d();const et=setTimeout(()=>{r()},700);return()=>clearTimeout(et)}const Se={"fade-in":"leaders-enter","leaders-enter":"nameplate",nameplate:"vs-display","vs-display":"coin-toss","coin-toss":"turn-order","turn-order":"leader-to-orb","leader-to-orb":"orb-pause","orb-pause":"orb-fly","orb-fly":"leader-appear","leader-appear":"complete"},Pe=setTimeout(()=>{const et=Se[C];et&&k(et)},Ae[C]||1e3);return()=>clearTimeout(Pe)},[C,r,n]),P.useEffect(()=>{if(C==="vs-display"){const Ae=setTimeout(()=>{R(!0),i==null||i(),setTimeout(()=>R(!1),300)},800);return()=>clearTimeout(Ae)}},[C,i]),P.useEffect(()=>{C==="coin-toss"&&(o==null||o())},[C,o]),P.useEffect(()=>{if(C==="leaders-enter"){const Ae=setTimeout(()=>{l==null||l()},1e3);return()=>clearTimeout(Ae)}},[C,l]),P.useEffect(()=>{C==="nameplate"&&(l==null||l())},[C,l]),P.useEffect(()=>{if(C==="leader-to-orb"){const Se=Date.now();let Pe;const et=()=>{const at=Date.now()-Se,nt=Math.min(at/800,1),Ue=1-Math.pow(1-nt,3);g(1-Ue*.7),Q(1-Ue),G(Ue*1.5),fe(Math.min(Ue*1.5,1)),nt<1&&(Pe=requestAnimationFrame(et))};return be(ne),Pe=requestAnimationFrame(et),()=>cancelAnimationFrame(Pe)}},[C,ne]),P.useEffect(()=>{if(C==="orb-pause"){const Se=Date.now();let Pe;const et=()=>{const at=Date.now()-Se,nt=Math.min(at/800,1);ae(1-nt),nt<1&&(Pe=requestAnimationFrame(et))};return Pe=requestAnimationFrame(et),()=>cancelAnimationFrame(Pe)}},[C]),P.useEffect(()=>{if(C==="orb-fly"){const Se=Date.now();let Pe;const et=ne.myX,at=ne.myY,nt=ne.opX,Ue=ne.opY,Pt=N.player.x,lt=N.player.y,Ot=N.opponent.x,vt=N.opponent.y,ct=()=>{const wt=Date.now()-Se,Lt=Math.min(wt/900,1),Oe=Lt*Lt*Lt,Bt=et-200*s,xt=(at+lt)/2+100*s,me=(1-Oe)*(1-Oe)*et+2*(1-Oe)*Oe*Bt+Oe*Oe*Pt,qe=(1-Oe)*(1-Oe)*at+2*(1-Oe)*Oe*xt+Oe*Oe*lt,Wt=nt+200*s,It=(Ue+vt)/2-100*s,Zt=(1-Oe)*(1-Oe)*nt+2*(1-Oe)*Oe*Wt+Oe*Oe*Ot,es=(1-Oe)*(1-Oe)*Ue+2*(1-Oe)*Oe*It+Oe*Oe*vt;be({myX:me,myY:qe,opX:Zt,opY:es}),G(1.5-Oe*1),Lt<1&&(Pe=requestAnimationFrame(ct))};return Pe=requestAnimationFrame(ct),()=>cancelAnimationFrame(Pe)}},[C,ne,N,s]),P.useEffect(()=>{if(C==="leader-appear"){const Se=Date.now();let Pe;c==null||c(),R(!0),setTimeout(()=>R(!1),300);const et=N.player.x,at=N.player.y,nt=N.opponent.x,Ue=N.opponent.y,Pt=24,lt=[];for(let ct=0;ct<Pt;ct++){const wt=ct/Pt*360+(Math.random()-.5)*15;lt.push({id:ct,x:et,y:at,angle:wt,dist:80+Math.random()*120,size:8+Math.random()*12,delay:Math.random()*.1,color:`hsl(${200+Math.random()*40}, 80%, ${60+Math.random()*20}%)`})}for(let ct=0;ct<Pt;ct++){const wt=ct/Pt*360+(Math.random()-.5)*15;lt.push({id:Pt+ct,x:nt,y:Ue,angle:wt,dist:80+Math.random()*120,size:8+Math.random()*12,delay:Math.random()*.1,color:`hsl(${0+Math.random()*30}, 80%, ${55+Math.random()*20}%)`})}O(lt);const Ot=setTimeout(()=>{O([])},800),vt=()=>{const ct=Date.now()-Se,wt=Math.min(ct/600,1),Lt=1-Math.pow(1-wt,3);fe(1-Lt),_(Lt),I(Lt),wt<1&&(Pe=requestAnimationFrame(vt))};return Pe=requestAnimationFrame(vt),()=>{cancelAnimationFrame(Pe),clearTimeout(Ot)}}},[C,c,N]);const xe=["fade-in","leaders-enter","nameplate","vs-display","coin-toss","turn-order","leader-to-orb","orb-pause","orb-fly","leader-appear","complete"].indexOf(C),J=xe>=3&&xe<=9,V=xe>=0&&xe<=7,Qe=`polygon(0 0, ${50+yr}% 0, ${50-yr}% 100%, 0 100%)`,tt=`polygon(${50+yr}% 0, 100% 0, 100% 100%, ${50-yr}% 100%)`;return a.jsxs("div",{style:{position:"fixed",inset:0,background:xe>=7?"transparent":"#0a0a0f",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",overflow:xe>=6?"visible":"hidden",animation:A?"screenShake 0.3s ease-in-out":void 0,pointerEvents:xe>=9?"none":"auto"},children:[a.jsx("div",{style:{position:"absolute",inset:0,background:"black",opacity:C==="fade-in"?1:0,transition:"opacity 0.5s ease-out",pointerEvents:"none",zIndex:1e4}}),V&&a.jsxs("div",{style:{opacity:Ee,transition:"opacity 0.3s"},children:[xe>=0&&a.jsxs("div",{style:{position:"absolute",inset:0,clipPath:Qe,background:"linear-gradient(135deg, #0a1628 0%, #1a2a4a 50%, #0d1a30 100%)",transform:`translateX(${xe>=1?"0":"-100%"})`,transition:"transform 1.2s cubic-bezier(0.22, 1, 0.36, 1)",zIndex:50,overflow:"hidden"},children:[a.jsx("div",{style:{position:"fixed",top:"50%",left:"25%",transform:"translate(-50%, -50%)",opacity:H},children:a.jsx("img",{src:_d(t.class),alt:t.name,style:{height:"120vh",width:"auto",objectFit:"cover",objectPosition:t.class==="AJA"?"center top":"center",filter:"brightness(0.85) contrast(1.1)",transform:`scale(${L})`,transformOrigin:"center center"}})}),a.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(135deg, rgba(59, 130, 246, 0.3) 0%, transparent 60%)",pointerEvents:"none"}}),xe>=2&&xe<6&&a.jsxs("div",{style:{position:"absolute",bottom:"12%",left:"15%",padding:`${16*s}px ${40*s}px`,background:"rgba(0,0,0,0.85)",borderRadius:8*s,borderLeft:"4px solid #3b82f6",animation:"nameplateSlideUp 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)",whiteSpace:"nowrap",boxShadow:"0 4px 30px rgba(59, 130, 246, 0.4)"},children:[a.jsx("div",{style:{color:"white",fontSize:2.2*s+"rem",fontWeight:"bold",textShadow:"0 0 20px rgba(59, 130, 246, 0.8)"},children:t.name}),h&&f&&a.jsx("div",{style:{color:bd(f),fontSize:1.2*s+"rem",fontWeight:"bold",textShadow:`0 0 10px ${bd(f)}80`,marginTop:`${4*s}px`},children:or[f]})]}),xe>=5&&xe<6&&a.jsx("div",{style:{position:"absolute",top:"10%",left:"15%",padding:`${12*s}px ${32*s}px`,background:n?"rgba(239, 68, 68, 0.9)":"rgba(59, 130, 246, 0.9)",borderRadius:8*s,animation:"turnOrderFadeIn 1s ease-out",boxShadow:n?"0 0 30px rgba(239, 68, 68, 0.6)":"0 0 30px rgba(59, 130, 246, 0.6)"},children:a.jsx("div",{style:{color:"white",fontSize:1.8*s+"rem",fontWeight:"bold",letterSpacing:"0.1em"},children:n?"":""})})]}),xe>=0&&a.jsxs("div",{style:{position:"absolute",inset:0,clipPath:tt,background:"linear-gradient(225deg, #280a0a 0%, #4a1a1a 50%, #300d0d 100%)",transform:`translateX(${xe>=1?"0":"100%"})`,transition:"transform 1.2s cubic-bezier(0.22, 1, 0.36, 1)",zIndex:50,overflow:"hidden"},children:[a.jsx("div",{style:{position:"fixed",top:"50%",left:"75%",transform:"translate(-50%, -50%)",opacity:H},children:a.jsx("img",{src:_d(e.class),alt:e.name,style:{height:"120vh",width:"auto",objectFit:"cover",objectPosition:e.class==="AJA"?"center top":"center",filter:"brightness(0.85) contrast(1.1)",transform:`scale(${L})`,transformOrigin:"center center"}})}),a.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(225deg, rgba(239, 68, 68, 0.3) 0%, transparent 60%)",pointerEvents:"none"}}),xe>=2&&xe<6&&a.jsxs("div",{style:{position:"absolute",bottom:"12%",right:"15%",padding:`${16*s}px ${40*s}px`,background:"rgba(0,0,0,0.85)",borderRadius:8*s,borderRight:"4px solid #ef4444",animation:"nameplateSlideUp 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)",whiteSpace:"nowrap",boxShadow:"0 4px 30px rgba(239, 68, 68, 0.4)"},children:[a.jsx("div",{style:{color:"white",fontSize:2.2*s+"rem",fontWeight:"bold",textShadow:"0 0 20px rgba(239, 68, 68, 0.8)"},children:e.name}),h&&b&&a.jsx("div",{style:{color:bd(b),fontSize:1.2*s+"rem",fontWeight:"bold",textShadow:`0 0 10px ${bd(b)}80`,marginTop:`${4*s}px`},children:or[b]})]}),xe>=5&&xe<6&&a.jsx("div",{style:{position:"absolute",top:"10%",right:"15%",padding:`${12*s}px ${32*s}px`,background:n?"rgba(59, 130, 246, 0.9)":"rgba(239, 68, 68, 0.9)",borderRadius:8*s,animation:"turnOrderFadeIn 1s ease-out",boxShadow:n?"0 0 30px rgba(59, 130, 246, 0.6)":"0 0 30px rgba(239, 68, 68, 0.6)"},children:a.jsx("div",{style:{color:"white",fontSize:1.8*s+"rem",fontWeight:"bold",letterSpacing:"0.1em"},children:n?"":""})})]}),xe>=1&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{position:"absolute",top:0,left:0,width:4*s,height:"100%",background:"linear-gradient(180deg, #67e8f9 0%, #22d3ee 30%, #06b6d4 50%, #22d3ee 70%, #67e8f9 100%)",boxShadow:B,zIndex:100,animation:te}}),a.jsx("div",{style:{position:"absolute",top:0,left:0,width:`calc(${50+yr}% + ${2*s}px)`,height:4*s,background:"linear-gradient(90deg, #67e8f9 0%, #22d3ee 30%, #06b6d4 50%, #22d3ee 70%, #67e8f9 100%)",boxShadow:B,zIndex:100,animation:te}}),a.jsx("div",{style:{position:"absolute",bottom:0,left:0,width:`calc(${50-yr}% + ${2*s}px)`,height:4*s,background:"linear-gradient(90deg, #67e8f9 0%, #22d3ee 30%, #06b6d4 50%, #22d3ee 70%, #67e8f9 100%)",boxShadow:B,zIndex:100,animation:te}}),a.jsxs("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:100,pointerEvents:"none",overflow:"visible"},children:[a.jsxs("defs",{children:[a.jsxs("linearGradient",{id:"cyanGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[a.jsx("stop",{offset:"0%",stopColor:"#67e8f9"}),a.jsx("stop",{offset:"30%",stopColor:"#22d3ee"}),a.jsx("stop",{offset:"50%",stopColor:"#06b6d4"}),a.jsx("stop",{offset:"70%",stopColor:"#22d3ee"}),a.jsx("stop",{offset:"100%",stopColor:"#67e8f9"})]}),a.jsxs("filter",{id:"cyanGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{stdDeviation:T.blurAmount,result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),a.jsx("line",{x1:`${50+yr-.2}%`,y1:"0",x2:`${50-yr-.2}%`,y2:"100%",stroke:"url(#cyanGradient)",strokeWidth:4*s,filter:m?void 0:"url(#cyanGlow)",style:{animation:te}})]})]}),xe>=1&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{position:"absolute",top:0,right:0,width:4*s,height:"100%",background:"linear-gradient(180deg, #f9a8d4 0%, #f472b6 30%, #ec4899 50%, #f472b6 70%, #f9a8d4 100%)",boxShadow:ye,zIndex:100,animation:te,animationDelay:"0.3s"}}),a.jsx("div",{style:{position:"absolute",top:0,right:0,width:`calc(${50-yr}% + ${2*s}px)`,height:4*s,background:"linear-gradient(90deg, #f9a8d4 0%, #f472b6 30%, #ec4899 50%, #f472b6 70%, #f9a8d4 100%)",boxShadow:ye,zIndex:100,animation:te,animationDelay:"0.3s"}}),a.jsx("div",{style:{position:"absolute",bottom:0,right:0,width:`calc(${50+yr}% + ${2*s}px)`,height:4*s,background:"linear-gradient(90deg, #f9a8d4 0%, #f472b6 30%, #ec4899 50%, #f472b6 70%, #f9a8d4 100%)",boxShadow:ye,zIndex:100,animation:te,animationDelay:"0.3s"}}),a.jsxs("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:100,pointerEvents:"none",overflow:"visible"},children:[a.jsxs("defs",{children:[a.jsxs("linearGradient",{id:"pinkGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[a.jsx("stop",{offset:"0%",stopColor:"#f9a8d4"}),a.jsx("stop",{offset:"30%",stopColor:"#f472b6"}),a.jsx("stop",{offset:"50%",stopColor:"#ec4899"}),a.jsx("stop",{offset:"70%",stopColor:"#f472b6"}),a.jsx("stop",{offset:"100%",stopColor:"#f9a8d4"})]}),a.jsxs("filter",{id:"pinkGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{stdDeviation:T.blurAmount,result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),a.jsx("line",{x1:`${50+yr+.2}%`,y1:"0",x2:`${50-yr+.2}%`,y2:"100%",stroke:"url(#pinkGradient)",strokeWidth:4*s,filter:m?void 0:"url(#pinkGlow)",style:{animation:te,animationDelay:"0.3s"}})]})]})]}),xe>=6&&xe<=9&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{position:"fixed",left:he.myX,top:he.myY,transform:`translate(-50%, -50%) scale(${W})`,opacity:de,width:400*s,height:400*s,borderRadius:"50%",background:m?"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(100,180,255,0.9) 15%, rgba(59,130,246,0.6) 30%, rgba(59,130,246,0.2) 50%, transparent 70%)":"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(100,180,255,0.9) 12%, rgba(59,130,246,0.7) 25%, rgba(59,130,246,0.4) 40%, rgba(59,130,246,0.15) 60%, transparent 80%)",zIndex:500,pointerEvents:"none"}}),a.jsx("div",{style:{position:"fixed",left:he.opX,top:he.opY,transform:`translate(-50%, -50%) scale(${W})`,opacity:de,width:400*s,height:400*s,borderRadius:"50%",background:m?"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(255,150,150,0.9) 15%, rgba(239,68,68,0.6) 30%, rgba(239,68,68,0.2) 50%, transparent 70%)":"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(255,150,150,0.9) 12%, rgba(239,68,68,0.7) 25%, rgba(239,68,68,0.4) 40%, rgba(239,68,68,0.15) 60%, transparent 80%)",zIndex:500,pointerEvents:"none"}})]}),xe>=9&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{position:"fixed",left:N.player.x,top:N.player.y,transform:`translate(-50%, -50%) scale(${v})`,opacity:x,width:N.leaderSize,height:N.leaderSize,borderRadius:"50%",overflow:"hidden",border:"4px solid #3182ce",boxShadow:"0 0 20px rgba(49, 130, 206, 0.4)",background:"#1a202c",zIndex:500,pointerEvents:"none"},children:a.jsx("img",{src:_d(t.class),alt:t.name,style:{width:"100%",height:"100%",objectFit:"cover",objectPosition:t.class==="AJA"?"center top":"center"}})}),a.jsx("div",{style:{position:"fixed",left:N.opponent.x,top:N.opponent.y,transform:`translate(-50%, -50%) scale(${v})`,opacity:x,width:N.leaderSize,height:N.leaderSize,borderRadius:"50%",overflow:"hidden",border:"4px solid #c53030",boxShadow:"0 0 20px rgba(197, 48, 48, 0.4)",background:"#1a202c",zIndex:500,pointerEvents:"none"},children:a.jsx("img",{src:_d(e.class),alt:e.name,style:{width:"100%",height:"100%",objectFit:"cover",objectPosition:e.class==="AJA"?"center top":"center"}})})]}),y.map(Ae=>a.jsx("div",{style:{position:"fixed",left:Ae.x,top:Ae.y,width:Ae.size*s,height:Ae.size*s,borderRadius:"50%",background:Ae.color,boxShadow:`0 0 ${Ae.size*.5*s}px ${Ae.color}`,pointerEvents:"none",zIndex:600,animation:`landingParticleBurst 0.6s ease-out ${Ae.delay}s forwards`,transform:"translate(-50%, -50%)","--particle-angle":`${Ae.angle}deg`,"--particle-dist":`${Ae.dist*s}px`}},Ae.id)),J&&a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",animation:xe===3?"vsZoomIn 1.5s cubic-bezier(0.34, 1.56, 0.64, 1)":void 0,opacity:xe>=7?Math.max(0,Ee):1,zIndex:200,pointerEvents:"none"},children:a.jsx("img",{src:iM,alt:"VS",style:{height:300*s,width:"auto",filter:`drop-shadow(0 0 ${20*s}px rgba(255,255,255,0.8)) drop-shadow(0 0 ${40*s}px rgba(255,255,255,0.6))`}})}),xe>=4&&xe<5&&a.jsx("div",{style:{position:"absolute",top:"20%",left:"50%",transform:"translate(-50%, -50%)",zIndex:150},children:a.jsx("div",{style:{width:100*s,height:100*s,borderRadius:"50%",background:"linear-gradient(45deg, #f6ad55 0%, #fbd38d 100%)",border:"4px solid white",display:"flex",alignItems:"center",justifyContent:"center",fontSize:2*s+"rem",fontWeight:"bold",color:"white",animation:"coinFlip 1.5s ease-in-out",boxShadow:`0 0 ${30*s}px rgba(246, 173, 85, 0.8)`},children:""})}),a.jsx("style",{children:`
                @keyframes screenShake {
                    0%, 100% { transform: translate(0, 0); }
                    10% { transform: translate(-10px, -10px); }
                    20% { transform: translate(10px, 10px); }
                    30% { transform: translate(-10px, 10px); }
                    40% { transform: translate(10px, -10px); }
                    50% { transform: translate(-10px, -10px); }
                    60% { transform: translate(10px, 10px); }
                    70% { transform: translate(-10px, 10px); }
                    80% { transform: translate(10px, -10px); }
                    90% { transform: translate(-10px, 0); }
                }

                @keyframes nameplateSlideUp {
                    0% {
                        transform: translateY(50px);
                        opacity: 0;
                    }
                    60% {
                        transform: translateY(-10px);
                    }
                    100% {
                        transform: translateY(0);
                        opacity: 1;
                    }
                }

                @keyframes vsZoomIn {
                    0% {
                        transform: translate(-50%, -50%) scale(3) translateZ(0);
                        opacity: 0;
                        filter: blur(20px);
                    }
                    50% {
                        transform: translate(-50%, -50%) scale(1.2) translateZ(0);
                        opacity: 1;
                        filter: blur(0px);
                    }
                    100% {
                        transform: translate(-50%, -50%) scale(1) translateZ(0);
                        opacity: 1;
                        filter: blur(0px);
                    }
                }

                @keyframes coinFlip {
                    0% {
                        transform: rotateY(0deg) scale(1);
                    }
                    50% {
                        transform: rotateY(1800deg) scale(1.2);
                    }
                    100% {
                        transform: rotateY(3600deg) scale(1);
                    }
                }

                @keyframes turnOrderFadeIn {
                    0% {
                        opacity: 0;
                        transform: scale(0.5);
                    }
                    50% {
                        transform: scale(1.2);
                    }
                    100% {
                        opacity: 1;
                        transform: scale(1);
                    }
                }

                @keyframes glowPulse {
                    0%, 100% {
                        opacity: 0.8;
                        filter: brightness(1);
                    }
                    50% {
                        opacity: 1;
                        filter: brightness(1.3);
                    }
                }

                @keyframes landingParticleBurst {
                    0% {
                        transform: translate(-50%, -50%) rotate(var(--particle-angle)) translateX(0);
                        opacity: 1;
                    }
                    100% {
                        transform: translate(-50%, -50%) rotate(var(--particle-angle)) translateX(var(--particle-dist));
                        opacity: 0;
                    }
                }
            `})]})},aM=({isVictory:t,loserLeaderRef:e,onComplete:n,onPhaseChange:r,onShakeIntensityChange:s,scale:i=1})=>{const[o,l]=P.useState("start"),[c,d]=P.useState(null),[u,h]=P.useState([]);P.useEffect(()=>{if(e.current){const b=e.current.getBoundingClientRect();d({x:b.left+b.width/2,y:b.top+b.height/2,size:b.width})}},[e]),P.useEffect(()=>{r==null||r(o)},[o,r]),P.useEffect(()=>{const b={start:200,zoom:600,"white-fade":800,explode:1200,"result-text":1800,"fade-out":600};if(o==="complete"){n();return}const C={start:"zoom",zoom:"white-fade","white-fade":"explode",explode:"result-text","result-text":"fade-out","fade-out":"complete"},k=setTimeout(()=>{const A=C[o];A&&l(A)},b[o]||1e3);return()=>clearTimeout(k)},[o,n]),P.useEffect(()=>{if(o==="explode"&&c){const C=Array.from({length:60},(m,T)=>{const L=T/60*360,g=(Math.random()-.5)*12,H=L+g,Q=150+Math.random()*250,W=12+Math.random()*20;return{id:T,x:c.x,y:c.y,angle:H,distance:Q,size:W,delay:Math.random()*.1,duration:.6+Math.random()*.4}});h(C),s==null||s(1);const k=1e3,A=Date.now(),R=setInterval(()=>{const T=(Date.now()-A)/k;if(T>=1)s==null||s(0),clearInterval(R);else{const L=1-Math.pow(T,2);s==null||s(L)}},16);return()=>clearInterval(R)}},[o,c,s]);const f=["start","zoom","white-fade","explode","result-text","fade-out","complete"].indexOf(o);return c?a.jsxs("div",{style:{position:"fixed",inset:0,zIndex:8e3,pointerEvents:"none",overflow:"hidden"},children:[a.jsx("div",{style:{position:"absolute",inset:0,background:"black",opacity:f>=1?f>=5?1:.5:0,transition:"opacity 0.5s ease-out"}}),f>=1&&f<4&&a.jsx("div",{style:{position:"absolute",left:c.x,top:c.y,transform:"translate(-50%, -50%)",width:c.size*1.8,height:c.size*1.8,borderRadius:"50%",background:"radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 60%)",transition:"all 0.4s ease-out"}}),f>=3&&u.map(b=>a.jsx("div",{style:{position:"absolute",left:b.x,top:b.y,width:b.size*i,height:b.size*i,borderRadius:"50%",background:"white",boxShadow:"0 0 15px white, 0 0 30px rgba(255,255,255,0.5)",transform:"translate(-50%, -50%)",animation:`particleFly-${b.id} ${b.duration}s ease-out ${b.delay}s forwards`}},b.id)),f>=3&&a.jsx("style",{children:u.map(b=>{const C=b.angle*Math.PI/180,k=Math.cos(C)*b.distance,A=Math.sin(C)*b.distance;return`
                            @keyframes particleFly-${b.id} {
                                0% {
                                    transform: translate(-50%, -50%) scale(1);
                                    opacity: 1;
                                }
                                100% {
                                    transform: translate(calc(-50% + ${k}px), calc(-50% + ${A}px)) scale(0);
                                    opacity: 0;
                                }
                            }
                        `}).join(`
`)}),f>=4&&f<6&&a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",animation:"resultTextPop 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)"},children:a.jsx("div",{style:{fontSize:`${7*i}rem`,fontWeight:900,fontFamily:"Tamanegi, sans-serif",color:t?"#ffd700":"#718096",textShadow:t?"0 0 30px rgba(255,215,0,0.8), 0 0 60px rgba(255,215,0,0.6), 0 0 90px rgba(255,215,0,0.4), 4px 4px 8px rgba(0,0,0,0.8)":"0 0 20px rgba(113,128,150,0.5), 4px 4px 8px rgba(0,0,0,0.8)",letterSpacing:"0.15em"},children:t?"":"..."})}),a.jsx("style",{children:`
                @keyframes resultTextPop {
                    0% {
                        transform: translate(-50%, -50%) scale(2.5);
                        opacity: 0;
                        filter: blur(20px);
                    }
                    60% {
                        transform: translate(-50%, -50%) scale(0.95);
                        opacity: 1;
                        filter: blur(0px);
                    }
                    100% {
                        transform: translate(-50%, -50%) scale(1);
                        opacity: 1;
                        filter: blur(0px);
                    }
                }
            `})]}):null},lM=({isMyTurn:t,turnCount:e,activePlayerId:n,onTimeUp:r,timerEnabled:s,isGameOver:i=!1,isPaused:o=!1,scale:l=1,buttonSize:c=160,timerDuration:d=60})=>{const[u,h]=P.useState(d),[f,b]=P.useState(!1),[C,k]=P.useState(!1),A=P.useRef(null),R=P.useRef(""),m=P.useRef(0),T=P.useRef(r),L=P.useRef(!1),g=P.useId().replace(/:/g,"_");P.useEffect(()=>{T.current=r},[r]);const H=`${e}-${n}`,Q=P.useCallback(()=>{h(d),b(!1),k(!1),m.current=Date.now()+d*1e3,L.current=!1},[d]);if(P.useEffect(()=>{H!==R.current&&(R.current=H,Q())},[H,Q]),P.useEffect(()=>{if(!s||!t||i||o){A.current&&(clearInterval(A.current),A.current=null);return}return m.current===0&&(m.current=Date.now()+d*1e3),A.current=window.setInterval(()=>{const I=Date.now(),y=Math.max(0,(m.current-I)/1e3);h(y);const O=Math.ceil(y);O<=15&&O>10?(b(!0),k(!1)):O<=10?(b(!0),k(!0)):(b(!1),k(!1)),y<=0&&!L.current&&(L.current=!0,A.current&&(clearInterval(A.current),A.current=null),setTimeout(()=>T.current(),0))},16),()=>{A.current&&(clearInterval(A.current),A.current=null)}},[s,t,i,o,d]),!s||o)return null;const W=u/d,G=(c/2+12)*l,de=6*l,fe=2*Math.PI*G,Ee=-fe*(1-W),ae=Math.ceil(u),he=C?Math.min(1,(10-ae)/10):0,be=Math.max(.05,.15-he*.1);let v="#4299e1";f&&!C?v="#f6ad55":C&&(v="#e53e3e");const _=20*l,x=G*2+de+_*2;return a.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:x,height:x,pointerEvents:"none",zIndex:10,animation:C?`timerShake${g} ${be}s ease-in-out infinite`:void 0},children:[a.jsxs("svg",{width:x,height:x,style:{position:"absolute",top:0,left:0,overflow:"visible"},children:[a.jsx("circle",{cx:x/2,cy:x/2,r:G,fill:"none",stroke:"rgba(0,0,0,0.3)",strokeWidth:de}),a.jsx("circle",{cx:x/2,cy:x/2,r:G,fill:"none",stroke:v,strokeWidth:de,strokeLinecap:"round",strokeDasharray:fe,strokeDashoffset:Ee,style:{transform:"rotate(-90deg)",transformOrigin:"center"}}),f&&a.jsx("circle",{cx:x/2,cy:x/2,r:G,fill:"none",stroke:v,strokeWidth:de*3,opacity:.4,style:{filter:`blur(${12*l}px)`,animation:C?`timerPulse${g} 0.5s ease-in-out infinite`:`timerPulse${g} 1s ease-in-out infinite`}})]}),a.jsx("style",{children:`
                @keyframes timerPulse${g} {
                    0%, 100% { opacity: 0.4; }
                    50% { opacity: 0.7; }
                }
                @keyframes timerShake${g} {
                    0%, 100% { transform: translate(-50%, -50%) translate(0, 0); }
                    25% { transform: translate(-50%, -50%) translate(${2*l}px, ${-2*l}px); }
                    50% { transform: translate(-50%, -50%) translate(${-2*l}px, ${2*l}px); }
                    75% { transform: translate(-50%, -50%) translate(${2*l}px, ${1*l}px); }
                }
            `})]})};function cM(t,e){const[n,r]=P.useState(null),[s,i]=P.useState(""),[o,l]=P.useState(!1),[c,d]=P.useState(null),[u,h]=P.useState(!1);return P.useEffect(()=>{if(t==="CPU")return;const f=new x2;return h(!0),(async()=>{try{const C=await f.connect(t==="JOIN"?e:void 0);i(C),r(f),f.onConnection(()=>{console.log("[useGameNetwork] Connection established!"),l(!0),h(!1)})}catch(C){d(C.toString()),h(!1)}})(),()=>{f.disconnect()}},[t,e]),{adapter:n,myId:s,connected:o,connecting:u,error:c,setConnected:l}}function Xx(t,e,n){return!(!t.canEvolveThisTurn||t.evolutionsUsed>=2||e<(n?5:4))}function Jx(t,e,n){return!(!t.canEvolveThisTurn||t.sep<=0||e<(n?7:6))}const ot=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},dM=ot("/leaders/azya_leader.png"),uM=ot("/leaders/senka_leader.png"),fM=ot("/leaders/yoRuka_leader.png"),hM=ot("/sleeves/azya_sleeve.png"),pM=ot("/sleeves/senka_sleeve.png"),gM=ot("/sleeves/yoruka_sleeve.png"),kl=t=>t==="YORUKA"?fM:t==="AJA"?dM:uM,Ci=t=>t==="YORUKA"?gM:t==="AJA"?hM:pM,mM=1920,b2=1080,yM=()=>{const[t,e]=P.useState({scale:1,toGameX:r=>r,toGameY:r=>r}),n=P.useCallback(()=>{const r=window.visualViewport?window.visualViewport.width:window.innerWidth,s=window.visualViewport?window.visualViewport.height:window.innerHeight;let i=Math.min(r/mM,s/b2);i*=1.5,e({scale:i,toGameX:c=>c,toGameY:c=>c})},[]);return P.useEffect(()=>{n(),window.addEventListener("resize",n),window.addEventListener("orientationchange",()=>{setTimeout(n,150)}),window.visualViewport&&window.visualViewport.addEventListener("resize",n);const r=()=>{document.visibilityState==="visible"&&setTimeout(n,100)};return document.addEventListener("visibilitychange",r),()=>{window.removeEventListener("resize",n),window.removeEventListener("orientationchange",n),window.visualViewport&&window.visualViewport.removeEventListener("resize",n),document.removeEventListener("visibilitychange",r)}},[n]),t},bn=90,Nn=120,ki=bn+18,ko=240,vM=({x:t,y:e,onComplete:n,scale:r=1})=>{j.useEffect(()=>{const i=setTimeout(n,2e3);return()=>clearTimeout(i)},[n]);const s=j.useMemo(()=>Array(20).fill(0).map((i,o)=>({id:o,angle:Math.random()*360,dist:(30+Math.random()*60)*r,size:(10+Math.random()*15)*r,delay:Math.random()*.5})),[r]);return a.jsxs("div",{style:{position:"absolute",left:t,top:e,pointerEvents:"none",zIndex:6e3},children:[a.jsx("style",{children:`
                @keyframes healGlowFade {
                    0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; filter: blur(10px); }
                    30% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.8; filter: blur(15px); }
                    100% { transform: translate(-50%, -50%) scale(1.6); opacity: 0; filter: blur(30px); }
                }
                @keyframes healParticleRise {
                    0% { transform: translate(-50%, -50%) rotate(var(--angle)) translate(0, 0) scale(0); opacity: 0; }
                    20% { transform: translate(-50%, -50%) rotate(var(--angle)) translate(0, 0) opacity: 0.7; }
                    100% { transform: translate(-50%, -50%) rotate(var(--angle)) translate(calc(var(--dist) * 1px), 0) scale(1.5); opacity: 0; }
                }
            `}),a.jsx("div",{style:{position:"absolute",left:0,top:0,width:150*r,height:150*r,background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(200,255,240,0.5) 50%, transparent 80%)",borderRadius:"50%",transform:"translate(-50%, -50%)",animation:"healGlowFade 1.5s ease-out forwards",filter:`blur(${8*r}px)`}}),s.map(i=>a.jsx("div",{style:{position:"absolute",left:0,top:0,width:i.size,height:i.size,background:"rgba(255,250,240,0.6)",borderRadius:"50%",filter:`blur(${4*r}px)`,"--angle":`${i.angle}deg`,"--dist":i.dist,animation:`healParticleRise 1.2s ease-out ${i.delay}s forwards`,pointerEvents:"none"}},i.id))]})},xM=({x:t,y:e,atkBuff:n,hpBuff:r,onComplete:s})=>{j.useEffect(()=>{const b=setTimeout(s,1500);return()=>clearTimeout(b)},[s]);const i=n<0||r<0,o=i?"radial-gradient(circle, rgba(180,50,50,0.9) 0%, rgba(150,30,30,0.4) 50%, transparent 80%)":"radial-gradient(circle, rgba(255,230,100,0.9) 0%, rgba(255,200,50,0.4) 50%, transparent 80%)",l=i?"#ff4444":"#ffd93d",c="#ffd93d",d="rgba(255,217,61,0.8)",u=b=>b>=0?`+${b}`:`${b}`,h=80,f=110;return a.jsxs("div",{style:{position:"absolute",left:t,top:e,pointerEvents:"none",zIndex:6e3},children:[a.jsx("style",{children:`
                @keyframes buffGlow {
                    0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
                    30% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
                    100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
                }
                @keyframes buffNumberRise {
                    0% { transform: translateY(0); opacity: 0; }
                    20% { opacity: 1; }
                    100% { transform: translateY(-30px); opacity: 0; }
                }
                @keyframes buffSparkle {
                    0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
                    50% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
                    100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
                }
            `}),a.jsx("div",{style:{position:"absolute",left:0,top:0,width:150,height:150,background:o,borderRadius:"50%",transform:"translate(-50%, -50%)",animation:"buffGlow 1.2s ease-out forwards",filter:"blur(8px)"}}),n!==0&&a.jsx("div",{style:{position:"absolute",left:-h/2+12,top:f/2-20,fontSize:"24px",fontWeight:"bold",color:c,textShadow:`0 0 10px ${d}, 2px 2px 4px rgba(0,0,0,0.8)`,fontFamily:"Tamanegi, sans-serif",animation:"buffNumberRise 1.2s ease-out forwards",textAlign:"center"},children:u(n)}),r!==0&&a.jsx("div",{style:{position:"absolute",left:h/2-28,top:f/2-20,fontSize:"24px",fontWeight:"bold",color:c,textShadow:`0 0 10px ${d}, 2px 2px 4px rgba(0,0,0,0.8)`,fontFamily:"Tamanegi, sans-serif",animation:"buffNumberRise 1.2s ease-out forwards",textAlign:"center"},children:u(r)}),[...Array(8)].map((b,C)=>a.jsx("div",{style:{position:"absolute",left:Math.cos(C*Math.PI/4)*60,top:Math.sin(C*Math.PI/4)*60,width:12,height:12,background:l,borderRadius:"50%",boxShadow:`0 0 10px ${l}, 0 0 20px ${l}`,animation:`buffSparkle 0.8s ease-out ${C*.1}s forwards`}},C))]})},_M=({x:t,y:e,onComplete:n,scale:r=1})=>(j.useEffect(()=>{const s=setTimeout(n,1200);return()=>clearTimeout(s)},[n]),a.jsxs("div",{style:{position:"absolute",left:t,top:e,transform:"translate(-50%, -50%)",width:130*r,height:130*r,pointerEvents:"none",zIndex:5e3,display:"flex",alignItems:"center",justifyContent:"center"},children:[a.jsx("div",{style:{fontSize:`${80*r}px`,animation:"baneSkullAppear 1.2s ease-out forwards",textShadow:`0 0 ${20*r}px #9b59b6, 0 0 ${40*r}px #8e44ad, 0 0 ${60*r}px #6c3483`,filter:`drop-shadow(0 0 ${15*r}px #9b59b6) hue-rotate(-10deg)`},children:""}),[...Array(12)].map((s,i)=>a.jsx("div",{style:{position:"absolute",left:"50%",top:"50%",width:6*r,height:6*r,background:"radial-gradient(circle, #9b59b6, #6c3483)",borderRadius:"50%",boxShadow:`0 0 ${8*r}px #9b59b6, 0 0 ${15*r}px #8e44ad`,animation:`baneParticle 1s ease-out ${i*.08}s forwards`,transform:`rotate(${i*30}deg) translateX(0)`}},i)),a.jsx("style",{children:`
                @keyframes baneSkullAppear {
                    0% { transform: scale(0) rotate(-30deg); opacity: 0; }
                    20% { transform: scale(1.3) rotate(10deg); opacity: 1; }
                    40% { transform: scale(1) rotate(-5deg); opacity: 1; }
                    60% { transform: scale(1.1) rotate(0deg); opacity: 1; }
                    80% { transform: scale(1) rotate(0deg); opacity: 0.8; }
                    100% { transform: scale(1.5) rotate(0deg); opacity: 0; }
                }
                @keyframes baneParticle {
                    0% { transform: rotate(0deg) translateX(0); opacity: 1; }
                    100% { transform: rotate(0deg) translateX(${70*r}px); opacity: 0; }
                }
            `})]})),bM=({type:t,x:e,y:n,onComplete:r,audioSettings:s,scale:i=1})=>{const o=j.useMemo(()=>{let f=8,b=8,C=100,k=256;return t==="SHOT"&&(k=128),{cols:f,rows:b,fps:C,size:k}},[t]);if(j.useEffect(()=>{const b=["LIGHTNING","THUNDER","IMPACT","SUMI","SHOT","ICE","WATER","RAY","FIRE","SLASH","BLUE_FIRE"].includes(t)?o.cols*o.rows/o.fps*1e3:t==="FIREBALL"?500:t==="HEAL"?2e3:400,C=setTimeout(r,b);return()=>clearTimeout(C)},[r,t,o]),j.useEffect(()=>{if(!s||!s.seEnabled)return;const f=(b,C=.5,k=0)=>{setTimeout(()=>{const A=new Audio(ot(`/se/${b}`));A.volume=(s.se||.5)*C,A.play().catch(R=>console.warn("SE Play prevented",R))},k)};t==="SHOT"?(f("shot.mp3",.6),f("hibi.mp3",.4,400)):t==="IMPACT"?(f("panch1.mp3",.6,100),f("panch2.mp3",.6,500)):t==="LIGHTNING"||t==="THUNDER"?f("thunder.mp3",.5):t==="FIREBALL"?f("explosion.mp3",.5):t==="FIRE"?f("fire.mp3",.5):t==="SLASH"?f("slash.mp3",.5):t==="ICE"?f("ice.mp3",.5):t==="WATER"?f("water.mp3",.5):t==="RAY"?f("ray.mp3",.6):t==="SUMI"?f("yami.mp3",.6):t==="HEAL"?f("heal.mp3",.6):t==="BLUE_FIRE"?f("fire.mp3",.5):t==="BANE"&&f("yami.mp3",.7)},[t,s]),t==="HEAL")return a.jsx(vM,{x:e,y:n,onComplete:r,scale:i});if(t==="BANE")return a.jsx(_M,{x:e,y:n,onComplete:r,scale:i});const l=100*i,c={position:"absolute",left:e,top:n,transform:"translate(-50%, -50%)",width:l,height:l,pointerEvents:"none",zIndex:5e3,display:"flex",alignItems:"center",justifyContent:"center"};if(["LIGHTNING","THUNDER","IMPACT","SUMI","SHOT","ICE","WATER","RAY","FIRE","SLASH","BLUE_FIRE"].includes(t)){let f=ot("/effects/thunder.png");t==="IMPACT"&&(f=ot("/effects/impact.png")),t==="SUMI"&&(f=ot("/effects/sumi.png")),t==="SHOT"&&(f=ot("/effects/shot.png")),t==="ICE"&&(f=ot("/effects/ice.png")),t==="WATER"&&(f=ot("/effects/water.png")),t==="RAY"&&(f=ot("/effects/ray.png")),t==="FIRE"&&(f=ot("/effects/fire.png")),t==="SLASH"&&(f=ot("/effects/slash.png")),t==="BLUE_FIRE"&&(f=ot("/effects/blue_fire.png"));const b=o.cols*o.rows,C=Math.min(160,o.size)*i;return a.jsxs("div",{style:{...c,width:C,height:C,transform:`${(c==null?void 0:c.transform)||""}`},children:[a.jsx("div",{style:{width:"100%",height:"100%",backgroundImage:`url(${f})`,backgroundSize:`${o.cols*100}% ${o.rows*100}%`,animation:`spriteAnimation ${b/o.fps}s steps(1) forwards`}}),a.jsx("style",{children:`
                    @keyframes spriteAnimation {
                        ${Array.from({length:b}).map((k,A)=>{const R=A%o.cols,m=Math.floor(A/o.cols),T=R*(100/(o.cols-1)),L=m*(100/(o.rows-1));return`${A/(b-1)*100}% { background-position: ${T}% ${L}%; }`}).join(`
`)}
                    }
                `})]})}let u="",h="";if(t==="FIREBALL")u=ot("/effects/fireball.png"),h="explode 0.5s ease-out forwards";else if(t==="BEAM")return a.jsx("div",{style:{position:"fixed",left:e,top:n,width:400,height:30,background:"linear-gradient(90deg, transparent, #faf089, #fff, #faf089, transparent)",transform:"translate(-50%, -50%) rotate(-45deg)",boxShadow:"0 0 20px #faf089",opacity:0,animation:"beamShoot 0.4s ease-out forwards",pointerEvents:"none",zIndex:5e3},children:a.jsx("style",{children:`
                    @keyframes beamShoot {
                        0% { width: 0; opacity: 1; transform: translate(-50%, -50%) rotate(-45deg) scaleX(0); }
                        20% { width: 400px; opacity: 1; transform: translate(-50%, -50%) rotate(-45deg) scaleX(1); }
                        100% { width: 400px; opacity: 0; transform: translate(-50%, -50%) rotate(-45deg) scaleX(1.2); }
                    }
                `})});return u?a.jsxs("div",{style:c,children:[a.jsx("img",{src:u,style:{width:"100%",height:"100%",objectFit:"contain",animation:h}}),a.jsx("style",{children:`
                @keyframes explode { 0% { transform: scale(0.5); opacity: 0; } 20% { opacity: 1; } 100% { transform: scale(2); opacity: 0; } }
            `})]}):null},EM=({value:t,x:e,y:n,color:r,onComplete:s,scale:i=1})=>{j.useEffect(()=>{const d=setTimeout(s,1200);return()=>clearTimeout(d)},[s]);const o=r==="#48bb78",l=r||"#e53e3e",c=o?"linear-gradient(180deg, #68d391 0%, #38a169 50%, #276749 100%)":"linear-gradient(180deg, #fc8181 0%, #e53e3e 50%, #c53030 100%)";return a.jsxs("div",{style:{position:"absolute",left:e,top:n,transform:"translate(-50%, -50%)",pointerEvents:"none",zIndex:6e3,fontSize:`${4*i}rem`,fontWeight:"900",fontFamily:'"Impact", "Arial Black", sans-serif',letterSpacing:`${-2*i}px`,background:c,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",filter:`drop-shadow(0 0 ${8*i}px ${l}) drop-shadow(0 ${2*i}px ${4*i}px rgba(0,0,0,0.8))`,animation:"floatUp 1.2s ease-out forwards"},children:[t,a.jsx("style",{children:`
                @keyframes floatUp {
                    0% { transform: translate(-50%, -50%) scale(0.3); opacity: 0; }
                    15% { transform: translate(-50%, -70%) scale(1.8); opacity: 1; }
                    30% { transform: translate(-50%, -90%) scale(1.4); opacity: 1; }
                    100% { transform: translate(-50%, -180%) scale(1); opacity: 0; }
                }
            `})]})},SM=({x:t,y:e})=>{const n=j.useMemo(()=>Array(16).fill(0).map((r,s)=>({id:s,angle:Math.random()*360,dist:60+Math.random()*120,size:4+Math.random()*8,delay:Math.random()*.3,color:Math.random()>.5?"#f6e05e":"#ffffff"})),[]);return a.jsxs("div",{style:{position:"absolute",left:t,top:e,pointerEvents:"none",zIndex:6e3},children:[a.jsx("style",{children:`
                @keyframes sparkleMove {
                    0% { transform: rotate(var(--angle)) translate(0, 0) scale(0); opacity: 0; }
                    20% { opacity: 1; transform: rotate(var(--angle)) translate(calc(var(--dist) * 0.2px), 0) scale(1.5); }
                    100% { transform: rotate(var(--angle)) translate(calc(var(--dist) * 1px), 0) scale(0); opacity: 0; }
                }
            `}),n.map(r=>a.jsx("div",{style:{position:"absolute",left:0,top:0,width:r.size,height:r.size,background:r.color,borderRadius:"50%",boxShadow:`0 0 10px ${r.color}, 0 0 20px ${r.color}`,"--angle":`${r.angle}deg`,"--dist":r.dist,animation:`sparkleMove 0.8s ease-out ${r.delay}s forwards`,pointerEvents:"none"}},r.id))]})},wM=({onClose:t})=>a.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(0,0,0,0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:t,children:a.jsxs("div",{style:{background:"linear-gradient(135deg, #1a202c 0%, #2d3748 100%)",borderRadius:16,padding:30,maxWidth:700,maxHeight:"80vh",overflowY:"auto",color:"#fff",boxShadow:"0 20px 60px rgba(0,0,0,0.5)",border:"1px solid #4a5568"},onClick:e=>e.stopPropagation(),children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[a.jsx("h2",{style:{margin:0,color:"#63b3ed"},children:""}),a.jsx("button",{onClick:t,style:{background:"transparent",border:"none",color:"#a0aec0",fontSize:"1.5rem",cursor:"pointer"},children:""})]}),a.jsxs("section",{style:{marginBottom:25},children:[a.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),a.jsxs("ul",{style:{lineHeight:1.8,paddingLeft:20,color:"#e2e8f0"},children:[a.jsx("li",{children:"0"}),a.jsx("li",{children:"1PP110"}),a.jsx("li",{children:"PP"}),a.jsx("li",{children:""}),a.jsx("li",{children:"5"}),a.jsx("li",{children:"910"})]})]}),a.jsxs("section",{style:{marginBottom:25},children:[a.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[a.jsxs("div",{children:[a.jsx("span",{style:{color:"#48bb78",fontWeight:"bold"},children:"[]"}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#ed8936",fontWeight:"bold"},children:"[]"}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#4299e1",fontWeight:"bold"},children:"[]"}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#9f7aea",fontWeight:"bold"},children:"[]"}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#f56565",fontWeight:"bold"},children:"[]"}),"12"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#38b2ac",fontWeight:"bold"},children:"[]"}),"1"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#718096",fontWeight:"bold"},children:"[]"}),"AoE"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#d69e2e",fontWeight:"bold"},children:"[]"}),"AoE"]})]})]}),a.jsxs("section",{style:{marginBottom:25},children:[a.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[a.jsxs("div",{children:[a.jsx("span",{style:{color:"#63b3ed",fontWeight:"bold"},children:""}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#f687b3",fontWeight:"bold"},children:""}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#faf089",fontWeight:"bold"},children:""}),"EP"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#b794f4",fontWeight:"bold"},children:""}),"SEP"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#68d391",fontWeight:"bold"},children:""}),""]})]})]}),a.jsxs("section",{style:{marginBottom:25},children:[a.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),a.jsxs("ul",{style:{lineHeight:1.8,paddingLeft:20,color:"#e2e8f0"},children:[a.jsxs("li",{children:[a.jsx("span",{style:{color:"#faf089"},children:"EP"}),"54112"]}),a.jsxs("li",{children:[a.jsx("span",{style:{color:"#b794f4"},children:"SEP"}),"76112"]}),a.jsx("li",{children:"1111"}),a.jsx("li",{children:"+2/+2"}),a.jsx("li",{children:"+3/+3"})]})]}),a.jsxs("section",{children:[a.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),a.jsxs("ul",{style:{lineHeight:1.8,paddingLeft:20,color:"#e2e8f0"},children:[a.jsxs("li",{children:[a.jsx("span",{style:{color:"#ed8936"},children:"PP"}),""]}),a.jsx("li",{children:"151612PP +1"})]})]})]})}),IM=({logs:t,onCardNameClick:e,scale:n=1,isMobile:r=!1})=>{const s=j.useRef(null);j.useEffect(()=>{s.current&&(s.current.scrollTop=s.current.scrollHeight)},[t.length]);const i=(c,d)=>{const u={color:"#ffd700",cursor:"pointer",textDecoration:"underline",textUnderlineOffset:"2px",fontWeight:"bold"},h=L=>{L.target.style.color="#ffec8b",L.target.style.textShadow="0 0 8px rgba(255, 215, 0, 0.8)"},f=L=>{L.target.style.color="#ffd700",L.target.style.textShadow="none"},b=(L,g)=>a.jsx("span",{style:u,onMouseEnter:h,onMouseLeave:f,onClick:H=>{H.stopPropagation(),e==null||e(L)},children:L},g),C=yb(),k=L=>L?!(/[a-zA-Z0-9]/.test(L)||/[\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/.test(L)):!0,A=[];for(const L of C){let g=0;for(;;){const H=c.indexOf(L,g);if(H===-1)break;const Q=H>0?c[H-1]:void 0,W=H+L.length<c.length?c[H+L.length]:void 0,G=k(Q)&&k(W),de=A.some(fe=>H>=fe.start&&H<fe.end||H+L.length>fe.start&&H+L.length<=fe.end||H<=fe.start&&H+L.length>=fe.end);G&&!de&&A.push({start:H,end:H+L.length,name:L}),g=H+1}}if(A.length===0)return a.jsx("span",{children:c});A.sort((L,g)=>L.start-g.start);const R=[];let m=0,T=0;for(const L of A)L.start>m&&R.push(a.jsx("span",{children:c.slice(m,L.start)},T++)),R.push(b(L.name,T++)),m=L.end;return m<c.length&&R.push(a.jsx("span",{children:c.slice(m)},T++)),a.jsx(a.Fragment,{children:R})},o=r?Math.max(100,140*n):Math.max(150,200*n),l=r?Math.max(140,180*n):Math.max(180,220*n);return a.jsxs("div",{ref:s,style:{position:"absolute",left:0,top:"45%",transform:"translateY(-50%)",width:l,height:o,overflowY:"auto",background:"linear-gradient(to right, rgba(0,0,0,0.8), rgba(0,0,0,0.0))",color:"#fff",fontSize:r?`${Math.max(.55,.65*n)}rem`:`${Math.max(.65,.75*n)}rem`,padding:r?`${6*n}px ${6*n}px ${6*n}px ${10*n}px`:`${8*n}px ${8*n}px ${8*n}px ${12*n}px`,borderLeft:r?"2px solid #63b3ed":"3px solid #63b3ed",zIndex:15,pointerEvents:"auto",scrollbarWidth:"thin"},onMouseDown:c=>c.stopPropagation(),onClick:c=>c.stopPropagation(),children:[a.jsx("div",{style:{fontWeight:"bold",marginBottom:(r?3:4)*n,color:"#a0aec0",borderBottom:"1px solid rgba(255,255,255,0.1)",paddingBottom:2,fontSize:r?`${Math.max(.5,.55*n)}rem`:`${Math.max(.55,.65*n)}rem`,textTransform:"uppercase",letterSpacing:1},children:r?"LOG":"BATTLE LOG"}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:(r?2:3)*n},children:t.map((c,d)=>a.jsx("div",{style:{opacity:.9,lineHeight:r?"1.3":"1.4",textShadow:"0 1px 2px black",animation:"fadeIn 0.3s ease-out"},children:i(c)},d))})]})},TM=({card:t,evolvedImageUrl:e,startX:n,startY:r,phase:s,onPhaseChange:i,onShake:o,useSep:l,playSE:c,scale:d,isLightMode:u=!1})=>{const h=j.useMemo(()=>("ontouchstart"in window||navigator.maxTouchPoints>0)&&window.innerWidth<1024,[]),[f,b]=j.useState(0),[C,k]=j.useState(0),[A,R]=j.useState(0),[m,T]=j.useState(0),[L,g]=j.useState(0),[H,Q]=j.useState(.25),[W,G]=j.useState({x:n,y:r}),[de,fe]=j.useState(!1),[Ee,ae]=j.useState([]),[he,be]=j.useState([]),[v,_]=j.useState(!1),x=j.useRef(!1),I=j.useRef(null),y=j.useRef(i),O=j.useRef(o),N=j.useRef(c);j.useEffect(()=>{y.current=i,O.current=o,N.current=c},[i,o,c]);const ne=360*d,B=480*d;j.useEffect(()=>{var Qe,tt,Ae;console.log("[EvolutionAnimation] Phase:",s);let J,V=null;switch(s){case"ZOOM_IN":{G({x:n,y:r}),Q(.25),k(0);const Ot=Date.now(),vt=650,ct=.25,wt=.75,Lt=setInterval(()=>{const xt=Date.now()-Ot,me=Math.min(xt/vt,1),qe=1-Math.pow(1-me,2);k(-5*qe),Q(ct+(wt-ct)*qe),me>=1&&clearInterval(Lt)},16);J=setTimeout(()=>{const xt=280*d,me=window.innerWidth-xt,qe=xt+me*.4;G({x:qe,y:window.innerHeight/2-30*d})},50);const Oe=setTimeout(()=>{const xt=new Audio(ot("/se/kirakira.mp3"));xt.volume=.35,xt.play().catch(()=>{}),I.current=xt},600),Bt=setTimeout(()=>{y.current("WHITE_FADE")},700);return()=>{clearTimeout(J),clearTimeout(Bt),clearTimeout(Oe),clearInterval(Lt)}}case"WHITE_FADE":(Qe=N.current)==null||Qe.call(N,"magic_charge.mp3",.3);const Se=h?20:u?40:80,Pe=Array(Se).fill(0).map((Ot,vt)=>{const ct=vt/Se*360,wt=(Math.random()-.5)*10,Lt=ct+wt,Oe=200+Math.random()*600,Bt=Math.random()*1.8,me=.5+(Oe-200)/600*.5,qe=24+Math.random()*48;return{id:vt,angle:Lt,dist:Oe,delay:Bt,duration:me,size:qe}});ae(Pe),_(!0);let et=0;return V=setInterval(()=>{et+=.025,T(Math.min(et,1)),g(Math.min(et*80,80)),R(et*15),et>=1.2&&(V&&clearInterval(V),_(!1),y.current("FLIP"))},40),()=>{V&&clearInterval(V)};case"FLIP":if((tt=N.current)==null||tt.call(N,"syakin.mp3",.8),(Ae=N.current)==null||Ae.call(N,"KO.mp3",.7),I.current){const Ot=I.current,vt=300,ct=30,wt=vt/ct,Lt=Ot.volume/wt;let Oe=0;const Bt=setInterval(()=>{Oe++,Ot.volume=Math.max(0,Ot.volume-Lt),Oe>=wt&&(clearInterval(Bt),Ot.pause(),I.current=null)},ct)}ae([]);const at=Date.now(),nt=h?16:u?40:120,Ue=400,Pt=1200;return V=setInterval(()=>{const Ot=Date.now()-at;if(Ot<Ue){const vt=Ot/Ue,ct=1-Math.pow(1-vt,3),wt=10+ct*160;if(b(wt),Q(.75+ct*((l?1.2:1.1)-.75)),k(-5+ct*2),T(Math.max(1-vt*3,0)),wt>90&&!x.current){x.current=!0;const Oe=Array(nt).fill(0).map((Bt,xt)=>{const me=xt/nt*360,qe=(Math.random()-.5)*8,Wt=h?24+Math.random()*36:18+Math.random()*42;return{id:xt,angle:me+qe,dist:200+Math.random()*400,size:h?Wt*2:Wt*3,delay:Math.random()*.05}});be(Oe)}}else{const vt=Math.min((Ot-Ue)/Pt,1),ct=vt<.5?2*vt*vt:1-Math.pow(-2*vt+2,2)/2;if(b(170+ct*10),T(0),!x.current){x.current=!0;const wt=Array(nt).fill(0).map((Lt,Oe)=>{const Bt=Oe/nt*360,xt=(Math.random()-.5)*8,me=h?24+Math.random()*36:18+Math.random()*42;return{id:Oe,angle:Bt+xt,dist:200+Math.random()*400,size:h?me*2:me*3,delay:Math.random()*.05}});be(wt)}vt>=1&&(V&&clearInterval(V),y.current("REVEAL"))}},16),()=>{V&&clearInterval(V)};case"REVEAL":let lt=0;return V=setInterval(()=>{lt+=.25,T(Math.max(1-lt,0)),g(Math.max(60-lt*60,0)),lt>=1&&(V&&clearInterval(V),be([]),y.current("ZOOM_OUT"))},40),()=>{V&&clearInterval(V)};case"ZOOM_OUT":{G({x:n,y:r});const Ot=Date.now(),vt=250,ct=H,wt=-3;return V=setInterval(()=>{const Lt=Date.now()-Ot,Oe=Math.min(Lt/vt,1),Bt=1-Math.pow(1-Oe,3);Q(ct-(ct-.25)*Bt),k(wt*(1-Bt)),Oe>=1&&(V&&clearInterval(V),b(180),R(0),Q(.25),k(0),y.current("LAND"))},16),()=>{V&&clearInterval(V)}}case"LAND":return O.current(),fe(!0),J=setTimeout(()=>{y.current("DONE")},600),()=>clearTimeout(J)}return()=>{J&&clearTimeout(J),V&&clearInterval(V),I.current&&(I.current.pause(),I.current=null)}},[s]);const ye=f+A,te=C,xe=v?{x:(Math.random()-.5)*4,y:(Math.random()-.5)*4}:{x:0,y:0};return a.jsxs("div",{style:{position:"fixed",inset:0,zIndex:1e4,background:"rgba(0,0,0,0.75)",pointerEvents:"none"},children:[a.jsx("style",{children:`
                ${Ee.map(J=>`
                    @keyframes chargeParticleIn-${J.id} {
                        0% { opacity: 0; transform: rotate(${J.angle}deg) translateX(${J.dist}px) scale(0.5); }
                        20% { opacity: 0.8; transform: rotate(${J.angle}deg) translateX(${J.dist*.8}px) scale(1.2); }
                        100% { opacity: 1; transform: rotate(${J.angle}deg) translateX(0) scale(0.2); } /* Keep visible at end */
                    }
                `).join("")}
                ${he.map(J=>`
                    @keyframes burstParticleOut-${J.id} {
                        0% { opacity: 1; transform: translate(-50%, -50%) rotate(${J.angle}deg) translateX(0) scale(1.5); }
                        100% { opacity: 0; transform: translate(-50%, -50%) rotate(${J.angle}deg) translateX(${J.dist*1.5}px) scale(0); }
                    }
                `).join("")}
            `}),Ee.map(J=>a.jsx("div",{style:{position:"absolute",left:W.x,top:W.y,width:J.size*d,height:J.size*d,borderRadius:"50%",background:h?"rgba(255, 255, 255, 0.9)":"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(200,230,255,0.6) 40%, transparent 70%)",boxShadow:h?"none":u?"0 0 8px white":"0 0 10px white, 0 0 20px rgba(100,200,255,0.5)",filter:h||u?void 0:"blur(1px)",animation:`chargeParticleIn-${J.id} ${J.duration}s ease-in ${J.delay}s forwards`,transform:`rotate(${J.angle}deg) translateX(${J.dist*d}px)`,opacity:0,pointerEvents:"none"}},`charge-${J.id}`)),s==="WHITE_FADE"&&!h&&a.jsxs("div",{style:{position:"absolute",left:W.x+xe.x,top:W.y+xe.y,width:0,height:0,transformStyle:"preserve-3d"},children:[a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:500*d,height:500*d,border:"8px solid rgba(255, 255, 255, 0.6)",borderRadius:"50%",transform:"translate(-50%, -50%) rotateX(75deg)",boxShadow:u?"0 0 15px rgba(255, 255, 255, 0.6)":"0 0 30px rgba(255, 255, 255, 0.8), inset 0 0 30px rgba(255, 255, 255, 0.8)",animation:"ringSpin 2s linear infinite"}}),!u&&a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:600*d,height:600*d,border:"6px dashed rgba(100, 200, 255, 0.7)",borderRadius:"50%",transform:"translate(-50%, -50%) rotateX(80deg) rotateY(10deg)",boxShadow:"0 0 40px rgba(100, 200, 255, 0.5)",animation:"ringSpinReverse 3s linear infinite"}}),a.jsx("style",{children:`
                        @keyframes ringSpin {
                            0% { transform: translate(-50%, -50%) rotateX(75deg) rotate(0deg); opacity: 0; scale: 0.5; }
                            20% { opacity: 1; scale: 1; }
                            100% { transform: translate(-50%, -50%) rotateX(75deg) rotate(360deg); opacity: 1; scale: 1; }
                        }
                        @keyframes ringSpinReverse {
                            0% { transform: translate(-50%, -50%) rotateX(80deg) rotateY(10deg) rotate(0deg); opacity: 0; scale: 0.6; }
                            20% { opacity: 0.8; scale: 1; }
                            100% { transform: translate(-50%, -50%) rotateX(80deg) rotateY(10deg) rotate(-360deg); opacity: 0.8; scale: 1; }
                        }
                    `})]}),he.map(J=>a.jsx("div",{style:{position:"absolute",left:W.x,top:W.y,width:J.size*d,height:J.size*d,borderRadius:"50%",background:h?l?"rgba(183, 148, 244, 0.9)":"rgba(255, 220, 150, 0.9)":l?"radial-gradient(circle, rgba(183, 148, 244, 1) 0%, rgba(159, 122, 234, 0.8) 50%, transparent 100%)":"radial-gradient(circle, rgba(255, 251, 235, 1) 0%, rgba(251, 211, 141, 0.8) 50%, transparent 100%)",boxShadow:h?"none":u?l?"0 0 8px #b794f4":"0 0 8px #fbd38d":l?"0 0 10px #b794f4, 0 0 20px rgba(159,122,234,0.6)":"0 0 10px #fbd38d, 0 0 20px rgba(251,211,141,0.6)",animation:`burstParticleOut-${J.id} 0.4s ease-out ${J.delay}s forwards`,pointerEvents:"none"}},`burst-${J.id}`)),a.jsxs("div",{style:{position:"absolute",left:W.x+xe.x,top:W.y+xe.y,transform:`translate(-50%, -50%) scale(${H}) perspective(1200px) rotateY(${ye}deg) rotateZ(${te}deg)`,transition:s==="ZOOM_IN"||s==="ZOOM_OUT"?"left 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), top 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)":"none",transformStyle:"preserve-3d"},children:[!u&&!h&&a.jsx("div",{style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:ne*1.3,height:B*1.2,background:l?"radial-gradient(ellipse, rgba(159, 122, 234, 0.4) 0%, transparent 70%)":"radial-gradient(ellipse, rgba(251, 211, 141, 0.4) 0%, transparent 70%)",filter:"blur(20px)",pointerEvents:"none",opacity:L>1?1:0,transition:"opacity 0.4s"}}),a.jsxs("div",{style:{width:ne,height:B,borderRadius:16,overflow:"hidden",boxShadow:h?l?"0 0 10px rgba(159, 122, 234, 0.4)":"0 0 10px rgba(251, 211, 141, 0.4)":u?l?"0 0 20px rgba(159, 122, 234, 0.5)":"0 0 20px rgba(251, 211, 141, 0.5)":l?"0 0 40px rgba(159, 122, 234, 0.7)":"0 0 40px rgba(251, 211, 141, 0.7)",position:"relative",transformStyle:"preserve-3d"},children:[a.jsxs("div",{style:{position:"absolute",inset:0,borderRadius:16,overflow:"hidden",background:"#1a202c",zIndex:ye<=90?2:1,opacity:ye<=90?1:0},children:[a.jsx("img",{src:ot(t.imageUrl||""),alt:t.name,style:{width:"100%",height:"100%",objectFit:"cover",filter:`brightness(${1+m*.5}) contrast(${1-m*.2})`}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"white",opacity:m,pointerEvents:"none"}})]}),a.jsxs("div",{style:{position:"absolute",inset:0,transform:"rotateY(180deg)",borderRadius:16,overflow:"hidden",background:"#1a202c",zIndex:ye>90?2:1,opacity:ye>90?1:0},children:[a.jsx("img",{src:ot(e&&e!==""?e:t.imageUrl||""),alt:`${t.name} Evolved`,style:{width:"100%",height:"100%",objectFit:"cover",filter:`brightness(${1+m*.5}) contrast(${1-m*.2})`}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"white",opacity:m,pointerEvents:"none"}})]})]})]}),de&&a.jsxs("div",{style:{position:"absolute",left:n,top:r,pointerEvents:"none"},children:[a.jsx("style",{children:`
                        @keyframes landParticleMove {
                            0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                            100% { opacity: 0; transform: translate(-50%, -50%) rotate(var(--angle)) translateX(calc(var(--dist) * 1px)) scale(0); }
                        }
                    `}),Array(20).fill(0).map((J,V)=>{const Qe=V/20*360,tt=40+Math.random()*100;return a.jsx("div",{style:{position:"absolute",left:0,top:0,width:8*d,height:8*d,borderRadius:"50%",background:"white","--angle":`${Qe}deg`,"--dist":tt,animation:"landParticleMove 0.5s ease-out forwards"}},`land-${V}`)})]})]})},CM=ot("/leaders/yoRuka_win.png"),kM=ot("/leaders/yoRuka_lose.png"),RM=ot("/leaders/senka_win.png"),AM=ot("/leaders/senka_lose.png"),PM=ot("/leaders/azya_win.png"),OM=ot("/leaders/azya_lose.png"),rl=t=>({BRONZE:"#cd7f32",SILVER:"#c0c0c0",GOLD:"#ffd700",PLATINUM:"#e5e4e2",DIAMOND:"#b9f2ff",MASTER:"#ff4500"})[t],LM=({winnerId:t,playerId:e,playerClass:n,onRematch:r,onRematching:s,onLeave:i,isOnline:o,isRoomMatch:l=!0,myRematchRequested:c,opponentRematchRequested:d,battleStats:u,selectedCardInfo:h,onCardInfoClick:f,victoryReason:b="normal",isRankedMatch:C=!1,ratingResult:k,scale:A=1})=>{const R=t===e,m=A<.7,[T,L]=j.useState(k?k.newRating-k.ratingChange:0),g=j.useRef(null),H=1500,Q=te=>{const xe=ac.find(Se=>te>=Se.min&&te<=Se.max)||ac[0],J=xe.rank==="MASTER",V=J?1/0:xe.max,Qe=te-xe.min,tt=xe.max-xe.min+1,Ae=J?0:Math.min(1,Qe/tt);return{rank:xe.rank,progress:Ae,ratingInRank:te,rankMax:V,isMaster:J}};j.useEffect(()=>{if(!k||!C)return;const te=k.newRating-k.ratingChange,xe=k.newRating,J=Qe=>{g.current||(g.current=Qe);const tt=Qe-g.current,Ae=Math.min(tt/H,1),Se=1-(1-Ae)*(1-Ae),Pe=te+(xe-te)*Se;L(Pe),Ae<1&&requestAnimationFrame(J)},V=setTimeout(()=>{g.current=null,requestAnimationFrame(J)},100);return()=>clearTimeout(V)},[k,C,H]);const G=(()=>{if(!R)return null;switch(b){case"disconnect":return"";case"surrender":return"";default:return null}})(),[de,fe]=j.useState("bg-fade"),Ee=["bg-fade","image","result-text","stats","rate","buttons","complete"].indexOf(de);j.useEffect(()=>{const te={"bg-fade":300,image:600,"result-text":400,stats:400,rate:300,buttons:0};if(de==="complete")return;const xe={"bg-fade":"image",image:"result-text","result-text":"stats",stats:"rate",rate:"buttons",buttons:"complete"},J=setTimeout(()=>{const V=xe[de];V&&fe(V)},te[de]||0);return()=>clearTimeout(J)},[de]);const ae=()=>n==="SENKA"?R?RM:AM:n==="AJA"?R?PM:OM:R?CM:kM,[he,be]=j.useState(30),[v,_]=j.useState(!1),[x,I]=j.useState(n),y=o?c||d:c||v;j.useEffect(()=>{if(y)return;const te=setInterval(()=>{be(xe=>xe<=1?(clearInterval(te),i(),0):xe-1)},1e3);return()=>clearInterval(te)},[i,y]);const O=te=>{I(te),_(!1)},N=()=>{o&&!l&&s?s(x):r(x)},ne=()=>{const te=!o||l?"":"";return o?c&&d?"...":c?"...":d?`${te}`:te:c?"...":te},B=()=>{const te={padding:`${Math.max(15*A,6)}px ${Math.max(40*A,14)}px`,fontSize:`${Math.max(1.5*A,.65)}rem`,fontWeight:"bold",border:"none",borderRadius:Math.max(12*A,4),cursor:c?"default":"pointer",transform:"scale(1)",transition:"transform 0.1s, background 0.2s"};return d&&!c?{...te,background:"linear-gradient(135deg, #f6e05e, #d69e2e)",color:"black",boxShadow:"0 4px 15px rgba(246, 224, 94, 0.6)",animation:"pulse 1s infinite"}:c?{...te,background:"linear-gradient(135deg, #718096, #4a5568)",color:"white",boxShadow:"none"}:{...te,background:"linear-gradient(135deg, #48bb78, #38a169)",color:"white",boxShadow:"0 4px 15px rgba(72, 187, 120, 0.4)"}},ye=(te,xe,J=1)=>({width:Math.max(220*J,70),height:Math.max(220*J,70),borderRadius:"50%",border:x===te?"5px solid #f6e05e":"4px solid rgba(255,255,255,0.4)",background:te==="AJA"?`url(${kl(te)}) center top/cover`:`url(${kl(te)}) center/cover`,cursor:"pointer",transform:xe?"scale(1.1)":"scale(1)",transition:"all 0.2s ease",boxShadow:xe?"0 0 30px rgba(246, 224, 94, 0.7)":"0 6px 15px rgba(0,0,0,0.5)"});return a.jsxs("div",{style:{position:"absolute",inset:0,zIndex:5e3,background:"rgba(0,0,0,0.85)",backdropFilter:"blur(10px)",display:"flex",flexDirection:"row",alignItems:"stretch",opacity:Ee>=0?1:0,transition:"opacity 0.3s ease-out"},onClick:()=>{},children:[a.jsx("style",{children:`
                @keyframes pulse {
                    0%, 100% { transform: scale(1); }
                    50% { transform: scale(1.05); }
                }
                @keyframes float {
                    0%, 100% { transform: translateY(0); }
                    50% { transform: translateY(-10px); }
                }
                @keyframes slideUpFadeIn {
                    0% { opacity: 0; transform: translateY(30px); }
                    100% { opacity: 1; transform: translateY(0); }
                }
                @keyframes imageFadeIn {
                    0% { opacity: 0; transform: scale(0.95); }
                    100% { opacity: 0.9; transform: scale(1); }
                }
            `}),a.jsx("div",{style:{flex:m?.6:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:Math.max(40*A,10),borderRight:"1px solid rgba(255,255,255,0.1)"},children:h?a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:Math.max(16*A,6),maxWidth:Math.max(320*A,120)},children:[a.jsx("div",{style:{width:Math.max(200*A,80),height:Math.max(280*A,112),backgroundImage:`url(${ot(`/cards/${h.id}.png`)})`,backgroundSize:"cover",backgroundPosition:"center",borderRadius:Math.max(12*A,4),boxShadow:"0 8px 30px rgba(0,0,0,0.6)"}}),a.jsx("div",{style:{fontFamily:"var(--font-tamanegi)",fontSize:`${Math.max(1.6*A,.7)}rem`,color:"white",textShadow:"0 2px 6px rgba(0,0,0,0.6)",textAlign:"center"},children:h.name}),a.jsxs("div",{style:{display:"flex",gap:Math.max(20*A,8),fontSize:`${Math.max(1.2*A,.55)}rem`,color:"rgba(255,255,255,0.9)"},children:[a.jsxs("span",{children:[": ",h.cost]}),h.type==="FOLLOWER"&&a.jsxs(a.Fragment,{children:[a.jsxs("span",{children:[": ",h.attack]}),a.jsxs("span",{children:[": ",h.health]})]})]}),a.jsx("div",{style:{fontSize:`${Math.max(1*A,.5)}rem`,color:"rgba(255,255,255,0.7)",textAlign:"center",lineHeight:1.5,maxHeight:Math.max(120*A,50),overflow:"auto"},children:h.description||""}),a.jsx("button",{onClick:()=>f(null),style:{padding:`${Math.max(8*A,4)}px ${Math.max(24*A,10)}px`,fontSize:`${Math.max(1*A,.5)}rem`,background:"transparent",border:"1px solid rgba(255,255,255,0.3)",color:"white",borderRadius:Math.max(8*A,4),cursor:"pointer",marginTop:Math.max(10*A,4)},children:""})]}):a.jsx("div",{style:{width:"100%",height:"100%",backgroundImage:`url(${ae()})`,backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat",opacity:Ee>=1?.9:0,transform:Ee>=1?"scale(1)":"scale(0.95)",transition:"opacity 0.6s ease-out, transform 0.6s ease-out"}})}),a.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:Math.max(40*A,10),position:"relative"},children:[a.jsx("div",{style:{fontFamily:"var(--font-tamanegi)",fontSize:`${Math.max(5*A,1.8)}rem`,color:R?"#f6e05e":"#a0aec0",textShadow:R?"0 0 40px rgba(246, 224, 94, 0.7), 4px 4px 8px rgba(0,0,0,0.6)":"0 0 20px rgba(160, 174, 192, 0.5), 4px 4px 8px rgba(0,0,0,0.6)",marginBottom:Math.max(20*A,8),opacity:Ee>=2?1:0,transform:Ee>=2?"translateY(0)":"translateY(30px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out",animation:Ee>=2?"float 3s ease-in-out infinite":"none"},children:R?"":""}),G&&a.jsx("div",{style:{fontSize:`${Math.max(1.1*A,.6)}rem`,color:"rgba(255, 255, 255, 0.8)",marginTop:Math.max(-10*A,-4),marginBottom:Math.max(20*A,8),opacity:Ee>=2?1:0,transform:Ee>=2?"translateY(0)":"translateY(20px)",transition:"opacity 0.4s ease-out 0.2s, transform 0.4s ease-out 0.2s"},children:G}),a.jsxs("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"center",gap:Math.max(16*A,6),marginBottom:Math.max(30*A,10),padding:`${Math.max(16*A,6)}px ${Math.max(24*A,8)}px`,background:"rgba(0,0,0,0.3)",borderRadius:Math.max(12*A,4),border:"1px solid rgba(255,255,255,0.1)",opacity:Ee>=3?1:0,transform:Ee>=3?"translateY(0)":"translateY(30px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out"},children:[a.jsxs("div",{style:{textAlign:"center",minWidth:Math.max(80*A,35)},children:[a.jsx("div",{style:{fontSize:`${Math.max(1.8*A,.8)}rem`,fontWeight:"bold",color:"#f6e05e"},children:u.turnCount}),a.jsx("div",{style:{fontSize:`${Math.max(.9*A,.45)}rem`,color:"rgba(255,255,255,0.6)"},children:""})]}),a.jsxs("div",{style:{textAlign:"center",minWidth:Math.max(80*A,35)},children:[a.jsx("div",{style:{fontSize:`${Math.max(1.8*A,.8)}rem`,fontWeight:"bold",color:"#48bb78"},children:u.damageDealtToOpponent}),a.jsx("div",{style:{fontSize:`${Math.max(.9*A,.45)}rem`,color:"rgba(255,255,255,0.6)"},children:""})]}),a.jsxs("div",{style:{textAlign:"center",minWidth:Math.max(80*A,35)},children:[a.jsx("div",{style:{fontSize:`${Math.max(1.8*A,.8)}rem`,fontWeight:"bold",color:"#e53e3e"},children:u.damageReceivedFromOpponent}),a.jsx("div",{style:{fontSize:`${Math.max(.9*A,.45)}rem`,color:"rgba(255,255,255,0.6)"},children:""})]}),a.jsxs("div",{style:{textAlign:"center",minWidth:Math.max(80*A,35)},children:[a.jsx("div",{style:{fontSize:`${Math.max(1.8*A,.8)}rem`,fontWeight:"bold",color:"#63b3ed"},children:u.followersDestroyed}),a.jsx("div",{style:{fontSize:`${Math.max(.9*A,.45)}rem`,color:"rgba(255,255,255,0.6)"},children:""})]})]}),C&&k&&(()=>{const te=Q(T),xe=Q(k.newRating);return a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:Math.max(12*A,4),marginTop:Math.max(16*A,6),opacity:Ee>=4?1:0,transform:Ee>=4?"translateY(0)":"translateY(20px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out",width:"90%",maxWidth:Math.max(500*A,180)},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:Math.max(12*A,4),background:"rgba(0, 0, 0, 0.5)",padding:`${Math.max(12*A,4)}px ${Math.max(24*A,8)}px`,borderRadius:Math.max(12*A,4),border:`2px solid ${k.ratingChange>=0?"#48bb78":"#e53e3e"}`},children:[a.jsx("span",{style:{fontSize:`${Math.max(1.2*A,.6)}rem`,color:"rgba(255,255,255,0.8)",fontFamily:"var(--font-tamanegi)"},children:""}),a.jsxs("span",{style:{fontSize:`${Math.max(2*A,.9)}rem`,fontWeight:"bold",color:k.ratingChange>=0?"#48bb78":"#e53e3e",fontFamily:"var(--font-tamanegi)"},children:[k.ratingChange>=0?"+":"",k.ratingChange]})]}),k.ratingChange>0&&(k.bonusBreakdown.winStreakBonus>0||k.bonusBreakdown.rankDiffBonus>0)&&a.jsxs("div",{style:{display:"flex",gap:Math.max(16*A,6),fontSize:`${Math.max(.85*A,.45)}rem`,color:"rgba(255,255,255,0.6)",fontFamily:"var(--font-tamanegi)"},children:[a.jsxs("span",{children:[": +",k.bonusBreakdown.base]}),k.bonusBreakdown.winStreakBonus>0&&a.jsxs("span",{style:{color:"#f6e05e"},children:[": +",k.bonusBreakdown.winStreakBonus,"",k.newWinStreak,""]}),k.bonusBreakdown.rankDiffBonus>0&&a.jsxs("span",{style:{color:"#63b3ed"},children:[": +",k.bonusBreakdown.rankDiffBonus]})]}),a.jsxs("div",{style:{width:"100%",display:"flex",flexDirection:"column",gap:Math.max(8*A,3),background:"rgba(0, 0, 0, 0.5)",padding:Math.max(16*A,6),borderRadius:Math.max(12*A,4),border:"2px solid rgba(255, 255, 255, 0.2)"},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[a.jsx("span",{style:{fontSize:`${Math.max(1.4*A,.65)}rem`,fontWeight:"bold",color:rl(te.rank),fontFamily:"var(--font-tamanegi)",textShadow:`0 0 10px ${rl(te.rank)}80`},children:or[te.rank]}),a.jsx("span",{style:{fontSize:`${Math.max(1*A,.5)}rem`,color:"rgba(255,255,255,0.8)",fontFamily:"var(--font-tamanegi)"},children:te.isMaster?Math.floor(T):`${Math.floor(T)} / ${te.rankMax}`})]}),a.jsxs("div",{style:{width:"100%",height:Math.max(24*A,10),background:"rgba(0, 0, 0, 0.7)",borderRadius:Math.max(12*A,5),overflow:"hidden",border:"2px solid rgba(255, 255, 255, 0.3)",position:"relative"},children:[a.jsx("div",{style:{width:`${te.progress*100}%`,height:"100%",background:`linear-gradient(90deg, ${rl(te.rank)}cc, ${rl(te.rank)})`,borderRadius:Math.max(10*A,4),transition:"width 0.05s linear",boxShadow:`0 0 10px ${rl(te.rank)}80`}}),a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${Math.max(.75*A,.4)}rem`,fontWeight:"bold",color:"white",textShadow:"0 1px 2px rgba(0,0,0,0.8)",fontFamily:"var(--font-tamanegi)"},children:te.isMaster?Math.floor(te.ratingInRank):`${Math.floor(te.ratingInRank)} / ${te.rankMax}`})]})]}),k.isRankUp&&T>=k.newRating-10&&a.jsxs("div",{style:{fontSize:`${Math.max(1.4*A,.65)}rem`,fontWeight:"bold",color:"#f6e05e",textShadow:"0 0 20px rgba(246, 224, 94, 0.8)",fontFamily:"var(--font-tamanegi)",animation:"pulse 1s ease-in-out infinite"},children:[or[xe.rank],""]}),k.isRankDown&&a.jsxs("div",{style:{fontSize:`${Math.max(1.2*A,.55)}rem`,color:"#e53e3e",fontFamily:"var(--font-tamanegi)"},children:[or[xe.rank],""]})]})})(),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:Math.max(16*A,6),opacity:Ee>=5?1:0,transform:Ee>=5?"translateY(0)":"translateY(30px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out"},children:[!c&&a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:Math.max(12*A,5),background:"rgba(0, 0, 0, 0.5)",padding:`${Math.max(10*A,4)}px ${Math.max(16*A,6)}px`,borderRadius:Math.max(10*A,4),border:"1px solid rgba(255, 255, 255, 0.2)"},children:[a.jsx("span",{style:{fontFamily:"var(--font-tamanegi)",fontSize:`${Math.max(1.1*A,.55)}rem`,color:"rgba(255, 255, 255, 0.7)"},children:":"}),a.jsx("span",{style:{fontFamily:"var(--font-tamanegi)",fontSize:`${Math.max(1.3*A,.6)}rem`,fontWeight:"bold",color:x==="SENKA"?"#e74c3c":x==="AJA"?"#3498db":"#9b59b6"},children:x==="SENKA"?"":x==="AJA"?"":"Y"}),a.jsx("button",{onClick:()=>_(!0),style:{padding:`${Math.max(6*A,3)}px ${Math.max(12*A,5)}px`,fontSize:`${Math.max(.9*A,.5)}rem`,fontWeight:"bold",background:"rgba(168, 85, 247, 0.3)",border:"1px solid rgba(168, 85, 247, 0.6)",color:"#d8b4fe",borderRadius:Math.max(6*A,3),cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:te=>{te.currentTarget.style.background="rgba(168, 85, 247, 0.5)",te.currentTarget.style.borderColor="rgba(168, 85, 247, 0.8)"},onMouseLeave:te=>{te.currentTarget.style.background="rgba(168, 85, 247, 0.3)",te.currentTarget.style.borderColor="rgba(168, 85, 247, 0.6)"},children:""})]}),a.jsxs("div",{style:{display:"flex",gap:Math.max(20*A,8)},children:[a.jsx("button",{onClick:N,disabled:c,style:B(),onMouseDown:te=>{c||(te.currentTarget.style.transform="scale(0.95)")},onMouseUp:te=>te.currentTarget.style.transform="scale(1)",children:ne()}),a.jsxs("button",{onClick:i,style:{padding:`${Math.max(15*A,6)}px ${Math.max(40*A,14)}px`,fontSize:`${Math.max(1.5*A,.65)}rem`,fontWeight:"bold",background:"transparent",border:"2px solid rgba(255,255,255,0.3)",color:"white",borderRadius:Math.max(12*A,4),cursor:"pointer"},children:[" ",!y&&`(${he})`]})]})]}),v&&a.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:100,animation:"fadeIn 0.2s ease-out"},children:a.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(30, 30, 50, 0.95) 0%, rgba(20, 20, 40, 0.95) 100%)",border:"2px solid rgba(168, 85, 247, 0.5)",borderRadius:Math.max(16*A,6),padding:Math.max(32*A,12),boxShadow:"0 10px 40px rgba(0, 0, 0, 0.6)",display:"flex",flexDirection:"column",alignItems:"center",gap:Math.max(24*A,8)},children:[a.jsx("div",{style:{fontFamily:"var(--font-tamanegi)",fontSize:`${Math.max(1.8*A,.75)}rem`,color:"white",textShadow:"0 2px 8px rgba(0, 0, 0, 0.6)"},children:""}),a.jsxs("div",{style:{display:"flex",gap:Math.max(24*A,8)},children:[a.jsx(Yh,{deckType:"SENKA",label:"",onSelect:O,getStyle:ye,scale:A}),a.jsx(Yh,{deckType:"AJA",label:"",onSelect:O,getStyle:ye,scale:A}),a.jsx(Yh,{deckType:"YORUKA",label:"Y",onSelect:O,getStyle:ye,scale:A})]}),a.jsx("button",{onClick:()=>_(!1),style:{padding:`${Math.max(10*A,4)}px ${Math.max(36*A,12)}px`,fontSize:`${Math.max(1.1*A,.55)}rem`,fontWeight:"bold",background:"transparent",border:"2px solid rgba(255, 255, 255, 0.3)",color:"white",borderRadius:Math.max(10*A,4),cursor:"pointer"},children:""})]})})]})]})},Yh=({deckType:t,label:e,onSelect:n,getStyle:r,scale:s=1})=>{const[i,o]=j.useState(!1);return a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:Math.max(12*s,4)},children:[a.jsx("button",{onClick:()=>n(t),onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),style:r(t,i,s)}),a.jsx("span",{style:{color:"white",fontFamily:"var(--font-tamanegi)",fontSize:`${Math.max(1.4*s,.6)}rem`,textShadow:"0 2px 6px rgba(0,0,0,0.6)"},children:e})]})},Qx=(t,e)=>{const[n,r]=j.useState([]),s=j.useRef(!1);return j.useEffect(()=>{r(i=>{const o=[],l=new Map((t||[]).filter(c=>c).map(c=>[c.instanceId,c]));return i.forEach(c=>{var u;if(!c)return;const d=l.get(c.instanceId);d?(o.push({...d,passiveAbilities:d.passiveAbilities?[...d.passiveAbilities]:[],hasBarrier:d.hasBarrier??((u=d.passiveAbilities)==null?void 0:u.includes("BARRIER"))??!1,isDying:!1}),l.delete(c.instanceId)):o.push({...c,isDying:!0,killedByBane:c.killedByBane})}),l.forEach(c=>{var d;o.push({...c,passiveAbilities:c.passiveAbilities?[...c.passiveAbilities]:[],hasBarrier:c.hasBarrier??((d=c.passiveAbilities)==null?void 0:d.includes("BARRIER"))??!1,isDying:!1})}),o})},[t]),j.useEffect(()=>{if(n.some(o=>o.isDying)){if(e!=null&&e.current){s.current=!0;return}const o=setTimeout(()=>{r(l=>l.filter(c=>!c.isDying))},700);return()=>clearTimeout(o)}},[n,e]),j.useEffect(()=>{const o=setInterval(()=>{if(!(e!=null&&e.current)&&s.current){s.current=!1;const l=setTimeout(()=>{r(c=>c.filter(d=>!d.isDying))},300);return()=>clearTimeout(l)}},100);return()=>clearInterval(o)},[e]),n},MM=({playerClass:t,opponentType:e,gameMode:n,targetRoomId:r,onLeave:s,onRematching:i,networkAdapter:o,networkConnected:l,opponentClass:c,aiDifficulty:d="NORMAL",playerName:u,timerEnabled:h=!0,playerId:f,opponentPlayerId:b,opponentRating:C,opponentName:k})=>{var Qm,qm,Zm,ey,ty,ny,ry,sy,iy;const A=n==="CPU"||!o,R=cM(A?n==="CPU"?"CPU":n:"CPU",A?r:void 0),m=o||R.adapter,T=l!==void 0?l:R.connected,L=yM(),{scale:g,toGameX:H,toGameY:Q}=L,{isLightMode:W}=_2(),[G,de]=P.useState(!1);P.useEffect(()=>{(()=>{de("ontouchstart"in window||navigator.maxTouchPoints>0)})()},[]);const fe=P.useCallback((p,E)=>({x:H(p),y:Q(E)}),[H,Q]),[Ee,ae]=P.useState(null),he=j.useRef(L);P.useEffect(()=>{he.current=L},[L]);const be=n==="CPU"||n==="HOST"||(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&(m==null?void 0:m.isHost)===!0,v=be?"p1":"p2",_=be?"p2":"p1";console.log("[GameScreen INIT]",{gameMode:n,"adapter exists":!!m,"adapter?.isHost":m==null?void 0:m.isHost,"adapter?.isHost === true":(m==null?void 0:m.isHost)===!0,isHost:be,currentPlayerId:v,connected:T,"networkAdapter provided":!!o,networkConnected:l});const x=c||(()=>{const E=["SENKA","AJA","YORUKA"].filter(w=>w!==t);return E[Math.floor(Math.random()*E.length)]})(),I=n==="JOIN"||(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&!be,[y,O]=P.useReducer(T5,null,()=>{const p=k||(n==="CPU"?"CPU":"");return console.log("[GameScreen] Initializing game with opponentName:",p,"propOpponentName:",k),I?Dd(p,x,u,t):Dd(u,t,p,x)}),[N,ne]=P.useState(!I),B=n==="CASUAL_MATCH"||n==="RANKED_MATCH",[ye,te]=j.useState(B?!1:!I),[xe,J]=j.useState(!1),[V,Qe]=j.useState(!1),[tt,Ae]=j.useState(!1),[Se,Pe]=j.useState(B),[et,at]=j.useState(!1),nt=j.useRef(!1);console.log("[GameScreen SYNC STATE]",{isCasualOrRanked:B,isJoinSide:I,gameSynced:N,waitingForIntroSync:Se,opponentReadyForIntro:et,showBattleIntro:ye,"introSyncSentRef.current":nt.current});const[Ue,Pt]=j.useState(!1),[lt,Ot]=j.useState(null),[vt,ct]=j.useState(0),[wt,Lt]=j.useState({x:0,y:0}),[Oe,Bt]=j.useState("IDLE"),[xt,me]=j.useState(null),[qe,Wt]=j.useState(!1),[It,Zt]=j.useState(()=>n==="JOIN"||(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&!be?!1:Math.random()>.5);P.useEffect(()=>{ye&&(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&console.log("[GameScreen DEBUG] BattleIntro shown with isFirstPlayer:",It,"currentPlayerId:",v,"adapter?.isHost:",m==null?void 0:m.isHost)},[ye,n,It,v,m]);const[es,Zn]=j.useState(!1),[Cn,Ca]=j.useState(!1),[Cf,ka]=j.useState("normal"),[yn,Ra]=j.useState(t),[Ss,ws]=j.useState({turnCount:0,damageDealtToOpponent:0,damageReceivedFromOpponent:0,followersDestroyed:0,myFollowersDestroyed:0}),[S,Aa]=j.useState(null),[kf,Rc]=j.useState(null),[Tr,Si]=j.useState(()=>(console.log("%c[RatingUpdate] Initializing ratingUpdateDone to FALSE","background: #00ff00; color: #000000; font-size: 12px;"),!1)),[Pa,Ac]=j.useState(void 0),[Rf,Pc]=j.useState(void 0);j.useEffect(()=>{if(n!=="RANKED_MATCH"||!f){Ac(void 0),Pc(void 0);return}(async()=>{try{const E=await cg(f,yn),w=wn(E.rating);if(Ac(w),C!=null){const M=wn(C);Pc(M)}}catch(E){console.error("[GameScreen] Failed to fetch rank info:",E)}})()},[n,f,yn,C]),j.useEffect(()=>{console.log("[GameScreen] winnerId changed:",{winnerId:y.winnerId,outroCompleted:Ue,showBattleOutro:tt,gameMode:n,phase:y.phase,authPlayerId:f,currentPlayerId:v,ratingUpdateDone:Tr,propOpponentRating:C});const p=3,E=y.turnCount>p,w=5*60*1e3,M=(()=>{if(!b||n!=="RANKED_MATCH")return!0;const q=`lastRankedMatch_${b}`,U=localStorage.getItem(q);return U?Date.now()-parseInt(U,10)>w:!0})(),$=y.winnerId&&n==="RANKED_MATCH"&&f&&!Tr&&E&&M,z=y.winnerId&&(n==="RANKED_MATCH"||n==="CASUAL_MATCH")&&f&&be&&!Tr;if(y.winnerId&&n==="RANKED_MATCH"&&f&&!Tr&&!E&&console.log("%c[RatingUpdate] Rating update SKIPPED - insufficient turns","background: #ff9900; color: #000000; font-size: 14px;",{turnCount:y.turnCount,minRequired:p,reason:"3"}),y.winnerId&&n==="RANKED_MATCH"&&f&&!Tr&&E&&!M&&console.log("%c[RatingUpdate] Rating update SKIPPED - recent rematch","background: #ff9900; color: #000000; font-size: 14px;",{opponentPlayerId:b,reason:"5"}),$||z)console.log("%c[RatingUpdate] Starting rating update...","background: #00ff00; color: #000000; font-size: 14px;",{authPlayerId:f,currentPlayerId:v,winnerId:y.winnerId,propOpponentRating:C,shouldUpdateRating:$,shouldSaveMatchHistory:z,turnCount:y.turnCount,isSufficientTurns:E}),(async()=>{var U;try{const F=await cg(f,yn),Y=y.winnerId===v;console.log("[RatingUpdate] Calculating rating:",{currentRating:F.rating,winStreak:F.winStreak,opponentRating:C,winnerId:y.winnerId,currentPlayerId:v,isWin:Y});let ce;if(Y?ce=Ox(F.rating,F.winStreak,C??0):ce=Lx(F.rating),$&&(await gL(f,yn,ce,Y),console.log("%c[RatingUpdate] Rating updated successfully!","background: #00ff00; color: #000000; font-size: 14px;",ce)),z&&b){const Z=!Y;let pe=C??0;n==="RANKED_MATCH"&&(Z?pe=Ox(C??0,0,F.rating).newRating:pe=Lx(C??0).newRating);const we=v==="p1"?"p2":"p1",Ze=((U=y.players[we])==null?void 0:U.name)||k||"",Ie=v===y.firstPlayerId,ze={gameMode:n,myPlayerId:f,myPlayerName:u,myPlayerClass:yn,myRatingBefore:F.rating,myRatingAfter:ce.newRating,myIsFirst:Ie,opponentPlayerId:b,opponentPlayerName:Ze,opponentPlayerClass:x,opponentRatingBefore:C??0,opponentRatingAfter:pe,winnerId:y.winnerId===v?f:b};try{await mL(ze),console.log("%c[MatchHistory] Match record saved!","background: #00ff00; color: #000000; font-size: 14px;")}catch(He){console.error("[MatchHistory] Failed to save match record:",He)}}if(Rc(ce),Si(!0),n==="RANKED_MATCH"&&b){const Z=`lastRankedMatch_${b}`;localStorage.setItem(Z,Date.now().toString()),console.log(`[RatingUpdate] Saved last match time for opponent: ${b}`)}}catch(F){console.error("[RatingUpdate] Failed to update rating:",F),Si(!0)}})();else if(y.winnerId&&n==="RANKED_MATCH"&&b&&!Tr){const q=`lastRankedMatch_${b}`;localStorage.setItem(q,Date.now().toString()),console.log(`[RatingUpdate] Saved last match time (no rating update) for opponent: ${b}`),Si(!0)}y.winnerId&&!Ue&&!tt&&(console.log("[GameScreen] Starting BattleOutro animation"),Ae(!0))},[y.winnerId,Ue,tt,n,y.phase,f,v,yn,C,Tr,be,b,x,u,k,y.players,y.firstPlayerId]),j.useEffect(()=>{if(vt<=0){Lt({x:0,y:0});return}let p;const E=()=>{const w=Date.now()*.03,M=25*vt*g,$=Math.sin(w*7)*M+Math.sin(w*13)*M*.5,z=Math.cos(w*11)*M+Math.cos(w*17)*M*.3;Lt({x:$,y:z}),p=requestAnimationFrame(E)};return p=requestAnimationFrame(E),()=>cancelAnimationFrame(p)},[vt,g]);const[lo,Oa]=j.useState([]),Af=j.useRef(0),[co,Oc]=j.useState(!1),[uo,fo]=j.useState(null),[wi,Is]=j.useState(null),er=j.useRef(null),hr=j.useRef(null),pr=j.useRef(null),La=j.useRef(y.logs.length),ho=P.useRef(!1),Lc=P.useRef(!1),gr=P.useRef(k??null);P.useEffect(()=>{const p=n==="HOST"||(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&be,E=B?T&&m:T&&m&&Oe==="DONE";if(console.log("[GameScreen INIT_GAME useEffect]",{isHostSide:p,isCasualOrRanked:B,connected:T,"adapter exists":!!m,coinTossPhase:Oe,canSendInitGame:E,"initialStateSentRef.current":ho.current}),p&&E&&!ho.current){console.log("[GameScreen] HOST side: Sending initial game state to JOIN"),ho.current=!0;const w=()=>{const M=It?"p1":"p2";console.log("[GameScreen] HOST side: Actually sending INIT_GAME now",{isFirstPlayer:It,firstPlayerId:M,currentPlayerId:v,"adapter.isHost":m.isHost,isCasualOrRanked:B});const $=B?{...y,firstPlayerId:M,activePlayerId:M}:y;B&&O({type:"SYNC_STATE",payload:$}),m.send({type:"INIT_GAME",payload:$}),(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&(console.log("[GameScreen] HOST side: Sending READY_FOR_INTRO"),m.send({type:"READY_FOR_INTRO"}),nt.current=!0)};setTimeout(w,500),(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&setTimeout(()=>{et||(console.log("[GameScreen] HOST side: Retrying INIT_GAME (no response yet)"),w())},2500)}},[n,T,m,y,Oe,be,B,et]),P.useEffect(()=>{!B||!m||!N||nt.current||I&&(console.log("[GameScreen] JOIN side: Sending READY_FOR_INTRO after game sync"),m.send({type:"READY_FOR_INTRO"}),nt.current=!0)},[B,m,N,I]),P.useEffect(()=>{!B||!m||!Se||be&&et&&nt.current&&(console.log("[GameScreen] HOST side: Both ready, sending START_INTRO"),m.send({type:"START_INTRO"}),Pe(!1),te(!0))},[B,m,be,et,Se]);const le=y.players[v],Ne=y.players[_];P.useEffect(()=>{var E,w;const p=y.logs.length;if(p>La.current)for(let M=La.current;M<p;M++){const $=y.logs[M],z=$.match(/(.+?)  (\d+) /);if(z){const U=z[1],F=parseInt(z[2],10),Y=(le==null?void 0:le.name)===U?v:_,ce=Af.current++;Oa(Z=>[...Z,{playerId:Y,amount:F,key:ce}]),setTimeout(()=>{Oa(Z=>Z.filter(pe=>pe.key!==ce))},1500)}const q=$.match(/(.+?) (?:)?/);if(q){const U=q[1],F=(E=y.players[v])==null?void 0:E.board.find(pe=>(pe==null?void 0:pe.name)===U),Y=(w=y.players[_])==null?void 0:w.board.find(pe=>(pe==null?void 0:pe.name)===U),ce=F||Y,Z=F?v:_;if(ce){const pe=y.players[Z].board.findIndex(Ie=>(Ie==null?void 0:Ie.instanceId)===ce.instanceId),Ze=(Z===v?Wr.current:kr.current)[pe];if(Ze){const Ie=Ze.getBoundingClientRect(),ze=Ie.left+Ie.width/2,He=Ie.top+Ie.height/2;Bc(We=>[...We,{id:Date.now()+Math.random(),value:0,x:ze,y:He,color:"#e53e3e"}])}}}}La.current=p},[y.logs.length,v,_,le==null?void 0:le.name,y.players]);const[Ma,Ii]=j.useState(!1),D=j.useRef(!1),ve=Qx(((Qm=y.players[v])==null?void 0:Qm.board)||[],D),je=Qx(((qm=y.players[_])==null?void 0:qm.board)||[],D),ft=j.useRef(ve),bt=j.useRef(je),[vn,po]=j.useState(null),[Pf,_m]=j.useState(-1),Mc=j.useRef(null),[go,Da]=j.useState([]),[ee,ts]=j.useState(null),[yt,mr]=j.useState(null),[E2,bm]=j.useState([]),S2=j.useRef(0),Em=j.useRef(0),Sm=j.useRef(null),wm=j.useRef(ee);wm.current=ee,j.useEffect(()=>{const p=ee==null?void 0:ee.sourceType;if(!p||p!=="BOARD"&&p!=="EVOLVE"){bm([]);return}const E=400,w=setInterval(()=>{const M=wm.current;if(!M||M.sourceType!=="BOARD"&&M.sourceType!=="EVOLVE")return;const $=Date.now(),z=Math.PI*(3-Math.sqrt(5));Em.current+=z+(Math.random()-.5)*.3;const q=Em.current,U=4+Math.random()*3,F={id:S2.current++,x:M.currentX,y:M.currentY,vx:Math.cos(q)*U,vy:Math.sin(q)*U,opacity:1,radius:3+Math.random()*2,createdAt:$};bm(Y=>[...Y.filter(Z=>$-Z.createdAt<E).map(Z=>({...Z,x:Z.x+Z.vx,y:Z.y+Z.vy,opacity:Math.max(0,1-($-Z.createdAt)/E)})),F])},80);return()=>clearInterval(w)},[ee==null?void 0:ee.sourceType]),j.useEffect(()=>{const p=(ee==null?void 0:ee.sourceType)==="EVOLVE";if(p&&!pr.current){const E=new Audio(ot("/se/aura.mp3"));E.loop=!0,E.volume=0,E.play().catch(()=>{}),pr.current=E;const w=300,M=30,$=w/M,z=.25/$;let q=0;const U=setInterval(()=>{q++,pr.current&&(pr.current.volume=Math.min(q*z,.25)),q>=$&&clearInterval(U)},M)}else if(!p&&pr.current){const E=pr.current,w=200,M=20,$=w/M,z=E.volume/$;let q=0;const U=setInterval(()=>{q++,E.volume=Math.max(0,E.volume-z),q>=$&&(clearInterval(U),E.pause(),E.currentTime=0)},M);pr.current=null}return()=>{!ee&&pr.current&&(pr.current.pause(),pr.current=null)}},[ee==null?void 0:ee.sourceType]);const[Im,Of]=j.useState(new Set),[Tm,Dc]=j.useState(null),[Cm,Nc]=j.useState(null),[w2,km]=j.useState(null),[Ye,ns]=j.useState(null),Lf=j.useCallback(p=>{const E=os(p);E&&(y.winnerId?Aa(E):ns({card:E,owner:"OPPONENT",source:"LOG"}))},[y.winnerId]),I2=j.useCallback(p=>{const E=/([^]+)/g,w=[];let M=0,$,z=0;const q=yb();for(;($=E.exec(p))!==null;){$.index>M&&w.push(a.jsx("span",{children:p.slice(M,$.index)},z++));const U=$[1];q.includes(U)?w.push(a.jsxs("span",{style:{color:"#ffd700",cursor:"pointer",textDecoration:"underline",textUnderlineOffset:"2px",fontWeight:"bold"},onMouseEnter:Y=>{Y.target.style.color="#ffec8b",Y.target.style.textShadow="0 0 8px rgba(255, 215, 0, 0.8)"},onMouseLeave:Y=>{Y.target.style.color="#ffd700",Y.target.style.textShadow="none"},onClick:Y=>{Y.stopPropagation(),Lf(U)},children:["",U,""]},z++)):w.push(a.jsxs("span",{children:["",U,""]},z++)),M=$.index+$[0].length}return M<p.length&&w.push(a.jsx("span",{children:p.slice(M)},z++)),w.length>0?a.jsx(a.Fragment,{children:w}):p},[Lf]),[$c,mo]=j.useState([]),nn=(p,E,w,M)=>{if(!p)return;let $=window.innerWidth/2,z=window.innerHeight/2;const q=E===_;if(w===void 0||w===-1){const F=q?vo:Ti;if(F.current){const Y=F.current.getBoundingClientRect(),ce=fe(Y.left+Y.width/2,Y.top+Y.height/2);$=ce.x,z=ce.y}else z=q?150:b2-250}else if(w!==void 0&&w>=0){const F=q?kr:Wr,Y=q?bt.current:ft.current;let ce=w;if(M){const pe=Y.findIndex(we=>we&&we.instanceId===M);pe>=0&&(ce=pe)}const Z=F.current[ce];if(Z){const pe=Z.getBoundingClientRect(),we=fe(pe.left+pe.width/2,pe.top+pe.height/2);$=we.x,z=we.y}}mo(F=>[...F,{type:p,x:$,y:z,key:Date.now()+Math.random()}])},Rm=(p,E,w,M,$)=>{let z=window.innerWidth/2,q=window.innerHeight/2;const U=p===_,F=U?kr:Wr,Y=U?bt.current:ft.current;let ce=E;if($){const pe=Y.findIndex(we=>we&&we.instanceId===$);pe>=0&&(ce=pe)}const Z=F.current[ce];if(Z){const pe=Z.getBoundingClientRect(),we=fe(pe.left+pe.width/2,pe.top+pe.height/2);z=we.x,q=we.y}mo(pe=>[...pe,{type:"BUFF",x:z,y:q,key:Date.now()+Math.random(),atkBuff:w,hpBuff:M}])},Cr=(p,E,w,M)=>{nn(p,E,w,M),n==="HOST"&&T&&m&&m.send({type:"EFFECT",payload:{effectType:p,targetPlayerId:E||"",targetIndex:w??-1,targetInstanceId:M}})},Na=(p,E,w,M,$)=>{Rm(p,E,w,M,$),n==="HOST"&&T&&m&&m.send({type:"EFFECT",payload:{effectType:"BUFF",targetPlayerId:p,targetIndex:E,targetInstanceId:$,isBuff:!0,atkBuff:w,hpBuff:M}})},Am=j.useRef([]),Pm=j.useRef([]);j.useEffect(()=>{var M,$;const p=(z,q,U)=>{q.forEach(F=>{if(!F)return;if(!z.find(ce=>ce&&ce.instanceId===F.instanceId)&&F.killedByBane){const ce=U===_,Z=ce?kr:Wr,we=(ce?bt.current:ft.current).findIndex(Ze=>Ze&&Ze.instanceId===F.instanceId);if(we>=0&&Z.current[we]){const Ie=Z.current[we].getBoundingClientRect(),ze=fe(Ie.left+Ie.width/2,Ie.top+Ie.height/2);mo(He=>[...He,{type:"BANE",x:ze.x,y:ze.y,key:Date.now()+Math.random()}])}}})},E=((M=y.players[v])==null?void 0:M.board)||[],w=(($=y.players[_])==null?void 0:$.board)||[];p(E,Am.current,v),p(w,Pm.current,_),Am.current=E.map(z=>z?{...z}:null),Pm.current=w.map(z=>z?{...z}:null)},[y.players,v,_]);const Mf=600,[Ts,$a]=j.useState(null),Df=j.useRef({player:0,opponent:0}),[jt,ja]=j.useState(()=>{try{const p=localStorage.getItem("audioSettings");if(p){const E=JSON.parse(p);if(E.enabled!==void 0){const{enabled:w,...M}=E;return{...M,bgmEnabled:w,seEnabled:w}}return E}return{bgm:.3,se:.5,voice:.5,bgmEnabled:!0,seEnabled:!0}}catch{return{bgm:.3,se:.5,voice:.5,bgmEnabled:!0,seEnabled:!0}}}),Tt=j.useCallback((p,E=.5)=>{if(!jt.seEnabled)return;const w=new Audio(ot(`/se/${p}`));w.volume=jt.se*E,w.play().catch(M=>console.warn("SE Play prevented",M))},[jt]);j.useEffect(()=>{lt==="explode"&&Tt("explosion.mp3",.6)},[lt,Tt]);const jc=j.useRef(null);j.useEffect(()=>{if(ee&&yt&&!jc.current)Tt("Buon.mp3",.25);else if(ee&&yt&&jc.current){const p=jc.current;(p.instanceId!==yt.instanceId||p.index!==yt.index||p.playerId!==yt.playerId)&&Tt("Buon.mp3",.25)}jc.current=yt},[yt,ee,Tt]);const Dn=j.useRef(null),[T2,Om]=j.useState(!1);j.useEffect(()=>{localStorage.setItem("audioSettings",JSON.stringify(jt)),Dn.current&&(Dn.current.volume=jt.bgmEnabled?jt.bgm:0,jt.bgmEnabled?Dn.current.paused&&Dn.current.play().catch(p=>console.warn("Auto-play prevented",p)):Dn.current.pause())},[jt]);const[C2,Fc]=j.useState(!1),[k2,Nf]=j.useState(!1),[R2,Uc]=j.useState(!1),A2=j.useCallback(()=>{if(console.log("[GameScreen] handleSurrender called",{gameMode:n,currentPlayerId:v,isHost:be,adapterExists:!!m}),Uc(!1),Fc(!1),n==="RANKED_MATCH"){const p="rankedSurrenderTimestamps",E=localStorage.getItem(p);let w=[];try{w=E?JSON.parse(E):[]}catch(z){console.error("[GameScreen] Failed to parse surrender timestamps, resetting:",z),w=[]}w.push(Date.now());const M=Date.now()-10*60*1e3,$=w.filter(z=>z>M);if(localStorage.setItem(p,JSON.stringify($)),console.log(`[GameScreen] Surrender recorded. Recent surrenders in 10min: ${$.length}`),$.length>=3){const z=Date.now()+3e5;localStorage.setItem("rankedSurrenderCooldownEnd",z.toString()),console.log("%c[GameScreen] Surrender cooldown activated until:","background: #ff0000; color: #ffffff;",new Date(z).toLocaleTimeString())}}n!=="CPU"&&m&&(m.send({type:"SURRENDER",payload:{playerId:v}}),console.log("[GameScreen] SURRENDER message sent to opponent")),console.log("[GameScreen] Dispatching CONCEDE for player:",v),O({type:"CONCEDE",playerId:v})},[n,m,v,be]),[rs,$f]=j.useState(!1),jf=j.useRef(!1),[Lm,Mm]=j.useState(!1),[dt,Cs]=j.useState(null),yo=j.useRef(null),vo=j.useRef(null),kr=j.useRef([]),Wr=j.useRef([]),Ti=j.useRef(null),[P2,Bc]=j.useState([]),zc=j.useRef({player:20,opponent:20}),Hc=j.useRef({player:0,opponent:0}),Fa=j.useRef(new Map);j.useEffect(()=>{var $,z,q,U;if(!le||!Ne)return;const p=zc.current.opponent-Ne.hp;p>0&&ws(F=>({...F,damageDealtToOpponent:F.damageDealtToOpponent+p}));const E=zc.current.player-le.hp;E>0&&ws(F=>({...F,damageReceivedFromOpponent:F.damageReceivedFromOpponent+E}));const w=Hc.current.opponent-((($=Ne.board)==null?void 0:$.filter(F=>F).length)||0);w>0&&ws(F=>({...F,followersDestroyed:F.followersDestroyed+w}));const M=Hc.current.player-(((z=le.board)==null?void 0:z.filter(F=>F).length)||0);M>0&&ws(F=>({...F,myFollowersDestroyed:F.myFollowersDestroyed+M})),zc.current={player:le.hp,opponent:Ne.hp},Hc.current={player:((q=le.board)==null?void 0:q.filter(F=>F).length)||0,opponent:((U=Ne.board)==null?void 0:U.filter(F=>F).length)||0}},[le==null?void 0:le.hp,Ne==null?void 0:Ne.hp,(Zm=le==null?void 0:le.board)==null?void 0:Zm.length,(ey=Ne==null?void 0:Ne.board)==null?void 0:ey.length]);const xn=j.useRef(null),Dm="lastPlayedBgm",Nm=j.useCallback(p=>{const E={AJA:[ot("/bgm/Green Misty Mountains.mp3"),ot("/bgm/Jade Moon.mp3"),ot("/bgm/amaama.mp3"),ot("/bgm/kingetsu.mp3")],SENKA:[ot("/bgm/ouka.mp3"),ot("/bgm/Jade Moon.mp3"),ot("/bgm/amaama.mp3"),ot("/bgm/kingetsu.mp3")]},w=E[p]||E.SENKA,M=sessionStorage.getItem(Dm),$=w.length>1?w.filter(q=>q!==M):w,z=$[Math.floor(Math.random()*$.length)];return sessionStorage.setItem(Dm,z),encodeURI(z)},[]),[Ff,$m]=j.useState(null);j.useEffect(()=>{var p,E;if(console.log(`[PendingEffects] useEffect fired. isProcessingEffect=${Ma}, pendingEffects.length=${((p=y.pendingEffects)==null?void 0:p.length)||0}, gameMode=${n}`),n==="JOIN"){console.log("[PendingEffects] Early return: JOIN mode waits for EFFECT messages from HOST");return}if(Ma){console.log("[PendingEffects] Early return: isProcessingEffect=true");return}if(y.pendingEffects&&y.pendingEffects.length>0){const w=y.pendingEffects[0];if(console.log(`[PendingEffects] Processing effect: ${w.effect.type} from ${w.sourceCard.name}`),Mc.current===w){console.log("[PendingEffects] Early return: same effect already processed");return}if(Mc.current=w,Ii(!0),D.current=!0,w.effect.type==="GENERATE_CARD"&&w.effect.targetCardId){const _e=[w],X=y.pendingEffects||[];for(let $e=1;$e<X.length;$e++){const Ce=X[$e];if(Ce.effect.type==="GENERATE_CARD"&&Ce.sourceCard.id===w.sourceCard.id&&Ce.sourcePlayerId===w.sourcePlayerId)_e.push(Ce);else break}const oe=120,re=20,K=-(_e.length*oe+(_e.length-1)*re-oe)/2,ie=w.sourcePlayerId===v,Te=ie?window.innerWidth-200*g:200*g,De=ie?window.innerHeight-100*g:100*g,Re=_e.map(($e,Ce)=>({card:os($e.effect.targetCardId),status:"APPEAR",targetX:Te,targetY:De,xOffset:K+Ce*(oe+re)})).filter($e=>$e.card);if(Re.length>0){Da(Re),xn.current&&clearTimeout(xn.current),xn.current=setTimeout(()=>{Da($e=>$e.map(Ce=>({...Ce,status:"FLY"}))),xn.current=setTimeout(()=>{Da([]),Ii(!1),D.current=!1,(n==="CPU"||be)&&(_e.forEach(Ve=>{O({type:"RESOLVE_EFFECT",playerId:Ve.sourcePlayerId,payload:{targetId:Ve.targetId}})}),be&&n!=="CPU"&&T&&m&&setTimeout(()=>{const Ve=it.current;m.send({type:"GAME_STATE",payload:Ve})},50)),xn.current=null},600)},800);return}}const M=w.effect.type==="DAMAGE"||w.effect.type==="AOE_DAMAGE"||w.effect.type==="RANDOM_DAMAGE"||w.effect.type==="RANDOM_DAMAGE_BY_TURN",$=w.effect.type==="DESTROY"||w.effect.type==="RANDOM_DESTROY",z=w.effect.type==="HEAL_LEADER",q=w.effect.type==="RANDOM_SET_HP",U=w.effect.type==="SET_MAX_HP",F=w.effect.type==="RETURN_TO_HAND",Y=w.effect.type==="SUMMON_CARD"||w.effect.type==="SUMMON_CARD_RUSH",ce=w.effect.type==="VISUAL_BUFF_ONLY",Z=w.effect.type==="BUFF_STATS",pe=z||F||Y||ce||Z?600:50;if(M){let _e=w.sourceCard.attackEffectType||"SLASH";w.sourceCard.id==="c_alice"&&w.effect.targetType==="SELECT_FOLLOWER"&&(_e="WATER");const X=w.sourcePlayerId===v?_:v,oe=X===v?ve:je;if(w.effect.type==="AOE_DAMAGE")y.players[X].board.forEach(se=>{if(se){const K=oe.findIndex(ie=>(ie==null?void 0:ie.instanceId)===se.instanceId);K!==-1&&Cr(_e,X,K,se.instanceId)}});else if(w.targetIds&&w.targetIds.length>0){const re=w.targetIds;console.log(`[GameScreen] ${w.effect.type}: Playing effect for ${re.length} targets:`,re),console.log("[GameScreen] vBoard instanceIds:",oe.map(se=>se==null?void 0:se.instanceId)),w.effect.type==="RANDOM_DAMAGE_BY_TURN"?re.forEach((se,K)=>{setTimeout(()=>{const ie=oe.findIndex(Te=>(Te==null?void 0:Te.instanceId)===se);console.log(`[GameScreen] RANDOM_DAMAGE_BY_TURN: tid=${se}, vIdx=${ie}`),ie!==-1&&Cr(_e,X,ie,se)},K*300)}):re.forEach(se=>{const K=oe.findIndex(ie=>(ie==null?void 0:ie.instanceId)===se);console.log(`[GameScreen] RANDOM_DAMAGE: tid=${se}, vIdx=${K}`),K!==-1&&Cr(_e,X,K,se)})}else if(w.effect.type==="RANDOM_DAMAGE"||w.effect.type==="RANDOM_DAMAGE_BY_TURN")console.warn(`[GameScreen] ${w.effect.type} effect without targetIds - skipping visual effect. current:`,w);else if(w.effect.targetType==="OPPONENT")Cr(_e,X,-1),tr();else if(w.targetId){const re=oe.findIndex(se=>(se==null?void 0:se.instanceId)===w.targetId);re!==-1&&Cr(_e,X,re,w.targetId)}}else if($){let _e=w.sourceCard.attackEffectType||"IMPACT";const X=w.sourcePlayerId===v?_:v,oe=X===v?ve:je;if(w.effect.targetType==="ALL_OTHER_FOLLOWERS"){oe.forEach((K,ie)=>{K&&K.instanceId!==w.sourceCard.instanceId&&Cr(_e,X,ie,K.instanceId)});const re=w.sourcePlayerId;(re===v?ve:je).forEach((K,ie)=>{K&&K.instanceId!==w.sourceCard.instanceId&&Cr(_e,re,ie,K.instanceId)}),tr()}else if(w.targetIds)w.targetIds.forEach(re=>{const se=oe.findIndex(K=>(K==null?void 0:K.instanceId)===re);se!==-1&&Cr(_e,X,se,re)});else if(w.targetId){const re=oe.findIndex(se=>(se==null?void 0:se.instanceId)===w.targetId);re!==-1&&Cr(_e,X,re,w.targetId)}}else if(z){const _e=w.sourcePlayerId;Cr("HEAL",_e)}else if(U){const _e=w.sourcePlayerId===v?_:v;Cr("RAY",_e,-1),tr()}if(w.effect.type==="BUFF_STATS"){const _e=w.effect.value??0,X=w.effect.value2??0,oe=w.sourcePlayerId;if(w.effect.targetType==="SELF"){const se=(oe===v?ve:je).findIndex(K=>(K==null?void 0:K.instanceId)===w.sourceCard.instanceId);se!==-1&&Na(oe,se,_e,X,w.sourceCard.instanceId)}else if(w.effect.targetType==="ALL_FOLLOWERS"){const re=oe===v?ve:je,se=y.players[oe].board,K=w.effect.conditions;se.forEach(ie=>{var Te;if(ie){if(K!=null&&K.tag&&!((Te=ie.tags)!=null&&Te.includes(K.tag))||K!=null&&K.nameIn&&!K.nameIn.includes(ie.name))return;const De=re.findIndex(Re=>(Re==null?void 0:Re.instanceId)===ie.instanceId);De!==-1&&Na(oe,De,_e,X,ie.instanceId)}})}else if(w.effect.targetType==="ALL_OTHER_FOLLOWERS"){const re=oe===v?ve:je,se=y.players[oe].board,K=w.effect.conditions;se.forEach(ie=>{var Te;if(ie&&ie.instanceId!==w.sourceCard.instanceId){if(K!=null&&K.tag&&!((Te=ie.tags)!=null&&Te.includes(K.tag))||K!=null&&K.nameIn&&!K.nameIn.includes(ie.name))return;const De=re.findIndex(Re=>(Re==null?void 0:Re.instanceId)===ie.instanceId);De!==-1&&Na(oe,De,_e,X,ie.instanceId)}})}else if(w.targetId){const se=(oe===v?ve:je).findIndex(K=>(K==null?void 0:K.instanceId)===w.targetId);se!==-1&&Na(oe,se,_e,X,w.targetId)}}if(ce){const _e=w.effect.value??0,X=w.effect.value2??0,oe=w.sourcePlayerId,re=w.sourceCard;setTimeout(()=>{const se=oe===v?ve:je;if(re!=null&&re.instanceId){const K=se.findIndex(ie=>(ie==null?void 0:ie.instanceId)===re.instanceId);K!==-1&&Na(oe,K,_e,X,re.instanceId)}},300)}xn.current&&clearTimeout(xn.current);const Ze=M||$||q||U,Ie=w.effect.type==="RANDOM_DAMAGE_BY_TURN",ze=Ie?((E=w.targetIds)==null?void 0:E.length)||y.turnCount:1,He=Ie?ze*300+300:0,We=Ie?He:Ze?700:pe,Ge=Ie?200:Ze?700:0;xn.current=setTimeout(()=>{(n==="CPU"||be)&&(O({type:"RESOLVE_EFFECT",playerId:w.sourcePlayerId,payload:{targetId:w.targetId}}),be&&n!=="CPU"&&T&&m&&setTimeout(()=>{const oe=it.current;m.send({type:"GAME_STATE",payload:oe})},50)),Ge>0?xn.current=setTimeout(()=>{Ii(!1),D.current=!1,xn.current=null},Ge):(Ii(!1),D.current=!1,xn.current=null)},We)}else Mc.current=null,xn.current&&(clearTimeout(xn.current),xn.current=null)},[y.pendingEffects,Ma,v,_,n,T,m]),j.useEffect(()=>{if(y.activePlayerId!==v)return;const p=v===y.firstPlayerId,E=y.turnCount,w=p?5:4;if(E===(p?7:6)){if(Pf===E)return;po("SUPER_EVOLVE_READY"),_m(E),setTimeout(()=>po(null),2500)}else if(E===w){if(Pf===E)return;po("EVOLVE_READY"),_m(E),setTimeout(()=>po(null),2500)}},[y.turnCount,y.activePlayerId,v,Pf,y.firstPlayerId]);const Wc=j.useRef(y.players);j.useEffect(()=>{const p=Wc.current,E=new Set;if(Object.keys(y.players).forEach(w=>{const M=y.players[w],$=p[w];if(!$)return;const z=new Set($.board.filter(U=>U).map(U=>U.instanceId)),q=new Set($.hand.filter(U=>U).map(U=>U.instanceId));M.board.forEach(U=>{if(!U)return;const F=U.instanceId;!z.has(F)&&!q.has(F)&&E.add(F)})}),E.size>0){Of(M=>new Set([...M,...E]));const w=setTimeout(()=>{Of(new Set)},1e3);return()=>clearTimeout(w)}},[y.players]),j.useEffect(()=>{const p=Wc.current,E=y.players;let w=[];const M=$=>{const z=$.getBoundingClientRect();return{x:z.left+z.width/2,y:z.top+z.height/2}};Object.keys(E).forEach($=>{const z=E[$],q=p[$];if(q&&z.hp<q.hp){const U=q.hp-z.hp,Y=$===v?Ti.current:vo.current;if(Y){const ce=M(Y);w.push({id:Date.now()+Math.random(),value:U,x:ce.x,y:ce.y,color:"#e53e3e"})}}else if(q&&z.hp>q.hp){const U=z.hp-q.hp,Y=$===v?Ti.current:vo.current;if(Y){const ce=M(Y);w.push({id:Date.now()+Math.random(),value:"+"+U,x:ce.x,y:ce.y,color:"#48bb78"})}}q==null||q.board.forEach(U=>{if(!U)return;const F=z.board.find(Y=>(Y==null?void 0:Y.instanceId)===U.instanceId);if(F){const Y=z.board.findIndex(we=>(we==null?void 0:we.instanceId)===F.instanceId),pe=($===v?Wr.current:kr.current)[Y];if(pe){const we=M(pe);if(Fa.current.set(U.instanceId,we),F.currentHealth<U.currentHealth){const Ze=U.currentHealth-F.currentHealth;w.push({id:Date.now()+Math.random(),value:Ze,x:we.x,y:we.y,color:"#e53e3e"})}else if(F.currentHealth>U.currentHealth){const Ze=F.hasEvolved&&!U.hasEvolved,Ie=F.currentAttack!==U.currentAttack||F.maxHealth!==U.maxHealth;if(!Ze&&!Ie){const ze=F.currentHealth-U.currentHealth;w.push({id:Date.now()+Math.random(),value:"+"+ze,x:we.x,y:we.y,color:"#48bb78"})}}else F.currentHealth===U.currentHealth&&U.hasBarrier&&!F.hasBarrier&&w.push({id:Date.now()+Math.random(),value:0,x:we.x,y:we.y,color:"#e53e3e"})}}else{const Y=z.graveyard.find(Z=>Z.instanceId===U.instanceId);let ce=0;if(Y){const Z=Y.currentHealth||0;Z<=0?ce=U.currentHealth-Z:ce=0}else ce=U.currentHealth;if(ce>0){const Z=Fa.current.get(U.instanceId);Z&&(Z.x!==0||Z.y!==0)&&w.push({id:Date.now()+Math.random(),value:ce,x:Z.x,y:Z.y,color:"#e53e3e"})}Fa.current.delete(U.instanceId)}})}),w.length>0&&(Bc(z=>[...z,...w]),w.some(z=>z.color!=="#48bb78")&&tr()),Wc.current=E},[y.players,v,_]);const Uf=j.useRef(null),tr=()=>{Uf.current||(Mm(!0),Uf.current=setTimeout(()=>{Mm(!1),Uf.current=null},300))},Bf=P.useCallback(p=>{Bc([]),mo([]),Da([]),nr(null),xo(null),$a(null),Of(new Set),ks.current=!1,zf.current=null,ws({turnCount:0,damageDealtToOpponent:0,damageReceivedFromOpponent:0,followersDestroyed:0,myFollowersDestroyed:0}),zc.current={player:20,opponent:20},Hc.current={player:0,opponent:0},Aa(null),Ae(!1),Pt(!1),Ot(null),Zn(!1),Ca(!1),Rc(null),Si(!1),ka("normal");const E=p||yn;p&&Ra(p);let w=x;e==="CPU"&&(E==="YORUKA"?w=Math.random()<.5?"SENKA":"AJA":w=E==="SENKA"?"AJA":"SENKA");const $=Dd(u,E,e==="ONLINE"?"":"CPU",w);Wc.current=$.players,Df.current={player:$.players.p1.hand.length,opponent:$.players.p2.hand.length},$m(null),te(n!=="JOIN");const z=n==="CASUAL_MATCH"||n==="RANKED_MATCH";Zt(n==="JOIN"||z&&!be?!1:Math.random()>.5),Bt("IDLE"),me(null),Wt(!1),(n==="HOST"||z)&&(ho.current=!1),O({type:"SYNC_STATE",payload:$})},[yn,x,e,n]),O2=P.useCallback(()=>{te(!1),J(!1),Qe(!0),me(It?"FIRST":"SECOND");const p=v,E=v==="p1"?"p2":"p1",w=y.firstPlayerId||(It?p:E),M=w===p?E:p;if(y.activePlayerId!==w||y.players[w].pp!==1||y.players[M].pp!==0){const z={...y,activePlayerId:w,firstPlayerId:w,players:{[w]:{...y.players[w],maxPp:1,pp:1},[M]:{...y.players[M],maxPp:0,pp:0}},logs:y.logs.length===0?[` 1 - ${y.players[w].name} `]:y.logs};O({type:"SYNC_STATE",payload:z})}Bt("DONE")},[y,It,v]);P.useEffect(()=>{},[y.phase,Oe,n,Tt,T]),j.useEffect(()=>{if(Ff===le.class&&Dn.current)return;const p=Nm(le.class);console.log(`[BGM] Initializing track: ${p} for class: ${le.class}`),Dn.current&&(Dn.current.pause(),Dn.current=null);const E=new Audio(p);E.loop=!0,E.volume=jt.bgm,Dn.current=E,$m(le.class)},[le.class,Nm,Ff]),j.useEffect(()=>()=>{Dn.current&&(console.log("[GameScreen] Stopping BGM on unmount"),Dn.current.pause(),Dn.current=null)},[]),j.useEffect(()=>{if(!Dn.current)return;const p=Dn.current,E=()=>{p.paused&&jt.bgmEnabled&&(console.log("[BGM] Attempting play on interaction..."),p.play().then(()=>{console.log("[BGM] Play success"),w()}).catch(M=>console.warn("[BGM] Play failed on interaction:",M)))},w=()=>{document.removeEventListener("click",E),document.removeEventListener("keydown",E),document.removeEventListener("touchstart",E)};return jt.bgmEnabled?(document.addEventListener("click",E),document.addEventListener("keydown",E),document.addEventListener("touchstart",E),p.play().then(()=>{console.log("[BGM] Immediate play success"),w()}).catch(()=>console.log("[BGM] Immediate play blocked, waiting for interaction"))):(p.pause(),w()),()=>{w()}},[jt.bgmEnabled,jt.bgm,Ff]),P.useEffect(()=>{if(!m){console.log("[GameScreen] Message handler setup skipped - no adapter yet");return}console.log("[GameScreen] Setting up message handler, adapter.isHost:",m.isHost);const p=E=>{var w,M,$,z,q;if(console.log("[GameScreen] Received message:",E.type,E),E.type==="HANDSHAKE"){const U=(w=E.payload)==null?void 0:w.name,F=typeof U=="string"&&U.trim().slice(0,12)||"";console.log("[GameScreen] Received HANDSHAKE from opponent:",F),gr.current=F,O({type:"UPDATE_PLAYER_NAME",payload:{playerId:v==="p1"?"p2":"p1",name:F}});return}if(E.type==="INIT_GAME"){console.log("[GameScreen] JOIN side: Received initial game state from HOST"),O({type:"SYNC_STATE",payload:E.payload}),O({type:"UPDATE_PLAYER_NAME",payload:{playerId:v,name:u}});const U=v==="p1"?"p2":"p1";gr.current&&(console.log("[GameScreen] Re-applying opponent name after INIT_GAME:",gr.current),O({type:"UPDATE_PLAYER_NAME",payload:{playerId:U,name:gr.current}})),ne(!0);const F=E.payload.firstPlayerId,Y=F===v;console.log("[GameScreen] JOIN side: Setting isFirstPlayer",{"received firstPlayerId":F,currentPlayerId:v,"adapter?.isHost":m==null?void 0:m.isHost,"isHost (calculated)":be,isJoinSideFirst:Y,comparison:`${F} === ${v} = ${Y}`}),Zt(Y),n==="CASUAL_MATCH"||n==="RANKED_MATCH"?console.log("[GameScreen] CASUAL_MATCH JOIN side: Waiting for intro sync"):te(!0);return}if(E.type==="READY_FOR_INTRO"){console.log("[GameScreen] Received READY_FOR_INTRO from opponent"),at(!0);return}if(E.type==="START_INTRO"){console.log("[GameScreen] Received START_INTRO - starting BattleIntro now"),Pe(!1),te(!0);return}if(E.type==="GAME_STATE"){console.log("[GameScreen] JOIN: Received GAME_STATE sync from HOST"),O({type:"SYNC_STATE",payload:E.payload}),Ii(!1),D.current=!1,Mc.current=null,Da([]),xn.current&&(clearTimeout(xn.current),xn.current=null),!Ba.current&&!bo.current&&(kn.current=!1);return}if(E.type==="EFFECT"){const{effectType:U,targetPlayerId:F,targetIndex:Y,targetInstanceId:ce,isBuff:Z,atkBuff:pe,hpBuff:we}=E.payload;console.log("[GameScreen] JOIN: Received EFFECT from HOST:",U,F,Y,ce),setTimeout(()=>{Z&&pe!==void 0&&we!==void 0?Rm(F,Y,pe,we,ce):nn(U,F,Y,ce)},50);return}if(E.type==="EVOLVE_ANIM"){const{playerId:U,followerIndex:F,useSep:Y,targetId:ce,instanceId:Z}=E.payload,pe=(M=y.players[U])==null?void 0:M.board[F];if(pe){const we=pe.evolvedImageUrl||(($=os(pe.id))==null?void 0:$.evolvedImageUrl),Ze=Z||pe.instanceId,Ie=je.findIndex(X=>X&&X.instanceId===Ze),ze=Ie>=0?kr.current[Ie]:null,He=he.current.scale,We=window.innerHeight/2;let Ge=window.innerWidth/2,_e=We-70*He;if(ze){const X=ze.getBoundingClientRect();Ge=X.left+X.width/2,_e=X.top+X.height/2}xo({card:pe,evolvedImageUrl:we,startX:Ge,startY:_e,phase:"ZOOM_IN",followerIndex:F,sourcePlayerId:U,useSep:Y||!1,targetId:ce,isRemote:!0}),Tt("fon.mp3",.7)}return}if(E.type==="PLAY_CARD_ANIM"){const{playerId:U,card:F,targetBoardIndex:Y}=E.payload;if(F){const ce=((z=y.players[U])==null?void 0:z.board)||[],Z=typeof Y=="number"?Y:ce.filter(K=>K!==null).length,pe=he.current.scale,we=window.innerWidth/2,Ze=window.innerHeight/2,Ie=we,ze=80*pe,He=we,We=Ze-100*pe,oe=-((Math.max(1,Z+1)-1)*ki*pe)/2+Z*ki*pe,re=we+oe,se=Ze-70*pe;F.type==="SPELL"?nr({card:F,sourceIndex:-1,startX:Ie,startY:ze,targetX:He,targetY:We,playerClass:(Ne==null?void 0:Ne.class)||"SENKA",onComplete:()=>{nr(null)}}):nr({card:F,sourceIndex:-1,startX:Ie,startY:ze,targetX:He,targetY:We,finalX:re,finalY:se,playerClass:(Ne==null?void 0:Ne.class)||"SENKA",onComplete:()=>{Tt("gan.mp3",.6),tr(),nr(null)}})}return}if(E.type==="REMATCH_REQUEST"){console.log("[GameScreen] Opponent requested rematch"),Ca(!0);return}if(E.type==="REMATCH_ACCEPT"){console.log("[GameScreen] Opponent accepted rematch - starting new game"),Bf(yn);return}if(E.type==="SURRENDER"){const U=(q=E.payload)==null?void 0:q.playerId;if(y.phase==="GAME_OVER"){console.warn("[GameScreen] Ignoring SURRENDER - game already over");return}if(U===v){console.warn(`[GameScreen] Security Alert: Received SURRENDER message targeting self (${v}). Ignoring.`);return}if(U!==_){console.warn(`[GameScreen] Security Alert: Invalid playerId in SURRENDER: ${U}. Expected: ${_}. Ignoring.`);return}console.log("[GameScreen] Opponent surrendered:",U),ka("surrender"),O({type:"CONCEDE",playerId:U});return}if(E.type==="STAMP"){console.log("[GameScreen] Opponent sent stamp:",E.stampId),hr.current&&(clearTimeout(hr.current),hr.current=null);const U=yv(E.stampId);U&&Tt(U,.6);const F={stampId:E.stampId,playerId:_,playerClass:E.playerClass||(Ne==null?void 0:Ne.class)||"SENKA",timestamp:Date.now()};Is(null),requestAnimationFrame(()=>{Is(F)}),hr.current=setTimeout(()=>{Is(Y=>(Y==null?void 0:Y.timestamp)===F.timestamp?null:Y),hr.current=null},3e3);return}if(E.type==="ACTION"){const U=E.payload;if(console.log("[GameScreen] Processing remote action:",U.type,"from player:",U.playerId),O({...U,isRemote:!0}),U.type==="ATTACK"){const{playerId:F,payload:Y}=U,ce=y.players[F],Z=ce==null?void 0:ce.board[Y.attackerIndex],pe=Y.targetIsLeader?-1:Y.targetIndex,we=F==="p1"?"p2":"p1";if(Z){const Ze=y.players[we],Ie=Y.targetIsLeader?null:Ze==null?void 0:Ze.board[Y.targetIndex],ze=Ie?Ie.instanceId:void 0;nn(Z.attackEffectType,we,pe,ze)}}else U.type==="PLAY_CARD"||U.type==="EVOLVE"||U.type==="END_TURN"&&(console.log("[GameScreen] Remote END_TURN received, turn switching to:",U.playerId==="p1"?"p2":"p1"),_o.current=!1)}};return m.onMessage(p),n!=="CPU"&&!Lc.current&&(Lc.current=!0,m.send({type:"HANDSHAKE",payload:{name:u,class:t}}),console.log("[GameScreen] Sent HANDSHAKE:",u,t)),m.onClose(()=>{const E=it.current,w=E.phase==="GAME_OVER"||E.winnerId;if((n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&w){console.log("[GameScreen] Connection closed after game over (casual match) - silent disconnect");return}if(n!=="CPU"&&!w){console.log("[GameScreen] Opponent disconnected during game - treating as surrender, player wins"),ka("disconnect");const M={...E,phase:"GAME_OVER",winnerId:v,logs:[...E.logs,""]};O({type:"SYNC_STATE",payload:M});return}alert(`
`),s()}),()=>{}},[m,Tt,nn,n,s,v]);const ks=j.useRef(!1),zf=j.useRef(null),Gn=j.useRef(null),[rt,nr]=j.useState(null),[Gt,xo]=j.useState(null),kn=j.useRef(!1),Ua=j.useRef(null),_o=j.useRef(!1),Hf=j.useRef($c),Wf=j.useRef(go),Ba=j.useRef(rt),bo=j.useRef(Gt);P.useEffect(()=>{Hf.current=$c,Wf.current=go,Ba.current=rt,bo.current=Gt},[$c,go,rt,Gt]),P.useEffect(()=>{if(rt&&rt.card.name===""&&jt.seEnabled){const p=new Audio(ot("/se/beam.mp3"));p.volume=jt.se*.8,p.play().catch(E=>console.warn("SE Play prevented",E))}},[rt,jt]),P.useEffect(()=>{ft.current=ve,bt.current=je},[ve,je]),P.useEffect(()=>{const p=E=>{const w=E.getBoundingClientRect();return{x:w.left+w.width/2,y:w.top}};ve.forEach((E,w)=>{if(E&&E.instanceId){const M=Wr.current[w];if(M){const $=p(M);($.x!==0||$.y!==0)&&Fa.current.set(E.instanceId,$)}}}),je.forEach((E,w)=>{if(E&&E.instanceId){const M=kr.current[w];if(M){const $=p(M);($.x!==0||$.y!==0)&&Fa.current.set(E.instanceId,$)}}})},[ve,je]);const Gc=(p,E,w,M)=>{const $=Gr.current.board,z=M?$.findIndex(Z=>Z&&Z.instanceId===M):p,q=z>=0?$[z]:null;if(!q)return;if(q.hasEvolved){console.log("[GameScreen] Cannot evolve: card already evolved");return}const U=Wr.current[p];let F=window.innerWidth/2,Y=window.innerHeight/2;if(U){const Z=U.getBoundingClientRect();F=Z.left+Z.width/2,Y=Z.top+Z.height/2}const ce=q.instanceId;n!=="CPU"&&T&&m&&m.send({type:"EVOLVE_ANIM",payload:{playerId:v,followerIndex:z,useSep:E,targetId:w,instanceId:ce}}),xo({card:q,evolvedImageUrl:q.evolvedImageUrl,startX:F,startY:Y,phase:"ZOOM_IN",followerIndex:z,useSep:E,targetId:w,sourcePlayerId:v}),Tt("fon.mp3",.7)},Gf=j.useRef(null),L2=j.useCallback(p=>{if(console.log("[GameScreen] handleEvolvePhaseChange:",p),p==="WHITE_FADE"&&Tt("fon.mp3",.7),p==="LAND"&&Tt("gan.mp3",.6),p==="DONE"){const E=bo.current;if(E&&!E.isRemote){const M={type:"EVOLVE",playerId:E.sourcePlayerId||v,payload:{followerIndex:E.followerIndex,useSep:E.useSep,targetId:E.targetId}};O(M),m&&n!=="CPU"&&m.send({type:"ACTION",payload:M})}xo(null)}else xo(E=>E?{...E,phase:p}:null)},[m,O,n,v,Tt]),Vf=(p,E,w)=>{var Ge,_e,X,oe,re,se;const $=Gr.current.hand[p];if(!$){console.warn("[handlePlayCard] Card not found at index:",p);return}if($.instanceId&&Ua.current===$.instanceId){console.warn("[handlePlayCard] Duplicate play blocked for instanceId:",$.instanceId);return}if(kn.current){console.warn("[handlePlayCard] Card play locked, ignoring duplicate call");return}kn.current=!0,Ua.current=$.instanceId||null,Tt("card.mp3",.5);const z=(Ge=$.triggers)==null?void 0:Ge.find(K=>K.trigger==="FANFARE"),q=z==null?void 0:z.effects[0];let U=_;const F=(q==null?void 0:q.targetType)==="SELECT_ALLY_FOLLOWER"||(q==null?void 0:q.targetType)==="SELECT_OTHER_ALLY_FOLLOWER";q&&(F||["GRANT_PASSIVE","BUFF_STATS","HEAL_FOLLOWER"].includes(q.type))&&(U=v);const Y=["SELECT_FOLLOWER","SELECT_ALLY_FOLLOWER","SELECT_OTHER_ALLY_FOLLOWER"],ce=$.type==="SPELL"&&((_e=$.triggers)==null?void 0:_e.some(K=>K.effects.some(ie=>ie.targetType&&Y.includes(ie.targetType))))||$.type==="FOLLOWER"&&(((oe=(X=$.triggerAbilities)==null?void 0:X.FANFARE)==null?void 0:oe.targetType)&&Y.includes($.triggerAbilities.FANFARE.targetType)||((re=$.triggers)==null?void 0:re.some(K=>K.trigger==="FANFARE"&&K.effects.some(ie=>ie.targetType&&Y.includes(ie.targetType))))),pe=it.current.players[U].board.some(K=>{var ie,Te;return K&&(U===v||!((ie=K.passiveAbilities)!=null&&ie.includes("STEALTH"))&&!((Te=K.passiveAbilities)!=null&&Te.includes("AURA")))});if(console.log(`[handlePlayCard] needsTarget: ${ce}, allowedTarget: ${U}, hasValidTargets: ${pe}`),ce&&pe){Cs({type:"PLAY",sourceIndex:p,sourceInstanceId:$.instanceId,allowedTargetPlayerId:U}),ts(null);return}const we=window.innerWidth/2,Ze=window.innerHeight/2;let Ie,ze;if($.type==="FOLLOWER"){const ie=it.current.players[v].board.filter(Me=>Me!==null),Te=ie.length+1,De=ie.length,Re=ki*g,$e=(De-(Te-1)/2)*Re,Ce=(se=yo.current)==null?void 0:se.getBoundingClientRect();Ie=(Ce?Ce.left+Ce.width/2:window.innerWidth/2)+$e,ze=window.innerHeight/2+70*g}const He=()=>{$.type!=="SPELL"&&(Tt("gan.mp3",.6),tr()),Rs({type:"PLAY_CARD",playerId:v,payload:{cardIndex:p,instanceId:$.instanceId}}),nr(null),setTimeout(()=>{kn.current=!1},100)},We=$.type==="FOLLOWER"?it.current.players[v].board.filter(K=>K!==null).length:void 0;n!=="CPU"&&T&&m&&m.send({type:"PLAY_CARD_ANIM",payload:{playerId:v,cardIndex:p,card:$,targetBoardIndex:We}}),nr({card:$,sourceIndex:p,startX:E,startY:w,targetX:we,targetY:Ze,finalX:Ie,finalY:ze,playerClass:(le==null?void 0:le.class)||"SENKA",onComplete:He}),setTimeout(()=>{nr(K=>(K==null?void 0:K.card.id)===$.id?(He(),null):K)},2e3)},Rs=p=>{O(p),n!=="CPU"&&T&&!p.isRemote&&(m==null||m.send({type:"ACTION",payload:p}))};j.useEffect(()=>{if(!Gt&&Gf.current){const p=Gf.current;Gf.current=null,console.log("[GameScreen] Dispatching pending evolve action for:",p.playerId),Rs({type:"EVOLVE",playerId:p.playerId,payload:{followerIndex:p.followerIndex,useSep:p.useSep,targetId:p.targetId}})}},[Gt,v,Rs]);const Gr=j.useRef(le),it=j.useRef(y);j.useEffect(()=>{Gr.current=le,it.current=y},[le,y]);const Rr=j.useRef(!1);j.useEffect(()=>{const p=Df.current,E=le.hand.length,w=Ne.hand.length;if(E>p.player){const M=E-p.player;$a({isPlayer:!0,count:M}),Tt("card.mp3",.5),setTimeout(()=>$a(null),Mf)}if(w>p.opponent){const M=w-p.opponent;$a({isPlayer:!1,count:M}),Tt("card.mp3",.5),setTimeout(()=>$a(null),Mf)}Df.current={player:E,opponent:w}},[le.hand.length,Ne.hand.length,jt,Tt]),P.useEffect(()=>{y.activePlayerId===v&&(console.log("[GameScreen] Player turn started - resetting card play lock and ending turn state"),kn.current=!1,Ua.current=null,_o.current=!1)},[y.activePlayerId,y.turnCount,v]),P.useEffect(()=>{if(n==="CPU")return;const p=setInterval(()=>{kn.current&&!Ba.current&&!bo.current&&!dt&&y.activePlayerId===v&&(console.warn("[GameScreen] Safety release: Card play lock was stuck, releasing"),kn.current=!1)},3e3);return()=>clearInterval(p)},[n,dt,y.activePlayerId,v]),P.useEffect(()=>{if(n!=="CPU")return;if(y.winnerId){ks.current=!1;return}const p=`${y.turnCount}-${y.activePlayerId}`;if(y.activePlayerId===v){ks.current=!1;return}if(y.activePlayerId===_){if(ks.current||zf.current===p)return;(async()=>{var Ie,ze,He,We,Ge,_e;ks.current=!0,zf.current=p;const w=async(X=300)=>{await new Promise(se=>setTimeout(se,X));const oe=()=>{const se=it.current,K=se.pendingEffects&&se.pendingEffects.length>0,ie=Hf.current.length>0,Te=Wf.current.length>0,De=Ba.current!==null,Re=bo.current!==null;return!K&&!ie&&!Te&&!De&&!Re};let re=0;for(;!oe()&&re<60;){await new Promise(K=>setTimeout(K,100)),re++;const se=it.current;if(se.pendingEffects&&se.pendingEffects.length>0&&!D.current){console.log("[waitForIdle] Forcing RESOLVE_EFFECT for stuck pending effect");const K=se.pendingEffects[0];O({type:"RESOLVE_EFFECT",playerId:K.sourcePlayerId,payload:{targetId:K.targetId}}),await new Promise(ie=>setTimeout(ie,200))}}},M=(X,oe)=>{var re;return X?!!((re=X.passiveAbilities)!=null&&re.includes("IMMUNE_TO_FOLLOWER_DAMAGE")):!1},$=(X,oe)=>{var re;return!oe||!X?!1:(re=oe.passiveAbilities)!=null&&re.includes("BANE")&&!X.hasBarrier?!0:(oe.currentAttack||0)>=X.currentHealth},z=(X,oe)=>{var re;return!oe||!X?!1:(re=X.passiveAbilities)!=null&&re.includes("BANE")?!oe.hasBarrier:X.currentAttack>=oe.currentHealth},q=X=>{var ie,Te,De;let oe=0;const re=X.players[_].board.filter(Re=>Re!==null),K=X.players[v].board.filter(Re=>Re!==null).some(Re=>{var $e,Ce;return(($e=Re.passiveAbilities)==null?void 0:$e.includes("WARD"))&&!((Ce=Re.passiveAbilities)!=null&&Ce.includes("STEALTH"))});for(const Re of re)!Re.canAttack||!((ie=Re.passiveAbilities)!=null&&ie.includes("STORM")||Re.turnPlayed!==X.turnCount)||K&&!((Te=Re.passiveAbilities)!=null&&Te.includes("STEALTH"))&&!Re.hadStealth||(oe+=Re.currentAttack||0,(De=Re.passiveAbilities)!=null&&De.includes("DOUBLE_ATTACK")&&(oe+=Re.currentAttack||0));return oe},U=X=>{var se,K,ie;let oe=0;const re=X.players[v].board.filter(Te=>Te!==null);for(const Te of re)oe+=Te.currentAttack||0,(se=Te.passiveAbilities)!=null&&se.includes("DOUBLE_ATTACK")&&(oe+=Te.currentAttack||0),(K=Te.passiveAbilities)!=null&&K.includes("BANE")&&(oe+=15),(ie=Te.passiveAbilities)!=null&&ie.includes("STORM")&&(oe+=10);return oe},F=(X,oe)=>{var $e,Ce,Ve,Me;let re=X.cost*10;const se=oe.players[v].board.filter(Be=>Be!==null),K=oe.players[_].board.filter(Be=>Be!==null),ie=oe.players[v].hp,Te=oe.players[_].hp,De=oe.players[_].pp;if(($e=X.passiveAbilities)!=null&&$e.includes("STORM")){const Be=q(oe),Fe=X.attack||0;Be+Fe>=ie?re+=500:ie<=10?re+=100:re+=30}if(se.length>0){const Be=X.triggers||[],Fe=U(oe);for(const Mt of Be)if(Mt.trigger==="FANFARE")for(const Ke of Mt.effects||[]){if(Ke.type==="DESTROY"&&(re+=60+(Fe>10?30:0)),Ke.type==="RANDOM_DESTROY"){const st=Ke.value||1;re+=40*st+(Fe>10?20:0)}["DAMAGE","SELECT_DAMAGE"].includes(Ke.type)&&(re+=35),Ke.type==="AOE_DAMAGE"&&(re+=25*Math.min(se.length,3))}}Te<=10&&((Ce=X.passiveAbilities)!=null&&Ce.includes("WARD")&&(re+=80),re+=20),X.cost===De?re+=15:De-X.cost<=1&&(re+=10);const Re=X.triggers||[];for(const Be of Re)if(Be.trigger==="FANFARE")for(const Fe of Be.effects||[])Fe.type==="DRAW"&&(re+=20*(Fe.value||1)),(Fe.type==="SUMMON_CARD"||Fe.type==="SUMMON_CARD_RUSH")&&(re+=30),Fe.type==="GENERATE_CARD"&&(re+=15),Fe.type==="HEAL"&&(re+=Te<15?25:10);return X.type==="FOLLOWER"&&((X.attack||0)+(X.health||0)>=X.cost*2.5&&(re+=15),(Ve=X.passiveAbilities)!=null&&Ve.includes("WARD")&&se.length>0&&(re+=25),(Me=X.passiveAbilities)!=null&&Me.includes("BANE")&&(re+=20)),X.type==="FOLLOWER"&&K.length>=5&&(re-=200),re},Y=(X,oe,re,se)=>{let K=0;const ie=re.players[v].board.filter(Ce=>Ce!==null),Te=re.players[_].board.filter(Ce=>Ce!==null),De=X.triggers||[],Re=se?"SUPER_EVOLVE":"EVOLVE";let $e=!1;for(const Ce of De)if(Ce.trigger===Re){$e=!0;for(const Ve of Ce.effects||[]){if(["DESTROY","RANDOM_DESTROY","DAMAGE","SELECT_DAMAGE","AOE_DAMAGE"].includes(Ve.type)&&(K+=ie.length>0?80:5),["SUMMON_CARD","SUMMON_CARD_RUSH"].includes(Ve.type)&&(K+=60),Ve.type==="BUFF_STATS"){const Me=Ve.targetType||"SELF";Me==="ALL_OTHER_FOLLOWERS"||Me==="ALL_FOLLOWERS"?K+=25*Math.max(1,Te.length-1):K+=30}Ve.type==="DRAW"&&(K+=35),Ve.type==="GENERATE_CARD"&&(K+=25)}}return X.canAttack?(K+=30,K+=(X.currentAttack||0)*5):K+=(X.currentAttack||0)*2,X.cost>=6&&$e&&(K+=20),!$e&&X.cost<=3&&(K-=30),K},ce=(X,oe)=>{const se=X.players[_].board.filter(Me=>Me!==null),K=X.players[v].board.filter(Me=>Me!==null),ie=X.players[v].hp,Te=X.players[_].hp,De=X.turnCount,Re=se.filter(Me=>Me&&!Me.hasEvolved);if(Re.length===0)return!1;const $e=Re.map((Me,Be)=>({c:Me,i:Be,score:Y(Me,Be,X,oe)})),Ce=Math.max(...$e.map(Me=>Me.score));if(ie<=12&&se.some(Me=>Me&&Me.canAttack)||Te<=10)return!0;const Ve=U(X);return Ve>=8&&Re.some(Be=>{const Fe=Be.triggers||[];for(const Mt of Fe)if(Mt.trigger===(oe?"SUPER_EVOLVE":"EVOLVE")){for(const Ke of Mt.effects||[])if(["DESTROY","RANDOM_DESTROY","DAMAGE","AOE_DAMAGE"].includes(Ke.type))return!0}return!1})&&K.length>0||Ce>=80||oe&&Ce>=50?!0:De<=5&&Te>=15&&Ve<8?Ce>=100:Ce<30?!1:Ce>=50},Z=(X,oe,re)=>{var De,Re,$e,Ce,Ve;const se=((De=X.passiveAbilities)==null?void 0:De.includes("STORM"))||X.turnPlayed!==re.turnCount,K=oe.map((Me,Be)=>({c:Me,i:Be})).filter(({c:Me})=>{var Be,Fe;return Me!==null&&!((Be=Me.passiveAbilities)!=null&&Be.includes("STEALTH"))&&!((Fe=Me.passiveAbilities)!=null&&Fe.includes("AURA"))});if(!(((Re=X.passiveAbilities)==null?void 0:Re.includes("STEALTH"))||X.hadStealth)){const Me=K.find(({c:Be})=>{var Fe;return(Fe=Be.passiveAbilities)==null?void 0:Fe.includes("WARD")});if(Me)return M(Me.c)?{index:-1,isLeader:!1}:{index:Me.i,isLeader:!1}}let Te={index:-1,isLeader:se,score:se?0:-1e3};for(const{c:Me,i:Be}of K){if(M(Me))continue;let Fe=0;const Mt=X.isEvolved,Ke=($e=Me.passiveAbilities)==null?void 0:$e.includes("BANE"),st=$(X,Me);z(X,Me)?(Fe+=50,Fe+=(Me.currentAttack||0)*5,st?Ke&&Mt?Fe-=60:Ke&&(Fe-=30):Fe+=30,Ke&&!st&&(Fe+=40),(Ce=Me.passiveAbilities)!=null&&Ce.includes("STORM")&&(Fe+=30),(Ve=Me.passiveAbilities)!=null&&Ve.includes("DOUBLE_ATTACK")&&(Fe+=35)):!st&&X.currentAttack>=Me.currentHealth/2?Fe+=10:st&&(Fe-=50,Mt&&(Fe-=40),(Me.currentAttack||0)>=5&&(Fe+=10)),Fe>Te.score&&(Te={index:Be,isLeader:!1,score:Fe})}return se&&(Te.index===-1||Te.score<=0)?{index:-1,isLeader:!0}:Te},pe=d==="EASY"?1200:d==="HARD"?400:800;if(await new Promise(X=>setTimeout(X,pe)),!ks.current)return;let we=0;const Ze=d==="EASY"?1:d==="HARD"?5:3;for(;we<Ze;){const X=it.current,oe=X.players[_].hand,re=X.players[_].pp,K=X.players[_].board.filter(Ke=>Ke!==null).length>=5;let ie=oe.map((Ke,st)=>({...Ke,originalIndex:st})).filter(Ke=>Ke.cost<=re).filter(Ke=>!(Ke.type==="FOLLOWER"&&K));if(ie.length===0||(d==="HARD"?ie=ie.sort((Ke,st)=>F(st,X)-F(Ke,X)):ie=ie.sort((Ke,st)=>st.cost-Ke.cost),d==="EASY"&&Math.random()<.3&&we>0))break;const Te=ie[0];let De;const $e=X.players[v].board.filter(Ke=>{var st,Ct;return Ke&&!((st=Ke.passiveAbilities)!=null&&st.includes("STEALTH"))&&!((Ct=Ke.passiveAbilities)!=null&&Ct.includes("AURA"))});$e.length>0&&(d==="HARD"?De=[...$e].sort((st,Ct)=>{var kt,Nt;let ht=(st.currentAttack||0)+(st.currentHealth||0),Et=(Ct.currentAttack||0)+(Ct.currentHealth||0);return(kt=st.passiveAbilities)!=null&&kt.includes("BANE")&&(ht+=10),(Nt=Ct.passiveAbilities)!=null&&Nt.includes("BANE")&&(Et+=10),Et-ht})[0].instanceId:De=$e[0].instanceId);const Ce=window.innerWidth-20*g-80*g/2,Ve=20*g+110*g/2,Me=window.innerWidth/2,Be=window.innerHeight/2;let Fe,Mt;if(Te.type==="FOLLOWER"){const st=it.current.players[_].board.filter(Jc=>Jc!==null),Ct=st.length+1,ht=st.length,Et=ki*g,kt=(ht-(Ct-1)/2)*Et,Nt=(Ie=yo.current)==null?void 0:Ie.getBoundingClientRect();Fe=(Nt?Nt.left+Nt.width/2:window.innerWidth/2)+kt,Mt=window.innerHeight/2-70*g}nr({card:Te,sourceIndex:-1,startX:Ce,startY:Ve,targetX:Me,targetY:Be,finalX:Fe,finalY:Mt,playerClass:(Ne==null?void 0:Ne.class)||"SENKA",onComplete:()=>{if(Te.type!=="SPELL"&&(Tt("gan.mp3",.6),tr()),O({type:"PLAY_CARD",playerId:_,payload:{cardIndex:Te.originalIndex,targetId:De,instanceId:Te.instanceId}}),Te.id==="c_amandava"&&it.current.players[v].board.forEach((st,Ct)=>{if(st){const ht=st.instanceId;setTimeout(()=>{nn("SHOT",v,Ct,ht)},200)}}),Te.id==="c_azya"){if(setTimeout(()=>{nn("THUNDER",v,-1)},200),De){const st=it.current.players[v].board.findIndex(Ct=>(Ct==null?void 0:Ct.instanceId)===De);st!==-1&&setTimeout(()=>{nn("ICE",v,st,De)},400)}setTimeout(()=>{const Ke=it.current.players[v].board,st=Ke.filter(Ct=>Ct!==null);if(st.length>0){const Ct=st[Math.floor(Math.random()*st.length)],ht=Ke.findIndex(Et=>(Et==null?void 0:Et.instanceId)===(Ct==null?void 0:Ct.instanceId));ht!==-1&&nn("WATER",v,ht,Ct==null?void 0:Ct.instanceId)}},600)}nr(null)}}),await w(600),we++}{const X=it.current,oe=X.players[_],re=_===X.firstPlayerId,se=X.turnCount,K=Jx(oe,se,re);if((Xx(oe,se,re)||K)&&oe.board.length>0){const Te=oe.board.map((De,Re)=>({c:De,i:Re})).filter(({c:De})=>De&&De.type==="FOLLOWER"&&!De.hasEvolved);if(Te.length>0){let De;const Re=K;if(d==="HARD"&&(ce(X,Re)||console.log("[AI HARD] Skipping evolution - saving EP for better opportunity")),d==="HARD"&&!ce(X,Re))De=null;else if(d==="EASY")De=Te[Math.floor(Math.random()*Te.length)];else{const Ce=Te.map(({c:Ve,i:Me})=>({c:Ve,i:Me,score:Y(Ve,Me,X,Re)}));Ce.sort((Ve,Me)=>Me.score-Ve.score),d==="HARD"&&Ce[0].score<5?(console.log("[AI HARD] Evolution target score too low:",Ce[0].score),De=null):De=Ce[0]}if(De){let Ce;const Me=X.players[v].board.filter(Fe=>{var Mt,Ke;return Fe!==null&&!((Mt=Fe.passiveAbilities)!=null&&Mt.includes("STEALTH"))&&!((Ke=Fe.passiveAbilities)!=null&&Ke.includes("AURA"))});Me.length>0&&(d==="HARD"?Ce=[...Me].sort((Mt,Ke)=>{var ht,Et,kt,Nt;let st=(Mt.currentAttack||0)*2+(Mt.currentHealth||0),Ct=(Ke.currentAttack||0)*2+(Ke.currentHealth||0);return(ht=Mt.passiveAbilities)!=null&&ht.includes("BANE")&&(st+=10),(Et=Ke.passiveAbilities)!=null&&Et.includes("BANE")&&(Ct+=10),(kt=Mt.passiveAbilities)!=null&&kt.includes("DOUBLE_ATTACK")&&(st+=5),(Nt=Ke.passiveAbilities)!=null&&Nt.includes("DOUBLE_ATTACK")&&(Ct+=5),Ct-st})[0].instanceId:Ce=Me[0].instanceId);const Be=(ze=kr.current[De.i])==null?void 0:ze.getBoundingClientRect();Be?(xo({card:De.c,evolvedImageUrl:De.c.evolvedImageUrl,startX:Be.left+Be.width/2,startY:Be.top+Be.height/2,useSep:Re,phase:"ZOOM_IN",followerIndex:De.i,sourcePlayerId:_,targetId:Ce}),await w(800)):(Rs({type:"EVOLVE",playerId:_,payload:{followerIndex:De.i,useSep:Re,targetId:Ce}}),await w(400))}}}}{let X=!0,oe=0;const re=se=>{if(d!=="HARD")return!1;const K=se.players[v].hp;return q(se)>=K};for(;X&&oe<15;){if(it.current.winnerId){X=!1;break}oe++;const se=it.current,K=se.players[_].board,ie=se.players[v].board,Te=re(se);let De=!1;for(let Re=0;Re<K.length;Re++){const $e=K[Re];if(!$e||!$e.canAttack)continue;let Ce=-1,Ve=!0;const Me=((He=$e.passiveAbilities)==null?void 0:He.includes("STEALTH"))||$e.hadStealth,Be=Me?-1:ie.findIndex(ht=>{var Et,kt;return ht&&((Et=ht.passiveAbilities)==null?void 0:Et.includes("WARD"))&&!((kt=ht.passiveAbilities)!=null&&kt.includes("STEALTH"))&&!M(ht)});if(Te&&Be===-1)if(((We=$e.passiveAbilities)==null?void 0:We.includes("STORM"))||$e.turnPlayed!==se.turnCount)Ce=-1,Ve=!0;else{const kt=ie.map((Nt,Ls)=>({c:Nt,idx:Ls})).filter(({c:Nt})=>{var Ls,Jc;return Nt&&!((Ls=Nt.passiveAbilities)!=null&&Ls.includes("STEALTH"))&&!((Jc=Nt.passiveAbilities)!=null&&Jc.includes("AURA"))&&!M(Nt)});if(kt.length>0)Ce=kt[0].idx,Ve=!1;else continue}else if(Be!==-1)Ce=Be,Ve=!1;else if(d==="EASY"){const ht=ie.map((kt,Nt)=>({c:kt,idx:Nt})).filter(({c:kt})=>{var Nt,Ls;return kt&&!((Nt=kt.passiveAbilities)!=null&&Nt.includes("STEALTH"))&&!((Ls=kt.passiveAbilities)!=null&&Ls.includes("AURA"))&&!M(kt)}),Et=((Ge=$e.passiveAbilities)==null?void 0:Ge.includes("STORM"))||$e.turnPlayed!==se.turnCount;if(!Et&&ht.length>0)Ce=ht[Math.floor(Math.random()*ht.length)].idx,Ve=!1;else{if(!Et&&ht.length===0)continue;Et&&ht.length>0&&Math.random()<.5&&(Ce=ht[Math.floor(Math.random()*ht.length)].idx,Ve=!1)}}else{const ht=Z($e,ie,se);if(Ce=ht.index,Ve=ht.isLeader,Ce===-1&&!Ve)continue}const Fe=(_e=$e.passiveAbilities)==null?void 0:_e.includes("STORM"),Mt=$e.turnPlayed===se.turnCount;if(!Fe&&Mt&&Ve){const ht=ie.map((Et,kt)=>({c:Et,idx:kt})).filter(({c:Et})=>{var kt,Nt;return Et&&!((kt=Et.passiveAbilities)!=null&&kt.includes("STEALTH"))&&!((Nt=Et.passiveAbilities)!=null&&Nt.includes("AURA"))&&!M(Et)});if(ht.length>0){const Et=Me?null:ht.find(({c:kt})=>{var Nt;return(Nt=kt.passiveAbilities)==null?void 0:Nt.includes("WARD")});Et?Ce=Et.idx:Ce=ht[0].idx,Ve=!1}else continue}const Ke=Ve?null:ie[Ce],st=Ke?Ke.instanceId:void 0,Ct=$e.instanceId;if(Ct&&(Dc(Ct),setTimeout(()=>Dc(null),300)),nn($e.attackEffectType||"SLASH",v,Ve?-1:Ce,st),!Ve&&Ce>=0){const ht=ie[Ce];if(ht&&(ht.currentAttack||0)>0){const Et=ht.instanceId;setTimeout(()=>{Et&&(Nc(Et),setTimeout(()=>Nc(null),300)),nn(ht.attackEffectType||"SLASH",_,Re,Ct)},200)}}De=!0,await w(1e3),O({type:"ATTACK",playerId:_,payload:{attackerIndex:Re,targetIndex:Ce,targetIsLeader:Ve}}),await w(1e3);break}De||(X=!1)}}if(await w(300),it.current.winnerId){ks.current=!1;return}O({type:"END_TURN",playerId:_}),ks.current=!1})()}},[y.activePlayerId,y.turnCount,n,y.phase,d,y.winnerId]);const jm=(p,E)=>{if(Gn.current||rt||go.length>0)return;const w=le.hand[E];p.stopPropagation();const M="touches"in p?p.touches[0].clientX:p.clientX,$="touches"in p?p.touches[0].clientY:p.clientY,z=p.currentTarget.getBoundingClientRect();if(!rs){$f(!0),ns({card:w,owner:"PLAYER",source:"HAND"}),jf.current=!0;return}if(ns({card:w,owner:"PLAYER",source:"HAND"}),y.activePlayerId!==v)return;if(kn.current){console.warn("[handleHandMouseDown] Card play in progress, blocking drag start");return}const q=it.current;if(q.winnerId){console.log("UI: Card play drag blocked - game has ended");return}if(q.pendingEffects&&q.pendingEffects.length>0){console.log("UI: Card play drag blocked - pendingEffects still processing");return}const U={sourceType:"HAND",sourceIndex:E,sourceInstanceId:w.instanceId,startX:z.left+z.width/2,startY:z.top+z.height/2,currentX:M,currentY:$,offsetX:0,offsetY:0,canDrag:!0};ts(U),Gn.current=U},Fm=(p,E,w)=>{p.stopPropagation();const M="touches"in p?p.touches[0].clientX:p.clientX,$="touches"in p?p.touches[0].clientY:p.clientY,z=it.current;if(z.winnerId){console.log("UI: Attack drag blocked - game has ended");return}const q=z.players[v].board,U=w?q.findIndex(Y=>Y&&Y.instanceId===w):E,F=U>=0?q[U]:null;if(dt&&dt.allowedTargetPlayerId===v&&F){Yf("FOLLOWER",U,v,w);return}if(F&&ns({card:F,owner:"PLAYER",source:"BOARD"}),z.pendingEffects&&z.pendingEffects.length>0){console.log("UI: Attack drag blocked - pendingEffects still processing");return}if(z.activePlayerId===v&&(F!=null&&F.canAttack)){const Y=p.currentTarget.getBoundingClientRect(),ce={x:Y.left+Y.width/2,y:Y.top+Y.height/2},Z={sourceType:"BOARD",sourceIndex:U,sourceInstanceId:F.instanceId,startX:ce.x,startY:ce.y,currentX:M,currentY:$,offsetX:0,offsetY:0};ts(Z),Gn.current=Z}},Vc=(p,E=!1)=>{if(y.activePlayerId!==v)return;p.stopPropagation();const w="touches"in p?p.touches[0].clientX:p.clientX,M="touches"in p?p.touches[0].clientY:p.clientY,$=it.current;if($.winnerId){console.log("UI: Evolve drag blocked - game has ended");return}if($.pendingEffects&&$.pendingEffects.length>0){console.log("UI: Evolve drag blocked - pendingEffects still processing");return}const z=v===y.firstPlayerId;if(E){if(!Jx(le,y.turnCount,z))return}else if(!Xx(le,y.turnCount,z))return;const q=p.currentTarget.getBoundingClientRect(),U=q.left+q.width/2,F=q.top+q.height/2,Y={sourceType:"EVOLVE",sourceIndex:0,startX:U,startY:F,currentX:w,currentY:M,offsetX:0,offsetY:0,useSep:E};ts(Y),Gn.current=Y},Um=P.useCallback(p=>{hr.current&&(clearTimeout(hr.current),hr.current=null);const E={stampId:p,playerId:v,playerClass:yn,timestamp:Date.now()},w=yv(p);w&&Tt(w,.6),Is(null),requestAnimationFrame(()=>{Is(E)}),e==="ONLINE"&&m&&m.send({type:"STAMP",stampId:p,playerClass:yn}),hr.current=setTimeout(()=>{Is(M=>(M==null?void 0:M.timestamp)===E.timestamp?null:M),hr.current=null},3e3)},[v,yn,e,m]),M2=P.useCallback(p=>{if(p.stopPropagation(),p.preventDefault(),Ti.current){const E=Ti.current.getBoundingClientRect();er.current={x:E.left+E.width/2,y:E.top+E.height/2}}else er.current={x:p.clientX,y:p.clientY};Oc(!0),fo(null)},[]),Bm=j.useRef(null);j.useEffect(()=>{Bm.current=uo},[uo]),P.useEffect(()=>{if(!co)return;const p=w=>{if(!er.current)return;const M=w.clientX-er.current.x,$=w.clientY-er.current.y,z=Math.sqrt(M*M+$*$),q=Math.atan2($,M)*(180/Math.PI);if(z>=200&&z<=320&&$<0){const ce=180- -q,Z=Math.floor(ce/22.5),we=Math.max(0,Math.min(7,Z))+1;fo(we)}else fo(null)},E=()=>{const w=Bm.current;w&&Um(w),Oc(!1),fo(null),er.current=null};return window.addEventListener("mousemove",p),window.addEventListener("mouseup",E),()=>{window.removeEventListener("mousemove",p),window.removeEventListener("mouseup",E)}},[co,Um]),P.useEffect(()=>{const p=(M,$,z=!1)=>{var F,Y,ce,Z;if(!Gn.current)return;const{canDrag:q,sourceType:U}=Gn.current;if(!(U==="HAND"&&!q)&&(Gn.current={...Gn.current,currentX:M,currentY:$},ts(pe=>pe?{...pe,currentX:M,currentY:$}:null),z&&(U==="BOARD"||U==="EVOLVE"))){const pe=vo.current;if(pe){const Ie=pe.getBoundingClientRect();if(M>=Ie.left&&M<=Ie.right&&$>=Ie.top&&$<=Ie.bottom){mr({type:"LEADER",index:0,playerId:_});return}}const we=it.current,Ze=((F=we.players[_])==null?void 0:F.board)||[];for(let Ie=0;Ie<kr.current.length;Ie++){const ze=kr.current[Ie];if(ze&&Ze[Ie]){const He=ze.getBoundingClientRect();if(M>=He.left&&M<=He.right&&$>=He.top&&$<=He.bottom){mr({type:"FOLLOWER",index:Ie,playerId:_,instanceId:(Y=Ze[Ie])==null?void 0:Y.instanceId});return}}}if(U==="EVOLVE"){const Ie=((ce=we.players[v])==null?void 0:ce.board)||[];for(let ze=0;ze<Wr.current.length;ze++){const He=Wr.current[ze];if(He&&Ie[ze]){const We=He.getBoundingClientRect();if(M>=We.left&&M<=We.right&&$>=We.top&&$<=We.bottom){mr({type:"FOLLOWER",index:ze,playerId:v,instanceId:(Z=Ie[ze])==null?void 0:Z.instanceId});return}}}}mr(null)}},E=M=>{p(M.clientX,M.clientY)},w=M=>{M.touches.length>0&&(Gn.current&&M.preventDefault(),p(M.touches[0].clientX,M.touches[0].clientY,!0))};return window.addEventListener("mousemove",E),window.addEventListener("touchmove",w,{passive:!1}),()=>{window.removeEventListener("mousemove",E),window.removeEventListener("touchmove",w)}},[]);const zm=j.useRef(null),D2=j.useRef(null);P.useEffect(()=>{zm.current=yt,D2.current=yt},[yt]),P.useEffect(()=>{const p=()=>{var $,z,q,U,F,Y,ce,Z,pe,we,Ze,Ie,ze;const w=Gn.current,M=zm.current;if(it.current.winnerId){console.log("[handleGlobalMouseUp] Game has ended, cancelling all actions"),ts(null),Gn.current=null,mr(null);return}if(w){if(w.sourceType==="HAND"){if(kn.current){console.warn("[handleGlobalMouseUp] Card play in progress, cancelling drag"),Gn.current=null,ts(null);return}const He=Math.sqrt(Math.pow(w.startX-w.currentX,2)+Math.pow(w.startY-w.currentY,2)),We=w.currentY<window.innerHeight-200*g;if(w.canDrag&&He>30&&We){const Ge=Gr.current.hand[w.sourceIndex];if(Gr.current.pp>=Ge.cost){const _e=((z=($=Ge.triggerAbilities)==null?void 0:$.FANFARE)==null?void 0:z.targetType)==="SELECT_FOLLOWER"||((q=Ge.triggers)==null?void 0:q.some(se=>se.trigger==="FANFARE"&&se.effects.some(K=>K.targetType==="SELECT_FOLLOWER"))),X=((F=(U=Ge.triggerAbilities)==null?void 0:U.FANFARE)==null?void 0:F.targetType)==="SELECT_ALLY_FOLLOWER"||((Y=Ge.triggers)==null?void 0:Y.some(se=>se.trigger==="FANFARE"&&se.effects.some(K=>K.targetType==="SELECT_ALLY_FOLLOWER"))),oe=((Z=(ce=Ge.triggerAbilities)==null?void 0:ce.FANFARE)==null?void 0:Z.targetType)==="SELECT_OTHER_ALLY_FOLLOWER"||((pe=Ge.triggers)==null?void 0:pe.some(se=>se.trigger==="FANFARE"&&se.effects.some(K=>K.targetType==="SELECT_OTHER_ALLY_FOLLOWER")));if(_e||X||oe){const se=X||oe?v:_;it.current.players[se].board.some(Te=>{var De,Re;return!(!Te||se!==v&&((De=Te.passiveAbilities)!=null&&De.includes("STEALTH")||(Re=Te.passiveAbilities)!=null&&Re.includes("AURA")))})?(kn.current=!0,Ua.current=Ge.instanceId||null,Cs({type:"PLAY",sourceIndex:w.sourceIndex,sourceInstanceId:Ge.instanceId,allowedTargetPlayerId:se}),Rr.current=!0,setTimeout(()=>{Rr.current=!1},100)):(console.log("[handleGlobalMouseUp] No valid targets, skipping target selection"),Vf(w.sourceIndex,w.startX,w.startY),ns(null),Rr.current=!0,setTimeout(()=>{Rr.current=!1},100))}else Vf(w.sourceIndex,w.startX,w.startY),ns(null),Rr.current=!0,setTimeout(()=>{Rr.current=!1},100);Gn.current=null,ts(null);return}}else w.canDrag||$f(!0)}else if(w.sourceType==="BOARD"){if(M&&M.playerId===_){const We=it.current.players[_],Ge=We.board.filter(K=>{var ie,Te;return K&&((ie=K.passiveAbilities)==null?void 0:ie.includes("WARD"))&&!((Te=K.passiveAbilities)!=null&&Te.includes("STEALTH"))});let _e=!1;const X=K=>K?We.board.findIndex(ie=>ie&&ie.instanceId===K):-1,oe=M.type==="LEADER"?-1:X(M.instanceId),re=Gr.current.board[w.sourceIndex],se=((we=re==null?void 0:re.passiveAbilities)==null?void 0:we.includes("STEALTH"))||(re==null?void 0:re.hadStealth);if(Ge.length>0&&!se){if(M.type==="LEADER")_e=!0;else if(M.type==="FOLLOWER"&&oe>=0){const K=We.board[oe];K&&!((Ze=K.passiveAbilities)!=null&&Ze.includes("WARD"))&&(_e=!0)}}if(_e)console.log("UI: Attack blocked by WARD");else{const K=Gr.current.board.findIndex(Ve=>Ve&&Ve.instanceId===w.sourceInstanceId),ie=K>=0?Gr.current.board[K]:null,Te=(Ie=ie==null?void 0:ie.passiveAbilities)==null?void 0:Ie.includes("RUSH"),De=(ze=ie==null?void 0:ie.passiveAbilities)==null?void 0:ze.includes("STORM"),Re=(ie==null?void 0:ie.turnPlayed)===it.current.turnCount,$e=M.type==="LEADER",Ce=oe;if($e&&Te&&!De&&Re)console.log("UI: Attack blocked by RUSH rule (Cannot attack leader)");else{if(K<0||!ie){console.log("UI: Attack blocked - invalid attacker");return}const Ve=it.current;if(Ve.pendingEffects&&Ve.pendingEffects.length>0){console.log("UI: Attack blocked - pendingEffects still processing");return}const Me=M.instanceId,Be=w.sourceInstanceId,Fe=!$e&&Ce>=0?We.board[Ce]:null;Rs({type:"ATTACK",playerId:v,payload:{attackerIndex:K,targetIndex:$e?-1:Ce,targetIsLeader:$e}}),Be&&(Dc(Be),setTimeout(()=>Dc(null),300));const Ke=(ie==null?void 0:ie.attackEffectType)||"SLASH";if(nn(Ke,_,$e?-1:Ce,Me),tr(),!$e&&Fe&&(Fe.currentAttack||0)>0){const st=Fe.instanceId;setTimeout(()=>{st&&(Nc(st),setTimeout(()=>Nc(null),300)),nn(Fe.attackEffectType||"SLASH",v,K,Be)},200)}}}}}else if(w.sourceType==="EVOLVE"&&M&&M.type==="FOLLOWER"&&M.playerId===v){const He=M.index,Ge=ft.current[He],_e=(Ge==null?void 0:Ge.instanceId)||M.instanceId,X=Gr.current.board,oe=_e?X.findIndex(Be=>Be&&Be.instanceId===_e):He,re=oe>=0?X[oe]:null;if(!re)return;if(re.hasEvolved){console.log("[GameScreen] Cannot evolve: card already evolved (drag drop)");return}const K=w.useSep?["SUPER_EVOLVE","EVOLVE"]:["EVOLVE"],Te=(()=>{var Fe,Mt;const Be=(Mt=(Fe=re==null?void 0:re.triggerAbilities)==null?void 0:Fe.EVOLVE)==null?void 0:Mt.targetType;if(Be)return Be;for(const Ke of(re==null?void 0:re.triggers)||[])if(K.includes(Ke.trigger)){for(const st of Ke.effects)if(st.targetType&&["SELECT_FOLLOWER","SELECT_ALLY_FOLLOWER","SELECT_OTHER_ALLY_FOLLOWER"].includes(st.targetType))return st.targetType}return null})(),De=!!Te,Re=Te==="SELECT_ALLY_FOLLOWER"||Te==="SELECT_OTHER_ALLY_FOLLOWER",$e=Te==="SELECT_OTHER_ALLY_FOLLOWER",Ce=Re?v:_,Me=it.current.players[Ce].board.some(Be=>{var Fe,Mt;return!(!Be||Re&&$e&&Be.instanceId===_e||!Re&&((Fe=Be.passiveAbilities)!=null&&Fe.includes("STEALTH")||(Mt=Be.passiveAbilities)!=null&&Mt.includes("AURA")))});De&&Me?(Cs({type:"EVOLVE",sourceIndex:oe,sourceInstanceId:_e,sourceVisualIndex:He,useSep:w.useSep,allowedTargetPlayerId:Ce,excludeInstanceId:$e?_e:void 0}),Rr.current=!0,setTimeout(()=>{Rr.current=!1},100)):(Gc(He,w.useSep,void 0,_e),Rr.current=!0,setTimeout(()=>{Rr.current=!1},100))}}w&&w.sourceType==="HAND"&&w.canDrag&&(km(w.sourceIndex),setTimeout(()=>km(null),300)),ts(null),Gn.current=null,mr(null)},E=()=>{p()};return window.addEventListener("mouseup",p),window.addEventListener("touchend",E),()=>{window.removeEventListener("mouseup",p),window.removeEventListener("touchend",E)}},[_,v,rs,g]);const N2=()=>{if(!Rr.current){if(dt){dt.type==="PLAY"&&(kn.current=!1),Cs(null);return}if(rs){if(jf.current){jf.current=!1;return}$f(!1),ns(null),ae(null)}}},As=()=>{if(!ee||ee.sourceType!=="BOARD"&&ee.sourceType!=="EVOLVE")return"";const p=ee.currentX-ee.startX,E=ee.currentY-ee.startY,w=Math.sqrt(p*p+E*E);if(w<10)return"";const M=(ee.startX+ee.currentX)/2,$=(ee.startY+ee.currentY)/2,z=Math.min(200,w*.3),q=Math.abs(p),U=Math.min(150,q*.4),F=z+U,ce=-(p/(w+1))*F*.5,Z=-F*.8,pe=M+ce,we=$+Z;return`M${ee.startX},${ee.startY} Q${pe},${we} ${ee.currentX},${ee.currentY}`},Yf=(p,E,w,M)=>{var q;if(!dt)return;if(dt.allowedTargetPlayerId&&dt.allowedTargetPlayerId!==w){console.log("Invalid target side");return}if(dt.excludeInstanceId&&M===dt.excludeInstanceId){console.log("Cannot target self (SELECT_OTHER_ALLY_FOLLOWER)"),tr();return}let $,z=E;if(p==="FOLLOWER"){if(M&&(z=y.players[w].board.findIndex(F=>F&&F.instanceId===M),z<0))return;const U=y.players[w].board[z];if(!U)return;if($=U.instanceId,w!==v){const F=U.passiveAbilities||[];if(F.includes("STEALTH")){console.log("Cannot target unit with STEALTH"),Tt("cancel"),tr();return}if(F.includes("AURA")){console.log("Cannot target unit with AURA"),Tt("cancel"),tr();return}}}else return;if(dt.type==="PLAY"){const U=Gr.current;let F=dt.sourceIndex,Y=U.hand[F];if(dt.sourceInstanceId){const We=U.hand.findIndex(Ge=>Ge.instanceId===dt.sourceInstanceId);if(We>=0)F=We,Y=U.hand[We],console.log(`[handleTargetClick] Using sourceInstanceId ${dt.sourceInstanceId}, found at index ${We} (was ${dt.sourceIndex})`);else{console.error("[handleTargetClick] Card not found with instanceId:",dt.sourceInstanceId),Cs(null);return}}if(!Y){console.error("[handleTargetClick] Card not found at index:",F),Cs(null),kn.current=!1;return}kn.current=!0,Ua.current=Y.instanceId||null,Y.id==="c_y"&&(nn("SUMI","p2",z,$),it.current.players[_].board.forEach((Ge,_e)=>{if(Ge){const X=Ge.instanceId;setTimeout(()=>{nn("SUMI",_,_e,X)},300)}})),Y.id==="s_resignation_proxy"&&(nn("SUMI",w,z,$),setTimeout(()=>{const We=it.current.players[v].board,Ge=[];if(We.forEach((_e,X)=>{_e&&Ge.push({index:X,instanceId:_e.instanceId})}),Ge.length>0){const _e=Ge[Math.floor(Math.random()*Ge.length)];nn("SUMI",v,_e.index,_e.instanceId)}},500)),Y.id==="c_azya"&&(nn("THUNDER",_,-1),setTimeout(()=>{nn("ICE",w,z,$)},300),setTimeout(()=>{const We=it.current.players[_].board,Ge=We.filter(_e=>_e!==null);if(Ge.length>0){const _e=Ge[Math.floor(Math.random()*Ge.length)],X=We.findIndex(oe=>(oe==null?void 0:oe.instanceId)===(_e==null?void 0:_e.instanceId));X!==-1&&nn("WATER",_,X,_e==null?void 0:_e.instanceId)}},600));const ce=window.innerWidth/2,Z=window.innerHeight-200*g/2,pe=window.innerWidth/2,we=window.innerHeight/2,Ze=()=>{Y.type==="SPELL"||tr(),Rs({type:"PLAY_CARD",playerId:v,payload:{cardIndex:F,targetId:$,instanceId:Y.instanceId}}),Y.id==="c_amandava"&&it.current.players[_].board.forEach((_e,X)=>{if(_e){const oe=_e.instanceId;setTimeout(()=>{nn("SHOT",_,X,oe)},200)}}),nr(null),setTimeout(()=>{kn.current=!1},100)};let Ie,ze;if(Y.type==="FOLLOWER"){const Ge=it.current.players[v].board.filter(ie=>ie!==null),_e=Ge.length+1,X=Ge.length,oe=ki*g,re=(X-(_e-1)/2)*oe,se=(q=yo.current)==null?void 0:q.getBoundingClientRect();Ie=(se?se.left+se.width/2:window.innerWidth/2)+re,ze=window.innerHeight/2+70*g}const He=Y.type==="FOLLOWER"?it.current.players[v].board.filter(We=>We!==null).length:void 0;n!=="CPU"&&T&&m&&m.send({type:"PLAY_CARD_ANIM",payload:{playerId:v,cardIndex:F,card:Y,targetBoardIndex:He}}),nr({card:Y,sourceIndex:dt.sourceIndex??-1,startX:ce,startY:Z,targetX:pe,targetY:we,finalX:Ie,finalY:ze,playerClass:(le==null?void 0:le.class)||"SENKA",onComplete:Ze}),setTimeout(()=>{nr(We=>(We==null?void 0:We.card.id)===Y.id?(Ze(),null):We)},2e3)}else if(dt.type==="EVOLVE"){const U=dt.sourceVisualIndex??dt.sourceIndex;Gc(U,!!dt.useSep,$,dt.sourceInstanceId)}Cs(null)},Hm=()=>{if(!Ye||Ye.owner!=="PLAYER")return;if(kn.current){console.warn("[handleUseButtonClick] Card play in progress, ignoring");return}const p=le.hand.findIndex(M=>M.id===Ye.card.id);if(p===-1)return;const E=window.innerWidth/2,w=window.innerHeight-200*g/2;Vf(p,E,w),ns(null)},[Eo,Kf]=j.useState(!1),[Yc,Xf]=j.useState(!1),[on,Jf]=j.useState(null),$2=j.useRef(0);j.useEffect(()=>{if(!(on!=null&&on.active))return;const p=Date.now(),E=800,w=()=>{const M=Date.now()-p;if(M>=E){Jf(null);return}const $=M/E;Jf(z=>z?{...z,ringRadius:20+$*100,particles:z.particles.map(q=>({...q,x:q.x+q.vx,y:q.y+q.vy,opacity:1-$}))}:null),requestAnimationFrame(w)};requestAnimationFrame(w)},[on==null?void 0:on.active]);const Wm=(p,E)=>{const w=[];for(let M=0;M<20;M++){const $=Math.random()*Math.PI*2,z=2+Math.random()*3;w.push({id:$2.current++,x:p,y:E,vx:Math.cos($)*z,vy:Math.sin($)*z,opacity:1,createdAt:Date.now()})}Jf({active:!0,x:p,y:E,ringRadius:20,particles:w})},Qf=async()=>{if(y.winnerId){console.log("[handleEndTurn] Game is over, ignoring");return}if(y.activePlayerId!==v){console.log("[handleEndTurn] Not my turn, ignoring");return}if(_o.current){console.log("[handleEndTurn] Already ending turn, ignoring");return}_o.current=!0,Kf(!0);const p=it.current.turnCount,E=it.current.activePlayerId;if(!await(async()=>{const $=()=>{const Y=it.current,ce=Y.pendingEffects&&Y.pendingEffects.length>0,Z=Hf.current.length>0,pe=Wf.current.length>0,we=Ba.current!==null,Ze=bo.current!==null,Ie=D.current,ze=kn.current;return!ce&&!Z&&!pe&&!we&&!Ze&&!Ie&&!ze};let U=0,F=0;for(;U<3e3;){if(it.current.turnCount!==p||it.current.activePlayerId!==E)return console.log("[handleEndTurn] Turn changed during wait, aborting local END_TURN"),!1;if($()){if(F++,F>=2)break}else F=0;await new Promise(Y=>setTimeout(Y,50)),U+=50}return U>=3e3&&console.warn("[handleEndTurn] Timeout waiting for processing to complete - forcing end turn"),!0})()||it.current.turnCount!==p||it.current.activePlayerId!==E||it.current.activePlayerId!==v){console.log("[handleEndTurn] Turn state changed, aborting END_TURN dispatch"),_o.current=!1,Kf(!1);return}console.log("[handleEndTurn] Dispatching END_TURN"),Rs({type:"END_TURN",playerId:v}),_o.current=!1,Kf(!1)},j2=P.useCallback(()=>{Tt("sisiodosi.mp3",.6);const p=Sm.current;if(p){const E=p.getBoundingClientRect();Wm(E.left+E.width/2,E.top+E.height/2)}Qf()},[Tt,Qf]),Gm=2-((le==null?void 0:le.evolutionsUsed)||0),qf=v===y.firstPlayerId,Vm=(p,E)=>E?Math.ceil(y.turnCount/2):Math.floor(y.turnCount/2),Ym=Vm(v,qf),F2=qf?3:2,U2=qf?4:3,Kc=Ym>=F2,Xc=Ym>=U2,Ps=(le==null?void 0:le.canEvolveThisTurn)&&Gm>0&&y.activePlayerId===v&&Kc,Os=(le==null?void 0:le.canEvolveThisTurn)&&le.sep>0&&y.activePlayerId===v&&Xc,Zf=_===y.firstPlayerId,Km=Vm(_,Zf),B2=Zf?3:2,z2=Zf?4:3,eh=Km>=B2,th=Km>=z2,nh=((ty=le==null?void 0:le.board)==null?void 0:ty.some(p=>{var E;return(E=p==null?void 0:p.passiveAbilities)==null?void 0:E.includes("LEADER_DAMAGE_CAP")}))??!1,rh=((ny=Ne==null?void 0:Ne.board)==null?void 0:ny.some(p=>{var E;return(E=p==null?void 0:p.passiveAbilities)==null?void 0:E.includes("LEADER_DAMAGE_CAP")}))??!1,H2=(le==null?void 0:le.leaderDamageShield)??!1,W2=(Ne==null?void 0:Ne.leaderDamageShield)??!1,Xm=nh||H2,Jm=rh||W2;return P.useLayoutEffect(()=>{window.scrollTo(0,0),yo.current&&(yo.current.scrollTop=0);const p=()=>{window.scrollTo(0,0)};return window.addEventListener("scroll",p,{passive:!1}),()=>{window.removeEventListener("scroll",p)}},[]),n==="JOIN"&&!N||B&&I&&!N?a.jsxs("div",{style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",gap:"1rem"},children:[a.jsx("div",{style:{width:"50px",height:"50px",border:"4px solid rgba(233, 69, 96, 0.3)",borderTop:"4px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),a.jsx("p",{children:"..."}),a.jsx("button",{onClick:s,style:{marginTop:"1rem",padding:"0.5rem 1rem",background:"transparent",border:"1px solid #888",color:"#888",cursor:"pointer",borderRadius:"4px"},children:""}),a.jsx("style",{children:`
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                `})]}):B&&Se&&N?a.jsxs("div",{style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",gap:"1rem"},children:[a.jsx("div",{style:{fontSize:"2rem",fontWeight:"bold",color:"#4ade80",textShadow:"0 0 10px rgba(74, 222, 128, 0.5)",marginBottom:"0.5rem"},children:""}),a.jsx("div",{style:{width:"50px",height:"50px",border:"4px solid rgba(74, 222, 128, 0.3)",borderTop:"4px solid #4ade80",borderRadius:"50%",animation:"spin 1s linear infinite"}}),a.jsx("p",{style:{color:"#a0aec0"},children:"..."}),a.jsx("style",{children:`
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                `})]}):a.jsxs("div",{className:"game-screen-wrapper",style:{width:"100vw",height:"100dvh",overflow:"hidden",background:"#000",position:"relative"},children:[ye&&a.jsx(oM,{myPlayer:le,opponentPlayer:Ne,isFirstPlayer:It,onComplete:O2,scale:g,onVsImpact:()=>Tt("vs.mp3",.7),onCoinToss:()=>Tt("coin.mp3",.7),onImpact:()=>Tt("gan.mp3",.7),onOrbLand:()=>Tt("gan.mp3",.8),onFadeInBoard:()=>J(!0),isMobile:G,isRankedMatch:n==="RANKED_MATCH",myRank:Pa,opponentRank:Rf}),a.jsxs("div",{className:"game-screen",style:{width:"100%",height:"100%",transform:vt>0?`translate(${wt.x}px, ${wt.y}px)`:"none",display:"flex",overflow:"hidden",background:"radial-gradient(circle at center, #1a202c 0%, #000 100%)",fontFamily:"'Helvetica Neue', sans-serif",userSelect:"none",color:"#fff",position:"absolute",top:0,left:0,opacity:ye&&!xe?0:1,transition:"opacity 0.5s ease-in"},onClick:N2,children:[a.jsx("style",{children:`
                    html, body {
                        margin: 0; padding: 0; height: 100%; background: #000;
                        overflow: hidden !important;
                        position: fixed !important;
                        width: 100% !important;
                        top: 0 !important;
                        left: 0 !important;
                    }
                    * { box-sizing: border-box; }
                    .shake-target { animation: shake 0.3s cubic-bezier(.36,.07,.19,.97) both; }
                    @keyframes shake {
                        10%, 90% { transform: translate3d(-1px, 0, 0); }
                        20%, 80% { transform: translate3d(2px, 0, 0); }
                        30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
                        40%, 60% { transform: translate3d(4px, 0, 0); }
                    }
                    @keyframes attackRotate {
                        0% { transform: rotateY(0deg); }
                        100% { transform: rotateY(360deg); }
                    }
                    .attack-rotating {
                        animation: attackRotate 0.2s linear forwards !important;
                        transform-style: preserve-3d;
                    }
                    @keyframes cardDie {
                        0% { transform: scale(1); filter: brightness(1) drop-shadow(0 0 0 white); opacity: 1; }
                        40% { transform: scale(1.15); filter: brightness(3) drop-shadow(0 0 20px white); opacity: 0.9; }
                        100% { transform: scale(0.4) rotate(8deg); filter: brightness(5) drop-shadow(0 0 40px white); opacity: 0; }
                    }
                    .card-dying { animation: cardDie 0.7s forwards; }
                    /* Necromance effect animations */
                    @keyframes necromanceFloat {
                        0% { transform: translateX(-50%) translateY(0) scale(1); opacity: 1; }
                        50% { transform: translateX(-50%) translateY(-20px) scale(1.2); opacity: 1; }
                        100% { transform: translateX(-50%) translateY(-40px) scale(0.8); opacity: 0; }
                    }
                    @keyframes necromanceFloatOpponent {
                        0% { transform: translateX(-50%) translateY(0) scale(1); opacity: 1; }
                        50% { transform: translateX(-50%) translateY(15px) scale(1.2); opacity: 1; }
                        100% { transform: translateX(-50%) translateY(30px) scale(0.8); opacity: 0; }
                    }
                    @keyframes necroPulse {
                        0%, 100% { box-shadow: 0 0 10px #d946ef, 0 0 20px #a855f7, inset 0 0 15px rgba(217, 70, 239, 0.3); }
                        50% { box-shadow: 0 0 25px #d946ef, 0 0 40px #a855f7, 0 0 60px #7c3aed, inset 0 0 25px rgba(217, 70, 239, 0.5); }
                    }
                    @keyframes leaderDamageCapPulse {
                        0%, 100% {
                            box-shadow: 0 0 20px rgba(103, 232, 249, 0.4), 0 0 40px rgba(103, 232, 249, 0.2);
                            border-color: #67e8f9;
                        }
                        50% {
                            box-shadow: 0 0 35px rgba(103, 232, 249, 0.7), 0 0 55px rgba(103, 232, 249, 0.4);
                            border-color: #a5f3fc;
                        }
                    }
                    @keyframes leaderDamageCapOverlay {
                        0%, 100% { opacity: 0.15; }
                        50% { opacity: 0.45; }
                    }
                    /* EP/SEP pulse animations for usable state - box-shadow only, no transform override */
                    @keyframes epPulse {
                        0%, 100% {
                            box-shadow: 0 0 12px #ffd700, 0 0 25px rgba(255,215,0,0.6);
                        }
                        50% {
                            box-shadow: 0 0 20px #ffd700, 0 0 40px rgba(255,215,0,0.8), 0 0 55px rgba(255,180,0,0.5);
                        }
                    }
                    @keyframes sepPulse {
                        0%, 100% {
                            box-shadow: 0 0 12px #b794f4, 0 0 25px rgba(159,122,234,0.6);
                        }
                        50% {
                            box-shadow: 0 0 20px #b794f4, 0 0 40px rgba(159,122,234,0.8), 0 0 55px rgba(180,0,255,0.5);
                        }
                    }
                `}),dt&&a.jsx("div",{style:{position:"absolute",top:"15%",left:"50%",transform:"translate(-50%, -50%)",background:"rgba(0, 0, 0, 0.7)",color:"#fff",padding:"10px 20px",borderRadius:20,pointerEvents:"none",zIndex:1e3,fontWeight:"bold",border:dt.allowedTargetPlayerId===v?"2px solid #48bb78":"2px solid #f56565"},children:dt.allowedTargetPlayerId===v?"":""}),k2&&a.jsx(wM,{onClose:()=>Nf(!1)}),C2&&a.jsx("div",{style:{position:"absolute",inset:0,zIndex:4e3,background:"rgba(0,0,0,0.8)",backdropFilter:"blur(5px)",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>Fc(!1),children:a.jsxs("div",{style:{background:"#2d3748",padding:40,borderRadius:16,display:"flex",flexDirection:"column",gap:20,minWidth:300,border:"1px solid rgba(255,255,255,0.1)"},onClick:p=>p.stopPropagation(),children:[a.jsx("h2",{style:{margin:0,textAlign:"center",borderBottom:"1px solid #4a5568",paddingBottom:10,color:"#fff"},children:""}),T2?a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:15},children:[a.jsx("h3",{style:{margin:0,color:"#cbd5e0"},children:""}),a.jsxs("label",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",color:"white"},children:["BGM",a.jsx("input",{type:"checkbox",checked:jt.bgmEnabled,onChange:p=>ja(E=>({...E,bgmEnabled:p.target.checked})),style:{width:20,height:20}})]}),a.jsxs("label",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",color:"white"},children:["SE",a.jsx("input",{type:"checkbox",checked:jt.seEnabled,onChange:p=>ja(E=>({...E,seEnabled:p.target.checked})),style:{width:20,height:20}})]}),a.jsxs("div",{children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",color:"#a0aec0",marginBottom:5},children:[a.jsx("span",{children:"BGM"}),a.jsxs("span",{children:[Math.round(jt.bgm*100),"%"]})]}),a.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:jt.bgm,onChange:p=>ja(E=>({...E,bgm:parseFloat(p.target.value)})),style:{width:"100%"}})]}),a.jsxs("div",{children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",color:"#a0aec0",marginBottom:5},children:[a.jsx("span",{children:"SE"}),a.jsxs("span",{children:[Math.round(jt.se*100),"%"]})]}),a.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:jt.se,onChange:p=>ja(E=>({...E,se:parseFloat(p.target.value)})),style:{width:"100%"}})]}),a.jsxs("div",{children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",color:"#a0aec0",marginBottom:5},children:[a.jsx("span",{children:""}),a.jsxs("span",{children:[Math.round(jt.voice*100),"%"]})]}),a.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:jt.voice,onChange:p=>ja(E=>({...E,voice:parseFloat(p.target.value)})),style:{width:"100%"}})]}),a.jsx("button",{onClick:()=>Om(!1),style:{padding:10,background:"#4a5568",border:"none",color:"white",borderRadius:8,cursor:"pointer",marginTop:10},children:""})]}):a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:()=>Fc(!1),style:{padding:15,background:"#4a5568",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.2rem"},children:""}),a.jsx("button",{onClick:()=>Om(!0),style:{padding:15,background:"#2b6cb0",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.2rem"},children:""}),a.jsx("button",{onClick:()=>Uc(!0),style:{padding:15,background:"#e53e3e",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.2rem"},children:""})]})]})}),R2&&a.jsx("div",{style:{position:"absolute",inset:0,zIndex:4100,background:"rgba(0,0,0,0.85)",backdropFilter:"blur(5px)",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>Uc(!1),children:a.jsxs("div",{style:{background:"#2d3748",padding:40,borderRadius:16,display:"flex",flexDirection:"column",gap:20,minWidth:320,border:"2px solid #e53e3e",boxShadow:"0 0 30px rgba(229, 62, 62, 0.3)"},onClick:p=>p.stopPropagation(),children:[a.jsx("h2",{style:{margin:0,textAlign:"center",color:"#fff",fontSize:"1.5rem"},children:""}),a.jsx("p",{style:{margin:0,textAlign:"center",color:"#a0aec0",fontSize:"1rem"},children:""}),a.jsxs("div",{style:{display:"flex",gap:15,marginTop:10},children:[a.jsx("button",{onClick:()=>Uc(!1),style:{flex:1,padding:15,background:"#4a5568",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.1rem"},children:""}),a.jsx("button",{onClick:A2,style:{flex:1,padding:15,background:"#e53e3e",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.1rem"},children:""})]})]})}),a.jsxs("div",{className:Lm?"shake-target":"",style:{width:(G?280:340)*g,borderRight:"1px solid rgba(255,255,255,0.1)",background:"rgba(0,0,0,0.3)",padding:G?`${10*g}px ${12*g}px`:`${20*g}px ${20*g}px ${20*g}px`,display:"flex",flexDirection:"column",zIndex:20,flexShrink:0},onClick:p=>p.stopPropagation(),children:[a.jsx("div",{style:{marginBottom:(G?6:12)*g},children:a.jsxs("button",{onClick:()=>Fc(!0),style:{background:"transparent",border:"none",cursor:"pointer",padding:G?3:5},children:[a.jsx("div",{style:{width:(G?22:30)*g,height:(G?2:3)*g,background:"#cbd5e0",marginBottom:(G?4:6)*g}}),a.jsx("div",{style:{width:(G?22:30)*g,height:(G?2:3)*g,background:"#cbd5e0",marginBottom:(G?4:6)*g}}),a.jsx("div",{style:{width:(G?22:30)*g,height:(G?2:3)*g,background:"#cbd5e0"}})]})}),a.jsx("h3",{style:{color:"#a0aec0",borderBottom:"1px solid #4a5568",paddingBottom:(G?4:8)*g,marginTop:0,marginBottom:0,flexShrink:0,fontSize:G?`${.85*g}rem`:void 0},children:""}),Ye?a.jsx("div",{style:{marginTop:(G?4:10)*g,display:"flex",flexDirection:"column",flex:1,overflow:"hidden",minHeight:0},children:a.jsxs("div",{style:{flex:1,overflow:"auto",minHeight:0,display:"flex",flexDirection:"column"},children:[a.jsxs("div",{style:{flexShrink:0},children:[a.jsx("div",{style:{width:"100%",aspectRatio:"1/1",marginBottom:(G?6:12)*g,display:"flex",alignItems:"center",justifyContent:"center",...G?{maxHeight:"28vh"}:{}},children:a.jsx(Co,{card:Ye.card,style:{width:"100%",height:"100%",...G?{maxHeight:"28vh"}:{}},variant:"art-only"})}),a.jsx("div",{style:{fontSize:G?`${(Ye.card.name.length>12?.9:Ye.card.name.length>8?1:1.1)*g}rem`:`${Ye.card.name.length>12?1.1:Ye.card.name.length>8?1.2:1.4}rem`,fontWeight:"bold",marginBottom:(G?4:6)*g,textAlign:"center"},children:Ye.card.name}),a.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:(G?10:15)*g,marginBottom:(G?6:10)*g},children:[a.jsx("div",{style:{width:24*g,height:24*g,borderRadius:"50%",background:"radial-gradient(circle at 30% 30%, #68d391, #276749)",border:"1px solid #fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${.85*g}rem`,fontWeight:900,color:"white",textShadow:"0 1px 2px rgba(0,0,0,0.5)",boxShadow:"0 2px 4px rgba(0,0,0,0.3)"},children:Ye.card.cost}),Ye.card.type==="FOLLOWER"&&a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:3*g},children:[a.jsx("svg",{width:18*g,height:18*g,viewBox:"0 0 24 24",fill:"none",children:a.jsx("polygon",{points:"12,2 22,22 2,22",fill:"#63b3ed",stroke:"none"})}),a.jsx("span",{style:{fontSize:`${.95*g}rem`,fontWeight:"bold",color:"#4299e1"},children:"currentAttack"in Ye.card?Ye.card.currentAttack:Ye.card.attack})]}),Ye.card.type==="FOLLOWER"&&a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:3*g},children:[a.jsx("svg",{width:18*g,height:18*g,viewBox:"0 0 24 24",fill:"#f56565",children:a.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})}),a.jsx("span",{style:{fontSize:`${.95*g}rem`,fontWeight:"bold",color:"#f56565"},children:"currentHealth"in Ye.card?Ye.card.currentHealth:Ye.card.health})]})]}),a.jsx("div",{style:{fontSize:`${((((ry=Ye.card.description)==null?void 0:ry.length)||0)>150?.7:(((sy=Ye.card.description)==null?void 0:sy.length)||0)>100?.8:.9)*g}rem`,color:"#cbd5e0",lineHeight:"1.4",whiteSpace:"pre-wrap",borderTop:"1px solid #4a5568",paddingTop:4*g},children:I2(Ye.card.description)})]}),Ye.card.flavorText&&a.jsx("div",{style:{marginTop:"auto",paddingTop:8*g,paddingBottom:4*g,flexShrink:0},children:a.jsx("div",{style:{fontSize:`${((((iy=Ye.card.flavorText)==null?void 0:iy.length)||0)>100?.6:.7)*g}rem`,color:"rgba(160, 174, 192, 0.6)",lineHeight:"1.3",fontStyle:"italic",whiteSpace:"pre-wrap",textAlign:"right"},children:Ye.card.flavorText})})]})}):a.jsx("div",{style:{marginTop:10*g,color:"#718096",fontStyle:"italic",flex:1,fontSize:`${.7*g}rem`},children:""})]}),a.jsxs("div",{ref:yo,className:Lm?"shake-target":"",style:{flex:1,height:"100%",position:"relative",background:"rgba(0,0,0,0.1)",overflow:"hidden"},children:[a.jsxs("div",{ref:vo,onMouseEnter:()=>mr({type:"LEADER",playerId:_}),onMouseLeave:()=>mr(null),onClick:p=>{p.stopPropagation(),dt&&Yf("LEADER",-1,_)},style:{position:"absolute",top:-20*g,left:"50%",transform:"translateX(-50%)",width:ko*g,height:ko*g,borderRadius:"50%",zIndex:100,cursor:"default"},children:[a.jsx("div",{style:{position:"absolute",inset:0,borderRadius:"50%",background:Ne.class==="AJA"?`url(${kl(Ne.class)}) center top/cover`:`url(${kl(Ne.class)}) center/cover`,border:rh?"4px solid #67e8f9":(yt==null?void 0:yt.type)==="LEADER"&&yt.playerId===_&&!dt?"4px solid #f56565":"4px solid #4a5568",boxShadow:rh?"0 0 20px rgba(103, 232, 249, 0.4), 0 0 40px rgba(103, 232, 249, 0.2)":"0 0 20px rgba(0,0,0,0.5)",transition:"border-color 0.3s, box-shadow 0.3s, filter 0.5s, opacity 0.5s",animation:Jm?"leaderDamageCapPulse 2s ease-in-out infinite":"none",...y.winnerId===v&&(lt||Ue)?{filter:lt==="white-fade"?"brightness(2) saturate(0.3)":lt==="explode"||lt==="result-text"||lt==="fade-out"||Ue?"brightness(3) saturate(0) blur(10px)":"none",opacity:lt==="explode"||lt==="result-text"||lt==="fade-out"||Ue?0:1}:{}},children:Jm&&a.jsx("div",{style:{position:"absolute",inset:0,borderRadius:"50%",background:"radial-gradient(circle, rgba(103, 232, 249, 0.5) 0%, rgba(103, 232, 249, 0.2) 70%, rgba(103, 232, 249, 0.1) 100%)",pointerEvents:"none",animation:"leaderDamageCapOverlay 2s ease-in-out infinite",zIndex:1}})}),a.jsx("div",{style:{position:"absolute",bottom:0,left:"50%",transform:`translateX(-50%) translateX(${-140*g}px)`,width:55*g,height:55*g,background:"radial-gradient(circle at 30% 30%, #feb2b2, #c53030)",borderRadius:"50%",border:`${Math.max(2,3*g)}px solid #fff`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${1.2*g}rem`,fontWeight:900,color:"white",textShadow:"0 2px 2px rgba(0,0,0,0.5)",zIndex:10,boxShadow:"0 4px 6px rgba(0,0,0,0.4)",opacity:V?1:0,transition:"opacity 0.3s ease-in"},children:Ne.hp}),a.jsx("div",{style:{position:"absolute",bottom:10*g,left:"50%",transform:`translateX(-50%) translateX(${-80*g}px)`,width:45*g,height:45*g,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,opacity:V?eh?1:.5:0,filter:eh?"none":"grayscale(0.8)",transition:"opacity 0.3s ease-in"},children:a.jsx("div",{style:{display:"flex",gap:3*g},children:Array(2).fill(0).map((p,E)=>{const w=E<2-Ne.evolutionsUsed;return a.jsx("div",{style:{width:12*g,height:12*g,borderRadius:"50%",background:w?"#ecc94b":"#2d3748",boxShadow:w&&eh?"0 0 8px #ecc94b, 0 0 15px #ecc94b":"none",border:"2px solid rgba(0,0,0,0.5)"}},E)})})}),a.jsx("div",{style:{position:"absolute",bottom:10*g,left:"50%",transform:`translateX(-50%) translateX(${80*g}px)`,width:45*g,height:45*g,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,opacity:V?th?1:.5:0,filter:th?"none":"grayscale(0.8)",transition:"opacity 0.3s ease-in"},children:a.jsx("div",{style:{display:"flex",gap:3*g},children:Array(2).fill(0).map((p,E)=>{const w=E<Ne.sep;return a.jsx("div",{style:{width:12*g,height:12*g,borderRadius:"50%",background:w?"#9f7aea":"#2d3748",boxShadow:w&&th?"0 0 8px #9f7aea, 0 0 15px #9f7aea":"none",border:"2px solid rgba(0,0,0,0.5)"}},E)})})}),a.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:ko*g*.75,height:ko*g*.75,pointerEvents:"none",zIndex:20,opacity:(yt==null?void 0:yt.type)==="LEADER"&&yt.playerId===_&&ee?1:0,transition:"opacity 0.1s ease-out"},children:[a.jsxs("svg",{width:"100%",height:"100%",viewBox:"0 0 100 100",children:[a.jsx("defs",{children:a.jsxs("filter",{id:"leaderCyanMarkerGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"4",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsxs("g",{style:{transformOrigin:"50% 50%",animation:"leaderMarkerSpin 2s linear infinite"},children:[a.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"rgba(100, 200, 255, 0.9)",strokeWidth:"3",strokeDasharray:"15 8",filter:"url(#leaderCyanMarkerGlow)"}),a.jsx("polygon",{points:"50,5 44,18 56,18",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"}),a.jsx("polygon",{points:"95,50 82,44 82,56",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"}),a.jsx("polygon",{points:"50,95 56,82 44,82",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"}),a.jsx("polygon",{points:"5,50 18,56 18,44",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"})]})]}),a.jsx("style",{children:`
                                @keyframes leaderMarkerSpin {
                                    0% { transform: rotate(0deg); }
                                    100% { transform: rotate(360deg); }
                                }
                            `})]})]}),a.jsxs("div",{style:{position:"absolute",top:20*g,left:20*g,width:60*g,height:85*g,zIndex:50},children:[[...Array(Math.min(5,Math.ceil(Ne.deck.length/5)))].map((p,E)=>a.jsx("div",{style:{position:"absolute",inset:0,transform:`translate(${E*2*g}px, ${-E*2*g}px)`,borderRadius:6,border:"1px solid #718096",overflow:"hidden"},children:a.jsx("img",{src:Ci((Ne==null?void 0:Ne.class)||"SENKA"),alt:"Deck",style:{width:"100%",height:"100%",objectFit:"cover"},onError:w=>{w.target.style.display="none",w.target.parentElement.style.background="linear-gradient(45deg, #2d3748, #1a202c)"}})},E)),a.jsx("div",{style:{position:"absolute",bottom:-20*g,width:"100%",textAlign:"center",fontWeight:"bold",color:"#a0aec0",fontSize:"0.9rem"},children:Ne.deck.length})]}),a.jsxs("div",{style:{position:"absolute",top:20*g,right:20*g,display:"flex",alignItems:"center",gap:8,zIndex:50,pointerEvents:"none"},children:[a.jsxs("div",{style:{position:"relative",width:24,height:30},children:[a.jsx("div",{style:{position:"absolute",inset:0,background:"#4a192c",borderRadius:2,border:"1px solid #742a3a",transform:"rotate(-15deg) translate(-3px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#3d1525",borderRadius:2,border:"1px solid #742a3a",transform:"rotate(-5deg) translate(-1px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#2d1a20",borderRadius:2,border:"1px solid #8b3a4a",transform:"rotate(5deg)"}})]}),a.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(74, 25, 44, 0.8), rgba(45, 26, 32, 0.9))",padding:"3px 8px",borderRadius:5,color:"#f0b8c4",fontSize:"0.64rem",fontWeight:"bold",border:"1px solid rgba(116, 42, 58, 0.5)",boxShadow:"0 2px 4px rgba(0,0,0,0.4)"},children:[" ",Ne.hand.length]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5,marginLeft:6},children:[a.jsx("div",{style:{fontSize:"0.9rem",filter:"drop-shadow(0 0 2px rgba(128, 90, 213, 0.6)) grayscale(30%)"},children:""}),a.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(128, 90, 213, 0.7), rgba(76, 29, 149, 0.8))",padding:"3px 8px",borderRadius:5,color:"#c4b5fd",fontSize:"0.64rem",fontWeight:"bold",border:"1px solid rgba(167, 139, 250, 0.4)",boxShadow:"0 2px 4px rgba(0,0,0,0.4)",position:"relative"},children:[" ",Ne.graveyard.length,lo.filter(p=>p.playerId===_).map(p=>a.jsxs("div",{style:{position:"absolute",bottom:-25,left:"50%",transform:"translateX(-50%)",color:"#d946ef",fontSize:"1.2rem",fontWeight:"bold",textShadow:"0 0 8px #d946ef, 0 0 15px #a855f7, 0 0 25px #7c3aed",animation:"necromanceFloatOpponent 1.5s ease-out forwards",pointerEvents:"none",whiteSpace:"nowrap"},children:["-",p.amount]},p.key))]})]})]}),a.jsx("div",{style:{position:"absolute",top:`calc(50% - ${Nn*g/2}px - ${70*g}px)`,left:"0",width:"100%",height:Nn*g,pointerEvents:"none",zIndex:10},children:a.jsx("div",{style:{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center"},children:je.map((p,E)=>{const w=je.length,M=(E-(w-1)/2)*ki*g;return a.jsxs("div",{ref:$=>kr.current[E]=$,onMouseEnter:()=>{ee&&mr({type:"FOLLOWER",index:E,playerId:_,instanceId:p==null?void 0:p.instanceId})},onMouseLeave:()=>{ee&&mr(null)},onClick:$=>{if($.stopPropagation(),dt){if(!p)return;Yf("FOLLOWER",E,_,p==null?void 0:p.instanceId)}else p&&ns({card:p,owner:"OPPONENT",source:"BOARD"})},style:{position:"absolute",left:"50%",top:0,transform:`translateX(calc(-50% + ${M}px))`,transition:"transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1), left 0.4s ease",border:dt&&p&&dt.allowedTargetPlayerId===_?"2px solid #f56565":"none",boxShadow:dt&&p&&dt.allowedTargetPlayerId===_?"0 0 15px #f56565":"none",borderRadius:8,cursor:dt?"crosshair":"default",width:bn*g,height:Nn*g,pointerEvents:"auto",opacity:Gt&&Gt.sourcePlayerId===_&&Gt.followerIndex===E?0:p!=null&&p.isDying?.8:1,transitionProperty:Gt&&Gt.sourcePlayerId===_&&Gt.followerIndex===E?"none":"transform, left, opacity"},children:[a.jsx("div",{style:{width:"100%",height:"100%",perspective:"800px"},children:a.jsxs("div",{className:Tm===(p==null?void 0:p.instanceId)||Cm===(p==null?void 0:p.instanceId)?"attack-rotating":"",style:{width:"100%",height:"100%",position:"relative",transformStyle:"preserve-3d"},children:[a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},children:p?a.jsx(Co,{card:p,turnCount:y.turnCount,className:p.isDying?"card-dying":"",scale:g,style:{width:bn*g,height:Nn*g,opacity:1,filter:p.isDying?"grayscale(0.5) brightness(2)":"none",boxShadow:(yt==null?void 0:yt.type)==="FOLLOWER"&&yt.index===E&&(ee==null?void 0:ee.sourceType)==="BOARD"?"0 0 20px #f56565":(ee==null?void 0:ee.sourceType)==="BOARD"?"0 0 20px #f6e05e":void 0},isOnBoard:!0,isSpecialSummoning:Im.has(p.instanceId)}):a.jsx("div",{style:{width:bn*g,height:Nn*g,border:"1px dashed rgba(255,255,255,0.1)",borderRadius:8}})}),p&&a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",transform:"rotateY(180deg)",borderRadius:12,overflow:"hidden"},children:a.jsx("img",{src:Ci((Ne==null?void 0:Ne.class)||"SENKA"),alt:"Card Sleeve",style:{width:"100%",height:"100%",objectFit:"cover"}})})]})}),p&&(ee==null?void 0:ee.sourceType)==="BOARD"&&a.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",width:"100%",height:"100%",transform:"translate(-50%, -50%)",pointerEvents:"none",zIndex:20,opacity:(yt==null?void 0:yt.type)==="FOLLOWER"&&yt.index===E&&yt.playerId===_?1:0,transition:"opacity 0.1s ease-out"},children:[a.jsxs("svg",{viewBox:"0 0 100 100",style:{width:"100%",height:"100%",filter:"drop-shadow(0 0 12px rgba(100, 200, 255, 0.9))"},children:[a.jsx("defs",{children:a.jsxs("filter",{id:"cyanMarkerGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"4",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsxs("g",{style:{transformOrigin:"50px 50px",animation:"attackMarkerSpin 1.5s linear infinite reverse"},children:[a.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:"rgba(100, 200, 255, 0.95)",strokeWidth:"4",strokeDasharray:"12 6",filter:"url(#cyanMarkerGlow)"}),a.jsx("polygon",{points:"50,10 45,20 55,20",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"}),a.jsx("polygon",{points:"90,50 80,45 80,55",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"}),a.jsx("polygon",{points:"50,90 55,80 45,80",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"}),a.jsx("polygon",{points:"10,50 20,55 20,45",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"})]})]}),a.jsx("style",{children:`
                                                    @keyframes attackMarkerSpin {
                                                        0% { transform: rotate(0deg); }
                                                        100% { transform: rotate(360deg); }
                                                    }
                                                `})]})]},(p==null?void 0:p.instanceId)||`empty-opp-${E}`)})})}),a.jsx("div",{style:{position:"absolute",bottom:`calc(50% - ${Nn*g/2}px - ${70*g}px)`,left:"0",width:"100%",height:Nn*g,pointerEvents:"none",zIndex:10},children:a.jsx("div",{style:{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center"},children:ve.map((p,E)=>{const w=ve.length,M=(E-(w-1)/2)*ki*g;return a.jsxs("div",{ref:$=>Wr.current[E]=$,onMouseDown:$=>Fm($,E,p==null?void 0:p.instanceId),onTouchStart:$=>Fm($,E,p==null?void 0:p.instanceId),onClick:$=>$.stopPropagation(),onMouseEnter:()=>{ee&&mr({type:"FOLLOWER",index:E,playerId:v,instanceId:p==null?void 0:p.instanceId})},onMouseLeave:()=>{ee&&mr(null)},style:{position:"absolute",left:"50%",top:0,"--offsetX":`calc(-50% + ${M}px)`,transform:`translateX(calc(-50% + ${M}px)) ${(ee==null?void 0:ee.sourceType)==="BOARD"&&ee.sourceInstanceId===(p==null?void 0:p.instanceId)?"translateY(-20px) scale(1.1)":""}`,transition:"transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1), left 0.4s ease",cursor:"pointer",pointerEvents:"auto",width:bn*g,height:Nn*g,border:dt&&p&&dt.allowedTargetPlayerId===v?"2px solid #48bb78":"none",boxShadow:dt&&p&&dt.allowedTargetPlayerId===v?"0 0 15px #48bb78":"none",borderRadius:8,zIndex:(ee==null?void 0:ee.sourceType)==="BOARD"&&ee.sourceInstanceId===(p==null?void 0:p.instanceId)?10:1,opacity:Gt&&Gt.sourcePlayerId===v&&Gt.followerIndex===E?0:p!=null&&p.isDying?.8:1,transitionProperty:Gt&&Gt.sourcePlayerId===v&&Gt.followerIndex===E?"none":"transform, left, opacity"},children:[a.jsx("div",{style:{width:"100%",height:"100%",perspective:"800px"},children:a.jsxs("div",{className:Tm===(p==null?void 0:p.instanceId)||Cm===(p==null?void 0:p.instanceId)?"attack-rotating":"",style:{width:"100%",height:"100%",position:"relative",transformStyle:"preserve-3d"},children:[a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},children:p?a.jsx(Co,{card:p,turnCount:y.turnCount,className:p.isDying?"card-dying":"",scale:g,style:{width:bn*g,height:Nn*g,opacity:1,filter:p.isDying?"grayscale(0.5) brightness(2)":"none",boxShadow:(ee==null?void 0:ee.sourceType)==="BOARD"&&ee.sourceInstanceId===(p==null?void 0:p.instanceId)&&(yt==null?void 0:yt.type)==="FOLLOWER"?"0 0 30px #f56565":(ee==null?void 0:ee.sourceType)==="BOARD"&&ee.sourceInstanceId===(p==null?void 0:p.instanceId)?"0 20px 30px rgba(0,0,0,0.6)":void 0,pointerEvents:(ee==null?void 0:ee.sourceType)==="BOARD"&&ee.sourceInstanceId===(p==null?void 0:p.instanceId)?"none":"auto"},isSelected:(Ye==null?void 0:Ye.card)===p,isOnBoard:!0,isSpecialSummoning:Im.has(p.instanceId),isMyTurn:y.activePlayerId===v}):a.jsx("div",{style:{width:bn*g,height:Nn*g,border:"1px dashed rgba(255,255,255,0.2)",borderRadius:8}})}),p&&a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",transform:"rotateY(180deg)",borderRadius:12,overflow:"hidden"},children:a.jsx("img",{src:Ci((le==null?void 0:le.class)||"SENKA"),alt:"Card Sleeve",style:{width:"100%",height:"100%",objectFit:"cover"}})})]})}),p&&(ee==null?void 0:ee.sourceType)==="EVOLVE"&&!p.hasEvolved&&a.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",width:"120%",height:"120%",transform:"translate(-50%, -50%)",pointerEvents:"none",border:ee.useSep?"2px dashed rgba(183, 148, 244, 0.9)":"2px dashed rgba(255, 230, 100, 0.9)",borderRadius:"50%",boxShadow:ee.useSep?"0 0 15px rgba(159, 122, 234, 0.8)":"0 0 15px rgba(255, 200, 50, 0.8)",animation:"evolveMarkerSpin 1.5s linear infinite",zIndex:20,opacity:(yt==null?void 0:yt.type)==="FOLLOWER"&&yt.index===E&&yt.playerId===v?1:0,transition:"opacity 0.1s ease-out"},children:[a.jsxs("svg",{viewBox:"0 0 100 100",style:{width:"100%",height:"100%",filter:"drop-shadow(0 0 8px currentColor)"},children:[a.jsx("defs",{children:a.jsxs("filter",{id:ee.useSep?"purpleMarkerGlow":"yellowMarkerGlow",x:"-30%",y:"-30%",width:"160%",height:"160%",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"3",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:ee.useSep?"#b794f4":"#f6e05e",strokeWidth:"4",strokeDasharray:"15 8",filter:`url(#${ee.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`,opacity:"0.95"}),a.jsx("polygon",{points:"50,5 45,15 55,15",fill:ee.useSep?"#b794f4":"#f6e05e",filter:`url(#${ee.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`}),a.jsx("polygon",{points:"95,50 85,45 85,55",fill:ee.useSep?"#b794f4":"#f6e05e",filter:`url(#${ee.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`}),a.jsx("polygon",{points:"50,95 55,85 45,85",fill:ee.useSep?"#b794f4":"#f6e05e",filter:`url(#${ee.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`}),a.jsx("polygon",{points:"5,50 15,55 15,45",fill:ee.useSep?"#b794f4":"#f6e05e",filter:`url(#${ee.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`})]}),a.jsx("style",{children:`
                                                @keyframes evolveMarkerSpin {
                                                    0% { transform: translate(-50%, -50%) rotate(0deg); }
                                                    100% { transform: translate(-50%, -50%) rotate(360deg); }
                                                }
                                            `})]})]},(p==null?void 0:p.instanceId)||`empty-plr-${E}`)})})}),a.jsxs("div",{style:{position:"absolute",right:30*g,top:"50%",transform:"translateY(-50%)",display:"flex",flexDirection:"column",alignItems:"center",gap:30*g,zIndex:50},children:[a.jsx("div",{style:{textAlign:"center"},children:a.jsxs("div",{style:{fontSize:`${1.2*g}rem`,fontWeight:700,color:"#a0aec0",fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif'},children:["Turn ",y.turnCount]})}),a.jsxs("div",{style:{textAlign:"center"},children:[a.jsxs("div",{style:{fontSize:`${1.8*g}rem`,fontWeight:900,color:"#f6e05e",fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif'},children:[Ne.pp,"/",Ne.maxPp]}),a.jsx("div",{style:{display:"flex",gap:4*g,justifyContent:"center"},children:Array(Math.min(10,Ne.maxPp)).fill(0).map((p,E)=>a.jsx("div",{style:{width:10*g,height:10*g,borderRadius:"50%",background:E<Ne.pp?"#f6e05e":"#2d3748"}},E))})]}),a.jsxs("div",{style:{position:"relative",width:160*g,height:160*g},children:[a.jsx(lM,{isMyTurn:y.activePlayerId===v,turnCount:y.turnCount,activePlayerId:y.activePlayerId,onTimeUp:j2,timerEnabled:h,isGameOver:!!y.winnerId,isPaused:ye,scale:g,buttonSize:160,timerDuration:60}),a.jsxs("button",{ref:Sm,disabled:y.activePlayerId!==v||Eo,onMouseDown:p=>{p.stopPropagation(),y.activePlayerId===v&&!Eo&&Xf(!0)},onMouseUp:p=>{var E;if(p.stopPropagation(),Yc&&y.activePlayerId===v&&!Eo){Xf(!1),Tt("sisiodosi.mp3",.6);const w=(E=p.target.closest("button"))==null?void 0:E.getBoundingClientRect();w&&Wm(w.left+w.width/2,w.top+w.height/2),Qf()}},onMouseLeave:()=>{Xf(!1)},style:{width:160*g,height:160*g,borderRadius:"50%",border:"4px solid rgba(255,255,255,0.2)",background:Eo?"linear-gradient(135deg, #805ad5, #6b46c1)":Yc?"linear-gradient(135deg, #5a9bd5, #4a7fb0)":y.activePlayerId===v?"linear-gradient(135deg, #3182ce, #2b6cb0)":"#2d3748",color:"white",fontWeight:900,fontSize:`${2*g}rem`,fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif',boxShadow:y.activePlayerId===v?Yc?"0 0 20px rgba(66, 153, 225, 0.5)":"0 0 40px rgba(66, 153, 225, 0.8)":"none",opacity:Yc?.8:1,cursor:y.activePlayerId===v&&!Eo?"pointer":"default",transition:"all 0.1s",position:"relative",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",lineHeight:1.2},children:[a.jsx("img",{src:ot("/assets/tenfubu_mark.png"),alt:"",style:{position:"absolute",width:"80%",height:"80%",objectFit:"contain",opacity:.25,pointerEvents:"none"}}),Eo?a.jsx("span",{style:{position:"relative",zIndex:1,whiteSpace:"nowrap"},children:"..."}):a.jsxs(a.Fragment,{children:[a.jsx("span",{style:{position:"relative",zIndex:1,whiteSpace:"nowrap"},children:""}),a.jsx("span",{style:{position:"relative",zIndex:1,whiteSpace:"nowrap"},children:""})]})]})]}),a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("div",{style:{fontSize:`${2.4*g}rem`,fontWeight:900,color:"#f6e05e",fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif'},children:le.extraPpActive?a.jsxs("span",{children:[Math.max(0,le.pp-1),"/",le.maxPp," ",a.jsx("span",{style:{color:"#ed8936"},children:"+1"})]}):a.jsxs("span",{children:[le.pp,"/",le.maxPp]})}),a.jsx("div",{style:{display:"flex",gap:3*g,justifyContent:"center"},children:Array(10).fill(0).map((p,E)=>{const w=E<le.pp,M=E<le.maxPp;let $;return w?$="#f6e05e":M?$="#744210":$="#2d3748",a.jsx("div",{style:{width:11*g,height:11*g,borderRadius:"50%",background:$}},E)})})]}),(()=>{const p=v!==y.firstPlayerId,E=y.activePlayerId===v,w=y.turnCount,M=w<=5&&!le.extraPpUsedEarly,$=w>=6&&!le.extraPpUsedLate,z=p&&E&&!le.extraPpActive&&(M||$),q=le.extraPpActive;if(!p)return null;const U=w<=5&&le.extraPpUsedEarly||w>=6&&le.extraPpUsedLate,F=!z&&!q;return a.jsxs("button",{disabled:F,onClick:Y=>{Y.stopPropagation(),F||Rs({type:"TOGGLE_EXTRA_PP",playerId:v})},style:{width:160*g,height:45*g,borderRadius:12*g,border:q?"3px solid #ed8936":"3px solid rgba(255,255,255,0.2)",background:q?"linear-gradient(135deg, #ed8936, #dd6b20)":z?"linear-gradient(135deg, #744210, #5a3510)":"#2d3748",color:q?"white":z?"#f6e05e":"#718096",fontWeight:700,fontSize:"1rem",boxShadow:q?"0 0 20px rgba(237, 137, 54, 0.6)":"none",cursor:F?"default":"pointer",transition:"all 0.3s",display:"flex",alignItems:"center",justifyContent:"center",gap:6*g,opacity:U&&!q?.5:1},children:[a.jsx("span",{children:"PP"}),a.jsx("span",{style:{fontSize:"1.3rem"},children:"+1"}),q&&a.jsx("span",{style:{fontSize:"0.8rem"},children:"ON"}),U&&!q&&a.jsx("span",{style:{fontSize:"0.7rem",marginLeft:2},children:""})]})})()]}),G?a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:p=>{p.stopPropagation(),Nf(!0)},style:{position:"absolute",left:15*g,top:120*g,width:64*g,height:64*g,minWidth:64*g,maxWidth:64*g,minHeight:64*g,maxHeight:64*g,borderRadius:"50%",background:"linear-gradient(135deg, #4a5568 0%, #2d3748 100%)",border:"3px solid #63b3ed",color:"#63b3ed",fontSize:`${1.8*g}rem`,fontWeight:"bold",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,padding:0,zIndex:16,boxShadow:"0 2px 8px rgba(0,0,0,0.4)",transition:"all 0.2s ease"},onMouseEnter:p=>{p.currentTarget.style.transform="scale(1.1)",p.currentTarget.style.boxShadow="0 0 15px rgba(99, 179, 237, 0.5)"},onMouseLeave:p=>{p.currentTarget.style.transform="scale(1)",p.currentTarget.style.boxShadow="0 2px 8px rgba(0,0,0,0.4)"},children:"?"}),a.jsx(IM,{logs:y.logs||[],onCardNameClick:Lf,scale:g,isMobile:G})]}):a.jsxs("div",{style:{position:"absolute",left:15,top:"50%",transform:"translateY(-50%)",display:"flex",flexDirection:"column",alignItems:"flex-start",gap:8,zIndex:16,pointerEvents:"none"},children:[a.jsx("button",{onClick:p=>{p.stopPropagation(),Nf(!0)},style:{width:36,height:36,borderRadius:"50%",background:"linear-gradient(135deg, #4a5568 0%, #2d3748 100%)",border:"2px solid #63b3ed",color:"#63b3ed",fontSize:"1.2rem",fontWeight:"bold",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",padding:0,boxShadow:"0 4px 12px rgba(0,0,0,0.4)",transition:"all 0.2s ease",pointerEvents:"auto"},onMouseEnter:p=>{p.currentTarget.style.transform="scale(1.1)",p.currentTarget.style.boxShadow="0 0 15px rgba(99, 179, 237, 0.5)"},onMouseLeave:p=>{p.currentTarget.style.transform="scale(1)",p.currentTarget.style.boxShadow="0 4px 12px rgba(0,0,0,0.4)"},children:"?"}),a.jsxs("div",{style:{width:Math.max(180,220*g),height:Math.max(200,280*g),overflowY:"auto",background:"linear-gradient(to right, rgba(0,0,0,0.8), rgba(0,0,0,0.0))",color:"#fff",fontSize:`${Math.max(.65,.75*g)}rem`,padding:`${8*g}px ${8*g}px ${8*g}px ${12*g}px`,borderLeft:"3px solid #63b3ed",pointerEvents:"auto",scrollbarWidth:"thin"},onMouseDown:p=>p.stopPropagation(),onClick:p=>p.stopPropagation(),ref:p=>{p&&(p.scrollTop=p.scrollHeight)},children:[a.jsx("div",{style:{fontWeight:"bold",marginBottom:4*g,color:"#a0aec0",borderBottom:"1px solid rgba(255,255,255,0.1)",paddingBottom:2,fontSize:`${Math.max(.55,.65*g)}rem`,textTransform:"uppercase",letterSpacing:1},children:"BATTLE LOG"}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:3*g},children:(y.logs||[]).map((p,E)=>a.jsx("div",{style:{opacity:.9,lineHeight:"1.4",textShadow:"0 1px 2px black",animation:"fadeIn 0.3s ease-out"},children:p},E))})]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,pointerEvents:"none"},children:[a.jsxs("div",{style:{position:"relative",width:32,height:40},children:[a.jsx("div",{style:{position:"absolute",inset:0,background:"#4a5568",borderRadius:4,border:"1px solid #718096",transform:"rotate(-15deg) translate(-5px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#2d3748",borderRadius:4,border:"1px solid #718096",transform:"rotate(-5deg) translate(-2px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#1a202c",borderRadius:4,border:"1px solid #cbd5e0",transform:"rotate(5deg)"}})]}),a.jsxs("div",{style:{background:"rgba(0,0,0,0.7)",padding:"4px 12px",borderRadius:8,color:"#e2e8f0",fontSize:"0.9rem",fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5)"},children:[" ",le.hand.length]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,marginLeft:6},children:[a.jsx("div",{style:{fontSize:"1.2rem",filter:"drop-shadow(0 0 3px rgba(128, 90, 213, 0.8))"},children:""}),a.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(128, 90, 213, 0.8), rgba(76, 29, 149, 0.9))",padding:"4px 12px",borderRadius:8,color:"#e2e8f0",fontSize:"0.9rem",fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5), inset 0 1px rgba(255,255,255,0.1)",border:"1px solid rgba(167, 139, 250, 0.5)",position:"relative"},children:[" ",le.graveyard.length,lo.filter(p=>p.playerId===v).map(p=>a.jsxs("div",{style:{position:"absolute",top:-30,left:"50%",transform:"translateX(-50%)",color:"#d946ef",fontSize:"1.5rem",fontWeight:"bold",textShadow:"0 0 10px #d946ef, 0 0 20px #a855f7, 0 0 30px #7c3aed",animation:"necromanceFloat 1.5s ease-out forwards",pointerEvents:"none",whiteSpace:"nowrap"},children:["-",p.amount]},p.key))]})]})]}),Ye&&Ye.owner==="PLAYER"&&Ye.source==="HAND"&&rs&&(()=>{const w=((G?Math.max(140,180*g):Math.max(180,220*g))-6)/2,M=le.pp>=Ye.card.cost;return a.jsxs("button",{disabled:!M,onClick:$=>{$.stopPropagation(),Hm()},className:M?"play-button-active":"",style:{width:w,background:M?"linear-gradient(to bottom, #48bb78, #38a169)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:"8px 4px",borderRadius:12,fontSize:"0.85rem",fontWeight:"bold",cursor:M?"pointer":"not-allowed",boxShadow:M?"0 0 15px rgba(72, 187, 120, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease",pointerEvents:"auto"},onMouseDown:$=>$.stopPropagation(),children:["",a.jsxs("div",{style:{fontSize:"0.6rem",opacity:.8,marginTop:2},children:["pp ",Ye.card.cost]})]})})(),Ye&&Ye.owner==="PLAYER"&&Ye.source==="BOARD"&&(()=>{const p=G?Math.max(140,180*g):Math.max(180,220*g),E=6,w=(p-E)/2,M=Ye.card,$=M==null?void 0:M.hasEvolved,z=!$&&Ps,q=!$&&Os,U=M==null?void 0:M.instanceId,F=le.board.findIndex(Z=>Z&&Z.instanceId===U),Y=le.board.slice(0,F+1).filter(Z=>Z).length-1,ce=Z=>{if(F<0)return;const pe=le.board[F];if(!pe)return;const we=Z?["SUPER_EVOLVE","EVOLVE"]:["EVOLVE"],Ie=(()=>{var re,se;const oe=(se=(re=pe.triggerAbilities)==null?void 0:re.EVOLVE)==null?void 0:se.targetType;if(oe)return oe;for(const K of pe.triggers||[])if(we.includes(K.trigger)){for(const ie of K.effects)if(ie.targetType&&["SELECT_FOLLOWER","SELECT_ALLY_FOLLOWER","SELECT_OTHER_ALLY_FOLLOWER"].includes(ie.targetType))return ie.targetType}return null})(),ze=!!Ie,He=Ie==="SELECT_ALLY_FOLLOWER"||Ie==="SELECT_OTHER_ALLY_FOLLOWER",We=Ie==="SELECT_OTHER_ALLY_FOLLOWER",Ge=He?v:_,X=y.players[Ge].board.some(oe=>{var re,se;return!(!oe||He&&We&&oe.instanceId===U||!He&&((re=oe.passiveAbilities)!=null&&re.includes("STEALTH")||(se=oe.passiveAbilities)!=null&&se.includes("AURA")))});if(ze&&X){Cs({type:"EVOLVE",sourceIndex:F,sourceInstanceId:U,sourceVisualIndex:Y>=0?Y:F,useSep:Z,allowedTargetPlayerId:Ge,excludeInstanceId:We?U:void 0});return}Gc(Y>=0?Y:F,Z,void 0,U)};return a.jsxs("div",{style:{display:"flex",gap:E,pointerEvents:"auto"},onMouseDown:Z=>Z.stopPropagation(),children:[a.jsxs("button",{disabled:!z,onClick:Z=>{Z.stopPropagation(),ce(!1)},style:{width:w,background:z?"linear-gradient(to bottom, #faf089, #d69e2e)":"#718096",color:z?"#1a202c":"white",border:"2px solid rgba(255,255,255,0.2)",padding:"8px 4px",borderRadius:12,fontSize:"0.85rem",fontWeight:"bold",cursor:z?"pointer":"not-allowed",boxShadow:z?"0 0 15px rgba(250, 240, 137, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:z?"0 1px 1px rgba(255,255,255,0.3)":"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",a.jsx("div",{style:{fontSize:"0.6rem",opacity:.8,marginTop:2},children:"EP"})]}),a.jsxs("button",{disabled:!q,onClick:Z=>{Z.stopPropagation(),ce(!0)},style:{width:w,background:q?"linear-gradient(to bottom, #b794f4, #805ad5)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:"8px 4px",borderRadius:12,fontSize:"0.85rem",fontWeight:"bold",cursor:q?"pointer":"not-allowed",boxShadow:q?"0 0 15px rgba(183, 148, 244, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",a.jsx("div",{style:{fontSize:"0.6rem",opacity:.8,marginTop:2},children:"SEP"})]})]})})(),!(Ye&&Ye.owner==="PLAYER"&&(Ye.source==="HAND"||Ye.source==="BOARD"))&&(()=>{const p=G?Math.max(140,180*g):Math.max(180,220*g);return a.jsx("div",{style:{width:p,height:52,visibility:"hidden",pointerEvents:"none"}})})()]}),(Oe==="TOSSING"||Oe==="RESULT")&&a.jsxs("div",{style:{position:"absolute",inset:0,zIndex:4e3,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.85)",pointerEvents:"none"},children:[a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("div",{style:{width:120*g,height:120*g,margin:`0 auto ${30*g}px`,borderRadius:"50%",background:Oe==="RESULT"?xt==="FIRST"?"linear-gradient(135deg, #ffd700, #ff8c00)":"linear-gradient(135deg, #c0c0c0, #808080)":"linear-gradient(135deg, #ffd700, #ff8c00)",boxShadow:Oe==="RESULT"?`0 0 ${40*g}px ${xt==="FIRST"?"#ffd700":"#c0c0c0"}, 0 0 ${80*g}px ${xt==="FIRST"?"rgba(255,215,0,0.5)":"rgba(192,192,192,0.5)"}`:`0 0 ${30*g}px #ffd700`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"3rem",fontWeight:900,color:"#1a202c",textShadow:"0 2px 2px rgba(0,0,0,0.5)",animation:Oe==="TOSSING"?"coinFlip 0.3s ease-in-out infinite":"coinLand 0.5s ease-out",border:"4px solid rgba(255,255,255,0.3)"},children:Oe==="RESULT"?xt==="FIRST"?"":"":"?"}),a.jsxs("div",{style:{fontSize:Oe==="RESULT"?"2.5rem":"1.8rem",fontWeight:900,color:xt==="FIRST"?"#ffd700":xt==="SECOND"?"#c0c0c0":"white",textShadow:"0 0 20px currentColor, 0 2px 4px black",animation:Oe==="RESULT"?"textPop 0.5s ease-out":"none"},children:[Oe==="TOSSING"&&"...",Oe==="RESULT"&&(xt==="FIRST"?"":"")]}),Oe==="RESULT"&&a.jsx("div",{style:{fontSize:"1rem",color:"#a0aec0",marginTop:10*g,animation:"fadeIn 0.5s ease-out 0.3s both"},children:xt==="FIRST"?"":""})]}),a.jsx("style",{children:`
                            @keyframes coinFlip {
                                0%, 100% { transform: rotateY(0deg) scale(1); }
                                50% { transform: rotateY(180deg) scale(1.1); }
                            }
                            @keyframes coinLand {
                                0% { transform: rotateY(720deg) scale(0.5); }
                                70% { transform: rotateY(0deg) scale(1.2); }
                                100% { transform: rotateY(0deg) scale(1); }
                            }
                            @keyframes textPop {
                                0% { transform: scale(0.5); opacity: 0; }
                                70% { transform: scale(1.2); }
                                100% { transform: scale(1); opacity: 1; }
                            }
                        `})]}),qe&&a.jsxs("div",{style:{position:"absolute",inset:0,zIndex:3e3,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.7)",pointerEvents:"none",animation:"fadeIn 0.2s ease-out"},children:[a.jsx("div",{style:{fontSize:`${3.5*g}rem`,fontWeight:900,fontFamily:"Tamanegi, sans-serif",background:"linear-gradient(135deg, #ffd700, #ff6b6b, #ffd700)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",textShadow:"none",filter:`drop-shadow(0 0 ${15*g}px rgba(255,215,0,0.8)) drop-shadow(0 0 ${30*g}px rgba(255,107,107,0.5))`,animation:"gameStartPop 0.8s ease-out",letterSpacing:"0.2em"},children:" "}),a.jsx("style",{children:`
                            @keyframes gameStartPop {
                                0% { transform: scale(0.3) rotate(-10deg); opacity: 0; }
                                50% { transform: scale(1.2) rotate(5deg); opacity: 1; }
                                70% { transform: scale(0.95) rotate(-2deg); }
                                100% { transform: scale(1) rotate(0deg); opacity: 1; }
                            }
                        `})]}),a.jsxs("div",{ref:Ti,style:{position:"absolute",bottom:-20*g,left:"50%",transform:"translateX(-50%)",width:ko*g,height:ko*g,borderRadius:"50%",zIndex:200},children:[a.jsxs("div",{onMouseDown:M2,style:{width:"100%",height:"100%",borderRadius:"50%",overflow:"hidden",border:nh?"4px solid #67e8f9":"4px solid #3182ce",boxShadow:nh?"0 0 20px rgba(103, 232, 249, 0.4), 0 0 40px rgba(103, 232, 249, 0.2)":"0 0 20px rgba(49, 130, 206, 0.4)",background:"#1a202c",cursor:"grab",transition:"border-color 0.3s, box-shadow 0.3s, filter 0.5s, opacity 0.5s",animation:Xm?"leaderDamageCapPulse 2s ease-in-out infinite":"none",position:"relative",...y.winnerId&&y.winnerId!==v&&(lt||Ue)?{filter:lt==="white-fade"?"brightness(2) saturate(0.3)":lt==="explode"||lt==="result-text"||lt==="fade-out"||Ue?"brightness(3) saturate(0) blur(10px)":"none",opacity:lt==="explode"||lt==="result-text"||lt==="fade-out"||Ue?0:1}:{}},children:[a.jsx("img",{src:kl(le.class),style:le.class==="AJA"?{width:"100%",height:"100%",objectFit:"cover",objectPosition:"center top",pointerEvents:"none"}:{width:"100%",height:"100%",objectFit:"cover",pointerEvents:"none"}}),Xm&&a.jsx("div",{style:{position:"absolute",inset:0,borderRadius:"50%",background:"radial-gradient(circle, rgba(103, 232, 249, 0.5) 0%, rgba(103, 232, 249, 0.2) 70%, rgba(103, 232, 249, 0.1) 100%)",pointerEvents:"none",animation:"leaderDamageCapOverlay 2s ease-in-out infinite",zIndex:1}})]}),a.jsx("div",{style:{position:"absolute",top:0,left:"50%",transform:`translateX(-50%) translateX(${-140*g}px)`,width:55*g,height:55*g,background:"radial-gradient(circle at 30% 30%, #feb2b2, #c53030)",borderRadius:"50%",border:`${Math.max(2,3*g)}px solid #fff`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${1.2*g}rem`,fontWeight:900,color:"white",textShadow:"0 2px 2px rgba(0,0,0,0.5)",boxShadow:"0 4px 6px rgba(0,0,0,0.4)",zIndex:10,opacity:V?1:0,transition:"opacity 0.3s ease-in"},children:le.hp}),a.jsx("div",{onMouseDown:p=>Vc(p,!1),onTouchStart:p=>Vc(p,!1),style:{position:"absolute",top:10*g,left:"50%",transform:`translateX(-50%) translateX(${-80*g}px)`,width:45*g,height:45*g,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:Ps?"rgba(255,235,100,0.2)":"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",cursor:Ps?"grab":"default",zIndex:10,opacity:V?Kc?1:.5:0,filter:Kc?"none":"grayscale(0.8)",transition:"opacity 0.3s ease-in, filter 0.3s, background 0.3s",boxShadow:Ps?"0 0 12px #ffd700, 0 0 25px rgba(255,215,0,0.5)":"none",animation:Ps?"epPulse 1.5s ease-in-out infinite":"none"},children:a.jsx("div",{style:{display:"flex",gap:3*g},children:Array(2).fill(0).map((p,E)=>{const w=E<Gm;let M="none";return w&&Kc&&(M=Ps?"0 0 10px #fff59d, 0 0 20px #ffd700, 0 0 30px #ecc94b":"0 0 8px #ecc94b, 0 0 15px #ecc94b"),a.jsx("div",{style:{width:12*g,height:12*g,borderRadius:"50%",background:w?Ps?"#fff59d":"#ecc94b":"#2d3748",boxShadow:M,border:"2px solid rgba(0,0,0,0.5)",transition:"box-shadow 0.3s, background 0.3s"}},E)})})}),a.jsx("div",{onMouseDown:p=>Vc(p,!0),onTouchStart:p=>Vc(p,!0),style:{position:"absolute",top:10*g,left:"50%",transform:`translateX(-50%) translateX(${80*g}px)`,width:45*g,height:45*g,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:Os?"rgba(200,160,255,0.2)":"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,cursor:Os?"grab":"default",opacity:V?Xc?1:.5:0,filter:Xc?"none":"grayscale(0.8)",transition:"opacity 0.3s ease-in, filter 0.3s, background 0.3s",boxShadow:Os?"0 0 12px #b794f4, 0 0 25px rgba(159,122,234,0.5)":"none",animation:Os?"sepPulse 1.5s ease-in-out infinite":"none"},children:a.jsx("div",{style:{display:"flex",gap:3*g},children:Array(2).fill(0).map((p,E)=>{const w=E<le.sep;let M="none";return w&&Xc&&(M=Os?"0 0 10px #d6bcfa, 0 0 20px #b794f4, 0 0 30px #9f7aea":"0 0 8px #9f7aea, 0 0 15px #9f7aea"),a.jsx("div",{style:{width:12*g,height:12*g,borderRadius:"50%",background:w?Os?"#d6bcfa":"#9f7aea":"#2d3748",boxShadow:M,border:"2px solid rgba(0,0,0,0.5)",transition:"box-shadow 0.3s, background 0.3s"}},E)})})})]}),a.jsxs("div",{style:{position:"absolute",bottom:10*g,right:15*g,width:60*g,height:85*g,zIndex:50},children:[[...Array(Math.min(5,Math.ceil(le.deck.length/5)))].map((p,E)=>a.jsx("div",{style:{position:"absolute",inset:0,transform:`translate(${E*2*g}px, ${-E*2*g}px)`,borderRadius:6,border:"1px solid #718096",boxShadow:"1px 1px 3px rgba(0,0,0,0.5)",overflow:"hidden"},children:a.jsx("img",{src:Ci((le==null?void 0:le.class)||"SENKA"),alt:"Deck",style:{width:"100%",height:"100%",objectFit:"cover"},onError:w=>{w.target.style.display="none",w.target.parentElement.style.background="linear-gradient(45deg, #2d3748, #1a202c)"}})},E)),a.jsx("div",{style:{position:"absolute",top:-20*g,width:"100%",textAlign:"center",color:"#a0aec0",fontSize:"0.9rem",fontWeight:"bold",textShadow:"0 1px 2px black"},children:le.deck.length})]}),a.jsx("div",{style:{position:"absolute",bottom:0,left:0,width:"100%",height:200*g,display:"flex",justifyContent:"center",alignItems:"flex-end",pointerEvents:"none",zIndex:500},children:le.hand.map((p,E)=>{if(rt!==null&&rt.sourceIndex===E)return null;const M=le.hand.length;let $=0,z=0,q=0;if(rs){const F=100*g,Y=window.innerWidth-40*g,ce=(M-1)*F+bn*g;let Z=F;ce>Y&&(Z=(Y-bn*g)/Math.max(1,M-1)),$=(E-(M-1)/2)*Z,z=Ee===E?-8*g:0,q=0}else{const F=45*g,Y=160*g,ce=bn*g/2,Z=window.innerWidth/2-Y-ce,pe=window.innerWidth-340*g-Y,we=(M-1)*F+bn*g;let Ze=F;we>pe&&(Ze=(pe-bn*g)/Math.max(1,M-1)),$=Z-(M-1-E)*Ze,z=0,q=(E-(M-1)/2)*3}const U=le.pp>=p.cost&&y.activePlayerId===v;return a.jsx("div",{onMouseDown:F=>{jm(F,E),rs&&ae(E===Ee?null:E)},onTouchStart:F=>{jm(F,E),rs&&ae(E===Ee?null:E)},style:{position:"absolute",left:"50%",bottom:5*g,transform:`translateX(calc(-50% + ${$}px)) translateY(${z}px) rotate(${q}deg) ${(ee==null?void 0:ee.sourceType)==="HAND"&&ee.sourceIndex===E?"scale(1.05) translateY(-10px)":rs?"translateY(-3px)":""}`,transition:w2===E?"all 0.3s ease-in":(ee==null?void 0:ee.sourceType)==="HAND"&&ee.sourceIndex===E?"none":"all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1)",zIndex:(ee==null?void 0:ee.sourceType)==="HAND"&&ee.sourceIndex===E?1e3:E+100,width:(G?80:bn)*g,height:(G?115:Nn)*g,pointerEvents:"auto",cursor:U?"grab":"not-allowed"},onClick:F=>F.stopPropagation(),children:a.jsx(Co,{card:p,turnCount:y.turnCount,isMyTurn:y.activePlayerId===v,isPlayable:U,scale:g,variant:G?"mobile-hand":"normal",style:{width:G?80*g:bn*g,height:G?115*g:Nn*g,boxShadow:(ee==null?void 0:ee.sourceType)==="HAND"&&ee.sourceIndex===E?"0 0 40px rgba(49, 130, 206, 0.8)":U?"0 0 15px rgba(40, 180, 100, 0.6)":"none"}})},p.instanceId)})}),G&&a.jsxs("div",{style:{position:"absolute",bottom:200*g,left:15*g,display:"flex",alignItems:"center",gap:10*g,zIndex:601,pointerEvents:"none"},children:[a.jsxs("div",{style:{position:"relative",width:50*g,height:62*g},children:[a.jsx("div",{style:{position:"absolute",inset:0,background:"#4a5568",borderRadius:6*g,border:"1px solid #718096",transform:"rotate(-15deg) translate(-5px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#2d3748",borderRadius:6*g,border:"1px solid #718096",transform:"rotate(-5deg) translate(-2px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#1a202c",borderRadius:6*g,border:"1px solid #cbd5e0",transform:"rotate(5deg)"}})]}),a.jsxs("div",{style:{background:"rgba(0,0,0,0.7)",padding:`${6*g}px ${16*g}px`,borderRadius:10*g,color:"#e2e8f0",fontSize:`${1.32*g}rem`,fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5)"},children:[" ",le.hand.length]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6*g,marginLeft:10*g},children:[a.jsx("div",{style:{fontSize:`${1.87*g}rem`,filter:"drop-shadow(0 0 3px rgba(128, 90, 213, 0.8))"},children:""}),a.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(128, 90, 213, 0.8), rgba(76, 29, 149, 0.9))",padding:`${6*g}px ${16*g}px`,borderRadius:10*g,color:"#e2e8f0",fontSize:`${1.32*g}rem`,fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5), inset 0 1px rgba(255,255,255,0.1)",border:"1px solid rgba(167, 139, 250, 0.5)",position:"relative"},children:[" ",le.graveyard.length,lo.filter(p=>p.playerId===v).map(p=>a.jsxs("div",{style:{position:"absolute",top:-30,left:"50%",transform:"translateX(-50%)",color:"#d946ef",fontSize:"1.5rem",fontWeight:"bold",textShadow:"0 0 10px #d946ef, 0 0 20px #a855f7, 0 0 30px #7c3aed",animation:"necromanceFloat 1.5s ease-out forwards",pointerEvents:"none",whiteSpace:"nowrap"},children:["-",p.amount]},p.key))]})]})]}),G&&Ye&&Ye.owner==="PLAYER"&&Ye.source==="HAND"&&rs&&(()=>{const p=Math.max(140,180*g),E=4*g,w=(p-E)/2,M=le.pp>=Ye.card.cost;return a.jsxs("div",{style:{position:"absolute",left:15*g,bottom:135*g,zIndex:600,pointerEvents:"auto"},children:[a.jsxs("button",{disabled:!M,onClick:$=>{$.stopPropagation(),Hm()},className:M?"play-button-active":"",style:{width:w,background:M?"linear-gradient(to bottom, #48bb78, #38a169)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:`${5*g}px ${3*g}px`,borderRadius:10*g,fontSize:`${.7*g}rem`,fontWeight:"bold",cursor:M?"pointer":"not-allowed",boxShadow:M?"0 0 12px rgba(72, 187, 120, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},onMouseDown:$=>$.stopPropagation(),children:["",a.jsxs("div",{style:{fontSize:`${.5*g}rem`,opacity:.8,marginTop:1},children:["pp ",Ye.card.cost]})]}),a.jsx("style",{children:`
                                @keyframes playGlowPulse {
                                    0% { box-shadow: 0 0 10px rgba(72, 187, 120, 0.4); }
                                    50% { box-shadow: 0 0 25px rgba(72, 187, 120, 0.8); }
                                    100% { box-shadow: 0 0 10px rgba(72, 187, 120, 0.4); }
                                }
                                .play-button-active {
                                    animation: playGlowPulse 2s infinite ease-in-out;
                                }
                            `})]})})(),G&&Ye&&Ye.owner==="PLAYER"&&Ye.source==="BOARD"&&(()=>{const p=Math.max(140,180*g),E=4*g,w=(p-E)/2,M=Ye.card,$=M==null?void 0:M.hasEvolved,z=!$&&Ps,q=!$&&Os,U=M==null?void 0:M.instanceId,F=le.board.findIndex(Z=>Z&&Z.instanceId===U),Y=le.board.slice(0,F+1).filter(Z=>Z).length-1,ce=Z=>{F<0||Gc(Y>=0?Y:F,Z,void 0,U)};return a.jsxs("div",{style:{position:"absolute",left:15*g,bottom:135*g,zIndex:600,pointerEvents:"auto",display:"flex",gap:E},onMouseDown:Z=>Z.stopPropagation(),children:[a.jsxs("button",{disabled:!z,onClick:Z=>{Z.stopPropagation(),ce(!1)},style:{width:w,background:z?"linear-gradient(to bottom, #faf089, #d69e2e)":"#718096",color:z?"#1a202c":"white",border:"2px solid rgba(255,255,255,0.2)",padding:`${5*g}px ${3*g}px`,borderRadius:10*g,fontSize:`${.7*g}rem`,fontWeight:"bold",cursor:z?"pointer":"not-allowed",boxShadow:z?"0 0 12px rgba(250, 240, 137, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:z?"0 1px 1px rgba(255,255,255,0.3)":"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",a.jsx("div",{style:{fontSize:`${.5*g}rem`,opacity:.8,marginTop:1},children:"EP"})]}),a.jsxs("button",{disabled:!q,onClick:Z=>{Z.stopPropagation(),ce(!0)},style:{width:w,background:q?"linear-gradient(to bottom, #b794f4, #805ad5)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:`${5*g}px ${3*g}px`,borderRadius:10*g,fontSize:`${.7*g}rem`,fontWeight:"bold",cursor:q?"pointer":"not-allowed",boxShadow:q?"0 0 12px rgba(183, 148, 244, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",a.jsx("div",{style:{fontSize:`${.5*g}rem`,opacity:.8,marginTop:1},children:"SEP"})]})]})})(),Ts&&Array.from({length:Ts.count},(p,E)=>{const q=-(Ts.count*80+(Ts.count-1)*20-80)/2+E*100,U=Ts.isPlayer?Ci((le==null?void 0:le.class)||"SENKA"):Ci((Ne==null?void 0:Ne.class)||"SENKA");return a.jsx("div",{style:{position:"absolute",left:Ts.isPlayer?"calc(100% - 90px)":90,top:Ts.isPlayer?"calc(100% - 105px)":105,width:80,height:110,borderRadius:8,border:"2px solid white",overflow:"hidden",transform:`translateX(${q}px)`,animation:`drawCard${Ts.isPlayer?"Player":"Opponent"} ${Mf}ms cubic-bezier(0.2, 0.8, 0.2, 1) forwards`,zIndex:9e3+E,boxShadow:"0 0 10px rgba(255,255,255,0.5)"},children:a.jsx("img",{src:U,alt:"Card Back",style:{width:"100%",height:"100%",objectFit:"cover"},onError:F=>{F.target.style.display="none",F.target.parentElement.style.background="repeating-linear-gradient(45deg, #2d3748, #2d3748 10px, #1a202c 10px, #1a202c 20px)"}})},E)}),a.jsx("style",{children:`
                        @keyframes drawCardPlayer {
                            0% { opacity: 1; }
                            100% { transform: translate(-50vw, -100px) scale(0.5) rotate(-10deg); opacity: 0; }
                        }
                        @keyframes drawCardOpponent {
                            0% { opacity: 1; }
                            100% { transform: translate(50vw, 200px) scale(0.5) rotate(10deg); opacity: 0; }
                        }
                    `})]}),P2.map(p=>a.jsx(EM,{value:p.value,x:p.x,y:p.y,color:p.color,scale:g,onComplete:()=>Bc(E=>E.filter(w=>w.id!==p.id))},p.id)),co&&er.current&&(()=>{const p=er.current.x,E=er.current.y,w=200,M=320,z=180/8,q=(U,F,Y,ce)=>{const Z=U*Math.PI/180,pe=F*Math.PI/180,we=Math.cos(Z)*ce,Ze=-Math.sin(Z)*ce,Ie=Math.cos(pe)*ce,ze=-Math.sin(pe)*ce,He=Math.cos(pe)*Y,We=-Math.sin(pe)*Y,Ge=Math.cos(Z)*Y,_e=-Math.sin(Z)*Y;return`M ${we} ${Ze} A ${ce} ${ce} 0 0 0 ${Ie} ${ze} L ${He} ${We} A ${Y} ${Y} 0 0 1 ${Ge} ${_e} Z`};return a.jsxs("div",{style:{position:"fixed",left:p,top:E,zIndex:2e3,pointerEvents:"none",animation:"stampUIFadeIn 0.15s ease-out"},children:[a.jsx("svg",{width:M*2+20,height:M+20,style:{position:"absolute",left:-330,top:-330,overflow:"visible"},children:a.jsx("g",{transform:`translate(${M+10}, ${M+10})`,children:m0.map((U,F)=>{const Y=180-F*z,ce=Y-z,Z=uo===U.id,we=(Y+ce)/2*Math.PI/180,Ze=(w+M)/2,Ie=Math.cos(we)*Ze,ze=-Math.sin(we)*Ze,He=85;return a.jsxs("g",{children:[a.jsx("path",{d:q(Y,ce,w,M),fill:Z?"rgba(255, 215, 0, 0.4)":"rgba(0, 0, 0, 0.7)",stroke:Z?"#ffd700":"rgba(255, 255, 255, 0.3)",strokeWidth:Z?3:1,style:{transition:"all 0.1s ease-out"}}),a.jsx("defs",{children:a.jsx("clipPath",{id:`stampClip-${U.id}`,children:a.jsx("circle",{cx:Ie,cy:ze,r:He/2})})}),a.jsx("image",{href:ot(mv(U.id,yn)),x:Ie-He/2,y:ze-He/2,width:He,height:He,clipPath:`url(#stampClip-${U.id})`,style:{transform:Z?"scale(1.15)":"scale(1)",transformOrigin:`${Ie}px ${ze}px`,transition:"transform 0.1s ease-out"}}),a.jsx("circle",{cx:Ie,cy:ze,r:He/2,fill:"none",stroke:Z?"#ffd700":"rgba(255, 255, 255, 0.5)",strokeWidth:Z?2:1})]},U.id)})})}),a.jsx("style",{children:`
                                @keyframes stampUIFadeIn {
                                    from { opacity: 0; transform: scale(0.8); }
                                    to { opacity: 1; transform: scale(1); }
                                }
                            `})]})})(),wi&&a.jsxs("div",{style:{position:"fixed",left:"50%",top:"40%",transform:"translate(-50%, -50%)",zIndex:2500,pointerEvents:"none",animation:"stampDisplay 3s ease-out forwards"},children:[a.jsx("div",{style:{width:250,height:250,borderRadius:20,overflow:"hidden",boxShadow:"0 0 40px rgba(0,0,0,0.5), 0 0 60px rgba(255,255,255,0.2)",border:"4px solid rgba(255,255,255,0.3)"},children:a.jsx("img",{src:ot(mv(wi.stampId,wi.playerClass)),alt:"",style:{width:"100%",height:"100%",objectFit:"cover"}})}),wi.playerId!==v&&a.jsx("div",{style:{position:"absolute",bottom:-30,left:"50%",transform:"translateX(-50%)",background:"rgba(0,0,0,0.7)",padding:"5px 15px",borderRadius:15,color:"#fff",fontSize:"0.9rem",whiteSpace:"nowrap"},children:""}),a.jsx("style",{children:`
                            @keyframes stampDisplay {
                                0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
                                10% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
                                20% { transform: translate(-50%, -50%) scale(1); }
                                80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                                100% { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
                            }
                        `})]},wi.timestamp),a.jsx("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:1e3},children:ee&&(ee.sourceType==="BOARD"||ee.sourceType==="EVOLVE")&&a.jsxs(a.Fragment,{children:[a.jsxs("defs",{children:[a.jsxs("filter",{id:"cyanGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{stdDeviation:"10",result:"blur1"}),a.jsx("feFlood",{floodColor:"rgba(100, 200, 255, 0.7)",result:"color1"}),a.jsx("feComposite",{in:"color1",in2:"blur1",operator:"in",result:"glow1"}),a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"5",result:"blur2"}),a.jsx("feFlood",{floodColor:"rgba(150, 220, 255, 0.5)",result:"color2"}),a.jsx("feComposite",{in:"color2",in2:"blur2",operator:"in",result:"glow2"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"glow1"}),a.jsx("feMergeNode",{in:"glow2"})]})]}),a.jsxs("filter",{id:"yellowGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{stdDeviation:"10",result:"blur1"}),a.jsx("feFlood",{floodColor:"rgba(255, 255, 50, 0.7)",result:"color1"}),a.jsx("feComposite",{in:"color1",in2:"blur1",operator:"in",result:"glow1"}),a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"5",result:"blur2"}),a.jsx("feFlood",{floodColor:"rgba(255, 240, 100, 0.5)",result:"color2"}),a.jsx("feComposite",{in:"color2",in2:"blur2",operator:"in",result:"glow2"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"glow1"}),a.jsx("feMergeNode",{in:"glow2"})]})]}),a.jsxs("filter",{id:"softWhiteGlow",x:"-300%",y:"-300%",width:"700%",height:"700%",children:[a.jsx("feGaussianBlur",{stdDeviation:"20",result:"blur"}),a.jsx("feFlood",{floodColor:"rgba(255, 255, 255, 0.9)",result:"color"}),a.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"glow"}),a.jsx("feMergeNode",{in:"glow"}),a.jsx("feMergeNode",{in:"glow"})]})]}),a.jsxs("filter",{id:"innerCoreGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{stdDeviation:"4",result:"blur"}),a.jsx("feFlood",{floodColor:"rgba(255, 255, 255, 0.8)",result:"color"}),a.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),a.jsx("feMerge",{children:a.jsx("feMergeNode",{in:"glow"})})]}),a.jsxs("filter",{id:"coloredBallGlow",x:"-150%",y:"-150%",width:"400%",height:"400%",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"6",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"blur"})]})]}),a.jsxs("filter",{id:"particleGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"2",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),a.jsxs("filter",{id:"purpleGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{stdDeviation:"10",result:"blur1"}),a.jsx("feFlood",{floodColor:"rgba(183, 148, 244, 0.7)",result:"color1"}),a.jsx("feComposite",{in:"color1",in2:"blur1",operator:"in",result:"glow1"}),a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"5",result:"blur2"}),a.jsx("feFlood",{floodColor:"rgba(200, 170, 255, 0.5)",result:"color2"}),a.jsx("feComposite",{in:"color2",in2:"blur2",operator:"in",result:"glow2"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"glow1"}),a.jsx("feMergeNode",{in:"glow2"})]})]})]}),ee.sourceType==="BOARD"&&a.jsxs(a.Fragment,{children:[a.jsx("path",{d:As(),fill:"none",stroke:"rgba(100, 200, 255, 0.3)",strokeWidth:"20",strokeLinecap:"butt",filter:"url(#cyanGlow)"}),a.jsx("path",{d:As(),fill:"none",stroke:"rgba(150, 220, 255, 0.5)",strokeWidth:"10",strokeLinecap:"butt"}),a.jsx("path",{d:As(),fill:"none",stroke:"rgba(200, 240, 255, 0.9)",strokeWidth:"4",strokeLinecap:"butt"}),a.jsx("path",{d:As(),fill:"none",stroke:"rgba(255, 255, 255, 1)",strokeWidth:"2",strokeLinecap:"butt"})]}),ee.sourceType==="EVOLVE"&&a.jsxs(a.Fragment,{children:[a.jsx("path",{d:As(),fill:"none",stroke:ee.useSep?"rgba(159, 122, 234, 0.3)":"rgba(236, 201, 75, 0.3)",strokeWidth:"20",strokeLinecap:"butt",filter:ee.useSep?"url(#purpleGlow)":"url(#yellowGlow)"}),a.jsx("path",{d:As(),fill:"none",stroke:ee.useSep?"rgba(183, 148, 244, 0.5)":"rgba(246, 224, 94, 0.5)",strokeWidth:"10",strokeLinecap:"butt"}),a.jsx("path",{d:As(),fill:"none",stroke:ee.useSep?"rgba(214, 188, 250, 0.9)":"rgba(250, 240, 137, 0.9)",strokeWidth:"4",strokeLinecap:"butt"}),a.jsx("path",{d:As(),fill:"none",stroke:"rgba(255, 255, 255, 1)",strokeWidth:"2",strokeLinecap:"butt"})]}),(ee.sourceType==="BOARD"||ee.sourceType==="EVOLVE")&&a.jsxs(a.Fragment,{children:[a.jsx("circle",{cx:ee.startX,cy:ee.startY,r:"15",fill:"rgba(255, 255, 255, 0.3)",filter:"url(#softWhiteGlow)"}),a.jsx("circle",{cx:ee.startX,cy:ee.startY,r:"8",fill:"rgba(255, 255, 255, 0.4)",filter:"url(#softWhiteGlow)"})]}),(ee.sourceType==="BOARD"||ee.sourceType==="EVOLVE")&&a.jsxs(a.Fragment,{children:[a.jsx("circle",{cx:ee.currentX,cy:ee.currentY,r:"18",fill:"rgba(255, 255, 255, 0.25)",filter:"url(#softWhiteGlow)"}),a.jsx("circle",{cx:ee.currentX,cy:ee.currentY,r:"8",fill:"rgba(255, 255, 255, 0.35)",filter:"url(#softWhiteGlow)"}),a.jsx("circle",{cx:ee.currentX,cy:ee.currentY,r:"3",fill:"rgba(255, 255, 255, 0.7)",filter:"url(#innerCoreGlow)"})]}),E2.map(p=>{const E=ee.sourceType==="EVOLVE"?ee.useSep?`rgba(230, 220, 255, ${p.opacity})`:`rgba(255, 255, 230, ${p.opacity})`:`rgba(220, 245, 255, ${p.opacity})`;return a.jsx("circle",{cx:p.x,cy:p.y,r:p.radius,fill:E,filter:"url(#particleGlow)"},p.id)})]})}),on&&a.jsxs("svg",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100dvh",pointerEvents:"none",zIndex:99999},children:[a.jsx("defs",{children:a.jsxs("filter",{id:"endTurnGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{stdDeviation:"6",result:"blur"}),a.jsx("feFlood",{floodColor:"rgba(100, 200, 255, 0.8)",result:"color"}),a.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"glow"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsx("circle",{cx:on.x,cy:on.y,r:on.ringRadius,fill:"none",stroke:`rgba(100, 200, 255, ${Math.max(0,1-on.ringRadius/120)*.8})`,strokeWidth:"4",filter:"url(#endTurnGlow)"}),a.jsx("circle",{cx:on.x,cy:on.y,r:on.ringRadius*.8,fill:"none",stroke:`rgba(255, 255, 255, ${Math.max(0,1-on.ringRadius/120)*.6})`,strokeWidth:"2"}),a.jsx("circle",{cx:on.x,cy:on.y,r:20,fill:`rgba(255, 255, 255, ${Math.max(0,1-on.ringRadius/120)*.9})`}),on.particles.map(p=>a.jsx("circle",{cx:p.x,cy:p.y,r:4,fill:`rgba(255, 255, 255, ${p.opacity*.8})`},p.id))]}),rt&&a.jsxs("div",{style:{position:"absolute",inset:0,zIndex:9999,pointerEvents:"auto",background:"rgba(0,0,0,0.5)",perspective:"1200px"},children:[a.jsx("style",{children:`
                                @keyframes playCardSequence {
                                    ${rt.finalX!==void 0?`
                                    /* Phase 1: Start at hand position (0%) */
                                    0% {
                                        transform: translate(${rt.startX-rt.targetX}px, ${rt.startY-rt.targetY}px) translate(-50%, -50%) scale(1.0) rotateY(0deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Phase 1b: Mid-rotation during move (12.5%) - CRITICAL: explicit 180deg to force rotation direction */
                                    12.5% {
                                        transform: translate(${(rt.startX-rt.targetX)*.5}px, ${(rt.startY-rt.targetY)*.5}px) translate(-50%, -50%) scale(1.5) rotateY(180deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Phase 2: Arrive at center with rotation complete (25%) */
                                    25% {
                                        transform: translate(-50%, -50%) scale(1.8) rotateY(360deg);
                                        opacity: 1;
                                        animation-timing-function: ease-out;
                                    }
                                    /* Phase 3: Hold at center (25%-80%) */
                                    80% {
                                        transform: translate(-50%, -50%) scale(2.4) rotateY(360deg);
                                        opacity: 1;
                                    }
                                    /* Phase 4: Move to board position (80%-100%) */
                                    100% {
                                        transform: translate(calc(-50% + ${rt.finalX-rt.targetX}px), calc(-50% + ${rt.finalY-rt.targetY}px)) scale(1.0) rotateY(360deg);
                                        opacity: 1;
                                    }
                                    `:`
                                    /* Spell: Move to center while rotating, then fade */
                                    0% {
                                        transform: translate(${rt.startX-rt.targetX}px, ${rt.startY-rt.targetY}px) translate(-50%, -50%) scale(1.0) rotateY(0deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Mid-rotation during move (15%) - CRITICAL: explicit 180deg */
                                    15% {
                                        transform: translate(${(rt.startX-rt.targetX)*.5}px, ${(rt.startY-rt.targetY)*.5}px) translate(-50%, -50%) scale(1.7) rotateY(180deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    30% {
                                        transform: translate(-50%, -50%) scale(2.2) rotateY(360deg);
                                        opacity: 1;
                                        animation-timing-function: ease-out;
                                    }
                                    80% {
                                        transform: translate(-50%, -50%) scale(2.4) rotateY(360deg);
                                        opacity: 1;
                                    }
                                    100% {
                                        transform: translate(-50%, -50%) scale(3.0) rotateY(360deg);
                                        opacity: 0;
                                    }
                                    `}
                                }
                                @keyframes playSpellSequence {
                                    /* Move from hand to center while rotating (0-30%) */
                                    0% {
                                        transform: translate(${rt.startX-rt.targetX}px, ${rt.startY-rt.targetY}px) translate(-50%, -50%) scale(1.0) rotateY(0deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Mid-rotation during move (15%) - CRITICAL: explicit 180deg to force rotation direction */
                                    15% {
                                        transform: translate(${(rt.startX-rt.targetX)*.5}px, ${(rt.startY-rt.targetY)*.5}px) translate(-50%, -50%) scale(1.7) rotateY(180deg);
                                        opacity: 1;
                                        filter: brightness(1);
                                        animation-timing-function: linear;
                                    }
                                    /* Arrive at center with rotation complete (30%) */
                                    30% {
                                        transform: translate(-50%, -50%) scale(2.2) rotateY(360deg);
                                        opacity: 1;
                                        filter: brightness(1);
                                        animation-timing-function: ease-out;
                                    }
                                    /* Hold at center (30%-75%) */
                                    75% {
                                        transform: translate(-50%, -50%) scale(2.4) rotateY(360deg);
                                        opacity: 1;
                                        filter: brightness(1.2);
                                    }
                                    /* Fade out (75%-100%) */
                                    100% {
                                        transform: translate(-50%, -50%) scale(3.0) rotateY(360deg);
                                        opacity: 0;
                                        filter: brightness(3);
                                    }
                                }
                                .play-card-flipper {
                                    transform-style: preserve-3d !important;
                                }
                                .play-card-front, .play-card-back {
                                    backface-visibility: hidden !important;
                                    -webkit-backface-visibility: hidden !important;
                                    position: absolute;
                                    width: 100%;
                                    height: 100%;
                                }
                                .play-card-back {
                                    transform: rotateY(180deg) translateZ(1px);
                                }
                            `}),a.jsxs("div",{className:"play-card-flipper",onAnimationEnd:rt.onComplete,style:{position:"absolute",left:rt.targetX,top:rt.targetY,width:bn*g,height:Nn*g,transformStyle:"preserve-3d",animation:rt.card.type==="SPELL"?"playSpellSequence 1s forwards":"playCardSequence 0.8s forwards"},children:[a.jsx("div",{className:"play-card-front",children:a.jsx(Co,{card:rt.card,isOnBoard:!0,suppressPassives:!0,scale:g,style:{width:bn*g,height:Nn*g,boxShadow:"0 0 50px rgba(255,215,0,0.8)"}})}),a.jsx("div",{className:"play-card-back",style:{borderRadius:12,boxShadow:"0 0 50px rgba(255,215,0,0.8)",overflow:"hidden"},children:a.jsx("img",{src:Ci(rt.playerClass),alt:"Card Sleeve",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:12},onError:p=>{const E=p.target;E.style.display="none",E.parentElement&&(E.parentElement.style.background="linear-gradient(135deg, #1e3a5f 0%, #0d1b2a 50%, #1e3a5f 100%)")}})}),rt.card.type==="SPELL"&&a.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none"},children:a.jsx(SM,{x:0,y:0})})]})]}),go.length>0&&go.map((p,E)=>a.jsx("div",{style:{position:"absolute",left:p.status==="FLY"&&p.targetX!==void 0?p.targetX:window.innerWidth/2+p.xOffset,top:p.status==="FLY"&&p.targetY!==void 0?p.targetY:window.innerHeight/2,transform:p.status==="APPEAR"?"translate(-50%, -50%) scale(1.2)":"translate(-50%, -50%) scale(0.2)",zIndex:7e3+E,pointerEvents:"none",transition:p.status==="FLY"?"all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)":"none",opacity:p.status==="FLY"?.3:1,animation:p.status==="APPEAR"?"cardAppear 0.8s ease-out":void 0},children:a.jsx(Co,{card:p.card,scale:g,style:{width:bn*g,height:Nn*g}})},E)),a.jsx("style",{children:`
                    @keyframes cardAppear {
                        0% { transform: translate(-50%, -50%) scale(0) rotate(-10deg); opacity: 0; }
                        50% { transform: translate(-50%, -50%) scale(1.3) rotate(5deg); opacity: 1; }
                        100% { transform: translate(-50%, -50%) scale(1.2) rotate(0deg); opacity: 1; }
                    }
                `}),$c.map(p=>p.type==="BUFF"?a.jsx(xM,{x:p.x,y:p.y,atkBuff:p.atkBuff??0,hpBuff:p.hpBuff??0,onComplete:()=>mo(E=>E.filter(w=>w.key!==p.key))},p.key):a.jsx(bM,{type:p.type,x:p.x,y:p.y,onComplete:()=>mo(E=>E.filter(w=>w.key!==p.key)),audioSettings:jt,scale:g},p.key)),Gt&&a.jsx(TM,{card:Gt.card,evolvedImageUrl:Gt.evolvedImageUrl,startX:Gt.startX,startY:Gt.startY,phase:Gt.phase,onPhaseChange:L2,onShake:tr,useSep:Gt.useSep,playSE:Tt,scale:g,isLightMode:W}),vn&&a.jsxs("div",{style:{position:"fixed",top:"45%",left:`${340*g}px`,width:`calc(100% - ${340*g}px)`,display:"flex",justifyContent:"center",alignItems:"center",transform:"translateY(-50%)",zIndex:9e3,pointerEvents:"none",animation:"notificationFade 2.5s forwards"},children:[a.jsx("div",{style:{padding:`${20*g}px ${90*g}px`,background:"rgba(0, 0, 0, 0.75)",backdropFilter:"blur(16px)",borderTop:`${3*g}px solid ${vn==="EVOLVE_READY"?"rgba(255, 215, 0, 0.7)":"rgba(180, 0, 255, 0.7)"}`,borderBottom:`${3*g}px solid ${vn==="EVOLVE_READY"?"rgba(255, 215, 0, 0.7)":"rgba(180, 0, 255, 0.7)"}`,boxShadow:vn==="EVOLVE_READY"?`0 0 ${50*g}px rgba(255, 180, 0, 0.5), inset 0 0 ${30*g}px rgba(255, 215, 0, 0.2)`:`0 0 ${50*g}px rgba(180, 0, 255, 0.5), inset 0 0 ${30*g}px rgba(180, 0, 255, 0.2)`,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",borderRadius:`${4*g}px`},children:a.jsx("span",{style:{fontSize:`${5*g}rem`,fontWeight:"900",fontFamily:'"YuMincho", "Hiragino Mincho ProN", "MS Mincho", serif',color:"#fff",letterSpacing:`${.8*g}rem`,whiteSpace:"nowrap",textShadow:vn==="EVOLVE_READY"?`0 0 ${15*g}px rgba(255, 215, 0, 1), 0 0 ${30*g}px rgba(255, 180, 0, 0.8), ${2*g}px ${2*g}px ${4*g}px rgba(0,0,0,0.9)`:`0 0 ${15*g}px rgba(180, 0, 255, 1), 0 0 ${30*g}px rgba(140, 0, 255, 0.8), ${2*g}px ${2*g}px ${4*g}px rgba(0,0,0,0.9)`,WebkitTextStroke:vn==="EVOLVE_READY"?`${1.5*g}px #ffd700`:`${1.5*g}px #b400ff`},children:vn==="EVOLVE_READY"?"":""})}),a.jsx("style",{children:`
                            @keyframes notificationFade {
                                0% { opacity: 0; transform: translateY(-40%) scale(0.8); filter: blur(15px); }
                                10% { opacity: 1; transform: translateY(-50%) scale(1); filter: blur(0px); }
                                90% { opacity: 1; transform: translateY(-50%) scale(1); filter: blur(0px); }
                                100% { opacity: 0; transform: translateY(-60%) scale(1.15); filter: blur(20px); }
                            }
                        `})]}),tt&&y.winnerId&&a.jsx(aM,{isVictory:y.winnerId===v,loserLeaderRef:y.winnerId===v?vo:Ti,onComplete:()=>{Ae(!1),Pt(!0),Ot(null),ct(0),(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&m&&(console.log("[GameScreen] Disconnecting after game over (casual match)"),m.disconnect())},onPhaseChange:Ot,onShakeIntensityChange:ct,scale:g}),y.winnerId&&Ue&&a.jsx(LM,{winnerId:y.winnerId,playerId:v,playerClass:(le==null?void 0:le.class)||"SENKA",isOnline:e==="ONLINE",isRoomMatch:n==="HOST"||n==="JOIN",myRematchRequested:es,opponentRematchRequested:Cn,battleStats:{turnCount:y.turnCount,damageDealtToOpponent:Ss.damageDealtToOpponent,damageReceivedFromOpponent:Ss.damageReceivedFromOpponent,followersDestroyed:Ss.followersDestroyed,myFollowersDestroyed:Ss.myFollowersDestroyed},selectedCardInfo:S,onCardInfoClick:Aa,victoryReason:Cf,isRankedMatch:n==="RANKED_MATCH",ratingResult:kf,onRematching:i,scale:g,onRematch:p=>{e==="ONLINE"?(Zn(!0),Cn?(m==null||m.send({type:"REMATCH_ACCEPT"}),Bf(p)):(m==null||m.send({type:"REMATCH_REQUEST"}),Ra(p))):Bf(p)},onLeave:s})]})]})},DM=async()=>(await zP(kc)).user,NM=async(t,e)=>(await XP(kc,t,e)).user,$M=async(t,e)=>{const n=kc.currentUser;if(!n)throw new Error("No user logged in");const r=so.credential(t,e);return(await YP(n,r)).user},jM=async()=>{await ZP(kc)},FM=t=>qP(kc,t),qx=1280,Zx=720,UM=({onRegisterSuccess:t,onBack:e})=>{const[n,r]=P.useState(""),[s,i]=P.useState(""),[o,l]=P.useState(""),[c,d]=P.useState(""),[u,h]=P.useState(!1),[f,b]=P.useState(1);P.useEffect(()=>{const m=()=>{const T=window.innerWidth/qx,L=window.innerHeight/Zx;b(Math.min(T,L))};return m(),window.addEventListener("resize",m),()=>window.removeEventListener("resize",m)},[]);const C=m=>/^[a-zA-Z0-9_]{3,20}$/.test(m),k=m=>`${m}@tenfubu-game.local`,A=async()=>{if(d(""),!n||!s||!o){d("");return}if(!C(n)){d("ID3-20");return}if(s.length<6){d("6");return}if(s!==o){d("");return}h(!0);try{const m=k(n);await $M(m,s),t()}catch(m){console.error("Registration error:",m),console.error("Error code:",m==null?void 0:m.code),console.error("Error message:",m==null?void 0:m.message);const T=(m==null?void 0:m.code)||"";d(T==="auth/email-already-in-use"?"ID":T==="auth/invalid-email"?"ID":T==="auth/weak-password"?"6":T==="auth/requires-recent-login"?"":T==="auth/provider-already-linked"?"ID":T==="auth/credential-already-in-use"?"ID":` (${T||"unknown error"})`)}finally{h(!1)}},R=m=>{m.key==="Enter"&&!u&&A()};return a.jsx("div",{style:{width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",overflow:"hidden"},children:a.jsxs("div",{style:{width:qx*f,height:Zx*f,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative"},children:[a.jsx("h1",{style:{fontSize:48*f,fontWeight:"bold",color:"#fff",marginBottom:40*f,textShadow:"0 4px 8px rgba(0,0,0,0.5)"},children:""}),a.jsxs("form",{onSubmit:m=>{m.preventDefault(),A()},style:{width:400*f,display:"flex",flexDirection:"column",gap:20*f},children:[a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*f,color:"#fff",marginBottom:8*f,fontWeight:"bold"},children:"ID"}),a.jsx("input",{type:"text",name:"username",value:n,onChange:m=>r(m.target.value),onKeyPress:R,placeholder:"player123",disabled:u,autoComplete:"username",maxLength:20,style:{width:"100%",padding:`${12*f}px ${16*f}px`,fontSize:16*f,borderRadius:8*f,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:m=>m.currentTarget.style.borderColor="#4a9eff",onBlur:m=>m.currentTarget.style.borderColor="#444"}),a.jsx("p",{style:{fontSize:12*f,color:"#888",marginTop:4*f,marginBottom:0},children:" _ 320"})]}),a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*f,color:"#fff",marginBottom:8*f,fontWeight:"bold"},children:""}),a.jsx("input",{type:"password",name:"password",value:s,onChange:m=>i(m.target.value),onKeyPress:R,placeholder:"",disabled:u,autoComplete:"new-password",style:{width:"100%",padding:`${12*f}px ${16*f}px`,fontSize:16*f,borderRadius:8*f,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:m=>m.currentTarget.style.borderColor="#4a9eff",onBlur:m=>m.currentTarget.style.borderColor="#444"}),a.jsx("p",{style:{fontSize:12*f,color:"#888",marginTop:4*f,marginBottom:0},children:"6"})]}),a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*f,color:"#fff",marginBottom:8*f,fontWeight:"bold"},children:""}),a.jsx("input",{type:"password",name:"confirm-password",value:o,onChange:m=>l(m.target.value),onKeyPress:R,placeholder:"",disabled:u,autoComplete:"new-password",style:{width:"100%",padding:`${12*f}px ${16*f}px`,fontSize:16*f,borderRadius:8*f,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:m=>m.currentTarget.style.borderColor="#4a9eff",onBlur:m=>m.currentTarget.style.borderColor="#444"}),a.jsx("p",{style:{fontSize:12*f,color:"#888",marginTop:4*f,marginBottom:0},children:""})]}),c&&a.jsx("div",{style:{padding:`${12*f}px ${16*f}px`,borderRadius:8*f,background:"rgba(255, 80, 80, 0.2)",border:"2px solid #ff5050",color:"#ff5050",fontSize:14*f,textAlign:"center"},children:c}),a.jsxs("div",{style:{display:"flex",gap:16*f,marginTop:20*f},children:[a.jsx("button",{onClick:e,disabled:u,style:{flex:1,padding:`${16*f}px ${32*f}px`,fontSize:18*f,fontWeight:"bold",borderRadius:8*f,border:"none",background:"#555",color:"#fff",cursor:u?"not-allowed":"pointer",transition:"all 0.3s",opacity:u?.5:1},onMouseEnter:m=>!u&&(m.currentTarget.style.background="#666"),onMouseLeave:m=>!u&&(m.currentTarget.style.background="#555"),children:""}),a.jsx("button",{onClick:A,disabled:u,style:{flex:1,padding:`${16*f}px ${32*f}px`,fontSize:18*f,fontWeight:"bold",borderRadius:8*f,border:"none",background:u?"#555":"linear-gradient(135deg, #4a9eff 0%, #357abd 100%)",color:"#fff",cursor:u?"not-allowed":"pointer",transition:"all 0.3s",boxShadow:u?"none":"0 4px 8px rgba(0,0,0,0.3)"},onMouseEnter:m=>!u&&(m.currentTarget.style.transform="scale(1.05)"),onMouseLeave:m=>!u&&(m.currentTarget.style.transform="scale(1)"),children:u?"...":""})]}),a.jsxs("div",{style:{marginTop:20*f,padding:`${12*f}px ${16*f}px`,borderRadius:8*f,background:"rgba(74, 158, 255, 0.1)",border:"1px solid rgba(74, 158, 255, 0.3)",fontSize:13*f,color:"#aaa",textAlign:"center",lineHeight:1.6},children:["ID",a.jsx("br",{}),""]})]})]})})},e1=1280,t1=720,BM=({onLoginSuccess:t,onBack:e})=>{const[n,r]=P.useState(""),[s,i]=P.useState(""),[o,l]=P.useState(""),[c,d]=P.useState(!1),[u,h]=P.useState(1);P.useEffect(()=>{const k=()=>{const A=window.innerWidth/e1,R=window.innerHeight/t1;h(Math.min(A,R))};return k(),window.addEventListener("resize",k),()=>window.removeEventListener("resize",k)},[]);const f=k=>`${k}@tenfubu-game.local`,b=async()=>{if(l(""),!n||!s){l("ID");return}d(!0);try{const k=f(n);await NM(k,s),t()}catch(k){const A=(k==null?void 0:k.code)||"";l(A==="auth/user-not-found"?"":A==="auth/wrong-password"?"":A==="auth/invalid-email"?"ID":A==="auth/invalid-credential"?"ID":"")}finally{d(!1)}},C=k=>{k.key==="Enter"&&!c&&b()};return a.jsx("div",{style:{width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",overflow:"hidden"},children:a.jsxs("div",{style:{width:e1*u,height:t1*u,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative"},children:[a.jsx("h1",{style:{fontSize:48*u,fontWeight:"bold",color:"#fff",marginBottom:40*u,textShadow:"0 4px 8px rgba(0,0,0,0.5)"},children:""}),a.jsxs("form",{onSubmit:k=>{k.preventDefault(),b()},style:{width:400*u,display:"flex",flexDirection:"column",gap:20*u},children:[a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*u,color:"#fff",marginBottom:8*u,fontWeight:"bold"},children:"ID"}),a.jsx("input",{type:"text",name:"username",value:n,onChange:k=>r(k.target.value),onKeyPress:C,placeholder:"player123",disabled:c,autoComplete:"username",style:{width:"100%",padding:`${12*u}px ${16*u}px`,fontSize:16*u,borderRadius:8*u,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:k=>k.currentTarget.style.borderColor="#4a9eff",onBlur:k=>k.currentTarget.style.borderColor="#444"})]}),a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*u,color:"#fff",marginBottom:8*u,fontWeight:"bold"},children:""}),a.jsx("input",{type:"password",name:"password",value:s,onChange:k=>i(k.target.value),onKeyPress:C,placeholder:"",disabled:c,autoComplete:"current-password",style:{width:"100%",padding:`${12*u}px ${16*u}px`,fontSize:16*u,borderRadius:8*u,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:k=>k.currentTarget.style.borderColor="#4a9eff",onBlur:k=>k.currentTarget.style.borderColor="#444"})]}),o&&a.jsx("div",{style:{padding:`${12*u}px ${16*u}px`,borderRadius:8*u,background:"rgba(255, 80, 80, 0.2)",border:"2px solid #ff5050",color:"#ff5050",fontSize:14*u,textAlign:"center"},children:o}),a.jsxs("div",{style:{display:"flex",gap:16*u,marginTop:20*u},children:[a.jsx("button",{onClick:e,disabled:c,style:{flex:1,padding:`${16*u}px ${32*u}px`,fontSize:18*u,fontWeight:"bold",borderRadius:8*u,border:"none",background:"#555",color:"#fff",cursor:c?"not-allowed":"pointer",transition:"all 0.3s",opacity:c?.5:1},onMouseEnter:k=>!c&&(k.currentTarget.style.background="#666"),onMouseLeave:k=>!c&&(k.currentTarget.style.background="#555"),children:""}),a.jsx("button",{onClick:b,disabled:c,style:{flex:1,padding:`${16*u}px ${32*u}px`,fontSize:18*u,fontWeight:"bold",borderRadius:8*u,border:"none",background:c?"#555":"linear-gradient(135deg, #4a9eff 0%, #357abd 100%)",color:"#fff",cursor:c?"not-allowed":"pointer",transition:"all 0.3s",boxShadow:c?"none":"0 4px 8px rgba(0,0,0,0.3)"},onMouseEnter:k=>!c&&(k.currentTarget.style.transform="scale(1.05)"),onMouseLeave:k=>!c&&(k.currentTarget.style.transform="scale(1)"),children:c?"...":""})]}),a.jsx("div",{style:{marginTop:20*u,padding:`${12*u}px ${16*u}px`,borderRadius:8*u,background:"rgba(255, 200, 80, 0.1)",border:"1px solid rgba(255, 200, 80, 0.3)",fontSize:13*u,color:"#ffcc80",textAlign:"center",lineHeight:1.6},children:" "})]})]})})},n1=1280,r1=720,zM=({playerId:t,currentPlayerName:e,onUpdateSuccess:n,onBack:r})=>{const[s,i]=P.useState(e),[o,l]=P.useState(""),[c,d]=P.useState(!1),[u,h]=P.useState(!1),[f,b]=P.useState(1);P.useEffect(()=>{const A=()=>{const R=window.innerWidth/n1,m=window.innerHeight/r1;b(Math.min(R,m))};return A(),window.addEventListener("resize",A),()=>window.removeEventListener("resize",A)},[]);const C=async()=>{if(l(""),h(!1),!s.trim()){l("");return}if(s.length>20){l("20");return}if(!t){l("ID");return}d(!0);try{await RS(t,s.trim()),h(!0),setTimeout(()=>{n(s.trim())},1e3)}catch(A){console.error("Failed to update player name:",A),l("")}finally{d(!1)}},k=A=>{A.key==="Enter"&&!c&&C()};return a.jsx("div",{style:{width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",overflow:"hidden"},children:a.jsxs("div",{style:{width:n1*f,height:r1*f,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative"},children:[a.jsx("h1",{style:{fontSize:48*f,fontWeight:"bold",color:"#fff",marginBottom:40*f,textShadow:"0 4px 8px rgba(0,0,0,0.5)"},children:""}),a.jsxs("div",{style:{width:400*f,display:"flex",flexDirection:"column",gap:20*f},children:[a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*f,color:"#fff",marginBottom:8*f,fontWeight:"bold"},children:""}),a.jsx("input",{type:"text",value:s,onChange:A=>i(A.target.value),onKeyPress:k,placeholder:"",disabled:c,maxLength:20,style:{width:"100%",padding:`${12*f}px ${16*f}px`,fontSize:16*f,borderRadius:8*f,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:A=>A.currentTarget.style.borderColor="#4a9eff",onBlur:A=>A.currentTarget.style.borderColor="#444"}),a.jsx("p",{style:{fontSize:12*f,color:"#888",marginTop:4*f,marginBottom:0},children:"20"})]}),o&&a.jsx("div",{style:{padding:`${12*f}px ${16*f}px`,borderRadius:8*f,background:"rgba(255, 80, 80, 0.2)",border:"2px solid #ff5050",color:"#ff5050",fontSize:14*f,textAlign:"center"},children:o}),u&&a.jsx("div",{style:{padding:`${12*f}px ${16*f}px`,borderRadius:8*f,background:"rgba(80, 255, 120, 0.2)",border:"2px solid #50ff78",color:"#50ff78",fontSize:14*f,textAlign:"center"},children:" "}),a.jsxs("div",{style:{display:"flex",gap:16*f,marginTop:20*f},children:[a.jsx("button",{onClick:r,disabled:c,style:{flex:1,padding:`${16*f}px ${32*f}px`,fontSize:18*f,fontWeight:"bold",borderRadius:8*f,border:"none",background:"#555",color:"#fff",cursor:c?"not-allowed":"pointer",transition:"all 0.3s",opacity:c?.5:1},onMouseEnter:A=>!c&&(A.currentTarget.style.background="#666"),onMouseLeave:A=>!c&&(A.currentTarget.style.background="#555"),children:""}),a.jsx("button",{onClick:C,disabled:c,style:{flex:1,padding:`${16*f}px ${32*f}px`,fontSize:18*f,fontWeight:"bold",borderRadius:8*f,border:"none",background:c?"#555":"linear-gradient(135deg, #4a9eff 0%, #357abd 100%)",color:"#fff",cursor:c?"not-allowed":"pointer",transition:"all 0.3s",boxShadow:c?"none":"0 4px 8px rgba(0,0,0,0.3)"},onMouseEnter:A=>!c&&(A.currentTarget.style.transform="scale(1.05)"),onMouseLeave:A=>!c&&(A.currentTarget.style.transform="scale(1)"),children:c?"...":""})]})]})]})})},HM=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},WM=HM("/bgm/tenfubu.mp3"),Ed={bgm:.3,se:.5,voice:.5,bgmEnabled:!0,seEnabled:!0},GM=()=>{try{const t=localStorage.getItem("audioSettings");if(t){const e=JSON.parse(t);if(e.enabled!==void 0){const{enabled:n,...r}=e;return{...Ed,...r,bgmEnabled:n,seEnabled:n}}return{...Ed,...e}}return Ed}catch{return Ed}},VM=()=>{const[t,e]=P.useState(!1);return P.useEffect(()=>{const n=()=>{const r="ontouchstart"in window||navigator.maxTouchPoints>0,s=window.innerHeight>window.innerWidth;e(r&&s)};return n(),window.addEventListener("resize",n),window.addEventListener("orientationchange",n),()=>{window.removeEventListener("resize",n),window.removeEventListener("orientationchange",n)}},[]),t};function YM(){const[t,e]=P.useState("TITLE"),[n,r]=P.useState("SENKA"),[s,i]=P.useState("CPU"),[o,l]=P.useState(""),[c,d]=P.useState(void 0),[u,h]=P.useState("NORMAL"),[f,b]=P.useState(null),[C,k]=P.useState(!0),[A,R]=P.useState(null),[m,T]=P.useState(null),[L,g]=P.useState(!0),[H,Q]=P.useState(()=>{const me=localStorage.getItem("timerEnabled");return me!==null?JSON.parse(me):!0}),[W,G]=P.useState(()=>localStorage.getItem("playerName")||""),[de,fe]=P.useState(void 0),[Ee,ae]=P.useState(void 0),[he,be]=P.useState(void 0),[v,_]=P.useState(0),[x,I]=P.useState(!1),y=VM(),O=P.useRef(null),[N,ne]=P.useState(!1),[B,ye]=P.useState(GM),[te,xe]=P.useState(()=>localStorage.getItem("homeCardId")),J=me=>me&&me.endsWith("@tenfubu-game.local")?me.replace("@tenfubu-game.local",""):null;P.useEffect(()=>{const me=FM(async qe=>{if(console.log(" Auth state changed:",{uid:qe==null?void 0:qe.uid,email:qe==null?void 0:qe.email,isAnonymous:qe==null?void 0:qe.isAnonymous}),qe){b(qe.uid),k(qe.isAnonymous),R(qe.email),T(J(qe.email));const Wt=J(qe.email);console.log(" State updated:",{playerId:qe.uid,isAnonymous:qe.isAnonymous,userId:Wt});try{const It=localStorage.getItem("playerName")||"",Zt=await Mx(qe.uid,Wt||"anonymous",It||"");Zt.playerName&&Zt.playerName!==""&&(!It||It==="")&&(G(Zt.playerName),localStorage.setItem("playerName",Zt.playerName))}catch(It){console.error("Failed to create player data:",It)}}else try{const Wt=await DM();b(Wt.uid),k(!0),R(null),T(null);const It=localStorage.getItem("playerName")||"",Zt=await Mx(Wt.uid,"anonymous",It||"");Zt.playerName&&Zt.playerName!==""&&(!It||It==="")&&(G(Zt.playerName),localStorage.setItem("playerName",Zt.playerName))}catch(Wt){console.error("Failed to sign in:",Wt)}g(!1)});return()=>me()},[]),P.useEffect(()=>{localStorage.setItem("audioSettings",JSON.stringify(B))},[B]);const V=P.useCallback(me=>{ye(qe=>({...qe,...me}))},[]),Qe=P.useCallback((me,qe)=>{O.current=me,ne(!0),qe&&d(qe),_(Wt=>Wt+1),e("GAME")},[]),tt=P.useCallback((me,qe,Wt,It,Zt,es)=>{O.current=me,ne(!0),d(qe),fe(It),ae(Zt),be(es),_(Zn=>Zn+1),e("GAME")},[]),Ae=P.useCallback(me=>{O.current&&(O.current.disconnect(),O.current=null),ne(!1),d(void 0),fe(void 0),ae(void 0),r(me),e("MATCHMAKING")},[]),Se=P.useRef(null),Pe=P.useRef(!1);P.useEffect(()=>{const me=new Audio(WM);return me.loop=!0,me.volume=B.bgmEnabled?B.bgm:0,Se.current=me,Pe.current=!0,()=>{me.pause(),me.src=""}},[]),P.useEffect(()=>{const me=Se.current;!me||!Pe.current||(me.volume=B.bgmEnabled?B.bgm:0,B.bgmEnabled?me.paused&&(t==="TITLE"||t==="CLASS_SELECT")&&me.play().catch(()=>{}):me.pause())},[B.bgm,B.bgmEnabled,t]),P.useEffect(()=>{const me=Se.current;me&&(t==="TITLE"||t==="CLASS_SELECT"||t==="LOBBY"?me.paused&&B.bgmEnabled&&me.play().catch(()=>{}):(me.pause(),me.currentTime=0))},[t,B.bgmEnabled]),P.useEffect(()=>{const me=()=>{const qe=Se.current;qe&&qe.paused&&B.bgmEnabled&&(t==="TITLE"||t==="CLASS_SELECT"||t==="LOBBY")&&qe.play().catch(()=>{})};return document.addEventListener("click",me),()=>document.removeEventListener("click",me)},[t,B.bgmEnabled]);const et=P.useCallback((me,qe,Wt,It)=>{i(me),qe&&l(qe),It&&h(It),I(!1),Wt?(r(Wt),me==="CPU"?(_(Zt=>Zt+1),e("GAME")):e(me==="CASUAL_MATCH"||me==="RANKED_MATCH"?"MATCHMAKING":"LOBBY")):e("CLASS_SELECT")},[]),at=P.useCallback(me=>{r(me),s==="CPU"?(_(qe=>qe+1),e("GAME")):e(s==="CASUAL_MATCH"||s==="RANKED_MATCH"?"MATCHMAKING":"LOBBY")},[s]),nt=P.useCallback((me=!1)=>{O.current&&(O.current.disconnect(),O.current=null),ne(!1),e("TITLE"),I(me),l(""),i("CPU"),d(void 0),fe(void 0),ae(void 0)},[]),Ue=P.useCallback(me=>{console.log(" App handleSetHomeCard called with cardId:",me),xe(me),localStorage.setItem("homeCardId",me),console.log(" localStorage updated:",localStorage.getItem("homeCardId"))},[]),Pt=P.useCallback(()=>{e("REGISTER")},[]),lt=P.useCallback(()=>{e("LOGIN")},[]),Ot=P.useCallback(()=>{e("TITLE")},[]),vt=P.useCallback(()=>{e("TITLE")},[]),ct=P.useCallback(async()=>{try{await jM(),e("TITLE")}catch(me){console.error("Failed to logout:",me)}},[]),wt=P.useCallback(()=>{e("TITLE")},[]),Lt=P.useCallback(()=>{e("TITLE")},[]),Oe=P.useCallback(()=>{e("PROFILE")},[]),Bt=P.useCallback(me=>{G(me),localStorage.setItem("playerName",me),e("TITLE")},[]),xt=P.useCallback(()=>{e("TITLE")},[]);return L?a.jsx("div",{style:{width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",color:"white",fontSize:"1.5rem",fontWeight:"bold"},children:"Loading..."}):a.jsxs("div",{className:"app-container",style:{userSelect:"none"},children:[y&&a.jsxs("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100dvh",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:99999,color:"white",textAlign:"center",padding:20},children:[a.jsx("div",{style:{fontSize:"4rem",marginBottom:20,animation:"rotatePhone 2s ease-in-out infinite"},children:""}),a.jsx("h2",{style:{fontSize:"1.5rem",fontWeight:"bold",marginBottom:10,textShadow:"0 2px 4px rgba(0,0,0,0.5)"},children:""}),a.jsx("p",{style:{fontSize:"1rem",opacity:.8,maxWidth:280},children:""}),a.jsx("style",{children:`
                        @keyframes rotatePhone {
                            0%, 100% { transform: rotate(0deg); }
                            25% { transform: rotate(-30deg); }
                            75% { transform: rotate(30deg); }
                        }
                    `})]}),t==="TITLE"&&a.jsx(_L,{onStartConfig:et,audioSettings:B,onAudioSettingsChange:V,playerId:f,onSetHomeCard:Ue,homeCardId:te,isAnonymous:C,userId:m,currentPlayerName:W,onPlayerNameUpdate:me=>G(me),onNavigateToRegister:Pt,onNavigateToLogin:lt,onNavigateToProfile:Oe,onLogout:ct,returnToHome:x}),t==="CLASS_SELECT"&&a.jsx(CL,{onSelectClass:at,onBack:()=>nt(!0),gameMode:s,aiDifficulty:u,onDifficultyChange:h,playerName:W,onPlayerNameChange:me=>{G(me),localStorage.setItem("playerName",me)},timerEnabled:H,onTimerEnabledChange:me=>{Q(me),localStorage.setItem("timerEnabled",JSON.stringify(me))},playerId:f}),t==="LOBBY"&&a.jsx(QL,{gameMode:s,targetRoomId:o,playerClass:n,onGameStart:Qe,onBack:()=>nt(!0)}),t==="MATCHMAKING"&&a.jsx(tM,{matchType:s==="CASUAL_MATCH"?"casual":"ranked",playerClass:n,playerName:W||"",playerId:f,onGameStart:tt,onCancel:()=>nt(!0)}),t==="GAME"&&a.jsx(MM,{playerClass:n,opponentType:s==="CPU"?"CPU":"ONLINE",gameMode:s,targetRoomId:o,onLeave:()=>nt(!0),onRematching:Ae,networkAdapter:O.current,networkConnected:N,opponentClass:c,aiDifficulty:u,playerName:W||"",timerEnabled:s==="CASUAL_MATCH"||s==="RANKED_MATCH"?!0:H,playerId:f,opponentPlayerId:de,opponentRating:Ee,opponentName:he},v),t==="REGISTER"&&a.jsx(UM,{onRegisterSuccess:Ot,onBack:wt}),t==="LOGIN"&&a.jsx(BM,{onLoginSuccess:vt,onBack:Lt}),t==="PROFILE"&&a.jsx(zM,{playerId:f,currentPlayerName:W,onUpdateSuccess:Bt,onBack:xt})]})}Kh.createRoot(document.getElementById("root")).render(a.jsx(YM,{}));
