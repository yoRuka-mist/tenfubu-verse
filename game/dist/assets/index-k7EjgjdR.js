var PI=Object.defineProperty;var OI=t=>{throw TypeError(t)};var LI=(t,e,n)=>e in t?PI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var ln=(t,e,n)=>LI(t,typeof e!="symbol"?e+"":e,n);var _a=(t,e,n)=>e.has(t)?OI("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n);function DI(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in t)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function F_(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var U_={exports:{}},xu={},B_={exports:{}},dt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $l=Symbol.for("react.element"),MI=Symbol.for("react.portal"),NI=Symbol.for("react.fragment"),jI=Symbol.for("react.strict_mode"),$I=Symbol.for("react.profiler"),FI=Symbol.for("react.provider"),UI=Symbol.for("react.context"),BI=Symbol.for("react.forward_ref"),zI=Symbol.for("react.suspense"),HI=Symbol.for("react.memo"),WI=Symbol.for("react.lazy"),Hm=Symbol.iterator;function GI(t){return t===null||typeof t!="object"?null:(t=Hm&&t[Hm]||t["@@iterator"],typeof t=="function"?t:null)}var z_={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},H_=Object.assign,W_={};function Ko(t,e,n){this.props=t,this.context=e,this.refs=W_,this.updater=n||z_}Ko.prototype.isReactComponent={};Ko.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Ko.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function G_(){}G_.prototype=Ko.prototype;function tg(t,e,n){this.props=t,this.context=e,this.refs=W_,this.updater=n||z_}var ng=tg.prototype=new G_;ng.constructor=tg;H_(ng,Ko.prototype);ng.isPureReactComponent=!0;var Wm=Array.isArray,V_=Object.prototype.hasOwnProperty,rg={current:null},Y_={key:!0,ref:!0,__self:!0,__source:!0};function K_(t,e,n){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)V_.call(e,r)&&!Y_.hasOwnProperty(r)&&(s[r]=e[r]);var l=arguments.length-2;if(l===1)s.children=n;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];s.children=c}if(t&&t.defaultProps)for(r in l=t.defaultProps,l)s[r]===void 0&&(s[r]=l[r]);return{$$typeof:$l,type:t,key:i,ref:o,props:s,_owner:rg.current}}function VI(t,e){return{$$typeof:$l,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function sg(t){return typeof t=="object"&&t!==null&&t.$$typeof===$l}function YI(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Gm=/\/+/g;function Ff(t,e){return typeof t=="object"&&t!==null&&t.key!=null?YI(""+t.key):e.toString(36)}function Zc(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case $l:case MI:o=!0}}if(o)return o=t,s=s(o),t=r===""?"."+Ff(o,0):r,Wm(s)?(n="",t!=null&&(n=t.replace(Gm,"$&/")+"/"),Zc(s,e,n,"",function(d){return d})):s!=null&&(sg(s)&&(s=VI(s,n+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(Gm,"$&/")+"/")+t)),e.push(s)),1;if(o=0,r=r===""?".":r+":",Wm(t))for(var l=0;l<t.length;l++){i=t[l];var c=r+Ff(i,l);o+=Zc(i,e,n,c,s)}else if(c=GI(t),typeof c=="function")for(t=c.call(t),l=0;!(i=t.next()).done;)i=i.value,c=r+Ff(i,l++),o+=Zc(i,e,n,c,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Cc(t,e,n){if(t==null)return t;var r=[],s=0;return Zc(t,r,"","",function(i){return e.call(n,i,s++)}),r}function KI(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var An={current:null},ed={transition:null},XI={ReactCurrentDispatcher:An,ReactCurrentBatchConfig:ed,ReactCurrentOwner:rg};function X_(){throw Error("act(...) is not supported in production builds of React.")}dt.Children={map:Cc,forEach:function(t,e,n){Cc(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Cc(t,function(){e++}),e},toArray:function(t){return Cc(t,function(e){return e})||[]},only:function(t){if(!sg(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};dt.Component=Ko;dt.Fragment=NI;dt.Profiler=$I;dt.PureComponent=tg;dt.StrictMode=jI;dt.Suspense=zI;dt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=XI;dt.act=X_;dt.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=H_({},t.props),s=t.key,i=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=rg.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(c in e)V_.call(e,c)&&!Y_.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&l!==void 0?l[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];r.children=l}return{$$typeof:$l,type:t.type,key:s,ref:i,props:r,_owner:o}};dt.createContext=function(t){return t={$$typeof:UI,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:FI,_context:t},t.Consumer=t};dt.createElement=K_;dt.createFactory=function(t){var e=K_.bind(null,t);return e.type=t,e};dt.createRef=function(){return{current:null}};dt.forwardRef=function(t){return{$$typeof:BI,render:t}};dt.isValidElement=sg;dt.lazy=function(t){return{$$typeof:WI,_payload:{_status:-1,_result:t},_init:KI}};dt.memo=function(t,e){return{$$typeof:HI,type:t,compare:e===void 0?null:e}};dt.startTransition=function(t){var e=ed.transition;ed.transition={};try{t()}finally{ed.transition=e}};dt.unstable_act=X_;dt.useCallback=function(t,e){return An.current.useCallback(t,e)};dt.useContext=function(t){return An.current.useContext(t)};dt.useDebugValue=function(){};dt.useDeferredValue=function(t){return An.current.useDeferredValue(t)};dt.useEffect=function(t,e){return An.current.useEffect(t,e)};dt.useId=function(){return An.current.useId()};dt.useImperativeHandle=function(t,e,n){return An.current.useImperativeHandle(t,e,n)};dt.useInsertionEffect=function(t,e){return An.current.useInsertionEffect(t,e)};dt.useLayoutEffect=function(t,e){return An.current.useLayoutEffect(t,e)};dt.useMemo=function(t,e){return An.current.useMemo(t,e)};dt.useReducer=function(t,e,n){return An.current.useReducer(t,e,n)};dt.useRef=function(t){return An.current.useRef(t)};dt.useState=function(t){return An.current.useState(t)};dt.useSyncExternalStore=function(t,e,n){return An.current.useSyncExternalStore(t,e,n)};dt.useTransition=function(){return An.current.useTransition()};dt.version="18.3.1";B_.exports=dt;var L=B_.exports;const j=F_(L);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var QI=L,JI=Symbol.for("react.element"),qI=Symbol.for("react.fragment"),ZI=Object.prototype.hasOwnProperty,eT=QI.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,tT={key:!0,ref:!0,__self:!0,__source:!0};function Q_(t,e,n){var r,s={},i=null,o=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)ZI.call(e,r)&&!tT.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:JI,type:t,key:i,ref:o,props:s,_owner:eT.current}}xu.Fragment=qI;xu.jsx=Q_;xu.jsxs=Q_;U_.exports=xu;var a=U_.exports,kh={},J_={exports:{}},Kn={},q_={exports:{}},Z_={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(y,g){var T=y.length;y.push(g);e:for(;0<T;){var A=T-1>>>1,M=y[A];if(0<s(M,g))y[A]=g,y[T]=M,T=A;else break e}}function n(y){return y.length===0?null:y[0]}function r(y){if(y.length===0)return null;var g=y[0],T=y.pop();if(T!==g){y[0]=T;e:for(var A=0,M=y.length,Q=M>>>1;A<Q;){var U=2*(A+1)-1,ge=y[U],z=U+1,Te=y[z];if(0>s(ge,T))z<M&&0>s(Te,ge)?(y[A]=Te,y[z]=T,A=z):(y[A]=ge,y[U]=T,A=U);else if(z<M&&0>s(Te,T))y[A]=Te,y[z]=T,A=z;else break e}}return g}function s(y,g){var T=y.sortIndex-g.sortIndex;return T!==0?T:y.id-g.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],d=[],u=1,h=null,f=3,E=!1,k=!1,w=!1,$=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function S(y){for(var g=n(d);g!==null;){if(g.callback===null)r(d);else if(g.startTime<=y)r(d),g.sortIndex=g.expirationTime,e(c,g);else break;g=n(d)}}function p(y){if(w=!1,S(y),!k)if(n(c)!==null)k=!0,C(D);else{var g=n(d);g!==null&&R(p,g.startTime-y)}}function D(y,g){k=!1,w&&(w=!1,v(V),V=-1),E=!0;var T=f;try{for(S(g),h=n(c);h!==null&&(!(h.expirationTime>g)||y&&!ve());){var A=h.callback;if(typeof A=="function"){h.callback=null,f=h.priorityLevel;var M=A(h.expirationTime<=g);g=t.unstable_now(),typeof M=="function"?h.callback=M:h===n(c)&&r(c),S(g)}else r(c);h=n(c)}if(h!==null)var Q=!0;else{var U=n(d);U!==null&&R(p,U.startTime-g),Q=!1}return Q}finally{h=null,f=T,E=!1}}var H=!1,ne=null,V=-1,ee=5,de=-1;function ve(){return!(t.unstable_now()-de<ee)}function je(){if(ne!==null){var y=t.unstable_now();de=y;var g=!0;try{g=ne(!0,y)}finally{g?ue():(H=!1,ne=null)}}else H=!1}var ue;if(typeof _=="function")ue=function(){_(je)};else if(typeof MessageChannel<"u"){var I=new MessageChannel,O=I.port2;I.port1.onmessage=je,ue=function(){O.postMessage(null)}}else ue=function(){$(je,0)};function C(y){ne=y,H||(H=!0,ue())}function R(y,g){V=$(function(){y(t.unstable_now())},g)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(y){y.callback=null},t.unstable_continueExecution=function(){k||E||(k=!0,C(D))},t.unstable_forceFrameRate=function(y){0>y||125<y?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ee=0<y?Math.floor(1e3/y):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(y){switch(f){case 1:case 2:case 3:var g=3;break;default:g=f}var T=f;f=g;try{return y()}finally{f=T}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(y,g){switch(y){case 1:case 2:case 3:case 4:case 5:break;default:y=3}var T=f;f=y;try{return g()}finally{f=T}},t.unstable_scheduleCallback=function(y,g,T){var A=t.unstable_now();switch(typeof T=="object"&&T!==null?(T=T.delay,T=typeof T=="number"&&0<T?A+T:A):T=A,y){case 1:var M=-1;break;case 2:M=250;break;case 5:M=1073741823;break;case 4:M=1e4;break;default:M=5e3}return M=T+M,y={id:u++,callback:g,priorityLevel:y,startTime:T,expirationTime:M,sortIndex:-1},T>A?(y.sortIndex=T,e(d,y),n(c)===null&&y===n(d)&&(w?(v(V),V=-1):w=!0,R(p,T-A))):(y.sortIndex=M,e(c,y),k||E||(k=!0,C(D))),y},t.unstable_shouldYield=ve,t.unstable_wrapCallback=function(y){var g=f;return function(){var T=f;f=g;try{return y.apply(this,arguments)}finally{f=T}}}})(Z_);q_.exports=Z_;var nT=q_.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rT=L,Vn=nT;function ce(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var ex=new Set,al={};function Ni(t,e){Lo(t,e),Lo(t+"Capture",e)}function Lo(t,e){for(al[t]=e,t=0;t<e.length;t++)ex.add(e[t])}var rs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Rh=Object.prototype.hasOwnProperty,sT=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Vm={},Ym={};function iT(t){return Rh.call(Ym,t)?!0:Rh.call(Vm,t)?!1:sT.test(t)?Ym[t]=!0:(Vm[t]=!0,!1)}function oT(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function aT(t,e,n,r){if(e===null||typeof e>"u"||oT(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Pn(t,e,n,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var fn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){fn[t]=new Pn(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];fn[e]=new Pn(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){fn[t]=new Pn(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){fn[t]=new Pn(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){fn[t]=new Pn(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){fn[t]=new Pn(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){fn[t]=new Pn(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){fn[t]=new Pn(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){fn[t]=new Pn(t,5,!1,t.toLowerCase(),null,!1,!1)});var ig=/[\-:]([a-z])/g;function og(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(ig,og);fn[e]=new Pn(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(ig,og);fn[e]=new Pn(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(ig,og);fn[e]=new Pn(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){fn[t]=new Pn(t,1,!1,t.toLowerCase(),null,!1,!1)});fn.xlinkHref=new Pn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){fn[t]=new Pn(t,1,!1,t.toLowerCase(),null,!0,!0)});function ag(t,e,n,r){var s=fn.hasOwnProperty(e)?fn[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(aT(e,n,s,r)&&(n=null),r||s===null?iT(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var ds=rT.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,kc=Symbol.for("react.element"),io=Symbol.for("react.portal"),oo=Symbol.for("react.fragment"),lg=Symbol.for("react.strict_mode"),Ah=Symbol.for("react.profiler"),tx=Symbol.for("react.provider"),nx=Symbol.for("react.context"),cg=Symbol.for("react.forward_ref"),Ph=Symbol.for("react.suspense"),Oh=Symbol.for("react.suspense_list"),dg=Symbol.for("react.memo"),bs=Symbol.for("react.lazy"),rx=Symbol.for("react.offscreen"),Km=Symbol.iterator;function xa(t){return t===null||typeof t!="object"?null:(t=Km&&t[Km]||t["@@iterator"],typeof t=="function"?t:null)}var Ut=Object.assign,Uf;function Da(t){if(Uf===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Uf=e&&e[1]||""}return`
`+Uf+t}var Bf=!1;function zf(t,e){if(!t||Bf)return"";Bf=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var r=d}Reflect.construct(t,[],e)}else{try{e.call()}catch(d){r=d}t.call(e.prototype)}else{try{throw Error()}catch(d){r=d}t()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var s=d.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,l=i.length-1;1<=o&&0<=l&&s[o]!==i[l];)l--;for(;1<=o&&0<=l;o--,l--)if(s[o]!==i[l]){if(o!==1||l!==1)do if(o--,l--,0>l||s[o]!==i[l]){var c=`
`+s[o].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=o&&0<=l);break}}}finally{Bf=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Da(t):""}function lT(t){switch(t.tag){case 5:return Da(t.type);case 16:return Da("Lazy");case 13:return Da("Suspense");case 19:return Da("SuspenseList");case 0:case 2:case 15:return t=zf(t.type,!1),t;case 11:return t=zf(t.type.render,!1),t;case 1:return t=zf(t.type,!0),t;default:return""}}function Lh(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case oo:return"Fragment";case io:return"Portal";case Ah:return"Profiler";case lg:return"StrictMode";case Ph:return"Suspense";case Oh:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case nx:return(t.displayName||"Context")+".Consumer";case tx:return(t._context.displayName||"Context")+".Provider";case cg:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case dg:return e=t.displayName||null,e!==null?e:Lh(t.type)||"Memo";case bs:e=t._payload,t=t._init;try{return Lh(t(e))}catch{}}return null}function cT(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Lh(e);case 8:return e===lg?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Xs(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function sx(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function dT(t){var e=sx(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Rc(t){t._valueTracker||(t._valueTracker=dT(t))}function ix(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=sx(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Id(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Dh(t,e){var n=e.checked;return Ut({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Xm(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Xs(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function ox(t,e){e=e.checked,e!=null&&ag(t,"checked",e,!1)}function Mh(t,e){ox(t,e);var n=Xs(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Nh(t,e.type,n):e.hasOwnProperty("defaultValue")&&Nh(t,e.type,Xs(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Qm(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Nh(t,e,n){(e!=="number"||Id(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Ma=Array.isArray;function xo(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Xs(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function jh(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ce(91));return Ut({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Jm(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(ce(92));if(Ma(n)){if(1<n.length)throw Error(ce(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Xs(n)}}function ax(t,e){var n=Xs(e.value),r=Xs(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function qm(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function lx(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function $h(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?lx(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Ac,cx=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Ac=Ac||document.createElement("div"),Ac.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Ac.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function ll(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Ba={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},uT=["Webkit","ms","Moz","O"];Object.keys(Ba).forEach(function(t){uT.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Ba[e]=Ba[t]})});function dx(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Ba.hasOwnProperty(t)&&Ba[t]?(""+e).trim():e+"px"}function ux(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=dx(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var fT=Ut({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Fh(t,e){if(e){if(fT[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ce(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ce(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ce(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ce(62))}}function Uh(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Bh=null;function ug(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var zh=null,bo=null,Eo=null;function Zm(t){if(t=Bl(t)){if(typeof zh!="function")throw Error(ce(280));var e=t.stateNode;e&&(e=Tu(e),zh(t.stateNode,t.type,e))}}function fx(t){bo?Eo?Eo.push(t):Eo=[t]:bo=t}function hx(){if(bo){var t=bo,e=Eo;if(Eo=bo=null,Zm(t),e)for(t=0;t<e.length;t++)Zm(e[t])}}function px(t,e){return t(e)}function gx(){}var Hf=!1;function mx(t,e,n){if(Hf)return t(e,n);Hf=!0;try{return px(t,e,n)}finally{Hf=!1,(bo!==null||Eo!==null)&&(gx(),hx())}}function cl(t,e){var n=t.stateNode;if(n===null)return null;var r=Tu(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(ce(231,e,typeof n));return n}var Hh=!1;if(rs)try{var ba={};Object.defineProperty(ba,"passive",{get:function(){Hh=!0}}),window.addEventListener("test",ba,ba),window.removeEventListener("test",ba,ba)}catch{Hh=!1}function hT(t,e,n,r,s,i,o,l,c){var d=Array.prototype.slice.call(arguments,3);try{e.apply(n,d)}catch(u){this.onError(u)}}var za=!1,Td=null,wd=!1,Wh=null,pT={onError:function(t){za=!0,Td=t}};function gT(t,e,n,r,s,i,o,l,c){za=!1,Td=null,hT.apply(pT,arguments)}function mT(t,e,n,r,s,i,o,l,c){if(gT.apply(this,arguments),za){if(za){var d=Td;za=!1,Td=null}else throw Error(ce(198));wd||(wd=!0,Wh=d)}}function ji(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function yx(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function ey(t){if(ji(t)!==t)throw Error(ce(188))}function yT(t){var e=t.alternate;if(!e){if(e=ji(t),e===null)throw Error(ce(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return ey(s),t;if(i===r)return ey(s),e;i=i.sibling}throw Error(ce(188))}if(n.return!==r.return)n=s,r=i;else{for(var o=!1,l=s.child;l;){if(l===n){o=!0,n=s,r=i;break}if(l===r){o=!0,r=s,n=i;break}l=l.sibling}if(!o){for(l=i.child;l;){if(l===n){o=!0,n=i,r=s;break}if(l===r){o=!0,r=i,n=s;break}l=l.sibling}if(!o)throw Error(ce(189))}}if(n.alternate!==r)throw Error(ce(190))}if(n.tag!==3)throw Error(ce(188));return n.stateNode.current===n?t:e}function vx(t){return t=yT(t),t!==null?_x(t):null}function _x(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=_x(t);if(e!==null)return e;t=t.sibling}return null}var xx=Vn.unstable_scheduleCallback,ty=Vn.unstable_cancelCallback,vT=Vn.unstable_shouldYield,_T=Vn.unstable_requestPaint,Ht=Vn.unstable_now,xT=Vn.unstable_getCurrentPriorityLevel,fg=Vn.unstable_ImmediatePriority,bx=Vn.unstable_UserBlockingPriority,Cd=Vn.unstable_NormalPriority,bT=Vn.unstable_LowPriority,Ex=Vn.unstable_IdlePriority,bu=null,Nr=null;function ET(t){if(Nr&&typeof Nr.onCommitFiberRoot=="function")try{Nr.onCommitFiberRoot(bu,t,void 0,(t.current.flags&128)===128)}catch{}}var vr=Math.clz32?Math.clz32:TT,ST=Math.log,IT=Math.LN2;function TT(t){return t>>>=0,t===0?32:31-(ST(t)/IT|0)|0}var Pc=64,Oc=4194304;function Na(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function kd(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,o=n&268435455;if(o!==0){var l=o&~s;l!==0?r=Na(l):(i&=o,i!==0&&(r=Na(i)))}else o=n&~s,o!==0?r=Na(o):i!==0&&(r=Na(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-vr(e),s=1<<n,r|=t[n],e&=~s;return r}function wT(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function CT(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var o=31-vr(i),l=1<<o,c=s[o];c===-1?(!(l&n)||l&r)&&(s[o]=wT(l,e)):c<=e&&(t.expiredLanes|=l),i&=~l}}function Gh(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Sx(){var t=Pc;return Pc<<=1,!(Pc&4194240)&&(Pc=64),t}function Wf(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Fl(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-vr(e),t[e]=n}function kT(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-vr(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function hg(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-vr(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var bt=0;function Ix(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Tx,pg,wx,Cx,kx,Vh=!1,Lc=[],Ms=null,Ns=null,js=null,dl=new Map,ul=new Map,Ss=[],RT="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ny(t,e){switch(t){case"focusin":case"focusout":Ms=null;break;case"dragenter":case"dragleave":Ns=null;break;case"mouseover":case"mouseout":js=null;break;case"pointerover":case"pointerout":dl.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ul.delete(e.pointerId)}}function Ea(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=Bl(e),e!==null&&pg(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function AT(t,e,n,r,s){switch(e){case"focusin":return Ms=Ea(Ms,t,e,n,r,s),!0;case"dragenter":return Ns=Ea(Ns,t,e,n,r,s),!0;case"mouseover":return js=Ea(js,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return dl.set(i,Ea(dl.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,ul.set(i,Ea(ul.get(i)||null,t,e,n,r,s)),!0}return!1}function Rx(t){var e=vi(t.target);if(e!==null){var n=ji(e);if(n!==null){if(e=n.tag,e===13){if(e=yx(n),e!==null){t.blockedOn=e,kx(t.priority,function(){wx(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function td(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Yh(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);Bh=r,n.target.dispatchEvent(r),Bh=null}else return e=Bl(n),e!==null&&pg(e),t.blockedOn=n,!1;e.shift()}return!0}function ry(t,e,n){td(t)&&n.delete(e)}function PT(){Vh=!1,Ms!==null&&td(Ms)&&(Ms=null),Ns!==null&&td(Ns)&&(Ns=null),js!==null&&td(js)&&(js=null),dl.forEach(ry),ul.forEach(ry)}function Sa(t,e){t.blockedOn===e&&(t.blockedOn=null,Vh||(Vh=!0,Vn.unstable_scheduleCallback(Vn.unstable_NormalPriority,PT)))}function fl(t){function e(s){return Sa(s,t)}if(0<Lc.length){Sa(Lc[0],t);for(var n=1;n<Lc.length;n++){var r=Lc[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Ms!==null&&Sa(Ms,t),Ns!==null&&Sa(Ns,t),js!==null&&Sa(js,t),dl.forEach(e),ul.forEach(e),n=0;n<Ss.length;n++)r=Ss[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Ss.length&&(n=Ss[0],n.blockedOn===null);)Rx(n),n.blockedOn===null&&Ss.shift()}var So=ds.ReactCurrentBatchConfig,Rd=!0;function OT(t,e,n,r){var s=bt,i=So.transition;So.transition=null;try{bt=1,gg(t,e,n,r)}finally{bt=s,So.transition=i}}function LT(t,e,n,r){var s=bt,i=So.transition;So.transition=null;try{bt=4,gg(t,e,n,r)}finally{bt=s,So.transition=i}}function gg(t,e,n,r){if(Rd){var s=Yh(t,e,n,r);if(s===null)eh(t,e,r,Ad,n),ny(t,r);else if(AT(s,t,e,n,r))r.stopPropagation();else if(ny(t,r),e&4&&-1<RT.indexOf(t)){for(;s!==null;){var i=Bl(s);if(i!==null&&Tx(i),i=Yh(t,e,n,r),i===null&&eh(t,e,r,Ad,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else eh(t,e,r,null,n)}}var Ad=null;function Yh(t,e,n,r){if(Ad=null,t=ug(r),t=vi(t),t!==null)if(e=ji(t),e===null)t=null;else if(n=e.tag,n===13){if(t=yx(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Ad=t,null}function Ax(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(xT()){case fg:return 1;case bx:return 4;case Cd:case bT:return 16;case Ex:return 536870912;default:return 16}default:return 16}}var As=null,mg=null,nd=null;function Px(){if(nd)return nd;var t,e=mg,n=e.length,r,s="value"in As?As.value:As.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===s[i-r];r++);return nd=s.slice(t,1<r?1-r:void 0)}function rd(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Dc(){return!0}function sy(){return!1}function Xn(t){function e(n,r,s,i,o){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(i):i[l]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Dc:sy,this.isPropagationStopped=sy,this}return Ut(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Dc)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Dc)},persist:function(){},isPersistent:Dc}),e}var Xo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},yg=Xn(Xo),Ul=Ut({},Xo,{view:0,detail:0}),DT=Xn(Ul),Gf,Vf,Ia,Eu=Ut({},Ul,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:vg,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Ia&&(Ia&&t.type==="mousemove"?(Gf=t.screenX-Ia.screenX,Vf=t.screenY-Ia.screenY):Vf=Gf=0,Ia=t),Gf)},movementY:function(t){return"movementY"in t?t.movementY:Vf}}),iy=Xn(Eu),MT=Ut({},Eu,{dataTransfer:0}),NT=Xn(MT),jT=Ut({},Ul,{relatedTarget:0}),Yf=Xn(jT),$T=Ut({},Xo,{animationName:0,elapsedTime:0,pseudoElement:0}),FT=Xn($T),UT=Ut({},Xo,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),BT=Xn(UT),zT=Ut({},Xo,{data:0}),oy=Xn(zT),HT={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},WT={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},GT={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function VT(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=GT[t])?!!e[t]:!1}function vg(){return VT}var YT=Ut({},Ul,{key:function(t){if(t.key){var e=HT[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=rd(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?WT[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:vg,charCode:function(t){return t.type==="keypress"?rd(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?rd(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),KT=Xn(YT),XT=Ut({},Eu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ay=Xn(XT),QT=Ut({},Ul,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:vg}),JT=Xn(QT),qT=Ut({},Xo,{propertyName:0,elapsedTime:0,pseudoElement:0}),ZT=Xn(qT),ew=Ut({},Eu,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),tw=Xn(ew),nw=[9,13,27,32],_g=rs&&"CompositionEvent"in window,Ha=null;rs&&"documentMode"in document&&(Ha=document.documentMode);var rw=rs&&"TextEvent"in window&&!Ha,Ox=rs&&(!_g||Ha&&8<Ha&&11>=Ha),ly=" ",cy=!1;function Lx(t,e){switch(t){case"keyup":return nw.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Dx(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var ao=!1;function sw(t,e){switch(t){case"compositionend":return Dx(e);case"keypress":return e.which!==32?null:(cy=!0,ly);case"textInput":return t=e.data,t===ly&&cy?null:t;default:return null}}function iw(t,e){if(ao)return t==="compositionend"||!_g&&Lx(t,e)?(t=Px(),nd=mg=As=null,ao=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Ox&&e.locale!=="ko"?null:e.data;default:return null}}var ow={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function dy(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!ow[t.type]:e==="textarea"}function Mx(t,e,n,r){fx(r),e=Pd(e,"onChange"),0<e.length&&(n=new yg("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Wa=null,hl=null;function aw(t){Vx(t,0)}function Su(t){var e=uo(t);if(ix(e))return t}function lw(t,e){if(t==="change")return e}var Nx=!1;if(rs){var Kf;if(rs){var Xf="oninput"in document;if(!Xf){var uy=document.createElement("div");uy.setAttribute("oninput","return;"),Xf=typeof uy.oninput=="function"}Kf=Xf}else Kf=!1;Nx=Kf&&(!document.documentMode||9<document.documentMode)}function fy(){Wa&&(Wa.detachEvent("onpropertychange",jx),hl=Wa=null)}function jx(t){if(t.propertyName==="value"&&Su(hl)){var e=[];Mx(e,hl,t,ug(t)),mx(aw,e)}}function cw(t,e,n){t==="focusin"?(fy(),Wa=e,hl=n,Wa.attachEvent("onpropertychange",jx)):t==="focusout"&&fy()}function dw(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Su(hl)}function uw(t,e){if(t==="click")return Su(e)}function fw(t,e){if(t==="input"||t==="change")return Su(e)}function hw(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var br=typeof Object.is=="function"?Object.is:hw;function pl(t,e){if(br(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!Rh.call(e,s)||!br(t[s],e[s]))return!1}return!0}function hy(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function py(t,e){var n=hy(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=hy(n)}}function $x(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?$x(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Fx(){for(var t=window,e=Id();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Id(t.document)}return e}function xg(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function pw(t){var e=Fx(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&$x(n.ownerDocument.documentElement,n)){if(r!==null&&xg(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=py(n,i);var o=py(n,r);s&&o&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var gw=rs&&"documentMode"in document&&11>=document.documentMode,lo=null,Kh=null,Ga=null,Xh=!1;function gy(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Xh||lo==null||lo!==Id(r)||(r=lo,"selectionStart"in r&&xg(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Ga&&pl(Ga,r)||(Ga=r,r=Pd(Kh,"onSelect"),0<r.length&&(e=new yg("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=lo)))}function Mc(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var co={animationend:Mc("Animation","AnimationEnd"),animationiteration:Mc("Animation","AnimationIteration"),animationstart:Mc("Animation","AnimationStart"),transitionend:Mc("Transition","TransitionEnd")},Qf={},Ux={};rs&&(Ux=document.createElement("div").style,"AnimationEvent"in window||(delete co.animationend.animation,delete co.animationiteration.animation,delete co.animationstart.animation),"TransitionEvent"in window||delete co.transitionend.transition);function Iu(t){if(Qf[t])return Qf[t];if(!co[t])return t;var e=co[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in Ux)return Qf[t]=e[n];return t}var Bx=Iu("animationend"),zx=Iu("animationiteration"),Hx=Iu("animationstart"),Wx=Iu("transitionend"),Gx=new Map,my="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ni(t,e){Gx.set(t,e),Ni(e,[t])}for(var Jf=0;Jf<my.length;Jf++){var qf=my[Jf],mw=qf.toLowerCase(),yw=qf[0].toUpperCase()+qf.slice(1);ni(mw,"on"+yw)}ni(Bx,"onAnimationEnd");ni(zx,"onAnimationIteration");ni(Hx,"onAnimationStart");ni("dblclick","onDoubleClick");ni("focusin","onFocus");ni("focusout","onBlur");ni(Wx,"onTransitionEnd");Lo("onMouseEnter",["mouseout","mouseover"]);Lo("onMouseLeave",["mouseout","mouseover"]);Lo("onPointerEnter",["pointerout","pointerover"]);Lo("onPointerLeave",["pointerout","pointerover"]);Ni("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ni("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ni("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ni("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ni("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ni("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ja="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),vw=new Set("cancel close invalid load scroll toggle".split(" ").concat(ja));function yy(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,mT(r,e,void 0,t),t.currentTarget=null}function Vx(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var l=r[o],c=l.instance,d=l.currentTarget;if(l=l.listener,c!==i&&s.isPropagationStopped())break e;yy(s,l,d),i=c}else for(o=0;o<r.length;o++){if(l=r[o],c=l.instance,d=l.currentTarget,l=l.listener,c!==i&&s.isPropagationStopped())break e;yy(s,l,d),i=c}}}if(wd)throw t=Wh,wd=!1,Wh=null,t}function At(t,e){var n=e[ep];n===void 0&&(n=e[ep]=new Set);var r=t+"__bubble";n.has(r)||(Yx(e,t,2,!1),n.add(r))}function Zf(t,e,n){var r=0;e&&(r|=4),Yx(n,t,r,e)}var Nc="_reactListening"+Math.random().toString(36).slice(2);function gl(t){if(!t[Nc]){t[Nc]=!0,ex.forEach(function(n){n!=="selectionchange"&&(vw.has(n)||Zf(n,!1,t),Zf(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Nc]||(e[Nc]=!0,Zf("selectionchange",!1,e))}}function Yx(t,e,n,r){switch(Ax(e)){case 1:var s=OT;break;case 4:s=LT;break;default:s=gg}n=s.bind(null,e,n,t),s=void 0,!Hh||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function eh(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var l=r.stateNode.containerInfo;if(l===s||l.nodeType===8&&l.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===s||c.nodeType===8&&c.parentNode===s))return;o=o.return}for(;l!==null;){if(o=vi(l),o===null)return;if(c=o.tag,c===5||c===6){r=i=o;continue e}l=l.parentNode}}r=r.return}mx(function(){var d=i,u=ug(n),h=[];e:{var f=Gx.get(t);if(f!==void 0){var E=yg,k=t;switch(t){case"keypress":if(rd(n)===0)break e;case"keydown":case"keyup":E=KT;break;case"focusin":k="focus",E=Yf;break;case"focusout":k="blur",E=Yf;break;case"beforeblur":case"afterblur":E=Yf;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":E=iy;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":E=NT;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":E=JT;break;case Bx:case zx:case Hx:E=FT;break;case Wx:E=ZT;break;case"scroll":E=DT;break;case"wheel":E=tw;break;case"copy":case"cut":case"paste":E=BT;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":E=ay}var w=(e&4)!==0,$=!w&&t==="scroll",v=w?f!==null?f+"Capture":null:f;w=[];for(var _=d,S;_!==null;){S=_;var p=S.stateNode;if(S.tag===5&&p!==null&&(S=p,v!==null&&(p=cl(_,v),p!=null&&w.push(ml(_,p,S)))),$)break;_=_.return}0<w.length&&(f=new E(f,k,null,n,u),h.push({event:f,listeners:w}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",E=t==="mouseout"||t==="pointerout",f&&n!==Bh&&(k=n.relatedTarget||n.fromElement)&&(vi(k)||k[ss]))break e;if((E||f)&&(f=u.window===u?u:(f=u.ownerDocument)?f.defaultView||f.parentWindow:window,E?(k=n.relatedTarget||n.toElement,E=d,k=k?vi(k):null,k!==null&&($=ji(k),k!==$||k.tag!==5&&k.tag!==6)&&(k=null)):(E=null,k=d),E!==k)){if(w=iy,p="onMouseLeave",v="onMouseEnter",_="mouse",(t==="pointerout"||t==="pointerover")&&(w=ay,p="onPointerLeave",v="onPointerEnter",_="pointer"),$=E==null?f:uo(E),S=k==null?f:uo(k),f=new w(p,_+"leave",E,n,u),f.target=$,f.relatedTarget=S,p=null,vi(u)===d&&(w=new w(v,_+"enter",k,n,u),w.target=S,w.relatedTarget=$,p=w),$=p,E&&k)t:{for(w=E,v=k,_=0,S=w;S;S=to(S))_++;for(S=0,p=v;p;p=to(p))S++;for(;0<_-S;)w=to(w),_--;for(;0<S-_;)v=to(v),S--;for(;_--;){if(w===v||v!==null&&w===v.alternate)break t;w=to(w),v=to(v)}w=null}else w=null;E!==null&&vy(h,f,E,w,!1),k!==null&&$!==null&&vy(h,$,k,w,!0)}}e:{if(f=d?uo(d):window,E=f.nodeName&&f.nodeName.toLowerCase(),E==="select"||E==="input"&&f.type==="file")var D=lw;else if(dy(f))if(Nx)D=fw;else{D=dw;var H=cw}else(E=f.nodeName)&&E.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(D=uw);if(D&&(D=D(t,d))){Mx(h,D,n,u);break e}H&&H(t,f,d),t==="focusout"&&(H=f._wrapperState)&&H.controlled&&f.type==="number"&&Nh(f,"number",f.value)}switch(H=d?uo(d):window,t){case"focusin":(dy(H)||H.contentEditable==="true")&&(lo=H,Kh=d,Ga=null);break;case"focusout":Ga=Kh=lo=null;break;case"mousedown":Xh=!0;break;case"contextmenu":case"mouseup":case"dragend":Xh=!1,gy(h,n,u);break;case"selectionchange":if(gw)break;case"keydown":case"keyup":gy(h,n,u)}var ne;if(_g)e:{switch(t){case"compositionstart":var V="onCompositionStart";break e;case"compositionend":V="onCompositionEnd";break e;case"compositionupdate":V="onCompositionUpdate";break e}V=void 0}else ao?Lx(t,n)&&(V="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(V="onCompositionStart");V&&(Ox&&n.locale!=="ko"&&(ao||V!=="onCompositionStart"?V==="onCompositionEnd"&&ao&&(ne=Px()):(As=u,mg="value"in As?As.value:As.textContent,ao=!0)),H=Pd(d,V),0<H.length&&(V=new oy(V,t,null,n,u),h.push({event:V,listeners:H}),ne?V.data=ne:(ne=Dx(n),ne!==null&&(V.data=ne)))),(ne=rw?sw(t,n):iw(t,n))&&(d=Pd(d,"onBeforeInput"),0<d.length&&(u=new oy("onBeforeInput","beforeinput",null,n,u),h.push({event:u,listeners:d}),u.data=ne))}Vx(h,e)})}function ml(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Pd(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=cl(t,n),i!=null&&r.unshift(ml(t,i,s)),i=cl(t,e),i!=null&&r.push(ml(t,i,s))),t=t.return}return r}function to(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function vy(t,e,n,r,s){for(var i=e._reactName,o=[];n!==null&&n!==r;){var l=n,c=l.alternate,d=l.stateNode;if(c!==null&&c===r)break;l.tag===5&&d!==null&&(l=d,s?(c=cl(n,i),c!=null&&o.unshift(ml(n,c,l))):s||(c=cl(n,i),c!=null&&o.push(ml(n,c,l)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var _w=/\r\n?/g,xw=/\u0000|\uFFFD/g;function _y(t){return(typeof t=="string"?t:""+t).replace(_w,`
`).replace(xw,"")}function jc(t,e,n){if(e=_y(e),_y(t)!==e&&n)throw Error(ce(425))}function Od(){}var Qh=null,Jh=null;function qh(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Zh=typeof setTimeout=="function"?setTimeout:void 0,bw=typeof clearTimeout=="function"?clearTimeout:void 0,xy=typeof Promise=="function"?Promise:void 0,Ew=typeof queueMicrotask=="function"?queueMicrotask:typeof xy<"u"?function(t){return xy.resolve(null).then(t).catch(Sw)}:Zh;function Sw(t){setTimeout(function(){throw t})}function th(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),fl(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);fl(e)}function $s(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function by(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Qo=Math.random().toString(36).slice(2),Or="__reactFiber$"+Qo,yl="__reactProps$"+Qo,ss="__reactContainer$"+Qo,ep="__reactEvents$"+Qo,Iw="__reactListeners$"+Qo,Tw="__reactHandles$"+Qo;function vi(t){var e=t[Or];if(e)return e;for(var n=t.parentNode;n;){if(e=n[ss]||n[Or]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=by(t);t!==null;){if(n=t[Or])return n;t=by(t)}return e}t=n,n=t.parentNode}return null}function Bl(t){return t=t[Or]||t[ss],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function uo(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(ce(33))}function Tu(t){return t[yl]||null}var tp=[],fo=-1;function ri(t){return{current:t}}function Pt(t){0>fo||(t.current=tp[fo],tp[fo]=null,fo--)}function Rt(t,e){fo++,tp[fo]=t.current,t.current=e}var Qs={},_n=ri(Qs),jn=ri(!1),Ii=Qs;function Do(t,e){var n=t.type.contextTypes;if(!n)return Qs;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function $n(t){return t=t.childContextTypes,t!=null}function Ld(){Pt(jn),Pt(_n)}function Ey(t,e,n){if(_n.current!==Qs)throw Error(ce(168));Rt(_n,e),Rt(jn,n)}function Kx(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(ce(108,cT(t)||"Unknown",s));return Ut({},n,r)}function Dd(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Qs,Ii=_n.current,Rt(_n,t),Rt(jn,jn.current),!0}function Sy(t,e,n){var r=t.stateNode;if(!r)throw Error(ce(169));n?(t=Kx(t,e,Ii),r.__reactInternalMemoizedMergedChildContext=t,Pt(jn),Pt(_n),Rt(_n,t)):Pt(jn),Rt(jn,n)}var Yr=null,wu=!1,nh=!1;function Xx(t){Yr===null?Yr=[t]:Yr.push(t)}function ww(t){wu=!0,Xx(t)}function si(){if(!nh&&Yr!==null){nh=!0;var t=0,e=bt;try{var n=Yr;for(bt=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}Yr=null,wu=!1}catch(s){throw Yr!==null&&(Yr=Yr.slice(t+1)),xx(fg,si),s}finally{bt=e,nh=!1}}return null}var ho=[],po=0,Md=null,Nd=0,qn=[],Zn=0,Ti=null,Xr=1,Qr="";function hi(t,e){ho[po++]=Nd,ho[po++]=Md,Md=t,Nd=e}function Qx(t,e,n){qn[Zn++]=Xr,qn[Zn++]=Qr,qn[Zn++]=Ti,Ti=t;var r=Xr;t=Qr;var s=32-vr(r)-1;r&=~(1<<s),n+=1;var i=32-vr(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,Xr=1<<32-vr(e)+s|n<<s|r,Qr=i+t}else Xr=1<<i|n<<s|r,Qr=t}function bg(t){t.return!==null&&(hi(t,1),Qx(t,1,0))}function Eg(t){for(;t===Md;)Md=ho[--po],ho[po]=null,Nd=ho[--po],ho[po]=null;for(;t===Ti;)Ti=qn[--Zn],qn[Zn]=null,Qr=qn[--Zn],qn[Zn]=null,Xr=qn[--Zn],qn[Zn]=null}var Gn=null,Wn=null,Dt=!1,hr=null;function Jx(t,e){var n=nr(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Iy(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Gn=t,Wn=$s(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Gn=t,Wn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Ti!==null?{id:Xr,overflow:Qr}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=nr(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Gn=t,Wn=null,!0):!1;default:return!1}}function np(t){return(t.mode&1)!==0&&(t.flags&128)===0}function rp(t){if(Dt){var e=Wn;if(e){var n=e;if(!Iy(t,e)){if(np(t))throw Error(ce(418));e=$s(n.nextSibling);var r=Gn;e&&Iy(t,e)?Jx(r,n):(t.flags=t.flags&-4097|2,Dt=!1,Gn=t)}}else{if(np(t))throw Error(ce(418));t.flags=t.flags&-4097|2,Dt=!1,Gn=t}}}function Ty(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Gn=t}function $c(t){if(t!==Gn)return!1;if(!Dt)return Ty(t),Dt=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!qh(t.type,t.memoizedProps)),e&&(e=Wn)){if(np(t))throw qx(),Error(ce(418));for(;e;)Jx(t,e),e=$s(e.nextSibling)}if(Ty(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(ce(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Wn=$s(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Wn=null}}else Wn=Gn?$s(t.stateNode.nextSibling):null;return!0}function qx(){for(var t=Wn;t;)t=$s(t.nextSibling)}function Mo(){Wn=Gn=null,Dt=!1}function Sg(t){hr===null?hr=[t]:hr.push(t)}var Cw=ds.ReactCurrentBatchConfig;function Ta(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(ce(309));var r=n.stateNode}if(!r)throw Error(ce(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var l=s.refs;o===null?delete l[i]:l[i]=o},e._stringRef=i,e)}if(typeof t!="string")throw Error(ce(284));if(!n._owner)throw Error(ce(290,t))}return t}function Fc(t,e){throw t=Object.prototype.toString.call(e),Error(ce(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function wy(t){var e=t._init;return e(t._payload)}function Zx(t){function e(v,_){if(t){var S=v.deletions;S===null?(v.deletions=[_],v.flags|=16):S.push(_)}}function n(v,_){if(!t)return null;for(;_!==null;)e(v,_),_=_.sibling;return null}function r(v,_){for(v=new Map;_!==null;)_.key!==null?v.set(_.key,_):v.set(_.index,_),_=_.sibling;return v}function s(v,_){return v=zs(v,_),v.index=0,v.sibling=null,v}function i(v,_,S){return v.index=S,t?(S=v.alternate,S!==null?(S=S.index,S<_?(v.flags|=2,_):S):(v.flags|=2,_)):(v.flags|=1048576,_)}function o(v){return t&&v.alternate===null&&(v.flags|=2),v}function l(v,_,S,p){return _===null||_.tag!==6?(_=ch(S,v.mode,p),_.return=v,_):(_=s(_,S),_.return=v,_)}function c(v,_,S,p){var D=S.type;return D===oo?u(v,_,S.props.children,p,S.key):_!==null&&(_.elementType===D||typeof D=="object"&&D!==null&&D.$$typeof===bs&&wy(D)===_.type)?(p=s(_,S.props),p.ref=Ta(v,_,S),p.return=v,p):(p=dd(S.type,S.key,S.props,null,v.mode,p),p.ref=Ta(v,_,S),p.return=v,p)}function d(v,_,S,p){return _===null||_.tag!==4||_.stateNode.containerInfo!==S.containerInfo||_.stateNode.implementation!==S.implementation?(_=dh(S,v.mode,p),_.return=v,_):(_=s(_,S.children||[]),_.return=v,_)}function u(v,_,S,p,D){return _===null||_.tag!==7?(_=Si(S,v.mode,p,D),_.return=v,_):(_=s(_,S),_.return=v,_)}function h(v,_,S){if(typeof _=="string"&&_!==""||typeof _=="number")return _=ch(""+_,v.mode,S),_.return=v,_;if(typeof _=="object"&&_!==null){switch(_.$$typeof){case kc:return S=dd(_.type,_.key,_.props,null,v.mode,S),S.ref=Ta(v,null,_),S.return=v,S;case io:return _=dh(_,v.mode,S),_.return=v,_;case bs:var p=_._init;return h(v,p(_._payload),S)}if(Ma(_)||xa(_))return _=Si(_,v.mode,S,null),_.return=v,_;Fc(v,_)}return null}function f(v,_,S,p){var D=_!==null?_.key:null;if(typeof S=="string"&&S!==""||typeof S=="number")return D!==null?null:l(v,_,""+S,p);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case kc:return S.key===D?c(v,_,S,p):null;case io:return S.key===D?d(v,_,S,p):null;case bs:return D=S._init,f(v,_,D(S._payload),p)}if(Ma(S)||xa(S))return D!==null?null:u(v,_,S,p,null);Fc(v,S)}return null}function E(v,_,S,p,D){if(typeof p=="string"&&p!==""||typeof p=="number")return v=v.get(S)||null,l(_,v,""+p,D);if(typeof p=="object"&&p!==null){switch(p.$$typeof){case kc:return v=v.get(p.key===null?S:p.key)||null,c(_,v,p,D);case io:return v=v.get(p.key===null?S:p.key)||null,d(_,v,p,D);case bs:var H=p._init;return E(v,_,S,H(p._payload),D)}if(Ma(p)||xa(p))return v=v.get(S)||null,u(_,v,p,D,null);Fc(_,p)}return null}function k(v,_,S,p){for(var D=null,H=null,ne=_,V=_=0,ee=null;ne!==null&&V<S.length;V++){ne.index>V?(ee=ne,ne=null):ee=ne.sibling;var de=f(v,ne,S[V],p);if(de===null){ne===null&&(ne=ee);break}t&&ne&&de.alternate===null&&e(v,ne),_=i(de,_,V),H===null?D=de:H.sibling=de,H=de,ne=ee}if(V===S.length)return n(v,ne),Dt&&hi(v,V),D;if(ne===null){for(;V<S.length;V++)ne=h(v,S[V],p),ne!==null&&(_=i(ne,_,V),H===null?D=ne:H.sibling=ne,H=ne);return Dt&&hi(v,V),D}for(ne=r(v,ne);V<S.length;V++)ee=E(ne,v,V,S[V],p),ee!==null&&(t&&ee.alternate!==null&&ne.delete(ee.key===null?V:ee.key),_=i(ee,_,V),H===null?D=ee:H.sibling=ee,H=ee);return t&&ne.forEach(function(ve){return e(v,ve)}),Dt&&hi(v,V),D}function w(v,_,S,p){var D=xa(S);if(typeof D!="function")throw Error(ce(150));if(S=D.call(S),S==null)throw Error(ce(151));for(var H=D=null,ne=_,V=_=0,ee=null,de=S.next();ne!==null&&!de.done;V++,de=S.next()){ne.index>V?(ee=ne,ne=null):ee=ne.sibling;var ve=f(v,ne,de.value,p);if(ve===null){ne===null&&(ne=ee);break}t&&ne&&ve.alternate===null&&e(v,ne),_=i(ve,_,V),H===null?D=ve:H.sibling=ve,H=ve,ne=ee}if(de.done)return n(v,ne),Dt&&hi(v,V),D;if(ne===null){for(;!de.done;V++,de=S.next())de=h(v,de.value,p),de!==null&&(_=i(de,_,V),H===null?D=de:H.sibling=de,H=de);return Dt&&hi(v,V),D}for(ne=r(v,ne);!de.done;V++,de=S.next())de=E(ne,v,V,de.value,p),de!==null&&(t&&de.alternate!==null&&ne.delete(de.key===null?V:de.key),_=i(de,_,V),H===null?D=de:H.sibling=de,H=de);return t&&ne.forEach(function(je){return e(v,je)}),Dt&&hi(v,V),D}function $(v,_,S,p){if(typeof S=="object"&&S!==null&&S.type===oo&&S.key===null&&(S=S.props.children),typeof S=="object"&&S!==null){switch(S.$$typeof){case kc:e:{for(var D=S.key,H=_;H!==null;){if(H.key===D){if(D=S.type,D===oo){if(H.tag===7){n(v,H.sibling),_=s(H,S.props.children),_.return=v,v=_;break e}}else if(H.elementType===D||typeof D=="object"&&D!==null&&D.$$typeof===bs&&wy(D)===H.type){n(v,H.sibling),_=s(H,S.props),_.ref=Ta(v,H,S),_.return=v,v=_;break e}n(v,H);break}else e(v,H);H=H.sibling}S.type===oo?(_=Si(S.props.children,v.mode,p,S.key),_.return=v,v=_):(p=dd(S.type,S.key,S.props,null,v.mode,p),p.ref=Ta(v,_,S),p.return=v,v=p)}return o(v);case io:e:{for(H=S.key;_!==null;){if(_.key===H)if(_.tag===4&&_.stateNode.containerInfo===S.containerInfo&&_.stateNode.implementation===S.implementation){n(v,_.sibling),_=s(_,S.children||[]),_.return=v,v=_;break e}else{n(v,_);break}else e(v,_);_=_.sibling}_=dh(S,v.mode,p),_.return=v,v=_}return o(v);case bs:return H=S._init,$(v,_,H(S._payload),p)}if(Ma(S))return k(v,_,S,p);if(xa(S))return w(v,_,S,p);Fc(v,S)}return typeof S=="string"&&S!==""||typeof S=="number"?(S=""+S,_!==null&&_.tag===6?(n(v,_.sibling),_=s(_,S),_.return=v,v=_):(n(v,_),_=ch(S,v.mode,p),_.return=v,v=_),o(v)):n(v,_)}return $}var No=Zx(!0),e1=Zx(!1),jd=ri(null),$d=null,go=null,Ig=null;function Tg(){Ig=go=$d=null}function wg(t){var e=jd.current;Pt(jd),t._currentValue=e}function sp(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function Io(t,e){$d=t,Ig=go=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Mn=!0),t.firstContext=null)}function ir(t){var e=t._currentValue;if(Ig!==t)if(t={context:t,memoizedValue:e,next:null},go===null){if($d===null)throw Error(ce(308));go=t,$d.dependencies={lanes:0,firstContext:t}}else go=go.next=t;return e}var _i=null;function Cg(t){_i===null?_i=[t]:_i.push(t)}function t1(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,Cg(e)):(n.next=s.next,s.next=n),e.interleaved=n,is(t,r)}function is(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Es=!1;function kg(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function n1(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function es(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Fs(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,ht&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,is(t,n)}return s=r.interleaved,s===null?(e.next=e,Cg(r)):(e.next=s.next,s.next=e),r.interleaved=e,is(t,n)}function sd(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,hg(t,n)}}function Cy(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=o:i=i.next=o,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Fd(t,e,n,r){var s=t.updateQueue;Es=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,l=s.shared.pending;if(l!==null){s.shared.pending=null;var c=l,d=c.next;c.next=null,o===null?i=d:o.next=d,o=c;var u=t.alternate;u!==null&&(u=u.updateQueue,l=u.lastBaseUpdate,l!==o&&(l===null?u.firstBaseUpdate=d:l.next=d,u.lastBaseUpdate=c))}if(i!==null){var h=s.baseState;o=0,u=d=c=null,l=i;do{var f=l.lane,E=l.eventTime;if((r&f)===f){u!==null&&(u=u.next={eventTime:E,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var k=t,w=l;switch(f=e,E=n,w.tag){case 1:if(k=w.payload,typeof k=="function"){h=k.call(E,h,f);break e}h=k;break e;case 3:k.flags=k.flags&-65537|128;case 0:if(k=w.payload,f=typeof k=="function"?k.call(E,h,f):k,f==null)break e;h=Ut({},h,f);break e;case 2:Es=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,f=s.effects,f===null?s.effects=[l]:f.push(l))}else E={eventTime:E,lane:f,tag:l.tag,payload:l.payload,callback:l.callback,next:null},u===null?(d=u=E,c=h):u=u.next=E,o|=f;if(l=l.next,l===null){if(l=s.shared.pending,l===null)break;f=l,l=f.next,f.next=null,s.lastBaseUpdate=f,s.shared.pending=null}}while(!0);if(u===null&&(c=h),s.baseState=c,s.firstBaseUpdate=d,s.lastBaseUpdate=u,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);Ci|=o,t.lanes=o,t.memoizedState=h}}function ky(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(ce(191,s));s.call(r)}}}var zl={},jr=ri(zl),vl=ri(zl),_l=ri(zl);function xi(t){if(t===zl)throw Error(ce(174));return t}function Rg(t,e){switch(Rt(_l,e),Rt(vl,t),Rt(jr,zl),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:$h(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=$h(e,t)}Pt(jr),Rt(jr,e)}function jo(){Pt(jr),Pt(vl),Pt(_l)}function r1(t){xi(_l.current);var e=xi(jr.current),n=$h(e,t.type);e!==n&&(Rt(vl,t),Rt(jr,n))}function Ag(t){vl.current===t&&(Pt(jr),Pt(vl))}var Nt=ri(0);function Ud(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var rh=[];function Pg(){for(var t=0;t<rh.length;t++)rh[t]._workInProgressVersionPrimary=null;rh.length=0}var id=ds.ReactCurrentDispatcher,sh=ds.ReactCurrentBatchConfig,wi=0,Ft=null,Kt=null,en=null,Bd=!1,Va=!1,xl=0,kw=0;function gn(){throw Error(ce(321))}function Og(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!br(t[n],e[n]))return!1;return!0}function Lg(t,e,n,r,s,i){if(wi=i,Ft=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,id.current=t===null||t.memoizedState===null?Ow:Lw,t=n(r,s),Va){i=0;do{if(Va=!1,xl=0,25<=i)throw Error(ce(301));i+=1,en=Kt=null,e.updateQueue=null,id.current=Dw,t=n(r,s)}while(Va)}if(id.current=zd,e=Kt!==null&&Kt.next!==null,wi=0,en=Kt=Ft=null,Bd=!1,e)throw Error(ce(300));return t}function Dg(){var t=xl!==0;return xl=0,t}function Pr(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return en===null?Ft.memoizedState=en=t:en=en.next=t,en}function or(){if(Kt===null){var t=Ft.alternate;t=t!==null?t.memoizedState:null}else t=Kt.next;var e=en===null?Ft.memoizedState:en.next;if(e!==null)en=e,Kt=t;else{if(t===null)throw Error(ce(310));Kt=t,t={memoizedState:Kt.memoizedState,baseState:Kt.baseState,baseQueue:Kt.baseQueue,queue:Kt.queue,next:null},en===null?Ft.memoizedState=en=t:en=en.next=t}return en}function bl(t,e){return typeof e=="function"?e(t):e}function ih(t){var e=or(),n=e.queue;if(n===null)throw Error(ce(311));n.lastRenderedReducer=t;var r=Kt,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var l=o=null,c=null,d=i;do{var u=d.lane;if((wi&u)===u)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:t(r,d.action);else{var h={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(l=c=h,o=r):c=c.next=h,Ft.lanes|=u,Ci|=u}d=d.next}while(d!==null&&d!==i);c===null?o=r:c.next=l,br(r,e.memoizedState)||(Mn=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=c,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,Ft.lanes|=i,Ci|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function oh(t){var e=or(),n=e.queue;if(n===null)throw Error(ce(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var o=s=s.next;do i=t(i,o.action),o=o.next;while(o!==s);br(i,e.memoizedState)||(Mn=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function s1(){}function i1(t,e){var n=Ft,r=or(),s=e(),i=!br(r.memoizedState,s);if(i&&(r.memoizedState=s,Mn=!0),r=r.queue,Mg(l1.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||en!==null&&en.memoizedState.tag&1){if(n.flags|=2048,El(9,a1.bind(null,n,r,s,e),void 0,null),rn===null)throw Error(ce(349));wi&30||o1(n,e,s)}return s}function o1(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Ft.updateQueue,e===null?(e={lastEffect:null,stores:null},Ft.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function a1(t,e,n,r){e.value=n,e.getSnapshot=r,c1(e)&&d1(t)}function l1(t,e,n){return n(function(){c1(e)&&d1(t)})}function c1(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!br(t,n)}catch{return!0}}function d1(t){var e=is(t,1);e!==null&&_r(e,t,1,-1)}function Ry(t){var e=Pr();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:bl,lastRenderedState:t},e.queue=t,t=t.dispatch=Pw.bind(null,Ft,t),[e.memoizedState,t]}function El(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=Ft.updateQueue,e===null?(e={lastEffect:null,stores:null},Ft.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function u1(){return or().memoizedState}function od(t,e,n,r){var s=Pr();Ft.flags|=t,s.memoizedState=El(1|e,n,void 0,r===void 0?null:r)}function Cu(t,e,n,r){var s=or();r=r===void 0?null:r;var i=void 0;if(Kt!==null){var o=Kt.memoizedState;if(i=o.destroy,r!==null&&Og(r,o.deps)){s.memoizedState=El(e,n,i,r);return}}Ft.flags|=t,s.memoizedState=El(1|e,n,i,r)}function Ay(t,e){return od(8390656,8,t,e)}function Mg(t,e){return Cu(2048,8,t,e)}function f1(t,e){return Cu(4,2,t,e)}function h1(t,e){return Cu(4,4,t,e)}function p1(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function g1(t,e,n){return n=n!=null?n.concat([t]):null,Cu(4,4,p1.bind(null,e,t),n)}function Ng(){}function m1(t,e){var n=or();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Og(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function y1(t,e){var n=or();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Og(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function v1(t,e,n){return wi&21?(br(n,e)||(n=Sx(),Ft.lanes|=n,Ci|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Mn=!0),t.memoizedState=n)}function Rw(t,e){var n=bt;bt=n!==0&&4>n?n:4,t(!0);var r=sh.transition;sh.transition={};try{t(!1),e()}finally{bt=n,sh.transition=r}}function _1(){return or().memoizedState}function Aw(t,e,n){var r=Bs(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},x1(t))b1(e,n);else if(n=t1(t,e,n,r),n!==null){var s=wn();_r(n,t,r,s),E1(n,e,r)}}function Pw(t,e,n){var r=Bs(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(x1(t))b1(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,l=i(o,n);if(s.hasEagerState=!0,s.eagerState=l,br(l,o)){var c=e.interleaved;c===null?(s.next=s,Cg(e)):(s.next=c.next,c.next=s),e.interleaved=s;return}}catch{}finally{}n=t1(t,e,s,r),n!==null&&(s=wn(),_r(n,t,r,s),E1(n,e,r))}}function x1(t){var e=t.alternate;return t===Ft||e!==null&&e===Ft}function b1(t,e){Va=Bd=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function E1(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,hg(t,n)}}var zd={readContext:ir,useCallback:gn,useContext:gn,useEffect:gn,useImperativeHandle:gn,useInsertionEffect:gn,useLayoutEffect:gn,useMemo:gn,useReducer:gn,useRef:gn,useState:gn,useDebugValue:gn,useDeferredValue:gn,useTransition:gn,useMutableSource:gn,useSyncExternalStore:gn,useId:gn,unstable_isNewReconciler:!1},Ow={readContext:ir,useCallback:function(t,e){return Pr().memoizedState=[t,e===void 0?null:e],t},useContext:ir,useEffect:Ay,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,od(4194308,4,p1.bind(null,e,t),n)},useLayoutEffect:function(t,e){return od(4194308,4,t,e)},useInsertionEffect:function(t,e){return od(4,2,t,e)},useMemo:function(t,e){var n=Pr();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Pr();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=Aw.bind(null,Ft,t),[r.memoizedState,t]},useRef:function(t){var e=Pr();return t={current:t},e.memoizedState=t},useState:Ry,useDebugValue:Ng,useDeferredValue:function(t){return Pr().memoizedState=t},useTransition:function(){var t=Ry(!1),e=t[0];return t=Rw.bind(null,t[1]),Pr().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=Ft,s=Pr();if(Dt){if(n===void 0)throw Error(ce(407));n=n()}else{if(n=e(),rn===null)throw Error(ce(349));wi&30||o1(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,Ay(l1.bind(null,r,i,t),[t]),r.flags|=2048,El(9,a1.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=Pr(),e=rn.identifierPrefix;if(Dt){var n=Qr,r=Xr;n=(r&~(1<<32-vr(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=xl++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=kw++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},Lw={readContext:ir,useCallback:m1,useContext:ir,useEffect:Mg,useImperativeHandle:g1,useInsertionEffect:f1,useLayoutEffect:h1,useMemo:y1,useReducer:ih,useRef:u1,useState:function(){return ih(bl)},useDebugValue:Ng,useDeferredValue:function(t){var e=or();return v1(e,Kt.memoizedState,t)},useTransition:function(){var t=ih(bl)[0],e=or().memoizedState;return[t,e]},useMutableSource:s1,useSyncExternalStore:i1,useId:_1,unstable_isNewReconciler:!1},Dw={readContext:ir,useCallback:m1,useContext:ir,useEffect:Mg,useImperativeHandle:g1,useInsertionEffect:f1,useLayoutEffect:h1,useMemo:y1,useReducer:oh,useRef:u1,useState:function(){return oh(bl)},useDebugValue:Ng,useDeferredValue:function(t){var e=or();return Kt===null?e.memoizedState=t:v1(e,Kt.memoizedState,t)},useTransition:function(){var t=oh(bl)[0],e=or().memoizedState;return[t,e]},useMutableSource:s1,useSyncExternalStore:i1,useId:_1,unstable_isNewReconciler:!1};function ur(t,e){if(t&&t.defaultProps){e=Ut({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function ip(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:Ut({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var ku={isMounted:function(t){return(t=t._reactInternals)?ji(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=wn(),s=Bs(t),i=es(r,s);i.payload=e,n!=null&&(i.callback=n),e=Fs(t,i,s),e!==null&&(_r(e,t,s,r),sd(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=wn(),s=Bs(t),i=es(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=Fs(t,i,s),e!==null&&(_r(e,t,s,r),sd(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=wn(),r=Bs(t),s=es(n,r);s.tag=2,e!=null&&(s.callback=e),e=Fs(t,s,r),e!==null&&(_r(e,t,r,n),sd(e,t,r))}};function Py(t,e,n,r,s,i,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!pl(n,r)||!pl(s,i):!0}function S1(t,e,n){var r=!1,s=Qs,i=e.contextType;return typeof i=="object"&&i!==null?i=ir(i):(s=$n(e)?Ii:_n.current,r=e.contextTypes,i=(r=r!=null)?Do(t,s):Qs),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=ku,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function Oy(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&ku.enqueueReplaceState(e,e.state,null)}function op(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},kg(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=ir(i):(i=$n(e)?Ii:_n.current,s.context=Do(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(ip(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&ku.enqueueReplaceState(s,s.state,null),Fd(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function $o(t,e){try{var n="",r=e;do n+=lT(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function ah(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function ap(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var Mw=typeof WeakMap=="function"?WeakMap:Map;function I1(t,e,n){n=es(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Wd||(Wd=!0,yp=r),ap(t,e)},n}function T1(t,e,n){n=es(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){ap(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){ap(t,e),typeof r!="function"&&(Us===null?Us=new Set([this]):Us.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function Ly(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new Mw;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=Xw.bind(null,t,e,n),e.then(t,t))}function Dy(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function My(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=es(-1,1),e.tag=2,Fs(n,e,1))),n.lanes|=1),t)}var Nw=ds.ReactCurrentOwner,Mn=!1;function In(t,e,n,r){e.child=t===null?e1(e,null,n,r):No(e,t.child,n,r)}function Ny(t,e,n,r,s){n=n.render;var i=e.ref;return Io(e,s),r=Lg(t,e,n,r,i,s),n=Dg(),t!==null&&!Mn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,os(t,e,s)):(Dt&&n&&bg(e),e.flags|=1,In(t,e,r,s),e.child)}function jy(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!Wg(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,w1(t,e,i,r,s)):(t=dd(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var o=i.memoizedProps;if(n=n.compare,n=n!==null?n:pl,n(o,r)&&t.ref===e.ref)return os(t,e,s)}return e.flags|=1,t=zs(i,r),t.ref=e.ref,t.return=e,e.child=t}function w1(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(pl(i,r)&&t.ref===e.ref)if(Mn=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(Mn=!0);else return e.lanes=t.lanes,os(t,e,s)}return lp(t,e,n,r,s)}function C1(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Rt(yo,Hn),Hn|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Rt(yo,Hn),Hn|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,Rt(yo,Hn),Hn|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,Rt(yo,Hn),Hn|=r;return In(t,e,s,n),e.child}function k1(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function lp(t,e,n,r,s){var i=$n(n)?Ii:_n.current;return i=Do(e,i),Io(e,s),n=Lg(t,e,n,r,i,s),r=Dg(),t!==null&&!Mn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,os(t,e,s)):(Dt&&r&&bg(e),e.flags|=1,In(t,e,n,s),e.child)}function $y(t,e,n,r,s){if($n(n)){var i=!0;Dd(e)}else i=!1;if(Io(e,s),e.stateNode===null)ad(t,e),S1(e,n,r),op(e,n,r,s),r=!0;else if(t===null){var o=e.stateNode,l=e.memoizedProps;o.props=l;var c=o.context,d=n.contextType;typeof d=="object"&&d!==null?d=ir(d):(d=$n(n)?Ii:_n.current,d=Do(e,d));var u=n.getDerivedStateFromProps,h=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==r||c!==d)&&Oy(e,o,r,d),Es=!1;var f=e.memoizedState;o.state=f,Fd(e,r,o,s),c=e.memoizedState,l!==r||f!==c||jn.current||Es?(typeof u=="function"&&(ip(e,n,u,r),c=e.memoizedState),(l=Es||Py(e,n,l,r,f,c,d))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),o.props=r,o.state=c,o.context=d,r=l):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,n1(t,e),l=e.memoizedProps,d=e.type===e.elementType?l:ur(e.type,l),o.props=d,h=e.pendingProps,f=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=ir(c):(c=$n(n)?Ii:_n.current,c=Do(e,c));var E=n.getDerivedStateFromProps;(u=typeof E=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==h||f!==c)&&Oy(e,o,r,c),Es=!1,f=e.memoizedState,o.state=f,Fd(e,r,o,s);var k=e.memoizedState;l!==h||f!==k||jn.current||Es?(typeof E=="function"&&(ip(e,n,E,r),k=e.memoizedState),(d=Es||Py(e,n,d,r,f,k,c)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,k,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,k,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=k),o.props=r,o.state=k,o.context=c,r=d):(typeof o.componentDidUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),r=!1)}return cp(t,e,n,r,i,s)}function cp(t,e,n,r,s,i){k1(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&Sy(e,n,!1),os(t,e,i);r=e.stateNode,Nw.current=e;var l=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=No(e,t.child,null,i),e.child=No(e,null,l,i)):In(t,e,l,i),e.memoizedState=r.state,s&&Sy(e,n,!0),e.child}function R1(t){var e=t.stateNode;e.pendingContext?Ey(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Ey(t,e.context,!1),Rg(t,e.containerInfo)}function Fy(t,e,n,r,s){return Mo(),Sg(s),e.flags|=256,In(t,e,n,r),e.child}var dp={dehydrated:null,treeContext:null,retryLane:0};function up(t){return{baseLanes:t,cachePool:null,transitions:null}}function A1(t,e,n){var r=e.pendingProps,s=Nt.current,i=!1,o=(e.flags&128)!==0,l;if((l=o)||(l=t!==null&&t.memoizedState===null?!1:(s&2)!==0),l?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),Rt(Nt,s&1),t===null)return rp(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=Pu(o,r,0,null),t=Si(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=up(n),e.memoizedState=dp,t):jg(e,o));if(s=t.memoizedState,s!==null&&(l=s.dehydrated,l!==null))return jw(t,e,o,r,l,s,n);if(i){i=r.fallback,o=e.mode,s=t.child,l=s.sibling;var c={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=zs(s,c),r.subtreeFlags=s.subtreeFlags&14680064),l!==null?i=zs(l,i):(i=Si(i,o,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=t.child.memoizedState,o=o===null?up(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=t.childLanes&~n,e.memoizedState=dp,r}return i=t.child,t=i.sibling,r=zs(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function jg(t,e){return e=Pu({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Uc(t,e,n,r){return r!==null&&Sg(r),No(e,t.child,null,n),t=jg(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function jw(t,e,n,r,s,i,o){if(n)return e.flags&256?(e.flags&=-257,r=ah(Error(ce(422))),Uc(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=Pu({mode:"visible",children:r.children},s,0,null),i=Si(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&No(e,t.child,null,o),e.child.memoizedState=up(o),e.memoizedState=dp,i);if(!(e.mode&1))return Uc(t,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var l=r.dgst;return r=l,i=Error(ce(419)),r=ah(i,r,void 0),Uc(t,e,o,r)}if(l=(o&t.childLanes)!==0,Mn||l){if(r=rn,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,is(t,s),_r(r,t,s,-1))}return Hg(),r=ah(Error(ce(421))),Uc(t,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=Qw.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,Wn=$s(s.nextSibling),Gn=e,Dt=!0,hr=null,t!==null&&(qn[Zn++]=Xr,qn[Zn++]=Qr,qn[Zn++]=Ti,Xr=t.id,Qr=t.overflow,Ti=e),e=jg(e,r.children),e.flags|=4096,e)}function Uy(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),sp(t.return,e,n)}function lh(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function P1(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(In(t,e,r.children,n),r=Nt.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Uy(t,n,e);else if(t.tag===19)Uy(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(Rt(Nt,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&Ud(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),lh(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&Ud(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}lh(e,!0,n,null,i);break;case"together":lh(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function ad(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function os(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Ci|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(ce(153));if(e.child!==null){for(t=e.child,n=zs(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=zs(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function $w(t,e,n){switch(e.tag){case 3:R1(e),Mo();break;case 5:r1(e);break;case 1:$n(e.type)&&Dd(e);break;case 4:Rg(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;Rt(jd,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Rt(Nt,Nt.current&1),e.flags|=128,null):n&e.child.childLanes?A1(t,e,n):(Rt(Nt,Nt.current&1),t=os(t,e,n),t!==null?t.sibling:null);Rt(Nt,Nt.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return P1(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Rt(Nt,Nt.current),r)break;return null;case 22:case 23:return e.lanes=0,C1(t,e,n)}return os(t,e,n)}var O1,fp,L1,D1;O1=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};fp=function(){};L1=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,xi(jr.current);var i=null;switch(n){case"input":s=Dh(t,s),r=Dh(t,r),i=[];break;case"select":s=Ut({},s,{value:void 0}),r=Ut({},r,{value:void 0}),i=[];break;case"textarea":s=jh(t,s),r=jh(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Od)}Fh(n,r);var o;n=null;for(d in s)if(!r.hasOwnProperty(d)&&s.hasOwnProperty(d)&&s[d]!=null)if(d==="style"){var l=s[d];for(o in l)l.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(al.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in r){var c=r[d];if(l=s!=null?s[d]:void 0,r.hasOwnProperty(d)&&c!==l&&(c!=null||l!=null))if(d==="style")if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(i||(i=[]),i.push(d,n)),n=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(i=i||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(al.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&At("scroll",t),i||l===c||(i=[])):(i=i||[]).push(d,c))}n&&(i=i||[]).push("style",n);var d=i;(e.updateQueue=d)&&(e.flags|=4)}};D1=function(t,e,n,r){n!==r&&(e.flags|=4)};function wa(t,e){if(!Dt)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function mn(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function Fw(t,e,n){var r=e.pendingProps;switch(Eg(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return mn(e),null;case 1:return $n(e.type)&&Ld(),mn(e),null;case 3:return r=e.stateNode,jo(),Pt(jn),Pt(_n),Pg(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&($c(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,hr!==null&&(xp(hr),hr=null))),fp(t,e),mn(e),null;case 5:Ag(e);var s=xi(_l.current);if(n=e.type,t!==null&&e.stateNode!=null)L1(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(ce(166));return mn(e),null}if(t=xi(jr.current),$c(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[Or]=e,r[yl]=i,t=(e.mode&1)!==0,n){case"dialog":At("cancel",r),At("close",r);break;case"iframe":case"object":case"embed":At("load",r);break;case"video":case"audio":for(s=0;s<ja.length;s++)At(ja[s],r);break;case"source":At("error",r);break;case"img":case"image":case"link":At("error",r),At("load",r);break;case"details":At("toggle",r);break;case"input":Xm(r,i),At("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},At("invalid",r);break;case"textarea":Jm(r,i),At("invalid",r)}Fh(n,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var l=i[o];o==="children"?typeof l=="string"?r.textContent!==l&&(i.suppressHydrationWarning!==!0&&jc(r.textContent,l,t),s=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(i.suppressHydrationWarning!==!0&&jc(r.textContent,l,t),s=["children",""+l]):al.hasOwnProperty(o)&&l!=null&&o==="onScroll"&&At("scroll",r)}switch(n){case"input":Rc(r),Qm(r,i,!0);break;case"textarea":Rc(r),qm(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=Od)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=lx(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[Or]=e,t[yl]=r,O1(t,e,!1,!1),e.stateNode=t;e:{switch(o=Uh(n,r),n){case"dialog":At("cancel",t),At("close",t),s=r;break;case"iframe":case"object":case"embed":At("load",t),s=r;break;case"video":case"audio":for(s=0;s<ja.length;s++)At(ja[s],t);s=r;break;case"source":At("error",t),s=r;break;case"img":case"image":case"link":At("error",t),At("load",t),s=r;break;case"details":At("toggle",t),s=r;break;case"input":Xm(t,r),s=Dh(t,r),At("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=Ut({},r,{value:void 0}),At("invalid",t);break;case"textarea":Jm(t,r),s=jh(t,r),At("invalid",t);break;default:s=r}Fh(n,s),l=s;for(i in l)if(l.hasOwnProperty(i)){var c=l[i];i==="style"?ux(t,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&cx(t,c)):i==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&ll(t,c):typeof c=="number"&&ll(t,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(al.hasOwnProperty(i)?c!=null&&i==="onScroll"&&At("scroll",t):c!=null&&ag(t,i,c,o))}switch(n){case"input":Rc(t),Qm(t,r,!1);break;case"textarea":Rc(t),qm(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Xs(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?xo(t,!!r.multiple,i,!1):r.defaultValue!=null&&xo(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=Od)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return mn(e),null;case 6:if(t&&e.stateNode!=null)D1(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(ce(166));if(n=xi(_l.current),xi(jr.current),$c(e)){if(r=e.stateNode,n=e.memoizedProps,r[Or]=e,(i=r.nodeValue!==n)&&(t=Gn,t!==null))switch(t.tag){case 3:jc(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&jc(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Or]=e,e.stateNode=r}return mn(e),null;case 13:if(Pt(Nt),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Dt&&Wn!==null&&e.mode&1&&!(e.flags&128))qx(),Mo(),e.flags|=98560,i=!1;else if(i=$c(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(ce(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(ce(317));i[Or]=e}else Mo(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;mn(e),i=!1}else hr!==null&&(xp(hr),hr=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||Nt.current&1?Qt===0&&(Qt=3):Hg())),e.updateQueue!==null&&(e.flags|=4),mn(e),null);case 4:return jo(),fp(t,e),t===null&&gl(e.stateNode.containerInfo),mn(e),null;case 10:return wg(e.type._context),mn(e),null;case 17:return $n(e.type)&&Ld(),mn(e),null;case 19:if(Pt(Nt),i=e.memoizedState,i===null)return mn(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)wa(i,!1);else{if(Qt!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=Ud(t),o!==null){for(e.flags|=128,wa(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,t=o.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Rt(Nt,Nt.current&1|2),e.child}t=t.sibling}i.tail!==null&&Ht()>Fo&&(e.flags|=128,r=!0,wa(i,!1),e.lanes=4194304)}else{if(!r)if(t=Ud(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),wa(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!Dt)return mn(e),null}else 2*Ht()-i.renderingStartTime>Fo&&n!==1073741824&&(e.flags|=128,r=!0,wa(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(n=i.last,n!==null?n.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Ht(),e.sibling=null,n=Nt.current,Rt(Nt,r?n&1|2:n&1),e):(mn(e),null);case 22:case 23:return zg(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Hn&1073741824&&(mn(e),e.subtreeFlags&6&&(e.flags|=8192)):mn(e),null;case 24:return null;case 25:return null}throw Error(ce(156,e.tag))}function Uw(t,e){switch(Eg(e),e.tag){case 1:return $n(e.type)&&Ld(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return jo(),Pt(jn),Pt(_n),Pg(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Ag(e),null;case 13:if(Pt(Nt),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(ce(340));Mo()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Pt(Nt),null;case 4:return jo(),null;case 10:return wg(e.type._context),null;case 22:case 23:return zg(),null;case 24:return null;default:return null}}var Bc=!1,vn=!1,Bw=typeof WeakSet=="function"?WeakSet:Set,xe=null;function mo(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){Bt(t,e,r)}else n.current=null}function hp(t,e,n){try{n()}catch(r){Bt(t,e,r)}}var By=!1;function zw(t,e){if(Qh=Rd,t=Fx(),xg(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var o=0,l=-1,c=-1,d=0,u=0,h=t,f=null;t:for(;;){for(var E;h!==n||s!==0&&h.nodeType!==3||(l=o+s),h!==i||r!==0&&h.nodeType!==3||(c=o+r),h.nodeType===3&&(o+=h.nodeValue.length),(E=h.firstChild)!==null;)f=h,h=E;for(;;){if(h===t)break t;if(f===n&&++d===s&&(l=o),f===i&&++u===r&&(c=o),(E=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=E}n=l===-1||c===-1?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Jh={focusedElem:t,selectionRange:n},Rd=!1,xe=e;xe!==null;)if(e=xe,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,xe=t;else for(;xe!==null;){e=xe;try{var k=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(k!==null){var w=k.memoizedProps,$=k.memoizedState,v=e.stateNode,_=v.getSnapshotBeforeUpdate(e.elementType===e.type?w:ur(e.type,w),$);v.__reactInternalSnapshotBeforeUpdate=_}break;case 3:var S=e.stateNode.containerInfo;S.nodeType===1?S.textContent="":S.nodeType===9&&S.documentElement&&S.removeChild(S.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ce(163))}}catch(p){Bt(e,e.return,p)}if(t=e.sibling,t!==null){t.return=e.return,xe=t;break}xe=e.return}return k=By,By=!1,k}function Ya(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&hp(e,n,i)}s=s.next}while(s!==r)}}function Ru(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function pp(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function M1(t){var e=t.alternate;e!==null&&(t.alternate=null,M1(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Or],delete e[yl],delete e[ep],delete e[Iw],delete e[Tw])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function N1(t){return t.tag===5||t.tag===3||t.tag===4}function zy(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||N1(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function gp(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Od));else if(r!==4&&(t=t.child,t!==null))for(gp(t,e,n),t=t.sibling;t!==null;)gp(t,e,n),t=t.sibling}function mp(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(mp(t,e,n),t=t.sibling;t!==null;)mp(t,e,n),t=t.sibling}var dn=null,fr=!1;function _s(t,e,n){for(n=n.child;n!==null;)j1(t,e,n),n=n.sibling}function j1(t,e,n){if(Nr&&typeof Nr.onCommitFiberUnmount=="function")try{Nr.onCommitFiberUnmount(bu,n)}catch{}switch(n.tag){case 5:vn||mo(n,e);case 6:var r=dn,s=fr;dn=null,_s(t,e,n),dn=r,fr=s,dn!==null&&(fr?(t=dn,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):dn.removeChild(n.stateNode));break;case 18:dn!==null&&(fr?(t=dn,n=n.stateNode,t.nodeType===8?th(t.parentNode,n):t.nodeType===1&&th(t,n),fl(t)):th(dn,n.stateNode));break;case 4:r=dn,s=fr,dn=n.stateNode.containerInfo,fr=!0,_s(t,e,n),dn=r,fr=s;break;case 0:case 11:case 14:case 15:if(!vn&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&hp(n,e,o),s=s.next}while(s!==r)}_s(t,e,n);break;case 1:if(!vn&&(mo(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(l){Bt(n,e,l)}_s(t,e,n);break;case 21:_s(t,e,n);break;case 22:n.mode&1?(vn=(r=vn)||n.memoizedState!==null,_s(t,e,n),vn=r):_s(t,e,n);break;default:_s(t,e,n)}}function Hy(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new Bw),e.forEach(function(r){var s=Jw.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function dr(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,o=e,l=o;e:for(;l!==null;){switch(l.tag){case 5:dn=l.stateNode,fr=!1;break e;case 3:dn=l.stateNode.containerInfo,fr=!0;break e;case 4:dn=l.stateNode.containerInfo,fr=!0;break e}l=l.return}if(dn===null)throw Error(ce(160));j1(i,o,s),dn=null,fr=!1;var c=s.alternate;c!==null&&(c.return=null),s.return=null}catch(d){Bt(s,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)$1(e,t),e=e.sibling}function $1(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(dr(e,t),Ar(t),r&4){try{Ya(3,t,t.return),Ru(3,t)}catch(w){Bt(t,t.return,w)}try{Ya(5,t,t.return)}catch(w){Bt(t,t.return,w)}}break;case 1:dr(e,t),Ar(t),r&512&&n!==null&&mo(n,n.return);break;case 5:if(dr(e,t),Ar(t),r&512&&n!==null&&mo(n,n.return),t.flags&32){var s=t.stateNode;try{ll(s,"")}catch(w){Bt(t,t.return,w)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,o=n!==null?n.memoizedProps:i,l=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{l==="input"&&i.type==="radio"&&i.name!=null&&ox(s,i),Uh(l,o);var d=Uh(l,i);for(o=0;o<c.length;o+=2){var u=c[o],h=c[o+1];u==="style"?ux(s,h):u==="dangerouslySetInnerHTML"?cx(s,h):u==="children"?ll(s,h):ag(s,u,h,d)}switch(l){case"input":Mh(s,i);break;case"textarea":ax(s,i);break;case"select":var f=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var E=i.value;E!=null?xo(s,!!i.multiple,E,!1):f!==!!i.multiple&&(i.defaultValue!=null?xo(s,!!i.multiple,i.defaultValue,!0):xo(s,!!i.multiple,i.multiple?[]:"",!1))}s[yl]=i}catch(w){Bt(t,t.return,w)}}break;case 6:if(dr(e,t),Ar(t),r&4){if(t.stateNode===null)throw Error(ce(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(w){Bt(t,t.return,w)}}break;case 3:if(dr(e,t),Ar(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{fl(e.containerInfo)}catch(w){Bt(t,t.return,w)}break;case 4:dr(e,t),Ar(t);break;case 13:dr(e,t),Ar(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(Ug=Ht())),r&4&&Hy(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(vn=(d=vn)||u,dr(e,t),vn=d):dr(e,t),Ar(t),r&8192){if(d=t.memoizedState!==null,(t.stateNode.isHidden=d)&&!u&&t.mode&1)for(xe=t,u=t.child;u!==null;){for(h=xe=u;xe!==null;){switch(f=xe,E=f.child,f.tag){case 0:case 11:case 14:case 15:Ya(4,f,f.return);break;case 1:mo(f,f.return);var k=f.stateNode;if(typeof k.componentWillUnmount=="function"){r=f,n=f.return;try{e=r,k.props=e.memoizedProps,k.state=e.memoizedState,k.componentWillUnmount()}catch(w){Bt(r,n,w)}}break;case 5:mo(f,f.return);break;case 22:if(f.memoizedState!==null){Gy(h);continue}}E!==null?(E.return=f,xe=E):Gy(h)}u=u.sibling}e:for(u=null,h=t;;){if(h.tag===5){if(u===null){u=h;try{s=h.stateNode,d?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(l=h.stateNode,c=h.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=dx("display",o))}catch(w){Bt(t,t.return,w)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=d?"":h.memoizedProps}catch(w){Bt(t,t.return,w)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===t)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===t)break e;for(;h.sibling===null;){if(h.return===null||h.return===t)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:dr(e,t),Ar(t),r&4&&Hy(t);break;case 21:break;default:dr(e,t),Ar(t)}}function Ar(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(N1(n)){var r=n;break e}n=n.return}throw Error(ce(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(ll(s,""),r.flags&=-33);var i=zy(t);mp(t,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,l=zy(t);gp(t,l,o);break;default:throw Error(ce(161))}}catch(c){Bt(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function Hw(t,e,n){xe=t,F1(t)}function F1(t,e,n){for(var r=(t.mode&1)!==0;xe!==null;){var s=xe,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||Bc;if(!o){var l=s.alternate,c=l!==null&&l.memoizedState!==null||vn;l=Bc;var d=vn;if(Bc=o,(vn=c)&&!d)for(xe=s;xe!==null;)o=xe,c=o.child,o.tag===22&&o.memoizedState!==null?Vy(s):c!==null?(c.return=o,xe=c):Vy(s);for(;i!==null;)xe=i,F1(i),i=i.sibling;xe=s,Bc=l,vn=d}Wy(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,xe=i):Wy(t)}}function Wy(t){for(;xe!==null;){var e=xe;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:vn||Ru(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!vn)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:ur(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&ky(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}ky(e,o,n)}break;case 5:var l=e.stateNode;if(n===null&&e.flags&4){n=l;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var u=d.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&fl(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ce(163))}vn||e.flags&512&&pp(e)}catch(f){Bt(e,e.return,f)}}if(e===t){xe=null;break}if(n=e.sibling,n!==null){n.return=e.return,xe=n;break}xe=e.return}}function Gy(t){for(;xe!==null;){var e=xe;if(e===t){xe=null;break}var n=e.sibling;if(n!==null){n.return=e.return,xe=n;break}xe=e.return}}function Vy(t){for(;xe!==null;){var e=xe;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Ru(4,e)}catch(c){Bt(e,n,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(c){Bt(e,s,c)}}var i=e.return;try{pp(e)}catch(c){Bt(e,i,c)}break;case 5:var o=e.return;try{pp(e)}catch(c){Bt(e,o,c)}}}catch(c){Bt(e,e.return,c)}if(e===t){xe=null;break}var l=e.sibling;if(l!==null){l.return=e.return,xe=l;break}xe=e.return}}var Ww=Math.ceil,Hd=ds.ReactCurrentDispatcher,$g=ds.ReactCurrentOwner,sr=ds.ReactCurrentBatchConfig,ht=0,rn=null,Vt=null,un=0,Hn=0,yo=ri(0),Qt=0,Sl=null,Ci=0,Au=0,Fg=0,Ka=null,Dn=null,Ug=0,Fo=1/0,Vr=null,Wd=!1,yp=null,Us=null,zc=!1,Ps=null,Gd=0,Xa=0,vp=null,ld=-1,cd=0;function wn(){return ht&6?Ht():ld!==-1?ld:ld=Ht()}function Bs(t){return t.mode&1?ht&2&&un!==0?un&-un:Cw.transition!==null?(cd===0&&(cd=Sx()),cd):(t=bt,t!==0||(t=window.event,t=t===void 0?16:Ax(t.type)),t):1}function _r(t,e,n,r){if(50<Xa)throw Xa=0,vp=null,Error(ce(185));Fl(t,n,r),(!(ht&2)||t!==rn)&&(t===rn&&(!(ht&2)&&(Au|=n),Qt===4&&Is(t,un)),Fn(t,r),n===1&&ht===0&&!(e.mode&1)&&(Fo=Ht()+500,wu&&si()))}function Fn(t,e){var n=t.callbackNode;CT(t,e);var r=kd(t,t===rn?un:0);if(r===0)n!==null&&ty(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&ty(n),e===1)t.tag===0?ww(Yy.bind(null,t)):Xx(Yy.bind(null,t)),Ew(function(){!(ht&6)&&si()}),n=null;else{switch(Ix(r)){case 1:n=fg;break;case 4:n=bx;break;case 16:n=Cd;break;case 536870912:n=Ex;break;default:n=Cd}n=Y1(n,U1.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function U1(t,e){if(ld=-1,cd=0,ht&6)throw Error(ce(327));var n=t.callbackNode;if(To()&&t.callbackNode!==n)return null;var r=kd(t,t===rn?un:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=Vd(t,r);else{e=r;var s=ht;ht|=2;var i=z1();(rn!==t||un!==e)&&(Vr=null,Fo=Ht()+500,Ei(t,e));do try{Yw();break}catch(l){B1(t,l)}while(!0);Tg(),Hd.current=i,ht=s,Vt!==null?e=0:(rn=null,un=0,e=Qt)}if(e!==0){if(e===2&&(s=Gh(t),s!==0&&(r=s,e=_p(t,s))),e===1)throw n=Sl,Ei(t,0),Is(t,r),Fn(t,Ht()),n;if(e===6)Is(t,r);else{if(s=t.current.alternate,!(r&30)&&!Gw(s)&&(e=Vd(t,r),e===2&&(i=Gh(t),i!==0&&(r=i,e=_p(t,i))),e===1))throw n=Sl,Ei(t,0),Is(t,r),Fn(t,Ht()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(ce(345));case 2:pi(t,Dn,Vr);break;case 3:if(Is(t,r),(r&130023424)===r&&(e=Ug+500-Ht(),10<e)){if(kd(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){wn(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=Zh(pi.bind(null,t,Dn,Vr),e);break}pi(t,Dn,Vr);break;case 4:if(Is(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var o=31-vr(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=Ht()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Ww(r/1960))-r,10<r){t.timeoutHandle=Zh(pi.bind(null,t,Dn,Vr),r);break}pi(t,Dn,Vr);break;case 5:pi(t,Dn,Vr);break;default:throw Error(ce(329))}}}return Fn(t,Ht()),t.callbackNode===n?U1.bind(null,t):null}function _p(t,e){var n=Ka;return t.current.memoizedState.isDehydrated&&(Ei(t,e).flags|=256),t=Vd(t,e),t!==2&&(e=Dn,Dn=n,e!==null&&xp(e)),t}function xp(t){Dn===null?Dn=t:Dn.push.apply(Dn,t)}function Gw(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!br(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Is(t,e){for(e&=~Fg,e&=~Au,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-vr(e),r=1<<n;t[n]=-1,e&=~r}}function Yy(t){if(ht&6)throw Error(ce(327));To();var e=kd(t,0);if(!(e&1))return Fn(t,Ht()),null;var n=Vd(t,e);if(t.tag!==0&&n===2){var r=Gh(t);r!==0&&(e=r,n=_p(t,r))}if(n===1)throw n=Sl,Ei(t,0),Is(t,e),Fn(t,Ht()),n;if(n===6)throw Error(ce(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,pi(t,Dn,Vr),Fn(t,Ht()),null}function Bg(t,e){var n=ht;ht|=1;try{return t(e)}finally{ht=n,ht===0&&(Fo=Ht()+500,wu&&si())}}function ki(t){Ps!==null&&Ps.tag===0&&!(ht&6)&&To();var e=ht;ht|=1;var n=sr.transition,r=bt;try{if(sr.transition=null,bt=1,t)return t()}finally{bt=r,sr.transition=n,ht=e,!(ht&6)&&si()}}function zg(){Hn=yo.current,Pt(yo)}function Ei(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,bw(n)),Vt!==null)for(n=Vt.return;n!==null;){var r=n;switch(Eg(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Ld();break;case 3:jo(),Pt(jn),Pt(_n),Pg();break;case 5:Ag(r);break;case 4:jo();break;case 13:Pt(Nt);break;case 19:Pt(Nt);break;case 10:wg(r.type._context);break;case 22:case 23:zg()}n=n.return}if(rn=t,Vt=t=zs(t.current,null),un=Hn=e,Qt=0,Sl=null,Fg=Au=Ci=0,Dn=Ka=null,_i!==null){for(e=0;e<_i.length;e++)if(n=_i[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}n.pending=r}_i=null}return t}function B1(t,e){do{var n=Vt;try{if(Tg(),id.current=zd,Bd){for(var r=Ft.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Bd=!1}if(wi=0,en=Kt=Ft=null,Va=!1,xl=0,$g.current=null,n===null||n.return===null){Qt=1,Sl=e,Vt=null;break}e:{var i=t,o=n.return,l=n,c=e;if(e=un,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,u=l,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var f=u.alternate;f?(u.updateQueue=f.updateQueue,u.memoizedState=f.memoizedState,u.lanes=f.lanes):(u.updateQueue=null,u.memoizedState=null)}var E=Dy(o);if(E!==null){E.flags&=-257,My(E,o,l,i,e),E.mode&1&&Ly(i,d,e),e=E,c=d;var k=e.updateQueue;if(k===null){var w=new Set;w.add(c),e.updateQueue=w}else k.add(c);break e}else{if(!(e&1)){Ly(i,d,e),Hg();break e}c=Error(ce(426))}}else if(Dt&&l.mode&1){var $=Dy(o);if($!==null){!($.flags&65536)&&($.flags|=256),My($,o,l,i,e),Sg($o(c,l));break e}}i=c=$o(c,l),Qt!==4&&(Qt=2),Ka===null?Ka=[i]:Ka.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var v=I1(i,c,e);Cy(i,v);break e;case 1:l=c;var _=i.type,S=i.stateNode;if(!(i.flags&128)&&(typeof _.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(Us===null||!Us.has(S)))){i.flags|=65536,e&=-e,i.lanes|=e;var p=T1(i,l,e);Cy(i,p);break e}}i=i.return}while(i!==null)}W1(n)}catch(D){e=D,Vt===n&&n!==null&&(Vt=n=n.return);continue}break}while(!0)}function z1(){var t=Hd.current;return Hd.current=zd,t===null?zd:t}function Hg(){(Qt===0||Qt===3||Qt===2)&&(Qt=4),rn===null||!(Ci&268435455)&&!(Au&268435455)||Is(rn,un)}function Vd(t,e){var n=ht;ht|=2;var r=z1();(rn!==t||un!==e)&&(Vr=null,Ei(t,e));do try{Vw();break}catch(s){B1(t,s)}while(!0);if(Tg(),ht=n,Hd.current=r,Vt!==null)throw Error(ce(261));return rn=null,un=0,Qt}function Vw(){for(;Vt!==null;)H1(Vt)}function Yw(){for(;Vt!==null&&!vT();)H1(Vt)}function H1(t){var e=V1(t.alternate,t,Hn);t.memoizedProps=t.pendingProps,e===null?W1(t):Vt=e,$g.current=null}function W1(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=Uw(n,e),n!==null){n.flags&=32767,Vt=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Qt=6,Vt=null;return}}else if(n=Fw(n,e,Hn),n!==null){Vt=n;return}if(e=e.sibling,e!==null){Vt=e;return}Vt=e=t}while(e!==null);Qt===0&&(Qt=5)}function pi(t,e,n){var r=bt,s=sr.transition;try{sr.transition=null,bt=1,Kw(t,e,n,r)}finally{sr.transition=s,bt=r}return null}function Kw(t,e,n,r){do To();while(Ps!==null);if(ht&6)throw Error(ce(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(ce(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(kT(t,i),t===rn&&(Vt=rn=null,un=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||zc||(zc=!0,Y1(Cd,function(){return To(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=sr.transition,sr.transition=null;var o=bt;bt=1;var l=ht;ht|=4,$g.current=null,zw(t,n),$1(n,t),pw(Jh),Rd=!!Qh,Jh=Qh=null,t.current=n,Hw(n),_T(),ht=l,bt=o,sr.transition=i}else t.current=n;if(zc&&(zc=!1,Ps=t,Gd=s),i=t.pendingLanes,i===0&&(Us=null),ET(n.stateNode),Fn(t,Ht()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(Wd)throw Wd=!1,t=yp,yp=null,t;return Gd&1&&t.tag!==0&&To(),i=t.pendingLanes,i&1?t===vp?Xa++:(Xa=0,vp=t):Xa=0,si(),null}function To(){if(Ps!==null){var t=Ix(Gd),e=sr.transition,n=bt;try{if(sr.transition=null,bt=16>t?16:t,Ps===null)var r=!1;else{if(t=Ps,Ps=null,Gd=0,ht&6)throw Error(ce(331));var s=ht;for(ht|=4,xe=t.current;xe!==null;){var i=xe,o=i.child;if(xe.flags&16){var l=i.deletions;if(l!==null){for(var c=0;c<l.length;c++){var d=l[c];for(xe=d;xe!==null;){var u=xe;switch(u.tag){case 0:case 11:case 15:Ya(8,u,i)}var h=u.child;if(h!==null)h.return=u,xe=h;else for(;xe!==null;){u=xe;var f=u.sibling,E=u.return;if(M1(u),u===d){xe=null;break}if(f!==null){f.return=E,xe=f;break}xe=E}}}var k=i.alternate;if(k!==null){var w=k.child;if(w!==null){k.child=null;do{var $=w.sibling;w.sibling=null,w=$}while(w!==null)}}xe=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,xe=o;else e:for(;xe!==null;){if(i=xe,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Ya(9,i,i.return)}var v=i.sibling;if(v!==null){v.return=i.return,xe=v;break e}xe=i.return}}var _=t.current;for(xe=_;xe!==null;){o=xe;var S=o.child;if(o.subtreeFlags&2064&&S!==null)S.return=o,xe=S;else e:for(o=_;xe!==null;){if(l=xe,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:Ru(9,l)}}catch(D){Bt(l,l.return,D)}if(l===o){xe=null;break e}var p=l.sibling;if(p!==null){p.return=l.return,xe=p;break e}xe=l.return}}if(ht=s,si(),Nr&&typeof Nr.onPostCommitFiberRoot=="function")try{Nr.onPostCommitFiberRoot(bu,t)}catch{}r=!0}return r}finally{bt=n,sr.transition=e}}return!1}function Ky(t,e,n){e=$o(n,e),e=I1(t,e,1),t=Fs(t,e,1),e=wn(),t!==null&&(Fl(t,1,e),Fn(t,e))}function Bt(t,e,n){if(t.tag===3)Ky(t,t,n);else for(;e!==null;){if(e.tag===3){Ky(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Us===null||!Us.has(r))){t=$o(n,t),t=T1(e,t,1),e=Fs(e,t,1),t=wn(),e!==null&&(Fl(e,1,t),Fn(e,t));break}}e=e.return}}function Xw(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=wn(),t.pingedLanes|=t.suspendedLanes&n,rn===t&&(un&n)===n&&(Qt===4||Qt===3&&(un&130023424)===un&&500>Ht()-Ug?Ei(t,0):Fg|=n),Fn(t,e)}function G1(t,e){e===0&&(t.mode&1?(e=Oc,Oc<<=1,!(Oc&130023424)&&(Oc=4194304)):e=1);var n=wn();t=is(t,e),t!==null&&(Fl(t,e,n),Fn(t,n))}function Qw(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),G1(t,n)}function Jw(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(ce(314))}r!==null&&r.delete(e),G1(t,n)}var V1;V1=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||jn.current)Mn=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Mn=!1,$w(t,e,n);Mn=!!(t.flags&131072)}else Mn=!1,Dt&&e.flags&1048576&&Qx(e,Nd,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;ad(t,e),t=e.pendingProps;var s=Do(e,_n.current);Io(e,n),s=Lg(null,e,r,t,s,n);var i=Dg();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,$n(r)?(i=!0,Dd(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,kg(e),s.updater=ku,e.stateNode=s,s._reactInternals=e,op(e,r,t,n),e=cp(null,e,r,!0,i,n)):(e.tag=0,Dt&&i&&bg(e),In(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(ad(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=Zw(r),t=ur(r,t),s){case 0:e=lp(null,e,r,t,n);break e;case 1:e=$y(null,e,r,t,n);break e;case 11:e=Ny(null,e,r,t,n);break e;case 14:e=jy(null,e,r,ur(r.type,t),n);break e}throw Error(ce(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:ur(r,s),lp(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:ur(r,s),$y(t,e,r,s,n);case 3:e:{if(R1(e),t===null)throw Error(ce(387));r=e.pendingProps,i=e.memoizedState,s=i.element,n1(t,e),Fd(e,r,null,n);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=$o(Error(ce(423)),e),e=Fy(t,e,r,n,s);break e}else if(r!==s){s=$o(Error(ce(424)),e),e=Fy(t,e,r,n,s);break e}else for(Wn=$s(e.stateNode.containerInfo.firstChild),Gn=e,Dt=!0,hr=null,n=e1(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Mo(),r===s){e=os(t,e,n);break e}In(t,e,r,n)}e=e.child}return e;case 5:return r1(e),t===null&&rp(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,o=s.children,qh(r,s)?o=null:i!==null&&qh(r,i)&&(e.flags|=32),k1(t,e),In(t,e,o,n),e.child;case 6:return t===null&&rp(e),null;case 13:return A1(t,e,n);case 4:return Rg(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=No(e,null,r,n):In(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:ur(r,s),Ny(t,e,r,s,n);case 7:return In(t,e,e.pendingProps,n),e.child;case 8:return In(t,e,e.pendingProps.children,n),e.child;case 12:return In(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,Rt(jd,r._currentValue),r._currentValue=o,i!==null)if(br(i.value,o)){if(i.children===s.children&&!jn.current){e=os(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var l=i.dependencies;if(l!==null){o=i.child;for(var c=l.firstContext;c!==null;){if(c.context===r){if(i.tag===1){c=es(-1,n&-n),c.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var u=d.pending;u===null?c.next=c:(c.next=u.next,u.next=c),d.pending=c}}i.lanes|=n,c=i.alternate,c!==null&&(c.lanes|=n),sp(i.return,n,e),l.lanes|=n;break}c=c.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(ce(341));o.lanes|=n,l=o.alternate,l!==null&&(l.lanes|=n),sp(o,n,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}In(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,Io(e,n),s=ir(s),r=r(s),e.flags|=1,In(t,e,r,n),e.child;case 14:return r=e.type,s=ur(r,e.pendingProps),s=ur(r.type,s),jy(t,e,r,s,n);case 15:return w1(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:ur(r,s),ad(t,e),e.tag=1,$n(r)?(t=!0,Dd(e)):t=!1,Io(e,n),S1(e,r,s),op(e,r,s,n),cp(null,e,r,!0,t,n);case 19:return P1(t,e,n);case 22:return C1(t,e,n)}throw Error(ce(156,e.tag))};function Y1(t,e){return xx(t,e)}function qw(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function nr(t,e,n,r){return new qw(t,e,n,r)}function Wg(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Zw(t){if(typeof t=="function")return Wg(t)?1:0;if(t!=null){if(t=t.$$typeof,t===cg)return 11;if(t===dg)return 14}return 2}function zs(t,e){var n=t.alternate;return n===null?(n=nr(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function dd(t,e,n,r,s,i){var o=2;if(r=t,typeof t=="function")Wg(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case oo:return Si(n.children,s,i,e);case lg:o=8,s|=8;break;case Ah:return t=nr(12,n,e,s|2),t.elementType=Ah,t.lanes=i,t;case Ph:return t=nr(13,n,e,s),t.elementType=Ph,t.lanes=i,t;case Oh:return t=nr(19,n,e,s),t.elementType=Oh,t.lanes=i,t;case rx:return Pu(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case tx:o=10;break e;case nx:o=9;break e;case cg:o=11;break e;case dg:o=14;break e;case bs:o=16,r=null;break e}throw Error(ce(130,t==null?t:typeof t,""))}return e=nr(o,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function Si(t,e,n,r){return t=nr(7,t,r,e),t.lanes=n,t}function Pu(t,e,n,r){return t=nr(22,t,r,e),t.elementType=rx,t.lanes=n,t.stateNode={isHidden:!1},t}function ch(t,e,n){return t=nr(6,t,null,e),t.lanes=n,t}function dh(t,e,n){return e=nr(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function e2(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Wf(0),this.expirationTimes=Wf(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Wf(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Gg(t,e,n,r,s,i,o,l,c){return t=new e2(t,e,n,l,c),e===1?(e=1,i===!0&&(e|=8)):e=0,i=nr(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},kg(i),t}function t2(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:io,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function K1(t){if(!t)return Qs;t=t._reactInternals;e:{if(ji(t)!==t||t.tag!==1)throw Error(ce(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if($n(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ce(171))}if(t.tag===1){var n=t.type;if($n(n))return Kx(t,n,e)}return e}function X1(t,e,n,r,s,i,o,l,c){return t=Gg(n,r,!0,t,s,i,o,l,c),t.context=K1(null),n=t.current,r=wn(),s=Bs(n),i=es(r,s),i.callback=e??null,Fs(n,i,s),t.current.lanes=s,Fl(t,s,r),Fn(t,r),t}function Ou(t,e,n,r){var s=e.current,i=wn(),o=Bs(s);return n=K1(n),e.context===null?e.context=n:e.pendingContext=n,e=es(i,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Fs(s,e,o),t!==null&&(_r(t,s,o,i),sd(t,s,o)),o}function Yd(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Xy(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Vg(t,e){Xy(t,e),(t=t.alternate)&&Xy(t,e)}function n2(){return null}var Q1=typeof reportError=="function"?reportError:function(t){console.error(t)};function Yg(t){this._internalRoot=t}Lu.prototype.render=Yg.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(ce(409));Ou(t,e,null,null)};Lu.prototype.unmount=Yg.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;ki(function(){Ou(null,t,null,null)}),e[ss]=null}};function Lu(t){this._internalRoot=t}Lu.prototype.unstable_scheduleHydration=function(t){if(t){var e=Cx();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Ss.length&&e!==0&&e<Ss[n].priority;n++);Ss.splice(n,0,t),n===0&&Rx(t)}};function Kg(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Du(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Qy(){}function r2(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var d=Yd(o);i.call(d)}}var o=X1(e,r,t,0,null,!1,!1,"",Qy);return t._reactRootContainer=o,t[ss]=o.current,gl(t.nodeType===8?t.parentNode:t),ki(),o}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var l=r;r=function(){var d=Yd(c);l.call(d)}}var c=Gg(t,0,!1,null,null,!1,!1,"",Qy);return t._reactRootContainer=c,t[ss]=c.current,gl(t.nodeType===8?t.parentNode:t),ki(function(){Ou(e,c,n,r)}),c}function Mu(t,e,n,r,s){var i=n._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var l=s;s=function(){var c=Yd(o);l.call(c)}}Ou(e,o,t,s)}else o=r2(n,e,t,s,r);return Yd(o)}Tx=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Na(e.pendingLanes);n!==0&&(hg(e,n|1),Fn(e,Ht()),!(ht&6)&&(Fo=Ht()+500,si()))}break;case 13:ki(function(){var r=is(t,1);if(r!==null){var s=wn();_r(r,t,1,s)}}),Vg(t,1)}};pg=function(t){if(t.tag===13){var e=is(t,134217728);if(e!==null){var n=wn();_r(e,t,134217728,n)}Vg(t,134217728)}};wx=function(t){if(t.tag===13){var e=Bs(t),n=is(t,e);if(n!==null){var r=wn();_r(n,t,e,r)}Vg(t,e)}};Cx=function(){return bt};kx=function(t,e){var n=bt;try{return bt=t,e()}finally{bt=n}};zh=function(t,e,n){switch(e){case"input":if(Mh(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=Tu(r);if(!s)throw Error(ce(90));ix(r),Mh(r,s)}}}break;case"textarea":ax(t,n);break;case"select":e=n.value,e!=null&&xo(t,!!n.multiple,e,!1)}};px=Bg;gx=ki;var s2={usingClientEntryPoint:!1,Events:[Bl,uo,Tu,fx,hx,Bg]},Ca={findFiberByHostInstance:vi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},i2={bundleType:Ca.bundleType,version:Ca.version,rendererPackageName:Ca.rendererPackageName,rendererConfig:Ca.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ds.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=vx(t),t===null?null:t.stateNode},findFiberByHostInstance:Ca.findFiberByHostInstance||n2,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Hc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Hc.isDisabled&&Hc.supportsFiber)try{bu=Hc.inject(i2),Nr=Hc}catch{}}Kn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=s2;Kn.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Kg(e))throw Error(ce(200));return t2(t,e,null,n)};Kn.createRoot=function(t,e){if(!Kg(t))throw Error(ce(299));var n=!1,r="",s=Q1;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=Gg(t,1,!1,null,null,n,!1,r,s),t[ss]=e.current,gl(t.nodeType===8?t.parentNode:t),new Yg(e)};Kn.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(ce(188)):(t=Object.keys(t).join(","),Error(ce(268,t)));return t=vx(e),t=t===null?null:t.stateNode,t};Kn.flushSync=function(t){return ki(t)};Kn.hydrate=function(t,e,n){if(!Du(e))throw Error(ce(200));return Mu(null,t,e,!0,n)};Kn.hydrateRoot=function(t,e,n){if(!Kg(t))throw Error(ce(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",o=Q1;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=X1(e,null,t,1,n??null,s,!1,i,o),t[ss]=e.current,gl(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new Lu(e)};Kn.render=function(t,e,n){if(!Du(e))throw Error(ce(200));return Mu(null,t,e,!1,n)};Kn.unmountComponentAtNode=function(t){if(!Du(t))throw Error(ce(40));return t._reactRootContainer?(ki(function(){Mu(null,null,t,!1,function(){t._reactRootContainer=null,t[ss]=null})}),!0):!1};Kn.unstable_batchedUpdates=Bg;Kn.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Du(n))throw Error(ce(200));if(t==null||t._reactInternals===void 0)throw Error(ce(38));return Mu(t,e,n,!1,r)};Kn.version="18.3.1-next-f1338f8080-20240426";function J1(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(J1)}catch(t){console.error(t)}}J1(),J_.exports=Kn;var o2=J_.exports,Jy=o2;kh.createRoot=Jy.createRoot,kh.hydrateRoot=Jy.hydrateRoot;const Ts=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},a2=1280,l2=720,c2=Ts("/leaders/azya_leader.png"),d2=Ts("/leaders/senka_leader.png"),u2=Ts("/leaders/yoRuka_leader.png"),f2=({onStartConfig:t,audioSettings:e,onAudioSettingsChange:n,playerId:r,onGalleryClassSelect:s,isAnonymous:i=!0,userId:o=null,onNavigateToRegister:l,onNavigateToLogin:c,onNavigateToProfile:d,onLogout:u})=>{const[h,f]=L.useState("title"),[E,k]=L.useState(!1);L.useEffect(()=>{console.log(" TitleScreen auth state:",{isAnonymous:i,userId:o})},[i,o]);const[w,$]=L.useState("home"),[v,_]=L.useState(!1),[S,p]=L.useState(""),[D,H]=L.useState(!1),[ne]=L.useState(()=>localStorage.getItem("homeCardId")),[V,ee]=L.useState(25),[de,ve]=L.useState(!1),je=L.useRef(0),ue=L.useRef(0),[I,O]=L.useState(1);L.useEffect(()=>{const z=()=>{const Te=window.innerWidth/a2,te=window.innerHeight/l2;O(Math.min(Te,te))};return z(),window.addEventListener("resize",z),()=>window.removeEventListener("resize",z)},[]);const C=()=>{k(!0),setTimeout(()=>{f("home"),k(!1)},600)},R=z=>{ve(!0),je.current=z.clientX,ue.current=V},y=z=>{if(!de)return;const Te=z.clientX-je.current,te=ue.current+Te*.5;ee(Math.max(-180,Math.min(180,te)))},g=()=>{ve(!1)},T=z=>{t(z==="casual"?"CASUAL_MATCH":"RANKED_MATCH")},A=()=>{H(!0)},M=()=>{H(!1),u&&u()},Q=()=>{H(!1)},U=9*I;if(h==="title")return a.jsxs("div",{className:"screen title-screen",onClick:C,style:{height:"100dvh",width:"100vw",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative",overflow:"hidden",color:"white",cursor:"pointer"},children:[a.jsx("div",{style:{position:"absolute",inset:0,backgroundImage:`url(${Ts("/title/background.png")})`,backgroundSize:"cover",backgroundPosition:"center",zIndex:0}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",zIndex:-1}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(0, 0, 0, 0.3)",zIndex:1}}),a.jsxs("div",{style:{position:"relative",zIndex:2,display:"flex",flexDirection:"column",alignItems:"center",transform:E?"translateY(-100vh)":"translateY(0)",transition:E?"transform 0.6s ease-in":"none"},children:[a.jsx("div",{style:{fontFamily:"Tamanegi, sans-serif",fontSize:`${U}rem`,color:"#fff",textShadow:"0 0 30px rgba(233, 69, 96, 0.9), 0 0 60px rgba(233, 69, 96, 0.5), 3px 3px 6px rgba(0,0,0,0.9)",letterSpacing:`${.5*I}rem`,whiteSpace:"nowrap",marginBottom:`${2*I}rem`},children:""}),a.jsx("div",{style:{fontSize:`${2*I}rem`,color:"#fff",fontWeight:"bold",letterSpacing:`${.3*I}rem`,animation:"blink 1.5s ease-in-out infinite",textShadow:"0 0 10px rgba(255, 255, 255, 0.8)"},children:"GAME START"})]}),a.jsx("p",{style:{position:"absolute",bottom:20*I,opacity:.5,fontSize:`${.8*I}rem`,zIndex:2},children:"Ver 1.04 Beta"}),a.jsx("style",{children:`
                    @keyframes blink {
                        0%, 100% { opacity: 1; }
                        50% { opacity: 0.3; }
                    }
                `})]});const ge=[{id:"solo",label:"",color:"#e94560"},{id:"room",label:"",color:"#60a5fa"},{id:"random",label:"",color:"#4ade80"},{id:"home",label:"",color:"#f59e0b"},{id:"ranking",label:"",color:"#a855f7"},{id:"gallery",label:"",color:"#ec4899"},{id:"settings",label:"",color:"#6b7280"}];return a.jsxs("div",{className:"screen home-screen",style:{height:"100dvh",width:"100vw",display:"flex",flexDirection:"column",position:"relative",overflow:"hidden",color:"white"},onMouseMove:y,onMouseUp:g,onMouseLeave:g,children:[a.jsx("div",{style:{position:"absolute",inset:0,backgroundImage:`url(${Ts("/title/background.png")})`,backgroundSize:"cover",backgroundPosition:"center",zIndex:0}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",zIndex:-1}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(0, 0, 0, 0.5)",zIndex:1}}),a.jsx("div",{style:{position:"absolute",top:20*I,left:"50%",transform:"translateX(-50%)",fontFamily:"Tamanegi, sans-serif",fontSize:`${2.5*I}rem`,color:"#fff",textShadow:"0 0 15px rgba(233, 69, 96, 0.7)",letterSpacing:`${.2*I}rem`,zIndex:10},children:""}),a.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",paddingBottom:80*I,position:"relative",zIndex:2},children:[w==="home"&&a.jsxs("div",{style:{position:"absolute",left:50*I,top:"50%",transform:"translateY(-50%)",perspective:1e3},children:[a.jsxs("div",{onMouseDown:R,style:{width:200*I,height:280*I,transformStyle:"preserve-3d",transform:`rotateY(${V}deg)`,transition:de?"none":"transform 0.3s ease-out",cursor:de?"grabbing":"grab"},children:[a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",borderRadius:12*I,background:ne?`url(${Ts(`/cards/${ne}.png`)})`:"linear-gradient(135deg, #2d3748 0%, #1a202c 100%)",backgroundSize:"cover",backgroundPosition:"center",border:`3px solid ${ne?"#e94560":"#4a5568"}`,boxShadow:"0 10px 30px rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center"},children:!ne&&a.jsxs("span",{style:{fontSize:`${.9*I}rem`,color:"#718096",textAlign:"center",padding:20*I},children:["",a.jsx("br",{}),"",a.jsx("br",{}),""]})}),a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",transform:"rotateY(180deg)",borderRadius:12*I,background:ne?`url(${Ts(`/cards/${ne}_evolved.png`)})`:`url(${Ts("/cards/sleeve_default.png")})`,backgroundSize:"cover",backgroundPosition:"center",border:`3px solid ${ne?"#a855f7":"#4a5568"}`,boxShadow:"0 10px 30px rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center"},children:!ne&&a.jsx("span",{style:{fontSize:`${.8*I}rem`,color:"#718096"},children:""})})]}),a.jsx("p",{style:{textAlign:"center",marginTop:10*I,fontSize:`${.75*I}rem`,color:"#888"},children:""})]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",maxWidth:600*I},children:[w==="home"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*I}rem`,marginBottom:`${1*I}rem`},children:""}),a.jsx("p",{style:{fontSize:`${1*I}rem`,color:"#aaa"},children:""})]}),w==="solo"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*I}rem`,marginBottom:`${1*I}rem`,color:"#e94560"},children:""}),a.jsx("button",{onClick:()=>t("CPU"),style:{padding:`${1*I}rem ${3*I}rem`,fontSize:`${1.2*I}rem`,background:"#e94560",border:"none",borderRadius:8*I,color:"white",cursor:"pointer",fontWeight:"bold"},children:"CPU"})]}),w==="room"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*I}rem`,marginBottom:`${1.5*I}rem`,color:"#60a5fa"},children:""}),v?a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:`${1*I}rem`,alignItems:"center"},children:[a.jsx("input",{type:"text",placeholder:"ID",value:S,onChange:z=>p(z.target.value),style:{padding:`${.8*I}rem`,fontSize:`${1*I}rem`,width:250*I,background:"rgba(255,255,255,0.1)",border:"2px solid #a855f7",borderRadius:8*I,color:"white",textAlign:"center"}}),a.jsxs("div",{style:{display:"flex",gap:`${.5*I}rem`},children:[a.jsx("button",{onClick:()=>_(!1),style:{padding:`${.6*I}rem ${1.5*I}rem`,fontSize:`${1*I}rem`,background:"transparent",border:"1px solid #666",borderRadius:6*I,color:"#888",cursor:"pointer"},children:""}),a.jsx("button",{onClick:()=>t("JOIN",S),disabled:!S,style:{padding:`${.6*I}rem ${1.5*I}rem`,fontSize:`${1*I}rem`,background:S?"#a855f7":"#333",border:"none",borderRadius:6*I,color:"white",cursor:S?"pointer":"not-allowed",opacity:S?1:.5},children:""})]})]}):a.jsxs("div",{style:{display:"flex",gap:`${3*I}rem`,perspective:1200},children:[a.jsxs("div",{onClick:()=>t("HOST"),style:{width:200*I,height:280*I,background:"linear-gradient(135deg, #1a2a3a 0%, #0d1a2a 100%)",border:"3px solid #60a5fa",borderRadius:16*I,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(96, 165, 250, 0.3)"},onMouseOver:z=>{z.currentTarget.style.transform="rotateY(0deg) scale(1.05)",z.currentTarget.style.boxShadow="0 15px 40px rgba(96, 165, 250, 0.5)"},onMouseOut:z=>{z.currentTarget.style.transform="rotateY(15deg)",z.currentTarget.style.boxShadow="0 10px 30px rgba(96, 165, 250, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*I}rem`,marginBottom:`${.5*I}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*I}rem`,color:"#60a5fa",margin:0,marginBottom:`${.5*I}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*I}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*I}rem`},children:["ID",a.jsx("br",{}),""]})]}),a.jsxs("div",{onClick:()=>_(!0),style:{width:200*I,height:280*I,background:"linear-gradient(135deg, #2a1a3a 0%, #1a0d2a 100%)",border:"3px solid #a855f7",borderRadius:16*I,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(-15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(168, 85, 247, 0.3)"},onMouseOver:z=>{z.currentTarget.style.transform="rotateY(0deg) scale(1.05)",z.currentTarget.style.boxShadow="0 15px 40px rgba(168, 85, 247, 0.5)"},onMouseOut:z=>{z.currentTarget.style.transform="rotateY(-15deg)",z.currentTarget.style.boxShadow="0 10px 30px rgba(168, 85, 247, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*I}rem`,marginBottom:`${.5*I}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*I}rem`,color:"#a855f7",margin:0,marginBottom:`${.5*I}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*I}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*I}rem`},children:["ID",a.jsx("br",{}),""]})]})]})]}),w==="random"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*I}rem`,marginBottom:`${1.5*I}rem`,color:"#4ade80"},children:""}),a.jsxs("div",{style:{display:"flex",gap:`${3*I}rem`,perspective:1200},children:[a.jsxs("div",{onClick:()=>T("casual"),style:{width:200*I,height:280*I,background:"linear-gradient(135deg, #1a3a1a 0%, #0d2d0d 100%)",border:"3px solid #4ade80",borderRadius:16*I,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(74, 222, 128, 0.3)"},onMouseOver:z=>{z.currentTarget.style.transform="rotateY(0deg) scale(1.05)",z.currentTarget.style.boxShadow="0 15px 40px rgba(74, 222, 128, 0.5)"},onMouseOut:z=>{z.currentTarget.style.transform="rotateY(15deg)",z.currentTarget.style.boxShadow="0 10px 30px rgba(74, 222, 128, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*I}rem`,marginBottom:`${.5*I}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*I}rem`,color:"#4ade80",margin:0,marginBottom:`${.5*I}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*I}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*I}rem`},children:["",a.jsx("br",{}),""]})]}),a.jsxs("div",{onClick:()=>T("ranked"),style:{width:200*I,height:280*I,background:"linear-gradient(135deg, #3a1a1a 0%, #2d0d0d 100%)",border:"3px solid #e94560",borderRadius:16*I,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(-15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(233, 69, 96, 0.3)"},onMouseOver:z=>{z.currentTarget.style.transform="rotateY(0deg) scale(1.05)",z.currentTarget.style.boxShadow="0 15px 40px rgba(233, 69, 96, 0.5)"},onMouseOut:z=>{z.currentTarget.style.transform="rotateY(-15deg)",z.currentTarget.style.boxShadow="0 10px 30px rgba(233, 69, 96, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*I}rem`,marginBottom:`${.5*I}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*I}rem`,color:"#e94560",margin:0,marginBottom:`${.5*I}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*I}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*I}rem`},children:["",a.jsx("br",{}),""]})]})]})]}),w==="ranking"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*I}rem`,marginBottom:`${1*I}rem`,color:"#a855f7"},children:""}),a.jsx("p",{style:{fontSize:`${1*I}rem`,color:"#888"},children:"Coming Soon..."})]}),w==="gallery"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*I}rem`,marginBottom:`${1.5*I}rem`,color:"#ec4899"},children:" - "}),a.jsxs("div",{style:{display:"flex",gap:`${1.2*I}rem`,justifyContent:"center",marginBottom:`${1*I}rem`},children:[a.jsxs("div",{onClick:()=>s("SENKA"),style:{width:200*I,height:280*I,border:"1px solid #444",borderRadius:10*I,background:"linear-gradient(180deg, #2c0b0e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:"0 4px 20px rgba(233, 69, 96, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:z=>{z.currentTarget.style.transform="scale(1.05)",z.currentTarget.style.boxShadow="0 8px 30px rgba(233, 69, 96, 0.4)"},onMouseOut:z=>{z.currentTarget.style.transform="scale(1)",z.currentTarget.style.boxShadow="0 4px 20px rgba(233, 69, 96, 0.2)"},children:[a.jsx("img",{src:d2,alt:"Senka",style:{width:"100%",height:"75%",objectFit:"cover"}}),a.jsx("div",{style:{padding:`${8*I}px`,display:"flex",flexDirection:"column",alignItems:"center",width:"100%",justifyContent:"center",flex:1},children:a.jsx("h3",{style:{fontSize:`${1.4*I}rem`,color:"#e94560",margin:0,fontFamily:"sans-serif"},children:""})})]}),a.jsxs("div",{onClick:()=>s("AJA"),style:{width:200*I,height:280*I,border:"1px solid #444",borderRadius:10*I,background:"linear-gradient(180deg, #0f1c2e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:"0 4px 20px rgba(69, 162, 233, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:z=>{z.currentTarget.style.transform="scale(1.05)",z.currentTarget.style.boxShadow="0 8px 30px rgba(69, 162, 233, 0.4)"},onMouseOut:z=>{z.currentTarget.style.transform="scale(1)",z.currentTarget.style.boxShadow="0 4px 20px rgba(69, 162, 233, 0.2)"},children:[a.jsx("img",{src:c2,alt:"Azya",style:{width:"100%",height:"75%",objectFit:"cover",objectPosition:"center top"}}),a.jsx("div",{style:{padding:`${8*I}px`,display:"flex",flexDirection:"column",alignItems:"center",width:"100%",justifyContent:"center",flex:1},children:a.jsx("h3",{style:{fontSize:`${1.4*I}rem`,color:"#45a2e9",margin:0,fontFamily:"sans-serif"},children:""})})]}),a.jsxs("div",{onClick:()=>s("YORUKA"),style:{width:200*I,height:280*I,border:"1px solid #444",borderRadius:10*I,background:"linear-gradient(180deg, #1a0f2e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:"0 4px 20px rgba(168, 85, 247, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:z=>{z.currentTarget.style.transform="scale(1.05)",z.currentTarget.style.boxShadow="0 8px 30px rgba(168, 85, 247, 0.4)"},onMouseOut:z=>{z.currentTarget.style.transform="scale(1)",z.currentTarget.style.boxShadow="0 4px 20px rgba(168, 85, 247, 0.2)"},children:[a.jsx("img",{src:u2,alt:"Yoruka",style:{width:"100%",height:"75%",objectFit:"cover"}}),a.jsx("div",{style:{padding:`${8*I}px`,display:"flex",flexDirection:"column",alignItems:"center",width:"100%",justifyContent:"center",flex:1},children:a.jsx("h3",{style:{fontSize:`${1.4*I}rem`,color:"#a855f7",margin:0,fontFamily:"sans-serif"},children:"Y"})})]})]})]}),w==="settings"&&a.jsxs("div",{style:{background:"rgba(0, 0, 0, 0.3)",borderRadius:12*I,padding:`${2*I}rem`,minWidth:400*I},children:[a.jsx("h2",{style:{fontSize:`${1.8*I}rem`,marginBottom:`${1.5*I}rem`,color:"#6b7280",textAlign:"center"},children:""}),a.jsxs("div",{style:{marginBottom:`${1.5*I}rem`},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:`${.5*I}rem`},children:[a.jsx("span",{style:{fontSize:`${1*I}rem`},children:"BGM"}),a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8*I,cursor:"pointer"},children:[a.jsx("input",{type:"checkbox",checked:e.bgmEnabled,onChange:z=>n({bgmEnabled:z.target.checked}),style:{width:18*I,height:18*I}}),a.jsx("span",{style:{color:e.bgmEnabled?"#4ade80":"#888",fontSize:`${.9*I}rem`},children:e.bgmEnabled?"ON":"OFF"})]})]}),a.jsx("input",{type:"range",min:0,max:1,step:.05,value:e.bgm,onChange:z=>n({bgm:parseFloat(z.target.value)}),disabled:!e.bgmEnabled,style:{width:"100%",opacity:e.bgmEnabled?1:.5}})]}),a.jsxs("div",{style:{marginBottom:`${1.5*I}rem`},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:`${.5*I}rem`},children:[a.jsx("span",{style:{fontSize:`${1*I}rem`},children:""}),a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8*I,cursor:"pointer"},children:[a.jsx("input",{type:"checkbox",checked:e.seEnabled,onChange:z=>n({seEnabled:z.target.checked}),style:{width:18*I,height:18*I}}),a.jsx("span",{style:{color:e.seEnabled?"#4ade80":"#888",fontSize:`${.9*I}rem`},children:e.seEnabled?"ON":"OFF"})]})]}),a.jsx("input",{type:"range",min:0,max:1,step:.05,value:e.se,onChange:z=>n({se:parseFloat(z.target.value)}),disabled:!e.seEnabled,style:{width:"100%",opacity:e.seEnabled?1:.5}})]}),a.jsxs("div",{style:{borderTop:"1px solid rgba(255, 255, 255, 0.1)",paddingTop:`${1.5*I}rem`,marginTop:`${1*I}rem`,marginBottom:`${1.5*I}rem`},children:[a.jsx("h3",{style:{fontSize:`${1.2*I}rem`,marginBottom:`${1*I}rem`,color:"#fff"},children:""}),a.jsx("button",{onClick:d,style:{width:"100%",padding:`${.6*I}rem ${1*I}rem`,fontSize:`${.9*I}rem`,background:"linear-gradient(135deg, #a855f7 0%, #7c3aed 100%)",border:"none",borderRadius:6*I,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s"},onMouseEnter:z=>z.currentTarget.style.transform="scale(1.05)",onMouseLeave:z=>z.currentTarget.style.transform="scale(1)",children:""})]}),a.jsxs("div",{style:{borderTop:"1px solid rgba(255, 255, 255, 0.1)",paddingTop:`${1.5*I}rem`,marginTop:`${1*I}rem`},children:[a.jsx("h3",{style:{fontSize:`${1.2*I}rem`,marginBottom:`${1*I}rem`,color:"#fff"},children:""}),i?a.jsxs("div",{children:[a.jsx("p",{style:{fontSize:`${.9*I}rem`,color:"#aaa",marginBottom:`${1*I}rem`},children:""}),a.jsxs("div",{style:{display:"flex",gap:10*I,marginBottom:`${1*I}rem`},children:[a.jsx("button",{onClick:l,style:{flex:1,padding:`${.6*I}rem ${1*I}rem`,fontSize:`${.9*I}rem`,background:"linear-gradient(135deg, #4a9eff 0%, #357abd 100%)",border:"none",borderRadius:6*I,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s"},onMouseEnter:z=>z.currentTarget.style.transform="scale(1.05)",onMouseLeave:z=>z.currentTarget.style.transform="scale(1)",children:""}),a.jsx("button",{onClick:c,style:{flex:1,padding:`${.6*I}rem ${1*I}rem`,fontSize:`${.9*I}rem`,background:"#555",border:"none",borderRadius:6*I,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s"},onMouseEnter:z=>z.currentTarget.style.background="#666",onMouseLeave:z=>z.currentTarget.style.background="#555",children:""})]}),a.jsx("p",{style:{fontSize:`${.75*I}rem`,color:"#888",textAlign:"center",lineHeight:1.4},children:""})]}):a.jsxs("div",{children:[a.jsx("p",{style:{fontSize:`${.9*I}rem`,color:"#4ade80",marginBottom:`${.5*I}rem`,fontWeight:"bold"},children:""}),a.jsxs("p",{style:{fontSize:`${.85*I}rem`,color:"#fff",marginBottom:`${.3*I}rem`},children:["ID: ",a.jsx("span",{style:{color:"#4a9eff",fontWeight:"bold"},children:o||""})]}),a.jsx("button",{onClick:A,style:{width:"100%",padding:`${.6*I}rem ${1*I}rem`,fontSize:`${.9*I}rem`,background:"#d32f2f",border:"none",borderRadius:6*I,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s",marginTop:`${.5*I}rem`},onMouseEnter:z=>z.currentTarget.style.background="#b71c1c",onMouseLeave:z=>z.currentTarget.style.background="#d32f2f",children:""})]})]})]})]})]}),a.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:70*I,background:"rgba(0, 0, 0, 0.8)",borderTop:"2px solid rgba(255, 255, 255, 0.1)",display:"flex",justifyContent:"center",alignItems:"center",gap:`${.5*I}rem`,padding:`0 ${1*I}rem`,zIndex:3},children:ge.map(z=>a.jsx("button",{onClick:()=>$(z.id),style:{flex:1,maxWidth:140*I,padding:`${.6*I}rem ${.5*I}rem`,fontSize:`${.85*I}rem`,background:w===z.id?z.color:"transparent",border:w===z.id?"none":`2px solid ${z.color}`,borderRadius:8*I,color:w===z.id?"white":z.color,cursor:"pointer",transition:"all 0.2s",fontWeight:w===z.id?"bold":"normal"},children:z.label},z.id))}),a.jsx("p",{style:{position:"absolute",bottom:75*I,right:20*I,opacity:.5,fontSize:`${.7*I}rem`,zIndex:2},children:"Ver 1.04 Beta"}),D&&a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0, 0, 0, 0.7)",zIndex:100},children:a.jsxs("div",{style:{background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",borderRadius:12*I,padding:`${2*I}rem`,minWidth:300*I,border:"2px solid rgba(255, 255, 255, 0.2)",boxShadow:"0 10px 30px rgba(0, 0, 0, 0.5)"},children:[a.jsx("h3",{style:{fontSize:`${1.2*I}rem`,marginBottom:`${1*I}rem`,color:"#fff",textAlign:"center"},children:""}),a.jsxs("div",{style:{display:"flex",gap:10*I,marginTop:`${1.5*I}rem`},children:[a.jsx("button",{onClick:Q,style:{flex:1,padding:`${.6*I}rem ${1*I}rem`,fontSize:`${.9*I}rem`,background:"#555",border:"none",borderRadius:6*I,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s"},onMouseEnter:z=>z.currentTarget.style.background="#666",onMouseLeave:z=>z.currentTarget.style.background="#555",children:""}),a.jsx("button",{onClick:M,style:{flex:1,padding:`${.6*I}rem ${1*I}rem`,fontSize:`${.9*I}rem`,background:"#d32f2f",border:"none",borderRadius:6*I,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s"},onMouseEnter:z=>z.currentTarget.style.background="#b71c1c",onMouseLeave:z=>z.currentTarget.style.background="#d32f2f",children:""})]})]})})]})},h2=()=>{};var qy={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q1={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fe=function(t,e){if(!t)throw Jo(e)},Jo=function(t){return new Error("Firebase Database ("+q1.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z1=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},p2=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=t[n++],o=t[n++],l=t[n++],c=((s&7)<<18|(i&63)<<12|(o&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{const i=t[n++],o=t[n++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},Xg={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<t.length;s+=3){const i=t[s],o=s+1<t.length,l=o?t[s+1]:0,c=s+2<t.length,d=c?t[s+2]:0,u=i>>2,h=(i&3)<<4|l>>4;let f=(l&15)<<2|d>>6,E=d&63;c||(E=64,o||(f=64)),r.push(n[u],n[h],n[f],n[E])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(Z1(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):p2(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<t.length;){const i=n[t.charAt(s++)],l=s<t.length?n[t.charAt(s)]:0;++s;const d=s<t.length?n[t.charAt(s)]:64;++s;const h=s<t.length?n[t.charAt(s)]:64;if(++s,i==null||l==null||d==null||h==null)throw new g2;const f=i<<2|l>>4;if(r.push(f),d!==64){const E=l<<4&240|d>>2;if(r.push(E),h!==64){const k=d<<6&192|h;r.push(k)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class g2 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const eb=function(t){const e=Z1(t);return Xg.encodeByteArray(e,!0)},Kd=function(t){return eb(t).replace(/\./g,"")},Xd=function(t){try{return Xg.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m2(t){return tb(void 0,t)}function tb(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const n=e;return new Date(n.getTime());case Object:t===void 0&&(t={});break;case Array:t=[];break;default:return e}for(const n in e)!e.hasOwnProperty(n)||!y2(n)||(t[n]=tb(t[n],e[n]));return t}function y2(t){return t!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v2(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _2=()=>v2().__FIREBASE_DEFAULTS__,x2=()=>{if(typeof process>"u"||typeof qy>"u")return;const t=qy.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},b2=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&Xd(t[1]);return e&&JSON.parse(e)},Qg=()=>{try{return h2()||_2()||x2()||b2()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},nb=t=>{var e,n;return(n=(e=Qg())==null?void 0:e.emulatorHosts)==null?void 0:n[t]},E2=t=>{const e=nb(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},rb=()=>{var t;return(t=Qg())==null?void 0:t.config},sb=t=>{var e;return(e=Qg())==null?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pr{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qo(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function ib(t){return(await fetch(t,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S2(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",s=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...t};return[Kd(JSON.stringify(n)),Kd(JSON.stringify(o)),""].join(".")}const Qa={};function I2(){const t={prod:[],emulator:[]};for(const e of Object.keys(Qa))Qa[e]?t.emulator.push(e):t.prod.push(e);return t}function T2(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let Zy=!1;function ob(t,e){if(typeof window>"u"||typeof document>"u"||!qo(window.location.host)||Qa[t]===e||Qa[t]||Zy)return;Qa[t]=e;function n(f){return`__firebase__banner__${f}`}const r="__firebase__banner",i=I2().prod.length>0;function o(){const f=document.getElementById(r);f&&f.remove()}function l(f){f.style.display="flex",f.style.background="#7faaf0",f.style.position="fixed",f.style.bottom="5px",f.style.left="5px",f.style.padding=".5em",f.style.borderRadius="5px",f.style.alignItems="center"}function c(f,E){f.setAttribute("width","24"),f.setAttribute("id",E),f.setAttribute("height","24"),f.setAttribute("viewBox","0 0 24 24"),f.setAttribute("fill","none"),f.style.marginLeft="-6px"}function d(){const f=document.createElement("span");return f.style.cursor="pointer",f.style.marginLeft="16px",f.style.fontSize="24px",f.innerHTML=" &times;",f.onclick=()=>{Zy=!0,o()},f}function u(f,E){f.setAttribute("id",E),f.innerText="Learn more",f.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",f.setAttribute("target","__blank"),f.style.paddingLeft="5px",f.style.textDecoration="underline"}function h(){const f=T2(r),E=n("text"),k=document.getElementById(E)||document.createElement("span"),w=n("learnmore"),$=document.getElementById(w)||document.createElement("a"),v=n("preprendIcon"),_=document.getElementById(v)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(f.created){const S=f.element;l(S),u($,w);const p=d();c(_,v),S.append(_,k,$,p),document.body.appendChild(S)}i?(k.innerText="Preview backend disconnected.",_.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(_.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,k.innerText="Preview backend running in this workspace."),k.setAttribute("id",E)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",h):h()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Jg(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(kn())}function w2(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function C2(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function ab(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function k2(){const t=kn();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function R2(){return q1.NODE_ADMIN===!0}function A2(){try{return typeof indexedDB=="object"}catch{return!1}}function P2(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var i;e(((i=s.error)==null?void 0:i.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O2="FirebaseError";class ii extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=O2,Object.setPrototypeOf(this,ii.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Hl.prototype.create)}}class Hl{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?L2(i,r):"Error",l=`${this.serviceName}: ${o} (${s}).`;return new ii(s,l,r)}}function L2(t,e){return t.replace(D2,(n,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const D2=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Il(t){return JSON.parse(t)}function Xt(t){return JSON.stringify(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lb=function(t){let e={},n={},r={},s="";try{const i=t.split(".");e=Il(Xd(i[0])||""),n=Il(Xd(i[1])||""),s=i[2],r=n.d||{},delete n.d}catch{}return{header:e,claims:n,data:r,signature:s}},M2=function(t){const e=lb(t),n=e.claims;return!!n&&typeof n=="object"&&n.hasOwnProperty("iat")},N2=function(t){const e=lb(t).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sr(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Ri(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}function Qd(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Jd(t,e,n){const r={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(r[s]=e.call(n,t[s],s,t));return r}function Ai(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const i=t[s],o=e[s];if(ev(i)&&ev(o)){if(!Ai(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function ev(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zo(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function $a(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Fa(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j2{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,n){n||(n=0);const r=this.W_;if(typeof e=="string")for(let h=0;h<16;h++)r[h]=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),n+=4;else for(let h=0;h<16;h++)r[h]=e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3],n+=4;for(let h=16;h<80;h++){const f=r[h-3]^r[h-8]^r[h-14]^r[h-16];r[h]=(f<<1|f>>>31)&4294967295}let s=this.chain_[0],i=this.chain_[1],o=this.chain_[2],l=this.chain_[3],c=this.chain_[4],d,u;for(let h=0;h<80;h++){h<40?h<20?(d=l^i&(o^l),u=1518500249):(d=i^o^l,u=1859775393):h<60?(d=i&o|l&(i|o),u=2400959708):(d=i^o^l,u=3395469782);const f=(s<<5|s>>>27)+d+c+u+r[h]&4294967295;c=l,l=o,o=(i<<30|i>>>2)&4294967295,i=s,s=f}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+i&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,n){if(e==null)return;n===void 0&&(n=e.length);const r=n-this.blockSize;let s=0;const i=this.buf_;let o=this.inbuf_;for(;s<n;){if(o===0)for(;s<=r;)this.compress_(e,s),s+=this.blockSize;if(typeof e=="string"){for(;s<n;)if(i[o]=e.charCodeAt(s),++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}else for(;s<n;)if(i[o]=e[s],++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=n}digest(){const e=[];let n=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=n&255,n/=256;this.compress_(this.buf_);let r=0;for(let s=0;s<5;s++)for(let i=24;i>=0;i-=8)e[r]=this.chain_[s]>>i&255,++r;return e}}function $2(t,e){const n=new F2(t,e);return n.subscribe.bind(n)}class F2{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let s;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");U2(e,["next","error","complete"])?s=e:s={next:e,error:n,complete:r},s.next===void 0&&(s.next=uh),s.error===void 0&&(s.error=uh),s.complete===void 0&&(s.complete=uh);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function U2(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function uh(){}function Uo(t,e){return`${t} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B2=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);if(s>=55296&&s<=56319){const i=s-55296;r++,fe(r<t.length,"Surrogate pair missing trail surrogate.");const o=t.charCodeAt(r)-56320;s=65536+(i<<10)+o}s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):s<65536?(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},Nu=function(t){let e=0;for(let n=0;n<t.length;n++){const r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,n++):e+=3}return e};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jt(t){return t&&t._delegate?t._delegate:t}class Pi{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gi="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z2{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new pr;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:n});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(W2(e))try{this.getOrInitializeService({instanceIdentifier:gi})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(n);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=gi){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=gi){return this.instances.has(e)}getOptions(e=gi){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[i,o]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);r===l&&o.resolve(s)}return s}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const s of r)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:H2(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=gi){return this.component?this.component.multipleInstances?e:gi:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function H2(t){return t===gi?void 0:t}function W2(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G2{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new z2(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var It;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(It||(It={}));const V2={debug:It.DEBUG,verbose:It.VERBOSE,info:It.INFO,warn:It.WARN,error:It.ERROR,silent:It.SILENT},Y2=It.INFO,K2={[It.DEBUG]:"log",[It.VERBOSE]:"log",[It.INFO]:"info",[It.WARN]:"warn",[It.ERROR]:"error"},X2=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),s=K2[e];if(s)console[s](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class qg{constructor(e){this.name=e,this._logLevel=Y2,this._logHandler=X2,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in It))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?V2[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,It.DEBUG,...e),this._logHandler(this,It.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,It.VERBOSE,...e),this._logHandler(this,It.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,It.INFO,...e),this._logHandler(this,It.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,It.WARN,...e),this._logHandler(this,It.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,It.ERROR,...e),this._logHandler(this,It.ERROR,...e)}}const Q2=(t,e)=>e.some(n=>t instanceof n);let tv,nv;function J2(){return tv||(tv=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function q2(){return nv||(nv=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const cb=new WeakMap,bp=new WeakMap,db=new WeakMap,fh=new WeakMap,Zg=new WeakMap;function Z2(t){const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("success",i),t.removeEventListener("error",o)},i=()=>{n(Hs(t.result)),s()},o=()=>{r(t.error),s()};t.addEventListener("success",i),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&cb.set(n,t)}).catch(()=>{}),Zg.set(e,t),e}function eC(t){if(bp.has(t))return;const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",o),t.removeEventListener("abort",o)},i=()=>{n(),s()},o=()=>{r(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",i),t.addEventListener("error",o),t.addEventListener("abort",o)});bp.set(t,e)}let Ep={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return bp.get(t);if(e==="objectStoreNames")return t.objectStoreNames||db.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Hs(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function tC(t){Ep=t(Ep)}function nC(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(hh(this),e,...n);return db.set(r,e.sort?e.sort():[e]),Hs(r)}:q2().includes(t)?function(...e){return t.apply(hh(this),e),Hs(cb.get(this))}:function(...e){return Hs(t.apply(hh(this),e))}}function rC(t){return typeof t=="function"?nC(t):(t instanceof IDBTransaction&&eC(t),Q2(t,J2())?new Proxy(t,Ep):t)}function Hs(t){if(t instanceof IDBRequest)return Z2(t);if(fh.has(t))return fh.get(t);const e=rC(t);return e!==t&&(fh.set(t,e),Zg.set(e,t)),e}const hh=t=>Zg.get(t);function sC(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(t,e),l=Hs(o);return r&&o.addEventListener("upgradeneeded",c=>{r(Hs(o.result),c.oldVersion,c.newVersion,Hs(o.transaction),c)}),n&&o.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),l.then(c=>{i&&c.addEventListener("close",()=>i()),s&&c.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),l}const iC=["get","getKey","getAll","getAllKeys","count"],oC=["put","add","delete","clear"],ph=new Map;function rv(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(ph.get(e))return ph.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=oC.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||iC.includes(n)))return;const i=async function(o,...l){const c=this.transaction(o,s?"readwrite":"readonly");let d=c.store;return r&&(d=d.index(l.shift())),(await Promise.all([d[n](...l),s&&c.done]))[0]};return ph.set(e,i),i}tC(t=>({...t,get:(e,n,r)=>rv(e,n)||t.get(e,n,r),has:(e,n)=>!!rv(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aC{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(lC(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function lC(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Sp="@firebase/app",sv="0.14.6";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const as=new qg("@firebase/app"),cC="@firebase/app-compat",dC="@firebase/analytics-compat",uC="@firebase/analytics",fC="@firebase/app-check-compat",hC="@firebase/app-check",pC="@firebase/auth",gC="@firebase/auth-compat",mC="@firebase/database",yC="@firebase/data-connect",vC="@firebase/database-compat",_C="@firebase/functions",xC="@firebase/functions-compat",bC="@firebase/installations",EC="@firebase/installations-compat",SC="@firebase/messaging",IC="@firebase/messaging-compat",TC="@firebase/performance",wC="@firebase/performance-compat",CC="@firebase/remote-config",kC="@firebase/remote-config-compat",RC="@firebase/storage",AC="@firebase/storage-compat",PC="@firebase/firestore",OC="@firebase/ai",LC="@firebase/firestore-compat",DC="firebase",MC="12.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ip="[DEFAULT]",NC={[Sp]:"fire-core",[cC]:"fire-core-compat",[uC]:"fire-analytics",[dC]:"fire-analytics-compat",[hC]:"fire-app-check",[fC]:"fire-app-check-compat",[pC]:"fire-auth",[gC]:"fire-auth-compat",[mC]:"fire-rtdb",[yC]:"fire-data-connect",[vC]:"fire-rtdb-compat",[_C]:"fire-fn",[xC]:"fire-fn-compat",[bC]:"fire-iid",[EC]:"fire-iid-compat",[SC]:"fire-fcm",[IC]:"fire-fcm-compat",[TC]:"fire-perf",[wC]:"fire-perf-compat",[CC]:"fire-rc",[kC]:"fire-rc-compat",[RC]:"fire-gcs",[AC]:"fire-gcs-compat",[PC]:"fire-fst",[LC]:"fire-fst-compat",[OC]:"fire-vertex","fire-js":"fire-js",[DC]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qd=new Map,jC=new Map,Tp=new Map;function iv(t,e){try{t.container.addComponent(e)}catch(n){as.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Bo(t){const e=t.name;if(Tp.has(e))return as.debug(`There were multiple attempts to register component ${e}.`),!1;Tp.set(e,t);for(const n of qd.values())iv(n,t);for(const n of jC.values())iv(n,t);return!0}function e0(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function er(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $C={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ws=new Hl("app","Firebase",$C);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FC{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Pi("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ws.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ea=MC;function ub(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:Ip,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw Ws.create("bad-app-name",{appName:String(s)});if(n||(n=rb()),!n)throw Ws.create("no-options");const i=qd.get(s);if(i){if(Ai(n,i.options)&&Ai(r,i.config))return i;throw Ws.create("duplicate-app",{appName:s})}const o=new G2(s);for(const c of Tp.values())o.addComponent(c);const l=new FC(n,r,o);return qd.set(s,l),l}function fb(t=Ip){const e=qd.get(t);if(!e&&t===Ip&&rb())return ub();if(!e)throw Ws.create("no-app",{appName:t});return e}function Gs(t,e,n){let r=NC[t]??t;n&&(r+=`-${n}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const o=[`Unable to register library "${r}" with version "${e}":`];s&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),as.warn(o.join(" "));return}Bo(new Pi(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UC="firebase-heartbeat-database",BC=1,Tl="firebase-heartbeat-store";let gh=null;function hb(){return gh||(gh=sC(UC,BC,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Tl)}catch(n){console.warn(n)}}}}).catch(t=>{throw Ws.create("idb-open",{originalErrorMessage:t.message})})),gh}async function zC(t){try{const n=(await hb()).transaction(Tl),r=await n.objectStore(Tl).get(pb(t));return await n.done,r}catch(e){if(e instanceof ii)as.warn(e.message);else{const n=Ws.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});as.warn(n.message)}}}async function ov(t,e){try{const r=(await hb()).transaction(Tl,"readwrite");await r.objectStore(Tl).put(e,pb(t)),await r.done}catch(n){if(n instanceof ii)as.warn(n.message);else{const r=Ws.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});as.warn(r.message)}}}function pb(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HC=1024,WC=30;class GC{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new YC(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=av();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)==null?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats.length>WC){const o=KC(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){as.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=av(),{heartbeatsToSend:r,unsentEntries:s}=VC(this._heartbeatsCache.heartbeats),i=Kd(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(n){return as.warn(n),""}}}function av(){return new Date().toISOString().substring(0,10)}function VC(t,e=HC){const n=[];let r=t.slice();for(const s of t){const i=n.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),lv(n)>e){i.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),lv(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class YC{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return A2()?P2().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await zC(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return ov(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return ov(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function lv(t){return Kd(JSON.stringify({version:2,heartbeats:t})).length}function KC(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XC(t){Bo(new Pi("platform-logger",e=>new aC(e),"PRIVATE")),Bo(new Pi("heartbeat",e=>new GC(e),"PRIVATE")),Gs(Sp,sv,t),Gs(Sp,sv,"esm2020"),Gs("fire-js","")}XC("");var QC="firebase",JC="12.7.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Gs(QC,JC,"app");var cv={};const dv="@firebase/database",uv="1.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gb="";function qC(t){gb=t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZC{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,n){n==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Xt(n))}get(e){const n=this.domStorage_.getItem(this.prefixedName_(e));return n==null?null:Il(n)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ek{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,n){n==null?delete this.cache_[e]:this.cache_[e]=n}get(e){return Sr(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mb=function(t){try{if(typeof window<"u"&&typeof window[t]<"u"){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new ZC(e)}}catch{}return new ek},bi=mb("localStorage"),tk=mb("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wo=new qg("@firebase/database"),yb=function(){let t=1;return function(){return t++}}(),vb=function(t){const e=B2(t),n=new j2;n.update(e);const r=n.digest();return Xg.encodeByteArray(r)},Wl=function(...t){let e="";for(let n=0;n<t.length;n++){const r=t[n];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=Wl.apply(null,r):typeof r=="object"?e+=Xt(r):e+=r,e+=" "}return e};let Ja=null,fv=!0;const nk=function(t,e){fe(!0,"Can't turn on custom loggers persistently."),wo.logLevel=It.VERBOSE,Ja=wo.log.bind(wo)},nn=function(...t){if(fv===!0&&(fv=!1,Ja===null&&tk.get("logging_enabled")===!0&&nk()),Ja){const e=Wl.apply(null,t);Ja(e)}},Gl=function(t){return function(...e){nn(t,...e)}},wp=function(...t){const e="FIREBASE INTERNAL ERROR: "+Wl(...t);wo.error(e)},ls=function(...t){const e=`FIREBASE FATAL ERROR: ${Wl(...t)}`;throw wo.error(e),new Error(e)},Cn=function(...t){const e="FIREBASE WARNING: "+Wl(...t);wo.warn(e)},rk=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Cn("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},ju=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},sk=function(t){if(document.readyState==="complete")t();else{let e=!1;const n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&n()}),window.attachEvent("onload",n))}},zo="[MIN_NAME]",Oi="[MAX_NAME]",$i=function(t,e){if(t===e)return 0;if(t===zo||e===Oi)return-1;if(e===zo||t===Oi)return 1;{const n=hv(t),r=hv(e);return n!==null?r!==null?n-r===0?t.length-e.length:n-r:-1:r!==null?1:t<e?-1:1}},ik=function(t,e){return t===e?0:t<e?-1:1},ka=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+Xt(e))},t0=function(t){if(typeof t!="object"||t===null)return Xt(t);const e=[];for(const r in t)e.push(r);e.sort();let n="{";for(let r=0;r<e.length;r++)r!==0&&(n+=","),n+=Xt(e[r]),n+=":",n+=t0(t[e[r]]);return n+="}",n},_b=function(t,e){const n=t.length;if(n<=e)return[t];const r=[];for(let s=0;s<n;s+=e)s+e>n?r.push(t.substring(s,n)):r.push(t.substring(s,s+e));return r};function sn(t,e){for(const n in t)t.hasOwnProperty(n)&&e(n,t[n])}const xb=function(t){fe(!ju(t),"Invalid JSON number");const e=11,n=52,r=(1<<e-1)-1;let s,i,o,l,c;t===0?(i=0,o=0,s=1/t===-1/0?1:0):(s=t<0,t=Math.abs(t),t>=Math.pow(2,1-r)?(l=Math.min(Math.floor(Math.log(t)/Math.LN2),r),i=l+r,o=Math.round(t*Math.pow(2,n-l)-Math.pow(2,n))):(i=0,o=Math.round(t/Math.pow(2,1-r-n))));const d=[];for(c=n;c;c-=1)d.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)d.push(i%2?1:0),i=Math.floor(i/2);d.push(s?1:0),d.reverse();const u=d.join("");let h="";for(c=0;c<64;c+=8){let f=parseInt(u.substr(c,8),2).toString(16);f.length===1&&(f="0"+f),h=h+f}return h.toLowerCase()},ok=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},ak=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function lk(t,e){let n="Unknown Error";t==="too_big"?n="The data requested exceeds the maximum size that can be accessed with a single request.":t==="permission_denied"?n="Client doesn't have permission to access the desired data.":t==="unavailable"&&(n="The service is unavailable");const r=new Error(t+" at "+e._path.toString()+": "+n);return r.code=t.toUpperCase(),r}const ck=new RegExp("^-?(0*)\\d{1,10}$"),dk=-2147483648,uk=2147483647,hv=function(t){if(ck.test(t)){const e=Number(t);if(e>=dk&&e<=uk)return e}return null},ta=function(t){try{t()}catch(e){setTimeout(()=>{const n=e.stack||"";throw Cn("Exception was thrown by user callback.",n),e},Math.floor(0))}},fk=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},qa=function(t,e){const n=setTimeout(t,e);return typeof n=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(n):typeof n=="object"&&n.unref&&n.unref(),n};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hk{constructor(e,n){this.appCheckProvider=n,this.appName=e.name,er(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=n==null?void 0:n.getImmediate({optional:!0}),this.appCheck||n==null||n.get().then(r=>this.appCheck=r)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((n,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(n,r):n(null)},0)})}addTokenChangeListener(e){var n;(n=this.appCheckProvider)==null||n.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){Cn(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pk{constructor(e,n,r){this.appName_=e,this.firebaseOptions_=n,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(n=>n&&n.code==="auth/token-not-initialized"?(nn("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(n)):new Promise((n,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(n,r):n(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(n=>n.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(n=>n.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Cn(e)}}class ud{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}ud.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n0="5",bb="v",Eb="s",Sb="r",Ib="f",Tb=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,wb="ls",Cb="p",Cp="ac",kb="websocket",Rb="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ab{constructor(e,n,r,s,i=!1,o="",l=!1,c=!1,d=null){this.secure=n,this.namespace=r,this.webSocketOnly=s,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=l,this.isUsingEmulator=c,this.emulatorOptions=d,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=bi.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&bi.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",n=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${n}`}}function gk(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function Pb(t,e,n){fe(typeof e=="string","typeof type must == string"),fe(typeof n=="object","typeof params must == object");let r;if(e===kb)r=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===Rb)r=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);gk(t)&&(n.ns=t.namespace);const s=[];return sn(n,(i,o)=>{s.push(i+"="+o)}),r+s.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mk{constructor(){this.counters_={}}incrementCounter(e,n=1){Sr(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=n}get(){return m2(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mh={},yh={};function r0(t){const e=t.toString();return mh[e]||(mh[e]=new mk),mh[e]}function yk(t,e){const n=t.toString();return yh[n]||(yh[n]=e()),yh[n]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vk{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,n){this.closeAfterResponse=e,this.onClose=n,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,n){for(this.pendingResponses[e]=n;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<r.length;++s)r[s]&&ta(()=>{this.onMessage_(r[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pv="start",_k="close",xk="pLPCommand",bk="pRTLPCB",Ob="id",Lb="pw",Db="ser",Ek="cb",Sk="seg",Ik="ts",Tk="d",wk="dframe",Mb=1870,Nb=30,Ck=Mb-Nb,kk=25e3,Rk=3e4;class vo{constructor(e,n,r,s,i,o,l){this.connId=e,this.repoInfo=n,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.transportSessionId=o,this.lastSessionId=l,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Gl(e),this.stats_=r0(n),this.urlFn=c=>(this.appCheckToken&&(c[Cp]=this.appCheckToken),Pb(n,Rb,c))}open(e,n){this.curSegmentNum=0,this.onDisconnect_=n,this.myPacketOrderer=new vk(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(Rk)),sk(()=>{if(this.isClosed_)return;this.scriptTagHolder=new s0((...i)=>{const[o,l,c,d,u]=i;if(this.incrementIncomingBytes_(i),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===pv)this.id=l,this.password=c;else if(o===_k)l?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(l,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...i)=>{const[o,l]=i;this.incrementIncomingBytes_(i),this.myPacketOrderer.handleResponse(o,l)},()=>{this.onClosed_()},this.urlFn);const r={};r[pv]="t",r[Db]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[Ek]=this.scriptTagHolder.uniqueCallbackIdentifier),r[bb]=n0,this.transportSessionId&&(r[Eb]=this.transportSessionId),this.lastSessionId&&(r[wb]=this.lastSessionId),this.applicationId&&(r[Cb]=this.applicationId),this.appCheckToken&&(r[Cp]=this.appCheckToken),typeof location<"u"&&location.hostname&&Tb.test(location.hostname)&&(r[Sb]=Ib);const s=this.urlFn(r);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){vo.forceAllow_=!0}static forceDisallow(){vo.forceDisallow_=!0}static isAvailable(){return vo.forceAllow_?!0:!vo.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!ok()&&!ak()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const n=Xt(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const r=eb(n),s=_b(r,Ck);for(let i=0;i<s.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[i]),this.curSegmentNum++}addDisconnectPingFrame(e,n){this.myDisconnFrame=document.createElement("iframe");const r={};r[wk]="t",r[Ob]=e,r[Lb]=n,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const n=Xt(e).length;this.bytesReceived+=n,this.stats_.incrementCounter("bytes_received",n)}}class s0{constructor(e,n,r,s){this.onDisconnect=r,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=yb(),window[xk+this.uniqueCallbackIdentifier]=e,window[bk+this.uniqueCallbackIdentifier]=n,this.myIFrame=s0.createIFrame_();let i="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(i='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(l){nn("frame writing exception"),l.stack&&nn(l.stack),nn(l)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||nn("No IE domain setting required")}catch{const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,n){for(this.myID=e,this.myPW=n,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[Ob]=this.myID,e[Lb]=this.myPW,e[Db]=this.currentSerial;let n=this.urlFn(e),r="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+Nb+r.length<=Mb;){const o=this.pendingSegs.shift();r=r+"&"+Sk+s+"="+o.seg+"&"+Ik+s+"="+o.ts+"&"+Tk+s+"="+o.d,s++}return n=n+r,this.addLongPollTag_(n,this.currentSerial),!0}else return!1}enqueueSegment(e,n,r){this.pendingSegs.push({seg:e,ts:n,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,n){this.outstandingRequests.add(n);const r=()=>{this.outstandingRequests.delete(n),this.newRequest_()},s=setTimeout(r,Math.floor(kk)),i=()=>{clearTimeout(s),r()};this.addTag(e,i)}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const s=r.readyState;(!s||s==="loaded"||s==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),n())},r.onerror=()=>{nn("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ak=16384,Pk=45e3;let Zd=null;typeof MozWebSocket<"u"?Zd=MozWebSocket:typeof WebSocket<"u"&&(Zd=WebSocket);class gr{constructor(e,n,r,s,i,o,l){this.connId=e,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Gl(this.connId),this.stats_=r0(n),this.connURL=gr.connectionURL_(n,o,l,s,r),this.nodeAdmin=n.nodeAdmin}static connectionURL_(e,n,r,s,i){const o={};return o[bb]=n0,typeof location<"u"&&location.hostname&&Tb.test(location.hostname)&&(o[Sb]=Ib),n&&(o[Eb]=n),r&&(o[wb]=r),s&&(o[Cp]=s),i&&(o[Cb]=i),Pb(e,kb,o)}open(e,n){this.onDisconnect=n,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,bi.set("previous_websocket_failure",!0);try{let r;R2(),this.mySock=new Zd(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){gr.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const n=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(n);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&Zd!==null&&!gr.forceDisallow_}static previouslyFailed(){return bi.isInMemoryStorage||bi.get("previous_websocket_failure")===!0}markConnectionHealthy(){bi.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const n=this.frames.join("");this.frames=null;const r=Il(n);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(fe(this.frames===null,"We already have a frame buffer"),e.length<=6){const n=Number(e);if(!isNaN(n))return this.handleNewFrameCount_(n),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const n=e.data;if(this.bytesReceived+=n.length,this.stats_.incrementCounter("bytes_received",n.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(n);else{const r=this.extractFrameCount_(n);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();const n=Xt(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const r=_b(n,Ak);r.length>1&&this.sendString_(String(r.length));for(let s=0;s<r.length;s++)this.sendString_(r[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(Pk))}sendString_(e){try{this.mySock.send(e)}catch(n){this.log_("Exception thrown from WebSocket.send():",n.message||n.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}gr.responsesRequiredToBeHealthy=2;gr.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wl{static get ALL_TRANSPORTS(){return[vo,gr]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const n=gr&&gr.isAvailable();let r=n&&!gr.previouslyFailed();if(e.webSocketOnly&&(n||Cn("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[gr];else{const s=this.transports_=[];for(const i of wl.ALL_TRANSPORTS)i&&i.isAvailable()&&s.push(i);wl.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}wl.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ok=6e4,Lk=5e3,Dk=10*1024,Mk=100*1024,vh="t",gv="d",Nk="s",mv="r",jk="e",yv="o",vv="a",_v="n",xv="p",$k="h";class Fk{constructor(e,n,r,s,i,o,l,c,d,u){this.id=e,this.repoInfo_=n,this.applicationId_=r,this.appCheckToken_=s,this.authToken_=i,this.onMessage_=o,this.onReady_=l,this.onDisconnect_=c,this.onKill_=d,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Gl("c:"+this.id+":"),this.transportManager_=new wl(n),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(n,r)},Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=qa(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>Mk?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>Dk?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return n=>{e===this.conn_?this.onConnectionLost_(n):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return n=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(n):e===this.secondaryConn_?this.onSecondaryMessageReceived_(n):this.log_("message on old connection"))}}sendRequest(e){const n={t:"d",d:e};this.sendData_(n)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(vh in e){const n=e[vh];n===vv?this.upgradeIfSecondaryHealthy_():n===mv?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):n===yv&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const n=ka("t",e),r=ka("d",e);if(n==="c")this.onSecondaryControl_(r);else if(n==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+n)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:xv,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:vv,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:_v,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const n=ka("t",e),r=ka("d",e);n==="c"?this.onControl_(r):n==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const n=ka(vh,e);if(gv in e){const r=e[gv];if(n===$k){const s={...r};this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(n===_v){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else n===Nk?this.onConnectionShutdown_(r):n===mv?this.onReset_(r):n===jk?wp("Server Error: "+r):n===yv?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):wp("Unknown control packet command: "+n)}}onHandshake_(e){const n=e.ts,r=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,n),n0!==r&&Cn("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),qa(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(Ok))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,n){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(n,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):qa(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(Lk))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:xv,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(bi.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jb{put(e,n,r,s){}merge(e,n,r,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,n,r){}onDisconnectMerge(e,n,r){}onDisconnectCancel(e,n){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $b{constructor(e){this.allowedEvents_=e,this.listeners_={},fe(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...n){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let s=0;s<r.length;s++)r[s].callback.apply(r[s].context,n)}}on(e,n,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:n,context:r});const s=this.getInitialEvent(e);s&&n.apply(r,s)}off(e,n,r){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let i=0;i<s.length;i++)if(s[i].callback===n&&(!r||r===s[i].context)){s.splice(i,1);return}}validateEventType_(e){fe(this.allowedEvents_.find(n=>n===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eu extends $b{static getInstance(){return new eu}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Jg()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return fe(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bv=32,Ev=768;class Et{constructor(e,n){if(n===void 0){this.pieces_=e.split("/");let r=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[r]=this.pieces_[s],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=n}toString(){let e="";for(let n=this.pieceNum_;n<this.pieces_.length;n++)this.pieces_[n]!==""&&(e+="/"+this.pieces_[n]);return e||"/"}}function gt(){return new Et("")}function ot(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function Js(t){return t.pieces_.length-t.pieceNum_}function wt(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new Et(t.pieces_,e)}function i0(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function Uk(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)t.pieces_[n]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}function Cl(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function Fb(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new Et(e,0)}function $t(t,e){const n=[];for(let r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);if(e instanceof Et)for(let r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);else{const r=e.split("/");for(let s=0;s<r.length;s++)r[s].length>0&&n.push(r[s])}return new Et(n,0)}function lt(t){return t.pieceNum_>=t.pieces_.length}function Tn(t,e){const n=ot(t),r=ot(e);if(n===null)return e;if(n===r)return Tn(wt(t),wt(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function Bk(t,e){const n=Cl(t,0),r=Cl(e,0);for(let s=0;s<n.length&&s<r.length;s++){const i=$i(n[s],r[s]);if(i!==0)return i}return n.length===r.length?0:n.length<r.length?-1:1}function o0(t,e){if(Js(t)!==Js(e))return!1;for(let n=t.pieceNum_,r=e.pieceNum_;n<=t.pieces_.length;n++,r++)if(t.pieces_[n]!==e.pieces_[r])return!1;return!0}function rr(t,e){let n=t.pieceNum_,r=e.pieceNum_;if(Js(t)>Js(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[r])return!1;++n,++r}return!0}class zk{constructor(e,n){this.errorPrefix_=n,this.parts_=Cl(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=Nu(this.parts_[r]);Ub(this)}}function Hk(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=Nu(e),Ub(t)}function Wk(t){const e=t.parts_.pop();t.byteLength_-=Nu(e),t.parts_.length>0&&(t.byteLength_-=1)}function Ub(t){if(t.byteLength_>Ev)throw new Error(t.errorPrefix_+"has a key path longer than "+Ev+" bytes ("+t.byteLength_+").");if(t.parts_.length>bv)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+bv+") or object contains a cycle "+mi(t))}function mi(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a0 extends $b{static getInstance(){return new a0}constructor(){super(["visible"]);let e,n;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(n="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(n="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(n="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(n="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,n&&document.addEventListener(n,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}getInitialEvent(e){return fe(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ra=1e3,Gk=60*5*1e3,Sv=30*1e3,Vk=1.3,Yk=3e4,Kk="server_kill",Iv=3;class ts extends jb{constructor(e,n,r,s,i,o,l,c){if(super(),this.repoInfo_=e,this.applicationId_=n,this.onDataUpdate_=r,this.onConnectStatus_=s,this.onServerInfoUpdate_=i,this.authTokenProvider_=o,this.appCheckTokenProvider_=l,this.authOverride_=c,this.id=ts.nextPersistentConnectionId_++,this.log_=Gl("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Ra,this.maxReconnectDelay_=Gk,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");a0.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&eu.getInstance().on("online",this.onOnline_,this)}sendRequest(e,n,r){const s=++this.requestNumber_,i={r:s,a:e,b:n};this.log_(Xt(i)),fe(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),r&&(this.requestCBHash_[s]=r)}get(e){this.initConnection_();const n=new pr,s={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const l=o.d;o.s==="ok"?n.resolve(l):n.reject(l)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),n.promise}listen(e,n,r,s){this.initConnection_();const i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),fe(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),fe(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");const l={onComplete:s,hashFn:n,query:e,tag:r};this.listens.get(o).set(i,l),this.connected_&&this.sendListen_(l)}sendGet_(e){const n=this.outstandingGets_[e];this.sendRequest("g",n.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(r)})}sendListen_(e){const n=e.query,r=n._path.toString(),s=n._queryIdentifier;this.log_("Listen on "+r+" for "+s);const i={p:r},o="q";e.tag&&(i.q=n._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest(o,i,l=>{const c=l.d,d=l.s;ts.warnOnListenWarnings_(c,n),(this.listens.get(r)&&this.listens.get(r).get(s))===e&&(this.log_("listen response",l),d!=="ok"&&this.removeListen_(r,s),e.onComplete&&e.onComplete(d,c))})}static warnOnListenWarnings_(e,n){if(e&&typeof e=="object"&&Sr(e,"w")){const r=Ri(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const s='".indexOn": "'+n._queryParams.getIndex().toString()+'"',i=n._path.toString();Cn(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${i} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||N2(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Sv)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,n=M2(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(n,r,s=>{const i=s.s,o=s.d||"error";this.authToken_===e&&(i==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(i,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const n=e.s,r=e.d||"error";n==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(n,r)})}unlisten(e,n){const r=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+s),fe(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,s)&&this.connected_&&this.sendUnlisten_(r,s,e._queryObject,n)}sendUnlisten_(e,n,r,s){this.log_("Unlisten on "+e+" for "+n);const i={p:e},o="n";s&&(i.q=r,i.t=s),this.sendRequest(o,i)}onDisconnectPut(e,n,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,n,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:n,onComplete:r})}onDisconnectMerge(e,n,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,n,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:n,onComplete:r})}onDisconnectCancel(e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:n})}sendOnDisconnect_(e,n,r,s){const i={p:n,d:r};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,o=>{s&&setTimeout(()=>{s(o.s,o.d)},Math.floor(0))})}put(e,n,r,s){this.putInternal("p",e,n,r,s)}merge(e,n,r,s){this.putInternal("m",e,n,r,s)}putInternal(e,n,r,s,i){this.initConnection_();const o={p:n,d:r};i!==void 0&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:s}),this.outstandingPutCount_++;const l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+n)}sendPut_(e){const n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,s=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,i=>{this.log_(n+" response",i),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(i.s,i.d)})}reportStats(e){if(this.connected_){const n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,r=>{if(r.s!=="ok"){const i=r.d;this.log_("reportStats","Error sending stats: "+i)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Xt(e));const n=e.r,r=this.requestCBHash_[n];r&&(delete this.requestCBHash_[n],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,n){this.log_("handleServerMessage",e,n),e==="d"?this.onDataUpdate_(n.p,n.d,!1,n.t):e==="m"?this.onDataUpdate_(n.p,n.d,!0,n.t):e==="c"?this.onListenRevoked_(n.p,n.q):e==="ac"?this.onAuthRevoked_(n.s,n.d):e==="apc"?this.onAppCheckRevoked_(n.s,n.d):e==="sd"?this.onSecurityDebugPacket_(n):wp("Unrecognized action received from server: "+Xt(e)+`
Are you using the latest client?`)}onReady_(e,n){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=n,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){fe(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Ra,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Ra,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>Yk&&(this.reconnectDelay_=Ra),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let n=Math.max(0,this.reconnectDelay_-e);n=Math.random()*n,this.log_("Trying to reconnect in "+n+"ms"),this.scheduleConnect_(n),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Vk)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+ts.nextConnectionId_++,i=this.lastSessionId;let o=!1,l=null;const c=function(){l?l.close():(o=!0,r())},d=function(h){fe(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(h)};this.realtime_={close:c,sendRequest:d};const u=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[h,f]=await Promise.all([this.authTokenProvider_.getToken(u),this.appCheckTokenProvider_.getToken(u)]);o?nn("getToken() completed but was canceled"):(nn("getToken() completed. Creating connection."),this.authToken_=h&&h.accessToken,this.appCheckToken_=f&&f.token,l=new Fk(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,r,E=>{Cn(E+" ("+this.repoInfo_.toString()+")"),this.interrupt(Kk)},i))}catch(h){this.log_("Failed to get token: "+h),o||(this.repoInfo_.nodeAdmin&&Cn(h),c())}}}interrupt(e){nn("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){nn("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Qd(this.interruptReasons_)&&(this.reconnectDelay_=Ra,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const n=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:n})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const n=this.outstandingPuts_[e];n&&"h"in n.request&&n.queued&&(n.onComplete&&n.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,n){let r;n?r=n.map(i=>t0(i)).join("$"):r="default";const s=this.removeListen_(e,r);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(e,n){const r=new Et(e).toString();let s;if(this.listens.has(r)){const i=this.listens.get(r);s=i.get(n),i.delete(n),i.size===0&&this.listens.delete(r)}else s=void 0;return s}onAuthRevoked_(e,n){nn("Auth token revoked: "+e+"/"+n),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Iv&&(this.reconnectDelay_=Sv,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,n){nn("App check token revoked: "+e+"/"+n),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Iv&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const n of e.values())this.sendListen_(n);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let n="js";e["sdk."+n+"."+gb.replace(/\./g,"-")]=1,Jg()?e["framework.cordova"]=1:ab()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=eu.getInstance().currentlyOnline();return Qd(this.interruptReasons_)&&e}}ts.nextPersistentConnectionId_=0;ts.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ct{constructor(e,n){this.name=e,this.node=n}static Wrap(e,n){return new ct(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $u{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,n){const r=new ct(zo,e),s=new ct(zo,n);return this.compare(r,s)!==0}minPost(){return ct.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Wc;class Bb extends $u{static get __EMPTY_NODE(){return Wc}static set __EMPTY_NODE(e){Wc=e}compare(e,n){return $i(e.name,n.name)}isDefinedOn(e){throw Jo("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,n){return!1}minPost(){return ct.MIN}maxPost(){return new ct(Oi,Wc)}makePost(e,n){return fe(typeof e=="string","KeyIndex indexValue must always be a string."),new ct(e,Wc)}toString(){return".key"}}const Co=new Bb;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gc{constructor(e,n,r,s,i=null){this.isReverse_=s,this.resultGenerator_=i,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=n?r(e.key,n):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),n;if(this.resultGenerator_?n=this.resultGenerator_(e.key,e.value):n={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return n}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class tn{constructor(e,n,r,s,i){this.key=e,this.value=n,this.color=r??tn.RED,this.left=s??Nn.EMPTY_NODE,this.right=i??Nn.EMPTY_NODE}copy(e,n,r,s,i){return new tn(e??this.key,n??this.value,r??this.color,s??this.left,i??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let s=this;const i=r(e,s.key);return i<0?s=s.copy(null,null,null,s.left.insert(e,n,r),null):i===0?s=s.copy(null,n,null,null,null):s=s.copy(null,null,null,null,s.right.insert(e,n,r)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return Nn.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,n){let r,s;if(r=this,n(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,n),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),n(e,r.key)===0){if(r.right.isEmpty())return Nn.EMPTY_NODE;s=r.right.min_(),r=r.copy(s.key,s.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,n))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,tn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,tn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}tn.RED=!0;tn.BLACK=!1;class Xk{copy(e,n,r,s,i){return this}insert(e,n,r){return new tn(e,n,null)}remove(e,n){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class Nn{constructor(e,n=Nn.EMPTY_NODE){this.comparator_=e,this.root_=n}insert(e,n){return new Nn(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,tn.BLACK,null,null))}remove(e){return new Nn(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,tn.BLACK,null,null))}get(e){let n,r=this.root_;for(;!r.isEmpty();){if(n=this.comparator_(e,r.key),n===0)return r.value;n<0?r=r.left:n>0&&(r=r.right)}return null}getPredecessorKey(e){let n,r=this.root_,s=null;for(;!r.isEmpty();)if(n=this.comparator_(e,r.key),n===0){if(r.left.isEmpty())return s?s.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else n<0?r=r.left:n>0&&(s=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Gc(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,n){return new Gc(this.root_,e,this.comparator_,!1,n)}getReverseIteratorFrom(e,n){return new Gc(this.root_,e,this.comparator_,!0,n)}getReverseIterator(e){return new Gc(this.root_,null,this.comparator_,!0,e)}}Nn.EMPTY_NODE=new Xk;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qk(t,e){return $i(t.name,e.name)}function l0(t,e){return $i(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let kp;function Jk(t){kp=t}const zb=function(t){return typeof t=="number"?"number:"+xb(t):"string:"+t},Hb=function(t){if(t.isLeafNode()){const e=t.val();fe(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Sr(e,".sv"),"Priority must be a string or number.")}else fe(t===kp||t.isEmpty(),"priority of unexpected type.");fe(t===kp||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Tv;class Zt{static set __childrenNodeConstructor(e){Tv=e}static get __childrenNodeConstructor(){return Tv}constructor(e,n=Zt.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=n,this.lazyHash_=null,fe(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),Hb(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Zt(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:Zt.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return lt(e)?this:ot(e)===".priority"?this.priorityNode_:Zt.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,n){return null}updateImmediateChild(e,n){return e===".priority"?this.updatePriority(n):n.isEmpty()&&e!==".priority"?this:Zt.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)}updateChild(e,n){const r=ot(e);return r===null?n:n.isEmpty()&&r!==".priority"?this:(fe(r!==".priority"||Js(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,Zt.__childrenNodeConstructor.EMPTY_NODE.updateChild(wt(e),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,n){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+zb(this.priorityNode_.val())+":");const n=typeof this.value_;e+=n+":",n==="number"?e+=xb(this.value_):e+=this.value_,this.lazyHash_=vb(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Zt.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Zt.__childrenNodeConstructor?-1:(fe(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const n=typeof e.value_,r=typeof this.value_,s=Zt.VALUE_TYPE_ORDER.indexOf(n),i=Zt.VALUE_TYPE_ORDER.indexOf(r);return fe(s>=0,"Unknown leaf type: "+n),fe(i>=0,"Unknown leaf type: "+r),s===i?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const n=e;return this.value_===n.value_&&this.priorityNode_.equals(n.priorityNode_)}else return!1}}Zt.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Wb,Gb;function qk(t){Wb=t}function Zk(t){Gb=t}class e5 extends $u{compare(e,n){const r=e.node.getPriority(),s=n.node.getPriority(),i=r.compareTo(s);return i===0?$i(e.name,n.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,n){return!e.getPriority().equals(n.getPriority())}minPost(){return ct.MIN}maxPost(){return new ct(Oi,new Zt("[PRIORITY-POST]",Gb))}makePost(e,n){const r=Wb(e);return new ct(n,new Zt("[PRIORITY-POST]",r))}toString(){return".priority"}}const Mt=new e5;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t5=Math.log(2);class n5{constructor(e){const n=i=>parseInt(Math.log(i)/t5,10),r=i=>parseInt(Array(i+1).join("1"),2);this.count=n(e+1),this.current_=this.count-1;const s=r(this.count);this.bits_=e+1&s}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const tu=function(t,e,n,r){t.sort(e);const s=function(c,d){const u=d-c;let h,f;if(u===0)return null;if(u===1)return h=t[c],f=n?n(h):h,new tn(f,h.node,tn.BLACK,null,null);{const E=parseInt(u/2,10)+c,k=s(c,E),w=s(E+1,d);return h=t[E],f=n?n(h):h,new tn(f,h.node,tn.BLACK,k,w)}},i=function(c){let d=null,u=null,h=t.length;const f=function(k,w){const $=h-k,v=h;h-=k;const _=s($+1,v),S=t[$],p=n?n(S):S;E(new tn(p,S.node,w,null,_))},E=function(k){d?(d.left=k,d=k):(u=k,d=k)};for(let k=0;k<c.count;++k){const w=c.nextBitIsOne(),$=Math.pow(2,c.count-(k+1));w?f($,tn.BLACK):(f($,tn.BLACK),f($,tn.RED))}return u},o=new n5(t.length),l=i(o);return new Nn(r||e,l)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _h;const no={};class Jr{static get Default(){return fe(no&&Mt,"ChildrenNode.ts has not been loaded"),_h=_h||new Jr({".priority":no},{".priority":Mt}),_h}constructor(e,n){this.indexes_=e,this.indexSet_=n}get(e){const n=Ri(this.indexes_,e);if(!n)throw new Error("No index defined for "+e);return n instanceof Nn?n:null}hasIndex(e){return Sr(this.indexSet_,e.toString())}addIndex(e,n){fe(e!==Co,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let s=!1;const i=n.getIterator(ct.Wrap);let o=i.getNext();for(;o;)s=s||e.isDefinedOn(o.node),r.push(o),o=i.getNext();let l;s?l=tu(r,e.getCompare()):l=no;const c=e.toString(),d={...this.indexSet_};d[c]=e;const u={...this.indexes_};return u[c]=l,new Jr(u,d)}addToIndexes(e,n){const r=Jd(this.indexes_,(s,i)=>{const o=Ri(this.indexSet_,i);if(fe(o,"Missing index implementation for "+i),s===no)if(o.isDefinedOn(e.node)){const l=[],c=n.getIterator(ct.Wrap);let d=c.getNext();for(;d;)d.name!==e.name&&l.push(d),d=c.getNext();return l.push(e),tu(l,o.getCompare())}else return no;else{const l=n.get(e.name);let c=s;return l&&(c=c.remove(new ct(e.name,l))),c.insert(e,e.node)}});return new Jr(r,this.indexSet_)}removeFromIndexes(e,n){const r=Jd(this.indexes_,s=>{if(s===no)return s;{const i=n.get(e.name);return i?s.remove(new ct(e.name,i)):s}});return new Jr(r,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Aa;class Be{static get EMPTY_NODE(){return Aa||(Aa=new Be(new Nn(l0),null,Jr.Default))}constructor(e,n,r){this.children_=e,this.priorityNode_=n,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&Hb(this.priorityNode_),this.children_.isEmpty()&&fe(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Aa}updatePriority(e){return this.children_.isEmpty()?this:new Be(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const n=this.children_.get(e);return n===null?Aa:n}}getChild(e){const n=ot(e);return n===null?this:this.getImmediateChild(n).getChild(wt(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,n){if(fe(n,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(n);{const r=new ct(e,n);let s,i;n.isEmpty()?(s=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(r,this.children_)):(s=this.children_.insert(e,n),i=this.indexMap_.addToIndexes(r,this.children_));const o=s.isEmpty()?Aa:this.priorityNode_;return new Be(s,o,i)}}updateChild(e,n){const r=ot(e);if(r===null)return n;{fe(ot(e)!==".priority"||Js(e)===1,".priority must be the last token in a path");const s=this.getImmediateChild(r).updateChild(wt(e),n);return this.updateImmediateChild(r,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const n={};let r=0,s=0,i=!0;if(this.forEachChild(Mt,(o,l)=>{n[o]=l.val(e),r++,i&&Be.INTEGER_REGEXP_.test(o)?s=Math.max(s,Number(o)):i=!1}),!e&&i&&s<2*r){const o=[];for(const l in n)o[l]=n[l];return o}else return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+zb(this.getPriority().val())+":"),this.forEachChild(Mt,(n,r)=>{const s=r.hash();s!==""&&(e+=":"+n+":"+s)}),this.lazyHash_=e===""?"":vb(e)}return this.lazyHash_}getPredecessorChildName(e,n,r){const s=this.resolveIndex_(r);if(s){const i=s.getPredecessorKey(new ct(e,n));return i?i.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const n=this.resolveIndex_(e);if(n){const r=n.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){const n=this.getFirstChildName(e);return n?new ct(n,this.children_.get(n)):null}getLastChildName(e){const n=this.resolveIndex_(e);if(n){const r=n.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){const n=this.getLastChildName(e);return n?new ct(n,this.children_.get(n)):null}forEachChild(e,n){const r=this.resolveIndex_(e);return r?r.inorderTraversal(s=>n(s.name,s.node)):this.children_.inorderTraversal(n)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,n){const r=this.resolveIndex_(n);if(r)return r.getIteratorFrom(e,s=>s);{const s=this.children_.getIteratorFrom(e.name,ct.Wrap);let i=s.peek();for(;i!=null&&n.compare(i,e)<0;)s.getNext(),i=s.peek();return s}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,n){const r=this.resolveIndex_(n);if(r)return r.getReverseIteratorFrom(e,s=>s);{const s=this.children_.getReverseIteratorFrom(e.name,ct.Wrap);let i=s.peek();for(;i!=null&&n.compare(i,e)>0;)s.getNext(),i=s.peek();return s}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Vl?-1:0}withIndex(e){if(e===Co||this.indexMap_.hasIndex(e))return this;{const n=this.indexMap_.addIndex(e,this.children_);return new Be(this.children_,this.priorityNode_,n)}}isIndexed(e){return e===Co||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority()))if(this.children_.count()===n.children_.count()){const r=this.getIterator(Mt),s=n.getIterator(Mt);let i=r.getNext(),o=s.getNext();for(;i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=r.getNext(),o=s.getNext()}return i===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===Co?null:this.indexMap_.get(e.toString())}}Be.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class r5 extends Be{constructor(){super(new Nn(l0),Be.EMPTY_NODE,Jr.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Be.EMPTY_NODE}isEmpty(){return!1}}const Vl=new r5;Object.defineProperties(ct,{MIN:{value:new ct(zo,Be.EMPTY_NODE)},MAX:{value:new ct(Oi,Vl)}});Bb.__EMPTY_NODE=Be.EMPTY_NODE;Zt.__childrenNodeConstructor=Be;Jk(Vl);Zk(Vl);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const s5=!0;function jt(t,e=null){if(t===null)return Be.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),fe(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){const n=t;return new Zt(n,jt(e))}if(!(t instanceof Array)&&s5){const n=[];let r=!1;if(sn(t,(o,l)=>{if(o.substring(0,1)!=="."){const c=jt(l);c.isEmpty()||(r=r||!c.getPriority().isEmpty(),n.push(new ct(o,c)))}}),n.length===0)return Be.EMPTY_NODE;const i=tu(n,Qk,o=>o.name,l0);if(r){const o=tu(n,Mt.getCompare());return new Be(i,jt(e),new Jr({".priority":o},{".priority":Mt}))}else return new Be(i,jt(e),Jr.Default)}else{let n=Be.EMPTY_NODE;return sn(t,(r,s)=>{if(Sr(t,r)&&r.substring(0,1)!=="."){const i=jt(s);(i.isLeafNode()||!i.isEmpty())&&(n=n.updateImmediateChild(r,i))}}),n.updatePriority(jt(e))}}qk(jt);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i5 extends $u{constructor(e){super(),this.indexPath_=e,fe(!lt(e)&&ot(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,n){const r=this.extractChild(e.node),s=this.extractChild(n.node),i=r.compareTo(s);return i===0?$i(e.name,n.name):i}makePost(e,n){const r=jt(e),s=Be.EMPTY_NODE.updateChild(this.indexPath_,r);return new ct(n,s)}maxPost(){const e=Be.EMPTY_NODE.updateChild(this.indexPath_,Vl);return new ct(Oi,e)}toString(){return Cl(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o5 extends $u{compare(e,n){const r=e.node.compareTo(n.node);return r===0?$i(e.name,n.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,n){return!e.equals(n)}minPost(){return ct.MIN}maxPost(){return ct.MAX}makePost(e,n){const r=jt(e);return new ct(n,r)}toString(){return".value"}}const a5=new o5;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vb(t){return{type:"value",snapshotNode:t}}function Ho(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function kl(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function Rl(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}function l5(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c0{constructor(e){this.index_=e}updateChild(e,n,r,s,i,o){fe(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const l=e.getImmediateChild(n);return l.getChild(s).equals(r.getChild(s))&&l.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(n)?o.trackChildChange(kl(n,l)):fe(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):l.isEmpty()?o.trackChildChange(Ho(n,r)):o.trackChildChange(Rl(n,r,l))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(n,r).withIndex(this.index_)}updateFullNode(e,n,r){return r!=null&&(e.isLeafNode()||e.forEachChild(Mt,(s,i)=>{n.hasChild(s)||r.trackChildChange(kl(s,i))}),n.isLeafNode()||n.forEachChild(Mt,(s,i)=>{if(e.hasChild(s)){const o=e.getImmediateChild(s);o.equals(i)||r.trackChildChange(Rl(s,i,o))}else r.trackChildChange(Ho(s,i))})),n.withIndex(this.index_)}updatePriority(e,n){return e.isEmpty()?Be.EMPTY_NODE:e.updatePriority(n)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Al{constructor(e){this.indexedFilter_=new c0(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Al.getStartPost_(e),this.endPost_=Al.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const n=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return n&&r}updateChild(e,n,r,s,i,o){return this.matches(new ct(n,r))||(r=Be.EMPTY_NODE),this.indexedFilter_.updateChild(e,n,r,s,i,o)}updateFullNode(e,n,r){n.isLeafNode()&&(n=Be.EMPTY_NODE);let s=n.withIndex(this.index_);s=s.updatePriority(Be.EMPTY_NODE);const i=this;return n.forEachChild(Mt,(o,l)=>{i.matches(new ct(o,l))||(s=s.updateImmediateChild(o,Be.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,r)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const n=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),n)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const n=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),n)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c5{constructor(e){this.withinDirectionalStart=n=>this.reverse_?this.withinEndPost(n):this.withinStartPost(n),this.withinDirectionalEnd=n=>this.reverse_?this.withinStartPost(n):this.withinEndPost(n),this.withinStartPost=n=>{const r=this.index_.compare(this.rangedFilter_.getStartPost(),n);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=n=>{const r=this.index_.compare(n,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new Al(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,n,r,s,i,o){return this.rangedFilter_.matches(new ct(n,r))||(r=Be.EMPTY_NODE),e.getImmediateChild(n).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,n,r,s,i,o):this.fullLimitUpdateChild_(e,n,r,i,o)}updateFullNode(e,n,r){let s;if(n.isLeafNode()||n.isEmpty())s=Be.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<n.numChildren()&&n.isIndexed(this.index_)){s=Be.EMPTY_NODE.withIndex(this.index_);let i;this.reverse_?i=n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):i=n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;i.hasNext()&&o<this.limit_;){const l=i.getNext();if(this.withinDirectionalStart(l))if(this.withinDirectionalEnd(l))s=s.updateImmediateChild(l.name,l.node),o++;else break;else continue}}else{s=n.withIndex(this.index_),s=s.updatePriority(Be.EMPTY_NODE);let i;this.reverse_?i=s.getReverseIterator(this.index_):i=s.getIterator(this.index_);let o=0;for(;i.hasNext();){const l=i.getNext();o<this.limit_&&this.withinDirectionalStart(l)&&this.withinDirectionalEnd(l)?o++:s=s.updateImmediateChild(l.name,Be.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,r)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,n,r,s,i){let o;if(this.reverse_){const h=this.index_.getCompare();o=(f,E)=>h(E,f)}else o=this.index_.getCompare();const l=e;fe(l.numChildren()===this.limit_,"");const c=new ct(n,r),d=this.reverse_?l.getFirstChild(this.index_):l.getLastChild(this.index_),u=this.rangedFilter_.matches(c);if(l.hasChild(n)){const h=l.getImmediateChild(n);let f=s.getChildAfterChild(this.index_,d,this.reverse_);for(;f!=null&&(f.name===n||l.hasChild(f.name));)f=s.getChildAfterChild(this.index_,f,this.reverse_);const E=f==null?1:o(f,c);if(u&&!r.isEmpty()&&E>=0)return i!=null&&i.trackChildChange(Rl(n,r,h)),l.updateImmediateChild(n,r);{i!=null&&i.trackChildChange(kl(n,h));const w=l.updateImmediateChild(n,Be.EMPTY_NODE);return f!=null&&this.rangedFilter_.matches(f)?(i!=null&&i.trackChildChange(Ho(f.name,f.node)),w.updateImmediateChild(f.name,f.node)):w}}else return r.isEmpty()?e:u&&o(d,c)>=0?(i!=null&&(i.trackChildChange(kl(d.name,d.node)),i.trackChildChange(Ho(n,r))),l.updateImmediateChild(n,r).updateImmediateChild(d.name,Be.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d0{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Mt}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return fe(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return fe(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:zo}hasEnd(){return this.endSet_}getIndexEndValue(){return fe(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return fe(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Oi}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return fe(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Mt}copy(){const e=new d0;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function d5(t){return t.loadsAllData()?new c0(t.getIndex()):t.hasLimit()?new c5(t):new Al(t)}function wv(t){const e={};if(t.isDefault())return e;let n;if(t.index_===Mt?n="$priority":t.index_===a5?n="$value":t.index_===Co?n="$key":(fe(t.index_ instanceof i5,"Unrecognized index type!"),n=t.index_.toString()),e.orderBy=Xt(n),t.startSet_){const r=t.startAfterSet_?"startAfter":"startAt";e[r]=Xt(t.indexStartValue_),t.startNameSet_&&(e[r]+=","+Xt(t.indexStartName_))}if(t.endSet_){const r=t.endBeforeSet_?"endBefore":"endAt";e[r]=Xt(t.indexEndValue_),t.endNameSet_&&(e[r]+=","+Xt(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function Cv(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;n===""&&(t.isViewFromLeft()?n="l":n="r"),e.vf=n}return t.index_!==Mt&&(e.i=t.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nu extends jb{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,n){return n!==void 0?"tag$"+n:(fe(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,n,r,s){super(),this.repoInfo_=e,this.onDataUpdate_=n,this.authTokenProvider_=r,this.appCheckTokenProvider_=s,this.log_=Gl("p:rest:"),this.listens_={}}listen(e,n,r,s){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const o=nu.getListenId_(e,r),l={};this.listens_[o]=l;const c=wv(e._queryParams);this.restRequest_(i+".json",c,(d,u)=>{let h=u;if(d===404&&(h=null,d=null),d===null&&this.onDataUpdate_(i,h,!1,r),Ri(this.listens_,o)===l){let f;d?d===401?f="permission_denied":f="rest_error:"+d:f="ok",s(f,null)}})}unlisten(e,n){const r=nu.getListenId_(e,n);delete this.listens_[r]}get(e){const n=wv(e._queryParams),r=e._path.toString(),s=new pr;return this.restRequest_(r+".json",n,(i,o)=>{let l=o;i===404&&(l=null,i=null),i===null?(this.onDataUpdate_(r,l,!1,null),s.resolve(l)):s.reject(new Error(l))}),s.promise}refreshAuthToken(e){}restRequest_(e,n={},r){return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,i])=>{s&&s.accessToken&&(n.auth=s.accessToken),i&&i.token&&(n.ac=i.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Zo(n);this.log_("Sending REST request for "+o);const l=new XMLHttpRequest;l.onreadystatechange=()=>{if(r&&l.readyState===4){this.log_("REST Response for "+o+" received. status:",l.status,"response:",l.responseText);let c=null;if(l.status>=200&&l.status<300){try{c=Il(l.responseText)}catch{Cn("Failed to parse JSON response for "+o+": "+l.responseText)}r(null,c)}else l.status!==401&&l.status!==404&&Cn("Got unsuccessful REST response for "+o+" Status: "+l.status),r(l.status);r=null}},l.open("GET",o,!0),l.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u5{constructor(){this.rootNode_=Be.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,n){this.rootNode_=this.rootNode_.updateChild(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ru(){return{value:null,children:new Map}}function na(t,e,n){if(lt(e))t.value=n,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,n);else{const r=ot(e);t.children.has(r)||t.children.set(r,ru());const s=t.children.get(r);e=wt(e),na(s,e,n)}}function Rp(t,e){if(lt(e))return t.value=null,t.children.clear(),!0;if(t.value!==null){if(t.value.isLeafNode())return!1;{const n=t.value;return t.value=null,n.forEachChild(Mt,(r,s)=>{na(t,new Et(r),s)}),Rp(t,e)}}else if(t.children.size>0){const n=ot(e);return e=wt(e),t.children.has(n)&&Rp(t.children.get(n),e)&&t.children.delete(n),t.children.size===0}else return!0}function Ap(t,e,n){t.value!==null?n(e,t.value):f5(t,(r,s)=>{const i=new Et(e.toString()+"/"+r);Ap(s,i,n)})}function f5(t,e){t.children.forEach((n,r)=>{e(r,n)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h5{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),n={...e};return this.last_&&sn(this.last_,(r,s)=>{n[r]=n[r]-s}),this.last_=e,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kv=10*1e3,p5=30*1e3,g5=5*60*1e3;class m5{constructor(e,n){this.server_=n,this.statsToReport_={},this.statsListener_=new h5(e);const r=kv+(p5-kv)*Math.random();qa(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),n={};let r=!1;sn(e,(s,i)=>{i>0&&Sr(this.statsToReport_,s)&&(n[s]=i,r=!0)}),r&&this.server_.reportStats(n),qa(this.reportStats_.bind(this),Math.floor(Math.random()*2*g5))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var mr;(function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(mr||(mr={}));function u0(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function f0(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function h0(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class su{constructor(e,n,r){this.path=e,this.affectedTree=n,this.revert=r,this.type=mr.ACK_USER_WRITE,this.source=u0()}operationForChild(e){if(lt(this.path)){if(this.affectedTree.value!=null)return fe(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const n=this.affectedTree.subtree(new Et(e));return new su(gt(),n,this.revert)}}else return fe(ot(this.path)===e,"operationForChild called for unrelated child."),new su(wt(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pl{constructor(e,n){this.source=e,this.path=n,this.type=mr.LISTEN_COMPLETE}operationForChild(e){return lt(this.path)?new Pl(this.source,gt()):new Pl(this.source,wt(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Li{constructor(e,n,r){this.source=e,this.path=n,this.snap=r,this.type=mr.OVERWRITE}operationForChild(e){return lt(this.path)?new Li(this.source,gt(),this.snap.getImmediateChild(e)):new Li(this.source,wt(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wo{constructor(e,n,r){this.source=e,this.path=n,this.children=r,this.type=mr.MERGE}operationForChild(e){if(lt(this.path)){const n=this.children.subtree(new Et(e));return n.isEmpty()?null:n.value?new Li(this.source,gt(),n.value):new Wo(this.source,gt(),n)}else return fe(ot(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Wo(this.source,wt(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qs{constructor(e,n,r){this.node_=e,this.fullyInitialized_=n,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(lt(e))return this.isFullyInitialized()&&!this.filtered_;const n=ot(e);return this.isCompleteForChild(n)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y5{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function v5(t,e,n,r){const s=[],i=[];return e.forEach(o=>{o.type==="child_changed"&&t.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&i.push(l5(o.childName,o.snapshotNode))}),Pa(t,s,"child_removed",e,r,n),Pa(t,s,"child_added",e,r,n),Pa(t,s,"child_moved",i,r,n),Pa(t,s,"child_changed",e,r,n),Pa(t,s,"value",e,r,n),s}function Pa(t,e,n,r,s,i){const o=r.filter(l=>l.type===n);o.sort((l,c)=>x5(t,l,c)),o.forEach(l=>{const c=_5(t,l,i);s.forEach(d=>{d.respondsTo(l.type)&&e.push(d.createEvent(c,t.query_))})})}function _5(t,e,n){return e.type==="value"||e.type==="child_removed"||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function x5(t,e,n){if(e.childName==null||n.childName==null)throw Jo("Should only compare child_ events.");const r=new ct(e.childName,e.snapshotNode),s=new ct(n.childName,n.snapshotNode);return t.index_.compare(r,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fu(t,e){return{eventCache:t,serverCache:e}}function Za(t,e,n,r){return Fu(new qs(e,n,r),t.serverCache)}function Yb(t,e,n,r){return Fu(t.eventCache,new qs(e,n,r))}function iu(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function Di(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let xh;const b5=()=>(xh||(xh=new Nn(ik)),xh);class kt{static fromObject(e){let n=new kt(null);return sn(e,(r,s)=>{n=n.set(new Et(r),s)}),n}constructor(e,n=b5()){this.value=e,this.children=n}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,n){if(this.value!=null&&n(this.value))return{path:gt(),value:this.value};if(lt(e))return null;{const r=ot(e),s=this.children.get(r);if(s!==null){const i=s.findRootMostMatchingPathAndValue(wt(e),n);return i!=null?{path:$t(new Et(r),i.path),value:i.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(lt(e))return this;{const n=ot(e),r=this.children.get(n);return r!==null?r.subtree(wt(e)):new kt(null)}}set(e,n){if(lt(e))return new kt(n,this.children);{const r=ot(e),i=(this.children.get(r)||new kt(null)).set(wt(e),n),o=this.children.insert(r,i);return new kt(this.value,o)}}remove(e){if(lt(e))return this.children.isEmpty()?new kt(null):new kt(null,this.children);{const n=ot(e),r=this.children.get(n);if(r){const s=r.remove(wt(e));let i;return s.isEmpty()?i=this.children.remove(n):i=this.children.insert(n,s),this.value===null&&i.isEmpty()?new kt(null):new kt(this.value,i)}else return this}}get(e){if(lt(e))return this.value;{const n=ot(e),r=this.children.get(n);return r?r.get(wt(e)):null}}setTree(e,n){if(lt(e))return n;{const r=ot(e),i=(this.children.get(r)||new kt(null)).setTree(wt(e),n);let o;return i.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,i),new kt(this.value,o)}}fold(e){return this.fold_(gt(),e)}fold_(e,n){const r={};return this.children.inorderTraversal((s,i)=>{r[s]=i.fold_($t(e,s),n)}),n(e,this.value,r)}findOnPath(e,n){return this.findOnPath_(e,gt(),n)}findOnPath_(e,n,r){const s=this.value?r(n,this.value):!1;if(s)return s;if(lt(e))return null;{const i=ot(e),o=this.children.get(i);return o?o.findOnPath_(wt(e),$t(n,i),r):null}}foreachOnPath(e,n){return this.foreachOnPath_(e,gt(),n)}foreachOnPath_(e,n,r){if(lt(e))return this;{this.value&&r(n,this.value);const s=ot(e),i=this.children.get(s);return i?i.foreachOnPath_(wt(e),$t(n,s),r):new kt(null)}}foreach(e){this.foreach_(gt(),e)}foreach_(e,n){this.children.inorderTraversal((r,s)=>{s.foreach_($t(e,r),n)}),this.value&&n(e,this.value)}foreachChild(e){this.children.inorderTraversal((n,r)=>{r.value&&e(n,r.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xr{constructor(e){this.writeTree_=e}static empty(){return new xr(new kt(null))}}function el(t,e,n){if(lt(e))return new xr(new kt(n));{const r=t.writeTree_.findRootMostValueAndPath(e);if(r!=null){const s=r.path;let i=r.value;const o=Tn(s,e);return i=i.updateChild(o,n),new xr(t.writeTree_.set(s,i))}else{const s=new kt(n),i=t.writeTree_.setTree(e,s);return new xr(i)}}}function Pp(t,e,n){let r=t;return sn(n,(s,i)=>{r=el(r,$t(e,s),i)}),r}function Rv(t,e){if(lt(e))return xr.empty();{const n=t.writeTree_.setTree(e,new kt(null));return new xr(n)}}function Op(t,e){return Fi(t,e)!=null}function Fi(t,e){const n=t.writeTree_.findRootMostValueAndPath(e);return n!=null?t.writeTree_.get(n.path).getChild(Tn(n.path,e)):null}function Av(t){const e=[],n=t.writeTree_.value;return n!=null?n.isLeafNode()||n.forEachChild(Mt,(r,s)=>{e.push(new ct(r,s))}):t.writeTree_.children.inorderTraversal((r,s)=>{s.value!=null&&e.push(new ct(r,s.value))}),e}function Vs(t,e){if(lt(e))return t;{const n=Fi(t,e);return n!=null?new xr(new kt(n)):new xr(t.writeTree_.subtree(e))}}function Lp(t){return t.writeTree_.isEmpty()}function Go(t,e){return Kb(gt(),t.writeTree_,e)}function Kb(t,e,n){if(e.value!=null)return n.updateChild(t,e.value);{let r=null;return e.children.inorderTraversal((s,i)=>{s===".priority"?(fe(i.value!==null,"Priority writes must always be leaf nodes"),r=i.value):n=Kb($t(t,s),i,n)}),!n.getChild(t).isEmpty()&&r!==null&&(n=n.updateChild($t(t,".priority"),r)),n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uu(t,e){return qb(e,t)}function E5(t,e,n,r,s){fe(r>t.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),t.allWrites.push({path:e,snap:n,writeId:r,visible:s}),s&&(t.visibleWrites=el(t.visibleWrites,e,n)),t.lastWriteId=r}function S5(t,e,n,r){fe(r>t.lastWriteId,"Stacking an older merge on top of newer ones"),t.allWrites.push({path:e,children:n,writeId:r,visible:!0}),t.visibleWrites=Pp(t.visibleWrites,e,n),t.lastWriteId=r}function I5(t,e){for(let n=0;n<t.allWrites.length;n++){const r=t.allWrites[n];if(r.writeId===e)return r}return null}function T5(t,e){const n=t.allWrites.findIndex(l=>l.writeId===e);fe(n>=0,"removeWrite called with nonexistent writeId.");const r=t.allWrites[n];t.allWrites.splice(n,1);let s=r.visible,i=!1,o=t.allWrites.length-1;for(;s&&o>=0;){const l=t.allWrites[o];l.visible&&(o>=n&&w5(l,r.path)?s=!1:rr(r.path,l.path)&&(i=!0)),o--}if(s){if(i)return C5(t),!0;if(r.snap)t.visibleWrites=Rv(t.visibleWrites,r.path);else{const l=r.children;sn(l,c=>{t.visibleWrites=Rv(t.visibleWrites,$t(r.path,c))})}return!0}else return!1}function w5(t,e){if(t.snap)return rr(t.path,e);for(const n in t.children)if(t.children.hasOwnProperty(n)&&rr($t(t.path,n),e))return!0;return!1}function C5(t){t.visibleWrites=Xb(t.allWrites,k5,gt()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function k5(t){return t.visible}function Xb(t,e,n){let r=xr.empty();for(let s=0;s<t.length;++s){const i=t[s];if(e(i)){const o=i.path;let l;if(i.snap)rr(n,o)?(l=Tn(n,o),r=el(r,l,i.snap)):rr(o,n)&&(l=Tn(o,n),r=el(r,gt(),i.snap.getChild(l)));else if(i.children){if(rr(n,o))l=Tn(n,o),r=Pp(r,l,i.children);else if(rr(o,n))if(l=Tn(o,n),lt(l))r=Pp(r,gt(),i.children);else{const c=Ri(i.children,ot(l));if(c){const d=c.getChild(wt(l));r=el(r,gt(),d)}}}else throw Jo("WriteRecord should have .snap or .children")}}return r}function Qb(t,e,n,r,s){if(!r&&!s){const i=Fi(t.visibleWrites,e);if(i!=null)return i;{const o=Vs(t.visibleWrites,e);if(Lp(o))return n;if(n==null&&!Op(o,gt()))return null;{const l=n||Be.EMPTY_NODE;return Go(o,l)}}}else{const i=Vs(t.visibleWrites,e);if(!s&&Lp(i))return n;if(!s&&n==null&&!Op(i,gt()))return null;{const o=function(d){return(d.visible||s)&&(!r||!~r.indexOf(d.writeId))&&(rr(d.path,e)||rr(e,d.path))},l=Xb(t.allWrites,o,e),c=n||Be.EMPTY_NODE;return Go(l,c)}}}function R5(t,e,n){let r=Be.EMPTY_NODE;const s=Fi(t.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(Mt,(i,o)=>{r=r.updateImmediateChild(i,o)}),r;if(n){const i=Vs(t.visibleWrites,e);return n.forEachChild(Mt,(o,l)=>{const c=Go(Vs(i,new Et(o)),l);r=r.updateImmediateChild(o,c)}),Av(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{const i=Vs(t.visibleWrites,e);return Av(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function A5(t,e,n,r,s){fe(r||s,"Either existingEventSnap or existingServerSnap must exist");const i=$t(e,n);if(Op(t.visibleWrites,i))return null;{const o=Vs(t.visibleWrites,i);return Lp(o)?s.getChild(n):Go(o,s.getChild(n))}}function P5(t,e,n,r){const s=$t(e,n),i=Fi(t.visibleWrites,s);if(i!=null)return i;if(r.isCompleteForChild(n)){const o=Vs(t.visibleWrites,s);return Go(o,r.getNode().getImmediateChild(n))}else return null}function O5(t,e){return Fi(t.visibleWrites,e)}function L5(t,e,n,r,s,i,o){let l;const c=Vs(t.visibleWrites,e),d=Fi(c,gt());if(d!=null)l=d;else if(n!=null)l=Go(c,n);else return[];if(l=l.withIndex(o),!l.isEmpty()&&!l.isLeafNode()){const u=[],h=o.getCompare(),f=i?l.getReverseIteratorFrom(r,o):l.getIteratorFrom(r,o);let E=f.getNext();for(;E&&u.length<s;)h(E,r)!==0&&u.push(E),E=f.getNext();return u}else return[]}function D5(){return{visibleWrites:xr.empty(),allWrites:[],lastWriteId:-1}}function ou(t,e,n,r){return Qb(t.writeTree,t.treePath,e,n,r)}function p0(t,e){return R5(t.writeTree,t.treePath,e)}function Pv(t,e,n,r){return A5(t.writeTree,t.treePath,e,n,r)}function au(t,e){return O5(t.writeTree,$t(t.treePath,e))}function M5(t,e,n,r,s,i){return L5(t.writeTree,t.treePath,e,n,r,s,i)}function g0(t,e,n){return P5(t.writeTree,t.treePath,e,n)}function Jb(t,e){return qb($t(t.treePath,e),t.writeTree)}function qb(t,e){return{treePath:t,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N5{constructor(){this.changeMap=new Map}trackChildChange(e){const n=e.type,r=e.childName;fe(n==="child_added"||n==="child_changed"||n==="child_removed","Only child changes supported for tracking"),fe(r!==".priority","Only non-priority child changes can be tracked.");const s=this.changeMap.get(r);if(s){const i=s.type;if(n==="child_added"&&i==="child_removed")this.changeMap.set(r,Rl(r,e.snapshotNode,s.snapshotNode));else if(n==="child_removed"&&i==="child_added")this.changeMap.delete(r);else if(n==="child_removed"&&i==="child_changed")this.changeMap.set(r,kl(r,s.oldSnap));else if(n==="child_changed"&&i==="child_added")this.changeMap.set(r,Ho(r,e.snapshotNode));else if(n==="child_changed"&&i==="child_changed")this.changeMap.set(r,Rl(r,e.snapshotNode,s.oldSnap));else throw Jo("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j5{getCompleteChild(e){return null}getChildAfterChild(e,n,r){return null}}const Zb=new j5;class m0{constructor(e,n,r=null){this.writes_=e,this.viewCache_=n,this.optCompleteServerCache_=r}getCompleteChild(e){const n=this.viewCache_.eventCache;if(n.isCompleteForChild(e))return n.getNode().getImmediateChild(e);{const r=this.optCompleteServerCache_!=null?new qs(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return g0(this.writes_,e,r)}}getChildAfterChild(e,n,r){const s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Di(this.viewCache_),i=M5(this.writes_,s,n,1,r,e);return i.length===0?null:i[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $5(t){return{filter:t}}function F5(t,e){fe(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),fe(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function U5(t,e,n,r,s){const i=new N5;let o,l;if(n.type===mr.OVERWRITE){const d=n;d.source.fromUser?o=Dp(t,e,d.path,d.snap,r,s,i):(fe(d.source.fromServer,"Unknown source."),l=d.source.tagged||e.serverCache.isFiltered()&&!lt(d.path),o=lu(t,e,d.path,d.snap,r,s,l,i))}else if(n.type===mr.MERGE){const d=n;d.source.fromUser?o=z5(t,e,d.path,d.children,r,s,i):(fe(d.source.fromServer,"Unknown source."),l=d.source.tagged||e.serverCache.isFiltered(),o=Mp(t,e,d.path,d.children,r,s,l,i))}else if(n.type===mr.ACK_USER_WRITE){const d=n;d.revert?o=G5(t,e,d.path,r,s,i):o=H5(t,e,d.path,d.affectedTree,r,s,i)}else if(n.type===mr.LISTEN_COMPLETE)o=W5(t,e,n.path,r,i);else throw Jo("Unknown operation type: "+n.type);const c=i.getChanges();return B5(e,o,c),{viewCache:o,changes:c}}function B5(t,e,n){const r=e.eventCache;if(r.isFullyInitialized()){const s=r.getNode().isLeafNode()||r.getNode().isEmpty(),i=iu(t);(n.length>0||!t.eventCache.isFullyInitialized()||s&&!r.getNode().equals(i)||!r.getNode().getPriority().equals(i.getPriority()))&&n.push(Vb(iu(e)))}}function eE(t,e,n,r,s,i){const o=e.eventCache;if(au(r,n)!=null)return e;{let l,c;if(lt(n))if(fe(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const d=Di(e),u=d instanceof Be?d:Be.EMPTY_NODE,h=p0(r,u);l=t.filter.updateFullNode(e.eventCache.getNode(),h,i)}else{const d=ou(r,Di(e));l=t.filter.updateFullNode(e.eventCache.getNode(),d,i)}else{const d=ot(n);if(d===".priority"){fe(Js(n)===1,"Can't have a priority with additional path components");const u=o.getNode();c=e.serverCache.getNode();const h=Pv(r,n,u,c);h!=null?l=t.filter.updatePriority(u,h):l=o.getNode()}else{const u=wt(n);let h;if(o.isCompleteForChild(d)){c=e.serverCache.getNode();const f=Pv(r,n,o.getNode(),c);f!=null?h=o.getNode().getImmediateChild(d).updateChild(u,f):h=o.getNode().getImmediateChild(d)}else h=g0(r,d,e.serverCache);h!=null?l=t.filter.updateChild(o.getNode(),d,h,u,s,i):l=o.getNode()}}return Za(e,l,o.isFullyInitialized()||lt(n),t.filter.filtersNodes())}}function lu(t,e,n,r,s,i,o,l){const c=e.serverCache;let d;const u=o?t.filter:t.filter.getIndexedFilter();if(lt(n))d=u.updateFullNode(c.getNode(),r,null);else if(u.filtersNodes()&&!c.isFiltered()){const E=c.getNode().updateChild(n,r);d=u.updateFullNode(c.getNode(),E,null)}else{const E=ot(n);if(!c.isCompleteForPath(n)&&Js(n)>1)return e;const k=wt(n),$=c.getNode().getImmediateChild(E).updateChild(k,r);E===".priority"?d=u.updatePriority(c.getNode(),$):d=u.updateChild(c.getNode(),E,$,k,Zb,null)}const h=Yb(e,d,c.isFullyInitialized()||lt(n),u.filtersNodes()),f=new m0(s,h,i);return eE(t,h,n,s,f,l)}function Dp(t,e,n,r,s,i,o){const l=e.eventCache;let c,d;const u=new m0(s,e,i);if(lt(n))d=t.filter.updateFullNode(e.eventCache.getNode(),r,o),c=Za(e,d,!0,t.filter.filtersNodes());else{const h=ot(n);if(h===".priority")d=t.filter.updatePriority(e.eventCache.getNode(),r),c=Za(e,d,l.isFullyInitialized(),l.isFiltered());else{const f=wt(n),E=l.getNode().getImmediateChild(h);let k;if(lt(f))k=r;else{const w=u.getCompleteChild(h);w!=null?i0(f)===".priority"&&w.getChild(Fb(f)).isEmpty()?k=w:k=w.updateChild(f,r):k=Be.EMPTY_NODE}if(E.equals(k))c=e;else{const w=t.filter.updateChild(l.getNode(),h,k,f,u,o);c=Za(e,w,l.isFullyInitialized(),t.filter.filtersNodes())}}}return c}function Ov(t,e){return t.eventCache.isCompleteForChild(e)}function z5(t,e,n,r,s,i,o){let l=e;return r.foreach((c,d)=>{const u=$t(n,c);Ov(e,ot(u))&&(l=Dp(t,l,u,d,s,i,o))}),r.foreach((c,d)=>{const u=$t(n,c);Ov(e,ot(u))||(l=Dp(t,l,u,d,s,i,o))}),l}function Lv(t,e,n){return n.foreach((r,s)=>{e=e.updateChild(r,s)}),e}function Mp(t,e,n,r,s,i,o,l){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,d;lt(n)?d=r:d=new kt(null).setTree(n,r);const u=e.serverCache.getNode();return d.children.inorderTraversal((h,f)=>{if(u.hasChild(h)){const E=e.serverCache.getNode().getImmediateChild(h),k=Lv(t,E,f);c=lu(t,c,new Et(h),k,s,i,o,l)}}),d.children.inorderTraversal((h,f)=>{const E=!e.serverCache.isCompleteForChild(h)&&f.value===null;if(!u.hasChild(h)&&!E){const k=e.serverCache.getNode().getImmediateChild(h),w=Lv(t,k,f);c=lu(t,c,new Et(h),w,s,i,o,l)}}),c}function H5(t,e,n,r,s,i,o){if(au(s,n)!=null)return e;const l=e.serverCache.isFiltered(),c=e.serverCache;if(r.value!=null){if(lt(n)&&c.isFullyInitialized()||c.isCompleteForPath(n))return lu(t,e,n,c.getNode().getChild(n),s,i,l,o);if(lt(n)){let d=new kt(null);return c.getNode().forEachChild(Co,(u,h)=>{d=d.set(new Et(u),h)}),Mp(t,e,n,d,s,i,l,o)}else return e}else{let d=new kt(null);return r.foreach((u,h)=>{const f=$t(n,u);c.isCompleteForPath(f)&&(d=d.set(u,c.getNode().getChild(f)))}),Mp(t,e,n,d,s,i,l,o)}}function W5(t,e,n,r,s){const i=e.serverCache,o=Yb(e,i.getNode(),i.isFullyInitialized()||lt(n),i.isFiltered());return eE(t,o,n,r,Zb,s)}function G5(t,e,n,r,s,i){let o;if(au(r,n)!=null)return e;{const l=new m0(r,e,s),c=e.eventCache.getNode();let d;if(lt(n)||ot(n)===".priority"){let u;if(e.serverCache.isFullyInitialized())u=ou(r,Di(e));else{const h=e.serverCache.getNode();fe(h instanceof Be,"serverChildren would be complete if leaf node"),u=p0(r,h)}u=u,d=t.filter.updateFullNode(c,u,i)}else{const u=ot(n);let h=g0(r,u,e.serverCache);h==null&&e.serverCache.isCompleteForChild(u)&&(h=c.getImmediateChild(u)),h!=null?d=t.filter.updateChild(c,u,h,wt(n),l,i):e.eventCache.getNode().hasChild(u)?d=t.filter.updateChild(c,u,Be.EMPTY_NODE,wt(n),l,i):d=c,d.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=ou(r,Di(e)),o.isLeafNode()&&(d=t.filter.updateFullNode(d,o,i)))}return o=e.serverCache.isFullyInitialized()||au(r,gt())!=null,Za(e,d,o,t.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V5{constructor(e,n){this.query_=e,this.eventRegistrations_=[];const r=this.query_._queryParams,s=new c0(r.getIndex()),i=d5(r);this.processor_=$5(i);const o=n.serverCache,l=n.eventCache,c=s.updateFullNode(Be.EMPTY_NODE,o.getNode(),null),d=i.updateFullNode(Be.EMPTY_NODE,l.getNode(),null),u=new qs(c,o.isFullyInitialized(),s.filtersNodes()),h=new qs(d,l.isFullyInitialized(),i.filtersNodes());this.viewCache_=Fu(h,u),this.eventGenerator_=new y5(this.query_)}get query(){return this.query_}}function Y5(t){return t.viewCache_.serverCache.getNode()}function K5(t){return iu(t.viewCache_)}function X5(t,e){const n=Di(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!lt(e)&&!n.getImmediateChild(ot(e)).isEmpty())?n.getChild(e):null}function Dv(t){return t.eventRegistrations_.length===0}function Q5(t,e){t.eventRegistrations_.push(e)}function Mv(t,e,n){const r=[];if(n){fe(e==null,"A cancel should cancel all event registrations.");const s=t.query._path;t.eventRegistrations_.forEach(i=>{const o=i.createCancelEvent(n,s);o&&r.push(o)})}if(e){let s=[];for(let i=0;i<t.eventRegistrations_.length;++i){const o=t.eventRegistrations_[i];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(t.eventRegistrations_.slice(i+1));break}}t.eventRegistrations_=s}else t.eventRegistrations_=[];return r}function Nv(t,e,n,r){e.type===mr.MERGE&&e.source.queryId!==null&&(fe(Di(t.viewCache_),"We should always have a full cache before handling merges"),fe(iu(t.viewCache_),"Missing event cache, even though we have a server cache"));const s=t.viewCache_,i=U5(t.processor_,s,e,n,r);return F5(t.processor_,i.viewCache),fe(i.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=i.viewCache,tE(t,i.changes,i.viewCache.eventCache.getNode(),null)}function J5(t,e){const n=t.viewCache_.eventCache,r=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(Mt,(i,o)=>{r.push(Ho(i,o))}),n.isFullyInitialized()&&r.push(Vb(n.getNode())),tE(t,r,n.getNode(),e)}function tE(t,e,n,r){const s=r?[r]:t.eventRegistrations_;return v5(t.eventGenerator_,e,n,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let cu;class nE{constructor(){this.views=new Map}}function q5(t){fe(!cu,"__referenceConstructor has already been defined"),cu=t}function Z5(){return fe(cu,"Reference.ts has not been loaded"),cu}function eR(t){return t.views.size===0}function y0(t,e,n,r){const s=e.source.queryId;if(s!==null){const i=t.views.get(s);return fe(i!=null,"SyncTree gave us an op for an invalid query."),Nv(i,e,n,r)}else{let i=[];for(const o of t.views.values())i=i.concat(Nv(o,e,n,r));return i}}function rE(t,e,n,r,s){const i=e._queryIdentifier,o=t.views.get(i);if(!o){let l=ou(n,s?r:null),c=!1;l?c=!0:r instanceof Be?(l=p0(n,r),c=!1):(l=Be.EMPTY_NODE,c=!1);const d=Fu(new qs(l,c,!1),new qs(r,s,!1));return new V5(e,d)}return o}function tR(t,e,n,r,s,i){const o=rE(t,e,r,s,i);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,o),Q5(o,n),J5(o,n)}function nR(t,e,n,r){const s=e._queryIdentifier,i=[];let o=[];const l=Zs(t);if(s==="default")for(const[c,d]of t.views.entries())o=o.concat(Mv(d,n,r)),Dv(d)&&(t.views.delete(c),d.query._queryParams.loadsAllData()||i.push(d.query));else{const c=t.views.get(s);c&&(o=o.concat(Mv(c,n,r)),Dv(c)&&(t.views.delete(s),c.query._queryParams.loadsAllData()||i.push(c.query)))}return l&&!Zs(t)&&i.push(new(Z5())(e._repo,e._path)),{removed:i,events:o}}function sE(t){const e=[];for(const n of t.views.values())n.query._queryParams.loadsAllData()||e.push(n);return e}function Ys(t,e){let n=null;for(const r of t.views.values())n=n||X5(r,e);return n}function iE(t,e){if(e._queryParams.loadsAllData())return Bu(t);{const r=e._queryIdentifier;return t.views.get(r)}}function oE(t,e){return iE(t,e)!=null}function Zs(t){return Bu(t)!=null}function Bu(t){for(const e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let du;function rR(t){fe(!du,"__referenceConstructor has already been defined"),du=t}function sR(){return fe(du,"Reference.ts has not been loaded"),du}let iR=1;class jv{constructor(e){this.listenProvider_=e,this.syncPointTree_=new kt(null),this.pendingWriteTree_=D5(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function v0(t,e,n,r,s){return E5(t.pendingWriteTree_,e,n,r,s),s?ra(t,new Li(u0(),e,n)):[]}function oR(t,e,n,r){S5(t.pendingWriteTree_,e,n,r);const s=kt.fromObject(n);return ra(t,new Wo(u0(),e,s))}function Os(t,e,n=!1){const r=I5(t.pendingWriteTree_,e);if(T5(t.pendingWriteTree_,e)){let i=new kt(null);return r.snap!=null?i=i.set(gt(),!0):sn(r.children,o=>{i=i.set(new Et(o),!0)}),ra(t,new su(r.path,i,n))}else return[]}function Yl(t,e,n){return ra(t,new Li(f0(),e,n))}function aR(t,e,n){const r=kt.fromObject(n);return ra(t,new Wo(f0(),e,r))}function lR(t,e){return ra(t,new Pl(f0(),e))}function cR(t,e,n){const r=_0(t,n);if(r){const s=x0(r),i=s.path,o=s.queryId,l=Tn(i,e),c=new Pl(h0(o),l);return b0(t,i,c)}else return[]}function uu(t,e,n,r,s=!1){const i=e._path,o=t.syncPointTree_.get(i);let l=[];if(o&&(e._queryIdentifier==="default"||oE(o,e))){const c=nR(o,e,n,r);eR(o)&&(t.syncPointTree_=t.syncPointTree_.remove(i));const d=c.removed;if(l=c.events,!s){const u=d.findIndex(f=>f._queryParams.loadsAllData())!==-1,h=t.syncPointTree_.findOnPath(i,(f,E)=>Zs(E));if(u&&!h){const f=t.syncPointTree_.subtree(i);if(!f.isEmpty()){const E=fR(f);for(let k=0;k<E.length;++k){const w=E[k],$=w.query,v=dE(t,w);t.listenProvider_.startListening(tl($),Ol(t,$),v.hashFn,v.onComplete)}}}!h&&d.length>0&&!r&&(u?t.listenProvider_.stopListening(tl(e),null):d.forEach(f=>{const E=t.queryToTagMap.get(Hu(f));t.listenProvider_.stopListening(tl(f),E)}))}hR(t,d)}return l}function aE(t,e,n,r){const s=_0(t,r);if(s!=null){const i=x0(s),o=i.path,l=i.queryId,c=Tn(o,e),d=new Li(h0(l),c,n);return b0(t,o,d)}else return[]}function dR(t,e,n,r){const s=_0(t,r);if(s){const i=x0(s),o=i.path,l=i.queryId,c=Tn(o,e),d=kt.fromObject(n),u=new Wo(h0(l),c,d);return b0(t,o,u)}else return[]}function Np(t,e,n,r=!1){const s=e._path;let i=null,o=!1;t.syncPointTree_.foreachOnPath(s,(f,E)=>{const k=Tn(f,s);i=i||Ys(E,k),o=o||Zs(E)});let l=t.syncPointTree_.get(s);l?(o=o||Zs(l),i=i||Ys(l,gt())):(l=new nE,t.syncPointTree_=t.syncPointTree_.set(s,l));let c;i!=null?c=!0:(c=!1,i=Be.EMPTY_NODE,t.syncPointTree_.subtree(s).foreachChild((E,k)=>{const w=Ys(k,gt());w&&(i=i.updateImmediateChild(E,w))}));const d=oE(l,e);if(!d&&!e._queryParams.loadsAllData()){const f=Hu(e);fe(!t.queryToTagMap.has(f),"View does not exist, but we have a tag");const E=pR();t.queryToTagMap.set(f,E),t.tagToQueryMap.set(E,f)}const u=Uu(t.pendingWriteTree_,s);let h=tR(l,e,n,u,i,c);if(!d&&!o&&!r){const f=iE(l,e);h=h.concat(gR(t,e,f))}return h}function zu(t,e,n){const s=t.pendingWriteTree_,i=t.syncPointTree_.findOnPath(e,(o,l)=>{const c=Tn(o,e),d=Ys(l,c);if(d)return d});return Qb(s,e,i,n,!0)}function uR(t,e){const n=e._path;let r=null;t.syncPointTree_.foreachOnPath(n,(d,u)=>{const h=Tn(d,n);r=r||Ys(u,h)});let s=t.syncPointTree_.get(n);s?r=r||Ys(s,gt()):(s=new nE,t.syncPointTree_=t.syncPointTree_.set(n,s));const i=r!=null,o=i?new qs(r,!0,!1):null,l=Uu(t.pendingWriteTree_,e._path),c=rE(s,e,l,i?o.getNode():Be.EMPTY_NODE,i);return K5(c)}function ra(t,e){return lE(e,t.syncPointTree_,null,Uu(t.pendingWriteTree_,gt()))}function lE(t,e,n,r){if(lt(t.path))return cE(t,e,n,r);{const s=e.get(gt());n==null&&s!=null&&(n=Ys(s,gt()));let i=[];const o=ot(t.path),l=t.operationForChild(o),c=e.children.get(o);if(c&&l){const d=n?n.getImmediateChild(o):null,u=Jb(r,o);i=i.concat(lE(l,c,d,u))}return s&&(i=i.concat(y0(s,t,r,n))),i}}function cE(t,e,n,r){const s=e.get(gt());n==null&&s!=null&&(n=Ys(s,gt()));let i=[];return e.children.inorderTraversal((o,l)=>{const c=n?n.getImmediateChild(o):null,d=Jb(r,o),u=t.operationForChild(o);u&&(i=i.concat(cE(u,l,c,d)))}),s&&(i=i.concat(y0(s,t,r,n))),i}function dE(t,e){const n=e.query,r=Ol(t,n);return{hashFn:()=>(Y5(e)||Be.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return r?cR(t,n._path,r):lR(t,n._path);{const i=lk(s,n);return uu(t,n,null,i)}}}}function Ol(t,e){const n=Hu(e);return t.queryToTagMap.get(n)}function Hu(t){return t._path.toString()+"$"+t._queryIdentifier}function _0(t,e){return t.tagToQueryMap.get(e)}function x0(t){const e=t.indexOf("$");return fe(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new Et(t.substr(0,e))}}function b0(t,e,n){const r=t.syncPointTree_.get(e);fe(r,"Missing sync point for query tag that we're tracking");const s=Uu(t.pendingWriteTree_,e);return y0(r,n,s,null)}function fR(t){return t.fold((e,n,r)=>{if(n&&Zs(n))return[Bu(n)];{let s=[];return n&&(s=sE(n)),sn(r,(i,o)=>{s=s.concat(o)}),s}})}function tl(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(sR())(t._repo,t._path):t}function hR(t,e){for(let n=0;n<e.length;++n){const r=e[n];if(!r._queryParams.loadsAllData()){const s=Hu(r),i=t.queryToTagMap.get(s);t.queryToTagMap.delete(s),t.tagToQueryMap.delete(i)}}}function pR(){return iR++}function gR(t,e,n){const r=e._path,s=Ol(t,e),i=dE(t,n),o=t.listenProvider_.startListening(tl(e),s,i.hashFn,i.onComplete),l=t.syncPointTree_.subtree(r);if(s)fe(!Zs(l.value),"If we're adding a query, it shouldn't be shadowed");else{const c=l.fold((d,u,h)=>{if(!lt(d)&&u&&Zs(u))return[Bu(u).query];{let f=[];return u&&(f=f.concat(sE(u).map(E=>E.query))),sn(h,(E,k)=>{f=f.concat(k)}),f}});for(let d=0;d<c.length;++d){const u=c[d];t.listenProvider_.stopListening(tl(u),Ol(t,u))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E0{constructor(e){this.node_=e}getImmediateChild(e){const n=this.node_.getImmediateChild(e);return new E0(n)}node(){return this.node_}}class S0{constructor(e,n){this.syncTree_=e,this.path_=n}getImmediateChild(e){const n=$t(this.path_,e);return new S0(this.syncTree_,n)}node(){return zu(this.syncTree_,this.path_)}}const mR=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},$v=function(t,e,n){if(!t||typeof t!="object")return t;if(fe(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return yR(t[".sv"],e,n);if(typeof t[".sv"]=="object")return vR(t[".sv"],e);fe(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},yR=function(t,e,n){switch(t){case"timestamp":return n.timestamp;default:fe(!1,"Unexpected server value: "+t)}},vR=function(t,e,n){t.hasOwnProperty("increment")||fe(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const r=t.increment;typeof r!="number"&&fe(!1,"Unexpected increment value: "+r);const s=e.node();if(fe(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return r;const o=s.getValue();return typeof o!="number"?r:o+r},uE=function(t,e,n,r){return T0(e,new S0(n,t),r)},I0=function(t,e,n){return T0(t,new E0(e),n)};function T0(t,e,n){const r=t.getPriority().val(),s=$v(r,e.getImmediateChild(".priority"),n);let i;if(t.isLeafNode()){const o=t,l=$v(o.getValue(),e,n);return l!==o.getValue()||s!==o.getPriority().val()?new Zt(l,jt(s)):t}else{const o=t;return i=o,s!==o.getPriority().val()&&(i=i.updatePriority(new Zt(s))),o.forEachChild(Mt,(l,c)=>{const d=T0(c,e.getImmediateChild(l),n);d!==c&&(i=i.updateImmediateChild(l,d))}),i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w0{constructor(e="",n=null,r={children:{},childCount:0}){this.name=e,this.parent=n,this.node=r}}function Wu(t,e){let n=e instanceof Et?e:new Et(e),r=t,s=ot(n);for(;s!==null;){const i=Ri(r.node.children,s)||{children:{},childCount:0};r=new w0(s,r,i),n=wt(n),s=ot(n)}return r}function Ui(t){return t.node.value}function C0(t,e){t.node.value=e,jp(t)}function fE(t){return t.node.childCount>0}function _R(t){return Ui(t)===void 0&&!fE(t)}function Gu(t,e){sn(t.node.children,(n,r)=>{e(new w0(n,t,r))})}function hE(t,e,n,r){n&&e(t),Gu(t,s=>{hE(s,e,!0)})}function xR(t,e,n){let r=t.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function Kl(t){return new Et(t.parent===null?t.name:Kl(t.parent)+"/"+t.name)}function jp(t){t.parent!==null&&bR(t.parent,t.name,t)}function bR(t,e,n){const r=_R(n),s=Sr(t.node.children,e);r&&s?(delete t.node.children[e],t.node.childCount--,jp(t)):!r&&!s&&(t.node.children[e]=n.node,t.node.childCount++,jp(t))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ER=/[\[\].#$\/\u0000-\u001F\u007F]/,SR=/[\[\].#$\u0000-\u001F\u007F]/,bh=10*1024*1024,k0=function(t){return typeof t=="string"&&t.length!==0&&!ER.test(t)},pE=function(t){return typeof t=="string"&&t.length!==0&&!SR.test(t)},IR=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),pE(t)},R0=function(t){return t===null||typeof t=="string"||typeof t=="number"&&!ju(t)||t&&typeof t=="object"&&Sr(t,".sv")},fu=function(t,e,n,r){r&&e===void 0||Xl(Uo(t,"value"),e,n)},Xl=function(t,e,n){const r=n instanceof Et?new zk(n,t):n;if(e===void 0)throw new Error(t+"contains undefined "+mi(r));if(typeof e=="function")throw new Error(t+"contains a function "+mi(r)+" with contents = "+e.toString());if(ju(e))throw new Error(t+"contains "+e.toString()+" "+mi(r));if(typeof e=="string"&&e.length>bh/3&&Nu(e)>bh)throw new Error(t+"contains a string greater than "+bh+" utf8 bytes "+mi(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,i=!1;if(sn(e,(o,l)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(i=!0,!k0(o)))throw new Error(t+" contains an invalid key ("+o+") "+mi(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);Hk(r,o),Xl(t,l,r),Wk(r)}),s&&i)throw new Error(t+' contains ".value" child '+mi(r)+" in addition to actual children.")}},TR=function(t,e){let n,r;for(n=0;n<e.length;n++){r=e[n];const i=Cl(r);for(let o=0;o<i.length;o++)if(!(i[o]===".priority"&&o===i.length-1)){if(!k0(i[o]))throw new Error(t+"contains an invalid key ("+i[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(Bk);let s=null;for(n=0;n<e.length;n++){if(r=e[n],s!==null&&rr(s,r))throw new Error(t+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}},gE=function(t,e,n,r){const s=Uo(t,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");const i=[];sn(e,(o,l)=>{const c=new Et(o);if(Xl(s,l,$t(n,c)),i0(c)===".priority"&&!R0(l))throw new Error(s+"contains an invalid value for '"+c.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");i.push(c)}),TR(s,i)},wR=function(t,e,n){if(ju(e))throw new Error(Uo(t,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!R0(e))throw new Error(Uo(t,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")},mE=function(t,e,n,r){if(!pE(n))throw new Error(Uo(t,e)+'was an invalid path = "'+n+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},CR=function(t,e,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),mE(t,e,n)},Ls=function(t,e){if(ot(e)===".info")throw new Error(t+" failed = Can't modify data under /.info/")},kR=function(t,e){const n=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!k0(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||n.length!==0&&!IR(n))throw new Error(Uo(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RR{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Vu(t,e){let n=null;for(let r=0;r<e.length;r++){const s=e[r],i=s.getPath();n!==null&&!o0(i,n.path)&&(t.eventLists_.push(n),n=null),n===null&&(n={events:[],path:i}),n.events.push(s)}n&&t.eventLists_.push(n)}function yE(t,e,n){Vu(t,n),vE(t,r=>o0(r,e))}function Yn(t,e,n){Vu(t,n),vE(t,r=>rr(r,e)||rr(e,r))}function vE(t,e){t.recursionDepth_++;let n=!0;for(let r=0;r<t.eventLists_.length;r++){const s=t.eventLists_[r];if(s){const i=s.path;e(i)?(AR(t.eventLists_[r]),t.eventLists_[r]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function AR(t){for(let e=0;e<t.events.length;e++){const n=t.events[e];if(n!==null){t.events[e]=null;const r=n.getEventRunner();Ja&&nn("event: "+n.toString()),ta(r)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PR="repo_interrupt",OR=25;class LR{constructor(e,n,r,s){this.repoInfo_=e,this.forceRestClient_=n,this.authTokenProvider_=r,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new RR,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=ru(),this.transactionQueueTree_=new w0,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function DR(t,e,n){if(t.stats_=r0(t.repoInfo_),t.forceRestClient_||fk())t.server_=new nu(t.repoInfo_,(r,s,i,o)=>{Fv(t,r,s,i,o)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>Uv(t,!0),0);else{if(typeof n<"u"&&n!==null){if(typeof n!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Xt(n)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}t.persistentConnection_=new ts(t.repoInfo_,e,(r,s,i,o)=>{Fv(t,r,s,i,o)},r=>{Uv(t,r)},r=>{MR(t,r)},t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(r=>{t.server_.refreshAuthToken(r)}),t.appCheckProvider_.addTokenChangeListener(r=>{t.server_.refreshAppCheckToken(r.token)}),t.statsReporter_=yk(t.repoInfo_,()=>new m5(t.stats_,t.server_)),t.infoData_=new u5,t.infoSyncTree_=new jv({startListening:(r,s,i,o)=>{let l=[];const c=t.infoData_.getNode(r._path);return c.isEmpty()||(l=Yl(t.infoSyncTree_,r._path,c),setTimeout(()=>{o("ok")},0)),l},stopListening:()=>{}}),A0(t,"connected",!1),t.serverSyncTree_=new jv({startListening:(r,s,i,o)=>(t.server_.listen(r,i,s,(l,c)=>{const d=o(l,c);Yn(t.eventQueue_,r._path,d)}),[]),stopListening:(r,s)=>{t.server_.unlisten(r,s)}})}function _E(t){const n=t.infoData_.getNode(new Et(".info/serverTimeOffset")).val()||0;return new Date().getTime()+n}function Ql(t){return mR({timestamp:_E(t)})}function Fv(t,e,n,r,s){t.dataUpdateCount++;const i=new Et(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let o=[];if(s)if(r){const c=Jd(n,d=>jt(d));o=dR(t.serverSyncTree_,i,c,s)}else{const c=jt(n);o=aE(t.serverSyncTree_,i,c,s)}else if(r){const c=Jd(n,d=>jt(d));o=aR(t.serverSyncTree_,i,c)}else{const c=jt(n);o=Yl(t.serverSyncTree_,i,c)}let l=i;o.length>0&&(l=Vo(t,i)),Yn(t.eventQueue_,l,o)}function Uv(t,e){A0(t,"connected",e),e===!1&&FR(t)}function MR(t,e){sn(e,(n,r)=>{A0(t,n,r)})}function A0(t,e,n){const r=new Et("/.info/"+e),s=jt(n);t.infoData_.updateSnapshot(r,s);const i=Yl(t.infoSyncTree_,r,s);Yn(t.eventQueue_,r,i)}function Yu(t){return t.nextWriteId_++}function NR(t,e,n){const r=uR(t.serverSyncTree_,e);return r!=null?Promise.resolve(r):t.server_.get(e).then(s=>{const i=jt(s).withIndex(e._queryParams.getIndex());Np(t.serverSyncTree_,e,n,!0);let o;if(e._queryParams.loadsAllData())o=Yl(t.serverSyncTree_,e._path,i);else{const l=Ol(t.serverSyncTree_,e);o=aE(t.serverSyncTree_,e._path,i,l)}return Yn(t.eventQueue_,e._path,o),uu(t.serverSyncTree_,e,n,null,!0),i},s=>(sa(t,"get for query "+Xt(e)+" failed: "+s),Promise.reject(new Error(s))))}function jR(t,e,n,r,s){sa(t,"set",{path:e.toString(),value:n,priority:r});const i=Ql(t),o=jt(n,r),l=zu(t.serverSyncTree_,e),c=I0(o,l,i),d=Yu(t),u=v0(t.serverSyncTree_,e,c,d,!0);Vu(t.eventQueue_,u),t.server_.put(e.toString(),o.val(!0),(f,E)=>{const k=f==="ok";k||Cn("set at "+e+" failed: "+f);const w=Os(t.serverSyncTree_,d,!k);Yn(t.eventQueue_,e,w),ei(t,s,f,E)});const h=O0(t,e);Vo(t,h),Yn(t.eventQueue_,h,[])}function $R(t,e,n,r){sa(t,"update",{path:e.toString(),value:n});let s=!0;const i=Ql(t),o={};if(sn(n,(l,c)=>{s=!1,o[l]=uE($t(e,l),jt(c),t.serverSyncTree_,i)}),s)nn("update() called with empty data.  Don't do anything."),ei(t,r,"ok",void 0);else{const l=Yu(t),c=oR(t.serverSyncTree_,e,o,l);Vu(t.eventQueue_,c),t.server_.merge(e.toString(),n,(d,u)=>{const h=d==="ok";h||Cn("update at "+e+" failed: "+d);const f=Os(t.serverSyncTree_,l,!h),E=f.length>0?Vo(t,e):e;Yn(t.eventQueue_,E,f),ei(t,r,d,u)}),sn(n,d=>{const u=O0(t,$t(e,d));Vo(t,u)}),Yn(t.eventQueue_,e,[])}}function FR(t){sa(t,"onDisconnectEvents");const e=Ql(t),n=ru();Ap(t.onDisconnect_,gt(),(s,i)=>{const o=uE(s,i,t.serverSyncTree_,e);na(n,s,o)});let r=[];Ap(n,gt(),(s,i)=>{r=r.concat(Yl(t.serverSyncTree_,s,i));const o=O0(t,s);Vo(t,o)}),t.onDisconnect_=ru(),Yn(t.eventQueue_,gt(),r)}function UR(t,e,n){t.server_.onDisconnectCancel(e.toString(),(r,s)=>{r==="ok"&&Rp(t.onDisconnect_,e),ei(t,n,r,s)})}function Bv(t,e,n,r){const s=jt(n);t.server_.onDisconnectPut(e.toString(),s.val(!0),(i,o)=>{i==="ok"&&na(t.onDisconnect_,e,s),ei(t,r,i,o)})}function BR(t,e,n,r,s){const i=jt(n,r);t.server_.onDisconnectPut(e.toString(),i.val(!0),(o,l)=>{o==="ok"&&na(t.onDisconnect_,e,i),ei(t,s,o,l)})}function zR(t,e,n,r){if(Qd(n)){nn("onDisconnect().update() called with empty data.  Don't do anything."),ei(t,r,"ok",void 0);return}t.server_.onDisconnectMerge(e.toString(),n,(s,i)=>{s==="ok"&&sn(n,(o,l)=>{const c=jt(l);na(t.onDisconnect_,$t(e,o),c)}),ei(t,r,s,i)})}function HR(t,e,n){let r;ot(e._path)===".info"?r=Np(t.infoSyncTree_,e,n):r=Np(t.serverSyncTree_,e,n),yE(t.eventQueue_,e._path,r)}function WR(t,e,n){let r;ot(e._path)===".info"?r=uu(t.infoSyncTree_,e,n):r=uu(t.serverSyncTree_,e,n),yE(t.eventQueue_,e._path,r)}function GR(t){t.persistentConnection_&&t.persistentConnection_.interrupt(PR)}function sa(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),nn(n,...e)}function ei(t,e,n,r){e&&ta(()=>{if(n==="ok")e(null);else{const s=(n||"error").toUpperCase();let i=s;r&&(i+=": "+r);const o=new Error(i);o.code=s,e(o)}})}function VR(t,e,n,r,s,i){sa(t,"transaction on "+e);const o={path:e,update:n,onComplete:r,status:null,order:yb(),applyLocally:i,retryCount:0,unwatcher:s,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},l=P0(t,e,void 0);o.currentInputSnapshot=l;const c=o.update(l.val());if(c===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{Xl("transaction failed: Data returned ",c,o.path),o.status=0;const d=Wu(t.transactionQueueTree_,e),u=Ui(d)||[];u.push(o),C0(d,u);let h;typeof c=="object"&&c!==null&&Sr(c,".priority")?(h=Ri(c,".priority"),fe(R0(h),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):h=(zu(t.serverSyncTree_,e)||Be.EMPTY_NODE).getPriority().val();const f=Ql(t),E=jt(c,h),k=I0(E,l,f);o.currentOutputSnapshotRaw=E,o.currentOutputSnapshotResolved=k,o.currentWriteId=Yu(t);const w=v0(t.serverSyncTree_,e,k,o.currentWriteId,o.applyLocally);Yn(t.eventQueue_,e,w),Ku(t,t.transactionQueueTree_)}}function P0(t,e,n){return zu(t.serverSyncTree_,e,n)||Be.EMPTY_NODE}function Ku(t,e=t.transactionQueueTree_){if(e||Xu(t,e),Ui(e)){const n=bE(t,e);fe(n.length>0,"Sending zero length transaction queue"),n.every(s=>s.status===0)&&YR(t,Kl(e),n)}else fE(e)&&Gu(e,n=>{Ku(t,n)})}function YR(t,e,n){const r=n.map(d=>d.currentWriteId),s=P0(t,e,r);let i=s;const o=s.hash();for(let d=0;d<n.length;d++){const u=n[d];fe(u.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;const h=Tn(e,u.path);i=i.updateChild(h,u.currentOutputSnapshotRaw)}const l=i.val(!0),c=e;t.server_.put(c.toString(),l,d=>{sa(t,"transaction put response",{path:c.toString(),status:d});let u=[];if(d==="ok"){const h=[];for(let f=0;f<n.length;f++)n[f].status=2,u=u.concat(Os(t.serverSyncTree_,n[f].currentWriteId)),n[f].onComplete&&h.push(()=>n[f].onComplete(null,!0,n[f].currentOutputSnapshotResolved)),n[f].unwatcher();Xu(t,Wu(t.transactionQueueTree_,e)),Ku(t,t.transactionQueueTree_),Yn(t.eventQueue_,e,u);for(let f=0;f<h.length;f++)ta(h[f])}else{if(d==="datastale")for(let h=0;h<n.length;h++)n[h].status===3?n[h].status=4:n[h].status=0;else{Cn("transaction at "+c.toString()+" failed: "+d);for(let h=0;h<n.length;h++)n[h].status=4,n[h].abortReason=d}Vo(t,e)}},o)}function Vo(t,e){const n=xE(t,e),r=Kl(n),s=bE(t,n);return KR(t,s,r),r}function KR(t,e,n){if(e.length===0)return;const r=[];let s=[];const o=e.filter(l=>l.status===0).map(l=>l.currentWriteId);for(let l=0;l<e.length;l++){const c=e[l],d=Tn(n,c.path);let u=!1,h;if(fe(d!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)u=!0,h=c.abortReason,s=s.concat(Os(t.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=OR)u=!0,h="maxretry",s=s.concat(Os(t.serverSyncTree_,c.currentWriteId,!0));else{const f=P0(t,c.path,o);c.currentInputSnapshot=f;const E=e[l].update(f.val());if(E!==void 0){Xl("transaction failed: Data returned ",E,c.path);let k=jt(E);typeof E=="object"&&E!=null&&Sr(E,".priority")||(k=k.updatePriority(f.getPriority()));const $=c.currentWriteId,v=Ql(t),_=I0(k,f,v);c.currentOutputSnapshotRaw=k,c.currentOutputSnapshotResolved=_,c.currentWriteId=Yu(t),o.splice(o.indexOf($),1),s=s.concat(v0(t.serverSyncTree_,c.path,_,c.currentWriteId,c.applyLocally)),s=s.concat(Os(t.serverSyncTree_,$,!0))}else u=!0,h="nodata",s=s.concat(Os(t.serverSyncTree_,c.currentWriteId,!0))}Yn(t.eventQueue_,n,s),s=[],u&&(e[l].status=2,function(f){setTimeout(f,Math.floor(0))}(e[l].unwatcher),e[l].onComplete&&(h==="nodata"?r.push(()=>e[l].onComplete(null,!1,e[l].currentInputSnapshot)):r.push(()=>e[l].onComplete(new Error(h),!1,null))))}Xu(t,t.transactionQueueTree_);for(let l=0;l<r.length;l++)ta(r[l]);Ku(t,t.transactionQueueTree_)}function xE(t,e){let n,r=t.transactionQueueTree_;for(n=ot(e);n!==null&&Ui(r)===void 0;)r=Wu(r,n),e=wt(e),n=ot(e);return r}function bE(t,e){const n=[];return EE(t,e,n),n.sort((r,s)=>r.order-s.order),n}function EE(t,e,n){const r=Ui(e);if(r)for(let s=0;s<r.length;s++)n.push(r[s]);Gu(e,s=>{EE(t,s,n)})}function Xu(t,e){const n=Ui(e);if(n){let r=0;for(let s=0;s<n.length;s++)n[s].status!==2&&(n[r]=n[s],r++);n.length=r,C0(e,n.length>0?n:void 0)}Gu(e,r=>{Xu(t,r)})}function O0(t,e){const n=Kl(xE(t,e)),r=Wu(t.transactionQueueTree_,e);return xR(r,s=>{Eh(t,s)}),Eh(t,r),hE(r,s=>{Eh(t,s)}),n}function Eh(t,e){const n=Ui(e);if(n){const r=[];let s=[],i=-1;for(let o=0;o<n.length;o++)n[o].status===3||(n[o].status===1?(fe(i===o-1,"All SENT items should be at beginning of queue."),i=o,n[o].status=3,n[o].abortReason="set"):(fe(n[o].status===0,"Unexpected transaction status in abort"),n[o].unwatcher(),s=s.concat(Os(t.serverSyncTree_,n[o].currentWriteId,!0)),n[o].onComplete&&r.push(n[o].onComplete.bind(null,new Error("set"),!1,null))));i===-1?C0(e,void 0):n.length=i+1,Yn(t.eventQueue_,Kl(e),s);for(let o=0;o<r.length;o++)ta(r[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XR(t){let e="";const n=t.split("/");for(let r=0;r<n.length;r++)if(n[r].length>0){let s=n[r];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function QR(t){const e={};t.charAt(0)==="?"&&(t=t.substring(1));for(const n of t.split("&")){if(n.length===0)continue;const r=n.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):Cn(`Invalid query segment '${n}' in query '${t}'`)}return e}const zv=function(t,e){const n=JR(t),r=n.namespace;n.domain==="firebase.com"&&ls(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&n.domain!=="localhost"&&ls("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||rk();const s=n.scheme==="ws"||n.scheme==="wss";return{repoInfo:new Ab(n.host,n.secure,r,s,e,"",r!==n.subdomain),path:new Et(n.pathString)}},JR=function(t){let e="",n="",r="",s="",i="",o=!0,l="https",c=443;if(typeof t=="string"){let d=t.indexOf("//");d>=0&&(l=t.substring(0,d-1),t=t.substring(d+2));let u=t.indexOf("/");u===-1&&(u=t.length);let h=t.indexOf("?");h===-1&&(h=t.length),e=t.substring(0,Math.min(u,h)),u<h&&(s=XR(t.substring(u,h)));const f=QR(t.substring(Math.min(t.length,h)));d=e.indexOf(":"),d>=0?(o=l==="https"||l==="wss",c=parseInt(e.substring(d+1),10)):d=e.length;const E=e.slice(0,d);if(E.toLowerCase()==="localhost")n="localhost";else if(E.split(".").length<=2)n=E;else{const k=e.indexOf(".");r=e.substring(0,k).toLowerCase(),n=e.substring(k+1),i=r}"ns"in f&&(i=f.ns)}return{host:e,port:c,domain:n,subdomain:r,secure:o,scheme:l,pathString:s,namespace:i}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hv="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",qR=function(){let t=0;const e=[];return function(n){const r=n===t;t=n;let s;const i=new Array(8);for(s=7;s>=0;s--)i[s]=Hv.charAt(n%64),n=Math.floor(n/64);fe(n===0,"Cannot push at time == 0");let o=i.join("");if(r){for(s=11;s>=0&&e[s]===63;s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)o+=Hv.charAt(e[s]);return fe(o.length===20,"nextPushId: Length should be 20."),o}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZR{constructor(e,n,r,s){this.eventType=e,this.eventRegistration=n,this.snapshot=r,this.prevName=s}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Xt(this.snapshot.exportVal())}}class eA{constructor(e,n,r){this.eventRegistration=e,this.error=n,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SE{constructor(e,n){this.snapshotCallback=e,this.cancelCallback=n}onValue(e,n){this.snapshotCallback.call(null,e,n)}onCancel(e){return fe(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tA{constructor(e,n){this._repo=e,this._path=n}cancel(){const e=new pr;return UR(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Ls("OnDisconnect.remove",this._path);const e=new pr;return Bv(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Ls("OnDisconnect.set",this._path),fu("OnDisconnect.set",e,this._path,!1);const n=new pr;return Bv(this._repo,this._path,e,n.wrapCallback(()=>{})),n.promise}setWithPriority(e,n){Ls("OnDisconnect.setWithPriority",this._path),fu("OnDisconnect.setWithPriority",e,this._path,!1),wR("OnDisconnect.setWithPriority",n);const r=new pr;return BR(this._repo,this._path,e,n,r.wrapCallback(()=>{})),r.promise}update(e){Ls("OnDisconnect.update",this._path),gE("OnDisconnect.update",e,this._path);const n=new pr;return zR(this._repo,this._path,e,n.wrapCallback(()=>{})),n.promise}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L0{constructor(e,n,r,s){this._repo=e,this._path=n,this._queryParams=r,this._orderByCalled=s}get key(){return lt(this._path)?null:i0(this._path)}get ref(){return new Ur(this._repo,this._path)}get _queryIdentifier(){const e=Cv(this._queryParams),n=t0(e);return n==="{}"?"default":n}get _queryObject(){return Cv(this._queryParams)}isEqual(e){if(e=Jt(e),!(e instanceof L0))return!1;const n=this._repo===e._repo,r=o0(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return n&&r&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+Uk(this._path)}}class Ur extends L0{constructor(e,n){super(e,n,new d0,!1)}get parent(){const e=Fb(this._path);return e===null?null:new Ur(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class Yo{constructor(e,n,r){this._node=e,this.ref=n,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const n=new Et(e),r=Ll(this.ref,e);return new Yo(this._node.getChild(n),r,Mt)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,s)=>e(new Yo(s,Ll(this.ref,r),Mt)))}hasChild(e){const n=new Et(e);return!this._node.getChild(n).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Lr(t,e){return t=Jt(t),t._checkNotDeleted("ref"),e!==void 0?Ll(t._root,e):t._root}function Ll(t,e){return t=Jt(t),ot(t._path)===null?CR("child","path",e):mE("child","path",e),new Ur(t._repo,$t(t._path,e))}function nA(t){return t=Jt(t),new tA(t._repo,t._path)}function rA(t,e){t=Jt(t),Ls("push",t._path),fu("push",e,t._path,!0);const n=_E(t._repo),r=qR(n),s=Ll(t,r),i=Ll(t,r);let o;return o=Promise.resolve(i),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function Vc(t){return Ls("remove",t._path),Qu(t,null)}function Qu(t,e){t=Jt(t),Ls("set",t._path),fu("set",e,t._path,!1);const n=new pr;return jR(t._repo,t._path,e,null,n.wrapCallback(()=>{})),n.promise}function D0(t,e){gE("update",e,t._path);const n=new pr;return $R(t._repo,t._path,e,n.wrapCallback(()=>{})),n.promise}function Ju(t){t=Jt(t);const e=new SE(()=>{}),n=new qu(e);return NR(t._repo,t,n).then(r=>new Yo(r,new Ur(t._repo,t._path),t._queryParams.getIndex()))}class qu{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,n){const r=n._queryParams.getIndex();return new ZR("value",this,new Yo(e.snapshotNode,new Ur(n._repo,n._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new eA(this,e,n):null}matches(e){return e instanceof qu?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function sA(t,e,n,r,s){const i=new SE(n,void 0),o=new qu(i);return HR(t._repo,t,o),()=>WR(t._repo,t,o)}function IE(t,e,n,r){return sA(t,"value",e)}q5(Ur);rR(Ur);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iA="FIREBASE_DATABASE_EMULATOR_HOST",$p={};let oA=!1;function aA(t,e,n,r){const s=e.lastIndexOf(":"),i=e.substring(0,s),o=qo(i);t.repoInfo_=new Ab(e,o,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0,n),r&&(t.authTokenProvider_=r)}function lA(t,e,n,r,s){let i=r||t.options.databaseURL;i===void 0&&(t.options.projectId||ls("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),nn("Using default host for project ",t.options.projectId),i=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o=zv(i,s),l=o.repoInfo,c;typeof process<"u"&&cv&&(c=cv[iA]),c?(i=`http://${c}?ns=${l.namespace}`,o=zv(i,s),l=o.repoInfo):o.repoInfo.secure;const d=new pk(t.name,t.options,e);kR("Invalid Firebase Database URL",o),lt(o.path)||ls("Database URL must point to the root of a Firebase Database (not including a child path).");const u=dA(l,t,d,new hk(t,n));return new uA(u,t)}function cA(t,e){const n=$p[e];(!n||n[t.key]!==t)&&ls(`Database ${e}(${t.repoInfo_}) has already been deleted.`),GR(t),delete n[t.key]}function dA(t,e,n,r){let s=$p[e.name];s||(s={},$p[e.name]=s);let i=s[t.toURLString()];return i&&ls("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new LR(t,oA,n,r),s[t.toURLString()]=i,i}class uA{constructor(e,n){this._repoInternal=e,this.app=n,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(DR(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Ur(this._repo,gt())),this._rootInternal}_delete(){return this._rootInternal!==null&&(cA(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&ls("Cannot call "+e+" on a deleted database.")}}function fA(t=fb(),e){const n=e0(t,"database").getImmediate({identifier:e});if(!n._instanceStarted){const r=E2("database");r&&hA(n,...r)}return n}function hA(t,e,n,r={}){t=Jt(t),t._checkNotDeleted("useEmulator");const s=`${e}:${n}`,i=t._repoInternal;if(t._instanceStarted){if(s===t._repoInternal.repoInfo_.host&&Ai(r,i.repoInfo_.emulatorOptions))return;ls("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&ls('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new ud(ud.OWNER);else if(r.mockUserToken){const l=typeof r.mockUserToken=="string"?r.mockUserToken:S2(r.mockUserToken,t.app.options.projectId);o=new ud(l)}qo(e)&&(ib(e),ob("Database",!0)),aA(i,s,r,o)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pA(t){qC(ea),Bo(new Pi("database",(e,{instanceIdentifier:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return lA(r,s,i,n)},"PUBLIC").setMultipleInstances(!0)),Gs(dv,uv,t),Gs(dv,uv,"esm2020")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gA{constructor(e,n){this.committed=e,this.snapshot=n}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function mA(t,e,n){if(t=Jt(t),Ls("Reference.transaction",t._path),t.key===".length"||t.key===".keys")throw"Reference.transaction failed: "+t.key+" is a read-only object.";const r=!0,s=new pr,i=(l,c,d)=>{let u=null;l?s.reject(l):(u=new Yo(d,new Ur(t._repo,t._path),Mt),s.resolve(new gA(c,u)))},o=IE(t,()=>{});return VR(t._repo,t._path,e,i,o,r),s.promise}ts.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};ts.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};pA();function TE(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const yA=TE,wE=new Hl("auth","Firebase",TE());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hu=new qg("@firebase/auth");function vA(t,...e){hu.logLevel<=It.WARN&&hu.warn(`Auth (${ea}): ${t}`,...e)}function fd(t,...e){hu.logLevel<=It.ERROR&&hu.error(`Auth (${ea}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Er(t,...e){throw M0(t,...e)}function $r(t,...e){return M0(t,...e)}function CE(t,e,n){const r={...yA(),[e]:n};return new Hl("auth","Firebase",r).create(e,{appName:t.name})}function ns(t){return CE(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function M0(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return wE.create(t,...e)}function Ue(t,e,...n){if(!t)throw M0(e,...n)}function qr(t){const e="INTERNAL ASSERTION FAILED: "+t;throw fd(e),new Error(e)}function cs(t,e){t||qr(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fp(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.href)||""}function _A(){return Wv()==="http:"||Wv()==="https:"}function Wv(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xA(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(_A()||C2()||"connection"in navigator)?navigator.onLine:!0}function bA(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jl{constructor(e,n){this.shortDelay=e,this.longDelay=n,cs(n>e,"Short delay should be less than long delay!"),this.isMobile=Jg()||ab()}get(){return xA()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function N0(t,e){cs(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kE{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;qr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;qr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;qr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EA={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SA=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],IA=new Jl(3e4,6e4);function oi(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function ai(t,e,n,r,s={}){return RE(t,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const l=Zo({key:t.config.apiKey,...o}).slice(1),c=await t._getAdditionalHeaders();c["Content-Type"]="application/json",t.languageCode&&(c["X-Firebase-Locale"]=t.languageCode);const d={method:e,headers:c,...i};return w2()||(d.referrerPolicy="no-referrer"),t.emulatorConfig&&qo(t.emulatorConfig.host)&&(d.credentials="include"),kE.fetch()(await AE(t,t.config.apiHost,n,l),d)})}async function RE(t,e,n){t._canInitEmulator=!1;const r={...EA,...e};try{const s=new wA(t),i=await Promise.race([n(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Yc(t,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const l=i.ok?o.errorMessage:o.error.message,[c,d]=l.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw Yc(t,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw Yc(t,"email-already-in-use",o);if(c==="USER_DISABLED")throw Yc(t,"user-disabled",o);const u=r[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw CE(t,u,d);Er(t,u)}}catch(s){if(s instanceof ii)throw s;Er(t,"network-request-failed",{message:String(s)})}}async function ql(t,e,n,r,s={}){const i=await ai(t,e,n,r,s);return"mfaPendingCredential"in i&&Er(t,"multi-factor-auth-required",{_serverResponse:i}),i}async function AE(t,e,n,r){const s=`${e}${n}?${r}`,i=t,o=i.config.emulator?N0(t.config,s):`${t.config.apiScheme}://${s}`;return SA.includes(n)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(o).toString():o}function TA(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class wA{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r($r(this.auth,"network-request-failed")),IA.get())})}}function Yc(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=$r(t,e,r);return s.customData._tokenResponse=n,s}function Gv(t){return t!==void 0&&t.enterprise!==void 0}class CA{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return TA(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function kA(t,e){return ai(t,"GET","/v2/recaptchaConfig",oi(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function RA(t,e){return ai(t,"POST","/v1/accounts:delete",e)}async function pu(t,e){return ai(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nl(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function AA(t,e=!1){const n=Jt(t),r=await n.getIdToken(e),s=j0(r);Ue(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:nl(Sh(s.auth_time)),issuedAtTime:nl(Sh(s.iat)),expirationTime:nl(Sh(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Sh(t){return Number(t)*1e3}function j0(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return fd("JWT malformed, contained fewer than 3 sections"),null;try{const s=Xd(n);return s?JSON.parse(s):(fd("Failed to decode base64 JWT payload"),null)}catch(s){return fd("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function Vv(t){const e=j0(t);return Ue(e,"internal-error"),Ue(typeof e.exp<"u","internal-error"),Ue(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Dl(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof ii&&PA(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function PA({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OA{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Up{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=nl(this.lastLoginAt),this.creationTime=nl(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ml(t){var h;const e=t.auth,n=await t.getIdToken(),r=await Dl(t,pu(e,{idToken:n}));Ue(r==null?void 0:r.users.length,e,"internal-error");const s=r.users[0];t._notifyReloadListener(s);const i=(h=s.providerUserInfo)!=null&&h.length?PE(s.providerUserInfo):[],o=DA(t.providerData,i),l=t.isAnonymous,c=!(t.email&&s.passwordHash)&&!(o!=null&&o.length),d=l?c:!1,u={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new Up(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(t,u)}async function LA(t){const e=Jt(t);await Ml(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function DA(t,e){return[...t.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function PE(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function MA(t,e){const n=await RE(t,{},async()=>{const r=Zo({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=t.config,o=await AE(t,s,"/v1/token",`key=${i}`),l=await t._getAdditionalHeaders();l["Content-Type"]="application/x-www-form-urlencoded";const c={method:"POST",headers:l,body:r};return t.emulatorConfig&&qo(t.emulatorConfig.host)&&(c.credentials="include"),kE.fetch()(o,c)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function NA(t,e){return ai(t,"POST","/v2/accounts:revokeToken",oi(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ko{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ue(e.idToken,"internal-error"),Ue(typeof e.idToken<"u","internal-error"),Ue(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Vv(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){Ue(e.length!==0,"internal-error");const n=Vv(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(Ue(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:s,expiresIn:i}=await MA(e,n);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:s,expirationTime:i}=n,o=new ko;return r&&(Ue(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(Ue(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(Ue(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ko,this.toJSON())}_performRefresh(){return qr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xs(t,e){Ue(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class yr{constructor({uid:e,auth:n,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new OA(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Up(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const n=await Dl(this,this.stsTokenManager.getToken(this.auth,e));return Ue(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return AA(this,e)}reload(){return LA(this)}_assign(e){this!==e&&(Ue(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new yr({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){Ue(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await Ml(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(er(this.auth.app))return Promise.reject(ns(this.auth));const e=await this.getIdToken();return await Dl(this,RA(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const r=n.displayName??void 0,s=n.email??void 0,i=n.phoneNumber??void 0,o=n.photoURL??void 0,l=n.tenantId??void 0,c=n._redirectEventId??void 0,d=n.createdAt??void 0,u=n.lastLoginAt??void 0,{uid:h,emailVerified:f,isAnonymous:E,providerData:k,stsTokenManager:w}=n;Ue(h&&w,e,"internal-error");const $=ko.fromJSON(this.name,w);Ue(typeof h=="string",e,"internal-error"),xs(r,e.name),xs(s,e.name),Ue(typeof f=="boolean",e,"internal-error"),Ue(typeof E=="boolean",e,"internal-error"),xs(i,e.name),xs(o,e.name),xs(l,e.name),xs(c,e.name),xs(d,e.name),xs(u,e.name);const v=new yr({uid:h,auth:e,email:s,emailVerified:f,displayName:r,isAnonymous:E,photoURL:o,phoneNumber:i,tenantId:l,stsTokenManager:$,createdAt:d,lastLoginAt:u});return k&&Array.isArray(k)&&(v.providerData=k.map(_=>({..._}))),c&&(v._redirectEventId=c),v}static async _fromIdTokenResponse(e,n,r=!1){const s=new ko;s.updateFromServerResponse(n);const i=new yr({uid:n.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Ml(i),i}static async _fromGetAccountInfoResponse(e,n,r){const s=n.users[0];Ue(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?PE(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),l=new ko;l.updateFromIdToken(r);const c=new yr({uid:s.localId,auth:e,stsTokenManager:l,isAnonymous:o}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Up(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(c,d),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yv=new Map;function Zr(t){cs(t instanceof Function,"Expected a class definition");let e=Yv.get(t);return e?(cs(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,Yv.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OE{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}OE.type="NONE";const Kv=OE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hd(t,e,n){return`firebase:${t}:${e}:${n}`}class Ro{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=hd(this.userKey,s.apiKey,i),this.fullPersistenceKey=hd("persistence",s.apiKey,i),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await pu(this.auth,{idToken:e}).catch(()=>{});return n?yr._fromGetAccountInfoResponse(this.auth,n,e):null}return yr._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new Ro(Zr(Kv),e,r);const s=(await Promise.all(n.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let i=s[0]||Zr(Kv);const o=hd(r,e.config.apiKey,e.name);let l=null;for(const d of n)try{const u=await d._get(o);if(u){let h;if(typeof u=="string"){const f=await pu(e,{idToken:u}).catch(()=>{});if(!f)break;h=await yr._fromGetAccountInfoResponse(e,f,u)}else h=yr._fromJSON(e,u);d!==i&&(l=h),i=d;break}}catch{}const c=s.filter(d=>d._shouldAllowMigration);return!i._shouldAllowMigration||!c.length?new Ro(i,e,r):(i=c[0],l&&await i._set(o,l.toJSON()),await Promise.all(n.map(async d=>{if(d!==i)try{await d._remove(o)}catch{}})),new Ro(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xv(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(NE(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(LE(e))return"Firefox";if(e.includes("silk/"))return"Silk";if($E(e))return"Blackberry";if(FE(e))return"Webos";if(DE(e))return"Safari";if((e.includes("chrome/")||ME(e))&&!e.includes("edge/"))return"Chrome";if(jE(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function LE(t=kn()){return/firefox\//i.test(t)}function DE(t=kn()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function ME(t=kn()){return/crios\//i.test(t)}function NE(t=kn()){return/iemobile/i.test(t)}function jE(t=kn()){return/android/i.test(t)}function $E(t=kn()){return/blackberry/i.test(t)}function FE(t=kn()){return/webos/i.test(t)}function $0(t=kn()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function jA(t=kn()){var e;return $0(t)&&!!((e=window.navigator)!=null&&e.standalone)}function $A(){return k2()&&document.documentMode===10}function UE(t=kn()){return $0(t)||jE(t)||FE(t)||$E(t)||/windows phone/i.test(t)||NE(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BE(t,e=[]){let n;switch(t){case"Browser":n=Xv(kn());break;case"Worker":n=`${Xv(kn())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${ea}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FA{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=i=>new Promise((o,l)=>{try{const c=e(i);o(c)}catch(c){l(c)}});r.onAbort=n,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const s of n)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function UA(t,e={}){return ai(t,"GET","/v2/passwordPolicy",oi(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BA=6;class zA{constructor(e){var r;const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??BA,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((r=e.allowedNonAlphanumericCharacters)==null?void 0:r.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),s&&(n.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HA{constructor(e,n,r,s){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Qv(this),this.idTokenSubscription=new Qv(this),this.beforeStateQueue=new FA(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=wE,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=Zr(n)),this._initializationPromise=this.queue(async()=>{var r,s,i;if(!this._deleted&&(this.persistenceManager=await Ro.create(this,e),(r=this._resolvePersistenceManagerAvailable)==null||r.call(this),!this._deleted)){if((s=this._popupRedirectResolver)!=null&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((i=this.currentUser)==null?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await pu(this,{idToken:e}),r=await yr._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(er(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(l,l))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(i=this.redirectUser)==null?void 0:i._redirectEventId,l=r==null?void 0:r._redirectEventId,c=await this.tryRedirectSignIn(e);(!o||o===l)&&(c!=null&&c.user)&&(r=c.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Ue(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await Ml(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=bA()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(er(this.app))return Promise.reject(ns(this));const n=e?Jt(e):null;return n&&Ue(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&Ue(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return er(this.app)?Promise.reject(ns(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return er(this.app)?Promise.reject(ns(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Zr(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await UA(this),n=new zA(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Hl("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await NA(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&Zr(e)||this._popupRedirectResolver;Ue(n,this,"argument-error"),this.redirectPersistenceManager=await Ro.create(this,[Zr(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)==null?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)==null?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((n=this.currentUser)==null?void 0:n.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,s){if(this._deleted)return()=>{};const i=typeof n=="function"?n:n.next.bind(n);let o=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ue(l,this,"internal-error"),l.then(()=>{o||i(this.currentUser)}),typeof n=="function"){const c=e.addObserver(n,r,s);return()=>{o=!0,c()}}else{const c=e.addObserver(n);return()=>{o=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ue(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=BE(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var s;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await((s=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getHeartbeatsHeader());n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var n;if(er(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((n=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:n.getToken());return e!=null&&e.error&&vA(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function Bi(t){return Jt(t)}class Qv{constructor(e){this.auth=e,this.observer=null,this.addObserver=$2(n=>this.observer=n)}get next(){return Ue(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Zu={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function WA(t){Zu=t}function zE(t){return Zu.loadJS(t)}function GA(){return Zu.recaptchaEnterpriseScript}function VA(){return Zu.gapiScript}function YA(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class KA{constructor(){this.enterprise=new XA}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class XA{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const QA="recaptcha-enterprise",HE="NO_RECAPTCHA";class JA{constructor(e){this.type=QA,this.auth=Bi(e)}async verify(e="verify",n=!1){async function r(i){if(!n){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,l)=>{kA(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const d=new CA(c);return i.tenantId==null?i._agentRecaptchaConfig=d:i._tenantRecaptchaConfigs[i.tenantId]=d,o(d.siteKey)}}).catch(c=>{l(c)})})}function s(i,o,l){const c=window.grecaptcha;Gv(c)?c.enterprise.ready(()=>{c.enterprise.execute(i,{action:e}).then(d=>{o(d)}).catch(()=>{o(HE)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new KA().execute("siteKey",{action:"verify"}):new Promise((i,o)=>{r(this.auth).then(l=>{if(!n&&Gv(window.grecaptcha))s(l,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let c=GA();c.length!==0&&(c+=l),zE(c).then(()=>{s(l,i,o)}).catch(d=>{o(d)})}}).catch(l=>{o(l)})})}}async function Jv(t,e,n,r=!1,s=!1){const i=new JA(t);let o;if(s)o=HE;else try{o=await i.verify(n)}catch{o=await i.verify(n,!0)}const l={...e};if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in l){const c=l.phoneEnrollmentInfo.phoneNumber,d=l.phoneEnrollmentInfo.recaptchaToken;Object.assign(l,{phoneEnrollmentInfo:{phoneNumber:c,recaptchaToken:d,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in l){const c=l.phoneSignInInfo.recaptchaToken;Object.assign(l,{phoneSignInInfo:{recaptchaToken:c,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return l}return r?Object.assign(l,{captchaResp:o}):Object.assign(l,{captchaResponse:o}),Object.assign(l,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(l,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),l}async function qv(t,e,n,r,s){var i;if((i=t._getRecaptchaConfig())!=null&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await Jv(t,e,n,n==="getOobCode");return r(t,o)}else return r(t,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await Jv(t,e,n,n==="getOobCode");return r(t,l)}else return Promise.reject(o)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qA(t,e){const n=e0(t,"auth");if(n.isInitialized()){const s=n.getImmediate(),i=n.getOptions();if(Ai(i,e??{}))return s;Er(s,"already-initialized")}return n.initialize({options:e})}function ZA(t,e){const n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(Zr);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function eP(t,e,n){const r=Bi(t);Ue(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,i=WE(e),{host:o,port:l}=tP(e),c=l===null?"":`:${l}`,d={url:`${i}//${o}${c}/`},u=Object.freeze({host:o,port:l,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){Ue(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),Ue(Ai(d,r.config.emulator)&&Ai(u,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=d,r.emulatorConfig=u,r.settings.appVerificationDisabledForTesting=!0,qo(o)?(ib(`${i}//${o}${c}`),ob("Auth",!0)):nP()}function WE(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function tP(t){const e=WE(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:Zv(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:Zv(o)}}}function Zv(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function nP(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F0{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return qr("not implemented")}_getIdTokenResponse(e){return qr("not implemented")}_linkToIdToken(e,n){return qr("not implemented")}_getReauthenticationResolver(e){return qr("not implemented")}}async function rP(t,e){return ai(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sP(t,e){return ql(t,"POST","/v1/accounts:signInWithPassword",oi(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iP(t,e){return ql(t,"POST","/v1/accounts:signInWithEmailLink",oi(t,e))}async function oP(t,e){return ql(t,"POST","/v1/accounts:signInWithEmailLink",oi(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nl extends F0{constructor(e,n,r,s=null){super("password",r),this._email=e,this._password=n,this._tenantId=s}static _fromEmailAndPassword(e,n){return new Nl(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new Nl(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return qv(e,n,"signInWithPassword",sP);case"emailLink":return iP(e,{email:this._email,oobCode:this._password});default:Er(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return qv(e,r,"signUpPassword",rP);case"emailLink":return oP(e,{idToken:n,email:this._email,oobCode:this._password});default:Er(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ao(t,e){return ql(t,"POST","/v1/accounts:signInWithIdp",oi(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aP="http://localhost";class Mi extends F0{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Mi(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):Er("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=n;if(!r||!s)return null;const o=new Mi(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const n=this.buildRequest();return Ao(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,Ao(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,Ao(e,n)}buildRequest(){const e={requestUri:aP,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=Zo(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lP(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function cP(t){const e=$a(Fa(t)).link,n=e?$a(Fa(e)).deep_link_id:null,r=$a(Fa(t)).deep_link_id;return(r?$a(Fa(r)).link:null)||r||n||e||t}class U0{constructor(e){const n=$a(Fa(e)),r=n.apiKey??null,s=n.oobCode??null,i=lP(n.mode??null);Ue(r&&s&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=s,this.continueUrl=n.continueUrl??null,this.languageCode=n.lang??null,this.tenantId=n.tenantId??null}static parseLink(e){const n=cP(e);try{return new U0(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zi{constructor(){this.providerId=zi.PROVIDER_ID}static credential(e,n){return Nl._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=U0.parseLink(n);return Ue(r,"argument-error"),Nl._fromEmailAndCode(e,r.code,r.tenantId)}}zi.PROVIDER_ID="password";zi.EMAIL_PASSWORD_SIGN_IN_METHOD="password";zi.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GE{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zl extends GE{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ws extends Zl{constructor(){super("facebook.com")}static credential(e){return Mi._fromParams({providerId:ws.PROVIDER_ID,signInMethod:ws.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ws.credentialFromTaggedObject(e)}static credentialFromError(e){return ws.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ws.credential(e.oauthAccessToken)}catch{return null}}}ws.FACEBOOK_SIGN_IN_METHOD="facebook.com";ws.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cs extends Zl{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Mi._fromParams({providerId:Cs.PROVIDER_ID,signInMethod:Cs.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return Cs.credentialFromTaggedObject(e)}static credentialFromError(e){return Cs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return Cs.credential(n,r)}catch{return null}}}Cs.GOOGLE_SIGN_IN_METHOD="google.com";Cs.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ks extends Zl{constructor(){super("github.com")}static credential(e){return Mi._fromParams({providerId:ks.PROVIDER_ID,signInMethod:ks.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ks.credentialFromTaggedObject(e)}static credentialFromError(e){return ks.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ks.credential(e.oauthAccessToken)}catch{return null}}}ks.GITHUB_SIGN_IN_METHOD="github.com";ks.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rs extends Zl{constructor(){super("twitter.com")}static credential(e,n){return Mi._fromParams({providerId:Rs.PROVIDER_ID,signInMethod:Rs.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return Rs.credentialFromTaggedObject(e)}static credentialFromError(e){return Rs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return Rs.credential(n,r)}catch{return null}}}Rs.TWITTER_SIGN_IN_METHOD="twitter.com";Rs.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dP(t,e){return ql(t,"POST","/v1/accounts:signUp",oi(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ti{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,s=!1){const i=await yr._fromIdTokenResponse(e,r,s),o=e_(r);return new ti({user:i,providerId:o,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const s=e_(r);return new ti({user:e,providerId:s,_tokenResponse:r,operationType:n})}}function e_(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uP(t){var s;if(er(t.app))return Promise.reject(ns(t));const e=Bi(t);if(await e._initializationPromise,(s=e.currentUser)!=null&&s.isAnonymous)return new ti({user:e.currentUser,providerId:null,operationType:"signIn"});const n=await dP(e,{returnSecureToken:!0}),r=await ti._fromIdTokenResponse(e,"signIn",n,!0);return await e._updateCurrentUser(r.user),r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gu extends ii{constructor(e,n,r,s){super(n.code,n.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,gu.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,s){return new gu(e,n,r,s)}}function VE(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?gu._fromErrorAndOperation(t,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fP(t){return new Set(t.map(({providerId:e})=>e).filter(e=>!!e))}async function YE(t,e,n=!1){const r=await Dl(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return ti._forOperation(t,"link",r)}async function hP(t,e,n){await Ml(e);const r=fP(e.providerData);Ue(r.has(n)===t,e.auth,"provider-already-linked")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pP(t,e,n=!1){const{auth:r}=t;if(er(r.app))return Promise.reject(ns(r));const s="reauthenticate";try{const i=await Dl(t,VE(r,s,e,t),n);Ue(i.idToken,r,"internal-error");const o=j0(i.idToken);Ue(o,r,"internal-error");const{sub:l}=o;return Ue(t.uid===l,r,"user-mismatch"),ti._forOperation(t,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Er(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function KE(t,e,n=!1){if(er(t.app))return Promise.reject(ns(t));const r="signIn",s=await VE(t,r,e),i=await ti._fromIdTokenResponse(t,r,s);return n||await t._updateCurrentUser(i.user),i}async function gP(t,e){return KE(Bi(t),e)}async function mP(t,e){const n=Jt(t);return await hP(!1,n,e.providerId),YE(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yP(t){const e=Bi(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}function vP(t,e,n){return er(t.app)?Promise.reject(ns(t)):gP(Jt(t),zi.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&yP(t),r})}function _P(t,e,n,r){return Jt(t).onIdTokenChanged(e,n,r)}function xP(t,e,n){return Jt(t).beforeAuthStateChanged(e,n)}function bP(t,e,n,r){return Jt(t).onAuthStateChanged(e,n,r)}function EP(t){return Jt(t).signOut()}const mu="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XE{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(mu,"1"),this.storage.removeItem(mu),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SP=1e3,IP=10;class QE extends XE{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=UE(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),s=this.localCache[n];r!==s&&e(n,s,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((o,l,c)=>{this.notifyListeners(o,c)});return}const r=e.key;n?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!n&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);$A()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,IP):s()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},SP)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}QE.type="LOCAL";const TP=QE;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JE extends XE{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}JE.type="SESSION";const qE=JE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wP(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ef{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(s=>s.isListeningto(e));if(n)return n;const r=new ef(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:s,data:i}=n.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const l=Array.from(o).map(async d=>d(n.origin,i)),c=await wP(l);n.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:c})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}ef.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B0(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CP{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((l,c)=>{const d=B0("",20);s.port1.start();const u=setTimeout(()=>{c(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(h){const f=h;if(f.data.eventId===d)switch(f.data.status){case"ack":clearTimeout(u),i=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),l(f.data.response);break;default:clearTimeout(u),clearTimeout(i),c(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:d,data:n},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fr(){return window}function kP(t){Fr().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZE(){return typeof Fr().WorkerGlobalScope<"u"&&typeof Fr().importScripts=="function"}async function RP(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function AP(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)==null?void 0:t.controller)||null}function PP(){return ZE()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eS="firebaseLocalStorageDb",OP=1,yu="firebaseLocalStorage",tS="fbase_key";class ec{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function tf(t,e){return t.transaction([yu],e?"readwrite":"readonly").objectStore(yu)}function LP(){const t=indexedDB.deleteDatabase(eS);return new ec(t).toPromise()}function Bp(){const t=indexedDB.open(eS,OP);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(yu,{keyPath:tS})}catch(s){n(s)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(yu)?e(r):(r.close(),await LP(),e(await Bp()))})})}async function t_(t,e,n){const r=tf(t,!0).put({[tS]:e,value:n});return new ec(r).toPromise()}async function DP(t,e){const n=tf(t,!1).get(e),r=await new ec(n).toPromise();return r===void 0?null:r.value}function n_(t,e){const n=tf(t,!0).delete(e);return new ec(n).toPromise()}const MP=800,NP=3;class nS{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Bp(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>NP)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return ZE()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ef._getInstance(PP()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var n,r;if(this.activeServiceWorker=await RP(),!this.activeServiceWorker)return;this.sender=new CP(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(n=e[0])!=null&&n.fulfilled&&(r=e[0])!=null&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||AP()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Bp();return await t_(e,mu,"1"),await n_(e,mu),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>t_(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>DP(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>n_(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=tf(s,!1).getAll();return new ec(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),n.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),n.push(s));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),MP)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}nS.type="LOCAL";const jP=nS;new Jl(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $P(t,e){return e?Zr(e):(Ue(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z0 extends F0{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ao(e,this._buildIdpRequest())}_linkToIdToken(e,n){return Ao(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return Ao(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function FP(t){return KE(t.auth,new z0(t),t.bypassAuthState)}function UP(t){const{auth:e,user:n}=t;return Ue(n,e,"internal-error"),pP(n,new z0(t),t.bypassAuthState)}async function BP(t){const{auth:e,user:n}=t;return Ue(n,e,"internal-error"),YE(n,new z0(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rS{constructor(e,n,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:s,tenantId:i,error:o,type:l}=e;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:n,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(c))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return FP;case"linkViaPopup":case"linkViaRedirect":return BP;case"reauthViaPopup":case"reauthViaRedirect":return UP;default:Er(this.auth,"internal-error")}}resolve(e){cs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){cs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zP=new Jl(2e3,1e4);class _o extends rS{constructor(e,n,r,s,i){super(e,n,s,i),this.provider=r,this.authWindow=null,this.pollId=null,_o.currentPopupAction&&_o.currentPopupAction.cancel(),_o.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ue(e,this.auth,"internal-error"),e}async onExecution(){cs(this.filter.length===1,"Popup operations only handle one event");const e=B0();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject($r(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject($r(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,_o.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if((r=(n=this.authWindow)==null?void 0:n.window)!=null&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject($r(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,zP.get())};e()}}_o.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HP="pendingRedirect",pd=new Map;class WP extends rS{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=pd.get(this.auth._key());if(!e){try{const r=await GP(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}pd.set(this.auth._key(),e)}return this.bypassAuthState||pd.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function GP(t,e){const n=KP(e),r=YP(t);if(!await r._isAvailable())return!1;const s=await r._get(n)==="true";return await r._remove(n),s}function VP(t,e){pd.set(t._key(),e)}function YP(t){return Zr(t._redirectPersistence)}function KP(t){return hd(HP,t.config.apiKey,t.name)}async function XP(t,e,n=!1){if(er(t.app))return Promise.reject(ns(t));const r=Bi(t),s=$P(r,e),o=await new WP(r,s,n).execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QP=10*60*1e3;class JP{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!qP(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!sS(e)){const s=((r=e.error.code)==null?void 0:r.split("auth/")[1])||"internal-error";n.onError($r(this.auth,s))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=QP&&this.cachedEventUids.clear(),this.cachedEventUids.has(r_(e))}saveEventToCache(e){this.cachedEventUids.add(r_(e)),this.lastProcessedEventTime=Date.now()}}function r_(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function sS({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function qP(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return sS(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ZP(t,e={}){return ai(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eO=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,tO=/^https?/;async function nO(t){if(t.config.emulator)return;const{authorizedDomains:e}=await ZP(t);for(const n of e)try{if(rO(n))return}catch{}Er(t,"unauthorized-domain")}function rO(t){const e=Fp(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const o=new URL(t);return o.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&o.hostname===r}if(!tO.test(n))return!1;if(eO.test(t))return r===t;const s=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sO=new Jl(3e4,6e4);function s_(){const t=Fr().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function iO(t){return new Promise((e,n)=>{var s,i,o;function r(){s_(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{s_(),n($r(t,"network-request-failed"))},timeout:sO.get()})}if((i=(s=Fr().gapi)==null?void 0:s.iframes)!=null&&i.Iframe)e(gapi.iframes.getContext());else if((o=Fr().gapi)!=null&&o.load)r();else{const l=YA("iframefcb");return Fr()[l]=()=>{gapi.load?r():n($r(t,"network-request-failed"))},zE(`${VA()}?onload=${l}`).catch(c=>n(c))}}).catch(e=>{throw gd=null,e})}let gd=null;function oO(t){return gd=gd||iO(t),gd}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aO=new Jl(5e3,15e3),lO="__/auth/iframe",cO="emulator/auth/iframe",dO={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},uO=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function fO(t){const e=t.config;Ue(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?N0(e,cO):`https://${t.config.authDomain}/${lO}`,r={apiKey:e.apiKey,appName:t.name,v:ea},s=uO.get(t.config.apiHost);s&&(r.eid=s);const i=t._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${Zo(r).slice(1)}`}async function hO(t){const e=await oO(t),n=Fr().gapi;return Ue(n,t,"internal-error"),e.open({where:document.body,url:fO(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:dO,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=$r(t,"network-request-failed"),l=Fr().setTimeout(()=>{i(o)},aO.get());function c(){Fr().clearTimeout(l),s(r)}r.ping(c).then(c,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pO={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},gO=500,mO=600,yO="_blank",vO="http://localhost";class i_{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function _O(t,e,n,r=gO,s=mO){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const c={...pO,width:r.toString(),height:s.toString(),top:i,left:o},d=kn().toLowerCase();n&&(l=ME(d)?yO:n),LE(d)&&(e=e||vO,c.scrollbars="yes");const u=Object.entries(c).reduce((f,[E,k])=>`${f}${E}=${k},`,"");if(jA(d)&&l!=="_self")return xO(e||"",l),new i_(null);const h=window.open(e||"",l,u);Ue(h,t,"popup-blocked");try{h.focus()}catch{}return new i_(h)}function xO(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bO="__/auth/handler",EO="emulator/auth/handler",SO=encodeURIComponent("fac");async function o_(t,e,n,r,s,i){Ue(t.config.authDomain,t,"auth-domain-config-required"),Ue(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:ea,eventId:s};if(e instanceof GE){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",Qd(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[u,h]of Object.entries({}))o[u]=h}if(e instanceof Zl){const u=e.getScopes().filter(h=>h!=="");u.length>0&&(o.scopes=u.join(","))}t.tenantId&&(o.tid=t.tenantId);const l=o;for(const u of Object.keys(l))l[u]===void 0&&delete l[u];const c=await t._getAppCheckToken(),d=c?`#${SO}=${encodeURIComponent(c)}`:"";return`${IO(t)}?${Zo(l).slice(1)}${d}`}function IO({config:t}){return t.emulator?N0(t,EO):`https://${t.authDomain}/${bO}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ih="webStorageSupport";class TO{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=qE,this._completeRedirectFn=XP,this._overrideRedirectResult=VP}async _openPopup(e,n,r,s){var o;cs((o=this.eventManagers[e._key()])==null?void 0:o.manager,"_initialize() not called before _openPopup()");const i=await o_(e,n,r,Fp(),s);return _O(e,i,B0())}async _openRedirect(e,n,r,s){await this._originValidation(e);const i=await o_(e,n,r,Fp(),s);return kP(i),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:s,promise:i}=this.eventManagers[n];return s?Promise.resolve(s):(cs(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await hO(e),r=new JP(e);return n.register("authEvent",s=>(Ue(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(Ih,{type:Ih},s=>{var o;const i=(o=s==null?void 0:s[0])==null?void 0:o[Ih];i!==void 0&&n(!!i),Er(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=nO(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return UE()||DE()||$0()}}const wO=TO;var a_="@firebase/auth",l_="1.12.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CO{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){Ue(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kO(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function RO(t){Bo(new Pi("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:l}=r.options;Ue(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:o,authDomain:l,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:BE(t)},d=new HA(r,s,i,c);return ZA(d,n),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),Bo(new Pi("auth-internal",e=>{const n=Bi(e.getProvider("auth").getImmediate());return(r=>new CO(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Gs(a_,l_,kO(t)),Gs(a_,l_,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AO=5*60,PO=sb("authIdTokenMaxAge")||AO;let c_=null;const OO=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>PO)return;const s=n==null?void 0:n.token;c_!==s&&(c_=s,await fetch(t,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function LO(t=fb()){const e=e0(t,"auth");if(e.isInitialized())return e.getImmediate();const n=qA(t,{popupRedirectResolver:wO,persistence:[jP,TP,qE]}),r=sb("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=OO(i.toString());xP(n,o,()=>o(n.currentUser)),_P(n,l=>o(l))}}const s=nb("auth");return s&&eP(n,`http://${s}`),n}function DO(){var t;return((t=document.getElementsByTagName("head"))==null?void 0:t[0])??document}WA({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=s=>{const i=$r("internal-error");i.customData=s,n(i)},r.type="text/javascript",r.charset="UTF-8",DO().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});RO("Browser");const MO={apiKey:"AIzaSyCqXssa5oOaWY3CiN7ti53Qt1F_AGpBrVE",authDomain:"tenfubu-verse.firebaseapp.com",databaseURL:"https://tenfubu-verse-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"tenfubu-verse",storageBucket:"tenfubu-verse.firebasestorage.app",messagingSenderId:"1047996014362",appId:"1:1047996014362:web:729f6b715d929087e296a3"},iS=ub(MO),Dr=fA(iS),tc=LO(iS),H0=[{rank:"BRONZE",min:0,max:2e3,lossPoints:0},{rank:"SILVER",min:2001,max:4e3,lossPoints:20},{rank:"GOLD",min:4001,max:6e3,lossPoints:40},{rank:"PLATINUM",min:6001,max:8e3,lossPoints:60},{rank:"DIAMOND",min:8001,max:1e4,lossPoints:80},{rank:"MASTER",min:10001,max:1/0,lossPoints:100}],Po={BRONZE:"",SILVER:"",GOLD:"",PLATINUM:"",DIAMOND:"",MASTER:""},Mr=t=>{for(const e of H0)if(t>=e.min&&t<=e.max)return e.rank;return"BRONZE"},rl=t=>H0.findIndex(e=>e.rank===t),oS=()=>({rating:0,winStreak:0,totalMatches:0,wins:0,losses:0}),Kc=200,d_=100,NO=10,jO=20,$O=(t,e,n)=>{const r=Mr(t),s=Mr(n),i=rl(r),o=rl(s),l=e+1,c=Math.min((l-1)*NO,d_),d=Math.max(0,o-i),u=Math.min(d*jO,d_),h=100+c+u,f=Math.floor(Kc*h/100),E=t+f,k=Mr(E),w=rl(k);return{newRating:E,ratingChange:f,newWinStreak:l,newRank:k,oldRank:r,isRankUp:w>i,isRankDown:!1,bonusBreakdown:{base:Kc,winStreakBonus:Math.floor(Kc*c/100),rankDiffBonus:Math.floor(Kc*u/100),total:f}}},FO=t=>{const e=Mr(t),r=-H0.find(c=>c.rank===e).lossPoints,s=Math.max(0,t+r),i=Mr(s),o=rl(e),l=rl(i);return{newRating:s,ratingChange:r,newWinStreak:0,newRank:i,oldRank:e,isRankUp:!1,isRankDown:l<o,bonusBreakdown:{base:r,winStreakBonus:0,rankDiffBonus:0,total:r}}},u_=async(t,e,n)=>{const r=Lr(Dr,`players/${t}`),s=await Ju(r);if(s.exists()){const o=s.val();return o.userId||(await D0(r,{userId:e}),o.userId=e),o}const i={userId:e,playerName:n||"",createdAt:Date.now(),lastMatchAt:Date.now(),ratings:{}};return await Qu(r,i),i},aS=async(t,e)=>{const n=Lr(Dr,`players/${t}/ratings/${e}`),r=await Ju(n);if(r.exists())return r.val();const s=oS();return await Qu(n,s),s},UO=async t=>{const e=Lr(Dr,`players/${t}/ratings`),n=await Ju(e);return n.exists()?n.val():{}},BO=async(t,e,n,r)=>{const s=Lr(Dr,`players/${t}/ratings/${e}`),i=Lr(Dr,`players/${t}`);await mA(s,o=>{const l=o||oS();return{rating:n.newRating,winStreak:n.newWinStreak,totalMatches:l.totalMatches+1,wins:l.wins+(r?1:0),losses:l.losses+(r?0:1)}}),await D0(i,{lastMatchAt:Date.now()})},zO=async(t,e)=>{const n=Lr(Dr,`players/${t}`);await D0(n,{playerName:e})},W0=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},HO=W0("/leaders/azya_leader.png"),WO=W0("/leaders/senka_leader.png"),GO=W0("/leaders/yoRuka_leader.png"),VO=1280,YO=720,KO={BRONZE:"#cd7f32",SILVER:"#c0c0c0",GOLD:"#ffd700",PLATINUM:"#e5e4e2",DIAMOND:"#b9f2ff",MASTER:"#ff4500"},XO=({onSelectClass:t,onBack:e,gameMode:n="CPU",aiDifficulty:r="NORMAL",onDifficultyChange:s,playerName:i,onPlayerNameChange:o,timerEnabled:l=!0,onTimerEnabledChange:c,playerId:d})=>{const[u,h]=L.useState(1),[f,E]=L.useState({}),[k,w]=L.useState(!1);L.useEffect(()=>{const ee=()=>{const de=window.innerWidth/VO,ve=window.innerHeight/YO;h(Math.min(de,ve))};return ee(),window.addEventListener("resize",ee),()=>window.removeEventListener("resize",ee)},[]),L.useEffect(()=>{(async()=>{if(!d){w(!1);return}w(!0);try{const de=await UO(d);E(de)}catch(de){console.error("Failed to fetch class ratings:",de)}finally{w(!1)}})()},[d]);const $=200*u,v=280*u,_=2*u,S=1.4*u,p=.75*u,D=.65*u,H=1.2*u,ne=`${8*u}px ${16*u}px`,V=ee=>{if(n!=="RANKED_MATCH"||!d||k)return null;const de=f[ee];if(!de)return null;const ve=Mr(de.rating),je=Po[ve],ue=KO[ve];return a.jsxs("div",{style:{marginTop:`${4*u}px`,padding:`${4*u}px ${8*u}px`,background:"rgba(0, 0, 0, 0.3)",borderRadius:4*u,display:"flex",alignItems:"center",gap:`${6*u}px`},children:[a.jsx("span",{style:{fontSize:`${.7*u}rem`,fontWeight:"bold",color:ue,fontFamily:"Tamanegi, sans-serif"},children:je}),a.jsx("span",{style:{fontSize:`${.75*u}rem`,color:"#fff",fontFamily:"Tamanegi, sans-serif"},children:de.rating})]})};return a.jsxs("div",{className:"screen",style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"#1a1a2e",color:"white"},children:[a.jsx("h2",{style:{fontSize:`${_}rem`,marginBottom:`${.5*u}rem`,marginTop:0},children:""}),a.jsxs("div",{style:{marginBottom:`${.8*u}rem`,display:"flex",flexDirection:"column",alignItems:"center",gap:`${.3*u}rem`},children:[a.jsx("label",{style:{fontSize:`${.9*u}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif"},children:""}),a.jsx("input",{type:"text",value:i,onChange:ee=>o(ee.target.value),maxLength:12,placeholder:"",style:{padding:`${6*u}px ${12*u}px`,fontSize:`${.9*u}rem`,background:"#2d3748",border:"2px solid #4a5568",borderRadius:6*u,color:"white",outline:"none",width:180*u,textAlign:"center",fontFamily:"Tamanegi, sans-serif"},onFocus:ee=>ee.target.style.borderColor="#63b3ed",onBlur:ee=>ee.target.style.borderColor="#4a5568"})]}),a.jsxs("div",{style:{display:"flex",gap:`${H}rem`,marginBottom:`${1*u}rem`},children:[a.jsxs("div",{onClick:()=>t("SENKA"),style:{width:$,height:v,border:"1px solid #444",borderRadius:10*u,background:"linear-gradient(180deg, #2c0b0e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s",boxShadow:"0 4px 20px rgba(233, 69, 96, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:ee=>ee.currentTarget.style.transform="scale(1.05)",onMouseOut:ee=>ee.currentTarget.style.transform="scale(1)",children:[a.jsx("img",{src:WO,alt:"Senka",style:{width:"100%",height:"60%",objectFit:"cover"}}),a.jsxs("div",{style:{padding:`${6*u}px`,display:"flex",flexDirection:"column",alignItems:"center"},children:[a.jsx("h3",{style:{fontSize:`${S}rem`,color:"#e94560",margin:0},children:""}),a.jsx("p",{style:{color:"#aaa",margin:`${3*u}px 0`,fontSize:`${p}rem`,fontFamily:"Tamanegi, sans-serif"},children:" / "}),a.jsxs("p",{style:{padding:`0 ${.5*u}rem`,textAlign:"center",fontSize:`${D}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",lineHeight:1.3},children:["",a.jsx("br",{}),""]}),V("SENKA")]})]}),a.jsxs("div",{onClick:()=>t("AJA"),style:{width:$,height:v,border:"1px solid #444",borderRadius:10*u,background:"linear-gradient(180deg, #0f1c2e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s",boxShadow:"0 4px 20px rgba(69, 162, 233, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:ee=>ee.currentTarget.style.transform="scale(1.05)",onMouseOut:ee=>ee.currentTarget.style.transform="scale(1)",children:[a.jsx("img",{src:HO,alt:"Azya",style:{width:"100%",height:"60%",objectFit:"cover",objectPosition:"center top"}}),a.jsxs("div",{style:{padding:`${6*u}px`,display:"flex",flexDirection:"column",alignItems:"center"},children:[a.jsx("h3",{style:{fontSize:`${S}rem`,color:"#45a2e9",margin:0},children:""}),a.jsx("p",{style:{color:"#aaa",margin:`${3*u}px 0`,fontSize:`${p}rem`,fontFamily:"Tamanegi, sans-serif"},children:" / "}),a.jsxs("p",{style:{padding:`${.5*u}rem`,textAlign:"center",fontSize:`${D}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",lineHeight:1.3},children:["",a.jsx("br",{}),""]}),V("AJA")]})]}),a.jsxs("div",{onClick:()=>t("YORUKA"),style:{width:$,height:v,border:"1px solid #444",borderRadius:10*u,background:"linear-gradient(180deg, #1a0f2e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s",boxShadow:"0 4px 20px rgba(168, 85, 247, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:ee=>ee.currentTarget.style.transform="scale(1.05)",onMouseOut:ee=>ee.currentTarget.style.transform="scale(1)",children:[a.jsx("img",{src:GO,alt:"Yoruka",style:{width:"100%",height:"60%",objectFit:"cover"}}),a.jsxs("div",{style:{padding:`${6*u}px`,display:"flex",flexDirection:"column",alignItems:"center"},children:[a.jsx("h3",{style:{fontSize:`${S}rem`,color:"#a855f7",margin:0},children:"Y"}),a.jsx("p",{style:{color:"#aaa",margin:`${3*u}px 0`,fontSize:`${p}rem`,fontFamily:"Tamanegi, sans-serif"},children:" / "}),a.jsxs("p",{style:{padding:`0 ${.5*u}rem`,textAlign:"center",fontSize:`${D}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",lineHeight:1.3},children:["",a.jsx("br",{}),""]}),V("YORUKA")]})]})]}),n==="CPU"&&s&&a.jsxs("div",{style:{marginBottom:`${.6*u}rem`,display:"flex",flexDirection:"column",alignItems:"center",gap:`${.3*u}rem`},children:[a.jsx("p",{style:{fontSize:`${.85*u}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",margin:0},children:""}),a.jsx("div",{style:{display:"flex",gap:`${.6*u}rem`},children:["EASY","NORMAL","HARD"].map(ee=>a.jsx("button",{onClick:()=>s(ee),style:{padding:`${6*u}px ${14*u}px`,fontSize:`${.8*u}rem`,background:r===ee?ee==="EASY"?"#48bb78":ee==="NORMAL"?"#e94560":"#9f7aea":"transparent",border:`2px solid ${ee==="EASY"?"#48bb78":ee==="NORMAL"?"#e94560":"#9f7aea"}`,color:"#fff",cursor:"pointer",borderRadius:4*u,fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s"},children:ee==="EASY"?"":ee==="NORMAL"?"":""},ee))}),a.jsxs("p",{style:{fontSize:`${.65*u}rem`,opacity:.6,fontFamily:"Tamanegi, sans-serif",margin:0},children:[r==="EASY"&&"CPU",r==="NORMAL"&&"CPU",r==="HARD"&&"CPU"]})]}),c&&a.jsxs("div",{style:{marginBottom:`${.6*u}rem`,display:"flex",flexDirection:"column",alignItems:"center",gap:`${.3*u}rem`},children:[a.jsx("p",{style:{fontSize:`${.85*u}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",margin:0},children:""}),a.jsxs("div",{style:{display:"flex",gap:`${.6*u}rem`},children:[a.jsx("button",{onClick:()=>c(!0),style:{padding:`${6*u}px ${14*u}px`,fontSize:`${.8*u}rem`,background:l?"#3182ce":"transparent",border:"2px solid #3182ce",color:"#fff",cursor:"pointer",borderRadius:4*u,fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s"},children:"ON (60)"}),a.jsx("button",{onClick:()=>c(!1),style:{padding:`${6*u}px ${14*u}px`,fontSize:`${.8*u}rem`,background:l?"transparent":"#718096",border:"2px solid #718096",color:"#fff",cursor:"pointer",borderRadius:4*u,fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s"},children:"OFF"})]}),a.jsx("p",{style:{fontSize:`${.65*u}rem`,opacity:.6,fontFamily:"Tamanegi, sans-serif",margin:0},children:l?"600":""})]}),a.jsx("button",{onClick:e,style:{background:"#333",padding:ne,fontSize:`${.9*u}rem`,marginBottom:`${.5*u}rem`},children:""})]})};class QO{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(e){this.flush(),this._parts.push(e)}append(e){this._pieces.push(e)}flush(){if(this._pieces.length>0){const e=new Uint8Array(this._pieces);this._parts.push(e),this._pieces=[]}}toArrayBuffer(){const e=[];for(const n of this._parts)e.push(n);return JO(e).buffer}}function JO(t){let e=0;for(const s of t)e+=s.byteLength;const n=new Uint8Array(e);let r=0;for(const s of t){const i=new Uint8Array(s.buffer,s.byteOffset,s.byteLength);n.set(i,r),r+=s.byteLength}return n}function lS(t){return new qO(t).unpack()}function cS(t){const e=new ZO,n=e.pack(t);return n instanceof Promise?n.then(()=>e.getBuffer()):e.getBuffer()}class qO{constructor(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){const e=this.unpack_uint8();if(e<128)return e;if((e^224)<32)return(e^224)-32;let n;if((n=e^160)<=15)return this.unpack_raw(n);if((n=e^176)<=15)return this.unpack_string(n);if((n=e^144)<=15)return this.unpack_array(n);if((n=e^128)<=15)return this.unpack_map(n);switch(e){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return n=this.unpack_uint16(),this.unpack_string(n);case 217:return n=this.unpack_uint32(),this.unpack_string(n);case 218:return n=this.unpack_uint16(),this.unpack_raw(n);case 219:return n=this.unpack_uint32(),this.unpack_raw(n);case 220:return n=this.unpack_uint16(),this.unpack_array(n);case 221:return n=this.unpack_uint32(),this.unpack_array(n);case 222:return n=this.unpack_uint16(),this.unpack_map(n);case 223:return n=this.unpack_uint32(),this.unpack_map(n)}}unpack_uint8(){const e=this.dataView[this.index]&255;return this.index++,e}unpack_uint16(){const e=this.read(2),n=(e[0]&255)*256+(e[1]&255);return this.index+=2,n}unpack_uint32(){const e=this.read(4),n=((e[0]*256+e[1])*256+e[2])*256+e[3];return this.index+=4,n}unpack_uint64(){const e=this.read(8),n=((((((e[0]*256+e[1])*256+e[2])*256+e[3])*256+e[4])*256+e[5])*256+e[6])*256+e[7];return this.index+=8,n}unpack_int8(){const e=this.unpack_uint8();return e<128?e:e-256}unpack_int16(){const e=this.unpack_uint16();return e<32768?e:e-65536}unpack_int32(){const e=this.unpack_uint32();return e<2**31?e:e-2**32}unpack_int64(){const e=this.unpack_uint64();return e<2**63?e:e-2**64}unpack_raw(e){if(this.length<this.index+e)throw new Error(`BinaryPackFailure: index is out of range ${this.index} ${e} ${this.length}`);const n=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,n}unpack_string(e){const n=this.read(e);let r=0,s="",i,o;for(;r<e;)i=n[r],i<160?(o=i,r++):(i^192)<32?(o=(i&31)<<6|n[r+1]&63,r+=2):(i^224)<16?(o=(i&15)<<12|(n[r+1]&63)<<6|n[r+2]&63,r+=3):(o=(i&7)<<18|(n[r+1]&63)<<12|(n[r+2]&63)<<6|n[r+3]&63,r+=4),s+=String.fromCodePoint(o);return this.index+=e,s}unpack_array(e){const n=new Array(e);for(let r=0;r<e;r++)n[r]=this.unpack();return n}unpack_map(e){const n={};for(let r=0;r<e;r++){const s=this.unpack();n[s]=this.unpack()}return n}unpack_float(){const e=this.unpack_uint32(),n=e>>31,r=(e>>23&255)-127,s=e&8388607|8388608;return(n===0?1:-1)*s*2**(r-23)}unpack_double(){const e=this.unpack_uint32(),n=this.unpack_uint32(),r=e>>31,s=(e>>20&2047)-1023,o=(e&1048575|1048576)*2**(s-20)+n*2**(s-52);return(r===0?1:-1)*o}read(e){const n=this.index;if(n+e<=this.length)return this.dataView.subarray(n,n+e);throw new Error("BinaryPackFailure: read index out of range")}}class ZO{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(e){if(typeof e=="string")this.pack_string(e);else if(typeof e=="number")Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if(typeof e=="boolean")e===!0?this._bufferBuilder.append(195):e===!1&&this._bufferBuilder.append(194);else if(e===void 0)this._bufferBuilder.append(192);else if(typeof e=="object")if(e===null)this._bufferBuilder.append(192);else{const n=e.constructor;if(e instanceof Array){const r=this.pack_array(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else if(e instanceof ArrayBuffer)this.pack_bin(new Uint8Array(e));else if("BYTES_PER_ELEMENT"in e){const r=e;this.pack_bin(new Uint8Array(r.buffer,r.byteOffset,r.byteLength))}else if(e instanceof Date)this.pack_string(e.toString());else{if(e instanceof Blob)return e.arrayBuffer().then(r=>{this.pack_bin(new Uint8Array(r)),this._bufferBuilder.flush()});if(n==Object||n.toString().startsWith("class")){const r=this.pack_object(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else throw new Error(`Type "${n.toString()}" not yet supported`)}}else throw new Error(`Type "${typeof e}" not yet supported`);this._bufferBuilder.flush()}pack_bin(e){const n=e.length;if(n<=15)this.pack_uint8(160+n);else if(n<=65535)this._bufferBuilder.append(218),this.pack_uint16(n);else if(n<=4294967295)this._bufferBuilder.append(219),this.pack_uint32(n);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(e)}pack_string(e){const n=this._textEncoder.encode(e),r=n.length;if(r<=15)this.pack_uint8(176+r);else if(r<=65535)this._bufferBuilder.append(216),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(217),this.pack_uint32(r);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(n)}pack_array(e){const n=e.length;if(n<=15)this.pack_uint8(144+n);else if(n<=65535)this._bufferBuilder.append(220),this.pack_uint16(n);else if(n<=4294967295)this._bufferBuilder.append(221),this.pack_uint32(n);else throw new Error("Invalid length");const r=s=>{if(s<n){const i=this.pack(e[s]);return i instanceof Promise?i.then(()=>r(s+1)):r(s+1)}};return r(0)}pack_integer(e){if(e>=-32&&e<=127)this._bufferBuilder.append(e&255);else if(e>=0&&e<=255)this._bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&e<=127)this._bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&e<=65535)this._bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&e<=32767)this._bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&e<=4294967295)this._bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-2147483648&&e<=2147483647)this._bufferBuilder.append(210),this.pack_int32(e);else if(e>=-9223372036854776e3&&e<=9223372036854776e3)this._bufferBuilder.append(211),this.pack_int64(e);else if(e>=0&&e<=18446744073709552e3)this._bufferBuilder.append(207),this.pack_uint64(e);else throw new Error("Invalid integer")}pack_double(e){let n=0;e<0&&(n=1,e=-e);const r=Math.floor(Math.log(e)/Math.LN2),s=e/2**r-1,i=Math.floor(s*2**52),o=2**32,l=n<<31|r+1023<<20|i/o&1048575,c=i%o;this._bufferBuilder.append(203),this.pack_int32(l),this.pack_int32(c)}pack_object(e){const n=Object.keys(e),r=n.length;if(r<=15)this.pack_uint8(128+r);else if(r<=65535)this._bufferBuilder.append(222),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(223),this.pack_uint32(r);else throw new Error("Invalid length");const s=i=>{if(i<n.length){const o=n[i];if(e.hasOwnProperty(o)){this.pack(o);const l=this.pack(e[o]);if(l instanceof Promise)return l.then(()=>s(i+1))}return s(i+1)}};return s(0)}pack_uint8(e){this._bufferBuilder.append(e)}pack_uint16(e){this._bufferBuilder.append(e>>8),this._bufferBuilder.append(e&255)}pack_uint32(e){const n=e&4294967295;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255)}pack_uint64(e){const n=e/4294967296,r=e%2**32;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}pack_int8(e){this._bufferBuilder.append(e&255)}pack_int16(e){this._bufferBuilder.append((e&65280)>>8),this._bufferBuilder.append(e&255)}pack_int32(e){this._bufferBuilder.append(e>>>24&255),this._bufferBuilder.append((e&16711680)>>>16),this._bufferBuilder.append((e&65280)>>>8),this._bufferBuilder.append(e&255)}pack_int64(e){const n=Math.floor(e/4294967296),r=e%2**32;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}constructor(){this._bufferBuilder=new QO,this._textEncoder=new TextEncoder}}let dS=!0,uS=!0;function Ua(t,e,n){const r=t.match(e);return r&&r.length>=n&&parseFloat(r[n],10)}function Hi(t,e,n){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,s=r.addEventListener;r.addEventListener=function(o,l){if(o!==e)return s.apply(this,arguments);const c=d=>{const u=n(d);u&&(l.handleEvent?l.handleEvent(u):l(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(l,c),s.apply(this,[o,c])};const i=r.removeEventListener;r.removeEventListener=function(o,l){if(o!==e||!this._eventMap||!this._eventMap[e])return i.apply(this,arguments);if(!this._eventMap[e].has(l))return i.apply(this,arguments);const c=this._eventMap[e].get(l);return this._eventMap[e].delete(l),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,i.apply(this,[o,c])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function eL(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(dS=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function tL(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(uS=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function fS(){if(typeof window=="object"){if(dS)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function G0(t,e){uS&&console.warn(t+" is deprecated, please use "+e+" instead.")}function nL(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const r=n.userAgentData.brands.find(s=>s.brand==="Chromium");if(r)return{browser:"chrome",version:parseInt(r.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(Ua(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(Ua(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(Ua(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=Ua(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function f_(t){return Object.prototype.toString.call(t)==="[object Object]"}function hS(t){return f_(t)?Object.keys(t).reduce(function(e,n){const r=f_(t[n]),s=r?hS(t[n]):t[n],i=r&&!Object.keys(s).length;return s===void 0||i?e:Object.assign(e,{[n]:s})},{}):t}function zp(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?zp(t,t.get(e[r]),n):r.endsWith("Ids")&&e[r].forEach(s=>{zp(t,t.get(s),n)})}))}function h_(t,e,n){const r=n?"outbound-rtp":"inbound-rtp",s=new Map;if(e===null)return s;const i=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&i.push(o)}),i.forEach(o=>{t.forEach(l=>{l.type===r&&l.trackId===o.id&&zp(t,l,s)})}),s}const p_=fS;function pS(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const r=function(l){if(typeof l!="object"||l.mandatory||l.optional)return l;const c={};return Object.keys(l).forEach(d=>{if(d==="require"||d==="advanced"||d==="mediaSource")return;const u=typeof l[d]=="object"?l[d]:{ideal:l[d]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const h=function(f,E){return f?f+E.charAt(0).toUpperCase()+E.slice(1):E==="deviceId"?"sourceId":E};if(u.ideal!==void 0){c.optional=c.optional||[];let f={};typeof u.ideal=="number"?(f[h("min",d)]=u.ideal,c.optional.push(f),f={},f[h("max",d)]=u.ideal,c.optional.push(f)):(f[h("",d)]=u.ideal,c.optional.push(f))}u.exact!==void 0&&typeof u.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[h("",d)]=u.exact):["min","max"].forEach(f=>{u[f]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[h(f,d)]=u[f])})}),l.advanced&&(c.optional=(c.optional||[]).concat(l.advanced)),c},s=function(l,c){if(e.version>=61)return c(l);if(l=JSON.parse(JSON.stringify(l)),l&&typeof l.audio=="object"){const d=function(u,h,f){h in u&&!(f in u)&&(u[f]=u[h],delete u[h])};l=JSON.parse(JSON.stringify(l)),d(l.audio,"autoGainControl","googAutoGainControl"),d(l.audio,"noiseSuppression","googNoiseSuppression"),l.audio=r(l.audio)}if(l&&typeof l.video=="object"){let d=l.video.facingMode;d=d&&(typeof d=="object"?d:{ideal:d});const u=e.version<66;if(d&&(d.exact==="user"||d.exact==="environment"||d.ideal==="user"||d.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete l.video.facingMode;let h;if(d.exact==="environment"||d.ideal==="environment"?h=["back","rear"]:(d.exact==="user"||d.ideal==="user")&&(h=["front"]),h)return n.mediaDevices.enumerateDevices().then(f=>{f=f.filter(k=>k.kind==="videoinput");let E=f.find(k=>h.some(w=>k.label.toLowerCase().includes(w)));return!E&&f.length&&h.includes("back")&&(E=f[f.length-1]),E&&(l.video.deviceId=d.exact?{exact:E.deviceId}:{ideal:E.deviceId}),l.video=r(l.video),p_("chrome: "+JSON.stringify(l)),c(l)})}l.video=r(l.video)}return p_("chrome: "+JSON.stringify(l)),c(l)},i=function(l){return e.version>=64?l:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[l.name]||l.name,message:l.message,constraint:l.constraint||l.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(l,c,d){s(l,u=>{n.webkitGetUserMedia(u,c,h=>{d&&d(i(h))})})};if(n.getUserMedia=o.bind(n),n.mediaDevices.getUserMedia){const l=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return s(c,d=>l(d).then(u=>{if(d.audio&&!u.getAudioTracks().length||d.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(h=>{h.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(i(u))))}}}function gS(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function mS(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",s=>{let i;t.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(l=>l.track&&l.track.id===s.track.id):i={track:s.track};const o=new Event("track");o.track=s.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[r.stream],this.dispatchEvent(o)}),r.stream.getTracks().forEach(s=>{let i;t.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(l=>l.track&&l.track.id===s.id):i={track:s};const o=new Event("track");o.track=s,o.receiver=i,o.transceiver={receiver:i},o.streams=[r.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Hi(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function yS(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(s,i){return{track:i,get dtmf(){return this._dtmf===void 0&&(i.kind==="audio"?this._dtmf=s.createDTMFSender(i):this._dtmf=null),this._dtmf},_pc:s}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const s=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(l,c){let d=s.apply(this,arguments);return d||(d=e(this,l),this._senders.push(d)),d};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(l){i.apply(this,arguments);const c=this._senders.indexOf(l);c!==-1&&this._senders.splice(c,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],n.apply(this,[i]),i.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach(o=>{const l=this._senders.find(c=>c.track===o);l&&this._senders.splice(this._senders.indexOf(l),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function vS(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=n.apply(this,[]);return i.forEach(o=>o._pc=this),i});const r=t.RTCPeerConnection.prototype.addTrack;r&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=r.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){const i=this;return this._pc.getStats().then(o=>h_(o,i.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const s=n.apply(this,[]);return s.forEach(i=>i._pc=this),s}),Hi(t,"track",r=>(r.receiver._pc=r.srcElement,r)),t.RTCRtpReceiver.prototype.getStats=function(){const s=this;return this._pc.getStats().then(i=>h_(i,s.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const r=arguments[0];let s,i,o;return this.getSenders().forEach(l=>{l.track===r&&(s?o=!0:s=l)}),this.getReceivers().forEach(l=>(l.track===r&&(i?o=!0:i=l),l.track===r)),o||s&&i?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function _S(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,l){if(!l)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[l.id]?this._shimmedLocalStreams[l.id].indexOf(c)===-1&&this._shimmedLocalStreams[l.id].push(c):this._shimmedLocalStreams[l.id]=[l,c],c};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(d=>{if(this.getSenders().find(h=>h.track===d))throw new DOMException("Track already exists.","InvalidAccessError")});const l=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(d=>l.indexOf(d)===-1);this._shimmedLocalStreams[o.id]=[o].concat(c)};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],r.apply(this,arguments)};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(l=>{const c=this._shimmedLocalStreams[l].indexOf(o);c!==-1&&this._shimmedLocalStreams[l].splice(c,1),this._shimmedLocalStreams[l].length===1&&delete this._shimmedLocalStreams[l]}),s.apply(this,arguments)}}function xS(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return _S(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const u=n.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(h=>this._reverseStreams[h.id])};const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(h=>{if(this.getSenders().find(E=>E.track===h))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const h=new t.MediaStream(u.getTracks());this._streams[u.id]=h,this._reverseStreams[h.id]=u,u=h}r.apply(this,[u])};const s=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},t.RTCPeerConnection.prototype.addTrack=function(u,h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const f=[].slice.call(arguments,1);if(f.length!==1||!f[0].getTracks().find(w=>w===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(w=>w.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const k=this._streams[h.id];if(k)k.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const w=new t.MediaStream([u]);this._streams[h.id]=w,this._reverseStreams[w.id]=h,this.addStream(w)}return this.getSenders().find(w=>w.track===u)};function i(d,u){let h=u.sdp;return Object.keys(d._reverseStreams||[]).forEach(f=>{const E=d._reverseStreams[f],k=d._streams[E.id];h=h.replace(new RegExp(k.id,"g"),E.id)}),new RTCSessionDescription({type:u.type,sdp:h})}function o(d,u){let h=u.sdp;return Object.keys(d._reverseStreams||[]).forEach(f=>{const E=d._reverseStreams[f],k=d._streams[E.id];h=h.replace(new RegExp(E.id,"g"),k.id)}),new RTCSessionDescription({type:u.type,sdp:h})}["createOffer","createAnswer"].forEach(function(d){const u=t.RTCPeerConnection.prototype[d],h={[d](){const f=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[k=>{const w=i(this,k);f[0].apply(null,[w])},k=>{f[1]&&f[1].apply(null,k)},arguments[2]]):u.apply(this,arguments).then(k=>i(this,k))}};t.RTCPeerConnection.prototype[d]=h[d]});const l=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?l.apply(this,arguments):(arguments[0]=o(this,arguments[0]),l.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const d=c.get.apply(this);return d.type===""?d:i(this,d)}}),t.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let f;Object.keys(this._streams).forEach(E=>{this._streams[E].getTracks().find(w=>u.track===w)&&(f=this._streams[E])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Hp(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=t.RTCPeerConnection.prototype[n],s={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=s[n]})}function bS(t,e){Hi(t,"negotiationneeded",n=>{const r=n.target;if(!((e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return n})}const g_=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:bS,shimAddTrackRemoveTrack:xS,shimAddTrackRemoveTrackWithNative:_S,shimGetSendersWithDtmf:yS,shimGetUserMedia:pS,shimMediaStream:gS,shimOnTrack:mS,shimPeerConnection:Hp,shimSenderReceiverGetStats:vS},Symbol.toStringTag,{value:"Module"}));function ES(t,e){const n=t&&t.navigator,r=t&&t.MediaStreamTrack;if(n.getUserMedia=function(s,i,o){G0("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(s).then(i,o)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const s=function(o,l,c){l in o&&!(c in o)&&(o[c]=o[l],delete o[l])},i=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),s(o.audio,"autoGainControl","mozAutoGainControl"),s(o.audio,"noiseSuppression","mozNoiseSuppression")),i(o)},r&&r.prototype.getSettings){const o=r.prototype.getSettings;r.prototype.getSettings=function(){const l=o.apply(this,arguments);return s(l,"mozAutoGainControl","autoGainControl"),s(l,"mozNoiseSuppression","noiseSuppression"),l}}if(r&&r.prototype.applyConstraints){const o=r.prototype.applyConstraints;r.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),s(l,"autoGainControl","mozAutoGainControl"),s(l,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[l])}}}}function rL(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,Promise.reject(s)}return r.video===!0?r.video={mediaSource:e}:r.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(r)})}function SS(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Wp(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const i=t.RTCPeerConnection.prototype[s],o={[s](){return arguments[0]=new(s==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[s]=o[s]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[i,o,l]=arguments;return r.apply(this,[i||null]).then(c=>{if(e.version<53&&!o)try{c.forEach(d=>{d.type=n[d.type]||d.type})}catch(d){if(d.name!=="TypeError")throw d;c.forEach((u,h)=>{c.set(h,Object.assign({},u,{type:n[u.type]||u.type}))})}return c}).then(o,l)}}function IS(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=e.apply(this,[]);return s.forEach(i=>i._pc=this),s});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=n.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function TS(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r}),Hi(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function wS(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){G0("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&n.getTracks().includes(r.track)&&this.removeTrack(r)})})}function CS(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function kS(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const s=r.length>0;s&&r.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=e.apply(this,arguments);if(s){const{sender:o}=i,l=o.getParameters();(!("encodings"in l)||l.encodings.length===1&&Object.keys(l.encodings[0]).length===0)&&(l.encodings=r,o.sendEncodings=r,this.setParametersPromises.push(o.setParameters(l).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return i})}function RS(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const r=e.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function AS(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function PS(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}const m_=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:kS,shimCreateAnswer:PS,shimCreateOffer:AS,shimGetDisplayMedia:rL,shimGetParameters:RS,shimGetUserMedia:ES,shimOnTrack:SS,shimPeerConnection:Wp,shimRTCDataChannel:CS,shimReceiverGetStats:TS,shimRemoveStream:wS,shimSenderGetStats:IS},Symbol.toStringTag,{value:"Module"}));function OS(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(s=>e.call(this,s,r)),r.getVideoTracks().forEach(s=>e.call(this,s,r))},t.RTCPeerConnection.prototype.addTrack=function(r,...s){return s&&s.forEach(i=>{this._localStreams?this._localStreams.includes(i)||this._localStreams.push(i):this._localStreams=[i]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(n);if(r===-1)return;this._localStreams.splice(r,1);const s=n.getTracks();this.getSenders().forEach(i=>{s.includes(i.track)&&this.removeTrack(i)})})}}function LS(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(s=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(s))return;this._remoteStreams.push(s);const i=new Event("addstream");i.stream=s,this.dispatchEvent(i)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){s.streams.forEach(i=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(i)>=0)return;r._remoteStreams.push(i);const o=new Event("addstream");o.stream=i,r.dispatchEvent(o)})}),e.apply(r,arguments)}}}function DS(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,r=e.createAnswer,s=e.setLocalDescription,i=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(d,u){const h=arguments.length>=2?arguments[2]:arguments[0],f=n.apply(this,[h]);return u?(f.then(d,u),Promise.resolve()):f},e.createAnswer=function(d,u){const h=arguments.length>=2?arguments[2]:arguments[0],f=r.apply(this,[h]);return u?(f.then(d,u),Promise.resolve()):f};let l=function(c,d,u){const h=s.apply(this,[c]);return u?(h.then(d,u),Promise.resolve()):h};e.setLocalDescription=l,l=function(c,d,u){const h=i.apply(this,[c]);return u?(h.then(d,u),Promise.resolve()):h},e.setRemoteDescription=l,l=function(c,d,u){const h=o.apply(this,[c]);return u?(h.then(d,u),Promise.resolve()):h},e.addIceCandidate=l}function MS(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,r=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=s=>r(NS(s))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(r,s,i){e.mediaDevices.getUserMedia(r).then(s,i)}).bind(e))}function NS(t){return t&&t.video!==void 0?Object.assign({},t,{video:hS(t.video)}):t}function jS(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(r,s){if(r&&r.iceServers){const i=[];for(let o=0;o<r.iceServers.length;o++){let l=r.iceServers[o];l.urls===void 0&&l.url?(G0("RTCIceServer.url","RTCIceServer.urls"),l=JSON.parse(JSON.stringify(l)),l.urls=l.url,delete l.url,i.push(l)):i.push(r.iceServers[o])}r.iceServers=i}return new e(r,s)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function $S(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function FS(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):r.offerToReceiveAudio===!0&&!s&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const i=this.getTransceivers().find(o=>o.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveVideo===!0&&!i&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function US(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}const y_=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:US,shimCallbacksAPI:DS,shimConstraints:NS,shimCreateOfferLegacy:FS,shimGetUserMedia:MS,shimLocalStreamsAPI:OS,shimRTCIceServerUrls:jS,shimRemoteStreamsAPI:LS,shimTrackEventTransceiver:$S},Symbol.toStringTag,{value:"Module"}));var BS={exports:{}};(function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},e.splitSections=function(n){return n.split(`
m=`).map((s,i)=>(i>0?"m="+s:s).trim()+`\r
`)},e.getDescription=function(n){const r=e.splitSections(n);return r&&r[0]},e.getMediaSections=function(n){const r=e.splitSections(n);return r.shift(),r},e.matchPrefix=function(n,r){return e.splitLines(n).filter(s=>s.indexOf(r)===0)},e.parseCandidate=function(n){let r;n.indexOf("a=candidate:")===0?r=n.substring(12).split(" "):r=n.substring(10).split(" ");const s={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let i=8;i<r.length;i+=2)switch(r[i]){case"raddr":s.relatedAddress=r[i+1];break;case"rport":s.relatedPort=parseInt(r[i+1],10);break;case"tcptype":s.tcpType=r[i+1];break;case"ufrag":s.ufrag=r[i+1],s.usernameFragment=r[i+1];break;default:s[r[i]]===void 0&&(s[r[i]]=r[i+1]);break}return s},e.writeCandidate=function(n){const r=[];r.push(n.foundation);const s=n.component;s==="rtp"?r.push(1):s==="rtcp"?r.push(2):r.push(s),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const i=n.type;return r.push("typ"),r.push(i),i!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let r=n.substring(9).split(" ");const s={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),s.name=r[0],s.clockRate=parseInt(r[1],10),s.channels=r.length===3?parseInt(r[2],10):1,s.numChannels=s.channels,s},e.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const s=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(s!==1?"/"+s:"")+`\r
`},e.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const r={};let s;const i=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<i.length;o++)s=i[o].trim().split("="),r[s[0].trim()]=s[1];return r},e.writeFmtp=function(n){let r="",s=n.payloadType;if(n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const i=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?i.push(o+"="+n.parameters[o]):i.push(o)}),r+="a=fmtp:"+s+" "+i.join(";")+`\r
`}return r},e.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},e.writeRtcpFb=function(n){let r="",s=n.payloadType;return n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(i=>{r+="a=rtcp-fb:"+s+" "+i.type+(i.parameter&&i.parameter.length?" "+i.parameter:"")+`\r
`}),r},e.parseSsrcMedia=function(n){const r=n.indexOf(" "),s={ssrc:parseInt(n.substring(7,r),10)},i=n.indexOf(":",r);return i>-1?(s.attribute=n.substring(r+1,i),s.value=n.substring(i+1)):s.attribute=n.substring(r+1),s},e.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(s=>parseInt(s,10))}},e.getMid=function(n){const r=e.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},e.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:e.matchPrefix(n+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,r){let s="a=setup:"+r+`\r
`;return n.fingerprints.forEach(i=>{s+="a=fingerprint:"+i.algorithm+" "+i.value+`\r
`}),s},e.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,r){return e.matchPrefix(n+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,r){const s=e.matchPrefix(n+r,"a=ice-ufrag:")[0],i=e.matchPrefix(n+r,"a=ice-pwd:")[0];return s&&i?{usernameFragment:s.substring(12),password:i.substring(10)}:null},e.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},e.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=e.splitLines(n)[0].split(" ");r.profile=i[2];for(let l=3;l<i.length;l++){const c=i[l],d=e.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(d){const u=e.parseRtpMap(d),h=e.matchPrefix(n,"a=fmtp:"+c+" ");switch(u.parameters=h.length?e.parseFmtp(h[0]):{},u.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),r.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(l=>{r.headerExtensions.push(e.parseExtmap(l))});const o=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(l=>{o.forEach(c=>{l.rtcpFeedback.find(u=>u.type===c.type&&u.parameter===c.parameter)||l.rtcpFeedback.push(c)})}),r},e.writeRtpDescription=function(n,r){let s="";s+="m="+n+" ",s+=r.codecs.length>0?"9":"0",s+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",s+=r.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,s+=`c=IN IP4 0.0.0.0\r
`,s+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(o=>{s+=e.writeRtpMap(o),s+=e.writeFmtp(o),s+=e.writeRtcpFb(o)});let i=0;return r.codecs.forEach(o=>{o.maxptime>i&&(i=o.maxptime)}),i>0&&(s+="a=maxptime:"+i+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(o=>{s+=e.writeExtmap(o)}),s},e.parseRtpEncodingParameters=function(n){const r=[],s=e.parseRtpParameters(n),i=s.fecMechanisms.indexOf("RED")!==-1,o=s.fecMechanisms.indexOf("ULPFEC")!==-1,l=e.matchPrefix(n,"a=ssrc:").map(f=>e.parseSsrcMedia(f)).filter(f=>f.attribute==="cname"),c=l.length>0&&l[0].ssrc;let d;const u=e.matchPrefix(n,"a=ssrc-group:FID").map(f=>f.substring(17).split(" ").map(k=>parseInt(k,10)));u.length>0&&u[0].length>1&&u[0][0]===c&&(d=u[0][1]),s.codecs.forEach(f=>{if(f.name.toUpperCase()==="RTX"&&f.parameters.apt){let E={ssrc:c,codecPayloadType:parseInt(f.parameters.apt,10)};c&&d&&(E.rtx={ssrc:d}),r.push(E),i&&(E=JSON.parse(JSON.stringify(E)),E.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},r.push(E))}}),r.length===0&&c&&r.push({ssrc:c});let h=e.matchPrefix(n,"b=");return h.length&&(h[0].indexOf("b=TIAS:")===0?h=parseInt(h[0].substring(7),10):h[0].indexOf("b=AS:")===0?h=parseInt(h[0].substring(5),10)*1e3*.95-50*40*8:h=void 0,r.forEach(f=>{f.maxBitrate=h})),r},e.parseRtcpParameters=function(n){const r={},s=e.matchPrefix(n,"a=ssrc:").map(l=>e.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];s&&(r.cname=s.value,r.ssrc=s.ssrc);const i=e.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=i.length>0,r.compound=i.length===0;const o=e.matchPrefix(n,"a=rtcp-mux");return r.mux=o.length>0,r},e.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},e.parseMsid=function(n){let r;const s=e.matchPrefix(n,"a=msid:");if(s.length===1)return r=s[0].substring(7).split(" "),{stream:r[0],track:r[1]};const i=e.matchPrefix(n,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(i.length>0)return r=i[0].value.split(" "),{stream:r[0],track:r[1]}},e.parseSctpDescription=function(n){const r=e.parseMLine(n),s=e.matchPrefix(n,"a=max-message-size:");let i;s.length>0&&(i=parseInt(s[0].substring(19),10)),isNaN(i)&&(i=65536);const o=e.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:r.fmt,maxMessageSize:i};const l=e.matchPrefix(n,"a=sctpmap:");if(l.length>0){const c=l[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:i}}},e.writeSctpDescription=function(n,r){let s=[];return n.protocol!=="DTLS/SCTP"?s=["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:s=["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&s.push("a=max-message-size:"+r.maxMessageSize+`\r
`),s.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,r,s){let i;const o=r!==void 0?r:2;return n?i=n:i=e.generateSessionId(),`v=0\r
o=`+(s||"thisisadapterortc")+" "+i+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,r){const s=e.splitLines(n);for(let i=0;i<s.length;i++)switch(s[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[i].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const s=e.splitLines(n)[0].substring(2).split(" ");return{kind:s[0],port:parseInt(s[1],10),protocol:s[2],fmt:s.slice(3).join(" ")}},e.parseOLine=function(n){const s=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:s[0],sessionId:s[1],sessionVersion:parseInt(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=e.splitLines(n);for(let s=0;s<r.length;s++)if(r[s].length<2||r[s].charAt(1)!=="=")return!1;return!0},t.exports=e})(BS);var zS=BS.exports;const Oo=F_(zS),sL=DI({__proto__:null,default:Oo},[zS]);function md(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const s=new e(r),i=Oo.parseCandidate(r.candidate);for(const o in i)o in s||Object.defineProperty(s,o,{value:i[o]});return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new e(r)},t.RTCIceCandidate.prototype=e.prototype,Hi(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function Gp(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Hi(t,"icecandidate",e=>{if(e.candidate){const n=Oo.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function yd(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(l){if(!l||!l.sdp)return!1;const c=Oo.splitSections(l.sdp);return c.shift(),c.some(d=>{const u=Oo.parseMLine(d);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},r=function(l){const c=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const d=parseInt(c[1],10);return d!==d?-1:d},s=function(l){let c=65536;return e.browser==="firefox"&&(e.version<57?l===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},i=function(l,c){let d=65536;e.browser==="firefox"&&e.version===57&&(d=65535);const u=Oo.matchPrefix(l.sdp,"a=max-message-size:");return u.length>0?d=parseInt(u[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(d=2147483637),d},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=r(arguments[0]),d=s(c),u=i(arguments[0],c);let h;d===0&&u===0?h=Number.POSITIVE_INFINITY:d===0||u===0?h=Math.max(d,u):h=Math.min(d,u);const f={};Object.defineProperty(f,"maxMessageSize",{get(){return h}}),this._sctp=f}return o.apply(this,arguments)}}function vd(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(r,s){const i=r.send;r.send=function(){const l=arguments[0],c=l.length||l.size||l.byteLength;if(r.readyState==="open"&&s.sctp&&c>s.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+s.sctp.maxMessageSize+" bytes)");return i.apply(r,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const s=n.apply(this,arguments);return e(s,this),s},Hi(t,"datachannel",r=>(e(r.channel,r.target),r))}function Vp(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=s=>{const i=s.target;if(i._lastConnectionState!==i.connectionState){i._lastConnectionState=i.connectionState;const o=new Event("connectionstatechange",s);i.dispatchEvent(o)}return s},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function Yp(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(s){if(s&&s.sdp&&s.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i=s.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&s instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:s.type,sdp:i}):s.sdp=i}return n.apply(this,arguments)}}function _d(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function xd(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let s=arguments[0]||{};if(typeof s!="object"||s.type&&s.sdp)return n.apply(this,arguments);if(s={type:s.type,sdp:s.sdp},!s.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":s.type="offer";break;default:s.type="answer";break}return s.sdp||s.type!=="offer"&&s.type!=="answer"?n.apply(this,[s]):(s.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}const iL=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:Yp,shimAddIceCandidateNullOrEmpty:_d,shimConnectionState:Vp,shimMaxMessageSize:yd,shimParameterlessSetLocalDescription:xd,shimRTCIceCandidate:md,shimRTCIceCandidateRelayProtocol:Gp,shimSendThrowTypeError:vd},Symbol.toStringTag,{value:"Module"}));function oL({window:t}={},e={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const n=fS,r=nL(t),s={browserDetails:r,commonShim:iL,extractVersion:Ua,disableLog:eL,disableWarnings:tL,sdp:sL};switch(r.browser){case"chrome":if(!g_||!Hp||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),s;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),s;n("adapter.js shimming chrome."),s.browserShim=g_,_d(t,r),xd(t),pS(t,r),gS(t),Hp(t,r),mS(t),xS(t,r),yS(t),vS(t),bS(t,r),md(t),Gp(t),Vp(t),yd(t,r),vd(t),Yp(t,r);break;case"firefox":if(!m_||!Wp||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),s;n("adapter.js shimming firefox."),s.browserShim=m_,_d(t,r),xd(t),ES(t,r),Wp(t,r),SS(t),wS(t),IS(t),TS(t),CS(t),kS(t),RS(t),AS(t),PS(t),md(t),Vp(t),yd(t,r),vd(t);break;case"safari":if(!y_||!e.shimSafari)return n("Safari shim is not included in this adapter release."),s;n("adapter.js shimming safari."),s.browserShim=y_,_d(t,r),xd(t),jS(t),FS(t),DS(t),OS(t),LS(t),$S(t),MS(t),US(t),md(t),Gp(t),yd(t,r),vd(t),Yp(t,r);break;default:n("Unsupported browser!");break}return s}const v_=oL({window:typeof window>"u"?void 0:window});function Wi(t,e,n,r){Object.defineProperty(t,e,{get:n,set:r,enumerable:!0,configurable:!0})}class HS{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=e=>{const n=[],r=e.byteLength,s=Math.ceil(r/this.chunkedMTU);let i=0,o=0;for(;o<r;){const l=Math.min(r,o+this.chunkedMTU),c=e.slice(o,l),d={__peerData:this._dataCount,n:i,data:c,total:s};n.push(d),o=l,i++}return this._dataCount++,n}}}function aL(t){let e=0;for(const s of t)e+=s.byteLength;const n=new Uint8Array(e);let r=0;for(const s of t)n.set(s,r),r+=s.byteLength;return n}const Th=v_.default||v_,Oa=new class{isWebRTCSupported(){return typeof RTCPeerConnection<"u"}isBrowserSupported(){const t=this.getBrowser(),e=this.getVersion();return this.supportedBrowsers.includes(t)?t==="chrome"?e>=this.minChromeVersion:t==="firefox"?e>=this.minFirefoxVersion:t==="safari"?!this.isIOS&&e>=this.minSafariVersion:!1:!1}getBrowser(){return Th.browserDetails.browser}getVersion(){return Th.browserDetails.version||0}isUnifiedPlanSupported(){const t=this.getBrowser(),e=Th.browserDetails.version||0;if(t==="chrome"&&e<this.minChromeVersion)return!1;if(t==="firefox"&&e>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let n,r=!1;try{n=new RTCPeerConnection,n.addTransceiver("audio"),r=!0}catch{}finally{n&&n.close()}return r}toString(){return`Supports:
    browser:${this.getBrowser()}
    version:${this.getVersion()}
    isIOS:${this.isIOS}
    isWebRTCSupported:${this.isWebRTCSupported()}
    isBrowserSupported:${this.isBrowserSupported()}
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS=typeof navigator<"u"?["iPad","iPhone","iPod"].includes(navigator.platform):!1,this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},lL=t=>!t||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(t),WS=()=>Math.random().toString(36).slice(2),__={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};class cL extends HS{noop(){}blobToArrayBuffer(e,n){const r=new FileReader;return r.onload=function(s){s.target&&n(s.target.result)},r.readAsArrayBuffer(e),r}binaryStringToArrayBuffer(e){const n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r)&255;return n.buffer}isSecure(){return location.protocol==="https:"}constructor(...e){super(...e),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=__,this.browser=Oa.getBrowser(),this.browserVersion=Oa.getVersion(),this.pack=cS,this.unpack=lS,this.supports=function(){const n={browser:Oa.isBrowserSupported(),webRTC:Oa.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!n.webRTC)return n;let r;try{r=new RTCPeerConnection(__),n.audioVideo=!0;let s;try{s=r.createDataChannel("_PEERJSTEST",{ordered:!0}),n.data=!0,n.reliable=!!s.ordered;try{s.binaryType="blob",n.binaryBlob=!Oa.isIOS}catch{}}catch{}finally{s&&s.close()}}catch{}finally{r&&r.close()}return n}(),this.validateId=lL,this.randomToken=WS}}const Ln=new cL,dL="PeerJS: ";class uL{get logLevel(){return this._logLevel}set logLevel(e){this._logLevel=e}log(...e){this._logLevel>=3&&this._print(3,...e)}warn(...e){this._logLevel>=2&&this._print(2,...e)}error(...e){this._logLevel>=1&&this._print(1,...e)}setLogFunction(e){this._print=e}_print(e,...n){const r=[dL,...n];for(const s in r)r[s]instanceof Error&&(r[s]="("+r[s].name+") "+r[s].message);e>=3?console.log(...r):e>=2?console.warn("WARNING",...r):e>=1&&console.error("ERROR",...r)}constructor(){this._logLevel=0}}var Ce=new uL,V0={},fL=Object.prototype.hasOwnProperty,Rn="~";function jl(){}Object.create&&(jl.prototype=Object.create(null),new jl().__proto__||(Rn=!1));function hL(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function GS(t,e,n,r,s){if(typeof n!="function")throw new TypeError("The listener must be a function");var i=new hL(n,r||t,s),o=Rn?Rn+e:e;return t._events[o]?t._events[o].fn?t._events[o]=[t._events[o],i]:t._events[o].push(i):(t._events[o]=i,t._eventsCount++),t}function bd(t,e){--t._eventsCount===0?t._events=new jl:delete t._events[e]}function xn(){this._events=new jl,this._eventsCount=0}xn.prototype.eventNames=function(){var e=[],n,r;if(this._eventsCount===0)return e;for(r in n=this._events)fL.call(n,r)&&e.push(Rn?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(n)):e};xn.prototype.listeners=function(e){var n=Rn?Rn+e:e,r=this._events[n];if(!r)return[];if(r.fn)return[r.fn];for(var s=0,i=r.length,o=new Array(i);s<i;s++)o[s]=r[s].fn;return o};xn.prototype.listenerCount=function(e){var n=Rn?Rn+e:e,r=this._events[n];return r?r.fn?1:r.length:0};xn.prototype.emit=function(e,n,r,s,i,o){var l=Rn?Rn+e:e;if(!this._events[l])return!1;var c=this._events[l],d=arguments.length,u,h;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,n),!0;case 3:return c.fn.call(c.context,n,r),!0;case 4:return c.fn.call(c.context,n,r,s),!0;case 5:return c.fn.call(c.context,n,r,s,i),!0;case 6:return c.fn.call(c.context,n,r,s,i,o),!0}for(h=1,u=new Array(d-1);h<d;h++)u[h-1]=arguments[h];c.fn.apply(c.context,u)}else{var f=c.length,E;for(h=0;h<f;h++)switch(c[h].once&&this.removeListener(e,c[h].fn,void 0,!0),d){case 1:c[h].fn.call(c[h].context);break;case 2:c[h].fn.call(c[h].context,n);break;case 3:c[h].fn.call(c[h].context,n,r);break;case 4:c[h].fn.call(c[h].context,n,r,s);break;default:if(!u)for(E=1,u=new Array(d-1);E<d;E++)u[E-1]=arguments[E];c[h].fn.apply(c[h].context,u)}}return!0};xn.prototype.on=function(e,n,r){return GS(this,e,n,r,!1)};xn.prototype.once=function(e,n,r){return GS(this,e,n,r,!0)};xn.prototype.removeListener=function(e,n,r,s){var i=Rn?Rn+e:e;if(!this._events[i])return this;if(!n)return bd(this,i),this;var o=this._events[i];if(o.fn)o.fn===n&&(!s||o.once)&&(!r||o.context===r)&&bd(this,i);else{for(var l=0,c=[],d=o.length;l<d;l++)(o[l].fn!==n||s&&!o[l].once||r&&o[l].context!==r)&&c.push(o[l]);c.length?this._events[i]=c.length===1?c[0]:c:bd(this,i)}return this};xn.prototype.removeAllListeners=function(e){var n;return e?(n=Rn?Rn+e:e,this._events[n]&&bd(this,n)):(this._events=new jl,this._eventsCount=0),this};xn.prototype.off=xn.prototype.removeListener;xn.prototype.addListener=xn.prototype.on;xn.prefixed=Rn;xn.EventEmitter=xn;V0=xn;var Gi={};Wi(Gi,"ConnectionType",()=>Ks);Wi(Gi,"PeerErrorType",()=>Gt);Wi(Gi,"BaseConnectionErrorType",()=>Kp);Wi(Gi,"DataConnectionErrorType",()=>Y0);Wi(Gi,"SerializationType",()=>nf);Wi(Gi,"SocketEventType",()=>Ds);Wi(Gi,"ServerMessageType",()=>yn);var Ks=function(t){return t.Data="data",t.Media="media",t}({}),Gt=function(t){return t.BrowserIncompatible="browser-incompatible",t.Disconnected="disconnected",t.InvalidID="invalid-id",t.InvalidKey="invalid-key",t.Network="network",t.PeerUnavailable="peer-unavailable",t.SslUnavailable="ssl-unavailable",t.ServerError="server-error",t.SocketError="socket-error",t.SocketClosed="socket-closed",t.UnavailableID="unavailable-id",t.WebRTC="webrtc",t}({}),Kp=function(t){return t.NegotiationFailed="negotiation-failed",t.ConnectionClosed="connection-closed",t}({}),Y0=function(t){return t.NotOpenYet="not-open-yet",t.MessageToBig="message-too-big",t}({}),nf=function(t){return t.Binary="binary",t.BinaryUTF8="binary-utf8",t.JSON="json",t.None="raw",t}({}),Ds=function(t){return t.Message="message",t.Disconnected="disconnected",t.Error="error",t.Close="close",t}({}),yn=function(t){return t.Heartbeat="HEARTBEAT",t.Candidate="CANDIDATE",t.Offer="OFFER",t.Answer="ANSWER",t.Open="OPEN",t.Error="ERROR",t.IdTaken="ID-TAKEN",t.InvalidKey="INVALID-KEY",t.Leave="LEAVE",t.Expire="EXPIRE",t}({});const VS="1.5.5";class pL extends V0.EventEmitter{constructor(e,n,r,s,i,o=5e3){super(),this.pingInterval=o,this._disconnected=!0,this._messagesQueue=[];const l=e?"wss://":"ws://";this._baseUrl=l+n+":"+r+s+"peerjs?key="+i}start(e,n){this._id=e;const r=`${this._baseUrl}&id=${e}&token=${n}`;this._socket||!this._disconnected||(this._socket=new WebSocket(r+"&version="+VS),this._disconnected=!1,this._socket.onmessage=s=>{let i;try{i=JSON.parse(s.data),Ce.log("Server message received:",i)}catch{Ce.log("Invalid server message",s.data);return}this.emit(Ds.Message,i)},this._socket.onclose=s=>{this._disconnected||(Ce.log("Socket closed.",s),this._cleanup(),this._disconnected=!0,this.emit(Ds.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),Ce.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen()){Ce.log("Cannot send heartbeat, because socket closed");return}const e=JSON.stringify({type:yn.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&this._socket.readyState===1}_sendQueuedMessages(){const e=[...this._messagesQueue];this._messagesQueue=[];for(const n of e)this.send(n)}send(e){if(this._disconnected)return;if(!this._id){this._messagesQueue.push(e);return}if(!e.type){this.emit(Ds.Error,"Invalid message");return}if(!this._wsOpen())return;const n=JSON.stringify(e);this._socket.send(n)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}class YS{constructor(e){this.connection=e}startConnection(e){const n=this._startPeerConnection();if(this.connection.peerConnection=n,this.connection.type===Ks.Media&&e._stream&&this._addTracksToConnection(e._stream,n),e.originator){const r=this.connection,s={ordered:!!e.reliable},i=n.createDataChannel(r.label,s);r._initializeDataChannel(i),this._makeOffer()}else this.handleSDP("OFFER",e.sdp)}_startPeerConnection(){Ce.log("Creating RTCPeerConnection.");const e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e}_setupListeners(e){const n=this.connection.peer,r=this.connection.connectionId,s=this.connection.type,i=this.connection.provider;Ce.log("Listening for ICE candidates."),e.onicecandidate=o=>{!o.candidate||!o.candidate.candidate||(Ce.log(`Received ICE candidates for ${n}:`,o.candidate),i.socket.send({type:yn.Candidate,payload:{candidate:o.candidate,type:s,connectionId:r},dst:n}))},e.oniceconnectionstatechange=()=>{switch(e.iceConnectionState){case"failed":Ce.log("iceConnectionState is failed, closing connections to "+n),this.connection.emitError(Kp.NegotiationFailed,"Negotiation of connection to "+n+" failed."),this.connection.close();break;case"closed":Ce.log("iceConnectionState is closed, closing connections to "+n),this.connection.emitError(Kp.ConnectionClosed,"Connection to "+n+" closed."),this.connection.close();break;case"disconnected":Ce.log("iceConnectionState changed to disconnected on the connection with "+n);break;case"completed":e.onicecandidate=()=>{};break}this.connection.emit("iceStateChanged",e.iceConnectionState)},Ce.log("Listening for data channel"),e.ondatachannel=o=>{Ce.log("Received data channel");const l=o.channel;i.getConnection(n,r)._initializeDataChannel(l)},Ce.log("Listening for remote stream"),e.ontrack=o=>{Ce.log("Received remote stream");const l=o.streams[0],c=i.getConnection(n,r);if(c.type===Ks.Media){const d=c;this._addStreamToMediaConnection(l,d)}}}cleanup(){Ce.log("Cleaning up PeerConnection to "+this.connection.peer);const e=this.connection.peerConnection;if(!e)return;this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=()=>{};const n=e.signalingState!=="closed";let r=!1;const s=this.connection.dataChannel;s&&(r=!!s.readyState&&s.readyState!=="closed"),(n||r)&&e.close()}async _makeOffer(){const e=this.connection.peerConnection,n=this.connection.provider;try{const r=await e.createOffer(this.connection.options.constraints);Ce.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),Ce.log("Set localDescription:",r,`for:${this.connection.peer}`);let s={sdp:r,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===Ks.Data){const i=this.connection;s={...s,label:i.label,reliable:i.reliable,serialization:i.serialization}}n.socket.send({type:yn.Offer,payload:s,dst:this.connection.peer})}catch(s){s!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(n.emitError(Gt.WebRTC,s),Ce.log("Failed to setLocalDescription, ",s))}}catch(r){n.emitError(Gt.WebRTC,r),Ce.log("Failed to createOffer, ",r)}}async _makeAnswer(){const e=this.connection.peerConnection,n=this.connection.provider;try{const r=await e.createAnswer();Ce.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),Ce.log("Set localDescription:",r,`for:${this.connection.peer}`),n.socket.send({type:yn.Answer,payload:{sdp:r,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(s){n.emitError(Gt.WebRTC,s),Ce.log("Failed to setLocalDescription, ",s)}}catch(r){n.emitError(Gt.WebRTC,r),Ce.log("Failed to create answer, ",r)}}async handleSDP(e,n){n=new RTCSessionDescription(n);const r=this.connection.peerConnection,s=this.connection.provider;Ce.log("Setting remote description",n);const i=this;try{await r.setRemoteDescription(n),Ce.log(`Set remoteDescription:${e} for:${this.connection.peer}`),e==="OFFER"&&await i._makeAnswer()}catch(o){s.emitError(Gt.WebRTC,o),Ce.log("Failed to setRemoteDescription, ",o)}}async handleCandidate(e){Ce.log("handleCandidate:",e);try{await this.connection.peerConnection.addIceCandidate(e),Ce.log(`Added ICE candidate for:${this.connection.peer}`)}catch(n){this.connection.provider.emitError(Gt.WebRTC,n),Ce.log("Failed to handleCandidate, ",n)}}_addTracksToConnection(e,n){if(Ce.log(`add tracks from stream ${e.id} to peer connection`),!n.addTrack)return Ce.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(r=>{n.addTrack(r,e)})}_addStreamToMediaConnection(e,n){Ce.log(`add stream ${e.id} to media connection ${n.connectionId}`),n.addStream(e)}}class KS extends V0.EventEmitter{emitError(e,n){Ce.error("Error:",n),this.emit("error",new gL(`${e}`,n))}}class gL extends Error{constructor(e,n){typeof n=="string"?super(n):(super(),Object.assign(this,n)),this.type=e}}class XS extends KS{get open(){return this._open}constructor(e,n,r){super(),this.peer=e,this.provider=n,this.options=r,this._open=!1,this.metadata=r.metadata}}var Jp;const il=class il extends XS{get type(){return Ks.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(e,n,r){super(e,n,r),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||il.ID_PREFIX+Ln.randomToken(),this._negotiator=new YS(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{Ce.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{Ce.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(e){Ce.log("Receiving stream",e),this._remoteStream=e,super.emit("stream",e)}handleMessage(e){const n=e.type,r=e.payload;switch(e.type){case yn.Answer:this._negotiator.handleSDP(n,r.sdp),this._open=!0;break;case yn.Candidate:this._negotiator.handleCandidate(r.candidate);break;default:Ce.warn(`Unrecognized message type:${n} from peer:${this.peer}`);break}}answer(e,n={}){if(this._localStream){Ce.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=e,n&&n.sdpTransform&&(this.options.sdpTransform=n.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:e});const r=this.provider._getMessages(this.connectionId);for(const s of r)this.handleMessage(s);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit("close"))}};Jp=new WeakMap,_a(il,Jp,il.ID_PREFIX="mc_");let vu=il;class mL{constructor(e){this._options=e}_buildRequest(e){const n=this._options.secure?"https":"http",{host:r,port:s,path:i,key:o}=this._options,l=new URL(`${n}://${r}:${s}${i}${o}/${e}`);return l.searchParams.set("ts",`${Date.now()}${Math.random()}`),l.searchParams.set("version",VS),fetch(l.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{const e=await this._buildRequest("id");if(e.status!==200)throw new Error(`Error. Status:${e.status}`);return e.text()}catch(e){Ce.error("Error retrieving ID",e);let n="";throw this._options.path==="/"&&this._options.host!==Ln.CLOUD_HOST&&(n=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+n)}}async listAllPeers(){try{const e=await this._buildRequest("peers");if(e.status!==200){if(e.status===401){let n="";throw this._options.host===Ln.CLOUD_HOST?n="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":n="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+n)}throw new Error(`Error. Status:${e.status}`)}return e.json()}catch(e){throw Ce.error("Error retrieving list peers",e),new Error("Could not get list peers from the server."+e)}}}var qp,Zp;const yi=class yi extends XS{get type(){return Ks.Data}constructor(e,n,r){super(e,n,r),this.connectionId=this.options.connectionId||yi.ID_PREFIX+WS(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new YS(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{Ce.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=n=>{Ce.log(`DC#${this.connectionId} dc onmessage:`,n.data)},this.dataChannel.onclose=()=>{Ce.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(e){if(e!=null&&e.flush){this.send({__peerData:{type:"close"}});return}this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null),this.open&&(this._open=!1,super.emit("close"))}send(e,n=!1){if(!this.open){this.emitError(Y0.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.");return}return this._send(e,n)}async handleMessage(e){const n=e.payload;switch(e.type){case yn.Answer:await this._negotiator.handleSDP(e.type,n.sdp);break;case yn.Candidate:await this._negotiator.handleCandidate(n.candidate);break;default:Ce.warn("Unrecognized message type:",e.type,"from peer:",this.peer);break}}};qp=new WeakMap,Zp=new WeakMap,_a(yi,qp,yi.ID_PREFIX="dc_"),_a(yi,Zp,yi.MAX_BUFFERED_AMOUNT=8388608);let _u=yi;class K0 extends _u{get bufferSize(){return this._bufferSize}_initializeDataChannel(e){super._initializeDataChannel(e),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",n=>this._handleDataMessage(n))}_bufferedSend(e){(this._buffering||!this._trySend(e))&&(this._buffer.push(e),this._bufferSize=this._buffer.length)}_trySend(e){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>_u.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(e)}catch(n){return Ce.error(`DC#:${this.connectionId} Error when sending:`,n),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open||this._buffer.length===0)return;const e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(e){if(e!=null&&e.flush){this.send({__peerData:{type:"close"}});return}this._buffer=[],this._bufferSize=0,super.close()}constructor(...e){super(...e),this._buffer=[],this._bufferSize=0,this._buffering=!1}}class wh extends K0{close(e){super.close(e),this._chunkedData={}}constructor(e,n,r){super(e,n,r),this.chunker=new HS,this.serialization=nf.Binary,this._chunkedData={}}_handleDataMessage({data:e}){const n=lS(e),r=n.__peerData;if(r){if(r.type==="close"){this.close();return}this._handleChunk(n);return}this.emit("data",n)}_handleChunk(e){const n=e.__peerData,r=this._chunkedData[n]||{data:[],count:0,total:e.total};if(r.data[e.n]=new Uint8Array(e.data),r.count++,this._chunkedData[n]=r,r.total===r.count){delete this._chunkedData[n];const s=aL(r.data);this._handleDataMessage({data:s})}}_send(e,n){const r=cS(e);if(r instanceof Promise)return this._send_blob(r);if(!n&&r.byteLength>this.chunker.chunkedMTU){this._sendChunks(r);return}this._bufferedSend(r)}async _send_blob(e){const n=await e;if(n.byteLength>this.chunker.chunkedMTU){this._sendChunks(n);return}this._bufferedSend(n)}_sendChunks(e){const n=this.chunker.chunk(e);Ce.log(`DC#${this.connectionId} Try to send ${n.length} chunks...`);for(const r of n)this.send(r,!0)}}class yL extends K0{_handleDataMessage({data:e}){super.emit("data",e)}_send(e,n){this._bufferedSend(e)}constructor(...e){super(...e),this.serialization=nf.None}}class vL extends K0{_handleDataMessage({data:e}){const n=this.parse(this.decoder.decode(e)),r=n.__peerData;if(r&&r.type==="close"){this.close();return}this.emit("data",n)}_send(e,n){const r=this.encoder.encode(this.stringify(e));if(r.byteLength>=Ln.chunkedMTU){this.emitError(Y0.MessageToBig,"Message too big for JSON channel");return}this._bufferedSend(r)}constructor(...e){super(...e),this.serialization=nf.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}var eg;const ol=class ol extends KS{get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){const e=Object.create(null);for(const[n,r]of this._connections)e[n]=r;return e}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(e,n){super(),this._serializers={raw:yL,json:vL,binary:wh,"binary-utf8":wh,default:wh},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map;let r;if(e&&e.constructor==Object?n=e:e&&(r=e.toString()),n={debug:0,host:Ln.CLOUD_HOST,port:Ln.CLOUD_PORT,path:"/",key:ol.DEFAULT_KEY,token:Ln.randomToken(),config:Ln.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...n},this._options=n,this._serializers={...this._serializers,...this.options.serializers},this._options.host==="/"&&(this._options.host=window.location.hostname),this._options.path&&(this._options.path[0]!=="/"&&(this._options.path="/"+this._options.path),this._options.path[this._options.path.length-1]!=="/"&&(this._options.path+="/")),this._options.secure===void 0&&this._options.host!==Ln.CLOUD_HOST?this._options.secure=Ln.isSecure():this._options.host==Ln.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&Ce.setLogFunction(this._options.logFunction),Ce.logLevel=this._options.debug||0,this._api=new mL(n),this._socket=this._createServerConnection(),!Ln.supports.audioVideo&&!Ln.supports.data){this._delayedAbort(Gt.BrowserIncompatible,"The current browser does not support WebRTC");return}if(r&&!Ln.validateId(r)){this._delayedAbort(Gt.InvalidID,`ID "${r}" is invalid`);return}r?this._initialize(r):this._api.retrieveId().then(s=>this._initialize(s)).catch(s=>this._abort(Gt.ServerError,s))}_createServerConnection(){const e=new pL(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return e.on(Ds.Message,n=>{this._handleMessage(n)}),e.on(Ds.Error,n=>{this._abort(Gt.SocketError,n)}),e.on(Ds.Disconnected,()=>{this.disconnected||(this.emitError(Gt.Network,"Lost connection to server."),this.disconnect())}),e.on(Ds.Close,()=>{this.disconnected||this._abort(Gt.SocketClosed,"Underlying socket is already closed.")}),e}_initialize(e){this._id=e,this.socket.start(e,this._options.token)}_handleMessage(e){const n=e.type,r=e.payload,s=e.src;switch(n){case yn.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case yn.Error:this._abort(Gt.ServerError,r.msg);break;case yn.IdTaken:this._abort(Gt.UnavailableID,`ID "${this.id}" is taken`);break;case yn.InvalidKey:this._abort(Gt.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case yn.Leave:Ce.log(`Received leave message from ${s}`),this._cleanupPeer(s),this._connections.delete(s);break;case yn.Expire:this.emitError(Gt.PeerUnavailable,`Could not connect to peer ${s}`);break;case yn.Offer:{const i=r.connectionId;let o=this.getConnection(s,i);if(o&&(o.close(),Ce.warn(`Offer received for existing Connection ID:${i}`)),r.type===Ks.Media){const c=new vu(s,this,{connectionId:i,_payload:r,metadata:r.metadata});o=c,this._addConnection(s,o),this.emit("call",c)}else if(r.type===Ks.Data){const c=new this._serializers[r.serialization](s,this,{connectionId:i,_payload:r,metadata:r.metadata,label:r.label,serialization:r.serialization,reliable:r.reliable});o=c,this._addConnection(s,o),this.emit("connection",c)}else{Ce.warn(`Received malformed connection type:${r.type}`);return}const l=this._getMessages(i);for(const c of l)o.handleMessage(c);break}default:{if(!r){Ce.warn(`You received a malformed message from ${s} of type ${n}`);return}const i=r.connectionId,o=this.getConnection(s,i);o&&o.peerConnection?o.handleMessage(e):i?this._storeMessage(i,e):Ce.warn("You received an unrecognized message:",e);break}}}_storeMessage(e,n){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(n)}_getMessages(e){const n=this._lostMessages.get(e);return n?(this._lostMessages.delete(e),n):[]}connect(e,n={}){if(n={serialization:"default",...n},this.disconnected){Ce.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(Gt.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}const r=new this._serializers[n.serialization](e,this,n);return this._addConnection(e,r),r}call(e,n,r={}){if(this.disconnected){Ce.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(Gt.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!n){Ce.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}const s=new vu(e,this,{...r,_stream:n});return this._addConnection(e,s),s}_addConnection(e,n){Ce.log(`add connection ${n.type}:${n.connectionId} to peerId:${e}`),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(n)}_removeConnection(e){const n=this._connections.get(e.peer);if(n){const r=n.indexOf(e);r!==-1&&n.splice(r,1)}this._lostMessages.delete(e.connectionId)}getConnection(e,n){const r=this._connections.get(e);if(!r)return null;for(const s of r)if(s.connectionId===n)return s;return null}_delayedAbort(e,n){setTimeout(()=>{this._abort(e,n)},0)}_abort(e,n){Ce.error("Aborting!"),this.emitError(e,n),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||(Ce.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))}_cleanup(){for(const e of this._connections.keys())this._cleanupPeer(e),this._connections.delete(e);this.socket.removeAllListeners()}_cleanupPeer(e){const n=this._connections.get(e);if(n)for(const r of n)r.close()}disconnect(){if(this.disconnected)return;const e=this.id;Ce.log(`Disconnect peer with ID:${e}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit("disconnected",e)}reconnect(){if(this.disconnected&&!this.destroyed)Ce.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)Ce.error("In a hurry? We're still trying to make the initial connection!");else throw new Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`)}}listAllPeers(e=n=>{}){this._api.listAllPeers().then(n=>e(n)).catch(n=>this._abort(Gt.ServerError,n))}};eg=new WeakMap,_a(ol,eg,ol.DEFAULT_KEY="peerjs");let Xp=ol;var QS=Xp;class JS{constructor(){ln(this,"peer",null);ln(this,"conn",null);ln(this,"isHost",!1);ln(this,"messageCallback",null);ln(this,"connectionCallback",null);ln(this,"closeCallback",null)}async connect(e){return this.peer=new QS,new Promise((n,r)=>{if(!this.peer)return r("Peer not initialized");this.peer.on("open",s=>{console.log("My Peer ID is:",s),e?(this.isHost=!1,this.connectToPeer(e),n(s)):(this.isHost=!0,this.peer.on("connection",i=>{console.log("Incoming connection..."),this.setupConnection(i)}),n(s))}),this.peer.on("error",s=>{console.error(s),r(s)})})}connectToPeer(e){if(!this.peer)return;const n=this.peer.connect(e);this.setupConnection(n)}setupConnection(e){this.conn=e,e.on("open",()=>{console.log("Connection established!"),this.connectionCallback&&this.connectionCallback()}),e.on("data",n=>{this.messageCallback&&this.messageCallback(n)}),e.on("close",()=>{console.log("Connection closed"),this.closeCallback&&this.closeCallback()}),e.on("error",n=>console.error("Connection Error:",n))}onConnection(e){this.connectionCallback=e}onClose(e){this.closeCallback=e}isConnected(){return this.conn!==null&&this.conn.open}send(e){this.conn&&this.conn.open?this.conn.send(e):console.warn("Connection not open, cannot send message")}onMessage(e){this.messageCallback=e}disconnect(){var e,n;(e=this.conn)==null||e.close(),(n=this.peer)==null||n.destroy()}}const _L=({gameMode:t,targetRoomId:e,playerClass:n,onGameStart:r,onBack:s})=>{const[i,o]=L.useState(""),[l,c]=L.useState(!1),[d,u]=L.useState(!0),[h,f]=L.useState(null),[E,k]=L.useState(!1),[w,$]=L.useState(null),[v,_]=L.useState(!1),S=L.useRef(null);L.useEffect(()=>{const H=new JS;return S.current=H,(async()=>{try{const V=await H.connect(t==="JOIN"?e:void 0);o(V),u(!1),H.onMessage(ee=>{console.log("[LobbyScreen] Received message:",ee),ee.type==="CLASS_INFO"&&(console.log("[LobbyScreen] Received opponent class:",ee.playerClass),$(ee.playerClass))}),H.onConnection(()=>{console.log("[LobbyScreen] Connection established!"),c(!0)})}catch(V){console.error("[LobbyScreen] Connection error:",V),f(V.toString()),u(!1)}})(),()=>{var V;(V=S.current)!=null&&V.isConnected()||H.disconnect()}},[t,e]),L.useEffect(()=>{l&&S.current&&!v&&(console.log("[LobbyScreen] Sending class info:",n),setTimeout(()=>{var H;(H=S.current)==null||H.send({type:"CLASS_INFO",playerClass:n}),_(!0)},100))},[l,n,v]),L.useEffect(()=>{if(l&&S.current&&w){const H=setTimeout(()=>{console.log("[LobbyScreen] Starting game with opponent class:",w),r(S.current,w)},500);return()=>clearTimeout(H)}},[l,r,w]);const p=async()=>{if(i)try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(i);else{const H=document.createElement("textarea");H.value=i,H.style.position="fixed",H.style.left="-999999px",H.style.top="-999999px",document.body.appendChild(H),H.focus(),H.select(),document.execCommand("copy"),document.body.removeChild(H)}k(!0),setTimeout(()=>k(!1),2e3)}catch(H){console.error("Failed to copy:",H),alert(`Room ID: ${i}

()`)}},D=()=>{S.current&&(S.current.disconnect(),S.current=null),s()};return a.jsxs("div",{className:"screen lobby-screen",style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",gap:"2rem"},children:[a.jsx("h1",{style:{fontSize:"2.5rem",marginBottom:"1rem",textShadow:"0 0 10px #e94560",fontFamily:"Tamanegi, sans-serif",letterSpacing:"2px"},children:t==="HOST"?"":"..."}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1.5rem",padding:"2rem",background:"rgba(0,0,0,0.3)",borderRadius:"10px",minWidth:"400px"},children:[h&&a.jsxs("div",{style:{color:"#ff6b6b",fontSize:"1.2rem",textAlign:"center",fontFamily:"Tamanegi, sans-serif"},children:[a.jsx("p",{children:""}),a.jsx("p",{style:{fontSize:"0.9rem",opacity:.7},children:h})]}),d&&!h&&a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1rem"},children:[a.jsx("div",{className:"loading-spinner",style:{width:"50px",height:"50px",border:"4px solid rgba(233, 69, 96, 0.3)",borderTop:"4px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),a.jsx("p",{style:{opacity:.8,fontFamily:"Tamanegi, sans-serif"},children:t==="HOST"?"...":"..."})]}),t==="HOST"&&i&&!d&&!l&&!h&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.5rem"},children:[a.jsx("p",{style:{fontSize:"1rem",opacity:.7,fontFamily:"Tamanegi, sans-serif"},children:"ID:"}),a.jsx("div",{style:{fontSize:"2rem",fontFamily:"monospace",fontWeight:"bold",padding:"0.5rem 1rem",background:"rgba(233, 69, 96, 0.2)",borderRadius:"8px",border:"1px solid #e94560",letterSpacing:"2px"},children:i})]}),a.jsx("button",{onClick:p,style:{fontSize:"1rem",padding:"0.8rem 2rem",background:E?"#48bb78":"transparent",border:"2px solid "+(E?"#48bb78":"#e94560"),color:"#fff",cursor:"pointer",transition:"all 0.3s",borderRadius:"4px",fontWeight:"bold",fontFamily:"Tamanegi, sans-serif"},children:E?" ":"ID"}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginTop:"1rem",opacity:.7},children:[a.jsx("div",{className:"loading-spinner",style:{width:"20px",height:"20px",border:"2px solid rgba(233, 69, 96, 0.3)",borderTop:"2px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),a.jsx("span",{style:{fontFamily:"Tamanegi, sans-serif"},children:"..."})]})]}),t==="JOIN"&&!d&&!l&&!h&&a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[a.jsx("div",{className:"loading-spinner",style:{width:"20px",height:"20px",border:"2px solid rgba(233, 69, 96, 0.3)",borderTop:"2px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),a.jsxs("span",{style:{fontFamily:"Tamanegi, sans-serif"},children:[" ",e," ..."]})]}),l&&a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1rem"},children:[a.jsx("p",{style:{fontSize:"1.5rem",color:"#48bb78",fontFamily:"Tamanegi, sans-serif"},children:" "}),a.jsx("p",{style:{fontFamily:"Tamanegi, sans-serif"},children:"..."})]}),a.jsxs("div",{style:{marginTop:"1rem",padding:"0.5rem 1rem",background:"rgba(255,255,255,0.1)",borderRadius:"4px",fontSize:"0.9rem",opacity:.7,fontFamily:"Tamanegi, sans-serif"},children:[": ",n==="SENKA"?"":n==="AJA"?"":"yoRuka"]})]}),a.jsx("button",{onClick:D,style:{fontSize:"1rem",padding:"0.8rem 2rem",background:"transparent",border:"1px solid #888",color:"#888",cursor:"pointer",transition:"all 0.3s",borderRadius:"4px",marginTop:"1rem",fontFamily:"Tamanegi, sans-serif"},onMouseOver:H=>{H.currentTarget.style.color="#fff",H.currentTarget.style.borderColor="#fff"},onMouseOut:H=>{H.currentTarget.style.color="#888",H.currentTarget.style.borderColor="#888"},children:" "}),a.jsx("style",{children:`
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `})]})};class xL{constructor(){ln(this,"myEntryRef",null);ln(this,"listenerUnsubscribe",null);ln(this,"myId","");ln(this,"myPeerId","");ln(this,"hasMatched",!1)}async startMatchmaking(e,n,r,s,i,o,l,c){this.myPeerId=e,this.hasMatched=!1;const d=Lr(Dr,`matchmaking/${s}`);try{const u=await Ju(d),h=[];if(u.exists()&&u.forEach(w=>{const $=w.val(),v=Date.now()-$.timestamp<5*60*1e3;$.peerId!==e&&v&&h.push({key:w.key,data:$})}),h.length>0){const w=h.sort(($,v)=>$.data.timestamp-v.data.timestamp)[0];await Vc(Lr(Dr,`matchmaking/${s}/${w.key}`)),i("matched"),o({peerId:w.data.peerId,playerName:w.data.playerName,playerClass:w.data.playerClass,isHost:!1,playerId:w.data.playerId,rating:w.data.rating});return}i("searching");const f=rA(d);this.myEntryRef=f,this.myId=f.key;const E={id:this.myId,peerId:e,playerName:n,playerClass:r,matchType:s,...l!=null&&{playerId:l},...c!=null&&{rating:c},timestamp:Date.now()};await Qu(f,E),nA(f).remove();const k=s;this.listenerUnsubscribe=IE(d,async w=>{if(this.hasMatched||!w.exists())return;let $=!1,v=null;if(w.forEach(_=>{const S=_.val();_.key===this.myId?$=!0:S.peerId!==this.myPeerId&&(!v||S.timestamp>v.data.timestamp)&&(v={key:_.key,data:S})}),!$&&this.myEntryRef){if(this.hasMatched)return;this.hasMatched=!0,i("matched"),this.cleanup();return}if(v!==null&&$){const _=w.child(this.myId).val(),S=v;if(_&&_.timestamp<S.data.timestamp){if(this.hasMatched)return;this.hasMatched=!0,await Vc(Lr(Dr,`matchmaking/${k}/${S.key}`)),await Vc(Lr(Dr,`matchmaking/${k}/${this.myId}`)),this.cleanup(),i("matched"),o({peerId:S.data.peerId,playerName:S.data.playerName,playerClass:S.data.playerClass,isHost:!0,playerId:S.data.playerId,rating:S.data.rating})}}})}catch(u){console.error("[Matchmaking] Error:",u),i("error"),this.cleanup()}}async cancelMatchmaking(){if(this.myEntryRef)try{await Vc(this.myEntryRef)}catch(e){console.error("[Matchmaking] Error removing entry:",e)}this.cleanup()}cleanup(){this.listenerUnsubscribe&&(this.listenerUnsubscribe(),this.listenerUnsubscribe=null),this.myEntryRef=null,this.myId=""}}const Xc=new xL;class x_{constructor(e,n,r=!1){ln(this,"peer");ln(this,"conn");ln(this,"isHost",!1);ln(this,"messageCallback",null);ln(this,"closeCallback",null);this.peer=e,this.conn=n,this.isHost=r,n.on("data",s=>{this.messageCallback&&this.messageCallback(s)}),n.on("close",()=>{console.log("[PeerJSAdapter] Connection closed"),this.closeCallback&&this.closeCallback()}),n.on("error",s=>console.error("[PeerJSAdapter] Connection Error:",s))}async connect(e){return this.peer.id}onConnection(e){}onClose(e){this.closeCallback=e}isConnected(){return this.conn!==null&&this.conn.open}send(e){this.conn&&this.conn.open?this.conn.send(e):console.warn("[PeerJSAdapter] Connection not open, cannot send message")}onMessage(e){this.messageCallback=e}disconnect(){var e,n;(e=this.conn)==null||e.close(),(n=this.peer)==null||n.destroy()}}const bL=1280,EL=720,b_={BRONZE:"#cd7f32",SILVER:"#c0c0c0",GOLD:"#ffd700",PLATINUM:"#e5e4e2",DIAMOND:"#b9f2ff",MASTER:"#ff4500"},SL=({matchType:t,playerClass:e,playerName:n,playerId:r,onGameStart:s,onCancel:i})=>{const[o,l]=L.useState("idle"),[c,d]=L.useState("..."),[u,h]=L.useState(0),f=L.useRef(null),E=L.useRef(null),k=L.useRef(null),w=L.useRef(!1),$=L.useRef(!1),[v,_]=L.useState(0),[S,p]=L.useState(void 0),[D,H]=L.useState(1);L.useEffect(()=>{const ee=()=>{const de=window.innerWidth/bL,ve=window.innerHeight/EL;H(Math.min(de,ve))};return ee(),window.addEventListener("resize",ee),()=>window.removeEventListener("resize",ee)},[]),L.useEffect(()=>{if(o!=="searching")return;const ee=setInterval(()=>{h(de=>{const ve=de+1;return ve>=60&&(l("error"),d(""),Xc.cancelMatchmaking(),E.current&&E.current.close(),f.current&&f.current.destroy()),ve})},1e3);return()=>clearInterval(ee)},[o]),L.useEffect(()=>{let ee=!0,de=0;return(async()=>{try{if(t==="ranked"&&r)try{de=(await aS(r,e)).rating,_(de)}catch(I){console.error("[Matchmaking] Failed to get rating:",I)}const je=new QS({debug:1,config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]}});if(f.current=je,await new Promise((I,O)=>{je.on("open",()=>I()),je.on("error",C=>O(C))}),!ee)return;const ue=je.id;console.log("[Matchmaking] My PeerJS ID:",ue),je.on("connection",I=>{console.log("[Matchmaking] Incoming connection from:",I.peer),E.current=I,I.on("open",()=>{console.log("[Matchmaking] Connection opened (as HOST)"),I.on("data",O=>{if(O.type==="PLAYER_INFO"){console.log("[Matchmaking] Received player info:",O),I.send({type:"PLAYER_INFO",playerName:n,playerClass:e,playerId:t==="ranked"?r:void 0,rating:t==="ranked"?de:void 0}),ee&&t==="ranked"&&p(O.rating),$.current=!0;const C=new x_(je,I,!0);s(C,O.playerClass,!0,O.playerId,O.rating)}})})}),Xc.startMatchmaking(ue,n,e,t,I=>{if(ee)switch(l(I),I){case"searching":d("...");break;case"matched":d("...");break;case"error":d("");break}},async I=>{if(ee)if(console.log("[Matchmaking] Match found:",I),k.current=I,w.current=I.isHost,I.isHost)d("...");else{d("...");const O=je.connect(I.peerId,{reliable:!0});E.current=O,O.on("open",()=>{console.log("[Matchmaking] Connection opened (as JOIN)"),O.send({type:"PLAYER_INFO",playerName:n,playerClass:e,playerId:t==="ranked"?r:void 0,rating:t==="ranked"?de:void 0}),O.on("data",C=>{if(C.type==="PLAYER_INFO"){console.log("[Matchmaking] Received player info:",C),ee&&t==="ranked"&&p(C.rating),$.current=!0;const R=new x_(je,O,!1);s(R,C.playerClass,!1,C.playerId,C.rating)}})}),O.on("error",C=>{console.error("[Matchmaking] Connection error:",C),l("error"),d("")})}},t==="ranked"&&r?r:void 0,t==="ranked"?de:void 0)}catch(je){console.error("[Matchmaking] Init error:",je),ee&&(l("error"),d(""))}})(),()=>{ee=!1,Xc.cancelMatchmaking(),$.current||(E.current&&E.current.close(),f.current&&f.current.destroy())}},[t,e,n,r,s]);const ne=async()=>{await Xc.cancelMatchmaking(),E.current&&E.current.close(),f.current&&f.current.destroy(),i()},V=ee=>{const de=Math.floor(ee/60),ve=ee%60;return`${de}:${ve.toString().padStart(2,"0")}`};return a.jsxs("div",{className:"screen",style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white"},children:[a.jsx("div",{style:{fontSize:`${1.2*D}rem`,color:"#4ade80",marginBottom:`${1*D}rem`,fontWeight:"bold"},children:t==="casual"?"":""}),a.jsx("div",{style:{fontSize:`${2*D}rem`,fontWeight:"bold",marginBottom:`${1*D}rem`,textAlign:"center"},children:c}),o==="searching"&&a.jsxs("div",{style:{fontSize:`${1.5*D}rem`,color:"#888",marginBottom:`${2*D}rem`},children:[": ",V(u)]}),(o==="searching"||o==="matched")&&a.jsx("div",{style:{width:80*D,height:80*D,border:"4px solid rgba(255,255,255,0.2)",borderTop:"4px solid #4ade80",borderRadius:"50%",animation:"spin 1s linear infinite",marginBottom:`${2*D}rem`}}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*D}rem`,marginBottom:`${2*D}rem`,padding:`${1*D}rem`,background:"rgba(255,255,255,0.1)",borderRadius:8*D},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:`${1*D}rem`},children:[a.jsx("div",{style:{fontSize:`${1*D}rem`},children:n||""}),a.jsx("div",{style:{fontSize:`${.9*D}rem`,color:e==="SENKA"?"#e94560":e==="AJA"?"#45a2e9":"#a855f7"},children:e==="SENKA"?"":e==="AJA"?"":"Y"})]}),t==="ranked"&&v>0&&a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:`${.5*D}rem`,fontSize:`${.85*D}rem`,color:"#aaa"},children:[a.jsx("span",{style:{fontWeight:"bold",color:b_[Mr(v)],fontFamily:"Tamanegi, sans-serif"},children:Po[Mr(v)]}),a.jsx("span",{style:{fontFamily:"Tamanegi, sans-serif"},children:v})]}),t==="ranked"&&o==="matched"&&S!==void 0&&a.jsxs("div",{style:{marginTop:`${.5*D}rem`,padding:`${.5*D}rem ${1*D}rem`,background:"rgba(0, 0, 0, 0.3)",borderRadius:4*D,fontSize:`${.8*D}rem`,color:"#aaa"},children:[": ",a.jsx("span",{style:{fontWeight:"bold",color:b_[Mr(S)],fontFamily:"Tamanegi, sans-serif"},children:Po[Mr(S)]})," ",S]})]}),o!=="error"&&a.jsx("button",{onClick:ne,style:{padding:`${.8*D}rem ${2*D}rem`,fontSize:`${1*D}rem`,background:"transparent",border:"2px solid #e94560",color:"#e94560",borderRadius:8*D,cursor:"pointer",transition:"all 0.2s"},onMouseOver:ee=>{ee.currentTarget.style.background="#e94560",ee.currentTarget.style.color="white"},onMouseOut:ee=>{ee.currentTarget.style.background="transparent",ee.currentTarget.style.color="#e94560"},children:""}),o==="error"&&a.jsx("button",{onClick:i,style:{padding:`${.8*D}rem ${2*D}rem`,fontSize:`${1*D}rem`,background:"#e94560",border:"none",color:"white",borderRadius:8*D,cursor:"pointer"},children:""}),a.jsx("style",{children:`
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `})]})},E_=20,X0=[{id:1,filename:"1_yoroshiku.png",label:"",se:"pa.mp3"},{id:2,filename:"2_nandato.png",label:"",se:"shock.mp3"},{id:3,filename:"3_thank.png",label:"",se:"thanks.mp3"},{id:4,filename:"4_willwin.png",label:"",se:"nt.mp3"},{id:5,filename:"5_dontmind.png",label:"",se:"boyon.mp3"},{id:6,filename:"6_thinking.png",label:"",se:"thinking.mp3"},{id:7,filename:"7_gg.png",label:"GG",se:"kiri.mp3"},{id:8,filename:"8_sorry.png",label:"",se:"gomen.mp3"}],S_=(t,e)=>{const n=X0.find(s=>s.id===t);return n?`/stamps/${e==="AJA"?"azya":e.toLowerCase()}/${n.filename}`:""},I_=t=>{const e=X0.find(n=>n.id===t);return(e==null?void 0:e.se)||null},tr=[{id:"s_3cats",name:"",cost:2,type:"SPELL",description:"1",flavorText:"",imageUrl:"/cards/chatora_three_cats.png",triggers:[{trigger:"FANFARE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_CHATORA"},{type:"GENERATE_CARD",targetCardId:"TOKEN_SABATORA"},{type:"GENERATE_CARD",targetCardId:"TOKEN_KIJITORA"}]}]},{id:"s_final_cannon",name:"",cost:10,type:"SPELL",description:"1",flavorText:'""""',imageUrl:"/cards/final_cannon.png",triggers:[{trigger:"FANFARE",effects:[{type:"SET_MAX_HP",value:1,targetType:"OPPONENT"}]}]},{id:"c_senka_knuckler",name:"",cost:8,type:"FOLLOWER",attack:3,health:5,description:`[] []
2
[]
1`,flavorText:`

`,imageUrl:"/cards/senka.png",evolvedImageUrl:"/cards/senka_2.png",tags:["Knuckler"],passiveAbilities:["STORM","DOUBLE_ATTACK"],attackEffectType:"IMPACT",triggers:[{trigger:"SUPER_EVOLVE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_FLICKER_JAB"},{type:"GENERATE_CARD",targetCardId:"TOKEN_QUAKE_HOWLING"},{type:"GENERATE_CARD",targetCardId:"TOKEN_BACKHAND_SMASH"}]}]},{id:"c_ruiyu",name:"",cost:7,type:"FOLLOWER",attack:5,health:5,description:`4cyoriena
14`,flavorText:`
`,imageUrl:"/cards/ruiyu.png",evolvedImageUrl:"/cards/ruiyu_2.png",attackEffectType:"BLUE_FIRE",relatedCards:["c_cyoriena"],triggers:[{trigger:"FANFARE",effects:[{type:"HEAL_LEADER",value:4,targetType:"SELF"},{type:"SUMMON_CARD",targetCardId:"c_cyoriena"}]},{trigger:"EVOLVE",effects:[{type:"DESTROY",targetType:"SELECT_FOLLOWER"},{type:"HEAL_LEADER",value:4,targetType:"SELF"}]}]},{id:"c_y",name:"Y",cost:6,type:"FOLLOWER",attack:3,health:3,description:`[]
142
3`,flavorText:"",imageUrl:"/cards/y.png",evolvedImageUrl:"/cards/y_2.png",passiveAbilities:["STEALTH"],attackEffectType:"SUMI",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:4,targetType:"SELECT_FOLLOWER"},{type:"AOE_DAMAGE",value:2,targetType:"ALL_FOLLOWERS"}]},{trigger:"EVOLVE",effects:[{type:"AOE_DAMAGE",value:3,targetType:"ALL_FOLLOWERS"}]}]},{id:"c_tsubumaru",name:"",cost:2,type:"FOLLOWER",attack:1,health:3,description:`[]
1
1`,flavorText:`

`,imageUrl:"/cards/tsubumaru.png",evolvedImageUrl:"/cards/tsubumaru_2.png",passiveAbilities:["WARD"],attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"GENERATE_CARD",targetCardId:"s_resignation_proxy"}]}]},{id:"c_barura",name:"",cost:4,type:"FOLLOWER",attack:3,health:4,description:`1
13`,flavorText:`

`,imageUrl:"/cards/barura.png",evolvedImageUrl:"/cards/barura_2.png",attackEffectType:"FIRE",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:3,targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_CHATORA",name:"",cost:0,type:"FOLLOWER",attack:1,health:1,description:"",flavorText:"",imageUrl:"/cards/chatora.png",attackEffectType:"SLASH"},{id:"TOKEN_SABATORA",name:"",cost:1,type:"FOLLOWER",attack:1,health:2,description:"[]",flavorText:"",passiveAbilities:["RUSH"],imageUrl:"/cards/sabatora.png",attackEffectType:"SLASH"},{id:"TOKEN_KIJITORA",name:"",cost:3,type:"FOLLOWER",attack:2,health:3,description:"[]",flavorText:"",passiveAbilities:["WARD"],imageUrl:"/cards/kijitora.png",attackEffectType:"SLASH"},{id:"TOKEN_RICE",name:"",cost:0,type:"SPELL",description:"1",flavorText:" ",imageUrl:"/cards/rice.png",triggers:[{trigger:"FANFARE",effects:[{type:"HEAL_LEADER",value:1,targetType:"SELF"}]}]},{id:"c_yunagi",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:`1
11`,flavorText:`


`,imageUrl:"/cards/yunagi.png",evolvedImageUrl:"/cards/yunagi_2.png",attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:1,targetType:"SELECT_FOLLOWER"},{type:"GENERATE_CARD",targetCardId:"TOKEN_OOMORI_RICE"}]}]},{id:"TOKEN_OOMORI_RICE",name:"",cost:1,type:"SPELL",description:"3",flavorText:"",imageUrl:"/cards/oomoririce.png",tags:["Token"],triggers:[{trigger:"FANFARE",effects:[{type:"HEAL_LEADER",value:3,targetType:"SELF"}]}]},{id:"c_nayuta",name:"",cost:4,type:"FOLLOWER",attack:3,health:3,description:`[]
1
1`,flavorText:"",imageUrl:"/cards/nayuta.png",evolvedImageUrl:"/cards/nayuta_2.png",attackEffectType:"RAY",passiveAbilities:["WARD"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]},{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]}]},{id:"c_yunagi_ward",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:`[]
1`,imageUrl:"/cards/yunagi.png",evolvedImageUrl:"/cards/yunagi_2.png",passiveAbilities:["WARD"],triggers:[{trigger:"FANFARE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_RICE"}]}]},{id:"c_nayuta_ward",name:"",cost:4,type:"FOLLOWER",attack:3,health:3,description:`[]
1
1`,imageUrl:"/cards/nayuta.png",evolvedImageUrl:"/cards/nayuta_2.png",passiveAbilities:["WARD"],attackEffectType:"RAY",triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]},{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]}]},{id:"c_azya",name:"",cost:8,type:"FOLLOWER",attack:4,health:4,description:`[]
3211-2
1+1/+2[][]0`,flavorText:`
&&`,imageUrl:"/cards/azya.png",evolvedImageUrl:"/cards/azya_2.png",attackEffectType:"THUNDER",passiveAbilities:["AURA"],relatedCards:["c_tsubumaru","c_yunagi","c_nayuta"],triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:3,targetType:"OPPONENT"},{type:"HEAL_LEADER",value:2,targetType:"SELF"},{type:"RANDOM_DESTROY",value:1},{type:"RANDOM_BOUNCE",value:1},{type:"REDUCE_HAND_COST",value:2,conditions:{nameIn:["","",""]}}]},{trigger:"SUPER_EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_tsubumaru"},{type:"SUMMON_CARD",targetCardId:"c_yunagi"},{type:"SUMMON_CARD",targetCardId:"c_nayuta"},{type:"BUFF_STATS",value:1,value2:2,targetType:"ALL_OTHER_FOLLOWERS"},{type:"GRANT_PASSIVE",targetPassive:"WARD",targetType:"ALL_OTHER_FOLLOWERS"},{type:"GRANT_PASSIVE",targetPassive:"RUSH",targetType:"ALL_OTHER_FOLLOWERS"},{type:"GENERATE_CARD",targetCardId:"s_yucho_of_the_abyss"},{type:"GENERATE_CARD",targetCardId:"s_thats_mine"},{type:"GRANT_LEADER_DAMAGE_SHIELD"}]}]},{id:"c_yuki",name:"",cost:3,type:"FOLLOWER",attack:3,health:2,description:`[]
+1/+1`,flavorText:"",imageUrl:"/cards/yuki.png",evolvedImageUrl:"/cards/yuki_2.png",tags:["Knuckler"],passiveAbilities:["RUSH"],attackEffectType:"IMPACT",triggers:[{trigger:"EVOLVE",effects:[{type:"BUFF_STATS",value:1,value2:1,targetType:"ALL_FOLLOWERS"}]}]},{id:"c_white_tsubaki",name:"",cost:4,type:"FOLLOWER",attack:4,health:3,description:`[]

01
1`,flavorText:`
`,imageUrl:"/cards/white_tsubaki.png",evolvedImageUrl:"/cards/white_tsubaki_2.png",tags:["Knuckler"],passiveAbilities:["RUSH","IMMUNE_TO_FOLLOWER_DAMAGE","GUTS_MY_TURN"],attackEffectType:"ICE",relatedCards:["c_shieko"],triggers:[{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_shieko"}]}]},{id:"c_shieko",name:"",cost:2,type:"FOLLOWER",attack:2,health:1,description:`[]
1+2/+2`,flavorText:`
`,imageUrl:"/cards/shieko.png",evolvedImageUrl:"/cards/shieko_2.png",tags:["Knuckler"],passiveAbilities:["RUSH"],attackEffectType:"IMPACT",triggers:[{trigger:"EVOLVE",effects:[{type:"BUFF_STATS",value:2,value2:2,targetType:"SELECT_OTHER_ALLY_FOLLOWER"}]}]},{id:"c_urara",name:"",cost:3,type:"FOLLOWER",attack:2,health:2,description:`[] []
2`,flavorText:`
`,imageUrl:"/cards/urara.png",evolvedImageUrl:"/cards/urara_2.png",passiveAbilities:["WARD","BARRIER"],attackEffectType:"WATER",triggers:[{trigger:"EVOLVE",effects:[{type:"HEAL_LEADER",value:2}]}]},{id:"c_kasuga",name:"",cost:10,type:"FOLLOWER",attack:8,health:8,description:"",flavorText:`

`,imageUrl:"/cards/kasuga.png",evolvedImageUrl:"/cards/kasuga_2.png",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY",targetType:"ALL_OTHER_FOLLOWERS"}]}],attackEffectType:"SLASH"},{id:"c_kyokune",name:"",cost:4,type:"FOLLOWER",attack:4,health:4,description:"1",imageUrl:"/cards/kyokune.jpg",relatedCards:["c_sia"],triggers:[{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_sia"}]}],attackEffectType:"SLASH"},{id:"c_sia",name:"",cost:2,type:"FOLLOWER",attack:2,health:1,description:"21",flavorText:"",imageUrl:"/cards/sia.png",evolvedImageUrl:"/cards/sia_2.png",attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DAMAGE",value:1,value2:2,targetType:"OPPONENT"}]}]},{id:"TOKEN_BACKHAND_SMASH",name:"",cost:0,type:"SPELL",description:"16",flavorText:`10
`,imageUrl:"/cards/BackhandSmash.jpg",tags:["Token"],attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:6,targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_QUAKE_HOWLING",name:"",cost:0,type:"SPELL",description:"2",flavorText:"",imageUrl:"/cards/QuakeHowling.png",tags:["Token"],attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"AOE_DAMAGE",value:2,targetType:"ALL_FOLLOWERS"}]}]},{id:"TOKEN_FLICKER_JAB",name:"",cost:0,type:"SPELL",description:"12",flavorText:`
BHS
`,imageUrl:"/cards/FlickerJab.png",tags:["Token"],attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:2,targetType:"SELECT_FOLLOWER"}]}]},{id:"c_bucchi",name:"",cost:5,type:"FOLLOWER",attack:1,health:3,description:"3",flavorText:`
`,imageUrl:"/cards/bucchi.png",evolvedImageUrl:"/cards/bucchi_2.png",attackEffectType:"SLASH",relatedCards:["c_manary"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_manary"},{type:"SUMMON_CARD",targetCardId:"c_manary"},{type:"SUMMON_CARD",targetCardId:"c_manary"}]}]},{id:"c_valkyrie",name:"",cost:6,type:"FOLLOWER",attack:6,health:6,description:`[] [] []
[]`,flavorText:"",imageUrl:"/cards/valkyrie.png",evolvedImageUrl:"/cards/valkyrie_2.png",passiveAbilities:["WARD","BARRIER","AURA"],attackEffectType:"RAY",triggers:[{trigger:"END_OF_TURN",effects:[{type:"GRANT_PASSIVE",targetPassive:"BARRIER",targetType:"SELF"}]}]},{id:"c_manary",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:"[]",flavorText:"^^",imageUrl:"/cards/manary.png",evolvedImageUrl:"/cards/manary_2.png",tags:["Token"],passiveAbilities:["WARD"],attackEffectType:"WATER"},{id:"c_potechi",name:"",cost:3,type:"FOLLOWER",attack:2,health:3,description:`[]
1`,flavorText:"",imageUrl:"/cards/potechi.png",evolvedImageUrl:"/cards/potechi_2.png",passiveAbilities:["WARD"],attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]}]},{id:"c_mono",name:"Mono",cost:3,type:"FOLLOWER",attack:2,health:1,description:`15
15`,flavorText:"",imageUrl:"/cards/Mono.png",evolvedImageUrl:"/cards/Mono_2.png",attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:5,targetType:"SELECT_FOLLOWER"}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:5,targetType:"SELECT_FOLLOWER"}]}]},{id:"c_sara",name:"sara",cost:7,type:"FOLLOWER",attack:4,health:6,description:`2111
1`,flavorText:"w",imageUrl:"/cards/sara.png",evolvedImageUrl:"/cards/sara_2.png",attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DESTROY",value:2,targetType:"OPPONENT"},{type:"GENERATE_CARD",targetCardId:"TOKEN_SORRY_THE_END",conditions:{minTurn:11}}]},{trigger:"SUPER_EVOLVE",effects:[{type:"DESTROY",targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_SORRY_THE_END",name:"",cost:3,type:"SPELL",description:"553sara1",flavorText:'""',imageUrl:"/cards/sorryTheEnd.png",tags:["Token"],attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"AOE_DAMAGE",value:5,targetType:"ALL_FOLLOWERS"},{type:"DAMAGE",value:5,targetType:"OPPONENT"},{type:"DRAW",value:3},{type:"SUMMON_CARD",targetCardId:"c_sara"}]}]},{id:"c_blue_tsubaki",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:`1
1`,flavorText:"",imageUrl:"/cards/blue_tsubaki.png",evolvedImageUrl:"/cards/blue_tsubaki_2.png",attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"RANDOM_DESTROY",value:1,targetType:"OPPONENT"}]}]},{id:"s_resignation_proxy",name:"",cost:0,type:"SPELL",description:"11",flavorText:"1",imageUrl:"/cards/taisyokudaiko.png",tags:["Token"],attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DESTROY",targetType:"OPPONENT",value:1},{type:"DRAW",value:1}]}]},{id:"s_yucho_of_the_abyss",name:"",cost:0,type:"SPELL",description:"11",flavorText:"",imageUrl:"/cards/yuchooftheabyss.png",tags:["Token"],attackEffectType:"THUNDER",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DAMAGE_BY_TURN",value:1,targetType:"OPPONENT"}]}]},{id:"s_thats_mine",name:"",cost:2,type:"SPELL",description:"1",flavorText:"",imageUrl:"/cards/thatsmine.png",tags:["Token"],attackEffectType:"ICE",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY_AND_GENERATE",value:0,targetType:"SELECT_FOLLOWER"}]}]},{id:"s_tenfubu_yabe_hutari",name:"2",cost:4,type:"SPELL",description:"11",flavorText:"",imageUrl:"/cards/tenfubuyabehutari.png",relatedCards:["c_yuki","c_potechi"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_yuki"},{type:"SUMMON_CARD",targetCardId:"c_potechi"}]}]},{id:"s_samurai_tea",name:"",cost:2,type:"SPELL",description:"1+1/+1",flavorText:'""""',imageUrl:"/cards/samuraitea.png",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1},{type:"BUFF_STATS",value:1,value2:1,targetType:"ALL_FOLLOWERS"}]}]},{id:"s_crazy_knucklers",name:"",cost:5,type:"SPELL",description:"+1/+11",flavorText:`
www www`,imageUrl:"/cards/crazy_knucklers.png",relatedCards:["c_white_tsubaki","c_shieko"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD_BUFFED",targetCardId:"c_white_tsubaki",value:1,value2:1},{type:"SUMMON_CARD_BUFFED",targetCardId:"c_shieko",value:1,value2:1},{type:"DRAW",value:1}]}]},{id:"s_knuckle_four",name:"",cost:10,type:"SPELL",description:"444",flavorText:"",imageUrl:"/cards/knucklefour.png",attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DESTROY",value:4,targetType:"OPPONENT"},{type:"DRAW",value:4},{type:"HEAL_LEADER",value:4,targetType:"SELF"}]}]},{id:"c_amandava",name:"amandava",cost:5,attack:2,health:3,type:"FOLLOWER",description:`21
1`,flavorText:"",imageUrl:"/cards/amandava.png",evolvedImageUrl:"/cards/amandava_2.png",attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_SET_HP",value:2,value2:1,targetType:"OPPONENT"}]},{trigger:"EVOLVE",effects:[{type:"AOE_DAMAGE",value:1,targetType:"ALL_FOLLOWERS"}]}]},{id:"c_alice",name:"",cost:3,attack:1,health:1,type:"FOLLOWER",description:`22
22`,flavorText:"",imageUrl:"/cards/alice.png",evolvedImageUrl:"/cards/alice_2.png",attackEffectType:"FIRE",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DAMAGE",value:2,value2:2,targetType:"OPPONENT"}]},{trigger:"EVOLVE",effects:[{type:"RANDOM_DAMAGE",value:2,value2:2,targetType:"OPPONENT"}]}]},{id:"c_yuri",name:"",cost:5,type:"FOLLOWER",attack:3,health:3,description:`1
13`,flavorText:`
`,imageUrl:"/cards/yuri.png",evolvedImageUrl:"/cards/yuri_2.png",attackEffectType:"WATER",relatedCards:["TOKEN_SUIHYORYU"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"TOKEN_SUIHYORYU"}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:3,targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_SUIHYORYU",name:"",cost:5,type:"FOLLOWER",attack:4,health:4,description:`[] []
`,flavorText:"",imageUrl:"/cards/suihyoryu.png",evolvedImageUrl:"/cards/suihyoryu.png",tags:["Token"],passiveAbilities:["RUSH","WARD"],attackEffectType:"ICE",triggers:[{trigger:"START_OF_TURN",effects:[{type:"DESTROY_SELF"}]}]},{id:"c_cyoriena",name:"cyoriena",cost:2,type:"FOLLOWER",attack:1,health:2,description:`[] []
HP2
`,flavorText:"7",imageUrl:"/cards/cyoriena.png",evolvedImageUrl:"/cards/cyoriena_2.png",tags:["Token"],passiveAbilities:["WARD","BARRIER"],attackEffectType:"RAY",triggers:[{trigger:"END_OF_TURN",effects:[{type:"HEAL_LEADER",value:2,targetType:"SELF"}]},{trigger:"EVOLVE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_TSUBASA"}]}]},{id:"TOKEN_TSUBASA",name:"",cost:1,type:"SPELL",description:"1[]",flavorText:"",imageUrl:"/cards/tsubasa.png",tags:["Token"],triggers:[{trigger:"FANFARE",effects:[{type:"GRANT_PASSIVE",targetPassive:"STORM",targetType:"SELECT_ALLY_FOLLOWER"}]}]},{id:"c_yamato",name:"",cost:5,type:"FOLLOWER",attack:5,health:1,description:"[]",imageUrl:"/cards/yamato.jpg",passiveAbilities:["STORM"],attackEffectType:"SLASH"},{id:"c_yoruka",name:"yoRuka",cost:8,type:"FOLLOWER",attack:5,health:5,description:`1
 8yoRuka1
2`,flavorText:"Y",imageUrl:"/cards/yoRuka.png",evolvedImageUrl:"/cards/yoRuka_2.png",attackEffectType:"SUMI",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY",targetType:"SELECT_FOLLOWER"}]},{trigger:"LAST_WORD",effects:[{type:"SUMMON_CARD",targetCardId:"c_yoruka",necromance:8}]},{trigger:"SUPER_EVOLVE",effects:[{type:"RANDOM_DESTROY",value:2,targetType:"OPPONENT"}]}]},{id:"c_haruka",name:"",cost:7,type:"FOLLOWER",attack:2,health:3,description:`[]
[]1
4
1 4+2/+0`,flavorText:"",imageUrl:"/cards/haruka.png",evolvedImageUrl:"/cards/haruka_2.png",passiveAbilities:["STEALTH"],attackEffectType:"SLASH",relatedCards:["c_yuka","c_setsuna"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD_RUSH",targetCardId:"c_yuka"},{type:"SUMMON_CARD",targetCardId:"c_setsuna"}]},{trigger:"LAST_WORD",effects:[{type:"ADD_GRAVEYARD",value:4}]},{trigger:"SUPER_EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_setsuna"},{type:"BUFF_STATS",value:2,value2:0,targetType:"ALL_OTHER_FOLLOWERS",necromance:4}]}]},{id:"c_setsuna",name:"",cost:3,type:"FOLLOWER",attack:1,health:1,description:`[] []
-12`,flavorText:"",imageUrl:"/cards/setsuna.png",evolvedImageUrl:"/cards/setsuna_2.png",passiveAbilities:["STORM","BANE"],attackEffectType:"SUMI",triggers:[{trigger:"LAST_WORD",effects:[{type:"BUFF_STATS",value:-1,value2:0,targetType:"RANDOM_FOLLOWER"},{type:"ADD_GRAVEYARD",value:2}]}]},{id:"c_yuka",name:"",cost:5,type:"FOLLOWER",attack:1,health:6,description:`[] []
1
3
132`,flavorText:"",imageUrl:"/cards/yuka.png",evolvedImageUrl:"/cards/yuka_2.png",passiveAbilities:["WARD","AURA"],attackEffectType:"SHOT",relatedCards:["c_setsuna"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_setsuna"}]},{trigger:"LAST_WORD",effects:[{type:"ADD_GRAVEYARD",value:3}]},{trigger:"EVOLVE",effects:[{type:"RANDOM_DAMAGE",value:3,value2:1,targetType:"OPPONENT"},{type:"RANDOM_DAMAGE",value:3,value2:1,targetType:"OPPONENT"}]}]},{id:"s_hayakikoto",name:"",cost:4,type:"SPELL",description:"21",flavorText:"",imageUrl:"/cards/hayakikoto.png",relatedCards:["c_setsuna"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_setsuna"},{type:"SUMMON_CARD",targetCardId:"c_setsuna"},{type:"DRAW",value:1}]}]},{id:"s_keishou",name:"",cost:9,type:"SPELL",description:"1-9",flavorText:`
`,imageUrl:"/cards/keisyopower.png",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY_AND_GENERATE",targetType:"RANDOM_ENEMY_FOLLOWER",value:-9}]}]},{id:"s_night_parade",name:"",cost:10,type:"SPELL",description:` 41
+1/+0`,flavorText:"",imageUrl:"/cards/nightparade.png",relatedCards:["c_setsuna"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD_FILL_BOARD",targetCardId:"c_setsuna",necromance:4},{type:"BUFF_STATS",value:1,value2:0,targetType:"ALL_FOLLOWERS"}]}]}];function Q0(t){let e=t;return()=>(e=(e*1664525+1013904223)%4294967296,e/4294967296)}function IL(t,e){let n=t.length,r;for(;n!=0;)r=Math.floor(e()*n),n--,[t[n],t[r]]=[t[r],t[n]];return t}function TL(t){var s;const e=t.players.p1,n=t.players.p2;return[t.turnCount,t.activePlayerId,e.hp,e.maxHp,e.pp,e.maxPp,e.sep,e.evolutionsUsed,n.hp,n.maxHp,n.pp,n.maxPp,n.sep,n.evolutionsUsed,e.board.map(i=>i?`${i.id}_${i.instanceId}_${i.currentHealth}_${i.hasBarrier?"B":""}`:"null").join(","),n.board.map(i=>i?`${i.id}_${i.instanceId}_${i.currentHealth}_${i.hasBarrier?"B":""}`:"null").join(","),e.hand.length,n.hand.length,((s=t.pendingEffects)==null?void 0:s.length)||0,t.rngSeed].join("|")}const qS=[{cardId:"c_senka_knuckler",count:3},{cardId:"c_yuki",count:3},{cardId:"c_white_tsubaki",count:3},{cardId:"c_shieko",count:3},{cardId:"s_samurai_tea",count:3},{cardId:"c_bucchi",count:2},{cardId:"c_valkyrie",count:1},{cardId:"c_potechi",count:3},{cardId:"s_tenfubu_yabe_hutari",count:3},{cardId:"s_crazy_knucklers",count:2},{cardId:"c_sia",count:2},{cardId:"c_mono",count:3},{cardId:"c_ruiyu",count:1},{cardId:"c_kasuga",count:1},{cardId:"c_y",count:2},{cardId:"c_sara",count:1},{cardId:"s_knuckle_four",count:1},{cardId:"c_blue_tsubaki",count:3}],ZS=[{cardId:"c_azya",count:3},{cardId:"c_ruiyu",count:2},{cardId:"c_y",count:2},{cardId:"c_sara",count:2},{cardId:"c_urara",count:3},{cardId:"c_yunagi",count:3},{cardId:"c_tsubumaru",count:3},{cardId:"c_nayuta",count:3},{cardId:"c_yuri",count:2},{cardId:"c_alice",count:3},{cardId:"c_kasuga",count:1},{cardId:"c_barura",count:3},{cardId:"c_valkyrie",count:3},{cardId:"s_3cats",count:2},{cardId:"s_final_cannon",count:1},{cardId:"c_amandava",count:2},{cardId:"c_mono",count:2}],eI=[{cardId:"c_yoruka",count:3},{cardId:"c_y",count:3},{cardId:"c_haruka",count:3},{cardId:"c_yuka",count:3},{cardId:"c_setsuna",count:3},{cardId:"s_hayakikoto",count:3},{cardId:"s_night_parade",count:1},{cardId:"c_kasuga",count:1},{cardId:"c_yunagi",count:3},{cardId:"c_tsubumaru",count:3},{cardId:"c_nayuta",count:3},{cardId:"c_mono",count:3},{cardId:"c_ruiyu",count:1},{cardId:"c_sara",count:1},{cardId:"s_3cats",count:2},{cardId:"c_yuri",count:2},{cardId:"c_sia",count:2}];function Kr(t){const e=tr.find(n=>n.id===t);return e||tr.find(n=>n.name===t)}function tI(){return tr.map(t=>t.name).sort((t,e)=>e.length-t.length)}function Qc(t){return{STORM:"",RUSH:"",WARD:"",BARRIER:"",AURA:"",STEALTH:"",BANE:"",DOUBLE_ATTACK:"",IMMUNE_TO_FOLLOWER_DAMAGE:"",GUTS_MY_TURN:""}[t]||t}function wL(t,e){const n=[];let r=0;return t.forEach(s=>{const i=Kr(s.cardId);if(i)for(let o=0;o<s.count;o++)n.push({...i,id:`${e}_c${r}`,instanceId:`inst_${e}_c${r}`}),r++;else console.warn(`Card definition not found: ${s.cardId}`)}),n}function T_(t,e,n,r){const i=wL(n==="SENKA"?qS:n==="AJA"?ZS:eI,t);return{id:t,name:e,class:n,hp:E_,maxHp:E_,pp:0,maxPp:0,sep:2,deck:IL(i,r),hand:[],graveyard:[],board:[],evolutionsUsed:0,canEvolveThisTurn:!1,extraPpUsedEarly:!1,extraPpUsedLate:!1,extraPpActive:!1}}function Ed(t,e,n,r,s,i=!0){const o=Math.floor(Math.random()*1e6),l=Q0(o),c=T_("p1",t,e,l),d=T_("p2",n,r,l);c.hand=c.deck.splice(0,4),d.hand=d.deck.splice(0,4);let u,h;return i?(u="p1",h=t,c.maxPp=1,c.pp=1,d.maxPp=0,d.pp=0):(u="p2",h=n,c.maxPp=0,c.pp=0,d.maxPp=1,d.pp=1),{phase:"INIT",rngSeed:Math.floor(l()*1e6),activePlayerId:u,firstPlayerId:u,players:{p1:c,p2:d},turnCount:1,pendingEffects:[],logs:[` 1 - ${h} `],winnerId:void 0}}function Qp(t){return t==="p1"?"p2":"p1"}function CL(t,e,n,r,s,i){var h,f,E,k,w,$,v,_,S,p,D,H,ne,V,ee,de,ve,je,ue,I,O;let o={...t,players:{p1:{...t.players.p1,hand:[...t.players.p1.hand],deck:[...t.players.p1.deck],board:t.players.p1.board.map(C=>C?{...C,passiveAbilities:C.passiveAbilities?[...C.passiveAbilities]:[]}:null),graveyard:[...t.players.p1.graveyard]},p2:{...t.players.p2,hand:[...t.players.p2.hand],deck:[...t.players.p2.deck],board:t.players.p2.board.map(C=>C?{...C,passiveAbilities:C.passiveAbilities?[...C.passiveAbilities]:[]}:null),graveyard:[...t.players.p2.graveyard]}},logs:[...t.logs||[]]};const l=Q0(o.rngSeed||999);o.rngSeed=Math.floor(l()*1e6);const c=Qp(e),d=C=>{for(const R of["p1","p2"]){const y=o.players[R].board.findIndex(g=>(g==null?void 0:g.instanceId)===C);if(y!==-1&&o.players[R].board[y])return{card:o.players[R].board[y],player:o.players[R],index:y}}return null};if(r.necromance!==void 0&&r.necromance>0&&r.type!=="SUMMON_CARD_FILL_BOARD"){const C=o.players[e];if(C.graveyard.length<r.necromance)return console.log(`[Engine] : ${C.graveyard.length} < ${r.necromance}`),o;const R=C.graveyard.splice(-r.necromance,r.necromance);o.logs.push(`${C.name}  ${r.necromance} `),console.log(`[Engine] : ${R.map(y=>y.name).join(", ")} `)}const u=(C,R)=>{var g;const y=(g=C.triggers)==null?void 0:g.find(T=>T.trigger==="LAST_WORD");if(y){const T=y.effects.map(A=>({sourceCard:C,effect:A,sourcePlayerId:R}));o.pendingEffects=[...o.pendingEffects||[],...T],o.logs.push(`${C.name} `),console.log(`[Engine] processSingleEffect: Last Word triggered for ${C.name}. pendingEffects count: ${o.pendingEffects.length}`)}};switch(r.type){case"DAMAGE":{const C=r.value||0;if(r.targetType==="SELECT_FOLLOWER"&&s){const R=d(s);if(R){const{card:y,player:g,index:T}=R;if(y.hasBarrier)y.hasBarrier=!1,o.logs.push(`${y.name} `);else if(y.currentHealth-=C,o.logs.push(`${n.name}  ${y.name}  ${C} `),y.currentHealth<=0){y.currentHealth=Math.min(0,y.currentHealth);const A=Object.keys(o.players).find(M=>o.players[M]===g)||c;u(y,A),g.graveyard.push(y),g.board[T]=null,o.logs.push(`${y.name} `)}}}else if(r.targetType==="OPPONENT"){const R=o.players[c];if(R.leaderDamageShield)R.leaderDamageShield=!1,o.logs.push(`${n.name}  ${C} `);else{const y=R.board.some(T=>{var A;return(A=T==null?void 0:T.passiveAbilities)==null?void 0:A.includes("LEADER_DAMAGE_CAP")}),g=y?Math.min(C,1):C;R.hp-=g,y&&C>1?o.logs.push(`${n.name}  ${C} 1`):o.logs.push(`${n.name}  ${g} `),R.hp<=0&&(o.winnerId=e,o.logs.push(`${R.name} `))}}break}case"AOE_DAMAGE":{const C=r.value||0;if(r.targetType==="ALL_FOLLOWERS"){const R=o.players[c].board,y=i&&i.length>0?new Set(i):null;R.forEach(T=>{if(T){if(y&&!y.has(T.instanceId))return;T.hasBarrier?(T.hasBarrier=!1,o.logs.push(`${T.name} `)):T.currentHealth-=C}}),R.filter(T=>T&&T.currentHealth<=0).forEach(T=>{T&&(T.currentHealth=Math.min(0,T.currentHealth),u(T,c),o.players[c].graveyard.push(T),o.logs.push(`${T.name} `))}),o.logs.push(`${n.name}  ${C} `),R.forEach((T,A)=>{T&&T.currentHealth<=0&&(R[A]=null)})}break}case"DRAW":{const C=r.value||1,R=o.players[e];for(let y=0;y<C;y++)if(R.deck.length>0){const g=R.deck.pop();g&&(R.hand.length<9?R.hand.push(g):(R.graveyard.push(g),o.logs.push(`${R.name}${g.name}`)))}o.logs.push(`${R.name}  ${C} `);break}case"ADD_GRAVEYARD":{const C=r.value||1,R=o.players[e];for(let y=0;y<C;y++){const g={...n,instanceId:`grave_${o.rngSeed}_${Math.floor(l()*1e3)}_${y}`};R.graveyard.push(g)}o.logs.push(`${R.name}  ${C} `);break}case"HEAL_LEADER":{const C=r.value||0,R=o.players[e];R.hp=Math.min(R.maxHp,R.hp+C),o.logs.push(`${R.name}  ${C} HP`);break}case"DESTROY":{const C=(R,y)=>{var g;return((g=R.passiveAbilities)==null?void 0:g.includes("IMMUNE_TO_DAMAGE_MY_TURN"))===!0&&o.activePlayerId===y};if(r.targetType==="ALL_OTHER_FOLLOWERS"){const R=o.players[c].board,y=[];R.forEach(M=>{M&&(C(M,c)?(y.push(M),o.logs.push(`${M.name} `)):(u(M,c),o.players[c].graveyard.push(M)))}),o.players[c].board=y;const g=o.players[e].board,T=[],A=n.instanceId;g.forEach(M=>{M&&(A&&M.instanceId===A?T.push(M):C(M,e)?(T.push(M),o.logs.push(`${M.name} `)):(u(M,e),o.players[e].graveyard.push(M)))}),o.players[e].board=T,o.logs.push(`${n.name} `)}else if((r.targetType==="SELECT_FOLLOWER"||r.targetType==="SELECT_ALLY_FOLLOWER")&&s){const R=d(s);if(R){const{card:y,player:g,index:T}=R,A=Object.keys(o.players).find(M=>o.players[M].board.includes(y))||"";C(y,A)?o.logs.push(`${y.name} `):(y.currentHealth=1,u(y,A),g.graveyard.push(y),g.board[T]=null,o.logs.push(`${y.name}  ${n.name} `))}}break}case"GENERATE_CARD":{if((h=r.conditions)!=null&&h.minTurn&&t.turnCount<r.conditions.minTurn)break;const C=r.targetCardId,R=tr.find(y=>y.id===C);if(R){const y=o.players[e],g=`gen_${o.rngSeed}_${Date.now()}_${Math.floor(l()*1e4)}`,T={...R,id:`token_${o.rngSeed}_${Math.floor(l()*1e3)}`,instanceId:g};y.hand.length<9?(y.hand.push(T),o.logs.push(`${y.name}  ${R.name} `)):(y.graveyard.push(T),o.logs.push(`${y.name}${R.name}`))}break}case"REDUCE_HAND_COST":{const C=r.value||0,R=((f=r.conditions)==null?void 0:f.nameIn)||[],y=o.players[e];let g=0;y.hand.forEach(T=>{if(R.includes(T.name)){const A=T.cost,M=Math.max(0,A-C);M!==A&&(T.cost=M,T.baseCost=M,g++)}}),g>0&&o.logs.push(`${n.name} -${C}`);break}case"GRANT_LEADER_DAMAGE_SHIELD":{const C=o.players[e];C.leaderDamageShield=!0,o.logs.push(`${C.name} 0`);break}case"RANDOM_DESTROY":{const C=(T,A)=>{var M;return((M=T.passiveAbilities)==null?void 0:M.includes("IMMUNE_TO_DAMAGE_MY_TURN"))===!0&&o.activePlayerId===A},R=r.value||1,y=r.targetType==="SELF"?e:c,g=o.players[y].board;if(i&&i.length>0)i.forEach(T=>{const A=g.findIndex(M=>(M==null?void 0:M.instanceId)===T);if(A!==-1&&g[A]){const M=g[A];C(M,y)?o.logs.push(`${M.name} `):(M.currentHealth=1,u(M,y),o.players[y].graveyard.push(M),g[A]=null,o.logs.push(`${M.name}  ${n.name} `))}});else{const T=g.map((M,Q)=>!M||C(M,y)?-1:Q).filter(M=>M!==-1);for(let M=T.length-1;M>0;M--){const Q=Math.floor(l()*(M+1));[T[M],T[Q]]=[T[Q],T[M]]}T.slice(0,R).forEach(M=>{const Q=g[M];Q&&(Q.currentHealth=1,u(Q,y),o.players[y].graveyard.push(Q),g[M]=null,o.logs.push(`${Q.name}  ${n.name} `))})}break}case"RANDOM_SET_HP":{const C=r.value||1,R=r.value2||1,y=r.targetType==="SELF"?e:c,g=o.players[y].board;if(i&&i.length>0)i.forEach(T=>{const A=g.findIndex(M=>(M==null?void 0:M.instanceId)===T);A!==-1&&g[A]&&(g[A].currentHealth=R,o.logs.push(`${g[A].name} HP ${R} `))});else{const T=g.map((M,Q)=>M?Q:-1).filter(M=>M!==-1);for(let M=T.length-1;M>0;M--){const Q=Math.floor(l()*(M+1));[T[M],T[Q]]=[T[Q],T[M]]}T.slice(0,C).forEach(M=>{const Q=g[M];Q&&(Q.currentHealth=R,o.logs.push(`${Q.name} HP ${R} `))})}break}case"RANDOM_DAMAGE":{const C=r.value2||1,R=r.value||0,y=r.targetType==="SELF"?e:c,g=o.players[y].board,T=M=>{const Q=g[M];Q&&(Q.hasBarrier?(Q.hasBarrier=!1,o.logs.push(`${Q.name} `)):(Q.currentHealth-=R,o.logs.push(`${n.name}  ${Q.name}  ${R} `)),Q.currentHealth<=0&&(Q.currentHealth=0,u(Q,y),o.players[y].graveyard.push(Q),g[M]=null,o.logs.push(`${Q.name} `)))},A=new Set;if(i&&i.length>0)i.forEach(M=>{const Q=g.findIndex(U=>(U==null?void 0:U.instanceId)===M);if(Q!==-1&&g[Q])A.add(M),T(Q);else{const U=g.map((ge,z)=>ge&&!A.has(ge.instanceId)?z:-1).filter(ge=>ge!==-1);if(U.length>0){const ge=Math.floor(l()*U.length),z=U[ge],Te=g[z];A.add(Te.instanceId),T(z)}}});else{const M=g.map((U,ge)=>U?ge:-1).filter(U=>U!==-1);for(let U=M.length-1;U>0;U--){const ge=Math.floor(l()*(U+1));[M[U],M[ge]]=[M[ge],M[U]]}M.slice(0,C).forEach(U=>{T(U)})}break}case"RANDOM_DAMAGE_BY_TURN":{const C=r.value||1,R=o.turnCount,y=r.targetType==="SELF"?e:c,g=o.players[y].board,T=A=>{var Q;const M=g[A];if(!M)return!1;if(M.hasBarrier)return M.hasBarrier=!1,o.logs.push(`${M.name} `),!0;if(M.currentHealth-=C,o.logs.push(`${n.name}  ${M.name}  ${C} `),M.currentHealth<=0){M.currentHealth=0;const U=Object.keys(o.players).find(z=>o.players[z]===o.players[y])||y,ge=(Q=M.triggers)==null?void 0:Q.find(z=>z.trigger==="LASTWORD");return ge&&ge.effects.forEach(z=>{o.pendingEffects.push({sourceCard:M,effect:z,sourcePlayerId:U})}),o.players[y].graveyard.push(M),g[A]=null,o.logs.push(`${M.name} `),!1}return!0};if(i&&i.length>0)for(let A=0;A<i.length;A++){const M=i[A],Q=g.findIndex(U=>(U==null?void 0:U.instanceId)===M);if(Q!==-1&&g[Q])T(Q);else{const U=g.map((ge,z)=>ge?z:-1).filter(ge=>ge!==-1);if(U.length>0){const ge=Math.floor(l()*U.length);T(U[ge])}}}else for(let A=0;A<R;A++){const M=g.map((U,ge)=>U?ge:-1).filter(U=>U!==-1);if(M.length===0)break;const Q=Math.floor(l()*M.length);T(M[Q])}break}case"SET_MAX_HP":{const C=r.value||20;if(r.targetType==="OPPONENT"){const R=o.players[c];R.maxHp=C,R.hp>C&&(R.hp=C)}break}case"SUMMON_CARD":{const C=r.targetCardId,R=tr.find(y=>y.id===C);if(R){const y=o.players[e];if(y.board.filter(T=>T!==null).length<5){const T={...R,instanceId:`token_${o.rngSeed}_${Math.floor(l()*1e3)}`,canAttack:((E=R.passiveAbilities)==null?void 0:E.includes("STORM"))||((k=R.passiveAbilities)==null?void 0:k.includes("RUSH"))||!1,currentHealth:R.health||1,maxHealth:R.health||1,attack:R.attack||0,currentAttack:R.attack||0,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((w=R.passiveAbilities)==null?void 0:w.includes("BARRIER"))??!1,passiveAbilities:R.passiveAbilities?[...R.passiveAbilities]:[],hadStealth:(($=R.passiveAbilities)==null?void 0:$.includes("STEALTH"))??!1};(v=R.tags)!=null&&v.includes("Knuckler")&&!T.passiveAbilities.includes("STORM")&&y.board.some(M=>(M==null?void 0:M.name)==="")&&(T.passiveAbilities.push("STORM"),T.canAttack=!0,o.logs.push(`${R.name}   `)),y.board.push(T),o.logs.push(`${y.name}  ${R.name} `)}}break}case"SUMMON_CARD_RUSH":{const C=r.targetCardId,R=tr.find(y=>y.id===C);if(R){const y=o.players[e];if(y.board.filter(T=>T!==null).length<5){const T={...R,instanceId:`token_${o.rngSeed}_${Math.floor(l()*1e3)}`,canAttack:!0,currentHealth:R.health||1,maxHealth:R.health||1,attack:R.attack||0,currentAttack:R.attack||0,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((_=R.passiveAbilities)==null?void 0:_.includes("BARRIER"))??!1,passiveAbilities:R.passiveAbilities?[...R.passiveAbilities]:[],hadStealth:((S=R.passiveAbilities)==null?void 0:S.includes("STEALTH"))??!1};let A=!1;(p=R.tags)!=null&&p.includes("Knuckler")&&!T.passiveAbilities.includes("STORM")&&y.board.some(Q=>(Q==null?void 0:Q.name)==="")&&(T.passiveAbilities.push("STORM"),A=!0,o.logs.push(`${R.name}   `)),!A&&!T.passiveAbilities.includes("RUSH")&&T.passiveAbilities.push("RUSH"),y.board.push(T),o.logs.push(`${y.name}  ${R.name} ${A?"":""}`)}}break}case"SUMMON_CARD_BUFFED":{const C=r.targetCardId,R=tr.find(T=>T.id===C),y=r.value||0,g=r.value2||0;if(R){const T=o.players[e];if(T.board.filter(M=>M!==null).length<5){const M=R.attack||0,Q=R.health||1,U=M+y,ge=Q+g,z={...R,instanceId:`token_${o.rngSeed}_${Math.floor(l()*1e3)}`,canAttack:!1,currentHealth:ge,maxHealth:ge,health:ge,attack:U,currentAttack:U,baseAttack:M,baseHealth:Q,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((D=R.passiveAbilities)==null?void 0:D.includes("BARRIER"))??!1,passiveAbilities:R.passiveAbilities?[...R.passiveAbilities]:[],hadStealth:((H=R.passiveAbilities)==null?void 0:H.includes("STEALTH"))??!1};(ne=R.tags)!=null&&ne.includes("Knuckler")&&!z.passiveAbilities.includes("STORM")&&T.board.some(te=>(te==null?void 0:te.name)==="")&&(z.passiveAbilities.push("STORM"),z.canAttack=!0,o.logs.push(`${R.name}   `)),((V=z.passiveAbilities)!=null&&V.includes("RUSH")||(ee=z.passiveAbilities)!=null&&ee.includes("STORM"))&&(z.canAttack=!0),T.board.push(z),o.logs.push(`${T.name}  ${R.name} +${y}/+${g}`),o.pendingEffects=[...o.pendingEffects||[],{sourceCard:z,effect:{type:"VISUAL_BUFF_ONLY",value:y,value2:g},sourcePlayerId:e}]}}break}case"SUMMON_CARD_FILL_BOARD":{const C=r.targetCardId,R=tr.find(g=>g.id===C),y=r.necromance||0;if(R){const g=o.players[e];let T=0;for(;!(g.board.filter(Q=>Q!==null).length>=5);){if(y>0&&g.graveyard.length<y){T===0&&o.logs.push(` ${R.name} `);break}if(y>0){const Q=g.graveyard.splice(-y,y);o.logs.push(` ${y} ${Q.map(U=>U.name).join(", ")} `)}const M={...R,instanceId:`token_${o.rngSeed}_${Math.floor(l()*1e3)}_${T}`,canAttack:((de=R.passiveAbilities)==null?void 0:de.includes("STORM"))||((ve=R.passiveAbilities)==null?void 0:ve.includes("RUSH"))||!1,currentHealth:R.health||1,maxHealth:R.health||1,attack:R.attack||0,currentAttack:R.attack||0,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((je=R.passiveAbilities)==null?void 0:je.includes("BARRIER"))??!1,passiveAbilities:R.passiveAbilities?[...R.passiveAbilities]:[],hadStealth:((ue=R.passiveAbilities)==null?void 0:ue.includes("STEALTH"))??!1};(I=R.tags)!=null&&I.includes("Knuckler")&&!M.passiveAbilities.includes("STORM")&&g.board.some(U=>(U==null?void 0:U.name)==="")&&(M.passiveAbilities.push("STORM"),M.canAttack=!0,o.logs.push(`${R.name}   `)),g.board.push(M),T++,o.logs.push(`${g.name}  ${R.name} `)}T>0&&o.logs.push(` ${T}  ${R.name} `)}break}case"DESTROY_AND_STEAL":{if(r.targetType==="SELECT_FOLLOWER"&&s){const C=d(s);if(C){const{card:R,player:y,index:g}=C,T=Object.keys(o.players).find(Q=>o.players[Q]===y)||c,A=o.players[e];if(A.board.filter(Q=>Q!==null).length<5){y.board[g]=null,o.logs.push(`${R.name}  ${n.name} `);const Q={...R,instanceId:`stolen_${o.rngSeed}_${Math.floor(l()*1e3)}`,canAttack:!1,currentHealth:R.health||R.currentHealth,maxHealth:R.health||R.maxHealth,currentAttack:R.attack||R.currentAttack,attacksMade:0,turnPlayed:o.turnCount,hasEvolved:!1};A.board.push(Q),o.logs.push(`${A.name}  ${Q.name} `)}else u(R,T),y.graveyard.push(R),y.board[g]=null,o.logs.push(`${R.name}  ${n.name} `)}}break}case"DESTROY_AND_GENERATE":{let C=null;if(r.targetType==="SELECT_FOLLOWER"&&s)C=d(s);else if(r.targetType==="RANDOM_ENEMY_FOLLOWER"){const y=o.players[c].board.map((g,T)=>({card:g,index:T})).filter(g=>g.card!==null);if(y.length>0){const g=Math.floor(l()*y.length),T=y[g];C={card:T.card,player:o.players[c],index:T.index}}}if(C){const{card:R,player:y,index:g}=C,T=Object.keys(o.players).find(Q=>o.players[Q]===y)||c;u(R,T),y.graveyard.push(R),y.board[g]=null,o.logs.push(`${R.name}  ${n.name} `);const A=o.players[e],M=Kr(R.name);if(M){const Q=Math.max(0,M.cost+(r.value||0)),U={...M,instanceId:`generated_${o.rngSeed}_${Math.floor(l()*1e3)}`,baseCost:Q,cost:Q,attackEffectType:M.attackEffectType};A.hand.push(U);const ge=r.value||0;o.logs.push(`${A.name}  ${U.name} ${ge>=0?"+":""}${ge}`)}}break}case"RETURN_TO_HAND":{const C=o.players[c].board;let R=-1;if(r.targetType==="SELECT_FOLLOWER"&&s?R=C.findIndex(y=>(y==null?void 0:y.instanceId)===s):(r.targetType==="RANDOM_FOLLOWER"||!s)&&C.length>0&&(R=Math.floor(l()*C.length)),R!==-1&&C[R]){const y=C[R];o.players[c].board[R]=null;const g=o.players[c],T=Kr(y.id)||Kr(y.name),{currentHealth:A,maxHealth:M,canAttack:Q,attacksMade:U,hasEvolved:ge,baseAttack:z,baseHealth:Te,turnPlayed:te,hasBarrier:X,attack:Pe,health:we,...We}=y,be={...We,attack:(T==null?void 0:T.attack)??Pe,health:(T==null?void 0:T.health)??we};g.hand.length<9?(g.hand.push(be),o.logs.push(`${y.name} `)):(g.graveyard.push(be),o.logs.push(`${y.name} `))}break}case"RANDOM_BOUNCE":{const C=r.value||1,R=o.players[c].board;for(let y=0;y<C;y++){const g=R.map((tt,qe)=>tt?qe:-1).filter(tt=>tt!==-1);if(g.length===0)break;const T=g[Math.floor(l()*g.length)],A=R[T];R[T]=null;const M=o.players[c],Q=Kr(A.id)||Kr(A.name),{currentHealth:U,maxHealth:ge,canAttack:z,attacksMade:Te,hasEvolved:te,baseAttack:X,baseHealth:Pe,turnPlayed:we,hasBarrier:We,attack:be,health:Me,...yt}=A,rt={...yt,attack:(Q==null?void 0:Q.attack)??be,health:(Q==null?void 0:Q.health)??Me};M.hand.length<9?(M.hand.push(rt),o.logs.push(`${A.name} `)):(M.graveyard.push(rt),o.logs.push(`${A.name} `))}break}case"GRANT_PASSIVE":{const C=r.targetPassive;if(!C)break;if(r.targetType==="SELF"){const R=n;if(R.instanceId){const g=o.players[e].board.find(T=>(T==null?void 0:T.instanceId)===R.instanceId);g&&(C==="BARRIER"?(g.hasBarrier=!0,o.logs.push(`${g.name} `)):(g.passiveAbilities||(g.passiveAbilities=[]),g.passiveAbilities.includes(C)||(g.passiveAbilities.push(C),o.logs.push(`${g.name}  ${Qc(C)} `)),(C==="STORM"||C==="RUSH")&&(g.canAttack=!0)))}}else if((r.targetType==="SELECT_FOLLOWER"||r.targetType==="SELECT_ALLY_FOLLOWER")&&s){const R=d(s);if(R){const{card:y}=R;C==="BARRIER"?(y.hasBarrier=!0,o.logs.push(`${y.name} `)):(y.passiveAbilities||(y.passiveAbilities=[]),y.passiveAbilities.includes(C)||(y.passiveAbilities.push(C),o.logs.push(`${y.name}  ${Qc(C)} `)),(C==="STORM"||C==="RUSH")&&(y.canAttack=!0))}}else if(r.targetType==="ALL_FOLLOWERS"){const R=o.players[e];let y=0;console.log(`[GRANT_PASSIVE] ALL_FOLLOWERS: Player board has ${R.board.filter(g=>g).length} units, condition tag=${(O=r.conditions)==null?void 0:O.tag}`),R.board.forEach(g=>{var T,A,M;if(g){if(console.log(`[GRANT_PASSIVE] Checking: ${g.name}, tags=${g.tags}, passives=${g.passiveAbilities}`),(T=r.conditions)!=null&&T.tag&&!((A=g.tags)!=null&&A.includes(r.conditions.tag))){console.log(`[GRANT_PASSIVE] Skipped ${g.name}: no matching tag`);return}if((M=r.conditions)!=null&&M.nameIn&&!r.conditions.nameIn.includes(g.name)){console.log(`[GRANT_PASSIVE] Skipped ${g.name}: no matching nameIn`);return}C==="BARRIER"?(g.hasBarrier=!0,y++):(g.passiveAbilities||(g.passiveAbilities=[]),g.passiveAbilities.includes(C)||(g.passiveAbilities.push(C),y++,console.log(`[GRANT_PASSIVE] Granted ${C} to ${g.name}`),(C==="STORM"||C==="RUSH")&&(g.canAttack=!0)))}}),y>0&&o.logs.push(`${y} ${Qc(C)} `),console.log(`[GRANT_PASSIVE] Total granted: ${y}`)}else if(r.targetType==="ALL_OTHER_FOLLOWERS"){const R=o.players[e];let y=0;R.board.forEach(g=>{var T,A,M;if(g&&g.instanceId!==n.instanceId){if((T=r.conditions)!=null&&T.tag&&!((A=g.tags)!=null&&A.includes(r.conditions.tag))||(M=r.conditions)!=null&&M.nameIn&&!r.conditions.nameIn.includes(g.name))return;C==="BARRIER"?(g.hasBarrier=!0,y++):(g.passiveAbilities||(g.passiveAbilities=[]),g.passiveAbilities.includes(C)||(g.passiveAbilities.push(C),y++,(C==="STORM"||C==="RUSH")&&(g.canAttack=!0)))}}),y>0&&o.logs.push(`${y} ${Qc(C)} `)}break}case"BUFF_STATS":{const C=r.value||0,R=r.value2||0;if(r.targetType==="ALL_FOLLOWERS")o.players[e].board.forEach(g=>{var T,A,M;if(g){if((T=r.conditions)!=null&&T.tag&&!((A=g.tags)!=null&&A.includes(r.conditions.tag))||(M=r.conditions)!=null&&M.nameIn&&!r.conditions.nameIn.includes(g.name))return;g.baseAttack||(g.baseAttack=g.attack||0),g.baseHealth||(g.baseHealth=g.health||0),g.attack=(g.attack||0)+C,g.currentAttack=(g.currentAttack||0)+C,g.health=(g.health||0)+R,g.maxHealth=(g.maxHealth||0)+R,g.currentHealth=(g.currentHealth||0)+R,o.logs.push(`${g.name}  +${C}/+${R} `)}});else if(r.targetType==="ALL_OTHER_FOLLOWERS")o.players[e].board.forEach(g=>{var T,A,M;if(g&&g.instanceId!==n.instanceId){if((T=r.conditions)!=null&&T.tag&&!((A=g.tags)!=null&&A.includes(r.conditions.tag))||(M=r.conditions)!=null&&M.nameIn&&!r.conditions.nameIn.includes(g.name))return;g.baseAttack||(g.baseAttack=g.attack||0),g.baseHealth||(g.baseHealth=g.health||0),g.attack=(g.attack||0)+C,g.currentAttack=(g.currentAttack||0)+C,g.health=(g.health||0)+R,g.maxHealth=(g.maxHealth||0)+R,g.currentHealth=(g.currentHealth||0)+R,o.logs.push(`${g.name}  +${C}/+${R} `)}});else if((r.targetType==="SELECT_FOLLOWER"||r.targetType==="SELECT_ALLY_FOLLOWER"||r.targetType==="SELECT_OTHER_ALLY_FOLLOWER")&&s){const y=d(s);if(y){const{card:g}=y;g.baseAttack||(g.baseAttack=g.attack||0),g.baseHealth||(g.baseHealth=g.health||0),g.attack=(g.attack||0)+C,g.currentAttack=(g.currentAttack||0)+C,g.health=(g.health||0)+R,g.maxHealth=(g.maxHealth||0)+R,g.currentHealth=(g.currentHealth||0)+R,o.logs.push(`${g.name}  +${C}/+${R} `)}}else if(r.targetType==="RANDOM_FOLLOWER"){const y=o.players[c].board,g=y.map((T,A)=>T?A:-1).filter(T=>T!==-1);if(g.length>0){const T=g[Math.floor(l()*g.length)],A=y[T];A.baseAttack||(A.baseAttack=A.attack||0),A.baseHealth||(A.baseHealth=A.health||0),A.attack=(A.attack||0)+C,A.currentAttack=(A.currentAttack||0)+C,A.health=(A.health||0)+R,A.maxHealth=(A.maxHealth||0)+R,A.currentHealth=(A.currentHealth||0)+R,A.currentAttack<0&&(A.currentAttack=0),A.attack&&A.attack<0&&(A.attack=0);const M=C>=0?`+${C}`:`${C}`,Q=R>=0?`+${R}`:`${R}`;o.logs.push(`${A.name}  ${M}/${Q} `)}else o.logs.push("")}break}}return o}const kL=t=>{const e=n=>{const r=n.board.some(i=>i&&i.name.includes("")),s=n.hand.map(i=>{var c;const o=i.baseCost!==void 0?i.baseCost:i.cost;let l=o;return r&&((c=i.tags)!=null&&c.includes("Knuckler"))&&(l=Math.max(0,o-2)),i.cost!==l?{...i,cost:l,baseCost:o}:i});return{...n,hand:s}};return{...t,players:{p1:e(t.players.p1),p2:e(t.players.p2)}}},RL=(t,e)=>{let n=AL(t,e);return n=kL(n),n.lastHash=TL(n),n},AL=(t,e)=>{var s,i,o,l,c,d,u,h,f,E,k,w,$,v,_,S,p,D,H,ne,V,ee,de,ve,je;console.log(`[Reducer] Action: ${e.type}, isRemote: ${e.isRemote}`);let n={...t,players:{p1:{...t.players.p1,hand:[...t.players.p1.hand],deck:[...t.players.p1.deck],board:t.players.p1.board.map(ue=>ue?{...ue,passiveAbilities:ue.passiveAbilities?[...ue.passiveAbilities]:[]}:null),graveyard:[...t.players.p1.graveyard]},p2:{...t.players.p2,hand:[...t.players.p2.hand],deck:[...t.players.p2.deck],board:t.players.p2.board.map(ue=>ue?{...ue,passiveAbilities:ue.passiveAbilities?[...ue.passiveAbilities]:[]}:null),graveyard:[...t.players.p2.graveyard]}},logs:[...t.logs||[]]};const r=Q0(n.rngSeed||999);switch(n.rngSeed=Math.floor(r()*1e6),e.type){case"START_GAME":return t;case"END_TURN":{const ue=t.activePlayerId,I=n.players[ue];I.extraPpActive&&(I.id!==t.firstPlayerId&&(n.turnCount<=5?I.extraPpUsedEarly=!0:I.extraPpUsedLate=!0),I.extraPpActive=!1);const O=[...n.pendingEffects||[]];I.board.forEach(y=>{y&&y.triggers&&y.triggers.filter(g=>g.trigger==="END_OF_TURN").forEach(g=>{g.effects.forEach(T=>{O.push({sourceCard:y,effect:T,sourcePlayerId:ue})})})});const C=Qp(ue),R=n.players[C];if(R.board.forEach((y,g)=>{y&&y.triggers&&y.triggers.filter(T=>T.trigger==="START_OF_TURN").forEach(T=>{T.effects.forEach(A=>{A.type==="DESTROY_SELF"?y&&(n.players[C].graveyard.push(y),n.players[C].board[g]=null,n.logs.push(`${y.name} `)):O.push({sourceCard:y,effect:A,sourcePlayerId:C})})})}),n.players[C].board=n.players[C].board.filter(Boolean),R.maxPp=Math.min(10,R.maxPp+1),R.pp=R.maxPp,R.deck.length>0){const y=R.deck.pop();y&&(R.hand.length<9?R.hand.push(y):(R.graveyard.push(y),n.logs.push(`${R.name}${y.name}`)))}return R.board=R.board.filter(Boolean),R.board.forEach(y=>{y&&(y.canAttack=!0,y.attacksMade=0,y.turnPlayed=-1)}),R.canEvolveThisTurn=!0,n.activePlayerId=C,n.pendingEffects=O,C===t.firstPlayerId&&(n.turnCount+=1),n.logs.push(` ${n.turnCount} - ${R.name} `),n}case"CONCEDE":{const ue=e.playerId,I=n.players[ue];if(!I)return console.warn(`[Engine] CONCEDE: Unknown playerId: ${ue}. Ignoring.`),t;if(t.phase==="GAME_OVER")return console.warn("[Engine] CONCEDE: Game already over. Ignoring."),t;const O=Qp(ue);return n.phase="GAME_OVER",n.winnerId=O,n.logs.push(`${I.name} `),console.log(`[Engine] CONCEDE: ${ue} surrendered. Winner: ${O}`),n}case"RESOLVE_EFFECT":{if(!n.pendingEffects||n.pendingEffects.length===0)return n;const[ue,...I]=n.pendingEffects;console.log(`[Engine] RESOLVE_EFFECT: Processing ${ue.effect.type} from ${ue.sourceCard.name}. Remaining: ${I.length}`);const O=((s=e.payload)==null?void 0:s.targetId)||ue.targetId;let C=CL(n,ue.sourcePlayerId,ue.sourceCard,ue.effect,O,ue.targetIds);const R=(C.pendingEffects||[]).filter(g=>{var T;return!((T=n.pendingEffects)!=null&&T.includes(g))}),y=[...I,...R];return console.log(`[Engine] RESOLVE_EFFECT done. Remaining: ${I.length}, NewlyAdded: ${R.length}, Final: ${y.length}`),y.length===0&&Object.values(C.players).forEach(g=>{g.board=g.board.filter(Boolean)}),{...C,pendingEffects:y}}case"PLAY_CARD":{if(!e.isRemote&&n.activePlayerId!==e.playerId)return n;const{cardIndex:ue,targetId:I,instanceId:O}=e.payload,C={...n.players.p1,hand:[...n.players.p1.hand],deck:[...n.players.p1.deck],board:[...n.players.p1.board],graveyard:[...n.players.p1.graveyard]},R={...n.players.p2,hand:[...n.players.p2.hand],deck:[...n.players.p2.deck],board:[...n.players.p2.board],graveyard:[...n.players.p2.graveyard]},y=e.playerId==="p1"?C:R;console.log(`[Engine] PLAY_CARD: playerId=${e.playerId}, cardIndex=${ue}, instanceId=${O}, handLength=${y.hand.length}, isRemote=${e.isRemote}`),console.log("[Engine] PLAY_CARD: hand cards:",y.hand.map(te=>`${te.name}(${te.instanceId})`));let g=ue;if(O){const te=y.hand.findIndex(X=>X.instanceId===O);if(te>=0)g=te,console.log(`[Engine] PLAY_CARD: Using instanceId ${O}, found at index ${te} (was ${ue})`);else return console.log(`[Engine] PLAY_CARD: instanceId ${O} not found in hand!`),n}if(g<0||g>=y.hand.length)return console.log("[Engine] PLAY_CARD: Invalid cardIndex! Returning unchanged state."),n;const T=y.hand[g];let A="";if(I){const X=(e.playerId==="p1"?R:C).board.find(Pe=>(Pe==null?void 0:Pe.instanceId)===I);X&&(A=` (: ${X.name})`)}if(n.logs.push(`${y.name}  ${T.name} ${A}`),y.pp<T.cost)return n;const M=y.board.filter(te=>te!==null).length;if(T.type==="FOLLOWER"&&M>=5)return n;const Q=y.pp;y.pp-=T.cost,y.extraPpActive&&Q-1<T.cost&&(y.id!==t.firstPlayerId&&(n.turnCount<=5?y.extraPpUsedEarly=!0:y.extraPpUsedLate=!0),y.extraPpActive=!1,y.pp<0&&(y.pp=0),console.log("[Engine] PLAY_CARD: Extra PP consumed, marked as used"),n.logs.push(`${y.name} PP`)),y.hand.splice(g,1);let U=T;if(T.type==="FOLLOWER"){const te={...T,instanceId:e.payload.instanceId||`inst_${n.rngSeed}_${Math.floor(r()*1e3)}`,currentAttack:T.attack||0,currentHealth:T.health||0,maxHealth:T.health||0,canAttack:!1,hasEvolved:!1,attacksMade:0,turnPlayed:n.turnCount,hasBarrier:((i=T.passiveAbilities)==null?void 0:i.includes("BARRIER"))??!1,passiveAbilities:T.passiveAbilities?[...T.passiveAbilities]:[],hadStealth:((o=T.passiveAbilities)==null?void 0:o.includes("STEALTH"))??!1};((l=T.passiveAbilities)!=null&&l.includes("STORM")||(c=T.passiveAbilities)!=null&&c.includes("RUSH"))&&(te.canAttack=!0),(d=te.tags)!=null&&d.includes("Knuckler")&&!te.passiveAbilities.includes("STORM")&&y.board.some(Pe=>(Pe==null?void 0:Pe.name)==="")&&(te.passiveAbilities.push("STORM"),te.canAttack=!0,n.logs.push(`${te.name}   `)),y.board.push(te),U=te,te.name===""&&y.board.forEach(X=>{var Pe,we;X&&((Pe=X.tags)!=null&&Pe.includes("Knuckler"))&&X.instanceId!==te.instanceId&&((we=X.passiveAbilities)!=null&&we.includes("STORM")||(X.passiveAbilities||(X.passiveAbilities=[]),X.passiveAbilities.push("STORM"),X.canAttack=!0,n.logs.push(`${X.name}   `)))})}else y.graveyard.push({...T,instanceId:`spell_${n.rngSeed}_${Math.floor(r()*1e3)}`});const ge=[];(u=T.triggers)==null||u.filter(te=>te.trigger==="FANFARE").forEach(te=>ge.push(...te.effects)),(h=T.triggerAbilities)!=null&&h.FANFARE&&ge.push(T.triggerAbilities.FANFARE);let z=[...n.pendingEffects||[]];return ge.forEach(te=>{if(te.conditions&&te.conditions.minTurn&&n.turnCount<te.conditions.minTurn)return;let X;if(te.targetType==="OPPONENT"||te.targetType==="SELF"||te.targetType==="ALL_FOLLOWERS"||te.targetType==="ALL_OTHER_FOLLOWERS"||te.type==="RANDOM_DESTROY"||te.type==="RANDOM_SET_HP"||te.type==="AOE_DAMAGE"||te.type==="RANDOM_DAMAGE"||te.type==="RANDOM_DAMAGE_BY_TURN"){const we=e.playerId==="p1"?"p2":"p1",We=e.playerId;if(te.type==="RANDOM_DAMAGE_BY_TURN"){const be=te.targetType==="SELF"?We:we,Me=n.players[be].board,yt=n.turnCount;X=[];for(let rt=0;rt<yt;rt++){const tt=Me.map((Ne,st)=>Ne?st:-1).filter(Ne=>Ne!==-1);if(tt.length===0)break;const qe=Math.floor(r()*tt.length);X.push(Me[tt[qe]].instanceId)}}else if(te.type==="RANDOM_DESTROY"||te.type==="RANDOM_SET_HP"||te.type==="RANDOM_DAMAGE"){const be=te.targetType==="SELF"?We:we,Me=n.players[be].board,yt=te.type==="RANDOM_DAMAGE"?te.value2||1:te.value||1,rt=Me.map((qe,Ne)=>qe?Ne:-1).filter(qe=>qe!==-1);for(let qe=rt.length-1;qe>0;qe--){const Ne=Math.floor(r()*(qe+1));[rt[qe],rt[Ne]]=[rt[Ne],rt[qe]]}X=rt.slice(0,yt).map(qe=>Me[qe].instanceId)}else if(te.targetType==="ALL_FOLLOWERS"||te.type==="AOE_DAMAGE"){const be=te.type==="GRANT_PASSIVE"||te.type==="BUFF_STATS",Me=be?We:we;X=n.players[Me].board.filter(rt=>rt!==null).map(rt=>rt.instanceId),console.log(`[Engine] Pre-calculated ALL_FOLLOWERS targets (${be?"ally":"enemy"}): ${X.length} units`)}else te.targetType==="ALL_OTHER_FOLLOWERS"&&(X=n.players[We].board.filter(Me=>Me!==null&&Me.instanceId!==U.instanceId).map(Me=>Me.instanceId))}const Pe=te.targetType==="SELECT_FOLLOWER"||te.targetType==="SELECT_ALLY_FOLLOWER"||te.targetType==="SELECT_OTHER_ALLY_FOLLOWER";z.push({sourceCard:U,effect:te,sourcePlayerId:e.playerId,targetId:Pe?I:void 0,targetIds:X})}),console.log(`[Engine] PLAY_CARD: Queued ${ge.length} effects. Total pending: ${z.length}`),{...n,players:{p1:C,p2:R},pendingEffects:z}}case"EVOLVE":{const{followerIndex:ue,targetId:I,useSep:O}=e.payload,C={...n.players.p1,hand:[...n.players.p1.hand],deck:[...n.players.p1.deck],board:n.players.p1.board.map(U=>U?{...U,passiveAbilities:U.passiveAbilities?[...U.passiveAbilities]:void 0}:null),graveyard:[...n.players.p1.graveyard]},R={...n.players.p2,hand:[...n.players.p2.hand],deck:[...n.players.p2.deck],board:n.players.p2.board.map(U=>U?{...U,passiveAbilities:U.passiveAbilities?[...U.passiveAbilities]:void 0}:null),graveyard:[...n.players.p2.graveyard]},y=e.playerId==="p1"?C:R,g=y.board[ue];if(!g||g.hasEvolved)return n;const T=e.isRemote;if(console.log(`[Engine] EVOLVE Logic: name=${g.name}, useSep=${O}, isRemote=${T}, turn=${t.turnCount}`),n.logs.push(`${y.name}  ${g.name} ${O?"":""}`),O){if(!T){if(t.turnCount<6)return console.log(`[Engine] Cannot Super Evolve: Turn ${t.turnCount} < 6`),n;if(y.sep<=0)return console.log("[Engine] Cannot Super Evolve: No SEP"),n;if(!y.canEvolveThisTurn)return console.log("[Engine] Cannot Super Evolve: Already evolved this turn"),n}y.sep=Math.max(0,y.sep-1),y.canEvolveThisTurn=!1,g.hasEvolved=!0,g.currentAttack+=3,g.currentHealth+=3,g.maxHealth+=3,g.canAttack=!0;const U=[...g.passiveAbilities||[]];U.includes("IMMUNE_TO_DAMAGE_MY_TURN")||U.push("IMMUNE_TO_DAMAGE_MY_TURN"),!U.includes("STORM")&&!U.includes("RUSH")&&U.push("RUSH"),g.passiveAbilities=U,console.log(`[Engine] Super Evolved ${g.name}! SEP remaining: ${y.sep}`)}else{if(!T){const z=e.playerId===t.firstPlayerId?5:4;if(t.turnCount<z)return console.log(`[Engine] Cannot Evolve: Turn ${t.turnCount} < ${z}`),n;if(y.evolutionsUsed>=2)return console.log("[Engine] Cannot Evolve: Limit reached"),n;if(!y.canEvolveThisTurn)return console.log("[Engine] Cannot Evolve: Already evolved this turn"),n}y.evolutionsUsed+=1,y.canEvolveThisTurn=!1,g.hasEvolved=!0,g.currentAttack+=2,g.currentHealth+=2,g.maxHealth+=2,g.canAttack=!0;const U=[...g.passiveAbilities||[]];!U.includes("STORM")&&!U.includes("RUSH")&&U.push("RUSH"),g.passiveAbilities=U}const A=[];(f=g.triggers)==null||f.filter(U=>U.trigger==="EVOLVE").forEach(U=>A.push(...U.effects)),(E=g.triggerAbilities)!=null&&E.EVOLVE&&A.push(g.triggerAbilities.EVOLVE),O&&((k=g.triggers)==null||k.filter(U=>U.trigger==="SUPER_EVOLVE").forEach(U=>A.push(...U.effects)));let M=[...n.pendingEffects||[]];return A.forEach(U=>{if(U.conditions&&U.conditions.minTurn&&n.turnCount<U.conditions.minTurn)return;let ge;const z=e.playerId==="p1"?"p2":"p1",Te=e.playerId;if(U.type==="RANDOM_DESTROY"||U.type==="RANDOM_SET_HP"||U.type==="RANDOM_DAMAGE"){const te=U.targetType==="SELF"?Te:z,X=n.players[te].board,Pe=U.type==="RANDOM_DAMAGE"?U.value2||1:U.value||1,we=X.map((be,Me)=>be?Me:-1).filter(be=>be!==-1);for(let be=we.length-1;be>0;be--){const Me=Math.floor(r()*(be+1));[we[be],we[Me]]=[we[Me],we[be]]}ge=we.slice(0,Pe).map(be=>X[be].instanceId)}else U.targetType==="ALL_FOLLOWERS"||U.type==="AOE_DAMAGE"?(ge=n.players[z].board.filter(X=>X!==null).map(X=>X.instanceId),console.log(`[Engine EVOLVE] Pre-calculated ALL_FOLLOWERS targets: ${ge.length} units`)):U.targetType==="ALL_OTHER_FOLLOWERS"&&(ge=n.players[Te].board.filter(X=>X!==null&&X.instanceId!==g.instanceId).map(X=>X.instanceId));M.push({sourceCard:g,effect:U,sourcePlayerId:e.playerId,targetId:I,targetIds:ge})}),console.log(`[Engine] EVOLVE: Queued ${A.length} effects. Total pending: ${M.length}`),{...n,players:{p1:C,p2:R},pendingEffects:M}}case"ATTACK":{console.log(`[Engine] ATTACK received. Incoming state P1 HP: ${t.players.p1.hp}, P2 HP: ${t.players.p2.hp}`);const{attackerIndex:ue,targetIndex:I,targetIsLeader:O}=e.payload,C={...n.players.p1,board:n.players.p1.board.map(X=>X?{...X,passiveAbilities:X.passiveAbilities?[...X.passiveAbilities]:void 0}:null),graveyard:[...n.players.p1.graveyard]},R={...n.players.p2,board:n.players.p2.board.map(X=>X?{...X,passiveAbilities:X.passiveAbilities?[...X.passiveAbilities]:void 0}:null),graveyard:[...n.players.p2.graveyard]},y=e.playerId==="p1",g=y?C:R,T=y?R:C,A=g.board[ue];if(!A||!A.canAttack)return n;const M=T.board.filter(X=>{var Pe,we;return X&&((Pe=X.passiveAbilities)==null?void 0:Pe.includes("WARD"))&&!((we=X.passiveAbilities)!=null&&we.includes("STEALTH"))}),Q=((w=A.passiveAbilities)==null?void 0:w.includes("STEALTH"))||A.hadStealth;if(M.length>0&&!Q){if(O)return console.log("[Engine] Attack blocked: Must attack Ward unit first."),n;const X=T.board[I];if(X&&!(($=X.passiveAbilities)!=null&&$.includes("WARD")))return console.log("[Engine] Attack blocked: Must attack Ward unit first."),n}if(O===!1){const X=T.board[I];if(X&&((v=X.passiveAbilities)!=null&&v.includes("STEALTH")))return console.log("[Engine] ATTACK blocked: Target has STEALTH"),n}const U=(_=A.passiveAbilities)==null?void 0:_.includes("RUSH"),ge=(S=A.passiveAbilities)==null?void 0:S.includes("STORM");if(U&&!ge&&O&&A.turnPlayed===n.turnCount)return console.log("[Engine] ATTACK blocked: RUSH unit cannot attack leader on the turn it was played"),n;(p=A.passiveAbilities)!=null&&p.includes("STEALTH")&&(A.passiveAbilities=A.passiveAbilities.filter(X=>X!=="STEALTH"),n.logs.push(`${A.name} `)),A.canAttack=!1,A.attacksMade=(A.attacksMade||0)+1,(D=A.passiveAbilities)!=null&&D.includes("DOUBLE_ATTACK")&&A.attacksMade<2&&(A.canAttack=!0);const z=A.currentAttack;console.log(`[Engine] Attack: ${A.name} (${z}) -> Target (Leader? ${O}). DefHP before: ${T.hp}`);const Te=(X,Pe)=>{var We;const we=(We=X.triggers)==null?void 0:We.find(be=>be.trigger==="LAST_WORD");if(we){const be=we.effects.map(Me=>({sourceCard:X,effect:Me,sourcePlayerId:Pe}));n.pendingEffects=[...n.pendingEffects||[],...be],n.logs.push(`${X.name} `),console.log(`[Engine] Last Word triggered for ${X.name}. pendingEffects count: ${n.pendingEffects.length}`)}};if(O){const X="";if(n.logs.push(`${A.name}  ${X} `),T.leaderDamageShield)T.leaderDamageShield=!1,n.logs.push(`${A.name}  ${X}  ${z} `);else{const Pe=T.board.some(We=>{var be;return(be=We==null?void 0:We.passiveAbilities)==null?void 0:be.includes("LEADER_DAMAGE_CAP")}),we=Pe?Math.min(z,1):z;T.hp-=we,Pe&&z>1?n.logs.push(`${A.name}  ${X}  ${z} 1`):n.logs.push(`${A.name}  ${X}  ${we} `),T.hp<=0&&(n.winnerId=e.playerId)}}else{const X=T.board[I];if(!X)return console.log(`[Engine] Attack target at index ${I} no longer exists. Skipping.`),n;n.logs.push(`${A.name}  ${X.name} `);let Pe=z;(H=X.passiveAbilities)!=null&&H.includes("IMMUNE_TO_FOLLOWER_DAMAGE")?(Pe=0,n.logs.push(`${X.name} `)):X.hasBarrier&&Pe>0?(Pe=0,X.hasBarrier=!1,n.logs.push(`${X.name} `)):n.logs.push(`${A.name}  ${X.name}  ${Pe} `),X.currentHealth-=Pe;const we=y?"p2":"p1",We=((ne=X.passiveAbilities)==null?void 0:ne.includes("IMMUNE_TO_DAMAGE_MY_TURN"))&&n.activePlayerId===we;(V=A.passiveAbilities)!=null&&V.includes("BANE")&&X.currentHealth>0&&(We?n.logs.push(`${X.name} `):(X.currentHealth=0,X.killedByBane=!0,n.logs.push(`${A.name}  ${X.name} `)));let be=X.currentAttack;(ee=A.passiveAbilities)!=null&&ee.includes("IMMUNE_TO_DAMAGE_MY_TURN")&&(be=0,n.logs.push(`${A.name} `)),A.hasBarrier&&be>0?(be=0,A.hasBarrier=!1,n.logs.push(`${A.name} `)):be>0&&n.logs.push(`${X.name}  ${A.name}  ${be} `),A.currentHealth-=be;const Me=y?"p1":"p2";A.currentHealth<=0&&((de=A.passiveAbilities)!=null&&de.includes("GUTS_MY_TURN"))&&n.activePlayerId===Me&&(A.currentHealth=1,n.logs.push(`${A.name} 1`));const yt=((ve=A.passiveAbilities)==null?void 0:ve.includes("IMMUNE_TO_DAMAGE_MY_TURN"))&&n.activePlayerId===Me;(je=X.passiveAbilities)!=null&&je.includes("BANE")&&A.currentHealth>0&&(yt?n.logs.push(`${A.name} `):(A.currentHealth=0,A.killedByBane=!0,n.logs.push(`${X.name}  ${A.name} `)));const rt=X.currentHealth<=0,tt=A.currentHealth<=0;rt&&(X.currentHealth=Math.min(0,X.currentHealth),T.graveyard.push(X),T.board[I]=null,n.logs.push(`${X.name} `)),tt&&(A.currentHealth=Math.min(0,A.currentHealth),g.graveyard.push(A),g.board[ue]=null,n.logs.push(`${A.name} `)),rt&&Te(X,y?"p2":"p1"),tt&&Te(A,y?"p1":"p2")}console.log(`[Engine] Committing state. P1 HP: ${C.hp}, P2 HP: ${R.hp}`);const te={...n,players:{p1:C,p2:R}};return console.log(`[Engine] After commit. finalState.players.p1.hp: ${te.players.p1.hp}, finalState.players.p2.hp: ${te.players.p2.hp}`),te}case"REINIT_GAME":{const{p1Class:ue,p2Class:I}=e.payload;return console.log(`[Engine] REINIT_GAME: p1=${ue}, p2=${I}`),Ed("Player 1",ue,"Player 2",I)}case"SYNC_STATE":return console.log("[Engine] SYNC_STATE received"),e.payload;case"UPDATE_PLAYER_NAME":{const{playerId:ue,name:I}=e.payload;return console.log("[Engine] UPDATE_PLAYER_NAME:",ue,I),t.players[ue]?{...t,players:{...t.players,[ue]:{...t.players[ue],name:I}}}:(console.warn("[Engine] UPDATE_PLAYER_NAME: Unknown playerId:",ue),t)}case"TOGGLE_EXTRA_PP":{const ue=e.playerId,I=n.players[ue];if(!(ue!==t.firstPlayerId))return console.log("[Engine] TOGGLE_EXTRA_PP: Only second player can use Extra PP"),t;if(t.activePlayerId!==ue)return console.log("[Engine] TOGGLE_EXTRA_PP: Can only toggle on your turn"),t;if(I.extraPpActive)return I.extraPpActive=!1,I.pp=Math.max(0,I.pp-1),console.log("[Engine] TOGGLE_EXTRA_PP: Deactivated, PP now",I.pp),n;if(n.turnCount<=5){if(I.extraPpUsedEarly)return console.log("[Engine] TOGGLE_EXTRA_PP: Already used in early turns"),t}else if(I.extraPpUsedLate)return console.log("[Engine] TOGGLE_EXTRA_PP: Already used in late turns"),t;return I.extraPpActive=!0,I.pp+=1,console.log("[Engine] TOGGLE_EXTRA_PP: Activated, PP now",I.pp),n}default:return t}},PL=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},ro=({card:t,onClick:e,style:n,isSelected:r,isPlayable:s,variant:i="normal",turnCount:o,isOnBoard:l,isSpecialSummoning:c,className:d,suppressPassives:u,isMyTurn:h,scale:f=1})=>{const E="currentAttack"in t?t.currentAttack:t.attack,k="currentHealth"in t?t.currentHealth:t.health,w="maxHealth"in t?t.maxHealth:t.health,$="canAttack"in t?t.canAttack:!1,v="turnPlayed"in t?t.turnPlayed:void 0,[_,S]=j.useState(!1);j.useEffect(()=>{if(c&&l){S(!0);const M=setTimeout(()=>S(!1),800);return()=>clearTimeout(M)}},[c,l]);const p="baseAttack"in t?t.baseAttack:void 0,D="baseHealth"in t?t.baseHealth:void 0,H=p!==void 0&&E>p,ne=D!==void 0&&(k>D||w>D),V="hasEvolved"in t?t.hasEvolved:!1,ee="evolvedImageUrl"in t?t.evolvedImageUrl:void 0,de=V&&ee?ee:t.imageUrl,ve=de?PL(de):void 0;let je=n==null?void 0:n.boxShadow,ue;const I=t.passiveAbilities||t.abilities||[],O=I.includes("WARD"),C=I.includes("AURA"),R=I.includes("STEALTH"),y=t.hasBarrier===!0||I.includes("BARRIER")&&t.hasBarrier!==!1;if(r)je="0 0 15px rgba(255, 255, 255, 0.8)";else if(s)je="0 0 10px #48bb78",ue="2px solid #48bb78";else if($&&h){const M=I.includes("STORM"),Q=I.includes("RUSH"),U=o!==void 0&&v!==void 0&&v===o;let ge=!1;M||(U?ge=!0:(o===void 0||v===void 0)&&(ge=Q)),ge?je="0 0 10px #f6e05e":je="0 0 10px #48bb78"}const g=k<w;if(i==="art-only")return a.jsx("div",{className:"card art-only",style:{width:140,height:200,...n,borderRadius:8,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",background:"#2d3748",position:"relative",boxShadow:"0 4px 6px rgba(0,0,0,0.3)"},children:ve?a.jsx("img",{src:ve,alt:t.name,draggable:!1,style:{width:"100%",height:"100%",objectFit:"cover"}}):a.jsx("div",{style:{fontSize:"1.5rem",opacity:.5,color:"white",fontWeight:"bold"},children:t.type})});if(i==="mobile-hand"){const Q=t.type==="SPELL"?16:6,U=28*f,ge=.85*f;return a.jsxs("div",{className:`card mobile-hand ${d||""}`,style:{width:80,height:115,...n,position:"relative",cursor:e?"pointer":"default",transform:r?"translateY(-8px)":n==null?void 0:n.transform,boxShadow:je||(n==null?void 0:n.boxShadow),border:ue||(s?"2px solid #48bb78":void 0),transition:"transform 0.2s, box-shadow 0.2s",background:"#1a202c",overflow:"hidden",borderRadius:`${Q}px ${Q}px 6px 6px`,backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},onClick:e,children:[a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"hidden",borderRadius:`${Q}px ${Q}px 6px 6px`},children:ve?a.jsx("img",{src:ve,alt:t.name,draggable:!1,style:{width:"100%",height:"100%",objectFit:"cover"}}):a.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"#4a5568",color:"#a0aec0",fontSize:"0.6rem"},children:t.type})}),a.jsxs("div",{style:{position:"absolute",top:3,left:4,display:"flex",flexDirection:"column",gap:2,zIndex:10},children:[a.jsx("div",{style:{width:U,height:U,borderRadius:"50%",background:"#48bb78",border:"1px solid rgba(255,255,255,0.8)",color:"white",fontSize:`${ge}rem`,fontWeight:900,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.6)"},children:t.cost}),t.type==="FOLLOWER"&&a.jsxs("div",{style:{width:U,height:U,display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[a.jsx("svg",{width:U,height:U,viewBox:"0 0 24 24",fill:"none",style:{position:"absolute",filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.8))"},children:a.jsx("polygon",{points:"12,2 22,22 2,22",fill:"#4299e1",stroke:"rgba(255,255,255,0.8)",strokeWidth:"1",strokeLinejoin:"round"})}),a.jsx("span",{style:{zIndex:1,color:H?"#faf089":"white",fontWeight:"bold",fontSize:`${ge}rem`,textShadow:"0 1px 2px black"},children:E})]}),t.type==="FOLLOWER"&&a.jsxs("div",{style:{width:U,height:U,display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[a.jsx("svg",{width:U,height:U,viewBox:"0 0 24 24",style:{position:"absolute",filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.8))"},children:a.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z",fill:"#c53030",stroke:"rgba(255,255,255,0.8)",strokeWidth:"1"})}),a.jsx("span",{style:{zIndex:1,color:ne?"#faf089":g?"#fc8181":"white",fontWeight:"bold",fontSize:`${ge}rem`,textShadow:"0 1px 2px black"},children:k})]})]})]})}const T=t.type==="SPELL"&&!l,A=T?20:8;return a.jsxs("div",{className:`card card-container ${$?"ready":""} ${l?"on-board":""} ${d||""}`,style:{width:140,height:200,...n,position:"relative",cursor:e?"pointer":"default",transform:r?"translateY(-10px)":n==null?void 0:n.transform,boxShadow:je||($?"0 0 10px #f6e05e":n==null?void 0:n.boxShadow),border:ue||(s?"2px solid #48bb78":void 0),transition:"transform 0.2s, box-shadow 0.2s",display:"flex",flexDirection:"column",background:"#1a202c",overflow:"visible",animation:_?"cardSummonAppear 0.8s cubic-bezier(0.22, 1, 0.36, 1) forwards":n==null?void 0:n.animation,backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",borderRadius:T?`${A}px ${A}px 8px 8px`:"8px"},onClick:e,children:[!l&&a.jsx("div",{style:{height:20,background:"rgba(0,0,0,0.8)",color:"#e2e8f0",fontSize:t.name.length>10?"0.6rem":"0.7rem",fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid rgba(255,255,255,0.2)",zIndex:2,transform:t.name.length>15?"scaleX(0.9)":"none",borderRadius:T?`${A}px ${A}px 0 0`:"8px 8px 0 0"},children:t.name}),a.jsxs("div",{style:{flex:1,position:"relative",width:"100%",background:"#2d3748",borderRadius:l?"8px":"0 0 8px 8px",minHeight:0},children:[a.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"hidden",borderRadius:l?"8px":"0 0 8px 8px",zIndex:1},children:[ve?a.jsx("img",{src:ve,alt:t.name,draggable:!1,style:{width:"100%",height:"100%",objectFit:"cover",display:"block"}}):a.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"#4a5568",color:"#a0aec0",fontSize:"0.8rem"},children:t.type}),a.jsx("div",{style:{position:"absolute",bottom:0,left:0,width:"100%",height:40,background:"linear-gradient(to top, rgba(0,0,0,0.8), transparent)",pointerEvents:"none",zIndex:3}})]}),!l&&a.jsx("div",{style:{position:"absolute",top:2*f,left:2*f,width:24*f,height:24*f,borderRadius:"50%",background:"#48bb78",border:`${Math.max(1,2*f)}px solid #fff`,color:"white",fontSize:`${.9*f}rem`,fontWeight:900,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 2px 4px rgba(0,0,0,0.5), inset 0 2px 5px rgba(255,255,255,0.3)",zIndex:10},children:t.cost}),t.type==="FOLLOWER"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{position:"absolute",bottom:l?2*f:40*f,left:2*f,width:32*f,height:32*f,zIndex:10,display:"flex",alignItems:"center",justifyContent:"center"},children:[a.jsxs("svg",{width:40*f,height:40*f,viewBox:"0 0 24 24",fill:"none",style:{position:"absolute",filter:"drop-shadow(0 2px 2px rgba(0,0,0,0.8))"},children:[a.jsx("defs",{children:a.jsxs("linearGradient",{id:"blueGrad",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[a.jsx("stop",{offset:"0%",stopColor:"#63b3ed"}),a.jsx("stop",{offset:"100%",stopColor:"#4299e1"})]})}),a.jsx("polygon",{points:"12,2 22,22 2,22",fill:"url(#blueGrad)",stroke:"white",strokeWidth:"1",strokeLinejoin:"round"})]}),a.jsx("span",{style:{zIndex:11,color:H?"#faf089":"white",fontWeight:"bold",fontSize:`${1.2*f}rem`,textShadow:"0 2px 2px black"},children:E})]}),a.jsxs("div",{style:{position:"absolute",bottom:2*f,right:l?2*f:"auto",left:l?"auto":2*f,width:32*f,height:32*f,zIndex:10,display:"flex",alignItems:"center",justifyContent:"center"},children:[a.jsxs("svg",{width:36*f,height:36*f,viewBox:"0 0 24 24",style:{position:"absolute",filter:"drop-shadow(0 2px 2px rgba(0,0,0,0.8))"},children:[a.jsx("defs",{children:a.jsxs("linearGradient",{id:"redGrad",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[a.jsx("stop",{offset:"0%",stopColor:"#f56565"}),a.jsx("stop",{offset:"100%",stopColor:"#c53030"})]})}),a.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z",fill:"url(#redGrad)",stroke:"white",strokeWidth:"1.5"})]}),a.jsx("span",{style:{zIndex:11,color:ne?"#faf089":g?"#fc8181":"white",fontWeight:"bold",fontSize:`${1.2*f}rem`,textShadow:"0 2px 2px black"},children:k})]})]}),l&&a.jsx("div",{style:{position:"absolute",top:-6*f,left:-6*f,right:-6*f,bottom:-6*f,zIndex:50,pointerEvents:"none",opacity:O&&!u?1:0,transition:"opacity 0.2s ease-in-out"},children:a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,animation:"wardPulseLoop 2.5s infinite ease-in-out"},children:a.jsxs("svg",{viewBox:"0 0 100 120",preserveAspectRatio:"none",style:{width:"100%",height:"100%"},children:[a.jsx("defs",{children:a.jsxs("filter",{id:"wardGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{stdDeviation:"2",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsx("path",{d:"M50 2 L96 20 V60 C96 90 50 116 50 116 C50 116 4 90 4 60 V20 Z",fill:"rgba(255, 255, 255, 0.12)",stroke:"#ECC94B",strokeWidth:"3",filter:"url(#wardGlow)"})]})})}),l&&a.jsxs("div",{style:{position:"absolute",top:-5*f,left:-5*f,right:-5*f,bottom:-5*f,zIndex:21,pointerEvents:"none",opacity:y&&!_&&!u?1:0,transition:"opacity 0.2s ease-in-out"},children:[a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,borderRadius:"50%",background:"radial-gradient(ellipse at center, rgba(99, 179, 237, 0.12) 0%, transparent 60%)",animation:"barrierGlowLoop 3s infinite ease-in-out"}}),a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,borderRadius:"50%",border:`${Math.max(1.5,2*f)}px solid rgba(99, 179, 237, 0.9)`,boxShadow:"0 0 6px rgba(66, 153, 225, 0.5), inset 0 0 8px rgba(99, 179, 237, 0.15)",animation:"barrierPulseLoop 3s infinite ease-in-out"}})]}),l&&a.jsx("div",{style:{position:"absolute",top:-6*f,left:-6*f,right:-6*f,bottom:-6*f,zIndex:22,pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center",opacity:C&&!_&&!u?1:0,transition:"opacity 0.2s ease-in-out"},children:a.jsx("div",{style:{width:"100%",height:"100%",position:"relative",animation:"auraPulseLoop 3s infinite ease-in-out"},children:a.jsxs("svg",{viewBox:"0 0 100 100",style:{width:"100%",height:"100%"},children:[a.jsx("defs",{children:a.jsxs("filter",{id:"auraGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{stdDeviation:"1.5",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsx("path",{d:"M40 5 L60 5 L60 30 L95 30 L95 45 L60 45 L60 95 L40 95 L40 45 L5 45 L5 30 L40 30 Z",fill:"rgba(255, 204, 0, 0.2)",stroke:"#f6ad55",strokeWidth:"2.5",filter:"url(#auraGlow)"})]})})}),l&&a.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:13,pointerEvents:"none",overflow:"hidden",borderRadius:"0 0 8px 8px",opacity:R&&!_&&!u?1:0,transition:"opacity 0.2s ease-in-out"},children:[a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:"120%",height:"120%",transform:"translate(-50%, -50%)",background:"radial-gradient(circle, rgba(0, 0, 0, 0.9) 0%, rgba(0, 0, 0, 0.6) 30%, rgba(0, 0, 0, 0.2) 60%, transparent 80%)",filter:"blur(10px)",animation:"stealthInkMove 3s infinite ease-in-out",mixBlendMode:"multiply"}}),a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:"100%",height:"100%",transform:"translate(-50%, -50%)",background:"radial-gradient(circle, rgba(20, 20, 30, 0.85) 0%, rgba(10, 10, 20, 0.4) 40%, transparent 70%)",filter:"blur(8px)",animation:"stealthInkPulse 1.5s infinite ease-in-out",mixBlendMode:"multiply"}}),a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:"70%",height:"70%",transform:"translate(-50%, -50%)",background:"radial-gradient(circle, rgba(255, 255, 255, 0.4) 0%, rgba(200, 200, 200, 0.25) 30%, transparent 60%)",filter:"blur(8px)",animation:"stealthMistMove 4s infinite ease-in-out",mixBlendMode:"screen"}}),a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,boxShadow:"inset 0 0 30px rgba(0, 0, 0, 0.85), 0 0 20px rgba(0, 0, 0, 0.6)",animation:"stealthPulse 1.5s infinite ease-in-out"}})]})]}),_&&a.jsx("div",{style:{position:"absolute",inset:0,borderRadius:8,background:"radial-gradient(circle, rgba(255,255,255,0.8) 0%, transparent 70%)",mixBlendMode:"overlay",animation:"cardSummonFlash 0.8s ease-out forwards",pointerEvents:"none",zIndex:100}}),a.jsx("style",{children:`
                @keyframes cardSummonAppear {
                    0% { opacity: 0; transform: scale(1.5); filter: brightness(2) blur(4px); }
                    100% { opacity: 1; transform: scale(1); filter: brightness(1) blur(0px); }
                }
                @keyframes cardSummonFlash {
                    0% { opacity: 0.8; transform: scale(1.2); }
                    100% { opacity: 0; transform: scale(1); }
                }
                @keyframes wardPulseLoop {
                    0% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(255, 255, 255, 0.5)); }
                    50% { transform: scale(1.08); opacity: 0.5; filter: blur(3px) drop-shadow(0 0 15px rgba(255, 255, 255, 0.8)); }
                    100% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(255, 255, 255, 0.5)); }
                }
                @keyframes barrierPulseLoop {
                    0% { transform: scale(1); opacity: 1; box-shadow: 0 0 8px rgba(66, 153, 225, 0.6), inset 0 0 10px rgba(99, 179, 237, 0.2); }
                    50% { transform: scale(1.03); opacity: 0.85; box-shadow: 0 0 12px rgba(99, 179, 237, 0.8), inset 0 0 15px rgba(99, 179, 237, 0.3); }
                    100% { transform: scale(1); opacity: 1; box-shadow: 0 0 8px rgba(66, 153, 225, 0.6), inset 0 0 10px rgba(99, 179, 237, 0.2); }
                }
                @keyframes barrierGlowLoop {
                    0% { transform: scale(1); opacity: 0.6; }
                    50% { transform: scale(1.05); opacity: 0.4; }
                    100% { transform: scale(1); opacity: 0.6; }
                }
                @keyframes auraPulseLoop {
                    0% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(246, 173, 85, 0.5)); }
                    50% { transform: scale(1.12); opacity: 0.4; filter: blur(4px) drop-shadow(0 0 20px rgba(255, 204, 0, 0.8)); }
                    100% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(246, 173, 85, 0.5)); }
                }
                @keyframes stealthInkMove {
                    0%, 100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 0.7; }
                    25% { transform: translate(-45%, -55%) scale(1.15) rotate(3deg); opacity: 1; }
                    50% { transform: translate(-50%, -50%) scale(0.95) rotate(0deg); opacity: 0.5; }
                    75% { transform: translate(-55%, -45%) scale(1.1) rotate(-3deg); opacity: 0.9; }
                }
                @keyframes stealthInkPulse {
                    0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.8; }
                    50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.4; }
                }
                @keyframes stealthMistMove {
                    0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.5; }
                    25% { transform: translate(-48%, -52%) scale(1.1); opacity: 0.8; }
                    50% { transform: translate(-52%, -48%) scale(1.2); opacity: 0.3; }
                    75% { transform: translate(-50%, -50%) scale(0.9); opacity: 0.7; }
                }
                @keyframes stealthPulse {
                    0%, 100% { opacity: 0.6; box-shadow: inset 0 0 50px rgba(0, 0, 0, 0.9), 0 0 30px rgba(0, 0, 0, 0.7); }
                    50% { opacity: 1; box-shadow: inset 0 0 70px rgba(0, 0, 0, 1), 0 0 40px rgba(0, 0, 0, 0.9); }
                }
                /* 3D flip support - ensure all child elements inherit backface-visibility */
                .card, .card * {
                    backface-visibility: hidden !important;
                    -webkit-backface-visibility: hidden !important;
                }
            `})]})},OL=35e5;function nI(){const[t,e]=L.useState(()=>w_());return L.useEffect(()=>{const n=()=>{e(w_())};return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),t}function w_(){const t=window.innerWidth*window.devicePixelRatio,e=window.innerHeight*window.devicePixelRatio,n=t*e,r=n>OL;let s="HD";return n>8e6?s="4K":n>35e5?s="1440p":n>2e6&&(s="1080p"),{isHighRes:r,isLightMode:r,pixelCount:n,resolution:s}}function LL(t){return t?{glowShadow:(e,n)=>`0 0 ${10*n}px ${e}`,blurAmount:4,enableGlowPulse:!1,dropShadow:e=>`drop-shadow(0 0 ${10*e}px rgba(255,255,255,0.6))`}:{glowShadow:(e,n)=>`
            0 0 ${15*n}px ${e},
            0 0 ${30*n}px ${e}80,
            0 0 ${60*n}px ${e}50
        `,blurAmount:8,enableGlowPulse:!0,dropShadow:e=>`drop-shadow(0 0 ${20*e}px rgba(255,255,255,0.8)) drop-shadow(0 0 ${40*e}px rgba(255,255,255,0.6))`}}const Sd=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},Jc=t=>Sd(t==="YORUKA"?"/leaders/yoRuka_leader.png":t==="AJA"?"/leaders/azya_leader.png":"/leaders/senka_leader.png"),DL=Sd("/assets/VS.png"),Jn=8,Ch=240,ML=({myPlayer:t,opponentPlayer:e,isFirstPlayer:n,onComplete:r,scale:s=1,onVsImpact:i,onCoinToss:o,onImpact:l,onOrbLand:c,onFadeInBoard:d,isMobile:u=!1})=>{const[h,f]=L.useState("fade-in"),[E,k]=L.useState(!1),{isLightMode:w}=nI(),$=LL(w),[v,_]=L.useState(1),[S,p]=L.useState(1),[D,H]=L.useState(0),[ne,V]=L.useState(0),[ee,de]=L.useState(1),[ve,je]=L.useState({myX:0,myY:0,opX:0,opY:0}),[ue,I]=L.useState(0),[O,C]=L.useState(0),[R,y]=L.useState([]),g=L.useMemo(()=>{const X=window.innerWidth,Pe=window.innerHeight,we=s,We=(u?280:340)*we,be=X-We,Me=We+be/2,yt=Me,rt=Pe- -20*we-Ch*we/2,tt=Me,qe=-20*we+Ch*we/2;return{player:{x:yt,y:rt},opponent:{x:tt,y:qe},leaderSize:Ch*we}},[u,s]),T=L.useMemo(()=>{const X=window.innerWidth,Pe=window.innerHeight,we=X*.25,We=Pe*.5,be=X*.75,Me=Pe*.5;return{myX:we,myY:We,opX:be,opY:Me}},[]),A=w?`0 0 ${10*s}px rgba(103, 232, 249, 0.8)`:`0 0 ${15*s}px rgba(103, 232, 249, 1), 0 0 ${30*s}px rgba(34, 211, 238, 0.8), 0 0 ${60*s}px rgba(6, 182, 212, 0.5)`,M=w?`0 0 ${10*s}px rgba(249, 168, 212, 0.8)`:`0 0 ${15*s}px rgba(249, 168, 212, 1), 0 0 ${30*s}px rgba(244, 114, 182, 0.8), 0 0 ${60*s}px rgba(236, 72, 153, 0.5)`,Q=$.enableGlowPulse?"glowPulse 2s ease-in-out infinite":"none";L.useEffect(()=>{const X={"fade-in":500,"leaders-enter":1200,nameplate:800,"vs-display":1500,"coin-toss":1500,"turn-order":1e3,"leader-to-orb":800,"orb-pause":1e3,"orb-fly":900,"leader-appear":600};if(h==="complete"){d==null||d();const We=setTimeout(()=>{r()},700);return()=>clearTimeout(We)}const Pe={"fade-in":"leaders-enter","leaders-enter":"nameplate",nameplate:"vs-display","vs-display":"coin-toss","coin-toss":"turn-order","turn-order":"leader-to-orb","leader-to-orb":"orb-pause","orb-pause":"orb-fly","orb-fly":"leader-appear","leader-appear":"complete"},we=setTimeout(()=>{const We=Pe[h];We&&f(We)},X[h]||1e3);return()=>clearTimeout(we)},[h,r,n]),L.useEffect(()=>{if(h==="vs-display"){const X=setTimeout(()=>{k(!0),i==null||i(),setTimeout(()=>k(!1),300)},800);return()=>clearTimeout(X)}},[h,i]),L.useEffect(()=>{h==="coin-toss"&&(o==null||o())},[h,o]),L.useEffect(()=>{if(h==="leaders-enter"){const X=setTimeout(()=>{l==null||l()},1e3);return()=>clearTimeout(X)}},[h,l]),L.useEffect(()=>{h==="nameplate"&&(l==null||l())},[h,l]),L.useEffect(()=>{if(h==="leader-to-orb"){const Pe=Date.now();let we;const We=()=>{const be=Date.now()-Pe,Me=Math.min(be/800,1),yt=1-Math.pow(1-Me,3);_(1-yt*.7),p(1-yt),H(yt*1.5),V(Math.min(yt*1.5,1)),Me<1&&(we=requestAnimationFrame(We))};return je(T),we=requestAnimationFrame(We),()=>cancelAnimationFrame(we)}},[h,T]),L.useEffect(()=>{if(h==="orb-pause"){const Pe=Date.now();let we;const We=()=>{const be=Date.now()-Pe,Me=Math.min(be/800,1);de(1-Me),Me<1&&(we=requestAnimationFrame(We))};return we=requestAnimationFrame(We),()=>cancelAnimationFrame(we)}},[h]),L.useEffect(()=>{if(h==="orb-fly"){const Pe=Date.now();let we;const We=T.myX,be=T.myY,Me=T.opX,yt=T.opY,rt=g.player.x,tt=g.player.y,qe=g.opponent.x,Ne=g.opponent.y,st=()=>{const vt=Date.now()-Pe,Ot=Math.min(vt/900,1),Ve=Ot*Ot*Ot,qt=We-200*s,ft=(be+tt)/2+100*s,on=(1-Ve)*(1-Ve)*We+2*(1-Ve)*Ve*qt+Ve*Ve*rt,zt=(1-Ve)*(1-Ve)*be+2*(1-Ve)*Ve*ft+Ve*Ve*tt,us=Me+200*s,ia=(yt+Ne)/2-100*s,oa=(1-Ve)*(1-Ve)*Me+2*(1-Ve)*Ve*us+Ve*Ve*qe,Ir=(1-Ve)*(1-Ve)*yt+2*(1-Ve)*Ve*ia+Ve*Ve*Ne;je({myX:on,myY:zt,opX:oa,opY:Ir}),H(1.5-Ve*1),Ot<1&&(we=requestAnimationFrame(st))};return we=requestAnimationFrame(st),()=>cancelAnimationFrame(we)}},[h,T,g,s]),L.useEffect(()=>{if(h==="leader-appear"){const Pe=Date.now();let we;c==null||c(),k(!0),setTimeout(()=>k(!1),300);const We=g.player.x,be=g.player.y,Me=g.opponent.x,yt=g.opponent.y,rt=24,tt=[];for(let st=0;st<rt;st++){const vt=st/rt*360+(Math.random()-.5)*15;tt.push({id:st,x:We,y:be,angle:vt,dist:80+Math.random()*120,size:8+Math.random()*12,delay:Math.random()*.1,color:`hsl(${200+Math.random()*40}, 80%, ${60+Math.random()*20}%)`})}for(let st=0;st<rt;st++){const vt=st/rt*360+(Math.random()-.5)*15;tt.push({id:rt+st,x:Me,y:yt,angle:vt,dist:80+Math.random()*120,size:8+Math.random()*12,delay:Math.random()*.1,color:`hsl(${0+Math.random()*30}, 80%, ${55+Math.random()*20}%)`})}y(tt);const qe=setTimeout(()=>{y([])},800),Ne=()=>{const st=Date.now()-Pe,vt=Math.min(st/600,1),Ot=1-Math.pow(1-vt,3);V(1-Ot),I(Ot),C(Ot),vt<1&&(we=requestAnimationFrame(Ne))};return we=requestAnimationFrame(Ne),()=>{cancelAnimationFrame(we),clearTimeout(qe)}}},[h,c,g]);const U=["fade-in","leaders-enter","nameplate","vs-display","coin-toss","turn-order","leader-to-orb","orb-pause","orb-fly","leader-appear","complete"].indexOf(h),ge=U>=3&&U<=9,z=U>=0&&U<=7,Te=`polygon(0 0, ${50+Jn}% 0, ${50-Jn}% 100%, 0 100%)`,te=`polygon(${50+Jn}% 0, 100% 0, 100% 100%, ${50-Jn}% 100%)`;return a.jsxs("div",{style:{position:"fixed",inset:0,background:U>=7?"transparent":"#0a0a0f",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",animation:E?"screenShake 0.3s ease-in-out":void 0,pointerEvents:U>=9?"none":"auto"},children:[a.jsx("div",{style:{position:"absolute",inset:0,background:"black",opacity:h==="fade-in"?1:0,transition:"opacity 0.5s ease-out",pointerEvents:"none",zIndex:1e4}}),z&&a.jsxs("div",{style:{opacity:ee,transition:"opacity 0.3s"},children:[U>=0&&a.jsxs("div",{style:{position:"absolute",inset:0,clipPath:Te,background:"linear-gradient(135deg, #0a1628 0%, #1a2a4a 50%, #0d1a30 100%)",transform:`translateX(${U>=1?"0":"-100%"})`,transition:"transform 1.2s cubic-bezier(0.22, 1, 0.36, 1)",zIndex:50,overflow:"hidden"},children:[a.jsx("div",{style:{position:"fixed",top:"50%",left:"25%",transform:"translate(-50%, -50%)",opacity:S},children:a.jsx("img",{src:Jc(t.class),alt:t.name,style:{height:"120vh",width:"auto",objectFit:"cover",objectPosition:t.class==="AJA"?"center top":"center",filter:"brightness(0.85) contrast(1.1)",transform:`scale(${v})`,transformOrigin:"center center"}})}),a.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(135deg, rgba(59, 130, 246, 0.3) 0%, transparent 60%)",pointerEvents:"none"}}),U>=2&&U<6&&a.jsx("div",{style:{position:"absolute",bottom:"12%",left:"15%",padding:`${16*s}px ${40*s}px`,background:"rgba(0,0,0,0.85)",borderRadius:8*s,borderLeft:"4px solid #3b82f6",animation:"nameplateSlideUp 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)",whiteSpace:"nowrap",boxShadow:"0 4px 30px rgba(59, 130, 246, 0.4)"},children:a.jsx("div",{style:{color:"white",fontSize:2.2*s+"rem",fontWeight:"bold",textShadow:"0 0 20px rgba(59, 130, 246, 0.8)"},children:t.name})}),U>=5&&U<6&&a.jsx("div",{style:{position:"absolute",top:"10%",left:"15%",padding:`${12*s}px ${32*s}px`,background:n?"rgba(239, 68, 68, 0.9)":"rgba(59, 130, 246, 0.9)",borderRadius:8*s,animation:"turnOrderFadeIn 1s ease-out",boxShadow:n?"0 0 30px rgba(239, 68, 68, 0.6)":"0 0 30px rgba(59, 130, 246, 0.6)"},children:a.jsx("div",{style:{color:"white",fontSize:1.8*s+"rem",fontWeight:"bold",letterSpacing:"0.1em"},children:n?"":""})})]}),U>=0&&a.jsxs("div",{style:{position:"absolute",inset:0,clipPath:te,background:"linear-gradient(225deg, #280a0a 0%, #4a1a1a 50%, #300d0d 100%)",transform:`translateX(${U>=1?"0":"100%"})`,transition:"transform 1.2s cubic-bezier(0.22, 1, 0.36, 1)",zIndex:50,overflow:"hidden"},children:[a.jsx("div",{style:{position:"fixed",top:"50%",left:"75%",transform:"translate(-50%, -50%)",opacity:S},children:a.jsx("img",{src:Jc(e.class),alt:e.name,style:{height:"120vh",width:"auto",objectFit:"cover",objectPosition:e.class==="AJA"?"center top":"center",filter:"brightness(0.85) contrast(1.1)",transform:`scale(${v})`,transformOrigin:"center center"}})}),a.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(225deg, rgba(239, 68, 68, 0.3) 0%, transparent 60%)",pointerEvents:"none"}}),U>=2&&U<6&&a.jsx("div",{style:{position:"absolute",bottom:"12%",right:"15%",padding:`${16*s}px ${40*s}px`,background:"rgba(0,0,0,0.85)",borderRadius:8*s,borderRight:"4px solid #ef4444",animation:"nameplateSlideUp 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)",whiteSpace:"nowrap",boxShadow:"0 4px 30px rgba(239, 68, 68, 0.4)"},children:a.jsx("div",{style:{color:"white",fontSize:2.2*s+"rem",fontWeight:"bold",textShadow:"0 0 20px rgba(239, 68, 68, 0.8)"},children:e.name})}),U>=5&&U<6&&a.jsx("div",{style:{position:"absolute",top:"10%",right:"15%",padding:`${12*s}px ${32*s}px`,background:n?"rgba(59, 130, 246, 0.9)":"rgba(239, 68, 68, 0.9)",borderRadius:8*s,animation:"turnOrderFadeIn 1s ease-out",boxShadow:n?"0 0 30px rgba(59, 130, 246, 0.6)":"0 0 30px rgba(239, 68, 68, 0.6)"},children:a.jsx("div",{style:{color:"white",fontSize:1.8*s+"rem",fontWeight:"bold",letterSpacing:"0.1em"},children:n?"":""})})]}),U>=1&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{position:"absolute",top:0,left:0,width:4*s,height:"100%",background:"linear-gradient(180deg, #67e8f9 0%, #22d3ee 30%, #06b6d4 50%, #22d3ee 70%, #67e8f9 100%)",boxShadow:A,zIndex:100,animation:Q}}),a.jsx("div",{style:{position:"absolute",top:0,left:0,width:`calc(${50+Jn}% + ${2*s}px)`,height:4*s,background:"linear-gradient(90deg, #67e8f9 0%, #22d3ee 30%, #06b6d4 50%, #22d3ee 70%, #67e8f9 100%)",boxShadow:A,zIndex:100,animation:Q}}),a.jsx("div",{style:{position:"absolute",bottom:0,left:0,width:`calc(${50-Jn}% + ${2*s}px)`,height:4*s,background:"linear-gradient(90deg, #67e8f9 0%, #22d3ee 30%, #06b6d4 50%, #22d3ee 70%, #67e8f9 100%)",boxShadow:A,zIndex:100,animation:Q}}),a.jsxs("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:100,pointerEvents:"none",overflow:"visible"},children:[a.jsxs("defs",{children:[a.jsxs("linearGradient",{id:"cyanGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[a.jsx("stop",{offset:"0%",stopColor:"#67e8f9"}),a.jsx("stop",{offset:"30%",stopColor:"#22d3ee"}),a.jsx("stop",{offset:"50%",stopColor:"#06b6d4"}),a.jsx("stop",{offset:"70%",stopColor:"#22d3ee"}),a.jsx("stop",{offset:"100%",stopColor:"#67e8f9"})]}),a.jsxs("filter",{id:"cyanGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{stdDeviation:$.blurAmount,result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),a.jsx("line",{x1:`${50+Jn-.2}%`,y1:"0",x2:`${50-Jn-.2}%`,y2:"100%",stroke:"url(#cyanGradient)",strokeWidth:4*s,filter:w?void 0:"url(#cyanGlow)",style:{animation:Q}})]})]}),U>=1&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{position:"absolute",top:0,right:0,width:4*s,height:"100%",background:"linear-gradient(180deg, #f9a8d4 0%, #f472b6 30%, #ec4899 50%, #f472b6 70%, #f9a8d4 100%)",boxShadow:M,zIndex:100,animation:Q,animationDelay:"0.3s"}}),a.jsx("div",{style:{position:"absolute",top:0,right:0,width:`calc(${50-Jn}% + ${2*s}px)`,height:4*s,background:"linear-gradient(90deg, #f9a8d4 0%, #f472b6 30%, #ec4899 50%, #f472b6 70%, #f9a8d4 100%)",boxShadow:M,zIndex:100,animation:Q,animationDelay:"0.3s"}}),a.jsx("div",{style:{position:"absolute",bottom:0,right:0,width:`calc(${50+Jn}% + ${2*s}px)`,height:4*s,background:"linear-gradient(90deg, #f9a8d4 0%, #f472b6 30%, #ec4899 50%, #f472b6 70%, #f9a8d4 100%)",boxShadow:M,zIndex:100,animation:Q,animationDelay:"0.3s"}}),a.jsxs("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:100,pointerEvents:"none",overflow:"visible"},children:[a.jsxs("defs",{children:[a.jsxs("linearGradient",{id:"pinkGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[a.jsx("stop",{offset:"0%",stopColor:"#f9a8d4"}),a.jsx("stop",{offset:"30%",stopColor:"#f472b6"}),a.jsx("stop",{offset:"50%",stopColor:"#ec4899"}),a.jsx("stop",{offset:"70%",stopColor:"#f472b6"}),a.jsx("stop",{offset:"100%",stopColor:"#f9a8d4"})]}),a.jsxs("filter",{id:"pinkGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{stdDeviation:$.blurAmount,result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),a.jsx("line",{x1:`${50+Jn+.2}%`,y1:"0",x2:`${50-Jn+.2}%`,y2:"100%",stroke:"url(#pinkGradient)",strokeWidth:4*s,filter:w?void 0:"url(#pinkGlow)",style:{animation:Q,animationDelay:"0.3s"}})]})]})]}),U>=6&&U<=9&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{position:"fixed",left:ve.myX,top:ve.myY,transform:`translate(-50%, -50%) scale(${D})`,opacity:ne,width:150*s,height:150*s,borderRadius:"50%",background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(100,180,255,0.8) 40%, rgba(59,130,246,0.4) 70%, transparent 100%)",boxShadow:w?`0 0 ${30*s}px rgba(59, 130, 246, 0.8)`:`0 0 ${40*s}px rgba(255,255,255,0.9), 0 0 ${80*s}px rgba(59, 130, 246, 0.8), 0 0 ${120*s}px rgba(59, 130, 246, 0.5)`,zIndex:500,pointerEvents:"none"}}),a.jsx("div",{style:{position:"fixed",left:ve.opX,top:ve.opY,transform:`translate(-50%, -50%) scale(${D})`,opacity:ne,width:150*s,height:150*s,borderRadius:"50%",background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(255,150,150,0.8) 40%, rgba(239,68,68,0.4) 70%, transparent 100%)",boxShadow:w?`0 0 ${30*s}px rgba(239, 68, 68, 0.8)`:`0 0 ${40*s}px rgba(255,255,255,0.9), 0 0 ${80*s}px rgba(239, 68, 68, 0.8), 0 0 ${120*s}px rgba(239, 68, 68, 0.5)`,zIndex:500,pointerEvents:"none"}})]}),U>=9&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{position:"fixed",left:g.player.x,top:g.player.y,transform:`translate(-50%, -50%) scale(${ue})`,opacity:O,width:g.leaderSize,height:g.leaderSize,borderRadius:"50%",overflow:"hidden",border:"4px solid #3182ce",boxShadow:"0 0 20px rgba(49, 130, 206, 0.4)",background:"#1a202c",zIndex:500,pointerEvents:"none"},children:a.jsx("img",{src:Jc(t.class),alt:t.name,style:{width:"100%",height:"100%",objectFit:"cover",objectPosition:t.class==="AJA"?"center top":"center"}})}),a.jsx("div",{style:{position:"fixed",left:g.opponent.x,top:g.opponent.y,transform:`translate(-50%, -50%) scale(${ue})`,opacity:O,width:g.leaderSize,height:g.leaderSize,borderRadius:"50%",overflow:"hidden",border:"4px solid #c53030",boxShadow:"0 0 20px rgba(197, 48, 48, 0.4)",background:"#1a202c",zIndex:500,pointerEvents:"none"},children:a.jsx("img",{src:Jc(e.class),alt:e.name,style:{width:"100%",height:"100%",objectFit:"cover",objectPosition:e.class==="AJA"?"center top":"center"}})})]}),R.map(X=>a.jsx("div",{style:{position:"fixed",left:X.x,top:X.y,width:X.size*s,height:X.size*s,borderRadius:"50%",background:X.color,boxShadow:`0 0 ${X.size*.5*s}px ${X.color}`,pointerEvents:"none",zIndex:600,animation:`landingParticleBurst 0.6s ease-out ${X.delay}s forwards`,transform:"translate(-50%, -50%)","--particle-angle":`${X.angle}deg`,"--particle-dist":`${X.dist*s}px`}},X.id)),ge&&a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",animation:U===3?"vsZoomIn 1.5s cubic-bezier(0.34, 1.56, 0.64, 1)":void 0,opacity:U>=7?Math.max(0,ee):1,zIndex:200,pointerEvents:"none"},children:a.jsx("img",{src:DL,alt:"VS",style:{height:300*s,width:"auto",filter:`drop-shadow(0 0 ${20*s}px rgba(255,255,255,0.8)) drop-shadow(0 0 ${40*s}px rgba(255,255,255,0.6))`}})}),U>=4&&U<5&&a.jsx("div",{style:{position:"absolute",top:"20%",left:"50%",transform:"translate(-50%, -50%)",zIndex:150},children:a.jsx("div",{style:{width:100*s,height:100*s,borderRadius:"50%",background:"linear-gradient(45deg, #f6ad55 0%, #fbd38d 100%)",border:"4px solid white",display:"flex",alignItems:"center",justifyContent:"center",fontSize:2*s+"rem",fontWeight:"bold",color:"white",animation:"coinFlip 1.5s ease-in-out",boxShadow:`0 0 ${30*s}px rgba(246, 173, 85, 0.8)`},children:""})}),a.jsx("style",{children:`
                @keyframes screenShake {
                    0%, 100% { transform: translate(0, 0); }
                    10% { transform: translate(-10px, -10px); }
                    20% { transform: translate(10px, 10px); }
                    30% { transform: translate(-10px, 10px); }
                    40% { transform: translate(10px, -10px); }
                    50% { transform: translate(-10px, -10px); }
                    60% { transform: translate(10px, 10px); }
                    70% { transform: translate(-10px, 10px); }
                    80% { transform: translate(10px, -10px); }
                    90% { transform: translate(-10px, 0); }
                }

                @keyframes nameplateSlideUp {
                    0% {
                        transform: translateY(50px);
                        opacity: 0;
                    }
                    60% {
                        transform: translateY(-10px);
                    }
                    100% {
                        transform: translateY(0);
                        opacity: 1;
                    }
                }

                @keyframes vsZoomIn {
                    0% {
                        transform: translate(-50%, -50%) scale(3) translateZ(0);
                        opacity: 0;
                        filter: blur(20px);
                    }
                    50% {
                        transform: translate(-50%, -50%) scale(1.2) translateZ(0);
                        opacity: 1;
                        filter: blur(0px);
                    }
                    100% {
                        transform: translate(-50%, -50%) scale(1) translateZ(0);
                        opacity: 1;
                        filter: blur(0px);
                    }
                }

                @keyframes coinFlip {
                    0% {
                        transform: rotateY(0deg) scale(1);
                    }
                    50% {
                        transform: rotateY(1800deg) scale(1.2);
                    }
                    100% {
                        transform: rotateY(3600deg) scale(1);
                    }
                }

                @keyframes turnOrderFadeIn {
                    0% {
                        opacity: 0;
                        transform: scale(0.5);
                    }
                    50% {
                        transform: scale(1.2);
                    }
                    100% {
                        opacity: 1;
                        transform: scale(1);
                    }
                }

                @keyframes glowPulse {
                    0%, 100% {
                        opacity: 0.8;
                        filter: brightness(1);
                    }
                    50% {
                        opacity: 1;
                        filter: brightness(1.3);
                    }
                }

                @keyframes landingParticleBurst {
                    0% {
                        transform: translate(-50%, -50%) rotate(var(--particle-angle)) translateX(0);
                        opacity: 1;
                    }
                    100% {
                        transform: translate(-50%, -50%) rotate(var(--particle-angle)) translateX(var(--particle-dist));
                        opacity: 0;
                    }
                }
            `})]})},NL=({isVictory:t,loserLeaderRef:e,onComplete:n,onPhaseChange:r,onShakeIntensityChange:s,scale:i=1})=>{const[o,l]=L.useState("start"),[c,d]=L.useState(null),[u,h]=L.useState([]);L.useEffect(()=>{if(e.current){const E=e.current.getBoundingClientRect();d({x:E.left+E.width/2,y:E.top+E.height/2,size:E.width})}},[e]),L.useEffect(()=>{r==null||r(o)},[o,r]),L.useEffect(()=>{const E={start:200,zoom:600,"white-fade":800,explode:1200,"result-text":1800,"fade-out":600};if(o==="complete"){n();return}const k={start:"zoom",zoom:"white-fade","white-fade":"explode",explode:"result-text","result-text":"fade-out","fade-out":"complete"},w=setTimeout(()=>{const $=k[o];$&&l($)},E[o]||1e3);return()=>clearTimeout(w)},[o,n]),L.useEffect(()=>{if(o==="explode"&&c){const k=Array.from({length:60},(_,S)=>{const p=S/60*360,D=(Math.random()-.5)*12,H=p+D,ne=150+Math.random()*250,V=12+Math.random()*20;return{id:S,x:c.x,y:c.y,angle:H,distance:ne,size:V,delay:Math.random()*.1,duration:.6+Math.random()*.4}});h(k),s==null||s(1);const w=1e3,$=Date.now(),v=setInterval(()=>{const S=(Date.now()-$)/w;if(S>=1)s==null||s(0),clearInterval(v);else{const p=1-Math.pow(S,2);s==null||s(p)}},16);return()=>clearInterval(v)}},[o,c,s]);const f=["start","zoom","white-fade","explode","result-text","fade-out","complete"].indexOf(o);return c?a.jsxs("div",{style:{position:"fixed",inset:0,zIndex:8e3,pointerEvents:"none",overflow:"hidden"},children:[a.jsx("div",{style:{position:"absolute",inset:0,background:"black",opacity:f>=1?f>=5?1:.5:0,transition:"opacity 0.5s ease-out"}}),f>=1&&f<4&&a.jsx("div",{style:{position:"absolute",left:c.x,top:c.y,transform:"translate(-50%, -50%)",width:c.size*1.8,height:c.size*1.8,borderRadius:"50%",background:"radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 60%)",transition:"all 0.4s ease-out"}}),f>=3&&u.map(E=>a.jsx("div",{style:{position:"absolute",left:E.x,top:E.y,width:E.size*i,height:E.size*i,borderRadius:"50%",background:"white",boxShadow:"0 0 15px white, 0 0 30px rgba(255,255,255,0.5)",transform:"translate(-50%, -50%)",animation:`particleFly-${E.id} ${E.duration}s ease-out ${E.delay}s forwards`}},E.id)),f>=3&&a.jsx("style",{children:u.map(E=>{const k=E.angle*Math.PI/180,w=Math.cos(k)*E.distance,$=Math.sin(k)*E.distance;return`
                            @keyframes particleFly-${E.id} {
                                0% {
                                    transform: translate(-50%, -50%) scale(1);
                                    opacity: 1;
                                }
                                100% {
                                    transform: translate(calc(-50% + ${w}px), calc(-50% + ${$}px)) scale(0);
                                    opacity: 0;
                                }
                            }
                        `}).join(`
`)}),f>=4&&f<6&&a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",animation:"resultTextPop 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)"},children:a.jsx("div",{style:{fontSize:`${7*i}rem`,fontWeight:900,fontFamily:"Tamanegi, sans-serif",color:t?"#ffd700":"#718096",textShadow:t?"0 0 30px rgba(255,215,0,0.8), 0 0 60px rgba(255,215,0,0.6), 0 0 90px rgba(255,215,0,0.4), 4px 4px 8px rgba(0,0,0,0.8)":"0 0 20px rgba(113,128,150,0.5), 4px 4px 8px rgba(0,0,0,0.8)",letterSpacing:"0.15em"},children:t?"":"..."})}),a.jsx("style",{children:`
                @keyframes resultTextPop {
                    0% {
                        transform: translate(-50%, -50%) scale(2.5);
                        opacity: 0;
                        filter: blur(20px);
                    }
                    60% {
                        transform: translate(-50%, -50%) scale(0.95);
                        opacity: 1;
                        filter: blur(0px);
                    }
                    100% {
                        transform: translate(-50%, -50%) scale(1);
                        opacity: 1;
                        filter: blur(0px);
                    }
                }
            `})]}):null},jL=({isMyTurn:t,turnCount:e,activePlayerId:n,onTimeUp:r,timerEnabled:s,isGameOver:i=!1,isPaused:o=!1,scale:l=1,buttonSize:c=160,timerDuration:d=60})=>{const[u,h]=L.useState(d),[f,E]=L.useState(!1),[k,w]=L.useState(!1),$=L.useRef(null),v=L.useRef(""),_=L.useRef(0),S=L.useRef(r),p=L.useRef(!1),D=L.useId().replace(/:/g,"_");L.useEffect(()=>{S.current=r},[r]);const H=`${e}-${n}`,ne=L.useCallback(()=>{h(d),E(!1),w(!1),_.current=Date.now()+d*1e3,p.current=!1},[d]);if(L.useEffect(()=>{H!==v.current&&(v.current=H,ne())},[H,ne]),L.useEffect(()=>{if(!s||!t||i||o){$.current&&(clearInterval($.current),$.current=null);return}return _.current===0&&(_.current=Date.now()+d*1e3),$.current=window.setInterval(()=>{const g=Date.now(),T=Math.max(0,(_.current-g)/1e3);h(T);const A=Math.ceil(T);A<=15&&A>10?(E(!0),w(!1)):A<=10?(E(!0),w(!0)):(E(!1),w(!1)),T<=0&&!p.current&&(p.current=!0,$.current&&(clearInterval($.current),$.current=null),setTimeout(()=>S.current(),0))},16),()=>{$.current&&(clearInterval($.current),$.current=null)}},[s,t,i,o,d]),!s||o)return null;const V=u/d,ee=(c/2+12)*l,de=6*l,ve=2*Math.PI*ee,je=-ve*(1-V),ue=Math.ceil(u),I=k?Math.min(1,(10-ue)/10):0,O=Math.max(.05,.15-I*.1);let C="#4299e1";f&&!k?C="#f6ad55":k&&(C="#e53e3e");const R=20*l,y=ee*2+de+R*2;return a.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:y,height:y,pointerEvents:"none",zIndex:10,animation:k?`timerShake${D} ${O}s ease-in-out infinite`:void 0},children:[a.jsxs("svg",{width:y,height:y,style:{position:"absolute",top:0,left:0,overflow:"visible"},children:[a.jsx("circle",{cx:y/2,cy:y/2,r:ee,fill:"none",stroke:"rgba(0,0,0,0.3)",strokeWidth:de}),a.jsx("circle",{cx:y/2,cy:y/2,r:ee,fill:"none",stroke:C,strokeWidth:de,strokeLinecap:"round",strokeDasharray:ve,strokeDashoffset:je,style:{transform:"rotate(-90deg)",transformOrigin:"center"}}),f&&a.jsx("circle",{cx:y/2,cy:y/2,r:ee,fill:"none",stroke:C,strokeWidth:de*3,opacity:.4,style:{filter:`blur(${12*l}px)`,animation:k?`timerPulse${D} 0.5s ease-in-out infinite`:`timerPulse${D} 1s ease-in-out infinite`}})]}),a.jsx("style",{children:`
                @keyframes timerPulse${D} {
                    0%, 100% { opacity: 0.4; }
                    50% { opacity: 0.7; }
                }
                @keyframes timerShake${D} {
                    0%, 100% { transform: translate(-50%, -50%) translate(0, 0); }
                    25% { transform: translate(-50%, -50%) translate(${2*l}px, ${-2*l}px); }
                    50% { transform: translate(-50%, -50%) translate(${-2*l}px, ${2*l}px); }
                    75% { transform: translate(-50%, -50%) translate(${2*l}px, ${1*l}px); }
                }
            `})]})};function $L(t,e){const[n,r]=L.useState(null),[s,i]=L.useState(""),[o,l]=L.useState(!1),[c,d]=L.useState(null),[u,h]=L.useState(!1);return L.useEffect(()=>{if(t==="CPU")return;const f=new JS;return h(!0),(async()=>{try{const k=await f.connect(t==="JOIN"?e:void 0);i(k),r(f),f.onConnection(()=>{console.log("[useGameNetwork] Connection established!"),l(!0),h(!1)})}catch(k){d(k.toString()),h(!1)}})(),()=>{f.disconnect()}},[t,e]),{adapter:n,myId:s,connected:o,connecting:u,error:c,setConnected:l}}function C_(t,e,n){return!(!t.canEvolveThisTurn||t.evolutionsUsed>=2||e<(n?5:4))}function k_(t,e,n){return!(!t.canEvolveThisTurn||t.sep<=0||e<(n?7:6))}const Ze=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},FL=Ze("/leaders/azya_leader.png"),UL=Ze("/leaders/senka_leader.png"),BL=Ze("/leaders/yoRuka_leader.png"),zL=Ze("/sleeves/azya_sleeve.png"),HL=Ze("/sleeves/senka_sleeve.png"),WL=Ze("/sleeves/yoruka_sleeve.png"),sl=t=>t==="YORUKA"?BL:t==="AJA"?FL:UL,ui=t=>t==="YORUKA"?WL:t==="AJA"?zL:HL,GL=1920,rI=1080,VL=()=>{const[t,e]=L.useState({scale:1,toGameX:r=>r,toGameY:r=>r}),n=L.useCallback(()=>{const r=window.visualViewport?window.visualViewport.width:window.innerWidth,s=window.visualViewport?window.visualViewport.height:window.innerHeight;let i=Math.min(r/GL,s/rI);i*=1.5,e({scale:i,toGameX:c=>c,toGameY:c=>c})},[]);return L.useEffect(()=>{n(),window.addEventListener("resize",n),window.addEventListener("orientationchange",()=>{setTimeout(n,150)}),window.visualViewport&&window.visualViewport.addEventListener("resize",n);const r=()=>{document.visibilityState==="visible"&&setTimeout(n,100)};return document.addEventListener("visibilitychange",r),()=>{window.removeEventListener("resize",n),window.removeEventListener("orientationchange",n),window.visualViewport&&window.visualViewport.removeEventListener("resize",n),document.removeEventListener("visibilitychange",r)}},[n]),t},cn=90,Sn=120,fi=cn+18,so=240,YL=({x:t,y:e,onComplete:n,scale:r=1})=>{j.useEffect(()=>{const i=setTimeout(n,2e3);return()=>clearTimeout(i)},[n]);const s=j.useMemo(()=>Array(20).fill(0).map((i,o)=>({id:o,angle:Math.random()*360,dist:(30+Math.random()*60)*r,size:(10+Math.random()*15)*r,delay:Math.random()*.5})),[r]);return a.jsxs("div",{style:{position:"absolute",left:t,top:e,pointerEvents:"none",zIndex:6e3},children:[a.jsx("style",{children:`
                @keyframes healGlowFade {
                    0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; filter: blur(10px); }
                    30% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.8; filter: blur(15px); }
                    100% { transform: translate(-50%, -50%) scale(1.6); opacity: 0; filter: blur(30px); }
                }
                @keyframes healParticleRise {
                    0% { transform: translate(-50%, -50%) rotate(var(--angle)) translate(0, 0) scale(0); opacity: 0; }
                    20% { transform: translate(-50%, -50%) rotate(var(--angle)) translate(0, 0) opacity: 0.7; }
                    100% { transform: translate(-50%, -50%) rotate(var(--angle)) translate(calc(var(--dist) * 1px), 0) scale(1.5); opacity: 0; }
                }
            `}),a.jsx("div",{style:{position:"absolute",left:0,top:0,width:150*r,height:150*r,background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(200,255,240,0.5) 50%, transparent 80%)",borderRadius:"50%",transform:"translate(-50%, -50%)",animation:"healGlowFade 1.5s ease-out forwards",filter:`blur(${8*r}px)`}}),s.map(i=>a.jsx("div",{style:{position:"absolute",left:0,top:0,width:i.size,height:i.size,background:"rgba(255,250,240,0.6)",borderRadius:"50%",filter:`blur(${4*r}px)`,"--angle":`${i.angle}deg`,"--dist":i.dist,animation:`healParticleRise 1.2s ease-out ${i.delay}s forwards`,pointerEvents:"none"}},i.id))]})},KL=({x:t,y:e,atkBuff:n,hpBuff:r,onComplete:s})=>{j.useEffect(()=>{const E=setTimeout(s,1500);return()=>clearTimeout(E)},[s]);const i=n<0||r<0,o=i?"radial-gradient(circle, rgba(180,50,50,0.9) 0%, rgba(150,30,30,0.4) 50%, transparent 80%)":"radial-gradient(circle, rgba(255,230,100,0.9) 0%, rgba(255,200,50,0.4) 50%, transparent 80%)",l=i?"#ff4444":"#ffd93d",c="#ffd93d",d="rgba(255,217,61,0.8)",u=E=>E>=0?`+${E}`:`${E}`,h=80,f=110;return a.jsxs("div",{style:{position:"absolute",left:t,top:e,pointerEvents:"none",zIndex:6e3},children:[a.jsx("style",{children:`
                @keyframes buffGlow {
                    0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
                    30% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
                    100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
                }
                @keyframes buffNumberRise {
                    0% { transform: translateY(0); opacity: 0; }
                    20% { opacity: 1; }
                    100% { transform: translateY(-30px); opacity: 0; }
                }
                @keyframes buffSparkle {
                    0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
                    50% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
                    100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
                }
            `}),a.jsx("div",{style:{position:"absolute",left:0,top:0,width:150,height:150,background:o,borderRadius:"50%",transform:"translate(-50%, -50%)",animation:"buffGlow 1.2s ease-out forwards",filter:"blur(8px)"}}),n!==0&&a.jsx("div",{style:{position:"absolute",left:-h/2+12,top:f/2-20,fontSize:"24px",fontWeight:"bold",color:c,textShadow:`0 0 10px ${d}, 2px 2px 4px rgba(0,0,0,0.8)`,fontFamily:"Tamanegi, sans-serif",animation:"buffNumberRise 1.2s ease-out forwards",textAlign:"center"},children:u(n)}),r!==0&&a.jsx("div",{style:{position:"absolute",left:h/2-28,top:f/2-20,fontSize:"24px",fontWeight:"bold",color:c,textShadow:`0 0 10px ${d}, 2px 2px 4px rgba(0,0,0,0.8)`,fontFamily:"Tamanegi, sans-serif",animation:"buffNumberRise 1.2s ease-out forwards",textAlign:"center"},children:u(r)}),[...Array(8)].map((E,k)=>a.jsx("div",{style:{position:"absolute",left:Math.cos(k*Math.PI/4)*60,top:Math.sin(k*Math.PI/4)*60,width:12,height:12,background:l,borderRadius:"50%",boxShadow:`0 0 10px ${l}, 0 0 20px ${l}`,animation:`buffSparkle 0.8s ease-out ${k*.1}s forwards`}},k))]})},XL=({x:t,y:e,onComplete:n,scale:r=1})=>(j.useEffect(()=>{const s=setTimeout(n,1200);return()=>clearTimeout(s)},[n]),a.jsxs("div",{style:{position:"absolute",left:t,top:e,transform:"translate(-50%, -50%)",width:130*r,height:130*r,pointerEvents:"none",zIndex:5e3,display:"flex",alignItems:"center",justifyContent:"center"},children:[a.jsx("div",{style:{fontSize:`${80*r}px`,animation:"baneSkullAppear 1.2s ease-out forwards",textShadow:`0 0 ${20*r}px #9b59b6, 0 0 ${40*r}px #8e44ad, 0 0 ${60*r}px #6c3483`,filter:`drop-shadow(0 0 ${15*r}px #9b59b6) hue-rotate(-10deg)`},children:""}),[...Array(12)].map((s,i)=>a.jsx("div",{style:{position:"absolute",left:"50%",top:"50%",width:6*r,height:6*r,background:"radial-gradient(circle, #9b59b6, #6c3483)",borderRadius:"50%",boxShadow:`0 0 ${8*r}px #9b59b6, 0 0 ${15*r}px #8e44ad`,animation:`baneParticle 1s ease-out ${i*.08}s forwards`,transform:`rotate(${i*30}deg) translateX(0)`}},i)),a.jsx("style",{children:`
                @keyframes baneSkullAppear {
                    0% { transform: scale(0) rotate(-30deg); opacity: 0; }
                    20% { transform: scale(1.3) rotate(10deg); opacity: 1; }
                    40% { transform: scale(1) rotate(-5deg); opacity: 1; }
                    60% { transform: scale(1.1) rotate(0deg); opacity: 1; }
                    80% { transform: scale(1) rotate(0deg); opacity: 0.8; }
                    100% { transform: scale(1.5) rotate(0deg); opacity: 0; }
                }
                @keyframes baneParticle {
                    0% { transform: rotate(0deg) translateX(0); opacity: 1; }
                    100% { transform: rotate(0deg) translateX(${70*r}px); opacity: 0; }
                }
            `})]})),QL=({type:t,x:e,y:n,onComplete:r,audioSettings:s,scale:i=1})=>{const o=j.useMemo(()=>{let f=8,E=8,k=100,w=256;return t==="SHOT"&&(w=128),{cols:f,rows:E,fps:k,size:w}},[t]);if(j.useEffect(()=>{const E=["LIGHTNING","THUNDER","IMPACT","SUMI","SHOT","ICE","WATER","RAY","FIRE","SLASH","BLUE_FIRE"].includes(t)?o.cols*o.rows/o.fps*1e3:t==="FIREBALL"?500:t==="HEAL"?2e3:400,k=setTimeout(r,E);return()=>clearTimeout(k)},[r,t,o]),j.useEffect(()=>{if(!s||!s.seEnabled)return;const f=(E,k=.5,w=0)=>{setTimeout(()=>{const $=new Audio(Ze(`/se/${E}`));$.volume=(s.se||.5)*k,$.play().catch(v=>console.warn("SE Play prevented",v))},w)};t==="SHOT"?(f("shot.mp3",.6),f("hibi.mp3",.4,400)):t==="IMPACT"?(f("panch1.mp3",.6,100),f("panch2.mp3",.6,500)):t==="LIGHTNING"||t==="THUNDER"?f("thunder.mp3",.5):t==="FIREBALL"?f("explosion.mp3",.5):t==="FIRE"?f("fire.mp3",.5):t==="SLASH"?f("slash.mp3",.5):t==="ICE"?f("ice.mp3",.5):t==="WATER"?f("water.mp3",.5):t==="RAY"?f("ray.mp3",.6):t==="SUMI"?f("yami.mp3",.6):t==="HEAL"?f("heal.mp3",.6):t==="BLUE_FIRE"?f("fire.mp3",.5):t==="BANE"&&f("yami.mp3",.7)},[t,s]),t==="HEAL")return a.jsx(YL,{x:e,y:n,onComplete:r,scale:i});if(t==="BANE")return a.jsx(XL,{x:e,y:n,onComplete:r,scale:i});const l=100*i,c={position:"absolute",left:e,top:n,transform:"translate(-50%, -50%)",width:l,height:l,pointerEvents:"none",zIndex:5e3,display:"flex",alignItems:"center",justifyContent:"center"};if(["LIGHTNING","THUNDER","IMPACT","SUMI","SHOT","ICE","WATER","RAY","FIRE","SLASH","BLUE_FIRE"].includes(t)){let f=Ze("/effects/thunder.png");t==="IMPACT"&&(f=Ze("/effects/impact.png")),t==="SUMI"&&(f=Ze("/effects/sumi.png")),t==="SHOT"&&(f=Ze("/effects/shot.png")),t==="ICE"&&(f=Ze("/effects/ice.png")),t==="WATER"&&(f=Ze("/effects/water.png")),t==="RAY"&&(f=Ze("/effects/ray.png")),t==="FIRE"&&(f=Ze("/effects/fire.png")),t==="SLASH"&&(f=Ze("/effects/slash.png")),t==="BLUE_FIRE"&&(f=Ze("/effects/blue_fire.png"));const E=o.cols*o.rows,k=Math.min(160,o.size)*i;return a.jsxs("div",{style:{...c,width:k,height:k,transform:`${(c==null?void 0:c.transform)||""}`},children:[a.jsx("div",{style:{width:"100%",height:"100%",backgroundImage:`url(${f})`,backgroundSize:`${o.cols*100}% ${o.rows*100}%`,animation:`spriteAnimation ${E/o.fps}s steps(1) forwards`}}),a.jsx("style",{children:`
                    @keyframes spriteAnimation {
                        ${Array.from({length:E}).map((w,$)=>{const v=$%o.cols,_=Math.floor($/o.cols),S=v*(100/(o.cols-1)),p=_*(100/(o.rows-1));return`${$/(E-1)*100}% { background-position: ${S}% ${p}%; }`}).join(`
`)}
                    }
                `})]})}let u="",h="";if(t==="FIREBALL")u=Ze("/effects/fireball.png"),h="explode 0.5s ease-out forwards";else if(t==="BEAM")return a.jsx("div",{style:{position:"fixed",left:e,top:n,width:400,height:30,background:"linear-gradient(90deg, transparent, #faf089, #fff, #faf089, transparent)",transform:"translate(-50%, -50%) rotate(-45deg)",boxShadow:"0 0 20px #faf089",opacity:0,animation:"beamShoot 0.4s ease-out forwards",pointerEvents:"none",zIndex:5e3},children:a.jsx("style",{children:`
                    @keyframes beamShoot {
                        0% { width: 0; opacity: 1; transform: translate(-50%, -50%) rotate(-45deg) scaleX(0); }
                        20% { width: 400px; opacity: 1; transform: translate(-50%, -50%) rotate(-45deg) scaleX(1); }
                        100% { width: 400px; opacity: 0; transform: translate(-50%, -50%) rotate(-45deg) scaleX(1.2); }
                    }
                `})});return u?a.jsxs("div",{style:c,children:[a.jsx("img",{src:u,style:{width:"100%",height:"100%",objectFit:"contain",animation:h}}),a.jsx("style",{children:`
                @keyframes explode { 0% { transform: scale(0.5); opacity: 0; } 20% { opacity: 1; } 100% { transform: scale(2); opacity: 0; } }
            `})]}):null},JL=({value:t,x:e,y:n,color:r,onComplete:s,scale:i=1})=>{j.useEffect(()=>{const d=setTimeout(s,1200);return()=>clearTimeout(d)},[s]);const o=r==="#48bb78",l=r||"#e53e3e",c=o?"linear-gradient(180deg, #68d391 0%, #38a169 50%, #276749 100%)":"linear-gradient(180deg, #fc8181 0%, #e53e3e 50%, #c53030 100%)";return a.jsxs("div",{style:{position:"absolute",left:e,top:n,transform:"translate(-50%, -50%)",pointerEvents:"none",zIndex:6e3,fontSize:`${4*i}rem`,fontWeight:"900",fontFamily:'"Impact", "Arial Black", sans-serif',letterSpacing:`${-2*i}px`,background:c,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",filter:`drop-shadow(0 0 ${8*i}px ${l}) drop-shadow(0 ${2*i}px ${4*i}px rgba(0,0,0,0.8))`,animation:"floatUp 1.2s ease-out forwards"},children:[t,a.jsx("style",{children:`
                @keyframes floatUp {
                    0% { transform: translate(-50%, -50%) scale(0.3); opacity: 0; }
                    15% { transform: translate(-50%, -70%) scale(1.8); opacity: 1; }
                    30% { transform: translate(-50%, -90%) scale(1.4); opacity: 1; }
                    100% { transform: translate(-50%, -180%) scale(1); opacity: 0; }
                }
            `})]})},qL=({x:t,y:e})=>{const n=j.useMemo(()=>Array(16).fill(0).map((r,s)=>({id:s,angle:Math.random()*360,dist:60+Math.random()*120,size:4+Math.random()*8,delay:Math.random()*.3,color:Math.random()>.5?"#f6e05e":"#ffffff"})),[]);return a.jsxs("div",{style:{position:"absolute",left:t,top:e,pointerEvents:"none",zIndex:6e3},children:[a.jsx("style",{children:`
                @keyframes sparkleMove {
                    0% { transform: rotate(var(--angle)) translate(0, 0) scale(0); opacity: 0; }
                    20% { opacity: 1; transform: rotate(var(--angle)) translate(calc(var(--dist) * 0.2px), 0) scale(1.5); }
                    100% { transform: rotate(var(--angle)) translate(calc(var(--dist) * 1px), 0) scale(0); opacity: 0; }
                }
            `}),n.map(r=>a.jsx("div",{style:{position:"absolute",left:0,top:0,width:r.size,height:r.size,background:r.color,borderRadius:"50%",boxShadow:`0 0 10px ${r.color}, 0 0 20px ${r.color}`,"--angle":`${r.angle}deg`,"--dist":r.dist,animation:`sparkleMove 0.8s ease-out ${r.delay}s forwards`,pointerEvents:"none"}},r.id))]})},ZL=({onClose:t})=>a.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(0,0,0,0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:t,children:a.jsxs("div",{style:{background:"linear-gradient(135deg, #1a202c 0%, #2d3748 100%)",borderRadius:16,padding:30,maxWidth:700,maxHeight:"80vh",overflowY:"auto",color:"#fff",boxShadow:"0 20px 60px rgba(0,0,0,0.5)",border:"1px solid #4a5568"},onClick:e=>e.stopPropagation(),children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[a.jsx("h2",{style:{margin:0,color:"#63b3ed"},children:""}),a.jsx("button",{onClick:t,style:{background:"transparent",border:"none",color:"#a0aec0",fontSize:"1.5rem",cursor:"pointer"},children:""})]}),a.jsxs("section",{style:{marginBottom:25},children:[a.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),a.jsxs("ul",{style:{lineHeight:1.8,paddingLeft:20,color:"#e2e8f0"},children:[a.jsx("li",{children:"0"}),a.jsx("li",{children:"1PP110"}),a.jsx("li",{children:"PP"}),a.jsx("li",{children:""}),a.jsx("li",{children:"5"}),a.jsx("li",{children:"910"})]})]}),a.jsxs("section",{style:{marginBottom:25},children:[a.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[a.jsxs("div",{children:[a.jsx("span",{style:{color:"#48bb78",fontWeight:"bold"},children:"[]"}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#ed8936",fontWeight:"bold"},children:"[]"}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#4299e1",fontWeight:"bold"},children:"[]"}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#9f7aea",fontWeight:"bold"},children:"[]"}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#f56565",fontWeight:"bold"},children:"[]"}),"12"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#38b2ac",fontWeight:"bold"},children:"[]"}),"1"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#718096",fontWeight:"bold"},children:"[]"}),"AoE"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#d69e2e",fontWeight:"bold"},children:"[]"}),"AoE"]})]})]}),a.jsxs("section",{style:{marginBottom:25},children:[a.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[a.jsxs("div",{children:[a.jsx("span",{style:{color:"#63b3ed",fontWeight:"bold"},children:""}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#f687b3",fontWeight:"bold"},children:""}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#faf089",fontWeight:"bold"},children:""}),"EP"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#b794f4",fontWeight:"bold"},children:""}),"SEP"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#68d391",fontWeight:"bold"},children:""}),""]})]})]}),a.jsxs("section",{style:{marginBottom:25},children:[a.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),a.jsxs("ul",{style:{lineHeight:1.8,paddingLeft:20,color:"#e2e8f0"},children:[a.jsxs("li",{children:[a.jsx("span",{style:{color:"#faf089"},children:"EP"}),"54112"]}),a.jsxs("li",{children:[a.jsx("span",{style:{color:"#b794f4"},children:"SEP"}),"76112"]}),a.jsx("li",{children:"1111"}),a.jsx("li",{children:"+2/+2"}),a.jsx("li",{children:"+3/+3"})]})]}),a.jsxs("section",{children:[a.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),a.jsxs("ul",{style:{lineHeight:1.8,paddingLeft:20,color:"#e2e8f0"},children:[a.jsxs("li",{children:[a.jsx("span",{style:{color:"#ed8936"},children:"PP"}),""]}),a.jsx("li",{children:"151612PP +1"})]})]})]})}),e3=({logs:t,onCardNameClick:e,scale:n=1,isMobile:r=!1})=>{const s=j.useRef(null);j.useEffect(()=>{s.current&&(s.current.scrollTop=s.current.scrollHeight)},[t.length]);const i=(c,d)=>{const u={color:"#ffd700",cursor:"pointer",textDecoration:"underline",textUnderlineOffset:"2px",fontWeight:"bold"},h=p=>{p.target.style.color="#ffec8b",p.target.style.textShadow="0 0 8px rgba(255, 215, 0, 0.8)"},f=p=>{p.target.style.color="#ffd700",p.target.style.textShadow="none"},E=(p,D)=>a.jsx("span",{style:u,onMouseEnter:h,onMouseLeave:f,onClick:H=>{H.stopPropagation(),e==null||e(p)},children:p},D),k=tI(),w=p=>p?!(/[a-zA-Z0-9]/.test(p)||/[\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/.test(p)):!0,$=[];for(const p of k){let D=0;for(;;){const H=c.indexOf(p,D);if(H===-1)break;const ne=H>0?c[H-1]:void 0,V=H+p.length<c.length?c[H+p.length]:void 0,ee=w(ne)&&w(V),de=$.some(ve=>H>=ve.start&&H<ve.end||H+p.length>ve.start&&H+p.length<=ve.end||H<=ve.start&&H+p.length>=ve.end);ee&&!de&&$.push({start:H,end:H+p.length,name:p}),D=H+1}}if($.length===0)return a.jsx("span",{children:c});$.sort((p,D)=>p.start-D.start);const v=[];let _=0,S=0;for(const p of $)p.start>_&&v.push(a.jsx("span",{children:c.slice(_,p.start)},S++)),v.push(E(p.name,S++)),_=p.end;return _<c.length&&v.push(a.jsx("span",{children:c.slice(_)},S++)),a.jsx(a.Fragment,{children:v})},o=r?Math.max(100,140*n):Math.max(150,200*n),l=r?Math.max(140,180*n):Math.max(180,220*n);return a.jsxs("div",{ref:s,style:{position:"absolute",left:0,top:"45%",transform:"translateY(-50%)",width:l,height:o,overflowY:"auto",background:"linear-gradient(to right, rgba(0,0,0,0.8), rgba(0,0,0,0.0))",color:"#fff",fontSize:r?`${Math.max(.55,.65*n)}rem`:`${Math.max(.65,.75*n)}rem`,padding:r?`${6*n}px ${6*n}px ${6*n}px ${10*n}px`:`${8*n}px ${8*n}px ${8*n}px ${12*n}px`,borderLeft:r?"2px solid #63b3ed":"3px solid #63b3ed",zIndex:15,pointerEvents:"auto",scrollbarWidth:"thin"},onMouseDown:c=>c.stopPropagation(),onClick:c=>c.stopPropagation(),children:[a.jsx("div",{style:{fontWeight:"bold",marginBottom:(r?3:4)*n,color:"#a0aec0",borderBottom:"1px solid rgba(255,255,255,0.1)",paddingBottom:2,fontSize:r?`${Math.max(.5,.55*n)}rem`:`${Math.max(.55,.65*n)}rem`,textTransform:"uppercase",letterSpacing:1},children:r?"LOG":"BATTLE LOG"}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:(r?2:3)*n},children:t.map((c,d)=>a.jsx("div",{style:{opacity:.9,lineHeight:r?"1.3":"1.4",textShadow:"0 1px 2px black",animation:"fadeIn 0.3s ease-out"},children:i(c)},d))})]})},t3=({card:t,evolvedImageUrl:e,startX:n,startY:r,phase:s,onPhaseChange:i,onShake:o,useSep:l,playSE:c,scale:d,isLightMode:u=!1})=>{const[h,f]=j.useState(0),[E,k]=j.useState(0),[w,$]=j.useState(0),[v,_]=j.useState(0),[S,p]=j.useState(0),[D,H]=j.useState(.25),[ne,V]=j.useState({x:n,y:r}),[ee,de]=j.useState(!1),[ve,je]=j.useState([]),[ue,I]=j.useState([]),[O,C]=j.useState(!1),R=j.useRef(!1),y=j.useRef(null),g=j.useRef(i),T=j.useRef(o),A=j.useRef(c);j.useEffect(()=>{g.current=i,T.current=o,A.current=c},[i,o,c]);const M=360*d,Q=480*d;j.useEffect(()=>{var X,Pe,we;console.log("[EvolutionAnimation] Phase:",s);let Te,te=null;switch(s){case"ZOOM_IN":{V({x:n,y:r}),H(.25),k(0);const qe=Date.now(),Ne=650,st=.25,vt=.75,Ot=setInterval(()=>{const ft=Date.now()-qe,on=Math.min(ft/Ne,1),zt=1-Math.pow(1-on,2);k(-5*zt),H(st+(vt-st)*zt),on>=1&&clearInterval(Ot)},16);Te=setTimeout(()=>{const ft=280*d,on=window.innerWidth-ft,zt=ft+on*.4;V({x:zt,y:window.innerHeight/2-30*d})},50);const Ve=setTimeout(()=>{const ft=new Audio(Ze("/se/kirakira.mp3"));ft.volume=.35,ft.play().catch(()=>{}),y.current=ft},600),qt=setTimeout(()=>{g.current("WHITE_FADE")},700);return()=>{clearTimeout(Te),clearTimeout(qt),clearTimeout(Ve),clearInterval(Ot)}}case"WHITE_FADE":(X=A.current)==null||X.call(A,"magic_charge.mp3",.3);const We=Array(80).fill(0).map((qe,Ne)=>{const st=Ne/80*360,vt=(Math.random()-.5)*10,Ot=st+vt,Ve=200+Math.random()*600,qt=Math.random()*1.8,on=.5+(Ve-200)/600*.5,zt=24+Math.random()*48;return{id:Ne,angle:Ot,dist:Ve,delay:qt,duration:on,size:zt}});je(We),C(!0);let be=0;return te=setInterval(()=>{be+=.025,_(Math.min(be,1)),p(Math.min(be*80,80)),$(be*15),be>=1.2&&(te&&clearInterval(te),C(!1),g.current("FLIP"))},40),()=>{te&&clearInterval(te)};case"FLIP":if((Pe=A.current)==null||Pe.call(A,"syakin.mp3",.8),(we=A.current)==null||we.call(A,"KO.mp3",.7),y.current){const qe=y.current,Ne=300,st=30,vt=Ne/st,Ot=qe.volume/vt;let Ve=0;const qt=setInterval(()=>{Ve++,qe.volume=Math.max(0,qe.volume-Ot),Ve>=vt&&(clearInterval(qt),qe.pause(),y.current=null)},st)}je([]);const Me=Date.now(),yt=400,rt=1200;return te=setInterval(()=>{const qe=Date.now()-Me;if(qe<yt){const Ne=qe/yt,st=1-Math.pow(1-Ne,3),vt=10+st*160;if(f(vt),H(.75+st*((l?1.2:1.1)-.75)),k(-5+st*2),_(Math.max(1-Ne*3,0)),vt>90&&!R.current){R.current=!0;const Ve=Array(120).fill(0).map((qt,ft)=>{const on=ft/120*360,zt=(Math.random()-.5)*8,us=18+Math.random()*42;return{id:ft,angle:on+zt,dist:200+Math.random()*400,size:us*3,delay:Math.random()*.05}});I(Ve)}}else{const Ne=Math.min((qe-yt)/rt,1),st=Ne<.5?2*Ne*Ne:1-Math.pow(-2*Ne+2,2)/2;if(f(170+st*10),_(0),!R.current){R.current=!0;const vt=Array(120).fill(0).map((Ot,Ve)=>{const qt=Ve/120*360,ft=(Math.random()-.5)*8,on=18+Math.random()*42;return{id:Ve,angle:qt+ft,dist:200+Math.random()*400,size:on*3,delay:Math.random()*.05}});I(vt)}Ne>=1&&(te&&clearInterval(te),g.current("REVEAL"))}},16),()=>{te&&clearInterval(te)};case"REVEAL":let tt=0;return te=setInterval(()=>{tt+=.25,_(Math.max(1-tt,0)),p(Math.max(60-tt*60,0)),tt>=1&&(te&&clearInterval(te),I([]),g.current("ZOOM_OUT"))},40),()=>{te&&clearInterval(te)};case"ZOOM_OUT":{V({x:n,y:r});const qe=Date.now(),Ne=250,st=D,vt=-3;return te=setInterval(()=>{const Ot=Date.now()-qe,Ve=Math.min(Ot/Ne,1),qt=1-Math.pow(1-Ve,3);H(st-(st-.25)*qt),k(vt*(1-qt)),Ve>=1&&(te&&clearInterval(te),f(180),$(0),H(.25),k(0),g.current("LAND"))},16),()=>{te&&clearInterval(te)}}case"LAND":return T.current(),de(!0),Te=setTimeout(()=>{g.current("DONE")},600),()=>clearTimeout(Te)}return()=>{Te&&clearTimeout(Te),te&&clearInterval(te),y.current&&(y.current.pause(),y.current=null)}},[s]);const U=h+w,ge=E,z=O?{x:(Math.random()-.5)*4,y:(Math.random()-.5)*4}:{x:0,y:0};return a.jsxs("div",{style:{position:"fixed",inset:0,zIndex:1e4,background:"rgba(0,0,0,0.75)",pointerEvents:"none"},children:[a.jsx("style",{children:`
                ${ve.map(Te=>`
                    @keyframes chargeParticleIn-${Te.id} {
                        0% { opacity: 0; transform: rotate(${Te.angle}deg) translateX(${Te.dist}px) scale(0.5); }
                        20% { opacity: 0.8; transform: rotate(${Te.angle}deg) translateX(${Te.dist*.8}px) scale(1.2); }
                        100% { opacity: 1; transform: rotate(${Te.angle}deg) translateX(0) scale(0.2); } /* Keep visible at end */
                    }
                `).join("")}
                ${ue.map(Te=>`
                    @keyframes burstParticleOut-${Te.id} {
                        0% { opacity: 1; transform: translate(-50%, -50%) rotate(${Te.angle}deg) translateX(0) scale(1.5); }
                        100% { opacity: 0; transform: translate(-50%, -50%) rotate(${Te.angle}deg) translateX(${Te.dist*1.5}px) scale(0); }
                    }
                `).join("")}
            `}),(u?ve.filter((Te,te)=>te%2===0):ve).map(Te=>a.jsx("div",{style:{position:"absolute",left:ne.x,top:ne.y,width:Te.size*d,height:Te.size*d,borderRadius:"50%",background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(200,230,255,0.6) 40%, transparent 70%)",boxShadow:u?"0 0 8px white":"0 0 10px white, 0 0 20px rgba(100,200,255,0.5)",filter:u?void 0:"blur(1px)",animation:`chargeParticleIn-${Te.id} ${Te.duration}s ease-in ${Te.delay}s forwards`,transform:`rotate(${Te.angle}deg) translateX(${Te.dist*d}px)`,opacity:0,pointerEvents:"none"}},`charge-${Te.id}`)),s==="WHITE_FADE"&&a.jsxs("div",{style:{position:"absolute",left:ne.x+z.x,top:ne.y+z.y,width:0,height:0,transformStyle:"preserve-3d"},children:[a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:500*d,height:500*d,border:"8px solid rgba(255, 255, 255, 0.6)",borderRadius:"50%",transform:"translate(-50%, -50%) rotateX(75deg)",boxShadow:u?"0 0 15px rgba(255, 255, 255, 0.6)":"0 0 30px rgba(255, 255, 255, 0.8), inset 0 0 30px rgba(255, 255, 255, 0.8)",animation:"ringSpin 2s linear infinite"}}),!u&&a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:600*d,height:600*d,border:"6px dashed rgba(100, 200, 255, 0.7)",borderRadius:"50%",transform:"translate(-50%, -50%) rotateX(80deg) rotateY(10deg)",boxShadow:"0 0 40px rgba(100, 200, 255, 0.5)",animation:"ringSpinReverse 3s linear infinite"}}),a.jsx("style",{children:`
                        @keyframes ringSpin {
                            0% { transform: translate(-50%, -50%) rotateX(75deg) rotate(0deg); opacity: 0; scale: 0.5; }
                            20% { opacity: 1; scale: 1; }
                            100% { transform: translate(-50%, -50%) rotateX(75deg) rotate(360deg); opacity: 1; scale: 1; }
                        }
                        @keyframes ringSpinReverse {
                            0% { transform: translate(-50%, -50%) rotateX(80deg) rotateY(10deg) rotate(0deg); opacity: 0; scale: 0.6; }
                            20% { opacity: 0.8; scale: 1; }
                            100% { transform: translate(-50%, -50%) rotateX(80deg) rotateY(10deg) rotate(-360deg); opacity: 0.8; scale: 1; }
                        }
                    `})]}),(u?ue.filter((Te,te)=>te%2===0):ue).map(Te=>a.jsx("div",{style:{position:"absolute",left:ne.x,top:ne.y,width:Te.size*d,height:Te.size*d,borderRadius:"50%",background:l?"radial-gradient(circle, rgba(183, 148, 244, 1) 0%, rgba(159, 122, 234, 0.8) 50%, transparent 100%)":"radial-gradient(circle, rgba(255, 251, 235, 1) 0%, rgba(251, 211, 141, 0.8) 50%, transparent 100%)",boxShadow:u?l?"0 0 8px #b794f4":"0 0 8px #fbd38d":l?"0 0 10px #b794f4, 0 0 20px rgba(159,122,234,0.6)":"0 0 10px #fbd38d, 0 0 20px rgba(251,211,141,0.6)",animation:`burstParticleOut-${Te.id} 0.4s ease-out ${Te.delay}s forwards`,pointerEvents:"none"}},`burst-${Te.id}`)),a.jsxs("div",{style:{position:"absolute",left:ne.x+z.x,top:ne.y+z.y,transform:`translate(-50%, -50%) scale(${D}) perspective(1200px) rotateY(${U}deg) rotateZ(${ge}deg)`,transition:s==="ZOOM_IN"||s==="ZOOM_OUT"?"left 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), top 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)":"none",transformStyle:"preserve-3d"},children:[!u&&a.jsx("div",{style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:M*1.3,height:Q*1.2,background:l?"radial-gradient(ellipse, rgba(159, 122, 234, 0.4) 0%, transparent 70%)":"radial-gradient(ellipse, rgba(251, 211, 141, 0.4) 0%, transparent 70%)",filter:"blur(20px)",pointerEvents:"none",opacity:S>1?1:0,transition:"opacity 0.4s"}}),a.jsxs("div",{style:{width:M,height:Q,borderRadius:16,overflow:"hidden",boxShadow:u?l?"0 0 20px rgba(159, 122, 234, 0.5)":"0 0 20px rgba(251, 211, 141, 0.5)":l?"0 0 40px rgba(159, 122, 234, 0.7)":"0 0 40px rgba(251, 211, 141, 0.7)",position:"relative",transformStyle:"preserve-3d"},children:[a.jsxs("div",{style:{position:"absolute",inset:0,borderRadius:16,overflow:"hidden",background:"#1a202c",zIndex:U<=90?2:1,opacity:U<=90?1:0},children:[a.jsx("img",{src:Ze(t.imageUrl||""),alt:t.name,style:{width:"100%",height:"100%",objectFit:"cover",filter:`brightness(${1+v*.5}) contrast(${1-v*.2})`}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"white",opacity:v,pointerEvents:"none"}})]}),a.jsxs("div",{style:{position:"absolute",inset:0,transform:"rotateY(180deg)",borderRadius:16,overflow:"hidden",background:"#1a202c",zIndex:U>90?2:1,opacity:U>90?1:0},children:[a.jsx("img",{src:Ze(e&&e!==""?e:t.imageUrl||""),alt:`${t.name} Evolved`,style:{width:"100%",height:"100%",objectFit:"cover",filter:`brightness(${1+v*.5}) contrast(${1-v*.2})`}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"white",opacity:v,pointerEvents:"none"}})]})]})]}),ee&&a.jsxs("div",{style:{position:"absolute",left:n,top:r,pointerEvents:"none"},children:[a.jsx("style",{children:`
                        @keyframes landParticleMove {
                            0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                            100% { opacity: 0; transform: translate(-50%, -50%) rotate(var(--angle)) translateX(calc(var(--dist) * 1px)) scale(0); }
                        }
                    `}),Array(20).fill(0).map((Te,te)=>{const X=te/20*360,Pe=40+Math.random()*100;return a.jsx("div",{style:{position:"absolute",left:0,top:0,width:8*d,height:8*d,borderRadius:"50%",background:"white","--angle":`${X}deg`,"--dist":Pe,animation:"landParticleMove 0.5s ease-out forwards"}},`land-${te}`)})]})]})},R_=Ze("/leaders/yoRuka_win.png"),A_=Ze("/leaders/yoRuka_lose.png"),n3=Ze("/leaders/senka_win.png"),r3=Ze("/leaders/senka_lose.png"),s3=Ze("/leaders/azya_win.png"),i3=Ze("/leaders/azya_lose.png"),o3=t=>({BRONZE:"#cd7f32",SILVER:"#c0c0c0",GOLD:"#ffd700",PLATINUM:"#e5e4e2",DIAMOND:"#b9f2ff",MASTER:"#ff4500"})[t],a3=({winnerId:t,playerId:e,playerClass:n,onRematch:r,onRematching:s,onLeave:i,isOnline:o,isRoomMatch:l=!0,myRematchRequested:c,opponentRematchRequested:d,battleStats:u,selectedCardInfo:h,onCardInfoClick:f,victoryReason:E="normal",isRankedMatch:k=!1,ratingResult:w})=>{const $=t===e,_=(()=>{if(!$)return null;switch(E){case"disconnect":return"";case"surrender":return"";default:return null}})(),[S,p]=j.useState("bg-fade"),D=["bg-fade","image","result-text","stats","rate","buttons","complete"].indexOf(S);j.useEffect(()=>{const y={"bg-fade":300,image:600,"result-text":400,stats:400,rate:300,buttons:0};if(S==="complete")return;const g={"bg-fade":"image",image:"result-text","result-text":"stats",stats:"rate",rate:"buttons",buttons:"complete"},T=setTimeout(()=>{const A=g[S];A&&p(A)},y[S]||0);return()=>clearTimeout(T)},[S]);const H=()=>n==="SENKA"?$?n3:r3:n==="AJA"?$?s3:i3:$?R_:A_,[ne,V]=j.useState(15),[ee,de]=j.useState(!1),[ve,je]=j.useState(null),ue=o?c||d:c||ee;j.useEffect(()=>{if(ue)return;const y=setInterval(()=>{V(g=>g<=1?(clearInterval(y),i(),0):g-1)},1e3);return()=>clearInterval(y)},[i,ue]);const I=y=>{je(y),o&&!l&&s?s(y):r(y)},O=()=>{const y=!o||l?"":"";return o?c&&d?"...":c?"...":d?`${y}`:y:c?"...":y},C=()=>{const y={padding:"15px 40px",fontSize:"1.5rem",fontWeight:"bold",border:"none",borderRadius:12,cursor:c?"default":"pointer",transform:"scale(1)",transition:"transform 0.1s, background 0.2s"};return d&&!c?{...y,background:"linear-gradient(135deg, #f6e05e, #d69e2e)",color:"black",boxShadow:"0 4px 15px rgba(246, 224, 94, 0.6)",animation:"pulse 1s infinite"}:c?{...y,background:"linear-gradient(135deg, #718096, #4a5568)",color:"white",boxShadow:"none"}:{...y,background:"linear-gradient(135deg, #48bb78, #38a169)",color:"white",boxShadow:"0 4px 15px rgba(72, 187, 120, 0.4)"}},R=(y,g)=>({width:220,height:220,borderRadius:"50%",border:ve===y?"5px solid #f6e05e":"4px solid rgba(255,255,255,0.4)",background:y==="AJA"?`url(${sl(y)}) center top/cover`:`url(${sl(y)}) center/cover`,cursor:"pointer",transform:g?"scale(1.1)":"scale(1)",transition:"all 0.2s ease",boxShadow:g?"0 0 30px rgba(246, 224, 94, 0.7)":"0 6px 15px rgba(0,0,0,0.5)"});return a.jsxs("div",{style:{position:"absolute",inset:0,zIndex:5e3,background:"rgba(0,0,0,0.85)",backdropFilter:"blur(10px)",display:"flex",flexDirection:"row",alignItems:"stretch",opacity:D>=0?1:0,transition:"opacity 0.3s ease-out"},onClick:()=>{},children:[a.jsx("style",{children:`
                @keyframes pulse {
                    0%, 100% { transform: scale(1); }
                    50% { transform: scale(1.05); }
                }
                @keyframes float {
                    0%, 100% { transform: translateY(0); }
                    50% { transform: translateY(-10px); }
                }
                @keyframes slideUpFadeIn {
                    0% { opacity: 0; transform: translateY(30px); }
                    100% { opacity: 1; transform: translateY(0); }
                }
                @keyframes imageFadeIn {
                    0% { opacity: 0; transform: scale(0.95); }
                    100% { opacity: 0.9; transform: scale(1); }
                }
            `}),a.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:40,borderRight:"1px solid rgba(255,255,255,0.1)"},children:h?a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:16,maxWidth:320},children:[a.jsx("div",{style:{width:200,height:280,backgroundImage:`url(${Ze(`/cards/${h.id}.png`)})`,backgroundSize:"cover",backgroundPosition:"center",borderRadius:12,boxShadow:"0 8px 30px rgba(0,0,0,0.6)"}}),a.jsx("div",{style:{fontFamily:"var(--font-tamanegi)",fontSize:"1.6rem",color:"white",textShadow:"0 2px 6px rgba(0,0,0,0.6)",textAlign:"center"},children:h.name}),a.jsxs("div",{style:{display:"flex",gap:20,fontSize:"1.2rem",color:"rgba(255,255,255,0.9)"},children:[a.jsxs("span",{children:[": ",h.cost]}),h.type==="FOLLOWER"&&a.jsxs(a.Fragment,{children:[a.jsxs("span",{children:[": ",h.attack]}),a.jsxs("span",{children:[": ",h.health]})]})]}),a.jsx("div",{style:{fontSize:"1rem",color:"rgba(255,255,255,0.7)",textAlign:"center",lineHeight:1.5,maxHeight:120,overflow:"auto"},children:h.description||""}),a.jsx("button",{onClick:()=>f(null),style:{padding:"8px 24px",fontSize:"1rem",background:"transparent",border:"1px solid rgba(255,255,255,0.3)",color:"white",borderRadius:8,cursor:"pointer",marginTop:10},children:""})]}):a.jsx("div",{style:{width:"100%",height:"100%",backgroundImage:`url(${H()})`,backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat",opacity:D>=1?.9:0,transform:D>=1?"scale(1)":"scale(0.95)",transition:"opacity 0.6s ease-out, transform 0.6s ease-out"}})}),a.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:40,position:"relative"},children:[a.jsx("div",{style:{fontFamily:"var(--font-tamanegi)",fontSize:"5rem",color:$?"#f6e05e":"#a0aec0",textShadow:$?"0 0 40px rgba(246, 224, 94, 0.7), 4px 4px 8px rgba(0,0,0,0.6)":"0 0 20px rgba(160, 174, 192, 0.5), 4px 4px 8px rgba(0,0,0,0.6)",marginBottom:20,opacity:D>=2?1:0,transform:D>=2?"translateY(0)":"translateY(30px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out",animation:D>=2?"float 3s ease-in-out infinite":"none"},children:$?"":""}),_&&a.jsx("div",{style:{fontSize:"1.1rem",color:"rgba(255, 255, 255, 0.8)",marginTop:-10,marginBottom:20,opacity:D>=2?1:0,transform:D>=2?"translateY(0)":"translateY(20px)",transition:"opacity 0.4s ease-out 0.2s, transform 0.4s ease-out 0.2s"},children:_}),a.jsxs("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"center",gap:16,marginBottom:30,padding:"16px 24px",background:"rgba(0,0,0,0.3)",borderRadius:12,border:"1px solid rgba(255,255,255,0.1)",opacity:D>=3?1:0,transform:D>=3?"translateY(0)":"translateY(30px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out"},children:[a.jsxs("div",{style:{textAlign:"center",minWidth:80},children:[a.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#f6e05e"},children:u.turnCount}),a.jsx("div",{style:{fontSize:"0.9rem",color:"rgba(255,255,255,0.6)"},children:""})]}),a.jsxs("div",{style:{textAlign:"center",minWidth:80},children:[a.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#48bb78"},children:u.damageDealtToOpponent}),a.jsx("div",{style:{fontSize:"0.9rem",color:"rgba(255,255,255,0.6)"},children:""})]}),a.jsxs("div",{style:{textAlign:"center",minWidth:80},children:[a.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#e53e3e"},children:u.damageReceivedFromOpponent}),a.jsx("div",{style:{fontSize:"0.9rem",color:"rgba(255,255,255,0.6)"},children:""})]}),a.jsxs("div",{style:{textAlign:"center",minWidth:80},children:[a.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#63b3ed"},children:u.followersDestroyed}),a.jsx("div",{style:{fontSize:"0.9rem",color:"rgba(255,255,255,0.6)"},children:""})]})]}),k&&w&&a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:8,marginTop:16,opacity:D>=4?1:0,transform:D>=4?"translateY(0)":"translateY(20px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out"},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,background:"rgba(0, 0, 0, 0.5)",padding:"12px 24px",borderRadius:12,border:`2px solid ${w.ratingChange>=0?"#48bb78":"#e53e3e"}`},children:[a.jsx("span",{style:{fontSize:"1.2rem",color:"rgba(255,255,255,0.8)",fontFamily:"var(--font-tamanegi)"},children:""}),a.jsxs("span",{style:{fontSize:"2rem",fontWeight:"bold",color:w.ratingChange>=0?"#48bb78":"#e53e3e",fontFamily:"var(--font-tamanegi)"},children:[w.ratingChange>=0?"+":"",w.ratingChange]})]}),w.ratingChange>0&&(w.bonusBreakdown.winStreakBonus>0||w.bonusBreakdown.rankDiffBonus>0)&&a.jsxs("div",{style:{display:"flex",gap:16,fontSize:"0.85rem",color:"rgba(255,255,255,0.6)",fontFamily:"var(--font-tamanegi)"},children:[a.jsxs("span",{children:[": +",w.bonusBreakdown.base]}),w.bonusBreakdown.winStreakBonus>0&&a.jsxs("span",{style:{color:"#f6e05e"},children:[": +",w.bonusBreakdown.winStreakBonus]}),w.bonusBreakdown.rankDiffBonus>0&&a.jsxs("span",{style:{color:"#63b3ed"},children:[": +",w.bonusBreakdown.rankDiffBonus]})]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,fontSize:"1rem",color:"rgba(255,255,255,0.8)",fontFamily:"var(--font-tamanegi)"},children:[a.jsx("span",{style:{color:o3(w.newRank),fontWeight:"bold"},children:Po[w.newRank]}),a.jsx("span",{children:w.newRating})]}),w.isRankUp&&a.jsxs("div",{style:{fontSize:"1.4rem",fontWeight:"bold",color:"#f6e05e",textShadow:"0 0 20px rgba(246, 224, 94, 0.8)",fontFamily:"var(--font-tamanegi)",animation:"pulse 1s ease-in-out infinite"},children:[Po[w.newRank],""]}),w.isRankDown&&a.jsxs("div",{style:{fontSize:"1.2rem",color:"#e53e3e",fontFamily:"var(--font-tamanegi)"},children:[Po[w.newRank],""]})]}),a.jsx("div",{style:{position:"absolute",right:20,bottom:270,width:180,textAlign:"center",fontFamily:"var(--font-tamanegi)",fontSize:"1.4rem",color:$?"#f6e05e":"#e53e3e",textShadow:$?"0 0 20px rgba(246, 224, 94, 0.8), 2px 2px 4px rgba(0,0,0,0.8)":"0 0 20px rgba(229, 62, 62, 0.8), 2px 2px 4px rgba(0,0,0,0.8)",zIndex:10,opacity:D>=5?1:0,transition:"opacity 0.4s ease-out"},children:$?"":""}),ee&&!c?a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",animation:"fadeIn 0.3s ease-out"},children:[a.jsx("div",{style:{fontFamily:"var(--font-tamanegi)",fontSize:"1.6rem",color:"white",marginBottom:24,textShadow:"0 2px 6px rgba(0,0,0,0.6)"},children:""}),a.jsxs("div",{style:{display:"flex",gap:40,marginBottom:24},children:[a.jsx(P_,{deckType:"SENKA",label:"",onSelect:I,getStyle:R}),a.jsx(P_,{deckType:"AJA",label:"",onSelect:I,getStyle:R})]}),a.jsx("button",{onClick:()=>de(!1),style:{padding:"10px 36px",fontSize:"1.1rem",fontWeight:"bold",background:"transparent",border:"2px solid rgba(255,255,255,0.3)",color:"white",borderRadius:10,cursor:"pointer",marginTop:8},children:""})]}):a.jsxs("div",{style:{display:"flex",gap:20,opacity:D>=5?1:0,transform:D>=5?"translateY(0)":"translateY(30px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out"},children:[a.jsx("button",{onClick:()=>{c||de(!0)},disabled:c,style:C(),onMouseDown:y=>{c||(y.currentTarget.style.transform="scale(0.95)")},onMouseUp:y=>y.currentTarget.style.transform="scale(1)",children:O()}),a.jsxs("button",{onClick:i,style:{padding:"15px 40px",fontSize:"1.5rem",fontWeight:"bold",background:"transparent",border:"2px solid rgba(255,255,255,0.3)",color:"white",borderRadius:12,cursor:"pointer"},children:[" ",!ue&&`(${ne})`]})]}),a.jsx("div",{onClick:()=>{ee&&!c&&I("YORUKA")},style:{position:"absolute",right:20,bottom:20,width:180,height:240,backgroundImage:`url(${$?R_:A_})`,backgroundSize:"cover",backgroundPosition:"center",borderRadius:12,cursor:ee&&!c?"pointer":"default",opacity:D>=5?.7:0,transition:"opacity 0.4s ease",boxShadow:"0 8px 20px rgba(0,0,0,0.4)"}})]})]})},P_=({deckType:t,label:e,onSelect:n,getStyle:r})=>{const[s,i]=j.useState(!1);return a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:12},children:[a.jsx("button",{onClick:()=>n(t),onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),style:r(t,s)}),a.jsx("span",{style:{color:"white",fontFamily:"var(--font-tamanegi)",fontSize:"1.4rem",textShadow:"0 2px 6px rgba(0,0,0,0.6)"},children:e})]})},O_=(t,e)=>{const[n,r]=j.useState([]),s=j.useRef(!1);return j.useEffect(()=>{r(i=>{const o=[],l=new Map((t||[]).filter(c=>c).map(c=>[c.instanceId,c]));return i.forEach(c=>{var u;if(!c)return;const d=l.get(c.instanceId);d?(o.push({...d,passiveAbilities:d.passiveAbilities?[...d.passiveAbilities]:[],hasBarrier:d.hasBarrier??((u=d.passiveAbilities)==null?void 0:u.includes("BARRIER"))??!1,isDying:!1}),l.delete(c.instanceId)):o.push({...c,isDying:!0,killedByBane:c.killedByBane})}),l.forEach(c=>{var d;o.push({...c,passiveAbilities:c.passiveAbilities?[...c.passiveAbilities]:[],hasBarrier:c.hasBarrier??((d=c.passiveAbilities)==null?void 0:d.includes("BARRIER"))??!1,isDying:!1})}),o})},[t]),j.useEffect(()=>{if(n.some(o=>o.isDying)){if(e!=null&&e.current){s.current=!0;return}const o=setTimeout(()=>{r(l=>l.filter(c=>!c.isDying))},700);return()=>clearTimeout(o)}},[n,e]),j.useEffect(()=>{const o=setInterval(()=>{if(!(e!=null&&e.current)&&s.current){s.current=!1;const l=setTimeout(()=>{r(c=>c.filter(d=>!d.isDying))},300);return()=>clearTimeout(l)}},100);return()=>clearInterval(o)},[e]),n},l3=({playerClass:t,opponentType:e,gameMode:n,targetRoomId:r,onLeave:s,onRematching:i,networkAdapter:o,networkConnected:l,opponentClass:c,aiDifficulty:d="NORMAL",playerName:u,timerEnabled:h=!0,playerId:f,opponentPlayerId:E,opponentRating:k})=>{var Dm,Mm,Nm,jm,$m,Fm,Um,Bm,zm;const w=n==="CPU"||!o,$=$L(w?n==="CPU"?"CPU":n:"CPU",w?r:void 0),v=o||$.adapter,_=l!==void 0?l:$.connected,S=VL(),{scale:p,toGameX:D,toGameY:H}=S,{isLightMode:ne}=nI(),[V,ee]=L.useState(!1);L.useEffect(()=>{(()=>{ee("ontouchstart"in window||navigator.maxTouchPoints>0)})()},[]);const de=L.useCallback((m,x)=>({x:D(m),y:H(x)}),[D,H]),[ve,je]=L.useState(null),ue=j.useRef(S);L.useEffect(()=>{ue.current=S},[S]);const I=n==="CPU"||n==="HOST"||(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&(v==null?void 0:v.isHost)===!0,O=I?"p1":"p2",C=I?"p2":"p1";console.log("[GameScreen INIT]",{gameMode:n,"adapter?.isHost":v==null?void 0:v.isHost,isHost:I,currentPlayerId:O,connected:_,"networkAdapter provided":!!o,networkConnected:l});const R=c||(t==="YORUKA"?Math.random()<.5?"SENKA":"AJA":t==="SENKA"?"AJA":"SENKA"),y=n==="JOIN"||(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&!I,[g,T]=L.useReducer(RL,null,()=>{const m=n==="CPU"?"CPU":"";return y?Ed(m,R,u,t):Ed(u,t,m,R)}),[A,M]=L.useState(!y),Q=n==="CASUAL_MATCH"||n==="RANKED_MATCH",[U,ge]=j.useState(Q?!1:!y),[z,Te]=j.useState(!1),[te,X]=j.useState(!1),[Pe,we]=j.useState(!1),[We,be]=j.useState(Q),[Me,yt]=j.useState(!1),rt=j.useRef(!1);console.log("[GameScreen SYNC STATE]",{isCasualOrRanked:Q,isJoinSide:y,gameSynced:A,waitingForIntroSync:We,opponentReadyForIntro:Me,showBattleIntro:U,"introSyncSentRef.current":rt.current});const[tt,qe]=j.useState(!1),[Ne,st]=j.useState(null),[vt,Ot]=j.useState(0),[Ve,qt]=j.useState({x:0,y:0}),[ft,on]=j.useState("IDLE"),[zt,us]=j.useState(null),[ia,oa]=j.useState(!1),[Ir,nc]=j.useState(()=>Math.random()>.5),[sf,Ee]=j.useState(!1),[nt,Un]=j.useState(!1),[aa,rc]=j.useState("normal"),[Tr,J0]=j.useState(t),[sc,la]=j.useState({turnCount:0,damageDealtToOpponent:0,damageReceivedFromOpponent:0,followersDestroyed:0,myFollowersDestroyed:0}),[sI,of]=j.useState(null),[iI,oI]=j.useState(null),[q0,Z0]=j.useState(!1);j.useEffect(()=>{if(n!=="RANKED_MATCH"||!f||!g.winnerId||q0)return;(async()=>{try{const x=await aS(f,Tr),b=g.winnerId===O;let P;b?P=$O(x.rating,x.winStreak,k??0):P=FO(x.rating),await BO(f,Tr,P,b),oI(P),Z0(!0),console.log("[RatingUpdate] Rating updated:",P)}catch(x){console.error("[RatingUpdate] Failed to update rating:",x),Z0(!0)}})()},[n,f,g.winnerId,O,Tr,k,q0]),j.useEffect(()=>{g.winnerId&&!tt&&!Pe&&we(!0)},[g.winnerId,tt,Pe]),j.useEffect(()=>{if(vt<=0){qt({x:0,y:0});return}let m;const x=()=>{const b=Date.now()*.03,P=25*vt*p,N=Math.sin(b*7)*P+Math.sin(b*13)*P*.5,G=Math.cos(b*11)*P+Math.cos(b*17)*P*.3;qt({x:N,y:G}),m=requestAnimationFrame(x)};return m=requestAnimationFrame(x),()=>cancelAnimationFrame(m)},[vt,p]);const[af,em]=j.useState([]),aI=j.useRef(0),[lf,tm]=j.useState(!1),[cf,ic]=j.useState(null),[ca,Vi]=j.useState(null),Br=j.useRef(null),wr=j.useRef(null),Cr=j.useRef(null),df=j.useRef(g.logs.length),oc=L.useRef(!1),nm=L.useRef(!1),ac=L.useRef(null);L.useEffect(()=>{const m=n==="HOST"||(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&I,x=Q?_&&v:_&&v&&ft==="DONE";if(console.log("[GameScreen INIT_GAME useEffect]",{isHostSide:m,isCasualOrRanked:Q,connected:_,"adapter exists":!!v,coinTossPhase:ft,canSendInitGame:x,"initialStateSentRef.current":oc.current}),m&&x&&!oc.current){console.log("[GameScreen] HOST side: Sending initial game state to JOIN"),oc.current=!0;const b=()=>{console.log("[GameScreen] HOST side: Actually sending INIT_GAME now, isFirstPlayer:",Ir);const P=Q?{...g,firstPlayerId:Ir?"p1":"p2"}:g;v.send({type:"INIT_GAME",payload:P}),(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&(console.log("[GameScreen] HOST side: Sending READY_FOR_INTRO"),v.send({type:"READY_FOR_INTRO"}),rt.current=!0)};setTimeout(b,500),(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&setTimeout(()=>{Me||(console.log("[GameScreen] HOST side: Retrying INIT_GAME (no response yet)"),b())},2500)}},[n,_,v,g,ft,I,Q,Me]),L.useEffect(()=>{!Q||!v||!A||rt.current||y&&(console.log("[GameScreen] JOIN side: Sending READY_FOR_INTRO after game sync"),v.send({type:"READY_FOR_INTRO"}),rt.current=!0)},[Q,v,A,y]),L.useEffect(()=>{!Q||!v||!We||I&&Me&&rt.current&&(console.log("[GameScreen] HOST side: Both ready, sending START_INTRO"),v.send({type:"START_INTRO"}),be(!1),ge(!0))},[Q,v,I,Me,We]);const oe=g.players[O],Oe=g.players[C];L.useEffect(()=>{var x,b;const m=g.logs.length;if(m>df.current)for(let P=df.current;P<m;P++){const N=g.logs[P],G=N.match(/(.+?)  (\d+) /);if(G){const F=G[1],B=parseInt(G[2],10),Y=(oe==null?void 0:oe.name)===F?O:C,le=aI.current++;em(Z=>[...Z,{playerId:Y,amount:B,key:le}]),setTimeout(()=>{em(Z=>Z.filter(he=>he.key!==le))},1500)}const q=N.match(/(.+?) (?:)?/);if(q){const F=q[1],B=(x=g.players[O])==null?void 0:x.board.find(he=>(he==null?void 0:he.name)===F),Y=(b=g.players[C])==null?void 0:b.board.find(he=>(he==null?void 0:he.name)===F),le=B||Y,Z=B?O:C;if(le){const he=g.players[Z].board.findIndex(Se=>(Se==null?void 0:Se.instanceId)===le.instanceId),Ke=(Z===O?kr.current:lr.current)[he];if(Ke){const Se=Ke.getBoundingClientRect(),Ge=Se.left+Se.width/2,Je=Se.top+Se.height/2;yc(ze=>[...ze,{id:Date.now()+Math.random(),value:0,x:Ge,y:Je,color:"#e53e3e"}])}}}}df.current=m},[g.logs.length,O,C,oe==null?void 0:oe.name,g.players]);const[uf,da]=j.useState(!1),zr=j.useRef(!1),bn=O_(((Dm=g.players[O])==null?void 0:Dm.board)||[],zr),hn=O_(((Mm=g.players[C])==null?void 0:Mm.board)||[],zr),ua=j.useRef(bn),lc=j.useRef(hn),[li,cc]=j.useState(null),[ff,rm]=j.useState(-1),dc=j.useRef(null),[Yi,fa]=j.useState([]),[J,Hr]=j.useState(null),[ut,Qn]=j.useState(null),[lI,sm]=j.useState([]),cI=j.useRef(0),im=j.useRef(0),om=j.useRef(null),am=j.useRef(J);am.current=J,j.useEffect(()=>{const m=J==null?void 0:J.sourceType;if(!m||m!=="BOARD"&&m!=="EVOLVE"){sm([]);return}const x=400,b=setInterval(()=>{const P=am.current;if(!P||P.sourceType!=="BOARD"&&P.sourceType!=="EVOLVE")return;const N=Date.now(),G=Math.PI*(3-Math.sqrt(5));im.current+=G+(Math.random()-.5)*.3;const q=im.current,F=4+Math.random()*3,B={id:cI.current++,x:P.currentX,y:P.currentY,vx:Math.cos(q)*F,vy:Math.sin(q)*F,opacity:1,radius:3+Math.random()*2,createdAt:N};sm(Y=>[...Y.filter(Z=>N-Z.createdAt<x).map(Z=>({...Z,x:Z.x+Z.vx,y:Z.y+Z.vy,opacity:Math.max(0,1-(N-Z.createdAt)/x)})),B])},80);return()=>clearInterval(b)},[J==null?void 0:J.sourceType]),j.useEffect(()=>{const m=(J==null?void 0:J.sourceType)==="EVOLVE";if(m&&!Cr.current){const x=new Audio(Ze("/se/aura.mp3"));x.loop=!0,x.volume=0,x.play().catch(()=>{}),Cr.current=x;const b=300,P=30,N=b/P,G=.25/N;let q=0;const F=setInterval(()=>{q++,Cr.current&&(Cr.current.volume=Math.min(q*G,.25)),q>=N&&clearInterval(F)},P)}else if(!m&&Cr.current){const x=Cr.current,b=200,P=20,N=b/P,G=x.volume/N;let q=0;const F=setInterval(()=>{q++,x.volume=Math.max(0,x.volume-G),q>=N&&(clearInterval(F),x.pause(),x.currentTime=0)},P);Cr.current=null}return()=>{!J&&Cr.current&&(Cr.current.pause(),Cr.current=null)}},[J==null?void 0:J.sourceType]);const[lm,hf]=j.useState(new Set),[cm,uc]=j.useState(null),[dm,fc]=j.useState(null),[dI,um]=j.useState(null),[$e,Wr]=j.useState(null),pf=j.useCallback(m=>{const x=Kr(m);x&&(g.winnerId?of(x):Wr({card:x,owner:"OPPONENT",source:"LOG"}))},[g.winnerId]),uI=j.useCallback(m=>{const x=/([^]+)/g,b=[];let P=0,N,G=0;const q=tI();for(;(N=x.exec(m))!==null;){N.index>P&&b.push(a.jsx("span",{children:m.slice(P,N.index)},G++));const F=N[1];q.includes(F)?b.push(a.jsxs("span",{style:{color:"#ffd700",cursor:"pointer",textDecoration:"underline",textUnderlineOffset:"2px",fontWeight:"bold"},onMouseEnter:Y=>{Y.target.style.color="#ffec8b",Y.target.style.textShadow="0 0 8px rgba(255, 215, 0, 0.8)"},onMouseLeave:Y=>{Y.target.style.color="#ffd700",Y.target.style.textShadow="none"},onClick:Y=>{Y.stopPropagation(),pf(F)},children:["",F,""]},G++)):b.push(a.jsxs("span",{children:["",F,""]},G++)),P=N.index+N[0].length}return P<m.length&&b.push(a.jsx("span",{children:m.slice(P)},G++)),b.length>0?a.jsx(a.Fragment,{children:b}):m},[pf]),[hc,Ki]=j.useState([]),Wt=(m,x,b,P)=>{if(!m)return;let N=window.innerWidth/2,G=window.innerHeight/2;const q=x===C;if(b===void 0||b===-1){const B=q?Qi:di;if(B.current){const Y=B.current.getBoundingClientRect(),le=de(Y.left+Y.width/2,Y.top+Y.height/2);N=le.x,G=le.y}else G=q?150:rI-250}else if(b!==void 0&&b>=0){const B=q?lr:kr,Y=q?lc.current:ua.current;let le=b;if(P){const he=Y.findIndex(_e=>_e&&_e.instanceId===P);he>=0&&(le=he)}const Z=B.current[le];if(Z){const he=Z.getBoundingClientRect(),_e=de(he.left+he.width/2,he.top+he.height/2);N=_e.x,G=_e.y}}Ki(B=>[...B,{type:m,x:N,y:G,key:Date.now()+Math.random()}])},fm=(m,x,b,P,N)=>{let G=window.innerWidth/2,q=window.innerHeight/2;const F=m===C,B=F?lr:kr,Y=F?lc.current:ua.current;let le=x;if(N){const he=Y.findIndex(_e=>_e&&_e.instanceId===N);he>=0&&(le=he)}const Z=B.current[le];if(Z){const he=Z.getBoundingClientRect(),_e=de(he.left+he.width/2,he.top+he.height/2);G=_e.x,q=_e.y}Ki(he=>[...he,{type:"BUFF",x:G,y:q,key:Date.now()+Math.random(),atkBuff:b,hpBuff:P}])},ar=(m,x,b,P)=>{Wt(m,x,b,P),n==="HOST"&&_&&v&&v.send({type:"EFFECT",payload:{effectType:m,targetPlayerId:x||"",targetIndex:b??-1,targetInstanceId:P}})},ha=(m,x,b,P,N)=>{fm(m,x,b,P,N),n==="HOST"&&_&&v&&v.send({type:"EFFECT",payload:{effectType:"BUFF",targetPlayerId:m,targetIndex:x,targetInstanceId:N,isBuff:!0,atkBuff:b,hpBuff:P}})},hm=j.useRef([]),pm=j.useRef([]);j.useEffect(()=>{var P,N;const m=(G,q,F)=>{q.forEach(B=>{if(!B)return;if(!G.find(le=>le&&le.instanceId===B.instanceId)&&B.killedByBane){const le=F===C,Z=le?lr:kr,_e=(le?lc.current:ua.current).findIndex(Ke=>Ke&&Ke.instanceId===B.instanceId);if(_e>=0&&Z.current[_e]){const Se=Z.current[_e].getBoundingClientRect(),Ge=de(Se.left+Se.width/2,Se.top+Se.height/2);Ki(Je=>[...Je,{type:"BANE",x:Ge.x,y:Ge.y,key:Date.now()+Math.random()}])}}})},x=((P=g.players[O])==null?void 0:P.board)||[],b=((N=g.players[C])==null?void 0:N.board)||[];m(x,hm.current,O),m(b,pm.current,C),hm.current=x.map(G=>G?{...G}:null),pm.current=b.map(G=>G?{...G}:null)},[g.players,O,C]);const gf=600,[fs,pa]=j.useState(null),mf=j.useRef({player:0,opponent:0}),[Ct,ga]=j.useState(()=>{try{const m=localStorage.getItem("audioSettings");if(m){const x=JSON.parse(m);if(x.enabled!==void 0){const{enabled:b,...P}=x;return{...P,bgmEnabled:b,seEnabled:b}}return x}return{bgm:.3,se:.5,voice:.5,bgmEnabled:!0,seEnabled:!0}}catch{return{bgm:.3,se:.5,voice:.5,bgmEnabled:!0,seEnabled:!0}}}),_t=j.useCallback((m,x=.5)=>{if(!Ct.seEnabled)return;const b=new Audio(Ze(`/se/${m}`));b.volume=Ct.se*x,b.play().catch(P=>console.warn("SE Play prevented",P))},[Ct]),pc=j.useRef(null);j.useEffect(()=>{if(J&&ut&&!pc.current)_t("Buon.mp3",.25);else if(J&&ut&&pc.current){const m=pc.current;(m.instanceId!==ut.instanceId||m.index!==ut.index||m.playerId!==ut.playerId)&&_t("Buon.mp3",.25)}pc.current=ut},[ut,J,_t]);const En=j.useRef(null),[fI,gm]=j.useState(!1);j.useEffect(()=>{localStorage.setItem("audioSettings",JSON.stringify(Ct)),En.current&&(En.current.volume=Ct.bgmEnabled?Ct.bgm:0,Ct.bgmEnabled?En.current.paused&&En.current.play().catch(m=>console.warn("Auto-play prevented",m)):En.current.pause())},[Ct]);const[hI,gc]=j.useState(!1),[pI,yf]=j.useState(!1),[gI,mc]=j.useState(!1),mI=j.useCallback(()=>{console.log("[GameScreen] handleSurrender called"),mc(!1),gc(!1),n!=="CPU"&&v&&v.send({type:"SURRENDER",payload:{playerId:O}}),T({type:"CONCEDE",playerId:O})},[n,v,O]),[Gr,vf]=j.useState(!1),_f=j.useRef(!1),[mm,ym]=j.useState(!1),[it,ci]=j.useState(null),Xi=j.useRef(null),Qi=j.useRef(null),lr=j.useRef([]),kr=j.useRef([]),di=j.useRef(null),[yI,yc]=j.useState([]),vc=j.useRef({player:20,opponent:20}),_c=j.useRef({player:0,opponent:0}),ma=j.useRef(new Map);j.useEffect(()=>{var N,G,q,F;if(!oe||!Oe)return;const m=vc.current.opponent-Oe.hp;m>0&&la(B=>({...B,damageDealtToOpponent:B.damageDealtToOpponent+m}));const x=vc.current.player-oe.hp;x>0&&la(B=>({...B,damageReceivedFromOpponent:B.damageReceivedFromOpponent+x}));const b=_c.current.opponent-(((N=Oe.board)==null?void 0:N.filter(B=>B).length)||0);b>0&&la(B=>({...B,followersDestroyed:B.followersDestroyed+b}));const P=_c.current.player-(((G=oe.board)==null?void 0:G.filter(B=>B).length)||0);P>0&&la(B=>({...B,myFollowersDestroyed:B.myFollowersDestroyed+P})),vc.current={player:oe.hp,opponent:Oe.hp},_c.current={player:((q=oe.board)==null?void 0:q.filter(B=>B).length)||0,opponent:((F=Oe.board)==null?void 0:F.filter(B=>B).length)||0}},[oe==null?void 0:oe.hp,Oe==null?void 0:Oe.hp,(Nm=oe==null?void 0:oe.board)==null?void 0:Nm.length,(jm=Oe==null?void 0:Oe.board)==null?void 0:jm.length]);const an=j.useRef(null),vm="lastPlayedBgm",_m=j.useCallback(m=>{const x={AJA:[Ze("/bgm/Green Misty Mountains.mp3"),Ze("/bgm/Jade Moon.mp3"),Ze("/bgm/amaama.mp3"),Ze("/bgm/kingetsu.mp3")],SENKA:[Ze("/bgm/ouka.mp3"),Ze("/bgm/Jade Moon.mp3"),Ze("/bgm/amaama.mp3"),Ze("/bgm/kingetsu.mp3")]},b=x[m]||x.SENKA,P=sessionStorage.getItem(vm),N=b.length>1?b.filter(q=>q!==P):b,G=N[Math.floor(Math.random()*N.length)];return sessionStorage.setItem(vm,G),encodeURI(G)},[]),[xf,xm]=j.useState(null);j.useEffect(()=>{var m,x;if(console.log(`[PendingEffects] useEffect fired. isProcessingEffect=${uf}, pendingEffects.length=${((m=g.pendingEffects)==null?void 0:m.length)||0}, gameMode=${n}`),n==="JOIN"){console.log("[PendingEffects] Early return: JOIN mode waits for EFFECT messages from HOST");return}if(uf){console.log("[PendingEffects] Early return: isProcessingEffect=true");return}if(g.pendingEffects&&g.pendingEffects.length>0){const b=g.pendingEffects[0];if(console.log(`[PendingEffects] Processing effect: ${b.effect.type} from ${b.sourceCard.name}`),dc.current===b){console.log("[PendingEffects] Early return: same effect already processed");return}if(dc.current=b,da(!0),zr.current=!0,b.effect.type==="GENERATE_CARD"&&b.effect.targetCardId){const pe=[b],K=g.pendingEffects||[];for(let ke=1;ke<K.length;ke++){const ye=K[ke];if(ye.effect.type==="GENERATE_CARD"&&ye.sourceCard.id===b.sourceCard.id&&ye.sourcePlayerId===b.sourcePlayerId)pe.push(ye);else break}const ae=120,re=20,W=-(pe.length*ae+(pe.length-1)*re-ae)/2,se=b.sourcePlayerId===O,me=se?window.innerWidth-200*p:200*p,Ae=se?window.innerHeight-100*p:100*p,Ie=pe.map((ke,ye)=>({card:Kr(ke.effect.targetCardId),status:"APPEAR",targetX:me,targetY:Ae,xOffset:W+ye*(ae+re)})).filter(ke=>ke.card);if(Ie.length>0){fa(Ie),an.current&&clearTimeout(an.current),an.current=setTimeout(()=>{fa(ke=>ke.map(ye=>({...ye,status:"FLY"}))),an.current=setTimeout(()=>{fa([]),da(!1),zr.current=!1,(n==="CPU"||n==="HOST")&&(pe.forEach(ke=>{T({type:"RESOLVE_EFFECT",playerId:ke.sourcePlayerId,payload:{targetId:ke.targetId}})}),n==="HOST"&&_&&v&&setTimeout(()=>{const ke=et.current;v.send({type:"GAME_STATE",payload:ke})},50)),an.current=null},600)},800);return}}const P=b.effect.type==="DAMAGE"||b.effect.type==="AOE_DAMAGE"||b.effect.type==="RANDOM_DAMAGE"||b.effect.type==="RANDOM_DAMAGE_BY_TURN",N=b.effect.type==="DESTROY"||b.effect.type==="RANDOM_DESTROY",G=b.effect.type==="HEAL_LEADER",q=b.effect.type==="RANDOM_SET_HP",F=b.effect.type==="SET_MAX_HP",B=b.effect.type==="RETURN_TO_HAND",Y=b.effect.type==="SUMMON_CARD"||b.effect.type==="SUMMON_CARD_RUSH",le=b.effect.type==="VISUAL_BUFF_ONLY",Z=b.effect.type==="BUFF_STATS",he=G||B||Y||le||Z?600:50;if(P){let pe=b.sourceCard.attackEffectType||"SLASH";b.sourceCard.id==="c_alice"&&b.effect.targetType==="SELECT_FOLLOWER"&&(pe="WATER");const K=b.sourcePlayerId===O?C:O,ae=K===O?bn:hn;if(b.effect.type==="AOE_DAMAGE")g.players[K].board.forEach(ie=>{if(ie){const W=ae.findIndex(se=>(se==null?void 0:se.instanceId)===ie.instanceId);W!==-1&&ar(pe,K,W,ie.instanceId)}});else if(b.targetIds)b.effect.type==="RANDOM_DAMAGE_BY_TURN"?b.targetIds.forEach((ie,W)=>{setTimeout(()=>{const se=ae.findIndex(me=>(me==null?void 0:me.instanceId)===ie);se!==-1&&ar(pe,K,se,ie)},W*300)}):b.targetIds.forEach(re=>{const ie=ae.findIndex(W=>(W==null?void 0:W.instanceId)===re);ie!==-1&&ar(pe,K,ie,re)});else if(b.effect.targetType==="OPPONENT")ar(pe,K,-1),Bn();else if(b.targetId){const re=ae.findIndex(ie=>(ie==null?void 0:ie.instanceId)===b.targetId);re!==-1&&ar(pe,K,re,b.targetId)}}else if(N){let pe=b.sourceCard.attackEffectType||"IMPACT";const K=b.sourcePlayerId===O?C:O,ae=K===O?bn:hn;if(b.effect.targetType==="ALL_OTHER_FOLLOWERS"){ae.forEach((W,se)=>{W&&W.instanceId!==b.sourceCard.instanceId&&ar(pe,K,se,W.instanceId)});const re=b.sourcePlayerId;(re===O?bn:hn).forEach((W,se)=>{W&&W.instanceId!==b.sourceCard.instanceId&&ar(pe,re,se,W.instanceId)}),Bn()}else if(b.targetIds)b.targetIds.forEach(re=>{const ie=ae.findIndex(W=>(W==null?void 0:W.instanceId)===re);ie!==-1&&ar(pe,K,ie,re)});else if(b.targetId){const re=ae.findIndex(ie=>(ie==null?void 0:ie.instanceId)===b.targetId);re!==-1&&ar(pe,K,re,b.targetId)}}else if(G){const pe=b.sourcePlayerId;ar("HEAL",pe)}else if(F){const pe=b.sourcePlayerId===O?C:O;ar("RAY",pe,-1),Bn()}if(b.effect.type==="BUFF_STATS"){const pe=b.effect.value??0,K=b.effect.value2??0,ae=b.sourcePlayerId;if(b.effect.targetType==="SELF"){const ie=(ae===O?bn:hn).findIndex(W=>(W==null?void 0:W.instanceId)===b.sourceCard.instanceId);ie!==-1&&ha(ae,ie,pe,K,b.sourceCard.instanceId)}else if(b.effect.targetType==="ALL_FOLLOWERS"){const re=ae===O?bn:hn,ie=g.players[ae].board,W=b.effect.conditions;ie.forEach(se=>{var me;if(se){if(W!=null&&W.tag&&!((me=se.tags)!=null&&me.includes(W.tag))||W!=null&&W.nameIn&&!W.nameIn.includes(se.name))return;const Ae=re.findIndex(Ie=>(Ie==null?void 0:Ie.instanceId)===se.instanceId);Ae!==-1&&ha(ae,Ae,pe,K,se.instanceId)}})}else if(b.effect.targetType==="ALL_OTHER_FOLLOWERS"){const re=ae===O?bn:hn,ie=g.players[ae].board,W=b.effect.conditions;ie.forEach(se=>{var me;if(se&&se.instanceId!==b.sourceCard.instanceId){if(W!=null&&W.tag&&!((me=se.tags)!=null&&me.includes(W.tag))||W!=null&&W.nameIn&&!W.nameIn.includes(se.name))return;const Ae=re.findIndex(Ie=>(Ie==null?void 0:Ie.instanceId)===se.instanceId);Ae!==-1&&ha(ae,Ae,pe,K,se.instanceId)}})}else if(b.targetId){const ie=(ae===O?bn:hn).findIndex(W=>(W==null?void 0:W.instanceId)===b.targetId);ie!==-1&&ha(ae,ie,pe,K,b.targetId)}}if(le){const pe=b.effect.value??0,K=b.effect.value2??0,ae=b.sourcePlayerId,re=b.sourceCard;setTimeout(()=>{const ie=ae===O?bn:hn;if(re!=null&&re.instanceId){const W=ie.findIndex(se=>(se==null?void 0:se.instanceId)===re.instanceId);W!==-1&&ha(ae,W,pe,K,re.instanceId)}},300)}an.current&&clearTimeout(an.current);const Ke=P||N||q||F,Se=b.effect.type==="RANDOM_DAMAGE_BY_TURN",Ge=Se?((x=b.targetIds)==null?void 0:x.length)||g.turnCount:1,Je=Se?Ge*300+300:0,ze=Se?Je:Ke?700:he,He=Se?200:Ke?700:0;an.current=setTimeout(()=>{(n==="CPU"||n==="HOST")&&(T({type:"RESOLVE_EFFECT",playerId:b.sourcePlayerId,payload:{targetId:b.targetId}}),n==="HOST"&&_&&v&&setTimeout(()=>{const pe=et.current;v.send({type:"GAME_STATE",payload:pe})},50)),He>0?an.current=setTimeout(()=>{da(!1),zr.current=!1,an.current=null},He):(da(!1),zr.current=!1,an.current=null)},ze)}else dc.current=null,an.current&&(clearTimeout(an.current),an.current=null)},[g.pendingEffects,uf,O,C,n,_,v]),j.useEffect(()=>{if(g.activePlayerId!==O)return;const m=O===g.firstPlayerId,x=g.turnCount,b=m?5:4;if(x===(m?7:6)){if(ff===x)return;cc("SUPER_EVOLVE_READY"),rm(x),setTimeout(()=>cc(null),2500)}else if(x===b){if(ff===x)return;cc("EVOLVE_READY"),rm(x),setTimeout(()=>cc(null),2500)}},[g.turnCount,g.activePlayerId,O,ff,g.firstPlayerId]);const xc=j.useRef(g.players);j.useEffect(()=>{const m=xc.current,x=new Set;if(Object.keys(g.players).forEach(b=>{const P=g.players[b],N=m[b];if(!N)return;const G=new Set(N.board.filter(F=>F).map(F=>F.instanceId)),q=new Set(N.hand.filter(F=>F).map(F=>F.instanceId));P.board.forEach(F=>{if(!F)return;const B=F.instanceId;!G.has(B)&&!q.has(B)&&x.add(B)})}),x.size>0){hf(P=>new Set([...P,...x]));const b=setTimeout(()=>{hf(new Set)},1e3);return()=>clearTimeout(b)}},[g.players]),j.useEffect(()=>{const m=xc.current,x=g.players;let b=[];const P=N=>{const G=N.getBoundingClientRect();return{x:G.left+G.width/2,y:G.top+G.height/2}};Object.keys(x).forEach(N=>{const G=x[N],q=m[N];if(q&&G.hp<q.hp){const F=q.hp-G.hp,Y=N===O?di.current:Qi.current;if(Y){const le=P(Y);b.push({id:Date.now()+Math.random(),value:F,x:le.x,y:le.y,color:"#e53e3e"})}}else if(q&&G.hp>q.hp){const F=G.hp-q.hp,Y=N===O?di.current:Qi.current;if(Y){const le=P(Y);b.push({id:Date.now()+Math.random(),value:"+"+F,x:le.x,y:le.y,color:"#48bb78"})}}q==null||q.board.forEach(F=>{if(!F)return;const B=G.board.find(Y=>(Y==null?void 0:Y.instanceId)===F.instanceId);if(B){const Y=G.board.findIndex(_e=>(_e==null?void 0:_e.instanceId)===B.instanceId),he=(N===O?kr.current:lr.current)[Y];if(he){const _e=P(he);if(ma.current.set(F.instanceId,_e),B.currentHealth<F.currentHealth){const Ke=F.currentHealth-B.currentHealth;b.push({id:Date.now()+Math.random(),value:Ke,x:_e.x,y:_e.y,color:"#e53e3e"})}else if(B.currentHealth>F.currentHealth){const Ke=B.hasEvolved&&!F.hasEvolved,Se=B.currentAttack!==F.currentAttack||B.maxHealth!==F.maxHealth;if(!Ke&&!Se){const Ge=B.currentHealth-F.currentHealth;b.push({id:Date.now()+Math.random(),value:"+"+Ge,x:_e.x,y:_e.y,color:"#48bb78"})}}else B.currentHealth===F.currentHealth&&F.hasBarrier&&!B.hasBarrier&&b.push({id:Date.now()+Math.random(),value:0,x:_e.x,y:_e.y,color:"#e53e3e"})}}else{const Y=G.graveyard.find(Z=>Z.instanceId===F.instanceId);let le=0;if(Y){const Z=Y.currentHealth||0;Z<=0?le=F.currentHealth-Z:le=0}else le=F.currentHealth;if(le>0){const Z=ma.current.get(F.instanceId);Z&&(Z.x!==0||Z.y!==0)&&b.push({id:Date.now()+Math.random(),value:le,x:Z.x,y:Z.y,color:"#e53e3e"})}ma.current.delete(F.instanceId)}})}),b.length>0&&(yc(G=>[...G,...b]),b.some(G=>G.color!=="#48bb78")&&Bn()),xc.current=x},[g.players,O,C]);const bf=j.useRef(null),Bn=()=>{bf.current||(ym(!0),bf.current=setTimeout(()=>{ym(!1),bf.current=null},300))},Ef=L.useCallback(m=>{yc([]),Ki([]),fa([]),zn(null),Ji(null),pa(null),hf(new Set),hs.current=!1,Sf.current=null,la({turnCount:0,damageDealtToOpponent:0,damageReceivedFromOpponent:0,followersDestroyed:0,myFollowersDestroyed:0}),vc.current={player:20,opponent:20},_c.current={player:0,opponent:0},of(null),we(!1),qe(!1),st(null),Ee(!1),Un(!1);const x=m||Tr;m&&J0(m);let b=R;e==="CPU"&&(x==="YORUKA"?b=Math.random()<.5?"SENKA":"AJA":b=x==="SENKA"?"AJA":"SENKA");const N=Ed(u,x,e==="ONLINE"?"":"CPU",b);xc.current=N.players,mf.current={player:N.players.p1.hand.length,opponent:N.players.p2.hand.length},xm(null),ge(n!=="JOIN"),nc(Math.random()>.5),on("IDLE"),us(null),oa(!1),n==="HOST"&&(oc.current=!1),T({type:"SYNC_STATE",payload:N})},[Tr,R,e,n]),vI=L.useCallback(()=>{if(ge(!1),Te(!1),X(!0),us(Ir?"FIRST":"SECOND"),!Ir){const m={...g,activePlayerId:"p2",firstPlayerId:"p2",players:{p1:{...g.players.p1,maxPp:0,pp:0},p2:{...g.players.p2,maxPp:1,pp:1}},logs:[` 1 - ${g.players.p2.name} `]};T({type:"SYNC_STATE",payload:m})}on("DONE")},[g,Ir]);L.useEffect(()=>{},[g.phase,ft,n,_t,_]),j.useEffect(()=>{if(xf===oe.class&&En.current)return;const m=_m(oe.class);console.log(`[BGM] Initializing track: ${m} for class: ${oe.class}`),En.current&&(En.current.pause(),En.current=null);const x=new Audio(m);x.loop=!0,x.volume=Ct.bgm,En.current=x,xm(oe.class)},[oe.class,_m,xf]),j.useEffect(()=>()=>{En.current&&(console.log("[GameScreen] Stopping BGM on unmount"),En.current.pause(),En.current=null)},[]),j.useEffect(()=>{if(!En.current)return;const m=En.current,x=()=>{m.paused&&Ct.bgmEnabled&&(console.log("[BGM] Attempting play on interaction..."),m.play().then(()=>{console.log("[BGM] Play success"),b()}).catch(P=>console.warn("[BGM] Play failed on interaction:",P)))},b=()=>{document.removeEventListener("click",x),document.removeEventListener("keydown",x),document.removeEventListener("touchstart",x)};return Ct.bgmEnabled?(document.addEventListener("click",x),document.addEventListener("keydown",x),document.addEventListener("touchstart",x),m.play().then(()=>{console.log("[BGM] Immediate play success"),b()}).catch(()=>console.log("[BGM] Immediate play blocked, waiting for interaction"))):(m.pause(),b()),()=>{b()}},[Ct.bgmEnabled,Ct.bgm,xf]),L.useEffect(()=>{if(!v){console.log("[GameScreen] Message handler setup skipped - no adapter yet");return}console.log("[GameScreen] Setting up message handler, adapter.isHost:",v.isHost);const m=x=>{var b,P,N,G,q;if(console.log("[GameScreen] Received message:",x.type,x),x.type==="HANDSHAKE"){const F=(b=x.payload)==null?void 0:b.name,B=typeof F=="string"&&F.trim().slice(0,12)||"";console.log("[GameScreen] Received HANDSHAKE from opponent:",B),ac.current=B,T({type:"UPDATE_PLAYER_NAME",payload:{playerId:O==="p1"?"p2":"p1",name:B}});return}if(x.type==="INIT_GAME"){console.log("[GameScreen] JOIN side: Received initial game state from HOST"),T({type:"SYNC_STATE",payload:x.payload}),T({type:"UPDATE_PLAYER_NAME",payload:{playerId:O,name:u}});const F=O==="p1"?"p2":"p1";ac.current&&(console.log("[GameScreen] Re-applying opponent name after INIT_GAME:",ac.current),T({type:"UPDATE_PLAYER_NAME",payload:{playerId:F,name:ac.current}})),M(!0);const B=x.payload.firstPlayerId===O;console.log("[GameScreen] JOIN side: Setting isFirstPlayer, firstPlayerId:",x.payload.firstPlayerId,"currentPlayerId:",O,"isJoinSideFirst:",B),nc(B),n==="CASUAL_MATCH"||n==="RANKED_MATCH"?console.log("[GameScreen] CASUAL_MATCH JOIN side: Waiting for intro sync"):ge(!0);return}if(x.type==="READY_FOR_INTRO"){console.log("[GameScreen] Received READY_FOR_INTRO from opponent"),yt(!0);return}if(x.type==="START_INTRO"){console.log("[GameScreen] Received START_INTRO - starting BattleIntro now"),be(!1),ge(!0);return}if(x.type==="GAME_STATE"){console.log("[GameScreen] JOIN: Received GAME_STATE sync from HOST"),T({type:"SYNC_STATE",payload:x.payload}),da(!1),zr.current=!1,dc.current=null,fa([]),an.current&&(clearTimeout(an.current),an.current=null),!va.current&&!Zi.current&&(pn.current=!1);return}if(x.type==="EFFECT"){const{effectType:F,targetPlayerId:B,targetIndex:Y,targetInstanceId:le,isBuff:Z,atkBuff:he,hpBuff:_e}=x.payload;console.log("[GameScreen] JOIN: Received EFFECT from HOST:",F,B,Y,le),setTimeout(()=>{Z&&he!==void 0&&_e!==void 0?fm(B,Y,he,_e,le):Wt(F,B,Y,le)},50);return}if(x.type==="EVOLVE_ANIM"){const{playerId:F,followerIndex:B,useSep:Y,targetId:le,instanceId:Z}=x.payload,he=(P=g.players[F])==null?void 0:P.board[B];if(he){const _e=he.evolvedImageUrl||((N=Kr(he.id))==null?void 0:N.evolvedImageUrl),Ke=Z||he.instanceId,Se=hn.findIndex(K=>K&&K.instanceId===Ke),Ge=Se>=0?lr.current[Se]:null,Je=ue.current.scale,ze=window.innerHeight/2;let He=window.innerWidth/2,pe=ze-70*Je;if(Ge){const K=Ge.getBoundingClientRect();He=K.left+K.width/2,pe=K.top+K.height/2}Ji({card:he,evolvedImageUrl:_e,startX:He,startY:pe,phase:"ZOOM_IN",followerIndex:B,sourcePlayerId:F,useSep:Y||!1,targetId:le,isRemote:!0}),_t("fon.mp3",.7)}return}if(x.type==="PLAY_CARD_ANIM"){const{playerId:F,card:B,targetBoardIndex:Y}=x.payload;if(B){const le=((G=g.players[F])==null?void 0:G.board)||[],Z=typeof Y=="number"?Y:le.filter(W=>W!==null).length,he=ue.current.scale,_e=window.innerWidth/2,Ke=window.innerHeight/2,Se=_e,Ge=80*he,Je=_e,ze=Ke-100*he,ae=-((Math.max(1,Z+1)-1)*fi*he)/2+Z*fi*he,re=_e+ae,ie=Ke-70*he;B.type==="SPELL"?zn({card:B,sourceIndex:-1,startX:Se,startY:Ge,targetX:Je,targetY:ze,playerClass:(Oe==null?void 0:Oe.class)||"SENKA",onComplete:()=>{zn(null)}}):zn({card:B,sourceIndex:-1,startX:Se,startY:Ge,targetX:Je,targetY:ze,finalX:re,finalY:ie,playerClass:(Oe==null?void 0:Oe.class)||"SENKA",onComplete:()=>{_t("gan.mp3",.6),Bn(),zn(null)}})}return}if(x.type==="REMATCH_REQUEST"){console.log("[GameScreen] Opponent requested rematch"),Un(!0);return}if(x.type==="REMATCH_ACCEPT"){console.log("[GameScreen] Opponent accepted rematch - starting new game"),Ef(Tr);return}if(x.type==="SURRENDER"){const F=(q=x.payload)==null?void 0:q.playerId;if(g.phase==="GAME_OVER"){console.warn("[GameScreen] Ignoring SURRENDER - game already over");return}if(F===O){console.warn(`[GameScreen] Security Alert: Received SURRENDER message targeting self (${O}). Ignoring.`);return}if(F!==C){console.warn(`[GameScreen] Security Alert: Invalid playerId in SURRENDER: ${F}. Expected: ${C}. Ignoring.`);return}console.log("[GameScreen] Opponent surrendered:",F),rc("surrender"),T({type:"CONCEDE",playerId:F});return}if(x.type==="STAMP"){console.log("[GameScreen] Opponent sent stamp:",x.stampId),wr.current&&(clearTimeout(wr.current),wr.current=null);const F=I_(x.stampId);F&&_t(F,.6);const B={stampId:x.stampId,playerId:C,playerClass:x.playerClass||(Oe==null?void 0:Oe.class)||"SENKA",timestamp:Date.now()};Vi(null),requestAnimationFrame(()=>{Vi(B)}),wr.current=setTimeout(()=>{Vi(Y=>(Y==null?void 0:Y.timestamp)===B.timestamp?null:Y),wr.current=null},3e3);return}if(x.type==="ACTION"){const F=x.payload;if(console.log("[GameScreen] Processing remote action:",F.type,"from player:",F.playerId),T({...F,isRemote:!0}),F.type==="ATTACK"){const{playerId:B,payload:Y}=F,le=g.players[B],Z=le==null?void 0:le.board[Y.attackerIndex],he=Y.targetIsLeader?-1:Y.targetIndex,_e=B==="p1"?"p2":"p1";if(Z){const Ke=g.players[_e],Se=Y.targetIsLeader?null:Ke==null?void 0:Ke.board[Y.targetIndex],Ge=Se?Se.instanceId:void 0;Wt(Z.attackEffectType,_e,he,Ge)}}else F.type==="PLAY_CARD"||F.type==="EVOLVE"||F.type==="END_TURN"&&(console.log("[GameScreen] Remote END_TURN received, turn switching to:",F.playerId==="p1"?"p2":"p1"),qi.current=!1)}};return v.onMessage(m),n!=="CPU"&&!nm.current&&(nm.current=!0,v.send({type:"HANDSHAKE",payload:{name:u,class:t}}),console.log("[GameScreen] Sent HANDSHAKE:",u,t)),v.onClose(()=>{if((n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&g.phase==="GAME_OVER"){console.log("[GameScreen] Connection closed after game over (casual match) - silent disconnect");return}if(n!=="CPU"&&g.phase!=="GAME_OVER"){console.log("[GameScreen] Opponent disconnected during game - treating as surrender, player wins"),rc("disconnect");const x={...g,phase:"GAME_OVER",winnerId:O,logs:[...g.logs,""]};T({type:"SYNC_STATE",payload:x});return}alert(`
`),s()}),()=>{}},[v,g,_t,Wt,n,s,O]);const hs=j.useRef(!1),Sf=j.useRef(null),On=j.useRef(null),[Ye,zn]=j.useState(null),[Lt,Ji]=j.useState(null),pn=j.useRef(!1),ya=j.useRef(null),qi=j.useRef(!1),If=j.useRef(hc),Tf=j.useRef(Yi),va=j.useRef(Ye),Zi=j.useRef(Lt);L.useEffect(()=>{If.current=hc,Tf.current=Yi,va.current=Ye,Zi.current=Lt},[hc,Yi,Ye,Lt]),L.useEffect(()=>{if(Ye&&Ye.card.name===""&&Ct.seEnabled){const m=new Audio(Ze("/se/beam.mp3"));m.volume=Ct.se*.8,m.play().catch(x=>console.warn("SE Play prevented",x))}},[Ye,Ct]),L.useEffect(()=>{ua.current=bn,lc.current=hn},[bn,hn]),L.useEffect(()=>{const m=x=>{const b=x.getBoundingClientRect();return{x:b.left+b.width/2,y:b.top}};bn.forEach((x,b)=>{if(x&&x.instanceId){const P=kr.current[b];if(P){const N=m(P);(N.x!==0||N.y!==0)&&ma.current.set(x.instanceId,N)}}}),hn.forEach((x,b)=>{if(x&&x.instanceId){const P=lr.current[b];if(P){const N=m(P);(N.x!==0||N.y!==0)&&ma.current.set(x.instanceId,N)}}})},[bn,hn]);const bc=(m,x,b,P)=>{const N=Rr.current.board,G=P?N.findIndex(Z=>Z&&Z.instanceId===P):m,q=G>=0?N[G]:null;if(!q)return;if(q.hasEvolved){console.log("[GameScreen] Cannot evolve: card already evolved");return}const F=kr.current[m];let B=window.innerWidth/2,Y=window.innerHeight/2;if(F){const Z=F.getBoundingClientRect();B=Z.left+Z.width/2,Y=Z.top+Z.height/2}const le=q.instanceId;n!=="CPU"&&_&&v&&v.send({type:"EVOLVE_ANIM",payload:{playerId:O,followerIndex:G,useSep:x,targetId:b,instanceId:le}}),Ji({card:q,evolvedImageUrl:q.evolvedImageUrl,startX:B,startY:Y,phase:"ZOOM_IN",followerIndex:G,useSep:x,targetId:b,sourcePlayerId:O}),_t("fon.mp3",.7)},wf=j.useRef(null),_I=j.useCallback(m=>{if(console.log("[GameScreen] handleEvolvePhaseChange:",m),m==="WHITE_FADE"&&_t("fon.mp3",.7),m==="LAND"&&_t("gan.mp3",.6),m==="DONE"){const x=Zi.current;if(x&&!x.isRemote){const P={type:"EVOLVE",playerId:x.sourcePlayerId||O,payload:{followerIndex:x.followerIndex,useSep:x.useSep,targetId:x.targetId}};T(P),v&&n!=="CPU"&&v.send({type:"ACTION",payload:P})}Ji(null)}else Ji(x=>x?{...x,phase:m}:null)},[v,T,n,O,_t]),Cf=(m,x,b)=>{var He,pe,K,ae,re,ie;const N=Rr.current.hand[m];if(!N){console.warn("[handlePlayCard] Card not found at index:",m);return}if(N.instanceId&&ya.current===N.instanceId){console.warn("[handlePlayCard] Duplicate play blocked for instanceId:",N.instanceId);return}if(pn.current){console.warn("[handlePlayCard] Card play locked, ignoring duplicate call");return}pn.current=!0,ya.current=N.instanceId||null,_t("card.mp3",.5);const G=(He=N.triggers)==null?void 0:He.find(W=>W.trigger==="FANFARE"),q=G==null?void 0:G.effects[0];let F=C;const B=(q==null?void 0:q.targetType)==="SELECT_ALLY_FOLLOWER"||(q==null?void 0:q.targetType)==="SELECT_OTHER_ALLY_FOLLOWER";q&&(B||["GRANT_PASSIVE","BUFF_STATS","HEAL_FOLLOWER"].includes(q.type))&&(F=O);const Y=["SELECT_FOLLOWER","SELECT_ALLY_FOLLOWER","SELECT_OTHER_ALLY_FOLLOWER"],le=N.type==="SPELL"&&((pe=N.triggers)==null?void 0:pe.some(W=>W.effects.some(se=>se.targetType&&Y.includes(se.targetType))))||N.type==="FOLLOWER"&&(((ae=(K=N.triggerAbilities)==null?void 0:K.FANFARE)==null?void 0:ae.targetType)&&Y.includes(N.triggerAbilities.FANFARE.targetType)||((re=N.triggers)==null?void 0:re.some(W=>W.trigger==="FANFARE"&&W.effects.some(se=>se.targetType&&Y.includes(se.targetType))))),he=et.current.players[F].board.some(W=>{var se,me;return W&&(F===O||!((se=W.passiveAbilities)!=null&&se.includes("STEALTH"))&&!((me=W.passiveAbilities)!=null&&me.includes("AURA")))});if(console.log(`[handlePlayCard] needsTarget: ${le}, allowedTarget: ${F}, hasValidTargets: ${he}`),le&&he){ci({type:"PLAY",sourceIndex:m,sourceInstanceId:N.instanceId,allowedTargetPlayerId:F}),Hr(null);return}const _e=window.innerWidth/2,Ke=window.innerHeight/2;let Se,Ge;if(N.type==="FOLLOWER"){const se=et.current.players[O].board.filter(Re=>Re!==null),me=se.length+1,Ae=se.length,Ie=fi*p,ke=(Ae-(me-1)/2)*Ie,ye=(ie=Xi.current)==null?void 0:ie.getBoundingClientRect();Se=(ye?ye.left+ye.width/2:window.innerWidth/2)+ke,Ge=window.innerHeight/2+70*p}const Je=()=>{N.type!=="SPELL"&&(_t("gan.mp3",.6),Bn()),ps({type:"PLAY_CARD",playerId:O,payload:{cardIndex:m,instanceId:N.instanceId}}),zn(null),setTimeout(()=>{pn.current=!1},100)},ze=N.type==="FOLLOWER"?et.current.players[O].board.filter(W=>W!==null).length:void 0;n!=="CPU"&&_&&v&&v.send({type:"PLAY_CARD_ANIM",payload:{playerId:O,cardIndex:m,card:N,targetBoardIndex:ze}}),zn({card:N,sourceIndex:m,startX:x,startY:b,targetX:_e,targetY:Ke,finalX:Se,finalY:Ge,playerClass:(oe==null?void 0:oe.class)||"SENKA",onComplete:Je}),setTimeout(()=>{zn(W=>(W==null?void 0:W.card.id)===N.id?(Je(),null):W)},2e3)},ps=m=>{T(m),n!=="CPU"&&_&&!m.isRemote&&(v==null||v.send({type:"ACTION",payload:m}))};j.useEffect(()=>{if(!Lt&&wf.current){const m=wf.current;wf.current=null,console.log("[GameScreen] Dispatching pending evolve action for:",m.playerId),ps({type:"EVOLVE",playerId:m.playerId,payload:{followerIndex:m.followerIndex,useSep:m.useSep,targetId:m.targetId}})}},[Lt,O,ps]);const Rr=j.useRef(oe),et=j.useRef(g);j.useEffect(()=>{Rr.current=oe,et.current=g},[oe,g]);const cr=j.useRef(!1);j.useEffect(()=>{const m=mf.current,x=oe.hand.length,b=Oe.hand.length;if(x>m.player){const P=x-m.player;pa({isPlayer:!0,count:P}),_t("card.mp3",.5),setTimeout(()=>pa(null),gf)}if(b>m.opponent){const P=b-m.opponent;pa({isPlayer:!1,count:P}),_t("card.mp3",.5),setTimeout(()=>pa(null),gf)}mf.current={player:x,opponent:b}},[oe.hand.length,Oe.hand.length,Ct,_t]),L.useEffect(()=>{g.activePlayerId===O&&(console.log("[GameScreen] Player turn started - resetting card play lock and ending turn state"),pn.current=!1,ya.current=null,qi.current=!1)},[g.activePlayerId,g.turnCount,O]),L.useEffect(()=>{if(n==="CPU")return;const m=setInterval(()=>{pn.current&&!va.current&&!Zi.current&&!it&&g.activePlayerId===O&&(console.warn("[GameScreen] Safety release: Card play lock was stuck, releasing"),pn.current=!1)},3e3);return()=>clearInterval(m)},[n,it,g.activePlayerId,O]),L.useEffect(()=>{if(n!=="CPU")return;if(g.winnerId){hs.current=!1;return}const m=`${g.turnCount}-${g.activePlayerId}`;if(g.activePlayerId===O){hs.current=!1;return}if(g.activePlayerId===C){if(hs.current||Sf.current===m)return;(async()=>{var Se,Ge,Je,ze,He,pe;hs.current=!0,Sf.current=m;const b=async(K=300)=>{await new Promise(ie=>setTimeout(ie,K));const ae=()=>{const ie=et.current,W=ie.pendingEffects&&ie.pendingEffects.length>0,se=If.current.length>0,me=Tf.current.length>0,Ae=va.current!==null,Ie=Zi.current!==null;return!W&&!se&&!me&&!Ae&&!Ie};let re=0;for(;!ae()&&re<60;){await new Promise(W=>setTimeout(W,100)),re++;const ie=et.current;if(ie.pendingEffects&&ie.pendingEffects.length>0&&!zr.current){console.log("[waitForIdle] Forcing RESOLVE_EFFECT for stuck pending effect");const W=ie.pendingEffects[0];T({type:"RESOLVE_EFFECT",playerId:W.sourcePlayerId,payload:{targetId:W.targetId}}),await new Promise(se=>setTimeout(se,200))}}},P=(K,ae)=>{var re;return K?!!((re=K.passiveAbilities)!=null&&re.includes("IMMUNE_TO_FOLLOWER_DAMAGE")):!1},N=(K,ae)=>{var re;return!ae||!K?!1:(re=ae.passiveAbilities)!=null&&re.includes("BANE")&&!K.hasBarrier?!0:(ae.currentAttack||0)>=K.currentHealth},G=(K,ae)=>{var re;return!ae||!K?!1:(re=K.passiveAbilities)!=null&&re.includes("BANE")?!ae.hasBarrier:K.currentAttack>=ae.currentHealth},q=K=>{var se,me,Ae;let ae=0;const re=K.players[C].board.filter(Ie=>Ie!==null),W=K.players[O].board.filter(Ie=>Ie!==null).some(Ie=>{var ke,ye;return((ke=Ie.passiveAbilities)==null?void 0:ke.includes("WARD"))&&!((ye=Ie.passiveAbilities)!=null&&ye.includes("STEALTH"))});for(const Ie of re)!Ie.canAttack||!((se=Ie.passiveAbilities)!=null&&se.includes("STORM")||Ie.turnPlayed!==K.turnCount)||W&&!((me=Ie.passiveAbilities)!=null&&me.includes("STEALTH"))&&!Ie.hadStealth||(ae+=Ie.currentAttack||0,(Ae=Ie.passiveAbilities)!=null&&Ae.includes("DOUBLE_ATTACK")&&(ae+=Ie.currentAttack||0));return ae},F=K=>{var ie,W,se;let ae=0;const re=K.players[O].board.filter(me=>me!==null);for(const me of re)ae+=me.currentAttack||0,(ie=me.passiveAbilities)!=null&&ie.includes("DOUBLE_ATTACK")&&(ae+=me.currentAttack||0),(W=me.passiveAbilities)!=null&&W.includes("BANE")&&(ae+=15),(se=me.passiveAbilities)!=null&&se.includes("STORM")&&(ae+=10);return ae},B=(K,ae)=>{var ke,ye,Xe,Re;let re=K.cost*10;const ie=ae.players[O].board.filter(De=>De!==null),W=ae.players[C].board.filter(De=>De!==null),se=ae.players[O].hp,me=ae.players[C].hp,Ae=ae.players[C].pp;if((ke=K.passiveAbilities)!=null&&ke.includes("STORM")){const De=q(ae),Le=K.attack||0;De+Le>=se?re+=500:se<=10?re+=100:re+=30}if(ie.length>0){const De=K.triggers||[],Le=F(ae);for(const St of De)if(St.trigger==="FANFARE")for(const Fe of St.effects||[]){if(Fe.type==="DESTROY"&&(re+=60+(Le>10?30:0)),Fe.type==="RANDOM_DESTROY"){const Qe=Fe.value||1;re+=40*Qe+(Le>10?20:0)}["DAMAGE","SELECT_DAMAGE"].includes(Fe.type)&&(re+=35),Fe.type==="AOE_DAMAGE"&&(re+=25*Math.min(ie.length,3))}}me<=10&&((ye=K.passiveAbilities)!=null&&ye.includes("WARD")&&(re+=80),re+=20),K.cost===Ae?re+=15:Ae-K.cost<=1&&(re+=10);const Ie=K.triggers||[];for(const De of Ie)if(De.trigger==="FANFARE")for(const Le of De.effects||[])Le.type==="DRAW"&&(re+=20*(Le.value||1)),(Le.type==="SUMMON_CARD"||Le.type==="SUMMON_CARD_RUSH")&&(re+=30),Le.type==="GENERATE_CARD"&&(re+=15),Le.type==="HEAL"&&(re+=me<15?25:10);return K.type==="FOLLOWER"&&((K.attack||0)+(K.health||0)>=K.cost*2.5&&(re+=15),(Xe=K.passiveAbilities)!=null&&Xe.includes("WARD")&&ie.length>0&&(re+=25),(Re=K.passiveAbilities)!=null&&Re.includes("BANE")&&(re+=20)),K.type==="FOLLOWER"&&W.length>=5&&(re-=200),re},Y=(K,ae,re,ie)=>{let W=0;const se=re.players[O].board.filter(ye=>ye!==null),me=re.players[C].board.filter(ye=>ye!==null),Ae=K.triggers||[],Ie=ie?"SUPER_EVOLVE":"EVOLVE";let ke=!1;for(const ye of Ae)if(ye.trigger===Ie){ke=!0;for(const Xe of ye.effects||[]){if(["DESTROY","RANDOM_DESTROY","DAMAGE","SELECT_DAMAGE","AOE_DAMAGE"].includes(Xe.type)&&(W+=se.length>0?80:5),["SUMMON_CARD","SUMMON_CARD_RUSH"].includes(Xe.type)&&(W+=60),Xe.type==="BUFF_STATS"){const Re=Xe.targetType||"SELF";Re==="ALL_OTHER_FOLLOWERS"||Re==="ALL_FOLLOWERS"?W+=25*Math.max(1,me.length-1):W+=30}Xe.type==="DRAW"&&(W+=35),Xe.type==="GENERATE_CARD"&&(W+=25)}}return K.canAttack?(W+=30,W+=(K.currentAttack||0)*5):W+=(K.currentAttack||0)*2,K.cost>=6&&ke&&(W+=20),!ke&&K.cost<=3&&(W-=30),W},le=(K,ae)=>{const ie=K.players[C].board.filter(Re=>Re!==null),W=K.players[O].board.filter(Re=>Re!==null),se=K.players[O].hp,me=K.players[C].hp,Ae=K.turnCount,Ie=ie.filter(Re=>Re&&!Re.hasEvolved);if(Ie.length===0)return!1;const ke=Ie.map((Re,De)=>({c:Re,i:De,score:Y(Re,De,K,ae)})),ye=Math.max(...ke.map(Re=>Re.score));if(se<=12&&ie.some(Re=>Re&&Re.canAttack)||me<=10)return!0;const Xe=F(K);return Xe>=8&&Ie.some(De=>{const Le=De.triggers||[];for(const St of Le)if(St.trigger===(ae?"SUPER_EVOLVE":"EVOLVE")){for(const Fe of St.effects||[])if(["DESTROY","RANDOM_DESTROY","DAMAGE","AOE_DAMAGE"].includes(Fe.type))return!0}return!1})&&W.length>0||ye>=80||ae&&ye>=50?!0:Ae<=5&&me>=15&&Xe<8?ye>=100:ye<30?!1:ye>=50},Z=(K,ae,re)=>{var Ae,Ie,ke,ye,Xe;const ie=((Ae=K.passiveAbilities)==null?void 0:Ae.includes("STORM"))||K.turnPlayed!==re.turnCount,W=ae.map((Re,De)=>({c:Re,i:De})).filter(({c:Re})=>{var De,Le;return Re!==null&&!((De=Re.passiveAbilities)!=null&&De.includes("STEALTH"))&&!((Le=Re.passiveAbilities)!=null&&Le.includes("AURA"))});if(!(((Ie=K.passiveAbilities)==null?void 0:Ie.includes("STEALTH"))||K.hadStealth)){const Re=W.find(({c:De})=>{var Le;return(Le=De.passiveAbilities)==null?void 0:Le.includes("WARD")});if(Re)return P(Re.c)?{index:-1,isLeader:!1}:{index:Re.i,isLeader:!1}}let me={index:-1,isLeader:ie,score:ie?0:-1e3};for(const{c:Re,i:De}of W){if(P(Re))continue;let Le=0;const St=K.isEvolved,Fe=(ke=Re.passiveAbilities)==null?void 0:ke.includes("BANE"),Qe=N(K,Re);G(K,Re)?(Le+=50,Le+=(Re.currentAttack||0)*5,Qe?Fe&&St?Le-=60:Fe&&(Le-=30):Le+=30,Fe&&!Qe&&(Le+=40),(ye=Re.passiveAbilities)!=null&&ye.includes("STORM")&&(Le+=30),(Xe=Re.passiveAbilities)!=null&&Xe.includes("DOUBLE_ATTACK")&&(Le+=35)):!Qe&&K.currentAttack>=Re.currentHealth/2?Le+=10:Qe&&(Le-=50,St&&(Le-=40),(Re.currentAttack||0)>=5&&(Le+=10)),Le>me.score&&(me={index:De,isLeader:!1,score:Le})}return ie&&(me.index===-1||me.score<=0)?{index:-1,isLeader:!0}:me},he=d==="EASY"?1200:d==="HARD"?400:800;if(await new Promise(K=>setTimeout(K,he)),!hs.current)return;let _e=0;const Ke=d==="EASY"?1:d==="HARD"?5:3;for(;_e<Ke;){const K=et.current,ae=K.players[C].hand,re=K.players[C].pp,W=K.players[C].board.filter(Fe=>Fe!==null).length>=5;let se=ae.map((Fe,Qe)=>({...Fe,originalIndex:Qe})).filter(Fe=>Fe.cost<=re).filter(Fe=>!(Fe.type==="FOLLOWER"&&W));if(se.length===0||(d==="HARD"?se=se.sort((Fe,Qe)=>B(Qe,K)-B(Fe,K)):se=se.sort((Fe,Qe)=>Qe.cost-Fe.cost),d==="EASY"&&Math.random()<.3&&_e>0))break;const me=se[0];let Ae;const ke=K.players[O].board.filter(Fe=>{var Qe,mt;return Fe&&!((Qe=Fe.passiveAbilities)!=null&&Qe.includes("STEALTH"))&&!((mt=Fe.passiveAbilities)!=null&&mt.includes("AURA"))});ke.length>0&&(d==="HARD"?Ae=[...ke].sort((Qe,mt)=>{var xt,Tt;let at=(Qe.currentAttack||0)+(Qe.currentHealth||0),pt=(mt.currentAttack||0)+(mt.currentHealth||0);return(xt=Qe.passiveAbilities)!=null&&xt.includes("BANE")&&(at+=10),(Tt=mt.passiveAbilities)!=null&&Tt.includes("BANE")&&(pt+=10),pt-at})[0].instanceId:Ae=ke[0].instanceId);const ye=window.innerWidth-20*p-80*p/2,Xe=20*p+110*p/2,Re=window.innerWidth/2,De=window.innerHeight/2;let Le,St;if(me.type==="FOLLOWER"){const Qe=et.current.players[C].board.filter(wc=>wc!==null),mt=Qe.length+1,at=Qe.length,pt=fi*p,xt=(at-(mt-1)/2)*pt,Tt=(Se=Xi.current)==null?void 0:Se.getBoundingClientRect();Le=(Tt?Tt.left+Tt.width/2:window.innerWidth/2)+xt,St=window.innerHeight/2-70*p}zn({card:me,sourceIndex:-1,startX:ye,startY:Xe,targetX:Re,targetY:De,finalX:Le,finalY:St,playerClass:(Oe==null?void 0:Oe.class)||"SENKA",onComplete:()=>{if(me.type!=="SPELL"&&(_t("gan.mp3",.6),Bn()),T({type:"PLAY_CARD",playerId:C,payload:{cardIndex:me.originalIndex,targetId:Ae,instanceId:me.instanceId}}),me.id==="c_amandava"&&et.current.players[O].board.forEach((Qe,mt)=>{if(Qe){const at=Qe.instanceId;setTimeout(()=>{Wt("SHOT",O,mt,at)},200)}}),me.id==="c_azya"){if(setTimeout(()=>{Wt("THUNDER",O,-1)},200),Ae){const Qe=et.current.players[O].board.findIndex(mt=>(mt==null?void 0:mt.instanceId)===Ae);Qe!==-1&&setTimeout(()=>{Wt("ICE",O,Qe,Ae)},400)}setTimeout(()=>{const Fe=et.current.players[O].board,Qe=Fe.filter(mt=>mt!==null);if(Qe.length>0){const mt=Qe[Math.floor(Math.random()*Qe.length)],at=Fe.findIndex(pt=>(pt==null?void 0:pt.instanceId)===(mt==null?void 0:mt.instanceId));at!==-1&&Wt("WATER",O,at,mt==null?void 0:mt.instanceId)}},600)}zn(null)}}),await b(600),_e++}{const K=et.current,ae=K.players[C],re=C===K.firstPlayerId,ie=K.turnCount,W=k_(ae,ie,re);if((C_(ae,ie,re)||W)&&ae.board.length>0){const me=ae.board.map((Ae,Ie)=>({c:Ae,i:Ie})).filter(({c:Ae})=>Ae&&Ae.type==="FOLLOWER"&&!Ae.hasEvolved);if(me.length>0){let Ae;const Ie=W;if(d==="HARD"&&(le(K,Ie)||console.log("[AI HARD] Skipping evolution - saving EP for better opportunity")),d==="HARD"&&!le(K,Ie))Ae=null;else if(d==="EASY")Ae=me[Math.floor(Math.random()*me.length)];else{const ye=me.map(({c:Xe,i:Re})=>({c:Xe,i:Re,score:Y(Xe,Re,K,Ie)}));ye.sort((Xe,Re)=>Re.score-Xe.score),d==="HARD"&&ye[0].score<5?(console.log("[AI HARD] Evolution target score too low:",ye[0].score),Ae=null):Ae=ye[0]}if(Ae){let ye;const Re=K.players[O].board.filter(Le=>{var St,Fe;return Le!==null&&!((St=Le.passiveAbilities)!=null&&St.includes("STEALTH"))&&!((Fe=Le.passiveAbilities)!=null&&Fe.includes("AURA"))});Re.length>0&&(d==="HARD"?ye=[...Re].sort((St,Fe)=>{var at,pt,xt,Tt;let Qe=(St.currentAttack||0)*2+(St.currentHealth||0),mt=(Fe.currentAttack||0)*2+(Fe.currentHealth||0);return(at=St.passiveAbilities)!=null&&at.includes("BANE")&&(Qe+=10),(pt=Fe.passiveAbilities)!=null&&pt.includes("BANE")&&(mt+=10),(xt=St.passiveAbilities)!=null&&xt.includes("DOUBLE_ATTACK")&&(Qe+=5),(Tt=Fe.passiveAbilities)!=null&&Tt.includes("DOUBLE_ATTACK")&&(mt+=5),mt-Qe})[0].instanceId:ye=Re[0].instanceId);const De=(Ge=lr.current[Ae.i])==null?void 0:Ge.getBoundingClientRect();De?(Ji({card:Ae.c,evolvedImageUrl:Ae.c.evolvedImageUrl,startX:De.left+De.width/2,startY:De.top+De.height/2,useSep:Ie,phase:"ZOOM_IN",followerIndex:Ae.i,sourcePlayerId:C,targetId:ye}),await b(800)):(ps({type:"EVOLVE",playerId:C,payload:{followerIndex:Ae.i,useSep:Ie,targetId:ye}}),await b(400))}}}}{let K=!0,ae=0;const re=ie=>{if(d!=="HARD")return!1;const W=ie.players[O].hp;return q(ie)>=W};for(;K&&ae<15;){if(et.current.winnerId){K=!1;break}ae++;const ie=et.current,W=ie.players[C].board,se=ie.players[O].board,me=re(ie);let Ae=!1;for(let Ie=0;Ie<W.length;Ie++){const ke=W[Ie];if(!ke||!ke.canAttack)continue;let ye=-1,Xe=!0;const Re=((Je=ke.passiveAbilities)==null?void 0:Je.includes("STEALTH"))||ke.hadStealth,De=Re?-1:se.findIndex(at=>{var pt,xt;return at&&((pt=at.passiveAbilities)==null?void 0:pt.includes("WARD"))&&!((xt=at.passiveAbilities)!=null&&xt.includes("STEALTH"))&&!P(at)});if(me&&De===-1)if(((ze=ke.passiveAbilities)==null?void 0:ze.includes("STORM"))||ke.turnPlayed!==ie.turnCount)ye=-1,Xe=!0;else{const xt=se.map((Tt,vs)=>({c:Tt,idx:vs})).filter(({c:Tt})=>{var vs,wc;return Tt&&!((vs=Tt.passiveAbilities)!=null&&vs.includes("STEALTH"))&&!((wc=Tt.passiveAbilities)!=null&&wc.includes("AURA"))&&!P(Tt)});if(xt.length>0)ye=xt[0].idx,Xe=!1;else continue}else if(De!==-1)ye=De,Xe=!1;else if(d==="EASY"){const at=se.map((xt,Tt)=>({c:xt,idx:Tt})).filter(({c:xt})=>{var Tt,vs;return xt&&!((Tt=xt.passiveAbilities)!=null&&Tt.includes("STEALTH"))&&!((vs=xt.passiveAbilities)!=null&&vs.includes("AURA"))&&!P(xt)}),pt=((He=ke.passiveAbilities)==null?void 0:He.includes("STORM"))||ke.turnPlayed!==ie.turnCount;if(!pt&&at.length>0)ye=at[Math.floor(Math.random()*at.length)].idx,Xe=!1;else{if(!pt&&at.length===0)continue;pt&&at.length>0&&Math.random()<.5&&(ye=at[Math.floor(Math.random()*at.length)].idx,Xe=!1)}}else{const at=Z(ke,se,ie);if(ye=at.index,Xe=at.isLeader,ye===-1&&!Xe)continue}const Le=(pe=ke.passiveAbilities)==null?void 0:pe.includes("STORM"),St=ke.turnPlayed===ie.turnCount;if(!Le&&St&&Xe){const at=se.map((pt,xt)=>({c:pt,idx:xt})).filter(({c:pt})=>{var xt,Tt;return pt&&!((xt=pt.passiveAbilities)!=null&&xt.includes("STEALTH"))&&!((Tt=pt.passiveAbilities)!=null&&Tt.includes("AURA"))&&!P(pt)});if(at.length>0){const pt=Re?null:at.find(({c:xt})=>{var Tt;return(Tt=xt.passiveAbilities)==null?void 0:Tt.includes("WARD")});pt?ye=pt.idx:ye=at[0].idx,Xe=!1}else continue}const Fe=Xe?null:se[ye],Qe=Fe?Fe.instanceId:void 0,mt=ke.instanceId;if(mt&&(uc(mt),setTimeout(()=>uc(null),300)),Wt(ke.attackEffectType||"SLASH",O,Xe?-1:ye,Qe),!Xe&&ye>=0){const at=se[ye];if(at&&(at.currentAttack||0)>0){const pt=at.instanceId;setTimeout(()=>{pt&&(fc(pt),setTimeout(()=>fc(null),300)),Wt(at.attackEffectType||"SLASH",C,Ie,mt)},200)}}Ae=!0,await b(1e3),T({type:"ATTACK",playerId:C,payload:{attackerIndex:Ie,targetIndex:ye,targetIsLeader:Xe}}),await b(1e3);break}Ae||(K=!1)}}if(await b(300),et.current.winnerId){hs.current=!1;return}T({type:"END_TURN",playerId:C}),hs.current=!1})()}},[g.activePlayerId,g.turnCount,n,g.phase,d,g.winnerId]);const bm=(m,x)=>{if(On.current||Ye||Yi.length>0)return;const b=oe.hand[x];m.stopPropagation();const P="touches"in m?m.touches[0].clientX:m.clientX,N="touches"in m?m.touches[0].clientY:m.clientY,G=m.currentTarget.getBoundingClientRect();if(!Gr){vf(!0),Wr({card:b,owner:"PLAYER",source:"HAND"}),_f.current=!0;return}if(Wr({card:b,owner:"PLAYER",source:"HAND"}),g.activePlayerId!==O)return;if(pn.current){console.warn("[handleHandMouseDown] Card play in progress, blocking drag start");return}const q=et.current;if(q.winnerId){console.log("UI: Card play drag blocked - game has ended");return}if(q.pendingEffects&&q.pendingEffects.length>0){console.log("UI: Card play drag blocked - pendingEffects still processing");return}const F={sourceType:"HAND",sourceIndex:x,sourceInstanceId:b.instanceId,startX:G.left+G.width/2,startY:G.top+G.height/2,currentX:P,currentY:N,offsetX:0,offsetY:0,canDrag:!0};Hr(F),On.current=F},Em=(m,x,b)=>{m.stopPropagation();const P="touches"in m?m.touches[0].clientX:m.clientX,N="touches"in m?m.touches[0].clientY:m.clientY,G=et.current;if(G.winnerId){console.log("UI: Attack drag blocked - game has ended");return}const q=G.players[O].board,F=b?q.findIndex(Y=>Y&&Y.instanceId===b):x,B=F>=0?q[F]:null;if(it&&it.allowedTargetPlayerId===O&&B){kf("FOLLOWER",F,O,b);return}if(B&&Wr({card:B,owner:"PLAYER",source:"BOARD"}),G.pendingEffects&&G.pendingEffects.length>0){console.log("UI: Attack drag blocked - pendingEffects still processing");return}if(G.activePlayerId===O&&(B!=null&&B.canAttack)){const Y=m.currentTarget.getBoundingClientRect(),le={x:Y.left+Y.width/2,y:Y.top+Y.height/2},Z={sourceType:"BOARD",sourceIndex:F,sourceInstanceId:B.instanceId,startX:le.x,startY:le.y,currentX:P,currentY:N,offsetX:0,offsetY:0};Hr(Z),On.current=Z}},Ec=(m,x=!1)=>{if(g.activePlayerId!==O)return;m.stopPropagation();const b="touches"in m?m.touches[0].clientX:m.clientX,P="touches"in m?m.touches[0].clientY:m.clientY,N=et.current;if(N.winnerId){console.log("UI: Evolve drag blocked - game has ended");return}if(N.pendingEffects&&N.pendingEffects.length>0){console.log("UI: Evolve drag blocked - pendingEffects still processing");return}const G=O===g.firstPlayerId;if(x){if(!k_(oe,g.turnCount,G))return}else if(!C_(oe,g.turnCount,G))return;const q=m.currentTarget.getBoundingClientRect(),F=q.left+q.width/2,B=q.top+q.height/2,Y={sourceType:"EVOLVE",sourceIndex:0,startX:F,startY:B,currentX:b,currentY:P,offsetX:0,offsetY:0,useSep:x};Hr(Y),On.current=Y},Sm=L.useCallback(m=>{wr.current&&(clearTimeout(wr.current),wr.current=null);const x={stampId:m,playerId:O,playerClass:Tr,timestamp:Date.now()},b=I_(m);b&&_t(b,.6),Vi(null),requestAnimationFrame(()=>{Vi(x)}),e==="ONLINE"&&v&&v.send({type:"STAMP",stampId:m,playerClass:Tr}),wr.current=setTimeout(()=>{Vi(P=>(P==null?void 0:P.timestamp)===x.timestamp?null:P),wr.current=null},3e3)},[O,Tr,e,v]),xI=L.useCallback(m=>{if(m.stopPropagation(),m.preventDefault(),di.current){const x=di.current.getBoundingClientRect();Br.current={x:x.left+x.width/2,y:x.top+x.height/2}}else Br.current={x:m.clientX,y:m.clientY};tm(!0),ic(null)},[]),Im=j.useRef(null);j.useEffect(()=>{Im.current=cf},[cf]),L.useEffect(()=>{if(!lf)return;const m=b=>{if(!Br.current)return;const P=b.clientX-Br.current.x,N=b.clientY-Br.current.y,G=Math.sqrt(P*P+N*N),q=Math.atan2(N,P)*(180/Math.PI);if(G>=200&&G<=320&&N<0){const le=180- -q,Z=Math.floor(le/22.5),_e=Math.max(0,Math.min(7,Z))+1;ic(_e)}else ic(null)},x=()=>{const b=Im.current;b&&Sm(b),tm(!1),ic(null),Br.current=null};return window.addEventListener("mousemove",m),window.addEventListener("mouseup",x),()=>{window.removeEventListener("mousemove",m),window.removeEventListener("mouseup",x)}},[lf,Sm]),L.useEffect(()=>{const m=(P,N,G=!1)=>{var B,Y,le,Z;if(!On.current)return;const{canDrag:q,sourceType:F}=On.current;if(!(F==="HAND"&&!q)&&(On.current={...On.current,currentX:P,currentY:N},Hr(he=>he?{...he,currentX:P,currentY:N}:null),G&&(F==="BOARD"||F==="EVOLVE"))){const he=Qi.current;if(he){const Se=he.getBoundingClientRect();if(P>=Se.left&&P<=Se.right&&N>=Se.top&&N<=Se.bottom){Qn({type:"LEADER",index:0,playerId:C});return}}const _e=et.current,Ke=((B=_e.players[C])==null?void 0:B.board)||[];for(let Se=0;Se<lr.current.length;Se++){const Ge=lr.current[Se];if(Ge&&Ke[Se]){const Je=Ge.getBoundingClientRect();if(P>=Je.left&&P<=Je.right&&N>=Je.top&&N<=Je.bottom){Qn({type:"FOLLOWER",index:Se,playerId:C,instanceId:(Y=Ke[Se])==null?void 0:Y.instanceId});return}}}if(F==="EVOLVE"){const Se=((le=_e.players[O])==null?void 0:le.board)||[];for(let Ge=0;Ge<kr.current.length;Ge++){const Je=kr.current[Ge];if(Je&&Se[Ge]){const ze=Je.getBoundingClientRect();if(P>=ze.left&&P<=ze.right&&N>=ze.top&&N<=ze.bottom){Qn({type:"FOLLOWER",index:Ge,playerId:O,instanceId:(Z=Se[Ge])==null?void 0:Z.instanceId});return}}}}Qn(null)}},x=P=>{m(P.clientX,P.clientY)},b=P=>{P.touches.length>0&&(On.current&&P.preventDefault(),m(P.touches[0].clientX,P.touches[0].clientY,!0))};return window.addEventListener("mousemove",x),window.addEventListener("touchmove",b,{passive:!1}),()=>{window.removeEventListener("mousemove",x),window.removeEventListener("touchmove",b)}},[]);const Tm=j.useRef(null),bI=j.useRef(null);L.useEffect(()=>{Tm.current=ut,bI.current=ut},[ut]),L.useEffect(()=>{const m=()=>{var N,G,q,F,B,Y,le,Z,he,_e,Ke,Se,Ge;const b=On.current,P=Tm.current;if(et.current.winnerId){console.log("[handleGlobalMouseUp] Game has ended, cancelling all actions"),Hr(null),On.current=null,Qn(null);return}if(b){if(b.sourceType==="HAND"){if(pn.current){console.warn("[handleGlobalMouseUp] Card play in progress, cancelling drag"),On.current=null,Hr(null);return}const Je=Math.sqrt(Math.pow(b.startX-b.currentX,2)+Math.pow(b.startY-b.currentY,2)),ze=b.currentY<window.innerHeight-200*p;if(b.canDrag&&Je>30&&ze){const He=Rr.current.hand[b.sourceIndex];if(Rr.current.pp>=He.cost){const pe=((G=(N=He.triggerAbilities)==null?void 0:N.FANFARE)==null?void 0:G.targetType)==="SELECT_FOLLOWER"||((q=He.triggers)==null?void 0:q.some(ie=>ie.trigger==="FANFARE"&&ie.effects.some(W=>W.targetType==="SELECT_FOLLOWER"))),K=((B=(F=He.triggerAbilities)==null?void 0:F.FANFARE)==null?void 0:B.targetType)==="SELECT_ALLY_FOLLOWER"||((Y=He.triggers)==null?void 0:Y.some(ie=>ie.trigger==="FANFARE"&&ie.effects.some(W=>W.targetType==="SELECT_ALLY_FOLLOWER"))),ae=((Z=(le=He.triggerAbilities)==null?void 0:le.FANFARE)==null?void 0:Z.targetType)==="SELECT_OTHER_ALLY_FOLLOWER"||((he=He.triggers)==null?void 0:he.some(ie=>ie.trigger==="FANFARE"&&ie.effects.some(W=>W.targetType==="SELECT_OTHER_ALLY_FOLLOWER")));if(pe||K||ae){const ie=K||ae?O:C;et.current.players[ie].board.some(me=>{var Ae,Ie;return!(!me||ie!==O&&((Ae=me.passiveAbilities)!=null&&Ae.includes("STEALTH")||(Ie=me.passiveAbilities)!=null&&Ie.includes("AURA")))})?(pn.current=!0,ya.current=He.instanceId||null,ci({type:"PLAY",sourceIndex:b.sourceIndex,sourceInstanceId:He.instanceId,allowedTargetPlayerId:ie}),cr.current=!0,setTimeout(()=>{cr.current=!1},100)):(console.log("[handleGlobalMouseUp] No valid targets, skipping target selection"),Cf(b.sourceIndex,b.startX,b.startY),Wr(null),cr.current=!0,setTimeout(()=>{cr.current=!1},100))}else Cf(b.sourceIndex,b.startX,b.startY),Wr(null),cr.current=!0,setTimeout(()=>{cr.current=!1},100);On.current=null,Hr(null);return}}else b.canDrag||vf(!0)}else if(b.sourceType==="BOARD"){if(P&&P.playerId===C){const ze=et.current.players[C],He=ze.board.filter(W=>{var se,me;return W&&((se=W.passiveAbilities)==null?void 0:se.includes("WARD"))&&!((me=W.passiveAbilities)!=null&&me.includes("STEALTH"))});let pe=!1;const K=W=>W?ze.board.findIndex(se=>se&&se.instanceId===W):-1,ae=P.type==="LEADER"?-1:K(P.instanceId),re=Rr.current.board[b.sourceIndex],ie=((_e=re==null?void 0:re.passiveAbilities)==null?void 0:_e.includes("STEALTH"))||(re==null?void 0:re.hadStealth);if(He.length>0&&!ie){if(P.type==="LEADER")pe=!0;else if(P.type==="FOLLOWER"&&ae>=0){const W=ze.board[ae];W&&!((Ke=W.passiveAbilities)!=null&&Ke.includes("WARD"))&&(pe=!0)}}if(pe)console.log("UI: Attack blocked by WARD");else{const W=Rr.current.board.findIndex(Xe=>Xe&&Xe.instanceId===b.sourceInstanceId),se=W>=0?Rr.current.board[W]:null,me=(Se=se==null?void 0:se.passiveAbilities)==null?void 0:Se.includes("RUSH"),Ae=(Ge=se==null?void 0:se.passiveAbilities)==null?void 0:Ge.includes("STORM"),Ie=(se==null?void 0:se.turnPlayed)===et.current.turnCount,ke=P.type==="LEADER",ye=ae;if(ke&&me&&!Ae&&Ie)console.log("UI: Attack blocked by RUSH rule (Cannot attack leader)");else{if(W<0||!se){console.log("UI: Attack blocked - invalid attacker");return}const Xe=et.current;if(Xe.pendingEffects&&Xe.pendingEffects.length>0){console.log("UI: Attack blocked - pendingEffects still processing");return}const Re=P.instanceId,De=b.sourceInstanceId,Le=!ke&&ye>=0?ze.board[ye]:null;ps({type:"ATTACK",playerId:O,payload:{attackerIndex:W,targetIndex:ke?-1:ye,targetIsLeader:ke}}),De&&(uc(De),setTimeout(()=>uc(null),300));const Fe=(se==null?void 0:se.attackEffectType)||"SLASH";if(Wt(Fe,C,ke?-1:ye,Re),Bn(),!ke&&Le&&(Le.currentAttack||0)>0){const Qe=Le.instanceId;setTimeout(()=>{Qe&&(fc(Qe),setTimeout(()=>fc(null),300)),Wt(Le.attackEffectType||"SLASH",O,W,De)},200)}}}}}else if(b.sourceType==="EVOLVE"&&P&&P.type==="FOLLOWER"&&P.playerId===O){const Je=P.index,He=ua.current[Je],pe=(He==null?void 0:He.instanceId)||P.instanceId,K=Rr.current.board,ae=pe?K.findIndex(De=>De&&De.instanceId===pe):Je,re=ae>=0?K[ae]:null;if(!re)return;if(re.hasEvolved){console.log("[GameScreen] Cannot evolve: card already evolved (drag drop)");return}const W=b.useSep?["SUPER_EVOLVE","EVOLVE"]:["EVOLVE"],me=(()=>{var Le,St;const De=(St=(Le=re==null?void 0:re.triggerAbilities)==null?void 0:Le.EVOLVE)==null?void 0:St.targetType;if(De)return De;for(const Fe of(re==null?void 0:re.triggers)||[])if(W.includes(Fe.trigger)){for(const Qe of Fe.effects)if(Qe.targetType&&["SELECT_FOLLOWER","SELECT_ALLY_FOLLOWER","SELECT_OTHER_ALLY_FOLLOWER"].includes(Qe.targetType))return Qe.targetType}return null})(),Ae=!!me,Ie=me==="SELECT_ALLY_FOLLOWER"||me==="SELECT_OTHER_ALLY_FOLLOWER",ke=me==="SELECT_OTHER_ALLY_FOLLOWER",ye=Ie?O:C,Re=et.current.players[ye].board.some(De=>{var Le,St;return!(!De||Ie&&ke&&De.instanceId===pe||!Ie&&((Le=De.passiveAbilities)!=null&&Le.includes("STEALTH")||(St=De.passiveAbilities)!=null&&St.includes("AURA")))});Ae&&Re?(ci({type:"EVOLVE",sourceIndex:ae,sourceInstanceId:pe,sourceVisualIndex:Je,useSep:b.useSep,allowedTargetPlayerId:ye,excludeInstanceId:ke?pe:void 0}),cr.current=!0,setTimeout(()=>{cr.current=!1},100)):(bc(Je,b.useSep,void 0,pe),cr.current=!0,setTimeout(()=>{cr.current=!1},100))}}b&&b.sourceType==="HAND"&&b.canDrag&&(um(b.sourceIndex),setTimeout(()=>um(null),300)),Hr(null),On.current=null,Qn(null)},x=()=>{m()};return window.addEventListener("mouseup",m),window.addEventListener("touchend",x),()=>{window.removeEventListener("mouseup",m),window.removeEventListener("touchend",x)}},[C,O,Gr,p]);const EI=()=>{if(!cr.current){if(it){it.type==="PLAY"&&(pn.current=!1),ci(null);return}if(Gr){if(_f.current){_f.current=!1;return}vf(!1),Wr(null),je(null)}}},gs=()=>{if(!J||J.sourceType!=="BOARD"&&J.sourceType!=="EVOLVE")return"";const m=J.currentX-J.startX,x=J.currentY-J.startY,b=Math.sqrt(m*m+x*x);if(b<10)return"";const P=(J.startX+J.currentX)/2,N=(J.startY+J.currentY)/2,G=Math.min(200,b*.3),q=Math.abs(m),F=Math.min(150,q*.4),B=G+F,le=-(m/(b+1))*B*.5,Z=-B*.8,he=P+le,_e=N+Z;return`M${J.startX},${J.startY} Q${he},${_e} ${J.currentX},${J.currentY}`},kf=(m,x,b,P)=>{var q;if(!it)return;if(it.allowedTargetPlayerId&&it.allowedTargetPlayerId!==b){console.log("Invalid target side");return}if(it.excludeInstanceId&&P===it.excludeInstanceId){console.log("Cannot target self (SELECT_OTHER_ALLY_FOLLOWER)"),Bn();return}let N,G=x;if(m==="FOLLOWER"){if(P&&(G=g.players[b].board.findIndex(B=>B&&B.instanceId===P),G<0))return;const F=g.players[b].board[G];if(!F)return;if(N=F.instanceId,b!==O){const B=F.passiveAbilities||[];if(B.includes("STEALTH")){console.log("Cannot target unit with STEALTH"),_t("cancel"),Bn();return}if(B.includes("AURA")){console.log("Cannot target unit with AURA"),_t("cancel"),Bn();return}}}else return;if(it.type==="PLAY"){const F=Rr.current;let B=it.sourceIndex,Y=F.hand[B];if(it.sourceInstanceId){const ze=F.hand.findIndex(He=>He.instanceId===it.sourceInstanceId);if(ze>=0)B=ze,Y=F.hand[ze],console.log(`[handleTargetClick] Using sourceInstanceId ${it.sourceInstanceId}, found at index ${ze} (was ${it.sourceIndex})`);else{console.error("[handleTargetClick] Card not found with instanceId:",it.sourceInstanceId),ci(null);return}}if(!Y){console.error("[handleTargetClick] Card not found at index:",B),ci(null),pn.current=!1;return}pn.current=!0,ya.current=Y.instanceId||null,Y.id==="c_y"&&(Wt("SUMI","p2",G,N),et.current.players[C].board.forEach((He,pe)=>{if(He){const K=He.instanceId;setTimeout(()=>{Wt("SUMI",C,pe,K)},300)}})),Y.id==="s_resignation_proxy"&&(Wt("SUMI",b,G,N),setTimeout(()=>{const ze=et.current.players[O].board,He=[];if(ze.forEach((pe,K)=>{pe&&He.push({index:K,instanceId:pe.instanceId})}),He.length>0){const pe=He[Math.floor(Math.random()*He.length)];Wt("SUMI",O,pe.index,pe.instanceId)}},500)),Y.id==="c_azya"&&(Wt("THUNDER",C,-1),setTimeout(()=>{Wt("ICE",b,G,N)},300),setTimeout(()=>{const ze=et.current.players[C].board,He=ze.filter(pe=>pe!==null);if(He.length>0){const pe=He[Math.floor(Math.random()*He.length)],K=ze.findIndex(ae=>(ae==null?void 0:ae.instanceId)===(pe==null?void 0:pe.instanceId));K!==-1&&Wt("WATER",C,K,pe==null?void 0:pe.instanceId)}},600));const le=window.innerWidth/2,Z=window.innerHeight-200*p/2,he=window.innerWidth/2,_e=window.innerHeight/2,Ke=()=>{Y.type==="SPELL"||Bn(),ps({type:"PLAY_CARD",playerId:O,payload:{cardIndex:B,targetId:N,instanceId:Y.instanceId}}),Y.id==="c_amandava"&&et.current.players[C].board.forEach((pe,K)=>{if(pe){const ae=pe.instanceId;setTimeout(()=>{Wt("SHOT",C,K,ae)},200)}}),zn(null),setTimeout(()=>{pn.current=!1},100)};let Se,Ge;if(Y.type==="FOLLOWER"){const He=et.current.players[O].board.filter(se=>se!==null),pe=He.length+1,K=He.length,ae=fi*p,re=(K-(pe-1)/2)*ae,ie=(q=Xi.current)==null?void 0:q.getBoundingClientRect();Se=(ie?ie.left+ie.width/2:window.innerWidth/2)+re,Ge=window.innerHeight/2+70*p}const Je=Y.type==="FOLLOWER"?et.current.players[O].board.filter(ze=>ze!==null).length:void 0;n!=="CPU"&&_&&v&&v.send({type:"PLAY_CARD_ANIM",payload:{playerId:O,cardIndex:B,card:Y,targetBoardIndex:Je}}),zn({card:Y,sourceIndex:it.sourceIndex??-1,startX:le,startY:Z,targetX:he,targetY:_e,finalX:Se,finalY:Ge,playerClass:(oe==null?void 0:oe.class)||"SENKA",onComplete:Ke}),setTimeout(()=>{zn(ze=>(ze==null?void 0:ze.card.id)===Y.id?(Ke(),null):ze)},2e3)}else if(it.type==="EVOLVE"){const F=it.sourceVisualIndex??it.sourceIndex;bc(F,!!it.useSep,N,it.sourceInstanceId)}ci(null)},wm=()=>{if(!$e||$e.owner!=="PLAYER")return;if(pn.current){console.warn("[handleUseButtonClick] Card play in progress, ignoring");return}const m=oe.hand.findIndex(P=>P.id===$e.card.id);if(m===-1)return;const x=window.innerWidth/2,b=window.innerHeight-200*p/2;Cf(m,x,b),Wr(null)},[eo,Rf]=j.useState(!1),[Sc,Af]=j.useState(!1),[Yt,Pf]=j.useState(null),SI=j.useRef(0);j.useEffect(()=>{if(!(Yt!=null&&Yt.active))return;const m=Date.now(),x=800,b=()=>{const P=Date.now()-m;if(P>=x){Pf(null);return}const N=P/x;Pf(G=>G?{...G,ringRadius:20+N*100,particles:G.particles.map(q=>({...q,x:q.x+q.vx,y:q.y+q.vy,opacity:1-N}))}:null),requestAnimationFrame(b)};requestAnimationFrame(b)},[Yt==null?void 0:Yt.active]);const Cm=(m,x)=>{const b=[];for(let P=0;P<20;P++){const N=Math.random()*Math.PI*2,G=2+Math.random()*3;b.push({id:SI.current++,x:m,y:x,vx:Math.cos(N)*G,vy:Math.sin(N)*G,opacity:1,createdAt:Date.now()})}Pf({active:!0,x:m,y:x,ringRadius:20,particles:b})},Of=async()=>{if(g.winnerId){console.log("[handleEndTurn] Game is over, ignoring");return}if(g.activePlayerId!==O){console.log("[handleEndTurn] Not my turn, ignoring");return}if(qi.current){console.log("[handleEndTurn] Already ending turn, ignoring");return}qi.current=!0,Rf(!0);const m=et.current.turnCount,x=et.current.activePlayerId;if(!await(async()=>{const N=()=>{const Y=et.current,le=Y.pendingEffects&&Y.pendingEffects.length>0,Z=If.current.length>0,he=Tf.current.length>0,_e=va.current!==null,Ke=Zi.current!==null,Se=zr.current,Ge=pn.current;return!le&&!Z&&!he&&!_e&&!Ke&&!Se&&!Ge};let F=0,B=0;for(;F<3e3;){if(et.current.turnCount!==m||et.current.activePlayerId!==x)return console.log("[handleEndTurn] Turn changed during wait, aborting local END_TURN"),!1;if(N()){if(B++,B>=2)break}else B=0;await new Promise(Y=>setTimeout(Y,50)),F+=50}return F>=3e3&&console.warn("[handleEndTurn] Timeout waiting for processing to complete - forcing end turn"),!0})()||et.current.turnCount!==m||et.current.activePlayerId!==x||et.current.activePlayerId!==O){console.log("[handleEndTurn] Turn state changed, aborting END_TURN dispatch"),qi.current=!1,Rf(!1);return}console.log("[handleEndTurn] Dispatching END_TURN"),ps({type:"END_TURN",playerId:O}),qi.current=!1,Rf(!1)},II=L.useCallback(()=>{_t("sisiodosi.mp3",.6);const m=om.current;if(m){const x=m.getBoundingClientRect();Cm(x.left+x.width/2,x.top+x.height/2)}Of()},[_t,Of]),km=2-((oe==null?void 0:oe.evolutionsUsed)||0),Lf=O===g.firstPlayerId,Rm=(m,x)=>x?Math.ceil(g.turnCount/2):Math.floor(g.turnCount/2),Am=Rm(O,Lf),TI=Lf?3:2,wI=Lf?4:3,Ic=Am>=TI,Tc=Am>=wI,ms=(oe==null?void 0:oe.canEvolveThisTurn)&&km>0&&g.activePlayerId===O&&Ic,ys=(oe==null?void 0:oe.canEvolveThisTurn)&&oe.sep>0&&g.activePlayerId===O&&Tc,Df=C===g.firstPlayerId,Pm=Rm(C,Df),CI=Df?3:2,kI=Df?4:3,Mf=Pm>=CI,Nf=Pm>=kI,jf=(($m=oe==null?void 0:oe.board)==null?void 0:$m.some(m=>{var x;return(x=m==null?void 0:m.passiveAbilities)==null?void 0:x.includes("LEADER_DAMAGE_CAP")}))??!1,$f=((Fm=Oe==null?void 0:Oe.board)==null?void 0:Fm.some(m=>{var x;return(x=m==null?void 0:m.passiveAbilities)==null?void 0:x.includes("LEADER_DAMAGE_CAP")}))??!1,RI=(oe==null?void 0:oe.leaderDamageShield)??!1,AI=(Oe==null?void 0:Oe.leaderDamageShield)??!1,Om=jf||RI,Lm=$f||AI;return L.useLayoutEffect(()=>{window.scrollTo(0,0),Xi.current&&(Xi.current.scrollTop=0);const m=()=>{window.scrollTo(0,0)};return window.addEventListener("scroll",m,{passive:!1}),()=>{window.removeEventListener("scroll",m)}},[]),n==="JOIN"&&!A||Q&&y&&!A?a.jsxs("div",{style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",gap:"1rem"},children:[a.jsx("div",{style:{width:"50px",height:"50px",border:"4px solid rgba(233, 69, 96, 0.3)",borderTop:"4px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),a.jsx("p",{children:"..."}),a.jsx("button",{onClick:s,style:{marginTop:"1rem",padding:"0.5rem 1rem",background:"transparent",border:"1px solid #888",color:"#888",cursor:"pointer",borderRadius:"4px"},children:""}),a.jsx("style",{children:`
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                `})]}):Q&&We&&A?a.jsxs("div",{style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",gap:"1rem"},children:[a.jsx("div",{style:{fontSize:"2rem",fontWeight:"bold",color:"#4ade80",textShadow:"0 0 10px rgba(74, 222, 128, 0.5)",marginBottom:"0.5rem"},children:""}),a.jsx("div",{style:{width:"50px",height:"50px",border:"4px solid rgba(74, 222, 128, 0.3)",borderTop:"4px solid #4ade80",borderRadius:"50%",animation:"spin 1s linear infinite"}}),a.jsx("p",{style:{color:"#a0aec0"},children:"..."}),a.jsx("style",{children:`
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                `})]}):a.jsxs("div",{className:"game-screen-wrapper",style:{width:"100vw",height:"100dvh",overflow:"hidden",background:"#000",position:"relative"},children:[U&&a.jsx(ML,{myPlayer:oe,opponentPlayer:Oe,isFirstPlayer:Ir,onComplete:vI,scale:p,onVsImpact:()=>_t("vs.mp3",.7),onCoinToss:()=>_t("coin.mp3",.7),onImpact:()=>_t("gan.mp3",.7),onOrbLand:()=>_t("gan.mp3",.8),onFadeInBoard:()=>Te(!0),isMobile:V}),a.jsxs("div",{className:"game-screen",style:{width:"100%",height:"100%",transform:vt>0?`translate(${Ve.x}px, ${Ve.y}px)`:"none",display:"flex",overflow:"hidden",background:"radial-gradient(circle at center, #1a202c 0%, #000 100%)",fontFamily:"'Helvetica Neue', sans-serif",userSelect:"none",color:"#fff",position:"absolute",top:0,left:0,opacity:U&&!z?0:1,transition:"opacity 0.5s ease-in"},onClick:EI,children:[a.jsx("style",{children:`
                    html, body {
                        margin: 0; padding: 0; height: 100%; background: #000;
                        overflow: hidden !important;
                        position: fixed !important;
                        width: 100% !important;
                        top: 0 !important;
                        left: 0 !important;
                    }
                    * { box-sizing: border-box; }
                    .shake-target { animation: shake 0.3s cubic-bezier(.36,.07,.19,.97) both; }
                    @keyframes shake {
                        10%, 90% { transform: translate3d(-1px, 0, 0); }
                        20%, 80% { transform: translate3d(2px, 0, 0); }
                        30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
                        40%, 60% { transform: translate3d(4px, 0, 0); }
                    }
                    @keyframes attackRotate {
                        0% { transform: rotateY(0deg); }
                        100% { transform: rotateY(360deg); }
                    }
                    .attack-rotating {
                        animation: attackRotate 0.2s linear forwards !important;
                        transform-style: preserve-3d;
                    }
                    @keyframes cardDie {
                        0% { transform: scale(1); filter: brightness(1) drop-shadow(0 0 0 white); opacity: 1; }
                        40% { transform: scale(1.15); filter: brightness(3) drop-shadow(0 0 20px white); opacity: 0.9; }
                        100% { transform: scale(0.4) rotate(8deg); filter: brightness(5) drop-shadow(0 0 40px white); opacity: 0; }
                    }
                    .card-dying { animation: cardDie 0.7s forwards; }
                    /* Necromance effect animations */
                    @keyframes necromanceFloat {
                        0% { transform: translateX(-50%) translateY(0) scale(1); opacity: 1; }
                        50% { transform: translateX(-50%) translateY(-20px) scale(1.2); opacity: 1; }
                        100% { transform: translateX(-50%) translateY(-40px) scale(0.8); opacity: 0; }
                    }
                    @keyframes necromanceFloatOpponent {
                        0% { transform: translateX(-50%) translateY(0) scale(1); opacity: 1; }
                        50% { transform: translateX(-50%) translateY(15px) scale(1.2); opacity: 1; }
                        100% { transform: translateX(-50%) translateY(30px) scale(0.8); opacity: 0; }
                    }
                    @keyframes necroPulse {
                        0%, 100% { box-shadow: 0 0 10px #d946ef, 0 0 20px #a855f7, inset 0 0 15px rgba(217, 70, 239, 0.3); }
                        50% { box-shadow: 0 0 25px #d946ef, 0 0 40px #a855f7, 0 0 60px #7c3aed, inset 0 0 25px rgba(217, 70, 239, 0.5); }
                    }
                    @keyframes leaderDamageCapPulse {
                        0%, 100% {
                            box-shadow: 0 0 20px rgba(103, 232, 249, 0.4), 0 0 40px rgba(103, 232, 249, 0.2);
                            border-color: #67e8f9;
                        }
                        50% {
                            box-shadow: 0 0 35px rgba(103, 232, 249, 0.7), 0 0 55px rgba(103, 232, 249, 0.4);
                            border-color: #a5f3fc;
                        }
                    }
                    @keyframes leaderDamageCapOverlay {
                        0%, 100% { opacity: 0.15; }
                        50% { opacity: 0.45; }
                    }
                    /* EP/SEP pulse animations for usable state - box-shadow only, no transform override */
                    @keyframes epPulse {
                        0%, 100% {
                            box-shadow: 0 0 12px #ffd700, 0 0 25px rgba(255,215,0,0.6);
                        }
                        50% {
                            box-shadow: 0 0 20px #ffd700, 0 0 40px rgba(255,215,0,0.8), 0 0 55px rgba(255,180,0,0.5);
                        }
                    }
                    @keyframes sepPulse {
                        0%, 100% {
                            box-shadow: 0 0 12px #b794f4, 0 0 25px rgba(159,122,234,0.6);
                        }
                        50% {
                            box-shadow: 0 0 20px #b794f4, 0 0 40px rgba(159,122,234,0.8), 0 0 55px rgba(180,0,255,0.5);
                        }
                    }
                `}),it&&a.jsx("div",{style:{position:"absolute",top:"15%",left:"50%",transform:"translate(-50%, -50%)",background:"rgba(0, 0, 0, 0.7)",color:"#fff",padding:"10px 20px",borderRadius:20,pointerEvents:"none",zIndex:1e3,fontWeight:"bold",border:it.allowedTargetPlayerId===O?"2px solid #48bb78":"2px solid #f56565"},children:it.allowedTargetPlayerId===O?"":""}),pI&&a.jsx(ZL,{onClose:()=>yf(!1)}),hI&&a.jsx("div",{style:{position:"absolute",inset:0,zIndex:4e3,background:"rgba(0,0,0,0.8)",backdropFilter:"blur(5px)",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>gc(!1),children:a.jsxs("div",{style:{background:"#2d3748",padding:40,borderRadius:16,display:"flex",flexDirection:"column",gap:20,minWidth:300,border:"1px solid rgba(255,255,255,0.1)"},onClick:m=>m.stopPropagation(),children:[a.jsx("h2",{style:{margin:0,textAlign:"center",borderBottom:"1px solid #4a5568",paddingBottom:10,color:"#fff"},children:""}),fI?a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:15},children:[a.jsx("h3",{style:{margin:0,color:"#cbd5e0"},children:""}),a.jsxs("label",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",color:"white"},children:["BGM",a.jsx("input",{type:"checkbox",checked:Ct.bgmEnabled,onChange:m=>ga(x=>({...x,bgmEnabled:m.target.checked})),style:{width:20,height:20}})]}),a.jsxs("label",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",color:"white"},children:["SE",a.jsx("input",{type:"checkbox",checked:Ct.seEnabled,onChange:m=>ga(x=>({...x,seEnabled:m.target.checked})),style:{width:20,height:20}})]}),a.jsxs("div",{children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",color:"#a0aec0",marginBottom:5},children:[a.jsx("span",{children:"BGM"}),a.jsxs("span",{children:[Math.round(Ct.bgm*100),"%"]})]}),a.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:Ct.bgm,onChange:m=>ga(x=>({...x,bgm:parseFloat(m.target.value)})),style:{width:"100%"}})]}),a.jsxs("div",{children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",color:"#a0aec0",marginBottom:5},children:[a.jsx("span",{children:"SE"}),a.jsxs("span",{children:[Math.round(Ct.se*100),"%"]})]}),a.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:Ct.se,onChange:m=>ga(x=>({...x,se:parseFloat(m.target.value)})),style:{width:"100%"}})]}),a.jsxs("div",{children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",color:"#a0aec0",marginBottom:5},children:[a.jsx("span",{children:""}),a.jsxs("span",{children:[Math.round(Ct.voice*100),"%"]})]}),a.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:Ct.voice,onChange:m=>ga(x=>({...x,voice:parseFloat(m.target.value)})),style:{width:"100%"}})]}),a.jsx("button",{onClick:()=>gm(!1),style:{padding:10,background:"#4a5568",border:"none",color:"white",borderRadius:8,cursor:"pointer",marginTop:10},children:""})]}):a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:()=>gc(!1),style:{padding:15,background:"#4a5568",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.2rem"},children:""}),a.jsx("button",{onClick:()=>gm(!0),style:{padding:15,background:"#2b6cb0",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.2rem"},children:""}),a.jsx("button",{onClick:()=>mc(!0),style:{padding:15,background:"#e53e3e",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.2rem"},children:""})]})]})}),gI&&a.jsx("div",{style:{position:"absolute",inset:0,zIndex:4100,background:"rgba(0,0,0,0.85)",backdropFilter:"blur(5px)",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>mc(!1),children:a.jsxs("div",{style:{background:"#2d3748",padding:40,borderRadius:16,display:"flex",flexDirection:"column",gap:20,minWidth:320,border:"2px solid #e53e3e",boxShadow:"0 0 30px rgba(229, 62, 62, 0.3)"},onClick:m=>m.stopPropagation(),children:[a.jsx("h2",{style:{margin:0,textAlign:"center",color:"#fff",fontSize:"1.5rem"},children:""}),a.jsx("p",{style:{margin:0,textAlign:"center",color:"#a0aec0",fontSize:"1rem"},children:""}),a.jsxs("div",{style:{display:"flex",gap:15,marginTop:10},children:[a.jsx("button",{onClick:()=>mc(!1),style:{flex:1,padding:15,background:"#4a5568",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.1rem"},children:""}),a.jsx("button",{onClick:mI,style:{flex:1,padding:15,background:"#e53e3e",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.1rem"},children:""})]})]})}),a.jsxs("div",{className:mm?"shake-target":"",style:{width:(V?280:340)*p,borderRight:"1px solid rgba(255,255,255,0.1)",background:"rgba(0,0,0,0.3)",padding:V?`${10*p}px ${12*p}px`:`${20*p}px ${20*p}px ${20*p}px`,display:"flex",flexDirection:"column",zIndex:20,flexShrink:0},onClick:m=>m.stopPropagation(),children:[a.jsx("div",{style:{marginBottom:(V?6:12)*p},children:a.jsxs("button",{onClick:()=>gc(!0),style:{background:"transparent",border:"none",cursor:"pointer",padding:V?3:5},children:[a.jsx("div",{style:{width:(V?22:30)*p,height:(V?2:3)*p,background:"#cbd5e0",marginBottom:(V?4:6)*p}}),a.jsx("div",{style:{width:(V?22:30)*p,height:(V?2:3)*p,background:"#cbd5e0",marginBottom:(V?4:6)*p}}),a.jsx("div",{style:{width:(V?22:30)*p,height:(V?2:3)*p,background:"#cbd5e0"}})]})}),a.jsx("h3",{style:{color:"#a0aec0",borderBottom:"1px solid #4a5568",paddingBottom:(V?4:8)*p,marginTop:0,marginBottom:0,flexShrink:0,fontSize:V?`${.85*p}rem`:void 0},children:""}),$e?a.jsx("div",{style:{marginTop:(V?4:10)*p,display:"flex",flexDirection:"column",flex:1,overflow:"hidden",minHeight:0},children:a.jsxs("div",{style:{flex:1,overflow:"auto",minHeight:0,display:"flex",flexDirection:"column"},children:[a.jsxs("div",{style:{flexShrink:0},children:[a.jsx("div",{style:{width:"100%",aspectRatio:"1/1",marginBottom:(V?6:12)*p,display:"flex",alignItems:"center",justifyContent:"center",...V?{maxHeight:"28vh"}:{}},children:a.jsx(ro,{card:$e.card,style:{width:"100%",height:"100%",...V?{maxHeight:"28vh"}:{}},variant:"art-only"})}),a.jsx("div",{style:{fontSize:V?`${($e.card.name.length>12?.9:$e.card.name.length>8?1:1.1)*p}rem`:`${$e.card.name.length>12?1.1:$e.card.name.length>8?1.2:1.4}rem`,fontWeight:"bold",marginBottom:(V?4:6)*p,textAlign:"center"},children:$e.card.name}),a.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:(V?10:15)*p,marginBottom:(V?6:10)*p},children:[a.jsx("div",{style:{width:24*p,height:24*p,borderRadius:"50%",background:"radial-gradient(circle at 30% 30%, #68d391, #276749)",border:"1px solid #fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${.85*p}rem`,fontWeight:900,color:"white",textShadow:"0 1px 2px rgba(0,0,0,0.5)",boxShadow:"0 2px 4px rgba(0,0,0,0.3)"},children:$e.card.cost}),$e.card.type==="FOLLOWER"&&a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:3*p},children:[a.jsx("svg",{width:18*p,height:18*p,viewBox:"0 0 24 24",fill:"none",children:a.jsx("polygon",{points:"12,2 22,22 2,22",fill:"#63b3ed",stroke:"none"})}),a.jsx("span",{style:{fontSize:`${.95*p}rem`,fontWeight:"bold",color:"#4299e1"},children:"currentAttack"in $e.card?$e.card.currentAttack:$e.card.attack})]}),$e.card.type==="FOLLOWER"&&a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:3*p},children:[a.jsx("svg",{width:18*p,height:18*p,viewBox:"0 0 24 24",fill:"#f56565",children:a.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})}),a.jsx("span",{style:{fontSize:`${.95*p}rem`,fontWeight:"bold",color:"#f56565"},children:"currentHealth"in $e.card?$e.card.currentHealth:$e.card.health})]})]}),a.jsx("div",{style:{fontSize:`${((((Um=$e.card.description)==null?void 0:Um.length)||0)>150?.7:(((Bm=$e.card.description)==null?void 0:Bm.length)||0)>100?.8:.9)*p}rem`,color:"#cbd5e0",lineHeight:"1.4",whiteSpace:"pre-wrap",borderTop:"1px solid #4a5568",paddingTop:4*p},children:uI($e.card.description)})]}),$e.card.flavorText&&a.jsx("div",{style:{marginTop:"auto",paddingTop:8*p,paddingBottom:4*p,flexShrink:0},children:a.jsx("div",{style:{fontSize:`${((((zm=$e.card.flavorText)==null?void 0:zm.length)||0)>100?.6:.7)*p}rem`,color:"rgba(160, 174, 192, 0.6)",lineHeight:"1.3",fontStyle:"italic",whiteSpace:"pre-wrap",textAlign:"right"},children:$e.card.flavorText})})]})}):a.jsx("div",{style:{marginTop:10*p,color:"#718096",fontStyle:"italic",flex:1,fontSize:`${.7*p}rem`},children:""})]}),a.jsxs("div",{ref:Xi,className:mm?"shake-target":"",style:{flex:1,height:"100%",position:"relative",background:"rgba(0,0,0,0.1)",overflow:"hidden"},children:[a.jsxs("div",{ref:Qi,onMouseEnter:()=>Qn({type:"LEADER",playerId:C}),onMouseLeave:()=>Qn(null),onClick:m=>{m.stopPropagation(),it&&kf("LEADER",-1,C)},style:{position:"absolute",top:-20*p,left:"50%",transform:"translateX(-50%)",width:so*p,height:so*p,borderRadius:"50%",zIndex:100,cursor:"default"},children:[a.jsx("div",{style:{position:"absolute",inset:0,borderRadius:"50%",background:Oe.class==="AJA"?`url(${sl(Oe.class)}) center top/cover`:`url(${sl(Oe.class)}) center/cover`,border:$f?"4px solid #67e8f9":(ut==null?void 0:ut.type)==="LEADER"&&ut.playerId===C&&!it?"4px solid #f56565":"4px solid #4a5568",boxShadow:$f?"0 0 20px rgba(103, 232, 249, 0.4), 0 0 40px rgba(103, 232, 249, 0.2)":"0 0 20px rgba(0,0,0,0.5)",transition:"border-color 0.3s, box-shadow 0.3s, filter 0.5s, opacity 0.5s",animation:Lm?"leaderDamageCapPulse 2s ease-in-out infinite":"none",...g.winnerId===O&&(Ne||tt)?{filter:Ne==="white-fade"?"brightness(2) saturate(0.3)":Ne==="explode"||Ne==="result-text"||Ne==="fade-out"||tt?"brightness(3) saturate(0) blur(10px)":"none",opacity:Ne==="explode"||Ne==="result-text"||Ne==="fade-out"||tt?0:1}:{}},children:Lm&&a.jsx("div",{style:{position:"absolute",inset:0,borderRadius:"50%",background:"radial-gradient(circle, rgba(103, 232, 249, 0.5) 0%, rgba(103, 232, 249, 0.2) 70%, rgba(103, 232, 249, 0.1) 100%)",pointerEvents:"none",animation:"leaderDamageCapOverlay 2s ease-in-out infinite",zIndex:1}})}),a.jsx("div",{style:{position:"absolute",bottom:0,left:"50%",transform:`translateX(-50%) translateX(${-140*p}px)`,width:55*p,height:55*p,background:"radial-gradient(circle at 30% 30%, #feb2b2, #c53030)",borderRadius:"50%",border:`${Math.max(2,3*p)}px solid #fff`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${1.2*p}rem`,fontWeight:900,color:"white",textShadow:"0 2px 2px rgba(0,0,0,0.5)",zIndex:10,boxShadow:"0 4px 6px rgba(0,0,0,0.4)",opacity:te?1:0,transition:"opacity 0.3s ease-in"},children:Oe.hp}),a.jsx("div",{style:{position:"absolute",bottom:10*p,left:"50%",transform:`translateX(-50%) translateX(${-80*p}px)`,width:45*p,height:45*p,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,opacity:te?Mf?1:.5:0,filter:Mf?"none":"grayscale(0.8)",transition:"opacity 0.3s ease-in"},children:a.jsx("div",{style:{display:"flex",gap:3*p},children:Array(2).fill(0).map((m,x)=>{const b=x<2-Oe.evolutionsUsed;return a.jsx("div",{style:{width:12*p,height:12*p,borderRadius:"50%",background:b?"#ecc94b":"#2d3748",boxShadow:b&&Mf?"0 0 8px #ecc94b, 0 0 15px #ecc94b":"none",border:"2px solid rgba(0,0,0,0.5)"}},x)})})}),a.jsx("div",{style:{position:"absolute",bottom:10*p,left:"50%",transform:`translateX(-50%) translateX(${80*p}px)`,width:45*p,height:45*p,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,opacity:te?Nf?1:.5:0,filter:Nf?"none":"grayscale(0.8)",transition:"opacity 0.3s ease-in"},children:a.jsx("div",{style:{display:"flex",gap:3*p},children:Array(2).fill(0).map((m,x)=>{const b=x<Oe.sep;return a.jsx("div",{style:{width:12*p,height:12*p,borderRadius:"50%",background:b?"#9f7aea":"#2d3748",boxShadow:b&&Nf?"0 0 8px #9f7aea, 0 0 15px #9f7aea":"none",border:"2px solid rgba(0,0,0,0.5)"}},x)})})}),a.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:so*p*.75,height:so*p*.75,pointerEvents:"none",zIndex:20,opacity:(ut==null?void 0:ut.type)==="LEADER"&&ut.playerId===C&&J?1:0,transition:"opacity 0.1s ease-out"},children:[a.jsxs("svg",{width:"100%",height:"100%",viewBox:"0 0 100 100",children:[a.jsx("defs",{children:a.jsxs("filter",{id:"leaderCyanMarkerGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"4",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsxs("g",{style:{transformOrigin:"50% 50%",animation:"leaderMarkerSpin 2s linear infinite"},children:[a.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"rgba(100, 200, 255, 0.9)",strokeWidth:"3",strokeDasharray:"15 8",filter:"url(#leaderCyanMarkerGlow)"}),a.jsx("polygon",{points:"50,5 44,18 56,18",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"}),a.jsx("polygon",{points:"95,50 82,44 82,56",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"}),a.jsx("polygon",{points:"50,95 56,82 44,82",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"}),a.jsx("polygon",{points:"5,50 18,56 18,44",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"})]})]}),a.jsx("style",{children:`
                                @keyframes leaderMarkerSpin {
                                    0% { transform: rotate(0deg); }
                                    100% { transform: rotate(360deg); }
                                }
                            `})]})]}),a.jsxs("div",{style:{position:"absolute",top:20*p,left:20*p,width:60*p,height:85*p,zIndex:50},children:[[...Array(Math.min(5,Math.ceil(Oe.deck.length/5)))].map((m,x)=>a.jsx("div",{style:{position:"absolute",inset:0,transform:`translate(${x*2*p}px, ${-x*2*p}px)`,borderRadius:6,border:"1px solid #718096",overflow:"hidden"},children:a.jsx("img",{src:ui((Oe==null?void 0:Oe.class)||"SENKA"),alt:"Deck",style:{width:"100%",height:"100%",objectFit:"cover"},onError:b=>{b.target.style.display="none",b.target.parentElement.style.background="linear-gradient(45deg, #2d3748, #1a202c)"}})},x)),a.jsx("div",{style:{position:"absolute",bottom:-20*p,width:"100%",textAlign:"center",fontWeight:"bold",color:"#a0aec0",fontSize:"0.9rem"},children:Oe.deck.length})]}),a.jsxs("div",{style:{position:"absolute",top:20*p,right:20*p,display:"flex",alignItems:"center",gap:8,zIndex:50,pointerEvents:"none"},children:[a.jsxs("div",{style:{position:"relative",width:24,height:30},children:[a.jsx("div",{style:{position:"absolute",inset:0,background:"#4a192c",borderRadius:2,border:"1px solid #742a3a",transform:"rotate(-15deg) translate(-3px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#3d1525",borderRadius:2,border:"1px solid #742a3a",transform:"rotate(-5deg) translate(-1px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#2d1a20",borderRadius:2,border:"1px solid #8b3a4a",transform:"rotate(5deg)"}})]}),a.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(74, 25, 44, 0.8), rgba(45, 26, 32, 0.9))",padding:"3px 8px",borderRadius:5,color:"#f0b8c4",fontSize:"0.64rem",fontWeight:"bold",border:"1px solid rgba(116, 42, 58, 0.5)",boxShadow:"0 2px 4px rgba(0,0,0,0.4)"},children:[" ",Oe.hand.length]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5,marginLeft:6},children:[a.jsx("div",{style:{fontSize:"0.9rem",filter:"drop-shadow(0 0 2px rgba(128, 90, 213, 0.6)) grayscale(30%)"},children:""}),a.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(128, 90, 213, 0.7), rgba(76, 29, 149, 0.8))",padding:"3px 8px",borderRadius:5,color:"#c4b5fd",fontSize:"0.64rem",fontWeight:"bold",border:"1px solid rgba(167, 139, 250, 0.4)",boxShadow:"0 2px 4px rgba(0,0,0,0.4)",position:"relative"},children:[" ",Oe.graveyard.length,af.filter(m=>m.playerId===C).map(m=>a.jsxs("div",{style:{position:"absolute",bottom:-25,left:"50%",transform:"translateX(-50%)",color:"#d946ef",fontSize:"1.2rem",fontWeight:"bold",textShadow:"0 0 8px #d946ef, 0 0 15px #a855f7, 0 0 25px #7c3aed",animation:"necromanceFloatOpponent 1.5s ease-out forwards",pointerEvents:"none",whiteSpace:"nowrap"},children:["-",m.amount]},m.key))]})]})]}),a.jsx("div",{style:{position:"absolute",top:`calc(50% - ${Sn*p/2}px - ${70*p}px)`,left:"0",width:"100%",height:Sn*p,pointerEvents:"none",zIndex:10},children:a.jsx("div",{style:{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center"},children:hn.map((m,x)=>{const b=hn.length,P=(x-(b-1)/2)*fi*p;return a.jsxs("div",{ref:N=>lr.current[x]=N,onMouseEnter:()=>{J&&Qn({type:"FOLLOWER",index:x,playerId:C,instanceId:m==null?void 0:m.instanceId})},onMouseLeave:()=>{J&&Qn(null)},onClick:N=>{if(N.stopPropagation(),it){if(!m)return;kf("FOLLOWER",x,C,m==null?void 0:m.instanceId)}else m&&Wr({card:m,owner:"OPPONENT",source:"BOARD"})},style:{position:"absolute",left:"50%",top:0,transform:`translateX(calc(-50% + ${P}px))`,transition:"transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1), left 0.4s ease",border:it&&m&&it.allowedTargetPlayerId===C?"2px solid #f56565":"none",boxShadow:it&&m&&it.allowedTargetPlayerId===C?"0 0 15px #f56565":"none",borderRadius:8,cursor:it?"crosshair":"default",width:cn*p,height:Sn*p,pointerEvents:"auto",opacity:Lt&&Lt.sourcePlayerId===C&&Lt.followerIndex===x?0:m!=null&&m.isDying?.8:1,transitionProperty:Lt&&Lt.sourcePlayerId===C&&Lt.followerIndex===x?"none":"transform, left, opacity"},children:[a.jsx("div",{style:{width:"100%",height:"100%",perspective:"800px"},children:a.jsxs("div",{className:cm===(m==null?void 0:m.instanceId)||dm===(m==null?void 0:m.instanceId)?"attack-rotating":"",style:{width:"100%",height:"100%",position:"relative",transformStyle:"preserve-3d"},children:[a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},children:m?a.jsx(ro,{card:m,turnCount:g.turnCount,className:m.isDying?"card-dying":"",scale:p,style:{width:cn*p,height:Sn*p,opacity:1,filter:m.isDying?"grayscale(0.5) brightness(2)":"none",boxShadow:(ut==null?void 0:ut.type)==="FOLLOWER"&&ut.index===x&&(J==null?void 0:J.sourceType)==="BOARD"?"0 0 20px #f56565":(J==null?void 0:J.sourceType)==="BOARD"?"0 0 20px #f6e05e":void 0},isOnBoard:!0,isSpecialSummoning:lm.has(m.instanceId)}):a.jsx("div",{style:{width:cn*p,height:Sn*p,border:"1px dashed rgba(255,255,255,0.1)",borderRadius:8}})}),m&&a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",transform:"rotateY(180deg)",borderRadius:12,overflow:"hidden"},children:a.jsx("img",{src:ui((Oe==null?void 0:Oe.class)||"SENKA"),alt:"Card Sleeve",style:{width:"100%",height:"100%",objectFit:"cover"}})})]})}),m&&(J==null?void 0:J.sourceType)==="BOARD"&&a.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",width:"100%",height:"100%",transform:"translate(-50%, -50%)",pointerEvents:"none",zIndex:20,opacity:(ut==null?void 0:ut.type)==="FOLLOWER"&&ut.index===x&&ut.playerId===C?1:0,transition:"opacity 0.1s ease-out"},children:[a.jsxs("svg",{viewBox:"0 0 100 100",style:{width:"100%",height:"100%",filter:"drop-shadow(0 0 12px rgba(100, 200, 255, 0.9))"},children:[a.jsx("defs",{children:a.jsxs("filter",{id:"cyanMarkerGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"4",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsxs("g",{style:{transformOrigin:"50px 50px",animation:"attackMarkerSpin 1.5s linear infinite reverse"},children:[a.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:"rgba(100, 200, 255, 0.95)",strokeWidth:"4",strokeDasharray:"12 6",filter:"url(#cyanMarkerGlow)"}),a.jsx("polygon",{points:"50,10 45,20 55,20",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"}),a.jsx("polygon",{points:"90,50 80,45 80,55",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"}),a.jsx("polygon",{points:"50,90 55,80 45,80",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"}),a.jsx("polygon",{points:"10,50 20,55 20,45",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"})]})]}),a.jsx("style",{children:`
                                                    @keyframes attackMarkerSpin {
                                                        0% { transform: rotate(0deg); }
                                                        100% { transform: rotate(360deg); }
                                                    }
                                                `})]})]},(m==null?void 0:m.instanceId)||`empty-opp-${x}`)})})}),a.jsx("div",{style:{position:"absolute",bottom:`calc(50% - ${Sn*p/2}px - ${70*p}px)`,left:"0",width:"100%",height:Sn*p,pointerEvents:"none",zIndex:10},children:a.jsx("div",{style:{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center"},children:bn.map((m,x)=>{const b=bn.length,P=(x-(b-1)/2)*fi*p;return a.jsxs("div",{ref:N=>kr.current[x]=N,onMouseDown:N=>Em(N,x,m==null?void 0:m.instanceId),onTouchStart:N=>Em(N,x,m==null?void 0:m.instanceId),onClick:N=>N.stopPropagation(),onMouseEnter:()=>{J&&Qn({type:"FOLLOWER",index:x,playerId:O,instanceId:m==null?void 0:m.instanceId})},onMouseLeave:()=>{J&&Qn(null)},style:{position:"absolute",left:"50%",top:0,"--offsetX":`calc(-50% + ${P}px)`,transform:`translateX(calc(-50% + ${P}px)) ${(J==null?void 0:J.sourceType)==="BOARD"&&J.sourceInstanceId===(m==null?void 0:m.instanceId)?"translateY(-20px) scale(1.1)":""}`,transition:"transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1), left 0.4s ease",cursor:"pointer",pointerEvents:"auto",width:cn*p,height:Sn*p,border:it&&m&&it.allowedTargetPlayerId===O?"2px solid #48bb78":"none",boxShadow:it&&m&&it.allowedTargetPlayerId===O?"0 0 15px #48bb78":"none",borderRadius:8,zIndex:(J==null?void 0:J.sourceType)==="BOARD"&&J.sourceInstanceId===(m==null?void 0:m.instanceId)?10:1,opacity:Lt&&Lt.sourcePlayerId===O&&Lt.followerIndex===x?0:m!=null&&m.isDying?.8:1,transitionProperty:Lt&&Lt.sourcePlayerId===O&&Lt.followerIndex===x?"none":"transform, left, opacity"},children:[a.jsx("div",{style:{width:"100%",height:"100%",perspective:"800px"},children:a.jsxs("div",{className:cm===(m==null?void 0:m.instanceId)||dm===(m==null?void 0:m.instanceId)?"attack-rotating":"",style:{width:"100%",height:"100%",position:"relative",transformStyle:"preserve-3d"},children:[a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},children:m?a.jsx(ro,{card:m,turnCount:g.turnCount,className:m.isDying?"card-dying":"",scale:p,style:{width:cn*p,height:Sn*p,opacity:1,filter:m.isDying?"grayscale(0.5) brightness(2)":"none",boxShadow:(J==null?void 0:J.sourceType)==="BOARD"&&J.sourceInstanceId===(m==null?void 0:m.instanceId)&&(ut==null?void 0:ut.type)==="FOLLOWER"?"0 0 30px #f56565":(J==null?void 0:J.sourceType)==="BOARD"&&J.sourceInstanceId===(m==null?void 0:m.instanceId)?"0 20px 30px rgba(0,0,0,0.6)":void 0,pointerEvents:(J==null?void 0:J.sourceType)==="BOARD"&&J.sourceInstanceId===(m==null?void 0:m.instanceId)?"none":"auto"},isSelected:($e==null?void 0:$e.card)===m,isOnBoard:!0,isSpecialSummoning:lm.has(m.instanceId),isMyTurn:g.activePlayerId===O}):a.jsx("div",{style:{width:cn*p,height:Sn*p,border:"1px dashed rgba(255,255,255,0.2)",borderRadius:8}})}),m&&a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",transform:"rotateY(180deg)",borderRadius:12,overflow:"hidden"},children:a.jsx("img",{src:ui((oe==null?void 0:oe.class)||"SENKA"),alt:"Card Sleeve",style:{width:"100%",height:"100%",objectFit:"cover"}})})]})}),m&&(J==null?void 0:J.sourceType)==="EVOLVE"&&!m.hasEvolved&&a.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",width:"120%",height:"120%",transform:"translate(-50%, -50%)",pointerEvents:"none",border:J.useSep?"2px dashed rgba(183, 148, 244, 0.9)":"2px dashed rgba(255, 230, 100, 0.9)",borderRadius:"50%",boxShadow:J.useSep?"0 0 15px rgba(159, 122, 234, 0.8)":"0 0 15px rgba(255, 200, 50, 0.8)",animation:"evolveMarkerSpin 1.5s linear infinite",zIndex:20,opacity:(ut==null?void 0:ut.type)==="FOLLOWER"&&ut.index===x&&ut.playerId===O?1:0,transition:"opacity 0.1s ease-out"},children:[a.jsxs("svg",{viewBox:"0 0 100 100",style:{width:"100%",height:"100%",filter:"drop-shadow(0 0 8px currentColor)"},children:[a.jsx("defs",{children:a.jsxs("filter",{id:J.useSep?"purpleMarkerGlow":"yellowMarkerGlow",x:"-30%",y:"-30%",width:"160%",height:"160%",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"3",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:J.useSep?"#b794f4":"#f6e05e",strokeWidth:"4",strokeDasharray:"15 8",filter:`url(#${J.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`,opacity:"0.95"}),a.jsx("polygon",{points:"50,5 45,15 55,15",fill:J.useSep?"#b794f4":"#f6e05e",filter:`url(#${J.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`}),a.jsx("polygon",{points:"95,50 85,45 85,55",fill:J.useSep?"#b794f4":"#f6e05e",filter:`url(#${J.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`}),a.jsx("polygon",{points:"50,95 55,85 45,85",fill:J.useSep?"#b794f4":"#f6e05e",filter:`url(#${J.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`}),a.jsx("polygon",{points:"5,50 15,55 15,45",fill:J.useSep?"#b794f4":"#f6e05e",filter:`url(#${J.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`})]}),a.jsx("style",{children:`
                                                @keyframes evolveMarkerSpin {
                                                    0% { transform: translate(-50%, -50%) rotate(0deg); }
                                                    100% { transform: translate(-50%, -50%) rotate(360deg); }
                                                }
                                            `})]})]},(m==null?void 0:m.instanceId)||`empty-plr-${x}`)})})}),a.jsxs("div",{style:{position:"absolute",right:30*p,top:"50%",transform:"translateY(-50%)",display:"flex",flexDirection:"column",alignItems:"center",gap:30*p,zIndex:50},children:[a.jsx("div",{style:{textAlign:"center"},children:a.jsxs("div",{style:{fontSize:`${1.2*p}rem`,fontWeight:700,color:"#a0aec0",fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif'},children:["Turn ",g.turnCount]})}),a.jsxs("div",{style:{textAlign:"center"},children:[a.jsxs("div",{style:{fontSize:`${1.8*p}rem`,fontWeight:900,color:"#f6e05e",fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif'},children:[Oe.pp,"/",Oe.maxPp]}),a.jsx("div",{style:{display:"flex",gap:4*p,justifyContent:"center"},children:Array(Math.min(10,Oe.maxPp)).fill(0).map((m,x)=>a.jsx("div",{style:{width:10*p,height:10*p,borderRadius:"50%",background:x<Oe.pp?"#f6e05e":"#2d3748"}},x))})]}),a.jsxs("div",{style:{position:"relative",width:160*p,height:160*p},children:[a.jsx(jL,{isMyTurn:g.activePlayerId===O,turnCount:g.turnCount,activePlayerId:g.activePlayerId,onTimeUp:II,timerEnabled:h,isGameOver:!!g.winnerId,isPaused:U,scale:p,buttonSize:160,timerDuration:60}),a.jsxs("button",{ref:om,disabled:g.activePlayerId!==O||eo,onMouseDown:m=>{m.stopPropagation(),g.activePlayerId===O&&!eo&&Af(!0)},onMouseUp:m=>{var x;if(m.stopPropagation(),Sc&&g.activePlayerId===O&&!eo){Af(!1),_t("sisiodosi.mp3",.6);const b=(x=m.target.closest("button"))==null?void 0:x.getBoundingClientRect();b&&Cm(b.left+b.width/2,b.top+b.height/2),Of()}},onMouseLeave:()=>{Af(!1)},style:{width:160*p,height:160*p,borderRadius:"50%",border:"4px solid rgba(255,255,255,0.2)",background:eo?"linear-gradient(135deg, #805ad5, #6b46c1)":Sc?"linear-gradient(135deg, #5a9bd5, #4a7fb0)":g.activePlayerId===O?"linear-gradient(135deg, #3182ce, #2b6cb0)":"#2d3748",color:"white",fontWeight:900,fontSize:`${2*p}rem`,fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif',boxShadow:g.activePlayerId===O?Sc?"0 0 20px rgba(66, 153, 225, 0.5)":"0 0 40px rgba(66, 153, 225, 0.8)":"none",opacity:Sc?.8:1,cursor:g.activePlayerId===O&&!eo?"pointer":"default",transition:"all 0.1s",position:"relative",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",lineHeight:1.2},children:[a.jsx("img",{src:Ze("/assets/tenfubu_mark.png"),alt:"",style:{position:"absolute",width:"80%",height:"80%",objectFit:"contain",opacity:.25,pointerEvents:"none"}}),eo?a.jsx("span",{style:{position:"relative",zIndex:1,whiteSpace:"nowrap"},children:"..."}):a.jsxs(a.Fragment,{children:[a.jsx("span",{style:{position:"relative",zIndex:1,whiteSpace:"nowrap"},children:""}),a.jsx("span",{style:{position:"relative",zIndex:1,whiteSpace:"nowrap"},children:""})]})]})]}),a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("div",{style:{fontSize:`${2.4*p}rem`,fontWeight:900,color:"#f6e05e",fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif'},children:oe.extraPpActive?a.jsxs("span",{children:[Math.max(0,oe.pp-1),"/",oe.maxPp," ",a.jsx("span",{style:{color:"#ed8936"},children:"+1"})]}):a.jsxs("span",{children:[oe.pp,"/",oe.maxPp]})}),a.jsx("div",{style:{display:"flex",gap:3*p,justifyContent:"center"},children:Array(10).fill(0).map((m,x)=>{const b=x<oe.pp,P=x<oe.maxPp;let N;return b?N="#f6e05e":P?N="#744210":N="#2d3748",a.jsx("div",{style:{width:11*p,height:11*p,borderRadius:"50%",background:N}},x)})})]}),(()=>{const m=O!==g.firstPlayerId,x=g.activePlayerId===O,b=g.turnCount,P=b<=5&&!oe.extraPpUsedEarly,N=b>=6&&!oe.extraPpUsedLate,G=m&&x&&!oe.extraPpActive&&(P||N),q=oe.extraPpActive;if(!m)return null;const F=b<=5&&oe.extraPpUsedEarly||b>=6&&oe.extraPpUsedLate,B=!G&&!q;return a.jsxs("button",{disabled:B,onClick:Y=>{Y.stopPropagation(),B||ps({type:"TOGGLE_EXTRA_PP",playerId:O})},style:{width:160*p,height:45*p,borderRadius:12*p,border:q?"3px solid #ed8936":"3px solid rgba(255,255,255,0.2)",background:q?"linear-gradient(135deg, #ed8936, #dd6b20)":G?"linear-gradient(135deg, #744210, #5a3510)":"#2d3748",color:q?"white":G?"#f6e05e":"#718096",fontWeight:700,fontSize:"1rem",boxShadow:q?"0 0 20px rgba(237, 137, 54, 0.6)":"none",cursor:B?"default":"pointer",transition:"all 0.3s",display:"flex",alignItems:"center",justifyContent:"center",gap:6*p,opacity:F&&!q?.5:1},children:[a.jsx("span",{children:"PP"}),a.jsx("span",{style:{fontSize:"1.3rem"},children:"+1"}),q&&a.jsx("span",{style:{fontSize:"0.8rem"},children:"ON"}),F&&!q&&a.jsx("span",{style:{fontSize:"0.7rem",marginLeft:2},children:""})]})})()]}),V?a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:m=>{m.stopPropagation(),yf(!0)},style:{position:"absolute",left:15*p,top:120*p,width:64*p,height:64*p,minWidth:64*p,maxWidth:64*p,minHeight:64*p,maxHeight:64*p,borderRadius:"50%",background:"linear-gradient(135deg, #4a5568 0%, #2d3748 100%)",border:"3px solid #63b3ed",color:"#63b3ed",fontSize:`${1.8*p}rem`,fontWeight:"bold",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,padding:0,zIndex:16,boxShadow:"0 2px 8px rgba(0,0,0,0.4)",transition:"all 0.2s ease"},onMouseEnter:m=>{m.currentTarget.style.transform="scale(1.1)",m.currentTarget.style.boxShadow="0 0 15px rgba(99, 179, 237, 0.5)"},onMouseLeave:m=>{m.currentTarget.style.transform="scale(1)",m.currentTarget.style.boxShadow="0 2px 8px rgba(0,0,0,0.4)"},children:"?"}),a.jsx(e3,{logs:g.logs||[],onCardNameClick:pf,scale:p,isMobile:V})]}):a.jsxs("div",{style:{position:"absolute",left:15,top:"50%",transform:"translateY(-50%)",display:"flex",flexDirection:"column",alignItems:"flex-start",gap:8,zIndex:16,pointerEvents:"none"},children:[a.jsx("button",{onClick:m=>{m.stopPropagation(),yf(!0)},style:{width:36,height:36,borderRadius:"50%",background:"linear-gradient(135deg, #4a5568 0%, #2d3748 100%)",border:"2px solid #63b3ed",color:"#63b3ed",fontSize:"1.2rem",fontWeight:"bold",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",padding:0,boxShadow:"0 4px 12px rgba(0,0,0,0.4)",transition:"all 0.2s ease",pointerEvents:"auto"},onMouseEnter:m=>{m.currentTarget.style.transform="scale(1.1)",m.currentTarget.style.boxShadow="0 0 15px rgba(99, 179, 237, 0.5)"},onMouseLeave:m=>{m.currentTarget.style.transform="scale(1)",m.currentTarget.style.boxShadow="0 4px 12px rgba(0,0,0,0.4)"},children:"?"}),a.jsxs("div",{style:{width:Math.max(180,220*p),height:Math.max(200,280*p),overflowY:"auto",background:"linear-gradient(to right, rgba(0,0,0,0.8), rgba(0,0,0,0.0))",color:"#fff",fontSize:`${Math.max(.65,.75*p)}rem`,padding:`${8*p}px ${8*p}px ${8*p}px ${12*p}px`,borderLeft:"3px solid #63b3ed",pointerEvents:"auto",scrollbarWidth:"thin"},onMouseDown:m=>m.stopPropagation(),onClick:m=>m.stopPropagation(),ref:m=>{m&&(m.scrollTop=m.scrollHeight)},children:[a.jsx("div",{style:{fontWeight:"bold",marginBottom:4*p,color:"#a0aec0",borderBottom:"1px solid rgba(255,255,255,0.1)",paddingBottom:2,fontSize:`${Math.max(.55,.65*p)}rem`,textTransform:"uppercase",letterSpacing:1},children:"BATTLE LOG"}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:3*p},children:(g.logs||[]).map((m,x)=>a.jsx("div",{style:{opacity:.9,lineHeight:"1.4",textShadow:"0 1px 2px black",animation:"fadeIn 0.3s ease-out"},children:m},x))})]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,pointerEvents:"none"},children:[a.jsxs("div",{style:{position:"relative",width:32,height:40},children:[a.jsx("div",{style:{position:"absolute",inset:0,background:"#4a5568",borderRadius:4,border:"1px solid #718096",transform:"rotate(-15deg) translate(-5px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#2d3748",borderRadius:4,border:"1px solid #718096",transform:"rotate(-5deg) translate(-2px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#1a202c",borderRadius:4,border:"1px solid #cbd5e0",transform:"rotate(5deg)"}})]}),a.jsxs("div",{style:{background:"rgba(0,0,0,0.7)",padding:"4px 12px",borderRadius:8,color:"#e2e8f0",fontSize:"0.9rem",fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5)"},children:[" ",oe.hand.length]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,marginLeft:6},children:[a.jsx("div",{style:{fontSize:"1.2rem",filter:"drop-shadow(0 0 3px rgba(128, 90, 213, 0.8))"},children:""}),a.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(128, 90, 213, 0.8), rgba(76, 29, 149, 0.9))",padding:"4px 12px",borderRadius:8,color:"#e2e8f0",fontSize:"0.9rem",fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5), inset 0 1px rgba(255,255,255,0.1)",border:"1px solid rgba(167, 139, 250, 0.5)",position:"relative"},children:[" ",oe.graveyard.length,af.filter(m=>m.playerId===O).map(m=>a.jsxs("div",{style:{position:"absolute",top:-30,left:"50%",transform:"translateX(-50%)",color:"#d946ef",fontSize:"1.5rem",fontWeight:"bold",textShadow:"0 0 10px #d946ef, 0 0 20px #a855f7, 0 0 30px #7c3aed",animation:"necromanceFloat 1.5s ease-out forwards",pointerEvents:"none",whiteSpace:"nowrap"},children:["-",m.amount]},m.key))]})]})]}),$e&&$e.owner==="PLAYER"&&$e.source==="HAND"&&Gr&&(()=>{const b=((V?Math.max(140,180*p):Math.max(180,220*p))-6)/2,P=oe.pp>=$e.card.cost;return a.jsxs("button",{disabled:!P,onClick:N=>{N.stopPropagation(),wm()},className:P?"play-button-active":"",style:{width:b,background:P?"linear-gradient(to bottom, #48bb78, #38a169)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:"8px 4px",borderRadius:12,fontSize:"0.85rem",fontWeight:"bold",cursor:P?"pointer":"not-allowed",boxShadow:P?"0 0 15px rgba(72, 187, 120, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease",pointerEvents:"auto"},onMouseDown:N=>N.stopPropagation(),children:["",a.jsxs("div",{style:{fontSize:"0.6rem",opacity:.8,marginTop:2},children:["pp ",$e.card.cost]})]})})(),$e&&$e.owner==="PLAYER"&&$e.source==="BOARD"&&(()=>{const m=V?Math.max(140,180*p):Math.max(180,220*p),x=6,b=(m-x)/2,P=$e.card,N=P==null?void 0:P.hasEvolved,G=!N&&ms,q=!N&&ys,F=P==null?void 0:P.instanceId,B=oe.board.findIndex(Z=>Z&&Z.instanceId===F),Y=oe.board.slice(0,B+1).filter(Z=>Z).length-1,le=Z=>{B<0||bc(Y>=0?Y:B,Z,void 0,F)};return a.jsxs("div",{style:{display:"flex",gap:x,pointerEvents:"auto"},onMouseDown:Z=>Z.stopPropagation(),children:[a.jsxs("button",{disabled:!G,onClick:Z=>{Z.stopPropagation(),le(!1)},style:{width:b,background:G?"linear-gradient(to bottom, #faf089, #d69e2e)":"#718096",color:G?"#1a202c":"white",border:"2px solid rgba(255,255,255,0.2)",padding:"8px 4px",borderRadius:12,fontSize:"0.85rem",fontWeight:"bold",cursor:G?"pointer":"not-allowed",boxShadow:G?"0 0 15px rgba(250, 240, 137, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:G?"0 1px 1px rgba(255,255,255,0.3)":"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",a.jsx("div",{style:{fontSize:"0.6rem",opacity:.8,marginTop:2},children:"EP"})]}),a.jsxs("button",{disabled:!q,onClick:Z=>{Z.stopPropagation(),le(!0)},style:{width:b,background:q?"linear-gradient(to bottom, #b794f4, #805ad5)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:"8px 4px",borderRadius:12,fontSize:"0.85rem",fontWeight:"bold",cursor:q?"pointer":"not-allowed",boxShadow:q?"0 0 15px rgba(183, 148, 244, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",a.jsx("div",{style:{fontSize:"0.6rem",opacity:.8,marginTop:2},children:"SEP"})]})]})})(),!($e&&$e.owner==="PLAYER"&&($e.source==="HAND"||$e.source==="BOARD"))&&(()=>{const m=V?Math.max(140,180*p):Math.max(180,220*p);return a.jsx("div",{style:{width:m,height:52,visibility:"hidden",pointerEvents:"none"}})})()]}),(ft==="TOSSING"||ft==="RESULT")&&a.jsxs("div",{style:{position:"absolute",inset:0,zIndex:4e3,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.85)",pointerEvents:"none"},children:[a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("div",{style:{width:120*p,height:120*p,margin:`0 auto ${30*p}px`,borderRadius:"50%",background:ft==="RESULT"?zt==="FIRST"?"linear-gradient(135deg, #ffd700, #ff8c00)":"linear-gradient(135deg, #c0c0c0, #808080)":"linear-gradient(135deg, #ffd700, #ff8c00)",boxShadow:ft==="RESULT"?`0 0 ${40*p}px ${zt==="FIRST"?"#ffd700":"#c0c0c0"}, 0 0 ${80*p}px ${zt==="FIRST"?"rgba(255,215,0,0.5)":"rgba(192,192,192,0.5)"}`:`0 0 ${30*p}px #ffd700`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"3rem",fontWeight:900,color:"#1a202c",textShadow:"0 2px 2px rgba(0,0,0,0.5)",animation:ft==="TOSSING"?"coinFlip 0.3s ease-in-out infinite":"coinLand 0.5s ease-out",border:"4px solid rgba(255,255,255,0.3)"},children:ft==="RESULT"?zt==="FIRST"?"":"":"?"}),a.jsxs("div",{style:{fontSize:ft==="RESULT"?"2.5rem":"1.8rem",fontWeight:900,color:zt==="FIRST"?"#ffd700":zt==="SECOND"?"#c0c0c0":"white",textShadow:"0 0 20px currentColor, 0 2px 4px black",animation:ft==="RESULT"?"textPop 0.5s ease-out":"none"},children:[ft==="TOSSING"&&"...",ft==="RESULT"&&(zt==="FIRST"?"":"")]}),ft==="RESULT"&&a.jsx("div",{style:{fontSize:"1rem",color:"#a0aec0",marginTop:10*p,animation:"fadeIn 0.5s ease-out 0.3s both"},children:zt==="FIRST"?"":""})]}),a.jsx("style",{children:`
                            @keyframes coinFlip {
                                0%, 100% { transform: rotateY(0deg) scale(1); }
                                50% { transform: rotateY(180deg) scale(1.1); }
                            }
                            @keyframes coinLand {
                                0% { transform: rotateY(720deg) scale(0.5); }
                                70% { transform: rotateY(0deg) scale(1.2); }
                                100% { transform: rotateY(0deg) scale(1); }
                            }
                            @keyframes textPop {
                                0% { transform: scale(0.5); opacity: 0; }
                                70% { transform: scale(1.2); }
                                100% { transform: scale(1); opacity: 1; }
                            }
                        `})]}),ia&&a.jsxs("div",{style:{position:"absolute",inset:0,zIndex:3e3,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.7)",pointerEvents:"none",animation:"fadeIn 0.2s ease-out"},children:[a.jsx("div",{style:{fontSize:`${3.5*p}rem`,fontWeight:900,fontFamily:"Tamanegi, sans-serif",background:"linear-gradient(135deg, #ffd700, #ff6b6b, #ffd700)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",textShadow:"none",filter:`drop-shadow(0 0 ${15*p}px rgba(255,215,0,0.8)) drop-shadow(0 0 ${30*p}px rgba(255,107,107,0.5))`,animation:"gameStartPop 0.8s ease-out",letterSpacing:"0.2em"},children:" "}),a.jsx("style",{children:`
                            @keyframes gameStartPop {
                                0% { transform: scale(0.3) rotate(-10deg); opacity: 0; }
                                50% { transform: scale(1.2) rotate(5deg); opacity: 1; }
                                70% { transform: scale(0.95) rotate(-2deg); }
                                100% { transform: scale(1) rotate(0deg); opacity: 1; }
                            }
                        `})]}),a.jsxs("div",{ref:di,style:{position:"absolute",bottom:-20*p,left:"50%",transform:"translateX(-50%)",width:so*p,height:so*p,borderRadius:"50%",zIndex:200},children:[a.jsxs("div",{onMouseDown:xI,style:{width:"100%",height:"100%",borderRadius:"50%",overflow:"hidden",border:jf?"4px solid #67e8f9":"4px solid #3182ce",boxShadow:jf?"0 0 20px rgba(103, 232, 249, 0.4), 0 0 40px rgba(103, 232, 249, 0.2)":"0 0 20px rgba(49, 130, 206, 0.4)",background:"#1a202c",cursor:"grab",transition:"border-color 0.3s, box-shadow 0.3s, filter 0.5s, opacity 0.5s",animation:Om?"leaderDamageCapPulse 2s ease-in-out infinite":"none",position:"relative",...g.winnerId&&g.winnerId!==O&&(Ne||tt)?{filter:Ne==="white-fade"?"brightness(2) saturate(0.3)":Ne==="explode"||Ne==="result-text"||Ne==="fade-out"||tt?"brightness(3) saturate(0) blur(10px)":"none",opacity:Ne==="explode"||Ne==="result-text"||Ne==="fade-out"||tt?0:1}:{}},children:[a.jsx("img",{src:sl(oe.class),style:oe.class==="AJA"?{width:"100%",height:"100%",objectFit:"cover",objectPosition:"center top",pointerEvents:"none"}:{width:"100%",height:"100%",objectFit:"cover",pointerEvents:"none"}}),Om&&a.jsx("div",{style:{position:"absolute",inset:0,borderRadius:"50%",background:"radial-gradient(circle, rgba(103, 232, 249, 0.5) 0%, rgba(103, 232, 249, 0.2) 70%, rgba(103, 232, 249, 0.1) 100%)",pointerEvents:"none",animation:"leaderDamageCapOverlay 2s ease-in-out infinite",zIndex:1}})]}),a.jsx("div",{style:{position:"absolute",top:0,left:"50%",transform:`translateX(-50%) translateX(${-140*p}px)`,width:55*p,height:55*p,background:"radial-gradient(circle at 30% 30%, #feb2b2, #c53030)",borderRadius:"50%",border:`${Math.max(2,3*p)}px solid #fff`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${1.2*p}rem`,fontWeight:900,color:"white",textShadow:"0 2px 2px rgba(0,0,0,0.5)",boxShadow:"0 4px 6px rgba(0,0,0,0.4)",zIndex:10,opacity:te?1:0,transition:"opacity 0.3s ease-in"},children:oe.hp}),a.jsx("div",{onMouseDown:m=>Ec(m,!1),onTouchStart:m=>Ec(m,!1),style:{position:"absolute",top:10*p,left:"50%",transform:`translateX(-50%) translateX(${-80*p}px)`,width:45*p,height:45*p,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:ms?"rgba(255,235,100,0.2)":"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",cursor:ms?"grab":"default",zIndex:10,opacity:te?Ic?1:.5:0,filter:Ic?"none":"grayscale(0.8)",transition:"opacity 0.3s ease-in, filter 0.3s, background 0.3s",boxShadow:ms?"0 0 12px #ffd700, 0 0 25px rgba(255,215,0,0.5)":"none",animation:ms?"epPulse 1.5s ease-in-out infinite":"none"},children:a.jsx("div",{style:{display:"flex",gap:3*p},children:Array(2).fill(0).map((m,x)=>{const b=x<km;let P="none";return b&&Ic&&(P=ms?"0 0 10px #fff59d, 0 0 20px #ffd700, 0 0 30px #ecc94b":"0 0 8px #ecc94b, 0 0 15px #ecc94b"),a.jsx("div",{style:{width:12*p,height:12*p,borderRadius:"50%",background:b?ms?"#fff59d":"#ecc94b":"#2d3748",boxShadow:P,border:"2px solid rgba(0,0,0,0.5)",transition:"box-shadow 0.3s, background 0.3s"}},x)})})}),a.jsx("div",{onMouseDown:m=>Ec(m,!0),onTouchStart:m=>Ec(m,!0),style:{position:"absolute",top:10*p,left:"50%",transform:`translateX(-50%) translateX(${80*p}px)`,width:45*p,height:45*p,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:ys?"rgba(200,160,255,0.2)":"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,cursor:ys?"grab":"default",opacity:te?Tc?1:.5:0,filter:Tc?"none":"grayscale(0.8)",transition:"opacity 0.3s ease-in, filter 0.3s, background 0.3s",boxShadow:ys?"0 0 12px #b794f4, 0 0 25px rgba(159,122,234,0.5)":"none",animation:ys?"sepPulse 1.5s ease-in-out infinite":"none"},children:a.jsx("div",{style:{display:"flex",gap:3*p},children:Array(2).fill(0).map((m,x)=>{const b=x<oe.sep;let P="none";return b&&Tc&&(P=ys?"0 0 10px #d6bcfa, 0 0 20px #b794f4, 0 0 30px #9f7aea":"0 0 8px #9f7aea, 0 0 15px #9f7aea"),a.jsx("div",{style:{width:12*p,height:12*p,borderRadius:"50%",background:b?ys?"#d6bcfa":"#9f7aea":"#2d3748",boxShadow:P,border:"2px solid rgba(0,0,0,0.5)",transition:"box-shadow 0.3s, background 0.3s"}},x)})})})]}),a.jsxs("div",{style:{position:"absolute",bottom:10*p,right:15*p,width:60*p,height:85*p,zIndex:50},children:[[...Array(Math.min(5,Math.ceil(oe.deck.length/5)))].map((m,x)=>a.jsx("div",{style:{position:"absolute",inset:0,transform:`translate(${x*2*p}px, ${-x*2*p}px)`,borderRadius:6,border:"1px solid #718096",boxShadow:"1px 1px 3px rgba(0,0,0,0.5)",overflow:"hidden"},children:a.jsx("img",{src:ui((oe==null?void 0:oe.class)||"SENKA"),alt:"Deck",style:{width:"100%",height:"100%",objectFit:"cover"},onError:b=>{b.target.style.display="none",b.target.parentElement.style.background="linear-gradient(45deg, #2d3748, #1a202c)"}})},x)),a.jsx("div",{style:{position:"absolute",top:-20*p,width:"100%",textAlign:"center",color:"#a0aec0",fontSize:"0.9rem",fontWeight:"bold",textShadow:"0 1px 2px black"},children:oe.deck.length})]}),a.jsx("div",{style:{position:"absolute",bottom:0,left:0,width:"100%",height:200*p,display:"flex",justifyContent:"center",alignItems:"flex-end",pointerEvents:"none",zIndex:500},children:oe.hand.map((m,x)=>{if(Ye!==null&&Ye.sourceIndex===x)return null;const P=oe.hand.length;let N=0,G=0,q=0;if(Gr){const B=100*p,Y=window.innerWidth-40*p,le=(P-1)*B+cn*p;let Z=B;le>Y&&(Z=(Y-cn*p)/Math.max(1,P-1)),N=(x-(P-1)/2)*Z,G=ve===x?-8*p:0,q=0}else{const B=45*p,Y=160*p,le=cn*p/2,Z=window.innerWidth/2-Y-le,he=window.innerWidth-340*p-Y,_e=(P-1)*B+cn*p;let Ke=B;_e>he&&(Ke=(he-cn*p)/Math.max(1,P-1)),N=Z-(P-1-x)*Ke,G=0,q=(x-(P-1)/2)*3}const F=oe.pp>=m.cost&&g.activePlayerId===O;return a.jsx("div",{onMouseDown:B=>{bm(B,x),Gr&&je(x===ve?null:x)},onTouchStart:B=>{bm(B,x),Gr&&je(x===ve?null:x)},style:{position:"absolute",left:"50%",bottom:5*p,transform:`translateX(calc(-50% + ${N}px)) translateY(${G}px) rotate(${q}deg) ${(J==null?void 0:J.sourceType)==="HAND"&&J.sourceIndex===x?"scale(1.05) translateY(-10px)":Gr?"translateY(-3px)":""}`,transition:dI===x?"all 0.3s ease-in":(J==null?void 0:J.sourceType)==="HAND"&&J.sourceIndex===x?"none":"all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1)",zIndex:(J==null?void 0:J.sourceType)==="HAND"&&J.sourceIndex===x?1e3:x+100,width:(V?80:cn)*p,height:(V?115:Sn)*p,pointerEvents:"auto",cursor:F?"grab":"not-allowed"},onClick:B=>B.stopPropagation(),children:a.jsx(ro,{card:m,turnCount:g.turnCount,isMyTurn:g.activePlayerId===O,isPlayable:F,scale:p,variant:V?"mobile-hand":"normal",style:{width:V?80*p:cn*p,height:V?115*p:Sn*p,boxShadow:(J==null?void 0:J.sourceType)==="HAND"&&J.sourceIndex===x?"0 0 40px rgba(49, 130, 206, 0.8)":F?"0 0 15px rgba(40, 180, 100, 0.6)":"none"}})},m.instanceId)})}),V&&a.jsxs("div",{style:{position:"absolute",bottom:200*p,left:15*p,display:"flex",alignItems:"center",gap:10*p,zIndex:601,pointerEvents:"none"},children:[a.jsxs("div",{style:{position:"relative",width:50*p,height:62*p},children:[a.jsx("div",{style:{position:"absolute",inset:0,background:"#4a5568",borderRadius:6*p,border:"1px solid #718096",transform:"rotate(-15deg) translate(-5px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#2d3748",borderRadius:6*p,border:"1px solid #718096",transform:"rotate(-5deg) translate(-2px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#1a202c",borderRadius:6*p,border:"1px solid #cbd5e0",transform:"rotate(5deg)"}})]}),a.jsxs("div",{style:{background:"rgba(0,0,0,0.7)",padding:`${6*p}px ${16*p}px`,borderRadius:10*p,color:"#e2e8f0",fontSize:`${1.32*p}rem`,fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5)"},children:[" ",oe.hand.length]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6*p,marginLeft:10*p},children:[a.jsx("div",{style:{fontSize:`${1.87*p}rem`,filter:"drop-shadow(0 0 3px rgba(128, 90, 213, 0.8))"},children:""}),a.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(128, 90, 213, 0.8), rgba(76, 29, 149, 0.9))",padding:`${6*p}px ${16*p}px`,borderRadius:10*p,color:"#e2e8f0",fontSize:`${1.32*p}rem`,fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5), inset 0 1px rgba(255,255,255,0.1)",border:"1px solid rgba(167, 139, 250, 0.5)",position:"relative"},children:[" ",oe.graveyard.length,af.filter(m=>m.playerId===O).map(m=>a.jsxs("div",{style:{position:"absolute",top:-30,left:"50%",transform:"translateX(-50%)",color:"#d946ef",fontSize:"1.5rem",fontWeight:"bold",textShadow:"0 0 10px #d946ef, 0 0 20px #a855f7, 0 0 30px #7c3aed",animation:"necromanceFloat 1.5s ease-out forwards",pointerEvents:"none",whiteSpace:"nowrap"},children:["-",m.amount]},m.key))]})]})]}),V&&$e&&$e.owner==="PLAYER"&&$e.source==="HAND"&&Gr&&(()=>{const m=Math.max(140,180*p),x=4*p,b=(m-x)/2,P=oe.pp>=$e.card.cost;return a.jsxs("div",{style:{position:"absolute",left:15*p,bottom:135*p,zIndex:600,pointerEvents:"auto"},children:[a.jsxs("button",{disabled:!P,onClick:N=>{N.stopPropagation(),wm()},className:P?"play-button-active":"",style:{width:b,background:P?"linear-gradient(to bottom, #48bb78, #38a169)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:`${5*p}px ${3*p}px`,borderRadius:10*p,fontSize:`${.7*p}rem`,fontWeight:"bold",cursor:P?"pointer":"not-allowed",boxShadow:P?"0 0 12px rgba(72, 187, 120, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},onMouseDown:N=>N.stopPropagation(),children:["",a.jsxs("div",{style:{fontSize:`${.5*p}rem`,opacity:.8,marginTop:1},children:["pp ",$e.card.cost]})]}),a.jsx("style",{children:`
                                @keyframes playGlowPulse {
                                    0% { box-shadow: 0 0 10px rgba(72, 187, 120, 0.4); }
                                    50% { box-shadow: 0 0 25px rgba(72, 187, 120, 0.8); }
                                    100% { box-shadow: 0 0 10px rgba(72, 187, 120, 0.4); }
                                }
                                .play-button-active {
                                    animation: playGlowPulse 2s infinite ease-in-out;
                                }
                            `})]})})(),V&&$e&&$e.owner==="PLAYER"&&$e.source==="BOARD"&&(()=>{const m=Math.max(140,180*p),x=4*p,b=(m-x)/2,P=$e.card,N=P==null?void 0:P.hasEvolved,G=!N&&ms,q=!N&&ys,F=P==null?void 0:P.instanceId,B=oe.board.findIndex(Z=>Z&&Z.instanceId===F),Y=oe.board.slice(0,B+1).filter(Z=>Z).length-1,le=Z=>{B<0||bc(Y>=0?Y:B,Z,void 0,F)};return a.jsxs("div",{style:{position:"absolute",left:15*p,bottom:135*p,zIndex:600,pointerEvents:"auto",display:"flex",gap:x},onMouseDown:Z=>Z.stopPropagation(),children:[a.jsxs("button",{disabled:!G,onClick:Z=>{Z.stopPropagation(),le(!1)},style:{width:b,background:G?"linear-gradient(to bottom, #faf089, #d69e2e)":"#718096",color:G?"#1a202c":"white",border:"2px solid rgba(255,255,255,0.2)",padding:`${5*p}px ${3*p}px`,borderRadius:10*p,fontSize:`${.7*p}rem`,fontWeight:"bold",cursor:G?"pointer":"not-allowed",boxShadow:G?"0 0 12px rgba(250, 240, 137, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:G?"0 1px 1px rgba(255,255,255,0.3)":"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",a.jsx("div",{style:{fontSize:`${.5*p}rem`,opacity:.8,marginTop:1},children:"EP"})]}),a.jsxs("button",{disabled:!q,onClick:Z=>{Z.stopPropagation(),le(!0)},style:{width:b,background:q?"linear-gradient(to bottom, #b794f4, #805ad5)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:`${5*p}px ${3*p}px`,borderRadius:10*p,fontSize:`${.7*p}rem`,fontWeight:"bold",cursor:q?"pointer":"not-allowed",boxShadow:q?"0 0 12px rgba(183, 148, 244, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",a.jsx("div",{style:{fontSize:`${.5*p}rem`,opacity:.8,marginTop:1},children:"SEP"})]})]})})(),fs&&Array.from({length:fs.count},(m,x)=>{const q=-(fs.count*80+(fs.count-1)*20-80)/2+x*100,F=fs.isPlayer?ui((oe==null?void 0:oe.class)||"SENKA"):ui((Oe==null?void 0:Oe.class)||"SENKA");return a.jsx("div",{style:{position:"absolute",left:fs.isPlayer?"calc(100% - 90px)":90,top:fs.isPlayer?"calc(100% - 105px)":105,width:80,height:110,borderRadius:8,border:"2px solid white",overflow:"hidden",transform:`translateX(${q}px)`,animation:`drawCard${fs.isPlayer?"Player":"Opponent"} ${gf}ms cubic-bezier(0.2, 0.8, 0.2, 1) forwards`,zIndex:9e3+x,boxShadow:"0 0 10px rgba(255,255,255,0.5)"},children:a.jsx("img",{src:F,alt:"Card Back",style:{width:"100%",height:"100%",objectFit:"cover"},onError:B=>{B.target.style.display="none",B.target.parentElement.style.background="repeating-linear-gradient(45deg, #2d3748, #2d3748 10px, #1a202c 10px, #1a202c 20px)"}})},x)}),a.jsx("style",{children:`
                        @keyframes drawCardPlayer {
                            0% { opacity: 1; }
                            100% { transform: translate(-50vw, -100px) scale(0.5) rotate(-10deg); opacity: 0; }
                        }
                        @keyframes drawCardOpponent {
                            0% { opacity: 1; }
                            100% { transform: translate(50vw, 200px) scale(0.5) rotate(10deg); opacity: 0; }
                        }
                    `})]}),yI.map(m=>a.jsx(JL,{value:m.value,x:m.x,y:m.y,color:m.color,scale:p,onComplete:()=>yc(x=>x.filter(b=>b.id!==m.id))},m.id)),lf&&Br.current&&(()=>{const m=Br.current.x,x=Br.current.y,b=200,P=320,G=180/8,q=(F,B,Y,le)=>{const Z=F*Math.PI/180,he=B*Math.PI/180,_e=Math.cos(Z)*le,Ke=-Math.sin(Z)*le,Se=Math.cos(he)*le,Ge=-Math.sin(he)*le,Je=Math.cos(he)*Y,ze=-Math.sin(he)*Y,He=Math.cos(Z)*Y,pe=-Math.sin(Z)*Y;return`M ${_e} ${Ke} A ${le} ${le} 0 0 0 ${Se} ${Ge} L ${Je} ${ze} A ${Y} ${Y} 0 0 1 ${He} ${pe} Z`};return a.jsxs("div",{style:{position:"fixed",left:m,top:x,zIndex:2e3,pointerEvents:"none",animation:"stampUIFadeIn 0.15s ease-out"},children:[a.jsx("svg",{width:P*2+20,height:P+20,style:{position:"absolute",left:-330,top:-330,overflow:"visible"},children:a.jsx("g",{transform:`translate(${P+10}, ${P+10})`,children:X0.map((F,B)=>{const Y=180-B*G,le=Y-G,Z=cf===F.id,_e=(Y+le)/2*Math.PI/180,Ke=(b+P)/2,Se=Math.cos(_e)*Ke,Ge=-Math.sin(_e)*Ke,Je=85;return a.jsxs("g",{children:[a.jsx("path",{d:q(Y,le,b,P),fill:Z?"rgba(255, 215, 0, 0.4)":"rgba(0, 0, 0, 0.7)",stroke:Z?"#ffd700":"rgba(255, 255, 255, 0.3)",strokeWidth:Z?3:1,style:{transition:"all 0.1s ease-out"}}),a.jsx("defs",{children:a.jsx("clipPath",{id:`stampClip-${F.id}`,children:a.jsx("circle",{cx:Se,cy:Ge,r:Je/2})})}),a.jsx("image",{href:Ze(S_(F.id,Tr)),x:Se-Je/2,y:Ge-Je/2,width:Je,height:Je,clipPath:`url(#stampClip-${F.id})`,style:{transform:Z?"scale(1.15)":"scale(1)",transformOrigin:`${Se}px ${Ge}px`,transition:"transform 0.1s ease-out"}}),a.jsx("circle",{cx:Se,cy:Ge,r:Je/2,fill:"none",stroke:Z?"#ffd700":"rgba(255, 255, 255, 0.5)",strokeWidth:Z?2:1})]},F.id)})})}),a.jsx("style",{children:`
                                @keyframes stampUIFadeIn {
                                    from { opacity: 0; transform: scale(0.8); }
                                    to { opacity: 1; transform: scale(1); }
                                }
                            `})]})})(),ca&&a.jsxs("div",{style:{position:"fixed",left:"50%",top:"40%",transform:"translate(-50%, -50%)",zIndex:2500,pointerEvents:"none",animation:"stampDisplay 3s ease-out forwards"},children:[a.jsx("div",{style:{width:250,height:250,borderRadius:20,overflow:"hidden",boxShadow:"0 0 40px rgba(0,0,0,0.5), 0 0 60px rgba(255,255,255,0.2)",border:"4px solid rgba(255,255,255,0.3)"},children:a.jsx("img",{src:Ze(S_(ca.stampId,ca.playerClass)),alt:"",style:{width:"100%",height:"100%",objectFit:"cover"}})}),ca.playerId!==O&&a.jsx("div",{style:{position:"absolute",bottom:-30,left:"50%",transform:"translateX(-50%)",background:"rgba(0,0,0,0.7)",padding:"5px 15px",borderRadius:15,color:"#fff",fontSize:"0.9rem",whiteSpace:"nowrap"},children:""}),a.jsx("style",{children:`
                            @keyframes stampDisplay {
                                0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
                                10% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
                                20% { transform: translate(-50%, -50%) scale(1); }
                                80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                                100% { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
                            }
                        `})]},ca.timestamp),a.jsx("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:1e3},children:J&&(J.sourceType==="BOARD"||J.sourceType==="EVOLVE")&&a.jsxs(a.Fragment,{children:[a.jsxs("defs",{children:[a.jsxs("filter",{id:"cyanGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{stdDeviation:"10",result:"blur1"}),a.jsx("feFlood",{floodColor:"rgba(100, 200, 255, 0.7)",result:"color1"}),a.jsx("feComposite",{in:"color1",in2:"blur1",operator:"in",result:"glow1"}),a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"5",result:"blur2"}),a.jsx("feFlood",{floodColor:"rgba(150, 220, 255, 0.5)",result:"color2"}),a.jsx("feComposite",{in:"color2",in2:"blur2",operator:"in",result:"glow2"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"glow1"}),a.jsx("feMergeNode",{in:"glow2"})]})]}),a.jsxs("filter",{id:"yellowGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{stdDeviation:"10",result:"blur1"}),a.jsx("feFlood",{floodColor:"rgba(255, 255, 50, 0.7)",result:"color1"}),a.jsx("feComposite",{in:"color1",in2:"blur1",operator:"in",result:"glow1"}),a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"5",result:"blur2"}),a.jsx("feFlood",{floodColor:"rgba(255, 240, 100, 0.5)",result:"color2"}),a.jsx("feComposite",{in:"color2",in2:"blur2",operator:"in",result:"glow2"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"glow1"}),a.jsx("feMergeNode",{in:"glow2"})]})]}),a.jsxs("filter",{id:"softWhiteGlow",x:"-300%",y:"-300%",width:"700%",height:"700%",children:[a.jsx("feGaussianBlur",{stdDeviation:"20",result:"blur"}),a.jsx("feFlood",{floodColor:"rgba(255, 255, 255, 0.9)",result:"color"}),a.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"glow"}),a.jsx("feMergeNode",{in:"glow"}),a.jsx("feMergeNode",{in:"glow"})]})]}),a.jsxs("filter",{id:"innerCoreGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{stdDeviation:"4",result:"blur"}),a.jsx("feFlood",{floodColor:"rgba(255, 255, 255, 0.8)",result:"color"}),a.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),a.jsx("feMerge",{children:a.jsx("feMergeNode",{in:"glow"})})]}),a.jsxs("filter",{id:"coloredBallGlow",x:"-150%",y:"-150%",width:"400%",height:"400%",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"6",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"blur"})]})]}),a.jsxs("filter",{id:"particleGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"2",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),a.jsxs("filter",{id:"purpleGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{stdDeviation:"10",result:"blur1"}),a.jsx("feFlood",{floodColor:"rgba(183, 148, 244, 0.7)",result:"color1"}),a.jsx("feComposite",{in:"color1",in2:"blur1",operator:"in",result:"glow1"}),a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"5",result:"blur2"}),a.jsx("feFlood",{floodColor:"rgba(200, 170, 255, 0.5)",result:"color2"}),a.jsx("feComposite",{in:"color2",in2:"blur2",operator:"in",result:"glow2"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"glow1"}),a.jsx("feMergeNode",{in:"glow2"})]})]})]}),J.sourceType==="BOARD"&&a.jsxs(a.Fragment,{children:[a.jsx("path",{d:gs(),fill:"none",stroke:"rgba(100, 200, 255, 0.3)",strokeWidth:"20",strokeLinecap:"butt",filter:"url(#cyanGlow)"}),a.jsx("path",{d:gs(),fill:"none",stroke:"rgba(150, 220, 255, 0.5)",strokeWidth:"10",strokeLinecap:"butt"}),a.jsx("path",{d:gs(),fill:"none",stroke:"rgba(200, 240, 255, 0.9)",strokeWidth:"4",strokeLinecap:"butt"}),a.jsx("path",{d:gs(),fill:"none",stroke:"rgba(255, 255, 255, 1)",strokeWidth:"2",strokeLinecap:"butt"})]}),J.sourceType==="EVOLVE"&&a.jsxs(a.Fragment,{children:[a.jsx("path",{d:gs(),fill:"none",stroke:J.useSep?"rgba(159, 122, 234, 0.3)":"rgba(236, 201, 75, 0.3)",strokeWidth:"20",strokeLinecap:"butt",filter:J.useSep?"url(#purpleGlow)":"url(#yellowGlow)"}),a.jsx("path",{d:gs(),fill:"none",stroke:J.useSep?"rgba(183, 148, 244, 0.5)":"rgba(246, 224, 94, 0.5)",strokeWidth:"10",strokeLinecap:"butt"}),a.jsx("path",{d:gs(),fill:"none",stroke:J.useSep?"rgba(214, 188, 250, 0.9)":"rgba(250, 240, 137, 0.9)",strokeWidth:"4",strokeLinecap:"butt"}),a.jsx("path",{d:gs(),fill:"none",stroke:"rgba(255, 255, 255, 1)",strokeWidth:"2",strokeLinecap:"butt"})]}),(J.sourceType==="BOARD"||J.sourceType==="EVOLVE")&&a.jsxs(a.Fragment,{children:[a.jsx("circle",{cx:J.startX,cy:J.startY,r:"15",fill:"rgba(255, 255, 255, 0.3)",filter:"url(#softWhiteGlow)"}),a.jsx("circle",{cx:J.startX,cy:J.startY,r:"8",fill:"rgba(255, 255, 255, 0.4)",filter:"url(#softWhiteGlow)"})]}),(J.sourceType==="BOARD"||J.sourceType==="EVOLVE")&&a.jsxs(a.Fragment,{children:[a.jsx("circle",{cx:J.currentX,cy:J.currentY,r:"18",fill:"rgba(255, 255, 255, 0.25)",filter:"url(#softWhiteGlow)"}),a.jsx("circle",{cx:J.currentX,cy:J.currentY,r:"8",fill:"rgba(255, 255, 255, 0.35)",filter:"url(#softWhiteGlow)"}),a.jsx("circle",{cx:J.currentX,cy:J.currentY,r:"3",fill:"rgba(255, 255, 255, 0.7)",filter:"url(#innerCoreGlow)"})]}),lI.map(m=>{const x=J.sourceType==="EVOLVE"?J.useSep?`rgba(230, 220, 255, ${m.opacity})`:`rgba(255, 255, 230, ${m.opacity})`:`rgba(220, 245, 255, ${m.opacity})`;return a.jsx("circle",{cx:m.x,cy:m.y,r:m.radius,fill:x,filter:"url(#particleGlow)"},m.id)})]})}),Yt&&a.jsxs("svg",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100dvh",pointerEvents:"none",zIndex:99999},children:[a.jsx("defs",{children:a.jsxs("filter",{id:"endTurnGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{stdDeviation:"6",result:"blur"}),a.jsx("feFlood",{floodColor:"rgba(100, 200, 255, 0.8)",result:"color"}),a.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"glow"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsx("circle",{cx:Yt.x,cy:Yt.y,r:Yt.ringRadius,fill:"none",stroke:`rgba(100, 200, 255, ${Math.max(0,1-Yt.ringRadius/120)*.8})`,strokeWidth:"4",filter:"url(#endTurnGlow)"}),a.jsx("circle",{cx:Yt.x,cy:Yt.y,r:Yt.ringRadius*.8,fill:"none",stroke:`rgba(255, 255, 255, ${Math.max(0,1-Yt.ringRadius/120)*.6})`,strokeWidth:"2"}),a.jsx("circle",{cx:Yt.x,cy:Yt.y,r:20,fill:`rgba(255, 255, 255, ${Math.max(0,1-Yt.ringRadius/120)*.9})`}),Yt.particles.map(m=>a.jsx("circle",{cx:m.x,cy:m.y,r:4,fill:`rgba(255, 255, 255, ${m.opacity*.8})`},m.id))]}),Ye&&a.jsxs("div",{style:{position:"absolute",inset:0,zIndex:9999,pointerEvents:"auto",background:"rgba(0,0,0,0.5)",perspective:"1200px"},children:[a.jsx("style",{children:`
                                @keyframes playCardSequence {
                                    ${Ye.finalX!==void 0?`
                                    /* Phase 1: Start at hand position (0%) */
                                    0% {
                                        transform: translate(${Ye.startX-Ye.targetX}px, ${Ye.startY-Ye.targetY}px) translate(-50%, -50%) scale(1.0) rotateY(0deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Phase 1b: Mid-rotation during move (12.5%) - CRITICAL: explicit 180deg to force rotation direction */
                                    12.5% {
                                        transform: translate(${(Ye.startX-Ye.targetX)*.5}px, ${(Ye.startY-Ye.targetY)*.5}px) translate(-50%, -50%) scale(1.5) rotateY(180deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Phase 2: Arrive at center with rotation complete (25%) */
                                    25% {
                                        transform: translate(-50%, -50%) scale(1.8) rotateY(360deg);
                                        opacity: 1;
                                        animation-timing-function: ease-out;
                                    }
                                    /* Phase 3: Hold at center (25%-80%) */
                                    80% {
                                        transform: translate(-50%, -50%) scale(2.4) rotateY(360deg);
                                        opacity: 1;
                                    }
                                    /* Phase 4: Move to board position (80%-100%) */
                                    100% {
                                        transform: translate(calc(-50% + ${Ye.finalX-Ye.targetX}px), calc(-50% + ${Ye.finalY-Ye.targetY}px)) scale(1.0) rotateY(360deg);
                                        opacity: 1;
                                    }
                                    `:`
                                    /* Spell: Move to center while rotating, then fade */
                                    0% {
                                        transform: translate(${Ye.startX-Ye.targetX}px, ${Ye.startY-Ye.targetY}px) translate(-50%, -50%) scale(1.0) rotateY(0deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Mid-rotation during move (15%) - CRITICAL: explicit 180deg */
                                    15% {
                                        transform: translate(${(Ye.startX-Ye.targetX)*.5}px, ${(Ye.startY-Ye.targetY)*.5}px) translate(-50%, -50%) scale(1.7) rotateY(180deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    30% {
                                        transform: translate(-50%, -50%) scale(2.2) rotateY(360deg);
                                        opacity: 1;
                                        animation-timing-function: ease-out;
                                    }
                                    80% {
                                        transform: translate(-50%, -50%) scale(2.4) rotateY(360deg);
                                        opacity: 1;
                                    }
                                    100% {
                                        transform: translate(-50%, -50%) scale(3.0) rotateY(360deg);
                                        opacity: 0;
                                    }
                                    `}
                                }
                                @keyframes playSpellSequence {
                                    /* Move from hand to center while rotating (0-30%) */
                                    0% {
                                        transform: translate(${Ye.startX-Ye.targetX}px, ${Ye.startY-Ye.targetY}px) translate(-50%, -50%) scale(1.0) rotateY(0deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Mid-rotation during move (15%) - CRITICAL: explicit 180deg to force rotation direction */
                                    15% {
                                        transform: translate(${(Ye.startX-Ye.targetX)*.5}px, ${(Ye.startY-Ye.targetY)*.5}px) translate(-50%, -50%) scale(1.7) rotateY(180deg);
                                        opacity: 1;
                                        filter: brightness(1);
                                        animation-timing-function: linear;
                                    }
                                    /* Arrive at center with rotation complete (30%) */
                                    30% {
                                        transform: translate(-50%, -50%) scale(2.2) rotateY(360deg);
                                        opacity: 1;
                                        filter: brightness(1);
                                        animation-timing-function: ease-out;
                                    }
                                    /* Hold at center (30%-75%) */
                                    75% {
                                        transform: translate(-50%, -50%) scale(2.4) rotateY(360deg);
                                        opacity: 1;
                                        filter: brightness(1.2);
                                    }
                                    /* Fade out (75%-100%) */
                                    100% {
                                        transform: translate(-50%, -50%) scale(3.0) rotateY(360deg);
                                        opacity: 0;
                                        filter: brightness(3);
                                    }
                                }
                                .play-card-flipper {
                                    transform-style: preserve-3d !important;
                                }
                                .play-card-front, .play-card-back {
                                    backface-visibility: hidden !important;
                                    -webkit-backface-visibility: hidden !important;
                                    position: absolute;
                                    width: 100%;
                                    height: 100%;
                                }
                                .play-card-back {
                                    transform: rotateY(180deg) translateZ(1px);
                                }
                            `}),a.jsxs("div",{className:"play-card-flipper",onAnimationEnd:Ye.onComplete,style:{position:"absolute",left:Ye.targetX,top:Ye.targetY,width:cn*p,height:Sn*p,transformStyle:"preserve-3d",animation:Ye.card.type==="SPELL"?"playSpellSequence 1s forwards":"playCardSequence 0.8s forwards"},children:[a.jsx("div",{className:"play-card-front",children:a.jsx(ro,{card:Ye.card,isOnBoard:!0,suppressPassives:!0,scale:p,style:{width:cn*p,height:Sn*p,boxShadow:"0 0 50px rgba(255,215,0,0.8)"}})}),a.jsx("div",{className:"play-card-back",style:{borderRadius:12,boxShadow:"0 0 50px rgba(255,215,0,0.8)",overflow:"hidden"},children:a.jsx("img",{src:ui(Ye.playerClass),alt:"Card Sleeve",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:12},onError:m=>{const x=m.target;x.style.display="none",x.parentElement&&(x.parentElement.style.background="linear-gradient(135deg, #1e3a5f 0%, #0d1b2a 50%, #1e3a5f 100%)")}})}),Ye.card.type==="SPELL"&&a.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none"},children:a.jsx(qL,{x:0,y:0})})]})]}),Yi.length>0&&Yi.map((m,x)=>a.jsx("div",{style:{position:"absolute",left:m.status==="FLY"&&m.targetX!==void 0?m.targetX:window.innerWidth/2+m.xOffset,top:m.status==="FLY"&&m.targetY!==void 0?m.targetY:window.innerHeight/2,transform:m.status==="APPEAR"?"translate(-50%, -50%) scale(1.2)":"translate(-50%, -50%) scale(0.2)",zIndex:7e3+x,pointerEvents:"none",transition:m.status==="FLY"?"all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)":"none",opacity:m.status==="FLY"?.3:1,animation:m.status==="APPEAR"?"cardAppear 0.8s ease-out":void 0},children:a.jsx(ro,{card:m.card,scale:p,style:{width:cn*p,height:Sn*p}})},x)),a.jsx("style",{children:`
                    @keyframes cardAppear {
                        0% { transform: translate(-50%, -50%) scale(0) rotate(-10deg); opacity: 0; }
                        50% { transform: translate(-50%, -50%) scale(1.3) rotate(5deg); opacity: 1; }
                        100% { transform: translate(-50%, -50%) scale(1.2) rotate(0deg); opacity: 1; }
                    }
                `}),hc.map(m=>m.type==="BUFF"?a.jsx(KL,{x:m.x,y:m.y,atkBuff:m.atkBuff??0,hpBuff:m.hpBuff??0,onComplete:()=>Ki(x=>x.filter(b=>b.key!==m.key))},m.key):a.jsx(QL,{type:m.type,x:m.x,y:m.y,onComplete:()=>Ki(x=>x.filter(b=>b.key!==m.key)),audioSettings:Ct,scale:p},m.key)),Lt&&a.jsx(t3,{card:Lt.card,evolvedImageUrl:Lt.evolvedImageUrl,startX:Lt.startX,startY:Lt.startY,phase:Lt.phase,onPhaseChange:_I,onShake:Bn,useSep:Lt.useSep,playSE:_t,scale:p,isLightMode:ne}),li&&a.jsxs("div",{style:{position:"fixed",top:"45%",left:`${340*p}px`,width:`calc(100% - ${340*p}px)`,display:"flex",justifyContent:"center",alignItems:"center",transform:"translateY(-50%)",zIndex:9e3,pointerEvents:"none",animation:"notificationFade 2.5s forwards"},children:[a.jsx("div",{style:{padding:`${20*p}px ${90*p}px`,background:"rgba(0, 0, 0, 0.75)",backdropFilter:"blur(16px)",borderTop:`${3*p}px solid ${li==="EVOLVE_READY"?"rgba(255, 215, 0, 0.7)":"rgba(180, 0, 255, 0.7)"}`,borderBottom:`${3*p}px solid ${li==="EVOLVE_READY"?"rgba(255, 215, 0, 0.7)":"rgba(180, 0, 255, 0.7)"}`,boxShadow:li==="EVOLVE_READY"?`0 0 ${50*p}px rgba(255, 180, 0, 0.5), inset 0 0 ${30*p}px rgba(255, 215, 0, 0.2)`:`0 0 ${50*p}px rgba(180, 0, 255, 0.5), inset 0 0 ${30*p}px rgba(180, 0, 255, 0.2)`,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",borderRadius:`${4*p}px`},children:a.jsx("span",{style:{fontSize:`${5*p}rem`,fontWeight:"900",fontFamily:'"YuMincho", "Hiragino Mincho ProN", "MS Mincho", serif',color:"#fff",letterSpacing:`${.8*p}rem`,whiteSpace:"nowrap",textShadow:li==="EVOLVE_READY"?`0 0 ${15*p}px rgba(255, 215, 0, 1), 0 0 ${30*p}px rgba(255, 180, 0, 0.8), ${2*p}px ${2*p}px ${4*p}px rgba(0,0,0,0.9)`:`0 0 ${15*p}px rgba(180, 0, 255, 1), 0 0 ${30*p}px rgba(140, 0, 255, 0.8), ${2*p}px ${2*p}px ${4*p}px rgba(0,0,0,0.9)`,WebkitTextStroke:li==="EVOLVE_READY"?`${1.5*p}px #ffd700`:`${1.5*p}px #b400ff`},children:li==="EVOLVE_READY"?"":""})}),a.jsx("style",{children:`
                            @keyframes notificationFade {
                                0% { opacity: 0; transform: translateY(-40%) scale(0.8); filter: blur(15px); }
                                10% { opacity: 1; transform: translateY(-50%) scale(1); filter: blur(0px); }
                                90% { opacity: 1; transform: translateY(-50%) scale(1); filter: blur(0px); }
                                100% { opacity: 0; transform: translateY(-60%) scale(1.15); filter: blur(20px); }
                            }
                        `})]}),Pe&&g.winnerId&&a.jsx(NL,{isVictory:g.winnerId===O,loserLeaderRef:g.winnerId===O?Qi:di,onComplete:()=>{we(!1),qe(!0),st(null),Ot(0),(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&v&&(console.log("[GameScreen] Disconnecting after game over (casual match)"),v.disconnect())},onPhaseChange:st,onShakeIntensityChange:Ot,scale:p}),g.winnerId&&tt&&a.jsx(a3,{winnerId:g.winnerId,playerId:O,playerClass:(oe==null?void 0:oe.class)||"SENKA",isOnline:e==="ONLINE",isRoomMatch:n==="HOST"||n==="JOIN",myRematchRequested:sf,opponentRematchRequested:nt,battleStats:{turnCount:g.turnCount,damageDealtToOpponent:sc.damageDealtToOpponent,damageReceivedFromOpponent:sc.damageReceivedFromOpponent,followersDestroyed:sc.followersDestroyed,myFollowersDestroyed:sc.myFollowersDestroyed},selectedCardInfo:sI,onCardInfoClick:of,victoryReason:aa,isRankedMatch:n==="RANKED_MATCH",ratingResult:iI,onRematching:i,onRematch:m=>{e==="ONLINE"?(Ee(!0),nt?(v==null||v.send({type:"REMATCH_ACCEPT"}),Ef(m)):(v==null||v.send({type:"REMATCH_REQUEST"}),J0(m))):Ef(m)},onLeave:s})]})]})},rf=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},c3=rf("/leaders/azya_leader.png"),d3=rf("/leaders/senka_leader.png"),u3=rf("/leaders/yoRuka_leader.png"),f3=1280,h3=720,p3={SENKA:{primary:"#e94560",gradient:"linear-gradient(135deg, #2c0b0e 0%, #1a1a2e 100%)",shadow:"rgba(233, 69, 96, 0.3)"},AJA:{primary:"#45a2e9",gradient:"linear-gradient(135deg, #0f1c2e 0%, #1a1a2e 100%)",shadow:"rgba(69, 162, 233, 0.3)"},YORUKA:{primary:"#a855f7",gradient:"linear-gradient(135deg, #1a0f2e 0%, #1a1a2e 100%)",shadow:"rgba(168, 85, 247, 0.3)"}},g3={SENKA:"",AJA:"",YORUKA:"Y"},m3={SENKA:d3,AJA:c3,YORUKA:u3},La=["SENKA","AJA","YORUKA"],y3=({classType:t,onSelectCard:e})=>{const[n,r]=L.useState(1),[s,i]=L.useState(La.indexOf(t));L.useEffect(()=>{const D=()=>{const H=window.innerWidth/f3,ne=window.innerHeight/h3;r(Math.min(H,ne))};return D(),window.addEventListener("resize",D),()=>window.removeEventListener("resize",D)},[]);const o=D=>D==="SENKA"?qS:D==="AJA"?ZS:eI,l=La[s],d=o(l).filter(D=>!D.cardId.startsWith("TOKEN_")).map(D=>({card:tr.find(H=>H.id===D.cardId),count:D.count})).filter(D=>D.card),u=p3[l],h=g3[l],f=m3[l],E=180*n,k=250*n,w=110*n,$=155*n,v=.6*n,_=1.8*n,S=()=>{i(D=>(D-1+La.length)%La.length)},p=()=>{i(D=>(D+1)%La.length)};return a.jsxs("div",{style:{minHeight:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",background:u.gradient,color:"white",position:"relative",paddingBottom:`${40*n}px`},children:[a.jsxs("h2",{style:{fontSize:`${_}rem`,marginTop:`${80*n}px`,marginBottom:`${20*n}px`,fontFamily:"sans-serif",color:u.primary,textShadow:`0 0 20px ${u.shadow}`},children:[h," - "]}),a.jsxs("div",{style:{display:"flex",gap:`${2*n}rem`,width:"95%",maxWidth:`${1100*n}px`,alignItems:"flex-start",justifyContent:"center"},children:[a.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:`${.8*n}rem`},children:[a.jsx("button",{onClick:S,style:{width:`${45*n}px`,height:`${45*n}px`,background:"rgba(0, 0, 0, 0.5)",border:`2px solid ${u.primary}`,borderRadius:"50%",color:u.primary,fontSize:`${1.5*n}rem`,cursor:"pointer",fontWeight:"bold",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},onMouseOver:D=>{D.currentTarget.style.background=u.primary,D.currentTarget.style.color="white"},onMouseOut:D=>{D.currentTarget.style.background="rgba(0, 0, 0, 0.5)",D.currentTarget.style.color=u.primary},children:"<"}),a.jsxs("div",{style:{width:E,height:k,border:`3px solid ${u.primary}`,borderRadius:10*n,background:"linear-gradient(180deg, rgba(0,0,0,0.5) 0%, rgba(0,0,0,0.8) 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",boxShadow:`0 8px 30px ${u.shadow}`,overflow:"hidden",position:"relative"},children:[a.jsx("img",{src:f,alt:h,style:{width:"100%",height:"75%",objectFit:"cover"}}),a.jsx("div",{style:{padding:`${8*n}px`,display:"flex",flexDirection:"column",alignItems:"center",width:"100%",justifyContent:"center",flex:1},children:a.jsx("h3",{style:{fontSize:`${1.2*n}rem`,color:u.primary,margin:0,fontFamily:"sans-serif"},children:h})})]}),a.jsx("button",{onClick:p,style:{width:`${45*n}px`,height:`${45*n}px`,background:"rgba(0, 0, 0, 0.5)",border:`2px solid ${u.primary}`,borderRadius:"50%",color:u.primary,fontSize:`${1.5*n}rem`,cursor:"pointer",fontWeight:"bold",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},onMouseOver:D=>{D.currentTarget.style.background=u.primary,D.currentTarget.style.color="white"},onMouseOut:D=>{D.currentTarget.style.background="rgba(0, 0, 0, 0.5)",D.currentTarget.style.color=u.primary},children:">"})]}),a.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:`${1*n}rem`},children:[a.jsx("div",{style:{display:"grid",gridTemplateColumns:`repeat(auto-fill, minmax(${w}px, 1fr))`,gap:`${v}rem`,width:"100%",padding:`${10*n}px`,maxHeight:`${($+v*16)*3+40*n}px`,overflowY:"auto",overflowX:"hidden"},children:d.map(({card:D,count:H})=>a.jsxs("div",{onClick:()=>e(D.id),style:{width:w,height:$,border:`2px solid ${u.primary}`,borderRadius:8*n,background:"linear-gradient(180deg, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.9) 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"all 0.2s",boxShadow:`0 4px 15px ${u.shadow}`,position:"relative",overflow:"hidden"},onMouseOver:ne=>{ne.currentTarget.style.transform="translateY(-5px) scale(1.05)",ne.currentTarget.style.boxShadow=`0 8px 25px ${u.shadow}`},onMouseOut:ne=>{ne.currentTarget.style.transform="translateY(0) scale(1)",ne.currentTarget.style.boxShadow=`0 4px 15px ${u.shadow}`},children:[a.jsx("div",{style:{width:"100%",height:"65%",overflow:"hidden",borderBottom:`1px solid ${u.primary}`},children:a.jsx("img",{src:rf(D.imageUrl||`/cards/${D.id}.png`),alt:D.name,style:{width:"100%",height:"100%",objectFit:"cover"},onError:ne=>{ne.currentTarget.style.display="none"}})}),a.jsxs("div",{style:{padding:`${5*n}px`,textAlign:"center",flex:1,display:"flex",flexDirection:"column",justifyContent:"center",width:"100%"},children:[a.jsx("h3",{style:{fontSize:`${.7*n}rem`,margin:`0 0 ${3*n}px 0`,fontFamily:"sans-serif",color:u.primary,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:D.name}),a.jsxs("p",{style:{fontSize:`${.6*n}rem`,color:"#ffcc00",margin:0,fontFamily:"sans-serif",fontWeight:"bold"},children:[": ",D.cost]})]}),a.jsx("div",{style:{position:"absolute",bottom:`${5*n}px`,right:`${5*n}px`,background:"rgba(0, 0, 0, 0.8)",color:"white",borderRadius:50,width:`${22*n}px`,height:`${22*n}px`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${.7*n}rem`,fontWeight:"bold",fontFamily:"sans-serif",border:`2px solid ${u.primary}`,boxShadow:`0 0 10px ${u.shadow}`},children:H})]},D.id))}),a.jsxs("div",{style:{fontSize:`${.85*n}rem`,color:"#aaa",fontFamily:"sans-serif",textAlign:"center"},children:[" ",d.length," "]})]})]})]})},v3=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},_3=1280,x3=720,b3=({cardId:t,onOpenRelatedCard:e,onBack:n,onSetHomeCard:r})=>{const[s,i]=L.useState(1),[o,l]=L.useState(!1);L.useEffect(()=>{const v=()=>{const _=window.innerWidth/_3,S=window.innerHeight/x3;i(Math.min(_,S))};return v(),window.addEventListener("resize",v),()=>window.removeEventListener("resize",v)},[]);const c=tr.find(v=>v.id===t);if(!c)return a.jsx("div",{style:{minHeight:"100dvh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",fontFamily:"sans-serif",fontSize:`${1.5*s}rem`},children:""});const d=(v,_)=>v3(v||_),u=d(c.imageUrl,`/cards/${c.id}.png`),h=c.type==="FOLLOWER"?d(c.evolvedImageUrl,`/cards/${c.id}_evolved.png`):null,f=200*s,E=280*s,k=1*s,w="linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #1a1a2e 100%)",$=()=>{r&&(r(t),l(!0),setTimeout(()=>l(!1),1500))};return a.jsxs("div",{style:{minHeight:"100dvh",display:"flex",flexDirection:"column",background:w,color:"white",fontFamily:"sans-serif",overflow:"auto",paddingTop:`${20*s}px`},children:[a.jsx("div",{style:{position:"absolute",top:`${15*s}px`,left:`${15*s}px`,zIndex:100},children:a.jsx("button",{onClick:n,style:{background:"rgba(255, 255, 255, 0.1)",padding:`${8*s}px ${16*s}px`,fontSize:`${.9*s}rem`,border:"1px solid rgba(255, 255, 255, 0.3)",borderRadius:`${6*s}px`,color:"white",cursor:"pointer",fontFamily:"sans-serif",transition:"all 0.2s"},onMouseOver:v=>v.currentTarget.style.background="rgba(255, 255, 255, 0.2)",onMouseOut:v=>v.currentTarget.style.background="rgba(255, 255, 255, 0.1)",children:""})}),a.jsxs("div",{style:{display:"flex",gap:`${2*s}rem`,padding:`${20*s}px ${30*s}px`,flex:1,justifyContent:"center",alignItems:"flex-start",maxWidth:`${1200*s}px`,width:"100%",margin:"0 auto"},children:[a.jsx("div",{style:{display:"flex",flexDirection:"row",alignItems:"flex-start",gap:`${k}rem`,flex:"0 0 auto"},children:c.type==="FOLLOWER"?a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*s}rem`},children:[a.jsx("div",{style:{width:f,height:E,border:"2px solid rgba(255, 255, 255, 0.3)",borderRadius:`${12*s}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.5)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:u,alt:`${c.name} `,style:{width:"100%",height:"100%",objectFit:"cover"}})}),a.jsx("div",{style:{fontSize:`${.75*s}rem`,color:"#aaa",textAlign:"center"},children:""})]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*s}rem`},children:[a.jsx("div",{style:{width:f,height:E,border:"2px solid rgba(255, 215, 0, 0.5)",borderRadius:`${12*s}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(255, 215, 0, 0.3)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:h||u,alt:`${c.name} `,style:{width:"100%",height:"100%",objectFit:"cover"}})}),a.jsx("div",{style:{fontSize:`${.75*s}rem`,color:"#ffd700",textAlign:"center"},children:""})]})]}):a.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*s}rem`},children:a.jsx("div",{style:{width:f,height:E,border:"2px solid rgba(138, 43, 226, 0.5)",borderRadius:`${12*s}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(138, 43, 226, 0.3)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:u,alt:c.name,style:{width:"100%",height:"100%",objectFit:"cover"}})})})}),a.jsxs("div",{style:{flex:"1 1 auto",maxWidth:`${450*s}px`,background:"rgba(0, 0, 0, 0.5)",padding:`${25*s}px`,borderRadius:`${12*s}px`,border:"1px solid rgba(255, 255, 255, 0.2)",display:"flex",flexDirection:"column",gap:`${18*s}px`,minHeight:`${450*s}px`,maxHeight:`${550*s}px`,overflowY:"auto"},children:[a.jsx("h2",{style:{fontSize:`${1.8*s}rem`,fontWeight:"bold",margin:0,color:"#fff",textAlign:"left"},children:c.name}),a.jsxs("div",{style:{display:"flex",gap:`${20*s}px`,fontSize:`${1.2*s}rem`,flexWrap:"wrap"},children:[a.jsxs("div",{style:{color:"#ffd700"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:c.cost})]}),c.type==="FOLLOWER"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{color:"#ff6b6b"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:c.attack})]}),a.jsxs("div",{style:{color:"#4ecdc4"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:c.health})]})]})]}),a.jsx("div",{style:{height:"1px",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)"}}),a.jsxs("div",{children:[a.jsx("h3",{style:{fontSize:`${1.1*s}rem`,margin:`0 0 ${8*s}px 0`,color:"#aaa"},children:""}),a.jsx("p",{style:{fontSize:`${1*s}rem`,margin:0,whiteSpace:"pre-wrap",lineHeight:1.7,color:"#fff"},children:c.description})]}),c.flavorText&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{height:"1px",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)"}}),a.jsxs("div",{children:[a.jsx("h3",{style:{fontSize:`${1.1*s}rem`,margin:`0 0 ${8*s}px 0`,color:"#aaa"},children:""}),a.jsx("p",{style:{fontSize:`${.95*s}rem`,margin:0,fontStyle:"italic",opacity:.7,lineHeight:1.7,whiteSpace:"pre-wrap",color:"#ccc"},children:c.flavorText})]})]}),a.jsxs("div",{style:{display:"flex",gap:`${12*s}px`,flexWrap:"wrap",marginTop:`${10*s}px`},children:[a.jsx("button",{onClick:$,disabled:o,style:{padding:`${.9*s}rem ${1.8*s}rem`,background:o?"#10b981":"#3b82f6",color:"white",border:"none",borderRadius:`${8*s}px`,fontSize:`${1*s}rem`,fontWeight:"bold",fontFamily:"sans-serif",cursor:o?"default":"pointer",transition:"all 0.2s",boxShadow:o?"0 4px 15px rgba(16, 185, 129, 0.3)":"0 4px 15px rgba(59, 130, 246, 0.3)",flex:1},onMouseOver:v=>{o||(v.currentTarget.style.background="#2563eb",v.currentTarget.style.transform="translateY(-2px)",v.currentTarget.style.boxShadow="0 6px 20px rgba(59, 130, 246, 0.4)")},onMouseOut:v=>{o||(v.currentTarget.style.background="#3b82f6",v.currentTarget.style.transform="translateY(0)",v.currentTarget.style.boxShadow="0 4px 15px rgba(59, 130, 246, 0.3)")},children:o?" ":""}),c.relatedCards&&c.relatedCards.length>0&&a.jsxs("button",{onClick:()=>e(t),style:{padding:`${.9*s}rem ${1.8*s}rem`,background:"#4ade80",color:"white",border:"none",borderRadius:`${8*s}px`,fontSize:`${1*s}rem`,fontWeight:"bold",fontFamily:"sans-serif",cursor:"pointer",transition:"all 0.2s",boxShadow:"0 4px 15px rgba(74, 222, 128, 0.3)",flex:1},onMouseOver:v=>{v.currentTarget.style.background="#22c55e",v.currentTarget.style.transform="translateY(-2px)",v.currentTarget.style.boxShadow="0 6px 20px rgba(74, 222, 128, 0.4)"},onMouseOut:v=>{v.currentTarget.style.background="#4ade80",v.currentTarget.style.transform="translateY(0)",v.currentTarget.style.boxShadow="0 4px 15px rgba(74, 222, 128, 0.3)"},children:[" (",c.relatedCards.length,")"]})]})]})]})]})},E3=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},S3=1280,I3=720,T3=({parentCardId:t,relatedCardIds:e,onBack:n})=>{const[r,s]=L.useState(1),[i,o]=L.useState(0);L.useEffect(()=>{const S=()=>{const p=window.innerWidth/S3,D=window.innerHeight/I3;s(Math.min(p,D))};return S(),window.addEventListener("resize",S),()=>window.removeEventListener("resize",S)},[]);const l=e[i],c=tr.find(S=>S.id===l),d=()=>{o(S=>S>0?S-1:e.length-1)},u=()=>{o(S=>S<e.length-1?S+1:0)};if(!c)return a.jsx("div",{style:{minHeight:"100dvh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",fontFamily:"Tamanegi, sans-serif",fontSize:`${1.5*r}rem`},children:""});const h=(S,p)=>E3(S||p),f=h(c.imageUrl,`/cards/${c.id}.png`),E=c.type==="FOLLOWER"?h(c.evolvedImageUrl,`/cards/${c.id}_evolved.png`):null,k=200*r,w=280*r,$=2*r,v="linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #1a1a2e 100%)",_={fontSize:`${3*r}rem`,background:"rgba(0, 0, 0, 0.5)",padding:`${1*r}rem`,borderRadius:`${8*r}px`,cursor:"pointer",border:"1px solid rgba(255, 255, 255, 0.2)",color:"white",transition:"all 0.2s",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",width:`${60*r}px`,height:`${60*r}px`};return a.jsxs("div",{style:{minHeight:"100dvh",display:"flex",flexDirection:"column",background:v,color:"white",fontFamily:"Tamanegi, sans-serif",overflow:"auto",paddingBottom:`${40*r}px`},children:[a.jsxs("div",{style:{position:"sticky",top:0,left:0,padding:`${20*r}px`,zIndex:100,background:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(10px)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[a.jsx("button",{onClick:n,style:{background:"rgba(255, 255, 255, 0.1)",padding:`${10*r}px ${20*r}px`,fontSize:`${1*r}rem`,border:"1px solid rgba(255, 255, 255, 0.3)",borderRadius:`${8*r}px`,color:"white",cursor:"pointer",fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s"},onMouseOver:S=>S.currentTarget.style.background="rgba(255, 255, 255, 0.2)",onMouseOut:S=>S.currentTarget.style.background="rgba(255, 255, 255, 0.1)",children:""}),a.jsxs("div",{style:{fontSize:`${1.2*r}rem`,opacity:.8,fontWeight:"bold"},children:[i+1," / ",e.length]})]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${30*r}px`,padding:`${20*r}px`,flex:1},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:`${20*r}px`,flexWrap:"wrap"},children:[a.jsx("button",{onClick:d,style:_,onMouseOver:S=>S.currentTarget.style.background="rgba(0, 0, 0, 0.7)",onMouseOut:S=>S.currentTarget.style.background="rgba(0, 0, 0, 0.5)",children:"<"}),a.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:`${$}rem`,flexWrap:"wrap"},children:c.type==="FOLLOWER"?a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{width:k,height:w,border:"2px solid rgba(255, 255, 255, 0.3)",borderRadius:`${12*r}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.5)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:f,alt:`${c.name} `,style:{width:"100%",height:"100%",objectFit:"cover"}})}),a.jsx("div",{style:{width:k,height:w,border:"2px solid rgba(255, 215, 0, 0.5)",borderRadius:`${12*r}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(255, 215, 0, 0.3)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:E||f,alt:`${c.name} `,style:{width:"100%",height:"100%",objectFit:"cover"}})})]}):a.jsx("div",{style:{width:k,height:w,border:"2px solid rgba(138, 43, 226, 0.5)",borderRadius:`${12*r}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(138, 43, 226, 0.3)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:f,alt:c.name,style:{width:"100%",height:"100%",objectFit:"cover"}})})}),a.jsx("button",{onClick:u,style:_,onMouseOver:S=>S.currentTarget.style.background="rgba(0, 0, 0, 0.7)",onMouseOut:S=>S.currentTarget.style.background="rgba(0, 0, 0, 0.5)",children:">"})]}),a.jsxs("div",{style:{maxWidth:`${600*r}px`,width:"90%",background:"rgba(0, 0, 0, 0.5)",padding:`${25*r}px`,borderRadius:`${12*r}px`,border:"1px solid rgba(255, 255, 255, 0.2)",display:"flex",flexDirection:"column",gap:`${15*r}px`},children:[a.jsx("h2",{style:{fontSize:`${1.8*r}rem`,fontWeight:"bold",margin:0,color:"#fff",textAlign:"center"},children:c.name}),a.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:`${20*r}px`,fontSize:`${1.2*r}rem`,flexWrap:"wrap"},children:[a.jsxs("div",{style:{color:"#ffd700"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:c.cost})]}),c.type==="FOLLOWER"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{color:"#ff6b6b"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:c.attack})]}),a.jsxs("div",{style:{color:"#4ecdc4"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:c.health})]})]})]}),a.jsx("div",{style:{height:"1px",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)"}}),a.jsxs("div",{children:[a.jsx("h3",{style:{fontSize:`${1.1*r}rem`,margin:`0 0 ${8*r}px 0`,color:"#aaa"},children:""}),a.jsx("p",{style:{fontSize:`${1*r}rem`,margin:0,whiteSpace:"pre-wrap",lineHeight:1.6,color:"#fff"},children:c.description})]}),c.flavorText&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{height:"1px",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)"}}),a.jsxs("div",{children:[a.jsx("h3",{style:{fontSize:`${1.1*r}rem`,margin:`0 0 ${8*r}px 0`,color:"#aaa"},children:""}),a.jsx("p",{style:{fontSize:`${.9*r}rem`,margin:0,fontStyle:"italic",opacity:.7,lineHeight:1.6,whiteSpace:"pre-wrap",color:"#ccc"},children:c.flavorText})]})]})]})]})]})},w3=async()=>(await uP(tc)).user,C3=async(t,e)=>(await vP(tc,t,e)).user,k3=async(t,e)=>{const n=tc.currentUser;if(!n)throw new Error("No user logged in");const r=zi.credential(t,e);return(await mP(n,r)).user},R3=async()=>{await EP(tc)},A3=t=>bP(tc,t),L_=1280,D_=720,P3=({onRegisterSuccess:t,onBack:e})=>{const[n,r]=L.useState(""),[s,i]=L.useState(""),[o,l]=L.useState(""),[c,d]=L.useState(""),[u,h]=L.useState(!1),[f,E]=L.useState(1);L.useEffect(()=>{const _=()=>{const S=window.innerWidth/L_,p=window.innerHeight/D_;E(Math.min(S,p))};return _(),window.addEventListener("resize",_),()=>window.removeEventListener("resize",_)},[]);const k=_=>/^[a-zA-Z0-9_]{3,20}$/.test(_),w=_=>`${_}@tenfubu-game.local`,$=async()=>{if(d(""),!n||!s||!o){d("");return}if(!k(n)){d("ID3-20");return}if(s.length<6){d("6");return}if(s!==o){d("");return}h(!0);try{const _=w(n);await k3(_,s),t()}catch(_){console.error("Registration error:",_),console.error("Error code:",_==null?void 0:_.code),console.error("Error message:",_==null?void 0:_.message);const S=(_==null?void 0:_.code)||"";d(S==="auth/email-already-in-use"?"ID":S==="auth/invalid-email"?"ID":S==="auth/weak-password"?"6":S==="auth/requires-recent-login"?"":S==="auth/provider-already-linked"?"ID":S==="auth/credential-already-in-use"?"ID":` (${S||"unknown error"})`)}finally{h(!1)}},v=_=>{_.key==="Enter"&&!u&&$()};return a.jsx("div",{style:{width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",overflow:"hidden"},children:a.jsxs("div",{style:{width:L_*f,height:D_*f,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative"},children:[a.jsx("h1",{style:{fontSize:48*f,fontWeight:"bold",color:"#fff",marginBottom:40*f,textShadow:"0 4px 8px rgba(0,0,0,0.5)"},children:""}),a.jsxs("div",{style:{width:400*f,display:"flex",flexDirection:"column",gap:20*f},children:[a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*f,color:"#fff",marginBottom:8*f,fontWeight:"bold"},children:"ID"}),a.jsx("input",{type:"text",value:n,onChange:_=>r(_.target.value),onKeyPress:v,placeholder:"player123",disabled:u,style:{width:"100%",padding:`${12*f}px ${16*f}px`,fontSize:16*f,borderRadius:8*f,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:_=>_.currentTarget.style.borderColor="#4a9eff",onBlur:_=>_.currentTarget.style.borderColor="#444"}),a.jsx("p",{style:{fontSize:12*f,color:"#888",marginTop:4*f,marginBottom:0},children:"3-20"})]}),a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*f,color:"#fff",marginBottom:8*f,fontWeight:"bold"},children:"6"}),a.jsx("input",{type:"password",value:s,onChange:_=>i(_.target.value),onKeyPress:v,placeholder:"",disabled:u,style:{width:"100%",padding:`${12*f}px ${16*f}px`,fontSize:16*f,borderRadius:8*f,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:_=>_.currentTarget.style.borderColor="#4a9eff",onBlur:_=>_.currentTarget.style.borderColor="#444"})]}),a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*f,color:"#fff",marginBottom:8*f,fontWeight:"bold"},children:""}),a.jsx("input",{type:"password",value:o,onChange:_=>l(_.target.value),onKeyPress:v,placeholder:"",disabled:u,style:{width:"100%",padding:`${12*f}px ${16*f}px`,fontSize:16*f,borderRadius:8*f,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:_=>_.currentTarget.style.borderColor="#4a9eff",onBlur:_=>_.currentTarget.style.borderColor="#444"})]}),c&&a.jsx("div",{style:{padding:`${12*f}px ${16*f}px`,borderRadius:8*f,background:"rgba(255, 80, 80, 0.2)",border:"2px solid #ff5050",color:"#ff5050",fontSize:14*f,textAlign:"center"},children:c}),a.jsxs("div",{style:{display:"flex",gap:16*f,marginTop:20*f},children:[a.jsx("button",{onClick:e,disabled:u,style:{flex:1,padding:`${16*f}px ${32*f}px`,fontSize:18*f,fontWeight:"bold",borderRadius:8*f,border:"none",background:"#555",color:"#fff",cursor:u?"not-allowed":"pointer",transition:"all 0.3s",opacity:u?.5:1},onMouseEnter:_=>!u&&(_.currentTarget.style.background="#666"),onMouseLeave:_=>!u&&(_.currentTarget.style.background="#555"),children:""}),a.jsx("button",{onClick:$,disabled:u,style:{flex:1,padding:`${16*f}px ${32*f}px`,fontSize:18*f,fontWeight:"bold",borderRadius:8*f,border:"none",background:u?"#555":"linear-gradient(135deg, #4a9eff 0%, #357abd 100%)",color:"#fff",cursor:u?"not-allowed":"pointer",transition:"all 0.3s",boxShadow:u?"none":"0 4px 8px rgba(0,0,0,0.3)"},onMouseEnter:_=>!u&&(_.currentTarget.style.transform="scale(1.05)"),onMouseLeave:_=>!u&&(_.currentTarget.style.transform="scale(1)"),children:u?"...":""})]}),a.jsxs("div",{style:{marginTop:20*f,padding:`${12*f}px ${16*f}px`,borderRadius:8*f,background:"rgba(74, 158, 255, 0.1)",border:"1px solid rgba(74, 158, 255, 0.3)",fontSize:13*f,color:"#aaa",textAlign:"center",lineHeight:1.6},children:["ID",a.jsx("br",{}),""]})]})]})})},M_=1280,N_=720,O3=({onLoginSuccess:t,onBack:e})=>{const[n,r]=L.useState(""),[s,i]=L.useState(""),[o,l]=L.useState(""),[c,d]=L.useState(!1),[u,h]=L.useState(1);L.useEffect(()=>{const w=()=>{const $=window.innerWidth/M_,v=window.innerHeight/N_;h(Math.min($,v))};return w(),window.addEventListener("resize",w),()=>window.removeEventListener("resize",w)},[]);const f=w=>`${w}@tenfubu-game.local`,E=async()=>{if(l(""),!n||!s){l("ID");return}d(!0);try{const w=f(n);await C3(w,s),t()}catch(w){const $=(w==null?void 0:w.code)||"";l($==="auth/user-not-found"?"":$==="auth/wrong-password"?"":$==="auth/invalid-email"?"ID":$==="auth/invalid-credential"?"ID":"")}finally{d(!1)}},k=w=>{w.key==="Enter"&&!c&&E()};return a.jsx("div",{style:{width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",overflow:"hidden"},children:a.jsxs("div",{style:{width:M_*u,height:N_*u,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative"},children:[a.jsx("h1",{style:{fontSize:48*u,fontWeight:"bold",color:"#fff",marginBottom:40*u,textShadow:"0 4px 8px rgba(0,0,0,0.5)"},children:""}),a.jsxs("div",{style:{width:400*u,display:"flex",flexDirection:"column",gap:20*u},children:[a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*u,color:"#fff",marginBottom:8*u,fontWeight:"bold"},children:"ID"}),a.jsx("input",{type:"text",value:n,onChange:w=>r(w.target.value),onKeyPress:k,placeholder:"player123",disabled:c,style:{width:"100%",padding:`${12*u}px ${16*u}px`,fontSize:16*u,borderRadius:8*u,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:w=>w.currentTarget.style.borderColor="#4a9eff",onBlur:w=>w.currentTarget.style.borderColor="#444"})]}),a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*u,color:"#fff",marginBottom:8*u,fontWeight:"bold"},children:""}),a.jsx("input",{type:"password",value:s,onChange:w=>i(w.target.value),onKeyPress:k,placeholder:"",disabled:c,style:{width:"100%",padding:`${12*u}px ${16*u}px`,fontSize:16*u,borderRadius:8*u,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:w=>w.currentTarget.style.borderColor="#4a9eff",onBlur:w=>w.currentTarget.style.borderColor="#444"})]}),o&&a.jsx("div",{style:{padding:`${12*u}px ${16*u}px`,borderRadius:8*u,background:"rgba(255, 80, 80, 0.2)",border:"2px solid #ff5050",color:"#ff5050",fontSize:14*u,textAlign:"center"},children:o}),a.jsxs("div",{style:{display:"flex",gap:16*u,marginTop:20*u},children:[a.jsx("button",{onClick:e,disabled:c,style:{flex:1,padding:`${16*u}px ${32*u}px`,fontSize:18*u,fontWeight:"bold",borderRadius:8*u,border:"none",background:"#555",color:"#fff",cursor:c?"not-allowed":"pointer",transition:"all 0.3s",opacity:c?.5:1},onMouseEnter:w=>!c&&(w.currentTarget.style.background="#666"),onMouseLeave:w=>!c&&(w.currentTarget.style.background="#555"),children:""}),a.jsx("button",{onClick:E,disabled:c,style:{flex:1,padding:`${16*u}px ${32*u}px`,fontSize:18*u,fontWeight:"bold",borderRadius:8*u,border:"none",background:c?"#555":"linear-gradient(135deg, #4a9eff 0%, #357abd 100%)",color:"#fff",cursor:c?"not-allowed":"pointer",transition:"all 0.3s",boxShadow:c?"none":"0 4px 8px rgba(0,0,0,0.3)"},onMouseEnter:w=>!c&&(w.currentTarget.style.transform="scale(1.05)"),onMouseLeave:w=>!c&&(w.currentTarget.style.transform="scale(1)"),children:c?"...":""})]}),a.jsx("div",{style:{marginTop:20*u,padding:`${12*u}px ${16*u}px`,borderRadius:8*u,background:"rgba(255, 200, 80, 0.1)",border:"1px solid rgba(255, 200, 80, 0.3)",fontSize:13*u,color:"#ffcc80",textAlign:"center",lineHeight:1.6},children:" "})]})]})})},j_=1280,$_=720,L3=({playerId:t,currentPlayerName:e,onUpdateSuccess:n,onBack:r})=>{const[s,i]=L.useState(e),[o,l]=L.useState(""),[c,d]=L.useState(!1),[u,h]=L.useState(!1),[f,E]=L.useState(1);L.useEffect(()=>{const $=()=>{const v=window.innerWidth/j_,_=window.innerHeight/$_;E(Math.min(v,_))};return $(),window.addEventListener("resize",$),()=>window.removeEventListener("resize",$)},[]);const k=async()=>{if(l(""),h(!1),!s.trim()){l("");return}if(s.length>20){l("20");return}if(!t){l("ID");return}d(!0);try{await zO(t,s.trim()),h(!0),setTimeout(()=>{n(s.trim())},1e3)}catch($){console.error("Failed to update player name:",$),l("")}finally{d(!1)}},w=$=>{$.key==="Enter"&&!c&&k()};return a.jsx("div",{style:{width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",overflow:"hidden"},children:a.jsxs("div",{style:{width:j_*f,height:$_*f,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative"},children:[a.jsx("h1",{style:{fontSize:48*f,fontWeight:"bold",color:"#fff",marginBottom:40*f,textShadow:"0 4px 8px rgba(0,0,0,0.5)"},children:""}),a.jsxs("div",{style:{width:400*f,display:"flex",flexDirection:"column",gap:20*f},children:[a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*f,color:"#fff",marginBottom:8*f,fontWeight:"bold"},children:""}),a.jsx("input",{type:"text",value:s,onChange:$=>i($.target.value),onKeyPress:w,placeholder:"",disabled:c,maxLength:20,style:{width:"100%",padding:`${12*f}px ${16*f}px`,fontSize:16*f,borderRadius:8*f,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:$=>$.currentTarget.style.borderColor="#4a9eff",onBlur:$=>$.currentTarget.style.borderColor="#444"}),a.jsx("p",{style:{fontSize:12*f,color:"#888",marginTop:4*f,marginBottom:0},children:"20"})]}),o&&a.jsx("div",{style:{padding:`${12*f}px ${16*f}px`,borderRadius:8*f,background:"rgba(255, 80, 80, 0.2)",border:"2px solid #ff5050",color:"#ff5050",fontSize:14*f,textAlign:"center"},children:o}),u&&a.jsx("div",{style:{padding:`${12*f}px ${16*f}px`,borderRadius:8*f,background:"rgba(80, 255, 120, 0.2)",border:"2px solid #50ff78",color:"#50ff78",fontSize:14*f,textAlign:"center"},children:" "}),a.jsxs("div",{style:{display:"flex",gap:16*f,marginTop:20*f},children:[a.jsx("button",{onClick:r,disabled:c,style:{flex:1,padding:`${16*f}px ${32*f}px`,fontSize:18*f,fontWeight:"bold",borderRadius:8*f,border:"none",background:"#555",color:"#fff",cursor:c?"not-allowed":"pointer",transition:"all 0.3s",opacity:c?.5:1},onMouseEnter:$=>!c&&($.currentTarget.style.background="#666"),onMouseLeave:$=>!c&&($.currentTarget.style.background="#555"),children:""}),a.jsx("button",{onClick:k,disabled:c,style:{flex:1,padding:`${16*f}px ${32*f}px`,fontSize:18*f,fontWeight:"bold",borderRadius:8*f,border:"none",background:c?"#555":"linear-gradient(135deg, #4a9eff 0%, #357abd 100%)",color:"#fff",cursor:c?"not-allowed":"pointer",transition:"all 0.3s",boxShadow:c?"none":"0 4px 8px rgba(0,0,0,0.3)"},onMouseEnter:$=>!c&&($.currentTarget.style.transform="scale(1.05)"),onMouseLeave:$=>!c&&($.currentTarget.style.transform="scale(1)"),children:c?"...":""})]})]})]})})},D3=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},M3=D3("/bgm/tenfubu.mp3"),qc={bgm:.3,se:.5,voice:.5,bgmEnabled:!0,seEnabled:!0},N3=()=>{try{const t=localStorage.getItem("audioSettings");if(t){const e=JSON.parse(t);if(e.enabled!==void 0){const{enabled:n,...r}=e;return{...qc,...r,bgmEnabled:n,seEnabled:n}}return{...qc,...e}}return qc}catch{return qc}},j3=()=>{const[t,e]=L.useState(!1);return L.useEffect(()=>{const n=()=>{const r="ontouchstart"in window||navigator.maxTouchPoints>0,s=window.innerHeight>window.innerWidth;e(r&&s)};return n(),window.addEventListener("resize",n),window.addEventListener("orientationchange",n),()=>{window.removeEventListener("resize",n),window.removeEventListener("orientationchange",n)}},[]),t};function $3(){const[t,e]=L.useState("TITLE"),[n,r]=L.useState("SENKA"),[s,i]=L.useState("CPU"),[o,l]=L.useState(""),[c,d]=L.useState(void 0),[u,h]=L.useState("NORMAL"),[f,E]=L.useState(null),[k,w]=L.useState(!0),[$,v]=L.useState(null),[_,S]=L.useState(null),[p,D]=L.useState(!0),[H,ne]=L.useState(()=>{const Ee=localStorage.getItem("timerEnabled");return Ee!==null?JSON.parse(Ee):!0}),[V,ee]=L.useState(()=>localStorage.getItem("playerName")||""),[de,ve]=L.useState(void 0),[je,ue]=L.useState(void 0),I=j3(),O=L.useRef(null),[C,R]=L.useState(!1),[y,g]=L.useState(N3),[T,A]=L.useState(null),[M,Q]=L.useState(null),[U,ge]=L.useState([]),[z,Te]=L.useState(()=>localStorage.getItem("homeCardId")),te=Ee=>Ee&&Ee.endsWith("@tenfubu-game.local")?Ee.replace("@tenfubu-game.local",""):null;L.useEffect(()=>{const Ee=A3(async nt=>{if(console.log(" Auth state changed:",{uid:nt==null?void 0:nt.uid,email:nt==null?void 0:nt.email,isAnonymous:nt==null?void 0:nt.isAnonymous}),nt){E(nt.uid),w(nt.isAnonymous),v(nt.email),S(te(nt.email));const Un=te(nt.email);console.log(" State updated:",{playerId:nt.uid,isAnonymous:nt.isAnonymous,userId:Un});try{await u_(nt.uid,Un||"anonymous",V||"")}catch(aa){console.error("Failed to create player data:",aa)}}else try{const Un=await w3();E(Un.uid),w(!0),v(null),S(null),await u_(Un.uid,"anonymous",V||"")}catch(Un){console.error("Failed to sign in:",Un)}D(!1)});return()=>Ee()},[]),L.useEffect(()=>{localStorage.setItem("audioSettings",JSON.stringify(y))},[y]);const X=L.useCallback(Ee=>{g(nt=>({...nt,...Ee}))},[]),Pe=L.useCallback((Ee,nt)=>{O.current=Ee,R(!0),nt&&d(nt),e("GAME")},[]),we=L.useCallback((Ee,nt,Un,aa,rc)=>{O.current=Ee,R(!0),d(nt),ve(aa),ue(rc),e("GAME")},[]),We=L.useCallback(Ee=>{O.current&&(O.current.disconnect(),O.current=null),R(!1),d(void 0),ve(void 0),ue(void 0),r(Ee),e("MATCHMAKING")},[]),be=L.useRef(null),Me=L.useRef(!1);L.useEffect(()=>{const Ee=new Audio(M3);return Ee.loop=!0,Ee.volume=y.bgmEnabled?y.bgm:0,be.current=Ee,Me.current=!0,()=>{Ee.pause(),Ee.src=""}},[]),L.useEffect(()=>{const Ee=be.current;!Ee||!Me.current||(Ee.volume=y.bgmEnabled?y.bgm:0,y.bgmEnabled?Ee.paused&&(t==="TITLE"||t==="CLASS_SELECT")&&Ee.play().catch(()=>{}):Ee.pause())},[y.bgm,y.bgmEnabled,t]),L.useEffect(()=>{const Ee=be.current;Ee&&(t==="TITLE"||t==="CLASS_SELECT"||t==="LOBBY"?Ee.paused&&y.bgmEnabled&&Ee.play().catch(()=>{}):(Ee.pause(),Ee.currentTime=0))},[t,y.bgmEnabled]),L.useEffect(()=>{const Ee=()=>{const nt=be.current;nt&&nt.paused&&y.bgmEnabled&&(t==="TITLE"||t==="CLASS_SELECT"||t==="LOBBY")&&nt.play().catch(()=>{})};return document.addEventListener("click",Ee),()=>document.removeEventListener("click",Ee)},[t,y.bgmEnabled]);const yt=L.useCallback((Ee,nt)=>{i(Ee),nt&&l(nt),e("CLASS_SELECT")},[]),rt=L.useCallback(Ee=>{r(Ee),e(s==="CPU"?"GAME":s==="CASUAL_MATCH"||s==="RANKED_MATCH"?"MATCHMAKING":"LOBBY")},[s]),tt=L.useCallback(()=>{O.current&&(O.current.disconnect(),O.current=null),R(!1),e("TITLE"),l(""),i("CPU"),d(void 0),ve(void 0),ue(void 0),A(null),Q(null),ge([])},[]),qe=L.useCallback(Ee=>{A(Ee),e("GALLERY_CARD_LIST")},[]),Ne=L.useCallback(Ee=>{Q(Ee),e("GALLERY_CARD_DETAIL")},[]),st=L.useCallback(Ee=>{const nt=tr.find(Un=>Un.id===Ee);nt&&nt.relatedCards&&nt.relatedCards.length>0&&(Q(Ee),ge(nt.relatedCards),e("GALLERY_RELATED_CARD"))},[]),vt=L.useCallback(()=>{Q(null),e("GALLERY_CARD_LIST")},[]),Ot=L.useCallback(()=>{ge([]),e("GALLERY_CARD_DETAIL")},[]),Ve=L.useCallback(Ee=>{Te(Ee),localStorage.setItem("homeCardId",Ee)},[]),qt=L.useCallback(()=>{e("REGISTER")},[]),ft=L.useCallback(()=>{e("LOGIN")},[]),on=L.useCallback(()=>{e("TITLE")},[]),zt=L.useCallback(()=>{e("TITLE")},[]),us=L.useCallback(async()=>{try{await R3(),e("TITLE")}catch(Ee){console.error("Failed to logout:",Ee)}},[]),ia=L.useCallback(()=>{e("TITLE")},[]),oa=L.useCallback(()=>{e("TITLE")},[]),Ir=L.useCallback(()=>{e("PROFILE")},[]),nc=L.useCallback(Ee=>{ee(Ee),localStorage.setItem("playerName",Ee),e("TITLE")},[]),sf=L.useCallback(()=>{e("TITLE")},[]);return p?a.jsx("div",{style:{width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",color:"white",fontSize:"1.5rem",fontWeight:"bold"},children:"Loading..."}):a.jsxs("div",{className:"app-container",children:[I&&a.jsxs("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100dvh",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:99999,color:"white",textAlign:"center",padding:20},children:[a.jsx("div",{style:{fontSize:"4rem",marginBottom:20,animation:"rotatePhone 2s ease-in-out infinite"},children:""}),a.jsx("h2",{style:{fontSize:"1.5rem",fontWeight:"bold",marginBottom:10,textShadow:"0 2px 4px rgba(0,0,0,0.5)"},children:""}),a.jsx("p",{style:{fontSize:"1rem",opacity:.8,maxWidth:280},children:""}),a.jsx("style",{children:`
                        @keyframes rotatePhone {
                            0%, 100% { transform: rotate(0deg); }
                            25% { transform: rotate(-30deg); }
                            75% { transform: rotate(30deg); }
                        }
                    `})]}),t==="TITLE"&&a.jsx(f2,{onStartConfig:yt,audioSettings:y,onAudioSettingsChange:X,playerId:f,onGalleryClassSelect:qe,isAnonymous:k,userId:_,onNavigateToRegister:qt,onNavigateToLogin:ft,onNavigateToProfile:Ir,onLogout:us}),t==="CLASS_SELECT"&&a.jsx(XO,{onSelectClass:rt,onBack:tt,gameMode:s,aiDifficulty:u,onDifficultyChange:h,playerName:V,onPlayerNameChange:Ee=>{ee(Ee),localStorage.setItem("playerName",Ee)},timerEnabled:H,onTimerEnabledChange:Ee=>{ne(Ee),localStorage.setItem("timerEnabled",JSON.stringify(Ee))},playerId:f}),t==="LOBBY"&&a.jsx(_L,{gameMode:s,targetRoomId:o,playerClass:n,onGameStart:Pe,onBack:tt}),t==="MATCHMAKING"&&a.jsx(SL,{matchType:s==="CASUAL_MATCH"?"casual":"ranked",playerClass:n,playerName:V||"",playerId:f,onGameStart:we,onCancel:tt}),t==="GAME"&&a.jsx(l3,{playerClass:n,opponentType:s==="CPU"?"CPU":"ONLINE",gameMode:s,targetRoomId:o,onLeave:tt,onRematching:We,networkAdapter:O.current,networkConnected:C,opponentClass:c,aiDifficulty:u,playerName:V||"",timerEnabled:s==="CASUAL_MATCH"||s==="RANKED_MATCH"?!0:H,playerId:f,opponentPlayerId:de,opponentRating:je}),t==="GALLERY_CARD_LIST"&&T&&a.jsx(y3,{classType:T,onSelectCard:Ne}),t==="GALLERY_CARD_DETAIL"&&M&&a.jsx(b3,{cardId:M,onOpenRelatedCard:st,onBack:vt,onSetHomeCard:Ve}),t==="GALLERY_RELATED_CARD"&&M&&a.jsx(T3,{parentCardId:M,relatedCardIds:U,onBack:Ot}),t==="REGISTER"&&a.jsx(P3,{onRegisterSuccess:on,onBack:ia}),t==="LOGIN"&&a.jsx(O3,{onLoginSuccess:zt,onBack:oa}),t==="PROFILE"&&a.jsx(L3,{playerId:f,currentPlayerName:V,onUpdateSuccess:nc,onBack:sf})]})}kh.createRoot(document.getElementById("root")).render(a.jsx($3,{}));
