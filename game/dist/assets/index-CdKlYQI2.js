var lI=Object.defineProperty;var cI=t=>{throw TypeError(t)};var uI=(t,e,n)=>e in t?lI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var nn=(t,e,n)=>uI(t,typeof e!="symbol"?e+"":e,n);var ca=(t,e,n)=>e.has(t)?cI("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n);function dI(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in t)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function y_(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var v_={exports:{}},rd={},__={exports:{}},at={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Il=Symbol.for("react.element"),fI=Symbol.for("react.portal"),hI=Symbol.for("react.fragment"),pI=Symbol.for("react.strict_mode"),gI=Symbol.for("react.profiler"),mI=Symbol.for("react.provider"),yI=Symbol.for("react.context"),vI=Symbol.for("react.forward_ref"),_I=Symbol.for("react.suspense"),xI=Symbol.for("react.memo"),EI=Symbol.for("react.lazy"),Rm=Symbol.iterator;function bI(t){return t===null||typeof t!="object"?null:(t=Rm&&t[Rm]||t["@@iterator"],typeof t=="function"?t:null)}var x_={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},E_=Object.assign,b_={};function Uo(t,e,n){this.props=t,this.context=e,this.refs=b_,this.updater=n||x_}Uo.prototype.isReactComponent={};Uo.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Uo.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function S_(){}S_.prototype=Uo.prototype;function Fp(t,e,n){this.props=t,this.context=e,this.refs=b_,this.updater=n||x_}var Up=Fp.prototype=new S_;Up.constructor=Fp;E_(Up,Uo.prototype);Up.isPureReactComponent=!0;var Pm=Array.isArray,I_=Object.prototype.hasOwnProperty,Bp={current:null},T_={key:!0,ref:!0,__self:!0,__source:!0};function C_(t,e,n){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)I_.call(e,r)&&!T_.hasOwnProperty(r)&&(s[r]=e[r]);var a=arguments.length-2;if(a===1)s.children=n;else if(1<a){for(var c=Array(a),u=0;u<a;u++)c[u]=arguments[u+2];s.children=c}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)s[r]===void 0&&(s[r]=a[r]);return{$$typeof:Il,type:t,key:i,ref:o,props:s,_owner:Bp.current}}function SI(t,e){return{$$typeof:Il,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function zp(t){return typeof t=="object"&&t!==null&&t.$$typeof===Il}function II(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Om=/\/+/g;function Sf(t,e){return typeof t=="object"&&t!==null&&t.key!=null?II(""+t.key):e.toString(36)}function Nc(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Il:case fI:o=!0}}if(o)return o=t,s=s(o),t=r===""?"."+Sf(o,0):r,Pm(s)?(n="",t!=null&&(n=t.replace(Om,"$&/")+"/"),Nc(s,e,n,"",function(u){return u})):s!=null&&(zp(s)&&(s=SI(s,n+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(Om,"$&/")+"/")+t)),e.push(s)),1;if(o=0,r=r===""?".":r+":",Pm(t))for(var a=0;a<t.length;a++){i=t[a];var c=r+Sf(i,a);o+=Nc(i,e,n,c,s)}else if(c=bI(t),typeof c=="function")for(t=c.call(t),a=0;!(i=t.next()).done;)i=i.value,c=r+Sf(i,a++),o+=Nc(i,e,n,c,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function cc(t,e,n){if(t==null)return t;var r=[],s=0;return Nc(t,r,"","",function(i){return e.call(n,i,s++)}),r}function TI(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var kn={current:null},Mc={transition:null},CI={ReactCurrentDispatcher:kn,ReactCurrentBatchConfig:Mc,ReactCurrentOwner:Bp};function w_(){throw Error("act(...) is not supported in production builds of React.")}at.Children={map:cc,forEach:function(t,e,n){cc(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return cc(t,function(){e++}),e},toArray:function(t){return cc(t,function(e){return e})||[]},only:function(t){if(!zp(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};at.Component=Uo;at.Fragment=hI;at.Profiler=gI;at.PureComponent=Fp;at.StrictMode=pI;at.Suspense=_I;at.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=CI;at.act=w_;at.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=E_({},t.props),s=t.key,i=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=Bp.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(c in e)I_.call(e,c)&&!T_.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){a=Array(c);for(var u=0;u<c;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:Il,type:t.type,key:s,ref:i,props:r,_owner:o}};at.createContext=function(t){return t={$$typeof:yI,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:mI,_context:t},t.Consumer=t};at.createElement=C_;at.createFactory=function(t){var e=C_.bind(null,t);return e.type=t,e};at.createRef=function(){return{current:null}};at.forwardRef=function(t){return{$$typeof:vI,render:t}};at.isValidElement=zp;at.lazy=function(t){return{$$typeof:EI,_payload:{_status:-1,_result:t},_init:TI}};at.memo=function(t,e){return{$$typeof:xI,type:t,compare:e===void 0?null:e}};at.startTransition=function(t){var e=Mc.transition;Mc.transition={};try{t()}finally{Mc.transition=e}};at.unstable_act=w_;at.useCallback=function(t,e){return kn.current.useCallback(t,e)};at.useContext=function(t){return kn.current.useContext(t)};at.useDebugValue=function(){};at.useDeferredValue=function(t){return kn.current.useDeferredValue(t)};at.useEffect=function(t,e){return kn.current.useEffect(t,e)};at.useId=function(){return kn.current.useId()};at.useImperativeHandle=function(t,e,n){return kn.current.useImperativeHandle(t,e,n)};at.useInsertionEffect=function(t,e){return kn.current.useInsertionEffect(t,e)};at.useLayoutEffect=function(t,e){return kn.current.useLayoutEffect(t,e)};at.useMemo=function(t,e){return kn.current.useMemo(t,e)};at.useReducer=function(t,e,n){return kn.current.useReducer(t,e,n)};at.useRef=function(t){return kn.current.useRef(t)};at.useState=function(t){return kn.current.useState(t)};at.useSyncExternalStore=function(t,e,n){return kn.current.useSyncExternalStore(t,e,n)};at.useTransition=function(){return kn.current.useTransition()};at.version="18.3.1";__.exports=at;var F=__.exports;const M=y_(F);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wI=F,kI=Symbol.for("react.element"),AI=Symbol.for("react.fragment"),RI=Object.prototype.hasOwnProperty,PI=wI.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,OI={key:!0,ref:!0,__self:!0,__source:!0};function k_(t,e,n){var r,s={},i=null,o=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)RI.call(e,r)&&!OI.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:kI,type:t,key:i,ref:o,props:s,_owner:PI.current}}rd.Fragment=AI;rd.jsx=k_;rd.jsxs=k_;v_.exports=rd;var l=v_.exports,fh={},A_={exports:{}},Gn={},R_={exports:{}},P_={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(y,g){var I=y.length;y.push(g);e:for(;0<I;){var A=I-1>>>1,L=y[A];if(0<s(L,g))y[A]=g,y[I]=L,I=A;else break e}}function n(y){return y.length===0?null:y[0]}function r(y){if(y.length===0)return null;var g=y[0],I=y.pop();if(I!==g){y[0]=I;e:for(var A=0,L=y.length,j=L>>>1;A<j;){var N=2*(A+1)-1,pe=y[N],we=N+1,ke=y[we];if(0>s(pe,I))we<L&&0>s(ke,pe)?(y[A]=ke,y[we]=I,A=we):(y[A]=pe,y[N]=I,A=N);else if(we<L&&0>s(ke,I))y[A]=ke,y[we]=I,A=we;else break e}}return g}function s(y,g){var I=y.sortIndex-g.sortIndex;return I!==0?I:y.id-g.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var c=[],u=[],d=1,h=null,f=3,E=!1,k=!1,P=!1,G=typeof setTimeout=="function"?setTimeout:null,x=typeof clearTimeout=="function"?clearTimeout:null,S=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(y){for(var g=n(u);g!==null;){if(g.callback===null)r(u);else if(g.startTime<=y)r(u),g.sortIndex=g.expirationTime,e(c,g);else break;g=n(u)}}function p(y){if(P=!1,w(y),!k)if(n(c)!==null)k=!0,T(b);else{var g=n(u);g!==null&&C(p,g.startTime-y)}}function b(y,g){k=!1,P&&(P=!1,x(K),K=-1),E=!0;var I=f;try{for(w(g),h=n(c);h!==null&&(!(h.expirationTime>g)||y&&!me());){var A=h.callback;if(typeof A=="function"){h.callback=null,f=h.priorityLevel;var L=A(h.expirationTime<=g);g=t.unstable_now(),typeof L=="function"?h.callback=L:h===n(c)&&r(c),w(g)}else r(c);h=n(c)}if(h!==null)var j=!0;else{var N=n(u);N!==null&&C(p,N.startTime-g),j=!1}return j}finally{h=null,f=I,E=!1}}var H=!1,re=null,K=-1,Q=5,ce=-1;function me(){return!(t.unstable_now()-ce<Q)}function Se(){if(re!==null){var y=t.unstable_now();ce=y;var g=!0;try{g=re(!0,y)}finally{g?de():(H=!1,re=null)}}else H=!1}var de;if(typeof S=="function")de=function(){S(Se)};else if(typeof MessageChannel<"u"){var B=new MessageChannel,O=B.port2;B.port1.onmessage=Se,de=function(){O.postMessage(null)}}else de=function(){G(Se,0)};function T(y){re=y,H||(H=!0,de())}function C(y,g){K=G(function(){y(t.unstable_now())},g)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(y){y.callback=null},t.unstable_continueExecution=function(){k||E||(k=!0,T(b))},t.unstable_forceFrameRate=function(y){0>y||125<y?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Q=0<y?Math.floor(1e3/y):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(y){switch(f){case 1:case 2:case 3:var g=3;break;default:g=f}var I=f;f=g;try{return y()}finally{f=I}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(y,g){switch(y){case 1:case 2:case 3:case 4:case 5:break;default:y=3}var I=f;f=y;try{return g()}finally{f=I}},t.unstable_scheduleCallback=function(y,g,I){var A=t.unstable_now();switch(typeof I=="object"&&I!==null?(I=I.delay,I=typeof I=="number"&&0<I?A+I:A):I=A,y){case 1:var L=-1;break;case 2:L=250;break;case 5:L=1073741823;break;case 4:L=1e4;break;default:L=5e3}return L=I+L,y={id:d++,callback:g,priorityLevel:y,startTime:I,expirationTime:L,sortIndex:-1},I>A?(y.sortIndex=I,e(u,y),n(c)===null&&y===n(u)&&(P?(x(K),K=-1):P=!0,C(p,I-A))):(y.sortIndex=L,e(c,y),k||E||(k=!0,T(b))),y},t.unstable_shouldYield=me,t.unstable_wrapCallback=function(y){var g=f;return function(){var I=f;f=g;try{return y.apply(this,arguments)}finally{f=I}}}})(P_);R_.exports=P_;var LI=R_.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var DI=F,Hn=LI;function le(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var O_=new Set,Xa={};function Ai(t,e){To(t,e),To(t+"Capture",e)}function To(t,e){for(Xa[t]=e,t=0;t<e.length;t++)O_.add(e[t])}var Qr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),hh=Object.prototype.hasOwnProperty,NI=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Lm={},Dm={};function MI(t){return hh.call(Dm,t)?!0:hh.call(Lm,t)?!1:NI.test(t)?Dm[t]=!0:(Lm[t]=!0,!1)}function jI(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function $I(t,e,n,r){if(e===null||typeof e>"u"||jI(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function An(t,e,n,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var an={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){an[t]=new An(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];an[e]=new An(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){an[t]=new An(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){an[t]=new An(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){an[t]=new An(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){an[t]=new An(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){an[t]=new An(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){an[t]=new An(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){an[t]=new An(t,5,!1,t.toLowerCase(),null,!1,!1)});var Hp=/[\-:]([a-z])/g;function Wp(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Hp,Wp);an[e]=new An(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Hp,Wp);an[e]=new An(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Hp,Wp);an[e]=new An(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){an[t]=new An(t,1,!1,t.toLowerCase(),null,!1,!1)});an.xlinkHref=new An("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){an[t]=new An(t,1,!1,t.toLowerCase(),null,!0,!0)});function Gp(t,e,n,r){var s=an.hasOwnProperty(e)?an[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&($I(e,n,s,r)&&(n=null),r||s===null?MI(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var ss=DI.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,uc=Symbol.for("react.element"),Ji=Symbol.for("react.portal"),qi=Symbol.for("react.fragment"),Vp=Symbol.for("react.strict_mode"),ph=Symbol.for("react.profiler"),L_=Symbol.for("react.provider"),D_=Symbol.for("react.context"),Yp=Symbol.for("react.forward_ref"),gh=Symbol.for("react.suspense"),mh=Symbol.for("react.suspense_list"),Kp=Symbol.for("react.memo"),gs=Symbol.for("react.lazy"),N_=Symbol.for("react.offscreen"),Nm=Symbol.iterator;function ua(t){return t===null||typeof t!="object"?null:(t=Nm&&t[Nm]||t["@@iterator"],typeof t=="function"?t:null)}var jt=Object.assign,If;function Ia(t){if(If===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);If=e&&e[1]||""}return`
`+If+t}var Tf=!1;function Cf(t,e){if(!t||Tf)return"";Tf=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){r=u}t.call(e.prototype)}else{try{throw Error()}catch(u){r=u}t()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var s=u.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,a=i.length-1;1<=o&&0<=a&&s[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||s[o]!==i[a]){var c=`
`+s[o].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=o&&0<=a);break}}}finally{Tf=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Ia(t):""}function FI(t){switch(t.tag){case 5:return Ia(t.type);case 16:return Ia("Lazy");case 13:return Ia("Suspense");case 19:return Ia("SuspenseList");case 0:case 2:case 15:return t=Cf(t.type,!1),t;case 11:return t=Cf(t.type.render,!1),t;case 1:return t=Cf(t.type,!0),t;default:return""}}function yh(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case qi:return"Fragment";case Ji:return"Portal";case ph:return"Profiler";case Vp:return"StrictMode";case gh:return"Suspense";case mh:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case D_:return(t.displayName||"Context")+".Consumer";case L_:return(t._context.displayName||"Context")+".Provider";case Yp:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Kp:return e=t.displayName||null,e!==null?e:yh(t.type)||"Memo";case gs:e=t._payload,t=t._init;try{return yh(t(e))}catch{}}return null}function UI(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return yh(e);case 8:return e===Vp?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Ws(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function M_(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function BI(t){var e=M_(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function dc(t){t._valueTracker||(t._valueTracker=BI(t))}function j_(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=M_(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function ou(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function vh(t,e){var n=e.checked;return jt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Mm(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Ws(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function $_(t,e){e=e.checked,e!=null&&Gp(t,"checked",e,!1)}function _h(t,e){$_(t,e);var n=Ws(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?xh(t,e.type,n):e.hasOwnProperty("defaultValue")&&xh(t,e.type,Ws(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function jm(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function xh(t,e,n){(e!=="number"||ou(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Ta=Array.isArray;function fo(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Ws(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function Eh(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(le(91));return jt({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function $m(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(le(92));if(Ta(n)){if(1<n.length)throw Error(le(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Ws(n)}}function F_(t,e){var n=Ws(e.value),r=Ws(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function Fm(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function U_(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function bh(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?U_(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var fc,B_=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(fc=fc||document.createElement("div"),fc.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=fc.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Qa(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Aa={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},zI=["Webkit","ms","Moz","O"];Object.keys(Aa).forEach(function(t){zI.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Aa[e]=Aa[t]})});function z_(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Aa.hasOwnProperty(t)&&Aa[t]?(""+e).trim():e+"px"}function H_(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=z_(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var HI=jt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Sh(t,e){if(e){if(HI[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(le(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(le(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(le(61))}if(e.style!=null&&typeof e.style!="object")throw Error(le(62))}}function Ih(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Th=null;function Xp(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Ch=null,ho=null,po=null;function Um(t){if(t=wl(t)){if(typeof Ch!="function")throw Error(le(280));var e=t.stateNode;e&&(e=ld(e),Ch(t.stateNode,t.type,e))}}function W_(t){ho?po?po.push(t):po=[t]:ho=t}function G_(){if(ho){var t=ho,e=po;if(po=ho=null,Um(t),e)for(t=0;t<e.length;t++)Um(e[t])}}function V_(t,e){return t(e)}function Y_(){}var wf=!1;function K_(t,e,n){if(wf)return t(e,n);wf=!0;try{return V_(t,e,n)}finally{wf=!1,(ho!==null||po!==null)&&(Y_(),G_())}}function Ja(t,e){var n=t.stateNode;if(n===null)return null;var r=ld(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(le(231,e,typeof n));return n}var wh=!1;if(Qr)try{var da={};Object.defineProperty(da,"passive",{get:function(){wh=!0}}),window.addEventListener("test",da,da),window.removeEventListener("test",da,da)}catch{wh=!1}function WI(t,e,n,r,s,i,o,a,c){var u=Array.prototype.slice.call(arguments,3);try{e.apply(n,u)}catch(d){this.onError(d)}}var Ra=!1,au=null,lu=!1,kh=null,GI={onError:function(t){Ra=!0,au=t}};function VI(t,e,n,r,s,i,o,a,c){Ra=!1,au=null,WI.apply(GI,arguments)}function YI(t,e,n,r,s,i,o,a,c){if(VI.apply(this,arguments),Ra){if(Ra){var u=au;Ra=!1,au=null}else throw Error(le(198));lu||(lu=!0,kh=u)}}function Ri(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function X_(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Bm(t){if(Ri(t)!==t)throw Error(le(188))}function KI(t){var e=t.alternate;if(!e){if(e=Ri(t),e===null)throw Error(le(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return Bm(s),t;if(i===r)return Bm(s),e;i=i.sibling}throw Error(le(188))}if(n.return!==r.return)n=s,r=i;else{for(var o=!1,a=s.child;a;){if(a===n){o=!0,n=s,r=i;break}if(a===r){o=!0,r=s,n=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===n){o=!0,n=i,r=s;break}if(a===r){o=!0,r=i,n=s;break}a=a.sibling}if(!o)throw Error(le(189))}}if(n.alternate!==r)throw Error(le(190))}if(n.tag!==3)throw Error(le(188));return n.stateNode.current===n?t:e}function Q_(t){return t=KI(t),t!==null?J_(t):null}function J_(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=J_(t);if(e!==null)return e;t=t.sibling}return null}var q_=Hn.unstable_scheduleCallback,zm=Hn.unstable_cancelCallback,XI=Hn.unstable_shouldYield,QI=Hn.unstable_requestPaint,Ut=Hn.unstable_now,JI=Hn.unstable_getCurrentPriorityLevel,Qp=Hn.unstable_ImmediatePriority,Z_=Hn.unstable_UserBlockingPriority,cu=Hn.unstable_NormalPriority,qI=Hn.unstable_LowPriority,e1=Hn.unstable_IdlePriority,sd=null,kr=null;function ZI(t){if(kr&&typeof kr.onCommitFiberRoot=="function")try{kr.onCommitFiberRoot(sd,t,void 0,(t.current.flags&128)===128)}catch{}}var pr=Math.clz32?Math.clz32:nT,eT=Math.log,tT=Math.LN2;function nT(t){return t>>>=0,t===0?32:31-(eT(t)/tT|0)|0}var hc=64,pc=4194304;function Ca(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function uu(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~s;a!==0?r=Ca(a):(i&=o,i!==0&&(r=Ca(i)))}else o=n&~s,o!==0?r=Ca(o):i!==0&&(r=Ca(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-pr(e),s=1<<n,r|=t[n],e&=~s;return r}function rT(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function sT(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var o=31-pr(i),a=1<<o,c=s[o];c===-1?(!(a&n)||a&r)&&(s[o]=rT(a,e)):c<=e&&(t.expiredLanes|=a),i&=~a}}function Ah(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function t1(){var t=hc;return hc<<=1,!(hc&4194240)&&(hc=64),t}function kf(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Tl(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-pr(e),t[e]=n}function iT(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-pr(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function Jp(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-pr(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var yt=0;function n1(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var r1,qp,s1,i1,o1,Rh=!1,gc=[],As=null,Rs=null,Ps=null,qa=new Map,Za=new Map,ys=[],oT="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Hm(t,e){switch(t){case"focusin":case"focusout":As=null;break;case"dragenter":case"dragleave":Rs=null;break;case"mouseover":case"mouseout":Ps=null;break;case"pointerover":case"pointerout":qa.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Za.delete(e.pointerId)}}function fa(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=wl(e),e!==null&&qp(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function aT(t,e,n,r,s){switch(e){case"focusin":return As=fa(As,t,e,n,r,s),!0;case"dragenter":return Rs=fa(Rs,t,e,n,r,s),!0;case"mouseover":return Ps=fa(Ps,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return qa.set(i,fa(qa.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,Za.set(i,fa(Za.get(i)||null,t,e,n,r,s)),!0}return!1}function a1(t){var e=di(t.target);if(e!==null){var n=Ri(e);if(n!==null){if(e=n.tag,e===13){if(e=X_(n),e!==null){t.blockedOn=e,o1(t.priority,function(){s1(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function jc(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Ph(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);Th=r,n.target.dispatchEvent(r),Th=null}else return e=wl(n),e!==null&&qp(e),t.blockedOn=n,!1;e.shift()}return!0}function Wm(t,e,n){jc(t)&&n.delete(e)}function lT(){Rh=!1,As!==null&&jc(As)&&(As=null),Rs!==null&&jc(Rs)&&(Rs=null),Ps!==null&&jc(Ps)&&(Ps=null),qa.forEach(Wm),Za.forEach(Wm)}function ha(t,e){t.blockedOn===e&&(t.blockedOn=null,Rh||(Rh=!0,Hn.unstable_scheduleCallback(Hn.unstable_NormalPriority,lT)))}function el(t){function e(s){return ha(s,t)}if(0<gc.length){ha(gc[0],t);for(var n=1;n<gc.length;n++){var r=gc[n];r.blockedOn===t&&(r.blockedOn=null)}}for(As!==null&&ha(As,t),Rs!==null&&ha(Rs,t),Ps!==null&&ha(Ps,t),qa.forEach(e),Za.forEach(e),n=0;n<ys.length;n++)r=ys[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<ys.length&&(n=ys[0],n.blockedOn===null);)a1(n),n.blockedOn===null&&ys.shift()}var go=ss.ReactCurrentBatchConfig,du=!0;function cT(t,e,n,r){var s=yt,i=go.transition;go.transition=null;try{yt=1,Zp(t,e,n,r)}finally{yt=s,go.transition=i}}function uT(t,e,n,r){var s=yt,i=go.transition;go.transition=null;try{yt=4,Zp(t,e,n,r)}finally{yt=s,go.transition=i}}function Zp(t,e,n,r){if(du){var s=Ph(t,e,n,r);if(s===null)$f(t,e,r,fu,n),Hm(t,r);else if(aT(s,t,e,n,r))r.stopPropagation();else if(Hm(t,r),e&4&&-1<oT.indexOf(t)){for(;s!==null;){var i=wl(s);if(i!==null&&r1(i),i=Ph(t,e,n,r),i===null&&$f(t,e,r,fu,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else $f(t,e,r,null,n)}}var fu=null;function Ph(t,e,n,r){if(fu=null,t=Xp(r),t=di(t),t!==null)if(e=Ri(t),e===null)t=null;else if(n=e.tag,n===13){if(t=X_(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return fu=t,null}function l1(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(JI()){case Qp:return 1;case Z_:return 4;case cu:case qI:return 16;case e1:return 536870912;default:return 16}default:return 16}}var Is=null,eg=null,$c=null;function c1(){if($c)return $c;var t,e=eg,n=e.length,r,s="value"in Is?Is.value:Is.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===s[i-r];r++);return $c=s.slice(t,1<r?1-r:void 0)}function Fc(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function mc(){return!0}function Gm(){return!1}function Vn(t){function e(n,r,s,i,o){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?mc:Gm,this.isPropagationStopped=Gm,this}return jt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=mc)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=mc)},persist:function(){},isPersistent:mc}),e}var Bo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},tg=Vn(Bo),Cl=jt({},Bo,{view:0,detail:0}),dT=Vn(Cl),Af,Rf,pa,id=jt({},Cl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ng,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==pa&&(pa&&t.type==="mousemove"?(Af=t.screenX-pa.screenX,Rf=t.screenY-pa.screenY):Rf=Af=0,pa=t),Af)},movementY:function(t){return"movementY"in t?t.movementY:Rf}}),Vm=Vn(id),fT=jt({},id,{dataTransfer:0}),hT=Vn(fT),pT=jt({},Cl,{relatedTarget:0}),Pf=Vn(pT),gT=jt({},Bo,{animationName:0,elapsedTime:0,pseudoElement:0}),mT=Vn(gT),yT=jt({},Bo,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),vT=Vn(yT),_T=jt({},Bo,{data:0}),Ym=Vn(_T),xT={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ET={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},bT={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ST(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=bT[t])?!!e[t]:!1}function ng(){return ST}var IT=jt({},Cl,{key:function(t){if(t.key){var e=xT[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Fc(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?ET[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ng,charCode:function(t){return t.type==="keypress"?Fc(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Fc(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),TT=Vn(IT),CT=jt({},id,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Km=Vn(CT),wT=jt({},Cl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ng}),kT=Vn(wT),AT=jt({},Bo,{propertyName:0,elapsedTime:0,pseudoElement:0}),RT=Vn(AT),PT=jt({},id,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),OT=Vn(PT),LT=[9,13,27,32],rg=Qr&&"CompositionEvent"in window,Pa=null;Qr&&"documentMode"in document&&(Pa=document.documentMode);var DT=Qr&&"TextEvent"in window&&!Pa,u1=Qr&&(!rg||Pa&&8<Pa&&11>=Pa),Xm=" ",Qm=!1;function d1(t,e){switch(t){case"keyup":return LT.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function f1(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Zi=!1;function NT(t,e){switch(t){case"compositionend":return f1(e);case"keypress":return e.which!==32?null:(Qm=!0,Xm);case"textInput":return t=e.data,t===Xm&&Qm?null:t;default:return null}}function MT(t,e){if(Zi)return t==="compositionend"||!rg&&d1(t,e)?(t=c1(),$c=eg=Is=null,Zi=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return u1&&e.locale!=="ko"?null:e.data;default:return null}}var jT={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Jm(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!jT[t.type]:e==="textarea"}function h1(t,e,n,r){W_(r),e=hu(e,"onChange"),0<e.length&&(n=new tg("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Oa=null,tl=null;function $T(t){I1(t,0)}function od(t){var e=no(t);if(j_(e))return t}function FT(t,e){if(t==="change")return e}var p1=!1;if(Qr){var Of;if(Qr){var Lf="oninput"in document;if(!Lf){var qm=document.createElement("div");qm.setAttribute("oninput","return;"),Lf=typeof qm.oninput=="function"}Of=Lf}else Of=!1;p1=Of&&(!document.documentMode||9<document.documentMode)}function Zm(){Oa&&(Oa.detachEvent("onpropertychange",g1),tl=Oa=null)}function g1(t){if(t.propertyName==="value"&&od(tl)){var e=[];h1(e,tl,t,Xp(t)),K_($T,e)}}function UT(t,e,n){t==="focusin"?(Zm(),Oa=e,tl=n,Oa.attachEvent("onpropertychange",g1)):t==="focusout"&&Zm()}function BT(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return od(tl)}function zT(t,e){if(t==="click")return od(e)}function HT(t,e){if(t==="input"||t==="change")return od(e)}function WT(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var yr=typeof Object.is=="function"?Object.is:WT;function nl(t,e){if(yr(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!hh.call(e,s)||!yr(t[s],e[s]))return!1}return!0}function ey(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function ty(t,e){var n=ey(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=ey(n)}}function m1(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?m1(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function y1(){for(var t=window,e=ou();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=ou(t.document)}return e}function sg(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function GT(t){var e=y1(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&m1(n.ownerDocument.documentElement,n)){if(r!==null&&sg(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=ty(n,i);var o=ty(n,r);s&&o&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var VT=Qr&&"documentMode"in document&&11>=document.documentMode,eo=null,Oh=null,La=null,Lh=!1;function ny(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Lh||eo==null||eo!==ou(r)||(r=eo,"selectionStart"in r&&sg(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),La&&nl(La,r)||(La=r,r=hu(Oh,"onSelect"),0<r.length&&(e=new tg("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=eo)))}function yc(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var to={animationend:yc("Animation","AnimationEnd"),animationiteration:yc("Animation","AnimationIteration"),animationstart:yc("Animation","AnimationStart"),transitionend:yc("Transition","TransitionEnd")},Df={},v1={};Qr&&(v1=document.createElement("div").style,"AnimationEvent"in window||(delete to.animationend.animation,delete to.animationiteration.animation,delete to.animationstart.animation),"TransitionEvent"in window||delete to.transitionend.transition);function ad(t){if(Df[t])return Df[t];if(!to[t])return t;var e=to[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in v1)return Df[t]=e[n];return t}var _1=ad("animationend"),x1=ad("animationiteration"),E1=ad("animationstart"),b1=ad("transitionend"),S1=new Map,ry="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Js(t,e){S1.set(t,e),Ai(e,[t])}for(var Nf=0;Nf<ry.length;Nf++){var Mf=ry[Nf],YT=Mf.toLowerCase(),KT=Mf[0].toUpperCase()+Mf.slice(1);Js(YT,"on"+KT)}Js(_1,"onAnimationEnd");Js(x1,"onAnimationIteration");Js(E1,"onAnimationStart");Js("dblclick","onDoubleClick");Js("focusin","onFocus");Js("focusout","onBlur");Js(b1,"onTransitionEnd");To("onMouseEnter",["mouseout","mouseover"]);To("onMouseLeave",["mouseout","mouseover"]);To("onPointerEnter",["pointerout","pointerover"]);To("onPointerLeave",["pointerout","pointerover"]);Ai("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ai("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ai("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ai("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ai("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ai("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var wa="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),XT=new Set("cancel close invalid load scroll toggle".split(" ").concat(wa));function sy(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,YI(r,e,void 0,t),t.currentTarget=null}function I1(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],c=a.instance,u=a.currentTarget;if(a=a.listener,c!==i&&s.isPropagationStopped())break e;sy(s,a,u),i=c}else for(o=0;o<r.length;o++){if(a=r[o],c=a.instance,u=a.currentTarget,a=a.listener,c!==i&&s.isPropagationStopped())break e;sy(s,a,u),i=c}}}if(lu)throw t=kh,lu=!1,kh=null,t}function kt(t,e){var n=e[$h];n===void 0&&(n=e[$h]=new Set);var r=t+"__bubble";n.has(r)||(T1(e,t,2,!1),n.add(r))}function jf(t,e,n){var r=0;e&&(r|=4),T1(n,t,r,e)}var vc="_reactListening"+Math.random().toString(36).slice(2);function rl(t){if(!t[vc]){t[vc]=!0,O_.forEach(function(n){n!=="selectionchange"&&(XT.has(n)||jf(n,!1,t),jf(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[vc]||(e[vc]=!0,jf("selectionchange",!1,e))}}function T1(t,e,n,r){switch(l1(e)){case 1:var s=cT;break;case 4:s=uT;break;default:s=Zp}n=s.bind(null,e,n,t),s=void 0,!wh||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function $f(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===s||c.nodeType===8&&c.parentNode===s))return;o=o.return}for(;a!==null;){if(o=di(a),o===null)return;if(c=o.tag,c===5||c===6){r=i=o;continue e}a=a.parentNode}}r=r.return}K_(function(){var u=i,d=Xp(n),h=[];e:{var f=S1.get(t);if(f!==void 0){var E=tg,k=t;switch(t){case"keypress":if(Fc(n)===0)break e;case"keydown":case"keyup":E=TT;break;case"focusin":k="focus",E=Pf;break;case"focusout":k="blur",E=Pf;break;case"beforeblur":case"afterblur":E=Pf;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":E=Vm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":E=hT;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":E=kT;break;case _1:case x1:case E1:E=mT;break;case b1:E=RT;break;case"scroll":E=dT;break;case"wheel":E=OT;break;case"copy":case"cut":case"paste":E=vT;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":E=Km}var P=(e&4)!==0,G=!P&&t==="scroll",x=P?f!==null?f+"Capture":null:f;P=[];for(var S=u,w;S!==null;){w=S;var p=w.stateNode;if(w.tag===5&&p!==null&&(w=p,x!==null&&(p=Ja(S,x),p!=null&&P.push(sl(S,p,w)))),G)break;S=S.return}0<P.length&&(f=new E(f,k,null,n,d),h.push({event:f,listeners:P}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",E=t==="mouseout"||t==="pointerout",f&&n!==Th&&(k=n.relatedTarget||n.fromElement)&&(di(k)||k[Jr]))break e;if((E||f)&&(f=d.window===d?d:(f=d.ownerDocument)?f.defaultView||f.parentWindow:window,E?(k=n.relatedTarget||n.toElement,E=u,k=k?di(k):null,k!==null&&(G=Ri(k),k!==G||k.tag!==5&&k.tag!==6)&&(k=null)):(E=null,k=u),E!==k)){if(P=Vm,p="onMouseLeave",x="onMouseEnter",S="mouse",(t==="pointerout"||t==="pointerover")&&(P=Km,p="onPointerLeave",x="onPointerEnter",S="pointer"),G=E==null?f:no(E),w=k==null?f:no(k),f=new P(p,S+"leave",E,n,d),f.target=G,f.relatedTarget=w,p=null,di(d)===u&&(P=new P(x,S+"enter",k,n,d),P.target=w,P.relatedTarget=G,p=P),G=p,E&&k)t:{for(P=E,x=k,S=0,w=P;w;w=Yi(w))S++;for(w=0,p=x;p;p=Yi(p))w++;for(;0<S-w;)P=Yi(P),S--;for(;0<w-S;)x=Yi(x),w--;for(;S--;){if(P===x||x!==null&&P===x.alternate)break t;P=Yi(P),x=Yi(x)}P=null}else P=null;E!==null&&iy(h,f,E,P,!1),k!==null&&G!==null&&iy(h,G,k,P,!0)}}e:{if(f=u?no(u):window,E=f.nodeName&&f.nodeName.toLowerCase(),E==="select"||E==="input"&&f.type==="file")var b=FT;else if(Jm(f))if(p1)b=HT;else{b=BT;var H=UT}else(E=f.nodeName)&&E.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(b=zT);if(b&&(b=b(t,u))){h1(h,b,n,d);break e}H&&H(t,f,u),t==="focusout"&&(H=f._wrapperState)&&H.controlled&&f.type==="number"&&xh(f,"number",f.value)}switch(H=u?no(u):window,t){case"focusin":(Jm(H)||H.contentEditable==="true")&&(eo=H,Oh=u,La=null);break;case"focusout":La=Oh=eo=null;break;case"mousedown":Lh=!0;break;case"contextmenu":case"mouseup":case"dragend":Lh=!1,ny(h,n,d);break;case"selectionchange":if(VT)break;case"keydown":case"keyup":ny(h,n,d)}var re;if(rg)e:{switch(t){case"compositionstart":var K="onCompositionStart";break e;case"compositionend":K="onCompositionEnd";break e;case"compositionupdate":K="onCompositionUpdate";break e}K=void 0}else Zi?d1(t,n)&&(K="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(K="onCompositionStart");K&&(u1&&n.locale!=="ko"&&(Zi||K!=="onCompositionStart"?K==="onCompositionEnd"&&Zi&&(re=c1()):(Is=d,eg="value"in Is?Is.value:Is.textContent,Zi=!0)),H=hu(u,K),0<H.length&&(K=new Ym(K,t,null,n,d),h.push({event:K,listeners:H}),re?K.data=re:(re=f1(n),re!==null&&(K.data=re)))),(re=DT?NT(t,n):MT(t,n))&&(u=hu(u,"onBeforeInput"),0<u.length&&(d=new Ym("onBeforeInput","beforeinput",null,n,d),h.push({event:d,listeners:u}),d.data=re))}I1(h,e)})}function sl(t,e,n){return{instance:t,listener:e,currentTarget:n}}function hu(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=Ja(t,n),i!=null&&r.unshift(sl(t,i,s)),i=Ja(t,e),i!=null&&r.push(sl(t,i,s))),t=t.return}return r}function Yi(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function iy(t,e,n,r,s){for(var i=e._reactName,o=[];n!==null&&n!==r;){var a=n,c=a.alternate,u=a.stateNode;if(c!==null&&c===r)break;a.tag===5&&u!==null&&(a=u,s?(c=Ja(n,i),c!=null&&o.unshift(sl(n,c,a))):s||(c=Ja(n,i),c!=null&&o.push(sl(n,c,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var QT=/\r\n?/g,JT=/\u0000|\uFFFD/g;function oy(t){return(typeof t=="string"?t:""+t).replace(QT,`
`).replace(JT,"")}function _c(t,e,n){if(e=oy(e),oy(t)!==e&&n)throw Error(le(425))}function pu(){}var Dh=null,Nh=null;function Mh(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var jh=typeof setTimeout=="function"?setTimeout:void 0,qT=typeof clearTimeout=="function"?clearTimeout:void 0,ay=typeof Promise=="function"?Promise:void 0,ZT=typeof queueMicrotask=="function"?queueMicrotask:typeof ay<"u"?function(t){return ay.resolve(null).then(t).catch(eC)}:jh;function eC(t){setTimeout(function(){throw t})}function Ff(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),el(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);el(e)}function Os(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function ly(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var zo=Math.random().toString(36).slice(2),Cr="__reactFiber$"+zo,il="__reactProps$"+zo,Jr="__reactContainer$"+zo,$h="__reactEvents$"+zo,tC="__reactListeners$"+zo,nC="__reactHandles$"+zo;function di(t){var e=t[Cr];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Jr]||n[Cr]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=ly(t);t!==null;){if(n=t[Cr])return n;t=ly(t)}return e}t=n,n=t.parentNode}return null}function wl(t){return t=t[Cr]||t[Jr],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function no(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(le(33))}function ld(t){return t[il]||null}var Fh=[],ro=-1;function qs(t){return{current:t}}function At(t){0>ro||(t.current=Fh[ro],Fh[ro]=null,ro--)}function wt(t,e){ro++,Fh[ro]=t.current,t.current=e}var Gs={},gn=qs(Gs),Nn=qs(!1),yi=Gs;function Co(t,e){var n=t.type.contextTypes;if(!n)return Gs;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function Mn(t){return t=t.childContextTypes,t!=null}function gu(){At(Nn),At(gn)}function cy(t,e,n){if(gn.current!==Gs)throw Error(le(168));wt(gn,e),wt(Nn,n)}function C1(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(le(108,UI(t)||"Unknown",s));return jt({},n,r)}function mu(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Gs,yi=gn.current,wt(gn,t),wt(Nn,Nn.current),!0}function uy(t,e,n){var r=t.stateNode;if(!r)throw Error(le(169));n?(t=C1(t,e,yi),r.__reactInternalMemoizedMergedChildContext=t,At(Nn),At(gn),wt(gn,t)):At(Nn),wt(Nn,n)}var Fr=null,cd=!1,Uf=!1;function w1(t){Fr===null?Fr=[t]:Fr.push(t)}function rC(t){cd=!0,w1(t)}function Zs(){if(!Uf&&Fr!==null){Uf=!0;var t=0,e=yt;try{var n=Fr;for(yt=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}Fr=null,cd=!1}catch(s){throw Fr!==null&&(Fr=Fr.slice(t+1)),q_(Qp,Zs),s}finally{yt=e,Uf=!1}}return null}var so=[],io=0,yu=null,vu=0,Xn=[],Qn=0,vi=null,Br=1,zr="";function oi(t,e){so[io++]=vu,so[io++]=yu,yu=t,vu=e}function k1(t,e,n){Xn[Qn++]=Br,Xn[Qn++]=zr,Xn[Qn++]=vi,vi=t;var r=Br;t=zr;var s=32-pr(r)-1;r&=~(1<<s),n+=1;var i=32-pr(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,Br=1<<32-pr(e)+s|n<<s|r,zr=i+t}else Br=1<<i|n<<s|r,zr=t}function ig(t){t.return!==null&&(oi(t,1),k1(t,1,0))}function og(t){for(;t===yu;)yu=so[--io],so[io]=null,vu=so[--io],so[io]=null;for(;t===vi;)vi=Xn[--Qn],Xn[Qn]=null,zr=Xn[--Qn],Xn[Qn]=null,Br=Xn[--Qn],Xn[Qn]=null}var zn=null,Bn=null,Pt=!1,lr=null;function A1(t,e){var n=Jn(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function dy(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,zn=t,Bn=Os(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,zn=t,Bn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=vi!==null?{id:Br,overflow:zr}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Jn(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,zn=t,Bn=null,!0):!1;default:return!1}}function Uh(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Bh(t){if(Pt){var e=Bn;if(e){var n=e;if(!dy(t,e)){if(Uh(t))throw Error(le(418));e=Os(n.nextSibling);var r=zn;e&&dy(t,e)?A1(r,n):(t.flags=t.flags&-4097|2,Pt=!1,zn=t)}}else{if(Uh(t))throw Error(le(418));t.flags=t.flags&-4097|2,Pt=!1,zn=t}}}function fy(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;zn=t}function xc(t){if(t!==zn)return!1;if(!Pt)return fy(t),Pt=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Mh(t.type,t.memoizedProps)),e&&(e=Bn)){if(Uh(t))throw R1(),Error(le(418));for(;e;)A1(t,e),e=Os(e.nextSibling)}if(fy(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(le(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Bn=Os(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Bn=null}}else Bn=zn?Os(t.stateNode.nextSibling):null;return!0}function R1(){for(var t=Bn;t;)t=Os(t.nextSibling)}function wo(){Bn=zn=null,Pt=!1}function ag(t){lr===null?lr=[t]:lr.push(t)}var sC=ss.ReactCurrentBatchConfig;function ga(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(le(309));var r=n.stateNode}if(!r)throw Error(le(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=s.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof t!="string")throw Error(le(284));if(!n._owner)throw Error(le(290,t))}return t}function Ec(t,e){throw t=Object.prototype.toString.call(e),Error(le(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function hy(t){var e=t._init;return e(t._payload)}function P1(t){function e(x,S){if(t){var w=x.deletions;w===null?(x.deletions=[S],x.flags|=16):w.push(S)}}function n(x,S){if(!t)return null;for(;S!==null;)e(x,S),S=S.sibling;return null}function r(x,S){for(x=new Map;S!==null;)S.key!==null?x.set(S.key,S):x.set(S.index,S),S=S.sibling;return x}function s(x,S){return x=Ms(x,S),x.index=0,x.sibling=null,x}function i(x,S,w){return x.index=w,t?(w=x.alternate,w!==null?(w=w.index,w<S?(x.flags|=2,S):w):(x.flags|=2,S)):(x.flags|=1048576,S)}function o(x){return t&&x.alternate===null&&(x.flags|=2),x}function a(x,S,w,p){return S===null||S.tag!==6?(S=Yf(w,x.mode,p),S.return=x,S):(S=s(S,w),S.return=x,S)}function c(x,S,w,p){var b=w.type;return b===qi?d(x,S,w.props.children,p,w.key):S!==null&&(S.elementType===b||typeof b=="object"&&b!==null&&b.$$typeof===gs&&hy(b)===S.type)?(p=s(S,w.props),p.ref=ga(x,S,w),p.return=x,p):(p=Vc(w.type,w.key,w.props,null,x.mode,p),p.ref=ga(x,S,w),p.return=x,p)}function u(x,S,w,p){return S===null||S.tag!==4||S.stateNode.containerInfo!==w.containerInfo||S.stateNode.implementation!==w.implementation?(S=Kf(w,x.mode,p),S.return=x,S):(S=s(S,w.children||[]),S.return=x,S)}function d(x,S,w,p,b){return S===null||S.tag!==7?(S=mi(w,x.mode,p,b),S.return=x,S):(S=s(S,w),S.return=x,S)}function h(x,S,w){if(typeof S=="string"&&S!==""||typeof S=="number")return S=Yf(""+S,x.mode,w),S.return=x,S;if(typeof S=="object"&&S!==null){switch(S.$$typeof){case uc:return w=Vc(S.type,S.key,S.props,null,x.mode,w),w.ref=ga(x,null,S),w.return=x,w;case Ji:return S=Kf(S,x.mode,w),S.return=x,S;case gs:var p=S._init;return h(x,p(S._payload),w)}if(Ta(S)||ua(S))return S=mi(S,x.mode,w,null),S.return=x,S;Ec(x,S)}return null}function f(x,S,w,p){var b=S!==null?S.key:null;if(typeof w=="string"&&w!==""||typeof w=="number")return b!==null?null:a(x,S,""+w,p);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case uc:return w.key===b?c(x,S,w,p):null;case Ji:return w.key===b?u(x,S,w,p):null;case gs:return b=w._init,f(x,S,b(w._payload),p)}if(Ta(w)||ua(w))return b!==null?null:d(x,S,w,p,null);Ec(x,w)}return null}function E(x,S,w,p,b){if(typeof p=="string"&&p!==""||typeof p=="number")return x=x.get(w)||null,a(S,x,""+p,b);if(typeof p=="object"&&p!==null){switch(p.$$typeof){case uc:return x=x.get(p.key===null?w:p.key)||null,c(S,x,p,b);case Ji:return x=x.get(p.key===null?w:p.key)||null,u(S,x,p,b);case gs:var H=p._init;return E(x,S,w,H(p._payload),b)}if(Ta(p)||ua(p))return x=x.get(w)||null,d(S,x,p,b,null);Ec(S,p)}return null}function k(x,S,w,p){for(var b=null,H=null,re=S,K=S=0,Q=null;re!==null&&K<w.length;K++){re.index>K?(Q=re,re=null):Q=re.sibling;var ce=f(x,re,w[K],p);if(ce===null){re===null&&(re=Q);break}t&&re&&ce.alternate===null&&e(x,re),S=i(ce,S,K),H===null?b=ce:H.sibling=ce,H=ce,re=Q}if(K===w.length)return n(x,re),Pt&&oi(x,K),b;if(re===null){for(;K<w.length;K++)re=h(x,w[K],p),re!==null&&(S=i(re,S,K),H===null?b=re:H.sibling=re,H=re);return Pt&&oi(x,K),b}for(re=r(x,re);K<w.length;K++)Q=E(re,x,K,w[K],p),Q!==null&&(t&&Q.alternate!==null&&re.delete(Q.key===null?K:Q.key),S=i(Q,S,K),H===null?b=Q:H.sibling=Q,H=Q);return t&&re.forEach(function(me){return e(x,me)}),Pt&&oi(x,K),b}function P(x,S,w,p){var b=ua(w);if(typeof b!="function")throw Error(le(150));if(w=b.call(w),w==null)throw Error(le(151));for(var H=b=null,re=S,K=S=0,Q=null,ce=w.next();re!==null&&!ce.done;K++,ce=w.next()){re.index>K?(Q=re,re=null):Q=re.sibling;var me=f(x,re,ce.value,p);if(me===null){re===null&&(re=Q);break}t&&re&&me.alternate===null&&e(x,re),S=i(me,S,K),H===null?b=me:H.sibling=me,H=me,re=Q}if(ce.done)return n(x,re),Pt&&oi(x,K),b;if(re===null){for(;!ce.done;K++,ce=w.next())ce=h(x,ce.value,p),ce!==null&&(S=i(ce,S,K),H===null?b=ce:H.sibling=ce,H=ce);return Pt&&oi(x,K),b}for(re=r(x,re);!ce.done;K++,ce=w.next())ce=E(re,x,K,ce.value,p),ce!==null&&(t&&ce.alternate!==null&&re.delete(ce.key===null?K:ce.key),S=i(ce,S,K),H===null?b=ce:H.sibling=ce,H=ce);return t&&re.forEach(function(Se){return e(x,Se)}),Pt&&oi(x,K),b}function G(x,S,w,p){if(typeof w=="object"&&w!==null&&w.type===qi&&w.key===null&&(w=w.props.children),typeof w=="object"&&w!==null){switch(w.$$typeof){case uc:e:{for(var b=w.key,H=S;H!==null;){if(H.key===b){if(b=w.type,b===qi){if(H.tag===7){n(x,H.sibling),S=s(H,w.props.children),S.return=x,x=S;break e}}else if(H.elementType===b||typeof b=="object"&&b!==null&&b.$$typeof===gs&&hy(b)===H.type){n(x,H.sibling),S=s(H,w.props),S.ref=ga(x,H,w),S.return=x,x=S;break e}n(x,H);break}else e(x,H);H=H.sibling}w.type===qi?(S=mi(w.props.children,x.mode,p,w.key),S.return=x,x=S):(p=Vc(w.type,w.key,w.props,null,x.mode,p),p.ref=ga(x,S,w),p.return=x,x=p)}return o(x);case Ji:e:{for(H=w.key;S!==null;){if(S.key===H)if(S.tag===4&&S.stateNode.containerInfo===w.containerInfo&&S.stateNode.implementation===w.implementation){n(x,S.sibling),S=s(S,w.children||[]),S.return=x,x=S;break e}else{n(x,S);break}else e(x,S);S=S.sibling}S=Kf(w,x.mode,p),S.return=x,x=S}return o(x);case gs:return H=w._init,G(x,S,H(w._payload),p)}if(Ta(w))return k(x,S,w,p);if(ua(w))return P(x,S,w,p);Ec(x,w)}return typeof w=="string"&&w!==""||typeof w=="number"?(w=""+w,S!==null&&S.tag===6?(n(x,S.sibling),S=s(S,w),S.return=x,x=S):(n(x,S),S=Yf(w,x.mode,p),S.return=x,x=S),o(x)):n(x,S)}return G}var ko=P1(!0),O1=P1(!1),_u=qs(null),xu=null,oo=null,lg=null;function cg(){lg=oo=xu=null}function ug(t){var e=_u.current;At(_u),t._currentValue=e}function zh(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function mo(t,e){xu=t,lg=oo=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Ln=!0),t.firstContext=null)}function er(t){var e=t._currentValue;if(lg!==t)if(t={context:t,memoizedValue:e,next:null},oo===null){if(xu===null)throw Error(le(308));oo=t,xu.dependencies={lanes:0,firstContext:t}}else oo=oo.next=t;return e}var fi=null;function dg(t){fi===null?fi=[t]:fi.push(t)}function L1(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,dg(e)):(n.next=s.next,s.next=n),e.interleaved=n,qr(t,r)}function qr(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var ms=!1;function fg(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function D1(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Kr(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Ls(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,ut&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,qr(t,n)}return s=r.interleaved,s===null?(e.next=e,dg(r)):(e.next=s.next,s.next=e),r.interleaved=e,qr(t,n)}function Uc(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Jp(t,n)}}function py(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=o:i=i.next=o,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Eu(t,e,n,r){var s=t.updateQueue;ms=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var c=a,u=c.next;c.next=null,o===null?i=u:o.next=u,o=c;var d=t.alternate;d!==null&&(d=d.updateQueue,a=d.lastBaseUpdate,a!==o&&(a===null?d.firstBaseUpdate=u:a.next=u,d.lastBaseUpdate=c))}if(i!==null){var h=s.baseState;o=0,d=u=c=null,a=i;do{var f=a.lane,E=a.eventTime;if((r&f)===f){d!==null&&(d=d.next={eventTime:E,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var k=t,P=a;switch(f=e,E=n,P.tag){case 1:if(k=P.payload,typeof k=="function"){h=k.call(E,h,f);break e}h=k;break e;case 3:k.flags=k.flags&-65537|128;case 0:if(k=P.payload,f=typeof k=="function"?k.call(E,h,f):k,f==null)break e;h=jt({},h,f);break e;case 2:ms=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,f=s.effects,f===null?s.effects=[a]:f.push(a))}else E={eventTime:E,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},d===null?(u=d=E,c=h):d=d.next=E,o|=f;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;f=a,a=f.next,f.next=null,s.lastBaseUpdate=f,s.shared.pending=null}}while(!0);if(d===null&&(c=h),s.baseState=c,s.firstBaseUpdate=u,s.lastBaseUpdate=d,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);xi|=o,t.lanes=o,t.memoizedState=h}}function gy(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(le(191,s));s.call(r)}}}var kl={},Ar=qs(kl),ol=qs(kl),al=qs(kl);function hi(t){if(t===kl)throw Error(le(174));return t}function hg(t,e){switch(wt(al,e),wt(ol,t),wt(Ar,kl),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:bh(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=bh(e,t)}At(Ar),wt(Ar,e)}function Ao(){At(Ar),At(ol),At(al)}function N1(t){hi(al.current);var e=hi(Ar.current),n=bh(e,t.type);e!==n&&(wt(ol,t),wt(Ar,n))}function pg(t){ol.current===t&&(At(Ar),At(ol))}var Lt=qs(0);function bu(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Bf=[];function gg(){for(var t=0;t<Bf.length;t++)Bf[t]._workInProgressVersionPrimary=null;Bf.length=0}var Bc=ss.ReactCurrentDispatcher,zf=ss.ReactCurrentBatchConfig,_i=0,Mt=null,Vt=null,Qt=null,Su=!1,Da=!1,ll=0,iC=0;function dn(){throw Error(le(321))}function mg(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!yr(t[n],e[n]))return!1;return!0}function yg(t,e,n,r,s,i){if(_i=i,Mt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Bc.current=t===null||t.memoizedState===null?cC:uC,t=n(r,s),Da){i=0;do{if(Da=!1,ll=0,25<=i)throw Error(le(301));i+=1,Qt=Vt=null,e.updateQueue=null,Bc.current=dC,t=n(r,s)}while(Da)}if(Bc.current=Iu,e=Vt!==null&&Vt.next!==null,_i=0,Qt=Vt=Mt=null,Su=!1,e)throw Error(le(300));return t}function vg(){var t=ll!==0;return ll=0,t}function Tr(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Qt===null?Mt.memoizedState=Qt=t:Qt=Qt.next=t,Qt}function tr(){if(Vt===null){var t=Mt.alternate;t=t!==null?t.memoizedState:null}else t=Vt.next;var e=Qt===null?Mt.memoizedState:Qt.next;if(e!==null)Qt=e,Vt=t;else{if(t===null)throw Error(le(310));Vt=t,t={memoizedState:Vt.memoizedState,baseState:Vt.baseState,baseQueue:Vt.baseQueue,queue:Vt.queue,next:null},Qt===null?Mt.memoizedState=Qt=t:Qt=Qt.next=t}return Qt}function cl(t,e){return typeof e=="function"?e(t):e}function Hf(t){var e=tr(),n=e.queue;if(n===null)throw Error(le(311));n.lastRenderedReducer=t;var r=Vt,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var a=o=null,c=null,u=i;do{var d=u.lane;if((_i&d)===d)c!==null&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:t(r,u.action);else{var h={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};c===null?(a=c=h,o=r):c=c.next=h,Mt.lanes|=d,xi|=d}u=u.next}while(u!==null&&u!==i);c===null?o=r:c.next=a,yr(r,e.memoizedState)||(Ln=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=c,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,Mt.lanes|=i,xi|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Wf(t){var e=tr(),n=e.queue;if(n===null)throw Error(le(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var o=s=s.next;do i=t(i,o.action),o=o.next;while(o!==s);yr(i,e.memoizedState)||(Ln=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function M1(){}function j1(t,e){var n=Mt,r=tr(),s=e(),i=!yr(r.memoizedState,s);if(i&&(r.memoizedState=s,Ln=!0),r=r.queue,_g(U1.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||Qt!==null&&Qt.memoizedState.tag&1){if(n.flags|=2048,ul(9,F1.bind(null,n,r,s,e),void 0,null),Zt===null)throw Error(le(349));_i&30||$1(n,e,s)}return s}function $1(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Mt.updateQueue,e===null?(e={lastEffect:null,stores:null},Mt.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function F1(t,e,n,r){e.value=n,e.getSnapshot=r,B1(e)&&z1(t)}function U1(t,e,n){return n(function(){B1(e)&&z1(t)})}function B1(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!yr(t,n)}catch{return!0}}function z1(t){var e=qr(t,1);e!==null&&gr(e,t,1,-1)}function my(t){var e=Tr();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:cl,lastRenderedState:t},e.queue=t,t=t.dispatch=lC.bind(null,Mt,t),[e.memoizedState,t]}function ul(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=Mt.updateQueue,e===null?(e={lastEffect:null,stores:null},Mt.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function H1(){return tr().memoizedState}function zc(t,e,n,r){var s=Tr();Mt.flags|=t,s.memoizedState=ul(1|e,n,void 0,r===void 0?null:r)}function ud(t,e,n,r){var s=tr();r=r===void 0?null:r;var i=void 0;if(Vt!==null){var o=Vt.memoizedState;if(i=o.destroy,r!==null&&mg(r,o.deps)){s.memoizedState=ul(e,n,i,r);return}}Mt.flags|=t,s.memoizedState=ul(1|e,n,i,r)}function yy(t,e){return zc(8390656,8,t,e)}function _g(t,e){return ud(2048,8,t,e)}function W1(t,e){return ud(4,2,t,e)}function G1(t,e){return ud(4,4,t,e)}function V1(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Y1(t,e,n){return n=n!=null?n.concat([t]):null,ud(4,4,V1.bind(null,e,t),n)}function xg(){}function K1(t,e){var n=tr();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&mg(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function X1(t,e){var n=tr();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&mg(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function Q1(t,e,n){return _i&21?(yr(n,e)||(n=t1(),Mt.lanes|=n,xi|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Ln=!0),t.memoizedState=n)}function oC(t,e){var n=yt;yt=n!==0&&4>n?n:4,t(!0);var r=zf.transition;zf.transition={};try{t(!1),e()}finally{yt=n,zf.transition=r}}function J1(){return tr().memoizedState}function aC(t,e,n){var r=Ns(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},q1(t))Z1(e,n);else if(n=L1(t,e,n,r),n!==null){var s=In();gr(n,t,r,s),ex(n,e,r)}}function lC(t,e,n){var r=Ns(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(q1(t))Z1(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,n);if(s.hasEagerState=!0,s.eagerState=a,yr(a,o)){var c=e.interleaved;c===null?(s.next=s,dg(e)):(s.next=c.next,c.next=s),e.interleaved=s;return}}catch{}finally{}n=L1(t,e,s,r),n!==null&&(s=In(),gr(n,t,r,s),ex(n,e,r))}}function q1(t){var e=t.alternate;return t===Mt||e!==null&&e===Mt}function Z1(t,e){Da=Su=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function ex(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Jp(t,n)}}var Iu={readContext:er,useCallback:dn,useContext:dn,useEffect:dn,useImperativeHandle:dn,useInsertionEffect:dn,useLayoutEffect:dn,useMemo:dn,useReducer:dn,useRef:dn,useState:dn,useDebugValue:dn,useDeferredValue:dn,useTransition:dn,useMutableSource:dn,useSyncExternalStore:dn,useId:dn,unstable_isNewReconciler:!1},cC={readContext:er,useCallback:function(t,e){return Tr().memoizedState=[t,e===void 0?null:e],t},useContext:er,useEffect:yy,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,zc(4194308,4,V1.bind(null,e,t),n)},useLayoutEffect:function(t,e){return zc(4194308,4,t,e)},useInsertionEffect:function(t,e){return zc(4,2,t,e)},useMemo:function(t,e){var n=Tr();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Tr();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=aC.bind(null,Mt,t),[r.memoizedState,t]},useRef:function(t){var e=Tr();return t={current:t},e.memoizedState=t},useState:my,useDebugValue:xg,useDeferredValue:function(t){return Tr().memoizedState=t},useTransition:function(){var t=my(!1),e=t[0];return t=oC.bind(null,t[1]),Tr().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=Mt,s=Tr();if(Pt){if(n===void 0)throw Error(le(407));n=n()}else{if(n=e(),Zt===null)throw Error(le(349));_i&30||$1(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,yy(U1.bind(null,r,i,t),[t]),r.flags|=2048,ul(9,F1.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=Tr(),e=Zt.identifierPrefix;if(Pt){var n=zr,r=Br;n=(r&~(1<<32-pr(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=ll++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=iC++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},uC={readContext:er,useCallback:K1,useContext:er,useEffect:_g,useImperativeHandle:Y1,useInsertionEffect:W1,useLayoutEffect:G1,useMemo:X1,useReducer:Hf,useRef:H1,useState:function(){return Hf(cl)},useDebugValue:xg,useDeferredValue:function(t){var e=tr();return Q1(e,Vt.memoizedState,t)},useTransition:function(){var t=Hf(cl)[0],e=tr().memoizedState;return[t,e]},useMutableSource:M1,useSyncExternalStore:j1,useId:J1,unstable_isNewReconciler:!1},dC={readContext:er,useCallback:K1,useContext:er,useEffect:_g,useImperativeHandle:Y1,useInsertionEffect:W1,useLayoutEffect:G1,useMemo:X1,useReducer:Wf,useRef:H1,useState:function(){return Wf(cl)},useDebugValue:xg,useDeferredValue:function(t){var e=tr();return Vt===null?e.memoizedState=t:Q1(e,Vt.memoizedState,t)},useTransition:function(){var t=Wf(cl)[0],e=tr().memoizedState;return[t,e]},useMutableSource:M1,useSyncExternalStore:j1,useId:J1,unstable_isNewReconciler:!1};function or(t,e){if(t&&t.defaultProps){e=jt({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Hh(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:jt({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var dd={isMounted:function(t){return(t=t._reactInternals)?Ri(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=In(),s=Ns(t),i=Kr(r,s);i.payload=e,n!=null&&(i.callback=n),e=Ls(t,i,s),e!==null&&(gr(e,t,s,r),Uc(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=In(),s=Ns(t),i=Kr(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=Ls(t,i,s),e!==null&&(gr(e,t,s,r),Uc(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=In(),r=Ns(t),s=Kr(n,r);s.tag=2,e!=null&&(s.callback=e),e=Ls(t,s,r),e!==null&&(gr(e,t,r,n),Uc(e,t,r))}};function vy(t,e,n,r,s,i,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!nl(n,r)||!nl(s,i):!0}function tx(t,e,n){var r=!1,s=Gs,i=e.contextType;return typeof i=="object"&&i!==null?i=er(i):(s=Mn(e)?yi:gn.current,r=e.contextTypes,i=(r=r!=null)?Co(t,s):Gs),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=dd,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function _y(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&dd.enqueueReplaceState(e,e.state,null)}function Wh(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},fg(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=er(i):(i=Mn(e)?yi:gn.current,s.context=Co(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(Hh(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&dd.enqueueReplaceState(s,s.state,null),Eu(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function Ro(t,e){try{var n="",r=e;do n+=FI(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function Gf(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Gh(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var fC=typeof WeakMap=="function"?WeakMap:Map;function nx(t,e,n){n=Kr(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Cu||(Cu=!0,tp=r),Gh(t,e)},n}function rx(t,e,n){n=Kr(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){Gh(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){Gh(t,e),typeof r!="function"&&(Ds===null?Ds=new Set([this]):Ds.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function xy(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new fC;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=CC.bind(null,t,e,n),e.then(t,t))}function Ey(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function by(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Kr(-1,1),e.tag=2,Ls(n,e,1))),n.lanes|=1),t)}var hC=ss.ReactCurrentOwner,Ln=!1;function bn(t,e,n,r){e.child=t===null?O1(e,null,n,r):ko(e,t.child,n,r)}function Sy(t,e,n,r,s){n=n.render;var i=e.ref;return mo(e,s),r=yg(t,e,n,r,i,s),n=vg(),t!==null&&!Ln?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Zr(t,e,s)):(Pt&&n&&ig(e),e.flags|=1,bn(t,e,r,s),e.child)}function Iy(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!kg(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,sx(t,e,i,r,s)):(t=Vc(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var o=i.memoizedProps;if(n=n.compare,n=n!==null?n:nl,n(o,r)&&t.ref===e.ref)return Zr(t,e,s)}return e.flags|=1,t=Ms(i,r),t.ref=e.ref,t.return=e,e.child=t}function sx(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(nl(i,r)&&t.ref===e.ref)if(Ln=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(Ln=!0);else return e.lanes=t.lanes,Zr(t,e,s)}return Vh(t,e,n,r,s)}function ix(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},wt(lo,Un),Un|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,wt(lo,Un),Un|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,wt(lo,Un),Un|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,wt(lo,Un),Un|=r;return bn(t,e,s,n),e.child}function ox(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Vh(t,e,n,r,s){var i=Mn(n)?yi:gn.current;return i=Co(e,i),mo(e,s),n=yg(t,e,n,r,i,s),r=vg(),t!==null&&!Ln?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Zr(t,e,s)):(Pt&&r&&ig(e),e.flags|=1,bn(t,e,n,s),e.child)}function Ty(t,e,n,r,s){if(Mn(n)){var i=!0;mu(e)}else i=!1;if(mo(e,s),e.stateNode===null)Hc(t,e),tx(e,n,r),Wh(e,n,r,s),r=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var c=o.context,u=n.contextType;typeof u=="object"&&u!==null?u=er(u):(u=Mn(n)?yi:gn.current,u=Co(e,u));var d=n.getDerivedStateFromProps,h=typeof d=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||c!==u)&&_y(e,o,r,u),ms=!1;var f=e.memoizedState;o.state=f,Eu(e,r,o,s),c=e.memoizedState,a!==r||f!==c||Nn.current||ms?(typeof d=="function"&&(Hh(e,n,d,r),c=e.memoizedState),(a=ms||vy(e,n,a,r,f,c,u))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),o.props=r,o.state=c,o.context=u,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,D1(t,e),a=e.memoizedProps,u=e.type===e.elementType?a:or(e.type,a),o.props=u,h=e.pendingProps,f=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=er(c):(c=Mn(n)?yi:gn.current,c=Co(e,c));var E=n.getDerivedStateFromProps;(d=typeof E=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==h||f!==c)&&_y(e,o,r,c),ms=!1,f=e.memoizedState,o.state=f,Eu(e,r,o,s);var k=e.memoizedState;a!==h||f!==k||Nn.current||ms?(typeof E=="function"&&(Hh(e,n,E,r),k=e.memoizedState),(u=ms||vy(e,n,u,r,f,k,c)||!1)?(d||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,k,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,k,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=k),o.props=r,o.state=k,o.context=c,r=u):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),r=!1)}return Yh(t,e,n,r,i,s)}function Yh(t,e,n,r,s,i){ox(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&uy(e,n,!1),Zr(t,e,i);r=e.stateNode,hC.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=ko(e,t.child,null,i),e.child=ko(e,null,a,i)):bn(t,e,a,i),e.memoizedState=r.state,s&&uy(e,n,!0),e.child}function ax(t){var e=t.stateNode;e.pendingContext?cy(t,e.pendingContext,e.pendingContext!==e.context):e.context&&cy(t,e.context,!1),hg(t,e.containerInfo)}function Cy(t,e,n,r,s){return wo(),ag(s),e.flags|=256,bn(t,e,n,r),e.child}var Kh={dehydrated:null,treeContext:null,retryLane:0};function Xh(t){return{baseLanes:t,cachePool:null,transitions:null}}function lx(t,e,n){var r=e.pendingProps,s=Lt.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(s&2)!==0),a?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),wt(Lt,s&1),t===null)return Bh(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=pd(o,r,0,null),t=mi(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=Xh(n),e.memoizedState=Kh,t):Eg(e,o));if(s=t.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return pC(t,e,o,r,a,s,n);if(i){i=r.fallback,o=e.mode,s=t.child,a=s.sibling;var c={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=Ms(s,c),r.subtreeFlags=s.subtreeFlags&14680064),a!==null?i=Ms(a,i):(i=mi(i,o,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=t.child.memoizedState,o=o===null?Xh(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=t.childLanes&~n,e.memoizedState=Kh,r}return i=t.child,t=i.sibling,r=Ms(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function Eg(t,e){return e=pd({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function bc(t,e,n,r){return r!==null&&ag(r),ko(e,t.child,null,n),t=Eg(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function pC(t,e,n,r,s,i,o){if(n)return e.flags&256?(e.flags&=-257,r=Gf(Error(le(422))),bc(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=pd({mode:"visible",children:r.children},s,0,null),i=mi(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&ko(e,t.child,null,o),e.child.memoizedState=Xh(o),e.memoizedState=Kh,i);if(!(e.mode&1))return bc(t,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var a=r.dgst;return r=a,i=Error(le(419)),r=Gf(i,r,void 0),bc(t,e,o,r)}if(a=(o&t.childLanes)!==0,Ln||a){if(r=Zt,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,qr(t,s),gr(r,t,s,-1))}return wg(),r=Gf(Error(le(421))),bc(t,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=wC.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,Bn=Os(s.nextSibling),zn=e,Pt=!0,lr=null,t!==null&&(Xn[Qn++]=Br,Xn[Qn++]=zr,Xn[Qn++]=vi,Br=t.id,zr=t.overflow,vi=e),e=Eg(e,r.children),e.flags|=4096,e)}function wy(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),zh(t.return,e,n)}function Vf(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function cx(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(bn(t,e,r.children,n),r=Lt.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&wy(t,n,e);else if(t.tag===19)wy(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(wt(Lt,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&bu(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),Vf(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&bu(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}Vf(e,!0,n,null,i);break;case"together":Vf(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Hc(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Zr(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),xi|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(le(153));if(e.child!==null){for(t=e.child,n=Ms(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Ms(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function gC(t,e,n){switch(e.tag){case 3:ax(e),wo();break;case 5:N1(e);break;case 1:Mn(e.type)&&mu(e);break;case 4:hg(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;wt(_u,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(wt(Lt,Lt.current&1),e.flags|=128,null):n&e.child.childLanes?lx(t,e,n):(wt(Lt,Lt.current&1),t=Zr(t,e,n),t!==null?t.sibling:null);wt(Lt,Lt.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return cx(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),wt(Lt,Lt.current),r)break;return null;case 22:case 23:return e.lanes=0,ix(t,e,n)}return Zr(t,e,n)}var ux,Qh,dx,fx;ux=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Qh=function(){};dx=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,hi(Ar.current);var i=null;switch(n){case"input":s=vh(t,s),r=vh(t,r),i=[];break;case"select":s=jt({},s,{value:void 0}),r=jt({},r,{value:void 0}),i=[];break;case"textarea":s=Eh(t,s),r=Eh(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=pu)}Sh(n,r);var o;n=null;for(u in s)if(!r.hasOwnProperty(u)&&s.hasOwnProperty(u)&&s[u]!=null)if(u==="style"){var a=s[u];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Xa.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in r){var c=r[u];if(a=s!=null?s[u]:void 0,r.hasOwnProperty(u)&&c!==a&&(c!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&a[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(i||(i=[]),i.push(u,n)),n=c;else u==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,a=a?a.__html:void 0,c!=null&&a!==c&&(i=i||[]).push(u,c)):u==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(u,""+c):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Xa.hasOwnProperty(u)?(c!=null&&u==="onScroll"&&kt("scroll",t),i||a===c||(i=[])):(i=i||[]).push(u,c))}n&&(i=i||[]).push("style",n);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};fx=function(t,e,n,r){n!==r&&(e.flags|=4)};function ma(t,e){if(!Pt)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function fn(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function mC(t,e,n){var r=e.pendingProps;switch(og(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return fn(e),null;case 1:return Mn(e.type)&&gu(),fn(e),null;case 3:return r=e.stateNode,Ao(),At(Nn),At(gn),gg(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(xc(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,lr!==null&&(sp(lr),lr=null))),Qh(t,e),fn(e),null;case 5:pg(e);var s=hi(al.current);if(n=e.type,t!==null&&e.stateNode!=null)dx(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(le(166));return fn(e),null}if(t=hi(Ar.current),xc(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[Cr]=e,r[il]=i,t=(e.mode&1)!==0,n){case"dialog":kt("cancel",r),kt("close",r);break;case"iframe":case"object":case"embed":kt("load",r);break;case"video":case"audio":for(s=0;s<wa.length;s++)kt(wa[s],r);break;case"source":kt("error",r);break;case"img":case"image":case"link":kt("error",r),kt("load",r);break;case"details":kt("toggle",r);break;case"input":Mm(r,i),kt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},kt("invalid",r);break;case"textarea":$m(r,i),kt("invalid",r)}Sh(n,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?r.textContent!==a&&(i.suppressHydrationWarning!==!0&&_c(r.textContent,a,t),s=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&_c(r.textContent,a,t),s=["children",""+a]):Xa.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&kt("scroll",r)}switch(n){case"input":dc(r),jm(r,i,!0);break;case"textarea":dc(r),Fm(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=pu)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=U_(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[Cr]=e,t[il]=r,ux(t,e,!1,!1),e.stateNode=t;e:{switch(o=Ih(n,r),n){case"dialog":kt("cancel",t),kt("close",t),s=r;break;case"iframe":case"object":case"embed":kt("load",t),s=r;break;case"video":case"audio":for(s=0;s<wa.length;s++)kt(wa[s],t);s=r;break;case"source":kt("error",t),s=r;break;case"img":case"image":case"link":kt("error",t),kt("load",t),s=r;break;case"details":kt("toggle",t),s=r;break;case"input":Mm(t,r),s=vh(t,r),kt("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=jt({},r,{value:void 0}),kt("invalid",t);break;case"textarea":$m(t,r),s=Eh(t,r),kt("invalid",t);break;default:s=r}Sh(n,s),a=s;for(i in a)if(a.hasOwnProperty(i)){var c=a[i];i==="style"?H_(t,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&B_(t,c)):i==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&Qa(t,c):typeof c=="number"&&Qa(t,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Xa.hasOwnProperty(i)?c!=null&&i==="onScroll"&&kt("scroll",t):c!=null&&Gp(t,i,c,o))}switch(n){case"input":dc(t),jm(t,r,!1);break;case"textarea":dc(t),Fm(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Ws(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?fo(t,!!r.multiple,i,!1):r.defaultValue!=null&&fo(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=pu)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return fn(e),null;case 6:if(t&&e.stateNode!=null)fx(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(le(166));if(n=hi(al.current),hi(Ar.current),xc(e)){if(r=e.stateNode,n=e.memoizedProps,r[Cr]=e,(i=r.nodeValue!==n)&&(t=zn,t!==null))switch(t.tag){case 3:_c(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&_c(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Cr]=e,e.stateNode=r}return fn(e),null;case 13:if(At(Lt),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Pt&&Bn!==null&&e.mode&1&&!(e.flags&128))R1(),wo(),e.flags|=98560,i=!1;else if(i=xc(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(le(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(le(317));i[Cr]=e}else wo(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;fn(e),i=!1}else lr!==null&&(sp(lr),lr=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||Lt.current&1?Kt===0&&(Kt=3):wg())),e.updateQueue!==null&&(e.flags|=4),fn(e),null);case 4:return Ao(),Qh(t,e),t===null&&rl(e.stateNode.containerInfo),fn(e),null;case 10:return ug(e.type._context),fn(e),null;case 17:return Mn(e.type)&&gu(),fn(e),null;case 19:if(At(Lt),i=e.memoizedState,i===null)return fn(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)ma(i,!1);else{if(Kt!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=bu(t),o!==null){for(e.flags|=128,ma(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,t=o.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return wt(Lt,Lt.current&1|2),e.child}t=t.sibling}i.tail!==null&&Ut()>Po&&(e.flags|=128,r=!0,ma(i,!1),e.lanes=4194304)}else{if(!r)if(t=bu(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),ma(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!Pt)return fn(e),null}else 2*Ut()-i.renderingStartTime>Po&&n!==1073741824&&(e.flags|=128,r=!0,ma(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(n=i.last,n!==null?n.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Ut(),e.sibling=null,n=Lt.current,wt(Lt,r?n&1|2:n&1),e):(fn(e),null);case 22:case 23:return Cg(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Un&1073741824&&(fn(e),e.subtreeFlags&6&&(e.flags|=8192)):fn(e),null;case 24:return null;case 25:return null}throw Error(le(156,e.tag))}function yC(t,e){switch(og(e),e.tag){case 1:return Mn(e.type)&&gu(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Ao(),At(Nn),At(gn),gg(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return pg(e),null;case 13:if(At(Lt),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(le(340));wo()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return At(Lt),null;case 4:return Ao(),null;case 10:return ug(e.type._context),null;case 22:case 23:return Cg(),null;case 24:return null;default:return null}}var Sc=!1,pn=!1,vC=typeof WeakSet=="function"?WeakSet:Set,_e=null;function ao(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){Ft(t,e,r)}else n.current=null}function Jh(t,e,n){try{n()}catch(r){Ft(t,e,r)}}var ky=!1;function _C(t,e){if(Dh=du,t=y1(),sg(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var o=0,a=-1,c=-1,u=0,d=0,h=t,f=null;t:for(;;){for(var E;h!==n||s!==0&&h.nodeType!==3||(a=o+s),h!==i||r!==0&&h.nodeType!==3||(c=o+r),h.nodeType===3&&(o+=h.nodeValue.length),(E=h.firstChild)!==null;)f=h,h=E;for(;;){if(h===t)break t;if(f===n&&++u===s&&(a=o),f===i&&++d===r&&(c=o),(E=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=E}n=a===-1||c===-1?null:{start:a,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Nh={focusedElem:t,selectionRange:n},du=!1,_e=e;_e!==null;)if(e=_e,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,_e=t;else for(;_e!==null;){e=_e;try{var k=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(k!==null){var P=k.memoizedProps,G=k.memoizedState,x=e.stateNode,S=x.getSnapshotBeforeUpdate(e.elementType===e.type?P:or(e.type,P),G);x.__reactInternalSnapshotBeforeUpdate=S}break;case 3:var w=e.stateNode.containerInfo;w.nodeType===1?w.textContent="":w.nodeType===9&&w.documentElement&&w.removeChild(w.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(le(163))}}catch(p){Ft(e,e.return,p)}if(t=e.sibling,t!==null){t.return=e.return,_e=t;break}_e=e.return}return k=ky,ky=!1,k}function Na(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&Jh(e,n,i)}s=s.next}while(s!==r)}}function fd(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function qh(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function hx(t){var e=t.alternate;e!==null&&(t.alternate=null,hx(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Cr],delete e[il],delete e[$h],delete e[tC],delete e[nC])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function px(t){return t.tag===5||t.tag===3||t.tag===4}function Ay(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||px(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Zh(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=pu));else if(r!==4&&(t=t.child,t!==null))for(Zh(t,e,n),t=t.sibling;t!==null;)Zh(t,e,n),t=t.sibling}function ep(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(ep(t,e,n),t=t.sibling;t!==null;)ep(t,e,n),t=t.sibling}var sn=null,ar=!1;function hs(t,e,n){for(n=n.child;n!==null;)gx(t,e,n),n=n.sibling}function gx(t,e,n){if(kr&&typeof kr.onCommitFiberUnmount=="function")try{kr.onCommitFiberUnmount(sd,n)}catch{}switch(n.tag){case 5:pn||ao(n,e);case 6:var r=sn,s=ar;sn=null,hs(t,e,n),sn=r,ar=s,sn!==null&&(ar?(t=sn,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):sn.removeChild(n.stateNode));break;case 18:sn!==null&&(ar?(t=sn,n=n.stateNode,t.nodeType===8?Ff(t.parentNode,n):t.nodeType===1&&Ff(t,n),el(t)):Ff(sn,n.stateNode));break;case 4:r=sn,s=ar,sn=n.stateNode.containerInfo,ar=!0,hs(t,e,n),sn=r,ar=s;break;case 0:case 11:case 14:case 15:if(!pn&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&Jh(n,e,o),s=s.next}while(s!==r)}hs(t,e,n);break;case 1:if(!pn&&(ao(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){Ft(n,e,a)}hs(t,e,n);break;case 21:hs(t,e,n);break;case 22:n.mode&1?(pn=(r=pn)||n.memoizedState!==null,hs(t,e,n),pn=r):hs(t,e,n);break;default:hs(t,e,n)}}function Ry(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new vC),e.forEach(function(r){var s=kC.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function ir(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:sn=a.stateNode,ar=!1;break e;case 3:sn=a.stateNode.containerInfo,ar=!0;break e;case 4:sn=a.stateNode.containerInfo,ar=!0;break e}a=a.return}if(sn===null)throw Error(le(160));gx(i,o,s),sn=null,ar=!1;var c=s.alternate;c!==null&&(c.return=null),s.return=null}catch(u){Ft(s,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)mx(e,t),e=e.sibling}function mx(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(ir(e,t),Ir(t),r&4){try{Na(3,t,t.return),fd(3,t)}catch(P){Ft(t,t.return,P)}try{Na(5,t,t.return)}catch(P){Ft(t,t.return,P)}}break;case 1:ir(e,t),Ir(t),r&512&&n!==null&&ao(n,n.return);break;case 5:if(ir(e,t),Ir(t),r&512&&n!==null&&ao(n,n.return),t.flags&32){var s=t.stateNode;try{Qa(s,"")}catch(P){Ft(t,t.return,P)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,o=n!==null?n.memoizedProps:i,a=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&$_(s,i),Ih(a,o);var u=Ih(a,i);for(o=0;o<c.length;o+=2){var d=c[o],h=c[o+1];d==="style"?H_(s,h):d==="dangerouslySetInnerHTML"?B_(s,h):d==="children"?Qa(s,h):Gp(s,d,h,u)}switch(a){case"input":_h(s,i);break;case"textarea":F_(s,i);break;case"select":var f=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var E=i.value;E!=null?fo(s,!!i.multiple,E,!1):f!==!!i.multiple&&(i.defaultValue!=null?fo(s,!!i.multiple,i.defaultValue,!0):fo(s,!!i.multiple,i.multiple?[]:"",!1))}s[il]=i}catch(P){Ft(t,t.return,P)}}break;case 6:if(ir(e,t),Ir(t),r&4){if(t.stateNode===null)throw Error(le(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(P){Ft(t,t.return,P)}}break;case 3:if(ir(e,t),Ir(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{el(e.containerInfo)}catch(P){Ft(t,t.return,P)}break;case 4:ir(e,t),Ir(t);break;case 13:ir(e,t),Ir(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(Ig=Ut())),r&4&&Ry(t);break;case 22:if(d=n!==null&&n.memoizedState!==null,t.mode&1?(pn=(u=pn)||d,ir(e,t),pn=u):ir(e,t),Ir(t),r&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!d&&t.mode&1)for(_e=t,d=t.child;d!==null;){for(h=_e=d;_e!==null;){switch(f=_e,E=f.child,f.tag){case 0:case 11:case 14:case 15:Na(4,f,f.return);break;case 1:ao(f,f.return);var k=f.stateNode;if(typeof k.componentWillUnmount=="function"){r=f,n=f.return;try{e=r,k.props=e.memoizedProps,k.state=e.memoizedState,k.componentWillUnmount()}catch(P){Ft(r,n,P)}}break;case 5:ao(f,f.return);break;case 22:if(f.memoizedState!==null){Oy(h);continue}}E!==null?(E.return=f,_e=E):Oy(h)}d=d.sibling}e:for(d=null,h=t;;){if(h.tag===5){if(d===null){d=h;try{s=h.stateNode,u?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=h.stateNode,c=h.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,a.style.display=z_("display",o))}catch(P){Ft(t,t.return,P)}}}else if(h.tag===6){if(d===null)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(P){Ft(t,t.return,P)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===t)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===t)break e;for(;h.sibling===null;){if(h.return===null||h.return===t)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:ir(e,t),Ir(t),r&4&&Ry(t);break;case 21:break;default:ir(e,t),Ir(t)}}function Ir(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(px(n)){var r=n;break e}n=n.return}throw Error(le(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(Qa(s,""),r.flags&=-33);var i=Ay(t);ep(t,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,a=Ay(t);Zh(t,a,o);break;default:throw Error(le(161))}}catch(c){Ft(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function xC(t,e,n){_e=t,yx(t)}function yx(t,e,n){for(var r=(t.mode&1)!==0;_e!==null;){var s=_e,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||Sc;if(!o){var a=s.alternate,c=a!==null&&a.memoizedState!==null||pn;a=Sc;var u=pn;if(Sc=o,(pn=c)&&!u)for(_e=s;_e!==null;)o=_e,c=o.child,o.tag===22&&o.memoizedState!==null?Ly(s):c!==null?(c.return=o,_e=c):Ly(s);for(;i!==null;)_e=i,yx(i),i=i.sibling;_e=s,Sc=a,pn=u}Py(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,_e=i):Py(t)}}function Py(t){for(;_e!==null;){var e=_e;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:pn||fd(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!pn)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:or(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&gy(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}gy(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var d=u.memoizedState;if(d!==null){var h=d.dehydrated;h!==null&&el(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(le(163))}pn||e.flags&512&&qh(e)}catch(f){Ft(e,e.return,f)}}if(e===t){_e=null;break}if(n=e.sibling,n!==null){n.return=e.return,_e=n;break}_e=e.return}}function Oy(t){for(;_e!==null;){var e=_e;if(e===t){_e=null;break}var n=e.sibling;if(n!==null){n.return=e.return,_e=n;break}_e=e.return}}function Ly(t){for(;_e!==null;){var e=_e;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{fd(4,e)}catch(c){Ft(e,n,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(c){Ft(e,s,c)}}var i=e.return;try{qh(e)}catch(c){Ft(e,i,c)}break;case 5:var o=e.return;try{qh(e)}catch(c){Ft(e,o,c)}}}catch(c){Ft(e,e.return,c)}if(e===t){_e=null;break}var a=e.sibling;if(a!==null){a.return=e.return,_e=a;break}_e=e.return}}var EC=Math.ceil,Tu=ss.ReactCurrentDispatcher,bg=ss.ReactCurrentOwner,Zn=ss.ReactCurrentBatchConfig,ut=0,Zt=null,Ht=null,on=0,Un=0,lo=qs(0),Kt=0,dl=null,xi=0,hd=0,Sg=0,Ma=null,On=null,Ig=0,Po=1/0,$r=null,Cu=!1,tp=null,Ds=null,Ic=!1,Ts=null,wu=0,ja=0,np=null,Wc=-1,Gc=0;function In(){return ut&6?Ut():Wc!==-1?Wc:Wc=Ut()}function Ns(t){return t.mode&1?ut&2&&on!==0?on&-on:sC.transition!==null?(Gc===0&&(Gc=t1()),Gc):(t=yt,t!==0||(t=window.event,t=t===void 0?16:l1(t.type)),t):1}function gr(t,e,n,r){if(50<ja)throw ja=0,np=null,Error(le(185));Tl(t,n,r),(!(ut&2)||t!==Zt)&&(t===Zt&&(!(ut&2)&&(hd|=n),Kt===4&&vs(t,on)),jn(t,r),n===1&&ut===0&&!(e.mode&1)&&(Po=Ut()+500,cd&&Zs()))}function jn(t,e){var n=t.callbackNode;sT(t,e);var r=uu(t,t===Zt?on:0);if(r===0)n!==null&&zm(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&zm(n),e===1)t.tag===0?rC(Dy.bind(null,t)):w1(Dy.bind(null,t)),ZT(function(){!(ut&6)&&Zs()}),n=null;else{switch(n1(r)){case 1:n=Qp;break;case 4:n=Z_;break;case 16:n=cu;break;case 536870912:n=e1;break;default:n=cu}n=Tx(n,vx.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function vx(t,e){if(Wc=-1,Gc=0,ut&6)throw Error(le(327));var n=t.callbackNode;if(yo()&&t.callbackNode!==n)return null;var r=uu(t,t===Zt?on:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=ku(t,r);else{e=r;var s=ut;ut|=2;var i=xx();(Zt!==t||on!==e)&&($r=null,Po=Ut()+500,gi(t,e));do try{IC();break}catch(a){_x(t,a)}while(!0);cg(),Tu.current=i,ut=s,Ht!==null?e=0:(Zt=null,on=0,e=Kt)}if(e!==0){if(e===2&&(s=Ah(t),s!==0&&(r=s,e=rp(t,s))),e===1)throw n=dl,gi(t,0),vs(t,r),jn(t,Ut()),n;if(e===6)vs(t,r);else{if(s=t.current.alternate,!(r&30)&&!bC(s)&&(e=ku(t,r),e===2&&(i=Ah(t),i!==0&&(r=i,e=rp(t,i))),e===1))throw n=dl,gi(t,0),vs(t,r),jn(t,Ut()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(le(345));case 2:ai(t,On,$r);break;case 3:if(vs(t,r),(r&130023424)===r&&(e=Ig+500-Ut(),10<e)){if(uu(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){In(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=jh(ai.bind(null,t,On,$r),e);break}ai(t,On,$r);break;case 4:if(vs(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var o=31-pr(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=Ut()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*EC(r/1960))-r,10<r){t.timeoutHandle=jh(ai.bind(null,t,On,$r),r);break}ai(t,On,$r);break;case 5:ai(t,On,$r);break;default:throw Error(le(329))}}}return jn(t,Ut()),t.callbackNode===n?vx.bind(null,t):null}function rp(t,e){var n=Ma;return t.current.memoizedState.isDehydrated&&(gi(t,e).flags|=256),t=ku(t,e),t!==2&&(e=On,On=n,e!==null&&sp(e)),t}function sp(t){On===null?On=t:On.push.apply(On,t)}function bC(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!yr(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function vs(t,e){for(e&=~Sg,e&=~hd,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-pr(e),r=1<<n;t[n]=-1,e&=~r}}function Dy(t){if(ut&6)throw Error(le(327));yo();var e=uu(t,0);if(!(e&1))return jn(t,Ut()),null;var n=ku(t,e);if(t.tag!==0&&n===2){var r=Ah(t);r!==0&&(e=r,n=rp(t,r))}if(n===1)throw n=dl,gi(t,0),vs(t,e),jn(t,Ut()),n;if(n===6)throw Error(le(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,ai(t,On,$r),jn(t,Ut()),null}function Tg(t,e){var n=ut;ut|=1;try{return t(e)}finally{ut=n,ut===0&&(Po=Ut()+500,cd&&Zs())}}function Ei(t){Ts!==null&&Ts.tag===0&&!(ut&6)&&yo();var e=ut;ut|=1;var n=Zn.transition,r=yt;try{if(Zn.transition=null,yt=1,t)return t()}finally{yt=r,Zn.transition=n,ut=e,!(ut&6)&&Zs()}}function Cg(){Un=lo.current,At(lo)}function gi(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,qT(n)),Ht!==null)for(n=Ht.return;n!==null;){var r=n;switch(og(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&gu();break;case 3:Ao(),At(Nn),At(gn),gg();break;case 5:pg(r);break;case 4:Ao();break;case 13:At(Lt);break;case 19:At(Lt);break;case 10:ug(r.type._context);break;case 22:case 23:Cg()}n=n.return}if(Zt=t,Ht=t=Ms(t.current,null),on=Un=e,Kt=0,dl=null,Sg=hd=xi=0,On=Ma=null,fi!==null){for(e=0;e<fi.length;e++)if(n=fi[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}n.pending=r}fi=null}return t}function _x(t,e){do{var n=Ht;try{if(cg(),Bc.current=Iu,Su){for(var r=Mt.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Su=!1}if(_i=0,Qt=Vt=Mt=null,Da=!1,ll=0,bg.current=null,n===null||n.return===null){Kt=1,dl=e,Ht=null;break}e:{var i=t,o=n.return,a=n,c=e;if(e=on,a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var u=c,d=a,h=d.tag;if(!(d.mode&1)&&(h===0||h===11||h===15)){var f=d.alternate;f?(d.updateQueue=f.updateQueue,d.memoizedState=f.memoizedState,d.lanes=f.lanes):(d.updateQueue=null,d.memoizedState=null)}var E=Ey(o);if(E!==null){E.flags&=-257,by(E,o,a,i,e),E.mode&1&&xy(i,u,e),e=E,c=u;var k=e.updateQueue;if(k===null){var P=new Set;P.add(c),e.updateQueue=P}else k.add(c);break e}else{if(!(e&1)){xy(i,u,e),wg();break e}c=Error(le(426))}}else if(Pt&&a.mode&1){var G=Ey(o);if(G!==null){!(G.flags&65536)&&(G.flags|=256),by(G,o,a,i,e),ag(Ro(c,a));break e}}i=c=Ro(c,a),Kt!==4&&(Kt=2),Ma===null?Ma=[i]:Ma.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var x=nx(i,c,e);py(i,x);break e;case 1:a=c;var S=i.type,w=i.stateNode;if(!(i.flags&128)&&(typeof S.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(Ds===null||!Ds.has(w)))){i.flags|=65536,e&=-e,i.lanes|=e;var p=rx(i,a,e);py(i,p);break e}}i=i.return}while(i!==null)}bx(n)}catch(b){e=b,Ht===n&&n!==null&&(Ht=n=n.return);continue}break}while(!0)}function xx(){var t=Tu.current;return Tu.current=Iu,t===null?Iu:t}function wg(){(Kt===0||Kt===3||Kt===2)&&(Kt=4),Zt===null||!(xi&268435455)&&!(hd&268435455)||vs(Zt,on)}function ku(t,e){var n=ut;ut|=2;var r=xx();(Zt!==t||on!==e)&&($r=null,gi(t,e));do try{SC();break}catch(s){_x(t,s)}while(!0);if(cg(),ut=n,Tu.current=r,Ht!==null)throw Error(le(261));return Zt=null,on=0,Kt}function SC(){for(;Ht!==null;)Ex(Ht)}function IC(){for(;Ht!==null&&!XI();)Ex(Ht)}function Ex(t){var e=Ix(t.alternate,t,Un);t.memoizedProps=t.pendingProps,e===null?bx(t):Ht=e,bg.current=null}function bx(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=yC(n,e),n!==null){n.flags&=32767,Ht=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Kt=6,Ht=null;return}}else if(n=mC(n,e,Un),n!==null){Ht=n;return}if(e=e.sibling,e!==null){Ht=e;return}Ht=e=t}while(e!==null);Kt===0&&(Kt=5)}function ai(t,e,n){var r=yt,s=Zn.transition;try{Zn.transition=null,yt=1,TC(t,e,n,r)}finally{Zn.transition=s,yt=r}return null}function TC(t,e,n,r){do yo();while(Ts!==null);if(ut&6)throw Error(le(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(le(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(iT(t,i),t===Zt&&(Ht=Zt=null,on=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Ic||(Ic=!0,Tx(cu,function(){return yo(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=Zn.transition,Zn.transition=null;var o=yt;yt=1;var a=ut;ut|=4,bg.current=null,_C(t,n),mx(n,t),GT(Nh),du=!!Dh,Nh=Dh=null,t.current=n,xC(n),QI(),ut=a,yt=o,Zn.transition=i}else t.current=n;if(Ic&&(Ic=!1,Ts=t,wu=s),i=t.pendingLanes,i===0&&(Ds=null),ZI(n.stateNode),jn(t,Ut()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(Cu)throw Cu=!1,t=tp,tp=null,t;return wu&1&&t.tag!==0&&yo(),i=t.pendingLanes,i&1?t===np?ja++:(ja=0,np=t):ja=0,Zs(),null}function yo(){if(Ts!==null){var t=n1(wu),e=Zn.transition,n=yt;try{if(Zn.transition=null,yt=16>t?16:t,Ts===null)var r=!1;else{if(t=Ts,Ts=null,wu=0,ut&6)throw Error(le(331));var s=ut;for(ut|=4,_e=t.current;_e!==null;){var i=_e,o=i.child;if(_e.flags&16){var a=i.deletions;if(a!==null){for(var c=0;c<a.length;c++){var u=a[c];for(_e=u;_e!==null;){var d=_e;switch(d.tag){case 0:case 11:case 15:Na(8,d,i)}var h=d.child;if(h!==null)h.return=d,_e=h;else for(;_e!==null;){d=_e;var f=d.sibling,E=d.return;if(hx(d),d===u){_e=null;break}if(f!==null){f.return=E,_e=f;break}_e=E}}}var k=i.alternate;if(k!==null){var P=k.child;if(P!==null){k.child=null;do{var G=P.sibling;P.sibling=null,P=G}while(P!==null)}}_e=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,_e=o;else e:for(;_e!==null;){if(i=_e,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Na(9,i,i.return)}var x=i.sibling;if(x!==null){x.return=i.return,_e=x;break e}_e=i.return}}var S=t.current;for(_e=S;_e!==null;){o=_e;var w=o.child;if(o.subtreeFlags&2064&&w!==null)w.return=o,_e=w;else e:for(o=S;_e!==null;){if(a=_e,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:fd(9,a)}}catch(b){Ft(a,a.return,b)}if(a===o){_e=null;break e}var p=a.sibling;if(p!==null){p.return=a.return,_e=p;break e}_e=a.return}}if(ut=s,Zs(),kr&&typeof kr.onPostCommitFiberRoot=="function")try{kr.onPostCommitFiberRoot(sd,t)}catch{}r=!0}return r}finally{yt=n,Zn.transition=e}}return!1}function Ny(t,e,n){e=Ro(n,e),e=nx(t,e,1),t=Ls(t,e,1),e=In(),t!==null&&(Tl(t,1,e),jn(t,e))}function Ft(t,e,n){if(t.tag===3)Ny(t,t,n);else for(;e!==null;){if(e.tag===3){Ny(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Ds===null||!Ds.has(r))){t=Ro(n,t),t=rx(e,t,1),e=Ls(e,t,1),t=In(),e!==null&&(Tl(e,1,t),jn(e,t));break}}e=e.return}}function CC(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=In(),t.pingedLanes|=t.suspendedLanes&n,Zt===t&&(on&n)===n&&(Kt===4||Kt===3&&(on&130023424)===on&&500>Ut()-Ig?gi(t,0):Sg|=n),jn(t,e)}function Sx(t,e){e===0&&(t.mode&1?(e=pc,pc<<=1,!(pc&130023424)&&(pc=4194304)):e=1);var n=In();t=qr(t,e),t!==null&&(Tl(t,e,n),jn(t,n))}function wC(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),Sx(t,n)}function kC(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(le(314))}r!==null&&r.delete(e),Sx(t,n)}var Ix;Ix=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Nn.current)Ln=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Ln=!1,gC(t,e,n);Ln=!!(t.flags&131072)}else Ln=!1,Pt&&e.flags&1048576&&k1(e,vu,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Hc(t,e),t=e.pendingProps;var s=Co(e,gn.current);mo(e,n),s=yg(null,e,r,t,s,n);var i=vg();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Mn(r)?(i=!0,mu(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,fg(e),s.updater=dd,e.stateNode=s,s._reactInternals=e,Wh(e,r,t,n),e=Yh(null,e,r,!0,i,n)):(e.tag=0,Pt&&i&&ig(e),bn(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(Hc(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=RC(r),t=or(r,t),s){case 0:e=Vh(null,e,r,t,n);break e;case 1:e=Ty(null,e,r,t,n);break e;case 11:e=Sy(null,e,r,t,n);break e;case 14:e=Iy(null,e,r,or(r.type,t),n);break e}throw Error(le(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:or(r,s),Vh(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:or(r,s),Ty(t,e,r,s,n);case 3:e:{if(ax(e),t===null)throw Error(le(387));r=e.pendingProps,i=e.memoizedState,s=i.element,D1(t,e),Eu(e,r,null,n);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=Ro(Error(le(423)),e),e=Cy(t,e,r,n,s);break e}else if(r!==s){s=Ro(Error(le(424)),e),e=Cy(t,e,r,n,s);break e}else for(Bn=Os(e.stateNode.containerInfo.firstChild),zn=e,Pt=!0,lr=null,n=O1(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(wo(),r===s){e=Zr(t,e,n);break e}bn(t,e,r,n)}e=e.child}return e;case 5:return N1(e),t===null&&Bh(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,o=s.children,Mh(r,s)?o=null:i!==null&&Mh(r,i)&&(e.flags|=32),ox(t,e),bn(t,e,o,n),e.child;case 6:return t===null&&Bh(e),null;case 13:return lx(t,e,n);case 4:return hg(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=ko(e,null,r,n):bn(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:or(r,s),Sy(t,e,r,s,n);case 7:return bn(t,e,e.pendingProps,n),e.child;case 8:return bn(t,e,e.pendingProps.children,n),e.child;case 12:return bn(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,wt(_u,r._currentValue),r._currentValue=o,i!==null)if(yr(i.value,o)){if(i.children===s.children&&!Nn.current){e=Zr(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var c=a.firstContext;c!==null;){if(c.context===r){if(i.tag===1){c=Kr(-1,n&-n),c.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var d=u.pending;d===null?c.next=c:(c.next=d.next,d.next=c),u.pending=c}}i.lanes|=n,c=i.alternate,c!==null&&(c.lanes|=n),zh(i.return,n,e),a.lanes|=n;break}c=c.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(le(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),zh(o,n,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}bn(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,mo(e,n),s=er(s),r=r(s),e.flags|=1,bn(t,e,r,n),e.child;case 14:return r=e.type,s=or(r,e.pendingProps),s=or(r.type,s),Iy(t,e,r,s,n);case 15:return sx(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:or(r,s),Hc(t,e),e.tag=1,Mn(r)?(t=!0,mu(e)):t=!1,mo(e,n),tx(e,r,s),Wh(e,r,s,n),Yh(null,e,r,!0,t,n);case 19:return cx(t,e,n);case 22:return ix(t,e,n)}throw Error(le(156,e.tag))};function Tx(t,e){return q_(t,e)}function AC(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Jn(t,e,n,r){return new AC(t,e,n,r)}function kg(t){return t=t.prototype,!(!t||!t.isReactComponent)}function RC(t){if(typeof t=="function")return kg(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Yp)return 11;if(t===Kp)return 14}return 2}function Ms(t,e){var n=t.alternate;return n===null?(n=Jn(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Vc(t,e,n,r,s,i){var o=2;if(r=t,typeof t=="function")kg(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case qi:return mi(n.children,s,i,e);case Vp:o=8,s|=8;break;case ph:return t=Jn(12,n,e,s|2),t.elementType=ph,t.lanes=i,t;case gh:return t=Jn(13,n,e,s),t.elementType=gh,t.lanes=i,t;case mh:return t=Jn(19,n,e,s),t.elementType=mh,t.lanes=i,t;case N_:return pd(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case L_:o=10;break e;case D_:o=9;break e;case Yp:o=11;break e;case Kp:o=14;break e;case gs:o=16,r=null;break e}throw Error(le(130,t==null?t:typeof t,""))}return e=Jn(o,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function mi(t,e,n,r){return t=Jn(7,t,r,e),t.lanes=n,t}function pd(t,e,n,r){return t=Jn(22,t,r,e),t.elementType=N_,t.lanes=n,t.stateNode={isHidden:!1},t}function Yf(t,e,n){return t=Jn(6,t,null,e),t.lanes=n,t}function Kf(t,e,n){return e=Jn(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function PC(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=kf(0),this.expirationTimes=kf(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=kf(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Ag(t,e,n,r,s,i,o,a,c){return t=new PC(t,e,n,a,c),e===1?(e=1,i===!0&&(e|=8)):e=0,i=Jn(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},fg(i),t}function OC(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ji,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function Cx(t){if(!t)return Gs;t=t._reactInternals;e:{if(Ri(t)!==t||t.tag!==1)throw Error(le(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Mn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(le(171))}if(t.tag===1){var n=t.type;if(Mn(n))return C1(t,n,e)}return e}function wx(t,e,n,r,s,i,o,a,c){return t=Ag(n,r,!0,t,s,i,o,a,c),t.context=Cx(null),n=t.current,r=In(),s=Ns(n),i=Kr(r,s),i.callback=e??null,Ls(n,i,s),t.current.lanes=s,Tl(t,s,r),jn(t,r),t}function gd(t,e,n,r){var s=e.current,i=In(),o=Ns(s);return n=Cx(n),e.context===null?e.context=n:e.pendingContext=n,e=Kr(i,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Ls(s,e,o),t!==null&&(gr(t,s,o,i),Uc(t,s,o)),o}function Au(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function My(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Rg(t,e){My(t,e),(t=t.alternate)&&My(t,e)}function LC(){return null}var kx=typeof reportError=="function"?reportError:function(t){console.error(t)};function Pg(t){this._internalRoot=t}md.prototype.render=Pg.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(le(409));gd(t,e,null,null)};md.prototype.unmount=Pg.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Ei(function(){gd(null,t,null,null)}),e[Jr]=null}};function md(t){this._internalRoot=t}md.prototype.unstable_scheduleHydration=function(t){if(t){var e=i1();t={blockedOn:null,target:t,priority:e};for(var n=0;n<ys.length&&e!==0&&e<ys[n].priority;n++);ys.splice(n,0,t),n===0&&a1(t)}};function Og(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function yd(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function jy(){}function DC(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var u=Au(o);i.call(u)}}var o=wx(e,r,t,0,null,!1,!1,"",jy);return t._reactRootContainer=o,t[Jr]=o.current,rl(t.nodeType===8?t.parentNode:t),Ei(),o}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var a=r;r=function(){var u=Au(c);a.call(u)}}var c=Ag(t,0,!1,null,null,!1,!1,"",jy);return t._reactRootContainer=c,t[Jr]=c.current,rl(t.nodeType===8?t.parentNode:t),Ei(function(){gd(e,c,n,r)}),c}function vd(t,e,n,r,s){var i=n._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var a=s;s=function(){var c=Au(o);a.call(c)}}gd(e,o,t,s)}else o=DC(n,e,t,s,r);return Au(o)}r1=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Ca(e.pendingLanes);n!==0&&(Jp(e,n|1),jn(e,Ut()),!(ut&6)&&(Po=Ut()+500,Zs()))}break;case 13:Ei(function(){var r=qr(t,1);if(r!==null){var s=In();gr(r,t,1,s)}}),Rg(t,1)}};qp=function(t){if(t.tag===13){var e=qr(t,134217728);if(e!==null){var n=In();gr(e,t,134217728,n)}Rg(t,134217728)}};s1=function(t){if(t.tag===13){var e=Ns(t),n=qr(t,e);if(n!==null){var r=In();gr(n,t,e,r)}Rg(t,e)}};i1=function(){return yt};o1=function(t,e){var n=yt;try{return yt=t,e()}finally{yt=n}};Ch=function(t,e,n){switch(e){case"input":if(_h(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=ld(r);if(!s)throw Error(le(90));j_(r),_h(r,s)}}}break;case"textarea":F_(t,n);break;case"select":e=n.value,e!=null&&fo(t,!!n.multiple,e,!1)}};V_=Tg;Y_=Ei;var NC={usingClientEntryPoint:!1,Events:[wl,no,ld,W_,G_,Tg]},ya={findFiberByHostInstance:di,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},MC={bundleType:ya.bundleType,version:ya.version,rendererPackageName:ya.rendererPackageName,rendererConfig:ya.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ss.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Q_(t),t===null?null:t.stateNode},findFiberByHostInstance:ya.findFiberByHostInstance||LC,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Tc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Tc.isDisabled&&Tc.supportsFiber)try{sd=Tc.inject(MC),kr=Tc}catch{}}Gn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=NC;Gn.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Og(e))throw Error(le(200));return OC(t,e,null,n)};Gn.createRoot=function(t,e){if(!Og(t))throw Error(le(299));var n=!1,r="",s=kx;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=Ag(t,1,!1,null,null,n,!1,r,s),t[Jr]=e.current,rl(t.nodeType===8?t.parentNode:t),new Pg(e)};Gn.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(le(188)):(t=Object.keys(t).join(","),Error(le(268,t)));return t=Q_(e),t=t===null?null:t.stateNode,t};Gn.flushSync=function(t){return Ei(t)};Gn.hydrate=function(t,e,n){if(!yd(e))throw Error(le(200));return vd(null,t,e,!0,n)};Gn.hydrateRoot=function(t,e,n){if(!Og(t))throw Error(le(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",o=kx;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=wx(e,null,t,1,n??null,s,!1,i,o),t[Jr]=e.current,rl(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new md(e)};Gn.render=function(t,e,n){if(!yd(e))throw Error(le(200));return vd(null,t,e,!1,n)};Gn.unmountComponentAtNode=function(t){if(!yd(t))throw Error(le(40));return t._reactRootContainer?(Ei(function(){vd(null,null,t,!1,function(){t._reactRootContainer=null,t[Jr]=null})}),!0):!1};Gn.unstable_batchedUpdates=Tg;Gn.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!yd(n))throw Error(le(200));if(t==null||t._reactInternals===void 0)throw Error(le(38));return vd(t,e,n,!1,r)};Gn.version="18.3.1-next-f1338f8080-20240426";function Ax(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Ax)}catch(t){console.error(t)}}Ax(),A_.exports=Gn;var jC=A_.exports,$y=jC;fh.createRoot=$y.createRoot,fh.hydrateRoot=$y.hydrateRoot;const va=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},$C=1280,FC=720,UC=({onStartConfig:t,audioSettings:e,onAudioSettingsChange:n,playerId:r})=>{const[s,i]=F.useState("title"),[o,a]=F.useState(!1),[c,u]=F.useState("home"),[d,h]=F.useState(!1),[f,E]=F.useState(""),[k]=F.useState(()=>localStorage.getItem("homeCardId")),[P,G]=F.useState(25),[x,S]=F.useState(!1),w=F.useRef(0),p=F.useRef(0),[b,H]=F.useState(1);F.useEffect(()=>{const B=()=>{const O=window.innerWidth/$C,T=window.innerHeight/FC;H(Math.min(O,T))};return B(),window.addEventListener("resize",B),()=>window.removeEventListener("resize",B)},[]);const re=()=>{a(!0),setTimeout(()=>{i("home"),a(!1)},600)},K=B=>{S(!0),w.current=B.clientX,p.current=P},Q=B=>{if(!x)return;const O=B.clientX-w.current,T=p.current+O*.5;G(Math.max(-180,Math.min(180,T)))},ce=()=>{S(!1)},me=B=>{t(B==="casual"?"CASUAL_MATCH":"RANKED_MATCH")},Se=9*b;if(s==="title")return l.jsxs("div",{className:"screen title-screen",onClick:re,style:{height:"100dvh",width:"100vw",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative",overflow:"hidden",color:"white",cursor:"pointer"},children:[l.jsx("div",{style:{position:"absolute",inset:0,backgroundImage:`url(${va("/title/background.png")})`,backgroundSize:"cover",backgroundPosition:"center",zIndex:0}}),l.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",zIndex:-1}}),l.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(0, 0, 0, 0.3)",zIndex:1}}),l.jsxs("div",{style:{position:"relative",zIndex:2,display:"flex",flexDirection:"column",alignItems:"center",transform:o?"translateY(-100vh)":"translateY(0)",transition:o?"transform 0.6s ease-in":"none"},children:[l.jsx("div",{style:{fontFamily:"Tamanegi, sans-serif",fontSize:`${Se}rem`,color:"#fff",textShadow:"0 0 30px rgba(233, 69, 96, 0.9), 0 0 60px rgba(233, 69, 96, 0.5), 3px 3px 6px rgba(0,0,0,0.9)",letterSpacing:`${.5*b}rem`,whiteSpace:"nowrap",marginBottom:`${2*b}rem`},children:""}),l.jsx("div",{style:{fontSize:`${2*b}rem`,color:"#fff",fontWeight:"bold",letterSpacing:`${.3*b}rem`,animation:"blink 1.5s ease-in-out infinite",textShadow:"0 0 10px rgba(255, 255, 255, 0.8)"},children:"GAME START"})]}),l.jsx("p",{style:{position:"absolute",bottom:20*b,opacity:.5,fontSize:`${.8*b}rem`,zIndex:2},children:"Ver 1.04 Beta"}),l.jsx("style",{children:`
                    @keyframes blink {
                        0%, 100% { opacity: 1; }
                        50% { opacity: 0.3; }
                    }
                `})]});const de=[{id:"solo",label:"",color:"#e94560"},{id:"room",label:"",color:"#60a5fa"},{id:"random",label:"",color:"#4ade80"},{id:"home",label:"",color:"#f59e0b"},{id:"ranking",label:"",color:"#a855f7"},{id:"gallery",label:"",color:"#ec4899"},{id:"settings",label:"",color:"#6b7280"}];return l.jsxs("div",{className:"screen home-screen",style:{height:"100dvh",width:"100vw",display:"flex",flexDirection:"column",position:"relative",overflow:"hidden",color:"white"},onMouseMove:Q,onMouseUp:ce,onMouseLeave:ce,children:[l.jsx("div",{style:{position:"absolute",inset:0,backgroundImage:`url(${va("/title/background.png")})`,backgroundSize:"cover",backgroundPosition:"center",zIndex:0}}),l.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",zIndex:-1}}),l.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(0, 0, 0, 0.5)",zIndex:1}}),l.jsx("div",{style:{position:"absolute",top:20*b,left:"50%",transform:"translateX(-50%)",fontFamily:"Tamanegi, sans-serif",fontSize:`${2.5*b}rem`,color:"#fff",textShadow:"0 0 15px rgba(233, 69, 96, 0.7)",letterSpacing:`${.2*b}rem`,zIndex:10},children:""}),l.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",paddingBottom:80*b,position:"relative",zIndex:2},children:[c==="home"&&l.jsxs("div",{style:{position:"absolute",left:50*b,top:"50%",transform:"translateY(-50%)",perspective:1e3},children:[l.jsxs("div",{onMouseDown:K,style:{width:200*b,height:280*b,transformStyle:"preserve-3d",transform:`rotateY(${P}deg)`,transition:x?"none":"transform 0.3s ease-out",cursor:x?"grabbing":"grab"},children:[l.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",borderRadius:12*b,background:k?`url(${va(`/cards/${k}.png`)})`:"linear-gradient(135deg, #2d3748 0%, #1a202c 100%)",backgroundSize:"cover",backgroundPosition:"center",border:`3px solid ${k?"#e94560":"#4a5568"}`,boxShadow:"0 10px 30px rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center"},children:!k&&l.jsxs("span",{style:{fontSize:`${.9*b}rem`,color:"#718096",textAlign:"center",padding:20*b},children:["",l.jsx("br",{}),"",l.jsx("br",{}),""]})}),l.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",transform:"rotateY(180deg)",borderRadius:12*b,background:k?`url(${va(`/cards/${k}_evolved.png`)})`:`url(${va("/cards/sleeve_default.png")})`,backgroundSize:"cover",backgroundPosition:"center",border:`3px solid ${k?"#a855f7":"#4a5568"}`,boxShadow:"0 10px 30px rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center"},children:!k&&l.jsx("span",{style:{fontSize:`${.8*b}rem`,color:"#718096"},children:""})})]}),l.jsx("p",{style:{textAlign:"center",marginTop:10*b,fontSize:`${.75*b}rem`,color:"#888"},children:""})]}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",maxWidth:600*b},children:[c==="home"&&l.jsxs("div",{style:{textAlign:"center"},children:[l.jsx("h2",{style:{fontSize:`${1.8*b}rem`,marginBottom:`${1*b}rem`},children:""}),l.jsx("p",{style:{fontSize:`${1*b}rem`,color:"#aaa"},children:""})]}),c==="solo"&&l.jsxs("div",{style:{textAlign:"center"},children:[l.jsx("h2",{style:{fontSize:`${1.8*b}rem`,marginBottom:`${1*b}rem`,color:"#e94560"},children:""}),l.jsx("button",{onClick:()=>t("CPU"),style:{padding:`${1*b}rem ${3*b}rem`,fontSize:`${1.2*b}rem`,background:"#e94560",border:"none",borderRadius:8*b,color:"white",cursor:"pointer",fontWeight:"bold"},children:"CPU"})]}),c==="room"&&l.jsxs("div",{style:{textAlign:"center"},children:[l.jsx("h2",{style:{fontSize:`${1.8*b}rem`,marginBottom:`${1.5*b}rem`,color:"#60a5fa"},children:""}),d?l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:`${1*b}rem`,alignItems:"center"},children:[l.jsx("input",{type:"text",placeholder:"ID",value:f,onChange:B=>E(B.target.value),style:{padding:`${.8*b}rem`,fontSize:`${1*b}rem`,width:250*b,background:"rgba(255,255,255,0.1)",border:"2px solid #a855f7",borderRadius:8*b,color:"white",textAlign:"center"}}),l.jsxs("div",{style:{display:"flex",gap:`${.5*b}rem`},children:[l.jsx("button",{onClick:()=>h(!1),style:{padding:`${.6*b}rem ${1.5*b}rem`,fontSize:`${1*b}rem`,background:"transparent",border:"1px solid #666",borderRadius:6*b,color:"#888",cursor:"pointer"},children:""}),l.jsx("button",{onClick:()=>t("JOIN",f),disabled:!f,style:{padding:`${.6*b}rem ${1.5*b}rem`,fontSize:`${1*b}rem`,background:f?"#a855f7":"#333",border:"none",borderRadius:6*b,color:"white",cursor:f?"pointer":"not-allowed",opacity:f?1:.5},children:""})]})]}):l.jsxs("div",{style:{display:"flex",gap:`${3*b}rem`,perspective:1200},children:[l.jsxs("div",{onClick:()=>t("HOST"),style:{width:200*b,height:280*b,background:"linear-gradient(135deg, #1a2a3a 0%, #0d1a2a 100%)",border:"3px solid #60a5fa",borderRadius:16*b,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(96, 165, 250, 0.3)"},onMouseOver:B=>{B.currentTarget.style.transform="rotateY(0deg) scale(1.05)",B.currentTarget.style.boxShadow="0 15px 40px rgba(96, 165, 250, 0.5)"},onMouseOut:B=>{B.currentTarget.style.transform="rotateY(15deg)",B.currentTarget.style.boxShadow="0 10px 30px rgba(96, 165, 250, 0.3)"},children:[l.jsx("div",{style:{fontSize:`${3*b}rem`,marginBottom:`${.5*b}rem`},children:""}),l.jsx("h3",{style:{fontSize:`${1.4*b}rem`,color:"#60a5fa",margin:0,marginBottom:`${.5*b}rem`},children:""}),l.jsxs("p",{style:{fontSize:`${.8*b}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*b}rem`},children:["ID",l.jsx("br",{}),""]})]}),l.jsxs("div",{onClick:()=>h(!0),style:{width:200*b,height:280*b,background:"linear-gradient(135deg, #2a1a3a 0%, #1a0d2a 100%)",border:"3px solid #a855f7",borderRadius:16*b,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(-15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(168, 85, 247, 0.3)"},onMouseOver:B=>{B.currentTarget.style.transform="rotateY(0deg) scale(1.05)",B.currentTarget.style.boxShadow="0 15px 40px rgba(168, 85, 247, 0.5)"},onMouseOut:B=>{B.currentTarget.style.transform="rotateY(-15deg)",B.currentTarget.style.boxShadow="0 10px 30px rgba(168, 85, 247, 0.3)"},children:[l.jsx("div",{style:{fontSize:`${3*b}rem`,marginBottom:`${.5*b}rem`},children:""}),l.jsx("h3",{style:{fontSize:`${1.4*b}rem`,color:"#a855f7",margin:0,marginBottom:`${.5*b}rem`},children:""}),l.jsxs("p",{style:{fontSize:`${.8*b}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*b}rem`},children:["ID",l.jsx("br",{}),""]})]})]})]}),c==="random"&&l.jsxs("div",{style:{textAlign:"center"},children:[l.jsx("h2",{style:{fontSize:`${1.8*b}rem`,marginBottom:`${1.5*b}rem`,color:"#4ade80"},children:""}),l.jsxs("div",{style:{display:"flex",gap:`${3*b}rem`,perspective:1200},children:[l.jsxs("div",{onClick:()=>me("casual"),style:{width:200*b,height:280*b,background:"linear-gradient(135deg, #1a3a1a 0%, #0d2d0d 100%)",border:"3px solid #4ade80",borderRadius:16*b,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(74, 222, 128, 0.3)"},onMouseOver:B=>{B.currentTarget.style.transform="rotateY(0deg) scale(1.05)",B.currentTarget.style.boxShadow="0 15px 40px rgba(74, 222, 128, 0.5)"},onMouseOut:B=>{B.currentTarget.style.transform="rotateY(15deg)",B.currentTarget.style.boxShadow="0 10px 30px rgba(74, 222, 128, 0.3)"},children:[l.jsx("div",{style:{fontSize:`${3*b}rem`,marginBottom:`${.5*b}rem`},children:""}),l.jsx("h3",{style:{fontSize:`${1.4*b}rem`,color:"#4ade80",margin:0,marginBottom:`${.5*b}rem`},children:""}),l.jsxs("p",{style:{fontSize:`${.8*b}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*b}rem`},children:["",l.jsx("br",{}),""]})]}),l.jsxs("div",{onClick:()=>me("ranked"),style:{width:200*b,height:280*b,background:"linear-gradient(135deg, #3a1a1a 0%, #2d0d0d 100%)",border:"3px solid #e94560",borderRadius:16*b,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(-15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(233, 69, 96, 0.3)"},onMouseOver:B=>{B.currentTarget.style.transform="rotateY(0deg) scale(1.05)",B.currentTarget.style.boxShadow="0 15px 40px rgba(233, 69, 96, 0.5)"},onMouseOut:B=>{B.currentTarget.style.transform="rotateY(-15deg)",B.currentTarget.style.boxShadow="0 10px 30px rgba(233, 69, 96, 0.3)"},children:[l.jsx("div",{style:{fontSize:`${3*b}rem`,marginBottom:`${.5*b}rem`},children:""}),l.jsx("h3",{style:{fontSize:`${1.4*b}rem`,color:"#e94560",margin:0,marginBottom:`${.5*b}rem`},children:""}),l.jsxs("p",{style:{fontSize:`${.8*b}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*b}rem`},children:["",l.jsx("br",{}),""]})]})]})]}),c==="ranking"&&l.jsxs("div",{style:{textAlign:"center"},children:[l.jsx("h2",{style:{fontSize:`${1.8*b}rem`,marginBottom:`${1*b}rem`,color:"#a855f7"},children:""}),l.jsx("p",{style:{fontSize:`${1*b}rem`,color:"#888"},children:"Coming Soon..."})]}),c==="gallery"&&l.jsxs("div",{style:{textAlign:"center"},children:[l.jsx("h2",{style:{fontSize:`${1.8*b}rem`,marginBottom:`${1*b}rem`,color:"#ec4899"},children:""}),l.jsx("p",{style:{fontSize:`${1*b}rem`,color:"#888",marginBottom:`${1*b}rem`},children:""}),l.jsx("p",{style:{fontSize:`${.8*b}rem`,color:"#666"},children:""})]}),c==="settings"&&l.jsxs("div",{style:{background:"rgba(0, 0, 0, 0.3)",borderRadius:12*b,padding:`${2*b}rem`,minWidth:400*b},children:[l.jsx("h2",{style:{fontSize:`${1.8*b}rem`,marginBottom:`${1.5*b}rem`,color:"#6b7280",textAlign:"center"},children:""}),l.jsxs("div",{style:{marginBottom:`${1.5*b}rem`},children:[l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:`${.5*b}rem`},children:[l.jsx("span",{style:{fontSize:`${1*b}rem`},children:"BGM"}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8*b,cursor:"pointer"},children:[l.jsx("input",{type:"checkbox",checked:e.bgmEnabled,onChange:B=>n({bgmEnabled:B.target.checked}),style:{width:18*b,height:18*b}}),l.jsx("span",{style:{color:e.bgmEnabled?"#4ade80":"#888",fontSize:`${.9*b}rem`},children:e.bgmEnabled?"ON":"OFF"})]})]}),l.jsx("input",{type:"range",min:0,max:1,step:.05,value:e.bgm,onChange:B=>n({bgm:parseFloat(B.target.value)}),disabled:!e.bgmEnabled,style:{width:"100%",opacity:e.bgmEnabled?1:.5}})]}),l.jsxs("div",{style:{marginBottom:`${1*b}rem`},children:[l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:`${.5*b}rem`},children:[l.jsx("span",{style:{fontSize:`${1*b}rem`},children:""}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8*b,cursor:"pointer"},children:[l.jsx("input",{type:"checkbox",checked:e.seEnabled,onChange:B=>n({seEnabled:B.target.checked}),style:{width:18*b,height:18*b}}),l.jsx("span",{style:{color:e.seEnabled?"#4ade80":"#888",fontSize:`${.9*b}rem`},children:e.seEnabled?"ON":"OFF"})]})]}),l.jsx("input",{type:"range",min:0,max:1,step:.05,value:e.se,onChange:B=>n({se:parseFloat(B.target.value)}),disabled:!e.seEnabled,style:{width:"100%",opacity:e.seEnabled?1:.5}})]})]})]})]}),l.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:70*b,background:"rgba(0, 0, 0, 0.8)",borderTop:"2px solid rgba(255, 255, 255, 0.1)",display:"flex",justifyContent:"center",alignItems:"center",gap:`${.5*b}rem`,padding:`0 ${1*b}rem`,zIndex:3},children:de.map(B=>l.jsx("button",{onClick:()=>u(B.id),style:{flex:1,maxWidth:140*b,padding:`${.6*b}rem ${.5*b}rem`,fontSize:`${.85*b}rem`,background:c===B.id?B.color:"transparent",border:c===B.id?"none":`2px solid ${B.color}`,borderRadius:8*b,color:c===B.id?"white":B.color,cursor:"pointer",transition:"all 0.2s",fontWeight:c===B.id?"bold":"normal"},children:B.label},B.id))}),l.jsx("p",{style:{position:"absolute",bottom:75*b,right:20*b,opacity:.5,fontSize:`${.7*b}rem`,zIndex:2},children:"Ver 1.04 Beta"})]})},BC=()=>{};var Fy={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rx={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ue=function(t,e){if(!t)throw Ho(e)},Ho=function(t){return new Error("Firebase Database ("+Rx.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Px=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},zC=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=t[n++],o=t[n++],a=t[n++],c=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{const i=t[n++],o=t[n++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},Lg={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<t.length;s+=3){const i=t[s],o=s+1<t.length,a=o?t[s+1]:0,c=s+2<t.length,u=c?t[s+2]:0,d=i>>2,h=(i&3)<<4|a>>4;let f=(a&15)<<2|u>>6,E=u&63;c||(E=64,o||(f=64)),r.push(n[d],n[h],n[f],n[E])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(Px(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):zC(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<t.length;){const i=n[t.charAt(s++)],a=s<t.length?n[t.charAt(s)]:0;++s;const u=s<t.length?n[t.charAt(s)]:64;++s;const h=s<t.length?n[t.charAt(s)]:64;if(++s,i==null||a==null||u==null||h==null)throw new HC;const f=i<<2|a>>4;if(r.push(f),u!==64){const E=a<<4&240|u>>2;if(r.push(E),h!==64){const k=u<<6&192|h;r.push(k)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class HC extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Ox=function(t){const e=Px(t);return Lg.encodeByteArray(e,!0)},Ru=function(t){return Ox(t).replace(/\./g,"")},Pu=function(t){try{return Lg.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WC(t){return Lx(void 0,t)}function Lx(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const n=e;return new Date(n.getTime());case Object:t===void 0&&(t={});break;case Array:t=[];break;default:return e}for(const n in e)!e.hasOwnProperty(n)||!GC(n)||(t[n]=Lx(t[n],e[n]));return t}function GC(t){return t!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VC(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YC=()=>VC().__FIREBASE_DEFAULTS__,KC=()=>{if(typeof process>"u"||typeof Fy>"u")return;const t=Fy.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},XC=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&Pu(t[1]);return e&&JSON.parse(e)},Dg=()=>{try{return BC()||YC()||KC()||XC()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},Dx=t=>{var e,n;return(n=(e=Dg())==null?void 0:e.emulatorHosts)==null?void 0:n[t]},QC=t=>{const e=Dx(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},Nx=()=>{var t;return(t=Dg())==null?void 0:t.config},Mx=t=>{var e;return(e=Dg())==null?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cr{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wo(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function jx(t){return(await fetch(t,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JC(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",s=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...t};return[Ru(JSON.stringify(n)),Ru(JSON.stringify(o)),""].join(".")}const $a={};function qC(){const t={prod:[],emulator:[]};for(const e of Object.keys($a))$a[e]?t.emulator.push(e):t.prod.push(e);return t}function ZC(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let Uy=!1;function $x(t,e){if(typeof window>"u"||typeof document>"u"||!Wo(window.location.host)||$a[t]===e||$a[t]||Uy)return;$a[t]=e;function n(f){return`__firebase__banner__${f}`}const r="__firebase__banner",i=qC().prod.length>0;function o(){const f=document.getElementById(r);f&&f.remove()}function a(f){f.style.display="flex",f.style.background="#7faaf0",f.style.position="fixed",f.style.bottom="5px",f.style.left="5px",f.style.padding=".5em",f.style.borderRadius="5px",f.style.alignItems="center"}function c(f,E){f.setAttribute("width","24"),f.setAttribute("id",E),f.setAttribute("height","24"),f.setAttribute("viewBox","0 0 24 24"),f.setAttribute("fill","none"),f.style.marginLeft="-6px"}function u(){const f=document.createElement("span");return f.style.cursor="pointer",f.style.marginLeft="16px",f.style.fontSize="24px",f.innerHTML=" &times;",f.onclick=()=>{Uy=!0,o()},f}function d(f,E){f.setAttribute("id",E),f.innerText="Learn more",f.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",f.setAttribute("target","__blank"),f.style.paddingLeft="5px",f.style.textDecoration="underline"}function h(){const f=ZC(r),E=n("text"),k=document.getElementById(E)||document.createElement("span"),P=n("learnmore"),G=document.getElementById(P)||document.createElement("a"),x=n("preprendIcon"),S=document.getElementById(x)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(f.created){const w=f.element;a(w),d(G,P);const p=u();c(S,x),w.append(S,k,G,p),document.body.appendChild(w)}i?(k.innerText="Preview backend disconnected.",S.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(S.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,k.innerText="Preview backend running in this workspace."),k.setAttribute("id",E)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",h):h()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Ng(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Cn())}function ew(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function tw(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function Fx(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function nw(){const t=Cn();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function rw(){return Rx.NODE_ADMIN===!0}function sw(){try{return typeof indexedDB=="object"}catch{return!1}}function iw(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var i;e(((i=s.error)==null?void 0:i.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ow="FirebaseError";class ei extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=ow,Object.setPrototypeOf(this,ei.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Al.prototype.create)}}class Al{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?aw(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new ei(s,a,r)}}function aw(t,e){return t.replace(lw,(n,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const lw=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fl(t){return JSON.parse(t)}function Yt(t){return JSON.stringify(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ux=function(t){let e={},n={},r={},s="";try{const i=t.split(".");e=fl(Pu(i[0])||""),n=fl(Pu(i[1])||""),s=i[2],r=n.d||{},delete n.d}catch{}return{header:e,claims:n,data:r,signature:s}},cw=function(t){const e=Ux(t),n=e.claims;return!!n&&typeof n=="object"&&n.hasOwnProperty("iat")},uw=function(t){const e=Ux(t).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vr(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function bi(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}function Ou(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Lu(t,e,n){const r={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(r[s]=e.call(n,t[s],s,t));return r}function Si(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const i=t[s],o=e[s];if(By(i)&&By(o)){if(!Si(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function By(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Go(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dw{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,n){n||(n=0);const r=this.W_;if(typeof e=="string")for(let h=0;h<16;h++)r[h]=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),n+=4;else for(let h=0;h<16;h++)r[h]=e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3],n+=4;for(let h=16;h<80;h++){const f=r[h-3]^r[h-8]^r[h-14]^r[h-16];r[h]=(f<<1|f>>>31)&4294967295}let s=this.chain_[0],i=this.chain_[1],o=this.chain_[2],a=this.chain_[3],c=this.chain_[4],u,d;for(let h=0;h<80;h++){h<40?h<20?(u=a^i&(o^a),d=1518500249):(u=i^o^a,d=1859775393):h<60?(u=i&o|a&(i|o),d=2400959708):(u=i^o^a,d=3395469782);const f=(s<<5|s>>>27)+u+c+d+r[h]&4294967295;c=a,a=o,o=(i<<30|i>>>2)&4294967295,i=s,s=f}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+i&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,n){if(e==null)return;n===void 0&&(n=e.length);const r=n-this.blockSize;let s=0;const i=this.buf_;let o=this.inbuf_;for(;s<n;){if(o===0)for(;s<=r;)this.compress_(e,s),s+=this.blockSize;if(typeof e=="string"){for(;s<n;)if(i[o]=e.charCodeAt(s),++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}else for(;s<n;)if(i[o]=e[s],++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=n}digest(){const e=[];let n=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=n&255,n/=256;this.compress_(this.buf_);let r=0;for(let s=0;s<5;s++)for(let i=24;i>=0;i-=8)e[r]=this.chain_[s]>>i&255,++r;return e}}function fw(t,e){const n=new hw(t,e);return n.subscribe.bind(n)}class hw{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let s;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");pw(e,["next","error","complete"])?s=e:s={next:e,error:n,complete:r},s.next===void 0&&(s.next=Xf),s.error===void 0&&(s.error=Xf),s.complete===void 0&&(s.complete=Xf);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function pw(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function Xf(){}function Oo(t,e){return`${t} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gw=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);if(s>=55296&&s<=56319){const i=s-55296;r++,ue(r<t.length,"Surrogate pair missing trail surrogate.");const o=t.charCodeAt(r)-56320;s=65536+(i<<10)+o}s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):s<65536?(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},_d=function(t){let e=0;for(let n=0;n<t.length;n++){const r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,n++):e+=3}return e};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yn(t){return t&&t._delegate?t._delegate:t}class Ii{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const li="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mw{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new cr;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:n});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(vw(e))try{this.getOrInitializeService({instanceIdentifier:li})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(n);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=li){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=li){return this.instances.has(e)}getOptions(e=li){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const s of r)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:yw(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=li){return this.component?this.component.multipleInstances?e:li:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function yw(t){return t===li?void 0:t}function vw(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _w{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new mw(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var xt;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(xt||(xt={}));const xw={debug:xt.DEBUG,verbose:xt.VERBOSE,info:xt.INFO,warn:xt.WARN,error:xt.ERROR,silent:xt.SILENT},Ew=xt.INFO,bw={[xt.DEBUG]:"log",[xt.VERBOSE]:"log",[xt.INFO]:"info",[xt.WARN]:"warn",[xt.ERROR]:"error"},Sw=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),s=bw[e];if(s)console[s](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Mg{constructor(e){this.name=e,this._logLevel=Ew,this._logHandler=Sw,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in xt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?xw[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,xt.DEBUG,...e),this._logHandler(this,xt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,xt.VERBOSE,...e),this._logHandler(this,xt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,xt.INFO,...e),this._logHandler(this,xt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,xt.WARN,...e),this._logHandler(this,xt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,xt.ERROR,...e),this._logHandler(this,xt.ERROR,...e)}}const Iw=(t,e)=>e.some(n=>t instanceof n);let zy,Hy;function Tw(){return zy||(zy=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Cw(){return Hy||(Hy=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Bx=new WeakMap,ip=new WeakMap,zx=new WeakMap,Qf=new WeakMap,jg=new WeakMap;function ww(t){const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("success",i),t.removeEventListener("error",o)},i=()=>{n(js(t.result)),s()},o=()=>{r(t.error),s()};t.addEventListener("success",i),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&Bx.set(n,t)}).catch(()=>{}),jg.set(e,t),e}function kw(t){if(ip.has(t))return;const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",o),t.removeEventListener("abort",o)},i=()=>{n(),s()},o=()=>{r(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",i),t.addEventListener("error",o),t.addEventListener("abort",o)});ip.set(t,e)}let op={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return ip.get(t);if(e==="objectStoreNames")return t.objectStoreNames||zx.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return js(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function Aw(t){op=t(op)}function Rw(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(Jf(this),e,...n);return zx.set(r,e.sort?e.sort():[e]),js(r)}:Cw().includes(t)?function(...e){return t.apply(Jf(this),e),js(Bx.get(this))}:function(...e){return js(t.apply(Jf(this),e))}}function Pw(t){return typeof t=="function"?Rw(t):(t instanceof IDBTransaction&&kw(t),Iw(t,Tw())?new Proxy(t,op):t)}function js(t){if(t instanceof IDBRequest)return ww(t);if(Qf.has(t))return Qf.get(t);const e=Pw(t);return e!==t&&(Qf.set(t,e),jg.set(e,t)),e}const Jf=t=>jg.get(t);function Ow(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(t,e),a=js(o);return r&&o.addEventListener("upgradeneeded",c=>{r(js(o.result),c.oldVersion,c.newVersion,js(o.transaction),c)}),n&&o.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),a.then(c=>{i&&c.addEventListener("close",()=>i()),s&&c.addEventListener("versionchange",u=>s(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const Lw=["get","getKey","getAll","getAllKeys","count"],Dw=["put","add","delete","clear"],qf=new Map;function Wy(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(qf.get(e))return qf.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=Dw.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||Lw.includes(n)))return;const i=async function(o,...a){const c=this.transaction(o,s?"readwrite":"readonly");let u=c.store;return r&&(u=u.index(a.shift())),(await Promise.all([u[n](...a),s&&c.done]))[0]};return qf.set(e,i),i}Aw(t=>({...t,get:(e,n,r)=>Wy(e,n)||t.get(e,n,r),has:(e,n)=>!!Wy(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nw{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(Mw(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function Mw(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const ap="@firebase/app",Gy="0.14.6";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const es=new Mg("@firebase/app"),jw="@firebase/app-compat",$w="@firebase/analytics-compat",Fw="@firebase/analytics",Uw="@firebase/app-check-compat",Bw="@firebase/app-check",zw="@firebase/auth",Hw="@firebase/auth-compat",Ww="@firebase/database",Gw="@firebase/data-connect",Vw="@firebase/database-compat",Yw="@firebase/functions",Kw="@firebase/functions-compat",Xw="@firebase/installations",Qw="@firebase/installations-compat",Jw="@firebase/messaging",qw="@firebase/messaging-compat",Zw="@firebase/performance",ek="@firebase/performance-compat",tk="@firebase/remote-config",nk="@firebase/remote-config-compat",rk="@firebase/storage",sk="@firebase/storage-compat",ik="@firebase/firestore",ok="@firebase/ai",ak="@firebase/firestore-compat",lk="firebase",ck="12.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lp="[DEFAULT]",uk={[ap]:"fire-core",[jw]:"fire-core-compat",[Fw]:"fire-analytics",[$w]:"fire-analytics-compat",[Bw]:"fire-app-check",[Uw]:"fire-app-check-compat",[zw]:"fire-auth",[Hw]:"fire-auth-compat",[Ww]:"fire-rtdb",[Gw]:"fire-data-connect",[Vw]:"fire-rtdb-compat",[Yw]:"fire-fn",[Kw]:"fire-fn-compat",[Xw]:"fire-iid",[Qw]:"fire-iid-compat",[Jw]:"fire-fcm",[qw]:"fire-fcm-compat",[Zw]:"fire-perf",[ek]:"fire-perf-compat",[tk]:"fire-rc",[nk]:"fire-rc-compat",[rk]:"fire-gcs",[sk]:"fire-gcs-compat",[ik]:"fire-fst",[ak]:"fire-fst-compat",[ok]:"fire-vertex","fire-js":"fire-js",[lk]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Du=new Map,dk=new Map,cp=new Map;function Vy(t,e){try{t.container.addComponent(e)}catch(n){es.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Lo(t){const e=t.name;if(cp.has(e))return es.debug(`There were multiple attempts to register component ${e}.`),!1;cp.set(e,t);for(const n of Du.values())Vy(n,t);for(const n of dk.values())Vy(n,t);return!0}function $g(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function ur(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fk={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},$s=new Al("app","Firebase",fk);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hk{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Ii("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw $s.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vo=ck;function Hx(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:lp,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw $s.create("bad-app-name",{appName:String(s)});if(n||(n=Nx()),!n)throw $s.create("no-options");const i=Du.get(s);if(i){if(Si(n,i.options)&&Si(r,i.config))return i;throw $s.create("duplicate-app",{appName:s})}const o=new _w(s);for(const c of cp.values())o.addComponent(c);const a=new hk(n,r,o);return Du.set(s,a),a}function Wx(t=lp){const e=Du.get(t);if(!e&&t===lp&&Nx())return Hx();if(!e)throw $s.create("no-app",{appName:t});return e}function Fs(t,e,n){let r=uk[t]??t;n&&(r+=`-${n}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const o=[`Unable to register library "${r}" with version "${e}":`];s&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),es.warn(o.join(" "));return}Lo(new Ii(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pk="firebase-heartbeat-database",gk=1,hl="firebase-heartbeat-store";let Zf=null;function Gx(){return Zf||(Zf=Ow(pk,gk,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(hl)}catch(n){console.warn(n)}}}}).catch(t=>{throw $s.create("idb-open",{originalErrorMessage:t.message})})),Zf}async function mk(t){try{const n=(await Gx()).transaction(hl),r=await n.objectStore(hl).get(Vx(t));return await n.done,r}catch(e){if(e instanceof ei)es.warn(e.message);else{const n=$s.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});es.warn(n.message)}}}async function Yy(t,e){try{const r=(await Gx()).transaction(hl,"readwrite");await r.objectStore(hl).put(e,Vx(t)),await r.done}catch(n){if(n instanceof ei)es.warn(n.message);else{const r=$s.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});es.warn(r.message)}}}function Vx(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yk=1024,vk=30;class _k{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new Ek(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Ky();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)==null?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats.length>vk){const o=bk(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){es.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=Ky(),{heartbeatsToSend:r,unsentEntries:s}=xk(this._heartbeatsCache.heartbeats),i=Ru(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(n){return es.warn(n),""}}}function Ky(){return new Date().toISOString().substring(0,10)}function xk(t,e=yk){const n=[];let r=t.slice();for(const s of t){const i=n.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),Xy(n)>e){i.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),Xy(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class Ek{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return sw()?iw().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await mk(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Yy(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Yy(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function Xy(t){return Ru(JSON.stringify({version:2,heartbeats:t})).length}function bk(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sk(t){Lo(new Ii("platform-logger",e=>new Nw(e),"PRIVATE")),Lo(new Ii("heartbeat",e=>new _k(e),"PRIVATE")),Fs(ap,Gy,t),Fs(ap,Gy,"esm2020"),Fs("fire-js","")}Sk("");var Ik="firebase",Tk="12.7.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Fs(Ik,Tk,"app");var Qy={};const Jy="@firebase/database",qy="1.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Yx="";function Ck(t){Yx=t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wk{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,n){n==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Yt(n))}get(e){const n=this.domStorage_.getItem(this.prefixedName_(e));return n==null?null:fl(n)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kk{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,n){n==null?delete this.cache_[e]:this.cache_[e]=n}get(e){return vr(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kx=function(t){try{if(typeof window<"u"&&typeof window[t]<"u"){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new wk(e)}}catch{}return new kk},pi=Kx("localStorage"),Ak=Kx("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vo=new Mg("@firebase/database"),Xx=function(){let t=1;return function(){return t++}}(),Qx=function(t){const e=gw(t),n=new dw;n.update(e);const r=n.digest();return Lg.encodeByteArray(r)},Rl=function(...t){let e="";for(let n=0;n<t.length;n++){const r=t[n];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=Rl.apply(null,r):typeof r=="object"?e+=Yt(r):e+=r,e+=" "}return e};let Fa=null,Zy=!0;const Rk=function(t,e){ue(!0,"Can't turn on custom loggers persistently."),vo.logLevel=xt.VERBOSE,Fa=vo.log.bind(vo)},qt=function(...t){if(Zy===!0&&(Zy=!1,Fa===null&&Ak.get("logging_enabled")===!0&&Rk()),Fa){const e=Rl.apply(null,t);Fa(e)}},Pl=function(t){return function(...e){qt(t,...e)}},up=function(...t){const e="FIREBASE INTERNAL ERROR: "+Rl(...t);vo.error(e)},ts=function(...t){const e=`FIREBASE FATAL ERROR: ${Rl(...t)}`;throw vo.error(e),new Error(e)},Tn=function(...t){const e="FIREBASE WARNING: "+Rl(...t);vo.warn(e)},Pk=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Tn("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},xd=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},Ok=function(t){if(document.readyState==="complete")t();else{let e=!1;const n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&n()}),window.attachEvent("onload",n))}},Do="[MIN_NAME]",Ti="[MAX_NAME]",Pi=function(t,e){if(t===e)return 0;if(t===Do||e===Ti)return-1;if(e===Do||t===Ti)return 1;{const n=ev(t),r=ev(e);return n!==null?r!==null?n-r===0?t.length-e.length:n-r:-1:r!==null?1:t<e?-1:1}},Lk=function(t,e){return t===e?0:t<e?-1:1},_a=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+Yt(e))},Fg=function(t){if(typeof t!="object"||t===null)return Yt(t);const e=[];for(const r in t)e.push(r);e.sort();let n="{";for(let r=0;r<e.length;r++)r!==0&&(n+=","),n+=Yt(e[r]),n+=":",n+=Fg(t[e[r]]);return n+="}",n},Jx=function(t,e){const n=t.length;if(n<=e)return[t];const r=[];for(let s=0;s<n;s+=e)s+e>n?r.push(t.substring(s,n)):r.push(t.substring(s,s+e));return r};function en(t,e){for(const n in t)t.hasOwnProperty(n)&&e(n,t[n])}const qx=function(t){ue(!xd(t),"Invalid JSON number");const e=11,n=52,r=(1<<e-1)-1;let s,i,o,a,c;t===0?(i=0,o=0,s=1/t===-1/0?1:0):(s=t<0,t=Math.abs(t),t>=Math.pow(2,1-r)?(a=Math.min(Math.floor(Math.log(t)/Math.LN2),r),i=a+r,o=Math.round(t*Math.pow(2,n-a)-Math.pow(2,n))):(i=0,o=Math.round(t/Math.pow(2,1-r-n))));const u=[];for(c=n;c;c-=1)u.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)u.push(i%2?1:0),i=Math.floor(i/2);u.push(s?1:0),u.reverse();const d=u.join("");let h="";for(c=0;c<64;c+=8){let f=parseInt(d.substr(c,8),2).toString(16);f.length===1&&(f="0"+f),h=h+f}return h.toLowerCase()},Dk=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},Nk=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function Mk(t,e){let n="Unknown Error";t==="too_big"?n="The data requested exceeds the maximum size that can be accessed with a single request.":t==="permission_denied"?n="Client doesn't have permission to access the desired data.":t==="unavailable"&&(n="The service is unavailable");const r=new Error(t+" at "+e._path.toString()+": "+n);return r.code=t.toUpperCase(),r}const jk=new RegExp("^-?(0*)\\d{1,10}$"),$k=-2147483648,Fk=2147483647,ev=function(t){if(jk.test(t)){const e=Number(t);if(e>=$k&&e<=Fk)return e}return null},Yo=function(t){try{t()}catch(e){setTimeout(()=>{const n=e.stack||"";throw Tn("Exception was thrown by user callback.",n),e},Math.floor(0))}},Uk=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Ua=function(t,e){const n=setTimeout(t,e);return typeof n=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(n):typeof n=="object"&&n.unref&&n.unref(),n};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bk{constructor(e,n){this.appCheckProvider=n,this.appName=e.name,ur(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=n==null?void 0:n.getImmediate({optional:!0}),this.appCheck||n==null||n.get().then(r=>this.appCheck=r)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((n,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(n,r):n(null)},0)})}addTokenChangeListener(e){var n;(n=this.appCheckProvider)==null||n.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){Tn(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zk{constructor(e,n,r){this.appName_=e,this.firebaseOptions_=n,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(n=>n&&n.code==="auth/token-not-initialized"?(qt("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(n)):new Promise((n,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(n,r):n(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(n=>n.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(n=>n.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Tn(e)}}class Yc{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Yc.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ug="5",Zx="v",eE="s",tE="r",nE="f",rE=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,sE="ls",iE="p",dp="ac",oE="websocket",aE="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lE{constructor(e,n,r,s,i=!1,o="",a=!1,c=!1,u=null){this.secure=n,this.namespace=r,this.webSocketOnly=s,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=c,this.emulatorOptions=u,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=pi.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&pi.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",n=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${n}`}}function Hk(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function cE(t,e,n){ue(typeof e=="string","typeof type must == string"),ue(typeof n=="object","typeof params must == object");let r;if(e===oE)r=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===aE)r=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);Hk(t)&&(n.ns=t.namespace);const s=[];return en(n,(i,o)=>{s.push(i+"="+o)}),r+s.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wk{constructor(){this.counters_={}}incrementCounter(e,n=1){vr(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=n}get(){return WC(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eh={},th={};function Bg(t){const e=t.toString();return eh[e]||(eh[e]=new Wk),eh[e]}function Gk(t,e){const n=t.toString();return th[n]||(th[n]=e()),th[n]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vk{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,n){this.closeAfterResponse=e,this.onClose=n,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,n){for(this.pendingResponses[e]=n;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<r.length;++s)r[s]&&Yo(()=>{this.onMessage_(r[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tv="start",Yk="close",Kk="pLPCommand",Xk="pRTLPCB",uE="id",dE="pw",fE="ser",Qk="cb",Jk="seg",qk="ts",Zk="d",e2="dframe",hE=1870,pE=30,t2=hE-pE,n2=25e3,r2=3e4;class co{constructor(e,n,r,s,i,o,a){this.connId=e,this.repoInfo=n,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Pl(e),this.stats_=Bg(n),this.urlFn=c=>(this.appCheckToken&&(c[dp]=this.appCheckToken),cE(n,aE,c))}open(e,n){this.curSegmentNum=0,this.onDisconnect_=n,this.myPacketOrderer=new Vk(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(r2)),Ok(()=>{if(this.isClosed_)return;this.scriptTagHolder=new zg((...i)=>{const[o,a,c,u,d]=i;if(this.incrementIncomingBytes_(i),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===tv)this.id=a,this.password=c;else if(o===Yk)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...i)=>{const[o,a]=i;this.incrementIncomingBytes_(i),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const r={};r[tv]="t",r[fE]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[Qk]=this.scriptTagHolder.uniqueCallbackIdentifier),r[Zx]=Ug,this.transportSessionId&&(r[eE]=this.transportSessionId),this.lastSessionId&&(r[sE]=this.lastSessionId),this.applicationId&&(r[iE]=this.applicationId),this.appCheckToken&&(r[dp]=this.appCheckToken),typeof location<"u"&&location.hostname&&rE.test(location.hostname)&&(r[tE]=nE);const s=this.urlFn(r);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){co.forceAllow_=!0}static forceDisallow(){co.forceDisallow_=!0}static isAvailable(){return co.forceAllow_?!0:!co.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!Dk()&&!Nk()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const n=Yt(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const r=Ox(n),s=Jx(r,t2);for(let i=0;i<s.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[i]),this.curSegmentNum++}addDisconnectPingFrame(e,n){this.myDisconnFrame=document.createElement("iframe");const r={};r[e2]="t",r[uE]=e,r[dE]=n,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const n=Yt(e).length;this.bytesReceived+=n,this.stats_.incrementCounter("bytes_received",n)}}class zg{constructor(e,n,r,s){this.onDisconnect=r,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=Xx(),window[Kk+this.uniqueCallbackIdentifier]=e,window[Xk+this.uniqueCallbackIdentifier]=n,this.myIFrame=zg.createIFrame_();let i="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(i='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){qt("frame writing exception"),a.stack&&qt(a.stack),qt(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||qt("No IE domain setting required")}catch{const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,n){for(this.myID=e,this.myPW=n,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[uE]=this.myID,e[dE]=this.myPW,e[fE]=this.currentSerial;let n=this.urlFn(e),r="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+pE+r.length<=hE;){const o=this.pendingSegs.shift();r=r+"&"+Jk+s+"="+o.seg+"&"+qk+s+"="+o.ts+"&"+Zk+s+"="+o.d,s++}return n=n+r,this.addLongPollTag_(n,this.currentSerial),!0}else return!1}enqueueSegment(e,n,r){this.pendingSegs.push({seg:e,ts:n,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,n){this.outstandingRequests.add(n);const r=()=>{this.outstandingRequests.delete(n),this.newRequest_()},s=setTimeout(r,Math.floor(n2)),i=()=>{clearTimeout(s),r()};this.addTag(e,i)}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const s=r.readyState;(!s||s==="loaded"||s==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),n())},r.onerror=()=>{qt("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const s2=16384,i2=45e3;let Nu=null;typeof MozWebSocket<"u"?Nu=MozWebSocket:typeof WebSocket<"u"&&(Nu=WebSocket);class dr{constructor(e,n,r,s,i,o,a){this.connId=e,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Pl(this.connId),this.stats_=Bg(n),this.connURL=dr.connectionURL_(n,o,a,s,r),this.nodeAdmin=n.nodeAdmin}static connectionURL_(e,n,r,s,i){const o={};return o[Zx]=Ug,typeof location<"u"&&location.hostname&&rE.test(location.hostname)&&(o[tE]=nE),n&&(o[eE]=n),r&&(o[sE]=r),s&&(o[dp]=s),i&&(o[iE]=i),cE(e,oE,o)}open(e,n){this.onDisconnect=n,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,pi.set("previous_websocket_failure",!0);try{let r;rw(),this.mySock=new Nu(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){dr.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const n=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(n);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&Nu!==null&&!dr.forceDisallow_}static previouslyFailed(){return pi.isInMemoryStorage||pi.get("previous_websocket_failure")===!0}markConnectionHealthy(){pi.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const n=this.frames.join("");this.frames=null;const r=fl(n);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(ue(this.frames===null,"We already have a frame buffer"),e.length<=6){const n=Number(e);if(!isNaN(n))return this.handleNewFrameCount_(n),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const n=e.data;if(this.bytesReceived+=n.length,this.stats_.incrementCounter("bytes_received",n.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(n);else{const r=this.extractFrameCount_(n);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();const n=Yt(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const r=Jx(n,s2);r.length>1&&this.sendString_(String(r.length));for(let s=0;s<r.length;s++)this.sendString_(r[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(i2))}sendString_(e){try{this.mySock.send(e)}catch(n){this.log_("Exception thrown from WebSocket.send():",n.message||n.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}dr.responsesRequiredToBeHealthy=2;dr.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pl{static get ALL_TRANSPORTS(){return[co,dr]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const n=dr&&dr.isAvailable();let r=n&&!dr.previouslyFailed();if(e.webSocketOnly&&(n||Tn("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[dr];else{const s=this.transports_=[];for(const i of pl.ALL_TRANSPORTS)i&&i.isAvailable()&&s.push(i);pl.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}pl.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o2=6e4,a2=5e3,l2=10*1024,c2=100*1024,nh="t",nv="d",u2="s",rv="r",d2="e",sv="o",iv="a",ov="n",av="p",f2="h";class h2{constructor(e,n,r,s,i,o,a,c,u,d){this.id=e,this.repoInfo_=n,this.applicationId_=r,this.appCheckToken_=s,this.authToken_=i,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=c,this.onKill_=u,this.lastSessionId=d,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Pl("c:"+this.id+":"),this.transportManager_=new pl(n),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(n,r)},Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=Ua(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>c2?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>l2?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return n=>{e===this.conn_?this.onConnectionLost_(n):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return n=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(n):e===this.secondaryConn_?this.onSecondaryMessageReceived_(n):this.log_("message on old connection"))}}sendRequest(e){const n={t:"d",d:e};this.sendData_(n)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(nh in e){const n=e[nh];n===iv?this.upgradeIfSecondaryHealthy_():n===rv?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):n===sv&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const n=_a("t",e),r=_a("d",e);if(n==="c")this.onSecondaryControl_(r);else if(n==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+n)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:av,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:iv,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:ov,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const n=_a("t",e),r=_a("d",e);n==="c"?this.onControl_(r):n==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const n=_a(nh,e);if(nv in e){const r=e[nv];if(n===f2){const s={...r};this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(n===ov){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else n===u2?this.onConnectionShutdown_(r):n===rv?this.onReset_(r):n===d2?up("Server Error: "+r):n===sv?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):up("Unknown control packet command: "+n)}}onHandshake_(e){const n=e.ts,r=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,n),Ug!==r&&Tn("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),Ua(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(o2))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,n){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(n,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Ua(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(a2))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:av,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(pi.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gE{put(e,n,r,s){}merge(e,n,r,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,n,r){}onDisconnectMerge(e,n,r){}onDisconnectCancel(e,n){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mE{constructor(e){this.allowedEvents_=e,this.listeners_={},ue(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...n){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let s=0;s<r.length;s++)r[s].callback.apply(r[s].context,n)}}on(e,n,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:n,context:r});const s=this.getInitialEvent(e);s&&n.apply(r,s)}off(e,n,r){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let i=0;i<s.length;i++)if(s[i].callback===n&&(!r||r===s[i].context)){s.splice(i,1);return}}validateEventType_(e){ue(this.allowedEvents_.find(n=>n===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mu extends mE{static getInstance(){return new Mu}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Ng()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return ue(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lv=32,cv=768;class vt{constructor(e,n){if(n===void 0){this.pieces_=e.split("/");let r=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[r]=this.pieces_[s],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=n}toString(){let e="";for(let n=this.pieceNum_;n<this.pieces_.length;n++)this.pieces_[n]!==""&&(e+="/"+this.pieces_[n]);return e||"/"}}function ht(){return new vt("")}function tt(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function Vs(t){return t.pieces_.length-t.pieceNum_}function It(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new vt(t.pieces_,e)}function Hg(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function p2(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)t.pieces_[n]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}function gl(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function yE(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new vt(e,0)}function Nt(t,e){const n=[];for(let r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);if(e instanceof vt)for(let r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);else{const r=e.split("/");for(let s=0;s<r.length;s++)r[s].length>0&&n.push(r[s])}return new vt(n,0)}function rt(t){return t.pieceNum_>=t.pieces_.length}function Sn(t,e){const n=tt(t),r=tt(e);if(n===null)return e;if(n===r)return Sn(It(t),It(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function g2(t,e){const n=gl(t,0),r=gl(e,0);for(let s=0;s<n.length&&s<r.length;s++){const i=Pi(n[s],r[s]);if(i!==0)return i}return n.length===r.length?0:n.length<r.length?-1:1}function Wg(t,e){if(Vs(t)!==Vs(e))return!1;for(let n=t.pieceNum_,r=e.pieceNum_;n<=t.pieces_.length;n++,r++)if(t.pieces_[n]!==e.pieces_[r])return!1;return!0}function qn(t,e){let n=t.pieceNum_,r=e.pieceNum_;if(Vs(t)>Vs(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[r])return!1;++n,++r}return!0}class m2{constructor(e,n){this.errorPrefix_=n,this.parts_=gl(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=_d(this.parts_[r]);vE(this)}}function y2(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=_d(e),vE(t)}function v2(t){const e=t.parts_.pop();t.byteLength_-=_d(e),t.parts_.length>0&&(t.byteLength_-=1)}function vE(t){if(t.byteLength_>cv)throw new Error(t.errorPrefix_+"has a key path longer than "+cv+" bytes ("+t.byteLength_+").");if(t.parts_.length>lv)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+lv+") or object contains a cycle "+ci(t))}function ci(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gg extends mE{static getInstance(){return new Gg}constructor(){super(["visible"]);let e,n;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(n="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(n="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(n="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(n="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,n&&document.addEventListener(n,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}getInitialEvent(e){return ue(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xa=1e3,_2=60*5*1e3,uv=30*1e3,x2=1.3,E2=3e4,b2="server_kill",dv=3;class Xr extends gE{constructor(e,n,r,s,i,o,a,c){if(super(),this.repoInfo_=e,this.applicationId_=n,this.onDataUpdate_=r,this.onConnectStatus_=s,this.onServerInfoUpdate_=i,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=c,this.id=Xr.nextPersistentConnectionId_++,this.log_=Pl("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=xa,this.maxReconnectDelay_=_2,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Gg.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&Mu.getInstance().on("online",this.onOnline_,this)}sendRequest(e,n,r){const s=++this.requestNumber_,i={r:s,a:e,b:n};this.log_(Yt(i)),ue(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),r&&(this.requestCBHash_[s]=r)}get(e){this.initConnection_();const n=new cr,s={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?n.resolve(a):n.reject(a)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),n.promise}listen(e,n,r,s){this.initConnection_();const i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),ue(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),ue(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");const a={onComplete:s,hashFn:n,query:e,tag:r};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const n=this.outstandingGets_[e];this.sendRequest("g",n.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(r)})}sendListen_(e){const n=e.query,r=n._path.toString(),s=n._queryIdentifier;this.log_("Listen on "+r+" for "+s);const i={p:r},o="q";e.tag&&(i.q=n._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest(o,i,a=>{const c=a.d,u=a.s;Xr.warnOnListenWarnings_(c,n),(this.listens.get(r)&&this.listens.get(r).get(s))===e&&(this.log_("listen response",a),u!=="ok"&&this.removeListen_(r,s),e.onComplete&&e.onComplete(u,c))})}static warnOnListenWarnings_(e,n){if(e&&typeof e=="object"&&vr(e,"w")){const r=bi(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const s='".indexOn": "'+n._queryParams.getIndex().toString()+'"',i=n._path.toString();Tn(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${i} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||uw(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=uv)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,n=cw(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(n,r,s=>{const i=s.s,o=s.d||"error";this.authToken_===e&&(i==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(i,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const n=e.s,r=e.d||"error";n==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(n,r)})}unlisten(e,n){const r=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+s),ue(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,s)&&this.connected_&&this.sendUnlisten_(r,s,e._queryObject,n)}sendUnlisten_(e,n,r,s){this.log_("Unlisten on "+e+" for "+n);const i={p:e},o="n";s&&(i.q=r,i.t=s),this.sendRequest(o,i)}onDisconnectPut(e,n,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,n,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:n,onComplete:r})}onDisconnectMerge(e,n,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,n,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:n,onComplete:r})}onDisconnectCancel(e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:n})}sendOnDisconnect_(e,n,r,s){const i={p:n,d:r};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,o=>{s&&setTimeout(()=>{s(o.s,o.d)},Math.floor(0))})}put(e,n,r,s){this.putInternal("p",e,n,r,s)}merge(e,n,r,s){this.putInternal("m",e,n,r,s)}putInternal(e,n,r,s,i){this.initConnection_();const o={p:n,d:r};i!==void 0&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:s}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+n)}sendPut_(e){const n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,s=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,i=>{this.log_(n+" response",i),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(i.s,i.d)})}reportStats(e){if(this.connected_){const n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,r=>{if(r.s!=="ok"){const i=r.d;this.log_("reportStats","Error sending stats: "+i)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Yt(e));const n=e.r,r=this.requestCBHash_[n];r&&(delete this.requestCBHash_[n],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,n){this.log_("handleServerMessage",e,n),e==="d"?this.onDataUpdate_(n.p,n.d,!1,n.t):e==="m"?this.onDataUpdate_(n.p,n.d,!0,n.t):e==="c"?this.onListenRevoked_(n.p,n.q):e==="ac"?this.onAuthRevoked_(n.s,n.d):e==="apc"?this.onAppCheckRevoked_(n.s,n.d):e==="sd"?this.onSecurityDebugPacket_(n):up("Unrecognized action received from server: "+Yt(e)+`
Are you using the latest client?`)}onReady_(e,n){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=n,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){ue(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=xa,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=xa,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>E2&&(this.reconnectDelay_=xa),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let n=Math.max(0,this.reconnectDelay_-e);n=Math.random()*n,this.log_("Trying to reconnect in "+n+"ms"),this.scheduleConnect_(n),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*x2)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+Xr.nextConnectionId_++,i=this.lastSessionId;let o=!1,a=null;const c=function(){a?a.close():(o=!0,r())},u=function(h){ue(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(h)};this.realtime_={close:c,sendRequest:u};const d=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[h,f]=await Promise.all([this.authTokenProvider_.getToken(d),this.appCheckTokenProvider_.getToken(d)]);o?qt("getToken() completed but was canceled"):(qt("getToken() completed. Creating connection."),this.authToken_=h&&h.accessToken,this.appCheckToken_=f&&f.token,a=new h2(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,r,E=>{Tn(E+" ("+this.repoInfo_.toString()+")"),this.interrupt(b2)},i))}catch(h){this.log_("Failed to get token: "+h),o||(this.repoInfo_.nodeAdmin&&Tn(h),c())}}}interrupt(e){qt("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){qt("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Ou(this.interruptReasons_)&&(this.reconnectDelay_=xa,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const n=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:n})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const n=this.outstandingPuts_[e];n&&"h"in n.request&&n.queued&&(n.onComplete&&n.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,n){let r;n?r=n.map(i=>Fg(i)).join("$"):r="default";const s=this.removeListen_(e,r);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(e,n){const r=new vt(e).toString();let s;if(this.listens.has(r)){const i=this.listens.get(r);s=i.get(n),i.delete(n),i.size===0&&this.listens.delete(r)}else s=void 0;return s}onAuthRevoked_(e,n){qt("Auth token revoked: "+e+"/"+n),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=dv&&(this.reconnectDelay_=uv,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,n){qt("App check token revoked: "+e+"/"+n),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=dv&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const n of e.values())this.sendListen_(n);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let n="js";e["sdk."+n+"."+Yx.replace(/\./g,"-")]=1,Ng()?e["framework.cordova"]=1:Fx()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Mu.getInstance().currentlyOnline();return Ou(this.interruptReasons_)&&e}}Xr.nextPersistentConnectionId_=0;Xr.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class st{constructor(e,n){this.name=e,this.node=n}static Wrap(e,n){return new st(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ed{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,n){const r=new st(Do,e),s=new st(Do,n);return this.compare(r,s)!==0}minPost(){return st.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Cc;class _E extends Ed{static get __EMPTY_NODE(){return Cc}static set __EMPTY_NODE(e){Cc=e}compare(e,n){return Pi(e.name,n.name)}isDefinedOn(e){throw Ho("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,n){return!1}minPost(){return st.MIN}maxPost(){return new st(Ti,Cc)}makePost(e,n){return ue(typeof e=="string","KeyIndex indexValue must always be a string."),new st(e,Cc)}toString(){return".key"}}const _o=new _E;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wc{constructor(e,n,r,s,i=null){this.isReverse_=s,this.resultGenerator_=i,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=n?r(e.key,n):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),n;if(this.resultGenerator_?n=this.resultGenerator_(e.key,e.value):n={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return n}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Jt{constructor(e,n,r,s,i){this.key=e,this.value=n,this.color=r??Jt.RED,this.left=s??Dn.EMPTY_NODE,this.right=i??Dn.EMPTY_NODE}copy(e,n,r,s,i){return new Jt(e??this.key,n??this.value,r??this.color,s??this.left,i??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let s=this;const i=r(e,s.key);return i<0?s=s.copy(null,null,null,s.left.insert(e,n,r),null):i===0?s=s.copy(null,n,null,null,null):s=s.copy(null,null,null,null,s.right.insert(e,n,r)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return Dn.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,n){let r,s;if(r=this,n(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,n),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),n(e,r.key)===0){if(r.right.isEmpty())return Dn.EMPTY_NODE;s=r.right.min_(),r=r.copy(s.key,s.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,n))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Jt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Jt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Jt.RED=!0;Jt.BLACK=!1;class S2{copy(e,n,r,s,i){return this}insert(e,n,r){return new Jt(e,n,null)}remove(e,n){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class Dn{constructor(e,n=Dn.EMPTY_NODE){this.comparator_=e,this.root_=n}insert(e,n){return new Dn(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,Jt.BLACK,null,null))}remove(e){return new Dn(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Jt.BLACK,null,null))}get(e){let n,r=this.root_;for(;!r.isEmpty();){if(n=this.comparator_(e,r.key),n===0)return r.value;n<0?r=r.left:n>0&&(r=r.right)}return null}getPredecessorKey(e){let n,r=this.root_,s=null;for(;!r.isEmpty();)if(n=this.comparator_(e,r.key),n===0){if(r.left.isEmpty())return s?s.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else n<0?r=r.left:n>0&&(s=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new wc(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,n){return new wc(this.root_,e,this.comparator_,!1,n)}getReverseIteratorFrom(e,n){return new wc(this.root_,e,this.comparator_,!0,n)}getReverseIterator(e){return new wc(this.root_,null,this.comparator_,!0,e)}}Dn.EMPTY_NODE=new S2;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function I2(t,e){return Pi(t.name,e.name)}function Vg(t,e){return Pi(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fp;function T2(t){fp=t}const xE=function(t){return typeof t=="number"?"number:"+qx(t):"string:"+t},EE=function(t){if(t.isLeafNode()){const e=t.val();ue(typeof e=="string"||typeof e=="number"||typeof e=="object"&&vr(e,".sv"),"Priority must be a string or number.")}else ue(t===fp||t.isEmpty(),"priority of unexpected type.");ue(t===fp||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fv;class Xt{static set __childrenNodeConstructor(e){fv=e}static get __childrenNodeConstructor(){return fv}constructor(e,n=Xt.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=n,this.lazyHash_=null,ue(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),EE(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Xt(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:Xt.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return rt(e)?this:tt(e)===".priority"?this.priorityNode_:Xt.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,n){return null}updateImmediateChild(e,n){return e===".priority"?this.updatePriority(n):n.isEmpty()&&e!==".priority"?this:Xt.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)}updateChild(e,n){const r=tt(e);return r===null?n:n.isEmpty()&&r!==".priority"?this:(ue(r!==".priority"||Vs(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,Xt.__childrenNodeConstructor.EMPTY_NODE.updateChild(It(e),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,n){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+xE(this.priorityNode_.val())+":");const n=typeof this.value_;e+=n+":",n==="number"?e+=qx(this.value_):e+=this.value_,this.lazyHash_=Qx(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Xt.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Xt.__childrenNodeConstructor?-1:(ue(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const n=typeof e.value_,r=typeof this.value_,s=Xt.VALUE_TYPE_ORDER.indexOf(n),i=Xt.VALUE_TYPE_ORDER.indexOf(r);return ue(s>=0,"Unknown leaf type: "+n),ue(i>=0,"Unknown leaf type: "+r),s===i?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const n=e;return this.value_===n.value_&&this.priorityNode_.equals(n.priorityNode_)}else return!1}}Xt.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let bE,SE;function C2(t){bE=t}function w2(t){SE=t}class k2 extends Ed{compare(e,n){const r=e.node.getPriority(),s=n.node.getPriority(),i=r.compareTo(s);return i===0?Pi(e.name,n.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,n){return!e.getPriority().equals(n.getPriority())}minPost(){return st.MIN}maxPost(){return new st(Ti,new Xt("[PRIORITY-POST]",SE))}makePost(e,n){const r=bE(e);return new st(n,new Xt("[PRIORITY-POST]",r))}toString(){return".priority"}}const Ot=new k2;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A2=Math.log(2);class R2{constructor(e){const n=i=>parseInt(Math.log(i)/A2,10),r=i=>parseInt(Array(i+1).join("1"),2);this.count=n(e+1),this.current_=this.count-1;const s=r(this.count);this.bits_=e+1&s}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const ju=function(t,e,n,r){t.sort(e);const s=function(c,u){const d=u-c;let h,f;if(d===0)return null;if(d===1)return h=t[c],f=n?n(h):h,new Jt(f,h.node,Jt.BLACK,null,null);{const E=parseInt(d/2,10)+c,k=s(c,E),P=s(E+1,u);return h=t[E],f=n?n(h):h,new Jt(f,h.node,Jt.BLACK,k,P)}},i=function(c){let u=null,d=null,h=t.length;const f=function(k,P){const G=h-k,x=h;h-=k;const S=s(G+1,x),w=t[G],p=n?n(w):w;E(new Jt(p,w.node,P,null,S))},E=function(k){u?(u.left=k,u=k):(d=k,u=k)};for(let k=0;k<c.count;++k){const P=c.nextBitIsOne(),G=Math.pow(2,c.count-(k+1));P?f(G,Jt.BLACK):(f(G,Jt.BLACK),f(G,Jt.RED))}return d},o=new R2(t.length),a=i(o);return new Dn(r||e,a)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rh;const Ki={};class Hr{static get Default(){return ue(Ki&&Ot,"ChildrenNode.ts has not been loaded"),rh=rh||new Hr({".priority":Ki},{".priority":Ot}),rh}constructor(e,n){this.indexes_=e,this.indexSet_=n}get(e){const n=bi(this.indexes_,e);if(!n)throw new Error("No index defined for "+e);return n instanceof Dn?n:null}hasIndex(e){return vr(this.indexSet_,e.toString())}addIndex(e,n){ue(e!==_o,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let s=!1;const i=n.getIterator(st.Wrap);let o=i.getNext();for(;o;)s=s||e.isDefinedOn(o.node),r.push(o),o=i.getNext();let a;s?a=ju(r,e.getCompare()):a=Ki;const c=e.toString(),u={...this.indexSet_};u[c]=e;const d={...this.indexes_};return d[c]=a,new Hr(d,u)}addToIndexes(e,n){const r=Lu(this.indexes_,(s,i)=>{const o=bi(this.indexSet_,i);if(ue(o,"Missing index implementation for "+i),s===Ki)if(o.isDefinedOn(e.node)){const a=[],c=n.getIterator(st.Wrap);let u=c.getNext();for(;u;)u.name!==e.name&&a.push(u),u=c.getNext();return a.push(e),ju(a,o.getCompare())}else return Ki;else{const a=n.get(e.name);let c=s;return a&&(c=c.remove(new st(e.name,a))),c.insert(e,e.node)}});return new Hr(r,this.indexSet_)}removeFromIndexes(e,n){const r=Lu(this.indexes_,s=>{if(s===Ki)return s;{const i=n.get(e.name);return i?s.remove(new st(e.name,i)):s}});return new Hr(r,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ea;class je{static get EMPTY_NODE(){return Ea||(Ea=new je(new Dn(Vg),null,Hr.Default))}constructor(e,n,r){this.children_=e,this.priorityNode_=n,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&EE(this.priorityNode_),this.children_.isEmpty()&&ue(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Ea}updatePriority(e){return this.children_.isEmpty()?this:new je(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const n=this.children_.get(e);return n===null?Ea:n}}getChild(e){const n=tt(e);return n===null?this:this.getImmediateChild(n).getChild(It(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,n){if(ue(n,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(n);{const r=new st(e,n);let s,i;n.isEmpty()?(s=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(r,this.children_)):(s=this.children_.insert(e,n),i=this.indexMap_.addToIndexes(r,this.children_));const o=s.isEmpty()?Ea:this.priorityNode_;return new je(s,o,i)}}updateChild(e,n){const r=tt(e);if(r===null)return n;{ue(tt(e)!==".priority"||Vs(e)===1,".priority must be the last token in a path");const s=this.getImmediateChild(r).updateChild(It(e),n);return this.updateImmediateChild(r,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const n={};let r=0,s=0,i=!0;if(this.forEachChild(Ot,(o,a)=>{n[o]=a.val(e),r++,i&&je.INTEGER_REGEXP_.test(o)?s=Math.max(s,Number(o)):i=!1}),!e&&i&&s<2*r){const o=[];for(const a in n)o[a]=n[a];return o}else return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+xE(this.getPriority().val())+":"),this.forEachChild(Ot,(n,r)=>{const s=r.hash();s!==""&&(e+=":"+n+":"+s)}),this.lazyHash_=e===""?"":Qx(e)}return this.lazyHash_}getPredecessorChildName(e,n,r){const s=this.resolveIndex_(r);if(s){const i=s.getPredecessorKey(new st(e,n));return i?i.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const n=this.resolveIndex_(e);if(n){const r=n.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){const n=this.getFirstChildName(e);return n?new st(n,this.children_.get(n)):null}getLastChildName(e){const n=this.resolveIndex_(e);if(n){const r=n.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){const n=this.getLastChildName(e);return n?new st(n,this.children_.get(n)):null}forEachChild(e,n){const r=this.resolveIndex_(e);return r?r.inorderTraversal(s=>n(s.name,s.node)):this.children_.inorderTraversal(n)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,n){const r=this.resolveIndex_(n);if(r)return r.getIteratorFrom(e,s=>s);{const s=this.children_.getIteratorFrom(e.name,st.Wrap);let i=s.peek();for(;i!=null&&n.compare(i,e)<0;)s.getNext(),i=s.peek();return s}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,n){const r=this.resolveIndex_(n);if(r)return r.getReverseIteratorFrom(e,s=>s);{const s=this.children_.getReverseIteratorFrom(e.name,st.Wrap);let i=s.peek();for(;i!=null&&n.compare(i,e)>0;)s.getNext(),i=s.peek();return s}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Ol?-1:0}withIndex(e){if(e===_o||this.indexMap_.hasIndex(e))return this;{const n=this.indexMap_.addIndex(e,this.children_);return new je(this.children_,this.priorityNode_,n)}}isIndexed(e){return e===_o||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority()))if(this.children_.count()===n.children_.count()){const r=this.getIterator(Ot),s=n.getIterator(Ot);let i=r.getNext(),o=s.getNext();for(;i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=r.getNext(),o=s.getNext()}return i===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===_o?null:this.indexMap_.get(e.toString())}}je.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class P2 extends je{constructor(){super(new Dn(Vg),je.EMPTY_NODE,Hr.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return je.EMPTY_NODE}isEmpty(){return!1}}const Ol=new P2;Object.defineProperties(st,{MIN:{value:new st(Do,je.EMPTY_NODE)},MAX:{value:new st(Ti,Ol)}});_E.__EMPTY_NODE=je.EMPTY_NODE;Xt.__childrenNodeConstructor=je;T2(Ol);w2(Ol);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O2=!0;function Dt(t,e=null){if(t===null)return je.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),ue(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){const n=t;return new Xt(n,Dt(e))}if(!(t instanceof Array)&&O2){const n=[];let r=!1;if(en(t,(o,a)=>{if(o.substring(0,1)!=="."){const c=Dt(a);c.isEmpty()||(r=r||!c.getPriority().isEmpty(),n.push(new st(o,c)))}}),n.length===0)return je.EMPTY_NODE;const i=ju(n,I2,o=>o.name,Vg);if(r){const o=ju(n,Ot.getCompare());return new je(i,Dt(e),new Hr({".priority":o},{".priority":Ot}))}else return new je(i,Dt(e),Hr.Default)}else{let n=je.EMPTY_NODE;return en(t,(r,s)=>{if(vr(t,r)&&r.substring(0,1)!=="."){const i=Dt(s);(i.isLeafNode()||!i.isEmpty())&&(n=n.updateImmediateChild(r,i))}}),n.updatePriority(Dt(e))}}C2(Dt);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L2 extends Ed{constructor(e){super(),this.indexPath_=e,ue(!rt(e)&&tt(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,n){const r=this.extractChild(e.node),s=this.extractChild(n.node),i=r.compareTo(s);return i===0?Pi(e.name,n.name):i}makePost(e,n){const r=Dt(e),s=je.EMPTY_NODE.updateChild(this.indexPath_,r);return new st(n,s)}maxPost(){const e=je.EMPTY_NODE.updateChild(this.indexPath_,Ol);return new st(Ti,e)}toString(){return gl(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D2 extends Ed{compare(e,n){const r=e.node.compareTo(n.node);return r===0?Pi(e.name,n.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,n){return!e.equals(n)}minPost(){return st.MIN}maxPost(){return st.MAX}makePost(e,n){const r=Dt(e);return new st(n,r)}toString(){return".value"}}const N2=new D2;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IE(t){return{type:"value",snapshotNode:t}}function No(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function ml(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function yl(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}function M2(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yg{constructor(e){this.index_=e}updateChild(e,n,r,s,i,o){ue(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(n);return a.getChild(s).equals(r.getChild(s))&&a.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(n)?o.trackChildChange(ml(n,a)):ue(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(No(n,r)):o.trackChildChange(yl(n,r,a))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(n,r).withIndex(this.index_)}updateFullNode(e,n,r){return r!=null&&(e.isLeafNode()||e.forEachChild(Ot,(s,i)=>{n.hasChild(s)||r.trackChildChange(ml(s,i))}),n.isLeafNode()||n.forEachChild(Ot,(s,i)=>{if(e.hasChild(s)){const o=e.getImmediateChild(s);o.equals(i)||r.trackChildChange(yl(s,i,o))}else r.trackChildChange(No(s,i))})),n.withIndex(this.index_)}updatePriority(e,n){return e.isEmpty()?je.EMPTY_NODE:e.updatePriority(n)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vl{constructor(e){this.indexedFilter_=new Yg(e.getIndex()),this.index_=e.getIndex(),this.startPost_=vl.getStartPost_(e),this.endPost_=vl.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const n=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return n&&r}updateChild(e,n,r,s,i,o){return this.matches(new st(n,r))||(r=je.EMPTY_NODE),this.indexedFilter_.updateChild(e,n,r,s,i,o)}updateFullNode(e,n,r){n.isLeafNode()&&(n=je.EMPTY_NODE);let s=n.withIndex(this.index_);s=s.updatePriority(je.EMPTY_NODE);const i=this;return n.forEachChild(Ot,(o,a)=>{i.matches(new st(o,a))||(s=s.updateImmediateChild(o,je.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,r)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const n=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),n)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const n=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),n)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j2{constructor(e){this.withinDirectionalStart=n=>this.reverse_?this.withinEndPost(n):this.withinStartPost(n),this.withinDirectionalEnd=n=>this.reverse_?this.withinStartPost(n):this.withinEndPost(n),this.withinStartPost=n=>{const r=this.index_.compare(this.rangedFilter_.getStartPost(),n);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=n=>{const r=this.index_.compare(n,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new vl(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,n,r,s,i,o){return this.rangedFilter_.matches(new st(n,r))||(r=je.EMPTY_NODE),e.getImmediateChild(n).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,n,r,s,i,o):this.fullLimitUpdateChild_(e,n,r,i,o)}updateFullNode(e,n,r){let s;if(n.isLeafNode()||n.isEmpty())s=je.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<n.numChildren()&&n.isIndexed(this.index_)){s=je.EMPTY_NODE.withIndex(this.index_);let i;this.reverse_?i=n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):i=n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;i.hasNext()&&o<this.limit_;){const a=i.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))s=s.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{s=n.withIndex(this.index_),s=s.updatePriority(je.EMPTY_NODE);let i;this.reverse_?i=s.getReverseIterator(this.index_):i=s.getIterator(this.index_);let o=0;for(;i.hasNext();){const a=i.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:s=s.updateImmediateChild(a.name,je.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,r)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,n,r,s,i){let o;if(this.reverse_){const h=this.index_.getCompare();o=(f,E)=>h(E,f)}else o=this.index_.getCompare();const a=e;ue(a.numChildren()===this.limit_,"");const c=new st(n,r),u=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),d=this.rangedFilter_.matches(c);if(a.hasChild(n)){const h=a.getImmediateChild(n);let f=s.getChildAfterChild(this.index_,u,this.reverse_);for(;f!=null&&(f.name===n||a.hasChild(f.name));)f=s.getChildAfterChild(this.index_,f,this.reverse_);const E=f==null?1:o(f,c);if(d&&!r.isEmpty()&&E>=0)return i!=null&&i.trackChildChange(yl(n,r,h)),a.updateImmediateChild(n,r);{i!=null&&i.trackChildChange(ml(n,h));const P=a.updateImmediateChild(n,je.EMPTY_NODE);return f!=null&&this.rangedFilter_.matches(f)?(i!=null&&i.trackChildChange(No(f.name,f.node)),P.updateImmediateChild(f.name,f.node)):P}}else return r.isEmpty()?e:d&&o(u,c)>=0?(i!=null&&(i.trackChildChange(ml(u.name,u.node)),i.trackChildChange(No(n,r))),a.updateImmediateChild(n,r).updateImmediateChild(u.name,je.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kg{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Ot}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return ue(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return ue(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Do}hasEnd(){return this.endSet_}getIndexEndValue(){return ue(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return ue(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Ti}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return ue(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Ot}copy(){const e=new Kg;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function $2(t){return t.loadsAllData()?new Yg(t.getIndex()):t.hasLimit()?new j2(t):new vl(t)}function hv(t){const e={};if(t.isDefault())return e;let n;if(t.index_===Ot?n="$priority":t.index_===N2?n="$value":t.index_===_o?n="$key":(ue(t.index_ instanceof L2,"Unrecognized index type!"),n=t.index_.toString()),e.orderBy=Yt(n),t.startSet_){const r=t.startAfterSet_?"startAfter":"startAt";e[r]=Yt(t.indexStartValue_),t.startNameSet_&&(e[r]+=","+Yt(t.indexStartName_))}if(t.endSet_){const r=t.endBeforeSet_?"endBefore":"endAt";e[r]=Yt(t.indexEndValue_),t.endNameSet_&&(e[r]+=","+Yt(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function pv(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;n===""&&(t.isViewFromLeft()?n="l":n="r"),e.vf=n}return t.index_!==Ot&&(e.i=t.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $u extends gE{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,n){return n!==void 0?"tag$"+n:(ue(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,n,r,s){super(),this.repoInfo_=e,this.onDataUpdate_=n,this.authTokenProvider_=r,this.appCheckTokenProvider_=s,this.log_=Pl("p:rest:"),this.listens_={}}listen(e,n,r,s){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const o=$u.getListenId_(e,r),a={};this.listens_[o]=a;const c=hv(e._queryParams);this.restRequest_(i+".json",c,(u,d)=>{let h=d;if(u===404&&(h=null,u=null),u===null&&this.onDataUpdate_(i,h,!1,r),bi(this.listens_,o)===a){let f;u?u===401?f="permission_denied":f="rest_error:"+u:f="ok",s(f,null)}})}unlisten(e,n){const r=$u.getListenId_(e,n);delete this.listens_[r]}get(e){const n=hv(e._queryParams),r=e._path.toString(),s=new cr;return this.restRequest_(r+".json",n,(i,o)=>{let a=o;i===404&&(a=null,i=null),i===null?(this.onDataUpdate_(r,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(e){}restRequest_(e,n={},r){return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,i])=>{s&&s.accessToken&&(n.auth=s.accessToken),i&&i.token&&(n.ac=i.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Go(n);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(r&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let c=null;if(a.status>=200&&a.status<300){try{c=fl(a.responseText)}catch{Tn("Failed to parse JSON response for "+o+": "+a.responseText)}r(null,c)}else a.status!==401&&a.status!==404&&Tn("Got unsuccessful REST response for "+o+" Status: "+a.status),r(a.status);r=null}},a.open("GET",o,!0),a.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F2{constructor(){this.rootNode_=je.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,n){this.rootNode_=this.rootNode_.updateChild(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fu(){return{value:null,children:new Map}}function Ko(t,e,n){if(rt(e))t.value=n,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,n);else{const r=tt(e);t.children.has(r)||t.children.set(r,Fu());const s=t.children.get(r);e=It(e),Ko(s,e,n)}}function hp(t,e){if(rt(e))return t.value=null,t.children.clear(),!0;if(t.value!==null){if(t.value.isLeafNode())return!1;{const n=t.value;return t.value=null,n.forEachChild(Ot,(r,s)=>{Ko(t,new vt(r),s)}),hp(t,e)}}else if(t.children.size>0){const n=tt(e);return e=It(e),t.children.has(n)&&hp(t.children.get(n),e)&&t.children.delete(n),t.children.size===0}else return!0}function pp(t,e,n){t.value!==null?n(e,t.value):U2(t,(r,s)=>{const i=new vt(e.toString()+"/"+r);pp(s,i,n)})}function U2(t,e){t.children.forEach((n,r)=>{e(r,n)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B2{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),n={...e};return this.last_&&en(this.last_,(r,s)=>{n[r]=n[r]-s}),this.last_=e,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gv=10*1e3,z2=30*1e3,H2=5*60*1e3;class W2{constructor(e,n){this.server_=n,this.statsToReport_={},this.statsListener_=new B2(e);const r=gv+(z2-gv)*Math.random();Ua(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),n={};let r=!1;en(e,(s,i)=>{i>0&&vr(this.statsToReport_,s)&&(n[s]=i,r=!0)}),r&&this.server_.reportStats(n),Ua(this.reportStats_.bind(this),Math.floor(Math.random()*2*H2))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var fr;(function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(fr||(fr={}));function Xg(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Qg(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Jg(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uu{constructor(e,n,r){this.path=e,this.affectedTree=n,this.revert=r,this.type=fr.ACK_USER_WRITE,this.source=Xg()}operationForChild(e){if(rt(this.path)){if(this.affectedTree.value!=null)return ue(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const n=this.affectedTree.subtree(new vt(e));return new Uu(ht(),n,this.revert)}}else return ue(tt(this.path)===e,"operationForChild called for unrelated child."),new Uu(It(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _l{constructor(e,n){this.source=e,this.path=n,this.type=fr.LISTEN_COMPLETE}operationForChild(e){return rt(this.path)?new _l(this.source,ht()):new _l(this.source,It(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ci{constructor(e,n,r){this.source=e,this.path=n,this.snap=r,this.type=fr.OVERWRITE}operationForChild(e){return rt(this.path)?new Ci(this.source,ht(),this.snap.getImmediateChild(e)):new Ci(this.source,It(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mo{constructor(e,n,r){this.source=e,this.path=n,this.children=r,this.type=fr.MERGE}operationForChild(e){if(rt(this.path)){const n=this.children.subtree(new vt(e));return n.isEmpty()?null:n.value?new Ci(this.source,ht(),n.value):new Mo(this.source,ht(),n)}else return ue(tt(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Mo(this.source,It(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ys{constructor(e,n,r){this.node_=e,this.fullyInitialized_=n,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(rt(e))return this.isFullyInitialized()&&!this.filtered_;const n=tt(e);return this.isCompleteForChild(n)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G2{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function V2(t,e,n,r){const s=[],i=[];return e.forEach(o=>{o.type==="child_changed"&&t.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&i.push(M2(o.childName,o.snapshotNode))}),ba(t,s,"child_removed",e,r,n),ba(t,s,"child_added",e,r,n),ba(t,s,"child_moved",i,r,n),ba(t,s,"child_changed",e,r,n),ba(t,s,"value",e,r,n),s}function ba(t,e,n,r,s,i){const o=r.filter(a=>a.type===n);o.sort((a,c)=>K2(t,a,c)),o.forEach(a=>{const c=Y2(t,a,i);s.forEach(u=>{u.respondsTo(a.type)&&e.push(u.createEvent(c,t.query_))})})}function Y2(t,e,n){return e.type==="value"||e.type==="child_removed"||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function K2(t,e,n){if(e.childName==null||n.childName==null)throw Ho("Should only compare child_ events.");const r=new st(e.childName,e.snapshotNode),s=new st(n.childName,n.snapshotNode);return t.index_.compare(r,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bd(t,e){return{eventCache:t,serverCache:e}}function Ba(t,e,n,r){return bd(new Ys(e,n,r),t.serverCache)}function TE(t,e,n,r){return bd(t.eventCache,new Ys(e,n,r))}function Bu(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function wi(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sh;const X2=()=>(sh||(sh=new Dn(Lk)),sh);class Ct{static fromObject(e){let n=new Ct(null);return en(e,(r,s)=>{n=n.set(new vt(r),s)}),n}constructor(e,n=X2()){this.value=e,this.children=n}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,n){if(this.value!=null&&n(this.value))return{path:ht(),value:this.value};if(rt(e))return null;{const r=tt(e),s=this.children.get(r);if(s!==null){const i=s.findRootMostMatchingPathAndValue(It(e),n);return i!=null?{path:Nt(new vt(r),i.path),value:i.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(rt(e))return this;{const n=tt(e),r=this.children.get(n);return r!==null?r.subtree(It(e)):new Ct(null)}}set(e,n){if(rt(e))return new Ct(n,this.children);{const r=tt(e),i=(this.children.get(r)||new Ct(null)).set(It(e),n),o=this.children.insert(r,i);return new Ct(this.value,o)}}remove(e){if(rt(e))return this.children.isEmpty()?new Ct(null):new Ct(null,this.children);{const n=tt(e),r=this.children.get(n);if(r){const s=r.remove(It(e));let i;return s.isEmpty()?i=this.children.remove(n):i=this.children.insert(n,s),this.value===null&&i.isEmpty()?new Ct(null):new Ct(this.value,i)}else return this}}get(e){if(rt(e))return this.value;{const n=tt(e),r=this.children.get(n);return r?r.get(It(e)):null}}setTree(e,n){if(rt(e))return n;{const r=tt(e),i=(this.children.get(r)||new Ct(null)).setTree(It(e),n);let o;return i.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,i),new Ct(this.value,o)}}fold(e){return this.fold_(ht(),e)}fold_(e,n){const r={};return this.children.inorderTraversal((s,i)=>{r[s]=i.fold_(Nt(e,s),n)}),n(e,this.value,r)}findOnPath(e,n){return this.findOnPath_(e,ht(),n)}findOnPath_(e,n,r){const s=this.value?r(n,this.value):!1;if(s)return s;if(rt(e))return null;{const i=tt(e),o=this.children.get(i);return o?o.findOnPath_(It(e),Nt(n,i),r):null}}foreachOnPath(e,n){return this.foreachOnPath_(e,ht(),n)}foreachOnPath_(e,n,r){if(rt(e))return this;{this.value&&r(n,this.value);const s=tt(e),i=this.children.get(s);return i?i.foreachOnPath_(It(e),Nt(n,s),r):new Ct(null)}}foreach(e){this.foreach_(ht(),e)}foreach_(e,n){this.children.inorderTraversal((r,s)=>{s.foreach_(Nt(e,r),n)}),this.value&&n(e,this.value)}foreachChild(e){this.children.inorderTraversal((n,r)=>{r.value&&e(n,r.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mr{constructor(e){this.writeTree_=e}static empty(){return new mr(new Ct(null))}}function za(t,e,n){if(rt(e))return new mr(new Ct(n));{const r=t.writeTree_.findRootMostValueAndPath(e);if(r!=null){const s=r.path;let i=r.value;const o=Sn(s,e);return i=i.updateChild(o,n),new mr(t.writeTree_.set(s,i))}else{const s=new Ct(n),i=t.writeTree_.setTree(e,s);return new mr(i)}}}function gp(t,e,n){let r=t;return en(n,(s,i)=>{r=za(r,Nt(e,s),i)}),r}function mv(t,e){if(rt(e))return mr.empty();{const n=t.writeTree_.setTree(e,new Ct(null));return new mr(n)}}function mp(t,e){return Oi(t,e)!=null}function Oi(t,e){const n=t.writeTree_.findRootMostValueAndPath(e);return n!=null?t.writeTree_.get(n.path).getChild(Sn(n.path,e)):null}function yv(t){const e=[],n=t.writeTree_.value;return n!=null?n.isLeafNode()||n.forEachChild(Ot,(r,s)=>{e.push(new st(r,s))}):t.writeTree_.children.inorderTraversal((r,s)=>{s.value!=null&&e.push(new st(r,s.value))}),e}function Us(t,e){if(rt(e))return t;{const n=Oi(t,e);return n!=null?new mr(new Ct(n)):new mr(t.writeTree_.subtree(e))}}function yp(t){return t.writeTree_.isEmpty()}function jo(t,e){return CE(ht(),t.writeTree_,e)}function CE(t,e,n){if(e.value!=null)return n.updateChild(t,e.value);{let r=null;return e.children.inorderTraversal((s,i)=>{s===".priority"?(ue(i.value!==null,"Priority writes must always be leaf nodes"),r=i.value):n=CE(Nt(t,s),i,n)}),!n.getChild(t).isEmpty()&&r!==null&&(n=n.updateChild(Nt(t,".priority"),r)),n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sd(t,e){return RE(e,t)}function Q2(t,e,n,r,s){ue(r>t.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),t.allWrites.push({path:e,snap:n,writeId:r,visible:s}),s&&(t.visibleWrites=za(t.visibleWrites,e,n)),t.lastWriteId=r}function J2(t,e,n,r){ue(r>t.lastWriteId,"Stacking an older merge on top of newer ones"),t.allWrites.push({path:e,children:n,writeId:r,visible:!0}),t.visibleWrites=gp(t.visibleWrites,e,n),t.lastWriteId=r}function q2(t,e){for(let n=0;n<t.allWrites.length;n++){const r=t.allWrites[n];if(r.writeId===e)return r}return null}function Z2(t,e){const n=t.allWrites.findIndex(a=>a.writeId===e);ue(n>=0,"removeWrite called with nonexistent writeId.");const r=t.allWrites[n];t.allWrites.splice(n,1);let s=r.visible,i=!1,o=t.allWrites.length-1;for(;s&&o>=0;){const a=t.allWrites[o];a.visible&&(o>=n&&eA(a,r.path)?s=!1:qn(r.path,a.path)&&(i=!0)),o--}if(s){if(i)return tA(t),!0;if(r.snap)t.visibleWrites=mv(t.visibleWrites,r.path);else{const a=r.children;en(a,c=>{t.visibleWrites=mv(t.visibleWrites,Nt(r.path,c))})}return!0}else return!1}function eA(t,e){if(t.snap)return qn(t.path,e);for(const n in t.children)if(t.children.hasOwnProperty(n)&&qn(Nt(t.path,n),e))return!0;return!1}function tA(t){t.visibleWrites=wE(t.allWrites,nA,ht()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function nA(t){return t.visible}function wE(t,e,n){let r=mr.empty();for(let s=0;s<t.length;++s){const i=t[s];if(e(i)){const o=i.path;let a;if(i.snap)qn(n,o)?(a=Sn(n,o),r=za(r,a,i.snap)):qn(o,n)&&(a=Sn(o,n),r=za(r,ht(),i.snap.getChild(a)));else if(i.children){if(qn(n,o))a=Sn(n,o),r=gp(r,a,i.children);else if(qn(o,n))if(a=Sn(o,n),rt(a))r=gp(r,ht(),i.children);else{const c=bi(i.children,tt(a));if(c){const u=c.getChild(It(a));r=za(r,ht(),u)}}}else throw Ho("WriteRecord should have .snap or .children")}}return r}function kE(t,e,n,r,s){if(!r&&!s){const i=Oi(t.visibleWrites,e);if(i!=null)return i;{const o=Us(t.visibleWrites,e);if(yp(o))return n;if(n==null&&!mp(o,ht()))return null;{const a=n||je.EMPTY_NODE;return jo(o,a)}}}else{const i=Us(t.visibleWrites,e);if(!s&&yp(i))return n;if(!s&&n==null&&!mp(i,ht()))return null;{const o=function(u){return(u.visible||s)&&(!r||!~r.indexOf(u.writeId))&&(qn(u.path,e)||qn(e,u.path))},a=wE(t.allWrites,o,e),c=n||je.EMPTY_NODE;return jo(a,c)}}}function rA(t,e,n){let r=je.EMPTY_NODE;const s=Oi(t.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(Ot,(i,o)=>{r=r.updateImmediateChild(i,o)}),r;if(n){const i=Us(t.visibleWrites,e);return n.forEachChild(Ot,(o,a)=>{const c=jo(Us(i,new vt(o)),a);r=r.updateImmediateChild(o,c)}),yv(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{const i=Us(t.visibleWrites,e);return yv(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function sA(t,e,n,r,s){ue(r||s,"Either existingEventSnap or existingServerSnap must exist");const i=Nt(e,n);if(mp(t.visibleWrites,i))return null;{const o=Us(t.visibleWrites,i);return yp(o)?s.getChild(n):jo(o,s.getChild(n))}}function iA(t,e,n,r){const s=Nt(e,n),i=Oi(t.visibleWrites,s);if(i!=null)return i;if(r.isCompleteForChild(n)){const o=Us(t.visibleWrites,s);return jo(o,r.getNode().getImmediateChild(n))}else return null}function oA(t,e){return Oi(t.visibleWrites,e)}function aA(t,e,n,r,s,i,o){let a;const c=Us(t.visibleWrites,e),u=Oi(c,ht());if(u!=null)a=u;else if(n!=null)a=jo(c,n);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const d=[],h=o.getCompare(),f=i?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o);let E=f.getNext();for(;E&&d.length<s;)h(E,r)!==0&&d.push(E),E=f.getNext();return d}else return[]}function lA(){return{visibleWrites:mr.empty(),allWrites:[],lastWriteId:-1}}function zu(t,e,n,r){return kE(t.writeTree,t.treePath,e,n,r)}function qg(t,e){return rA(t.writeTree,t.treePath,e)}function vv(t,e,n,r){return sA(t.writeTree,t.treePath,e,n,r)}function Hu(t,e){return oA(t.writeTree,Nt(t.treePath,e))}function cA(t,e,n,r,s,i){return aA(t.writeTree,t.treePath,e,n,r,s,i)}function Zg(t,e,n){return iA(t.writeTree,t.treePath,e,n)}function AE(t,e){return RE(Nt(t.treePath,e),t.writeTree)}function RE(t,e){return{treePath:t,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uA{constructor(){this.changeMap=new Map}trackChildChange(e){const n=e.type,r=e.childName;ue(n==="child_added"||n==="child_changed"||n==="child_removed","Only child changes supported for tracking"),ue(r!==".priority","Only non-priority child changes can be tracked.");const s=this.changeMap.get(r);if(s){const i=s.type;if(n==="child_added"&&i==="child_removed")this.changeMap.set(r,yl(r,e.snapshotNode,s.snapshotNode));else if(n==="child_removed"&&i==="child_added")this.changeMap.delete(r);else if(n==="child_removed"&&i==="child_changed")this.changeMap.set(r,ml(r,s.oldSnap));else if(n==="child_changed"&&i==="child_added")this.changeMap.set(r,No(r,e.snapshotNode));else if(n==="child_changed"&&i==="child_changed")this.changeMap.set(r,yl(r,e.snapshotNode,s.oldSnap));else throw Ho("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dA{getCompleteChild(e){return null}getChildAfterChild(e,n,r){return null}}const PE=new dA;class e0{constructor(e,n,r=null){this.writes_=e,this.viewCache_=n,this.optCompleteServerCache_=r}getCompleteChild(e){const n=this.viewCache_.eventCache;if(n.isCompleteForChild(e))return n.getNode().getImmediateChild(e);{const r=this.optCompleteServerCache_!=null?new Ys(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Zg(this.writes_,e,r)}}getChildAfterChild(e,n,r){const s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:wi(this.viewCache_),i=cA(this.writes_,s,n,1,r,e);return i.length===0?null:i[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fA(t){return{filter:t}}function hA(t,e){ue(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),ue(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function pA(t,e,n,r,s){const i=new uA;let o,a;if(n.type===fr.OVERWRITE){const u=n;u.source.fromUser?o=vp(t,e,u.path,u.snap,r,s,i):(ue(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered()&&!rt(u.path),o=Wu(t,e,u.path,u.snap,r,s,a,i))}else if(n.type===fr.MERGE){const u=n;u.source.fromUser?o=mA(t,e,u.path,u.children,r,s,i):(ue(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered(),o=_p(t,e,u.path,u.children,r,s,a,i))}else if(n.type===fr.ACK_USER_WRITE){const u=n;u.revert?o=_A(t,e,u.path,r,s,i):o=yA(t,e,u.path,u.affectedTree,r,s,i)}else if(n.type===fr.LISTEN_COMPLETE)o=vA(t,e,n.path,r,i);else throw Ho("Unknown operation type: "+n.type);const c=i.getChanges();return gA(e,o,c),{viewCache:o,changes:c}}function gA(t,e,n){const r=e.eventCache;if(r.isFullyInitialized()){const s=r.getNode().isLeafNode()||r.getNode().isEmpty(),i=Bu(t);(n.length>0||!t.eventCache.isFullyInitialized()||s&&!r.getNode().equals(i)||!r.getNode().getPriority().equals(i.getPriority()))&&n.push(IE(Bu(e)))}}function OE(t,e,n,r,s,i){const o=e.eventCache;if(Hu(r,n)!=null)return e;{let a,c;if(rt(n))if(ue(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const u=wi(e),d=u instanceof je?u:je.EMPTY_NODE,h=qg(r,d);a=t.filter.updateFullNode(e.eventCache.getNode(),h,i)}else{const u=zu(r,wi(e));a=t.filter.updateFullNode(e.eventCache.getNode(),u,i)}else{const u=tt(n);if(u===".priority"){ue(Vs(n)===1,"Can't have a priority with additional path components");const d=o.getNode();c=e.serverCache.getNode();const h=vv(r,n,d,c);h!=null?a=t.filter.updatePriority(d,h):a=o.getNode()}else{const d=It(n);let h;if(o.isCompleteForChild(u)){c=e.serverCache.getNode();const f=vv(r,n,o.getNode(),c);f!=null?h=o.getNode().getImmediateChild(u).updateChild(d,f):h=o.getNode().getImmediateChild(u)}else h=Zg(r,u,e.serverCache);h!=null?a=t.filter.updateChild(o.getNode(),u,h,d,s,i):a=o.getNode()}}return Ba(e,a,o.isFullyInitialized()||rt(n),t.filter.filtersNodes())}}function Wu(t,e,n,r,s,i,o,a){const c=e.serverCache;let u;const d=o?t.filter:t.filter.getIndexedFilter();if(rt(n))u=d.updateFullNode(c.getNode(),r,null);else if(d.filtersNodes()&&!c.isFiltered()){const E=c.getNode().updateChild(n,r);u=d.updateFullNode(c.getNode(),E,null)}else{const E=tt(n);if(!c.isCompleteForPath(n)&&Vs(n)>1)return e;const k=It(n),G=c.getNode().getImmediateChild(E).updateChild(k,r);E===".priority"?u=d.updatePriority(c.getNode(),G):u=d.updateChild(c.getNode(),E,G,k,PE,null)}const h=TE(e,u,c.isFullyInitialized()||rt(n),d.filtersNodes()),f=new e0(s,h,i);return OE(t,h,n,s,f,a)}function vp(t,e,n,r,s,i,o){const a=e.eventCache;let c,u;const d=new e0(s,e,i);if(rt(n))u=t.filter.updateFullNode(e.eventCache.getNode(),r,o),c=Ba(e,u,!0,t.filter.filtersNodes());else{const h=tt(n);if(h===".priority")u=t.filter.updatePriority(e.eventCache.getNode(),r),c=Ba(e,u,a.isFullyInitialized(),a.isFiltered());else{const f=It(n),E=a.getNode().getImmediateChild(h);let k;if(rt(f))k=r;else{const P=d.getCompleteChild(h);P!=null?Hg(f)===".priority"&&P.getChild(yE(f)).isEmpty()?k=P:k=P.updateChild(f,r):k=je.EMPTY_NODE}if(E.equals(k))c=e;else{const P=t.filter.updateChild(a.getNode(),h,k,f,d,o);c=Ba(e,P,a.isFullyInitialized(),t.filter.filtersNodes())}}}return c}function _v(t,e){return t.eventCache.isCompleteForChild(e)}function mA(t,e,n,r,s,i,o){let a=e;return r.foreach((c,u)=>{const d=Nt(n,c);_v(e,tt(d))&&(a=vp(t,a,d,u,s,i,o))}),r.foreach((c,u)=>{const d=Nt(n,c);_v(e,tt(d))||(a=vp(t,a,d,u,s,i,o))}),a}function xv(t,e,n){return n.foreach((r,s)=>{e=e.updateChild(r,s)}),e}function _p(t,e,n,r,s,i,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,u;rt(n)?u=r:u=new Ct(null).setTree(n,r);const d=e.serverCache.getNode();return u.children.inorderTraversal((h,f)=>{if(d.hasChild(h)){const E=e.serverCache.getNode().getImmediateChild(h),k=xv(t,E,f);c=Wu(t,c,new vt(h),k,s,i,o,a)}}),u.children.inorderTraversal((h,f)=>{const E=!e.serverCache.isCompleteForChild(h)&&f.value===null;if(!d.hasChild(h)&&!E){const k=e.serverCache.getNode().getImmediateChild(h),P=xv(t,k,f);c=Wu(t,c,new vt(h),P,s,i,o,a)}}),c}function yA(t,e,n,r,s,i,o){if(Hu(s,n)!=null)return e;const a=e.serverCache.isFiltered(),c=e.serverCache;if(r.value!=null){if(rt(n)&&c.isFullyInitialized()||c.isCompleteForPath(n))return Wu(t,e,n,c.getNode().getChild(n),s,i,a,o);if(rt(n)){let u=new Ct(null);return c.getNode().forEachChild(_o,(d,h)=>{u=u.set(new vt(d),h)}),_p(t,e,n,u,s,i,a,o)}else return e}else{let u=new Ct(null);return r.foreach((d,h)=>{const f=Nt(n,d);c.isCompleteForPath(f)&&(u=u.set(d,c.getNode().getChild(f)))}),_p(t,e,n,u,s,i,a,o)}}function vA(t,e,n,r,s){const i=e.serverCache,o=TE(e,i.getNode(),i.isFullyInitialized()||rt(n),i.isFiltered());return OE(t,o,n,r,PE,s)}function _A(t,e,n,r,s,i){let o;if(Hu(r,n)!=null)return e;{const a=new e0(r,e,s),c=e.eventCache.getNode();let u;if(rt(n)||tt(n)===".priority"){let d;if(e.serverCache.isFullyInitialized())d=zu(r,wi(e));else{const h=e.serverCache.getNode();ue(h instanceof je,"serverChildren would be complete if leaf node"),d=qg(r,h)}d=d,u=t.filter.updateFullNode(c,d,i)}else{const d=tt(n);let h=Zg(r,d,e.serverCache);h==null&&e.serverCache.isCompleteForChild(d)&&(h=c.getImmediateChild(d)),h!=null?u=t.filter.updateChild(c,d,h,It(n),a,i):e.eventCache.getNode().hasChild(d)?u=t.filter.updateChild(c,d,je.EMPTY_NODE,It(n),a,i):u=c,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=zu(r,wi(e)),o.isLeafNode()&&(u=t.filter.updateFullNode(u,o,i)))}return o=e.serverCache.isFullyInitialized()||Hu(r,ht())!=null,Ba(e,u,o,t.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xA{constructor(e,n){this.query_=e,this.eventRegistrations_=[];const r=this.query_._queryParams,s=new Yg(r.getIndex()),i=$2(r);this.processor_=fA(i);const o=n.serverCache,a=n.eventCache,c=s.updateFullNode(je.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(je.EMPTY_NODE,a.getNode(),null),d=new Ys(c,o.isFullyInitialized(),s.filtersNodes()),h=new Ys(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=bd(h,d),this.eventGenerator_=new G2(this.query_)}get query(){return this.query_}}function EA(t){return t.viewCache_.serverCache.getNode()}function bA(t){return Bu(t.viewCache_)}function SA(t,e){const n=wi(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!rt(e)&&!n.getImmediateChild(tt(e)).isEmpty())?n.getChild(e):null}function Ev(t){return t.eventRegistrations_.length===0}function IA(t,e){t.eventRegistrations_.push(e)}function bv(t,e,n){const r=[];if(n){ue(e==null,"A cancel should cancel all event registrations.");const s=t.query._path;t.eventRegistrations_.forEach(i=>{const o=i.createCancelEvent(n,s);o&&r.push(o)})}if(e){let s=[];for(let i=0;i<t.eventRegistrations_.length;++i){const o=t.eventRegistrations_[i];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(t.eventRegistrations_.slice(i+1));break}}t.eventRegistrations_=s}else t.eventRegistrations_=[];return r}function Sv(t,e,n,r){e.type===fr.MERGE&&e.source.queryId!==null&&(ue(wi(t.viewCache_),"We should always have a full cache before handling merges"),ue(Bu(t.viewCache_),"Missing event cache, even though we have a server cache"));const s=t.viewCache_,i=pA(t.processor_,s,e,n,r);return hA(t.processor_,i.viewCache),ue(i.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=i.viewCache,LE(t,i.changes,i.viewCache.eventCache.getNode(),null)}function TA(t,e){const n=t.viewCache_.eventCache,r=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(Ot,(i,o)=>{r.push(No(i,o))}),n.isFullyInitialized()&&r.push(IE(n.getNode())),LE(t,r,n.getNode(),e)}function LE(t,e,n,r){const s=r?[r]:t.eventRegistrations_;return V2(t.eventGenerator_,e,n,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Gu;class DE{constructor(){this.views=new Map}}function CA(t){ue(!Gu,"__referenceConstructor has already been defined"),Gu=t}function wA(){return ue(Gu,"Reference.ts has not been loaded"),Gu}function kA(t){return t.views.size===0}function t0(t,e,n,r){const s=e.source.queryId;if(s!==null){const i=t.views.get(s);return ue(i!=null,"SyncTree gave us an op for an invalid query."),Sv(i,e,n,r)}else{let i=[];for(const o of t.views.values())i=i.concat(Sv(o,e,n,r));return i}}function NE(t,e,n,r,s){const i=e._queryIdentifier,o=t.views.get(i);if(!o){let a=zu(n,s?r:null),c=!1;a?c=!0:r instanceof je?(a=qg(n,r),c=!1):(a=je.EMPTY_NODE,c=!1);const u=bd(new Ys(a,c,!1),new Ys(r,s,!1));return new xA(e,u)}return o}function AA(t,e,n,r,s,i){const o=NE(t,e,r,s,i);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,o),IA(o,n),TA(o,n)}function RA(t,e,n,r){const s=e._queryIdentifier,i=[];let o=[];const a=Ks(t);if(s==="default")for(const[c,u]of t.views.entries())o=o.concat(bv(u,n,r)),Ev(u)&&(t.views.delete(c),u.query._queryParams.loadsAllData()||i.push(u.query));else{const c=t.views.get(s);c&&(o=o.concat(bv(c,n,r)),Ev(c)&&(t.views.delete(s),c.query._queryParams.loadsAllData()||i.push(c.query)))}return a&&!Ks(t)&&i.push(new(wA())(e._repo,e._path)),{removed:i,events:o}}function ME(t){const e=[];for(const n of t.views.values())n.query._queryParams.loadsAllData()||e.push(n);return e}function Bs(t,e){let n=null;for(const r of t.views.values())n=n||SA(r,e);return n}function jE(t,e){if(e._queryParams.loadsAllData())return Id(t);{const r=e._queryIdentifier;return t.views.get(r)}}function $E(t,e){return jE(t,e)!=null}function Ks(t){return Id(t)!=null}function Id(t){for(const e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Vu;function PA(t){ue(!Vu,"__referenceConstructor has already been defined"),Vu=t}function OA(){return ue(Vu,"Reference.ts has not been loaded"),Vu}let LA=1;class Iv{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Ct(null),this.pendingWriteTree_=lA(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function n0(t,e,n,r,s){return Q2(t.pendingWriteTree_,e,n,r,s),s?Xo(t,new Ci(Xg(),e,n)):[]}function DA(t,e,n,r){J2(t.pendingWriteTree_,e,n,r);const s=Ct.fromObject(n);return Xo(t,new Mo(Xg(),e,s))}function Cs(t,e,n=!1){const r=q2(t.pendingWriteTree_,e);if(Z2(t.pendingWriteTree_,e)){let i=new Ct(null);return r.snap!=null?i=i.set(ht(),!0):en(r.children,o=>{i=i.set(new vt(o),!0)}),Xo(t,new Uu(r.path,i,n))}else return[]}function Ll(t,e,n){return Xo(t,new Ci(Qg(),e,n))}function NA(t,e,n){const r=Ct.fromObject(n);return Xo(t,new Mo(Qg(),e,r))}function MA(t,e){return Xo(t,new _l(Qg(),e))}function jA(t,e,n){const r=r0(t,n);if(r){const s=s0(r),i=s.path,o=s.queryId,a=Sn(i,e),c=new _l(Jg(o),a);return i0(t,i,c)}else return[]}function Yu(t,e,n,r,s=!1){const i=e._path,o=t.syncPointTree_.get(i);let a=[];if(o&&(e._queryIdentifier==="default"||$E(o,e))){const c=RA(o,e,n,r);kA(o)&&(t.syncPointTree_=t.syncPointTree_.remove(i));const u=c.removed;if(a=c.events,!s){const d=u.findIndex(f=>f._queryParams.loadsAllData())!==-1,h=t.syncPointTree_.findOnPath(i,(f,E)=>Ks(E));if(d&&!h){const f=t.syncPointTree_.subtree(i);if(!f.isEmpty()){const E=UA(f);for(let k=0;k<E.length;++k){const P=E[k],G=P.query,x=zE(t,P);t.listenProvider_.startListening(Ha(G),xl(t,G),x.hashFn,x.onComplete)}}}!h&&u.length>0&&!r&&(d?t.listenProvider_.stopListening(Ha(e),null):u.forEach(f=>{const E=t.queryToTagMap.get(Cd(f));t.listenProvider_.stopListening(Ha(f),E)}))}BA(t,u)}return a}function FE(t,e,n,r){const s=r0(t,r);if(s!=null){const i=s0(s),o=i.path,a=i.queryId,c=Sn(o,e),u=new Ci(Jg(a),c,n);return i0(t,o,u)}else return[]}function $A(t,e,n,r){const s=r0(t,r);if(s){const i=s0(s),o=i.path,a=i.queryId,c=Sn(o,e),u=Ct.fromObject(n),d=new Mo(Jg(a),c,u);return i0(t,o,d)}else return[]}function xp(t,e,n,r=!1){const s=e._path;let i=null,o=!1;t.syncPointTree_.foreachOnPath(s,(f,E)=>{const k=Sn(f,s);i=i||Bs(E,k),o=o||Ks(E)});let a=t.syncPointTree_.get(s);a?(o=o||Ks(a),i=i||Bs(a,ht())):(a=new DE,t.syncPointTree_=t.syncPointTree_.set(s,a));let c;i!=null?c=!0:(c=!1,i=je.EMPTY_NODE,t.syncPointTree_.subtree(s).foreachChild((E,k)=>{const P=Bs(k,ht());P&&(i=i.updateImmediateChild(E,P))}));const u=$E(a,e);if(!u&&!e._queryParams.loadsAllData()){const f=Cd(e);ue(!t.queryToTagMap.has(f),"View does not exist, but we have a tag");const E=zA();t.queryToTagMap.set(f,E),t.tagToQueryMap.set(E,f)}const d=Sd(t.pendingWriteTree_,s);let h=AA(a,e,n,d,i,c);if(!u&&!o&&!r){const f=jE(a,e);h=h.concat(HA(t,e,f))}return h}function Td(t,e,n){const s=t.pendingWriteTree_,i=t.syncPointTree_.findOnPath(e,(o,a)=>{const c=Sn(o,e),u=Bs(a,c);if(u)return u});return kE(s,e,i,n,!0)}function FA(t,e){const n=e._path;let r=null;t.syncPointTree_.foreachOnPath(n,(u,d)=>{const h=Sn(u,n);r=r||Bs(d,h)});let s=t.syncPointTree_.get(n);s?r=r||Bs(s,ht()):(s=new DE,t.syncPointTree_=t.syncPointTree_.set(n,s));const i=r!=null,o=i?new Ys(r,!0,!1):null,a=Sd(t.pendingWriteTree_,e._path),c=NE(s,e,a,i?o.getNode():je.EMPTY_NODE,i);return bA(c)}function Xo(t,e){return UE(e,t.syncPointTree_,null,Sd(t.pendingWriteTree_,ht()))}function UE(t,e,n,r){if(rt(t.path))return BE(t,e,n,r);{const s=e.get(ht());n==null&&s!=null&&(n=Bs(s,ht()));let i=[];const o=tt(t.path),a=t.operationForChild(o),c=e.children.get(o);if(c&&a){const u=n?n.getImmediateChild(o):null,d=AE(r,o);i=i.concat(UE(a,c,u,d))}return s&&(i=i.concat(t0(s,t,r,n))),i}}function BE(t,e,n,r){const s=e.get(ht());n==null&&s!=null&&(n=Bs(s,ht()));let i=[];return e.children.inorderTraversal((o,a)=>{const c=n?n.getImmediateChild(o):null,u=AE(r,o),d=t.operationForChild(o);d&&(i=i.concat(BE(d,a,c,u)))}),s&&(i=i.concat(t0(s,t,r,n))),i}function zE(t,e){const n=e.query,r=xl(t,n);return{hashFn:()=>(EA(e)||je.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return r?jA(t,n._path,r):MA(t,n._path);{const i=Mk(s,n);return Yu(t,n,null,i)}}}}function xl(t,e){const n=Cd(e);return t.queryToTagMap.get(n)}function Cd(t){return t._path.toString()+"$"+t._queryIdentifier}function r0(t,e){return t.tagToQueryMap.get(e)}function s0(t){const e=t.indexOf("$");return ue(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new vt(t.substr(0,e))}}function i0(t,e,n){const r=t.syncPointTree_.get(e);ue(r,"Missing sync point for query tag that we're tracking");const s=Sd(t.pendingWriteTree_,e);return t0(r,n,s,null)}function UA(t){return t.fold((e,n,r)=>{if(n&&Ks(n))return[Id(n)];{let s=[];return n&&(s=ME(n)),en(r,(i,o)=>{s=s.concat(o)}),s}})}function Ha(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(OA())(t._repo,t._path):t}function BA(t,e){for(let n=0;n<e.length;++n){const r=e[n];if(!r._queryParams.loadsAllData()){const s=Cd(r),i=t.queryToTagMap.get(s);t.queryToTagMap.delete(s),t.tagToQueryMap.delete(i)}}}function zA(){return LA++}function HA(t,e,n){const r=e._path,s=xl(t,e),i=zE(t,n),o=t.listenProvider_.startListening(Ha(e),s,i.hashFn,i.onComplete),a=t.syncPointTree_.subtree(r);if(s)ue(!Ks(a.value),"If we're adding a query, it shouldn't be shadowed");else{const c=a.fold((u,d,h)=>{if(!rt(u)&&d&&Ks(d))return[Id(d).query];{let f=[];return d&&(f=f.concat(ME(d).map(E=>E.query))),en(h,(E,k)=>{f=f.concat(k)}),f}});for(let u=0;u<c.length;++u){const d=c[u];t.listenProvider_.stopListening(Ha(d),xl(t,d))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o0{constructor(e){this.node_=e}getImmediateChild(e){const n=this.node_.getImmediateChild(e);return new o0(n)}node(){return this.node_}}class a0{constructor(e,n){this.syncTree_=e,this.path_=n}getImmediateChild(e){const n=Nt(this.path_,e);return new a0(this.syncTree_,n)}node(){return Td(this.syncTree_,this.path_)}}const WA=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},Tv=function(t,e,n){if(!t||typeof t!="object")return t;if(ue(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return GA(t[".sv"],e,n);if(typeof t[".sv"]=="object")return VA(t[".sv"],e);ue(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},GA=function(t,e,n){switch(t){case"timestamp":return n.timestamp;default:ue(!1,"Unexpected server value: "+t)}},VA=function(t,e,n){t.hasOwnProperty("increment")||ue(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const r=t.increment;typeof r!="number"&&ue(!1,"Unexpected increment value: "+r);const s=e.node();if(ue(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return r;const o=s.getValue();return typeof o!="number"?r:o+r},HE=function(t,e,n,r){return c0(e,new a0(n,t),r)},l0=function(t,e,n){return c0(t,new o0(e),n)};function c0(t,e,n){const r=t.getPriority().val(),s=Tv(r,e.getImmediateChild(".priority"),n);let i;if(t.isLeafNode()){const o=t,a=Tv(o.getValue(),e,n);return a!==o.getValue()||s!==o.getPriority().val()?new Xt(a,Dt(s)):t}else{const o=t;return i=o,s!==o.getPriority().val()&&(i=i.updatePriority(new Xt(s))),o.forEachChild(Ot,(a,c)=>{const u=c0(c,e.getImmediateChild(a),n);u!==c&&(i=i.updateImmediateChild(a,u))}),i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u0{constructor(e="",n=null,r={children:{},childCount:0}){this.name=e,this.parent=n,this.node=r}}function wd(t,e){let n=e instanceof vt?e:new vt(e),r=t,s=tt(n);for(;s!==null;){const i=bi(r.node.children,s)||{children:{},childCount:0};r=new u0(s,r,i),n=It(n),s=tt(n)}return r}function Li(t){return t.node.value}function d0(t,e){t.node.value=e,Ep(t)}function WE(t){return t.node.childCount>0}function YA(t){return Li(t)===void 0&&!WE(t)}function kd(t,e){en(t.node.children,(n,r)=>{e(new u0(n,t,r))})}function GE(t,e,n,r){n&&e(t),kd(t,s=>{GE(s,e,!0)})}function KA(t,e,n){let r=t.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function Dl(t){return new vt(t.parent===null?t.name:Dl(t.parent)+"/"+t.name)}function Ep(t){t.parent!==null&&XA(t.parent,t.name,t)}function XA(t,e,n){const r=YA(n),s=vr(t.node.children,e);r&&s?(delete t.node.children[e],t.node.childCount--,Ep(t)):!r&&!s&&(t.node.children[e]=n.node,t.node.childCount++,Ep(t))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QA=/[\[\].#$\/\u0000-\u001F\u007F]/,JA=/[\[\].#$\u0000-\u001F\u007F]/,ih=10*1024*1024,f0=function(t){return typeof t=="string"&&t.length!==0&&!QA.test(t)},VE=function(t){return typeof t=="string"&&t.length!==0&&!JA.test(t)},qA=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),VE(t)},h0=function(t){return t===null||typeof t=="string"||typeof t=="number"&&!xd(t)||t&&typeof t=="object"&&vr(t,".sv")},Ku=function(t,e,n,r){r&&e===void 0||Nl(Oo(t,"value"),e,n)},Nl=function(t,e,n){const r=n instanceof vt?new m2(n,t):n;if(e===void 0)throw new Error(t+"contains undefined "+ci(r));if(typeof e=="function")throw new Error(t+"contains a function "+ci(r)+" with contents = "+e.toString());if(xd(e))throw new Error(t+"contains "+e.toString()+" "+ci(r));if(typeof e=="string"&&e.length>ih/3&&_d(e)>ih)throw new Error(t+"contains a string greater than "+ih+" utf8 bytes "+ci(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,i=!1;if(en(e,(o,a)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(i=!0,!f0(o)))throw new Error(t+" contains an invalid key ("+o+") "+ci(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);y2(r,o),Nl(t,a,r),v2(r)}),s&&i)throw new Error(t+' contains ".value" child '+ci(r)+" in addition to actual children.")}},ZA=function(t,e){let n,r;for(n=0;n<e.length;n++){r=e[n];const i=gl(r);for(let o=0;o<i.length;o++)if(!(i[o]===".priority"&&o===i.length-1)){if(!f0(i[o]))throw new Error(t+"contains an invalid key ("+i[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(g2);let s=null;for(n=0;n<e.length;n++){if(r=e[n],s!==null&&qn(s,r))throw new Error(t+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}},YE=function(t,e,n,r){const s=Oo(t,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");const i=[];en(e,(o,a)=>{const c=new vt(o);if(Nl(s,a,Nt(n,c)),Hg(c)===".priority"&&!h0(a))throw new Error(s+"contains an invalid value for '"+c.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");i.push(c)}),ZA(s,i)},eR=function(t,e,n){if(xd(e))throw new Error(Oo(t,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!h0(e))throw new Error(Oo(t,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")},KE=function(t,e,n,r){if(!VE(n))throw new Error(Oo(t,e)+'was an invalid path = "'+n+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},tR=function(t,e,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),KE(t,e,n)},ws=function(t,e){if(tt(e)===".info")throw new Error(t+" failed = Can't modify data under /.info/")},nR=function(t,e){const n=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!f0(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||n.length!==0&&!qA(n))throw new Error(Oo(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rR{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Ad(t,e){let n=null;for(let r=0;r<e.length;r++){const s=e[r],i=s.getPath();n!==null&&!Wg(i,n.path)&&(t.eventLists_.push(n),n=null),n===null&&(n={events:[],path:i}),n.events.push(s)}n&&t.eventLists_.push(n)}function XE(t,e,n){Ad(t,n),QE(t,r=>Wg(r,e))}function Wn(t,e,n){Ad(t,n),QE(t,r=>qn(r,e)||qn(e,r))}function QE(t,e){t.recursionDepth_++;let n=!0;for(let r=0;r<t.eventLists_.length;r++){const s=t.eventLists_[r];if(s){const i=s.path;e(i)?(sR(t.eventLists_[r]),t.eventLists_[r]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function sR(t){for(let e=0;e<t.events.length;e++){const n=t.events[e];if(n!==null){t.events[e]=null;const r=n.getEventRunner();Fa&&qt("event: "+n.toString()),Yo(r)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iR="repo_interrupt",oR=25;class aR{constructor(e,n,r,s){this.repoInfo_=e,this.forceRestClient_=n,this.authTokenProvider_=r,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new rR,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Fu(),this.transactionQueueTree_=new u0,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function lR(t,e,n){if(t.stats_=Bg(t.repoInfo_),t.forceRestClient_||Uk())t.server_=new $u(t.repoInfo_,(r,s,i,o)=>{Cv(t,r,s,i,o)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>wv(t,!0),0);else{if(typeof n<"u"&&n!==null){if(typeof n!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Yt(n)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}t.persistentConnection_=new Xr(t.repoInfo_,e,(r,s,i,o)=>{Cv(t,r,s,i,o)},r=>{wv(t,r)},r=>{cR(t,r)},t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(r=>{t.server_.refreshAuthToken(r)}),t.appCheckProvider_.addTokenChangeListener(r=>{t.server_.refreshAppCheckToken(r.token)}),t.statsReporter_=Gk(t.repoInfo_,()=>new W2(t.stats_,t.server_)),t.infoData_=new F2,t.infoSyncTree_=new Iv({startListening:(r,s,i,o)=>{let a=[];const c=t.infoData_.getNode(r._path);return c.isEmpty()||(a=Ll(t.infoSyncTree_,r._path,c),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),p0(t,"connected",!1),t.serverSyncTree_=new Iv({startListening:(r,s,i,o)=>(t.server_.listen(r,i,s,(a,c)=>{const u=o(a,c);Wn(t.eventQueue_,r._path,u)}),[]),stopListening:(r,s)=>{t.server_.unlisten(r,s)}})}function JE(t){const n=t.infoData_.getNode(new vt(".info/serverTimeOffset")).val()||0;return new Date().getTime()+n}function Ml(t){return WA({timestamp:JE(t)})}function Cv(t,e,n,r,s){t.dataUpdateCount++;const i=new vt(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let o=[];if(s)if(r){const c=Lu(n,u=>Dt(u));o=$A(t.serverSyncTree_,i,c,s)}else{const c=Dt(n);o=FE(t.serverSyncTree_,i,c,s)}else if(r){const c=Lu(n,u=>Dt(u));o=NA(t.serverSyncTree_,i,c)}else{const c=Dt(n);o=Ll(t.serverSyncTree_,i,c)}let a=i;o.length>0&&(a=$o(t,i)),Wn(t.eventQueue_,a,o)}function wv(t,e){p0(t,"connected",e),e===!1&&hR(t)}function cR(t,e){en(e,(n,r)=>{p0(t,n,r)})}function p0(t,e,n){const r=new vt("/.info/"+e),s=Dt(n);t.infoData_.updateSnapshot(r,s);const i=Ll(t.infoSyncTree_,r,s);Wn(t.eventQueue_,r,i)}function Rd(t){return t.nextWriteId_++}function uR(t,e,n){const r=FA(t.serverSyncTree_,e);return r!=null?Promise.resolve(r):t.server_.get(e).then(s=>{const i=Dt(s).withIndex(e._queryParams.getIndex());xp(t.serverSyncTree_,e,n,!0);let o;if(e._queryParams.loadsAllData())o=Ll(t.serverSyncTree_,e._path,i);else{const a=xl(t.serverSyncTree_,e);o=FE(t.serverSyncTree_,e._path,i,a)}return Wn(t.eventQueue_,e._path,o),Yu(t.serverSyncTree_,e,n,null,!0),i},s=>(Qo(t,"get for query "+Yt(e)+" failed: "+s),Promise.reject(new Error(s))))}function dR(t,e,n,r,s){Qo(t,"set",{path:e.toString(),value:n,priority:r});const i=Ml(t),o=Dt(n,r),a=Td(t.serverSyncTree_,e),c=l0(o,a,i),u=Rd(t),d=n0(t.serverSyncTree_,e,c,u,!0);Ad(t.eventQueue_,d),t.server_.put(e.toString(),o.val(!0),(f,E)=>{const k=f==="ok";k||Tn("set at "+e+" failed: "+f);const P=Cs(t.serverSyncTree_,u,!k);Wn(t.eventQueue_,e,P),Xs(t,s,f,E)});const h=m0(t,e);$o(t,h),Wn(t.eventQueue_,h,[])}function fR(t,e,n,r){Qo(t,"update",{path:e.toString(),value:n});let s=!0;const i=Ml(t),o={};if(en(n,(a,c)=>{s=!1,o[a]=HE(Nt(e,a),Dt(c),t.serverSyncTree_,i)}),s)qt("update() called with empty data.  Don't do anything."),Xs(t,r,"ok",void 0);else{const a=Rd(t),c=DA(t.serverSyncTree_,e,o,a);Ad(t.eventQueue_,c),t.server_.merge(e.toString(),n,(u,d)=>{const h=u==="ok";h||Tn("update at "+e+" failed: "+u);const f=Cs(t.serverSyncTree_,a,!h),E=f.length>0?$o(t,e):e;Wn(t.eventQueue_,E,f),Xs(t,r,u,d)}),en(n,u=>{const d=m0(t,Nt(e,u));$o(t,d)}),Wn(t.eventQueue_,e,[])}}function hR(t){Qo(t,"onDisconnectEvents");const e=Ml(t),n=Fu();pp(t.onDisconnect_,ht(),(s,i)=>{const o=HE(s,i,t.serverSyncTree_,e);Ko(n,s,o)});let r=[];pp(n,ht(),(s,i)=>{r=r.concat(Ll(t.serverSyncTree_,s,i));const o=m0(t,s);$o(t,o)}),t.onDisconnect_=Fu(),Wn(t.eventQueue_,ht(),r)}function pR(t,e,n){t.server_.onDisconnectCancel(e.toString(),(r,s)=>{r==="ok"&&hp(t.onDisconnect_,e),Xs(t,n,r,s)})}function kv(t,e,n,r){const s=Dt(n);t.server_.onDisconnectPut(e.toString(),s.val(!0),(i,o)=>{i==="ok"&&Ko(t.onDisconnect_,e,s),Xs(t,r,i,o)})}function gR(t,e,n,r,s){const i=Dt(n,r);t.server_.onDisconnectPut(e.toString(),i.val(!0),(o,a)=>{o==="ok"&&Ko(t.onDisconnect_,e,i),Xs(t,s,o,a)})}function mR(t,e,n,r){if(Ou(n)){qt("onDisconnect().update() called with empty data.  Don't do anything."),Xs(t,r,"ok",void 0);return}t.server_.onDisconnectMerge(e.toString(),n,(s,i)=>{s==="ok"&&en(n,(o,a)=>{const c=Dt(a);Ko(t.onDisconnect_,Nt(e,o),c)}),Xs(t,r,s,i)})}function yR(t,e,n){let r;tt(e._path)===".info"?r=xp(t.infoSyncTree_,e,n):r=xp(t.serverSyncTree_,e,n),XE(t.eventQueue_,e._path,r)}function vR(t,e,n){let r;tt(e._path)===".info"?r=Yu(t.infoSyncTree_,e,n):r=Yu(t.serverSyncTree_,e,n),XE(t.eventQueue_,e._path,r)}function _R(t){t.persistentConnection_&&t.persistentConnection_.interrupt(iR)}function Qo(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),qt(n,...e)}function Xs(t,e,n,r){e&&Yo(()=>{if(n==="ok")e(null);else{const s=(n||"error").toUpperCase();let i=s;r&&(i+=": "+r);const o=new Error(i);o.code=s,e(o)}})}function xR(t,e,n,r,s,i){Qo(t,"transaction on "+e);const o={path:e,update:n,onComplete:r,status:null,order:Xx(),applyLocally:i,retryCount:0,unwatcher:s,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=g0(t,e,void 0);o.currentInputSnapshot=a;const c=o.update(a.val());if(c===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{Nl("transaction failed: Data returned ",c,o.path),o.status=0;const u=wd(t.transactionQueueTree_,e),d=Li(u)||[];d.push(o),d0(u,d);let h;typeof c=="object"&&c!==null&&vr(c,".priority")?(h=bi(c,".priority"),ue(h0(h),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):h=(Td(t.serverSyncTree_,e)||je.EMPTY_NODE).getPriority().val();const f=Ml(t),E=Dt(c,h),k=l0(E,a,f);o.currentOutputSnapshotRaw=E,o.currentOutputSnapshotResolved=k,o.currentWriteId=Rd(t);const P=n0(t.serverSyncTree_,e,k,o.currentWriteId,o.applyLocally);Wn(t.eventQueue_,e,P),Pd(t,t.transactionQueueTree_)}}function g0(t,e,n){return Td(t.serverSyncTree_,e,n)||je.EMPTY_NODE}function Pd(t,e=t.transactionQueueTree_){if(e||Od(t,e),Li(e)){const n=ZE(t,e);ue(n.length>0,"Sending zero length transaction queue"),n.every(s=>s.status===0)&&ER(t,Dl(e),n)}else WE(e)&&kd(e,n=>{Pd(t,n)})}function ER(t,e,n){const r=n.map(u=>u.currentWriteId),s=g0(t,e,r);let i=s;const o=s.hash();for(let u=0;u<n.length;u++){const d=n[u];ue(d.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),d.status=1,d.retryCount++;const h=Sn(e,d.path);i=i.updateChild(h,d.currentOutputSnapshotRaw)}const a=i.val(!0),c=e;t.server_.put(c.toString(),a,u=>{Qo(t,"transaction put response",{path:c.toString(),status:u});let d=[];if(u==="ok"){const h=[];for(let f=0;f<n.length;f++)n[f].status=2,d=d.concat(Cs(t.serverSyncTree_,n[f].currentWriteId)),n[f].onComplete&&h.push(()=>n[f].onComplete(null,!0,n[f].currentOutputSnapshotResolved)),n[f].unwatcher();Od(t,wd(t.transactionQueueTree_,e)),Pd(t,t.transactionQueueTree_),Wn(t.eventQueue_,e,d);for(let f=0;f<h.length;f++)Yo(h[f])}else{if(u==="datastale")for(let h=0;h<n.length;h++)n[h].status===3?n[h].status=4:n[h].status=0;else{Tn("transaction at "+c.toString()+" failed: "+u);for(let h=0;h<n.length;h++)n[h].status=4,n[h].abortReason=u}$o(t,e)}},o)}function $o(t,e){const n=qE(t,e),r=Dl(n),s=ZE(t,n);return bR(t,s,r),r}function bR(t,e,n){if(e.length===0)return;const r=[];let s=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const c=e[a],u=Sn(n,c.path);let d=!1,h;if(ue(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)d=!0,h=c.abortReason,s=s.concat(Cs(t.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=oR)d=!0,h="maxretry",s=s.concat(Cs(t.serverSyncTree_,c.currentWriteId,!0));else{const f=g0(t,c.path,o);c.currentInputSnapshot=f;const E=e[a].update(f.val());if(E!==void 0){Nl("transaction failed: Data returned ",E,c.path);let k=Dt(E);typeof E=="object"&&E!=null&&vr(E,".priority")||(k=k.updatePriority(f.getPriority()));const G=c.currentWriteId,x=Ml(t),S=l0(k,f,x);c.currentOutputSnapshotRaw=k,c.currentOutputSnapshotResolved=S,c.currentWriteId=Rd(t),o.splice(o.indexOf(G),1),s=s.concat(n0(t.serverSyncTree_,c.path,S,c.currentWriteId,c.applyLocally)),s=s.concat(Cs(t.serverSyncTree_,G,!0))}else d=!0,h="nodata",s=s.concat(Cs(t.serverSyncTree_,c.currentWriteId,!0))}Wn(t.eventQueue_,n,s),s=[],d&&(e[a].status=2,function(f){setTimeout(f,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(h==="nodata"?r.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):r.push(()=>e[a].onComplete(new Error(h),!1,null))))}Od(t,t.transactionQueueTree_);for(let a=0;a<r.length;a++)Yo(r[a]);Pd(t,t.transactionQueueTree_)}function qE(t,e){let n,r=t.transactionQueueTree_;for(n=tt(e);n!==null&&Li(r)===void 0;)r=wd(r,n),e=It(e),n=tt(e);return r}function ZE(t,e){const n=[];return eb(t,e,n),n.sort((r,s)=>r.order-s.order),n}function eb(t,e,n){const r=Li(e);if(r)for(let s=0;s<r.length;s++)n.push(r[s]);kd(e,s=>{eb(t,s,n)})}function Od(t,e){const n=Li(e);if(n){let r=0;for(let s=0;s<n.length;s++)n[s].status!==2&&(n[r]=n[s],r++);n.length=r,d0(e,n.length>0?n:void 0)}kd(e,r=>{Od(t,r)})}function m0(t,e){const n=Dl(qE(t,e)),r=wd(t.transactionQueueTree_,e);return KA(r,s=>{oh(t,s)}),oh(t,r),GE(r,s=>{oh(t,s)}),n}function oh(t,e){const n=Li(e);if(n){const r=[];let s=[],i=-1;for(let o=0;o<n.length;o++)n[o].status===3||(n[o].status===1?(ue(i===o-1,"All SENT items should be at beginning of queue."),i=o,n[o].status=3,n[o].abortReason="set"):(ue(n[o].status===0,"Unexpected transaction status in abort"),n[o].unwatcher(),s=s.concat(Cs(t.serverSyncTree_,n[o].currentWriteId,!0)),n[o].onComplete&&r.push(n[o].onComplete.bind(null,new Error("set"),!1,null))));i===-1?d0(e,void 0):n.length=i+1,Wn(t.eventQueue_,Dl(e),s);for(let o=0;o<r.length;o++)Yo(r[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SR(t){let e="";const n=t.split("/");for(let r=0;r<n.length;r++)if(n[r].length>0){let s=n[r];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function IR(t){const e={};t.charAt(0)==="?"&&(t=t.substring(1));for(const n of t.split("&")){if(n.length===0)continue;const r=n.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):Tn(`Invalid query segment '${n}' in query '${t}'`)}return e}const Av=function(t,e){const n=TR(t),r=n.namespace;n.domain==="firebase.com"&&ts(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&n.domain!=="localhost"&&ts("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||Pk();const s=n.scheme==="ws"||n.scheme==="wss";return{repoInfo:new lE(n.host,n.secure,r,s,e,"",r!==n.subdomain),path:new vt(n.pathString)}},TR=function(t){let e="",n="",r="",s="",i="",o=!0,a="https",c=443;if(typeof t=="string"){let u=t.indexOf("//");u>=0&&(a=t.substring(0,u-1),t=t.substring(u+2));let d=t.indexOf("/");d===-1&&(d=t.length);let h=t.indexOf("?");h===-1&&(h=t.length),e=t.substring(0,Math.min(d,h)),d<h&&(s=SR(t.substring(d,h)));const f=IR(t.substring(Math.min(t.length,h)));u=e.indexOf(":"),u>=0?(o=a==="https"||a==="wss",c=parseInt(e.substring(u+1),10)):u=e.length;const E=e.slice(0,u);if(E.toLowerCase()==="localhost")n="localhost";else if(E.split(".").length<=2)n=E;else{const k=e.indexOf(".");r=e.substring(0,k).toLowerCase(),n=e.substring(k+1),i=r}"ns"in f&&(i=f.ns)}return{host:e,port:c,domain:n,subdomain:r,secure:o,scheme:a,pathString:s,namespace:i}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rv="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",CR=function(){let t=0;const e=[];return function(n){const r=n===t;t=n;let s;const i=new Array(8);for(s=7;s>=0;s--)i[s]=Rv.charAt(n%64),n=Math.floor(n/64);ue(n===0,"Cannot push at time == 0");let o=i.join("");if(r){for(s=11;s>=0&&e[s]===63;s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)o+=Rv.charAt(e[s]);return ue(o.length===20,"nextPushId: Length should be 20."),o}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wR{constructor(e,n,r,s){this.eventType=e,this.eventRegistration=n,this.snapshot=r,this.prevName=s}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Yt(this.snapshot.exportVal())}}class kR{constructor(e,n,r){this.eventRegistration=e,this.error=n,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tb{constructor(e,n){this.snapshotCallback=e,this.cancelCallback=n}onValue(e,n){this.snapshotCallback.call(null,e,n)}onCancel(e){return ue(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AR{constructor(e,n){this._repo=e,this._path=n}cancel(){const e=new cr;return pR(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){ws("OnDisconnect.remove",this._path);const e=new cr;return kv(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){ws("OnDisconnect.set",this._path),Ku("OnDisconnect.set",e,this._path,!1);const n=new cr;return kv(this._repo,this._path,e,n.wrapCallback(()=>{})),n.promise}setWithPriority(e,n){ws("OnDisconnect.setWithPriority",this._path),Ku("OnDisconnect.setWithPriority",e,this._path,!1),eR("OnDisconnect.setWithPriority",n);const r=new cr;return gR(this._repo,this._path,e,n,r.wrapCallback(()=>{})),r.promise}update(e){ws("OnDisconnect.update",this._path),YE("OnDisconnect.update",e,this._path);const n=new cr;return mR(this._repo,this._path,e,n.wrapCallback(()=>{})),n.promise}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y0{constructor(e,n,r,s){this._repo=e,this._path=n,this._queryParams=r,this._orderByCalled=s}get key(){return rt(this._path)?null:Hg(this._path)}get ref(){return new Or(this._repo,this._path)}get _queryIdentifier(){const e=pv(this._queryParams),n=Fg(e);return n==="{}"?"default":n}get _queryObject(){return pv(this._queryParams)}isEqual(e){if(e=yn(e),!(e instanceof y0))return!1;const n=this._repo===e._repo,r=Wg(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return n&&r&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+p2(this._path)}}class Or extends y0{constructor(e,n){super(e,n,new Kg,!1)}get parent(){const e=yE(this._path);return e===null?null:new Or(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class Fo{constructor(e,n,r){this._node=e,this.ref=n,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const n=new vt(e),r=El(this.ref,e);return new Fo(this._node.getChild(n),r,Ot)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,s)=>e(new Fo(s,El(this.ref,r),Ot)))}hasChild(e){const n=new vt(e);return!this._node.getChild(n).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Wr(t,e){return t=yn(t),t._checkNotDeleted("ref"),e!==void 0?El(t._root,e):t._root}function El(t,e){return t=yn(t),tt(t._path)===null?tR("child","path",e):KE("child","path",e),new Or(t._repo,Nt(t._path,e))}function RR(t){return t=yn(t),new AR(t._repo,t._path)}function PR(t,e){t=yn(t),ws("push",t._path),Ku("push",e,t._path,!0);const n=JE(t._repo),r=CR(n),s=El(t,r),i=El(t,r);let o;return o=Promise.resolve(i),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function kc(t){return ws("remove",t._path),Ld(t,null)}function Ld(t,e){t=yn(t),ws("set",t._path),Ku("set",e,t._path,!1);const n=new cr;return dR(t._repo,t._path,e,null,n.wrapCallback(()=>{})),n.promise}function nb(t,e){YE("update",e,t._path);const n=new cr;return fR(t._repo,t._path,e,n.wrapCallback(()=>{})),n.promise}function Dd(t){t=yn(t);const e=new tb(()=>{}),n=new Nd(e);return uR(t._repo,t,n).then(r=>new Fo(r,new Or(t._repo,t._path),t._queryParams.getIndex()))}class Nd{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,n){const r=n._queryParams.getIndex();return new wR("value",this,new Fo(e.snapshotNode,new Or(n._repo,n._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new kR(this,e,n):null}matches(e){return e instanceof Nd?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function OR(t,e,n,r,s){const i=new tb(n,void 0),o=new Nd(i);return yR(t._repo,t,o),()=>vR(t._repo,t,o)}function rb(t,e,n,r){return OR(t,"value",e)}CA(Or);PA(Or);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LR="FIREBASE_DATABASE_EMULATOR_HOST",bp={};let DR=!1;function NR(t,e,n,r){const s=e.lastIndexOf(":"),i=e.substring(0,s),o=Wo(i);t.repoInfo_=new lE(e,o,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0,n),r&&(t.authTokenProvider_=r)}function MR(t,e,n,r,s){let i=r||t.options.databaseURL;i===void 0&&(t.options.projectId||ts("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),qt("Using default host for project ",t.options.projectId),i=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o=Av(i,s),a=o.repoInfo,c;typeof process<"u"&&Qy&&(c=Qy[LR]),c?(i=`http://${c}?ns=${a.namespace}`,o=Av(i,s),a=o.repoInfo):o.repoInfo.secure;const u=new zk(t.name,t.options,e);nR("Invalid Firebase Database URL",o),rt(o.path)||ts("Database URL must point to the root of a Firebase Database (not including a child path).");const d=$R(a,t,u,new Bk(t,n));return new FR(d,t)}function jR(t,e){const n=bp[e];(!n||n[t.key]!==t)&&ts(`Database ${e}(${t.repoInfo_}) has already been deleted.`),_R(t),delete n[t.key]}function $R(t,e,n,r){let s=bp[e.name];s||(s={},bp[e.name]=s);let i=s[t.toURLString()];return i&&ts("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new aR(t,DR,n,r),s[t.toURLString()]=i,i}class FR{constructor(e,n){this._repoInternal=e,this.app=n,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(lR(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Or(this._repo,ht())),this._rootInternal}_delete(){return this._rootInternal!==null&&(jR(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&ts("Cannot call "+e+" on a deleted database.")}}function UR(t=Wx(),e){const n=$g(t,"database").getImmediate({identifier:e});if(!n._instanceStarted){const r=QC("database");r&&BR(n,...r)}return n}function BR(t,e,n,r={}){t=yn(t),t._checkNotDeleted("useEmulator");const s=`${e}:${n}`,i=t._repoInternal;if(t._instanceStarted){if(s===t._repoInternal.repoInfo_.host&&Si(r,i.repoInfo_.emulatorOptions))return;ts("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&ts('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new Yc(Yc.OWNER);else if(r.mockUserToken){const a=typeof r.mockUserToken=="string"?r.mockUserToken:JC(r.mockUserToken,t.app.options.projectId);o=new Yc(a)}Wo(e)&&(jx(e),$x("Database",!0)),NR(i,s,r,o)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zR(t){Ck(Vo),Lo(new Ii("database",(e,{instanceIdentifier:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return MR(r,s,i,n)},"PUBLIC").setMultipleInstances(!0)),Fs(Jy,qy,t),Fs(Jy,qy,"esm2020")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HR{constructor(e,n){this.committed=e,this.snapshot=n}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function WR(t,e,n){if(t=yn(t),ws("Reference.transaction",t._path),t.key===".length"||t.key===".keys")throw"Reference.transaction failed: "+t.key+" is a read-only object.";const r=!0,s=new cr,i=(a,c,u)=>{let d=null;a?s.reject(a):(d=new Fo(u,new Or(t._repo,t._path),Ot),s.resolve(new HR(c,d)))},o=rb(t,()=>{});return xR(t._repo,t._path,e,i,o,r),s.promise}Xr.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};Xr.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};zR();function sb(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const GR=sb,ib=new Al("auth","Firebase",sb());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xu=new Mg("@firebase/auth");function VR(t,...e){Xu.logLevel<=xt.WARN&&Xu.warn(`Auth (${Vo}): ${t}`,...e)}function Kc(t,...e){Xu.logLevel<=xt.ERROR&&Xu.error(`Auth (${Vo}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ns(t,...e){throw v0(t,...e)}function Rr(t,...e){return v0(t,...e)}function ob(t,e,n){const r={...GR(),[e]:n};return new Al("auth","Firebase",r).create(e,{appName:t.name})}function zs(t){return ob(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function v0(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return ib.create(t,...e)}function He(t,e,...n){if(!t)throw v0(e,...n)}function Gr(t){const e="INTERNAL ASSERTION FAILED: "+t;throw Kc(e),new Error(e)}function rs(t,e){t||Gr(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sp(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.href)||""}function YR(){return Pv()==="http:"||Pv()==="https:"}function Pv(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KR(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(YR()||tw()||"connection"in navigator)?navigator.onLine:!0}function XR(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jl{constructor(e,n){this.shortDelay=e,this.longDelay=n,rs(n>e,"Short delay should be less than long delay!"),this.isMobile=Ng()||Fx()}get(){return KR()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _0(t,e){rs(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ab{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Gr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Gr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Gr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QR={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JR=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],qR=new jl(3e4,6e4);function Md(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function Jo(t,e,n,r,s={}){return lb(t,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=Go({key:t.config.apiKey,...o}).slice(1),c=await t._getAdditionalHeaders();c["Content-Type"]="application/json",t.languageCode&&(c["X-Firebase-Locale"]=t.languageCode);const u={method:e,headers:c,...i};return ew()||(u.referrerPolicy="no-referrer"),t.emulatorConfig&&Wo(t.emulatorConfig.host)&&(u.credentials="include"),ab.fetch()(await ub(t,t.config.apiHost,n,a),u)})}async function lb(t,e,n){t._canInitEmulator=!1;const r={...QR,...e};try{const s=new ZR(t),i=await Promise.race([n(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Ac(t,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[c,u]=a.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw Ac(t,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw Ac(t,"email-already-in-use",o);if(c==="USER_DISABLED")throw Ac(t,"user-disabled",o);const d=r[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw ob(t,d,u);ns(t,d)}}catch(s){if(s instanceof ei)throw s;ns(t,"network-request-failed",{message:String(s)})}}async function cb(t,e,n,r,s={}){const i=await Jo(t,e,n,r,s);return"mfaPendingCredential"in i&&ns(t,"multi-factor-auth-required",{_serverResponse:i}),i}async function ub(t,e,n,r){const s=`${e}${n}?${r}`,i=t,o=i.config.emulator?_0(t.config,s):`${t.config.apiScheme}://${s}`;return JR.includes(n)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(o).toString():o}class ZR{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(Rr(this.auth,"network-request-failed")),qR.get())})}}function Ac(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=Rr(t,e,r);return s.customData._tokenResponse=n,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function e5(t,e){return Jo(t,"POST","/v1/accounts:delete",e)}async function Qu(t,e){return Jo(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wa(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function t5(t,e=!1){const n=yn(t),r=await n.getIdToken(e),s=x0(r);He(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:Wa(ah(s.auth_time)),issuedAtTime:Wa(ah(s.iat)),expirationTime:Wa(ah(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function ah(t){return Number(t)*1e3}function x0(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return Kc("JWT malformed, contained fewer than 3 sections"),null;try{const s=Pu(n);return s?JSON.parse(s):(Kc("Failed to decode base64 JWT payload"),null)}catch(s){return Kc("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function Ov(t){const e=x0(t);return He(e,"internal-error"),He(typeof e.exp<"u","internal-error"),He(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bl(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof ei&&n5(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function n5({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r5{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ip{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Wa(this.lastLoginAt),this.creationTime=Wa(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ju(t){var h;const e=t.auth,n=await t.getIdToken(),r=await bl(t,Qu(e,{idToken:n}));He(r==null?void 0:r.users.length,e,"internal-error");const s=r.users[0];t._notifyReloadListener(s);const i=(h=s.providerUserInfo)!=null&&h.length?db(s.providerUserInfo):[],o=i5(t.providerData,i),a=t.isAnonymous,c=!(t.email&&s.passwordHash)&&!(o!=null&&o.length),u=a?c:!1,d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new Ip(s.createdAt,s.lastLoginAt),isAnonymous:u};Object.assign(t,d)}async function s5(t){const e=yn(t);await Ju(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function i5(t,e){return[...t.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function db(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function o5(t,e){const n=await lb(t,{},async()=>{const r=Go({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=t.config,o=await ub(t,s,"/v1/token",`key=${i}`),a=await t._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const c={method:"POST",headers:a,body:r};return t.emulatorConfig&&Wo(t.emulatorConfig.host)&&(c.credentials="include"),ab.fetch()(o,c)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function a5(t,e){return Jo(t,"POST","/v2/accounts:revokeToken",Md(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xo{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){He(e.idToken,"internal-error"),He(typeof e.idToken<"u","internal-error"),He(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Ov(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){He(e.length!==0,"internal-error");const n=Ov(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(He(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:s,expiresIn:i}=await o5(e,n);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:s,expirationTime:i}=n,o=new xo;return r&&(He(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(He(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(He(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new xo,this.toJSON())}_performRefresh(){return Gr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ps(t,e){He(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class hr{constructor({uid:e,auth:n,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new r5(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Ip(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const n=await bl(this,this.stsTokenManager.getToken(this.auth,e));return He(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return t5(this,e)}reload(){return s5(this)}_assign(e){this!==e&&(He(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new hr({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){He(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await Ju(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(ur(this.auth.app))return Promise.reject(zs(this.auth));const e=await this.getIdToken();return await bl(this,e5(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const r=n.displayName??void 0,s=n.email??void 0,i=n.phoneNumber??void 0,o=n.photoURL??void 0,a=n.tenantId??void 0,c=n._redirectEventId??void 0,u=n.createdAt??void 0,d=n.lastLoginAt??void 0,{uid:h,emailVerified:f,isAnonymous:E,providerData:k,stsTokenManager:P}=n;He(h&&P,e,"internal-error");const G=xo.fromJSON(this.name,P);He(typeof h=="string",e,"internal-error"),ps(r,e.name),ps(s,e.name),He(typeof f=="boolean",e,"internal-error"),He(typeof E=="boolean",e,"internal-error"),ps(i,e.name),ps(o,e.name),ps(a,e.name),ps(c,e.name),ps(u,e.name),ps(d,e.name);const x=new hr({uid:h,auth:e,email:s,emailVerified:f,displayName:r,isAnonymous:E,photoURL:o,phoneNumber:i,tenantId:a,stsTokenManager:G,createdAt:u,lastLoginAt:d});return k&&Array.isArray(k)&&(x.providerData=k.map(S=>({...S}))),c&&(x._redirectEventId=c),x}static async _fromIdTokenResponse(e,n,r=!1){const s=new xo;s.updateFromServerResponse(n);const i=new hr({uid:n.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Ju(i),i}static async _fromGetAccountInfoResponse(e,n,r){const s=n.users[0];He(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?db(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new xo;a.updateFromIdToken(r);const c=new hr({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),u={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Ip(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(c,u),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lv=new Map;function Vr(t){rs(t instanceof Function,"Expected a class definition");let e=Lv.get(t);return e?(rs(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,Lv.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fb{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}fb.type="NONE";const Dv=fb;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xc(t,e,n){return`firebase:${t}:${e}:${n}`}class Eo{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=Xc(this.userKey,s.apiKey,i),this.fullPersistenceKey=Xc("persistence",s.apiKey,i),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await Qu(this.auth,{idToken:e}).catch(()=>{});return n?hr._fromGetAccountInfoResponse(this.auth,n,e):null}return hr._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new Eo(Vr(Dv),e,r);const s=(await Promise.all(n.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let i=s[0]||Vr(Dv);const o=Xc(r,e.config.apiKey,e.name);let a=null;for(const u of n)try{const d=await u._get(o);if(d){let h;if(typeof d=="string"){const f=await Qu(e,{idToken:d}).catch(()=>{});if(!f)break;h=await hr._fromGetAccountInfoResponse(e,f,d)}else h=hr._fromJSON(e,d);u!==i&&(a=h),i=u;break}}catch{}const c=s.filter(u=>u._shouldAllowMigration);return!i._shouldAllowMigration||!c.length?new Eo(i,e,r):(i=c[0],a&&await i._set(o,a.toJSON()),await Promise.all(n.map(async u=>{if(u!==i)try{await u._remove(o)}catch{}})),new Eo(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nv(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(mb(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(hb(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(vb(e))return"Blackberry";if(_b(e))return"Webos";if(pb(e))return"Safari";if((e.includes("chrome/")||gb(e))&&!e.includes("edge/"))return"Chrome";if(yb(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function hb(t=Cn()){return/firefox\//i.test(t)}function pb(t=Cn()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function gb(t=Cn()){return/crios\//i.test(t)}function mb(t=Cn()){return/iemobile/i.test(t)}function yb(t=Cn()){return/android/i.test(t)}function vb(t=Cn()){return/blackberry/i.test(t)}function _b(t=Cn()){return/webos/i.test(t)}function E0(t=Cn()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function l5(t=Cn()){var e;return E0(t)&&!!((e=window.navigator)!=null&&e.standalone)}function c5(){return nw()&&document.documentMode===10}function xb(t=Cn()){return E0(t)||yb(t)||_b(t)||vb(t)||/windows phone/i.test(t)||mb(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eb(t,e=[]){let n;switch(t){case"Browser":n=Nv(Cn());break;case"Worker":n=`${Nv(Cn())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${Vo}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u5{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=i=>new Promise((o,a)=>{try{const c=e(i);o(c)}catch(c){a(c)}});r.onAbort=n,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const s of n)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function d5(t,e={}){return Jo(t,"GET","/v2/passwordPolicy",Md(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f5=6;class h5{constructor(e){var r;const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??f5,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((r=e.allowedNonAlphanumericCharacters)==null?void 0:r.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),s&&(n.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p5{constructor(e,n,r,s){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Mv(this),this.idTokenSubscription=new Mv(this),this.beforeStateQueue=new u5(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ib,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=Vr(n)),this._initializationPromise=this.queue(async()=>{var r,s,i;if(!this._deleted&&(this.persistenceManager=await Eo.create(this,e),(r=this._resolvePersistenceManagerAvailable)==null||r.call(this),!this._deleted)){if((s=this._popupRedirectResolver)!=null&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((i=this.currentUser)==null?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await Qu(this,{idToken:e}),r=await hr._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(ur(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(i=this.redirectUser)==null?void 0:i._redirectEventId,a=r==null?void 0:r._redirectEventId,c=await this.tryRedirectSignIn(e);(!o||o===a)&&(c!=null&&c.user)&&(r=c.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return He(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await Ju(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=XR()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(ur(this.app))return Promise.reject(zs(this));const n=e?yn(e):null;return n&&He(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&He(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return ur(this.app)?Promise.reject(zs(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return ur(this.app)?Promise.reject(zs(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Vr(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await d5(this),n=new h5(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Al("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await a5(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&Vr(e)||this._popupRedirectResolver;He(n,this,"argument-error"),this.redirectPersistenceManager=await Eo.create(this,[Vr(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)==null?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)==null?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((n=this.currentUser)==null?void 0:n.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,s){if(this._deleted)return()=>{};const i=typeof n=="function"?n:n.next.bind(n);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(He(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof n=="function"){const c=e.addObserver(n,r,s);return()=>{o=!0,c()}}else{const c=e.addObserver(n);return()=>{o=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return He(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Eb(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var s;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await((s=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getHeartbeatsHeader());n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var n;if(ur(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((n=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:n.getToken());return e!=null&&e.error&&VR(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function jd(t){return yn(t)}class Mv{constructor(e){this.auth=e,this.observer=null,this.addObserver=fw(n=>this.observer=n)}get next(){return He(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let b0={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function g5(t){b0=t}function m5(t){return b0.loadJS(t)}function y5(){return b0.gapiScript}function v5(t){return`__${t}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _5(t,e){const n=$g(t,"auth");if(n.isInitialized()){const s=n.getImmediate(),i=n.getOptions();if(Si(i,e??{}))return s;ns(s,"already-initialized")}return n.initialize({options:e})}function x5(t,e){const n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(Vr);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function E5(t,e,n){const r=jd(t);He(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,i=bb(e),{host:o,port:a}=b5(e),c=a===null?"":`:${a}`,u={url:`${i}//${o}${c}/`},d=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){He(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),He(Si(u,r.config.emulator)&&Si(d,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=u,r.emulatorConfig=d,r.settings.appVerificationDisabledForTesting=!0,Wo(o)?(jx(`${i}//${o}${c}`),$x("Auth",!0)):S5()}function bb(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function b5(t){const e=bb(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:jv(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:jv(o)}}}function jv(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function S5(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sb{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return Gr("not implemented")}_getIdTokenResponse(e){return Gr("not implemented")}_linkToIdToken(e,n){return Gr("not implemented")}_getReauthenticationResolver(e){return Gr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bo(t,e){return cb(t,"POST","/v1/accounts:signInWithIdp",Md(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I5="http://localhost";class ki extends Sb{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new ki(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):ns("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=n;if(!r||!s)return null;const o=new ki(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const n=this.buildRequest();return bo(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,bo(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,bo(e,n)}buildRequest(){const e={requestUri:I5,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=Go(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ib{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $l extends Ib{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _s extends $l{constructor(){super("facebook.com")}static credential(e){return ki._fromParams({providerId:_s.PROVIDER_ID,signInMethod:_s.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return _s.credentialFromTaggedObject(e)}static credentialFromError(e){return _s.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return _s.credential(e.oauthAccessToken)}catch{return null}}}_s.FACEBOOK_SIGN_IN_METHOD="facebook.com";_s.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xs extends $l{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return ki._fromParams({providerId:xs.PROVIDER_ID,signInMethod:xs.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return xs.credentialFromTaggedObject(e)}static credentialFromError(e){return xs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return xs.credential(n,r)}catch{return null}}}xs.GOOGLE_SIGN_IN_METHOD="google.com";xs.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Es extends $l{constructor(){super("github.com")}static credential(e){return ki._fromParams({providerId:Es.PROVIDER_ID,signInMethod:Es.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Es.credentialFromTaggedObject(e)}static credentialFromError(e){return Es.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Es.credential(e.oauthAccessToken)}catch{return null}}}Es.GITHUB_SIGN_IN_METHOD="github.com";Es.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bs extends $l{constructor(){super("twitter.com")}static credential(e,n){return ki._fromParams({providerId:bs.PROVIDER_ID,signInMethod:bs.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return bs.credentialFromTaggedObject(e)}static credentialFromError(e){return bs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return bs.credential(n,r)}catch{return null}}}bs.TWITTER_SIGN_IN_METHOD="twitter.com";bs.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function T5(t,e){return cb(t,"POST","/v1/accounts:signUp",Md(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qs{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,s=!1){const i=await hr._fromIdTokenResponse(e,r,s),o=$v(r);return new Qs({user:i,providerId:o,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const s=$v(r);return new Qs({user:e,providerId:s,_tokenResponse:r,operationType:n})}}function $v(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function C5(t){var s;if(ur(t.app))return Promise.reject(zs(t));const e=jd(t);if(await e._initializationPromise,(s=e.currentUser)!=null&&s.isAnonymous)return new Qs({user:e.currentUser,providerId:null,operationType:"signIn"});const n=await T5(e,{returnSecureToken:!0}),r=await Qs._fromIdTokenResponse(e,"signIn",n,!0);return await e._updateCurrentUser(r.user),r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qu extends ei{constructor(e,n,r,s){super(n.code,n.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,qu.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,s){return new qu(e,n,r,s)}}function Tb(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?qu._fromErrorAndOperation(t,i,e,r):i})}async function w5(t,e,n=!1){const r=await bl(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Qs._forOperation(t,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function k5(t,e,n=!1){const{auth:r}=t;if(ur(r.app))return Promise.reject(zs(r));const s="reauthenticate";try{const i=await bl(t,Tb(r,s,e,t),n);He(i.idToken,r,"internal-error");const o=x0(i.idToken);He(o,r,"internal-error");const{sub:a}=o;return He(t.uid===a,r,"user-mismatch"),Qs._forOperation(t,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&ns(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function A5(t,e,n=!1){if(ur(t.app))return Promise.reject(zs(t));const r="signIn",s=await Tb(t,r,e),i=await Qs._fromIdTokenResponse(t,r,s);return n||await t._updateCurrentUser(i.user),i}function R5(t,e,n,r){return yn(t).onIdTokenChanged(e,n,r)}function P5(t,e,n){return yn(t).beforeAuthStateChanged(e,n)}function O5(t,e,n,r){return yn(t).onAuthStateChanged(e,n,r)}const Zu="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cb{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(Zu,"1"),this.storage.removeItem(Zu),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const L5=1e3,D5=10;class wb extends Cb{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=xb(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),s=this.localCache[n];r!==s&&e(n,s,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((o,a,c)=>{this.notifyListeners(o,c)});return}const r=e.key;n?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!n&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);c5()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,D5):s()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},L5)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}wb.type="LOCAL";const N5=wb;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kb extends Cb{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}kb.type="SESSION";const Ab=kb;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M5(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $d{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(s=>s.isListeningto(e));if(n)return n;const r=new $d(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:s,data:i}=n.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async u=>u(n.origin,i)),c=await M5(a);n.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:c})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}$d.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S0(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j5{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,c)=>{const u=S0("",20);s.port1.start();const d=setTimeout(()=>{c(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(h){const f=h;if(f.data.eventId===u)switch(f.data.status){case"ack":clearTimeout(d),i=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(f.data.response);break;default:clearTimeout(d),clearTimeout(i),c(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:n},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pr(){return window}function $5(t){Pr().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rb(){return typeof Pr().WorkerGlobalScope<"u"&&typeof Pr().importScripts=="function"}async function F5(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function U5(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)==null?void 0:t.controller)||null}function B5(){return Rb()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pb="firebaseLocalStorageDb",z5=1,ed="firebaseLocalStorage",Ob="fbase_key";class Fl{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function Fd(t,e){return t.transaction([ed],e?"readwrite":"readonly").objectStore(ed)}function H5(){const t=indexedDB.deleteDatabase(Pb);return new Fl(t).toPromise()}function Tp(){const t=indexedDB.open(Pb,z5);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(ed,{keyPath:Ob})}catch(s){n(s)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(ed)?e(r):(r.close(),await H5(),e(await Tp()))})})}async function Fv(t,e,n){const r=Fd(t,!0).put({[Ob]:e,value:n});return new Fl(r).toPromise()}async function W5(t,e){const n=Fd(t,!1).get(e),r=await new Fl(n).toPromise();return r===void 0?null:r.value}function Uv(t,e){const n=Fd(t,!0).delete(e);return new Fl(n).toPromise()}const G5=800,V5=3;class Lb{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Tp(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>V5)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Rb()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=$d._getInstance(B5()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var n,r;if(this.activeServiceWorker=await F5(),!this.activeServiceWorker)return;this.sender=new j5(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(n=e[0])!=null&&n.fulfilled&&(r=e[0])!=null&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||U5()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Tp();return await Fv(e,Zu,"1"),await Uv(e,Zu),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>Fv(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>W5(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>Uv(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Fd(s,!1).getAll();return new Fl(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),n.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),n.push(s));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),G5)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Lb.type="LOCAL";const Y5=Lb;new jl(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K5(t,e){return e?Vr(e):(He(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I0 extends Sb{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return bo(e,this._buildIdpRequest())}_linkToIdToken(e,n){return bo(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return bo(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function X5(t){return A5(t.auth,new I0(t),t.bypassAuthState)}function Q5(t){const{auth:e,user:n}=t;return He(n,e,"internal-error"),k5(n,new I0(t),t.bypassAuthState)}async function J5(t){const{auth:e,user:n}=t;return He(n,e,"internal-error"),w5(n,new I0(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Db{constructor(e,n,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:n,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(c))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return X5;case"linkViaPopup":case"linkViaRedirect":return J5;case"reauthViaPopup":case"reauthViaRedirect":return Q5;default:ns(this.auth,"internal-error")}}resolve(e){rs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){rs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q5=new jl(2e3,1e4);class uo extends Db{constructor(e,n,r,s,i){super(e,n,s,i),this.provider=r,this.authWindow=null,this.pollId=null,uo.currentPopupAction&&uo.currentPopupAction.cancel(),uo.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return He(e,this.auth,"internal-error"),e}async onExecution(){rs(this.filter.length===1,"Popup operations only handle one event");const e=S0();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Rr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(Rr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,uo.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if((r=(n=this.authWindow)==null?void 0:n.window)!=null&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Rr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,q5.get())};e()}}uo.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z5="pendingRedirect",Qc=new Map;class eP extends Db{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=Qc.get(this.auth._key());if(!e){try{const r=await tP(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}Qc.set(this.auth._key(),e)}return this.bypassAuthState||Qc.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function tP(t,e){const n=sP(e),r=rP(t);if(!await r._isAvailable())return!1;const s=await r._get(n)==="true";return await r._remove(n),s}function nP(t,e){Qc.set(t._key(),e)}function rP(t){return Vr(t._redirectPersistence)}function sP(t){return Xc(Z5,t.config.apiKey,t.name)}async function iP(t,e,n=!1){if(ur(t.app))return Promise.reject(zs(t));const r=jd(t),s=K5(r,e),o=await new eP(r,s,n).execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oP=10*60*1e3;class aP{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!lP(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!Nb(e)){const s=((r=e.error.code)==null?void 0:r.split("auth/")[1])||"internal-error";n.onError(Rr(this.auth,s))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=oP&&this.cachedEventUids.clear(),this.cachedEventUids.has(Bv(e))}saveEventToCache(e){this.cachedEventUids.add(Bv(e)),this.lastProcessedEventTime=Date.now()}}function Bv(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function Nb({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function lP(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Nb(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cP(t,e={}){return Jo(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uP=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,dP=/^https?/;async function fP(t){if(t.config.emulator)return;const{authorizedDomains:e}=await cP(t);for(const n of e)try{if(hP(n))return}catch{}ns(t,"unauthorized-domain")}function hP(t){const e=Sp(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const o=new URL(t);return o.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&o.hostname===r}if(!dP.test(n))return!1;if(uP.test(t))return r===t;const s=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pP=new jl(3e4,6e4);function zv(){const t=Pr().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function gP(t){return new Promise((e,n)=>{var s,i,o;function r(){zv(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{zv(),n(Rr(t,"network-request-failed"))},timeout:pP.get()})}if((i=(s=Pr().gapi)==null?void 0:s.iframes)!=null&&i.Iframe)e(gapi.iframes.getContext());else if((o=Pr().gapi)!=null&&o.load)r();else{const a=v5("iframefcb");return Pr()[a]=()=>{gapi.load?r():n(Rr(t,"network-request-failed"))},m5(`${y5()}?onload=${a}`).catch(c=>n(c))}}).catch(e=>{throw Jc=null,e})}let Jc=null;function mP(t){return Jc=Jc||gP(t),Jc}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yP=new jl(5e3,15e3),vP="__/auth/iframe",_P="emulator/auth/iframe",xP={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},EP=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function bP(t){const e=t.config;He(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?_0(e,_P):`https://${t.config.authDomain}/${vP}`,r={apiKey:e.apiKey,appName:t.name,v:Vo},s=EP.get(t.config.apiHost);s&&(r.eid=s);const i=t._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${Go(r).slice(1)}`}async function SP(t){const e=await mP(t),n=Pr().gapi;return He(n,t,"internal-error"),e.open({where:document.body,url:bP(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:xP,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=Rr(t,"network-request-failed"),a=Pr().setTimeout(()=>{i(o)},yP.get());function c(){Pr().clearTimeout(a),s(r)}r.ping(c).then(c,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IP={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},TP=500,CP=600,wP="_blank",kP="http://localhost";class Hv{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function AP(t,e,n,r=TP,s=CP){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const c={...IP,width:r.toString(),height:s.toString(),top:i,left:o},u=Cn().toLowerCase();n&&(a=gb(u)?wP:n),hb(u)&&(e=e||kP,c.scrollbars="yes");const d=Object.entries(c).reduce((f,[E,k])=>`${f}${E}=${k},`,"");if(l5(u)&&a!=="_self")return RP(e||"",a),new Hv(null);const h=window.open(e||"",a,d);He(h,t,"popup-blocked");try{h.focus()}catch{}return new Hv(h)}function RP(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PP="__/auth/handler",OP="emulator/auth/handler",LP=encodeURIComponent("fac");async function Wv(t,e,n,r,s,i){He(t.config.authDomain,t,"auth-domain-config-required"),He(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:Vo,eventId:s};if(e instanceof Ib){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",Ou(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[d,h]of Object.entries({}))o[d]=h}if(e instanceof $l){const d=e.getScopes().filter(h=>h!=="");d.length>0&&(o.scopes=d.join(","))}t.tenantId&&(o.tid=t.tenantId);const a=o;for(const d of Object.keys(a))a[d]===void 0&&delete a[d];const c=await t._getAppCheckToken(),u=c?`#${LP}=${encodeURIComponent(c)}`:"";return`${DP(t)}?${Go(a).slice(1)}${u}`}function DP({config:t}){return t.emulator?_0(t,OP):`https://${t.authDomain}/${PP}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lh="webStorageSupport";class NP{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Ab,this._completeRedirectFn=iP,this._overrideRedirectResult=nP}async _openPopup(e,n,r,s){var o;rs((o=this.eventManagers[e._key()])==null?void 0:o.manager,"_initialize() not called before _openPopup()");const i=await Wv(e,n,r,Sp(),s);return AP(e,i,S0())}async _openRedirect(e,n,r,s){await this._originValidation(e);const i=await Wv(e,n,r,Sp(),s);return $5(i),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:s,promise:i}=this.eventManagers[n];return s?Promise.resolve(s):(rs(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await SP(e),r=new aP(e);return n.register("authEvent",s=>(He(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(lh,{type:lh},s=>{var o;const i=(o=s==null?void 0:s[0])==null?void 0:o[lh];i!==void 0&&n(!!i),ns(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=fP(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return xb()||pb()||E0()}}const MP=NP;var Gv="@firebase/auth",Vv="1.12.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jP{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){He(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $P(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function FP(t){Lo(new Ii("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;He(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:o,authDomain:a,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Eb(t)},u=new p5(r,s,i,c);return x5(u,n),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),Lo(new Ii("auth-internal",e=>{const n=jd(e.getProvider("auth").getImmediate());return(r=>new jP(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Fs(Gv,Vv,$P(t)),Fs(Gv,Vv,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UP=5*60,BP=Mx("authIdTokenMaxAge")||UP;let Yv=null;const zP=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>BP)return;const s=n==null?void 0:n.token;Yv!==s&&(Yv=s,await fetch(t,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function HP(t=Wx()){const e=$g(t,"auth");if(e.isInitialized())return e.getImmediate();const n=_5(t,{popupRedirectResolver:MP,persistence:[Y5,N5,Ab]}),r=Mx("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=zP(i.toString());P5(n,o,()=>o(n.currentUser)),R5(n,a=>o(a))}}const s=Dx("auth");return s&&E5(n,`http://${s}`),n}function WP(){var t;return((t=document.getElementsByTagName("head"))==null?void 0:t[0])??document}g5({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=s=>{const i=Rr("internal-error");i.customData=s,n(i)},r.type="text/javascript",r.charset="UTF-8",WP().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});FP("Browser");const GP={apiKey:"AIzaSyCqXssa5oOaWY3CiN7ti53Qt1F_AGpBrVE",authDomain:"tenfubu-verse.firebaseapp.com",databaseURL:"https://tenfubu-verse-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"tenfubu-verse",storageBucket:"tenfubu-verse.firebasestorage.app",messagingSenderId:"1047996014362",appId:"1:1047996014362:web:729f6b715d929087e296a3"},Mb=Hx(GP),Yr=UR(Mb),jb=HP(Mb),T0=[{rank:"BRONZE",min:0,max:2e3,lossPoints:0},{rank:"SILVER",min:2001,max:4e3,lossPoints:20},{rank:"GOLD",min:4001,max:6e3,lossPoints:40},{rank:"PLATINUM",min:6001,max:8e3,lossPoints:60},{rank:"DIAMOND",min:8001,max:1e4,lossPoints:80},{rank:"MASTER",min:10001,max:1/0,lossPoints:100}],So={BRONZE:"",SILVER:"",GOLD:"",PLATINUM:"",DIAMOND:"",MASTER:""},wr=t=>{for(const e of T0)if(t>=e.min&&t<=e.max)return e.rank;return"BRONZE"},Ga=t=>T0.findIndex(e=>e.rank===t),$b=()=>({rating:0,winStreak:0,totalMatches:0,wins:0,losses:0}),Rc=200,Kv=100,VP=10,YP=20,KP=(t,e,n)=>{const r=wr(t),s=wr(n),i=Ga(r),o=Ga(s),a=e+1,c=Math.min((a-1)*VP,Kv),u=Math.max(0,o-i),d=Math.min(u*YP,Kv),h=100+c+d,f=Math.floor(Rc*h/100),E=t+f,k=wr(E),P=Ga(k);return{newRating:E,ratingChange:f,newWinStreak:a,newRank:k,oldRank:r,isRankUp:P>i,isRankDown:!1,bonusBreakdown:{base:Rc,winStreakBonus:Math.floor(Rc*c/100),rankDiffBonus:Math.floor(Rc*d/100),total:f}}},XP=t=>{const e=wr(t),r=-T0.find(c=>c.rank===e).lossPoints,s=Math.max(0,t+r),i=wr(s),o=Ga(e),a=Ga(i);return{newRating:s,ratingChange:r,newWinStreak:0,newRank:i,oldRank:e,isRankUp:!1,isRankDown:a<o,bonusBreakdown:{base:r,winStreakBonus:0,rankDiffBonus:0,total:r}}},Xv=async(t,e)=>{const n=Wr(Yr,`players/${t}`),r=await Dd(n);if(r.exists()){const i=r.val();return i.playerName!==e&&(await nb(n,{playerName:e}),i.playerName=e),i}const s={playerName:e,createdAt:Date.now(),lastMatchAt:Date.now(),ratings:{}};return await Ld(n,s),s},Fb=async(t,e)=>{const n=Wr(Yr,`players/${t}/ratings/${e}`),r=await Dd(n);if(r.exists())return r.val();const s=$b();return await Ld(n,s),s},QP=async t=>{const e=Wr(Yr,`players/${t}/ratings`),n=await Dd(e);return n.exists()?n.val():{}},JP=async(t,e,n,r)=>{const s=Wr(Yr,`players/${t}/ratings/${e}`),i=Wr(Yr,`players/${t}`);await WR(s,o=>{const a=o||$b();return{rating:n.newRating,winStreak:n.newWinStreak,totalMatches:a.totalMatches+1,wins:a.wins+(r?1:0),losses:a.losses+(r?0:1)}}),await nb(i,{lastMatchAt:Date.now()})},C0=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},qP=C0("/leaders/azya_leader.png"),ZP=C0("/leaders/senka_leader.png"),eO=C0("/leaders/yoRuka_leader.png"),tO=1280,nO=720,rO={BRONZE:"#cd7f32",SILVER:"#c0c0c0",GOLD:"#ffd700",PLATINUM:"#e5e4e2",DIAMOND:"#b9f2ff",MASTER:"#ff4500"},sO=({onSelectClass:t,onBack:e,gameMode:n="CPU",aiDifficulty:r="NORMAL",onDifficultyChange:s,playerName:i,onPlayerNameChange:o,timerEnabled:a=!0,onTimerEnabledChange:c,playerId:u})=>{const[d,h]=F.useState(1),[f,E]=F.useState({}),[k,P]=F.useState(!1);F.useEffect(()=>{const Q=()=>{const ce=window.innerWidth/tO,me=window.innerHeight/nO;h(Math.min(ce,me))};return Q(),window.addEventListener("resize",Q),()=>window.removeEventListener("resize",Q)},[]),F.useEffect(()=>{(async()=>{if(!u){P(!1);return}P(!0);try{const ce=await QP(u);E(ce)}catch(ce){console.error("Failed to fetch class ratings:",ce)}finally{P(!1)}})()},[u]);const G=200*d,x=280*d,S=2*d,w=1.4*d,p=.75*d,b=.65*d,H=1.2*d,re=`${8*d}px ${16*d}px`,K=Q=>{if(n!=="RANKED_MATCH"||!u||k)return null;const ce=f[Q];if(!ce)return null;const me=wr(ce.rating),Se=So[me],de=rO[me];return l.jsxs("div",{style:{marginTop:`${4*d}px`,padding:`${4*d}px ${8*d}px`,background:"rgba(0, 0, 0, 0.3)",borderRadius:4*d,display:"flex",alignItems:"center",gap:`${6*d}px`},children:[l.jsx("span",{style:{fontSize:`${.7*d}rem`,fontWeight:"bold",color:de,fontFamily:"Tamanegi, sans-serif"},children:Se}),l.jsx("span",{style:{fontSize:`${.75*d}rem`,color:"#fff",fontFamily:"Tamanegi, sans-serif"},children:ce.rating})]})};return l.jsxs("div",{className:"screen",style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"#1a1a2e",color:"white"},children:[l.jsx("h2",{style:{fontSize:`${S}rem`,marginBottom:`${.5*d}rem`,marginTop:0},children:""}),l.jsxs("div",{style:{marginBottom:`${.8*d}rem`,display:"flex",flexDirection:"column",alignItems:"center",gap:`${.3*d}rem`},children:[l.jsx("label",{style:{fontSize:`${.9*d}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif"},children:""}),l.jsx("input",{type:"text",value:i,onChange:Q=>o(Q.target.value),maxLength:12,placeholder:"",style:{padding:`${6*d}px ${12*d}px`,fontSize:`${.9*d}rem`,background:"#2d3748",border:"2px solid #4a5568",borderRadius:6*d,color:"white",outline:"none",width:180*d,textAlign:"center",fontFamily:"Tamanegi, sans-serif"},onFocus:Q=>Q.target.style.borderColor="#63b3ed",onBlur:Q=>Q.target.style.borderColor="#4a5568"})]}),l.jsxs("div",{style:{display:"flex",gap:`${H}rem`,marginBottom:`${1*d}rem`},children:[l.jsxs("div",{onClick:()=>t("SENKA"),style:{width:G,height:x,border:"1px solid #444",borderRadius:10*d,background:"linear-gradient(180deg, #2c0b0e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s",boxShadow:"0 4px 20px rgba(233, 69, 96, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:Q=>Q.currentTarget.style.transform="scale(1.05)",onMouseOut:Q=>Q.currentTarget.style.transform="scale(1)",children:[l.jsx("img",{src:ZP,alt:"Senka",style:{width:"100%",height:"60%",objectFit:"cover"}}),l.jsxs("div",{style:{padding:`${6*d}px`,display:"flex",flexDirection:"column",alignItems:"center"},children:[l.jsx("h3",{style:{fontSize:`${w}rem`,color:"#e94560",margin:0},children:""}),l.jsx("p",{style:{color:"#aaa",margin:`${3*d}px 0`,fontSize:`${p}rem`,fontFamily:"Tamanegi, sans-serif"},children:" / "}),l.jsxs("p",{style:{padding:`0 ${.5*d}rem`,textAlign:"center",fontSize:`${b}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",lineHeight:1.3},children:["",l.jsx("br",{}),""]}),K("SENKA")]})]}),l.jsxs("div",{onClick:()=>t("AJA"),style:{width:G,height:x,border:"1px solid #444",borderRadius:10*d,background:"linear-gradient(180deg, #0f1c2e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s",boxShadow:"0 4px 20px rgba(69, 162, 233, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:Q=>Q.currentTarget.style.transform="scale(1.05)",onMouseOut:Q=>Q.currentTarget.style.transform="scale(1)",children:[l.jsx("img",{src:qP,alt:"Azya",style:{width:"100%",height:"60%",objectFit:"cover",objectPosition:"center top"}}),l.jsxs("div",{style:{padding:`${6*d}px`,display:"flex",flexDirection:"column",alignItems:"center"},children:[l.jsx("h3",{style:{fontSize:`${w}rem`,color:"#45a2e9",margin:0},children:""}),l.jsx("p",{style:{color:"#aaa",margin:`${3*d}px 0`,fontSize:`${p}rem`,fontFamily:"Tamanegi, sans-serif"},children:" / "}),l.jsxs("p",{style:{padding:`${.5*d}rem`,textAlign:"center",fontSize:`${b}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",lineHeight:1.3},children:["",l.jsx("br",{}),""]}),K("AJA")]})]}),l.jsxs("div",{onClick:()=>t("YORUKA"),style:{width:G,height:x,border:"1px solid #444",borderRadius:10*d,background:"linear-gradient(180deg, #1a0f2e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s",boxShadow:"0 4px 20px rgba(168, 85, 247, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:Q=>Q.currentTarget.style.transform="scale(1.05)",onMouseOut:Q=>Q.currentTarget.style.transform="scale(1)",children:[l.jsx("img",{src:eO,alt:"Yoruka",style:{width:"100%",height:"60%",objectFit:"cover"}}),l.jsxs("div",{style:{padding:`${6*d}px`,display:"flex",flexDirection:"column",alignItems:"center"},children:[l.jsx("h3",{style:{fontSize:`${w}rem`,color:"#a855f7",margin:0},children:"Y"}),l.jsx("p",{style:{color:"#aaa",margin:`${3*d}px 0`,fontSize:`${p}rem`,fontFamily:"Tamanegi, sans-serif"},children:" / "}),l.jsxs("p",{style:{padding:`0 ${.5*d}rem`,textAlign:"center",fontSize:`${b}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",lineHeight:1.3},children:["",l.jsx("br",{}),""]}),K("YORUKA")]})]})]}),n==="CPU"&&s&&l.jsxs("div",{style:{marginBottom:`${.6*d}rem`,display:"flex",flexDirection:"column",alignItems:"center",gap:`${.3*d}rem`},children:[l.jsx("p",{style:{fontSize:`${.85*d}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",margin:0},children:""}),l.jsx("div",{style:{display:"flex",gap:`${.6*d}rem`},children:["EASY","NORMAL","HARD"].map(Q=>l.jsx("button",{onClick:()=>s(Q),style:{padding:`${6*d}px ${14*d}px`,fontSize:`${.8*d}rem`,background:r===Q?Q==="EASY"?"#48bb78":Q==="NORMAL"?"#e94560":"#9f7aea":"transparent",border:`2px solid ${Q==="EASY"?"#48bb78":Q==="NORMAL"?"#e94560":"#9f7aea"}`,color:"#fff",cursor:"pointer",borderRadius:4*d,fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s"},children:Q==="EASY"?"":Q==="NORMAL"?"":""},Q))}),l.jsxs("p",{style:{fontSize:`${.65*d}rem`,opacity:.6,fontFamily:"Tamanegi, sans-serif",margin:0},children:[r==="EASY"&&"CPU",r==="NORMAL"&&"CPU",r==="HARD"&&"CPU"]})]}),c&&l.jsxs("div",{style:{marginBottom:`${.6*d}rem`,display:"flex",flexDirection:"column",alignItems:"center",gap:`${.3*d}rem`},children:[l.jsx("p",{style:{fontSize:`${.85*d}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",margin:0},children:""}),l.jsxs("div",{style:{display:"flex",gap:`${.6*d}rem`},children:[l.jsx("button",{onClick:()=>c(!0),style:{padding:`${6*d}px ${14*d}px`,fontSize:`${.8*d}rem`,background:a?"#3182ce":"transparent",border:"2px solid #3182ce",color:"#fff",cursor:"pointer",borderRadius:4*d,fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s"},children:"ON (60)"}),l.jsx("button",{onClick:()=>c(!1),style:{padding:`${6*d}px ${14*d}px`,fontSize:`${.8*d}rem`,background:a?"transparent":"#718096",border:"2px solid #718096",color:"#fff",cursor:"pointer",borderRadius:4*d,fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s"},children:"OFF"})]}),l.jsx("p",{style:{fontSize:`${.65*d}rem`,opacity:.6,fontFamily:"Tamanegi, sans-serif",margin:0},children:a?"600":""})]}),l.jsx("button",{onClick:e,style:{background:"#333",padding:re,fontSize:`${.9*d}rem`,marginBottom:`${.5*d}rem`},children:""})]})};class iO{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(e){this.flush(),this._parts.push(e)}append(e){this._pieces.push(e)}flush(){if(this._pieces.length>0){const e=new Uint8Array(this._pieces);this._parts.push(e),this._pieces=[]}}toArrayBuffer(){const e=[];for(const n of this._parts)e.push(n);return oO(e).buffer}}function oO(t){let e=0;for(const s of t)e+=s.byteLength;const n=new Uint8Array(e);let r=0;for(const s of t){const i=new Uint8Array(s.buffer,s.byteOffset,s.byteLength);n.set(i,r),r+=s.byteLength}return n}function Ub(t){return new aO(t).unpack()}function Bb(t){const e=new lO,n=e.pack(t);return n instanceof Promise?n.then(()=>e.getBuffer()):e.getBuffer()}class aO{constructor(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){const e=this.unpack_uint8();if(e<128)return e;if((e^224)<32)return(e^224)-32;let n;if((n=e^160)<=15)return this.unpack_raw(n);if((n=e^176)<=15)return this.unpack_string(n);if((n=e^144)<=15)return this.unpack_array(n);if((n=e^128)<=15)return this.unpack_map(n);switch(e){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return n=this.unpack_uint16(),this.unpack_string(n);case 217:return n=this.unpack_uint32(),this.unpack_string(n);case 218:return n=this.unpack_uint16(),this.unpack_raw(n);case 219:return n=this.unpack_uint32(),this.unpack_raw(n);case 220:return n=this.unpack_uint16(),this.unpack_array(n);case 221:return n=this.unpack_uint32(),this.unpack_array(n);case 222:return n=this.unpack_uint16(),this.unpack_map(n);case 223:return n=this.unpack_uint32(),this.unpack_map(n)}}unpack_uint8(){const e=this.dataView[this.index]&255;return this.index++,e}unpack_uint16(){const e=this.read(2),n=(e[0]&255)*256+(e[1]&255);return this.index+=2,n}unpack_uint32(){const e=this.read(4),n=((e[0]*256+e[1])*256+e[2])*256+e[3];return this.index+=4,n}unpack_uint64(){const e=this.read(8),n=((((((e[0]*256+e[1])*256+e[2])*256+e[3])*256+e[4])*256+e[5])*256+e[6])*256+e[7];return this.index+=8,n}unpack_int8(){const e=this.unpack_uint8();return e<128?e:e-256}unpack_int16(){const e=this.unpack_uint16();return e<32768?e:e-65536}unpack_int32(){const e=this.unpack_uint32();return e<2**31?e:e-2**32}unpack_int64(){const e=this.unpack_uint64();return e<2**63?e:e-2**64}unpack_raw(e){if(this.length<this.index+e)throw new Error(`BinaryPackFailure: index is out of range ${this.index} ${e} ${this.length}`);const n=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,n}unpack_string(e){const n=this.read(e);let r=0,s="",i,o;for(;r<e;)i=n[r],i<160?(o=i,r++):(i^192)<32?(o=(i&31)<<6|n[r+1]&63,r+=2):(i^224)<16?(o=(i&15)<<12|(n[r+1]&63)<<6|n[r+2]&63,r+=3):(o=(i&7)<<18|(n[r+1]&63)<<12|(n[r+2]&63)<<6|n[r+3]&63,r+=4),s+=String.fromCodePoint(o);return this.index+=e,s}unpack_array(e){const n=new Array(e);for(let r=0;r<e;r++)n[r]=this.unpack();return n}unpack_map(e){const n={};for(let r=0;r<e;r++){const s=this.unpack();n[s]=this.unpack()}return n}unpack_float(){const e=this.unpack_uint32(),n=e>>31,r=(e>>23&255)-127,s=e&8388607|8388608;return(n===0?1:-1)*s*2**(r-23)}unpack_double(){const e=this.unpack_uint32(),n=this.unpack_uint32(),r=e>>31,s=(e>>20&2047)-1023,o=(e&1048575|1048576)*2**(s-20)+n*2**(s-52);return(r===0?1:-1)*o}read(e){const n=this.index;if(n+e<=this.length)return this.dataView.subarray(n,n+e);throw new Error("BinaryPackFailure: read index out of range")}}class lO{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(e){if(typeof e=="string")this.pack_string(e);else if(typeof e=="number")Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if(typeof e=="boolean")e===!0?this._bufferBuilder.append(195):e===!1&&this._bufferBuilder.append(194);else if(e===void 0)this._bufferBuilder.append(192);else if(typeof e=="object")if(e===null)this._bufferBuilder.append(192);else{const n=e.constructor;if(e instanceof Array){const r=this.pack_array(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else if(e instanceof ArrayBuffer)this.pack_bin(new Uint8Array(e));else if("BYTES_PER_ELEMENT"in e){const r=e;this.pack_bin(new Uint8Array(r.buffer,r.byteOffset,r.byteLength))}else if(e instanceof Date)this.pack_string(e.toString());else{if(e instanceof Blob)return e.arrayBuffer().then(r=>{this.pack_bin(new Uint8Array(r)),this._bufferBuilder.flush()});if(n==Object||n.toString().startsWith("class")){const r=this.pack_object(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else throw new Error(`Type "${n.toString()}" not yet supported`)}}else throw new Error(`Type "${typeof e}" not yet supported`);this._bufferBuilder.flush()}pack_bin(e){const n=e.length;if(n<=15)this.pack_uint8(160+n);else if(n<=65535)this._bufferBuilder.append(218),this.pack_uint16(n);else if(n<=4294967295)this._bufferBuilder.append(219),this.pack_uint32(n);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(e)}pack_string(e){const n=this._textEncoder.encode(e),r=n.length;if(r<=15)this.pack_uint8(176+r);else if(r<=65535)this._bufferBuilder.append(216),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(217),this.pack_uint32(r);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(n)}pack_array(e){const n=e.length;if(n<=15)this.pack_uint8(144+n);else if(n<=65535)this._bufferBuilder.append(220),this.pack_uint16(n);else if(n<=4294967295)this._bufferBuilder.append(221),this.pack_uint32(n);else throw new Error("Invalid length");const r=s=>{if(s<n){const i=this.pack(e[s]);return i instanceof Promise?i.then(()=>r(s+1)):r(s+1)}};return r(0)}pack_integer(e){if(e>=-32&&e<=127)this._bufferBuilder.append(e&255);else if(e>=0&&e<=255)this._bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&e<=127)this._bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&e<=65535)this._bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&e<=32767)this._bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&e<=4294967295)this._bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-2147483648&&e<=2147483647)this._bufferBuilder.append(210),this.pack_int32(e);else if(e>=-9223372036854776e3&&e<=9223372036854776e3)this._bufferBuilder.append(211),this.pack_int64(e);else if(e>=0&&e<=18446744073709552e3)this._bufferBuilder.append(207),this.pack_uint64(e);else throw new Error("Invalid integer")}pack_double(e){let n=0;e<0&&(n=1,e=-e);const r=Math.floor(Math.log(e)/Math.LN2),s=e/2**r-1,i=Math.floor(s*2**52),o=2**32,a=n<<31|r+1023<<20|i/o&1048575,c=i%o;this._bufferBuilder.append(203),this.pack_int32(a),this.pack_int32(c)}pack_object(e){const n=Object.keys(e),r=n.length;if(r<=15)this.pack_uint8(128+r);else if(r<=65535)this._bufferBuilder.append(222),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(223),this.pack_uint32(r);else throw new Error("Invalid length");const s=i=>{if(i<n.length){const o=n[i];if(e.hasOwnProperty(o)){this.pack(o);const a=this.pack(e[o]);if(a instanceof Promise)return a.then(()=>s(i+1))}return s(i+1)}};return s(0)}pack_uint8(e){this._bufferBuilder.append(e)}pack_uint16(e){this._bufferBuilder.append(e>>8),this._bufferBuilder.append(e&255)}pack_uint32(e){const n=e&4294967295;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255)}pack_uint64(e){const n=e/4294967296,r=e%2**32;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}pack_int8(e){this._bufferBuilder.append(e&255)}pack_int16(e){this._bufferBuilder.append((e&65280)>>8),this._bufferBuilder.append(e&255)}pack_int32(e){this._bufferBuilder.append(e>>>24&255),this._bufferBuilder.append((e&16711680)>>>16),this._bufferBuilder.append((e&65280)>>>8),this._bufferBuilder.append(e&255)}pack_int64(e){const n=Math.floor(e/4294967296),r=e%2**32;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}constructor(){this._bufferBuilder=new iO,this._textEncoder=new TextEncoder}}let zb=!0,Hb=!0;function ka(t,e,n){const r=t.match(e);return r&&r.length>=n&&parseFloat(r[n],10)}function Di(t,e,n){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,s=r.addEventListener;r.addEventListener=function(o,a){if(o!==e)return s.apply(this,arguments);const c=u=>{const d=n(u);d&&(a.handleEvent?a.handleEvent(d):a(d))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,c),s.apply(this,[o,c])};const i=r.removeEventListener;r.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return i.apply(this,arguments);if(!this._eventMap[e].has(a))return i.apply(this,arguments);const c=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,i.apply(this,[o,c])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function cO(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(zb=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function uO(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(Hb=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function Wb(){if(typeof window=="object"){if(zb)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function w0(t,e){Hb&&console.warn(t+" is deprecated, please use "+e+" instead.")}function dO(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const r=n.userAgentData.brands.find(s=>s.brand==="Chromium");if(r)return{browser:"chrome",version:parseInt(r.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(ka(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(ka(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(ka(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=ka(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function Qv(t){return Object.prototype.toString.call(t)==="[object Object]"}function Gb(t){return Qv(t)?Object.keys(t).reduce(function(e,n){const r=Qv(t[n]),s=r?Gb(t[n]):t[n],i=r&&!Object.keys(s).length;return s===void 0||i?e:Object.assign(e,{[n]:s})},{}):t}function Cp(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?Cp(t,t.get(e[r]),n):r.endsWith("Ids")&&e[r].forEach(s=>{Cp(t,t.get(s),n)})}))}function Jv(t,e,n){const r=n?"outbound-rtp":"inbound-rtp",s=new Map;if(e===null)return s;const i=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&i.push(o)}),i.forEach(o=>{t.forEach(a=>{a.type===r&&a.trackId===o.id&&Cp(t,a,s)})}),s}const qv=Wb;function Vb(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const r=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const c={};return Object.keys(a).forEach(u=>{if(u==="require"||u==="advanced"||u==="mediaSource")return;const d=typeof a[u]=="object"?a[u]:{ideal:a[u]};d.exact!==void 0&&typeof d.exact=="number"&&(d.min=d.max=d.exact);const h=function(f,E){return f?f+E.charAt(0).toUpperCase()+E.slice(1):E==="deviceId"?"sourceId":E};if(d.ideal!==void 0){c.optional=c.optional||[];let f={};typeof d.ideal=="number"?(f[h("min",u)]=d.ideal,c.optional.push(f),f={},f[h("max",u)]=d.ideal,c.optional.push(f)):(f[h("",u)]=d.ideal,c.optional.push(f))}d.exact!==void 0&&typeof d.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[h("",u)]=d.exact):["min","max"].forEach(f=>{d[f]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[h(f,u)]=d[f])})}),a.advanced&&(c.optional=(c.optional||[]).concat(a.advanced)),c},s=function(a,c){if(e.version>=61)return c(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const u=function(d,h,f){h in d&&!(f in d)&&(d[f]=d[h],delete d[h])};a=JSON.parse(JSON.stringify(a)),u(a.audio,"autoGainControl","googAutoGainControl"),u(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=r(a.audio)}if(a&&typeof a.video=="object"){let u=a.video.facingMode;u=u&&(typeof u=="object"?u:{ideal:u});const d=e.version<66;if(u&&(u.exact==="user"||u.exact==="environment"||u.ideal==="user"||u.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!d)){delete a.video.facingMode;let h;if(u.exact==="environment"||u.ideal==="environment"?h=["back","rear"]:(u.exact==="user"||u.ideal==="user")&&(h=["front"]),h)return n.mediaDevices.enumerateDevices().then(f=>{f=f.filter(k=>k.kind==="videoinput");let E=f.find(k=>h.some(P=>k.label.toLowerCase().includes(P)));return!E&&f.length&&h.includes("back")&&(E=f[f.length-1]),E&&(a.video.deviceId=u.exact?{exact:E.deviceId}:{ideal:E.deviceId}),a.video=r(a.video),qv("chrome: "+JSON.stringify(a)),c(a)})}a.video=r(a.video)}return qv("chrome: "+JSON.stringify(a)),c(a)},i=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,c,u){s(a,d=>{n.webkitGetUserMedia(d,c,h=>{u&&u(i(h))})})};if(n.getUserMedia=o.bind(n),n.mediaDevices.getUserMedia){const a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return s(c,u=>a(u).then(d=>{if(u.audio&&!d.getAudioTracks().length||u.video&&!d.getVideoTracks().length)throw d.getTracks().forEach(h=>{h.stop()}),new DOMException("","NotFoundError");return d},d=>Promise.reject(i(d))))}}}function Yb(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function Kb(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",s=>{let i;t.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(a=>a.track&&a.track.id===s.track.id):i={track:s.track};const o=new Event("track");o.track=s.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[r.stream],this.dispatchEvent(o)}),r.stream.getTracks().forEach(s=>{let i;t.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(a=>a.track&&a.track.id===s.id):i={track:s};const o=new Event("track");o.track=s,o.receiver=i,o.transceiver={receiver:i},o.streams=[r.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Di(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function Xb(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(s,i){return{track:i,get dtmf(){return this._dtmf===void 0&&(i.kind==="audio"?this._dtmf=s.createDTMFSender(i):this._dtmf=null),this._dtmf},_pc:s}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const s=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,c){let u=s.apply(this,arguments);return u||(u=e(this,a),this._senders.push(u)),u};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){i.apply(this,arguments);const c=this._senders.indexOf(a);c!==-1&&this._senders.splice(c,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],n.apply(this,[i]),i.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach(o=>{const a=this._senders.find(c=>c.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Qb(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=n.apply(this,[]);return i.forEach(o=>o._pc=this),i});const r=t.RTCPeerConnection.prototype.addTrack;r&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=r.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){const i=this;return this._pc.getStats().then(o=>Jv(o,i.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const s=n.apply(this,[]);return s.forEach(i=>i._pc=this),s}),Di(t,"track",r=>(r.receiver._pc=r.srcElement,r)),t.RTCRtpReceiver.prototype.getStats=function(){const s=this;return this._pc.getStats().then(i=>Jv(i,s.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const r=arguments[0];let s,i,o;return this.getSenders().forEach(a=>{a.track===r&&(s?o=!0:s=a)}),this.getReceivers().forEach(a=>(a.track===r&&(i?o=!0:i=a),a.track===r)),o||s&&i?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function Jb(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(c)===-1&&this._shimmedLocalStreams[a.id].push(c):this._shimmedLocalStreams[a.id]=[a,c],c};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(u=>{if(this.getSenders().find(h=>h.track===u))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(u=>a.indexOf(u)===-1);this._shimmedLocalStreams[o.id]=[o].concat(c)};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],r.apply(this,arguments)};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const c=this._shimmedLocalStreams[a].indexOf(o);c!==-1&&this._shimmedLocalStreams[a].splice(c,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),s.apply(this,arguments)}}function qb(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return Jb(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const d=n.apply(this);return this._reverseStreams=this._reverseStreams||{},d.map(h=>this._reverseStreams[h.id])};const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(d){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},d.getTracks().forEach(h=>{if(this.getSenders().find(E=>E.track===h))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[d.id]){const h=new t.MediaStream(d.getTracks());this._streams[d.id]=h,this._reverseStreams[h.id]=d,d=h}r.apply(this,[d])};const s=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(d){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[d.id]||d]),delete this._reverseStreams[this._streams[d.id]?this._streams[d.id].id:d.id],delete this._streams[d.id]},t.RTCPeerConnection.prototype.addTrack=function(d,h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const f=[].slice.call(arguments,1);if(f.length!==1||!f[0].getTracks().find(P=>P===d))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(P=>P.track===d))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const k=this._streams[h.id];if(k)k.addTrack(d),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const P=new t.MediaStream([d]);this._streams[h.id]=P,this._reverseStreams[P.id]=h,this.addStream(P)}return this.getSenders().find(P=>P.track===d)};function i(u,d){let h=d.sdp;return Object.keys(u._reverseStreams||[]).forEach(f=>{const E=u._reverseStreams[f],k=u._streams[E.id];h=h.replace(new RegExp(k.id,"g"),E.id)}),new RTCSessionDescription({type:d.type,sdp:h})}function o(u,d){let h=d.sdp;return Object.keys(u._reverseStreams||[]).forEach(f=>{const E=u._reverseStreams[f],k=u._streams[E.id];h=h.replace(new RegExp(E.id,"g"),k.id)}),new RTCSessionDescription({type:d.type,sdp:h})}["createOffer","createAnswer"].forEach(function(u){const d=t.RTCPeerConnection.prototype[u],h={[u](){const f=arguments;return arguments.length&&typeof arguments[0]=="function"?d.apply(this,[k=>{const P=i(this,k);f[0].apply(null,[P])},k=>{f[1]&&f[1].apply(null,k)},arguments[2]]):d.apply(this,arguments).then(k=>i(this,k))}};t.RTCPeerConnection.prototype[u]=h[u]});const a=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const u=c.get.apply(this);return u.type===""?u:i(this,u)}}),t.RTCPeerConnection.prototype.removeTrack=function(d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!d._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(d._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let f;Object.keys(this._streams).forEach(E=>{this._streams[E].getTracks().find(P=>d.track===P)&&(f=this._streams[E])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(d.track),this.dispatchEvent(new Event("negotiationneeded")))}}function wp(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=t.RTCPeerConnection.prototype[n],s={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=s[n]})}function Zb(t,e){Di(t,"negotiationneeded",n=>{const r=n.target;if(!((e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return n})}const Zv=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:Zb,shimAddTrackRemoveTrack:qb,shimAddTrackRemoveTrackWithNative:Jb,shimGetSendersWithDtmf:Xb,shimGetUserMedia:Vb,shimMediaStream:Yb,shimOnTrack:Kb,shimPeerConnection:wp,shimSenderReceiverGetStats:Qb},Symbol.toStringTag,{value:"Module"}));function eS(t,e){const n=t&&t.navigator,r=t&&t.MediaStreamTrack;if(n.getUserMedia=function(s,i,o){w0("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(s).then(i,o)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const s=function(o,a,c){a in o&&!(c in o)&&(o[c]=o[a],delete o[a])},i=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),s(o.audio,"autoGainControl","mozAutoGainControl"),s(o.audio,"noiseSuppression","mozNoiseSuppression")),i(o)},r&&r.prototype.getSettings){const o=r.prototype.getSettings;r.prototype.getSettings=function(){const a=o.apply(this,arguments);return s(a,"mozAutoGainControl","autoGainControl"),s(a,"mozNoiseSuppression","noiseSuppression"),a}}if(r&&r.prototype.applyConstraints){const o=r.prototype.applyConstraints;r.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),s(a,"autoGainControl","mozAutoGainControl"),s(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function fO(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,Promise.reject(s)}return r.video===!0?r.video={mediaSource:e}:r.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(r)})}function tS(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function kp(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const i=t.RTCPeerConnection.prototype[s],o={[s](){return arguments[0]=new(s==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[s]=o[s]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[i,o,a]=arguments;return r.apply(this,[i||null]).then(c=>{if(e.version<53&&!o)try{c.forEach(u=>{u.type=n[u.type]||u.type})}catch(u){if(u.name!=="TypeError")throw u;c.forEach((d,h)=>{c.set(h,Object.assign({},d,{type:n[d.type]||d.type}))})}return c}).then(o,a)}}function nS(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=e.apply(this,[]);return s.forEach(i=>i._pc=this),s});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=n.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function rS(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r}),Di(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function sS(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){w0("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&n.getTracks().includes(r.track)&&this.removeTrack(r)})})}function iS(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function oS(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const s=r.length>0;s&&r.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=e.apply(this,arguments);if(s){const{sender:o}=i,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=r,o.sendEncodings=r,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return i})}function aS(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const r=e.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function lS(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function cS(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}const e_=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:oS,shimCreateAnswer:cS,shimCreateOffer:lS,shimGetDisplayMedia:fO,shimGetParameters:aS,shimGetUserMedia:eS,shimOnTrack:tS,shimPeerConnection:kp,shimRTCDataChannel:iS,shimReceiverGetStats:rS,shimRemoveStream:sS,shimSenderGetStats:nS},Symbol.toStringTag,{value:"Module"}));function uS(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(s=>e.call(this,s,r)),r.getVideoTracks().forEach(s=>e.call(this,s,r))},t.RTCPeerConnection.prototype.addTrack=function(r,...s){return s&&s.forEach(i=>{this._localStreams?this._localStreams.includes(i)||this._localStreams.push(i):this._localStreams=[i]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(n);if(r===-1)return;this._localStreams.splice(r,1);const s=n.getTracks();this.getSenders().forEach(i=>{s.includes(i.track)&&this.removeTrack(i)})})}}function dS(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(s=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(s))return;this._remoteStreams.push(s);const i=new Event("addstream");i.stream=s,this.dispatchEvent(i)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){s.streams.forEach(i=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(i)>=0)return;r._remoteStreams.push(i);const o=new Event("addstream");o.stream=i,r.dispatchEvent(o)})}),e.apply(r,arguments)}}}function fS(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,r=e.createAnswer,s=e.setLocalDescription,i=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(u,d){const h=arguments.length>=2?arguments[2]:arguments[0],f=n.apply(this,[h]);return d?(f.then(u,d),Promise.resolve()):f},e.createAnswer=function(u,d){const h=arguments.length>=2?arguments[2]:arguments[0],f=r.apply(this,[h]);return d?(f.then(u,d),Promise.resolve()):f};let a=function(c,u,d){const h=s.apply(this,[c]);return d?(h.then(u,d),Promise.resolve()):h};e.setLocalDescription=a,a=function(c,u,d){const h=i.apply(this,[c]);return d?(h.then(u,d),Promise.resolve()):h},e.setRemoteDescription=a,a=function(c,u,d){const h=o.apply(this,[c]);return d?(h.then(u,d),Promise.resolve()):h},e.addIceCandidate=a}function hS(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,r=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=s=>r(pS(s))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(r,s,i){e.mediaDevices.getUserMedia(r).then(s,i)}).bind(e))}function pS(t){return t&&t.video!==void 0?Object.assign({},t,{video:Gb(t.video)}):t}function gS(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(r,s){if(r&&r.iceServers){const i=[];for(let o=0;o<r.iceServers.length;o++){let a=r.iceServers[o];a.urls===void 0&&a.url?(w0("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,i.push(a)):i.push(r.iceServers[o])}r.iceServers=i}return new e(r,s)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function mS(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function yS(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):r.offerToReceiveAudio===!0&&!s&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const i=this.getTransceivers().find(o=>o.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveVideo===!0&&!i&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function vS(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}const t_=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:vS,shimCallbacksAPI:fS,shimConstraints:pS,shimCreateOfferLegacy:yS,shimGetUserMedia:hS,shimLocalStreamsAPI:uS,shimRTCIceServerUrls:gS,shimRemoteStreamsAPI:dS,shimTrackEventTransceiver:mS},Symbol.toStringTag,{value:"Module"}));var _S={exports:{}};(function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},e.splitSections=function(n){return n.split(`
m=`).map((s,i)=>(i>0?"m="+s:s).trim()+`\r
`)},e.getDescription=function(n){const r=e.splitSections(n);return r&&r[0]},e.getMediaSections=function(n){const r=e.splitSections(n);return r.shift(),r},e.matchPrefix=function(n,r){return e.splitLines(n).filter(s=>s.indexOf(r)===0)},e.parseCandidate=function(n){let r;n.indexOf("a=candidate:")===0?r=n.substring(12).split(" "):r=n.substring(10).split(" ");const s={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let i=8;i<r.length;i+=2)switch(r[i]){case"raddr":s.relatedAddress=r[i+1];break;case"rport":s.relatedPort=parseInt(r[i+1],10);break;case"tcptype":s.tcpType=r[i+1];break;case"ufrag":s.ufrag=r[i+1],s.usernameFragment=r[i+1];break;default:s[r[i]]===void 0&&(s[r[i]]=r[i+1]);break}return s},e.writeCandidate=function(n){const r=[];r.push(n.foundation);const s=n.component;s==="rtp"?r.push(1):s==="rtcp"?r.push(2):r.push(s),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const i=n.type;return r.push("typ"),r.push(i),i!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let r=n.substring(9).split(" ");const s={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),s.name=r[0],s.clockRate=parseInt(r[1],10),s.channels=r.length===3?parseInt(r[2],10):1,s.numChannels=s.channels,s},e.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const s=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(s!==1?"/"+s:"")+`\r
`},e.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const r={};let s;const i=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<i.length;o++)s=i[o].trim().split("="),r[s[0].trim()]=s[1];return r},e.writeFmtp=function(n){let r="",s=n.payloadType;if(n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const i=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?i.push(o+"="+n.parameters[o]):i.push(o)}),r+="a=fmtp:"+s+" "+i.join(";")+`\r
`}return r},e.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},e.writeRtcpFb=function(n){let r="",s=n.payloadType;return n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(i=>{r+="a=rtcp-fb:"+s+" "+i.type+(i.parameter&&i.parameter.length?" "+i.parameter:"")+`\r
`}),r},e.parseSsrcMedia=function(n){const r=n.indexOf(" "),s={ssrc:parseInt(n.substring(7,r),10)},i=n.indexOf(":",r);return i>-1?(s.attribute=n.substring(r+1,i),s.value=n.substring(i+1)):s.attribute=n.substring(r+1),s},e.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(s=>parseInt(s,10))}},e.getMid=function(n){const r=e.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},e.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:e.matchPrefix(n+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,r){let s="a=setup:"+r+`\r
`;return n.fingerprints.forEach(i=>{s+="a=fingerprint:"+i.algorithm+" "+i.value+`\r
`}),s},e.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,r){return e.matchPrefix(n+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,r){const s=e.matchPrefix(n+r,"a=ice-ufrag:")[0],i=e.matchPrefix(n+r,"a=ice-pwd:")[0];return s&&i?{usernameFragment:s.substring(12),password:i.substring(10)}:null},e.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},e.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=e.splitLines(n)[0].split(" ");r.profile=i[2];for(let a=3;a<i.length;a++){const c=i[a],u=e.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(u){const d=e.parseRtpMap(u),h=e.matchPrefix(n,"a=fmtp:"+c+" ");switch(d.parameters=h.length?e.parseFmtp(h[0]):{},d.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),r.codecs.push(d),d.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(d.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(a=>{r.headerExtensions.push(e.parseExtmap(a))});const o=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(a=>{o.forEach(c=>{a.rtcpFeedback.find(d=>d.type===c.type&&d.parameter===c.parameter)||a.rtcpFeedback.push(c)})}),r},e.writeRtpDescription=function(n,r){let s="";s+="m="+n+" ",s+=r.codecs.length>0?"9":"0",s+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",s+=r.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,s+=`c=IN IP4 0.0.0.0\r
`,s+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(o=>{s+=e.writeRtpMap(o),s+=e.writeFmtp(o),s+=e.writeRtcpFb(o)});let i=0;return r.codecs.forEach(o=>{o.maxptime>i&&(i=o.maxptime)}),i>0&&(s+="a=maxptime:"+i+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(o=>{s+=e.writeExtmap(o)}),s},e.parseRtpEncodingParameters=function(n){const r=[],s=e.parseRtpParameters(n),i=s.fecMechanisms.indexOf("RED")!==-1,o=s.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(n,"a=ssrc:").map(f=>e.parseSsrcMedia(f)).filter(f=>f.attribute==="cname"),c=a.length>0&&a[0].ssrc;let u;const d=e.matchPrefix(n,"a=ssrc-group:FID").map(f=>f.substring(17).split(" ").map(k=>parseInt(k,10)));d.length>0&&d[0].length>1&&d[0][0]===c&&(u=d[0][1]),s.codecs.forEach(f=>{if(f.name.toUpperCase()==="RTX"&&f.parameters.apt){let E={ssrc:c,codecPayloadType:parseInt(f.parameters.apt,10)};c&&u&&(E.rtx={ssrc:u}),r.push(E),i&&(E=JSON.parse(JSON.stringify(E)),E.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},r.push(E))}}),r.length===0&&c&&r.push({ssrc:c});let h=e.matchPrefix(n,"b=");return h.length&&(h[0].indexOf("b=TIAS:")===0?h=parseInt(h[0].substring(7),10):h[0].indexOf("b=AS:")===0?h=parseInt(h[0].substring(5),10)*1e3*.95-50*40*8:h=void 0,r.forEach(f=>{f.maxBitrate=h})),r},e.parseRtcpParameters=function(n){const r={},s=e.matchPrefix(n,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];s&&(r.cname=s.value,r.ssrc=s.ssrc);const i=e.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=i.length>0,r.compound=i.length===0;const o=e.matchPrefix(n,"a=rtcp-mux");return r.mux=o.length>0,r},e.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},e.parseMsid=function(n){let r;const s=e.matchPrefix(n,"a=msid:");if(s.length===1)return r=s[0].substring(7).split(" "),{stream:r[0],track:r[1]};const i=e.matchPrefix(n,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(i.length>0)return r=i[0].value.split(" "),{stream:r[0],track:r[1]}},e.parseSctpDescription=function(n){const r=e.parseMLine(n),s=e.matchPrefix(n,"a=max-message-size:");let i;s.length>0&&(i=parseInt(s[0].substring(19),10)),isNaN(i)&&(i=65536);const o=e.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:r.fmt,maxMessageSize:i};const a=e.matchPrefix(n,"a=sctpmap:");if(a.length>0){const c=a[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:i}}},e.writeSctpDescription=function(n,r){let s=[];return n.protocol!=="DTLS/SCTP"?s=["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:s=["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&s.push("a=max-message-size:"+r.maxMessageSize+`\r
`),s.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,r,s){let i;const o=r!==void 0?r:2;return n?i=n:i=e.generateSessionId(),`v=0\r
o=`+(s||"thisisadapterortc")+" "+i+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,r){const s=e.splitLines(n);for(let i=0;i<s.length;i++)switch(s[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[i].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const s=e.splitLines(n)[0].substring(2).split(" ");return{kind:s[0],port:parseInt(s[1],10),protocol:s[2],fmt:s.slice(3).join(" ")}},e.parseOLine=function(n){const s=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:s[0],sessionId:s[1],sessionVersion:parseInt(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=e.splitLines(n);for(let s=0;s<r.length;s++)if(r[s].length<2||r[s].charAt(1)!=="=")return!1;return!0},t.exports=e})(_S);var xS=_S.exports;const Io=y_(xS),hO=dI({__proto__:null,default:Io},[xS]);function qc(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const s=new e(r),i=Io.parseCandidate(r.candidate);for(const o in i)o in s||Object.defineProperty(s,o,{value:i[o]});return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new e(r)},t.RTCIceCandidate.prototype=e.prototype,Di(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function Ap(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Di(t,"icecandidate",e=>{if(e.candidate){const n=Io.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function Zc(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(a){if(!a||!a.sdp)return!1;const c=Io.splitSections(a.sdp);return c.shift(),c.some(u=>{const d=Io.parseMLine(u);return d&&d.kind==="application"&&d.protocol.indexOf("SCTP")!==-1})},r=function(a){const c=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const u=parseInt(c[1],10);return u!==u?-1:u},s=function(a){let c=65536;return e.browser==="firefox"&&(e.version<57?a===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},i=function(a,c){let u=65536;e.browser==="firefox"&&e.version===57&&(u=65535);const d=Io.matchPrefix(a.sdp,"a=max-message-size:");return d.length>0?u=parseInt(d[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(u=2147483637),u},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=r(arguments[0]),u=s(c),d=i(arguments[0],c);let h;u===0&&d===0?h=Number.POSITIVE_INFINITY:u===0||d===0?h=Math.max(u,d):h=Math.min(u,d);const f={};Object.defineProperty(f,"maxMessageSize",{get(){return h}}),this._sctp=f}return o.apply(this,arguments)}}function eu(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(r,s){const i=r.send;r.send=function(){const a=arguments[0],c=a.length||a.size||a.byteLength;if(r.readyState==="open"&&s.sctp&&c>s.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+s.sctp.maxMessageSize+" bytes)");return i.apply(r,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const s=n.apply(this,arguments);return e(s,this),s},Di(t,"datachannel",r=>(e(r.channel,r.target),r))}function Rp(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=s=>{const i=s.target;if(i._lastConnectionState!==i.connectionState){i._lastConnectionState=i.connectionState;const o=new Event("connectionstatechange",s);i.dispatchEvent(o)}return s},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function Pp(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(s){if(s&&s.sdp&&s.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i=s.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&s instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:s.type,sdp:i}):s.sdp=i}return n.apply(this,arguments)}}function tu(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function nu(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let s=arguments[0]||{};if(typeof s!="object"||s.type&&s.sdp)return n.apply(this,arguments);if(s={type:s.type,sdp:s.sdp},!s.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":s.type="offer";break;default:s.type="answer";break}return s.sdp||s.type!=="offer"&&s.type!=="answer"?n.apply(this,[s]):(s.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}const pO=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:Pp,shimAddIceCandidateNullOrEmpty:tu,shimConnectionState:Rp,shimMaxMessageSize:Zc,shimParameterlessSetLocalDescription:nu,shimRTCIceCandidate:qc,shimRTCIceCandidateRelayProtocol:Ap,shimSendThrowTypeError:eu},Symbol.toStringTag,{value:"Module"}));function gO({window:t}={},e={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const n=Wb,r=dO(t),s={browserDetails:r,commonShim:pO,extractVersion:ka,disableLog:cO,disableWarnings:uO,sdp:hO};switch(r.browser){case"chrome":if(!Zv||!wp||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),s;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),s;n("adapter.js shimming chrome."),s.browserShim=Zv,tu(t,r),nu(t),Vb(t,r),Yb(t),wp(t,r),Kb(t),qb(t,r),Xb(t),Qb(t),Zb(t,r),qc(t),Ap(t),Rp(t),Zc(t,r),eu(t),Pp(t,r);break;case"firefox":if(!e_||!kp||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),s;n("adapter.js shimming firefox."),s.browserShim=e_,tu(t,r),nu(t),eS(t,r),kp(t,r),tS(t),sS(t),nS(t),rS(t),iS(t),oS(t),aS(t),lS(t),cS(t),qc(t),Rp(t),Zc(t,r),eu(t);break;case"safari":if(!t_||!e.shimSafari)return n("Safari shim is not included in this adapter release."),s;n("adapter.js shimming safari."),s.browserShim=t_,tu(t,r),nu(t),gS(t),yS(t),fS(t),uS(t),dS(t),mS(t),hS(t),vS(t),qc(t),Ap(t),Zc(t,r),eu(t),Pp(t,r);break;default:n("Unsupported browser!");break}return s}const n_=gO({window:typeof window>"u"?void 0:window});function Ni(t,e,n,r){Object.defineProperty(t,e,{get:n,set:r,enumerable:!0,configurable:!0})}class ES{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=e=>{const n=[],r=e.byteLength,s=Math.ceil(r/this.chunkedMTU);let i=0,o=0;for(;o<r;){const a=Math.min(r,o+this.chunkedMTU),c=e.slice(o,a),u={__peerData:this._dataCount,n:i,data:c,total:s};n.push(u),o=a,i++}return this._dataCount++,n}}}function mO(t){let e=0;for(const s of t)e+=s.byteLength;const n=new Uint8Array(e);let r=0;for(const s of t)n.set(s,r),r+=s.byteLength;return n}const ch=n_.default||n_,Sa=new class{isWebRTCSupported(){return typeof RTCPeerConnection<"u"}isBrowserSupported(){const t=this.getBrowser(),e=this.getVersion();return this.supportedBrowsers.includes(t)?t==="chrome"?e>=this.minChromeVersion:t==="firefox"?e>=this.minFirefoxVersion:t==="safari"?!this.isIOS&&e>=this.minSafariVersion:!1:!1}getBrowser(){return ch.browserDetails.browser}getVersion(){return ch.browserDetails.version||0}isUnifiedPlanSupported(){const t=this.getBrowser(),e=ch.browserDetails.version||0;if(t==="chrome"&&e<this.minChromeVersion)return!1;if(t==="firefox"&&e>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let n,r=!1;try{n=new RTCPeerConnection,n.addTransceiver("audio"),r=!0}catch{}finally{n&&n.close()}return r}toString(){return`Supports:
    browser:${this.getBrowser()}
    version:${this.getVersion()}
    isIOS:${this.isIOS}
    isWebRTCSupported:${this.isWebRTCSupported()}
    isBrowserSupported:${this.isBrowserSupported()}
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS=typeof navigator<"u"?["iPad","iPhone","iPod"].includes(navigator.platform):!1,this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},yO=t=>!t||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(t),bS=()=>Math.random().toString(36).slice(2),r_={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};class vO extends ES{noop(){}blobToArrayBuffer(e,n){const r=new FileReader;return r.onload=function(s){s.target&&n(s.target.result)},r.readAsArrayBuffer(e),r}binaryStringToArrayBuffer(e){const n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r)&255;return n.buffer}isSecure(){return location.protocol==="https:"}constructor(...e){super(...e),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=r_,this.browser=Sa.getBrowser(),this.browserVersion=Sa.getVersion(),this.pack=Bb,this.unpack=Ub,this.supports=function(){const n={browser:Sa.isBrowserSupported(),webRTC:Sa.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!n.webRTC)return n;let r;try{r=new RTCPeerConnection(r_),n.audioVideo=!0;let s;try{s=r.createDataChannel("_PEERJSTEST",{ordered:!0}),n.data=!0,n.reliable=!!s.ordered;try{s.binaryType="blob",n.binaryBlob=!Sa.isIOS}catch{}}catch{}finally{s&&s.close()}}catch{}finally{r&&r.close()}return n}(),this.validateId=yO,this.randomToken=bS}}const Pn=new vO,_O="PeerJS: ";class xO{get logLevel(){return this._logLevel}set logLevel(e){this._logLevel=e}log(...e){this._logLevel>=3&&this._print(3,...e)}warn(...e){this._logLevel>=2&&this._print(2,...e)}error(...e){this._logLevel>=1&&this._print(1,...e)}setLogFunction(e){this._print=e}_print(e,...n){const r=[_O,...n];for(const s in r)r[s]instanceof Error&&(r[s]="("+r[s].name+") "+r[s].message);e>=3?console.log(...r):e>=2?console.warn("WARNING",...r):e>=1&&console.error("ERROR",...r)}constructor(){this._logLevel=0}}var be=new xO,k0={},EO=Object.prototype.hasOwnProperty,wn="~";function Sl(){}Object.create&&(Sl.prototype=Object.create(null),new Sl().__proto__||(wn=!1));function bO(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function SS(t,e,n,r,s){if(typeof n!="function")throw new TypeError("The listener must be a function");var i=new bO(n,r||t,s),o=wn?wn+e:e;return t._events[o]?t._events[o].fn?t._events[o]=[t._events[o],i]:t._events[o].push(i):(t._events[o]=i,t._eventsCount++),t}function ru(t,e){--t._eventsCount===0?t._events=new Sl:delete t._events[e]}function mn(){this._events=new Sl,this._eventsCount=0}mn.prototype.eventNames=function(){var e=[],n,r;if(this._eventsCount===0)return e;for(r in n=this._events)EO.call(n,r)&&e.push(wn?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(n)):e};mn.prototype.listeners=function(e){var n=wn?wn+e:e,r=this._events[n];if(!r)return[];if(r.fn)return[r.fn];for(var s=0,i=r.length,o=new Array(i);s<i;s++)o[s]=r[s].fn;return o};mn.prototype.listenerCount=function(e){var n=wn?wn+e:e,r=this._events[n];return r?r.fn?1:r.length:0};mn.prototype.emit=function(e,n,r,s,i,o){var a=wn?wn+e:e;if(!this._events[a])return!1;var c=this._events[a],u=arguments.length,d,h;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,n),!0;case 3:return c.fn.call(c.context,n,r),!0;case 4:return c.fn.call(c.context,n,r,s),!0;case 5:return c.fn.call(c.context,n,r,s,i),!0;case 6:return c.fn.call(c.context,n,r,s,i,o),!0}for(h=1,d=new Array(u-1);h<u;h++)d[h-1]=arguments[h];c.fn.apply(c.context,d)}else{var f=c.length,E;for(h=0;h<f;h++)switch(c[h].once&&this.removeListener(e,c[h].fn,void 0,!0),u){case 1:c[h].fn.call(c[h].context);break;case 2:c[h].fn.call(c[h].context,n);break;case 3:c[h].fn.call(c[h].context,n,r);break;case 4:c[h].fn.call(c[h].context,n,r,s);break;default:if(!d)for(E=1,d=new Array(u-1);E<u;E++)d[E-1]=arguments[E];c[h].fn.apply(c[h].context,d)}}return!0};mn.prototype.on=function(e,n,r){return SS(this,e,n,r,!1)};mn.prototype.once=function(e,n,r){return SS(this,e,n,r,!0)};mn.prototype.removeListener=function(e,n,r,s){var i=wn?wn+e:e;if(!this._events[i])return this;if(!n)return ru(this,i),this;var o=this._events[i];if(o.fn)o.fn===n&&(!s||o.once)&&(!r||o.context===r)&&ru(this,i);else{for(var a=0,c=[],u=o.length;a<u;a++)(o[a].fn!==n||s&&!o[a].once||r&&o[a].context!==r)&&c.push(o[a]);c.length?this._events[i]=c.length===1?c[0]:c:ru(this,i)}return this};mn.prototype.removeAllListeners=function(e){var n;return e?(n=wn?wn+e:e,this._events[n]&&ru(this,n)):(this._events=new Sl,this._eventsCount=0),this};mn.prototype.off=mn.prototype.removeListener;mn.prototype.addListener=mn.prototype.on;mn.prefixed=wn;mn.EventEmitter=mn;k0=mn;var Mi={};Ni(Mi,"ConnectionType",()=>Hs);Ni(Mi,"PeerErrorType",()=>zt);Ni(Mi,"BaseConnectionErrorType",()=>Op);Ni(Mi,"DataConnectionErrorType",()=>A0);Ni(Mi,"SerializationType",()=>Ud);Ni(Mi,"SocketEventType",()=>ks);Ni(Mi,"ServerMessageType",()=>hn);var Hs=function(t){return t.Data="data",t.Media="media",t}({}),zt=function(t){return t.BrowserIncompatible="browser-incompatible",t.Disconnected="disconnected",t.InvalidID="invalid-id",t.InvalidKey="invalid-key",t.Network="network",t.PeerUnavailable="peer-unavailable",t.SslUnavailable="ssl-unavailable",t.ServerError="server-error",t.SocketError="socket-error",t.SocketClosed="socket-closed",t.UnavailableID="unavailable-id",t.WebRTC="webrtc",t}({}),Op=function(t){return t.NegotiationFailed="negotiation-failed",t.ConnectionClosed="connection-closed",t}({}),A0=function(t){return t.NotOpenYet="not-open-yet",t.MessageToBig="message-too-big",t}({}),Ud=function(t){return t.Binary="binary",t.BinaryUTF8="binary-utf8",t.JSON="json",t.None="raw",t}({}),ks=function(t){return t.Message="message",t.Disconnected="disconnected",t.Error="error",t.Close="close",t}({}),hn=function(t){return t.Heartbeat="HEARTBEAT",t.Candidate="CANDIDATE",t.Offer="OFFER",t.Answer="ANSWER",t.Open="OPEN",t.Error="ERROR",t.IdTaken="ID-TAKEN",t.InvalidKey="INVALID-KEY",t.Leave="LEAVE",t.Expire="EXPIRE",t}({});const IS="1.5.5";class SO extends k0.EventEmitter{constructor(e,n,r,s,i,o=5e3){super(),this.pingInterval=o,this._disconnected=!0,this._messagesQueue=[];const a=e?"wss://":"ws://";this._baseUrl=a+n+":"+r+s+"peerjs?key="+i}start(e,n){this._id=e;const r=`${this._baseUrl}&id=${e}&token=${n}`;this._socket||!this._disconnected||(this._socket=new WebSocket(r+"&version="+IS),this._disconnected=!1,this._socket.onmessage=s=>{let i;try{i=JSON.parse(s.data),be.log("Server message received:",i)}catch{be.log("Invalid server message",s.data);return}this.emit(ks.Message,i)},this._socket.onclose=s=>{this._disconnected||(be.log("Socket closed.",s),this._cleanup(),this._disconnected=!0,this.emit(ks.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),be.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen()){be.log("Cannot send heartbeat, because socket closed");return}const e=JSON.stringify({type:hn.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&this._socket.readyState===1}_sendQueuedMessages(){const e=[...this._messagesQueue];this._messagesQueue=[];for(const n of e)this.send(n)}send(e){if(this._disconnected)return;if(!this._id){this._messagesQueue.push(e);return}if(!e.type){this.emit(ks.Error,"Invalid message");return}if(!this._wsOpen())return;const n=JSON.stringify(e);this._socket.send(n)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}class TS{constructor(e){this.connection=e}startConnection(e){const n=this._startPeerConnection();if(this.connection.peerConnection=n,this.connection.type===Hs.Media&&e._stream&&this._addTracksToConnection(e._stream,n),e.originator){const r=this.connection,s={ordered:!!e.reliable},i=n.createDataChannel(r.label,s);r._initializeDataChannel(i),this._makeOffer()}else this.handleSDP("OFFER",e.sdp)}_startPeerConnection(){be.log("Creating RTCPeerConnection.");const e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e}_setupListeners(e){const n=this.connection.peer,r=this.connection.connectionId,s=this.connection.type,i=this.connection.provider;be.log("Listening for ICE candidates."),e.onicecandidate=o=>{!o.candidate||!o.candidate.candidate||(be.log(`Received ICE candidates for ${n}:`,o.candidate),i.socket.send({type:hn.Candidate,payload:{candidate:o.candidate,type:s,connectionId:r},dst:n}))},e.oniceconnectionstatechange=()=>{switch(e.iceConnectionState){case"failed":be.log("iceConnectionState is failed, closing connections to "+n),this.connection.emitError(Op.NegotiationFailed,"Negotiation of connection to "+n+" failed."),this.connection.close();break;case"closed":be.log("iceConnectionState is closed, closing connections to "+n),this.connection.emitError(Op.ConnectionClosed,"Connection to "+n+" closed."),this.connection.close();break;case"disconnected":be.log("iceConnectionState changed to disconnected on the connection with "+n);break;case"completed":e.onicecandidate=()=>{};break}this.connection.emit("iceStateChanged",e.iceConnectionState)},be.log("Listening for data channel"),e.ondatachannel=o=>{be.log("Received data channel");const a=o.channel;i.getConnection(n,r)._initializeDataChannel(a)},be.log("Listening for remote stream"),e.ontrack=o=>{be.log("Received remote stream");const a=o.streams[0],c=i.getConnection(n,r);if(c.type===Hs.Media){const u=c;this._addStreamToMediaConnection(a,u)}}}cleanup(){be.log("Cleaning up PeerConnection to "+this.connection.peer);const e=this.connection.peerConnection;if(!e)return;this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=()=>{};const n=e.signalingState!=="closed";let r=!1;const s=this.connection.dataChannel;s&&(r=!!s.readyState&&s.readyState!=="closed"),(n||r)&&e.close()}async _makeOffer(){const e=this.connection.peerConnection,n=this.connection.provider;try{const r=await e.createOffer(this.connection.options.constraints);be.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),be.log("Set localDescription:",r,`for:${this.connection.peer}`);let s={sdp:r,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===Hs.Data){const i=this.connection;s={...s,label:i.label,reliable:i.reliable,serialization:i.serialization}}n.socket.send({type:hn.Offer,payload:s,dst:this.connection.peer})}catch(s){s!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(n.emitError(zt.WebRTC,s),be.log("Failed to setLocalDescription, ",s))}}catch(r){n.emitError(zt.WebRTC,r),be.log("Failed to createOffer, ",r)}}async _makeAnswer(){const e=this.connection.peerConnection,n=this.connection.provider;try{const r=await e.createAnswer();be.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),be.log("Set localDescription:",r,`for:${this.connection.peer}`),n.socket.send({type:hn.Answer,payload:{sdp:r,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(s){n.emitError(zt.WebRTC,s),be.log("Failed to setLocalDescription, ",s)}}catch(r){n.emitError(zt.WebRTC,r),be.log("Failed to create answer, ",r)}}async handleSDP(e,n){n=new RTCSessionDescription(n);const r=this.connection.peerConnection,s=this.connection.provider;be.log("Setting remote description",n);const i=this;try{await r.setRemoteDescription(n),be.log(`Set remoteDescription:${e} for:${this.connection.peer}`),e==="OFFER"&&await i._makeAnswer()}catch(o){s.emitError(zt.WebRTC,o),be.log("Failed to setRemoteDescription, ",o)}}async handleCandidate(e){be.log("handleCandidate:",e);try{await this.connection.peerConnection.addIceCandidate(e),be.log(`Added ICE candidate for:${this.connection.peer}`)}catch(n){this.connection.provider.emitError(zt.WebRTC,n),be.log("Failed to handleCandidate, ",n)}}_addTracksToConnection(e,n){if(be.log(`add tracks from stream ${e.id} to peer connection`),!n.addTrack)return be.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(r=>{n.addTrack(r,e)})}_addStreamToMediaConnection(e,n){be.log(`add stream ${e.id} to media connection ${n.connectionId}`),n.addStream(e)}}class CS extends k0.EventEmitter{emitError(e,n){be.error("Error:",n),this.emit("error",new IO(`${e}`,n))}}class IO extends Error{constructor(e,n){typeof n=="string"?super(n):(super(),Object.assign(this,n)),this.type=e}}class wS extends CS{get open(){return this._open}constructor(e,n,r){super(),this.peer=e,this.provider=n,this.options=r,this._open=!1,this.metadata=r.metadata}}var Np;const Ya=class Ya extends wS{get type(){return Hs.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(e,n,r){super(e,n,r),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||Ya.ID_PREFIX+Pn.randomToken(),this._negotiator=new TS(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{be.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{be.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(e){be.log("Receiving stream",e),this._remoteStream=e,super.emit("stream",e)}handleMessage(e){const n=e.type,r=e.payload;switch(e.type){case hn.Answer:this._negotiator.handleSDP(n,r.sdp),this._open=!0;break;case hn.Candidate:this._negotiator.handleCandidate(r.candidate);break;default:be.warn(`Unrecognized message type:${n} from peer:${this.peer}`);break}}answer(e,n={}){if(this._localStream){be.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=e,n&&n.sdpTransform&&(this.options.sdpTransform=n.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:e});const r=this.provider._getMessages(this.connectionId);for(const s of r)this.handleMessage(s);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit("close"))}};Np=new WeakMap,ca(Ya,Np,Ya.ID_PREFIX="mc_");let td=Ya;class TO{constructor(e){this._options=e}_buildRequest(e){const n=this._options.secure?"https":"http",{host:r,port:s,path:i,key:o}=this._options,a=new URL(`${n}://${r}:${s}${i}${o}/${e}`);return a.searchParams.set("ts",`${Date.now()}${Math.random()}`),a.searchParams.set("version",IS),fetch(a.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{const e=await this._buildRequest("id");if(e.status!==200)throw new Error(`Error. Status:${e.status}`);return e.text()}catch(e){be.error("Error retrieving ID",e);let n="";throw this._options.path==="/"&&this._options.host!==Pn.CLOUD_HOST&&(n=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+n)}}async listAllPeers(){try{const e=await this._buildRequest("peers");if(e.status!==200){if(e.status===401){let n="";throw this._options.host===Pn.CLOUD_HOST?n="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":n="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+n)}throw new Error(`Error. Status:${e.status}`)}return e.json()}catch(e){throw be.error("Error retrieving list peers",e),new Error("Could not get list peers from the server."+e)}}}var Mp,jp;const ui=class ui extends wS{get type(){return Hs.Data}constructor(e,n,r){super(e,n,r),this.connectionId=this.options.connectionId||ui.ID_PREFIX+bS(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new TS(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{be.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=n=>{be.log(`DC#${this.connectionId} dc onmessage:`,n.data)},this.dataChannel.onclose=()=>{be.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(e){if(e!=null&&e.flush){this.send({__peerData:{type:"close"}});return}this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null),this.open&&(this._open=!1,super.emit("close"))}send(e,n=!1){if(!this.open){this.emitError(A0.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.");return}return this._send(e,n)}async handleMessage(e){const n=e.payload;switch(e.type){case hn.Answer:await this._negotiator.handleSDP(e.type,n.sdp);break;case hn.Candidate:await this._negotiator.handleCandidate(n.candidate);break;default:be.warn("Unrecognized message type:",e.type,"from peer:",this.peer);break}}};Mp=new WeakMap,jp=new WeakMap,ca(ui,Mp,ui.ID_PREFIX="dc_"),ca(ui,jp,ui.MAX_BUFFERED_AMOUNT=8388608);let nd=ui;class R0 extends nd{get bufferSize(){return this._bufferSize}_initializeDataChannel(e){super._initializeDataChannel(e),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",n=>this._handleDataMessage(n))}_bufferedSend(e){(this._buffering||!this._trySend(e))&&(this._buffer.push(e),this._bufferSize=this._buffer.length)}_trySend(e){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>nd.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(e)}catch(n){return be.error(`DC#:${this.connectionId} Error when sending:`,n),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open||this._buffer.length===0)return;const e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(e){if(e!=null&&e.flush){this.send({__peerData:{type:"close"}});return}this._buffer=[],this._bufferSize=0,super.close()}constructor(...e){super(...e),this._buffer=[],this._bufferSize=0,this._buffering=!1}}class uh extends R0{close(e){super.close(e),this._chunkedData={}}constructor(e,n,r){super(e,n,r),this.chunker=new ES,this.serialization=Ud.Binary,this._chunkedData={}}_handleDataMessage({data:e}){const n=Ub(e),r=n.__peerData;if(r){if(r.type==="close"){this.close();return}this._handleChunk(n);return}this.emit("data",n)}_handleChunk(e){const n=e.__peerData,r=this._chunkedData[n]||{data:[],count:0,total:e.total};if(r.data[e.n]=new Uint8Array(e.data),r.count++,this._chunkedData[n]=r,r.total===r.count){delete this._chunkedData[n];const s=mO(r.data);this._handleDataMessage({data:s})}}_send(e,n){const r=Bb(e);if(r instanceof Promise)return this._send_blob(r);if(!n&&r.byteLength>this.chunker.chunkedMTU){this._sendChunks(r);return}this._bufferedSend(r)}async _send_blob(e){const n=await e;if(n.byteLength>this.chunker.chunkedMTU){this._sendChunks(n);return}this._bufferedSend(n)}_sendChunks(e){const n=this.chunker.chunk(e);be.log(`DC#${this.connectionId} Try to send ${n.length} chunks...`);for(const r of n)this.send(r,!0)}}class CO extends R0{_handleDataMessage({data:e}){super.emit("data",e)}_send(e,n){this._bufferedSend(e)}constructor(...e){super(...e),this.serialization=Ud.None}}class wO extends R0{_handleDataMessage({data:e}){const n=this.parse(this.decoder.decode(e)),r=n.__peerData;if(r&&r.type==="close"){this.close();return}this.emit("data",n)}_send(e,n){const r=this.encoder.encode(this.stringify(e));if(r.byteLength>=Pn.chunkedMTU){this.emitError(A0.MessageToBig,"Message too big for JSON channel");return}this._bufferedSend(r)}constructor(...e){super(...e),this.serialization=Ud.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}var $p;const Ka=class Ka extends CS{get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){const e=Object.create(null);for(const[n,r]of this._connections)e[n]=r;return e}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(e,n){super(),this._serializers={raw:CO,json:wO,binary:uh,"binary-utf8":uh,default:uh},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map;let r;if(e&&e.constructor==Object?n=e:e&&(r=e.toString()),n={debug:0,host:Pn.CLOUD_HOST,port:Pn.CLOUD_PORT,path:"/",key:Ka.DEFAULT_KEY,token:Pn.randomToken(),config:Pn.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...n},this._options=n,this._serializers={...this._serializers,...this.options.serializers},this._options.host==="/"&&(this._options.host=window.location.hostname),this._options.path&&(this._options.path[0]!=="/"&&(this._options.path="/"+this._options.path),this._options.path[this._options.path.length-1]!=="/"&&(this._options.path+="/")),this._options.secure===void 0&&this._options.host!==Pn.CLOUD_HOST?this._options.secure=Pn.isSecure():this._options.host==Pn.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&be.setLogFunction(this._options.logFunction),be.logLevel=this._options.debug||0,this._api=new TO(n),this._socket=this._createServerConnection(),!Pn.supports.audioVideo&&!Pn.supports.data){this._delayedAbort(zt.BrowserIncompatible,"The current browser does not support WebRTC");return}if(r&&!Pn.validateId(r)){this._delayedAbort(zt.InvalidID,`ID "${r}" is invalid`);return}r?this._initialize(r):this._api.retrieveId().then(s=>this._initialize(s)).catch(s=>this._abort(zt.ServerError,s))}_createServerConnection(){const e=new SO(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return e.on(ks.Message,n=>{this._handleMessage(n)}),e.on(ks.Error,n=>{this._abort(zt.SocketError,n)}),e.on(ks.Disconnected,()=>{this.disconnected||(this.emitError(zt.Network,"Lost connection to server."),this.disconnect())}),e.on(ks.Close,()=>{this.disconnected||this._abort(zt.SocketClosed,"Underlying socket is already closed.")}),e}_initialize(e){this._id=e,this.socket.start(e,this._options.token)}_handleMessage(e){const n=e.type,r=e.payload,s=e.src;switch(n){case hn.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case hn.Error:this._abort(zt.ServerError,r.msg);break;case hn.IdTaken:this._abort(zt.UnavailableID,`ID "${this.id}" is taken`);break;case hn.InvalidKey:this._abort(zt.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case hn.Leave:be.log(`Received leave message from ${s}`),this._cleanupPeer(s),this._connections.delete(s);break;case hn.Expire:this.emitError(zt.PeerUnavailable,`Could not connect to peer ${s}`);break;case hn.Offer:{const i=r.connectionId;let o=this.getConnection(s,i);if(o&&(o.close(),be.warn(`Offer received for existing Connection ID:${i}`)),r.type===Hs.Media){const c=new td(s,this,{connectionId:i,_payload:r,metadata:r.metadata});o=c,this._addConnection(s,o),this.emit("call",c)}else if(r.type===Hs.Data){const c=new this._serializers[r.serialization](s,this,{connectionId:i,_payload:r,metadata:r.metadata,label:r.label,serialization:r.serialization,reliable:r.reliable});o=c,this._addConnection(s,o),this.emit("connection",c)}else{be.warn(`Received malformed connection type:${r.type}`);return}const a=this._getMessages(i);for(const c of a)o.handleMessage(c);break}default:{if(!r){be.warn(`You received a malformed message from ${s} of type ${n}`);return}const i=r.connectionId,o=this.getConnection(s,i);o&&o.peerConnection?o.handleMessage(e):i?this._storeMessage(i,e):be.warn("You received an unrecognized message:",e);break}}}_storeMessage(e,n){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(n)}_getMessages(e){const n=this._lostMessages.get(e);return n?(this._lostMessages.delete(e),n):[]}connect(e,n={}){if(n={serialization:"default",...n},this.disconnected){be.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(zt.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}const r=new this._serializers[n.serialization](e,this,n);return this._addConnection(e,r),r}call(e,n,r={}){if(this.disconnected){be.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(zt.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!n){be.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}const s=new td(e,this,{...r,_stream:n});return this._addConnection(e,s),s}_addConnection(e,n){be.log(`add connection ${n.type}:${n.connectionId} to peerId:${e}`),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(n)}_removeConnection(e){const n=this._connections.get(e.peer);if(n){const r=n.indexOf(e);r!==-1&&n.splice(r,1)}this._lostMessages.delete(e.connectionId)}getConnection(e,n){const r=this._connections.get(e);if(!r)return null;for(const s of r)if(s.connectionId===n)return s;return null}_delayedAbort(e,n){setTimeout(()=>{this._abort(e,n)},0)}_abort(e,n){be.error("Aborting!"),this.emitError(e,n),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||(be.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))}_cleanup(){for(const e of this._connections.keys())this._cleanupPeer(e),this._connections.delete(e);this.socket.removeAllListeners()}_cleanupPeer(e){const n=this._connections.get(e);if(n)for(const r of n)r.close()}disconnect(){if(this.disconnected)return;const e=this.id;be.log(`Disconnect peer with ID:${e}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit("disconnected",e)}reconnect(){if(this.disconnected&&!this.destroyed)be.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)be.error("In a hurry? We're still trying to make the initial connection!");else throw new Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`)}}listAllPeers(e=n=>{}){this._api.listAllPeers().then(n=>e(n)).catch(n=>this._abort(zt.ServerError,n))}};$p=new WeakMap,ca(Ka,$p,Ka.DEFAULT_KEY="peerjs");let Lp=Ka;var kS=Lp;class AS{constructor(){nn(this,"peer",null);nn(this,"conn",null);nn(this,"isHost",!1);nn(this,"messageCallback",null);nn(this,"connectionCallback",null);nn(this,"closeCallback",null)}async connect(e){return this.peer=new kS,new Promise((n,r)=>{if(!this.peer)return r("Peer not initialized");this.peer.on("open",s=>{console.log("My Peer ID is:",s),e?(this.isHost=!1,this.connectToPeer(e),n(s)):(this.isHost=!0,this.peer.on("connection",i=>{console.log("Incoming connection..."),this.setupConnection(i)}),n(s))}),this.peer.on("error",s=>{console.error(s),r(s)})})}connectToPeer(e){if(!this.peer)return;const n=this.peer.connect(e);this.setupConnection(n)}setupConnection(e){this.conn=e,e.on("open",()=>{console.log("Connection established!"),this.connectionCallback&&this.connectionCallback()}),e.on("data",n=>{this.messageCallback&&this.messageCallback(n)}),e.on("close",()=>{console.log("Connection closed"),this.closeCallback&&this.closeCallback()}),e.on("error",n=>console.error("Connection Error:",n))}onConnection(e){this.connectionCallback=e}onClose(e){this.closeCallback=e}isConnected(){return this.conn!==null&&this.conn.open}send(e){this.conn&&this.conn.open?this.conn.send(e):console.warn("Connection not open, cannot send message")}onMessage(e){this.messageCallback=e}disconnect(){var e,n;(e=this.conn)==null||e.close(),(n=this.peer)==null||n.destroy()}}const kO=({gameMode:t,targetRoomId:e,playerClass:n,onGameStart:r,onBack:s})=>{const[i,o]=F.useState(""),[a,c]=F.useState(!1),[u,d]=F.useState(!0),[h,f]=F.useState(null),[E,k]=F.useState(!1),[P,G]=F.useState(null),[x,S]=F.useState(!1),w=F.useRef(null);F.useEffect(()=>{const H=new AS;return w.current=H,(async()=>{try{const K=await H.connect(t==="JOIN"?e:void 0);o(K),d(!1),H.onMessage(Q=>{console.log("[LobbyScreen] Received message:",Q),Q.type==="CLASS_INFO"&&(console.log("[LobbyScreen] Received opponent class:",Q.playerClass),G(Q.playerClass))}),H.onConnection(()=>{console.log("[LobbyScreen] Connection established!"),c(!0)})}catch(K){console.error("[LobbyScreen] Connection error:",K),f(K.toString()),d(!1)}})(),()=>{var K;(K=w.current)!=null&&K.isConnected()||H.disconnect()}},[t,e]),F.useEffect(()=>{a&&w.current&&!x&&(console.log("[LobbyScreen] Sending class info:",n),setTimeout(()=>{var H;(H=w.current)==null||H.send({type:"CLASS_INFO",playerClass:n}),S(!0)},100))},[a,n,x]),F.useEffect(()=>{if(a&&w.current&&P){const H=setTimeout(()=>{console.log("[LobbyScreen] Starting game with opponent class:",P),r(w.current,P)},500);return()=>clearTimeout(H)}},[a,r,P]);const p=async()=>{if(i)try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(i);else{const H=document.createElement("textarea");H.value=i,H.style.position="fixed",H.style.left="-999999px",H.style.top="-999999px",document.body.appendChild(H),H.focus(),H.select(),document.execCommand("copy"),document.body.removeChild(H)}k(!0),setTimeout(()=>k(!1),2e3)}catch(H){console.error("Failed to copy:",H),alert(`Room ID: ${i}

()`)}},b=()=>{w.current&&(w.current.disconnect(),w.current=null),s()};return l.jsxs("div",{className:"screen lobby-screen",style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",gap:"2rem"},children:[l.jsx("h1",{style:{fontSize:"2.5rem",marginBottom:"1rem",textShadow:"0 0 10px #e94560",fontFamily:"Tamanegi, sans-serif",letterSpacing:"2px"},children:t==="HOST"?"":"..."}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1.5rem",padding:"2rem",background:"rgba(0,0,0,0.3)",borderRadius:"10px",minWidth:"400px"},children:[h&&l.jsxs("div",{style:{color:"#ff6b6b",fontSize:"1.2rem",textAlign:"center",fontFamily:"Tamanegi, sans-serif"},children:[l.jsx("p",{children:""}),l.jsx("p",{style:{fontSize:"0.9rem",opacity:.7},children:h})]}),u&&!h&&l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1rem"},children:[l.jsx("div",{className:"loading-spinner",style:{width:"50px",height:"50px",border:"4px solid rgba(233, 69, 96, 0.3)",borderTop:"4px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),l.jsx("p",{style:{opacity:.8,fontFamily:"Tamanegi, sans-serif"},children:t==="HOST"?"...":"..."})]}),t==="HOST"&&i&&!u&&!a&&!h&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.5rem"},children:[l.jsx("p",{style:{fontSize:"1rem",opacity:.7,fontFamily:"Tamanegi, sans-serif"},children:"ID:"}),l.jsx("div",{style:{fontSize:"2rem",fontFamily:"monospace",fontWeight:"bold",padding:"0.5rem 1rem",background:"rgba(233, 69, 96, 0.2)",borderRadius:"8px",border:"1px solid #e94560",letterSpacing:"2px"},children:i})]}),l.jsx("button",{onClick:p,style:{fontSize:"1rem",padding:"0.8rem 2rem",background:E?"#48bb78":"transparent",border:"2px solid "+(E?"#48bb78":"#e94560"),color:"#fff",cursor:"pointer",transition:"all 0.3s",borderRadius:"4px",fontWeight:"bold",fontFamily:"Tamanegi, sans-serif"},children:E?" ":"ID"}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginTop:"1rem",opacity:.7},children:[l.jsx("div",{className:"loading-spinner",style:{width:"20px",height:"20px",border:"2px solid rgba(233, 69, 96, 0.3)",borderTop:"2px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),l.jsx("span",{style:{fontFamily:"Tamanegi, sans-serif"},children:"..."})]})]}),t==="JOIN"&&!u&&!a&&!h&&l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[l.jsx("div",{className:"loading-spinner",style:{width:"20px",height:"20px",border:"2px solid rgba(233, 69, 96, 0.3)",borderTop:"2px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),l.jsxs("span",{style:{fontFamily:"Tamanegi, sans-serif"},children:[" ",e," ..."]})]}),a&&l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1rem"},children:[l.jsx("p",{style:{fontSize:"1.5rem",color:"#48bb78",fontFamily:"Tamanegi, sans-serif"},children:" "}),l.jsx("p",{style:{fontFamily:"Tamanegi, sans-serif"},children:"..."})]}),l.jsxs("div",{style:{marginTop:"1rem",padding:"0.5rem 1rem",background:"rgba(255,255,255,0.1)",borderRadius:"4px",fontSize:"0.9rem",opacity:.7,fontFamily:"Tamanegi, sans-serif"},children:[": ",n==="SENKA"?"":n==="AJA"?"":"yoRuka"]})]}),l.jsx("button",{onClick:b,style:{fontSize:"1rem",padding:"0.8rem 2rem",background:"transparent",border:"1px solid #888",color:"#888",cursor:"pointer",transition:"all 0.3s",borderRadius:"4px",marginTop:"1rem",fontFamily:"Tamanegi, sans-serif"},onMouseOver:H=>{H.currentTarget.style.color="#fff",H.currentTarget.style.borderColor="#fff"},onMouseOut:H=>{H.currentTarget.style.color="#888",H.currentTarget.style.borderColor="#888"},children:" "}),l.jsx("style",{children:`
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `})]})};class AO{constructor(){nn(this,"myEntryRef",null);nn(this,"listenerUnsubscribe",null);nn(this,"myId","");nn(this,"myPeerId","");nn(this,"hasMatched",!1)}async startMatchmaking(e,n,r,s,i,o,a,c){this.myPeerId=e,this.hasMatched=!1;const u=Wr(Yr,`matchmaking/${s}`);try{const d=await Dd(u),h=[];if(d.exists()&&d.forEach(P=>{const G=P.val(),x=Date.now()-G.timestamp<5*60*1e3;G.peerId!==e&&x&&h.push({key:P.key,data:G})}),h.length>0){const P=h.sort((G,x)=>G.data.timestamp-x.data.timestamp)[0];await kc(Wr(Yr,`matchmaking/${s}/${P.key}`)),i("matched"),o({peerId:P.data.peerId,playerName:P.data.playerName,playerClass:P.data.playerClass,isHost:!1,playerId:P.data.playerId,rating:P.data.rating});return}i("searching");const f=PR(u);this.myEntryRef=f,this.myId=f.key;const E={id:this.myId,peerId:e,playerName:n,playerClass:r,matchType:s,...a!=null&&{playerId:a},...c!=null&&{rating:c},timestamp:Date.now()};await Ld(f,E),RR(f).remove();const k=s;this.listenerUnsubscribe=rb(u,async P=>{if(this.hasMatched||!P.exists())return;let G=!1,x=null;if(P.forEach(S=>{const w=S.val();S.key===this.myId?G=!0:w.peerId!==this.myPeerId&&(!x||w.timestamp>x.data.timestamp)&&(x={key:S.key,data:w})}),!G&&this.myEntryRef){if(this.hasMatched)return;this.hasMatched=!0,i("matched"),this.cleanup();return}if(x!==null&&G){const S=P.child(this.myId).val(),w=x;if(S&&S.timestamp<w.data.timestamp){if(this.hasMatched)return;this.hasMatched=!0,await kc(Wr(Yr,`matchmaking/${k}/${w.key}`)),await kc(Wr(Yr,`matchmaking/${k}/${this.myId}`)),this.cleanup(),i("matched"),o({peerId:w.data.peerId,playerName:w.data.playerName,playerClass:w.data.playerClass,isHost:!0,playerId:w.data.playerId,rating:w.data.rating})}}})}catch(d){console.error("[Matchmaking] Error:",d),i("error"),this.cleanup()}}async cancelMatchmaking(){if(this.myEntryRef)try{await kc(this.myEntryRef)}catch(e){console.error("[Matchmaking] Error removing entry:",e)}this.cleanup()}cleanup(){this.listenerUnsubscribe&&(this.listenerUnsubscribe(),this.listenerUnsubscribe=null),this.myEntryRef=null,this.myId=""}}const Pc=new AO;class s_{constructor(e,n,r=!1){nn(this,"peer");nn(this,"conn");nn(this,"isHost",!1);nn(this,"messageCallback",null);nn(this,"closeCallback",null);this.peer=e,this.conn=n,this.isHost=r,n.on("data",s=>{this.messageCallback&&this.messageCallback(s)}),n.on("close",()=>{console.log("[PeerJSAdapter] Connection closed"),this.closeCallback&&this.closeCallback()}),n.on("error",s=>console.error("[PeerJSAdapter] Connection Error:",s))}async connect(e){return this.peer.id}onConnection(e){}onClose(e){this.closeCallback=e}isConnected(){return this.conn!==null&&this.conn.open}send(e){this.conn&&this.conn.open?this.conn.send(e):console.warn("[PeerJSAdapter] Connection not open, cannot send message")}onMessage(e){this.messageCallback=e}disconnect(){var e,n;(e=this.conn)==null||e.close(),(n=this.peer)==null||n.destroy()}}const RO=1280,PO=720,i_={BRONZE:"#cd7f32",SILVER:"#c0c0c0",GOLD:"#ffd700",PLATINUM:"#e5e4e2",DIAMOND:"#b9f2ff",MASTER:"#ff4500"},OO=({matchType:t,playerClass:e,playerName:n,playerId:r,onGameStart:s,onCancel:i})=>{const[o,a]=F.useState("idle"),[c,u]=F.useState("..."),[d,h]=F.useState(0),f=F.useRef(null),E=F.useRef(null),k=F.useRef(null),P=F.useRef(!1),G=F.useRef(!1),[x,S]=F.useState(0),[w,p]=F.useState(void 0),[b,H]=F.useState(1);F.useEffect(()=>{const Q=()=>{const ce=window.innerWidth/RO,me=window.innerHeight/PO;H(Math.min(ce,me))};return Q(),window.addEventListener("resize",Q),()=>window.removeEventListener("resize",Q)},[]),F.useEffect(()=>{if(o!=="searching")return;const Q=setInterval(()=>{h(ce=>{const me=ce+1;return me>=60&&(a("error"),u(""),Pc.cancelMatchmaking(),E.current&&E.current.close(),f.current&&f.current.destroy()),me})},1e3);return()=>clearInterval(Q)},[o]),F.useEffect(()=>{let Q=!0,ce=0;return(async()=>{try{if(t==="ranked"&&r)try{ce=(await Fb(r,e)).rating,S(ce)}catch(B){console.error("[Matchmaking] Failed to get rating:",B)}const Se=new kS({debug:1,config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]}});if(f.current=Se,await new Promise((B,O)=>{Se.on("open",()=>B()),Se.on("error",T=>O(T))}),!Q)return;const de=Se.id;console.log("[Matchmaking] My PeerJS ID:",de),Se.on("connection",B=>{console.log("[Matchmaking] Incoming connection from:",B.peer),E.current=B,B.on("open",()=>{console.log("[Matchmaking] Connection opened (as HOST)"),B.on("data",O=>{if(O.type==="PLAYER_INFO"){console.log("[Matchmaking] Received player info:",O),B.send({type:"PLAYER_INFO",playerName:n,playerClass:e,playerId:t==="ranked"?r:void 0,rating:t==="ranked"?ce:void 0}),Q&&t==="ranked"&&p(O.rating),G.current=!0;const T=new s_(Se,B,!0);s(T,O.playerClass,!0,O.playerId,O.rating)}})})}),Pc.startMatchmaking(de,n,e,t,B=>{if(Q)switch(a(B),B){case"searching":u("...");break;case"matched":u("...");break;case"error":u("");break}},async B=>{if(Q)if(console.log("[Matchmaking] Match found:",B),k.current=B,P.current=B.isHost,B.isHost)u("...");else{u("...");const O=Se.connect(B.peerId,{reliable:!0});E.current=O,O.on("open",()=>{console.log("[Matchmaking] Connection opened (as JOIN)"),O.send({type:"PLAYER_INFO",playerName:n,playerClass:e,playerId:t==="ranked"?r:void 0,rating:t==="ranked"?ce:void 0}),O.on("data",T=>{if(T.type==="PLAYER_INFO"){console.log("[Matchmaking] Received player info:",T),Q&&t==="ranked"&&p(T.rating),G.current=!0;const C=new s_(Se,O,!1);s(C,T.playerClass,!1,T.playerId,T.rating)}})}),O.on("error",T=>{console.error("[Matchmaking] Connection error:",T),a("error"),u("")})}},t==="ranked"&&r?r:void 0,t==="ranked"?ce:void 0)}catch(Se){console.error("[Matchmaking] Init error:",Se),Q&&(a("error"),u(""))}})(),()=>{Q=!1,Pc.cancelMatchmaking(),G.current||(E.current&&E.current.close(),f.current&&f.current.destroy())}},[t,e,n,r,s]);const re=async()=>{await Pc.cancelMatchmaking(),E.current&&E.current.close(),f.current&&f.current.destroy(),i()},K=Q=>{const ce=Math.floor(Q/60),me=Q%60;return`${ce}:${me.toString().padStart(2,"0")}`};return l.jsxs("div",{className:"screen",style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white"},children:[l.jsx("div",{style:{fontSize:`${1.2*b}rem`,color:"#4ade80",marginBottom:`${1*b}rem`,fontWeight:"bold"},children:t==="casual"?"":""}),l.jsx("div",{style:{fontSize:`${2*b}rem`,fontWeight:"bold",marginBottom:`${1*b}rem`,textAlign:"center"},children:c}),o==="searching"&&l.jsxs("div",{style:{fontSize:`${1.5*b}rem`,color:"#888",marginBottom:`${2*b}rem`},children:[": ",K(d)]}),(o==="searching"||o==="matched")&&l.jsx("div",{style:{width:80*b,height:80*b,border:"4px solid rgba(255,255,255,0.2)",borderTop:"4px solid #4ade80",borderRadius:"50%",animation:"spin 1s linear infinite",marginBottom:`${2*b}rem`}}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*b}rem`,marginBottom:`${2*b}rem`,padding:`${1*b}rem`,background:"rgba(255,255,255,0.1)",borderRadius:8*b},children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:`${1*b}rem`},children:[l.jsx("div",{style:{fontSize:`${1*b}rem`},children:n||""}),l.jsx("div",{style:{fontSize:`${.9*b}rem`,color:e==="SENKA"?"#e94560":e==="AJA"?"#45a2e9":"#a855f7"},children:e==="SENKA"?"":e==="AJA"?"":"Y"})]}),t==="ranked"&&x>0&&l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:`${.5*b}rem`,fontSize:`${.85*b}rem`,color:"#aaa"},children:[l.jsx("span",{style:{fontWeight:"bold",color:i_[wr(x)],fontFamily:"Tamanegi, sans-serif"},children:So[wr(x)]}),l.jsx("span",{style:{fontFamily:"Tamanegi, sans-serif"},children:x})]}),t==="ranked"&&o==="matched"&&w!==void 0&&l.jsxs("div",{style:{marginTop:`${.5*b}rem`,padding:`${.5*b}rem ${1*b}rem`,background:"rgba(0, 0, 0, 0.3)",borderRadius:4*b,fontSize:`${.8*b}rem`,color:"#aaa"},children:[": ",l.jsx("span",{style:{fontWeight:"bold",color:i_[wr(w)],fontFamily:"Tamanegi, sans-serif"},children:So[wr(w)]})," ",w]})]}),o!=="error"&&l.jsx("button",{onClick:re,style:{padding:`${.8*b}rem ${2*b}rem`,fontSize:`${1*b}rem`,background:"transparent",border:"2px solid #e94560",color:"#e94560",borderRadius:8*b,cursor:"pointer",transition:"all 0.2s"},onMouseOver:Q=>{Q.currentTarget.style.background="#e94560",Q.currentTarget.style.color="white"},onMouseOut:Q=>{Q.currentTarget.style.background="transparent",Q.currentTarget.style.color="#e94560"},children:""}),o==="error"&&l.jsx("button",{onClick:i,style:{padding:`${.8*b}rem ${2*b}rem`,fontSize:`${1*b}rem`,background:"#e94560",border:"none",color:"white",borderRadius:8*b,cursor:"pointer"},children:""}),l.jsx("style",{children:`
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `})]})},o_=20,P0=[{id:1,filename:"1_yoroshiku.png",label:"",se:"pa.mp3"},{id:2,filename:"2_nandato.png",label:"",se:"shock.mp3"},{id:3,filename:"3_thank.png",label:"",se:"thanks.mp3"},{id:4,filename:"4_willwin.png",label:"",se:"nt.mp3"},{id:5,filename:"5_dontmind.png",label:"",se:"boyon.mp3"},{id:6,filename:"6_thinking.png",label:"",se:"thinking.mp3"},{id:7,filename:"7_gg.png",label:"GG",se:"kiri.mp3"},{id:8,filename:"8_sorry.png",label:"",se:"gomen.mp3"}],a_=(t,e)=>{const n=P0.find(s=>s.id===t);return n?`/stamps/${e==="AJA"?"azya":e.toLowerCase()}/${n.filename}`:""},l_=t=>{const e=P0.find(n=>n.id===t);return(e==null?void 0:e.se)||null},Ss=[{id:"s_3cats",name:"",cost:2,type:"SPELL",description:"1",flavorText:"",imageUrl:"/cards/chatora_three_cats.png",triggers:[{trigger:"FANFARE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_CHATORA"},{type:"GENERATE_CARD",targetCardId:"TOKEN_SABATORA"},{type:"GENERATE_CARD",targetCardId:"TOKEN_KIJITORA"}]}]},{id:"s_final_cannon",name:"",cost:10,type:"SPELL",description:"1",flavorText:'""""',imageUrl:"/cards/final_cannon.png",triggers:[{trigger:"FANFARE",effects:[{type:"SET_MAX_HP",value:1,targetType:"OPPONENT"}]}]},{id:"c_senka_knuckler",name:"",cost:8,type:"FOLLOWER",attack:3,health:5,description:`[] []
2
[]
1`,flavorText:`

`,imageUrl:"/cards/senka.png",evolvedImageUrl:"/cards/senka_2.png",tags:["Knuckler"],passiveAbilities:["STORM","DOUBLE_ATTACK"],attackEffectType:"IMPACT",triggers:[{trigger:"SUPER_EVOLVE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_FLICKER_JAB"},{type:"GENERATE_CARD",targetCardId:"TOKEN_QUAKE_HOWLING"},{type:"GENERATE_CARD",targetCardId:"TOKEN_BACKHAND_SMASH"}]}]},{id:"c_ruiyu",name:"",cost:7,type:"FOLLOWER",attack:5,health:5,description:`4cyoriena
14`,flavorText:`
`,imageUrl:"/cards/ruiyu.png",evolvedImageUrl:"/cards/ruiyu_2.png",attackEffectType:"BLUE_FIRE",relatedCards:["c_cyoriena"],triggers:[{trigger:"FANFARE",effects:[{type:"HEAL_LEADER",value:4,targetType:"SELF"},{type:"SUMMON_CARD",targetCardId:"c_cyoriena"}]},{trigger:"EVOLVE",effects:[{type:"DESTROY",targetType:"SELECT_FOLLOWER"},{type:"HEAL_LEADER",value:4,targetType:"SELF"}]}]},{id:"c_y",name:"Y",cost:6,type:"FOLLOWER",attack:3,health:3,description:`[]
142
3`,flavorText:"",imageUrl:"/cards/y.png",evolvedImageUrl:"/cards/y_2.png",passiveAbilities:["STEALTH"],attackEffectType:"SUMI",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:4,targetType:"SELECT_FOLLOWER"},{type:"AOE_DAMAGE",value:2,targetType:"ALL_FOLLOWERS"}]},{trigger:"EVOLVE",effects:[{type:"AOE_DAMAGE",value:3,targetType:"ALL_FOLLOWERS"}]}]},{id:"c_tsubumaru",name:"",cost:2,type:"FOLLOWER",attack:1,health:3,description:`[]
1
1`,flavorText:`

`,imageUrl:"/cards/tsubumaru.png",evolvedImageUrl:"/cards/tsubumaru_2.png",passiveAbilities:["WARD"],attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"GENERATE_CARD",targetCardId:"s_resignation_proxy"}]}]},{id:"c_barura",name:"",cost:4,type:"FOLLOWER",attack:3,health:4,description:`1
13`,flavorText:`

`,imageUrl:"/cards/barura.png",evolvedImageUrl:"/cards/barura_2.png",attackEffectType:"FIRE",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:3,targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_CHATORA",name:"",cost:0,type:"FOLLOWER",attack:1,health:1,description:"",flavorText:"",imageUrl:"/cards/chatora.png",attackEffectType:"SLASH"},{id:"TOKEN_SABATORA",name:"",cost:1,type:"FOLLOWER",attack:1,health:2,description:"[]",flavorText:"",passiveAbilities:["RUSH"],imageUrl:"/cards/sabatora.png",attackEffectType:"SLASH"},{id:"TOKEN_KIJITORA",name:"",cost:3,type:"FOLLOWER",attack:2,health:3,description:"[]",flavorText:"",passiveAbilities:["WARD"],imageUrl:"/cards/kijitora.png",attackEffectType:"SLASH"},{id:"TOKEN_RICE",name:"",cost:0,type:"SPELL",description:"1",flavorText:" ",imageUrl:"/cards/rice.png",triggers:[{trigger:"FANFARE",effects:[{type:"HEAL_LEADER",value:1,targetType:"SELF"}]}]},{id:"c_yunagi",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:`1
11`,flavorText:`


`,imageUrl:"/cards/yunagi.png",evolvedImageUrl:"/cards/yunagi_2.png",attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:1,targetType:"SELECT_FOLLOWER"},{type:"GENERATE_CARD",targetCardId:"TOKEN_OOMORI_RICE"}]}]},{id:"TOKEN_OOMORI_RICE",name:"",cost:1,type:"SPELL",description:"3",flavorText:"",imageUrl:"/cards/oomoririce.png",tags:["Token"],triggers:[{trigger:"FANFARE",effects:[{type:"HEAL_LEADER",value:3,targetType:"SELF"}]}]},{id:"c_nayuta",name:"",cost:4,type:"FOLLOWER",attack:3,health:3,description:`[]
1
1`,flavorText:"",imageUrl:"/cards/nayuta.png",evolvedImageUrl:"/cards/nayuta_2.png",attackEffectType:"RAY",passiveAbilities:["WARD"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]},{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]}]},{id:"c_yunagi_ward",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:`[]
1`,imageUrl:"/cards/yunagi.png",evolvedImageUrl:"/cards/yunagi_2.png",passiveAbilities:["WARD"],triggers:[{trigger:"FANFARE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_RICE"}]}]},{id:"c_nayuta_ward",name:"",cost:4,type:"FOLLOWER",attack:3,health:3,description:`[]
1
1`,imageUrl:"/cards/nayuta.png",evolvedImageUrl:"/cards/nayuta_2.png",passiveAbilities:["WARD"],attackEffectType:"RAY",triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]},{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]}]},{id:"c_azya",name:"",cost:8,type:"FOLLOWER",attack:4,health:4,description:`[]
3211-2
1+1/+2[][]0`,flavorText:`
&&`,imageUrl:"/cards/azya.png",evolvedImageUrl:"/cards/azya_2.png",attackEffectType:"THUNDER",passiveAbilities:["AURA"],relatedCards:["c_tsubumaru","c_yunagi","c_nayuta"],triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:3,targetType:"OPPONENT"},{type:"HEAL_LEADER",value:2,targetType:"SELF"},{type:"RANDOM_DESTROY",value:1},{type:"RANDOM_BOUNCE",value:1},{type:"REDUCE_HAND_COST",value:2,conditions:{nameIn:["","",""]}}]},{trigger:"SUPER_EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_tsubumaru"},{type:"SUMMON_CARD",targetCardId:"c_yunagi"},{type:"SUMMON_CARD",targetCardId:"c_nayuta"},{type:"BUFF_STATS",value:1,value2:2,targetType:"ALL_OTHER_FOLLOWERS"},{type:"GRANT_PASSIVE",targetPassive:"WARD",targetType:"ALL_OTHER_FOLLOWERS"},{type:"GRANT_PASSIVE",targetPassive:"RUSH",targetType:"ALL_OTHER_FOLLOWERS"},{type:"GENERATE_CARD",targetCardId:"s_yucho_of_the_abyss"},{type:"GENERATE_CARD",targetCardId:"s_thats_mine"},{type:"GRANT_LEADER_DAMAGE_SHIELD"}]}]},{id:"c_yuki",name:"",cost:3,type:"FOLLOWER",attack:3,health:2,description:`[]
+1/+1`,flavorText:"",imageUrl:"/cards/yuki.png",evolvedImageUrl:"/cards/yuki_2.png",tags:["Knuckler"],passiveAbilities:["RUSH"],attackEffectType:"IMPACT",triggers:[{trigger:"EVOLVE",effects:[{type:"BUFF_STATS",value:1,value2:1,targetType:"ALL_FOLLOWERS"}]}]},{id:"c_white_tsubaki",name:"",cost:4,type:"FOLLOWER",attack:4,health:3,description:`[]

01
1`,flavorText:`
`,imageUrl:"/cards/white_tsubaki.png",evolvedImageUrl:"/cards/white_tsubaki_2.png",tags:["Knuckler"],passiveAbilities:["RUSH","IMMUNE_TO_FOLLOWER_DAMAGE","GUTS_MY_TURN"],attackEffectType:"ICE",relatedCards:["c_shieko"],triggers:[{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_shieko"}]}]},{id:"c_shieko",name:"",cost:2,type:"FOLLOWER",attack:2,health:1,description:`[]
1+2/+2`,flavorText:`
`,imageUrl:"/cards/shieko.png",evolvedImageUrl:"/cards/shieko_2.png",tags:["Knuckler"],passiveAbilities:["RUSH"],attackEffectType:"IMPACT",triggers:[{trigger:"EVOLVE",effects:[{type:"BUFF_STATS",value:2,value2:2,targetType:"SELECT_OTHER_ALLY_FOLLOWER"}]}]},{id:"c_urara",name:"",cost:3,type:"FOLLOWER",attack:2,health:2,description:`[] []
2`,flavorText:`
`,imageUrl:"/cards/urara.png",evolvedImageUrl:"/cards/urara_2.png",passiveAbilities:["WARD","BARRIER"],attackEffectType:"WATER",triggers:[{trigger:"EVOLVE",effects:[{type:"HEAL_LEADER",value:2}]}]},{id:"c_kasuga",name:"",cost:10,type:"FOLLOWER",attack:8,health:8,description:"",flavorText:`

`,imageUrl:"/cards/kasuga.png",evolvedImageUrl:"/cards/kasuga_2.png",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY",targetType:"ALL_OTHER_FOLLOWERS"}]}],attackEffectType:"SLASH"},{id:"c_kyokune",name:"",cost:4,type:"FOLLOWER",attack:4,health:4,description:"1",imageUrl:"/cards/kyokune.jpg",relatedCards:["c_sia"],triggers:[{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_sia"}]}],attackEffectType:"SLASH"},{id:"c_sia",name:"",cost:2,type:"FOLLOWER",attack:2,health:1,description:"21",flavorText:"",imageUrl:"/cards/sia.png",evolvedImageUrl:"/cards/sia_2.png",attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DAMAGE",value:1,value2:2,targetType:"OPPONENT"}]}]},{id:"TOKEN_BACKHAND_SMASH",name:"",cost:0,type:"SPELL",description:"16",flavorText:`10
`,imageUrl:"/cards/BackhandSmash.jpg",tags:["Token"],attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:6,targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_QUAKE_HOWLING",name:"",cost:0,type:"SPELL",description:"2",flavorText:"",imageUrl:"/cards/QuakeHowling.png",tags:["Token"],attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"AOE_DAMAGE",value:2,targetType:"ALL_FOLLOWERS"}]}]},{id:"TOKEN_FLICKER_JAB",name:"",cost:0,type:"SPELL",description:"12",flavorText:`
BHS
`,imageUrl:"/cards/FlickerJab.png",tags:["Token"],attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:2,targetType:"SELECT_FOLLOWER"}]}]},{id:"c_bucchi",name:"",cost:5,type:"FOLLOWER",attack:1,health:3,description:"3",flavorText:`
`,imageUrl:"/cards/bucchi.png",evolvedImageUrl:"/cards/bucchi_2.png",attackEffectType:"SLASH",relatedCards:["c_manary"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_manary"},{type:"SUMMON_CARD",targetCardId:"c_manary"},{type:"SUMMON_CARD",targetCardId:"c_manary"}]}]},{id:"c_valkyrie",name:"",cost:6,type:"FOLLOWER",attack:6,health:6,description:`[] [] []
[]`,flavorText:"",imageUrl:"/cards/valkyrie.png",evolvedImageUrl:"/cards/valkyrie_2.png",passiveAbilities:["WARD","BARRIER","AURA"],attackEffectType:"RAY",triggers:[{trigger:"END_OF_TURN",effects:[{type:"GRANT_PASSIVE",targetPassive:"BARRIER",targetType:"SELF"}]}]},{id:"c_manary",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:"[]",flavorText:"^^",imageUrl:"/cards/manary.png",evolvedImageUrl:"/cards/manary_2.png",tags:["Token"],passiveAbilities:["WARD"],attackEffectType:"WATER"},{id:"c_potechi",name:"",cost:3,type:"FOLLOWER",attack:2,health:3,description:`[]
1`,flavorText:"",imageUrl:"/cards/potechi.png",evolvedImageUrl:"/cards/potechi_2.png",passiveAbilities:["WARD"],attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]}]},{id:"c_mono",name:"Mono",cost:3,type:"FOLLOWER",attack:2,health:1,description:`15
15`,flavorText:"",imageUrl:"/cards/Mono.png",evolvedImageUrl:"/cards/Mono_2.png",attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:5,targetType:"SELECT_FOLLOWER"}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:5,targetType:"SELECT_FOLLOWER"}]}]},{id:"c_sara",name:"sara",cost:7,type:"FOLLOWER",attack:4,health:6,description:`2111
1`,flavorText:"w",imageUrl:"/cards/sara.png",evolvedImageUrl:"/cards/sara_2.png",attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DESTROY",value:2,targetType:"OPPONENT"},{type:"GENERATE_CARD",targetCardId:"TOKEN_SORRY_THE_END",conditions:{minTurn:11}}]},{trigger:"SUPER_EVOLVE",effects:[{type:"DESTROY",targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_SORRY_THE_END",name:"",cost:3,type:"SPELL",description:"553sara1",flavorText:'""',imageUrl:"/cards/sorryTheEnd.png",tags:["Token"],attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"AOE_DAMAGE",value:5,targetType:"ALL_FOLLOWERS"},{type:"DAMAGE",value:5,targetType:"OPPONENT"},{type:"DRAW",value:3},{type:"SUMMON_CARD",targetCardId:"c_sara"}]}]},{id:"c_blue_tsubaki",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:`1
1`,flavorText:"",imageUrl:"/cards/blue_tsubaki.png",evolvedImageUrl:"/cards/blue_tsubaki_2.png",attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"RANDOM_DESTROY",value:1,targetType:"OPPONENT"}]}]},{id:"s_resignation_proxy",name:"",cost:0,type:"SPELL",description:"11",flavorText:"1",imageUrl:"/cards/taisyokudaiko.png",tags:["Token"],attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DESTROY",targetType:"OPPONENT",value:1},{type:"DRAW",value:1}]}]},{id:"s_yucho_of_the_abyss",name:"",cost:0,type:"SPELL",description:"11",flavorText:"",imageUrl:"/cards/yuchooftheabyss.png",tags:["Token"],attackEffectType:"THUNDER",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DAMAGE_BY_TURN",value:1,targetType:"OPPONENT"}]}]},{id:"s_thats_mine",name:"",cost:2,type:"SPELL",description:"1",flavorText:"",imageUrl:"/cards/thatsmine.png",tags:["Token"],attackEffectType:"ICE",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY_AND_GENERATE",value:0,targetType:"SELECT_FOLLOWER"}]}]},{id:"s_tenfubu_yabe_hutari",name:"2",cost:4,type:"SPELL",description:"11",flavorText:"",imageUrl:"/cards/tenfubuyabehutari.png",relatedCards:["c_yuki","c_potechi"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_yuki"},{type:"SUMMON_CARD",targetCardId:"c_potechi"}]}]},{id:"s_samurai_tea",name:"",cost:2,type:"SPELL",description:"1+1/+1",flavorText:'""""',imageUrl:"/cards/samuraitea.png",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1},{type:"BUFF_STATS",value:1,value2:1,targetType:"ALL_FOLLOWERS"}]}]},{id:"s_crazy_knucklers",name:"",cost:5,type:"SPELL",description:"+1/+11",flavorText:`
www www`,imageUrl:"/cards/crazy_knucklers.png",relatedCards:["c_white_tsubaki","c_shieko"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD_BUFFED",targetCardId:"c_white_tsubaki",value:1,value2:1},{type:"SUMMON_CARD_BUFFED",targetCardId:"c_shieko",value:1,value2:1},{type:"DRAW",value:1}]}]},{id:"s_knuckle_four",name:"",cost:10,type:"SPELL",description:"444",flavorText:"",imageUrl:"/cards/knucklefour.png",attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DESTROY",value:4,targetType:"OPPONENT"},{type:"DRAW",value:4},{type:"HEAL_LEADER",value:4,targetType:"SELF"}]}]},{id:"c_amandava",name:"amandava",cost:5,attack:2,health:3,type:"FOLLOWER",description:`21
1`,flavorText:"",imageUrl:"/cards/amandava.png",evolvedImageUrl:"/cards/amandava_2.png",attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_SET_HP",value:2,value2:1,targetType:"OPPONENT"}]},{trigger:"EVOLVE",effects:[{type:"AOE_DAMAGE",value:1,targetType:"ALL_FOLLOWERS"}]}]},{id:"c_alice",name:"",cost:3,attack:1,health:1,type:"FOLLOWER",description:`22
22`,flavorText:"",imageUrl:"/cards/alice.png",evolvedImageUrl:"/cards/alice_2.png",attackEffectType:"FIRE",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DAMAGE",value:2,value2:2,targetType:"OPPONENT"}]},{trigger:"EVOLVE",effects:[{type:"RANDOM_DAMAGE",value:2,value2:2,targetType:"OPPONENT"}]}]},{id:"c_yuri",name:"",cost:5,type:"FOLLOWER",attack:3,health:3,description:`1
13`,flavorText:`
`,imageUrl:"/cards/yuri.png",evolvedImageUrl:"/cards/yuri_2.png",attackEffectType:"WATER",relatedCards:["TOKEN_SUIHYORYU"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"TOKEN_SUIHYORYU"}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:3,targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_SUIHYORYU",name:"",cost:5,type:"FOLLOWER",attack:4,health:4,description:`[] []
`,flavorText:"",imageUrl:"/cards/suihyoryu.png",evolvedImageUrl:"/cards/suihyoryu.png",tags:["Token"],passiveAbilities:["RUSH","WARD"],attackEffectType:"ICE",triggers:[{trigger:"START_OF_TURN",effects:[{type:"DESTROY_SELF"}]}]},{id:"c_cyoriena",name:"cyoriena",cost:2,type:"FOLLOWER",attack:1,health:2,description:`[] []
HP2
`,flavorText:"7",imageUrl:"/cards/cyoriena.png",evolvedImageUrl:"/cards/cyoriena_2.png",tags:["Token"],passiveAbilities:["WARD","BARRIER"],attackEffectType:"RAY",triggers:[{trigger:"END_OF_TURN",effects:[{type:"HEAL_LEADER",value:2,targetType:"SELF"}]},{trigger:"EVOLVE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_TSUBASA"}]}]},{id:"TOKEN_TSUBASA",name:"",cost:1,type:"SPELL",description:"1[]",flavorText:"",imageUrl:"/cards/tsubasa.png",tags:["Token"],triggers:[{trigger:"FANFARE",effects:[{type:"GRANT_PASSIVE",targetPassive:"STORM",targetType:"SELECT_ALLY_FOLLOWER"}]}]},{id:"c_yamato",name:"",cost:5,type:"FOLLOWER",attack:5,health:1,description:"[]",imageUrl:"/cards/yamato.jpg",passiveAbilities:["STORM"],attackEffectType:"SLASH"},{id:"c_yoruka",name:"yoRuka",cost:8,type:"FOLLOWER",attack:5,health:5,description:`1
 8yoRuka1
2`,flavorText:"Y",imageUrl:"/cards/yoRuka.png",evolvedImageUrl:"/cards/yoRuka_2.png",attackEffectType:"SUMI",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY",targetType:"SELECT_FOLLOWER"}]},{trigger:"LAST_WORD",effects:[{type:"SUMMON_CARD",targetCardId:"c_yoruka",necromance:8}]},{trigger:"SUPER_EVOLVE",effects:[{type:"RANDOM_DESTROY",value:2,targetType:"OPPONENT"}]}]},{id:"c_haruka",name:"",cost:7,type:"FOLLOWER",attack:2,health:3,description:`[]
[]1
4
1 4+2/+0`,flavorText:"",imageUrl:"/cards/haruka.png",evolvedImageUrl:"/cards/haruka_2.png",passiveAbilities:["STEALTH"],attackEffectType:"SLASH",relatedCards:["c_yuka","c_setsuna"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD_RUSH",targetCardId:"c_yuka"},{type:"SUMMON_CARD",targetCardId:"c_setsuna"}]},{trigger:"LAST_WORD",effects:[{type:"ADD_GRAVEYARD",value:4}]},{trigger:"SUPER_EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_setsuna"},{type:"BUFF_STATS",value:2,value2:0,targetType:"ALL_OTHER_FOLLOWERS",necromance:4}]}]},{id:"c_setsuna",name:"",cost:3,type:"FOLLOWER",attack:1,health:1,description:`[] []
-12`,flavorText:"",imageUrl:"/cards/setsuna.png",evolvedImageUrl:"/cards/setsuna_2.png",passiveAbilities:["STORM","BANE"],attackEffectType:"SUMI",triggers:[{trigger:"LAST_WORD",effects:[{type:"BUFF_STATS",value:-1,value2:0,targetType:"RANDOM_FOLLOWER"},{type:"ADD_GRAVEYARD",value:2}]}]},{id:"c_yuka",name:"",cost:5,type:"FOLLOWER",attack:1,health:6,description:`[] []
1
3
132`,flavorText:"",imageUrl:"/cards/yuka.png",evolvedImageUrl:"/cards/yuka_2.png",passiveAbilities:["WARD","AURA"],attackEffectType:"SHOT",relatedCards:["c_setsuna"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_setsuna"}]},{trigger:"LAST_WORD",effects:[{type:"ADD_GRAVEYARD",value:3}]},{trigger:"EVOLVE",effects:[{type:"RANDOM_DAMAGE",value:3,value2:1,targetType:"OPPONENT"},{type:"RANDOM_DAMAGE",value:3,value2:1,targetType:"OPPONENT"}]}]},{id:"s_hayakikoto",name:"",cost:4,type:"SPELL",description:"21",flavorText:"",imageUrl:"/cards/hayakikoto.png",relatedCards:["c_setsuna"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_setsuna"},{type:"SUMMON_CARD",targetCardId:"c_setsuna"},{type:"DRAW",value:1}]}]},{id:"s_keishou",name:"",cost:9,type:"SPELL",description:"1-9",flavorText:`
`,imageUrl:"/cards/keisyopower.png",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY_AND_GENERATE",targetType:"RANDOM_ENEMY_FOLLOWER",value:-9}]}]},{id:"s_night_parade",name:"",cost:10,type:"SPELL",description:` 41
+1/+0`,flavorText:"",imageUrl:"/cards/nightparade.png",relatedCards:["c_setsuna"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD_FILL_BOARD",targetCardId:"c_setsuna",necromance:4},{type:"BUFF_STATS",value:1,value2:0,targetType:"ALL_FOLLOWERS"}]}]}];function O0(t){let e=t;return()=>(e=(e*1664525+1013904223)%4294967296,e/4294967296)}function LO(t,e){let n=t.length,r;for(;n!=0;)r=Math.floor(e()*n),n--,[t[n],t[r]]=[t[r],t[n]];return t}function DO(t){var s;const e=t.players.p1,n=t.players.p2;return[t.turnCount,t.activePlayerId,e.hp,e.maxHp,e.pp,e.maxPp,e.sep,e.evolutionsUsed,n.hp,n.maxHp,n.pp,n.maxPp,n.sep,n.evolutionsUsed,e.board.map(i=>i?`${i.id}_${i.instanceId}_${i.currentHealth}_${i.hasBarrier?"B":""}`:"null").join(","),n.board.map(i=>i?`${i.id}_${i.instanceId}_${i.currentHealth}_${i.hasBarrier?"B":""}`:"null").join(","),e.hand.length,n.hand.length,((s=t.pendingEffects)==null?void 0:s.length)||0,t.rngSeed].join("|")}const NO=[{cardId:"c_senka_knuckler",count:3},{cardId:"c_yuki",count:3},{cardId:"c_white_tsubaki",count:3},{cardId:"c_shieko",count:3},{cardId:"s_samurai_tea",count:3},{cardId:"c_bucchi",count:2},{cardId:"c_valkyrie",count:1},{cardId:"c_potechi",count:3},{cardId:"s_tenfubu_yabe_hutari",count:3},{cardId:"s_crazy_knucklers",count:2},{cardId:"c_sia",count:2},{cardId:"c_mono",count:3},{cardId:"c_ruiyu",count:1},{cardId:"c_kasuga",count:1},{cardId:"c_y",count:2},{cardId:"c_sara",count:1},{cardId:"s_knuckle_four",count:1},{cardId:"c_blue_tsubaki",count:3}],MO=[{cardId:"c_azya",count:3},{cardId:"c_ruiyu",count:2},{cardId:"c_y",count:2},{cardId:"c_sara",count:2},{cardId:"c_urara",count:3},{cardId:"c_yunagi",count:3},{cardId:"c_tsubumaru",count:3},{cardId:"c_nayuta",count:3},{cardId:"c_yuri",count:2},{cardId:"c_alice",count:3},{cardId:"c_kasuga",count:1},{cardId:"c_barura",count:3},{cardId:"c_valkyrie",count:3},{cardId:"s_3cats",count:2},{cardId:"s_final_cannon",count:1},{cardId:"c_amandava",count:2},{cardId:"c_mono",count:2}],jO=[{cardId:"c_yoruka",count:3},{cardId:"c_y",count:3},{cardId:"c_haruka",count:3},{cardId:"c_yuka",count:3},{cardId:"c_setsuna",count:3},{cardId:"s_hayakikoto",count:3},{cardId:"s_night_parade",count:1},{cardId:"c_kasuga",count:1},{cardId:"c_yunagi",count:3},{cardId:"c_tsubumaru",count:3},{cardId:"c_nayuta",count:3},{cardId:"c_mono",count:3},{cardId:"c_ruiyu",count:1},{cardId:"c_sara",count:1},{cardId:"s_3cats",count:2},{cardId:"c_yuri",count:2},{cardId:"c_sia",count:2}];function Ur(t){const e=Ss.find(n=>n.id===t);return e||Ss.find(n=>n.name===t)}function RS(){return Ss.map(t=>t.name).sort((t,e)=>e.length-t.length)}function Oc(t){return{STORM:"",RUSH:"",WARD:"",BARRIER:"",AURA:"",STEALTH:"",BANE:"",DOUBLE_ATTACK:"",IMMUNE_TO_FOLLOWER_DAMAGE:"",GUTS_MY_TURN:""}[t]||t}function $O(t,e){const n=[];let r=0;return t.forEach(s=>{const i=Ur(s.cardId);if(i)for(let o=0;o<s.count;o++)n.push({...i,id:`${e}_c${r}`,instanceId:`inst_${e}_c${r}`}),r++;else console.warn(`Card definition not found: ${s.cardId}`)}),n}function c_(t,e,n,r){const i=$O(n==="SENKA"?NO:n==="AJA"?MO:jO,t);return{id:t,name:e,class:n,hp:o_,maxHp:o_,pp:0,maxPp:0,sep:2,deck:LO(i,r),hand:[],graveyard:[],board:[],evolutionsUsed:0,canEvolveThisTurn:!1,extraPpUsedEarly:!1,extraPpUsedLate:!1,extraPpActive:!1}}function su(t,e,n,r,s,i=!0){const o=Math.floor(Math.random()*1e6),a=O0(o),c=c_("p1",t,e,a),u=c_("p2",n,r,a);c.hand=c.deck.splice(0,4),u.hand=u.deck.splice(0,4);let d,h;return i?(d="p1",h=t,c.maxPp=1,c.pp=1,u.maxPp=0,u.pp=0):(d="p2",h=n,c.maxPp=0,c.pp=0,u.maxPp=1,u.pp=1),{phase:"INIT",rngSeed:Math.floor(a()*1e6),activePlayerId:d,firstPlayerId:d,players:{p1:c,p2:u},turnCount:1,pendingEffects:[],logs:[` 1 - ${h} `],winnerId:void 0}}function Dp(t){return t==="p1"?"p2":"p1"}function FO(t,e,n,r,s,i){var h,f,E,k,P,G,x,S,w,p,b,H,re,K,Q,ce,me,Se,de,B,O;let o={...t,players:{p1:{...t.players.p1,hand:[...t.players.p1.hand],deck:[...t.players.p1.deck],board:t.players.p1.board.map(T=>T?{...T,passiveAbilities:T.passiveAbilities?[...T.passiveAbilities]:[]}:null),graveyard:[...t.players.p1.graveyard]},p2:{...t.players.p2,hand:[...t.players.p2.hand],deck:[...t.players.p2.deck],board:t.players.p2.board.map(T=>T?{...T,passiveAbilities:T.passiveAbilities?[...T.passiveAbilities]:[]}:null),graveyard:[...t.players.p2.graveyard]}},logs:[...t.logs||[]]};const a=O0(o.rngSeed||999);o.rngSeed=Math.floor(a()*1e6);const c=Dp(e),u=T=>{for(const C of["p1","p2"]){const y=o.players[C].board.findIndex(g=>(g==null?void 0:g.instanceId)===T);if(y!==-1&&o.players[C].board[y])return{card:o.players[C].board[y],player:o.players[C],index:y}}return null};if(r.necromance!==void 0&&r.necromance>0&&r.type!=="SUMMON_CARD_FILL_BOARD"){const T=o.players[e];if(T.graveyard.length<r.necromance)return console.log(`[Engine] : ${T.graveyard.length} < ${r.necromance}`),o;const C=T.graveyard.splice(-r.necromance,r.necromance);o.logs.push(`${T.name}  ${r.necromance} `),console.log(`[Engine] : ${C.map(y=>y.name).join(", ")} `)}const d=(T,C)=>{var g;const y=(g=T.triggers)==null?void 0:g.find(I=>I.trigger==="LAST_WORD");if(y){const I=y.effects.map(A=>({sourceCard:T,effect:A,sourcePlayerId:C}));o.pendingEffects=[...o.pendingEffects||[],...I],o.logs.push(`${T.name} `),console.log(`[Engine] processSingleEffect: Last Word triggered for ${T.name}. pendingEffects count: ${o.pendingEffects.length}`)}};switch(r.type){case"DAMAGE":{const T=r.value||0;if(r.targetType==="SELECT_FOLLOWER"&&s){const C=u(s);if(C){const{card:y,player:g,index:I}=C;if(y.hasBarrier)y.hasBarrier=!1,o.logs.push(`${y.name} `);else if(y.currentHealth-=T,o.logs.push(`${n.name}  ${y.name}  ${T} `),y.currentHealth<=0){y.currentHealth=Math.min(0,y.currentHealth);const A=Object.keys(o.players).find(L=>o.players[L]===g)||c;d(y,A),g.graveyard.push(y),g.board[I]=null,o.logs.push(`${y.name} `)}}}else if(r.targetType==="OPPONENT"){const C=o.players[c];if(C.leaderDamageShield)C.leaderDamageShield=!1,o.logs.push(`${n.name}  ${T} `);else{const y=C.board.some(I=>{var A;return(A=I==null?void 0:I.passiveAbilities)==null?void 0:A.includes("LEADER_DAMAGE_CAP")}),g=y?Math.min(T,1):T;C.hp-=g,y&&T>1?o.logs.push(`${n.name}  ${T} 1`):o.logs.push(`${n.name}  ${g} `),C.hp<=0&&(o.winnerId=e,o.logs.push(`${C.name} `))}}break}case"AOE_DAMAGE":{const T=r.value||0;if(r.targetType==="ALL_FOLLOWERS"){const C=o.players[c].board,y=i&&i.length>0?new Set(i):null;C.forEach(I=>{if(I){if(y&&!y.has(I.instanceId))return;I.hasBarrier?(I.hasBarrier=!1,o.logs.push(`${I.name} `)):I.currentHealth-=T}}),C.filter(I=>I&&I.currentHealth<=0).forEach(I=>{I&&(I.currentHealth=Math.min(0,I.currentHealth),d(I,c),o.players[c].graveyard.push(I),o.logs.push(`${I.name} `))}),o.logs.push(`${n.name}  ${T} `),C.forEach((I,A)=>{I&&I.currentHealth<=0&&(C[A]=null)})}break}case"DRAW":{const T=r.value||1,C=o.players[e];for(let y=0;y<T;y++)if(C.deck.length>0){const g=C.deck.pop();g&&(C.hand.length<9?C.hand.push(g):(C.graveyard.push(g),o.logs.push(`${C.name}${g.name}`)))}o.logs.push(`${C.name}  ${T} `);break}case"ADD_GRAVEYARD":{const T=r.value||1,C=o.players[e];for(let y=0;y<T;y++){const g={...n,instanceId:`grave_${o.rngSeed}_${Math.floor(a()*1e3)}_${y}`};C.graveyard.push(g)}o.logs.push(`${C.name}  ${T} `);break}case"HEAL_LEADER":{const T=r.value||0,C=o.players[e];C.hp=Math.min(C.maxHp,C.hp+T),o.logs.push(`${C.name}  ${T} HP`);break}case"DESTROY":{const T=(C,y)=>{var g;return((g=C.passiveAbilities)==null?void 0:g.includes("IMMUNE_TO_DAMAGE_MY_TURN"))===!0&&o.activePlayerId===y};if(r.targetType==="ALL_OTHER_FOLLOWERS"){const C=o.players[c].board,y=[];C.forEach(L=>{L&&(T(L,c)?(y.push(L),o.logs.push(`${L.name} `)):(d(L,c),o.players[c].graveyard.push(L)))}),o.players[c].board=y;const g=o.players[e].board,I=[],A=n.instanceId;g.forEach(L=>{L&&(A&&L.instanceId===A?I.push(L):T(L,e)?(I.push(L),o.logs.push(`${L.name} `)):(d(L,e),o.players[e].graveyard.push(L)))}),o.players[e].board=I,o.logs.push(`${n.name} `)}else if((r.targetType==="SELECT_FOLLOWER"||r.targetType==="SELECT_ALLY_FOLLOWER")&&s){const C=u(s);if(C){const{card:y,player:g,index:I}=C,A=Object.keys(o.players).find(L=>o.players[L].board.includes(y))||"";T(y,A)?o.logs.push(`${y.name} `):(y.currentHealth=1,d(y,A),g.graveyard.push(y),g.board[I]=null,o.logs.push(`${y.name}  ${n.name} `))}}break}case"GENERATE_CARD":{if((h=r.conditions)!=null&&h.minTurn&&t.turnCount<r.conditions.minTurn)break;const T=r.targetCardId,C=Ss.find(y=>y.id===T);if(C){const y=o.players[e],g=`gen_${o.rngSeed}_${Date.now()}_${Math.floor(a()*1e4)}`,I={...C,id:`token_${o.rngSeed}_${Math.floor(a()*1e3)}`,instanceId:g};y.hand.length<9?(y.hand.push(I),o.logs.push(`${y.name}  ${C.name} `)):(y.graveyard.push(I),o.logs.push(`${y.name}${C.name}`))}break}case"REDUCE_HAND_COST":{const T=r.value||0,C=((f=r.conditions)==null?void 0:f.nameIn)||[],y=o.players[e];let g=0;y.hand.forEach(I=>{if(C.includes(I.name)){const A=I.cost,L=Math.max(0,A-T);L!==A&&(I.cost=L,I.baseCost=L,g++)}}),g>0&&o.logs.push(`${n.name} -${T}`);break}case"GRANT_LEADER_DAMAGE_SHIELD":{const T=o.players[e];T.leaderDamageShield=!0,o.logs.push(`${T.name} 0`);break}case"RANDOM_DESTROY":{const T=(I,A)=>{var L;return((L=I.passiveAbilities)==null?void 0:L.includes("IMMUNE_TO_DAMAGE_MY_TURN"))===!0&&o.activePlayerId===A},C=r.value||1,y=r.targetType==="SELF"?e:c,g=o.players[y].board;if(i&&i.length>0)i.forEach(I=>{const A=g.findIndex(L=>(L==null?void 0:L.instanceId)===I);if(A!==-1&&g[A]){const L=g[A];T(L,y)?o.logs.push(`${L.name} `):(L.currentHealth=1,d(L,y),o.players[y].graveyard.push(L),g[A]=null,o.logs.push(`${L.name}  ${n.name} `))}});else{const I=g.map((L,j)=>!L||T(L,y)?-1:j).filter(L=>L!==-1);for(let L=I.length-1;L>0;L--){const j=Math.floor(a()*(L+1));[I[L],I[j]]=[I[j],I[L]]}I.slice(0,C).forEach(L=>{const j=g[L];j&&(j.currentHealth=1,d(j,y),o.players[y].graveyard.push(j),g[L]=null,o.logs.push(`${j.name}  ${n.name} `))})}break}case"RANDOM_SET_HP":{const T=r.value||1,C=r.value2||1,y=r.targetType==="SELF"?e:c,g=o.players[y].board;if(i&&i.length>0)i.forEach(I=>{const A=g.findIndex(L=>(L==null?void 0:L.instanceId)===I);A!==-1&&g[A]&&(g[A].currentHealth=C,o.logs.push(`${g[A].name} HP ${C} `))});else{const I=g.map((L,j)=>L?j:-1).filter(L=>L!==-1);for(let L=I.length-1;L>0;L--){const j=Math.floor(a()*(L+1));[I[L],I[j]]=[I[j],I[L]]}I.slice(0,T).forEach(L=>{const j=g[L];j&&(j.currentHealth=C,o.logs.push(`${j.name} HP ${C} `))})}break}case"RANDOM_DAMAGE":{const T=r.value2||1,C=r.value||0,y=r.targetType==="SELF"?e:c,g=o.players[y].board,I=L=>{const j=g[L];j&&(j.hasBarrier?(j.hasBarrier=!1,o.logs.push(`${j.name} `)):(j.currentHealth-=C,o.logs.push(`${n.name}  ${j.name}  ${C} `)),j.currentHealth<=0&&(j.currentHealth=0,d(j,y),o.players[y].graveyard.push(j),g[L]=null,o.logs.push(`${j.name} `)))},A=new Set;if(i&&i.length>0)i.forEach(L=>{const j=g.findIndex(N=>(N==null?void 0:N.instanceId)===L);if(j!==-1&&g[j])A.add(L),I(j);else{const N=g.map((pe,we)=>pe&&!A.has(pe.instanceId)?we:-1).filter(pe=>pe!==-1);if(N.length>0){const pe=Math.floor(a()*N.length),we=N[pe],ke=g[we];A.add(ke.instanceId),I(we)}}});else{const L=g.map((N,pe)=>N?pe:-1).filter(N=>N!==-1);for(let N=L.length-1;N>0;N--){const pe=Math.floor(a()*(N+1));[L[N],L[pe]]=[L[pe],L[N]]}L.slice(0,T).forEach(N=>{I(N)})}break}case"RANDOM_DAMAGE_BY_TURN":{const T=r.value||1,C=o.turnCount,y=r.targetType==="SELF"?e:c,g=o.players[y].board,I=A=>{var j;const L=g[A];if(!L)return!1;if(L.hasBarrier)return L.hasBarrier=!1,o.logs.push(`${L.name} `),!0;if(L.currentHealth-=T,o.logs.push(`${n.name}  ${L.name}  ${T} `),L.currentHealth<=0){L.currentHealth=0;const N=Object.keys(o.players).find(we=>o.players[we]===o.players[y])||y,pe=(j=L.triggers)==null?void 0:j.find(we=>we.trigger==="LASTWORD");return pe&&pe.effects.forEach(we=>{o.pendingEffects.push({sourceCard:L,effect:we,sourcePlayerId:N})}),o.players[y].graveyard.push(L),g[A]=null,o.logs.push(`${L.name} `),!1}return!0};if(i&&i.length>0)for(let A=0;A<i.length;A++){const L=i[A],j=g.findIndex(N=>(N==null?void 0:N.instanceId)===L);if(j!==-1&&g[j])I(j);else{const N=g.map((pe,we)=>pe?we:-1).filter(pe=>pe!==-1);if(N.length>0){const pe=Math.floor(a()*N.length);I(N[pe])}}}else for(let A=0;A<C;A++){const L=g.map((N,pe)=>N?pe:-1).filter(N=>N!==-1);if(L.length===0)break;const j=Math.floor(a()*L.length);I(L[j])}break}case"SET_MAX_HP":{const T=r.value||20;if(r.targetType==="OPPONENT"){const C=o.players[c];C.maxHp=T,C.hp>T&&(C.hp=T)}break}case"SUMMON_CARD":{const T=r.targetCardId,C=Ss.find(y=>y.id===T);if(C){const y=o.players[e];if(y.board.filter(I=>I!==null).length<5){const I={...C,instanceId:`token_${o.rngSeed}_${Math.floor(a()*1e3)}`,canAttack:((E=C.passiveAbilities)==null?void 0:E.includes("STORM"))||((k=C.passiveAbilities)==null?void 0:k.includes("RUSH"))||!1,currentHealth:C.health||1,maxHealth:C.health||1,attack:C.attack||0,currentAttack:C.attack||0,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((P=C.passiveAbilities)==null?void 0:P.includes("BARRIER"))??!1,passiveAbilities:C.passiveAbilities?[...C.passiveAbilities]:[],hadStealth:((G=C.passiveAbilities)==null?void 0:G.includes("STEALTH"))??!1};(x=C.tags)!=null&&x.includes("Knuckler")&&!I.passiveAbilities.includes("STORM")&&y.board.some(L=>(L==null?void 0:L.name)==="")&&(I.passiveAbilities.push("STORM"),I.canAttack=!0,o.logs.push(`${C.name}   `)),y.board.push(I),o.logs.push(`${y.name}  ${C.name} `)}}break}case"SUMMON_CARD_RUSH":{const T=r.targetCardId,C=Ss.find(y=>y.id===T);if(C){const y=o.players[e];if(y.board.filter(I=>I!==null).length<5){const I={...C,instanceId:`token_${o.rngSeed}_${Math.floor(a()*1e3)}`,canAttack:!0,currentHealth:C.health||1,maxHealth:C.health||1,attack:C.attack||0,currentAttack:C.attack||0,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((S=C.passiveAbilities)==null?void 0:S.includes("BARRIER"))??!1,passiveAbilities:C.passiveAbilities?[...C.passiveAbilities]:[],hadStealth:((w=C.passiveAbilities)==null?void 0:w.includes("STEALTH"))??!1};let A=!1;(p=C.tags)!=null&&p.includes("Knuckler")&&!I.passiveAbilities.includes("STORM")&&y.board.some(j=>(j==null?void 0:j.name)==="")&&(I.passiveAbilities.push("STORM"),A=!0,o.logs.push(`${C.name}   `)),!A&&!I.passiveAbilities.includes("RUSH")&&I.passiveAbilities.push("RUSH"),y.board.push(I),o.logs.push(`${y.name}  ${C.name} ${A?"":""}`)}}break}case"SUMMON_CARD_BUFFED":{const T=r.targetCardId,C=Ss.find(I=>I.id===T),y=r.value||0,g=r.value2||0;if(C){const I=o.players[e];if(I.board.filter(L=>L!==null).length<5){const L=C.attack||0,j=C.health||1,N=L+y,pe=j+g,we={...C,instanceId:`token_${o.rngSeed}_${Math.floor(a()*1e3)}`,canAttack:!1,currentHealth:pe,maxHealth:pe,health:pe,attack:N,currentAttack:N,baseAttack:L,baseHealth:j,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((b=C.passiveAbilities)==null?void 0:b.includes("BARRIER"))??!1,passiveAbilities:C.passiveAbilities?[...C.passiveAbilities]:[],hadStealth:((H=C.passiveAbilities)==null?void 0:H.includes("STEALTH"))??!1};(re=C.tags)!=null&&re.includes("Knuckler")&&!we.passiveAbilities.includes("STORM")&&I.board.some(ee=>(ee==null?void 0:ee.name)==="")&&(we.passiveAbilities.push("STORM"),we.canAttack=!0,o.logs.push(`${C.name}   `)),((K=we.passiveAbilities)!=null&&K.includes("RUSH")||(Q=we.passiveAbilities)!=null&&Q.includes("STORM"))&&(we.canAttack=!0),I.board.push(we),o.logs.push(`${I.name}  ${C.name} +${y}/+${g}`),o.pendingEffects=[...o.pendingEffects||[],{sourceCard:we,effect:{type:"VISUAL_BUFF_ONLY",value:y,value2:g},sourcePlayerId:e}]}}break}case"SUMMON_CARD_FILL_BOARD":{const T=r.targetCardId,C=Ss.find(g=>g.id===T),y=r.necromance||0;if(C){const g=o.players[e];let I=0;for(;!(g.board.filter(j=>j!==null).length>=5);){if(y>0&&g.graveyard.length<y){I===0&&o.logs.push(` ${C.name} `);break}if(y>0){const j=g.graveyard.splice(-y,y);o.logs.push(` ${y} ${j.map(N=>N.name).join(", ")} `)}const L={...C,instanceId:`token_${o.rngSeed}_${Math.floor(a()*1e3)}_${I}`,canAttack:((ce=C.passiveAbilities)==null?void 0:ce.includes("STORM"))||((me=C.passiveAbilities)==null?void 0:me.includes("RUSH"))||!1,currentHealth:C.health||1,maxHealth:C.health||1,attack:C.attack||0,currentAttack:C.attack||0,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((Se=C.passiveAbilities)==null?void 0:Se.includes("BARRIER"))??!1,passiveAbilities:C.passiveAbilities?[...C.passiveAbilities]:[],hadStealth:((de=C.passiveAbilities)==null?void 0:de.includes("STEALTH"))??!1};(B=C.tags)!=null&&B.includes("Knuckler")&&!L.passiveAbilities.includes("STORM")&&g.board.some(N=>(N==null?void 0:N.name)==="")&&(L.passiveAbilities.push("STORM"),L.canAttack=!0,o.logs.push(`${C.name}   `)),g.board.push(L),I++,o.logs.push(`${g.name}  ${C.name} `)}I>0&&o.logs.push(` ${I}  ${C.name} `)}break}case"DESTROY_AND_STEAL":{if(r.targetType==="SELECT_FOLLOWER"&&s){const T=u(s);if(T){const{card:C,player:y,index:g}=T,I=Object.keys(o.players).find(j=>o.players[j]===y)||c,A=o.players[e];if(A.board.filter(j=>j!==null).length<5){y.board[g]=null,o.logs.push(`${C.name}  ${n.name} `);const j={...C,instanceId:`stolen_${o.rngSeed}_${Math.floor(a()*1e3)}`,canAttack:!1,currentHealth:C.health||C.currentHealth,maxHealth:C.health||C.maxHealth,currentAttack:C.attack||C.currentAttack,attacksMade:0,turnPlayed:o.turnCount,hasEvolved:!1};A.board.push(j),o.logs.push(`${A.name}  ${j.name} `)}else d(C,I),y.graveyard.push(C),y.board[g]=null,o.logs.push(`${C.name}  ${n.name} `)}}break}case"DESTROY_AND_GENERATE":{let T=null;if(r.targetType==="SELECT_FOLLOWER"&&s)T=u(s);else if(r.targetType==="RANDOM_ENEMY_FOLLOWER"){const y=o.players[c].board.map((g,I)=>({card:g,index:I})).filter(g=>g.card!==null);if(y.length>0){const g=Math.floor(a()*y.length),I=y[g];T={card:I.card,player:o.players[c],index:I.index}}}if(T){const{card:C,player:y,index:g}=T,I=Object.keys(o.players).find(j=>o.players[j]===y)||c;d(C,I),y.graveyard.push(C),y.board[g]=null,o.logs.push(`${C.name}  ${n.name} `);const A=o.players[e],L=Ur(C.name);if(L){const j=Math.max(0,L.cost+(r.value||0)),N={...L,instanceId:`generated_${o.rngSeed}_${Math.floor(a()*1e3)}`,baseCost:j,cost:j,attackEffectType:L.attackEffectType};A.hand.push(N);const pe=r.value||0;o.logs.push(`${A.name}  ${N.name} ${pe>=0?"+":""}${pe}`)}}break}case"RETURN_TO_HAND":{const T=o.players[c].board;let C=-1;if(r.targetType==="SELECT_FOLLOWER"&&s?C=T.findIndex(y=>(y==null?void 0:y.instanceId)===s):(r.targetType==="RANDOM_FOLLOWER"||!s)&&T.length>0&&(C=Math.floor(a()*T.length)),C!==-1&&T[C]){const y=T[C];o.players[c].board[C]=null;const g=o.players[c],I=Ur(y.id)||Ur(y.name),{currentHealth:A,maxHealth:L,canAttack:j,attacksMade:N,hasEvolved:pe,baseAttack:we,baseHealth:ke,turnPlayed:ee,hasBarrier:X,attack:Pe,health:Ie,...Ye}=y,Ae={...Ye,attack:(I==null?void 0:I.attack)??Pe,health:(I==null?void 0:I.health)??Ie};g.hand.length<9?(g.hand.push(Ae),o.logs.push(`${y.name} `)):(g.graveyard.push(Ae),o.logs.push(`${y.name} `))}break}case"RANDOM_BOUNCE":{const T=r.value||1,C=o.players[c].board;for(let y=0;y<T;y++){const g=C.map((lt,Ze)=>lt?Ze:-1).filter(lt=>lt!==-1);if(g.length===0)break;const I=g[Math.floor(a()*g.length)],A=C[I];C[I]=null;const L=o.players[c],j=Ur(A.id)||Ur(A.name),{currentHealth:N,maxHealth:pe,canAttack:we,attacksMade:ke,hasEvolved:ee,baseAttack:X,baseHealth:Pe,turnPlayed:Ie,hasBarrier:Ye,attack:Ae,health:Fe,...Et}=A,it={...Et,attack:(j==null?void 0:j.attack)??Ae,health:(j==null?void 0:j.health)??Fe};L.hand.length<9?(L.hand.push(it),o.logs.push(`${A.name} `)):(L.graveyard.push(it),o.logs.push(`${A.name} `))}break}case"GRANT_PASSIVE":{const T=r.targetPassive;if(!T)break;if(r.targetType==="SELF"){const C=n;if(C.instanceId){const g=o.players[e].board.find(I=>(I==null?void 0:I.instanceId)===C.instanceId);g&&(T==="BARRIER"?(g.hasBarrier=!0,o.logs.push(`${g.name} `)):(g.passiveAbilities||(g.passiveAbilities=[]),g.passiveAbilities.includes(T)||(g.passiveAbilities.push(T),o.logs.push(`${g.name}  ${Oc(T)} `)),(T==="STORM"||T==="RUSH")&&(g.canAttack=!0)))}}else if((r.targetType==="SELECT_FOLLOWER"||r.targetType==="SELECT_ALLY_FOLLOWER")&&s){const C=u(s);if(C){const{card:y}=C;T==="BARRIER"?(y.hasBarrier=!0,o.logs.push(`${y.name} `)):(y.passiveAbilities||(y.passiveAbilities=[]),y.passiveAbilities.includes(T)||(y.passiveAbilities.push(T),o.logs.push(`${y.name}  ${Oc(T)} `)),(T==="STORM"||T==="RUSH")&&(y.canAttack=!0))}}else if(r.targetType==="ALL_FOLLOWERS"){const C=o.players[e];let y=0;console.log(`[GRANT_PASSIVE] ALL_FOLLOWERS: Player board has ${C.board.filter(g=>g).length} units, condition tag=${(O=r.conditions)==null?void 0:O.tag}`),C.board.forEach(g=>{var I,A,L;if(g){if(console.log(`[GRANT_PASSIVE] Checking: ${g.name}, tags=${g.tags}, passives=${g.passiveAbilities}`),(I=r.conditions)!=null&&I.tag&&!((A=g.tags)!=null&&A.includes(r.conditions.tag))){console.log(`[GRANT_PASSIVE] Skipped ${g.name}: no matching tag`);return}if((L=r.conditions)!=null&&L.nameIn&&!r.conditions.nameIn.includes(g.name)){console.log(`[GRANT_PASSIVE] Skipped ${g.name}: no matching nameIn`);return}T==="BARRIER"?(g.hasBarrier=!0,y++):(g.passiveAbilities||(g.passiveAbilities=[]),g.passiveAbilities.includes(T)||(g.passiveAbilities.push(T),y++,console.log(`[GRANT_PASSIVE] Granted ${T} to ${g.name}`),(T==="STORM"||T==="RUSH")&&(g.canAttack=!0)))}}),y>0&&o.logs.push(`${y} ${Oc(T)} `),console.log(`[GRANT_PASSIVE] Total granted: ${y}`)}else if(r.targetType==="ALL_OTHER_FOLLOWERS"){const C=o.players[e];let y=0;C.board.forEach(g=>{var I,A,L;if(g&&g.instanceId!==n.instanceId){if((I=r.conditions)!=null&&I.tag&&!((A=g.tags)!=null&&A.includes(r.conditions.tag))||(L=r.conditions)!=null&&L.nameIn&&!r.conditions.nameIn.includes(g.name))return;T==="BARRIER"?(g.hasBarrier=!0,y++):(g.passiveAbilities||(g.passiveAbilities=[]),g.passiveAbilities.includes(T)||(g.passiveAbilities.push(T),y++,(T==="STORM"||T==="RUSH")&&(g.canAttack=!0)))}}),y>0&&o.logs.push(`${y} ${Oc(T)} `)}break}case"BUFF_STATS":{const T=r.value||0,C=r.value2||0;if(r.targetType==="ALL_FOLLOWERS")o.players[e].board.forEach(g=>{var I,A,L;if(g){if((I=r.conditions)!=null&&I.tag&&!((A=g.tags)!=null&&A.includes(r.conditions.tag))||(L=r.conditions)!=null&&L.nameIn&&!r.conditions.nameIn.includes(g.name))return;g.baseAttack||(g.baseAttack=g.attack||0),g.baseHealth||(g.baseHealth=g.health||0),g.attack=(g.attack||0)+T,g.currentAttack=(g.currentAttack||0)+T,g.health=(g.health||0)+C,g.maxHealth=(g.maxHealth||0)+C,g.currentHealth=(g.currentHealth||0)+C,o.logs.push(`${g.name}  +${T}/+${C} `)}});else if(r.targetType==="ALL_OTHER_FOLLOWERS")o.players[e].board.forEach(g=>{var I,A,L;if(g&&g.instanceId!==n.instanceId){if((I=r.conditions)!=null&&I.tag&&!((A=g.tags)!=null&&A.includes(r.conditions.tag))||(L=r.conditions)!=null&&L.nameIn&&!r.conditions.nameIn.includes(g.name))return;g.baseAttack||(g.baseAttack=g.attack||0),g.baseHealth||(g.baseHealth=g.health||0),g.attack=(g.attack||0)+T,g.currentAttack=(g.currentAttack||0)+T,g.health=(g.health||0)+C,g.maxHealth=(g.maxHealth||0)+C,g.currentHealth=(g.currentHealth||0)+C,o.logs.push(`${g.name}  +${T}/+${C} `)}});else if((r.targetType==="SELECT_FOLLOWER"||r.targetType==="SELECT_ALLY_FOLLOWER"||r.targetType==="SELECT_OTHER_ALLY_FOLLOWER")&&s){const y=u(s);if(y){const{card:g}=y;g.baseAttack||(g.baseAttack=g.attack||0),g.baseHealth||(g.baseHealth=g.health||0),g.attack=(g.attack||0)+T,g.currentAttack=(g.currentAttack||0)+T,g.health=(g.health||0)+C,g.maxHealth=(g.maxHealth||0)+C,g.currentHealth=(g.currentHealth||0)+C,o.logs.push(`${g.name}  +${T}/+${C} `)}}else if(r.targetType==="RANDOM_FOLLOWER"){const y=o.players[c].board,g=y.map((I,A)=>I?A:-1).filter(I=>I!==-1);if(g.length>0){const I=g[Math.floor(a()*g.length)],A=y[I];A.baseAttack||(A.baseAttack=A.attack||0),A.baseHealth||(A.baseHealth=A.health||0),A.attack=(A.attack||0)+T,A.currentAttack=(A.currentAttack||0)+T,A.health=(A.health||0)+C,A.maxHealth=(A.maxHealth||0)+C,A.currentHealth=(A.currentHealth||0)+C,A.currentAttack<0&&(A.currentAttack=0),A.attack&&A.attack<0&&(A.attack=0);const L=T>=0?`+${T}`:`${T}`,j=C>=0?`+${C}`:`${C}`;o.logs.push(`${A.name}  ${L}/${j} `)}else o.logs.push("")}break}}return o}const UO=t=>{const e=n=>{const r=n.board.some(i=>i&&i.name.includes("")),s=n.hand.map(i=>{var c;const o=i.baseCost!==void 0?i.baseCost:i.cost;let a=o;return r&&((c=i.tags)!=null&&c.includes("Knuckler"))&&(a=Math.max(0,o-2)),i.cost!==a?{...i,cost:a,baseCost:o}:i});return{...n,hand:s}};return{...t,players:{p1:e(t.players.p1),p2:e(t.players.p2)}}},BO=(t,e)=>{let n=zO(t,e);return n=UO(n),n.lastHash=DO(n),n},zO=(t,e)=>{var s,i,o,a,c,u,d,h,f,E,k,P,G,x,S,w,p,b,H,re,K,Q,ce,me,Se;console.log(`[Reducer] Action: ${e.type}, isRemote: ${e.isRemote}`);let n={...t,players:{p1:{...t.players.p1,hand:[...t.players.p1.hand],deck:[...t.players.p1.deck],board:t.players.p1.board.map(de=>de?{...de,passiveAbilities:de.passiveAbilities?[...de.passiveAbilities]:[]}:null),graveyard:[...t.players.p1.graveyard]},p2:{...t.players.p2,hand:[...t.players.p2.hand],deck:[...t.players.p2.deck],board:t.players.p2.board.map(de=>de?{...de,passiveAbilities:de.passiveAbilities?[...de.passiveAbilities]:[]}:null),graveyard:[...t.players.p2.graveyard]}},logs:[...t.logs||[]]};const r=O0(n.rngSeed||999);switch(n.rngSeed=Math.floor(r()*1e6),e.type){case"START_GAME":return t;case"END_TURN":{const de=t.activePlayerId,B=n.players[de];B.extraPpActive&&(B.id!==t.firstPlayerId&&(n.turnCount<=5?B.extraPpUsedEarly=!0:B.extraPpUsedLate=!0),B.extraPpActive=!1);const O=[...n.pendingEffects||[]];B.board.forEach(y=>{y&&y.triggers&&y.triggers.filter(g=>g.trigger==="END_OF_TURN").forEach(g=>{g.effects.forEach(I=>{O.push({sourceCard:y,effect:I,sourcePlayerId:de})})})});const T=Dp(de),C=n.players[T];if(C.board.forEach((y,g)=>{y&&y.triggers&&y.triggers.filter(I=>I.trigger==="START_OF_TURN").forEach(I=>{I.effects.forEach(A=>{A.type==="DESTROY_SELF"?y&&(n.players[T].graveyard.push(y),n.players[T].board[g]=null,n.logs.push(`${y.name} `)):O.push({sourceCard:y,effect:A,sourcePlayerId:T})})})}),n.players[T].board=n.players[T].board.filter(Boolean),C.maxPp=Math.min(10,C.maxPp+1),C.pp=C.maxPp,C.deck.length>0){const y=C.deck.pop();y&&(C.hand.length<9?C.hand.push(y):(C.graveyard.push(y),n.logs.push(`${C.name}${y.name}`)))}return C.board=C.board.filter(Boolean),C.board.forEach(y=>{y&&(y.canAttack=!0,y.attacksMade=0,y.turnPlayed=-1)}),C.canEvolveThisTurn=!0,n.activePlayerId=T,n.pendingEffects=O,T===t.firstPlayerId&&(n.turnCount+=1),n.logs.push(` ${n.turnCount} - ${C.name} `),n}case"CONCEDE":{const de=e.playerId,B=n.players[de];if(!B)return console.warn(`[Engine] CONCEDE: Unknown playerId: ${de}. Ignoring.`),t;if(t.phase==="GAME_OVER")return console.warn("[Engine] CONCEDE: Game already over. Ignoring."),t;const O=Dp(de);return n.phase="GAME_OVER",n.winnerId=O,n.logs.push(`${B.name} `),console.log(`[Engine] CONCEDE: ${de} surrendered. Winner: ${O}`),n}case"RESOLVE_EFFECT":{if(!n.pendingEffects||n.pendingEffects.length===0)return n;const[de,...B]=n.pendingEffects;console.log(`[Engine] RESOLVE_EFFECT: Processing ${de.effect.type} from ${de.sourceCard.name}. Remaining: ${B.length}`);const O=((s=e.payload)==null?void 0:s.targetId)||de.targetId;let T=FO(n,de.sourcePlayerId,de.sourceCard,de.effect,O,de.targetIds);const C=(T.pendingEffects||[]).filter(g=>{var I;return!((I=n.pendingEffects)!=null&&I.includes(g))}),y=[...B,...C];return console.log(`[Engine] RESOLVE_EFFECT done. Remaining: ${B.length}, NewlyAdded: ${C.length}, Final: ${y.length}`),y.length===0&&Object.values(T.players).forEach(g=>{g.board=g.board.filter(Boolean)}),{...T,pendingEffects:y}}case"PLAY_CARD":{if(!e.isRemote&&n.activePlayerId!==e.playerId)return n;const{cardIndex:de,targetId:B,instanceId:O}=e.payload,T={...n.players.p1,hand:[...n.players.p1.hand],deck:[...n.players.p1.deck],board:[...n.players.p1.board],graveyard:[...n.players.p1.graveyard]},C={...n.players.p2,hand:[...n.players.p2.hand],deck:[...n.players.p2.deck],board:[...n.players.p2.board],graveyard:[...n.players.p2.graveyard]},y=e.playerId==="p1"?T:C;console.log(`[Engine] PLAY_CARD: playerId=${e.playerId}, cardIndex=${de}, instanceId=${O}, handLength=${y.hand.length}, isRemote=${e.isRemote}`),console.log("[Engine] PLAY_CARD: hand cards:",y.hand.map(ee=>`${ee.name}(${ee.instanceId})`));let g=de;if(O){const ee=y.hand.findIndex(X=>X.instanceId===O);if(ee>=0)g=ee,console.log(`[Engine] PLAY_CARD: Using instanceId ${O}, found at index ${ee} (was ${de})`);else return console.log(`[Engine] PLAY_CARD: instanceId ${O} not found in hand!`),n}if(g<0||g>=y.hand.length)return console.log("[Engine] PLAY_CARD: Invalid cardIndex! Returning unchanged state."),n;const I=y.hand[g];let A="";if(B){const X=(e.playerId==="p1"?C:T).board.find(Pe=>(Pe==null?void 0:Pe.instanceId)===B);X&&(A=` (: ${X.name})`)}if(n.logs.push(`${y.name}  ${I.name} ${A}`),y.pp<I.cost)return n;const L=y.board.filter(ee=>ee!==null).length;if(I.type==="FOLLOWER"&&L>=5)return n;const j=y.pp;y.pp-=I.cost,y.extraPpActive&&j-1<I.cost&&(y.id!==t.firstPlayerId&&(n.turnCount<=5?y.extraPpUsedEarly=!0:y.extraPpUsedLate=!0),y.extraPpActive=!1,y.pp<0&&(y.pp=0),console.log("[Engine] PLAY_CARD: Extra PP consumed, marked as used"),n.logs.push(`${y.name} PP`)),y.hand.splice(g,1);let N=I;if(I.type==="FOLLOWER"){const ee={...I,instanceId:e.payload.instanceId||`inst_${n.rngSeed}_${Math.floor(r()*1e3)}`,currentAttack:I.attack||0,currentHealth:I.health||0,maxHealth:I.health||0,canAttack:!1,hasEvolved:!1,attacksMade:0,turnPlayed:n.turnCount,hasBarrier:((i=I.passiveAbilities)==null?void 0:i.includes("BARRIER"))??!1,passiveAbilities:I.passiveAbilities?[...I.passiveAbilities]:[],hadStealth:((o=I.passiveAbilities)==null?void 0:o.includes("STEALTH"))??!1};((a=I.passiveAbilities)!=null&&a.includes("STORM")||(c=I.passiveAbilities)!=null&&c.includes("RUSH"))&&(ee.canAttack=!0),(u=ee.tags)!=null&&u.includes("Knuckler")&&!ee.passiveAbilities.includes("STORM")&&y.board.some(Pe=>(Pe==null?void 0:Pe.name)==="")&&(ee.passiveAbilities.push("STORM"),ee.canAttack=!0,n.logs.push(`${ee.name}   `)),y.board.push(ee),N=ee,ee.name===""&&y.board.forEach(X=>{var Pe,Ie;X&&((Pe=X.tags)!=null&&Pe.includes("Knuckler"))&&X.instanceId!==ee.instanceId&&((Ie=X.passiveAbilities)!=null&&Ie.includes("STORM")||(X.passiveAbilities||(X.passiveAbilities=[]),X.passiveAbilities.push("STORM"),X.canAttack=!0,n.logs.push(`${X.name}   `)))})}else y.graveyard.push({...I,instanceId:`spell_${n.rngSeed}_${Math.floor(r()*1e3)}`});const pe=[];(d=I.triggers)==null||d.filter(ee=>ee.trigger==="FANFARE").forEach(ee=>pe.push(...ee.effects)),(h=I.triggerAbilities)!=null&&h.FANFARE&&pe.push(I.triggerAbilities.FANFARE);let we=[...n.pendingEffects||[]];return pe.forEach(ee=>{if(ee.conditions&&ee.conditions.minTurn&&n.turnCount<ee.conditions.minTurn)return;let X;if(ee.targetType==="OPPONENT"||ee.targetType==="SELF"||ee.targetType==="ALL_FOLLOWERS"||ee.targetType==="ALL_OTHER_FOLLOWERS"||ee.type==="RANDOM_DESTROY"||ee.type==="RANDOM_SET_HP"||ee.type==="AOE_DAMAGE"||ee.type==="RANDOM_DAMAGE"||ee.type==="RANDOM_DAMAGE_BY_TURN"){const Ie=e.playerId==="p1"?"p2":"p1",Ye=e.playerId;if(ee.type==="RANDOM_DAMAGE_BY_TURN"){const Ae=ee.targetType==="SELF"?Ye:Ie,Fe=n.players[Ae].board,Et=n.turnCount;X=[];for(let it=0;it<Et;it++){const lt=Fe.map(($e,ot)=>$e?ot:-1).filter($e=>$e!==-1);if(lt.length===0)break;const Ze=Math.floor(r()*lt.length);X.push(Fe[lt[Ze]].instanceId)}}else if(ee.type==="RANDOM_DESTROY"||ee.type==="RANDOM_SET_HP"||ee.type==="RANDOM_DAMAGE"){const Ae=ee.targetType==="SELF"?Ye:Ie,Fe=n.players[Ae].board,Et=ee.type==="RANDOM_DAMAGE"?ee.value2||1:ee.value||1,it=Fe.map((Ze,$e)=>Ze?$e:-1).filter(Ze=>Ze!==-1);for(let Ze=it.length-1;Ze>0;Ze--){const $e=Math.floor(r()*(Ze+1));[it[Ze],it[$e]]=[it[$e],it[Ze]]}X=it.slice(0,Et).map(Ze=>Fe[Ze].instanceId)}else if(ee.targetType==="ALL_FOLLOWERS"||ee.type==="AOE_DAMAGE"){const Ae=ee.type==="GRANT_PASSIVE"||ee.type==="BUFF_STATS",Fe=Ae?Ye:Ie;X=n.players[Fe].board.filter(it=>it!==null).map(it=>it.instanceId),console.log(`[Engine] Pre-calculated ALL_FOLLOWERS targets (${Ae?"ally":"enemy"}): ${X.length} units`)}else ee.targetType==="ALL_OTHER_FOLLOWERS"&&(X=n.players[Ye].board.filter(Fe=>Fe!==null&&Fe.instanceId!==N.instanceId).map(Fe=>Fe.instanceId))}const Pe=ee.targetType==="SELECT_FOLLOWER"||ee.targetType==="SELECT_ALLY_FOLLOWER"||ee.targetType==="SELECT_OTHER_ALLY_FOLLOWER";we.push({sourceCard:N,effect:ee,sourcePlayerId:e.playerId,targetId:Pe?B:void 0,targetIds:X})}),console.log(`[Engine] PLAY_CARD: Queued ${pe.length} effects. Total pending: ${we.length}`),{...n,players:{p1:T,p2:C},pendingEffects:we}}case"EVOLVE":{const{followerIndex:de,targetId:B,useSep:O}=e.payload,T={...n.players.p1,hand:[...n.players.p1.hand],deck:[...n.players.p1.deck],board:n.players.p1.board.map(N=>N?{...N,passiveAbilities:N.passiveAbilities?[...N.passiveAbilities]:void 0}:null),graveyard:[...n.players.p1.graveyard]},C={...n.players.p2,hand:[...n.players.p2.hand],deck:[...n.players.p2.deck],board:n.players.p2.board.map(N=>N?{...N,passiveAbilities:N.passiveAbilities?[...N.passiveAbilities]:void 0}:null),graveyard:[...n.players.p2.graveyard]},y=e.playerId==="p1"?T:C,g=y.board[de];if(!g||g.hasEvolved)return n;const I=e.isRemote;if(console.log(`[Engine] EVOLVE Logic: name=${g.name}, useSep=${O}, isRemote=${I}, turn=${t.turnCount}`),n.logs.push(`${y.name}  ${g.name} ${O?"":""}`),O){if(!I){if(t.turnCount<6)return console.log(`[Engine] Cannot Super Evolve: Turn ${t.turnCount} < 6`),n;if(y.sep<=0)return console.log("[Engine] Cannot Super Evolve: No SEP"),n;if(!y.canEvolveThisTurn)return console.log("[Engine] Cannot Super Evolve: Already evolved this turn"),n}y.sep=Math.max(0,y.sep-1),y.canEvolveThisTurn=!1,g.hasEvolved=!0,g.currentAttack+=3,g.currentHealth+=3,g.maxHealth+=3,g.canAttack=!0;const N=[...g.passiveAbilities||[]];N.includes("IMMUNE_TO_DAMAGE_MY_TURN")||N.push("IMMUNE_TO_DAMAGE_MY_TURN"),!N.includes("STORM")&&!N.includes("RUSH")&&N.push("RUSH"),g.passiveAbilities=N,console.log(`[Engine] Super Evolved ${g.name}! SEP remaining: ${y.sep}`)}else{if(!I){const we=e.playerId===t.firstPlayerId?5:4;if(t.turnCount<we)return console.log(`[Engine] Cannot Evolve: Turn ${t.turnCount} < ${we}`),n;if(y.evolutionsUsed>=2)return console.log("[Engine] Cannot Evolve: Limit reached"),n;if(!y.canEvolveThisTurn)return console.log("[Engine] Cannot Evolve: Already evolved this turn"),n}y.evolutionsUsed+=1,y.canEvolveThisTurn=!1,g.hasEvolved=!0,g.currentAttack+=2,g.currentHealth+=2,g.maxHealth+=2,g.canAttack=!0;const N=[...g.passiveAbilities||[]];!N.includes("STORM")&&!N.includes("RUSH")&&N.push("RUSH"),g.passiveAbilities=N}const A=[];(f=g.triggers)==null||f.filter(N=>N.trigger==="EVOLVE").forEach(N=>A.push(...N.effects)),(E=g.triggerAbilities)!=null&&E.EVOLVE&&A.push(g.triggerAbilities.EVOLVE),O&&((k=g.triggers)==null||k.filter(N=>N.trigger==="SUPER_EVOLVE").forEach(N=>A.push(...N.effects)));let L=[...n.pendingEffects||[]];return A.forEach(N=>{if(N.conditions&&N.conditions.minTurn&&n.turnCount<N.conditions.minTurn)return;let pe;const we=e.playerId==="p1"?"p2":"p1",ke=e.playerId;if(N.type==="RANDOM_DESTROY"||N.type==="RANDOM_SET_HP"||N.type==="RANDOM_DAMAGE"){const ee=N.targetType==="SELF"?ke:we,X=n.players[ee].board,Pe=N.type==="RANDOM_DAMAGE"?N.value2||1:N.value||1,Ie=X.map((Ae,Fe)=>Ae?Fe:-1).filter(Ae=>Ae!==-1);for(let Ae=Ie.length-1;Ae>0;Ae--){const Fe=Math.floor(r()*(Ae+1));[Ie[Ae],Ie[Fe]]=[Ie[Fe],Ie[Ae]]}pe=Ie.slice(0,Pe).map(Ae=>X[Ae].instanceId)}else N.targetType==="ALL_FOLLOWERS"||N.type==="AOE_DAMAGE"?(pe=n.players[we].board.filter(X=>X!==null).map(X=>X.instanceId),console.log(`[Engine EVOLVE] Pre-calculated ALL_FOLLOWERS targets: ${pe.length} units`)):N.targetType==="ALL_OTHER_FOLLOWERS"&&(pe=n.players[ke].board.filter(X=>X!==null&&X.instanceId!==g.instanceId).map(X=>X.instanceId));L.push({sourceCard:g,effect:N,sourcePlayerId:e.playerId,targetId:B,targetIds:pe})}),console.log(`[Engine] EVOLVE: Queued ${A.length} effects. Total pending: ${L.length}`),{...n,players:{p1:T,p2:C},pendingEffects:L}}case"ATTACK":{console.log(`[Engine] ATTACK received. Incoming state P1 HP: ${t.players.p1.hp}, P2 HP: ${t.players.p2.hp}`);const{attackerIndex:de,targetIndex:B,targetIsLeader:O}=e.payload,T={...n.players.p1,board:n.players.p1.board.map(X=>X?{...X,passiveAbilities:X.passiveAbilities?[...X.passiveAbilities]:void 0}:null),graveyard:[...n.players.p1.graveyard]},C={...n.players.p2,board:n.players.p2.board.map(X=>X?{...X,passiveAbilities:X.passiveAbilities?[...X.passiveAbilities]:void 0}:null),graveyard:[...n.players.p2.graveyard]},y=e.playerId==="p1",g=y?T:C,I=y?C:T,A=g.board[de];if(!A||!A.canAttack)return n;const L=I.board.filter(X=>{var Pe,Ie;return X&&((Pe=X.passiveAbilities)==null?void 0:Pe.includes("WARD"))&&!((Ie=X.passiveAbilities)!=null&&Ie.includes("STEALTH"))}),j=((P=A.passiveAbilities)==null?void 0:P.includes("STEALTH"))||A.hadStealth;if(L.length>0&&!j){if(O)return console.log("[Engine] Attack blocked: Must attack Ward unit first."),n;const X=I.board[B];if(X&&!((G=X.passiveAbilities)!=null&&G.includes("WARD")))return console.log("[Engine] Attack blocked: Must attack Ward unit first."),n}if(O===!1){const X=I.board[B];if(X&&((x=X.passiveAbilities)!=null&&x.includes("STEALTH")))return console.log("[Engine] ATTACK blocked: Target has STEALTH"),n}const N=(S=A.passiveAbilities)==null?void 0:S.includes("RUSH"),pe=(w=A.passiveAbilities)==null?void 0:w.includes("STORM");if(N&&!pe&&O&&A.turnPlayed===n.turnCount)return console.log("[Engine] ATTACK blocked: RUSH unit cannot attack leader on the turn it was played"),n;(p=A.passiveAbilities)!=null&&p.includes("STEALTH")&&(A.passiveAbilities=A.passiveAbilities.filter(X=>X!=="STEALTH"),n.logs.push(`${A.name} `)),A.canAttack=!1,A.attacksMade=(A.attacksMade||0)+1,(b=A.passiveAbilities)!=null&&b.includes("DOUBLE_ATTACK")&&A.attacksMade<2&&(A.canAttack=!0);const we=A.currentAttack;console.log(`[Engine] Attack: ${A.name} (${we}) -> Target (Leader? ${O}). DefHP before: ${I.hp}`);const ke=(X,Pe)=>{var Ye;const Ie=(Ye=X.triggers)==null?void 0:Ye.find(Ae=>Ae.trigger==="LAST_WORD");if(Ie){const Ae=Ie.effects.map(Fe=>({sourceCard:X,effect:Fe,sourcePlayerId:Pe}));n.pendingEffects=[...n.pendingEffects||[],...Ae],n.logs.push(`${X.name} `),console.log(`[Engine] Last Word triggered for ${X.name}. pendingEffects count: ${n.pendingEffects.length}`)}};if(O){const X="";if(n.logs.push(`${A.name}  ${X} `),I.leaderDamageShield)I.leaderDamageShield=!1,n.logs.push(`${A.name}  ${X}  ${we} `);else{const Pe=I.board.some(Ye=>{var Ae;return(Ae=Ye==null?void 0:Ye.passiveAbilities)==null?void 0:Ae.includes("LEADER_DAMAGE_CAP")}),Ie=Pe?Math.min(we,1):we;I.hp-=Ie,Pe&&we>1?n.logs.push(`${A.name}  ${X}  ${we} 1`):n.logs.push(`${A.name}  ${X}  ${Ie} `),I.hp<=0&&(n.winnerId=e.playerId)}}else{const X=I.board[B];if(!X)return console.log(`[Engine] Attack target at index ${B} no longer exists. Skipping.`),n;n.logs.push(`${A.name}  ${X.name} `);let Pe=we;(H=X.passiveAbilities)!=null&&H.includes("IMMUNE_TO_FOLLOWER_DAMAGE")?(Pe=0,n.logs.push(`${X.name} `)):X.hasBarrier&&Pe>0?(Pe=0,X.hasBarrier=!1,n.logs.push(`${X.name} `)):n.logs.push(`${A.name}  ${X.name}  ${Pe} `),X.currentHealth-=Pe;const Ie=y?"p2":"p1",Ye=((re=X.passiveAbilities)==null?void 0:re.includes("IMMUNE_TO_DAMAGE_MY_TURN"))&&n.activePlayerId===Ie;(K=A.passiveAbilities)!=null&&K.includes("BANE")&&X.currentHealth>0&&(Ye?n.logs.push(`${X.name} `):(X.currentHealth=0,X.killedByBane=!0,n.logs.push(`${A.name}  ${X.name} `)));let Ae=X.currentAttack;(Q=A.passiveAbilities)!=null&&Q.includes("IMMUNE_TO_DAMAGE_MY_TURN")&&(Ae=0,n.logs.push(`${A.name} `)),A.hasBarrier&&Ae>0?(Ae=0,A.hasBarrier=!1,n.logs.push(`${A.name} `)):Ae>0&&n.logs.push(`${X.name}  ${A.name}  ${Ae} `),A.currentHealth-=Ae;const Fe=y?"p1":"p2";A.currentHealth<=0&&((ce=A.passiveAbilities)!=null&&ce.includes("GUTS_MY_TURN"))&&n.activePlayerId===Fe&&(A.currentHealth=1,n.logs.push(`${A.name} 1`));const Et=((me=A.passiveAbilities)==null?void 0:me.includes("IMMUNE_TO_DAMAGE_MY_TURN"))&&n.activePlayerId===Fe;(Se=X.passiveAbilities)!=null&&Se.includes("BANE")&&A.currentHealth>0&&(Et?n.logs.push(`${A.name} `):(A.currentHealth=0,A.killedByBane=!0,n.logs.push(`${X.name}  ${A.name} `)));const it=X.currentHealth<=0,lt=A.currentHealth<=0;it&&(X.currentHealth=Math.min(0,X.currentHealth),I.graveyard.push(X),I.board[B]=null,n.logs.push(`${X.name} `)),lt&&(A.currentHealth=Math.min(0,A.currentHealth),g.graveyard.push(A),g.board[de]=null,n.logs.push(`${A.name} `)),it&&ke(X,y?"p2":"p1"),lt&&ke(A,y?"p1":"p2")}console.log(`[Engine] Committing state. P1 HP: ${T.hp}, P2 HP: ${C.hp}`);const ee={...n,players:{p1:T,p2:C}};return console.log(`[Engine] After commit. finalState.players.p1.hp: ${ee.players.p1.hp}, finalState.players.p2.hp: ${ee.players.p2.hp}`),ee}case"REINIT_GAME":{const{p1Class:de,p2Class:B}=e.payload;return console.log(`[Engine] REINIT_GAME: p1=${de}, p2=${B}`),su("Player 1",de,"Player 2",B)}case"SYNC_STATE":return console.log("[Engine] SYNC_STATE received"),e.payload;case"UPDATE_PLAYER_NAME":{const{playerId:de,name:B}=e.payload;return console.log("[Engine] UPDATE_PLAYER_NAME:",de,B),t.players[de]?{...t,players:{...t.players,[de]:{...t.players[de],name:B}}}:(console.warn("[Engine] UPDATE_PLAYER_NAME: Unknown playerId:",de),t)}case"TOGGLE_EXTRA_PP":{const de=e.playerId,B=n.players[de];if(!(de!==t.firstPlayerId))return console.log("[Engine] TOGGLE_EXTRA_PP: Only second player can use Extra PP"),t;if(t.activePlayerId!==de)return console.log("[Engine] TOGGLE_EXTRA_PP: Can only toggle on your turn"),t;if(B.extraPpActive)return B.extraPpActive=!1,B.pp=Math.max(0,B.pp-1),console.log("[Engine] TOGGLE_EXTRA_PP: Deactivated, PP now",B.pp),n;if(n.turnCount<=5){if(B.extraPpUsedEarly)return console.log("[Engine] TOGGLE_EXTRA_PP: Already used in early turns"),t}else if(B.extraPpUsedLate)return console.log("[Engine] TOGGLE_EXTRA_PP: Already used in late turns"),t;return B.extraPpActive=!0,B.pp+=1,console.log("[Engine] TOGGLE_EXTRA_PP: Activated, PP now",B.pp),n}default:return t}},HO=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},Xi=({card:t,onClick:e,style:n,isSelected:r,isPlayable:s,variant:i="normal",turnCount:o,isOnBoard:a,isSpecialSummoning:c,className:u,suppressPassives:d,isMyTurn:h,scale:f=1})=>{const E="currentAttack"in t?t.currentAttack:t.attack,k="currentHealth"in t?t.currentHealth:t.health,P="maxHealth"in t?t.maxHealth:t.health,G="canAttack"in t?t.canAttack:!1,x="turnPlayed"in t?t.turnPlayed:void 0,[S,w]=M.useState(!1);M.useEffect(()=>{if(c&&a){w(!0);const L=setTimeout(()=>w(!1),800);return()=>clearTimeout(L)}},[c,a]);const p="baseAttack"in t?t.baseAttack:void 0,b="baseHealth"in t?t.baseHealth:void 0,H=p!==void 0&&E>p,re=b!==void 0&&(k>b||P>b),K="hasEvolved"in t?t.hasEvolved:!1,Q="evolvedImageUrl"in t?t.evolvedImageUrl:void 0,ce=K&&Q?Q:t.imageUrl,me=ce?HO(ce):void 0;let Se=n==null?void 0:n.boxShadow,de;const B=t.passiveAbilities||t.abilities||[],O=B.includes("WARD"),T=B.includes("AURA"),C=B.includes("STEALTH"),y=t.hasBarrier===!0||B.includes("BARRIER")&&t.hasBarrier!==!1;if(r)Se="0 0 15px rgba(255, 255, 255, 0.8)";else if(s)Se="0 0 10px #48bb78",de="2px solid #48bb78";else if(G&&h){const L=B.includes("STORM"),j=B.includes("RUSH"),N=o!==void 0&&x!==void 0&&x===o;let pe=!1;L||(N?pe=!0:(o===void 0||x===void 0)&&(pe=j)),pe?Se="0 0 10px #f6e05e":Se="0 0 10px #48bb78"}const g=k<P;if(i==="art-only")return l.jsx("div",{className:"card art-only",style:{width:140,height:200,...n,borderRadius:8,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",background:"#2d3748",position:"relative",boxShadow:"0 4px 6px rgba(0,0,0,0.3)"},children:me?l.jsx("img",{src:me,alt:t.name,draggable:!1,style:{width:"100%",height:"100%",objectFit:"cover"}}):l.jsx("div",{style:{fontSize:"1.5rem",opacity:.5,color:"white",fontWeight:"bold"},children:t.type})});if(i==="mobile-hand"){const j=t.type==="SPELL"?16:6,N=28*f,pe=.85*f;return l.jsxs("div",{className:`card mobile-hand ${u||""}`,style:{width:80,height:115,...n,position:"relative",cursor:e?"pointer":"default",transform:r?"translateY(-8px)":n==null?void 0:n.transform,boxShadow:Se||(n==null?void 0:n.boxShadow),border:de||(s?"2px solid #48bb78":void 0),transition:"transform 0.2s, box-shadow 0.2s",background:"#1a202c",overflow:"hidden",borderRadius:`${j}px ${j}px 6px 6px`,backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},onClick:e,children:[l.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"hidden",borderRadius:`${j}px ${j}px 6px 6px`},children:me?l.jsx("img",{src:me,alt:t.name,draggable:!1,style:{width:"100%",height:"100%",objectFit:"cover"}}):l.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"#4a5568",color:"#a0aec0",fontSize:"0.6rem"},children:t.type})}),l.jsxs("div",{style:{position:"absolute",top:3,left:4,display:"flex",flexDirection:"column",gap:2,zIndex:10},children:[l.jsx("div",{style:{width:N,height:N,borderRadius:"50%",background:"#48bb78",border:"1px solid rgba(255,255,255,0.8)",color:"white",fontSize:`${pe}rem`,fontWeight:900,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.6)"},children:t.cost}),t.type==="FOLLOWER"&&l.jsxs("div",{style:{width:N,height:N,display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[l.jsx("svg",{width:N,height:N,viewBox:"0 0 24 24",fill:"none",style:{position:"absolute",filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.8))"},children:l.jsx("polygon",{points:"12,2 22,22 2,22",fill:"#4299e1",stroke:"rgba(255,255,255,0.8)",strokeWidth:"1",strokeLinejoin:"round"})}),l.jsx("span",{style:{zIndex:1,color:H?"#faf089":"white",fontWeight:"bold",fontSize:`${pe}rem`,textShadow:"0 1px 2px black"},children:E})]}),t.type==="FOLLOWER"&&l.jsxs("div",{style:{width:N,height:N,display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[l.jsx("svg",{width:N,height:N,viewBox:"0 0 24 24",style:{position:"absolute",filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.8))"},children:l.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z",fill:"#c53030",stroke:"rgba(255,255,255,0.8)",strokeWidth:"1"})}),l.jsx("span",{style:{zIndex:1,color:re?"#faf089":g?"#fc8181":"white",fontWeight:"bold",fontSize:`${pe}rem`,textShadow:"0 1px 2px black"},children:k})]})]})]})}const I=t.type==="SPELL"&&!a,A=I?20:8;return l.jsxs("div",{className:`card card-container ${G?"ready":""} ${a?"on-board":""} ${u||""}`,style:{width:140,height:200,...n,position:"relative",cursor:e?"pointer":"default",transform:r?"translateY(-10px)":n==null?void 0:n.transform,boxShadow:Se||(G?"0 0 10px #f6e05e":n==null?void 0:n.boxShadow),border:de||(s?"2px solid #48bb78":void 0),transition:"transform 0.2s, box-shadow 0.2s",display:"flex",flexDirection:"column",background:"#1a202c",overflow:"visible",animation:S?"cardSummonAppear 0.8s cubic-bezier(0.22, 1, 0.36, 1) forwards":n==null?void 0:n.animation,backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",borderRadius:I?`${A}px ${A}px 8px 8px`:"8px"},onClick:e,children:[!a&&l.jsx("div",{style:{height:20,background:"rgba(0,0,0,0.8)",color:"#e2e8f0",fontSize:t.name.length>10?"0.6rem":"0.7rem",fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid rgba(255,255,255,0.2)",zIndex:2,transform:t.name.length>15?"scaleX(0.9)":"none",borderRadius:I?`${A}px ${A}px 0 0`:"8px 8px 0 0"},children:t.name}),l.jsxs("div",{style:{flex:1,position:"relative",width:"100%",background:"#2d3748",borderRadius:a?"8px":"0 0 8px 8px",minHeight:0},children:[l.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"hidden",borderRadius:a?"8px":"0 0 8px 8px",zIndex:1},children:[me?l.jsx("img",{src:me,alt:t.name,draggable:!1,style:{width:"100%",height:"100%",objectFit:"cover",display:"block"}}):l.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"#4a5568",color:"#a0aec0",fontSize:"0.8rem"},children:t.type}),l.jsx("div",{style:{position:"absolute",bottom:0,left:0,width:"100%",height:40,background:"linear-gradient(to top, rgba(0,0,0,0.8), transparent)",pointerEvents:"none",zIndex:3}})]}),!a&&l.jsx("div",{style:{position:"absolute",top:2*f,left:2*f,width:24*f,height:24*f,borderRadius:"50%",background:"#48bb78",border:`${Math.max(1,2*f)}px solid #fff`,color:"white",fontSize:`${.9*f}rem`,fontWeight:900,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 2px 4px rgba(0,0,0,0.5), inset 0 2px 5px rgba(255,255,255,0.3)",zIndex:10},children:t.cost}),t.type==="FOLLOWER"&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{style:{position:"absolute",bottom:a?2*f:40*f,left:2*f,width:32*f,height:32*f,zIndex:10,display:"flex",alignItems:"center",justifyContent:"center"},children:[l.jsxs("svg",{width:40*f,height:40*f,viewBox:"0 0 24 24",fill:"none",style:{position:"absolute",filter:"drop-shadow(0 2px 2px rgba(0,0,0,0.8))"},children:[l.jsx("defs",{children:l.jsxs("linearGradient",{id:"blueGrad",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[l.jsx("stop",{offset:"0%",stopColor:"#63b3ed"}),l.jsx("stop",{offset:"100%",stopColor:"#4299e1"})]})}),l.jsx("polygon",{points:"12,2 22,22 2,22",fill:"url(#blueGrad)",stroke:"white",strokeWidth:"1",strokeLinejoin:"round"})]}),l.jsx("span",{style:{zIndex:11,color:H?"#faf089":"white",fontWeight:"bold",fontSize:`${1.2*f}rem`,textShadow:"0 2px 2px black"},children:E})]}),l.jsxs("div",{style:{position:"absolute",bottom:2*f,right:a?2*f:"auto",left:a?"auto":2*f,width:32*f,height:32*f,zIndex:10,display:"flex",alignItems:"center",justifyContent:"center"},children:[l.jsxs("svg",{width:36*f,height:36*f,viewBox:"0 0 24 24",style:{position:"absolute",filter:"drop-shadow(0 2px 2px rgba(0,0,0,0.8))"},children:[l.jsx("defs",{children:l.jsxs("linearGradient",{id:"redGrad",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[l.jsx("stop",{offset:"0%",stopColor:"#f56565"}),l.jsx("stop",{offset:"100%",stopColor:"#c53030"})]})}),l.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z",fill:"url(#redGrad)",stroke:"white",strokeWidth:"1.5"})]}),l.jsx("span",{style:{zIndex:11,color:re?"#faf089":g?"#fc8181":"white",fontWeight:"bold",fontSize:`${1.2*f}rem`,textShadow:"0 2px 2px black"},children:k})]})]}),a&&l.jsx("div",{style:{position:"absolute",top:-6*f,left:-6*f,right:-6*f,bottom:-6*f,zIndex:50,pointerEvents:"none",opacity:O&&!d?1:0,transition:"opacity 0.2s ease-in-out"},children:l.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,animation:"wardPulseLoop 2.5s infinite ease-in-out"},children:l.jsxs("svg",{viewBox:"0 0 100 120",preserveAspectRatio:"none",style:{width:"100%",height:"100%"},children:[l.jsx("defs",{children:l.jsxs("filter",{id:"wardGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[l.jsx("feGaussianBlur",{stdDeviation:"2",result:"blur"}),l.jsxs("feMerge",{children:[l.jsx("feMergeNode",{in:"blur"}),l.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),l.jsx("path",{d:"M50 2 L96 20 V60 C96 90 50 116 50 116 C50 116 4 90 4 60 V20 Z",fill:"rgba(255, 255, 255, 0.12)",stroke:"#ECC94B",strokeWidth:"3",filter:"url(#wardGlow)"})]})})}),a&&l.jsxs("div",{style:{position:"absolute",top:-5*f,left:-5*f,right:-5*f,bottom:-5*f,zIndex:21,pointerEvents:"none",opacity:y&&!S&&!d?1:0,transition:"opacity 0.2s ease-in-out"},children:[l.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,borderRadius:"50%",background:"radial-gradient(ellipse at center, rgba(99, 179, 237, 0.12) 0%, transparent 60%)",animation:"barrierGlowLoop 3s infinite ease-in-out"}}),l.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,borderRadius:"50%",border:`${Math.max(1.5,2*f)}px solid rgba(99, 179, 237, 0.9)`,boxShadow:"0 0 6px rgba(66, 153, 225, 0.5), inset 0 0 8px rgba(99, 179, 237, 0.15)",animation:"barrierPulseLoop 3s infinite ease-in-out"}})]}),a&&l.jsx("div",{style:{position:"absolute",top:-6*f,left:-6*f,right:-6*f,bottom:-6*f,zIndex:22,pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center",opacity:T&&!S&&!d?1:0,transition:"opacity 0.2s ease-in-out"},children:l.jsx("div",{style:{width:"100%",height:"100%",position:"relative",animation:"auraPulseLoop 3s infinite ease-in-out"},children:l.jsxs("svg",{viewBox:"0 0 100 100",style:{width:"100%",height:"100%"},children:[l.jsx("defs",{children:l.jsxs("filter",{id:"auraGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[l.jsx("feGaussianBlur",{stdDeviation:"1.5",result:"blur"}),l.jsxs("feMerge",{children:[l.jsx("feMergeNode",{in:"blur"}),l.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),l.jsx("path",{d:"M40 5 L60 5 L60 30 L95 30 L95 45 L60 45 L60 95 L40 95 L40 45 L5 45 L5 30 L40 30 Z",fill:"rgba(255, 204, 0, 0.2)",stroke:"#f6ad55",strokeWidth:"2.5",filter:"url(#auraGlow)"})]})})}),a&&l.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:13,pointerEvents:"none",overflow:"hidden",borderRadius:"0 0 8px 8px",opacity:C&&!S&&!d?1:0,transition:"opacity 0.2s ease-in-out"},children:[l.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:"120%",height:"120%",transform:"translate(-50%, -50%)",background:"radial-gradient(circle, rgba(0, 0, 0, 0.9) 0%, rgba(0, 0, 0, 0.6) 30%, rgba(0, 0, 0, 0.2) 60%, transparent 80%)",filter:"blur(10px)",animation:"stealthInkMove 3s infinite ease-in-out",mixBlendMode:"multiply"}}),l.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:"100%",height:"100%",transform:"translate(-50%, -50%)",background:"radial-gradient(circle, rgba(20, 20, 30, 0.85) 0%, rgba(10, 10, 20, 0.4) 40%, transparent 70%)",filter:"blur(8px)",animation:"stealthInkPulse 1.5s infinite ease-in-out",mixBlendMode:"multiply"}}),l.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:"70%",height:"70%",transform:"translate(-50%, -50%)",background:"radial-gradient(circle, rgba(255, 255, 255, 0.4) 0%, rgba(200, 200, 200, 0.25) 30%, transparent 60%)",filter:"blur(8px)",animation:"stealthMistMove 4s infinite ease-in-out",mixBlendMode:"screen"}}),l.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,boxShadow:"inset 0 0 30px rgba(0, 0, 0, 0.85), 0 0 20px rgba(0, 0, 0, 0.6)",animation:"stealthPulse 1.5s infinite ease-in-out"}})]})]}),S&&l.jsx("div",{style:{position:"absolute",inset:0,borderRadius:8,background:"radial-gradient(circle, rgba(255,255,255,0.8) 0%, transparent 70%)",mixBlendMode:"overlay",animation:"cardSummonFlash 0.8s ease-out forwards",pointerEvents:"none",zIndex:100}}),l.jsx("style",{children:`
                @keyframes cardSummonAppear {
                    0% { opacity: 0; transform: scale(1.5); filter: brightness(2) blur(4px); }
                    100% { opacity: 1; transform: scale(1); filter: brightness(1) blur(0px); }
                }
                @keyframes cardSummonFlash {
                    0% { opacity: 0.8; transform: scale(1.2); }
                    100% { opacity: 0; transform: scale(1); }
                }
                @keyframes wardPulseLoop {
                    0% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(255, 255, 255, 0.5)); }
                    50% { transform: scale(1.08); opacity: 0.5; filter: blur(3px) drop-shadow(0 0 15px rgba(255, 255, 255, 0.8)); }
                    100% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(255, 255, 255, 0.5)); }
                }
                @keyframes barrierPulseLoop {
                    0% { transform: scale(1); opacity: 1; box-shadow: 0 0 8px rgba(66, 153, 225, 0.6), inset 0 0 10px rgba(99, 179, 237, 0.2); }
                    50% { transform: scale(1.03); opacity: 0.85; box-shadow: 0 0 12px rgba(99, 179, 237, 0.8), inset 0 0 15px rgba(99, 179, 237, 0.3); }
                    100% { transform: scale(1); opacity: 1; box-shadow: 0 0 8px rgba(66, 153, 225, 0.6), inset 0 0 10px rgba(99, 179, 237, 0.2); }
                }
                @keyframes barrierGlowLoop {
                    0% { transform: scale(1); opacity: 0.6; }
                    50% { transform: scale(1.05); opacity: 0.4; }
                    100% { transform: scale(1); opacity: 0.6; }
                }
                @keyframes auraPulseLoop {
                    0% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(246, 173, 85, 0.5)); }
                    50% { transform: scale(1.12); opacity: 0.4; filter: blur(4px) drop-shadow(0 0 20px rgba(255, 204, 0, 0.8)); }
                    100% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(246, 173, 85, 0.5)); }
                }
                @keyframes stealthInkMove {
                    0%, 100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 0.7; }
                    25% { transform: translate(-45%, -55%) scale(1.15) rotate(3deg); opacity: 1; }
                    50% { transform: translate(-50%, -50%) scale(0.95) rotate(0deg); opacity: 0.5; }
                    75% { transform: translate(-55%, -45%) scale(1.1) rotate(-3deg); opacity: 0.9; }
                }
                @keyframes stealthInkPulse {
                    0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.8; }
                    50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.4; }
                }
                @keyframes stealthMistMove {
                    0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.5; }
                    25% { transform: translate(-48%, -52%) scale(1.1); opacity: 0.8; }
                    50% { transform: translate(-52%, -48%) scale(1.2); opacity: 0.3; }
                    75% { transform: translate(-50%, -50%) scale(0.9); opacity: 0.7; }
                }
                @keyframes stealthPulse {
                    0%, 100% { opacity: 0.6; box-shadow: inset 0 0 50px rgba(0, 0, 0, 0.9), 0 0 30px rgba(0, 0, 0, 0.7); }
                    50% { opacity: 1; box-shadow: inset 0 0 70px rgba(0, 0, 0, 1), 0 0 40px rgba(0, 0, 0, 0.9); }
                }
                /* 3D flip support - ensure all child elements inherit backface-visibility */
                .card, .card * {
                    backface-visibility: hidden !important;
                    -webkit-backface-visibility: hidden !important;
                }
            `})]})},WO=35e5;function PS(){const[t,e]=F.useState(()=>u_());return F.useEffect(()=>{const n=()=>{e(u_())};return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),t}function u_(){const t=window.innerWidth*window.devicePixelRatio,e=window.innerHeight*window.devicePixelRatio,n=t*e,r=n>WO;let s="HD";return n>8e6?s="4K":n>35e5?s="1440p":n>2e6&&(s="1080p"),{isHighRes:r,isLightMode:r,pixelCount:n,resolution:s}}function GO(t){return t?{glowShadow:(e,n)=>`0 0 ${10*n}px ${e}`,blurAmount:4,enableGlowPulse:!1,dropShadow:e=>`drop-shadow(0 0 ${10*e}px rgba(255,255,255,0.6))`}:{glowShadow:(e,n)=>`
            0 0 ${15*n}px ${e},
            0 0 ${30*n}px ${e}80,
            0 0 ${60*n}px ${e}50
        `,blurAmount:8,enableGlowPulse:!0,dropShadow:e=>`drop-shadow(0 0 ${20*e}px rgba(255,255,255,0.8)) drop-shadow(0 0 ${40*e}px rgba(255,255,255,0.6))`}}const iu=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},Lc=t=>iu(t==="YORUKA"?"/leaders/yoRuka_leader.png":t==="AJA"?"/leaders/azya_leader.png":"/leaders/senka_leader.png"),VO=iu("/assets/VS.png"),Kn=8,dh=240,YO=({myPlayer:t,opponentPlayer:e,isFirstPlayer:n,onComplete:r,scale:s=1,onVsImpact:i,onCoinToss:o,onImpact:a,onOrbLand:c,onFadeInBoard:u,isMobile:d=!1})=>{const[h,f]=F.useState("fade-in"),[E,k]=F.useState(!1),{isLightMode:P}=PS(),G=GO(P),[x,S]=F.useState(1),[w,p]=F.useState(1),[b,H]=F.useState(0),[re,K]=F.useState(0),[Q,ce]=F.useState(1),[me,Se]=F.useState({myX:0,myY:0,opX:0,opY:0}),[de,B]=F.useState(0),[O,T]=F.useState(0),[C,y]=F.useState([]),g=F.useMemo(()=>{const X=window.innerWidth,Pe=window.innerHeight,Ie=s,Ye=(d?280:340)*Ie,Ae=X-Ye,Fe=Ye+Ae/2,Et=Fe,it=Pe- -20*Ie-dh*Ie/2,lt=Fe,Ze=-20*Ie+dh*Ie/2;return{player:{x:Et,y:it},opponent:{x:lt,y:Ze},leaderSize:dh*Ie}},[d,s]),I=F.useMemo(()=>{const X=window.innerWidth,Pe=window.innerHeight,Ie=X*.25,Ye=Pe*.5,Ae=X*.75,Fe=Pe*.5;return{myX:Ie,myY:Ye,opX:Ae,opY:Fe}},[]),A=P?`0 0 ${10*s}px rgba(103, 232, 249, 0.8)`:`0 0 ${15*s}px rgba(103, 232, 249, 1), 0 0 ${30*s}px rgba(34, 211, 238, 0.8), 0 0 ${60*s}px rgba(6, 182, 212, 0.5)`,L=P?`0 0 ${10*s}px rgba(249, 168, 212, 0.8)`:`0 0 ${15*s}px rgba(249, 168, 212, 1), 0 0 ${30*s}px rgba(244, 114, 182, 0.8), 0 0 ${60*s}px rgba(236, 72, 153, 0.5)`,j=G.enableGlowPulse?"glowPulse 2s ease-in-out infinite":"none";F.useEffect(()=>{const X={"fade-in":500,"leaders-enter":1200,nameplate:800,"vs-display":1500,"coin-toss":1500,"turn-order":1e3,"leader-to-orb":800,"orb-pause":1e3,"orb-fly":900,"leader-appear":600};if(h==="complete"){u==null||u();const Ye=setTimeout(()=>{r()},700);return()=>clearTimeout(Ye)}const Pe={"fade-in":"leaders-enter","leaders-enter":"nameplate",nameplate:"vs-display","vs-display":"coin-toss","coin-toss":"turn-order","turn-order":"leader-to-orb","leader-to-orb":"orb-pause","orb-pause":"orb-fly","orb-fly":"leader-appear","leader-appear":"complete"},Ie=setTimeout(()=>{const Ye=Pe[h];Ye&&f(Ye)},X[h]||1e3);return()=>clearTimeout(Ie)},[h,r,n]),F.useEffect(()=>{if(h==="vs-display"){const X=setTimeout(()=>{k(!0),i==null||i(),setTimeout(()=>k(!1),300)},800);return()=>clearTimeout(X)}},[h,i]),F.useEffect(()=>{h==="coin-toss"&&(o==null||o())},[h,o]),F.useEffect(()=>{if(h==="leaders-enter"){const X=setTimeout(()=>{a==null||a()},1e3);return()=>clearTimeout(X)}},[h,a]),F.useEffect(()=>{h==="nameplate"&&(a==null||a())},[h,a]),F.useEffect(()=>{if(h==="leader-to-orb"){const Pe=Date.now();let Ie;const Ye=()=>{const Ae=Date.now()-Pe,Fe=Math.min(Ae/800,1),Et=1-Math.pow(1-Fe,3);S(1-Et*.7),p(1-Et),H(Et*1.5),K(Math.min(Et*1.5,1)),Fe<1&&(Ie=requestAnimationFrame(Ye))};return Se(I),Ie=requestAnimationFrame(Ye),()=>cancelAnimationFrame(Ie)}},[h,I]),F.useEffect(()=>{if(h==="orb-pause"){const Pe=Date.now();let Ie;const Ye=()=>{const Ae=Date.now()-Pe,Fe=Math.min(Ae/800,1);ce(1-Fe),Fe<1&&(Ie=requestAnimationFrame(Ye))};return Ie=requestAnimationFrame(Ye),()=>cancelAnimationFrame(Ie)}},[h]),F.useEffect(()=>{if(h==="orb-fly"){const Pe=Date.now();let Ie;const Ye=I.myX,Ae=I.myY,Fe=I.opX,Et=I.opY,it=g.player.x,lt=g.player.y,Ze=g.opponent.x,$e=g.opponent.y,ot=()=>{const bt=Date.now()-Pe,$t=Math.min(bt/900,1),Xe=$t*$t*$t,ln=Ye-200*s,dt=(Ae+lt)/2+100*s,vn=(1-Xe)*(1-Xe)*Ye+2*(1-Xe)*Xe*ln+Xe*Xe*it,Wt=(1-Xe)*(1-Xe)*Ae+2*(1-Xe)*Xe*dt+Xe*Xe*lt,ji=Fe+200*s,Bd=(Et+$e)/2-100*s,zd=(1-Xe)*(1-Xe)*Fe+2*(1-Xe)*Xe*ji+Xe*Xe*Ze,is=(1-Xe)*(1-Xe)*Et+2*(1-Xe)*Xe*Bd+Xe*Xe*$e;Se({myX:vn,myY:Wt,opX:zd,opY:is}),H(1.5-Xe*1),$t<1&&(Ie=requestAnimationFrame(ot))};return Ie=requestAnimationFrame(ot),()=>cancelAnimationFrame(Ie)}},[h,I,g,s]),F.useEffect(()=>{if(h==="leader-appear"){const Pe=Date.now();let Ie;c==null||c(),k(!0),setTimeout(()=>k(!1),300);const Ye=g.player.x,Ae=g.player.y,Fe=g.opponent.x,Et=g.opponent.y,it=24,lt=[];for(let ot=0;ot<it;ot++){const bt=ot/it*360+(Math.random()-.5)*15;lt.push({id:ot,x:Ye,y:Ae,angle:bt,dist:80+Math.random()*120,size:8+Math.random()*12,delay:Math.random()*.1,color:`hsl(${200+Math.random()*40}, 80%, ${60+Math.random()*20}%)`})}for(let ot=0;ot<it;ot++){const bt=ot/it*360+(Math.random()-.5)*15;lt.push({id:it+ot,x:Fe,y:Et,angle:bt,dist:80+Math.random()*120,size:8+Math.random()*12,delay:Math.random()*.1,color:`hsl(${0+Math.random()*30}, 80%, ${55+Math.random()*20}%)`})}y(lt);const Ze=setTimeout(()=>{y([])},800),$e=()=>{const ot=Date.now()-Pe,bt=Math.min(ot/600,1),$t=1-Math.pow(1-bt,3);K(1-$t),B($t),T($t),bt<1&&(Ie=requestAnimationFrame($e))};return Ie=requestAnimationFrame($e),()=>{cancelAnimationFrame(Ie),clearTimeout(Ze)}}},[h,c,g]);const N=["fade-in","leaders-enter","nameplate","vs-display","coin-toss","turn-order","leader-to-orb","orb-pause","orb-fly","leader-appear","complete"].indexOf(h),pe=N>=3&&N<=9,we=N>=0&&N<=7,ke=`polygon(0 0, ${50+Kn}% 0, ${50-Kn}% 100%, 0 100%)`,ee=`polygon(${50+Kn}% 0, 100% 0, 100% 100%, ${50-Kn}% 100%)`;return l.jsxs("div",{style:{position:"fixed",inset:0,background:N>=7?"transparent":"#0a0a0f",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",animation:E?"screenShake 0.3s ease-in-out":void 0,pointerEvents:N>=9?"none":"auto"},children:[l.jsx("div",{style:{position:"absolute",inset:0,background:"black",opacity:h==="fade-in"?1:0,transition:"opacity 0.5s ease-out",pointerEvents:"none",zIndex:1e4}}),we&&l.jsxs("div",{style:{opacity:Q,transition:"opacity 0.3s"},children:[N>=0&&l.jsxs("div",{style:{position:"absolute",inset:0,clipPath:ke,background:"linear-gradient(135deg, #0a1628 0%, #1a2a4a 50%, #0d1a30 100%)",transform:`translateX(${N>=1?"0":"-100%"})`,transition:"transform 1.2s cubic-bezier(0.22, 1, 0.36, 1)",zIndex:50,overflow:"hidden"},children:[l.jsx("div",{style:{position:"fixed",top:"50%",left:"25%",transform:"translate(-50%, -50%)",opacity:w},children:l.jsx("img",{src:Lc(t.class),alt:t.name,style:{height:"120vh",width:"auto",objectFit:"cover",objectPosition:t.class==="AJA"?"center top":"center",filter:"brightness(0.85) contrast(1.1)",transform:`scale(${x})`,transformOrigin:"center center"}})}),l.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(135deg, rgba(59, 130, 246, 0.3) 0%, transparent 60%)",pointerEvents:"none"}}),N>=2&&N<6&&l.jsx("div",{style:{position:"absolute",bottom:"12%",left:"15%",padding:`${16*s}px ${40*s}px`,background:"rgba(0,0,0,0.85)",borderRadius:8*s,borderLeft:"4px solid #3b82f6",animation:"nameplateSlideUp 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)",whiteSpace:"nowrap",boxShadow:"0 4px 30px rgba(59, 130, 246, 0.4)"},children:l.jsx("div",{style:{color:"white",fontSize:2.2*s+"rem",fontWeight:"bold",textShadow:"0 0 20px rgba(59, 130, 246, 0.8)"},children:t.name})}),N>=5&&N<6&&l.jsx("div",{style:{position:"absolute",top:"10%",left:"15%",padding:`${12*s}px ${32*s}px`,background:n?"rgba(239, 68, 68, 0.9)":"rgba(59, 130, 246, 0.9)",borderRadius:8*s,animation:"turnOrderFadeIn 1s ease-out",boxShadow:n?"0 0 30px rgba(239, 68, 68, 0.6)":"0 0 30px rgba(59, 130, 246, 0.6)"},children:l.jsx("div",{style:{color:"white",fontSize:1.8*s+"rem",fontWeight:"bold",letterSpacing:"0.1em"},children:n?"":""})})]}),N>=0&&l.jsxs("div",{style:{position:"absolute",inset:0,clipPath:ee,background:"linear-gradient(225deg, #280a0a 0%, #4a1a1a 50%, #300d0d 100%)",transform:`translateX(${N>=1?"0":"100%"})`,transition:"transform 1.2s cubic-bezier(0.22, 1, 0.36, 1)",zIndex:50,overflow:"hidden"},children:[l.jsx("div",{style:{position:"fixed",top:"50%",left:"75%",transform:"translate(-50%, -50%)",opacity:w},children:l.jsx("img",{src:Lc(e.class),alt:e.name,style:{height:"120vh",width:"auto",objectFit:"cover",objectPosition:e.class==="AJA"?"center top":"center",filter:"brightness(0.85) contrast(1.1)",transform:`scale(${x})`,transformOrigin:"center center"}})}),l.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(225deg, rgba(239, 68, 68, 0.3) 0%, transparent 60%)",pointerEvents:"none"}}),N>=2&&N<6&&l.jsx("div",{style:{position:"absolute",bottom:"12%",right:"15%",padding:`${16*s}px ${40*s}px`,background:"rgba(0,0,0,0.85)",borderRadius:8*s,borderRight:"4px solid #ef4444",animation:"nameplateSlideUp 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)",whiteSpace:"nowrap",boxShadow:"0 4px 30px rgba(239, 68, 68, 0.4)"},children:l.jsx("div",{style:{color:"white",fontSize:2.2*s+"rem",fontWeight:"bold",textShadow:"0 0 20px rgba(239, 68, 68, 0.8)"},children:e.name})}),N>=5&&N<6&&l.jsx("div",{style:{position:"absolute",top:"10%",right:"15%",padding:`${12*s}px ${32*s}px`,background:n?"rgba(59, 130, 246, 0.9)":"rgba(239, 68, 68, 0.9)",borderRadius:8*s,animation:"turnOrderFadeIn 1s ease-out",boxShadow:n?"0 0 30px rgba(59, 130, 246, 0.6)":"0 0 30px rgba(239, 68, 68, 0.6)"},children:l.jsx("div",{style:{color:"white",fontSize:1.8*s+"rem",fontWeight:"bold",letterSpacing:"0.1em"},children:n?"":""})})]}),N>=1&&l.jsxs(l.Fragment,{children:[l.jsx("div",{style:{position:"absolute",top:0,left:0,width:4*s,height:"100%",background:"linear-gradient(180deg, #67e8f9 0%, #22d3ee 30%, #06b6d4 50%, #22d3ee 70%, #67e8f9 100%)",boxShadow:A,zIndex:100,animation:j}}),l.jsx("div",{style:{position:"absolute",top:0,left:0,width:`calc(${50+Kn}% + ${2*s}px)`,height:4*s,background:"linear-gradient(90deg, #67e8f9 0%, #22d3ee 30%, #06b6d4 50%, #22d3ee 70%, #67e8f9 100%)",boxShadow:A,zIndex:100,animation:j}}),l.jsx("div",{style:{position:"absolute",bottom:0,left:0,width:`calc(${50-Kn}% + ${2*s}px)`,height:4*s,background:"linear-gradient(90deg, #67e8f9 0%, #22d3ee 30%, #06b6d4 50%, #22d3ee 70%, #67e8f9 100%)",boxShadow:A,zIndex:100,animation:j}}),l.jsxs("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:100,pointerEvents:"none",overflow:"visible"},children:[l.jsxs("defs",{children:[l.jsxs("linearGradient",{id:"cyanGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[l.jsx("stop",{offset:"0%",stopColor:"#67e8f9"}),l.jsx("stop",{offset:"30%",stopColor:"#22d3ee"}),l.jsx("stop",{offset:"50%",stopColor:"#06b6d4"}),l.jsx("stop",{offset:"70%",stopColor:"#22d3ee"}),l.jsx("stop",{offset:"100%",stopColor:"#67e8f9"})]}),l.jsxs("filter",{id:"cyanGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[l.jsx("feGaussianBlur",{stdDeviation:G.blurAmount,result:"blur"}),l.jsxs("feMerge",{children:[l.jsx("feMergeNode",{in:"blur"}),l.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),l.jsx("line",{x1:`${50+Kn-.2}%`,y1:"0",x2:`${50-Kn-.2}%`,y2:"100%",stroke:"url(#cyanGradient)",strokeWidth:4*s,filter:P?void 0:"url(#cyanGlow)",style:{animation:j}})]})]}),N>=1&&l.jsxs(l.Fragment,{children:[l.jsx("div",{style:{position:"absolute",top:0,right:0,width:4*s,height:"100%",background:"linear-gradient(180deg, #f9a8d4 0%, #f472b6 30%, #ec4899 50%, #f472b6 70%, #f9a8d4 100%)",boxShadow:L,zIndex:100,animation:j,animationDelay:"0.3s"}}),l.jsx("div",{style:{position:"absolute",top:0,right:0,width:`calc(${50-Kn}% + ${2*s}px)`,height:4*s,background:"linear-gradient(90deg, #f9a8d4 0%, #f472b6 30%, #ec4899 50%, #f472b6 70%, #f9a8d4 100%)",boxShadow:L,zIndex:100,animation:j,animationDelay:"0.3s"}}),l.jsx("div",{style:{position:"absolute",bottom:0,right:0,width:`calc(${50+Kn}% + ${2*s}px)`,height:4*s,background:"linear-gradient(90deg, #f9a8d4 0%, #f472b6 30%, #ec4899 50%, #f472b6 70%, #f9a8d4 100%)",boxShadow:L,zIndex:100,animation:j,animationDelay:"0.3s"}}),l.jsxs("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:100,pointerEvents:"none",overflow:"visible"},children:[l.jsxs("defs",{children:[l.jsxs("linearGradient",{id:"pinkGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[l.jsx("stop",{offset:"0%",stopColor:"#f9a8d4"}),l.jsx("stop",{offset:"30%",stopColor:"#f472b6"}),l.jsx("stop",{offset:"50%",stopColor:"#ec4899"}),l.jsx("stop",{offset:"70%",stopColor:"#f472b6"}),l.jsx("stop",{offset:"100%",stopColor:"#f9a8d4"})]}),l.jsxs("filter",{id:"pinkGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[l.jsx("feGaussianBlur",{stdDeviation:G.blurAmount,result:"blur"}),l.jsxs("feMerge",{children:[l.jsx("feMergeNode",{in:"blur"}),l.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),l.jsx("line",{x1:`${50+Kn+.2}%`,y1:"0",x2:`${50-Kn+.2}%`,y2:"100%",stroke:"url(#pinkGradient)",strokeWidth:4*s,filter:P?void 0:"url(#pinkGlow)",style:{animation:j,animationDelay:"0.3s"}})]})]})]}),N>=6&&N<=9&&l.jsxs(l.Fragment,{children:[l.jsx("div",{style:{position:"fixed",left:me.myX,top:me.myY,transform:`translate(-50%, -50%) scale(${b})`,opacity:re,width:150*s,height:150*s,borderRadius:"50%",background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(100,180,255,0.8) 40%, rgba(59,130,246,0.4) 70%, transparent 100%)",boxShadow:P?`0 0 ${30*s}px rgba(59, 130, 246, 0.8)`:`0 0 ${40*s}px rgba(255,255,255,0.9), 0 0 ${80*s}px rgba(59, 130, 246, 0.8), 0 0 ${120*s}px rgba(59, 130, 246, 0.5)`,zIndex:500,pointerEvents:"none"}}),l.jsx("div",{style:{position:"fixed",left:me.opX,top:me.opY,transform:`translate(-50%, -50%) scale(${b})`,opacity:re,width:150*s,height:150*s,borderRadius:"50%",background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(255,150,150,0.8) 40%, rgba(239,68,68,0.4) 70%, transparent 100%)",boxShadow:P?`0 0 ${30*s}px rgba(239, 68, 68, 0.8)`:`0 0 ${40*s}px rgba(255,255,255,0.9), 0 0 ${80*s}px rgba(239, 68, 68, 0.8), 0 0 ${120*s}px rgba(239, 68, 68, 0.5)`,zIndex:500,pointerEvents:"none"}})]}),N>=9&&l.jsxs(l.Fragment,{children:[l.jsx("div",{style:{position:"fixed",left:g.player.x,top:g.player.y,transform:`translate(-50%, -50%) scale(${de})`,opacity:O,width:g.leaderSize,height:g.leaderSize,borderRadius:"50%",overflow:"hidden",border:"4px solid #3182ce",boxShadow:"0 0 20px rgba(49, 130, 206, 0.4)",background:"#1a202c",zIndex:500,pointerEvents:"none"},children:l.jsx("img",{src:Lc(t.class),alt:t.name,style:{width:"100%",height:"100%",objectFit:"cover",objectPosition:t.class==="AJA"?"center top":"center"}})}),l.jsx("div",{style:{position:"fixed",left:g.opponent.x,top:g.opponent.y,transform:`translate(-50%, -50%) scale(${de})`,opacity:O,width:g.leaderSize,height:g.leaderSize,borderRadius:"50%",overflow:"hidden",border:"4px solid #c53030",boxShadow:"0 0 20px rgba(197, 48, 48, 0.4)",background:"#1a202c",zIndex:500,pointerEvents:"none"},children:l.jsx("img",{src:Lc(e.class),alt:e.name,style:{width:"100%",height:"100%",objectFit:"cover",objectPosition:e.class==="AJA"?"center top":"center"}})})]}),C.map(X=>l.jsx("div",{style:{position:"fixed",left:X.x,top:X.y,width:X.size*s,height:X.size*s,borderRadius:"50%",background:X.color,boxShadow:`0 0 ${X.size*.5*s}px ${X.color}`,pointerEvents:"none",zIndex:600,animation:`landingParticleBurst 0.6s ease-out ${X.delay}s forwards`,transform:"translate(-50%, -50%)","--particle-angle":`${X.angle}deg`,"--particle-dist":`${X.dist*s}px`}},X.id)),pe&&l.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",animation:N===3?"vsZoomIn 1.5s cubic-bezier(0.34, 1.56, 0.64, 1)":void 0,opacity:N>=7?Math.max(0,Q):1,zIndex:200,pointerEvents:"none"},children:l.jsx("img",{src:VO,alt:"VS",style:{height:300*s,width:"auto",filter:`drop-shadow(0 0 ${20*s}px rgba(255,255,255,0.8)) drop-shadow(0 0 ${40*s}px rgba(255,255,255,0.6))`}})}),N>=4&&N<5&&l.jsx("div",{style:{position:"absolute",top:"20%",left:"50%",transform:"translate(-50%, -50%)",zIndex:150},children:l.jsx("div",{style:{width:100*s,height:100*s,borderRadius:"50%",background:"linear-gradient(45deg, #f6ad55 0%, #fbd38d 100%)",border:"4px solid white",display:"flex",alignItems:"center",justifyContent:"center",fontSize:2*s+"rem",fontWeight:"bold",color:"white",animation:"coinFlip 1.5s ease-in-out",boxShadow:`0 0 ${30*s}px rgba(246, 173, 85, 0.8)`},children:""})}),l.jsx("style",{children:`
                @keyframes screenShake {
                    0%, 100% { transform: translate(0, 0); }
                    10% { transform: translate(-10px, -10px); }
                    20% { transform: translate(10px, 10px); }
                    30% { transform: translate(-10px, 10px); }
                    40% { transform: translate(10px, -10px); }
                    50% { transform: translate(-10px, -10px); }
                    60% { transform: translate(10px, 10px); }
                    70% { transform: translate(-10px, 10px); }
                    80% { transform: translate(10px, -10px); }
                    90% { transform: translate(-10px, 0); }
                }

                @keyframes nameplateSlideUp {
                    0% {
                        transform: translateY(50px);
                        opacity: 0;
                    }
                    60% {
                        transform: translateY(-10px);
                    }
                    100% {
                        transform: translateY(0);
                        opacity: 1;
                    }
                }

                @keyframes vsZoomIn {
                    0% {
                        transform: translate(-50%, -50%) scale(3) translateZ(0);
                        opacity: 0;
                        filter: blur(20px);
                    }
                    50% {
                        transform: translate(-50%, -50%) scale(1.2) translateZ(0);
                        opacity: 1;
                        filter: blur(0px);
                    }
                    100% {
                        transform: translate(-50%, -50%) scale(1) translateZ(0);
                        opacity: 1;
                        filter: blur(0px);
                    }
                }

                @keyframes coinFlip {
                    0% {
                        transform: rotateY(0deg) scale(1);
                    }
                    50% {
                        transform: rotateY(1800deg) scale(1.2);
                    }
                    100% {
                        transform: rotateY(3600deg) scale(1);
                    }
                }

                @keyframes turnOrderFadeIn {
                    0% {
                        opacity: 0;
                        transform: scale(0.5);
                    }
                    50% {
                        transform: scale(1.2);
                    }
                    100% {
                        opacity: 1;
                        transform: scale(1);
                    }
                }

                @keyframes glowPulse {
                    0%, 100% {
                        opacity: 0.8;
                        filter: brightness(1);
                    }
                    50% {
                        opacity: 1;
                        filter: brightness(1.3);
                    }
                }

                @keyframes landingParticleBurst {
                    0% {
                        transform: translate(-50%, -50%) rotate(var(--particle-angle)) translateX(0);
                        opacity: 1;
                    }
                    100% {
                        transform: translate(-50%, -50%) rotate(var(--particle-angle)) translateX(var(--particle-dist));
                        opacity: 0;
                    }
                }
            `})]})},KO=({isVictory:t,loserLeaderRef:e,onComplete:n,onPhaseChange:r,onShakeIntensityChange:s,scale:i=1})=>{const[o,a]=F.useState("start"),[c,u]=F.useState(null),[d,h]=F.useState([]);F.useEffect(()=>{if(e.current){const E=e.current.getBoundingClientRect();u({x:E.left+E.width/2,y:E.top+E.height/2,size:E.width})}},[e]),F.useEffect(()=>{r==null||r(o)},[o,r]),F.useEffect(()=>{const E={start:200,zoom:600,"white-fade":800,explode:1200,"result-text":1800,"fade-out":600};if(o==="complete"){n();return}const k={start:"zoom",zoom:"white-fade","white-fade":"explode",explode:"result-text","result-text":"fade-out","fade-out":"complete"},P=setTimeout(()=>{const G=k[o];G&&a(G)},E[o]||1e3);return()=>clearTimeout(P)},[o,n]),F.useEffect(()=>{if(o==="explode"&&c){const k=Array.from({length:60},(S,w)=>{const p=w/60*360,b=(Math.random()-.5)*12,H=p+b,re=150+Math.random()*250,K=12+Math.random()*20;return{id:w,x:c.x,y:c.y,angle:H,distance:re,size:K,delay:Math.random()*.1,duration:.6+Math.random()*.4}});h(k),s==null||s(1);const P=1e3,G=Date.now(),x=setInterval(()=>{const w=(Date.now()-G)/P;if(w>=1)s==null||s(0),clearInterval(x);else{const p=1-Math.pow(w,2);s==null||s(p)}},16);return()=>clearInterval(x)}},[o,c,s]);const f=["start","zoom","white-fade","explode","result-text","fade-out","complete"].indexOf(o);return c?l.jsxs("div",{style:{position:"fixed",inset:0,zIndex:8e3,pointerEvents:"none",overflow:"hidden"},children:[l.jsx("div",{style:{position:"absolute",inset:0,background:"black",opacity:f>=1?f>=5?1:.5:0,transition:"opacity 0.5s ease-out"}}),f>=1&&f<4&&l.jsx("div",{style:{position:"absolute",left:c.x,top:c.y,transform:"translate(-50%, -50%)",width:c.size*1.8,height:c.size*1.8,borderRadius:"50%",background:"radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 60%)",transition:"all 0.4s ease-out"}}),f>=3&&d.map(E=>l.jsx("div",{style:{position:"absolute",left:E.x,top:E.y,width:E.size*i,height:E.size*i,borderRadius:"50%",background:"white",boxShadow:"0 0 15px white, 0 0 30px rgba(255,255,255,0.5)",transform:"translate(-50%, -50%)",animation:`particleFly-${E.id} ${E.duration}s ease-out ${E.delay}s forwards`}},E.id)),f>=3&&l.jsx("style",{children:d.map(E=>{const k=E.angle*Math.PI/180,P=Math.cos(k)*E.distance,G=Math.sin(k)*E.distance;return`
                            @keyframes particleFly-${E.id} {
                                0% {
                                    transform: translate(-50%, -50%) scale(1);
                                    opacity: 1;
                                }
                                100% {
                                    transform: translate(calc(-50% + ${P}px), calc(-50% + ${G}px)) scale(0);
                                    opacity: 0;
                                }
                            }
                        `}).join(`
`)}),f>=4&&f<6&&l.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",animation:"resultTextPop 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)"},children:l.jsx("div",{style:{fontSize:`${7*i}rem`,fontWeight:900,fontFamily:"Tamanegi, sans-serif",color:t?"#ffd700":"#718096",textShadow:t?"0 0 30px rgba(255,215,0,0.8), 0 0 60px rgba(255,215,0,0.6), 0 0 90px rgba(255,215,0,0.4), 4px 4px 8px rgba(0,0,0,0.8)":"0 0 20px rgba(113,128,150,0.5), 4px 4px 8px rgba(0,0,0,0.8)",letterSpacing:"0.15em"},children:t?"":"..."})}),l.jsx("style",{children:`
                @keyframes resultTextPop {
                    0% {
                        transform: translate(-50%, -50%) scale(2.5);
                        opacity: 0;
                        filter: blur(20px);
                    }
                    60% {
                        transform: translate(-50%, -50%) scale(0.95);
                        opacity: 1;
                        filter: blur(0px);
                    }
                    100% {
                        transform: translate(-50%, -50%) scale(1);
                        opacity: 1;
                        filter: blur(0px);
                    }
                }
            `})]}):null},XO=({isMyTurn:t,turnCount:e,activePlayerId:n,onTimeUp:r,timerEnabled:s,isGameOver:i=!1,isPaused:o=!1,scale:a=1,buttonSize:c=160,timerDuration:u=60})=>{const[d,h]=F.useState(u),[f,E]=F.useState(!1),[k,P]=F.useState(!1),G=F.useRef(null),x=F.useRef(""),S=F.useRef(0),w=F.useRef(r),p=F.useRef(!1),b=F.useId().replace(/:/g,"_");F.useEffect(()=>{w.current=r},[r]);const H=`${e}-${n}`,re=F.useCallback(()=>{h(u),E(!1),P(!1),S.current=Date.now()+u*1e3,p.current=!1},[u]);if(F.useEffect(()=>{H!==x.current&&(x.current=H,re())},[H,re]),F.useEffect(()=>{if(!s||!t||i||o){G.current&&(clearInterval(G.current),G.current=null);return}return S.current===0&&(S.current=Date.now()+u*1e3),G.current=window.setInterval(()=>{const g=Date.now(),I=Math.max(0,(S.current-g)/1e3);h(I);const A=Math.ceil(I);A<=15&&A>10?(E(!0),P(!1)):A<=10?(E(!0),P(!0)):(E(!1),P(!1)),I<=0&&!p.current&&(p.current=!0,G.current&&(clearInterval(G.current),G.current=null),setTimeout(()=>w.current(),0))},16),()=>{G.current&&(clearInterval(G.current),G.current=null)}},[s,t,i,o,u]),!s||o)return null;const K=d/u,Q=(c/2+12)*a,ce=6*a,me=2*Math.PI*Q,Se=-me*(1-K),de=Math.ceil(d),B=k?Math.min(1,(10-de)/10):0,O=Math.max(.05,.15-B*.1);let T="#4299e1";f&&!k?T="#f6ad55":k&&(T="#e53e3e");const C=20*a,y=Q*2+ce+C*2;return l.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:y,height:y,pointerEvents:"none",zIndex:10,animation:k?`timerShake${b} ${O}s ease-in-out infinite`:void 0},children:[l.jsxs("svg",{width:y,height:y,style:{position:"absolute",top:0,left:0,overflow:"visible"},children:[l.jsx("circle",{cx:y/2,cy:y/2,r:Q,fill:"none",stroke:"rgba(0,0,0,0.3)",strokeWidth:ce}),l.jsx("circle",{cx:y/2,cy:y/2,r:Q,fill:"none",stroke:T,strokeWidth:ce,strokeLinecap:"round",strokeDasharray:me,strokeDashoffset:Se,style:{transform:"rotate(-90deg)",transformOrigin:"center"}}),f&&l.jsx("circle",{cx:y/2,cy:y/2,r:Q,fill:"none",stroke:T,strokeWidth:ce*3,opacity:.4,style:{filter:`blur(${12*a}px)`,animation:k?`timerPulse${b} 0.5s ease-in-out infinite`:`timerPulse${b} 1s ease-in-out infinite`}})]}),l.jsx("style",{children:`
                @keyframes timerPulse${b} {
                    0%, 100% { opacity: 0.4; }
                    50% { opacity: 0.7; }
                }
                @keyframes timerShake${b} {
                    0%, 100% { transform: translate(-50%, -50%) translate(0, 0); }
                    25% { transform: translate(-50%, -50%) translate(${2*a}px, ${-2*a}px); }
                    50% { transform: translate(-50%, -50%) translate(${-2*a}px, ${2*a}px); }
                    75% { transform: translate(-50%, -50%) translate(${2*a}px, ${1*a}px); }
                }
            `})]})};function QO(t,e){const[n,r]=F.useState(null),[s,i]=F.useState(""),[o,a]=F.useState(!1),[c,u]=F.useState(null),[d,h]=F.useState(!1);return F.useEffect(()=>{if(t==="CPU")return;const f=new AS;return h(!0),(async()=>{try{const k=await f.connect(t==="JOIN"?e:void 0);i(k),r(f),f.onConnection(()=>{console.log("[useGameNetwork] Connection established!"),a(!0),h(!1)})}catch(k){u(k.toString()),h(!1)}})(),()=>{f.disconnect()}},[t,e]),{adapter:n,myId:s,connected:o,connecting:d,error:c,setConnected:a}}function d_(t,e,n){return!(!t.canEvolveThisTurn||t.evolutionsUsed>=2||e<(n?5:4))}function f_(t,e,n){return!(!t.canEvolveThisTurn||t.sep<=0||e<(n?7:6))}const Je=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},JO=Je("/leaders/azya_leader.png"),qO=Je("/leaders/senka_leader.png"),ZO=Je("/leaders/yoRuka_leader.png"),eL=Je("/sleeves/azya_sleeve.png"),tL=Je("/sleeves/senka_sleeve.png"),nL=Je("/sleeves/yoruka_sleeve.png"),Va=t=>t==="YORUKA"?ZO:t==="AJA"?JO:qO,si=t=>t==="YORUKA"?nL:t==="AJA"?eL:tL,rL=1920,OS=1080,sL=()=>{const[t,e]=F.useState({scale:1,toGameX:r=>r,toGameY:r=>r}),n=F.useCallback(()=>{const r=window.visualViewport?window.visualViewport.width:window.innerWidth,s=window.visualViewport?window.visualViewport.height:window.innerHeight;let i=Math.min(r/rL,s/OS);i*=1.5,e({scale:i,toGameX:c=>c,toGameY:c=>c})},[]);return F.useEffect(()=>{n(),window.addEventListener("resize",n),window.addEventListener("orientationchange",()=>{setTimeout(n,150)}),window.visualViewport&&window.visualViewport.addEventListener("resize",n);const r=()=>{document.visibilityState==="visible"&&setTimeout(n,100)};return document.addEventListener("visibilitychange",r),()=>{window.removeEventListener("resize",n),window.removeEventListener("orientationchange",n),window.visualViewport&&window.visualViewport.removeEventListener("resize",n),document.removeEventListener("visibilitychange",r)}},[n]),t},rn=90,En=120,ii=rn+18,Qi=240,iL=({x:t,y:e,onComplete:n,scale:r=1})=>{M.useEffect(()=>{const i=setTimeout(n,2e3);return()=>clearTimeout(i)},[n]);const s=M.useMemo(()=>Array(20).fill(0).map((i,o)=>({id:o,angle:Math.random()*360,dist:(30+Math.random()*60)*r,size:(10+Math.random()*15)*r,delay:Math.random()*.5})),[r]);return l.jsxs("div",{style:{position:"absolute",left:t,top:e,pointerEvents:"none",zIndex:6e3},children:[l.jsx("style",{children:`
                @keyframes healGlowFade {
                    0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; filter: blur(10px); }
                    30% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.8; filter: blur(15px); }
                    100% { transform: translate(-50%, -50%) scale(1.6); opacity: 0; filter: blur(30px); }
                }
                @keyframes healParticleRise {
                    0% { transform: translate(-50%, -50%) rotate(var(--angle)) translate(0, 0) scale(0); opacity: 0; }
                    20% { transform: translate(-50%, -50%) rotate(var(--angle)) translate(0, 0) opacity: 0.7; }
                    100% { transform: translate(-50%, -50%) rotate(var(--angle)) translate(calc(var(--dist) * 1px), 0) scale(1.5); opacity: 0; }
                }
            `}),l.jsx("div",{style:{position:"absolute",left:0,top:0,width:150*r,height:150*r,background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(200,255,240,0.5) 50%, transparent 80%)",borderRadius:"50%",transform:"translate(-50%, -50%)",animation:"healGlowFade 1.5s ease-out forwards",filter:`blur(${8*r}px)`}}),s.map(i=>l.jsx("div",{style:{position:"absolute",left:0,top:0,width:i.size,height:i.size,background:"rgba(255,250,240,0.6)",borderRadius:"50%",filter:`blur(${4*r}px)`,"--angle":`${i.angle}deg`,"--dist":i.dist,animation:`healParticleRise 1.2s ease-out ${i.delay}s forwards`,pointerEvents:"none"}},i.id))]})},oL=({x:t,y:e,atkBuff:n,hpBuff:r,onComplete:s})=>{M.useEffect(()=>{const E=setTimeout(s,1500);return()=>clearTimeout(E)},[s]);const i=n<0||r<0,o=i?"radial-gradient(circle, rgba(180,50,50,0.9) 0%, rgba(150,30,30,0.4) 50%, transparent 80%)":"radial-gradient(circle, rgba(255,230,100,0.9) 0%, rgba(255,200,50,0.4) 50%, transparent 80%)",a=i?"#ff4444":"#ffd93d",c="#ffd93d",u="rgba(255,217,61,0.8)",d=E=>E>=0?`+${E}`:`${E}`,h=80,f=110;return l.jsxs("div",{style:{position:"absolute",left:t,top:e,pointerEvents:"none",zIndex:6e3},children:[l.jsx("style",{children:`
                @keyframes buffGlow {
                    0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
                    30% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
                    100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
                }
                @keyframes buffNumberRise {
                    0% { transform: translateY(0); opacity: 0; }
                    20% { opacity: 1; }
                    100% { transform: translateY(-30px); opacity: 0; }
                }
                @keyframes buffSparkle {
                    0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
                    50% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
                    100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
                }
            `}),l.jsx("div",{style:{position:"absolute",left:0,top:0,width:150,height:150,background:o,borderRadius:"50%",transform:"translate(-50%, -50%)",animation:"buffGlow 1.2s ease-out forwards",filter:"blur(8px)"}}),n!==0&&l.jsx("div",{style:{position:"absolute",left:-h/2+12,top:f/2-20,fontSize:"24px",fontWeight:"bold",color:c,textShadow:`0 0 10px ${u}, 2px 2px 4px rgba(0,0,0,0.8)`,fontFamily:"Tamanegi, sans-serif",animation:"buffNumberRise 1.2s ease-out forwards",textAlign:"center"},children:d(n)}),r!==0&&l.jsx("div",{style:{position:"absolute",left:h/2-28,top:f/2-20,fontSize:"24px",fontWeight:"bold",color:c,textShadow:`0 0 10px ${u}, 2px 2px 4px rgba(0,0,0,0.8)`,fontFamily:"Tamanegi, sans-serif",animation:"buffNumberRise 1.2s ease-out forwards",textAlign:"center"},children:d(r)}),[...Array(8)].map((E,k)=>l.jsx("div",{style:{position:"absolute",left:Math.cos(k*Math.PI/4)*60,top:Math.sin(k*Math.PI/4)*60,width:12,height:12,background:a,borderRadius:"50%",boxShadow:`0 0 10px ${a}, 0 0 20px ${a}`,animation:`buffSparkle 0.8s ease-out ${k*.1}s forwards`}},k))]})},aL=({x:t,y:e,onComplete:n,scale:r=1})=>(M.useEffect(()=>{const s=setTimeout(n,1200);return()=>clearTimeout(s)},[n]),l.jsxs("div",{style:{position:"absolute",left:t,top:e,transform:"translate(-50%, -50%)",width:130*r,height:130*r,pointerEvents:"none",zIndex:5e3,display:"flex",alignItems:"center",justifyContent:"center"},children:[l.jsx("div",{style:{fontSize:`${80*r}px`,animation:"baneSkullAppear 1.2s ease-out forwards",textShadow:`0 0 ${20*r}px #9b59b6, 0 0 ${40*r}px #8e44ad, 0 0 ${60*r}px #6c3483`,filter:`drop-shadow(0 0 ${15*r}px #9b59b6) hue-rotate(-10deg)`},children:""}),[...Array(12)].map((s,i)=>l.jsx("div",{style:{position:"absolute",left:"50%",top:"50%",width:6*r,height:6*r,background:"radial-gradient(circle, #9b59b6, #6c3483)",borderRadius:"50%",boxShadow:`0 0 ${8*r}px #9b59b6, 0 0 ${15*r}px #8e44ad`,animation:`baneParticle 1s ease-out ${i*.08}s forwards`,transform:`rotate(${i*30}deg) translateX(0)`}},i)),l.jsx("style",{children:`
                @keyframes baneSkullAppear {
                    0% { transform: scale(0) rotate(-30deg); opacity: 0; }
                    20% { transform: scale(1.3) rotate(10deg); opacity: 1; }
                    40% { transform: scale(1) rotate(-5deg); opacity: 1; }
                    60% { transform: scale(1.1) rotate(0deg); opacity: 1; }
                    80% { transform: scale(1) rotate(0deg); opacity: 0.8; }
                    100% { transform: scale(1.5) rotate(0deg); opacity: 0; }
                }
                @keyframes baneParticle {
                    0% { transform: rotate(0deg) translateX(0); opacity: 1; }
                    100% { transform: rotate(0deg) translateX(${70*r}px); opacity: 0; }
                }
            `})]})),lL=({type:t,x:e,y:n,onComplete:r,audioSettings:s,scale:i=1})=>{const o=M.useMemo(()=>{let f=8,E=8,k=100,P=256;return t==="SHOT"&&(P=128),{cols:f,rows:E,fps:k,size:P}},[t]);if(M.useEffect(()=>{const E=["LIGHTNING","THUNDER","IMPACT","SUMI","SHOT","ICE","WATER","RAY","FIRE","SLASH","BLUE_FIRE"].includes(t)?o.cols*o.rows/o.fps*1e3:t==="FIREBALL"?500:t==="HEAL"?2e3:400,k=setTimeout(r,E);return()=>clearTimeout(k)},[r,t,o]),M.useEffect(()=>{if(!s||!s.seEnabled)return;const f=(E,k=.5,P=0)=>{setTimeout(()=>{const G=new Audio(Je(`/se/${E}`));G.volume=(s.se||.5)*k,G.play().catch(x=>console.warn("SE Play prevented",x))},P)};t==="SHOT"?(f("shot.mp3",.6),f("hibi.mp3",.4,400)):t==="IMPACT"?(f("panch1.mp3",.6,100),f("panch2.mp3",.6,500)):t==="LIGHTNING"||t==="THUNDER"?f("thunder.mp3",.5):t==="FIREBALL"?f("explosion.mp3",.5):t==="FIRE"?f("fire.mp3",.5):t==="SLASH"?f("slash.mp3",.5):t==="ICE"?f("ice.mp3",.5):t==="WATER"?f("water.mp3",.5):t==="RAY"?f("ray.mp3",.6):t==="SUMI"?f("yami.mp3",.6):t==="HEAL"?f("heal.mp3",.6):t==="BLUE_FIRE"?f("fire.mp3",.5):t==="BANE"&&f("yami.mp3",.7)},[t,s]),t==="HEAL")return l.jsx(iL,{x:e,y:n,onComplete:r,scale:i});if(t==="BANE")return l.jsx(aL,{x:e,y:n,onComplete:r,scale:i});const a=100*i,c={position:"absolute",left:e,top:n,transform:"translate(-50%, -50%)",width:a,height:a,pointerEvents:"none",zIndex:5e3,display:"flex",alignItems:"center",justifyContent:"center"};if(["LIGHTNING","THUNDER","IMPACT","SUMI","SHOT","ICE","WATER","RAY","FIRE","SLASH","BLUE_FIRE"].includes(t)){let f=Je("/effects/thunder.png");t==="IMPACT"&&(f=Je("/effects/impact.png")),t==="SUMI"&&(f=Je("/effects/sumi.png")),t==="SHOT"&&(f=Je("/effects/shot.png")),t==="ICE"&&(f=Je("/effects/ice.png")),t==="WATER"&&(f=Je("/effects/water.png")),t==="RAY"&&(f=Je("/effects/ray.png")),t==="FIRE"&&(f=Je("/effects/fire.png")),t==="SLASH"&&(f=Je("/effects/slash.png")),t==="BLUE_FIRE"&&(f=Je("/effects/blue_fire.png"));const E=o.cols*o.rows,k=Math.min(160,o.size)*i;return l.jsxs("div",{style:{...c,width:k,height:k,transform:`${(c==null?void 0:c.transform)||""}`},children:[l.jsx("div",{style:{width:"100%",height:"100%",backgroundImage:`url(${f})`,backgroundSize:`${o.cols*100}% ${o.rows*100}%`,animation:`spriteAnimation ${E/o.fps}s steps(1) forwards`}}),l.jsx("style",{children:`
                    @keyframes spriteAnimation {
                        ${Array.from({length:E}).map((P,G)=>{const x=G%o.cols,S=Math.floor(G/o.cols),w=x*(100/(o.cols-1)),p=S*(100/(o.rows-1));return`${G/(E-1)*100}% { background-position: ${w}% ${p}%; }`}).join(`
`)}
                    }
                `})]})}let d="",h="";if(t==="FIREBALL")d=Je("/effects/fireball.png"),h="explode 0.5s ease-out forwards";else if(t==="BEAM")return l.jsx("div",{style:{position:"fixed",left:e,top:n,width:400,height:30,background:"linear-gradient(90deg, transparent, #faf089, #fff, #faf089, transparent)",transform:"translate(-50%, -50%) rotate(-45deg)",boxShadow:"0 0 20px #faf089",opacity:0,animation:"beamShoot 0.4s ease-out forwards",pointerEvents:"none",zIndex:5e3},children:l.jsx("style",{children:`
                    @keyframes beamShoot {
                        0% { width: 0; opacity: 1; transform: translate(-50%, -50%) rotate(-45deg) scaleX(0); }
                        20% { width: 400px; opacity: 1; transform: translate(-50%, -50%) rotate(-45deg) scaleX(1); }
                        100% { width: 400px; opacity: 0; transform: translate(-50%, -50%) rotate(-45deg) scaleX(1.2); }
                    }
                `})});return d?l.jsxs("div",{style:c,children:[l.jsx("img",{src:d,style:{width:"100%",height:"100%",objectFit:"contain",animation:h}}),l.jsx("style",{children:`
                @keyframes explode { 0% { transform: scale(0.5); opacity: 0; } 20% { opacity: 1; } 100% { transform: scale(2); opacity: 0; } }
            `})]}):null},cL=({value:t,x:e,y:n,color:r,onComplete:s,scale:i=1})=>{M.useEffect(()=>{const u=setTimeout(s,1200);return()=>clearTimeout(u)},[s]);const o=r==="#48bb78",a=r||"#e53e3e",c=o?"linear-gradient(180deg, #68d391 0%, #38a169 50%, #276749 100%)":"linear-gradient(180deg, #fc8181 0%, #e53e3e 50%, #c53030 100%)";return l.jsxs("div",{style:{position:"absolute",left:e,top:n,transform:"translate(-50%, -50%)",pointerEvents:"none",zIndex:6e3,fontSize:`${4*i}rem`,fontWeight:"900",fontFamily:'"Impact", "Arial Black", sans-serif',letterSpacing:`${-2*i}px`,background:c,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",filter:`drop-shadow(0 0 ${8*i}px ${a}) drop-shadow(0 ${2*i}px ${4*i}px rgba(0,0,0,0.8))`,animation:"floatUp 1.2s ease-out forwards"},children:[t,l.jsx("style",{children:`
                @keyframes floatUp {
                    0% { transform: translate(-50%, -50%) scale(0.3); opacity: 0; }
                    15% { transform: translate(-50%, -70%) scale(1.8); opacity: 1; }
                    30% { transform: translate(-50%, -90%) scale(1.4); opacity: 1; }
                    100% { transform: translate(-50%, -180%) scale(1); opacity: 0; }
                }
            `})]})},uL=({x:t,y:e})=>{const n=M.useMemo(()=>Array(16).fill(0).map((r,s)=>({id:s,angle:Math.random()*360,dist:60+Math.random()*120,size:4+Math.random()*8,delay:Math.random()*.3,color:Math.random()>.5?"#f6e05e":"#ffffff"})),[]);return l.jsxs("div",{style:{position:"absolute",left:t,top:e,pointerEvents:"none",zIndex:6e3},children:[l.jsx("style",{children:`
                @keyframes sparkleMove {
                    0% { transform: rotate(var(--angle)) translate(0, 0) scale(0); opacity: 0; }
                    20% { opacity: 1; transform: rotate(var(--angle)) translate(calc(var(--dist) * 0.2px), 0) scale(1.5); }
                    100% { transform: rotate(var(--angle)) translate(calc(var(--dist) * 1px), 0) scale(0); opacity: 0; }
                }
            `}),n.map(r=>l.jsx("div",{style:{position:"absolute",left:0,top:0,width:r.size,height:r.size,background:r.color,borderRadius:"50%",boxShadow:`0 0 10px ${r.color}, 0 0 20px ${r.color}`,"--angle":`${r.angle}deg`,"--dist":r.dist,animation:`sparkleMove 0.8s ease-out ${r.delay}s forwards`,pointerEvents:"none"}},r.id))]})},dL=({onClose:t})=>l.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(0,0,0,0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:t,children:l.jsxs("div",{style:{background:"linear-gradient(135deg, #1a202c 0%, #2d3748 100%)",borderRadius:16,padding:30,maxWidth:700,maxHeight:"80vh",overflowY:"auto",color:"#fff",boxShadow:"0 20px 60px rgba(0,0,0,0.5)",border:"1px solid #4a5568"},onClick:e=>e.stopPropagation(),children:[l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[l.jsx("h2",{style:{margin:0,color:"#63b3ed"},children:""}),l.jsx("button",{onClick:t,style:{background:"transparent",border:"none",color:"#a0aec0",fontSize:"1.5rem",cursor:"pointer"},children:""})]}),l.jsxs("section",{style:{marginBottom:25},children:[l.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),l.jsxs("ul",{style:{lineHeight:1.8,paddingLeft:20,color:"#e2e8f0"},children:[l.jsx("li",{children:"0"}),l.jsx("li",{children:"1PP110"}),l.jsx("li",{children:"PP"}),l.jsx("li",{children:""}),l.jsx("li",{children:"5"}),l.jsx("li",{children:"910"})]})]}),l.jsxs("section",{style:{marginBottom:25},children:[l.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[l.jsxs("div",{children:[l.jsx("span",{style:{color:"#48bb78",fontWeight:"bold"},children:"[]"}),""]}),l.jsxs("div",{children:[l.jsx("span",{style:{color:"#ed8936",fontWeight:"bold"},children:"[]"}),""]}),l.jsxs("div",{children:[l.jsx("span",{style:{color:"#4299e1",fontWeight:"bold"},children:"[]"}),""]}),l.jsxs("div",{children:[l.jsx("span",{style:{color:"#9f7aea",fontWeight:"bold"},children:"[]"}),""]}),l.jsxs("div",{children:[l.jsx("span",{style:{color:"#f56565",fontWeight:"bold"},children:"[]"}),"12"]}),l.jsxs("div",{children:[l.jsx("span",{style:{color:"#38b2ac",fontWeight:"bold"},children:"[]"}),"1"]}),l.jsxs("div",{children:[l.jsx("span",{style:{color:"#718096",fontWeight:"bold"},children:"[]"}),"AoE"]}),l.jsxs("div",{children:[l.jsx("span",{style:{color:"#d69e2e",fontWeight:"bold"},children:"[]"}),"AoE"]})]})]}),l.jsxs("section",{style:{marginBottom:25},children:[l.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[l.jsxs("div",{children:[l.jsx("span",{style:{color:"#63b3ed",fontWeight:"bold"},children:""}),""]}),l.jsxs("div",{children:[l.jsx("span",{style:{color:"#f687b3",fontWeight:"bold"},children:""}),""]}),l.jsxs("div",{children:[l.jsx("span",{style:{color:"#faf089",fontWeight:"bold"},children:""}),"EP"]}),l.jsxs("div",{children:[l.jsx("span",{style:{color:"#b794f4",fontWeight:"bold"},children:""}),"SEP"]}),l.jsxs("div",{children:[l.jsx("span",{style:{color:"#68d391",fontWeight:"bold"},children:""}),""]})]})]}),l.jsxs("section",{style:{marginBottom:25},children:[l.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),l.jsxs("ul",{style:{lineHeight:1.8,paddingLeft:20,color:"#e2e8f0"},children:[l.jsxs("li",{children:[l.jsx("span",{style:{color:"#faf089"},children:"EP"}),"54112"]}),l.jsxs("li",{children:[l.jsx("span",{style:{color:"#b794f4"},children:"SEP"}),"76112"]}),l.jsx("li",{children:"1111"}),l.jsx("li",{children:"+2/+2"}),l.jsx("li",{children:"+3/+3"})]})]}),l.jsxs("section",{children:[l.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),l.jsxs("ul",{style:{lineHeight:1.8,paddingLeft:20,color:"#e2e8f0"},children:[l.jsxs("li",{children:[l.jsx("span",{style:{color:"#ed8936"},children:"PP"}),""]}),l.jsx("li",{children:"151612PP +1"})]})]})]})}),fL=({logs:t,onCardNameClick:e,scale:n=1,isMobile:r=!1})=>{const s=M.useRef(null);M.useEffect(()=>{s.current&&(s.current.scrollTop=s.current.scrollHeight)},[t.length]);const i=(c,u)=>{const d={color:"#ffd700",cursor:"pointer",textDecoration:"underline",textUnderlineOffset:"2px",fontWeight:"bold"},h=p=>{p.target.style.color="#ffec8b",p.target.style.textShadow="0 0 8px rgba(255, 215, 0, 0.8)"},f=p=>{p.target.style.color="#ffd700",p.target.style.textShadow="none"},E=(p,b)=>l.jsx("span",{style:d,onMouseEnter:h,onMouseLeave:f,onClick:H=>{H.stopPropagation(),e==null||e(p)},children:p},b),k=RS(),P=p=>p?!(/[a-zA-Z0-9]/.test(p)||/[\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/.test(p)):!0,G=[];for(const p of k){let b=0;for(;;){const H=c.indexOf(p,b);if(H===-1)break;const re=H>0?c[H-1]:void 0,K=H+p.length<c.length?c[H+p.length]:void 0,Q=P(re)&&P(K),ce=G.some(me=>H>=me.start&&H<me.end||H+p.length>me.start&&H+p.length<=me.end||H<=me.start&&H+p.length>=me.end);Q&&!ce&&G.push({start:H,end:H+p.length,name:p}),b=H+1}}if(G.length===0)return l.jsx("span",{children:c});G.sort((p,b)=>p.start-b.start);const x=[];let S=0,w=0;for(const p of G)p.start>S&&x.push(l.jsx("span",{children:c.slice(S,p.start)},w++)),x.push(E(p.name,w++)),S=p.end;return S<c.length&&x.push(l.jsx("span",{children:c.slice(S)},w++)),l.jsx(l.Fragment,{children:x})},o=r?Math.max(100,140*n):Math.max(150,200*n),a=r?Math.max(140,180*n):Math.max(180,220*n);return l.jsxs("div",{ref:s,style:{position:"absolute",left:0,top:"45%",transform:"translateY(-50%)",width:a,height:o,overflowY:"auto",background:"linear-gradient(to right, rgba(0,0,0,0.8), rgba(0,0,0,0.0))",color:"#fff",fontSize:r?`${Math.max(.55,.65*n)}rem`:`${Math.max(.65,.75*n)}rem`,padding:r?`${6*n}px ${6*n}px ${6*n}px ${10*n}px`:`${8*n}px ${8*n}px ${8*n}px ${12*n}px`,borderLeft:r?"2px solid #63b3ed":"3px solid #63b3ed",zIndex:15,pointerEvents:"auto",scrollbarWidth:"thin"},onMouseDown:c=>c.stopPropagation(),onClick:c=>c.stopPropagation(),children:[l.jsx("div",{style:{fontWeight:"bold",marginBottom:(r?3:4)*n,color:"#a0aec0",borderBottom:"1px solid rgba(255,255,255,0.1)",paddingBottom:2,fontSize:r?`${Math.max(.5,.55*n)}rem`:`${Math.max(.55,.65*n)}rem`,textTransform:"uppercase",letterSpacing:1},children:r?"LOG":"BATTLE LOG"}),l.jsx("div",{style:{display:"flex",flexDirection:"column",gap:(r?2:3)*n},children:t.map((c,u)=>l.jsx("div",{style:{opacity:.9,lineHeight:r?"1.3":"1.4",textShadow:"0 1px 2px black",animation:"fadeIn 0.3s ease-out"},children:i(c)},u))})]})},hL=({card:t,evolvedImageUrl:e,startX:n,startY:r,phase:s,onPhaseChange:i,onShake:o,useSep:a,playSE:c,scale:u,isLightMode:d=!1})=>{const[h,f]=M.useState(0),[E,k]=M.useState(0),[P,G]=M.useState(0),[x,S]=M.useState(0),[w,p]=M.useState(0),[b,H]=M.useState(.25),[re,K]=M.useState({x:n,y:r}),[Q,ce]=M.useState(!1),[me,Se]=M.useState([]),[de,B]=M.useState([]),[O,T]=M.useState(!1),C=M.useRef(!1),y=M.useRef(null),g=M.useRef(i),I=M.useRef(o),A=M.useRef(c);M.useEffect(()=>{g.current=i,I.current=o,A.current=c},[i,o,c]);const L=360*u,j=480*u;M.useEffect(()=>{var X,Pe,Ie;console.log("[EvolutionAnimation] Phase:",s);let ke,ee=null;switch(s){case"ZOOM_IN":{K({x:n,y:r}),H(.25),k(0);const Ze=Date.now(),$e=650,ot=.25,bt=.75,$t=setInterval(()=>{const dt=Date.now()-Ze,vn=Math.min(dt/$e,1),Wt=1-Math.pow(1-vn,2);k(-5*Wt),H(ot+(bt-ot)*Wt),vn>=1&&clearInterval($t)},16);ke=setTimeout(()=>{const dt=280*u,vn=window.innerWidth-dt,Wt=dt+vn*.4;K({x:Wt,y:window.innerHeight/2-30*u})},50);const Xe=setTimeout(()=>{const dt=new Audio(Je("/se/kirakira.mp3"));dt.volume=.35,dt.play().catch(()=>{}),y.current=dt},600),ln=setTimeout(()=>{g.current("WHITE_FADE")},700);return()=>{clearTimeout(ke),clearTimeout(ln),clearTimeout(Xe),clearInterval($t)}}case"WHITE_FADE":(X=A.current)==null||X.call(A,"magic_charge.mp3",.3);const Ye=Array(80).fill(0).map((Ze,$e)=>{const ot=$e/80*360,bt=(Math.random()-.5)*10,$t=ot+bt,Xe=200+Math.random()*600,ln=Math.random()*1.8,vn=.5+(Xe-200)/600*.5,Wt=24+Math.random()*48;return{id:$e,angle:$t,dist:Xe,delay:ln,duration:vn,size:Wt}});Se(Ye),T(!0);let Ae=0;return ee=setInterval(()=>{Ae+=.025,S(Math.min(Ae,1)),p(Math.min(Ae*80,80)),G(Ae*15),Ae>=1.2&&(ee&&clearInterval(ee),T(!1),g.current("FLIP"))},40),()=>{ee&&clearInterval(ee)};case"FLIP":if((Pe=A.current)==null||Pe.call(A,"syakin.mp3",.8),(Ie=A.current)==null||Ie.call(A,"KO.mp3",.7),y.current){const Ze=y.current,$e=300,ot=30,bt=$e/ot,$t=Ze.volume/bt;let Xe=0;const ln=setInterval(()=>{Xe++,Ze.volume=Math.max(0,Ze.volume-$t),Xe>=bt&&(clearInterval(ln),Ze.pause(),y.current=null)},ot)}Se([]);const Fe=Date.now(),Et=400,it=1200;return ee=setInterval(()=>{const Ze=Date.now()-Fe;if(Ze<Et){const $e=Ze/Et,ot=1-Math.pow(1-$e,3),bt=10+ot*160;if(f(bt),H(.75+ot*((a?1.2:1.1)-.75)),k(-5+ot*2),S(Math.max(1-$e*3,0)),bt>90&&!C.current){C.current=!0;const Xe=Array(120).fill(0).map((ln,dt)=>{const vn=dt/120*360,Wt=(Math.random()-.5)*8,ji=18+Math.random()*42;return{id:dt,angle:vn+Wt,dist:200+Math.random()*400,size:ji*3,delay:Math.random()*.05}});B(Xe)}}else{const $e=Math.min((Ze-Et)/it,1),ot=$e<.5?2*$e*$e:1-Math.pow(-2*$e+2,2)/2;if(f(170+ot*10),S(0),!C.current){C.current=!0;const bt=Array(120).fill(0).map(($t,Xe)=>{const ln=Xe/120*360,dt=(Math.random()-.5)*8,vn=18+Math.random()*42;return{id:Xe,angle:ln+dt,dist:200+Math.random()*400,size:vn*3,delay:Math.random()*.05}});B(bt)}$e>=1&&(ee&&clearInterval(ee),g.current("REVEAL"))}},16),()=>{ee&&clearInterval(ee)};case"REVEAL":let lt=0;return ee=setInterval(()=>{lt+=.25,S(Math.max(1-lt,0)),p(Math.max(60-lt*60,0)),lt>=1&&(ee&&clearInterval(ee),B([]),g.current("ZOOM_OUT"))},40),()=>{ee&&clearInterval(ee)};case"ZOOM_OUT":{K({x:n,y:r});const Ze=Date.now(),$e=250,ot=b,bt=-3;return ee=setInterval(()=>{const $t=Date.now()-Ze,Xe=Math.min($t/$e,1),ln=1-Math.pow(1-Xe,3);H(ot-(ot-.25)*ln),k(bt*(1-ln)),Xe>=1&&(ee&&clearInterval(ee),f(180),G(0),H(.25),k(0),g.current("LAND"))},16),()=>{ee&&clearInterval(ee)}}case"LAND":return I.current(),ce(!0),ke=setTimeout(()=>{g.current("DONE")},600),()=>clearTimeout(ke)}return()=>{ke&&clearTimeout(ke),ee&&clearInterval(ee),y.current&&(y.current.pause(),y.current=null)}},[s]);const N=h+P,pe=E,we=O?{x:(Math.random()-.5)*4,y:(Math.random()-.5)*4}:{x:0,y:0};return l.jsxs("div",{style:{position:"fixed",inset:0,zIndex:1e4,background:"rgba(0,0,0,0.75)",pointerEvents:"none"},children:[l.jsx("style",{children:`
                ${me.map(ke=>`
                    @keyframes chargeParticleIn-${ke.id} {
                        0% { opacity: 0; transform: rotate(${ke.angle}deg) translateX(${ke.dist}px) scale(0.5); }
                        20% { opacity: 0.8; transform: rotate(${ke.angle}deg) translateX(${ke.dist*.8}px) scale(1.2); }
                        100% { opacity: 1; transform: rotate(${ke.angle}deg) translateX(0) scale(0.2); } /* Keep visible at end */
                    }
                `).join("")}
                ${de.map(ke=>`
                    @keyframes burstParticleOut-${ke.id} {
                        0% { opacity: 1; transform: translate(-50%, -50%) rotate(${ke.angle}deg) translateX(0) scale(1.5); }
                        100% { opacity: 0; transform: translate(-50%, -50%) rotate(${ke.angle}deg) translateX(${ke.dist*1.5}px) scale(0); }
                    }
                `).join("")}
            `}),(d?me.filter((ke,ee)=>ee%2===0):me).map(ke=>l.jsx("div",{style:{position:"absolute",left:re.x,top:re.y,width:ke.size*u,height:ke.size*u,borderRadius:"50%",background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(200,230,255,0.6) 40%, transparent 70%)",boxShadow:d?"0 0 8px white":"0 0 10px white, 0 0 20px rgba(100,200,255,0.5)",filter:d?void 0:"blur(1px)",animation:`chargeParticleIn-${ke.id} ${ke.duration}s ease-in ${ke.delay}s forwards`,transform:`rotate(${ke.angle}deg) translateX(${ke.dist*u}px)`,opacity:0,pointerEvents:"none"}},`charge-${ke.id}`)),s==="WHITE_FADE"&&l.jsxs("div",{style:{position:"absolute",left:re.x+we.x,top:re.y+we.y,width:0,height:0,transformStyle:"preserve-3d"},children:[l.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:500*u,height:500*u,border:"8px solid rgba(255, 255, 255, 0.6)",borderRadius:"50%",transform:"translate(-50%, -50%) rotateX(75deg)",boxShadow:d?"0 0 15px rgba(255, 255, 255, 0.6)":"0 0 30px rgba(255, 255, 255, 0.8), inset 0 0 30px rgba(255, 255, 255, 0.8)",animation:"ringSpin 2s linear infinite"}}),!d&&l.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:600*u,height:600*u,border:"6px dashed rgba(100, 200, 255, 0.7)",borderRadius:"50%",transform:"translate(-50%, -50%) rotateX(80deg) rotateY(10deg)",boxShadow:"0 0 40px rgba(100, 200, 255, 0.5)",animation:"ringSpinReverse 3s linear infinite"}}),l.jsx("style",{children:`
                        @keyframes ringSpin {
                            0% { transform: translate(-50%, -50%) rotateX(75deg) rotate(0deg); opacity: 0; scale: 0.5; }
                            20% { opacity: 1; scale: 1; }
                            100% { transform: translate(-50%, -50%) rotateX(75deg) rotate(360deg); opacity: 1; scale: 1; }
                        }
                        @keyframes ringSpinReverse {
                            0% { transform: translate(-50%, -50%) rotateX(80deg) rotateY(10deg) rotate(0deg); opacity: 0; scale: 0.6; }
                            20% { opacity: 0.8; scale: 1; }
                            100% { transform: translate(-50%, -50%) rotateX(80deg) rotateY(10deg) rotate(-360deg); opacity: 0.8; scale: 1; }
                        }
                    `})]}),(d?de.filter((ke,ee)=>ee%2===0):de).map(ke=>l.jsx("div",{style:{position:"absolute",left:re.x,top:re.y,width:ke.size*u,height:ke.size*u,borderRadius:"50%",background:a?"radial-gradient(circle, rgba(183, 148, 244, 1) 0%, rgba(159, 122, 234, 0.8) 50%, transparent 100%)":"radial-gradient(circle, rgba(255, 251, 235, 1) 0%, rgba(251, 211, 141, 0.8) 50%, transparent 100%)",boxShadow:d?a?"0 0 8px #b794f4":"0 0 8px #fbd38d":a?"0 0 10px #b794f4, 0 0 20px rgba(159,122,234,0.6)":"0 0 10px #fbd38d, 0 0 20px rgba(251,211,141,0.6)",animation:`burstParticleOut-${ke.id} 0.4s ease-out ${ke.delay}s forwards`,pointerEvents:"none"}},`burst-${ke.id}`)),l.jsxs("div",{style:{position:"absolute",left:re.x+we.x,top:re.y+we.y,transform:`translate(-50%, -50%) scale(${b}) perspective(1200px) rotateY(${N}deg) rotateZ(${pe}deg)`,transition:s==="ZOOM_IN"||s==="ZOOM_OUT"?"left 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), top 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)":"none",transformStyle:"preserve-3d"},children:[!d&&l.jsx("div",{style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:L*1.3,height:j*1.2,background:a?"radial-gradient(ellipse, rgba(159, 122, 234, 0.4) 0%, transparent 70%)":"radial-gradient(ellipse, rgba(251, 211, 141, 0.4) 0%, transparent 70%)",filter:"blur(20px)",pointerEvents:"none",opacity:w>1?1:0,transition:"opacity 0.4s"}}),l.jsxs("div",{style:{width:L,height:j,borderRadius:16,overflow:"hidden",boxShadow:d?a?"0 0 20px rgba(159, 122, 234, 0.5)":"0 0 20px rgba(251, 211, 141, 0.5)":a?"0 0 40px rgba(159, 122, 234, 0.7)":"0 0 40px rgba(251, 211, 141, 0.7)",position:"relative",transformStyle:"preserve-3d"},children:[l.jsxs("div",{style:{position:"absolute",inset:0,borderRadius:16,overflow:"hidden",background:"#1a202c",zIndex:N<=90?2:1,opacity:N<=90?1:0},children:[l.jsx("img",{src:Je(t.imageUrl||""),alt:t.name,style:{width:"100%",height:"100%",objectFit:"cover",filter:`brightness(${1+x*.5}) contrast(${1-x*.2})`}}),l.jsx("div",{style:{position:"absolute",inset:0,background:"white",opacity:x,pointerEvents:"none"}})]}),l.jsxs("div",{style:{position:"absolute",inset:0,transform:"rotateY(180deg)",borderRadius:16,overflow:"hidden",background:"#1a202c",zIndex:N>90?2:1,opacity:N>90?1:0},children:[l.jsx("img",{src:Je(e&&e!==""?e:t.imageUrl||""),alt:`${t.name} Evolved`,style:{width:"100%",height:"100%",objectFit:"cover",filter:`brightness(${1+x*.5}) contrast(${1-x*.2})`}}),l.jsx("div",{style:{position:"absolute",inset:0,background:"white",opacity:x,pointerEvents:"none"}})]})]})]}),Q&&l.jsxs("div",{style:{position:"absolute",left:n,top:r,pointerEvents:"none"},children:[l.jsx("style",{children:`
                        @keyframes landParticleMove {
                            0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                            100% { opacity: 0; transform: translate(-50%, -50%) rotate(var(--angle)) translateX(calc(var(--dist) * 1px)) scale(0); }
                        }
                    `}),Array(20).fill(0).map((ke,ee)=>{const X=ee/20*360,Pe=40+Math.random()*100;return l.jsx("div",{style:{position:"absolute",left:0,top:0,width:8*u,height:8*u,borderRadius:"50%",background:"white","--angle":`${X}deg`,"--dist":Pe,animation:"landParticleMove 0.5s ease-out forwards"}},`land-${ee}`)})]})]})},h_=Je("/leaders/yoRuka_win.png"),p_=Je("/leaders/yoRuka_lose.png"),pL=Je("/leaders/senka_win.png"),gL=Je("/leaders/senka_lose.png"),mL=Je("/leaders/azya_win.png"),yL=Je("/leaders/azya_lose.png"),vL=t=>({BRONZE:"#cd7f32",SILVER:"#c0c0c0",GOLD:"#ffd700",PLATINUM:"#e5e4e2",DIAMOND:"#b9f2ff",MASTER:"#ff4500"})[t],_L=({winnerId:t,playerId:e,playerClass:n,onRematch:r,onRematching:s,onLeave:i,isOnline:o,isRoomMatch:a=!0,myRematchRequested:c,opponentRematchRequested:u,battleStats:d,selectedCardInfo:h,onCardInfoClick:f,victoryReason:E="normal",isRankedMatch:k=!1,ratingResult:P})=>{const G=t===e,S=(()=>{if(!G)return null;switch(E){case"disconnect":return"";case"surrender":return"";default:return null}})(),[w,p]=M.useState("bg-fade"),b=["bg-fade","image","result-text","stats","rate","buttons","complete"].indexOf(w);M.useEffect(()=>{const y={"bg-fade":300,image:600,"result-text":400,stats:400,rate:300,buttons:0};if(w==="complete")return;const g={"bg-fade":"image",image:"result-text","result-text":"stats",stats:"rate",rate:"buttons",buttons:"complete"},I=setTimeout(()=>{const A=g[w];A&&p(A)},y[w]||0);return()=>clearTimeout(I)},[w]);const H=()=>n==="SENKA"?G?pL:gL:n==="AJA"?G?mL:yL:G?h_:p_,[re,K]=M.useState(15),[Q,ce]=M.useState(!1),[me,Se]=M.useState(null),de=o?c||u:c||Q;M.useEffect(()=>{if(de)return;const y=setInterval(()=>{K(g=>g<=1?(clearInterval(y),i(),0):g-1)},1e3);return()=>clearInterval(y)},[i,de]);const B=y=>{Se(y),o&&!a&&s?s(y):r(y)},O=()=>{const y=!o||a?"":"";return o?c&&u?"...":c?"...":u?`${y}`:y:c?"...":y},T=()=>{const y={padding:"15px 40px",fontSize:"1.5rem",fontWeight:"bold",border:"none",borderRadius:12,cursor:c?"default":"pointer",transform:"scale(1)",transition:"transform 0.1s, background 0.2s"};return u&&!c?{...y,background:"linear-gradient(135deg, #f6e05e, #d69e2e)",color:"black",boxShadow:"0 4px 15px rgba(246, 224, 94, 0.6)",animation:"pulse 1s infinite"}:c?{...y,background:"linear-gradient(135deg, #718096, #4a5568)",color:"white",boxShadow:"none"}:{...y,background:"linear-gradient(135deg, #48bb78, #38a169)",color:"white",boxShadow:"0 4px 15px rgba(72, 187, 120, 0.4)"}},C=(y,g)=>({width:220,height:220,borderRadius:"50%",border:me===y?"5px solid #f6e05e":"4px solid rgba(255,255,255,0.4)",background:y==="AJA"?`url(${Va(y)}) center top/cover`:`url(${Va(y)}) center/cover`,cursor:"pointer",transform:g?"scale(1.1)":"scale(1)",transition:"all 0.2s ease",boxShadow:g?"0 0 30px rgba(246, 224, 94, 0.7)":"0 6px 15px rgba(0,0,0,0.5)"});return l.jsxs("div",{style:{position:"absolute",inset:0,zIndex:5e3,background:"rgba(0,0,0,0.85)",backdropFilter:"blur(10px)",display:"flex",flexDirection:"row",alignItems:"stretch",opacity:b>=0?1:0,transition:"opacity 0.3s ease-out"},onClick:()=>{},children:[l.jsx("style",{children:`
                @keyframes pulse {
                    0%, 100% { transform: scale(1); }
                    50% { transform: scale(1.05); }
                }
                @keyframes float {
                    0%, 100% { transform: translateY(0); }
                    50% { transform: translateY(-10px); }
                }
                @keyframes slideUpFadeIn {
                    0% { opacity: 0; transform: translateY(30px); }
                    100% { opacity: 1; transform: translateY(0); }
                }
                @keyframes imageFadeIn {
                    0% { opacity: 0; transform: scale(0.95); }
                    100% { opacity: 0.9; transform: scale(1); }
                }
            `}),l.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:40,borderRight:"1px solid rgba(255,255,255,0.1)"},children:h?l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:16,maxWidth:320},children:[l.jsx("div",{style:{width:200,height:280,backgroundImage:`url(${Je(`/cards/${h.id}.png`)})`,backgroundSize:"cover",backgroundPosition:"center",borderRadius:12,boxShadow:"0 8px 30px rgba(0,0,0,0.6)"}}),l.jsx("div",{style:{fontFamily:"var(--font-tamanegi)",fontSize:"1.6rem",color:"white",textShadow:"0 2px 6px rgba(0,0,0,0.6)",textAlign:"center"},children:h.name}),l.jsxs("div",{style:{display:"flex",gap:20,fontSize:"1.2rem",color:"rgba(255,255,255,0.9)"},children:[l.jsxs("span",{children:[": ",h.cost]}),h.type==="FOLLOWER"&&l.jsxs(l.Fragment,{children:[l.jsxs("span",{children:[": ",h.attack]}),l.jsxs("span",{children:[": ",h.health]})]})]}),l.jsx("div",{style:{fontSize:"1rem",color:"rgba(255,255,255,0.7)",textAlign:"center",lineHeight:1.5,maxHeight:120,overflow:"auto"},children:h.description||""}),l.jsx("button",{onClick:()=>f(null),style:{padding:"8px 24px",fontSize:"1rem",background:"transparent",border:"1px solid rgba(255,255,255,0.3)",color:"white",borderRadius:8,cursor:"pointer",marginTop:10},children:""})]}):l.jsx("div",{style:{width:"100%",height:"100%",backgroundImage:`url(${H()})`,backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat",opacity:b>=1?.9:0,transform:b>=1?"scale(1)":"scale(0.95)",transition:"opacity 0.6s ease-out, transform 0.6s ease-out"}})}),l.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:40,position:"relative"},children:[l.jsx("div",{style:{fontFamily:"var(--font-tamanegi)",fontSize:"5rem",color:G?"#f6e05e":"#a0aec0",textShadow:G?"0 0 40px rgba(246, 224, 94, 0.7), 4px 4px 8px rgba(0,0,0,0.6)":"0 0 20px rgba(160, 174, 192, 0.5), 4px 4px 8px rgba(0,0,0,0.6)",marginBottom:20,opacity:b>=2?1:0,transform:b>=2?"translateY(0)":"translateY(30px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out",animation:b>=2?"float 3s ease-in-out infinite":"none"},children:G?"":""}),S&&l.jsx("div",{style:{fontSize:"1.1rem",color:"rgba(255, 255, 255, 0.8)",marginTop:-10,marginBottom:20,opacity:b>=2?1:0,transform:b>=2?"translateY(0)":"translateY(20px)",transition:"opacity 0.4s ease-out 0.2s, transform 0.4s ease-out 0.2s"},children:S}),l.jsxs("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"center",gap:16,marginBottom:30,padding:"16px 24px",background:"rgba(0,0,0,0.3)",borderRadius:12,border:"1px solid rgba(255,255,255,0.1)",opacity:b>=3?1:0,transform:b>=3?"translateY(0)":"translateY(30px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out"},children:[l.jsxs("div",{style:{textAlign:"center",minWidth:80},children:[l.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#f6e05e"},children:d.turnCount}),l.jsx("div",{style:{fontSize:"0.9rem",color:"rgba(255,255,255,0.6)"},children:""})]}),l.jsxs("div",{style:{textAlign:"center",minWidth:80},children:[l.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#48bb78"},children:d.damageDealtToOpponent}),l.jsx("div",{style:{fontSize:"0.9rem",color:"rgba(255,255,255,0.6)"},children:""})]}),l.jsxs("div",{style:{textAlign:"center",minWidth:80},children:[l.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#e53e3e"},children:d.damageReceivedFromOpponent}),l.jsx("div",{style:{fontSize:"0.9rem",color:"rgba(255,255,255,0.6)"},children:""})]}),l.jsxs("div",{style:{textAlign:"center",minWidth:80},children:[l.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#63b3ed"},children:d.followersDestroyed}),l.jsx("div",{style:{fontSize:"0.9rem",color:"rgba(255,255,255,0.6)"},children:""})]})]}),k&&P&&l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:8,marginTop:16,opacity:b>=4?1:0,transform:b>=4?"translateY(0)":"translateY(20px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out"},children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,background:"rgba(0, 0, 0, 0.5)",padding:"12px 24px",borderRadius:12,border:`2px solid ${P.ratingChange>=0?"#48bb78":"#e53e3e"}`},children:[l.jsx("span",{style:{fontSize:"1.2rem",color:"rgba(255,255,255,0.8)",fontFamily:"var(--font-tamanegi)"},children:""}),l.jsxs("span",{style:{fontSize:"2rem",fontWeight:"bold",color:P.ratingChange>=0?"#48bb78":"#e53e3e",fontFamily:"var(--font-tamanegi)"},children:[P.ratingChange>=0?"+":"",P.ratingChange]})]}),P.ratingChange>0&&(P.bonusBreakdown.winStreakBonus>0||P.bonusBreakdown.rankDiffBonus>0)&&l.jsxs("div",{style:{display:"flex",gap:16,fontSize:"0.85rem",color:"rgba(255,255,255,0.6)",fontFamily:"var(--font-tamanegi)"},children:[l.jsxs("span",{children:[": +",P.bonusBreakdown.base]}),P.bonusBreakdown.winStreakBonus>0&&l.jsxs("span",{style:{color:"#f6e05e"},children:[": +",P.bonusBreakdown.winStreakBonus]}),P.bonusBreakdown.rankDiffBonus>0&&l.jsxs("span",{style:{color:"#63b3ed"},children:[": +",P.bonusBreakdown.rankDiffBonus]})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,fontSize:"1rem",color:"rgba(255,255,255,0.8)",fontFamily:"var(--font-tamanegi)"},children:[l.jsx("span",{style:{color:vL(P.newRank),fontWeight:"bold"},children:So[P.newRank]}),l.jsx("span",{children:P.newRating})]}),P.isRankUp&&l.jsxs("div",{style:{fontSize:"1.4rem",fontWeight:"bold",color:"#f6e05e",textShadow:"0 0 20px rgba(246, 224, 94, 0.8)",fontFamily:"var(--font-tamanegi)",animation:"pulse 1s ease-in-out infinite"},children:[So[P.newRank],""]}),P.isRankDown&&l.jsxs("div",{style:{fontSize:"1.2rem",color:"#e53e3e",fontFamily:"var(--font-tamanegi)"},children:[So[P.newRank],""]})]}),l.jsx("div",{style:{position:"absolute",right:20,bottom:270,width:180,textAlign:"center",fontFamily:"var(--font-tamanegi)",fontSize:"1.4rem",color:G?"#f6e05e":"#e53e3e",textShadow:G?"0 0 20px rgba(246, 224, 94, 0.8), 2px 2px 4px rgba(0,0,0,0.8)":"0 0 20px rgba(229, 62, 62, 0.8), 2px 2px 4px rgba(0,0,0,0.8)",zIndex:10,opacity:b>=5?1:0,transition:"opacity 0.4s ease-out"},children:G?"":""}),Q&&!c?l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",animation:"fadeIn 0.3s ease-out"},children:[l.jsx("div",{style:{fontFamily:"var(--font-tamanegi)",fontSize:"1.6rem",color:"white",marginBottom:24,textShadow:"0 2px 6px rgba(0,0,0,0.6)"},children:""}),l.jsxs("div",{style:{display:"flex",gap:40,marginBottom:24},children:[l.jsx(g_,{deckType:"SENKA",label:"",onSelect:B,getStyle:C}),l.jsx(g_,{deckType:"AJA",label:"",onSelect:B,getStyle:C})]}),l.jsx("button",{onClick:()=>ce(!1),style:{padding:"10px 36px",fontSize:"1.1rem",fontWeight:"bold",background:"transparent",border:"2px solid rgba(255,255,255,0.3)",color:"white",borderRadius:10,cursor:"pointer",marginTop:8},children:""})]}):l.jsxs("div",{style:{display:"flex",gap:20,opacity:b>=5?1:0,transform:b>=5?"translateY(0)":"translateY(30px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out"},children:[l.jsx("button",{onClick:()=>{c||ce(!0)},disabled:c,style:T(),onMouseDown:y=>{c||(y.currentTarget.style.transform="scale(0.95)")},onMouseUp:y=>y.currentTarget.style.transform="scale(1)",children:O()}),l.jsxs("button",{onClick:i,style:{padding:"15px 40px",fontSize:"1.5rem",fontWeight:"bold",background:"transparent",border:"2px solid rgba(255,255,255,0.3)",color:"white",borderRadius:12,cursor:"pointer"},children:[" ",!de&&`(${re})`]})]}),l.jsx("div",{onClick:()=>{Q&&!c&&B("YORUKA")},style:{position:"absolute",right:20,bottom:20,width:180,height:240,backgroundImage:`url(${G?h_:p_})`,backgroundSize:"cover",backgroundPosition:"center",borderRadius:12,cursor:Q&&!c?"pointer":"default",opacity:b>=5?.7:0,transition:"opacity 0.4s ease",boxShadow:"0 8px 20px rgba(0,0,0,0.4)"}})]})]})},g_=({deckType:t,label:e,onSelect:n,getStyle:r})=>{const[s,i]=M.useState(!1);return l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:12},children:[l.jsx("button",{onClick:()=>n(t),onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),style:r(t,s)}),l.jsx("span",{style:{color:"white",fontFamily:"var(--font-tamanegi)",fontSize:"1.4rem",textShadow:"0 2px 6px rgba(0,0,0,0.6)"},children:e})]})},m_=(t,e)=>{const[n,r]=M.useState([]),s=M.useRef(!1);return M.useEffect(()=>{r(i=>{const o=[],a=new Map((t||[]).filter(c=>c).map(c=>[c.instanceId,c]));return i.forEach(c=>{var d;if(!c)return;const u=a.get(c.instanceId);u?(o.push({...u,passiveAbilities:u.passiveAbilities?[...u.passiveAbilities]:[],hasBarrier:u.hasBarrier??((d=u.passiveAbilities)==null?void 0:d.includes("BARRIER"))??!1,isDying:!1}),a.delete(c.instanceId)):o.push({...c,isDying:!0,killedByBane:c.killedByBane})}),a.forEach(c=>{var u;o.push({...c,passiveAbilities:c.passiveAbilities?[...c.passiveAbilities]:[],hasBarrier:c.hasBarrier??((u=c.passiveAbilities)==null?void 0:u.includes("BARRIER"))??!1,isDying:!1})}),o})},[t]),M.useEffect(()=>{if(n.some(o=>o.isDying)){if(e!=null&&e.current){s.current=!0;return}const o=setTimeout(()=>{r(a=>a.filter(c=>!c.isDying))},700);return()=>clearTimeout(o)}},[n,e]),M.useEffect(()=>{const o=setInterval(()=>{if(!(e!=null&&e.current)&&s.current){s.current=!1;const a=setTimeout(()=>{r(c=>c.filter(u=>!u.isDying))},300);return()=>clearTimeout(a)}},100);return()=>clearInterval(o)},[e]),n},xL=({playerClass:t,opponentType:e,gameMode:n,targetRoomId:r,onLeave:s,onRematching:i,networkAdapter:o,networkConnected:a,opponentClass:c,aiDifficulty:u="NORMAL",playerName:d,timerEnabled:h=!0,playerId:f,opponentPlayerId:E,opponentRating:k})=>{var Em,bm,Sm,Im,Tm,Cm,wm,km,Am;const P=n==="CPU"||!o,G=QO(P?n==="CPU"?"CPU":n:"CPU",P?r:void 0),x=o||G.adapter,S=a!==void 0?a:G.connected,w=sL(),{scale:p,toGameX:b,toGameY:H}=w,{isLightMode:re}=PS(),[K,Q]=F.useState(!1);F.useEffect(()=>{(()=>{Q("ontouchstart"in window||navigator.maxTouchPoints>0)})()},[]);const ce=F.useCallback((m,v)=>({x:b(m),y:H(v)}),[b,H]),[me,Se]=F.useState(null),de=M.useRef(w);F.useEffect(()=>{de.current=w},[w]);const B=n==="CPU"||n==="HOST"||(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&(x==null?void 0:x.isHost)===!0,O=B?"p1":"p2",T=B?"p2":"p1";console.log("[GameScreen INIT]",{gameMode:n,"adapter?.isHost":x==null?void 0:x.isHost,isHost:B,currentPlayerId:O,connected:S,"networkAdapter provided":!!o,networkConnected:a});const C=c||(t==="YORUKA"?Math.random()<.5?"SENKA":"AJA":t==="SENKA"?"AJA":"SENKA"),y=n==="JOIN"||(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&!B,[g,I]=F.useReducer(BO,null,()=>{const m=n==="CPU"?"CPU":"";return y?su(m,C,d,t):su(d,t,m,C)}),[A,L]=F.useState(!y),j=n==="CASUAL_MATCH"||n==="RANKED_MATCH",[N,pe]=M.useState(j?!1:!y),[we,ke]=M.useState(!1),[ee,X]=M.useState(!1),[Pe,Ie]=M.useState(!1),[Ye,Ae]=M.useState(j),[Fe,Et]=M.useState(!1),it=M.useRef(!1);console.log("[GameScreen SYNC STATE]",{isCasualOrRanked:j,isJoinSide:y,gameSynced:A,waitingForIntroSync:Ye,opponentReadyForIntro:Fe,showBattleIntro:N,"introSyncSentRef.current":it.current});const[lt,Ze]=M.useState(!1),[$e,ot]=M.useState(null),[bt,$t]=M.useState(0),[Xe,ln]=M.useState({x:0,y:0}),[dt,vn]=M.useState("IDLE"),[Wt,ji]=M.useState(null),[Bd,zd]=M.useState(!1),[is,L0]=M.useState(()=>Math.random()>.5),[LS,D0]=M.useState(!1),[N0,M0]=M.useState(!1),[DS,j0]=M.useState("normal"),[_r,$0]=M.useState(t),[Ul,qo]=M.useState({turnCount:0,damageDealtToOpponent:0,damageReceivedFromOpponent:0,followersDestroyed:0,myFollowersDestroyed:0}),[NS,Hd]=M.useState(null),[MS,jS]=M.useState(null),[F0,U0]=M.useState(!1);M.useEffect(()=>{if(n!=="RANKED_MATCH"||!f||!g.winnerId||F0)return;(async()=>{try{const v=await Fb(f,_r),_=g.winnerId===O;let R;_?R=KP(v.rating,v.winStreak,k??0):R=XP(v.rating),await JP(f,_r,R,_),jS(R),U0(!0),console.log("[RatingUpdate] Rating updated:",R)}catch(v){console.error("[RatingUpdate] Failed to update rating:",v),U0(!0)}})()},[n,f,g.winnerId,O,_r,k,F0]),M.useEffect(()=>{g.winnerId&&!lt&&!Pe&&Ie(!0)},[g.winnerId,lt,Pe]),M.useEffect(()=>{if(bt<=0){ln({x:0,y:0});return}let m;const v=()=>{const _=Date.now()*.03,R=25*bt*p,D=Math.sin(_*7)*R+Math.sin(_*13)*R*.5,W=Math.cos(_*11)*R+Math.cos(_*17)*R*.3;ln({x:D,y:W}),m=requestAnimationFrame(v)};return m=requestAnimationFrame(v),()=>cancelAnimationFrame(m)},[bt,p]);const[Wd,B0]=M.useState([]),$S=M.useRef(0),[Gd,z0]=M.useState(!1),[Vd,Bl]=M.useState(null),[Zo,$i]=M.useState(null),Lr=M.useRef(null),xr=M.useRef(null),Er=M.useRef(null),Yd=M.useRef(g.logs.length),zl=F.useRef(!1),H0=F.useRef(!1),Hl=F.useRef(null);F.useEffect(()=>{const m=n==="HOST"||(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&B,v=j?S&&x:S&&x&&dt==="DONE";if(console.log("[GameScreen INIT_GAME useEffect]",{isHostSide:m,isCasualOrRanked:j,connected:S,"adapter exists":!!x,coinTossPhase:dt,canSendInitGame:v,"initialStateSentRef.current":zl.current}),m&&v&&!zl.current){console.log("[GameScreen] HOST side: Sending initial game state to JOIN"),zl.current=!0;const _=()=>{console.log("[GameScreen] HOST side: Actually sending INIT_GAME now, isFirstPlayer:",is);const R=j?{...g,firstPlayerId:is?"p1":"p2"}:g;x.send({type:"INIT_GAME",payload:R}),(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&(console.log("[GameScreen] HOST side: Sending READY_FOR_INTRO"),x.send({type:"READY_FOR_INTRO"}),it.current=!0)};setTimeout(_,500),(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&setTimeout(()=>{Fe||(console.log("[GameScreen] HOST side: Retrying INIT_GAME (no response yet)"),_())},2500)}},[n,S,x,g,dt,B,j,Fe]),F.useEffect(()=>{!j||!x||!A||it.current||y&&(console.log("[GameScreen] JOIN side: Sending READY_FOR_INTRO after game sync"),x.send({type:"READY_FOR_INTRO"}),it.current=!0)},[j,x,A,y]),F.useEffect(()=>{!j||!x||!Ye||B&&Fe&&it.current&&(console.log("[GameScreen] HOST side: Both ready, sending START_INTRO"),x.send({type:"START_INTRO"}),Ae(!1),pe(!0))},[j,x,B,Fe,Ye]);const ie=g.players[O],Oe=g.players[T];F.useEffect(()=>{var v,_;const m=g.logs.length;if(m>Yd.current)for(let R=Yd.current;R<m;R++){const D=g.logs[R],W=D.match(/(.+?)  (\d+) /);if(W){const $=W[1],U=parseInt(W[2],10),V=(ie==null?void 0:ie.name)===$?O:T,ae=$S.current++;B0(Z=>[...Z,{playerId:V,amount:U,key:ae}]),setTimeout(()=>{B0(Z=>Z.filter(fe=>fe.key!==ae))},1500)}const q=D.match(/(.+?) (?:)?/);if(q){const $=q[1],U=(v=g.players[O])==null?void 0:v.board.find(fe=>(fe==null?void 0:fe.name)===$),V=(_=g.players[T])==null?void 0:_.board.find(fe=>(fe==null?void 0:fe.name)===$),ae=U||V,Z=U?O:T;if(ae){const fe=g.players[Z].board.findIndex(xe=>(xe==null?void 0:xe.instanceId)===ae.instanceId),Ge=(Z===O?br.current:rr.current)[fe];if(Ge){const xe=Ge.getBoundingClientRect(),ze=xe.left+xe.width/2,Qe=xe.top+xe.height/2;Zl(Ue=>[...Ue,{id:Date.now()+Math.random(),value:0,x:ze,y:Qe,color:"#e53e3e"}])}}}}Yd.current=m},[g.logs.length,O,T,ie==null?void 0:ie.name,g.players]);const[Kd,ea]=M.useState(!1),Dr=M.useRef(!1),_n=m_(((Em=g.players[O])==null?void 0:Em.board)||[],Dr),cn=m_(((bm=g.players[T])==null?void 0:bm.board)||[],Dr),ta=M.useRef(_n),Wl=M.useRef(cn),[ti,Gl]=M.useState(null),[Xd,W0]=M.useState(-1),Vl=M.useRef(null),[Fi,na]=M.useState([]),[J,Nr]=M.useState(null),[ct,Yn]=M.useState(null),[FS,G0]=M.useState([]),US=M.useRef(0),V0=M.useRef(0),Y0=M.useRef(null),K0=M.useRef(J);K0.current=J,M.useEffect(()=>{const m=J==null?void 0:J.sourceType;if(!m||m!=="BOARD"&&m!=="EVOLVE"){G0([]);return}const v=400,_=setInterval(()=>{const R=K0.current;if(!R||R.sourceType!=="BOARD"&&R.sourceType!=="EVOLVE")return;const D=Date.now(),W=Math.PI*(3-Math.sqrt(5));V0.current+=W+(Math.random()-.5)*.3;const q=V0.current,$=4+Math.random()*3,U={id:US.current++,x:R.currentX,y:R.currentY,vx:Math.cos(q)*$,vy:Math.sin(q)*$,opacity:1,radius:3+Math.random()*2,createdAt:D};G0(V=>[...V.filter(Z=>D-Z.createdAt<v).map(Z=>({...Z,x:Z.x+Z.vx,y:Z.y+Z.vy,opacity:Math.max(0,1-(D-Z.createdAt)/v)})),U])},80);return()=>clearInterval(_)},[J==null?void 0:J.sourceType]),M.useEffect(()=>{const m=(J==null?void 0:J.sourceType)==="EVOLVE";if(m&&!Er.current){const v=new Audio(Je("/se/aura.mp3"));v.loop=!0,v.volume=0,v.play().catch(()=>{}),Er.current=v;const _=300,R=30,D=_/R,W=.25/D;let q=0;const $=setInterval(()=>{q++,Er.current&&(Er.current.volume=Math.min(q*W,.25)),q>=D&&clearInterval($)},R)}else if(!m&&Er.current){const v=Er.current,_=200,R=20,D=_/R,W=v.volume/D;let q=0;const $=setInterval(()=>{q++,v.volume=Math.max(0,v.volume-W),q>=D&&(clearInterval($),v.pause(),v.currentTime=0)},R);Er.current=null}return()=>{!J&&Er.current&&(Er.current.pause(),Er.current=null)}},[J==null?void 0:J.sourceType]);const[X0,Qd]=M.useState(new Set),[Q0,Yl]=M.useState(null),[J0,Kl]=M.useState(null),[BS,q0]=M.useState(null),[Ne,Mr]=M.useState(null),Jd=M.useCallback(m=>{const v=Ur(m);v&&(g.winnerId?Hd(v):Mr({card:v,owner:"OPPONENT",source:"LOG"}))},[g.winnerId]),zS=M.useCallback(m=>{const v=/([^]+)/g,_=[];let R=0,D,W=0;const q=RS();for(;(D=v.exec(m))!==null;){D.index>R&&_.push(l.jsx("span",{children:m.slice(R,D.index)},W++));const $=D[1];q.includes($)?_.push(l.jsxs("span",{style:{color:"#ffd700",cursor:"pointer",textDecoration:"underline",textUnderlineOffset:"2px",fontWeight:"bold"},onMouseEnter:V=>{V.target.style.color="#ffec8b",V.target.style.textShadow="0 0 8px rgba(255, 215, 0, 0.8)"},onMouseLeave:V=>{V.target.style.color="#ffd700",V.target.style.textShadow="none"},onClick:V=>{V.stopPropagation(),Jd($)},children:["",$,""]},W++)):_.push(l.jsxs("span",{children:["",$,""]},W++)),R=D.index+D[0].length}return R<m.length&&_.push(l.jsx("span",{children:m.slice(R)},W++)),_.length>0?l.jsx(l.Fragment,{children:_}):m},[Jd]),[Xl,Ui]=M.useState([]),Bt=(m,v,_,R)=>{if(!m)return;let D=window.innerWidth/2,W=window.innerHeight/2;const q=v===T;if(_===void 0||_===-1){const U=q?zi:ri;if(U.current){const V=U.current.getBoundingClientRect(),ae=ce(V.left+V.width/2,V.top+V.height/2);D=ae.x,W=ae.y}else W=q?150:OS-250}else if(_!==void 0&&_>=0){const U=q?rr:br,V=q?Wl.current:ta.current;let ae=_;if(R){const fe=V.findIndex(ve=>ve&&ve.instanceId===R);fe>=0&&(ae=fe)}const Z=U.current[ae];if(Z){const fe=Z.getBoundingClientRect(),ve=ce(fe.left+fe.width/2,fe.top+fe.height/2);D=ve.x,W=ve.y}}Ui(U=>[...U,{type:m,x:D,y:W,key:Date.now()+Math.random()}])},Z0=(m,v,_,R,D)=>{let W=window.innerWidth/2,q=window.innerHeight/2;const $=m===T,U=$?rr:br,V=$?Wl.current:ta.current;let ae=v;if(D){const fe=V.findIndex(ve=>ve&&ve.instanceId===D);fe>=0&&(ae=fe)}const Z=U.current[ae];if(Z){const fe=Z.getBoundingClientRect(),ve=ce(fe.left+fe.width/2,fe.top+fe.height/2);W=ve.x,q=ve.y}Ui(fe=>[...fe,{type:"BUFF",x:W,y:q,key:Date.now()+Math.random(),atkBuff:_,hpBuff:R}])},nr=(m,v,_,R)=>{Bt(m,v,_,R),n==="HOST"&&S&&x&&x.send({type:"EFFECT",payload:{effectType:m,targetPlayerId:v||"",targetIndex:_??-1,targetInstanceId:R}})},ra=(m,v,_,R,D)=>{Z0(m,v,_,R,D),n==="HOST"&&S&&x&&x.send({type:"EFFECT",payload:{effectType:"BUFF",targetPlayerId:m,targetIndex:v,targetInstanceId:D,isBuff:!0,atkBuff:_,hpBuff:R}})},em=M.useRef([]),tm=M.useRef([]);M.useEffect(()=>{var R,D;const m=(W,q,$)=>{q.forEach(U=>{if(!U)return;if(!W.find(ae=>ae&&ae.instanceId===U.instanceId)&&U.killedByBane){const ae=$===T,Z=ae?rr:br,ve=(ae?Wl.current:ta.current).findIndex(Ge=>Ge&&Ge.instanceId===U.instanceId);if(ve>=0&&Z.current[ve]){const xe=Z.current[ve].getBoundingClientRect(),ze=ce(xe.left+xe.width/2,xe.top+xe.height/2);Ui(Qe=>[...Qe,{type:"BANE",x:ze.x,y:ze.y,key:Date.now()+Math.random()}])}}})},v=((R=g.players[O])==null?void 0:R.board)||[],_=((D=g.players[T])==null?void 0:D.board)||[];m(v,em.current,O),m(_,tm.current,T),em.current=v.map(W=>W?{...W}:null),tm.current=_.map(W=>W?{...W}:null)},[g.players,O,T]);const qd=600,[os,sa]=M.useState(null),Zd=M.useRef({player:0,opponent:0}),[Tt,ia]=M.useState(()=>{try{const m=localStorage.getItem("audioSettings");if(m){const v=JSON.parse(m);if(v.enabled!==void 0){const{enabled:_,...R}=v;return{...R,bgmEnabled:_,seEnabled:_}}return v}return{bgm:.3,se:.5,voice:.5,bgmEnabled:!0,seEnabled:!0}}catch{return{bgm:.3,se:.5,voice:.5,bgmEnabled:!0,seEnabled:!0}}}),gt=M.useCallback((m,v=.5)=>{if(!Tt.seEnabled)return;const _=new Audio(Je(`/se/${m}`));_.volume=Tt.se*v,_.play().catch(R=>console.warn("SE Play prevented",R))},[Tt]),Ql=M.useRef(null);M.useEffect(()=>{if(J&&ct&&!Ql.current)gt("Buon.mp3",.25);else if(J&&ct&&Ql.current){const m=Ql.current;(m.instanceId!==ct.instanceId||m.index!==ct.index||m.playerId!==ct.playerId)&&gt("Buon.mp3",.25)}Ql.current=ct},[ct,J,gt]);const xn=M.useRef(null),[HS,nm]=M.useState(!1);M.useEffect(()=>{localStorage.setItem("audioSettings",JSON.stringify(Tt)),xn.current&&(xn.current.volume=Tt.bgmEnabled?Tt.bgm:0,Tt.bgmEnabled?xn.current.paused&&xn.current.play().catch(m=>console.warn("Auto-play prevented",m)):xn.current.pause())},[Tt]);const[WS,Jl]=M.useState(!1),[GS,ef]=M.useState(!1),[VS,ql]=M.useState(!1),YS=M.useCallback(()=>{console.log("[GameScreen] handleSurrender called"),ql(!1),Jl(!1),n!=="CPU"&&x&&x.send({type:"SURRENDER",payload:{playerId:O}}),I({type:"CONCEDE",playerId:O})},[n,x,O]),[jr,tf]=M.useState(!1),nf=M.useRef(!1),[rm,sm]=M.useState(!1),[et,ni]=M.useState(null),Bi=M.useRef(null),zi=M.useRef(null),rr=M.useRef([]),br=M.useRef([]),ri=M.useRef(null),[KS,Zl]=M.useState([]),ec=M.useRef({player:20,opponent:20}),tc=M.useRef({player:0,opponent:0}),oa=M.useRef(new Map);M.useEffect(()=>{var D,W,q,$;if(!ie||!Oe)return;const m=ec.current.opponent-Oe.hp;m>0&&qo(U=>({...U,damageDealtToOpponent:U.damageDealtToOpponent+m}));const v=ec.current.player-ie.hp;v>0&&qo(U=>({...U,damageReceivedFromOpponent:U.damageReceivedFromOpponent+v}));const _=tc.current.opponent-(((D=Oe.board)==null?void 0:D.filter(U=>U).length)||0);_>0&&qo(U=>({...U,followersDestroyed:U.followersDestroyed+_}));const R=tc.current.player-(((W=ie.board)==null?void 0:W.filter(U=>U).length)||0);R>0&&qo(U=>({...U,myFollowersDestroyed:U.myFollowersDestroyed+R})),ec.current={player:ie.hp,opponent:Oe.hp},tc.current={player:((q=ie.board)==null?void 0:q.filter(U=>U).length)||0,opponent:(($=Oe.board)==null?void 0:$.filter(U=>U).length)||0}},[ie==null?void 0:ie.hp,Oe==null?void 0:Oe.hp,(Sm=ie==null?void 0:ie.board)==null?void 0:Sm.length,(Im=Oe==null?void 0:Oe.board)==null?void 0:Im.length]);const tn=M.useRef(null),im="lastPlayedBgm",om=M.useCallback(m=>{const v={AJA:[Je("/bgm/Green Misty Mountains.mp3"),Je("/bgm/Jade Moon.mp3"),Je("/bgm/amaama.mp3"),Je("/bgm/kingetsu.mp3")],SENKA:[Je("/bgm/ouka.mp3"),Je("/bgm/Jade Moon.mp3"),Je("/bgm/amaama.mp3"),Je("/bgm/kingetsu.mp3")]},_=v[m]||v.SENKA,R=sessionStorage.getItem(im),D=_.length>1?_.filter(q=>q!==R):_,W=D[Math.floor(Math.random()*D.length)];return sessionStorage.setItem(im,W),encodeURI(W)},[]),[rf,am]=M.useState(null);M.useEffect(()=>{var m,v;if(console.log(`[PendingEffects] useEffect fired. isProcessingEffect=${Kd}, pendingEffects.length=${((m=g.pendingEffects)==null?void 0:m.length)||0}, gameMode=${n}`),n==="JOIN"){console.log("[PendingEffects] Early return: JOIN mode waits for EFFECT messages from HOST");return}if(Kd){console.log("[PendingEffects] Early return: isProcessingEffect=true");return}if(g.pendingEffects&&g.pendingEffects.length>0){const _=g.pendingEffects[0];if(console.log(`[PendingEffects] Processing effect: ${_.effect.type} from ${_.sourceCard.name}`),Vl.current===_){console.log("[PendingEffects] Early return: same effect already processed");return}if(Vl.current=_,ea(!0),Dr.current=!0,_.effect.type==="GENERATE_CARD"&&_.effect.targetCardId){const he=[_],Y=g.pendingEffects||[];for(let Te=1;Te<Y.length;Te++){const ye=Y[Te];if(ye.effect.type==="GENERATE_CARD"&&ye.sourceCard.id===_.sourceCard.id&&ye.sourcePlayerId===_.sourcePlayerId)he.push(ye);else break}const oe=120,te=20,z=-(he.length*oe+(he.length-1)*te-oe)/2,ne=_.sourcePlayerId===O,ge=ne?window.innerWidth-200*p:200*p,Re=ne?window.innerHeight-100*p:100*p,Ee=he.map((Te,ye)=>({card:Ur(Te.effect.targetCardId),status:"APPEAR",targetX:ge,targetY:Re,xOffset:z+ye*(oe+te)})).filter(Te=>Te.card);if(Ee.length>0){na(Ee),tn.current&&clearTimeout(tn.current),tn.current=setTimeout(()=>{na(Te=>Te.map(ye=>({...ye,status:"FLY"}))),tn.current=setTimeout(()=>{na([]),ea(!1),Dr.current=!1,(n==="CPU"||n==="HOST")&&(he.forEach(Te=>{I({type:"RESOLVE_EFFECT",playerId:Te.sourcePlayerId,payload:{targetId:Te.targetId}})}),n==="HOST"&&S&&x&&setTimeout(()=>{const Te=qe.current;x.send({type:"GAME_STATE",payload:Te})},50)),tn.current=null},600)},800);return}}const R=_.effect.type==="DAMAGE"||_.effect.type==="AOE_DAMAGE"||_.effect.type==="RANDOM_DAMAGE"||_.effect.type==="RANDOM_DAMAGE_BY_TURN",D=_.effect.type==="DESTROY"||_.effect.type==="RANDOM_DESTROY",W=_.effect.type==="HEAL_LEADER",q=_.effect.type==="RANDOM_SET_HP",$=_.effect.type==="SET_MAX_HP",U=_.effect.type==="RETURN_TO_HAND",V=_.effect.type==="SUMMON_CARD"||_.effect.type==="SUMMON_CARD_RUSH",ae=_.effect.type==="VISUAL_BUFF_ONLY",Z=_.effect.type==="BUFF_STATS",fe=W||U||V||ae||Z?600:50;if(R){let he=_.sourceCard.attackEffectType||"SLASH";_.sourceCard.id==="c_alice"&&_.effect.targetType==="SELECT_FOLLOWER"&&(he="WATER");const Y=_.sourcePlayerId===O?T:O,oe=Y===O?_n:cn;if(_.effect.type==="AOE_DAMAGE")g.players[Y].board.forEach(se=>{if(se){const z=oe.findIndex(ne=>(ne==null?void 0:ne.instanceId)===se.instanceId);z!==-1&&nr(he,Y,z,se.instanceId)}});else if(_.targetIds)_.effect.type==="RANDOM_DAMAGE_BY_TURN"?_.targetIds.forEach((se,z)=>{setTimeout(()=>{const ne=oe.findIndex(ge=>(ge==null?void 0:ge.instanceId)===se);ne!==-1&&nr(he,Y,ne,se)},z*300)}):_.targetIds.forEach(te=>{const se=oe.findIndex(z=>(z==null?void 0:z.instanceId)===te);se!==-1&&nr(he,Y,se,te)});else if(_.effect.targetType==="OPPONENT")nr(he,Y,-1),$n();else if(_.targetId){const te=oe.findIndex(se=>(se==null?void 0:se.instanceId)===_.targetId);te!==-1&&nr(he,Y,te,_.targetId)}}else if(D){let he=_.sourceCard.attackEffectType||"IMPACT";const Y=_.sourcePlayerId===O?T:O,oe=Y===O?_n:cn;if(_.effect.targetType==="ALL_OTHER_FOLLOWERS"){oe.forEach((z,ne)=>{z&&z.instanceId!==_.sourceCard.instanceId&&nr(he,Y,ne,z.instanceId)});const te=_.sourcePlayerId;(te===O?_n:cn).forEach((z,ne)=>{z&&z.instanceId!==_.sourceCard.instanceId&&nr(he,te,ne,z.instanceId)}),$n()}else if(_.targetIds)_.targetIds.forEach(te=>{const se=oe.findIndex(z=>(z==null?void 0:z.instanceId)===te);se!==-1&&nr(he,Y,se,te)});else if(_.targetId){const te=oe.findIndex(se=>(se==null?void 0:se.instanceId)===_.targetId);te!==-1&&nr(he,Y,te,_.targetId)}}else if(W){const he=_.sourcePlayerId;nr("HEAL",he)}else if($){const he=_.sourcePlayerId===O?T:O;nr("RAY",he,-1),$n()}if(_.effect.type==="BUFF_STATS"){const he=_.effect.value??0,Y=_.effect.value2??0,oe=_.sourcePlayerId;if(_.effect.targetType==="SELF"){const se=(oe===O?_n:cn).findIndex(z=>(z==null?void 0:z.instanceId)===_.sourceCard.instanceId);se!==-1&&ra(oe,se,he,Y,_.sourceCard.instanceId)}else if(_.effect.targetType==="ALL_FOLLOWERS"){const te=oe===O?_n:cn,se=g.players[oe].board,z=_.effect.conditions;se.forEach(ne=>{var ge;if(ne){if(z!=null&&z.tag&&!((ge=ne.tags)!=null&&ge.includes(z.tag))||z!=null&&z.nameIn&&!z.nameIn.includes(ne.name))return;const Re=te.findIndex(Ee=>(Ee==null?void 0:Ee.instanceId)===ne.instanceId);Re!==-1&&ra(oe,Re,he,Y,ne.instanceId)}})}else if(_.effect.targetType==="ALL_OTHER_FOLLOWERS"){const te=oe===O?_n:cn,se=g.players[oe].board,z=_.effect.conditions;se.forEach(ne=>{var ge;if(ne&&ne.instanceId!==_.sourceCard.instanceId){if(z!=null&&z.tag&&!((ge=ne.tags)!=null&&ge.includes(z.tag))||z!=null&&z.nameIn&&!z.nameIn.includes(ne.name))return;const Re=te.findIndex(Ee=>(Ee==null?void 0:Ee.instanceId)===ne.instanceId);Re!==-1&&ra(oe,Re,he,Y,ne.instanceId)}})}else if(_.targetId){const se=(oe===O?_n:cn).findIndex(z=>(z==null?void 0:z.instanceId)===_.targetId);se!==-1&&ra(oe,se,he,Y,_.targetId)}}if(ae){const he=_.effect.value??0,Y=_.effect.value2??0,oe=_.sourcePlayerId,te=_.sourceCard;setTimeout(()=>{const se=oe===O?_n:cn;if(te!=null&&te.instanceId){const z=se.findIndex(ne=>(ne==null?void 0:ne.instanceId)===te.instanceId);z!==-1&&ra(oe,z,he,Y,te.instanceId)}},300)}tn.current&&clearTimeout(tn.current);const Ge=R||D||q||$,xe=_.effect.type==="RANDOM_DAMAGE_BY_TURN",ze=xe?((v=_.targetIds)==null?void 0:v.length)||g.turnCount:1,Qe=xe?ze*300+300:0,Ue=xe?Qe:Ge?700:fe,Be=xe?200:Ge?700:0;tn.current=setTimeout(()=>{(n==="CPU"||n==="HOST")&&(I({type:"RESOLVE_EFFECT",playerId:_.sourcePlayerId,payload:{targetId:_.targetId}}),n==="HOST"&&S&&x&&setTimeout(()=>{const he=qe.current;x.send({type:"GAME_STATE",payload:he})},50)),Be>0?tn.current=setTimeout(()=>{ea(!1),Dr.current=!1,tn.current=null},Be):(ea(!1),Dr.current=!1,tn.current=null)},Ue)}else Vl.current=null,tn.current&&(clearTimeout(tn.current),tn.current=null)},[g.pendingEffects,Kd,O,T,n,S,x]),M.useEffect(()=>{if(g.activePlayerId!==O)return;const m=O===g.firstPlayerId,v=g.turnCount,_=m?5:4;if(v===(m?7:6)){if(Xd===v)return;Gl("SUPER_EVOLVE_READY"),W0(v),setTimeout(()=>Gl(null),2500)}else if(v===_){if(Xd===v)return;Gl("EVOLVE_READY"),W0(v),setTimeout(()=>Gl(null),2500)}},[g.turnCount,g.activePlayerId,O,Xd,g.firstPlayerId]);const nc=M.useRef(g.players);M.useEffect(()=>{const m=nc.current,v=new Set;if(Object.keys(g.players).forEach(_=>{const R=g.players[_],D=m[_];if(!D)return;const W=new Set(D.board.filter($=>$).map($=>$.instanceId)),q=new Set(D.hand.filter($=>$).map($=>$.instanceId));R.board.forEach($=>{if(!$)return;const U=$.instanceId;!W.has(U)&&!q.has(U)&&v.add(U)})}),v.size>0){Qd(R=>new Set([...R,...v]));const _=setTimeout(()=>{Qd(new Set)},1e3);return()=>clearTimeout(_)}},[g.players]),M.useEffect(()=>{const m=nc.current,v=g.players;let _=[];const R=D=>{const W=D.getBoundingClientRect();return{x:W.left+W.width/2,y:W.top+W.height/2}};Object.keys(v).forEach(D=>{const W=v[D],q=m[D];if(q&&W.hp<q.hp){const $=q.hp-W.hp,V=D===O?ri.current:zi.current;if(V){const ae=R(V);_.push({id:Date.now()+Math.random(),value:$,x:ae.x,y:ae.y,color:"#e53e3e"})}}else if(q&&W.hp>q.hp){const $=W.hp-q.hp,V=D===O?ri.current:zi.current;if(V){const ae=R(V);_.push({id:Date.now()+Math.random(),value:"+"+$,x:ae.x,y:ae.y,color:"#48bb78"})}}q==null||q.board.forEach($=>{if(!$)return;const U=W.board.find(V=>(V==null?void 0:V.instanceId)===$.instanceId);if(U){const V=W.board.findIndex(ve=>(ve==null?void 0:ve.instanceId)===U.instanceId),fe=(D===O?br.current:rr.current)[V];if(fe){const ve=R(fe);if(oa.current.set($.instanceId,ve),U.currentHealth<$.currentHealth){const Ge=$.currentHealth-U.currentHealth;_.push({id:Date.now()+Math.random(),value:Ge,x:ve.x,y:ve.y,color:"#e53e3e"})}else if(U.currentHealth>$.currentHealth){const Ge=U.hasEvolved&&!$.hasEvolved,xe=U.currentAttack!==$.currentAttack||U.maxHealth!==$.maxHealth;if(!Ge&&!xe){const ze=U.currentHealth-$.currentHealth;_.push({id:Date.now()+Math.random(),value:"+"+ze,x:ve.x,y:ve.y,color:"#48bb78"})}}else U.currentHealth===$.currentHealth&&$.hasBarrier&&!U.hasBarrier&&_.push({id:Date.now()+Math.random(),value:0,x:ve.x,y:ve.y,color:"#e53e3e"})}}else{const V=W.graveyard.find(Z=>Z.instanceId===$.instanceId);let ae=0;if(V){const Z=V.currentHealth||0;Z<=0?ae=$.currentHealth-Z:ae=0}else ae=$.currentHealth;if(ae>0){const Z=oa.current.get($.instanceId);Z&&(Z.x!==0||Z.y!==0)&&_.push({id:Date.now()+Math.random(),value:ae,x:Z.x,y:Z.y,color:"#e53e3e"})}oa.current.delete($.instanceId)}})}),_.length>0&&(Zl(W=>[...W,..._]),_.some(W=>W.color!=="#48bb78")&&$n()),nc.current=v},[g.players,O,T]);const sf=M.useRef(null),$n=()=>{sf.current||(sm(!0),sf.current=setTimeout(()=>{sm(!1),sf.current=null},300))},of=F.useCallback(m=>{Zl([]),Ui([]),na([]),Fn(null),Hi(null),sa(null),Qd(new Set),as.current=!1,af.current=null,qo({turnCount:0,damageDealtToOpponent:0,damageReceivedFromOpponent:0,followersDestroyed:0,myFollowersDestroyed:0}),ec.current={player:20,opponent:20},tc.current={player:0,opponent:0},Hd(null),Ie(!1),Ze(!1),ot(null),D0(!1),M0(!1);const v=m||_r;m&&$0(m);let _=C;e==="CPU"&&(v==="YORUKA"?_=Math.random()<.5?"SENKA":"AJA":_=v==="SENKA"?"AJA":"SENKA");const D=su(d,v,e==="ONLINE"?"":"CPU",_);nc.current=D.players,Zd.current={player:D.players.p1.hand.length,opponent:D.players.p2.hand.length},am(null),pe(n!=="JOIN"),L0(Math.random()>.5),vn("IDLE"),ji(null),zd(!1),n==="HOST"&&(zl.current=!1),I({type:"SYNC_STATE",payload:D})},[_r,C,e,n]),XS=F.useCallback(()=>{if(pe(!1),ke(!1),X(!0),ji(is?"FIRST":"SECOND"),!is){const m={...g,activePlayerId:"p2",firstPlayerId:"p2",players:{p1:{...g.players.p1,maxPp:0,pp:0},p2:{...g.players.p2,maxPp:1,pp:1}},logs:[` 1 - ${g.players.p2.name} `]};I({type:"SYNC_STATE",payload:m})}vn("DONE")},[g,is]);F.useEffect(()=>{},[g.phase,dt,n,gt,S]),M.useEffect(()=>{if(rf===ie.class&&xn.current)return;const m=om(ie.class);console.log(`[BGM] Initializing track: ${m} for class: ${ie.class}`),xn.current&&(xn.current.pause(),xn.current=null);const v=new Audio(m);v.loop=!0,v.volume=Tt.bgm,xn.current=v,am(ie.class)},[ie.class,om,rf]),M.useEffect(()=>()=>{xn.current&&(console.log("[GameScreen] Stopping BGM on unmount"),xn.current.pause(),xn.current=null)},[]),M.useEffect(()=>{if(!xn.current)return;const m=xn.current,v=()=>{m.paused&&Tt.bgmEnabled&&(console.log("[BGM] Attempting play on interaction..."),m.play().then(()=>{console.log("[BGM] Play success"),_()}).catch(R=>console.warn("[BGM] Play failed on interaction:",R)))},_=()=>{document.removeEventListener("click",v),document.removeEventListener("keydown",v),document.removeEventListener("touchstart",v)};return Tt.bgmEnabled?(document.addEventListener("click",v),document.addEventListener("keydown",v),document.addEventListener("touchstart",v),m.play().then(()=>{console.log("[BGM] Immediate play success"),_()}).catch(()=>console.log("[BGM] Immediate play blocked, waiting for interaction"))):(m.pause(),_()),()=>{_()}},[Tt.bgmEnabled,Tt.bgm,rf]),F.useEffect(()=>{if(!x){console.log("[GameScreen] Message handler setup skipped - no adapter yet");return}console.log("[GameScreen] Setting up message handler, adapter.isHost:",x.isHost);const m=v=>{var _,R,D,W,q;if(console.log("[GameScreen] Received message:",v.type,v),v.type==="HANDSHAKE"){const $=(_=v.payload)==null?void 0:_.name,U=typeof $=="string"&&$.trim().slice(0,12)||"";console.log("[GameScreen] Received HANDSHAKE from opponent:",U),Hl.current=U,I({type:"UPDATE_PLAYER_NAME",payload:{playerId:O==="p1"?"p2":"p1",name:U}});return}if(v.type==="INIT_GAME"){console.log("[GameScreen] JOIN side: Received initial game state from HOST"),I({type:"SYNC_STATE",payload:v.payload}),I({type:"UPDATE_PLAYER_NAME",payload:{playerId:O,name:d}});const $=O==="p1"?"p2":"p1";Hl.current&&(console.log("[GameScreen] Re-applying opponent name after INIT_GAME:",Hl.current),I({type:"UPDATE_PLAYER_NAME",payload:{playerId:$,name:Hl.current}})),L(!0);const U=v.payload.firstPlayerId===O;console.log("[GameScreen] JOIN side: Setting isFirstPlayer, firstPlayerId:",v.payload.firstPlayerId,"currentPlayerId:",O,"isJoinSideFirst:",U),L0(U),n==="CASUAL_MATCH"||n==="RANKED_MATCH"?console.log("[GameScreen] CASUAL_MATCH JOIN side: Waiting for intro sync"):pe(!0);return}if(v.type==="READY_FOR_INTRO"){console.log("[GameScreen] Received READY_FOR_INTRO from opponent"),Et(!0);return}if(v.type==="START_INTRO"){console.log("[GameScreen] Received START_INTRO - starting BattleIntro now"),Ae(!1),pe(!0);return}if(v.type==="GAME_STATE"){console.log("[GameScreen] JOIN: Received GAME_STATE sync from HOST"),I({type:"SYNC_STATE",payload:v.payload}),ea(!1),Dr.current=!1,Vl.current=null,na([]),tn.current&&(clearTimeout(tn.current),tn.current=null),!la.current&&!Gi.current&&(un.current=!1);return}if(v.type==="EFFECT"){const{effectType:$,targetPlayerId:U,targetIndex:V,targetInstanceId:ae,isBuff:Z,atkBuff:fe,hpBuff:ve}=v.payload;console.log("[GameScreen] JOIN: Received EFFECT from HOST:",$,U,V,ae),setTimeout(()=>{Z&&fe!==void 0&&ve!==void 0?Z0(U,V,fe,ve,ae):Bt($,U,V,ae)},50);return}if(v.type==="EVOLVE_ANIM"){const{playerId:$,followerIndex:U,useSep:V,targetId:ae,instanceId:Z}=v.payload,fe=(R=g.players[$])==null?void 0:R.board[U];if(fe){const ve=fe.evolvedImageUrl||((D=Ur(fe.id))==null?void 0:D.evolvedImageUrl),Ge=Z||fe.instanceId,xe=cn.findIndex(Y=>Y&&Y.instanceId===Ge),ze=xe>=0?rr.current[xe]:null,Qe=de.current.scale,Ue=window.innerHeight/2;let Be=window.innerWidth/2,he=Ue-70*Qe;if(ze){const Y=ze.getBoundingClientRect();Be=Y.left+Y.width/2,he=Y.top+Y.height/2}Hi({card:fe,evolvedImageUrl:ve,startX:Be,startY:he,phase:"ZOOM_IN",followerIndex:U,sourcePlayerId:$,useSep:V||!1,targetId:ae,isRemote:!0}),gt("fon.mp3",.7)}return}if(v.type==="PLAY_CARD_ANIM"){const{playerId:$,card:U,targetBoardIndex:V}=v.payload;if(U){const ae=((W=g.players[$])==null?void 0:W.board)||[],Z=typeof V=="number"?V:ae.filter(z=>z!==null).length,fe=de.current.scale,ve=window.innerWidth/2,Ge=window.innerHeight/2,xe=ve,ze=80*fe,Qe=ve,Ue=Ge-100*fe,oe=-((Math.max(1,Z+1)-1)*ii*fe)/2+Z*ii*fe,te=ve+oe,se=Ge-70*fe;U.type==="SPELL"?Fn({card:U,sourceIndex:-1,startX:xe,startY:ze,targetX:Qe,targetY:Ue,playerClass:(Oe==null?void 0:Oe.class)||"SENKA",onComplete:()=>{Fn(null)}}):Fn({card:U,sourceIndex:-1,startX:xe,startY:ze,targetX:Qe,targetY:Ue,finalX:te,finalY:se,playerClass:(Oe==null?void 0:Oe.class)||"SENKA",onComplete:()=>{gt("gan.mp3",.6),$n(),Fn(null)}})}return}if(v.type==="REMATCH_REQUEST"){console.log("[GameScreen] Opponent requested rematch"),M0(!0);return}if(v.type==="REMATCH_ACCEPT"){console.log("[GameScreen] Opponent accepted rematch - starting new game"),of(_r);return}if(v.type==="SURRENDER"){const $=(q=v.payload)==null?void 0:q.playerId;if(g.phase==="GAME_OVER"){console.warn("[GameScreen] Ignoring SURRENDER - game already over");return}if($===O){console.warn(`[GameScreen] Security Alert: Received SURRENDER message targeting self (${O}). Ignoring.`);return}if($!==T){console.warn(`[GameScreen] Security Alert: Invalid playerId in SURRENDER: ${$}. Expected: ${T}. Ignoring.`);return}console.log("[GameScreen] Opponent surrendered:",$),j0("surrender"),I({type:"CONCEDE",playerId:$});return}if(v.type==="STAMP"){console.log("[GameScreen] Opponent sent stamp:",v.stampId),xr.current&&(clearTimeout(xr.current),xr.current=null);const $=l_(v.stampId);$&&gt($,.6);const U={stampId:v.stampId,playerId:T,playerClass:v.playerClass||(Oe==null?void 0:Oe.class)||"SENKA",timestamp:Date.now()};$i(null),requestAnimationFrame(()=>{$i(U)}),xr.current=setTimeout(()=>{$i(V=>(V==null?void 0:V.timestamp)===U.timestamp?null:V),xr.current=null},3e3);return}if(v.type==="ACTION"){const $=v.payload;if(console.log("[GameScreen] Processing remote action:",$.type,"from player:",$.playerId),I({...$,isRemote:!0}),$.type==="ATTACK"){const{playerId:U,payload:V}=$,ae=g.players[U],Z=ae==null?void 0:ae.board[V.attackerIndex],fe=V.targetIsLeader?-1:V.targetIndex,ve=U==="p1"?"p2":"p1";if(Z){const Ge=g.players[ve],xe=V.targetIsLeader?null:Ge==null?void 0:Ge.board[V.targetIndex],ze=xe?xe.instanceId:void 0;Bt(Z.attackEffectType,ve,fe,ze)}}else $.type==="PLAY_CARD"||$.type==="EVOLVE"||$.type==="END_TURN"&&(console.log("[GameScreen] Remote END_TURN received, turn switching to:",$.playerId==="p1"?"p2":"p1"),Wi.current=!1)}};return x.onMessage(m),n!=="CPU"&&!H0.current&&(H0.current=!0,x.send({type:"HANDSHAKE",payload:{name:d,class:t}}),console.log("[GameScreen] Sent HANDSHAKE:",d,t)),x.onClose(()=>{if((n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&g.phase==="GAME_OVER"){console.log("[GameScreen] Connection closed after game over (casual match) - silent disconnect");return}if(n!=="CPU"&&g.phase!=="GAME_OVER"){console.log("[GameScreen] Opponent disconnected during game - treating as surrender, player wins"),j0("disconnect");const v={...g,phase:"GAME_OVER",winnerId:O,logs:[...g.logs,""]};I({type:"SYNC_STATE",payload:v});return}alert(`
`),s()}),()=>{}},[x,g,gt,Bt,n,s,O]);const as=M.useRef(!1),af=M.useRef(null),Rn=M.useRef(null),[We,Fn]=M.useState(null),[Rt,Hi]=M.useState(null),un=M.useRef(!1),aa=M.useRef(null),Wi=M.useRef(!1),lf=M.useRef(Xl),cf=M.useRef(Fi),la=M.useRef(We),Gi=M.useRef(Rt);F.useEffect(()=>{lf.current=Xl,cf.current=Fi,la.current=We,Gi.current=Rt},[Xl,Fi,We,Rt]),F.useEffect(()=>{if(We&&We.card.name===""&&Tt.seEnabled){const m=new Audio(Je("/se/beam.mp3"));m.volume=Tt.se*.8,m.play().catch(v=>console.warn("SE Play prevented",v))}},[We,Tt]),F.useEffect(()=>{ta.current=_n,Wl.current=cn},[_n,cn]),F.useEffect(()=>{const m=v=>{const _=v.getBoundingClientRect();return{x:_.left+_.width/2,y:_.top}};_n.forEach((v,_)=>{if(v&&v.instanceId){const R=br.current[_];if(R){const D=m(R);(D.x!==0||D.y!==0)&&oa.current.set(v.instanceId,D)}}}),cn.forEach((v,_)=>{if(v&&v.instanceId){const R=rr.current[_];if(R){const D=m(R);(D.x!==0||D.y!==0)&&oa.current.set(v.instanceId,D)}}})},[_n,cn]);const rc=(m,v,_,R)=>{const D=Sr.current.board,W=R?D.findIndex(Z=>Z&&Z.instanceId===R):m,q=W>=0?D[W]:null;if(!q)return;if(q.hasEvolved){console.log("[GameScreen] Cannot evolve: card already evolved");return}const $=br.current[m];let U=window.innerWidth/2,V=window.innerHeight/2;if($){const Z=$.getBoundingClientRect();U=Z.left+Z.width/2,V=Z.top+Z.height/2}const ae=q.instanceId;n!=="CPU"&&S&&x&&x.send({type:"EVOLVE_ANIM",payload:{playerId:O,followerIndex:W,useSep:v,targetId:_,instanceId:ae}}),Hi({card:q,evolvedImageUrl:q.evolvedImageUrl,startX:U,startY:V,phase:"ZOOM_IN",followerIndex:W,useSep:v,targetId:_,sourcePlayerId:O}),gt("fon.mp3",.7)},uf=M.useRef(null),QS=M.useCallback(m=>{if(console.log("[GameScreen] handleEvolvePhaseChange:",m),m==="WHITE_FADE"&&gt("fon.mp3",.7),m==="LAND"&&gt("gan.mp3",.6),m==="DONE"){const v=Gi.current;if(v&&!v.isRemote){const R={type:"EVOLVE",playerId:v.sourcePlayerId||O,payload:{followerIndex:v.followerIndex,useSep:v.useSep,targetId:v.targetId}};I(R),x&&n!=="CPU"&&x.send({type:"ACTION",payload:R})}Hi(null)}else Hi(v=>v?{...v,phase:m}:null)},[x,I,n,O,gt]),df=(m,v,_)=>{var Be,he,Y,oe,te,se;const D=Sr.current.hand[m];if(!D){console.warn("[handlePlayCard] Card not found at index:",m);return}if(D.instanceId&&aa.current===D.instanceId){console.warn("[handlePlayCard] Duplicate play blocked for instanceId:",D.instanceId);return}if(un.current){console.warn("[handlePlayCard] Card play locked, ignoring duplicate call");return}un.current=!0,aa.current=D.instanceId||null,gt("card.mp3",.5);const W=(Be=D.triggers)==null?void 0:Be.find(z=>z.trigger==="FANFARE"),q=W==null?void 0:W.effects[0];let $=T;const U=(q==null?void 0:q.targetType)==="SELECT_ALLY_FOLLOWER"||(q==null?void 0:q.targetType)==="SELECT_OTHER_ALLY_FOLLOWER";q&&(U||["GRANT_PASSIVE","BUFF_STATS","HEAL_FOLLOWER"].includes(q.type))&&($=O);const V=["SELECT_FOLLOWER","SELECT_ALLY_FOLLOWER","SELECT_OTHER_ALLY_FOLLOWER"],ae=D.type==="SPELL"&&((he=D.triggers)==null?void 0:he.some(z=>z.effects.some(ne=>ne.targetType&&V.includes(ne.targetType))))||D.type==="FOLLOWER"&&(((oe=(Y=D.triggerAbilities)==null?void 0:Y.FANFARE)==null?void 0:oe.targetType)&&V.includes(D.triggerAbilities.FANFARE.targetType)||((te=D.triggers)==null?void 0:te.some(z=>z.trigger==="FANFARE"&&z.effects.some(ne=>ne.targetType&&V.includes(ne.targetType))))),fe=qe.current.players[$].board.some(z=>{var ne,ge;return z&&($===O||!((ne=z.passiveAbilities)!=null&&ne.includes("STEALTH"))&&!((ge=z.passiveAbilities)!=null&&ge.includes("AURA")))});if(console.log(`[handlePlayCard] needsTarget: ${ae}, allowedTarget: ${$}, hasValidTargets: ${fe}`),ae&&fe){ni({type:"PLAY",sourceIndex:m,sourceInstanceId:D.instanceId,allowedTargetPlayerId:$}),Nr(null);return}const ve=window.innerWidth/2,Ge=window.innerHeight/2;let xe,ze;if(D.type==="FOLLOWER"){const ne=qe.current.players[O].board.filter(Ce=>Ce!==null),ge=ne.length+1,Re=ne.length,Ee=ii*p,Te=(Re-(ge-1)/2)*Ee,ye=(se=Bi.current)==null?void 0:se.getBoundingClientRect();xe=(ye?ye.left+ye.width/2:window.innerWidth/2)+Te,ze=window.innerHeight/2+70*p}const Qe=()=>{D.type!=="SPELL"&&(gt("gan.mp3",.6),$n()),ls({type:"PLAY_CARD",playerId:O,payload:{cardIndex:m,instanceId:D.instanceId}}),Fn(null),setTimeout(()=>{un.current=!1},100)},Ue=D.type==="FOLLOWER"?qe.current.players[O].board.filter(z=>z!==null).length:void 0;n!=="CPU"&&S&&x&&x.send({type:"PLAY_CARD_ANIM",payload:{playerId:O,cardIndex:m,card:D,targetBoardIndex:Ue}}),Fn({card:D,sourceIndex:m,startX:v,startY:_,targetX:ve,targetY:Ge,finalX:xe,finalY:ze,playerClass:(ie==null?void 0:ie.class)||"SENKA",onComplete:Qe}),setTimeout(()=>{Fn(z=>(z==null?void 0:z.card.id)===D.id?(Qe(),null):z)},2e3)},ls=m=>{I(m),n!=="CPU"&&S&&!m.isRemote&&(x==null||x.send({type:"ACTION",payload:m}))};M.useEffect(()=>{if(!Rt&&uf.current){const m=uf.current;uf.current=null,console.log("[GameScreen] Dispatching pending evolve action for:",m.playerId),ls({type:"EVOLVE",playerId:m.playerId,payload:{followerIndex:m.followerIndex,useSep:m.useSep,targetId:m.targetId}})}},[Rt,O,ls]);const Sr=M.useRef(ie),qe=M.useRef(g);M.useEffect(()=>{Sr.current=ie,qe.current=g},[ie,g]);const sr=M.useRef(!1);M.useEffect(()=>{const m=Zd.current,v=ie.hand.length,_=Oe.hand.length;if(v>m.player){const R=v-m.player;sa({isPlayer:!0,count:R}),gt("card.mp3",.5),setTimeout(()=>sa(null),qd)}if(_>m.opponent){const R=_-m.opponent;sa({isPlayer:!1,count:R}),gt("card.mp3",.5),setTimeout(()=>sa(null),qd)}Zd.current={player:v,opponent:_}},[ie.hand.length,Oe.hand.length,Tt,gt]),F.useEffect(()=>{g.activePlayerId===O&&(console.log("[GameScreen] Player turn started - resetting card play lock and ending turn state"),un.current=!1,aa.current=null,Wi.current=!1)},[g.activePlayerId,g.turnCount,O]),F.useEffect(()=>{if(n==="CPU")return;const m=setInterval(()=>{un.current&&!la.current&&!Gi.current&&!et&&g.activePlayerId===O&&(console.warn("[GameScreen] Safety release: Card play lock was stuck, releasing"),un.current=!1)},3e3);return()=>clearInterval(m)},[n,et,g.activePlayerId,O]),F.useEffect(()=>{if(n!=="CPU")return;if(g.winnerId){as.current=!1;return}const m=`${g.turnCount}-${g.activePlayerId}`;if(g.activePlayerId===O){as.current=!1;return}if(g.activePlayerId===T){if(as.current||af.current===m)return;(async()=>{var xe,ze,Qe,Ue,Be,he;as.current=!0,af.current=m;const _=async(Y=300)=>{await new Promise(se=>setTimeout(se,Y));const oe=()=>{const se=qe.current,z=se.pendingEffects&&se.pendingEffects.length>0,ne=lf.current.length>0,ge=cf.current.length>0,Re=la.current!==null,Ee=Gi.current!==null;return!z&&!ne&&!ge&&!Re&&!Ee};let te=0;for(;!oe()&&te<60;){await new Promise(z=>setTimeout(z,100)),te++;const se=qe.current;if(se.pendingEffects&&se.pendingEffects.length>0&&!Dr.current){console.log("[waitForIdle] Forcing RESOLVE_EFFECT for stuck pending effect");const z=se.pendingEffects[0];I({type:"RESOLVE_EFFECT",playerId:z.sourcePlayerId,payload:{targetId:z.targetId}}),await new Promise(ne=>setTimeout(ne,200))}}},R=(Y,oe)=>{var te;return Y?!!((te=Y.passiveAbilities)!=null&&te.includes("IMMUNE_TO_FOLLOWER_DAMAGE")):!1},D=(Y,oe)=>{var te;return!oe||!Y?!1:(te=oe.passiveAbilities)!=null&&te.includes("BANE")&&!Y.hasBarrier?!0:(oe.currentAttack||0)>=Y.currentHealth},W=(Y,oe)=>{var te;return!oe||!Y?!1:(te=Y.passiveAbilities)!=null&&te.includes("BANE")?!oe.hasBarrier:Y.currentAttack>=oe.currentHealth},q=Y=>{var ne,ge,Re;let oe=0;const te=Y.players[T].board.filter(Ee=>Ee!==null),z=Y.players[O].board.filter(Ee=>Ee!==null).some(Ee=>{var Te,ye;return((Te=Ee.passiveAbilities)==null?void 0:Te.includes("WARD"))&&!((ye=Ee.passiveAbilities)!=null&&ye.includes("STEALTH"))});for(const Ee of te)!Ee.canAttack||!((ne=Ee.passiveAbilities)!=null&&ne.includes("STORM")||Ee.turnPlayed!==Y.turnCount)||z&&!((ge=Ee.passiveAbilities)!=null&&ge.includes("STEALTH"))&&!Ee.hadStealth||(oe+=Ee.currentAttack||0,(Re=Ee.passiveAbilities)!=null&&Re.includes("DOUBLE_ATTACK")&&(oe+=Ee.currentAttack||0));return oe},$=Y=>{var se,z,ne;let oe=0;const te=Y.players[O].board.filter(ge=>ge!==null);for(const ge of te)oe+=ge.currentAttack||0,(se=ge.passiveAbilities)!=null&&se.includes("DOUBLE_ATTACK")&&(oe+=ge.currentAttack||0),(z=ge.passiveAbilities)!=null&&z.includes("BANE")&&(oe+=15),(ne=ge.passiveAbilities)!=null&&ne.includes("STORM")&&(oe+=10);return oe},U=(Y,oe)=>{var Te,ye,Ve,Ce;let te=Y.cost*10;const se=oe.players[O].board.filter(De=>De!==null),z=oe.players[T].board.filter(De=>De!==null),ne=oe.players[O].hp,ge=oe.players[T].hp,Re=oe.players[T].pp;if((Te=Y.passiveAbilities)!=null&&Te.includes("STORM")){const De=q(oe),Le=Y.attack||0;De+Le>=ne?te+=500:ne<=10?te+=100:te+=30}if(se.length>0){const De=Y.triggers||[],Le=$(oe);for(const _t of De)if(_t.trigger==="FANFARE")for(const Me of _t.effects||[]){if(Me.type==="DESTROY"&&(te+=60+(Le>10?30:0)),Me.type==="RANDOM_DESTROY"){const Ke=Me.value||1;te+=40*Ke+(Le>10?20:0)}["DAMAGE","SELECT_DAMAGE"].includes(Me.type)&&(te+=35),Me.type==="AOE_DAMAGE"&&(te+=25*Math.min(se.length,3))}}ge<=10&&((ye=Y.passiveAbilities)!=null&&ye.includes("WARD")&&(te+=80),te+=20),Y.cost===Re?te+=15:Re-Y.cost<=1&&(te+=10);const Ee=Y.triggers||[];for(const De of Ee)if(De.trigger==="FANFARE")for(const Le of De.effects||[])Le.type==="DRAW"&&(te+=20*(Le.value||1)),(Le.type==="SUMMON_CARD"||Le.type==="SUMMON_CARD_RUSH")&&(te+=30),Le.type==="GENERATE_CARD"&&(te+=15),Le.type==="HEAL"&&(te+=ge<15?25:10);return Y.type==="FOLLOWER"&&((Y.attack||0)+(Y.health||0)>=Y.cost*2.5&&(te+=15),(Ve=Y.passiveAbilities)!=null&&Ve.includes("WARD")&&se.length>0&&(te+=25),(Ce=Y.passiveAbilities)!=null&&Ce.includes("BANE")&&(te+=20)),Y.type==="FOLLOWER"&&z.length>=5&&(te-=200),te},V=(Y,oe,te,se)=>{let z=0;const ne=te.players[O].board.filter(ye=>ye!==null),ge=te.players[T].board.filter(ye=>ye!==null),Re=Y.triggers||[],Ee=se?"SUPER_EVOLVE":"EVOLVE";let Te=!1;for(const ye of Re)if(ye.trigger===Ee){Te=!0;for(const Ve of ye.effects||[]){if(["DESTROY","RANDOM_DESTROY","DAMAGE","SELECT_DAMAGE","AOE_DAMAGE"].includes(Ve.type)&&(z+=ne.length>0?80:5),["SUMMON_CARD","SUMMON_CARD_RUSH"].includes(Ve.type)&&(z+=60),Ve.type==="BUFF_STATS"){const Ce=Ve.targetType||"SELF";Ce==="ALL_OTHER_FOLLOWERS"||Ce==="ALL_FOLLOWERS"?z+=25*Math.max(1,ge.length-1):z+=30}Ve.type==="DRAW"&&(z+=35),Ve.type==="GENERATE_CARD"&&(z+=25)}}return Y.canAttack?(z+=30,z+=(Y.currentAttack||0)*5):z+=(Y.currentAttack||0)*2,Y.cost>=6&&Te&&(z+=20),!Te&&Y.cost<=3&&(z-=30),z},ae=(Y,oe)=>{const se=Y.players[T].board.filter(Ce=>Ce!==null),z=Y.players[O].board.filter(Ce=>Ce!==null),ne=Y.players[O].hp,ge=Y.players[T].hp,Re=Y.turnCount,Ee=se.filter(Ce=>Ce&&!Ce.hasEvolved);if(Ee.length===0)return!1;const Te=Ee.map((Ce,De)=>({c:Ce,i:De,score:V(Ce,De,Y,oe)})),ye=Math.max(...Te.map(Ce=>Ce.score));if(ne<=12&&se.some(Ce=>Ce&&Ce.canAttack)||ge<=10)return!0;const Ve=$(Y);return Ve>=8&&Ee.some(De=>{const Le=De.triggers||[];for(const _t of Le)if(_t.trigger===(oe?"SUPER_EVOLVE":"EVOLVE")){for(const Me of _t.effects||[])if(["DESTROY","RANDOM_DESTROY","DAMAGE","AOE_DAMAGE"].includes(Me.type))return!0}return!1})&&z.length>0||ye>=80||oe&&ye>=50?!0:Re<=5&&ge>=15&&Ve<8?ye>=100:ye<30?!1:ye>=50},Z=(Y,oe,te)=>{var Re,Ee,Te,ye,Ve;const se=((Re=Y.passiveAbilities)==null?void 0:Re.includes("STORM"))||Y.turnPlayed!==te.turnCount,z=oe.map((Ce,De)=>({c:Ce,i:De})).filter(({c:Ce})=>{var De,Le;return Ce!==null&&!((De=Ce.passiveAbilities)!=null&&De.includes("STEALTH"))&&!((Le=Ce.passiveAbilities)!=null&&Le.includes("AURA"))});if(!(((Ee=Y.passiveAbilities)==null?void 0:Ee.includes("STEALTH"))||Y.hadStealth)){const Ce=z.find(({c:De})=>{var Le;return(Le=De.passiveAbilities)==null?void 0:Le.includes("WARD")});if(Ce)return R(Ce.c)?{index:-1,isLeader:!1}:{index:Ce.i,isLeader:!1}}let ge={index:-1,isLeader:se,score:se?0:-1e3};for(const{c:Ce,i:De}of z){if(R(Ce))continue;let Le=0;const _t=Y.isEvolved,Me=(Te=Ce.passiveAbilities)==null?void 0:Te.includes("BANE"),Ke=D(Y,Ce);W(Y,Ce)?(Le+=50,Le+=(Ce.currentAttack||0)*5,Ke?Me&&_t?Le-=60:Me&&(Le-=30):Le+=30,Me&&!Ke&&(Le+=40),(ye=Ce.passiveAbilities)!=null&&ye.includes("STORM")&&(Le+=30),(Ve=Ce.passiveAbilities)!=null&&Ve.includes("DOUBLE_ATTACK")&&(Le+=35)):!Ke&&Y.currentAttack>=Ce.currentHealth/2?Le+=10:Ke&&(Le-=50,_t&&(Le-=40),(Ce.currentAttack||0)>=5&&(Le+=10)),Le>ge.score&&(ge={index:De,isLeader:!1,score:Le})}return se&&(ge.index===-1||ge.score<=0)?{index:-1,isLeader:!0}:ge},fe=u==="EASY"?1200:u==="HARD"?400:800;if(await new Promise(Y=>setTimeout(Y,fe)),!as.current)return;let ve=0;const Ge=u==="EASY"?1:u==="HARD"?5:3;for(;ve<Ge;){const Y=qe.current,oe=Y.players[T].hand,te=Y.players[T].pp,z=Y.players[T].board.filter(Me=>Me!==null).length>=5;let ne=oe.map((Me,Ke)=>({...Me,originalIndex:Ke})).filter(Me=>Me.cost<=te).filter(Me=>!(Me.type==="FOLLOWER"&&z));if(ne.length===0||(u==="HARD"?ne=ne.sort((Me,Ke)=>U(Ke,Y)-U(Me,Y)):ne=ne.sort((Me,Ke)=>Ke.cost-Me.cost),u==="EASY"&&Math.random()<.3&&ve>0))break;const ge=ne[0];let Re;const Te=Y.players[O].board.filter(Me=>{var Ke,pt;return Me&&!((Ke=Me.passiveAbilities)!=null&&Ke.includes("STEALTH"))&&!((pt=Me.passiveAbilities)!=null&&pt.includes("AURA"))});Te.length>0&&(u==="HARD"?Re=[...Te].sort((Ke,pt)=>{var mt,St;let nt=(Ke.currentAttack||0)+(Ke.currentHealth||0),ft=(pt.currentAttack||0)+(pt.currentHealth||0);return(mt=Ke.passiveAbilities)!=null&&mt.includes("BANE")&&(nt+=10),(St=pt.passiveAbilities)!=null&&St.includes("BANE")&&(ft+=10),ft-nt})[0].instanceId:Re=Te[0].instanceId);const ye=window.innerWidth-20*p-80*p/2,Ve=20*p+110*p/2,Ce=window.innerWidth/2,De=window.innerHeight/2;let Le,_t;if(ge.type==="FOLLOWER"){const Ke=qe.current.players[T].board.filter(lc=>lc!==null),pt=Ke.length+1,nt=Ke.length,ft=ii*p,mt=(nt-(pt-1)/2)*ft,St=(xe=Bi.current)==null?void 0:xe.getBoundingClientRect();Le=(St?St.left+St.width/2:window.innerWidth/2)+mt,_t=window.innerHeight/2-70*p}Fn({card:ge,sourceIndex:-1,startX:ye,startY:Ve,targetX:Ce,targetY:De,finalX:Le,finalY:_t,playerClass:(Oe==null?void 0:Oe.class)||"SENKA",onComplete:()=>{if(ge.type!=="SPELL"&&(gt("gan.mp3",.6),$n()),I({type:"PLAY_CARD",playerId:T,payload:{cardIndex:ge.originalIndex,targetId:Re,instanceId:ge.instanceId}}),ge.id==="c_amandava"&&qe.current.players[O].board.forEach((Ke,pt)=>{if(Ke){const nt=Ke.instanceId;setTimeout(()=>{Bt("SHOT",O,pt,nt)},200)}}),ge.id==="c_azya"){if(setTimeout(()=>{Bt("THUNDER",O,-1)},200),Re){const Ke=qe.current.players[O].board.findIndex(pt=>(pt==null?void 0:pt.instanceId)===Re);Ke!==-1&&setTimeout(()=>{Bt("ICE",O,Ke,Re)},400)}setTimeout(()=>{const Me=qe.current.players[O].board,Ke=Me.filter(pt=>pt!==null);if(Ke.length>0){const pt=Ke[Math.floor(Math.random()*Ke.length)],nt=Me.findIndex(ft=>(ft==null?void 0:ft.instanceId)===(pt==null?void 0:pt.instanceId));nt!==-1&&Bt("WATER",O,nt,pt==null?void 0:pt.instanceId)}},600)}Fn(null)}}),await _(600),ve++}{const Y=qe.current,oe=Y.players[T],te=T===Y.firstPlayerId,se=Y.turnCount,z=f_(oe,se,te);if((d_(oe,se,te)||z)&&oe.board.length>0){const ge=oe.board.map((Re,Ee)=>({c:Re,i:Ee})).filter(({c:Re})=>Re&&Re.type==="FOLLOWER"&&!Re.hasEvolved);if(ge.length>0){let Re;const Ee=z;if(u==="HARD"&&(ae(Y,Ee)||console.log("[AI HARD] Skipping evolution - saving EP for better opportunity")),u==="HARD"&&!ae(Y,Ee))Re=null;else if(u==="EASY")Re=ge[Math.floor(Math.random()*ge.length)];else{const ye=ge.map(({c:Ve,i:Ce})=>({c:Ve,i:Ce,score:V(Ve,Ce,Y,Ee)}));ye.sort((Ve,Ce)=>Ce.score-Ve.score),u==="HARD"&&ye[0].score<5?(console.log("[AI HARD] Evolution target score too low:",ye[0].score),Re=null):Re=ye[0]}if(Re){let ye;const Ce=Y.players[O].board.filter(Le=>{var _t,Me;return Le!==null&&!((_t=Le.passiveAbilities)!=null&&_t.includes("STEALTH"))&&!((Me=Le.passiveAbilities)!=null&&Me.includes("AURA"))});Ce.length>0&&(u==="HARD"?ye=[...Ce].sort((_t,Me)=>{var nt,ft,mt,St;let Ke=(_t.currentAttack||0)*2+(_t.currentHealth||0),pt=(Me.currentAttack||0)*2+(Me.currentHealth||0);return(nt=_t.passiveAbilities)!=null&&nt.includes("BANE")&&(Ke+=10),(ft=Me.passiveAbilities)!=null&&ft.includes("BANE")&&(pt+=10),(mt=_t.passiveAbilities)!=null&&mt.includes("DOUBLE_ATTACK")&&(Ke+=5),(St=Me.passiveAbilities)!=null&&St.includes("DOUBLE_ATTACK")&&(pt+=5),pt-Ke})[0].instanceId:ye=Ce[0].instanceId);const De=(ze=rr.current[Re.i])==null?void 0:ze.getBoundingClientRect();De?(Hi({card:Re.c,evolvedImageUrl:Re.c.evolvedImageUrl,startX:De.left+De.width/2,startY:De.top+De.height/2,useSep:Ee,phase:"ZOOM_IN",followerIndex:Re.i,sourcePlayerId:T,targetId:ye}),await _(800)):(ls({type:"EVOLVE",playerId:T,payload:{followerIndex:Re.i,useSep:Ee,targetId:ye}}),await _(400))}}}}{let Y=!0,oe=0;const te=se=>{if(u!=="HARD")return!1;const z=se.players[O].hp;return q(se)>=z};for(;Y&&oe<15;){if(qe.current.winnerId){Y=!1;break}oe++;const se=qe.current,z=se.players[T].board,ne=se.players[O].board,ge=te(se);let Re=!1;for(let Ee=0;Ee<z.length;Ee++){const Te=z[Ee];if(!Te||!Te.canAttack)continue;let ye=-1,Ve=!0;const Ce=((Qe=Te.passiveAbilities)==null?void 0:Qe.includes("STEALTH"))||Te.hadStealth,De=Ce?-1:ne.findIndex(nt=>{var ft,mt;return nt&&((ft=nt.passiveAbilities)==null?void 0:ft.includes("WARD"))&&!((mt=nt.passiveAbilities)!=null&&mt.includes("STEALTH"))&&!R(nt)});if(ge&&De===-1)if(((Ue=Te.passiveAbilities)==null?void 0:Ue.includes("STORM"))||Te.turnPlayed!==se.turnCount)ye=-1,Ve=!0;else{const mt=ne.map((St,fs)=>({c:St,idx:fs})).filter(({c:St})=>{var fs,lc;return St&&!((fs=St.passiveAbilities)!=null&&fs.includes("STEALTH"))&&!((lc=St.passiveAbilities)!=null&&lc.includes("AURA"))&&!R(St)});if(mt.length>0)ye=mt[0].idx,Ve=!1;else continue}else if(De!==-1)ye=De,Ve=!1;else if(u==="EASY"){const nt=ne.map((mt,St)=>({c:mt,idx:St})).filter(({c:mt})=>{var St,fs;return mt&&!((St=mt.passiveAbilities)!=null&&St.includes("STEALTH"))&&!((fs=mt.passiveAbilities)!=null&&fs.includes("AURA"))&&!R(mt)}),ft=((Be=Te.passiveAbilities)==null?void 0:Be.includes("STORM"))||Te.turnPlayed!==se.turnCount;if(!ft&&nt.length>0)ye=nt[Math.floor(Math.random()*nt.length)].idx,Ve=!1;else{if(!ft&&nt.length===0)continue;ft&&nt.length>0&&Math.random()<.5&&(ye=nt[Math.floor(Math.random()*nt.length)].idx,Ve=!1)}}else{const nt=Z(Te,ne,se);if(ye=nt.index,Ve=nt.isLeader,ye===-1&&!Ve)continue}const Le=(he=Te.passiveAbilities)==null?void 0:he.includes("STORM"),_t=Te.turnPlayed===se.turnCount;if(!Le&&_t&&Ve){const nt=ne.map((ft,mt)=>({c:ft,idx:mt})).filter(({c:ft})=>{var mt,St;return ft&&!((mt=ft.passiveAbilities)!=null&&mt.includes("STEALTH"))&&!((St=ft.passiveAbilities)!=null&&St.includes("AURA"))&&!R(ft)});if(nt.length>0){const ft=Ce?null:nt.find(({c:mt})=>{var St;return(St=mt.passiveAbilities)==null?void 0:St.includes("WARD")});ft?ye=ft.idx:ye=nt[0].idx,Ve=!1}else continue}const Me=Ve?null:ne[ye],Ke=Me?Me.instanceId:void 0,pt=Te.instanceId;if(pt&&(Yl(pt),setTimeout(()=>Yl(null),300)),Bt(Te.attackEffectType||"SLASH",O,Ve?-1:ye,Ke),!Ve&&ye>=0){const nt=ne[ye];if(nt&&(nt.currentAttack||0)>0){const ft=nt.instanceId;setTimeout(()=>{ft&&(Kl(ft),setTimeout(()=>Kl(null),300)),Bt(nt.attackEffectType||"SLASH",T,Ee,pt)},200)}}Re=!0,await _(1e3),I({type:"ATTACK",playerId:T,payload:{attackerIndex:Ee,targetIndex:ye,targetIsLeader:Ve}}),await _(1e3);break}Re||(Y=!1)}}if(await _(300),qe.current.winnerId){as.current=!1;return}I({type:"END_TURN",playerId:T}),as.current=!1})()}},[g.activePlayerId,g.turnCount,n,g.phase,u,g.winnerId]);const lm=(m,v)=>{if(Rn.current||We||Fi.length>0)return;const _=ie.hand[v];m.stopPropagation();const R="touches"in m?m.touches[0].clientX:m.clientX,D="touches"in m?m.touches[0].clientY:m.clientY,W=m.currentTarget.getBoundingClientRect();if(!jr){tf(!0),Mr({card:_,owner:"PLAYER",source:"HAND"}),nf.current=!0;return}if(Mr({card:_,owner:"PLAYER",source:"HAND"}),g.activePlayerId!==O)return;if(un.current){console.warn("[handleHandMouseDown] Card play in progress, blocking drag start");return}const q=qe.current;if(q.winnerId){console.log("UI: Card play drag blocked - game has ended");return}if(q.pendingEffects&&q.pendingEffects.length>0){console.log("UI: Card play drag blocked - pendingEffects still processing");return}const $={sourceType:"HAND",sourceIndex:v,sourceInstanceId:_.instanceId,startX:W.left+W.width/2,startY:W.top+W.height/2,currentX:R,currentY:D,offsetX:0,offsetY:0,canDrag:!0};Nr($),Rn.current=$},cm=(m,v,_)=>{m.stopPropagation();const R="touches"in m?m.touches[0].clientX:m.clientX,D="touches"in m?m.touches[0].clientY:m.clientY,W=qe.current;if(W.winnerId){console.log("UI: Attack drag blocked - game has ended");return}const q=W.players[O].board,$=_?q.findIndex(V=>V&&V.instanceId===_):v,U=$>=0?q[$]:null;if(et&&et.allowedTargetPlayerId===O&&U){ff("FOLLOWER",$,O,_);return}if(U&&Mr({card:U,owner:"PLAYER",source:"BOARD"}),W.pendingEffects&&W.pendingEffects.length>0){console.log("UI: Attack drag blocked - pendingEffects still processing");return}if(W.activePlayerId===O&&(U!=null&&U.canAttack)){const V=m.currentTarget.getBoundingClientRect(),ae={x:V.left+V.width/2,y:V.top+V.height/2},Z={sourceType:"BOARD",sourceIndex:$,sourceInstanceId:U.instanceId,startX:ae.x,startY:ae.y,currentX:R,currentY:D,offsetX:0,offsetY:0};Nr(Z),Rn.current=Z}},sc=(m,v=!1)=>{if(g.activePlayerId!==O)return;m.stopPropagation();const _="touches"in m?m.touches[0].clientX:m.clientX,R="touches"in m?m.touches[0].clientY:m.clientY,D=qe.current;if(D.winnerId){console.log("UI: Evolve drag blocked - game has ended");return}if(D.pendingEffects&&D.pendingEffects.length>0){console.log("UI: Evolve drag blocked - pendingEffects still processing");return}const W=O===g.firstPlayerId;if(v){if(!f_(ie,g.turnCount,W))return}else if(!d_(ie,g.turnCount,W))return;const q=m.currentTarget.getBoundingClientRect(),$=q.left+q.width/2,U=q.top+q.height/2,V={sourceType:"EVOLVE",sourceIndex:0,startX:$,startY:U,currentX:_,currentY:R,offsetX:0,offsetY:0,useSep:v};Nr(V),Rn.current=V},um=F.useCallback(m=>{xr.current&&(clearTimeout(xr.current),xr.current=null);const v={stampId:m,playerId:O,playerClass:_r,timestamp:Date.now()},_=l_(m);_&&gt(_,.6),$i(null),requestAnimationFrame(()=>{$i(v)}),e==="ONLINE"&&x&&x.send({type:"STAMP",stampId:m,playerClass:_r}),xr.current=setTimeout(()=>{$i(R=>(R==null?void 0:R.timestamp)===v.timestamp?null:R),xr.current=null},3e3)},[O,_r,e,x]),JS=F.useCallback(m=>{if(m.stopPropagation(),m.preventDefault(),ri.current){const v=ri.current.getBoundingClientRect();Lr.current={x:v.left+v.width/2,y:v.top+v.height/2}}else Lr.current={x:m.clientX,y:m.clientY};z0(!0),Bl(null)},[]),dm=M.useRef(null);M.useEffect(()=>{dm.current=Vd},[Vd]),F.useEffect(()=>{if(!Gd)return;const m=_=>{if(!Lr.current)return;const R=_.clientX-Lr.current.x,D=_.clientY-Lr.current.y,W=Math.sqrt(R*R+D*D),q=Math.atan2(D,R)*(180/Math.PI);if(W>=200&&W<=320&&D<0){const ae=180- -q,Z=Math.floor(ae/22.5),ve=Math.max(0,Math.min(7,Z))+1;Bl(ve)}else Bl(null)},v=()=>{const _=dm.current;_&&um(_),z0(!1),Bl(null),Lr.current=null};return window.addEventListener("mousemove",m),window.addEventListener("mouseup",v),()=>{window.removeEventListener("mousemove",m),window.removeEventListener("mouseup",v)}},[Gd,um]),F.useEffect(()=>{const m=(R,D,W=!1)=>{var U,V,ae,Z;if(!Rn.current)return;const{canDrag:q,sourceType:$}=Rn.current;if(!($==="HAND"&&!q)&&(Rn.current={...Rn.current,currentX:R,currentY:D},Nr(fe=>fe?{...fe,currentX:R,currentY:D}:null),W&&($==="BOARD"||$==="EVOLVE"))){const fe=zi.current;if(fe){const xe=fe.getBoundingClientRect();if(R>=xe.left&&R<=xe.right&&D>=xe.top&&D<=xe.bottom){Yn({type:"LEADER",index:0,playerId:T});return}}const ve=qe.current,Ge=((U=ve.players[T])==null?void 0:U.board)||[];for(let xe=0;xe<rr.current.length;xe++){const ze=rr.current[xe];if(ze&&Ge[xe]){const Qe=ze.getBoundingClientRect();if(R>=Qe.left&&R<=Qe.right&&D>=Qe.top&&D<=Qe.bottom){Yn({type:"FOLLOWER",index:xe,playerId:T,instanceId:(V=Ge[xe])==null?void 0:V.instanceId});return}}}if($==="EVOLVE"){const xe=((ae=ve.players[O])==null?void 0:ae.board)||[];for(let ze=0;ze<br.current.length;ze++){const Qe=br.current[ze];if(Qe&&xe[ze]){const Ue=Qe.getBoundingClientRect();if(R>=Ue.left&&R<=Ue.right&&D>=Ue.top&&D<=Ue.bottom){Yn({type:"FOLLOWER",index:ze,playerId:O,instanceId:(Z=xe[ze])==null?void 0:Z.instanceId});return}}}}Yn(null)}},v=R=>{m(R.clientX,R.clientY)},_=R=>{R.touches.length>0&&(Rn.current&&R.preventDefault(),m(R.touches[0].clientX,R.touches[0].clientY,!0))};return window.addEventListener("mousemove",v),window.addEventListener("touchmove",_,{passive:!1}),()=>{window.removeEventListener("mousemove",v),window.removeEventListener("touchmove",_)}},[]);const fm=M.useRef(null),qS=M.useRef(null);F.useEffect(()=>{fm.current=ct,qS.current=ct},[ct]),F.useEffect(()=>{const m=()=>{var D,W,q,$,U,V,ae,Z,fe,ve,Ge,xe,ze;const _=Rn.current,R=fm.current;if(qe.current.winnerId){console.log("[handleGlobalMouseUp] Game has ended, cancelling all actions"),Nr(null),Rn.current=null,Yn(null);return}if(_){if(_.sourceType==="HAND"){if(un.current){console.warn("[handleGlobalMouseUp] Card play in progress, cancelling drag"),Rn.current=null,Nr(null);return}const Qe=Math.sqrt(Math.pow(_.startX-_.currentX,2)+Math.pow(_.startY-_.currentY,2)),Ue=_.currentY<window.innerHeight-200*p;if(_.canDrag&&Qe>30&&Ue){const Be=Sr.current.hand[_.sourceIndex];if(Sr.current.pp>=Be.cost){const he=((W=(D=Be.triggerAbilities)==null?void 0:D.FANFARE)==null?void 0:W.targetType)==="SELECT_FOLLOWER"||((q=Be.triggers)==null?void 0:q.some(se=>se.trigger==="FANFARE"&&se.effects.some(z=>z.targetType==="SELECT_FOLLOWER"))),Y=((U=($=Be.triggerAbilities)==null?void 0:$.FANFARE)==null?void 0:U.targetType)==="SELECT_ALLY_FOLLOWER"||((V=Be.triggers)==null?void 0:V.some(se=>se.trigger==="FANFARE"&&se.effects.some(z=>z.targetType==="SELECT_ALLY_FOLLOWER"))),oe=((Z=(ae=Be.triggerAbilities)==null?void 0:ae.FANFARE)==null?void 0:Z.targetType)==="SELECT_OTHER_ALLY_FOLLOWER"||((fe=Be.triggers)==null?void 0:fe.some(se=>se.trigger==="FANFARE"&&se.effects.some(z=>z.targetType==="SELECT_OTHER_ALLY_FOLLOWER")));if(he||Y||oe){const se=Y||oe?O:T;qe.current.players[se].board.some(ge=>{var Re,Ee;return!(!ge||se!==O&&((Re=ge.passiveAbilities)!=null&&Re.includes("STEALTH")||(Ee=ge.passiveAbilities)!=null&&Ee.includes("AURA")))})?(un.current=!0,aa.current=Be.instanceId||null,ni({type:"PLAY",sourceIndex:_.sourceIndex,sourceInstanceId:Be.instanceId,allowedTargetPlayerId:se}),sr.current=!0,setTimeout(()=>{sr.current=!1},100)):(console.log("[handleGlobalMouseUp] No valid targets, skipping target selection"),df(_.sourceIndex,_.startX,_.startY),Mr(null),sr.current=!0,setTimeout(()=>{sr.current=!1},100))}else df(_.sourceIndex,_.startX,_.startY),Mr(null),sr.current=!0,setTimeout(()=>{sr.current=!1},100);Rn.current=null,Nr(null);return}}else _.canDrag||tf(!0)}else if(_.sourceType==="BOARD"){if(R&&R.playerId===T){const Ue=qe.current.players[T],Be=Ue.board.filter(z=>{var ne,ge;return z&&((ne=z.passiveAbilities)==null?void 0:ne.includes("WARD"))&&!((ge=z.passiveAbilities)!=null&&ge.includes("STEALTH"))});let he=!1;const Y=z=>z?Ue.board.findIndex(ne=>ne&&ne.instanceId===z):-1,oe=R.type==="LEADER"?-1:Y(R.instanceId),te=Sr.current.board[_.sourceIndex],se=((ve=te==null?void 0:te.passiveAbilities)==null?void 0:ve.includes("STEALTH"))||(te==null?void 0:te.hadStealth);if(Be.length>0&&!se){if(R.type==="LEADER")he=!0;else if(R.type==="FOLLOWER"&&oe>=0){const z=Ue.board[oe];z&&!((Ge=z.passiveAbilities)!=null&&Ge.includes("WARD"))&&(he=!0)}}if(he)console.log("UI: Attack blocked by WARD");else{const z=Sr.current.board.findIndex(Ve=>Ve&&Ve.instanceId===_.sourceInstanceId),ne=z>=0?Sr.current.board[z]:null,ge=(xe=ne==null?void 0:ne.passiveAbilities)==null?void 0:xe.includes("RUSH"),Re=(ze=ne==null?void 0:ne.passiveAbilities)==null?void 0:ze.includes("STORM"),Ee=(ne==null?void 0:ne.turnPlayed)===qe.current.turnCount,Te=R.type==="LEADER",ye=oe;if(Te&&ge&&!Re&&Ee)console.log("UI: Attack blocked by RUSH rule (Cannot attack leader)");else{if(z<0||!ne){console.log("UI: Attack blocked - invalid attacker");return}const Ve=qe.current;if(Ve.pendingEffects&&Ve.pendingEffects.length>0){console.log("UI: Attack blocked - pendingEffects still processing");return}const Ce=R.instanceId,De=_.sourceInstanceId,Le=!Te&&ye>=0?Ue.board[ye]:null;ls({type:"ATTACK",playerId:O,payload:{attackerIndex:z,targetIndex:Te?-1:ye,targetIsLeader:Te}}),De&&(Yl(De),setTimeout(()=>Yl(null),300));const Me=(ne==null?void 0:ne.attackEffectType)||"SLASH";if(Bt(Me,T,Te?-1:ye,Ce),$n(),!Te&&Le&&(Le.currentAttack||0)>0){const Ke=Le.instanceId;setTimeout(()=>{Ke&&(Kl(Ke),setTimeout(()=>Kl(null),300)),Bt(Le.attackEffectType||"SLASH",O,z,De)},200)}}}}}else if(_.sourceType==="EVOLVE"&&R&&R.type==="FOLLOWER"&&R.playerId===O){const Qe=R.index,Be=ta.current[Qe],he=(Be==null?void 0:Be.instanceId)||R.instanceId,Y=Sr.current.board,oe=he?Y.findIndex(De=>De&&De.instanceId===he):Qe,te=oe>=0?Y[oe]:null;if(!te)return;if(te.hasEvolved){console.log("[GameScreen] Cannot evolve: card already evolved (drag drop)");return}const z=_.useSep?["SUPER_EVOLVE","EVOLVE"]:["EVOLVE"],ge=(()=>{var Le,_t;const De=(_t=(Le=te==null?void 0:te.triggerAbilities)==null?void 0:Le.EVOLVE)==null?void 0:_t.targetType;if(De)return De;for(const Me of(te==null?void 0:te.triggers)||[])if(z.includes(Me.trigger)){for(const Ke of Me.effects)if(Ke.targetType&&["SELECT_FOLLOWER","SELECT_ALLY_FOLLOWER","SELECT_OTHER_ALLY_FOLLOWER"].includes(Ke.targetType))return Ke.targetType}return null})(),Re=!!ge,Ee=ge==="SELECT_ALLY_FOLLOWER"||ge==="SELECT_OTHER_ALLY_FOLLOWER",Te=ge==="SELECT_OTHER_ALLY_FOLLOWER",ye=Ee?O:T,Ce=qe.current.players[ye].board.some(De=>{var Le,_t;return!(!De||Ee&&Te&&De.instanceId===he||!Ee&&((Le=De.passiveAbilities)!=null&&Le.includes("STEALTH")||(_t=De.passiveAbilities)!=null&&_t.includes("AURA")))});Re&&Ce?(ni({type:"EVOLVE",sourceIndex:oe,sourceInstanceId:he,sourceVisualIndex:Qe,useSep:_.useSep,allowedTargetPlayerId:ye,excludeInstanceId:Te?he:void 0}),sr.current=!0,setTimeout(()=>{sr.current=!1},100)):(rc(Qe,_.useSep,void 0,he),sr.current=!0,setTimeout(()=>{sr.current=!1},100))}}_&&_.sourceType==="HAND"&&_.canDrag&&(q0(_.sourceIndex),setTimeout(()=>q0(null),300)),Nr(null),Rn.current=null,Yn(null)},v=()=>{m()};return window.addEventListener("mouseup",m),window.addEventListener("touchend",v),()=>{window.removeEventListener("mouseup",m),window.removeEventListener("touchend",v)}},[T,O,jr,p]);const ZS=()=>{if(!sr.current){if(et){et.type==="PLAY"&&(un.current=!1),ni(null);return}if(jr){if(nf.current){nf.current=!1;return}tf(!1),Mr(null),Se(null)}}},cs=()=>{if(!J||J.sourceType!=="BOARD"&&J.sourceType!=="EVOLVE")return"";const m=J.currentX-J.startX,v=J.currentY-J.startY,_=Math.sqrt(m*m+v*v);if(_<10)return"";const R=(J.startX+J.currentX)/2,D=(J.startY+J.currentY)/2,W=Math.min(200,_*.3),q=Math.abs(m),$=Math.min(150,q*.4),U=W+$,ae=-(m/(_+1))*U*.5,Z=-U*.8,fe=R+ae,ve=D+Z;return`M${J.startX},${J.startY} Q${fe},${ve} ${J.currentX},${J.currentY}`},ff=(m,v,_,R)=>{var q;if(!et)return;if(et.allowedTargetPlayerId&&et.allowedTargetPlayerId!==_){console.log("Invalid target side");return}if(et.excludeInstanceId&&R===et.excludeInstanceId){console.log("Cannot target self (SELECT_OTHER_ALLY_FOLLOWER)"),$n();return}let D,W=v;if(m==="FOLLOWER"){if(R&&(W=g.players[_].board.findIndex(U=>U&&U.instanceId===R),W<0))return;const $=g.players[_].board[W];if(!$)return;if(D=$.instanceId,_!==O){const U=$.passiveAbilities||[];if(U.includes("STEALTH")){console.log("Cannot target unit with STEALTH"),gt("cancel"),$n();return}if(U.includes("AURA")){console.log("Cannot target unit with AURA"),gt("cancel"),$n();return}}}else return;if(et.type==="PLAY"){const $=Sr.current;let U=et.sourceIndex,V=$.hand[U];if(et.sourceInstanceId){const Ue=$.hand.findIndex(Be=>Be.instanceId===et.sourceInstanceId);if(Ue>=0)U=Ue,V=$.hand[Ue],console.log(`[handleTargetClick] Using sourceInstanceId ${et.sourceInstanceId}, found at index ${Ue} (was ${et.sourceIndex})`);else{console.error("[handleTargetClick] Card not found with instanceId:",et.sourceInstanceId),ni(null);return}}if(!V){console.error("[handleTargetClick] Card not found at index:",U),ni(null),un.current=!1;return}un.current=!0,aa.current=V.instanceId||null,V.id==="c_y"&&(Bt("SUMI","p2",W,D),qe.current.players[T].board.forEach((Be,he)=>{if(Be){const Y=Be.instanceId;setTimeout(()=>{Bt("SUMI",T,he,Y)},300)}})),V.id==="s_resignation_proxy"&&(Bt("SUMI",_,W,D),setTimeout(()=>{const Ue=qe.current.players[O].board,Be=[];if(Ue.forEach((he,Y)=>{he&&Be.push({index:Y,instanceId:he.instanceId})}),Be.length>0){const he=Be[Math.floor(Math.random()*Be.length)];Bt("SUMI",O,he.index,he.instanceId)}},500)),V.id==="c_azya"&&(Bt("THUNDER",T,-1),setTimeout(()=>{Bt("ICE",_,W,D)},300),setTimeout(()=>{const Ue=qe.current.players[T].board,Be=Ue.filter(he=>he!==null);if(Be.length>0){const he=Be[Math.floor(Math.random()*Be.length)],Y=Ue.findIndex(oe=>(oe==null?void 0:oe.instanceId)===(he==null?void 0:he.instanceId));Y!==-1&&Bt("WATER",T,Y,he==null?void 0:he.instanceId)}},600));const ae=window.innerWidth/2,Z=window.innerHeight-200*p/2,fe=window.innerWidth/2,ve=window.innerHeight/2,Ge=()=>{V.type==="SPELL"||$n(),ls({type:"PLAY_CARD",playerId:O,payload:{cardIndex:U,targetId:D,instanceId:V.instanceId}}),V.id==="c_amandava"&&qe.current.players[T].board.forEach((he,Y)=>{if(he){const oe=he.instanceId;setTimeout(()=>{Bt("SHOT",T,Y,oe)},200)}}),Fn(null),setTimeout(()=>{un.current=!1},100)};let xe,ze;if(V.type==="FOLLOWER"){const Be=qe.current.players[O].board.filter(ne=>ne!==null),he=Be.length+1,Y=Be.length,oe=ii*p,te=(Y-(he-1)/2)*oe,se=(q=Bi.current)==null?void 0:q.getBoundingClientRect();xe=(se?se.left+se.width/2:window.innerWidth/2)+te,ze=window.innerHeight/2+70*p}const Qe=V.type==="FOLLOWER"?qe.current.players[O].board.filter(Ue=>Ue!==null).length:void 0;n!=="CPU"&&S&&x&&x.send({type:"PLAY_CARD_ANIM",payload:{playerId:O,cardIndex:U,card:V,targetBoardIndex:Qe}}),Fn({card:V,sourceIndex:et.sourceIndex??-1,startX:ae,startY:Z,targetX:fe,targetY:ve,finalX:xe,finalY:ze,playerClass:(ie==null?void 0:ie.class)||"SENKA",onComplete:Ge}),setTimeout(()=>{Fn(Ue=>(Ue==null?void 0:Ue.card.id)===V.id?(Ge(),null):Ue)},2e3)}else if(et.type==="EVOLVE"){const $=et.sourceVisualIndex??et.sourceIndex;rc($,!!et.useSep,D,et.sourceInstanceId)}ni(null)},hm=()=>{if(!Ne||Ne.owner!=="PLAYER")return;if(un.current){console.warn("[handleUseButtonClick] Card play in progress, ignoring");return}const m=ie.hand.findIndex(R=>R.id===Ne.card.id);if(m===-1)return;const v=window.innerWidth/2,_=window.innerHeight-200*p/2;df(m,v,_),Mr(null)},[Vi,hf]=M.useState(!1),[ic,pf]=M.useState(!1),[Gt,gf]=M.useState(null),eI=M.useRef(0);M.useEffect(()=>{if(!(Gt!=null&&Gt.active))return;const m=Date.now(),v=800,_=()=>{const R=Date.now()-m;if(R>=v){gf(null);return}const D=R/v;gf(W=>W?{...W,ringRadius:20+D*100,particles:W.particles.map(q=>({...q,x:q.x+q.vx,y:q.y+q.vy,opacity:1-D}))}:null),requestAnimationFrame(_)};requestAnimationFrame(_)},[Gt==null?void 0:Gt.active]);const pm=(m,v)=>{const _=[];for(let R=0;R<20;R++){const D=Math.random()*Math.PI*2,W=2+Math.random()*3;_.push({id:eI.current++,x:m,y:v,vx:Math.cos(D)*W,vy:Math.sin(D)*W,opacity:1,createdAt:Date.now()})}gf({active:!0,x:m,y:v,ringRadius:20,particles:_})},mf=async()=>{if(g.winnerId){console.log("[handleEndTurn] Game is over, ignoring");return}if(g.activePlayerId!==O){console.log("[handleEndTurn] Not my turn, ignoring");return}if(Wi.current){console.log("[handleEndTurn] Already ending turn, ignoring");return}Wi.current=!0,hf(!0);const m=qe.current.turnCount,v=qe.current.activePlayerId;if(!await(async()=>{const D=()=>{const V=qe.current,ae=V.pendingEffects&&V.pendingEffects.length>0,Z=lf.current.length>0,fe=cf.current.length>0,ve=la.current!==null,Ge=Gi.current!==null,xe=Dr.current,ze=un.current;return!ae&&!Z&&!fe&&!ve&&!Ge&&!xe&&!ze};let $=0,U=0;for(;$<3e3;){if(qe.current.turnCount!==m||qe.current.activePlayerId!==v)return console.log("[handleEndTurn] Turn changed during wait, aborting local END_TURN"),!1;if(D()){if(U++,U>=2)break}else U=0;await new Promise(V=>setTimeout(V,50)),$+=50}return $>=3e3&&console.warn("[handleEndTurn] Timeout waiting for processing to complete - forcing end turn"),!0})()||qe.current.turnCount!==m||qe.current.activePlayerId!==v||qe.current.activePlayerId!==O){console.log("[handleEndTurn] Turn state changed, aborting END_TURN dispatch"),Wi.current=!1,hf(!1);return}console.log("[handleEndTurn] Dispatching END_TURN"),ls({type:"END_TURN",playerId:O}),Wi.current=!1,hf(!1)},tI=F.useCallback(()=>{gt("sisiodosi.mp3",.6);const m=Y0.current;if(m){const v=m.getBoundingClientRect();pm(v.left+v.width/2,v.top+v.height/2)}mf()},[gt,mf]),gm=2-((ie==null?void 0:ie.evolutionsUsed)||0),yf=O===g.firstPlayerId,mm=(m,v)=>v?Math.ceil(g.turnCount/2):Math.floor(g.turnCount/2),ym=mm(O,yf),nI=yf?3:2,rI=yf?4:3,oc=ym>=nI,ac=ym>=rI,us=(ie==null?void 0:ie.canEvolveThisTurn)&&gm>0&&g.activePlayerId===O&&oc,ds=(ie==null?void 0:ie.canEvolveThisTurn)&&ie.sep>0&&g.activePlayerId===O&&ac,vf=T===g.firstPlayerId,vm=mm(T,vf),sI=vf?3:2,iI=vf?4:3,_f=vm>=sI,xf=vm>=iI,Ef=((Tm=ie==null?void 0:ie.board)==null?void 0:Tm.some(m=>{var v;return(v=m==null?void 0:m.passiveAbilities)==null?void 0:v.includes("LEADER_DAMAGE_CAP")}))??!1,bf=((Cm=Oe==null?void 0:Oe.board)==null?void 0:Cm.some(m=>{var v;return(v=m==null?void 0:m.passiveAbilities)==null?void 0:v.includes("LEADER_DAMAGE_CAP")}))??!1,oI=(ie==null?void 0:ie.leaderDamageShield)??!1,aI=(Oe==null?void 0:Oe.leaderDamageShield)??!1,_m=Ef||oI,xm=bf||aI;return F.useLayoutEffect(()=>{window.scrollTo(0,0),Bi.current&&(Bi.current.scrollTop=0);const m=()=>{window.scrollTo(0,0)};return window.addEventListener("scroll",m,{passive:!1}),()=>{window.removeEventListener("scroll",m)}},[]),n==="JOIN"&&!A||j&&y&&!A?l.jsxs("div",{style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",gap:"1rem"},children:[l.jsx("div",{style:{width:"50px",height:"50px",border:"4px solid rgba(233, 69, 96, 0.3)",borderTop:"4px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),l.jsx("p",{children:"..."}),l.jsx("button",{onClick:s,style:{marginTop:"1rem",padding:"0.5rem 1rem",background:"transparent",border:"1px solid #888",color:"#888",cursor:"pointer",borderRadius:"4px"},children:""}),l.jsx("style",{children:`
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                `})]}):j&&Ye&&A?l.jsxs("div",{style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",gap:"1rem"},children:[l.jsx("div",{style:{fontSize:"2rem",fontWeight:"bold",color:"#4ade80",textShadow:"0 0 10px rgba(74, 222, 128, 0.5)",marginBottom:"0.5rem"},children:""}),l.jsx("div",{style:{width:"50px",height:"50px",border:"4px solid rgba(74, 222, 128, 0.3)",borderTop:"4px solid #4ade80",borderRadius:"50%",animation:"spin 1s linear infinite"}}),l.jsx("p",{style:{color:"#a0aec0"},children:"..."}),l.jsx("style",{children:`
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                `})]}):l.jsxs("div",{className:"game-screen-wrapper",style:{width:"100vw",height:"100dvh",overflow:"hidden",background:"#000",position:"relative"},children:[N&&l.jsx(YO,{myPlayer:ie,opponentPlayer:Oe,isFirstPlayer:is,onComplete:XS,scale:p,onVsImpact:()=>gt("vs.mp3",.7),onCoinToss:()=>gt("coin.mp3",.7),onImpact:()=>gt("gan.mp3",.7),onOrbLand:()=>gt("gan.mp3",.8),onFadeInBoard:()=>ke(!0),isMobile:K}),l.jsxs("div",{className:"game-screen",style:{width:"100%",height:"100%",transform:bt>0?`translate(${Xe.x}px, ${Xe.y}px)`:"none",display:"flex",overflow:"hidden",background:"radial-gradient(circle at center, #1a202c 0%, #000 100%)",fontFamily:"'Helvetica Neue', sans-serif",userSelect:"none",color:"#fff",position:"absolute",top:0,left:0,opacity:N&&!we?0:1,transition:"opacity 0.5s ease-in"},onClick:ZS,children:[l.jsx("style",{children:`
                    html, body {
                        margin: 0; padding: 0; height: 100%; background: #000;
                        overflow: hidden !important;
                        position: fixed !important;
                        width: 100% !important;
                        top: 0 !important;
                        left: 0 !important;
                    }
                    * { box-sizing: border-box; }
                    .shake-target { animation: shake 0.3s cubic-bezier(.36,.07,.19,.97) both; }
                    @keyframes shake {
                        10%, 90% { transform: translate3d(-1px, 0, 0); }
                        20%, 80% { transform: translate3d(2px, 0, 0); }
                        30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
                        40%, 60% { transform: translate3d(4px, 0, 0); }
                    }
                    @keyframes attackRotate {
                        0% { transform: rotateY(0deg); }
                        100% { transform: rotateY(360deg); }
                    }
                    .attack-rotating {
                        animation: attackRotate 0.2s linear forwards !important;
                        transform-style: preserve-3d;
                    }
                    @keyframes cardDie {
                        0% { transform: scale(1); filter: brightness(1) drop-shadow(0 0 0 white); opacity: 1; }
                        40% { transform: scale(1.15); filter: brightness(3) drop-shadow(0 0 20px white); opacity: 0.9; }
                        100% { transform: scale(0.4) rotate(8deg); filter: brightness(5) drop-shadow(0 0 40px white); opacity: 0; }
                    }
                    .card-dying { animation: cardDie 0.7s forwards; }
                    /* Necromance effect animations */
                    @keyframes necromanceFloat {
                        0% { transform: translateX(-50%) translateY(0) scale(1); opacity: 1; }
                        50% { transform: translateX(-50%) translateY(-20px) scale(1.2); opacity: 1; }
                        100% { transform: translateX(-50%) translateY(-40px) scale(0.8); opacity: 0; }
                    }
                    @keyframes necromanceFloatOpponent {
                        0% { transform: translateX(-50%) translateY(0) scale(1); opacity: 1; }
                        50% { transform: translateX(-50%) translateY(15px) scale(1.2); opacity: 1; }
                        100% { transform: translateX(-50%) translateY(30px) scale(0.8); opacity: 0; }
                    }
                    @keyframes necroPulse {
                        0%, 100% { box-shadow: 0 0 10px #d946ef, 0 0 20px #a855f7, inset 0 0 15px rgba(217, 70, 239, 0.3); }
                        50% { box-shadow: 0 0 25px #d946ef, 0 0 40px #a855f7, 0 0 60px #7c3aed, inset 0 0 25px rgba(217, 70, 239, 0.5); }
                    }
                    @keyframes leaderDamageCapPulse {
                        0%, 100% {
                            box-shadow: 0 0 20px rgba(103, 232, 249, 0.4), 0 0 40px rgba(103, 232, 249, 0.2);
                            border-color: #67e8f9;
                        }
                        50% {
                            box-shadow: 0 0 35px rgba(103, 232, 249, 0.7), 0 0 55px rgba(103, 232, 249, 0.4);
                            border-color: #a5f3fc;
                        }
                    }
                    @keyframes leaderDamageCapOverlay {
                        0%, 100% { opacity: 0.15; }
                        50% { opacity: 0.45; }
                    }
                    /* EP/SEP pulse animations for usable state - box-shadow only, no transform override */
                    @keyframes epPulse {
                        0%, 100% {
                            box-shadow: 0 0 12px #ffd700, 0 0 25px rgba(255,215,0,0.6);
                        }
                        50% {
                            box-shadow: 0 0 20px #ffd700, 0 0 40px rgba(255,215,0,0.8), 0 0 55px rgba(255,180,0,0.5);
                        }
                    }
                    @keyframes sepPulse {
                        0%, 100% {
                            box-shadow: 0 0 12px #b794f4, 0 0 25px rgba(159,122,234,0.6);
                        }
                        50% {
                            box-shadow: 0 0 20px #b794f4, 0 0 40px rgba(159,122,234,0.8), 0 0 55px rgba(180,0,255,0.5);
                        }
                    }
                `}),et&&l.jsx("div",{style:{position:"absolute",top:"15%",left:"50%",transform:"translate(-50%, -50%)",background:"rgba(0, 0, 0, 0.7)",color:"#fff",padding:"10px 20px",borderRadius:20,pointerEvents:"none",zIndex:1e3,fontWeight:"bold",border:et.allowedTargetPlayerId===O?"2px solid #48bb78":"2px solid #f56565"},children:et.allowedTargetPlayerId===O?"":""}),GS&&l.jsx(dL,{onClose:()=>ef(!1)}),WS&&l.jsx("div",{style:{position:"absolute",inset:0,zIndex:4e3,background:"rgba(0,0,0,0.8)",backdropFilter:"blur(5px)",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>Jl(!1),children:l.jsxs("div",{style:{background:"#2d3748",padding:40,borderRadius:16,display:"flex",flexDirection:"column",gap:20,minWidth:300,border:"1px solid rgba(255,255,255,0.1)"},onClick:m=>m.stopPropagation(),children:[l.jsx("h2",{style:{margin:0,textAlign:"center",borderBottom:"1px solid #4a5568",paddingBottom:10,color:"#fff"},children:""}),HS?l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:15},children:[l.jsx("h3",{style:{margin:0,color:"#cbd5e0"},children:""}),l.jsxs("label",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",color:"white"},children:["BGM",l.jsx("input",{type:"checkbox",checked:Tt.bgmEnabled,onChange:m=>ia(v=>({...v,bgmEnabled:m.target.checked})),style:{width:20,height:20}})]}),l.jsxs("label",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",color:"white"},children:["SE",l.jsx("input",{type:"checkbox",checked:Tt.seEnabled,onChange:m=>ia(v=>({...v,seEnabled:m.target.checked})),style:{width:20,height:20}})]}),l.jsxs("div",{children:[l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",color:"#a0aec0",marginBottom:5},children:[l.jsx("span",{children:"BGM"}),l.jsxs("span",{children:[Math.round(Tt.bgm*100),"%"]})]}),l.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:Tt.bgm,onChange:m=>ia(v=>({...v,bgm:parseFloat(m.target.value)})),style:{width:"100%"}})]}),l.jsxs("div",{children:[l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",color:"#a0aec0",marginBottom:5},children:[l.jsx("span",{children:"SE"}),l.jsxs("span",{children:[Math.round(Tt.se*100),"%"]})]}),l.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:Tt.se,onChange:m=>ia(v=>({...v,se:parseFloat(m.target.value)})),style:{width:"100%"}})]}),l.jsxs("div",{children:[l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",color:"#a0aec0",marginBottom:5},children:[l.jsx("span",{children:""}),l.jsxs("span",{children:[Math.round(Tt.voice*100),"%"]})]}),l.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:Tt.voice,onChange:m=>ia(v=>({...v,voice:parseFloat(m.target.value)})),style:{width:"100%"}})]}),l.jsx("button",{onClick:()=>nm(!1),style:{padding:10,background:"#4a5568",border:"none",color:"white",borderRadius:8,cursor:"pointer",marginTop:10},children:""})]}):l.jsxs(l.Fragment,{children:[l.jsx("button",{onClick:()=>Jl(!1),style:{padding:15,background:"#4a5568",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.2rem"},children:""}),l.jsx("button",{onClick:()=>nm(!0),style:{padding:15,background:"#2b6cb0",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.2rem"},children:""}),l.jsx("button",{onClick:()=>ql(!0),style:{padding:15,background:"#e53e3e",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.2rem"},children:""})]})]})}),VS&&l.jsx("div",{style:{position:"absolute",inset:0,zIndex:4100,background:"rgba(0,0,0,0.85)",backdropFilter:"blur(5px)",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>ql(!1),children:l.jsxs("div",{style:{background:"#2d3748",padding:40,borderRadius:16,display:"flex",flexDirection:"column",gap:20,minWidth:320,border:"2px solid #e53e3e",boxShadow:"0 0 30px rgba(229, 62, 62, 0.3)"},onClick:m=>m.stopPropagation(),children:[l.jsx("h2",{style:{margin:0,textAlign:"center",color:"#fff",fontSize:"1.5rem"},children:""}),l.jsx("p",{style:{margin:0,textAlign:"center",color:"#a0aec0",fontSize:"1rem"},children:""}),l.jsxs("div",{style:{display:"flex",gap:15,marginTop:10},children:[l.jsx("button",{onClick:()=>ql(!1),style:{flex:1,padding:15,background:"#4a5568",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.1rem"},children:""}),l.jsx("button",{onClick:YS,style:{flex:1,padding:15,background:"#e53e3e",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.1rem"},children:""})]})]})}),l.jsxs("div",{className:rm?"shake-target":"",style:{width:(K?280:340)*p,borderRight:"1px solid rgba(255,255,255,0.1)",background:"rgba(0,0,0,0.3)",padding:K?`${10*p}px ${12*p}px`:`${20*p}px ${20*p}px ${20*p}px`,display:"flex",flexDirection:"column",zIndex:20,flexShrink:0},onClick:m=>m.stopPropagation(),children:[l.jsx("div",{style:{marginBottom:(K?6:12)*p},children:l.jsxs("button",{onClick:()=>Jl(!0),style:{background:"transparent",border:"none",cursor:"pointer",padding:K?3:5},children:[l.jsx("div",{style:{width:(K?22:30)*p,height:(K?2:3)*p,background:"#cbd5e0",marginBottom:(K?4:6)*p}}),l.jsx("div",{style:{width:(K?22:30)*p,height:(K?2:3)*p,background:"#cbd5e0",marginBottom:(K?4:6)*p}}),l.jsx("div",{style:{width:(K?22:30)*p,height:(K?2:3)*p,background:"#cbd5e0"}})]})}),l.jsx("h3",{style:{color:"#a0aec0",borderBottom:"1px solid #4a5568",paddingBottom:(K?4:8)*p,marginTop:0,marginBottom:0,flexShrink:0,fontSize:K?`${.85*p}rem`:void 0},children:""}),Ne?l.jsx("div",{style:{marginTop:(K?4:10)*p,display:"flex",flexDirection:"column",flex:1,overflow:"hidden",minHeight:0},children:l.jsxs("div",{style:{flex:1,overflow:"auto",minHeight:0,display:"flex",flexDirection:"column"},children:[l.jsxs("div",{style:{flexShrink:0},children:[l.jsx("div",{style:{width:"100%",aspectRatio:"1/1",marginBottom:(K?6:12)*p,display:"flex",alignItems:"center",justifyContent:"center",...K?{maxHeight:"28vh"}:{}},children:l.jsx(Xi,{card:Ne.card,style:{width:"100%",height:"100%",...K?{maxHeight:"28vh"}:{}},variant:"art-only"})}),l.jsx("div",{style:{fontSize:K?`${(Ne.card.name.length>12?.9:Ne.card.name.length>8?1:1.1)*p}rem`:`${Ne.card.name.length>12?1.1:Ne.card.name.length>8?1.2:1.4}rem`,fontWeight:"bold",marginBottom:(K?4:6)*p,textAlign:"center"},children:Ne.card.name}),l.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:(K?10:15)*p,marginBottom:(K?6:10)*p},children:[l.jsx("div",{style:{width:24*p,height:24*p,borderRadius:"50%",background:"radial-gradient(circle at 30% 30%, #68d391, #276749)",border:"1px solid #fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${.85*p}rem`,fontWeight:900,color:"white",textShadow:"0 1px 2px rgba(0,0,0,0.5)",boxShadow:"0 2px 4px rgba(0,0,0,0.3)"},children:Ne.card.cost}),Ne.card.type==="FOLLOWER"&&l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:3*p},children:[l.jsx("svg",{width:18*p,height:18*p,viewBox:"0 0 24 24",fill:"none",children:l.jsx("polygon",{points:"12,2 22,22 2,22",fill:"#63b3ed",stroke:"none"})}),l.jsx("span",{style:{fontSize:`${.95*p}rem`,fontWeight:"bold",color:"#4299e1"},children:"currentAttack"in Ne.card?Ne.card.currentAttack:Ne.card.attack})]}),Ne.card.type==="FOLLOWER"&&l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:3*p},children:[l.jsx("svg",{width:18*p,height:18*p,viewBox:"0 0 24 24",fill:"#f56565",children:l.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})}),l.jsx("span",{style:{fontSize:`${.95*p}rem`,fontWeight:"bold",color:"#f56565"},children:"currentHealth"in Ne.card?Ne.card.currentHealth:Ne.card.health})]})]}),l.jsx("div",{style:{fontSize:`${((((wm=Ne.card.description)==null?void 0:wm.length)||0)>150?.7:(((km=Ne.card.description)==null?void 0:km.length)||0)>100?.8:.9)*p}rem`,color:"#cbd5e0",lineHeight:"1.4",whiteSpace:"pre-wrap",borderTop:"1px solid #4a5568",paddingTop:4*p},children:zS(Ne.card.description)})]}),Ne.card.flavorText&&l.jsx("div",{style:{marginTop:"auto",paddingTop:8*p,paddingBottom:4*p,flexShrink:0},children:l.jsx("div",{style:{fontSize:`${((((Am=Ne.card.flavorText)==null?void 0:Am.length)||0)>100?.6:.7)*p}rem`,color:"rgba(160, 174, 192, 0.6)",lineHeight:"1.3",fontStyle:"italic",whiteSpace:"pre-wrap",textAlign:"right"},children:Ne.card.flavorText})})]})}):l.jsx("div",{style:{marginTop:10*p,color:"#718096",fontStyle:"italic",flex:1,fontSize:`${.7*p}rem`},children:""})]}),l.jsxs("div",{ref:Bi,className:rm?"shake-target":"",style:{flex:1,height:"100%",position:"relative",background:"rgba(0,0,0,0.1)",overflow:"hidden"},children:[l.jsxs("div",{ref:zi,onMouseEnter:()=>Yn({type:"LEADER",playerId:T}),onMouseLeave:()=>Yn(null),onClick:m=>{m.stopPropagation(),et&&ff("LEADER",-1,T)},style:{position:"absolute",top:-20*p,left:"50%",transform:"translateX(-50%)",width:Qi*p,height:Qi*p,borderRadius:"50%",zIndex:100,cursor:"default"},children:[l.jsx("div",{style:{position:"absolute",inset:0,borderRadius:"50%",background:Oe.class==="AJA"?`url(${Va(Oe.class)}) center top/cover`:`url(${Va(Oe.class)}) center/cover`,border:bf?"4px solid #67e8f9":(ct==null?void 0:ct.type)==="LEADER"&&ct.playerId===T&&!et?"4px solid #f56565":"4px solid #4a5568",boxShadow:bf?"0 0 20px rgba(103, 232, 249, 0.4), 0 0 40px rgba(103, 232, 249, 0.2)":"0 0 20px rgba(0,0,0,0.5)",transition:"border-color 0.3s, box-shadow 0.3s, filter 0.5s, opacity 0.5s",animation:xm?"leaderDamageCapPulse 2s ease-in-out infinite":"none",...g.winnerId===O&&($e||lt)?{filter:$e==="white-fade"?"brightness(2) saturate(0.3)":$e==="explode"||$e==="result-text"||$e==="fade-out"||lt?"brightness(3) saturate(0) blur(10px)":"none",opacity:$e==="explode"||$e==="result-text"||$e==="fade-out"||lt?0:1}:{}},children:xm&&l.jsx("div",{style:{position:"absolute",inset:0,borderRadius:"50%",background:"radial-gradient(circle, rgba(103, 232, 249, 0.5) 0%, rgba(103, 232, 249, 0.2) 70%, rgba(103, 232, 249, 0.1) 100%)",pointerEvents:"none",animation:"leaderDamageCapOverlay 2s ease-in-out infinite",zIndex:1}})}),l.jsx("div",{style:{position:"absolute",bottom:0,left:"50%",transform:`translateX(-50%) translateX(${-140*p}px)`,width:55*p,height:55*p,background:"radial-gradient(circle at 30% 30%, #feb2b2, #c53030)",borderRadius:"50%",border:`${Math.max(2,3*p)}px solid #fff`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${1.2*p}rem`,fontWeight:900,color:"white",textShadow:"0 2px 2px rgba(0,0,0,0.5)",zIndex:10,boxShadow:"0 4px 6px rgba(0,0,0,0.4)",opacity:ee?1:0,transition:"opacity 0.3s ease-in"},children:Oe.hp}),l.jsx("div",{style:{position:"absolute",bottom:10*p,left:"50%",transform:`translateX(-50%) translateX(${-80*p}px)`,width:45*p,height:45*p,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,opacity:ee?_f?1:.5:0,filter:_f?"none":"grayscale(0.8)",transition:"opacity 0.3s ease-in"},children:l.jsx("div",{style:{display:"flex",gap:3*p},children:Array(2).fill(0).map((m,v)=>{const _=v<2-Oe.evolutionsUsed;return l.jsx("div",{style:{width:12*p,height:12*p,borderRadius:"50%",background:_?"#ecc94b":"#2d3748",boxShadow:_&&_f?"0 0 8px #ecc94b, 0 0 15px #ecc94b":"none",border:"2px solid rgba(0,0,0,0.5)"}},v)})})}),l.jsx("div",{style:{position:"absolute",bottom:10*p,left:"50%",transform:`translateX(-50%) translateX(${80*p}px)`,width:45*p,height:45*p,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,opacity:ee?xf?1:.5:0,filter:xf?"none":"grayscale(0.8)",transition:"opacity 0.3s ease-in"},children:l.jsx("div",{style:{display:"flex",gap:3*p},children:Array(2).fill(0).map((m,v)=>{const _=v<Oe.sep;return l.jsx("div",{style:{width:12*p,height:12*p,borderRadius:"50%",background:_?"#9f7aea":"#2d3748",boxShadow:_&&xf?"0 0 8px #9f7aea, 0 0 15px #9f7aea":"none",border:"2px solid rgba(0,0,0,0.5)"}},v)})})}),l.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:Qi*p*.75,height:Qi*p*.75,pointerEvents:"none",zIndex:20,opacity:(ct==null?void 0:ct.type)==="LEADER"&&ct.playerId===T&&J?1:0,transition:"opacity 0.1s ease-out"},children:[l.jsxs("svg",{width:"100%",height:"100%",viewBox:"0 0 100 100",children:[l.jsx("defs",{children:l.jsxs("filter",{id:"leaderCyanMarkerGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"4",result:"blur"}),l.jsxs("feMerge",{children:[l.jsx("feMergeNode",{in:"blur"}),l.jsx("feMergeNode",{in:"blur"}),l.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),l.jsxs("g",{style:{transformOrigin:"50% 50%",animation:"leaderMarkerSpin 2s linear infinite"},children:[l.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"rgba(100, 200, 255, 0.9)",strokeWidth:"3",strokeDasharray:"15 8",filter:"url(#leaderCyanMarkerGlow)"}),l.jsx("polygon",{points:"50,5 44,18 56,18",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"}),l.jsx("polygon",{points:"95,50 82,44 82,56",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"}),l.jsx("polygon",{points:"50,95 56,82 44,82",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"}),l.jsx("polygon",{points:"5,50 18,56 18,44",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"})]})]}),l.jsx("style",{children:`
                                @keyframes leaderMarkerSpin {
                                    0% { transform: rotate(0deg); }
                                    100% { transform: rotate(360deg); }
                                }
                            `})]})]}),l.jsxs("div",{style:{position:"absolute",top:20*p,left:20*p,width:60*p,height:85*p,zIndex:50},children:[[...Array(Math.min(5,Math.ceil(Oe.deck.length/5)))].map((m,v)=>l.jsx("div",{style:{position:"absolute",inset:0,transform:`translate(${v*2*p}px, ${-v*2*p}px)`,borderRadius:6,border:"1px solid #718096",overflow:"hidden"},children:l.jsx("img",{src:si((Oe==null?void 0:Oe.class)||"SENKA"),alt:"Deck",style:{width:"100%",height:"100%",objectFit:"cover"},onError:_=>{_.target.style.display="none",_.target.parentElement.style.background="linear-gradient(45deg, #2d3748, #1a202c)"}})},v)),l.jsx("div",{style:{position:"absolute",bottom:-20*p,width:"100%",textAlign:"center",fontWeight:"bold",color:"#a0aec0",fontSize:"0.9rem"},children:Oe.deck.length})]}),l.jsxs("div",{style:{position:"absolute",top:20*p,right:20*p,display:"flex",alignItems:"center",gap:8,zIndex:50,pointerEvents:"none"},children:[l.jsxs("div",{style:{position:"relative",width:24,height:30},children:[l.jsx("div",{style:{position:"absolute",inset:0,background:"#4a192c",borderRadius:2,border:"1px solid #742a3a",transform:"rotate(-15deg) translate(-3px, 0)"}}),l.jsx("div",{style:{position:"absolute",inset:0,background:"#3d1525",borderRadius:2,border:"1px solid #742a3a",transform:"rotate(-5deg) translate(-1px, 0)"}}),l.jsx("div",{style:{position:"absolute",inset:0,background:"#2d1a20",borderRadius:2,border:"1px solid #8b3a4a",transform:"rotate(5deg)"}})]}),l.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(74, 25, 44, 0.8), rgba(45, 26, 32, 0.9))",padding:"3px 8px",borderRadius:5,color:"#f0b8c4",fontSize:"0.64rem",fontWeight:"bold",border:"1px solid rgba(116, 42, 58, 0.5)",boxShadow:"0 2px 4px rgba(0,0,0,0.4)"},children:[" ",Oe.hand.length]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5,marginLeft:6},children:[l.jsx("div",{style:{fontSize:"0.9rem",filter:"drop-shadow(0 0 2px rgba(128, 90, 213, 0.6)) grayscale(30%)"},children:""}),l.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(128, 90, 213, 0.7), rgba(76, 29, 149, 0.8))",padding:"3px 8px",borderRadius:5,color:"#c4b5fd",fontSize:"0.64rem",fontWeight:"bold",border:"1px solid rgba(167, 139, 250, 0.4)",boxShadow:"0 2px 4px rgba(0,0,0,0.4)",position:"relative"},children:[" ",Oe.graveyard.length,Wd.filter(m=>m.playerId===T).map(m=>l.jsxs("div",{style:{position:"absolute",bottom:-25,left:"50%",transform:"translateX(-50%)",color:"#d946ef",fontSize:"1.2rem",fontWeight:"bold",textShadow:"0 0 8px #d946ef, 0 0 15px #a855f7, 0 0 25px #7c3aed",animation:"necromanceFloatOpponent 1.5s ease-out forwards",pointerEvents:"none",whiteSpace:"nowrap"},children:["-",m.amount]},m.key))]})]})]}),l.jsx("div",{style:{position:"absolute",top:`calc(50% - ${En*p/2}px - ${70*p}px)`,left:"0",width:"100%",height:En*p,pointerEvents:"none",zIndex:10},children:l.jsx("div",{style:{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center"},children:cn.map((m,v)=>{const _=cn.length,R=(v-(_-1)/2)*ii*p;return l.jsxs("div",{ref:D=>rr.current[v]=D,onMouseEnter:()=>{J&&Yn({type:"FOLLOWER",index:v,playerId:T,instanceId:m==null?void 0:m.instanceId})},onMouseLeave:()=>{J&&Yn(null)},onClick:D=>{if(D.stopPropagation(),et){if(!m)return;ff("FOLLOWER",v,T,m==null?void 0:m.instanceId)}else m&&Mr({card:m,owner:"OPPONENT",source:"BOARD"})},style:{position:"absolute",left:"50%",top:0,transform:`translateX(calc(-50% + ${R}px))`,transition:"transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1), left 0.4s ease",border:et&&m&&et.allowedTargetPlayerId===T?"2px solid #f56565":"none",boxShadow:et&&m&&et.allowedTargetPlayerId===T?"0 0 15px #f56565":"none",borderRadius:8,cursor:et?"crosshair":"default",width:rn*p,height:En*p,pointerEvents:"auto",opacity:Rt&&Rt.sourcePlayerId===T&&Rt.followerIndex===v?0:m!=null&&m.isDying?.8:1,transitionProperty:Rt&&Rt.sourcePlayerId===T&&Rt.followerIndex===v?"none":"transform, left, opacity"},children:[l.jsx("div",{style:{width:"100%",height:"100%",perspective:"800px"},children:l.jsxs("div",{className:Q0===(m==null?void 0:m.instanceId)||J0===(m==null?void 0:m.instanceId)?"attack-rotating":"",style:{width:"100%",height:"100%",position:"relative",transformStyle:"preserve-3d"},children:[l.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},children:m?l.jsx(Xi,{card:m,turnCount:g.turnCount,className:m.isDying?"card-dying":"",scale:p,style:{width:rn*p,height:En*p,opacity:1,filter:m.isDying?"grayscale(0.5) brightness(2)":"none",boxShadow:(ct==null?void 0:ct.type)==="FOLLOWER"&&ct.index===v&&(J==null?void 0:J.sourceType)==="BOARD"?"0 0 20px #f56565":(J==null?void 0:J.sourceType)==="BOARD"?"0 0 20px #f6e05e":void 0},isOnBoard:!0,isSpecialSummoning:X0.has(m.instanceId)}):l.jsx("div",{style:{width:rn*p,height:En*p,border:"1px dashed rgba(255,255,255,0.1)",borderRadius:8}})}),m&&l.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",transform:"rotateY(180deg)",borderRadius:12,overflow:"hidden"},children:l.jsx("img",{src:si((Oe==null?void 0:Oe.class)||"SENKA"),alt:"Card Sleeve",style:{width:"100%",height:"100%",objectFit:"cover"}})})]})}),m&&(J==null?void 0:J.sourceType)==="BOARD"&&l.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",width:"100%",height:"100%",transform:"translate(-50%, -50%)",pointerEvents:"none",zIndex:20,opacity:(ct==null?void 0:ct.type)==="FOLLOWER"&&ct.index===v&&ct.playerId===T?1:0,transition:"opacity 0.1s ease-out"},children:[l.jsxs("svg",{viewBox:"0 0 100 100",style:{width:"100%",height:"100%",filter:"drop-shadow(0 0 12px rgba(100, 200, 255, 0.9))"},children:[l.jsx("defs",{children:l.jsxs("filter",{id:"cyanMarkerGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"4",result:"blur"}),l.jsxs("feMerge",{children:[l.jsx("feMergeNode",{in:"blur"}),l.jsx("feMergeNode",{in:"blur"}),l.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),l.jsxs("g",{style:{transformOrigin:"50px 50px",animation:"attackMarkerSpin 1.5s linear infinite reverse"},children:[l.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:"rgba(100, 200, 255, 0.95)",strokeWidth:"4",strokeDasharray:"12 6",filter:"url(#cyanMarkerGlow)"}),l.jsx("polygon",{points:"50,10 45,20 55,20",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"}),l.jsx("polygon",{points:"90,50 80,45 80,55",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"}),l.jsx("polygon",{points:"50,90 55,80 45,80",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"}),l.jsx("polygon",{points:"10,50 20,55 20,45",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"})]})]}),l.jsx("style",{children:`
                                                    @keyframes attackMarkerSpin {
                                                        0% { transform: rotate(0deg); }
                                                        100% { transform: rotate(360deg); }
                                                    }
                                                `})]})]},(m==null?void 0:m.instanceId)||`empty-opp-${v}`)})})}),l.jsx("div",{style:{position:"absolute",bottom:`calc(50% - ${En*p/2}px - ${70*p}px)`,left:"0",width:"100%",height:En*p,pointerEvents:"none",zIndex:10},children:l.jsx("div",{style:{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center"},children:_n.map((m,v)=>{const _=_n.length,R=(v-(_-1)/2)*ii*p;return l.jsxs("div",{ref:D=>br.current[v]=D,onMouseDown:D=>cm(D,v,m==null?void 0:m.instanceId),onTouchStart:D=>cm(D,v,m==null?void 0:m.instanceId),onClick:D=>D.stopPropagation(),onMouseEnter:()=>{J&&Yn({type:"FOLLOWER",index:v,playerId:O,instanceId:m==null?void 0:m.instanceId})},onMouseLeave:()=>{J&&Yn(null)},style:{position:"absolute",left:"50%",top:0,"--offsetX":`calc(-50% + ${R}px)`,transform:`translateX(calc(-50% + ${R}px)) ${(J==null?void 0:J.sourceType)==="BOARD"&&J.sourceInstanceId===(m==null?void 0:m.instanceId)?"translateY(-20px) scale(1.1)":""}`,transition:"transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1), left 0.4s ease",cursor:"pointer",pointerEvents:"auto",width:rn*p,height:En*p,border:et&&m&&et.allowedTargetPlayerId===O?"2px solid #48bb78":"none",boxShadow:et&&m&&et.allowedTargetPlayerId===O?"0 0 15px #48bb78":"none",borderRadius:8,zIndex:(J==null?void 0:J.sourceType)==="BOARD"&&J.sourceInstanceId===(m==null?void 0:m.instanceId)?10:1,opacity:Rt&&Rt.sourcePlayerId===O&&Rt.followerIndex===v?0:m!=null&&m.isDying?.8:1,transitionProperty:Rt&&Rt.sourcePlayerId===O&&Rt.followerIndex===v?"none":"transform, left, opacity"},children:[l.jsx("div",{style:{width:"100%",height:"100%",perspective:"800px"},children:l.jsxs("div",{className:Q0===(m==null?void 0:m.instanceId)||J0===(m==null?void 0:m.instanceId)?"attack-rotating":"",style:{width:"100%",height:"100%",position:"relative",transformStyle:"preserve-3d"},children:[l.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},children:m?l.jsx(Xi,{card:m,turnCount:g.turnCount,className:m.isDying?"card-dying":"",scale:p,style:{width:rn*p,height:En*p,opacity:1,filter:m.isDying?"grayscale(0.5) brightness(2)":"none",boxShadow:(J==null?void 0:J.sourceType)==="BOARD"&&J.sourceInstanceId===(m==null?void 0:m.instanceId)&&(ct==null?void 0:ct.type)==="FOLLOWER"?"0 0 30px #f56565":(J==null?void 0:J.sourceType)==="BOARD"&&J.sourceInstanceId===(m==null?void 0:m.instanceId)?"0 20px 30px rgba(0,0,0,0.6)":void 0,pointerEvents:(J==null?void 0:J.sourceType)==="BOARD"&&J.sourceInstanceId===(m==null?void 0:m.instanceId)?"none":"auto"},isSelected:(Ne==null?void 0:Ne.card)===m,isOnBoard:!0,isSpecialSummoning:X0.has(m.instanceId),isMyTurn:g.activePlayerId===O}):l.jsx("div",{style:{width:rn*p,height:En*p,border:"1px dashed rgba(255,255,255,0.2)",borderRadius:8}})}),m&&l.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",transform:"rotateY(180deg)",borderRadius:12,overflow:"hidden"},children:l.jsx("img",{src:si((ie==null?void 0:ie.class)||"SENKA"),alt:"Card Sleeve",style:{width:"100%",height:"100%",objectFit:"cover"}})})]})}),m&&(J==null?void 0:J.sourceType)==="EVOLVE"&&!m.hasEvolved&&l.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",width:"120%",height:"120%",transform:"translate(-50%, -50%)",pointerEvents:"none",border:J.useSep?"2px dashed rgba(183, 148, 244, 0.9)":"2px dashed rgba(255, 230, 100, 0.9)",borderRadius:"50%",boxShadow:J.useSep?"0 0 15px rgba(159, 122, 234, 0.8)":"0 0 15px rgba(255, 200, 50, 0.8)",animation:"evolveMarkerSpin 1.5s linear infinite",zIndex:20,opacity:(ct==null?void 0:ct.type)==="FOLLOWER"&&ct.index===v&&ct.playerId===O?1:0,transition:"opacity 0.1s ease-out"},children:[l.jsxs("svg",{viewBox:"0 0 100 100",style:{width:"100%",height:"100%",filter:"drop-shadow(0 0 8px currentColor)"},children:[l.jsx("defs",{children:l.jsxs("filter",{id:J.useSep?"purpleMarkerGlow":"yellowMarkerGlow",x:"-30%",y:"-30%",width:"160%",height:"160%",children:[l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"3",result:"blur"}),l.jsxs("feMerge",{children:[l.jsx("feMergeNode",{in:"blur"}),l.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),l.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:J.useSep?"#b794f4":"#f6e05e",strokeWidth:"4",strokeDasharray:"15 8",filter:`url(#${J.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`,opacity:"0.95"}),l.jsx("polygon",{points:"50,5 45,15 55,15",fill:J.useSep?"#b794f4":"#f6e05e",filter:`url(#${J.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`}),l.jsx("polygon",{points:"95,50 85,45 85,55",fill:J.useSep?"#b794f4":"#f6e05e",filter:`url(#${J.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`}),l.jsx("polygon",{points:"50,95 55,85 45,85",fill:J.useSep?"#b794f4":"#f6e05e",filter:`url(#${J.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`}),l.jsx("polygon",{points:"5,50 15,55 15,45",fill:J.useSep?"#b794f4":"#f6e05e",filter:`url(#${J.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`})]}),l.jsx("style",{children:`
                                                @keyframes evolveMarkerSpin {
                                                    0% { transform: translate(-50%, -50%) rotate(0deg); }
                                                    100% { transform: translate(-50%, -50%) rotate(360deg); }
                                                }
                                            `})]})]},(m==null?void 0:m.instanceId)||`empty-plr-${v}`)})})}),l.jsxs("div",{style:{position:"absolute",right:30*p,top:"50%",transform:"translateY(-50%)",display:"flex",flexDirection:"column",alignItems:"center",gap:30*p,zIndex:50},children:[l.jsx("div",{style:{textAlign:"center"},children:l.jsxs("div",{style:{fontSize:`${1.2*p}rem`,fontWeight:700,color:"#a0aec0",fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif'},children:["Turn ",g.turnCount]})}),l.jsxs("div",{style:{textAlign:"center"},children:[l.jsxs("div",{style:{fontSize:`${1.8*p}rem`,fontWeight:900,color:"#f6e05e",fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif'},children:[Oe.pp,"/",Oe.maxPp]}),l.jsx("div",{style:{display:"flex",gap:4*p,justifyContent:"center"},children:Array(Math.min(10,Oe.maxPp)).fill(0).map((m,v)=>l.jsx("div",{style:{width:10*p,height:10*p,borderRadius:"50%",background:v<Oe.pp?"#f6e05e":"#2d3748"}},v))})]}),l.jsxs("div",{style:{position:"relative",width:160*p,height:160*p},children:[l.jsx(XO,{isMyTurn:g.activePlayerId===O,turnCount:g.turnCount,activePlayerId:g.activePlayerId,onTimeUp:tI,timerEnabled:h,isGameOver:!!g.winnerId,isPaused:N,scale:p,buttonSize:160,timerDuration:60}),l.jsxs("button",{ref:Y0,disabled:g.activePlayerId!==O||Vi,onMouseDown:m=>{m.stopPropagation(),g.activePlayerId===O&&!Vi&&pf(!0)},onMouseUp:m=>{var v;if(m.stopPropagation(),ic&&g.activePlayerId===O&&!Vi){pf(!1),gt("sisiodosi.mp3",.6);const _=(v=m.target.closest("button"))==null?void 0:v.getBoundingClientRect();_&&pm(_.left+_.width/2,_.top+_.height/2),mf()}},onMouseLeave:()=>{pf(!1)},style:{width:160*p,height:160*p,borderRadius:"50%",border:"4px solid rgba(255,255,255,0.2)",background:Vi?"linear-gradient(135deg, #805ad5, #6b46c1)":ic?"linear-gradient(135deg, #5a9bd5, #4a7fb0)":g.activePlayerId===O?"linear-gradient(135deg, #3182ce, #2b6cb0)":"#2d3748",color:"white",fontWeight:900,fontSize:`${2*p}rem`,fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif',boxShadow:g.activePlayerId===O?ic?"0 0 20px rgba(66, 153, 225, 0.5)":"0 0 40px rgba(66, 153, 225, 0.8)":"none",opacity:ic?.8:1,cursor:g.activePlayerId===O&&!Vi?"pointer":"default",transition:"all 0.1s",position:"relative",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",lineHeight:1.2},children:[l.jsx("img",{src:Je("/assets/tenfubu_mark.png"),alt:"",style:{position:"absolute",width:"80%",height:"80%",objectFit:"contain",opacity:.25,pointerEvents:"none"}}),Vi?l.jsx("span",{style:{position:"relative",zIndex:1,whiteSpace:"nowrap"},children:"..."}):l.jsxs(l.Fragment,{children:[l.jsx("span",{style:{position:"relative",zIndex:1,whiteSpace:"nowrap"},children:""}),l.jsx("span",{style:{position:"relative",zIndex:1,whiteSpace:"nowrap"},children:""})]})]})]}),l.jsxs("div",{style:{textAlign:"center"},children:[l.jsx("div",{style:{fontSize:`${2.4*p}rem`,fontWeight:900,color:"#f6e05e",fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif'},children:ie.extraPpActive?l.jsxs("span",{children:[Math.max(0,ie.pp-1),"/",ie.maxPp," ",l.jsx("span",{style:{color:"#ed8936"},children:"+1"})]}):l.jsxs("span",{children:[ie.pp,"/",ie.maxPp]})}),l.jsx("div",{style:{display:"flex",gap:3*p,justifyContent:"center"},children:Array(10).fill(0).map((m,v)=>{const _=v<ie.pp,R=v<ie.maxPp;let D;return _?D="#f6e05e":R?D="#744210":D="#2d3748",l.jsx("div",{style:{width:11*p,height:11*p,borderRadius:"50%",background:D}},v)})})]}),(()=>{const m=O!==g.firstPlayerId,v=g.activePlayerId===O,_=g.turnCount,R=_<=5&&!ie.extraPpUsedEarly,D=_>=6&&!ie.extraPpUsedLate,W=m&&v&&!ie.extraPpActive&&(R||D),q=ie.extraPpActive;if(!m)return null;const $=_<=5&&ie.extraPpUsedEarly||_>=6&&ie.extraPpUsedLate,U=!W&&!q;return l.jsxs("button",{disabled:U,onClick:V=>{V.stopPropagation(),U||ls({type:"TOGGLE_EXTRA_PP",playerId:O})},style:{width:160*p,height:45*p,borderRadius:12*p,border:q?"3px solid #ed8936":"3px solid rgba(255,255,255,0.2)",background:q?"linear-gradient(135deg, #ed8936, #dd6b20)":W?"linear-gradient(135deg, #744210, #5a3510)":"#2d3748",color:q?"white":W?"#f6e05e":"#718096",fontWeight:700,fontSize:"1rem",boxShadow:q?"0 0 20px rgba(237, 137, 54, 0.6)":"none",cursor:U?"default":"pointer",transition:"all 0.3s",display:"flex",alignItems:"center",justifyContent:"center",gap:6*p,opacity:$&&!q?.5:1},children:[l.jsx("span",{children:"PP"}),l.jsx("span",{style:{fontSize:"1.3rem"},children:"+1"}),q&&l.jsx("span",{style:{fontSize:"0.8rem"},children:"ON"}),$&&!q&&l.jsx("span",{style:{fontSize:"0.7rem",marginLeft:2},children:""})]})})()]}),K?l.jsxs(l.Fragment,{children:[l.jsx("button",{onClick:m=>{m.stopPropagation(),ef(!0)},style:{position:"absolute",left:15*p,top:120*p,width:64*p,height:64*p,minWidth:64*p,maxWidth:64*p,minHeight:64*p,maxHeight:64*p,borderRadius:"50%",background:"linear-gradient(135deg, #4a5568 0%, #2d3748 100%)",border:"3px solid #63b3ed",color:"#63b3ed",fontSize:`${1.8*p}rem`,fontWeight:"bold",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,padding:0,zIndex:16,boxShadow:"0 2px 8px rgba(0,0,0,0.4)",transition:"all 0.2s ease"},onMouseEnter:m=>{m.currentTarget.style.transform="scale(1.1)",m.currentTarget.style.boxShadow="0 0 15px rgba(99, 179, 237, 0.5)"},onMouseLeave:m=>{m.currentTarget.style.transform="scale(1)",m.currentTarget.style.boxShadow="0 2px 8px rgba(0,0,0,0.4)"},children:"?"}),l.jsx(fL,{logs:g.logs||[],onCardNameClick:Jd,scale:p,isMobile:K})]}):l.jsxs("div",{style:{position:"absolute",left:15,top:"50%",transform:"translateY(-50%)",display:"flex",flexDirection:"column",alignItems:"flex-start",gap:8,zIndex:16,pointerEvents:"none"},children:[l.jsx("button",{onClick:m=>{m.stopPropagation(),ef(!0)},style:{width:36,height:36,borderRadius:"50%",background:"linear-gradient(135deg, #4a5568 0%, #2d3748 100%)",border:"2px solid #63b3ed",color:"#63b3ed",fontSize:"1.2rem",fontWeight:"bold",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",padding:0,boxShadow:"0 4px 12px rgba(0,0,0,0.4)",transition:"all 0.2s ease",pointerEvents:"auto"},onMouseEnter:m=>{m.currentTarget.style.transform="scale(1.1)",m.currentTarget.style.boxShadow="0 0 15px rgba(99, 179, 237, 0.5)"},onMouseLeave:m=>{m.currentTarget.style.transform="scale(1)",m.currentTarget.style.boxShadow="0 4px 12px rgba(0,0,0,0.4)"},children:"?"}),l.jsxs("div",{style:{width:Math.max(180,220*p),height:Math.max(200,280*p),overflowY:"auto",background:"linear-gradient(to right, rgba(0,0,0,0.8), rgba(0,0,0,0.0))",color:"#fff",fontSize:`${Math.max(.65,.75*p)}rem`,padding:`${8*p}px ${8*p}px ${8*p}px ${12*p}px`,borderLeft:"3px solid #63b3ed",pointerEvents:"auto",scrollbarWidth:"thin"},onMouseDown:m=>m.stopPropagation(),onClick:m=>m.stopPropagation(),ref:m=>{m&&(m.scrollTop=m.scrollHeight)},children:[l.jsx("div",{style:{fontWeight:"bold",marginBottom:4*p,color:"#a0aec0",borderBottom:"1px solid rgba(255,255,255,0.1)",paddingBottom:2,fontSize:`${Math.max(.55,.65*p)}rem`,textTransform:"uppercase",letterSpacing:1},children:"BATTLE LOG"}),l.jsx("div",{style:{display:"flex",flexDirection:"column",gap:3*p},children:(g.logs||[]).map((m,v)=>l.jsx("div",{style:{opacity:.9,lineHeight:"1.4",textShadow:"0 1px 2px black",animation:"fadeIn 0.3s ease-out"},children:m},v))})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,pointerEvents:"none"},children:[l.jsxs("div",{style:{position:"relative",width:32,height:40},children:[l.jsx("div",{style:{position:"absolute",inset:0,background:"#4a5568",borderRadius:4,border:"1px solid #718096",transform:"rotate(-15deg) translate(-5px, 0)"}}),l.jsx("div",{style:{position:"absolute",inset:0,background:"#2d3748",borderRadius:4,border:"1px solid #718096",transform:"rotate(-5deg) translate(-2px, 0)"}}),l.jsx("div",{style:{position:"absolute",inset:0,background:"#1a202c",borderRadius:4,border:"1px solid #cbd5e0",transform:"rotate(5deg)"}})]}),l.jsxs("div",{style:{background:"rgba(0,0,0,0.7)",padding:"4px 12px",borderRadius:8,color:"#e2e8f0",fontSize:"0.9rem",fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5)"},children:[" ",ie.hand.length]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,marginLeft:6},children:[l.jsx("div",{style:{fontSize:"1.2rem",filter:"drop-shadow(0 0 3px rgba(128, 90, 213, 0.8))"},children:""}),l.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(128, 90, 213, 0.8), rgba(76, 29, 149, 0.9))",padding:"4px 12px",borderRadius:8,color:"#e2e8f0",fontSize:"0.9rem",fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5), inset 0 1px rgba(255,255,255,0.1)",border:"1px solid rgba(167, 139, 250, 0.5)",position:"relative"},children:[" ",ie.graveyard.length,Wd.filter(m=>m.playerId===O).map(m=>l.jsxs("div",{style:{position:"absolute",top:-30,left:"50%",transform:"translateX(-50%)",color:"#d946ef",fontSize:"1.5rem",fontWeight:"bold",textShadow:"0 0 10px #d946ef, 0 0 20px #a855f7, 0 0 30px #7c3aed",animation:"necromanceFloat 1.5s ease-out forwards",pointerEvents:"none",whiteSpace:"nowrap"},children:["-",m.amount]},m.key))]})]})]}),Ne&&Ne.owner==="PLAYER"&&Ne.source==="HAND"&&jr&&(()=>{const _=((K?Math.max(140,180*p):Math.max(180,220*p))-6)/2,R=ie.pp>=Ne.card.cost;return l.jsxs("button",{disabled:!R,onClick:D=>{D.stopPropagation(),hm()},className:R?"play-button-active":"",style:{width:_,background:R?"linear-gradient(to bottom, #48bb78, #38a169)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:"8px 4px",borderRadius:12,fontSize:"0.85rem",fontWeight:"bold",cursor:R?"pointer":"not-allowed",boxShadow:R?"0 0 15px rgba(72, 187, 120, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease",pointerEvents:"auto"},onMouseDown:D=>D.stopPropagation(),children:["",l.jsxs("div",{style:{fontSize:"0.6rem",opacity:.8,marginTop:2},children:["pp ",Ne.card.cost]})]})})(),Ne&&Ne.owner==="PLAYER"&&Ne.source==="BOARD"&&(()=>{const m=K?Math.max(140,180*p):Math.max(180,220*p),v=6,_=(m-v)/2,R=Ne.card,D=R==null?void 0:R.hasEvolved,W=!D&&us,q=!D&&ds,$=R==null?void 0:R.instanceId,U=ie.board.findIndex(Z=>Z&&Z.instanceId===$),V=ie.board.slice(0,U+1).filter(Z=>Z).length-1,ae=Z=>{U<0||rc(V>=0?V:U,Z,void 0,$)};return l.jsxs("div",{style:{display:"flex",gap:v,pointerEvents:"auto"},onMouseDown:Z=>Z.stopPropagation(),children:[l.jsxs("button",{disabled:!W,onClick:Z=>{Z.stopPropagation(),ae(!1)},style:{width:_,background:W?"linear-gradient(to bottom, #faf089, #d69e2e)":"#718096",color:W?"#1a202c":"white",border:"2px solid rgba(255,255,255,0.2)",padding:"8px 4px",borderRadius:12,fontSize:"0.85rem",fontWeight:"bold",cursor:W?"pointer":"not-allowed",boxShadow:W?"0 0 15px rgba(250, 240, 137, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:W?"0 1px 1px rgba(255,255,255,0.3)":"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",l.jsx("div",{style:{fontSize:"0.6rem",opacity:.8,marginTop:2},children:"EP"})]}),l.jsxs("button",{disabled:!q,onClick:Z=>{Z.stopPropagation(),ae(!0)},style:{width:_,background:q?"linear-gradient(to bottom, #b794f4, #805ad5)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:"8px 4px",borderRadius:12,fontSize:"0.85rem",fontWeight:"bold",cursor:q?"pointer":"not-allowed",boxShadow:q?"0 0 15px rgba(183, 148, 244, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",l.jsx("div",{style:{fontSize:"0.6rem",opacity:.8,marginTop:2},children:"SEP"})]})]})})(),!(Ne&&Ne.owner==="PLAYER"&&(Ne.source==="HAND"||Ne.source==="BOARD"))&&(()=>{const m=K?Math.max(140,180*p):Math.max(180,220*p);return l.jsx("div",{style:{width:m,height:52,visibility:"hidden",pointerEvents:"none"}})})()]}),(dt==="TOSSING"||dt==="RESULT")&&l.jsxs("div",{style:{position:"absolute",inset:0,zIndex:4e3,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.85)",pointerEvents:"none"},children:[l.jsxs("div",{style:{textAlign:"center"},children:[l.jsx("div",{style:{width:120*p,height:120*p,margin:`0 auto ${30*p}px`,borderRadius:"50%",background:dt==="RESULT"?Wt==="FIRST"?"linear-gradient(135deg, #ffd700, #ff8c00)":"linear-gradient(135deg, #c0c0c0, #808080)":"linear-gradient(135deg, #ffd700, #ff8c00)",boxShadow:dt==="RESULT"?`0 0 ${40*p}px ${Wt==="FIRST"?"#ffd700":"#c0c0c0"}, 0 0 ${80*p}px ${Wt==="FIRST"?"rgba(255,215,0,0.5)":"rgba(192,192,192,0.5)"}`:`0 0 ${30*p}px #ffd700`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"3rem",fontWeight:900,color:"#1a202c",textShadow:"0 2px 2px rgba(0,0,0,0.5)",animation:dt==="TOSSING"?"coinFlip 0.3s ease-in-out infinite":"coinLand 0.5s ease-out",border:"4px solid rgba(255,255,255,0.3)"},children:dt==="RESULT"?Wt==="FIRST"?"":"":"?"}),l.jsxs("div",{style:{fontSize:dt==="RESULT"?"2.5rem":"1.8rem",fontWeight:900,color:Wt==="FIRST"?"#ffd700":Wt==="SECOND"?"#c0c0c0":"white",textShadow:"0 0 20px currentColor, 0 2px 4px black",animation:dt==="RESULT"?"textPop 0.5s ease-out":"none"},children:[dt==="TOSSING"&&"...",dt==="RESULT"&&(Wt==="FIRST"?"":"")]}),dt==="RESULT"&&l.jsx("div",{style:{fontSize:"1rem",color:"#a0aec0",marginTop:10*p,animation:"fadeIn 0.5s ease-out 0.3s both"},children:Wt==="FIRST"?"":""})]}),l.jsx("style",{children:`
                            @keyframes coinFlip {
                                0%, 100% { transform: rotateY(0deg) scale(1); }
                                50% { transform: rotateY(180deg) scale(1.1); }
                            }
                            @keyframes coinLand {
                                0% { transform: rotateY(720deg) scale(0.5); }
                                70% { transform: rotateY(0deg) scale(1.2); }
                                100% { transform: rotateY(0deg) scale(1); }
                            }
                            @keyframes textPop {
                                0% { transform: scale(0.5); opacity: 0; }
                                70% { transform: scale(1.2); }
                                100% { transform: scale(1); opacity: 1; }
                            }
                        `})]}),Bd&&l.jsxs("div",{style:{position:"absolute",inset:0,zIndex:3e3,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.7)",pointerEvents:"none",animation:"fadeIn 0.2s ease-out"},children:[l.jsx("div",{style:{fontSize:`${3.5*p}rem`,fontWeight:900,fontFamily:"Tamanegi, sans-serif",background:"linear-gradient(135deg, #ffd700, #ff6b6b, #ffd700)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",textShadow:"none",filter:`drop-shadow(0 0 ${15*p}px rgba(255,215,0,0.8)) drop-shadow(0 0 ${30*p}px rgba(255,107,107,0.5))`,animation:"gameStartPop 0.8s ease-out",letterSpacing:"0.2em"},children:" "}),l.jsx("style",{children:`
                            @keyframes gameStartPop {
                                0% { transform: scale(0.3) rotate(-10deg); opacity: 0; }
                                50% { transform: scale(1.2) rotate(5deg); opacity: 1; }
                                70% { transform: scale(0.95) rotate(-2deg); }
                                100% { transform: scale(1) rotate(0deg); opacity: 1; }
                            }
                        `})]}),l.jsxs("div",{ref:ri,style:{position:"absolute",bottom:-20*p,left:"50%",transform:"translateX(-50%)",width:Qi*p,height:Qi*p,borderRadius:"50%",zIndex:200},children:[l.jsxs("div",{onMouseDown:JS,style:{width:"100%",height:"100%",borderRadius:"50%",overflow:"hidden",border:Ef?"4px solid #67e8f9":"4px solid #3182ce",boxShadow:Ef?"0 0 20px rgba(103, 232, 249, 0.4), 0 0 40px rgba(103, 232, 249, 0.2)":"0 0 20px rgba(49, 130, 206, 0.4)",background:"#1a202c",cursor:"grab",transition:"border-color 0.3s, box-shadow 0.3s, filter 0.5s, opacity 0.5s",animation:_m?"leaderDamageCapPulse 2s ease-in-out infinite":"none",position:"relative",...g.winnerId&&g.winnerId!==O&&($e||lt)?{filter:$e==="white-fade"?"brightness(2) saturate(0.3)":$e==="explode"||$e==="result-text"||$e==="fade-out"||lt?"brightness(3) saturate(0) blur(10px)":"none",opacity:$e==="explode"||$e==="result-text"||$e==="fade-out"||lt?0:1}:{}},children:[l.jsx("img",{src:Va(ie.class),style:ie.class==="AJA"?{width:"100%",height:"100%",objectFit:"cover",objectPosition:"center top",pointerEvents:"none"}:{width:"100%",height:"100%",objectFit:"cover",pointerEvents:"none"}}),_m&&l.jsx("div",{style:{position:"absolute",inset:0,borderRadius:"50%",background:"radial-gradient(circle, rgba(103, 232, 249, 0.5) 0%, rgba(103, 232, 249, 0.2) 70%, rgba(103, 232, 249, 0.1) 100%)",pointerEvents:"none",animation:"leaderDamageCapOverlay 2s ease-in-out infinite",zIndex:1}})]}),l.jsx("div",{style:{position:"absolute",top:0,left:"50%",transform:`translateX(-50%) translateX(${-140*p}px)`,width:55*p,height:55*p,background:"radial-gradient(circle at 30% 30%, #feb2b2, #c53030)",borderRadius:"50%",border:`${Math.max(2,3*p)}px solid #fff`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${1.2*p}rem`,fontWeight:900,color:"white",textShadow:"0 2px 2px rgba(0,0,0,0.5)",boxShadow:"0 4px 6px rgba(0,0,0,0.4)",zIndex:10,opacity:ee?1:0,transition:"opacity 0.3s ease-in"},children:ie.hp}),l.jsx("div",{onMouseDown:m=>sc(m,!1),onTouchStart:m=>sc(m,!1),style:{position:"absolute",top:10*p,left:"50%",transform:`translateX(-50%) translateX(${-80*p}px)`,width:45*p,height:45*p,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:us?"rgba(255,235,100,0.2)":"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",cursor:us?"grab":"default",zIndex:10,opacity:ee?oc?1:.5:0,filter:oc?"none":"grayscale(0.8)",transition:"opacity 0.3s ease-in, filter 0.3s, background 0.3s",boxShadow:us?"0 0 12px #ffd700, 0 0 25px rgba(255,215,0,0.5)":"none",animation:us?"epPulse 1.5s ease-in-out infinite":"none"},children:l.jsx("div",{style:{display:"flex",gap:3*p},children:Array(2).fill(0).map((m,v)=>{const _=v<gm;let R="none";return _&&oc&&(R=us?"0 0 10px #fff59d, 0 0 20px #ffd700, 0 0 30px #ecc94b":"0 0 8px #ecc94b, 0 0 15px #ecc94b"),l.jsx("div",{style:{width:12*p,height:12*p,borderRadius:"50%",background:_?us?"#fff59d":"#ecc94b":"#2d3748",boxShadow:R,border:"2px solid rgba(0,0,0,0.5)",transition:"box-shadow 0.3s, background 0.3s"}},v)})})}),l.jsx("div",{onMouseDown:m=>sc(m,!0),onTouchStart:m=>sc(m,!0),style:{position:"absolute",top:10*p,left:"50%",transform:`translateX(-50%) translateX(${80*p}px)`,width:45*p,height:45*p,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:ds?"rgba(200,160,255,0.2)":"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,cursor:ds?"grab":"default",opacity:ee?ac?1:.5:0,filter:ac?"none":"grayscale(0.8)",transition:"opacity 0.3s ease-in, filter 0.3s, background 0.3s",boxShadow:ds?"0 0 12px #b794f4, 0 0 25px rgba(159,122,234,0.5)":"none",animation:ds?"sepPulse 1.5s ease-in-out infinite":"none"},children:l.jsx("div",{style:{display:"flex",gap:3*p},children:Array(2).fill(0).map((m,v)=>{const _=v<ie.sep;let R="none";return _&&ac&&(R=ds?"0 0 10px #d6bcfa, 0 0 20px #b794f4, 0 0 30px #9f7aea":"0 0 8px #9f7aea, 0 0 15px #9f7aea"),l.jsx("div",{style:{width:12*p,height:12*p,borderRadius:"50%",background:_?ds?"#d6bcfa":"#9f7aea":"#2d3748",boxShadow:R,border:"2px solid rgba(0,0,0,0.5)",transition:"box-shadow 0.3s, background 0.3s"}},v)})})})]}),l.jsxs("div",{style:{position:"absolute",bottom:10*p,right:15*p,width:60*p,height:85*p,zIndex:50},children:[[...Array(Math.min(5,Math.ceil(ie.deck.length/5)))].map((m,v)=>l.jsx("div",{style:{position:"absolute",inset:0,transform:`translate(${v*2*p}px, ${-v*2*p}px)`,borderRadius:6,border:"1px solid #718096",boxShadow:"1px 1px 3px rgba(0,0,0,0.5)",overflow:"hidden"},children:l.jsx("img",{src:si((ie==null?void 0:ie.class)||"SENKA"),alt:"Deck",style:{width:"100%",height:"100%",objectFit:"cover"},onError:_=>{_.target.style.display="none",_.target.parentElement.style.background="linear-gradient(45deg, #2d3748, #1a202c)"}})},v)),l.jsx("div",{style:{position:"absolute",top:-20*p,width:"100%",textAlign:"center",color:"#a0aec0",fontSize:"0.9rem",fontWeight:"bold",textShadow:"0 1px 2px black"},children:ie.deck.length})]}),l.jsx("div",{style:{position:"absolute",bottom:0,left:0,width:"100%",height:200*p,display:"flex",justifyContent:"center",alignItems:"flex-end",pointerEvents:"none",zIndex:500},children:ie.hand.map((m,v)=>{if(We!==null&&We.sourceIndex===v)return null;const R=ie.hand.length;let D=0,W=0,q=0;if(jr){const U=100*p,V=window.innerWidth-40*p,ae=(R-1)*U+rn*p;let Z=U;ae>V&&(Z=(V-rn*p)/Math.max(1,R-1)),D=(v-(R-1)/2)*Z,W=me===v?-8*p:0,q=0}else{const U=45*p,V=160*p,ae=rn*p/2,Z=window.innerWidth/2-V-ae,fe=window.innerWidth-340*p-V,ve=(R-1)*U+rn*p;let Ge=U;ve>fe&&(Ge=(fe-rn*p)/Math.max(1,R-1)),D=Z-(R-1-v)*Ge,W=0,q=(v-(R-1)/2)*3}const $=ie.pp>=m.cost&&g.activePlayerId===O;return l.jsx("div",{onMouseDown:U=>{lm(U,v),jr&&Se(v===me?null:v)},onTouchStart:U=>{lm(U,v),jr&&Se(v===me?null:v)},style:{position:"absolute",left:"50%",bottom:5*p,transform:`translateX(calc(-50% + ${D}px)) translateY(${W}px) rotate(${q}deg) ${(J==null?void 0:J.sourceType)==="HAND"&&J.sourceIndex===v?"scale(1.05) translateY(-10px)":jr?"translateY(-3px)":""}`,transition:BS===v?"all 0.3s ease-in":(J==null?void 0:J.sourceType)==="HAND"&&J.sourceIndex===v?"none":"all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1)",zIndex:(J==null?void 0:J.sourceType)==="HAND"&&J.sourceIndex===v?1e3:v+100,width:(K?80:rn)*p,height:(K?115:En)*p,pointerEvents:"auto",cursor:$?"grab":"not-allowed"},onClick:U=>U.stopPropagation(),children:l.jsx(Xi,{card:m,turnCount:g.turnCount,isMyTurn:g.activePlayerId===O,isPlayable:$,scale:p,variant:K?"mobile-hand":"normal",style:{width:K?80*p:rn*p,height:K?115*p:En*p,boxShadow:(J==null?void 0:J.sourceType)==="HAND"&&J.sourceIndex===v?"0 0 40px rgba(49, 130, 206, 0.8)":$?"0 0 15px rgba(40, 180, 100, 0.6)":"none"}})},m.instanceId)})}),K&&l.jsxs("div",{style:{position:"absolute",bottom:200*p,left:15*p,display:"flex",alignItems:"center",gap:10*p,zIndex:601,pointerEvents:"none"},children:[l.jsxs("div",{style:{position:"relative",width:50*p,height:62*p},children:[l.jsx("div",{style:{position:"absolute",inset:0,background:"#4a5568",borderRadius:6*p,border:"1px solid #718096",transform:"rotate(-15deg) translate(-5px, 0)"}}),l.jsx("div",{style:{position:"absolute",inset:0,background:"#2d3748",borderRadius:6*p,border:"1px solid #718096",transform:"rotate(-5deg) translate(-2px, 0)"}}),l.jsx("div",{style:{position:"absolute",inset:0,background:"#1a202c",borderRadius:6*p,border:"1px solid #cbd5e0",transform:"rotate(5deg)"}})]}),l.jsxs("div",{style:{background:"rgba(0,0,0,0.7)",padding:`${6*p}px ${16*p}px`,borderRadius:10*p,color:"#e2e8f0",fontSize:`${1.32*p}rem`,fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5)"},children:[" ",ie.hand.length]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6*p,marginLeft:10*p},children:[l.jsx("div",{style:{fontSize:`${1.87*p}rem`,filter:"drop-shadow(0 0 3px rgba(128, 90, 213, 0.8))"},children:""}),l.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(128, 90, 213, 0.8), rgba(76, 29, 149, 0.9))",padding:`${6*p}px ${16*p}px`,borderRadius:10*p,color:"#e2e8f0",fontSize:`${1.32*p}rem`,fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5), inset 0 1px rgba(255,255,255,0.1)",border:"1px solid rgba(167, 139, 250, 0.5)",position:"relative"},children:[" ",ie.graveyard.length,Wd.filter(m=>m.playerId===O).map(m=>l.jsxs("div",{style:{position:"absolute",top:-30,left:"50%",transform:"translateX(-50%)",color:"#d946ef",fontSize:"1.5rem",fontWeight:"bold",textShadow:"0 0 10px #d946ef, 0 0 20px #a855f7, 0 0 30px #7c3aed",animation:"necromanceFloat 1.5s ease-out forwards",pointerEvents:"none",whiteSpace:"nowrap"},children:["-",m.amount]},m.key))]})]})]}),K&&Ne&&Ne.owner==="PLAYER"&&Ne.source==="HAND"&&jr&&(()=>{const m=Math.max(140,180*p),v=4*p,_=(m-v)/2,R=ie.pp>=Ne.card.cost;return l.jsxs("div",{style:{position:"absolute",left:15*p,bottom:135*p,zIndex:600,pointerEvents:"auto"},children:[l.jsxs("button",{disabled:!R,onClick:D=>{D.stopPropagation(),hm()},className:R?"play-button-active":"",style:{width:_,background:R?"linear-gradient(to bottom, #48bb78, #38a169)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:`${5*p}px ${3*p}px`,borderRadius:10*p,fontSize:`${.7*p}rem`,fontWeight:"bold",cursor:R?"pointer":"not-allowed",boxShadow:R?"0 0 12px rgba(72, 187, 120, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},onMouseDown:D=>D.stopPropagation(),children:["",l.jsxs("div",{style:{fontSize:`${.5*p}rem`,opacity:.8,marginTop:1},children:["pp ",Ne.card.cost]})]}),l.jsx("style",{children:`
                                @keyframes playGlowPulse {
                                    0% { box-shadow: 0 0 10px rgba(72, 187, 120, 0.4); }
                                    50% { box-shadow: 0 0 25px rgba(72, 187, 120, 0.8); }
                                    100% { box-shadow: 0 0 10px rgba(72, 187, 120, 0.4); }
                                }
                                .play-button-active {
                                    animation: playGlowPulse 2s infinite ease-in-out;
                                }
                            `})]})})(),K&&Ne&&Ne.owner==="PLAYER"&&Ne.source==="BOARD"&&(()=>{const m=Math.max(140,180*p),v=4*p,_=(m-v)/2,R=Ne.card,D=R==null?void 0:R.hasEvolved,W=!D&&us,q=!D&&ds,$=R==null?void 0:R.instanceId,U=ie.board.findIndex(Z=>Z&&Z.instanceId===$),V=ie.board.slice(0,U+1).filter(Z=>Z).length-1,ae=Z=>{U<0||rc(V>=0?V:U,Z,void 0,$)};return l.jsxs("div",{style:{position:"absolute",left:15*p,bottom:135*p,zIndex:600,pointerEvents:"auto",display:"flex",gap:v},onMouseDown:Z=>Z.stopPropagation(),children:[l.jsxs("button",{disabled:!W,onClick:Z=>{Z.stopPropagation(),ae(!1)},style:{width:_,background:W?"linear-gradient(to bottom, #faf089, #d69e2e)":"#718096",color:W?"#1a202c":"white",border:"2px solid rgba(255,255,255,0.2)",padding:`${5*p}px ${3*p}px`,borderRadius:10*p,fontSize:`${.7*p}rem`,fontWeight:"bold",cursor:W?"pointer":"not-allowed",boxShadow:W?"0 0 12px rgba(250, 240, 137, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:W?"0 1px 1px rgba(255,255,255,0.3)":"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",l.jsx("div",{style:{fontSize:`${.5*p}rem`,opacity:.8,marginTop:1},children:"EP"})]}),l.jsxs("button",{disabled:!q,onClick:Z=>{Z.stopPropagation(),ae(!0)},style:{width:_,background:q?"linear-gradient(to bottom, #b794f4, #805ad5)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:`${5*p}px ${3*p}px`,borderRadius:10*p,fontSize:`${.7*p}rem`,fontWeight:"bold",cursor:q?"pointer":"not-allowed",boxShadow:q?"0 0 12px rgba(183, 148, 244, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",l.jsx("div",{style:{fontSize:`${.5*p}rem`,opacity:.8,marginTop:1},children:"SEP"})]})]})})(),os&&Array.from({length:os.count},(m,v)=>{const q=-(os.count*80+(os.count-1)*20-80)/2+v*100,$=os.isPlayer?si((ie==null?void 0:ie.class)||"SENKA"):si((Oe==null?void 0:Oe.class)||"SENKA");return l.jsx("div",{style:{position:"absolute",left:os.isPlayer?"calc(100% - 90px)":90,top:os.isPlayer?"calc(100% - 105px)":105,width:80,height:110,borderRadius:8,border:"2px solid white",overflow:"hidden",transform:`translateX(${q}px)`,animation:`drawCard${os.isPlayer?"Player":"Opponent"} ${qd}ms cubic-bezier(0.2, 0.8, 0.2, 1) forwards`,zIndex:9e3+v,boxShadow:"0 0 10px rgba(255,255,255,0.5)"},children:l.jsx("img",{src:$,alt:"Card Back",style:{width:"100%",height:"100%",objectFit:"cover"},onError:U=>{U.target.style.display="none",U.target.parentElement.style.background="repeating-linear-gradient(45deg, #2d3748, #2d3748 10px, #1a202c 10px, #1a202c 20px)"}})},v)}),l.jsx("style",{children:`
                        @keyframes drawCardPlayer {
                            0% { opacity: 1; }
                            100% { transform: translate(-50vw, -100px) scale(0.5) rotate(-10deg); opacity: 0; }
                        }
                        @keyframes drawCardOpponent {
                            0% { opacity: 1; }
                            100% { transform: translate(50vw, 200px) scale(0.5) rotate(10deg); opacity: 0; }
                        }
                    `})]}),KS.map(m=>l.jsx(cL,{value:m.value,x:m.x,y:m.y,color:m.color,scale:p,onComplete:()=>Zl(v=>v.filter(_=>_.id!==m.id))},m.id)),Gd&&Lr.current&&(()=>{const m=Lr.current.x,v=Lr.current.y,_=200,R=320,W=180/8,q=($,U,V,ae)=>{const Z=$*Math.PI/180,fe=U*Math.PI/180,ve=Math.cos(Z)*ae,Ge=-Math.sin(Z)*ae,xe=Math.cos(fe)*ae,ze=-Math.sin(fe)*ae,Qe=Math.cos(fe)*V,Ue=-Math.sin(fe)*V,Be=Math.cos(Z)*V,he=-Math.sin(Z)*V;return`M ${ve} ${Ge} A ${ae} ${ae} 0 0 0 ${xe} ${ze} L ${Qe} ${Ue} A ${V} ${V} 0 0 1 ${Be} ${he} Z`};return l.jsxs("div",{style:{position:"fixed",left:m,top:v,zIndex:2e3,pointerEvents:"none",animation:"stampUIFadeIn 0.15s ease-out"},children:[l.jsx("svg",{width:R*2+20,height:R+20,style:{position:"absolute",left:-330,top:-330,overflow:"visible"},children:l.jsx("g",{transform:`translate(${R+10}, ${R+10})`,children:P0.map(($,U)=>{const V=180-U*W,ae=V-W,Z=Vd===$.id,ve=(V+ae)/2*Math.PI/180,Ge=(_+R)/2,xe=Math.cos(ve)*Ge,ze=-Math.sin(ve)*Ge,Qe=85;return l.jsxs("g",{children:[l.jsx("path",{d:q(V,ae,_,R),fill:Z?"rgba(255, 215, 0, 0.4)":"rgba(0, 0, 0, 0.7)",stroke:Z?"#ffd700":"rgba(255, 255, 255, 0.3)",strokeWidth:Z?3:1,style:{transition:"all 0.1s ease-out"}}),l.jsx("defs",{children:l.jsx("clipPath",{id:`stampClip-${$.id}`,children:l.jsx("circle",{cx:xe,cy:ze,r:Qe/2})})}),l.jsx("image",{href:Je(a_($.id,_r)),x:xe-Qe/2,y:ze-Qe/2,width:Qe,height:Qe,clipPath:`url(#stampClip-${$.id})`,style:{transform:Z?"scale(1.15)":"scale(1)",transformOrigin:`${xe}px ${ze}px`,transition:"transform 0.1s ease-out"}}),l.jsx("circle",{cx:xe,cy:ze,r:Qe/2,fill:"none",stroke:Z?"#ffd700":"rgba(255, 255, 255, 0.5)",strokeWidth:Z?2:1})]},$.id)})})}),l.jsx("style",{children:`
                                @keyframes stampUIFadeIn {
                                    from { opacity: 0; transform: scale(0.8); }
                                    to { opacity: 1; transform: scale(1); }
                                }
                            `})]})})(),Zo&&l.jsxs("div",{style:{position:"fixed",left:"50%",top:"40%",transform:"translate(-50%, -50%)",zIndex:2500,pointerEvents:"none",animation:"stampDisplay 3s ease-out forwards"},children:[l.jsx("div",{style:{width:250,height:250,borderRadius:20,overflow:"hidden",boxShadow:"0 0 40px rgba(0,0,0,0.5), 0 0 60px rgba(255,255,255,0.2)",border:"4px solid rgba(255,255,255,0.3)"},children:l.jsx("img",{src:Je(a_(Zo.stampId,Zo.playerClass)),alt:"",style:{width:"100%",height:"100%",objectFit:"cover"}})}),Zo.playerId!==O&&l.jsx("div",{style:{position:"absolute",bottom:-30,left:"50%",transform:"translateX(-50%)",background:"rgba(0,0,0,0.7)",padding:"5px 15px",borderRadius:15,color:"#fff",fontSize:"0.9rem",whiteSpace:"nowrap"},children:""}),l.jsx("style",{children:`
                            @keyframes stampDisplay {
                                0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
                                10% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
                                20% { transform: translate(-50%, -50%) scale(1); }
                                80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                                100% { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
                            }
                        `})]},Zo.timestamp),l.jsx("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:1e3},children:J&&(J.sourceType==="BOARD"||J.sourceType==="EVOLVE")&&l.jsxs(l.Fragment,{children:[l.jsxs("defs",{children:[l.jsxs("filter",{id:"cyanGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[l.jsx("feGaussianBlur",{stdDeviation:"10",result:"blur1"}),l.jsx("feFlood",{floodColor:"rgba(100, 200, 255, 0.7)",result:"color1"}),l.jsx("feComposite",{in:"color1",in2:"blur1",operator:"in",result:"glow1"}),l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"5",result:"blur2"}),l.jsx("feFlood",{floodColor:"rgba(150, 220, 255, 0.5)",result:"color2"}),l.jsx("feComposite",{in:"color2",in2:"blur2",operator:"in",result:"glow2"}),l.jsxs("feMerge",{children:[l.jsx("feMergeNode",{in:"glow1"}),l.jsx("feMergeNode",{in:"glow2"})]})]}),l.jsxs("filter",{id:"yellowGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[l.jsx("feGaussianBlur",{stdDeviation:"10",result:"blur1"}),l.jsx("feFlood",{floodColor:"rgba(255, 255, 50, 0.7)",result:"color1"}),l.jsx("feComposite",{in:"color1",in2:"blur1",operator:"in",result:"glow1"}),l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"5",result:"blur2"}),l.jsx("feFlood",{floodColor:"rgba(255, 240, 100, 0.5)",result:"color2"}),l.jsx("feComposite",{in:"color2",in2:"blur2",operator:"in",result:"glow2"}),l.jsxs("feMerge",{children:[l.jsx("feMergeNode",{in:"glow1"}),l.jsx("feMergeNode",{in:"glow2"})]})]}),l.jsxs("filter",{id:"softWhiteGlow",x:"-300%",y:"-300%",width:"700%",height:"700%",children:[l.jsx("feGaussianBlur",{stdDeviation:"20",result:"blur"}),l.jsx("feFlood",{floodColor:"rgba(255, 255, 255, 0.9)",result:"color"}),l.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),l.jsxs("feMerge",{children:[l.jsx("feMergeNode",{in:"glow"}),l.jsx("feMergeNode",{in:"glow"}),l.jsx("feMergeNode",{in:"glow"})]})]}),l.jsxs("filter",{id:"innerCoreGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[l.jsx("feGaussianBlur",{stdDeviation:"4",result:"blur"}),l.jsx("feFlood",{floodColor:"rgba(255, 255, 255, 0.8)",result:"color"}),l.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),l.jsx("feMerge",{children:l.jsx("feMergeNode",{in:"glow"})})]}),l.jsxs("filter",{id:"coloredBallGlow",x:"-150%",y:"-150%",width:"400%",height:"400%",children:[l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"6",result:"blur"}),l.jsxs("feMerge",{children:[l.jsx("feMergeNode",{in:"blur"}),l.jsx("feMergeNode",{in:"blur"})]})]}),l.jsxs("filter",{id:"particleGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"2",result:"blur"}),l.jsxs("feMerge",{children:[l.jsx("feMergeNode",{in:"blur"}),l.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),l.jsxs("filter",{id:"purpleGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[l.jsx("feGaussianBlur",{stdDeviation:"10",result:"blur1"}),l.jsx("feFlood",{floodColor:"rgba(183, 148, 244, 0.7)",result:"color1"}),l.jsx("feComposite",{in:"color1",in2:"blur1",operator:"in",result:"glow1"}),l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"5",result:"blur2"}),l.jsx("feFlood",{floodColor:"rgba(200, 170, 255, 0.5)",result:"color2"}),l.jsx("feComposite",{in:"color2",in2:"blur2",operator:"in",result:"glow2"}),l.jsxs("feMerge",{children:[l.jsx("feMergeNode",{in:"glow1"}),l.jsx("feMergeNode",{in:"glow2"})]})]})]}),J.sourceType==="BOARD"&&l.jsxs(l.Fragment,{children:[l.jsx("path",{d:cs(),fill:"none",stroke:"rgba(100, 200, 255, 0.3)",strokeWidth:"20",strokeLinecap:"butt",filter:"url(#cyanGlow)"}),l.jsx("path",{d:cs(),fill:"none",stroke:"rgba(150, 220, 255, 0.5)",strokeWidth:"10",strokeLinecap:"butt"}),l.jsx("path",{d:cs(),fill:"none",stroke:"rgba(200, 240, 255, 0.9)",strokeWidth:"4",strokeLinecap:"butt"}),l.jsx("path",{d:cs(),fill:"none",stroke:"rgba(255, 255, 255, 1)",strokeWidth:"2",strokeLinecap:"butt"})]}),J.sourceType==="EVOLVE"&&l.jsxs(l.Fragment,{children:[l.jsx("path",{d:cs(),fill:"none",stroke:J.useSep?"rgba(159, 122, 234, 0.3)":"rgba(236, 201, 75, 0.3)",strokeWidth:"20",strokeLinecap:"butt",filter:J.useSep?"url(#purpleGlow)":"url(#yellowGlow)"}),l.jsx("path",{d:cs(),fill:"none",stroke:J.useSep?"rgba(183, 148, 244, 0.5)":"rgba(246, 224, 94, 0.5)",strokeWidth:"10",strokeLinecap:"butt"}),l.jsx("path",{d:cs(),fill:"none",stroke:J.useSep?"rgba(214, 188, 250, 0.9)":"rgba(250, 240, 137, 0.9)",strokeWidth:"4",strokeLinecap:"butt"}),l.jsx("path",{d:cs(),fill:"none",stroke:"rgba(255, 255, 255, 1)",strokeWidth:"2",strokeLinecap:"butt"})]}),(J.sourceType==="BOARD"||J.sourceType==="EVOLVE")&&l.jsxs(l.Fragment,{children:[l.jsx("circle",{cx:J.startX,cy:J.startY,r:"15",fill:"rgba(255, 255, 255, 0.3)",filter:"url(#softWhiteGlow)"}),l.jsx("circle",{cx:J.startX,cy:J.startY,r:"8",fill:"rgba(255, 255, 255, 0.4)",filter:"url(#softWhiteGlow)"})]}),(J.sourceType==="BOARD"||J.sourceType==="EVOLVE")&&l.jsxs(l.Fragment,{children:[l.jsx("circle",{cx:J.currentX,cy:J.currentY,r:"18",fill:"rgba(255, 255, 255, 0.25)",filter:"url(#softWhiteGlow)"}),l.jsx("circle",{cx:J.currentX,cy:J.currentY,r:"8",fill:"rgba(255, 255, 255, 0.35)",filter:"url(#softWhiteGlow)"}),l.jsx("circle",{cx:J.currentX,cy:J.currentY,r:"3",fill:"rgba(255, 255, 255, 0.7)",filter:"url(#innerCoreGlow)"})]}),FS.map(m=>{const v=J.sourceType==="EVOLVE"?J.useSep?`rgba(230, 220, 255, ${m.opacity})`:`rgba(255, 255, 230, ${m.opacity})`:`rgba(220, 245, 255, ${m.opacity})`;return l.jsx("circle",{cx:m.x,cy:m.y,r:m.radius,fill:v,filter:"url(#particleGlow)"},m.id)})]})}),Gt&&l.jsxs("svg",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100dvh",pointerEvents:"none",zIndex:99999},children:[l.jsx("defs",{children:l.jsxs("filter",{id:"endTurnGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[l.jsx("feGaussianBlur",{stdDeviation:"6",result:"blur"}),l.jsx("feFlood",{floodColor:"rgba(100, 200, 255, 0.8)",result:"color"}),l.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),l.jsxs("feMerge",{children:[l.jsx("feMergeNode",{in:"glow"}),l.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),l.jsx("circle",{cx:Gt.x,cy:Gt.y,r:Gt.ringRadius,fill:"none",stroke:`rgba(100, 200, 255, ${Math.max(0,1-Gt.ringRadius/120)*.8})`,strokeWidth:"4",filter:"url(#endTurnGlow)"}),l.jsx("circle",{cx:Gt.x,cy:Gt.y,r:Gt.ringRadius*.8,fill:"none",stroke:`rgba(255, 255, 255, ${Math.max(0,1-Gt.ringRadius/120)*.6})`,strokeWidth:"2"}),l.jsx("circle",{cx:Gt.x,cy:Gt.y,r:20,fill:`rgba(255, 255, 255, ${Math.max(0,1-Gt.ringRadius/120)*.9})`}),Gt.particles.map(m=>l.jsx("circle",{cx:m.x,cy:m.y,r:4,fill:`rgba(255, 255, 255, ${m.opacity*.8})`},m.id))]}),We&&l.jsxs("div",{style:{position:"absolute",inset:0,zIndex:9999,pointerEvents:"auto",background:"rgba(0,0,0,0.5)",perspective:"1200px"},children:[l.jsx("style",{children:`
                                @keyframes playCardSequence {
                                    ${We.finalX!==void 0?`
                                    /* Phase 1: Start at hand position (0%) */
                                    0% {
                                        transform: translate(${We.startX-We.targetX}px, ${We.startY-We.targetY}px) translate(-50%, -50%) scale(1.0) rotateY(0deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Phase 1b: Mid-rotation during move (12.5%) - CRITICAL: explicit 180deg to force rotation direction */
                                    12.5% {
                                        transform: translate(${(We.startX-We.targetX)*.5}px, ${(We.startY-We.targetY)*.5}px) translate(-50%, -50%) scale(1.5) rotateY(180deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Phase 2: Arrive at center with rotation complete (25%) */
                                    25% {
                                        transform: translate(-50%, -50%) scale(1.8) rotateY(360deg);
                                        opacity: 1;
                                        animation-timing-function: ease-out;
                                    }
                                    /* Phase 3: Hold at center (25%-80%) */
                                    80% {
                                        transform: translate(-50%, -50%) scale(2.4) rotateY(360deg);
                                        opacity: 1;
                                    }
                                    /* Phase 4: Move to board position (80%-100%) */
                                    100% {
                                        transform: translate(calc(-50% + ${We.finalX-We.targetX}px), calc(-50% + ${We.finalY-We.targetY}px)) scale(1.0) rotateY(360deg);
                                        opacity: 1;
                                    }
                                    `:`
                                    /* Spell: Move to center while rotating, then fade */
                                    0% {
                                        transform: translate(${We.startX-We.targetX}px, ${We.startY-We.targetY}px) translate(-50%, -50%) scale(1.0) rotateY(0deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Mid-rotation during move (15%) - CRITICAL: explicit 180deg */
                                    15% {
                                        transform: translate(${(We.startX-We.targetX)*.5}px, ${(We.startY-We.targetY)*.5}px) translate(-50%, -50%) scale(1.7) rotateY(180deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    30% {
                                        transform: translate(-50%, -50%) scale(2.2) rotateY(360deg);
                                        opacity: 1;
                                        animation-timing-function: ease-out;
                                    }
                                    80% {
                                        transform: translate(-50%, -50%) scale(2.4) rotateY(360deg);
                                        opacity: 1;
                                    }
                                    100% {
                                        transform: translate(-50%, -50%) scale(3.0) rotateY(360deg);
                                        opacity: 0;
                                    }
                                    `}
                                }
                                @keyframes playSpellSequence {
                                    /* Move from hand to center while rotating (0-30%) */
                                    0% {
                                        transform: translate(${We.startX-We.targetX}px, ${We.startY-We.targetY}px) translate(-50%, -50%) scale(1.0) rotateY(0deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Mid-rotation during move (15%) - CRITICAL: explicit 180deg to force rotation direction */
                                    15% {
                                        transform: translate(${(We.startX-We.targetX)*.5}px, ${(We.startY-We.targetY)*.5}px) translate(-50%, -50%) scale(1.7) rotateY(180deg);
                                        opacity: 1;
                                        filter: brightness(1);
                                        animation-timing-function: linear;
                                    }
                                    /* Arrive at center with rotation complete (30%) */
                                    30% {
                                        transform: translate(-50%, -50%) scale(2.2) rotateY(360deg);
                                        opacity: 1;
                                        filter: brightness(1);
                                        animation-timing-function: ease-out;
                                    }
                                    /* Hold at center (30%-75%) */
                                    75% {
                                        transform: translate(-50%, -50%) scale(2.4) rotateY(360deg);
                                        opacity: 1;
                                        filter: brightness(1.2);
                                    }
                                    /* Fade out (75%-100%) */
                                    100% {
                                        transform: translate(-50%, -50%) scale(3.0) rotateY(360deg);
                                        opacity: 0;
                                        filter: brightness(3);
                                    }
                                }
                                .play-card-flipper {
                                    transform-style: preserve-3d !important;
                                }
                                .play-card-front, .play-card-back {
                                    backface-visibility: hidden !important;
                                    -webkit-backface-visibility: hidden !important;
                                    position: absolute;
                                    width: 100%;
                                    height: 100%;
                                }
                                .play-card-back {
                                    transform: rotateY(180deg) translateZ(1px);
                                }
                            `}),l.jsxs("div",{className:"play-card-flipper",onAnimationEnd:We.onComplete,style:{position:"absolute",left:We.targetX,top:We.targetY,width:rn*p,height:En*p,transformStyle:"preserve-3d",animation:We.card.type==="SPELL"?"playSpellSequence 1s forwards":"playCardSequence 0.8s forwards"},children:[l.jsx("div",{className:"play-card-front",children:l.jsx(Xi,{card:We.card,isOnBoard:!0,suppressPassives:!0,scale:p,style:{width:rn*p,height:En*p,boxShadow:"0 0 50px rgba(255,215,0,0.8)"}})}),l.jsx("div",{className:"play-card-back",style:{borderRadius:12,boxShadow:"0 0 50px rgba(255,215,0,0.8)",overflow:"hidden"},children:l.jsx("img",{src:si(We.playerClass),alt:"Card Sleeve",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:12},onError:m=>{const v=m.target;v.style.display="none",v.parentElement&&(v.parentElement.style.background="linear-gradient(135deg, #1e3a5f 0%, #0d1b2a 50%, #1e3a5f 100%)")}})}),We.card.type==="SPELL"&&l.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none"},children:l.jsx(uL,{x:0,y:0})})]})]}),Fi.length>0&&Fi.map((m,v)=>l.jsx("div",{style:{position:"absolute",left:m.status==="FLY"&&m.targetX!==void 0?m.targetX:window.innerWidth/2+m.xOffset,top:m.status==="FLY"&&m.targetY!==void 0?m.targetY:window.innerHeight/2,transform:m.status==="APPEAR"?"translate(-50%, -50%) scale(1.2)":"translate(-50%, -50%) scale(0.2)",zIndex:7e3+v,pointerEvents:"none",transition:m.status==="FLY"?"all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)":"none",opacity:m.status==="FLY"?.3:1,animation:m.status==="APPEAR"?"cardAppear 0.8s ease-out":void 0},children:l.jsx(Xi,{card:m.card,scale:p,style:{width:rn*p,height:En*p}})},v)),l.jsx("style",{children:`
                    @keyframes cardAppear {
                        0% { transform: translate(-50%, -50%) scale(0) rotate(-10deg); opacity: 0; }
                        50% { transform: translate(-50%, -50%) scale(1.3) rotate(5deg); opacity: 1; }
                        100% { transform: translate(-50%, -50%) scale(1.2) rotate(0deg); opacity: 1; }
                    }
                `}),Xl.map(m=>m.type==="BUFF"?l.jsx(oL,{x:m.x,y:m.y,atkBuff:m.atkBuff??0,hpBuff:m.hpBuff??0,onComplete:()=>Ui(v=>v.filter(_=>_.key!==m.key))},m.key):l.jsx(lL,{type:m.type,x:m.x,y:m.y,onComplete:()=>Ui(v=>v.filter(_=>_.key!==m.key)),audioSettings:Tt,scale:p},m.key)),Rt&&l.jsx(hL,{card:Rt.card,evolvedImageUrl:Rt.evolvedImageUrl,startX:Rt.startX,startY:Rt.startY,phase:Rt.phase,onPhaseChange:QS,onShake:$n,useSep:Rt.useSep,playSE:gt,scale:p,isLightMode:re}),ti&&l.jsxs("div",{style:{position:"fixed",top:"45%",left:`${340*p}px`,width:`calc(100% - ${340*p}px)`,display:"flex",justifyContent:"center",alignItems:"center",transform:"translateY(-50%)",zIndex:9e3,pointerEvents:"none",animation:"notificationFade 2.5s forwards"},children:[l.jsx("div",{style:{padding:`${20*p}px ${90*p}px`,background:"rgba(0, 0, 0, 0.75)",backdropFilter:"blur(16px)",borderTop:`${3*p}px solid ${ti==="EVOLVE_READY"?"rgba(255, 215, 0, 0.7)":"rgba(180, 0, 255, 0.7)"}`,borderBottom:`${3*p}px solid ${ti==="EVOLVE_READY"?"rgba(255, 215, 0, 0.7)":"rgba(180, 0, 255, 0.7)"}`,boxShadow:ti==="EVOLVE_READY"?`0 0 ${50*p}px rgba(255, 180, 0, 0.5), inset 0 0 ${30*p}px rgba(255, 215, 0, 0.2)`:`0 0 ${50*p}px rgba(180, 0, 255, 0.5), inset 0 0 ${30*p}px rgba(180, 0, 255, 0.2)`,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",borderRadius:`${4*p}px`},children:l.jsx("span",{style:{fontSize:`${5*p}rem`,fontWeight:"900",fontFamily:'"YuMincho", "Hiragino Mincho ProN", "MS Mincho", serif',color:"#fff",letterSpacing:`${.8*p}rem`,whiteSpace:"nowrap",textShadow:ti==="EVOLVE_READY"?`0 0 ${15*p}px rgba(255, 215, 0, 1), 0 0 ${30*p}px rgba(255, 180, 0, 0.8), ${2*p}px ${2*p}px ${4*p}px rgba(0,0,0,0.9)`:`0 0 ${15*p}px rgba(180, 0, 255, 1), 0 0 ${30*p}px rgba(140, 0, 255, 0.8), ${2*p}px ${2*p}px ${4*p}px rgba(0,0,0,0.9)`,WebkitTextStroke:ti==="EVOLVE_READY"?`${1.5*p}px #ffd700`:`${1.5*p}px #b400ff`},children:ti==="EVOLVE_READY"?"":""})}),l.jsx("style",{children:`
                            @keyframes notificationFade {
                                0% { opacity: 0; transform: translateY(-40%) scale(0.8); filter: blur(15px); }
                                10% { opacity: 1; transform: translateY(-50%) scale(1); filter: blur(0px); }
                                90% { opacity: 1; transform: translateY(-50%) scale(1); filter: blur(0px); }
                                100% { opacity: 0; transform: translateY(-60%) scale(1.15); filter: blur(20px); }
                            }
                        `})]}),Pe&&g.winnerId&&l.jsx(KO,{isVictory:g.winnerId===O,loserLeaderRef:g.winnerId===O?zi:ri,onComplete:()=>{Ie(!1),Ze(!0),ot(null),$t(0),(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&x&&(console.log("[GameScreen] Disconnecting after game over (casual match)"),x.disconnect())},onPhaseChange:ot,onShakeIntensityChange:$t,scale:p}),g.winnerId&&lt&&l.jsx(_L,{winnerId:g.winnerId,playerId:O,playerClass:(ie==null?void 0:ie.class)||"SENKA",isOnline:e==="ONLINE",isRoomMatch:n==="HOST"||n==="JOIN",myRematchRequested:LS,opponentRematchRequested:N0,battleStats:{turnCount:g.turnCount,damageDealtToOpponent:Ul.damageDealtToOpponent,damageReceivedFromOpponent:Ul.damageReceivedFromOpponent,followersDestroyed:Ul.followersDestroyed,myFollowersDestroyed:Ul.myFollowersDestroyed},selectedCardInfo:NS,onCardInfoClick:Hd,victoryReason:DS,isRankedMatch:n==="RANKED_MATCH",ratingResult:MS,onRematching:i,onRematch:m=>{e==="ONLINE"?(D0(!0),N0?(x==null||x.send({type:"REMATCH_ACCEPT"}),of(m)):(x==null||x.send({type:"REMATCH_REQUEST"}),$0(m))):of(m)},onLeave:s})]})]})},EL=async()=>{const t=await C5(jb);return t.user,t.user.uid},bL=t=>O5(jb,e=>{t(e)}),SL=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},IL=SL("/bgm/tenfubu.mp3"),Dc={bgm:.3,se:.5,voice:.5,bgmEnabled:!0,seEnabled:!0},TL=()=>{try{const t=localStorage.getItem("audioSettings");if(t){const e=JSON.parse(t);if(e.enabled!==void 0){const{enabled:n,...r}=e;return{...Dc,...r,bgmEnabled:n,seEnabled:n}}return{...Dc,...e}}return Dc}catch{return Dc}},CL=()=>{const[t,e]=F.useState(!1);return F.useEffect(()=>{const n=()=>{const r="ontouchstart"in window||navigator.maxTouchPoints>0,s=window.innerHeight>window.innerWidth;e(r&&s)};return n(),window.addEventListener("resize",n),window.addEventListener("orientationchange",n),()=>{window.removeEventListener("resize",n),window.removeEventListener("orientationchange",n)}},[]),t};function wL(){const[t,e]=F.useState("TITLE"),[n,r]=F.useState("SENKA"),[s,i]=F.useState("CPU"),[o,a]=F.useState(""),[c,u]=F.useState(void 0),[d,h]=F.useState("NORMAL"),[f,E]=F.useState(null),[k,P]=F.useState(!0),[G,x]=F.useState(()=>{const j=localStorage.getItem("timerEnabled");return j!==null?JSON.parse(j):!0}),[S,w]=F.useState(()=>localStorage.getItem("playerName")||""),[p,b]=F.useState(void 0),[H,re]=F.useState(void 0),K=CL(),Q=F.useRef(null),[ce,me]=F.useState(!1),[Se,de]=F.useState(TL);F.useEffect(()=>{const j=bL(async N=>{if(N){E(N.uid);try{await Xv(N.uid,S||"")}catch(pe){console.error("Failed to create player data:",pe)}}else try{const pe=await EL();E(pe),await Xv(pe,S||"")}catch(pe){console.error("Failed to sign in:",pe)}P(!1)});return()=>j()},[]),F.useEffect(()=>{localStorage.setItem("audioSettings",JSON.stringify(Se))},[Se]);const B=F.useCallback(j=>{de(N=>({...N,...j}))},[]),O=F.useCallback((j,N)=>{Q.current=j,me(!0),N&&u(N),e("GAME")},[]),T=F.useCallback((j,N,pe,we,ke)=>{Q.current=j,me(!0),u(N),b(we),re(ke),e("GAME")},[]),C=F.useCallback(j=>{Q.current&&(Q.current.disconnect(),Q.current=null),me(!1),u(void 0),b(void 0),re(void 0),r(j),e("MATCHMAKING")},[]),y=F.useRef(null),g=F.useRef(!1);F.useEffect(()=>{const j=new Audio(IL);return j.loop=!0,j.volume=Se.bgmEnabled?Se.bgm:0,y.current=j,g.current=!0,()=>{j.pause(),j.src=""}},[]),F.useEffect(()=>{const j=y.current;!j||!g.current||(j.volume=Se.bgmEnabled?Se.bgm:0,Se.bgmEnabled?j.paused&&(t==="TITLE"||t==="CLASS_SELECT")&&j.play().catch(()=>{}):j.pause())},[Se.bgm,Se.bgmEnabled,t]),F.useEffect(()=>{const j=y.current;j&&(t==="TITLE"||t==="CLASS_SELECT"||t==="LOBBY"?j.paused&&Se.bgmEnabled&&j.play().catch(()=>{}):(j.pause(),j.currentTime=0))},[t,Se.bgmEnabled]),F.useEffect(()=>{const j=()=>{const N=y.current;N&&N.paused&&Se.bgmEnabled&&(t==="TITLE"||t==="CLASS_SELECT"||t==="LOBBY")&&N.play().catch(()=>{})};return document.addEventListener("click",j),()=>document.removeEventListener("click",j)},[t,Se.bgmEnabled]);const I=F.useCallback((j,N)=>{i(j),N&&a(N),e("CLASS_SELECT")},[]),A=F.useCallback(j=>{r(j),e(s==="CPU"?"GAME":s==="CASUAL_MATCH"||s==="RANKED_MATCH"?"MATCHMAKING":"LOBBY")},[s]),L=F.useCallback(()=>{Q.current&&(Q.current.disconnect(),Q.current=null),me(!1),e("TITLE"),a(""),i("CPU"),u(void 0),b(void 0),re(void 0)},[]);return l.jsxs("div",{className:"app-container",children:[K&&l.jsxs("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100dvh",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:99999,color:"white",textAlign:"center",padding:20},children:[l.jsx("div",{style:{fontSize:"4rem",marginBottom:20,animation:"rotatePhone 2s ease-in-out infinite"},children:""}),l.jsx("h2",{style:{fontSize:"1.5rem",fontWeight:"bold",marginBottom:10,textShadow:"0 2px 4px rgba(0,0,0,0.5)"},children:""}),l.jsx("p",{style:{fontSize:"1rem",opacity:.8,maxWidth:280},children:""}),l.jsx("style",{children:`
                        @keyframes rotatePhone {
                            0%, 100% { transform: rotate(0deg); }
                            25% { transform: rotate(-30deg); }
                            75% { transform: rotate(30deg); }
                        }
                    `})]}),t==="TITLE"&&l.jsx(UC,{onStartConfig:I,audioSettings:Se,onAudioSettingsChange:B,playerId:f}),t==="CLASS_SELECT"&&l.jsx(sO,{onSelectClass:A,onBack:L,gameMode:s,aiDifficulty:d,onDifficultyChange:h,playerName:S,onPlayerNameChange:j=>{w(j),localStorage.setItem("playerName",j)},timerEnabled:G,onTimerEnabledChange:j=>{x(j),localStorage.setItem("timerEnabled",JSON.stringify(j))},playerId:f}),t==="LOBBY"&&l.jsx(kO,{gameMode:s,targetRoomId:o,playerClass:n,onGameStart:O,onBack:L}),t==="MATCHMAKING"&&l.jsx(OO,{matchType:s==="CASUAL_MATCH"?"casual":"ranked",playerClass:n,playerName:S||"",playerId:f,onGameStart:T,onCancel:L}),t==="GAME"&&l.jsx(xL,{playerClass:n,opponentType:s==="CPU"?"CPU":"ONLINE",gameMode:s,targetRoomId:o,onLeave:L,onRematching:C,networkAdapter:Q.current,networkConnected:ce,opponentClass:c,aiDifficulty:d,playerName:S||"",timerEnabled:s==="CASUAL_MATCH"||s==="RANKED_MATCH"?!0:G,playerId:f,opponentPlayerId:p,opponentRating:H})]})}fh.createRoot(document.getElementById("root")).render(l.jsx(wL,{}));
