var PI=Object.defineProperty;var OI=t=>{throw TypeError(t)};var LI=(t,e,n)=>e in t?PI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var on=(t,e,n)=>LI(t,typeof e!="symbol"?e+"":e,n);var ha=(t,e,n)=>e.has(t)?OI("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n);function DI(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in t)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function j_(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var $_={exports:{}},fu={},F_={exports:{}},dt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ol=Symbol.for("react.element"),MI=Symbol.for("react.portal"),NI=Symbol.for("react.fragment"),jI=Symbol.for("react.strict_mode"),$I=Symbol.for("react.profiler"),FI=Symbol.for("react.provider"),UI=Symbol.for("react.context"),BI=Symbol.for("react.forward_ref"),zI=Symbol.for("react.suspense"),HI=Symbol.for("react.memo"),WI=Symbol.for("react.lazy"),Bm=Symbol.iterator;function GI(t){return t===null||typeof t!="object"?null:(t=Bm&&t[Bm]||t["@@iterator"],typeof t=="function"?t:null)}var U_={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},B_=Object.assign,z_={};function Go(t,e,n){this.props=t,this.context=e,this.refs=z_,this.updater=n||U_}Go.prototype.isReactComponent={};Go.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Go.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function H_(){}H_.prototype=Go.prototype;function Kp(t,e,n){this.props=t,this.context=e,this.refs=z_,this.updater=n||U_}var Xp=Kp.prototype=new H_;Xp.constructor=Kp;B_(Xp,Go.prototype);Xp.isPureReactComponent=!0;var zm=Array.isArray,W_=Object.prototype.hasOwnProperty,Qp={current:null},G_={key:!0,ref:!0,__self:!0,__source:!0};function V_(t,e,n){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)W_.call(e,r)&&!G_.hasOwnProperty(r)&&(s[r]=e[r]);var l=arguments.length-2;if(l===1)s.children=n;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];s.children=c}if(t&&t.defaultProps)for(r in l=t.defaultProps,l)s[r]===void 0&&(s[r]=l[r]);return{$$typeof:Ol,type:t,key:i,ref:o,props:s,_owner:Qp.current}}function VI(t,e){return{$$typeof:Ol,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Jp(t){return typeof t=="object"&&t!==null&&t.$$typeof===Ol}function YI(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Hm=/\/+/g;function Of(t,e){return typeof t=="object"&&t!==null&&t.key!=null?YI(""+t.key):e.toString(36)}function Gc(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Ol:case MI:o=!0}}if(o)return o=t,s=s(o),t=r===""?"."+Of(o,0):r,zm(s)?(n="",t!=null&&(n=t.replace(Hm,"$&/")+"/"),Gc(s,e,n,"",function(d){return d})):s!=null&&(Jp(s)&&(s=VI(s,n+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(Hm,"$&/")+"/")+t)),e.push(s)),1;if(o=0,r=r===""?".":r+":",zm(t))for(var l=0;l<t.length;l++){i=t[l];var c=r+Of(i,l);o+=Gc(i,e,n,c,s)}else if(c=GI(t),typeof c=="function")for(t=c.call(t),l=0;!(i=t.next()).done;)i=i.value,c=r+Of(i,l++),o+=Gc(i,e,n,c,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function _c(t,e,n){if(t==null)return t;var r=[],s=0;return Gc(t,r,"","",function(i){return e.call(n,i,s++)}),r}function KI(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var kn={current:null},Vc={transition:null},XI={ReactCurrentDispatcher:kn,ReactCurrentBatchConfig:Vc,ReactCurrentOwner:Qp};function Y_(){throw Error("act(...) is not supported in production builds of React.")}dt.Children={map:_c,forEach:function(t,e,n){_c(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return _c(t,function(){e++}),e},toArray:function(t){return _c(t,function(e){return e})||[]},only:function(t){if(!Jp(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};dt.Component=Go;dt.Fragment=NI;dt.Profiler=$I;dt.PureComponent=Kp;dt.StrictMode=jI;dt.Suspense=zI;dt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=XI;dt.act=Y_;dt.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=B_({},t.props),s=t.key,i=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=Qp.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(c in e)W_.call(e,c)&&!G_.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&l!==void 0?l[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];r.children=l}return{$$typeof:Ol,type:t.type,key:s,ref:i,props:r,_owner:o}};dt.createContext=function(t){return t={$$typeof:UI,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:FI,_context:t},t.Consumer=t};dt.createElement=V_;dt.createFactory=function(t){var e=V_.bind(null,t);return e.type=t,e};dt.createRef=function(){return{current:null}};dt.forwardRef=function(t){return{$$typeof:BI,render:t}};dt.isValidElement=Jp;dt.lazy=function(t){return{$$typeof:WI,_payload:{_status:-1,_result:t},_init:KI}};dt.memo=function(t,e){return{$$typeof:HI,type:t,compare:e===void 0?null:e}};dt.startTransition=function(t){var e=Vc.transition;Vc.transition={};try{t()}finally{Vc.transition=e}};dt.unstable_act=Y_;dt.useCallback=function(t,e){return kn.current.useCallback(t,e)};dt.useContext=function(t){return kn.current.useContext(t)};dt.useDebugValue=function(){};dt.useDeferredValue=function(t){return kn.current.useDeferredValue(t)};dt.useEffect=function(t,e){return kn.current.useEffect(t,e)};dt.useId=function(){return kn.current.useId()};dt.useImperativeHandle=function(t,e,n){return kn.current.useImperativeHandle(t,e,n)};dt.useInsertionEffect=function(t,e){return kn.current.useInsertionEffect(t,e)};dt.useLayoutEffect=function(t,e){return kn.current.useLayoutEffect(t,e)};dt.useMemo=function(t,e){return kn.current.useMemo(t,e)};dt.useReducer=function(t,e,n){return kn.current.useReducer(t,e,n)};dt.useRef=function(t){return kn.current.useRef(t)};dt.useState=function(t){return kn.current.useState(t)};dt.useSyncExternalStore=function(t,e,n){return kn.current.useSyncExternalStore(t,e,n)};dt.useTransition=function(){return kn.current.useTransition()};dt.version="18.3.1";F_.exports=dt;var L=F_.exports;const N=j_(L);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var QI=L,JI=Symbol.for("react.element"),qI=Symbol.for("react.fragment"),ZI=Object.prototype.hasOwnProperty,ew=QI.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,tw={key:!0,ref:!0,__self:!0,__source:!0};function K_(t,e,n){var r,s={},i=null,o=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)ZI.call(e,r)&&!tw.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:JI,type:t,key:i,ref:o,props:s,_owner:ew.current}}fu.Fragment=qI;fu.jsx=K_;fu.jsxs=K_;$_.exports=fu;var a=$_.exports,bh={},X_={exports:{}},Gn={},Q_={exports:{}},J_={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(v,g){var T=v.length;v.push(g);e:for(;0<T;){var A=T-1>>>1,y=v[A];if(0<s(y,g))v[A]=g,v[T]=y,T=A;else break e}}function n(v){return v.length===0?null:v[0]}function r(v){if(v.length===0)return null;var g=v[0],T=v.pop();if(T!==g){v[0]=T;e:for(var A=0,y=v.length,X=y>>>1;A<X;){var F=2*(A+1)-1,ve=v[F],ke=F+1,Ee=v[ke];if(0>s(ve,T))ke<y&&0>s(Ee,ve)?(v[A]=Ee,v[ke]=T,A=ke):(v[A]=ve,v[F]=T,A=F);else if(ke<y&&0>s(Ee,T))v[A]=Ee,v[ke]=T,A=ke;else break e}}return g}function s(v,g){var T=v.sortIndex-g.sortIndex;return T!==0?T:v.id-g.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],d=[],u=1,h=null,f=3,S=!1,k=!1,w=!1,j=typeof setTimeout=="function"?setTimeout:null,_=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function I(v){for(var g=n(d);g!==null;){if(g.callback===null)r(d);else if(g.startTime<=v)r(d),g.sortIndex=g.expirationTime,e(c,g);else break;g=n(d)}}function p(v){if(w=!1,I(v),!k)if(n(c)!==null)k=!0,C(D);else{var g=n(d);g!==null&&R(p,g.startTime-v)}}function D(v,g){k=!1,w&&(w=!1,_(H),H=-1),S=!0;var T=f;try{for(I(g),h=n(c);h!==null&&(!(h.expirationTime>g)||v&&!ye());){var A=h.callback;if(typeof A=="function"){h.callback=null,f=h.priorityLevel;var y=A(h.expirationTime<=g);g=t.unstable_now(),typeof y=="function"?h.callback=y:h===n(c)&&r(c),I(g)}else r(c);h=n(c)}if(h!==null)var X=!0;else{var F=n(d);F!==null&&R(p,F.startTime-g),X=!1}return X}finally{h=null,f=T,S=!1}}var z=!1,te=null,H=-1,q=5,ue=-1;function ye(){return!(t.unstable_now()-ue<q)}function Me(){if(te!==null){var v=t.unstable_now();ue=v;var g=!0;try{g=te(!0,v)}finally{g?fe():(z=!1,te=null)}}else z=!1}var fe;if(typeof x=="function")fe=function(){x(Me)};else if(typeof MessageChannel<"u"){var re=new MessageChannel,P=re.port2;re.port1.onmessage=Me,fe=function(){P.postMessage(null)}}else fe=function(){j(Me,0)};function C(v){te=v,z||(z=!0,fe())}function R(v,g){H=j(function(){v(t.unstable_now())},g)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(v){v.callback=null},t.unstable_continueExecution=function(){k||S||(k=!0,C(D))},t.unstable_forceFrameRate=function(v){0>v||125<v?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):q=0<v?Math.floor(1e3/v):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(v){switch(f){case 1:case 2:case 3:var g=3;break;default:g=f}var T=f;f=g;try{return v()}finally{f=T}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(v,g){switch(v){case 1:case 2:case 3:case 4:case 5:break;default:v=3}var T=f;f=v;try{return g()}finally{f=T}},t.unstable_scheduleCallback=function(v,g,T){var A=t.unstable_now();switch(typeof T=="object"&&T!==null?(T=T.delay,T=typeof T=="number"&&0<T?A+T:A):T=A,v){case 1:var y=-1;break;case 2:y=250;break;case 5:y=1073741823;break;case 4:y=1e4;break;default:y=5e3}return y=T+y,v={id:u++,callback:g,priorityLevel:v,startTime:T,expirationTime:y,sortIndex:-1},T>A?(v.sortIndex=T,e(d,v),n(c)===null&&v===n(d)&&(w?(_(H),H=-1):w=!0,R(p,T-A))):(v.sortIndex=y,e(c,v),k||S||(k=!0,C(D))),v},t.unstable_shouldYield=ye,t.unstable_wrapCallback=function(v){var g=f;return function(){var T=f;f=g;try{return v.apply(this,arguments)}finally{f=T}}}})(J_);Q_.exports=J_;var nw=Q_.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rw=L,Hn=nw;function de(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var q_=new Set,tl={};function Oi(t,e){Ao(t,e),Ao(t+"Capture",e)}function Ao(t,e){for(tl[t]=e,t=0;t<e.length;t++)q_.add(e[t])}var Zr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Eh=Object.prototype.hasOwnProperty,sw=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Wm={},Gm={};function iw(t){return Eh.call(Gm,t)?!0:Eh.call(Wm,t)?!1:sw.test(t)?Gm[t]=!0:(Wm[t]=!0,!1)}function ow(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function aw(t,e,n,r){if(e===null||typeof e>"u"||ow(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Rn(t,e,n,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var dn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){dn[t]=new Rn(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];dn[e]=new Rn(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){dn[t]=new Rn(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){dn[t]=new Rn(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){dn[t]=new Rn(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){dn[t]=new Rn(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){dn[t]=new Rn(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){dn[t]=new Rn(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){dn[t]=new Rn(t,5,!1,t.toLowerCase(),null,!1,!1)});var qp=/[\-:]([a-z])/g;function Zp(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(qp,Zp);dn[e]=new Rn(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(qp,Zp);dn[e]=new Rn(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(qp,Zp);dn[e]=new Rn(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){dn[t]=new Rn(t,1,!1,t.toLowerCase(),null,!1,!1)});dn.xlinkHref=new Rn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){dn[t]=new Rn(t,1,!1,t.toLowerCase(),null,!0,!0)});function eg(t,e,n,r){var s=dn.hasOwnProperty(e)?dn[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(aw(e,n,s,r)&&(n=null),r||s===null?iw(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var os=rw.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,xc=Symbol.for("react.element"),no=Symbol.for("react.portal"),ro=Symbol.for("react.fragment"),tg=Symbol.for("react.strict_mode"),Sh=Symbol.for("react.profiler"),Z_=Symbol.for("react.provider"),ex=Symbol.for("react.context"),ng=Symbol.for("react.forward_ref"),Ih=Symbol.for("react.suspense"),wh=Symbol.for("react.suspense_list"),rg=Symbol.for("react.memo"),ys=Symbol.for("react.lazy"),tx=Symbol.for("react.offscreen"),Vm=Symbol.iterator;function pa(t){return t===null||typeof t!="object"?null:(t=Vm&&t[Vm]||t["@@iterator"],typeof t=="function"?t:null)}var Ft=Object.assign,Lf;function ka(t){if(Lf===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Lf=e&&e[1]||""}return`
`+Lf+t}var Df=!1;function Mf(t,e){if(!t||Df)return"";Df=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var r=d}Reflect.construct(t,[],e)}else{try{e.call()}catch(d){r=d}t.call(e.prototype)}else{try{throw Error()}catch(d){r=d}t()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var s=d.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,l=i.length-1;1<=o&&0<=l&&s[o]!==i[l];)l--;for(;1<=o&&0<=l;o--,l--)if(s[o]!==i[l]){if(o!==1||l!==1)do if(o--,l--,0>l||s[o]!==i[l]){var c=`
`+s[o].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=o&&0<=l);break}}}finally{Df=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?ka(t):""}function lw(t){switch(t.tag){case 5:return ka(t.type);case 16:return ka("Lazy");case 13:return ka("Suspense");case 19:return ka("SuspenseList");case 0:case 2:case 15:return t=Mf(t.type,!1),t;case 11:return t=Mf(t.type.render,!1),t;case 1:return t=Mf(t.type,!0),t;default:return""}}function Th(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case ro:return"Fragment";case no:return"Portal";case Sh:return"Profiler";case tg:return"StrictMode";case Ih:return"Suspense";case wh:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case ex:return(t.displayName||"Context")+".Consumer";case Z_:return(t._context.displayName||"Context")+".Provider";case ng:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case rg:return e=t.displayName||null,e!==null?e:Th(t.type)||"Memo";case ys:e=t._payload,t=t._init;try{return Th(t(e))}catch{}}return null}function cw(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Th(e);case 8:return e===tg?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Gs(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function nx(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function dw(t){var e=nx(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function bc(t){t._valueTracker||(t._valueTracker=dw(t))}function rx(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=nx(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function md(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Ch(t,e){var n=e.checked;return Ft({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Ym(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Gs(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function sx(t,e){e=e.checked,e!=null&&eg(t,"checked",e,!1)}function kh(t,e){sx(t,e);var n=Gs(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Rh(t,e.type,n):e.hasOwnProperty("defaultValue")&&Rh(t,e.type,Gs(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Km(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Rh(t,e,n){(e!=="number"||md(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Ra=Array.isArray;function yo(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Gs(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function Ah(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(de(91));return Ft({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Xm(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(de(92));if(Ra(n)){if(1<n.length)throw Error(de(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Gs(n)}}function ix(t,e){var n=Gs(e.value),r=Gs(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function Qm(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function ox(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ph(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?ox(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Ec,ax=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Ec=Ec||document.createElement("div"),Ec.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Ec.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function nl(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Ma={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},uw=["Webkit","ms","Moz","O"];Object.keys(Ma).forEach(function(t){uw.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Ma[e]=Ma[t]})});function lx(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Ma.hasOwnProperty(t)&&Ma[t]?(""+e).trim():e+"px"}function cx(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=lx(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var fw=Ft({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Oh(t,e){if(e){if(fw[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(de(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(de(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(de(61))}if(e.style!=null&&typeof e.style!="object")throw Error(de(62))}}function Lh(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Dh=null;function sg(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Mh=null,vo=null,_o=null;function Jm(t){if(t=Ml(t)){if(typeof Mh!="function")throw Error(de(280));var e=t.stateNode;e&&(e=yu(e),Mh(t.stateNode,t.type,e))}}function dx(t){vo?_o?_o.push(t):_o=[t]:vo=t}function ux(){if(vo){var t=vo,e=_o;if(_o=vo=null,Jm(t),e)for(t=0;t<e.length;t++)Jm(e[t])}}function fx(t,e){return t(e)}function hx(){}var Nf=!1;function px(t,e,n){if(Nf)return t(e,n);Nf=!0;try{return fx(t,e,n)}finally{Nf=!1,(vo!==null||_o!==null)&&(hx(),ux())}}function rl(t,e){var n=t.stateNode;if(n===null)return null;var r=yu(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(de(231,e,typeof n));return n}var Nh=!1;if(Zr)try{var ga={};Object.defineProperty(ga,"passive",{get:function(){Nh=!0}}),window.addEventListener("test",ga,ga),window.removeEventListener("test",ga,ga)}catch{Nh=!1}function hw(t,e,n,r,s,i,o,l,c){var d=Array.prototype.slice.call(arguments,3);try{e.apply(n,d)}catch(u){this.onError(u)}}var Na=!1,yd=null,vd=!1,jh=null,pw={onError:function(t){Na=!0,yd=t}};function gw(t,e,n,r,s,i,o,l,c){Na=!1,yd=null,hw.apply(pw,arguments)}function mw(t,e,n,r,s,i,o,l,c){if(gw.apply(this,arguments),Na){if(Na){var d=yd;Na=!1,yd=null}else throw Error(de(198));vd||(vd=!0,jh=d)}}function Li(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function gx(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function qm(t){if(Li(t)!==t)throw Error(de(188))}function yw(t){var e=t.alternate;if(!e){if(e=Li(t),e===null)throw Error(de(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return qm(s),t;if(i===r)return qm(s),e;i=i.sibling}throw Error(de(188))}if(n.return!==r.return)n=s,r=i;else{for(var o=!1,l=s.child;l;){if(l===n){o=!0,n=s,r=i;break}if(l===r){o=!0,r=s,n=i;break}l=l.sibling}if(!o){for(l=i.child;l;){if(l===n){o=!0,n=i,r=s;break}if(l===r){o=!0,r=i,n=s;break}l=l.sibling}if(!o)throw Error(de(189))}}if(n.alternate!==r)throw Error(de(190))}if(n.tag!==3)throw Error(de(188));return n.stateNode.current===n?t:e}function mx(t){return t=yw(t),t!==null?yx(t):null}function yx(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=yx(t);if(e!==null)return e;t=t.sibling}return null}var vx=Hn.unstable_scheduleCallback,Zm=Hn.unstable_cancelCallback,vw=Hn.unstable_shouldYield,_w=Hn.unstable_requestPaint,zt=Hn.unstable_now,xw=Hn.unstable_getCurrentPriorityLevel,ig=Hn.unstable_ImmediatePriority,_x=Hn.unstable_UserBlockingPriority,_d=Hn.unstable_NormalPriority,bw=Hn.unstable_LowPriority,xx=Hn.unstable_IdlePriority,hu=null,Or=null;function Ew(t){if(Or&&typeof Or.onCommitFiberRoot=="function")try{Or.onCommitFiberRoot(hu,t,void 0,(t.current.flags&128)===128)}catch{}}var gr=Math.clz32?Math.clz32:ww,Sw=Math.log,Iw=Math.LN2;function ww(t){return t>>>=0,t===0?32:31-(Sw(t)/Iw|0)|0}var Sc=64,Ic=4194304;function Aa(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function xd(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,o=n&268435455;if(o!==0){var l=o&~s;l!==0?r=Aa(l):(i&=o,i!==0&&(r=Aa(i)))}else o=n&~s,o!==0?r=Aa(o):i!==0&&(r=Aa(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-gr(e),s=1<<n,r|=t[n],e&=~s;return r}function Tw(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Cw(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var o=31-gr(i),l=1<<o,c=s[o];c===-1?(!(l&n)||l&r)&&(s[o]=Tw(l,e)):c<=e&&(t.expiredLanes|=l),i&=~l}}function $h(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function bx(){var t=Sc;return Sc<<=1,!(Sc&4194240)&&(Sc=64),t}function jf(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Ll(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-gr(e),t[e]=n}function kw(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-gr(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function og(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-gr(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var xt=0;function Ex(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Sx,ag,Ix,wx,Tx,Fh=!1,wc=[],Ps=null,Os=null,Ls=null,sl=new Map,il=new Map,_s=[],Rw="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ey(t,e){switch(t){case"focusin":case"focusout":Ps=null;break;case"dragenter":case"dragleave":Os=null;break;case"mouseover":case"mouseout":Ls=null;break;case"pointerover":case"pointerout":sl.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":il.delete(e.pointerId)}}function ma(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=Ml(e),e!==null&&ag(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function Aw(t,e,n,r,s){switch(e){case"focusin":return Ps=ma(Ps,t,e,n,r,s),!0;case"dragenter":return Os=ma(Os,t,e,n,r,s),!0;case"mouseover":return Ls=ma(Ls,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return sl.set(i,ma(sl.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,il.set(i,ma(il.get(i)||null,t,e,n,r,s)),!0}return!1}function Cx(t){var e=pi(t.target);if(e!==null){var n=Li(e);if(n!==null){if(e=n.tag,e===13){if(e=gx(n),e!==null){t.blockedOn=e,Tx(t.priority,function(){Ix(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Yc(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Uh(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);Dh=r,n.target.dispatchEvent(r),Dh=null}else return e=Ml(n),e!==null&&ag(e),t.blockedOn=n,!1;e.shift()}return!0}function ty(t,e,n){Yc(t)&&n.delete(e)}function Pw(){Fh=!1,Ps!==null&&Yc(Ps)&&(Ps=null),Os!==null&&Yc(Os)&&(Os=null),Ls!==null&&Yc(Ls)&&(Ls=null),sl.forEach(ty),il.forEach(ty)}function ya(t,e){t.blockedOn===e&&(t.blockedOn=null,Fh||(Fh=!0,Hn.unstable_scheduleCallback(Hn.unstable_NormalPriority,Pw)))}function ol(t){function e(s){return ya(s,t)}if(0<wc.length){ya(wc[0],t);for(var n=1;n<wc.length;n++){var r=wc[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Ps!==null&&ya(Ps,t),Os!==null&&ya(Os,t),Ls!==null&&ya(Ls,t),sl.forEach(e),il.forEach(e),n=0;n<_s.length;n++)r=_s[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<_s.length&&(n=_s[0],n.blockedOn===null);)Cx(n),n.blockedOn===null&&_s.shift()}var xo=os.ReactCurrentBatchConfig,bd=!0;function Ow(t,e,n,r){var s=xt,i=xo.transition;xo.transition=null;try{xt=1,lg(t,e,n,r)}finally{xt=s,xo.transition=i}}function Lw(t,e,n,r){var s=xt,i=xo.transition;xo.transition=null;try{xt=4,lg(t,e,n,r)}finally{xt=s,xo.transition=i}}function lg(t,e,n,r){if(bd){var s=Uh(t,e,n,r);if(s===null)Yf(t,e,r,Ed,n),ey(t,r);else if(Aw(s,t,e,n,r))r.stopPropagation();else if(ey(t,r),e&4&&-1<Rw.indexOf(t)){for(;s!==null;){var i=Ml(s);if(i!==null&&Sx(i),i=Uh(t,e,n,r),i===null&&Yf(t,e,r,Ed,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else Yf(t,e,r,null,n)}}var Ed=null;function Uh(t,e,n,r){if(Ed=null,t=sg(r),t=pi(t),t!==null)if(e=Li(t),e===null)t=null;else if(n=e.tag,n===13){if(t=gx(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Ed=t,null}function kx(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(xw()){case ig:return 1;case _x:return 4;case _d:case bw:return 16;case xx:return 536870912;default:return 16}default:return 16}}var Ts=null,cg=null,Kc=null;function Rx(){if(Kc)return Kc;var t,e=cg,n=e.length,r,s="value"in Ts?Ts.value:Ts.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===s[i-r];r++);return Kc=s.slice(t,1<r?1-r:void 0)}function Xc(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Tc(){return!0}function ny(){return!1}function Vn(t){function e(n,r,s,i,o){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(i):i[l]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Tc:ny,this.isPropagationStopped=ny,this}return Ft(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Tc)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Tc)},persist:function(){},isPersistent:Tc}),e}var Vo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},dg=Vn(Vo),Dl=Ft({},Vo,{view:0,detail:0}),Dw=Vn(Dl),$f,Ff,va,pu=Ft({},Dl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ug,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==va&&(va&&t.type==="mousemove"?($f=t.screenX-va.screenX,Ff=t.screenY-va.screenY):Ff=$f=0,va=t),$f)},movementY:function(t){return"movementY"in t?t.movementY:Ff}}),ry=Vn(pu),Mw=Ft({},pu,{dataTransfer:0}),Nw=Vn(Mw),jw=Ft({},Dl,{relatedTarget:0}),Uf=Vn(jw),$w=Ft({},Vo,{animationName:0,elapsedTime:0,pseudoElement:0}),Fw=Vn($w),Uw=Ft({},Vo,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Bw=Vn(Uw),zw=Ft({},Vo,{data:0}),sy=Vn(zw),Hw={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ww={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Gw={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Vw(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=Gw[t])?!!e[t]:!1}function ug(){return Vw}var Yw=Ft({},Dl,{key:function(t){if(t.key){var e=Hw[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Xc(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Ww[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ug,charCode:function(t){return t.type==="keypress"?Xc(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Xc(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Kw=Vn(Yw),Xw=Ft({},pu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),iy=Vn(Xw),Qw=Ft({},Dl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ug}),Jw=Vn(Qw),qw=Ft({},Vo,{propertyName:0,elapsedTime:0,pseudoElement:0}),Zw=Vn(qw),eT=Ft({},pu,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),tT=Vn(eT),nT=[9,13,27,32],fg=Zr&&"CompositionEvent"in window,ja=null;Zr&&"documentMode"in document&&(ja=document.documentMode);var rT=Zr&&"TextEvent"in window&&!ja,Ax=Zr&&(!fg||ja&&8<ja&&11>=ja),oy=" ",ay=!1;function Px(t,e){switch(t){case"keyup":return nT.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ox(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var so=!1;function sT(t,e){switch(t){case"compositionend":return Ox(e);case"keypress":return e.which!==32?null:(ay=!0,oy);case"textInput":return t=e.data,t===oy&&ay?null:t;default:return null}}function iT(t,e){if(so)return t==="compositionend"||!fg&&Px(t,e)?(t=Rx(),Kc=cg=Ts=null,so=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Ax&&e.locale!=="ko"?null:e.data;default:return null}}var oT={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ly(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!oT[t.type]:e==="textarea"}function Lx(t,e,n,r){dx(r),e=Sd(e,"onChange"),0<e.length&&(n=new dg("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var $a=null,al=null;function aT(t){Wx(t,0)}function gu(t){var e=ao(t);if(rx(e))return t}function lT(t,e){if(t==="change")return e}var Dx=!1;if(Zr){var Bf;if(Zr){var zf="oninput"in document;if(!zf){var cy=document.createElement("div");cy.setAttribute("oninput","return;"),zf=typeof cy.oninput=="function"}Bf=zf}else Bf=!1;Dx=Bf&&(!document.documentMode||9<document.documentMode)}function dy(){$a&&($a.detachEvent("onpropertychange",Mx),al=$a=null)}function Mx(t){if(t.propertyName==="value"&&gu(al)){var e=[];Lx(e,al,t,sg(t)),px(aT,e)}}function cT(t,e,n){t==="focusin"?(dy(),$a=e,al=n,$a.attachEvent("onpropertychange",Mx)):t==="focusout"&&dy()}function dT(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return gu(al)}function uT(t,e){if(t==="click")return gu(e)}function fT(t,e){if(t==="input"||t==="change")return gu(e)}function hT(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var vr=typeof Object.is=="function"?Object.is:hT;function ll(t,e){if(vr(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!Eh.call(e,s)||!vr(t[s],e[s]))return!1}return!0}function uy(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function fy(t,e){var n=uy(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=uy(n)}}function Nx(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?Nx(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function jx(){for(var t=window,e=md();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=md(t.document)}return e}function hg(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function pT(t){var e=jx(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&Nx(n.ownerDocument.documentElement,n)){if(r!==null&&hg(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=fy(n,i);var o=fy(n,r);s&&o&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var gT=Zr&&"documentMode"in document&&11>=document.documentMode,io=null,Bh=null,Fa=null,zh=!1;function hy(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;zh||io==null||io!==md(r)||(r=io,"selectionStart"in r&&hg(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Fa&&ll(Fa,r)||(Fa=r,r=Sd(Bh,"onSelect"),0<r.length&&(e=new dg("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=io)))}function Cc(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var oo={animationend:Cc("Animation","AnimationEnd"),animationiteration:Cc("Animation","AnimationIteration"),animationstart:Cc("Animation","AnimationStart"),transitionend:Cc("Transition","TransitionEnd")},Hf={},$x={};Zr&&($x=document.createElement("div").style,"AnimationEvent"in window||(delete oo.animationend.animation,delete oo.animationiteration.animation,delete oo.animationstart.animation),"TransitionEvent"in window||delete oo.transitionend.transition);function mu(t){if(Hf[t])return Hf[t];if(!oo[t])return t;var e=oo[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in $x)return Hf[t]=e[n];return t}var Fx=mu("animationend"),Ux=mu("animationiteration"),Bx=mu("animationstart"),zx=mu("transitionend"),Hx=new Map,py="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function qs(t,e){Hx.set(t,e),Oi(e,[t])}for(var Wf=0;Wf<py.length;Wf++){var Gf=py[Wf],mT=Gf.toLowerCase(),yT=Gf[0].toUpperCase()+Gf.slice(1);qs(mT,"on"+yT)}qs(Fx,"onAnimationEnd");qs(Ux,"onAnimationIteration");qs(Bx,"onAnimationStart");qs("dblclick","onDoubleClick");qs("focusin","onFocus");qs("focusout","onBlur");qs(zx,"onTransitionEnd");Ao("onMouseEnter",["mouseout","mouseover"]);Ao("onMouseLeave",["mouseout","mouseover"]);Ao("onPointerEnter",["pointerout","pointerover"]);Ao("onPointerLeave",["pointerout","pointerover"]);Oi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Oi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Oi("onBeforeInput",["compositionend","keypress","textInput","paste"]);Oi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Oi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Oi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Pa="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),vT=new Set("cancel close invalid load scroll toggle".split(" ").concat(Pa));function gy(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,mw(r,e,void 0,t),t.currentTarget=null}function Wx(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var l=r[o],c=l.instance,d=l.currentTarget;if(l=l.listener,c!==i&&s.isPropagationStopped())break e;gy(s,l,d),i=c}else for(o=0;o<r.length;o++){if(l=r[o],c=l.instance,d=l.currentTarget,l=l.listener,c!==i&&s.isPropagationStopped())break e;gy(s,l,d),i=c}}}if(vd)throw t=jh,vd=!1,jh=null,t}function Rt(t,e){var n=e[Yh];n===void 0&&(n=e[Yh]=new Set);var r=t+"__bubble";n.has(r)||(Gx(e,t,2,!1),n.add(r))}function Vf(t,e,n){var r=0;e&&(r|=4),Gx(n,t,r,e)}var kc="_reactListening"+Math.random().toString(36).slice(2);function cl(t){if(!t[kc]){t[kc]=!0,q_.forEach(function(n){n!=="selectionchange"&&(vT.has(n)||Vf(n,!1,t),Vf(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[kc]||(e[kc]=!0,Vf("selectionchange",!1,e))}}function Gx(t,e,n,r){switch(kx(e)){case 1:var s=Ow;break;case 4:s=Lw;break;default:s=lg}n=s.bind(null,e,n,t),s=void 0,!Nh||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function Yf(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var l=r.stateNode.containerInfo;if(l===s||l.nodeType===8&&l.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===s||c.nodeType===8&&c.parentNode===s))return;o=o.return}for(;l!==null;){if(o=pi(l),o===null)return;if(c=o.tag,c===5||c===6){r=i=o;continue e}l=l.parentNode}}r=r.return}px(function(){var d=i,u=sg(n),h=[];e:{var f=Hx.get(t);if(f!==void 0){var S=dg,k=t;switch(t){case"keypress":if(Xc(n)===0)break e;case"keydown":case"keyup":S=Kw;break;case"focusin":k="focus",S=Uf;break;case"focusout":k="blur",S=Uf;break;case"beforeblur":case"afterblur":S=Uf;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":S=ry;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":S=Nw;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":S=Jw;break;case Fx:case Ux:case Bx:S=Fw;break;case zx:S=Zw;break;case"scroll":S=Dw;break;case"wheel":S=tT;break;case"copy":case"cut":case"paste":S=Bw;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":S=iy}var w=(e&4)!==0,j=!w&&t==="scroll",_=w?f!==null?f+"Capture":null:f;w=[];for(var x=d,I;x!==null;){I=x;var p=I.stateNode;if(I.tag===5&&p!==null&&(I=p,_!==null&&(p=rl(x,_),p!=null&&w.push(dl(x,p,I)))),j)break;x=x.return}0<w.length&&(f=new S(f,k,null,n,u),h.push({event:f,listeners:w}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",S=t==="mouseout"||t==="pointerout",f&&n!==Dh&&(k=n.relatedTarget||n.fromElement)&&(pi(k)||k[es]))break e;if((S||f)&&(f=u.window===u?u:(f=u.ownerDocument)?f.defaultView||f.parentWindow:window,S?(k=n.relatedTarget||n.toElement,S=d,k=k?pi(k):null,k!==null&&(j=Li(k),k!==j||k.tag!==5&&k.tag!==6)&&(k=null)):(S=null,k=d),S!==k)){if(w=ry,p="onMouseLeave",_="onMouseEnter",x="mouse",(t==="pointerout"||t==="pointerover")&&(w=iy,p="onPointerLeave",_="onPointerEnter",x="pointer"),j=S==null?f:ao(S),I=k==null?f:ao(k),f=new w(p,x+"leave",S,n,u),f.target=j,f.relatedTarget=I,p=null,pi(u)===d&&(w=new w(_,x+"enter",k,n,u),w.target=I,w.relatedTarget=j,p=w),j=p,S&&k)t:{for(w=S,_=k,x=0,I=w;I;I=qi(I))x++;for(I=0,p=_;p;p=qi(p))I++;for(;0<x-I;)w=qi(w),x--;for(;0<I-x;)_=qi(_),I--;for(;x--;){if(w===_||_!==null&&w===_.alternate)break t;w=qi(w),_=qi(_)}w=null}else w=null;S!==null&&my(h,f,S,w,!1),k!==null&&j!==null&&my(h,j,k,w,!0)}}e:{if(f=d?ao(d):window,S=f.nodeName&&f.nodeName.toLowerCase(),S==="select"||S==="input"&&f.type==="file")var D=lT;else if(ly(f))if(Dx)D=fT;else{D=dT;var z=cT}else(S=f.nodeName)&&S.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(D=uT);if(D&&(D=D(t,d))){Lx(h,D,n,u);break e}z&&z(t,f,d),t==="focusout"&&(z=f._wrapperState)&&z.controlled&&f.type==="number"&&Rh(f,"number",f.value)}switch(z=d?ao(d):window,t){case"focusin":(ly(z)||z.contentEditable==="true")&&(io=z,Bh=d,Fa=null);break;case"focusout":Fa=Bh=io=null;break;case"mousedown":zh=!0;break;case"contextmenu":case"mouseup":case"dragend":zh=!1,hy(h,n,u);break;case"selectionchange":if(gT)break;case"keydown":case"keyup":hy(h,n,u)}var te;if(fg)e:{switch(t){case"compositionstart":var H="onCompositionStart";break e;case"compositionend":H="onCompositionEnd";break e;case"compositionupdate":H="onCompositionUpdate";break e}H=void 0}else so?Px(t,n)&&(H="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(H="onCompositionStart");H&&(Ax&&n.locale!=="ko"&&(so||H!=="onCompositionStart"?H==="onCompositionEnd"&&so&&(te=Rx()):(Ts=u,cg="value"in Ts?Ts.value:Ts.textContent,so=!0)),z=Sd(d,H),0<z.length&&(H=new sy(H,t,null,n,u),h.push({event:H,listeners:z}),te?H.data=te:(te=Ox(n),te!==null&&(H.data=te)))),(te=rT?sT(t,n):iT(t,n))&&(d=Sd(d,"onBeforeInput"),0<d.length&&(u=new sy("onBeforeInput","beforeinput",null,n,u),h.push({event:u,listeners:d}),u.data=te))}Wx(h,e)})}function dl(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Sd(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=rl(t,n),i!=null&&r.unshift(dl(t,i,s)),i=rl(t,e),i!=null&&r.push(dl(t,i,s))),t=t.return}return r}function qi(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function my(t,e,n,r,s){for(var i=e._reactName,o=[];n!==null&&n!==r;){var l=n,c=l.alternate,d=l.stateNode;if(c!==null&&c===r)break;l.tag===5&&d!==null&&(l=d,s?(c=rl(n,i),c!=null&&o.unshift(dl(n,c,l))):s||(c=rl(n,i),c!=null&&o.push(dl(n,c,l)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var _T=/\r\n?/g,xT=/\u0000|\uFFFD/g;function yy(t){return(typeof t=="string"?t:""+t).replace(_T,`
`).replace(xT,"")}function Rc(t,e,n){if(e=yy(e),yy(t)!==e&&n)throw Error(de(425))}function Id(){}var Hh=null,Wh=null;function Gh(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Vh=typeof setTimeout=="function"?setTimeout:void 0,bT=typeof clearTimeout=="function"?clearTimeout:void 0,vy=typeof Promise=="function"?Promise:void 0,ET=typeof queueMicrotask=="function"?queueMicrotask:typeof vy<"u"?function(t){return vy.resolve(null).then(t).catch(ST)}:Vh;function ST(t){setTimeout(function(){throw t})}function Kf(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),ol(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);ol(e)}function Ds(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function _y(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Yo=Math.random().toString(36).slice(2),kr="__reactFiber$"+Yo,ul="__reactProps$"+Yo,es="__reactContainer$"+Yo,Yh="__reactEvents$"+Yo,IT="__reactListeners$"+Yo,wT="__reactHandles$"+Yo;function pi(t){var e=t[kr];if(e)return e;for(var n=t.parentNode;n;){if(e=n[es]||n[kr]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=_y(t);t!==null;){if(n=t[kr])return n;t=_y(t)}return e}t=n,n=t.parentNode}return null}function Ml(t){return t=t[kr]||t[es],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function ao(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(de(33))}function yu(t){return t[ul]||null}var Kh=[],lo=-1;function Zs(t){return{current:t}}function At(t){0>lo||(t.current=Kh[lo],Kh[lo]=null,lo--)}function kt(t,e){lo++,Kh[lo]=t.current,t.current=e}var Vs={},yn=Zs(Vs),Mn=Zs(!1),xi=Vs;function Po(t,e){var n=t.type.contextTypes;if(!n)return Vs;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function Nn(t){return t=t.childContextTypes,t!=null}function wd(){At(Mn),At(yn)}function xy(t,e,n){if(yn.current!==Vs)throw Error(de(168));kt(yn,e),kt(Mn,n)}function Vx(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(de(108,cw(t)||"Unknown",s));return Ft({},n,r)}function Td(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Vs,xi=yn.current,kt(yn,t),kt(Mn,Mn.current),!0}function by(t,e,n){var r=t.stateNode;if(!r)throw Error(de(169));n?(t=Vx(t,e,xi),r.__reactInternalMemoizedMergedChildContext=t,At(Mn),At(yn),kt(yn,t)):At(Mn),kt(Mn,n)}var Hr=null,vu=!1,Xf=!1;function Yx(t){Hr===null?Hr=[t]:Hr.push(t)}function TT(t){vu=!0,Yx(t)}function ei(){if(!Xf&&Hr!==null){Xf=!0;var t=0,e=xt;try{var n=Hr;for(xt=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}Hr=null,vu=!1}catch(s){throw Hr!==null&&(Hr=Hr.slice(t+1)),vx(ig,ei),s}finally{xt=e,Xf=!1}}return null}var co=[],uo=0,Cd=null,kd=0,Xn=[],Qn=0,bi=null,Gr=1,Vr="";function ci(t,e){co[uo++]=kd,co[uo++]=Cd,Cd=t,kd=e}function Kx(t,e,n){Xn[Qn++]=Gr,Xn[Qn++]=Vr,Xn[Qn++]=bi,bi=t;var r=Gr;t=Vr;var s=32-gr(r)-1;r&=~(1<<s),n+=1;var i=32-gr(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,Gr=1<<32-gr(e)+s|n<<s|r,Vr=i+t}else Gr=1<<i|n<<s|r,Vr=t}function pg(t){t.return!==null&&(ci(t,1),Kx(t,1,0))}function gg(t){for(;t===Cd;)Cd=co[--uo],co[uo]=null,kd=co[--uo],co[uo]=null;for(;t===bi;)bi=Xn[--Qn],Xn[Qn]=null,Vr=Xn[--Qn],Xn[Qn]=null,Gr=Xn[--Qn],Xn[Qn]=null}var zn=null,Bn=null,Lt=!1,dr=null;function Xx(t,e){var n=Zn(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Ey(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,zn=t,Bn=Ds(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,zn=t,Bn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=bi!==null?{id:Gr,overflow:Vr}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Zn(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,zn=t,Bn=null,!0):!1;default:return!1}}function Xh(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Qh(t){if(Lt){var e=Bn;if(e){var n=e;if(!Ey(t,e)){if(Xh(t))throw Error(de(418));e=Ds(n.nextSibling);var r=zn;e&&Ey(t,e)?Xx(r,n):(t.flags=t.flags&-4097|2,Lt=!1,zn=t)}}else{if(Xh(t))throw Error(de(418));t.flags=t.flags&-4097|2,Lt=!1,zn=t}}}function Sy(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;zn=t}function Ac(t){if(t!==zn)return!1;if(!Lt)return Sy(t),Lt=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Gh(t.type,t.memoizedProps)),e&&(e=Bn)){if(Xh(t))throw Qx(),Error(de(418));for(;e;)Xx(t,e),e=Ds(e.nextSibling)}if(Sy(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(de(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Bn=Ds(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Bn=null}}else Bn=zn?Ds(t.stateNode.nextSibling):null;return!0}function Qx(){for(var t=Bn;t;)t=Ds(t.nextSibling)}function Oo(){Bn=zn=null,Lt=!1}function mg(t){dr===null?dr=[t]:dr.push(t)}var CT=os.ReactCurrentBatchConfig;function _a(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(de(309));var r=n.stateNode}if(!r)throw Error(de(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var l=s.refs;o===null?delete l[i]:l[i]=o},e._stringRef=i,e)}if(typeof t!="string")throw Error(de(284));if(!n._owner)throw Error(de(290,t))}return t}function Pc(t,e){throw t=Object.prototype.toString.call(e),Error(de(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Iy(t){var e=t._init;return e(t._payload)}function Jx(t){function e(_,x){if(t){var I=_.deletions;I===null?(_.deletions=[x],_.flags|=16):I.push(x)}}function n(_,x){if(!t)return null;for(;x!==null;)e(_,x),x=x.sibling;return null}function r(_,x){for(_=new Map;x!==null;)x.key!==null?_.set(x.key,x):_.set(x.index,x),x=x.sibling;return _}function s(_,x){return _=$s(_,x),_.index=0,_.sibling=null,_}function i(_,x,I){return _.index=I,t?(I=_.alternate,I!==null?(I=I.index,I<x?(_.flags|=2,x):I):(_.flags|=2,x)):(_.flags|=1048576,x)}function o(_){return t&&_.alternate===null&&(_.flags|=2),_}function l(_,x,I,p){return x===null||x.tag!==6?(x=nh(I,_.mode,p),x.return=_,x):(x=s(x,I),x.return=_,x)}function c(_,x,I,p){var D=I.type;return D===ro?u(_,x,I.props.children,p,I.key):x!==null&&(x.elementType===D||typeof D=="object"&&D!==null&&D.$$typeof===ys&&Iy(D)===x.type)?(p=s(x,I.props),p.ref=_a(_,x,I),p.return=_,p):(p=nd(I.type,I.key,I.props,null,_.mode,p),p.ref=_a(_,x,I),p.return=_,p)}function d(_,x,I,p){return x===null||x.tag!==4||x.stateNode.containerInfo!==I.containerInfo||x.stateNode.implementation!==I.implementation?(x=rh(I,_.mode,p),x.return=_,x):(x=s(x,I.children||[]),x.return=_,x)}function u(_,x,I,p,D){return x===null||x.tag!==7?(x=_i(I,_.mode,p,D),x.return=_,x):(x=s(x,I),x.return=_,x)}function h(_,x,I){if(typeof x=="string"&&x!==""||typeof x=="number")return x=nh(""+x,_.mode,I),x.return=_,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case xc:return I=nd(x.type,x.key,x.props,null,_.mode,I),I.ref=_a(_,null,x),I.return=_,I;case no:return x=rh(x,_.mode,I),x.return=_,x;case ys:var p=x._init;return h(_,p(x._payload),I)}if(Ra(x)||pa(x))return x=_i(x,_.mode,I,null),x.return=_,x;Pc(_,x)}return null}function f(_,x,I,p){var D=x!==null?x.key:null;if(typeof I=="string"&&I!==""||typeof I=="number")return D!==null?null:l(_,x,""+I,p);if(typeof I=="object"&&I!==null){switch(I.$$typeof){case xc:return I.key===D?c(_,x,I,p):null;case no:return I.key===D?d(_,x,I,p):null;case ys:return D=I._init,f(_,x,D(I._payload),p)}if(Ra(I)||pa(I))return D!==null?null:u(_,x,I,p,null);Pc(_,I)}return null}function S(_,x,I,p,D){if(typeof p=="string"&&p!==""||typeof p=="number")return _=_.get(I)||null,l(x,_,""+p,D);if(typeof p=="object"&&p!==null){switch(p.$$typeof){case xc:return _=_.get(p.key===null?I:p.key)||null,c(x,_,p,D);case no:return _=_.get(p.key===null?I:p.key)||null,d(x,_,p,D);case ys:var z=p._init;return S(_,x,I,z(p._payload),D)}if(Ra(p)||pa(p))return _=_.get(I)||null,u(x,_,p,D,null);Pc(x,p)}return null}function k(_,x,I,p){for(var D=null,z=null,te=x,H=x=0,q=null;te!==null&&H<I.length;H++){te.index>H?(q=te,te=null):q=te.sibling;var ue=f(_,te,I[H],p);if(ue===null){te===null&&(te=q);break}t&&te&&ue.alternate===null&&e(_,te),x=i(ue,x,H),z===null?D=ue:z.sibling=ue,z=ue,te=q}if(H===I.length)return n(_,te),Lt&&ci(_,H),D;if(te===null){for(;H<I.length;H++)te=h(_,I[H],p),te!==null&&(x=i(te,x,H),z===null?D=te:z.sibling=te,z=te);return Lt&&ci(_,H),D}for(te=r(_,te);H<I.length;H++)q=S(te,_,H,I[H],p),q!==null&&(t&&q.alternate!==null&&te.delete(q.key===null?H:q.key),x=i(q,x,H),z===null?D=q:z.sibling=q,z=q);return t&&te.forEach(function(ye){return e(_,ye)}),Lt&&ci(_,H),D}function w(_,x,I,p){var D=pa(I);if(typeof D!="function")throw Error(de(150));if(I=D.call(I),I==null)throw Error(de(151));for(var z=D=null,te=x,H=x=0,q=null,ue=I.next();te!==null&&!ue.done;H++,ue=I.next()){te.index>H?(q=te,te=null):q=te.sibling;var ye=f(_,te,ue.value,p);if(ye===null){te===null&&(te=q);break}t&&te&&ye.alternate===null&&e(_,te),x=i(ye,x,H),z===null?D=ye:z.sibling=ye,z=ye,te=q}if(ue.done)return n(_,te),Lt&&ci(_,H),D;if(te===null){for(;!ue.done;H++,ue=I.next())ue=h(_,ue.value,p),ue!==null&&(x=i(ue,x,H),z===null?D=ue:z.sibling=ue,z=ue);return Lt&&ci(_,H),D}for(te=r(_,te);!ue.done;H++,ue=I.next())ue=S(te,_,H,ue.value,p),ue!==null&&(t&&ue.alternate!==null&&te.delete(ue.key===null?H:ue.key),x=i(ue,x,H),z===null?D=ue:z.sibling=ue,z=ue);return t&&te.forEach(function(Me){return e(_,Me)}),Lt&&ci(_,H),D}function j(_,x,I,p){if(typeof I=="object"&&I!==null&&I.type===ro&&I.key===null&&(I=I.props.children),typeof I=="object"&&I!==null){switch(I.$$typeof){case xc:e:{for(var D=I.key,z=x;z!==null;){if(z.key===D){if(D=I.type,D===ro){if(z.tag===7){n(_,z.sibling),x=s(z,I.props.children),x.return=_,_=x;break e}}else if(z.elementType===D||typeof D=="object"&&D!==null&&D.$$typeof===ys&&Iy(D)===z.type){n(_,z.sibling),x=s(z,I.props),x.ref=_a(_,z,I),x.return=_,_=x;break e}n(_,z);break}else e(_,z);z=z.sibling}I.type===ro?(x=_i(I.props.children,_.mode,p,I.key),x.return=_,_=x):(p=nd(I.type,I.key,I.props,null,_.mode,p),p.ref=_a(_,x,I),p.return=_,_=p)}return o(_);case no:e:{for(z=I.key;x!==null;){if(x.key===z)if(x.tag===4&&x.stateNode.containerInfo===I.containerInfo&&x.stateNode.implementation===I.implementation){n(_,x.sibling),x=s(x,I.children||[]),x.return=_,_=x;break e}else{n(_,x);break}else e(_,x);x=x.sibling}x=rh(I,_.mode,p),x.return=_,_=x}return o(_);case ys:return z=I._init,j(_,x,z(I._payload),p)}if(Ra(I))return k(_,x,I,p);if(pa(I))return w(_,x,I,p);Pc(_,I)}return typeof I=="string"&&I!==""||typeof I=="number"?(I=""+I,x!==null&&x.tag===6?(n(_,x.sibling),x=s(x,I),x.return=_,_=x):(n(_,x),x=nh(I,_.mode,p),x.return=_,_=x),o(_)):n(_,x)}return j}var Lo=Jx(!0),qx=Jx(!1),Rd=Zs(null),Ad=null,fo=null,yg=null;function vg(){yg=fo=Ad=null}function _g(t){var e=Rd.current;At(Rd),t._currentValue=e}function Jh(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function bo(t,e){Ad=t,yg=fo=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Ln=!0),t.firstContext=null)}function nr(t){var e=t._currentValue;if(yg!==t)if(t={context:t,memoizedValue:e,next:null},fo===null){if(Ad===null)throw Error(de(308));fo=t,Ad.dependencies={lanes:0,firstContext:t}}else fo=fo.next=t;return e}var gi=null;function xg(t){gi===null?gi=[t]:gi.push(t)}function Zx(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,xg(e)):(n.next=s.next,s.next=n),e.interleaved=n,ts(t,r)}function ts(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var vs=!1;function bg(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function e1(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Qr(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Ms(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,ht&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,ts(t,n)}return s=r.interleaved,s===null?(e.next=e,xg(r)):(e.next=s.next,s.next=e),r.interleaved=e,ts(t,n)}function Qc(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,og(t,n)}}function wy(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=o:i=i.next=o,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Pd(t,e,n,r){var s=t.updateQueue;vs=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,l=s.shared.pending;if(l!==null){s.shared.pending=null;var c=l,d=c.next;c.next=null,o===null?i=d:o.next=d,o=c;var u=t.alternate;u!==null&&(u=u.updateQueue,l=u.lastBaseUpdate,l!==o&&(l===null?u.firstBaseUpdate=d:l.next=d,u.lastBaseUpdate=c))}if(i!==null){var h=s.baseState;o=0,u=d=c=null,l=i;do{var f=l.lane,S=l.eventTime;if((r&f)===f){u!==null&&(u=u.next={eventTime:S,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var k=t,w=l;switch(f=e,S=n,w.tag){case 1:if(k=w.payload,typeof k=="function"){h=k.call(S,h,f);break e}h=k;break e;case 3:k.flags=k.flags&-65537|128;case 0:if(k=w.payload,f=typeof k=="function"?k.call(S,h,f):k,f==null)break e;h=Ft({},h,f);break e;case 2:vs=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,f=s.effects,f===null?s.effects=[l]:f.push(l))}else S={eventTime:S,lane:f,tag:l.tag,payload:l.payload,callback:l.callback,next:null},u===null?(d=u=S,c=h):u=u.next=S,o|=f;if(l=l.next,l===null){if(l=s.shared.pending,l===null)break;f=l,l=f.next,f.next=null,s.lastBaseUpdate=f,s.shared.pending=null}}while(!0);if(u===null&&(c=h),s.baseState=c,s.firstBaseUpdate=d,s.lastBaseUpdate=u,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);Si|=o,t.lanes=o,t.memoizedState=h}}function Ty(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(de(191,s));s.call(r)}}}var Nl={},Lr=Zs(Nl),fl=Zs(Nl),hl=Zs(Nl);function mi(t){if(t===Nl)throw Error(de(174));return t}function Eg(t,e){switch(kt(hl,e),kt(fl,t),kt(Lr,Nl),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Ph(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Ph(e,t)}At(Lr),kt(Lr,e)}function Do(){At(Lr),At(fl),At(hl)}function t1(t){mi(hl.current);var e=mi(Lr.current),n=Ph(e,t.type);e!==n&&(kt(fl,t),kt(Lr,n))}function Sg(t){fl.current===t&&(At(Lr),At(fl))}var Mt=Zs(0);function Od(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Qf=[];function Ig(){for(var t=0;t<Qf.length;t++)Qf[t]._workInProgressVersionPrimary=null;Qf.length=0}var Jc=os.ReactCurrentDispatcher,Jf=os.ReactCurrentBatchConfig,Ei=0,$t=null,Kt=null,Zt=null,Ld=!1,Ua=!1,pl=0,kT=0;function hn(){throw Error(de(321))}function wg(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!vr(t[n],e[n]))return!1;return!0}function Tg(t,e,n,r,s,i){if(Ei=i,$t=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Jc.current=t===null||t.memoizedState===null?OT:LT,t=n(r,s),Ua){i=0;do{if(Ua=!1,pl=0,25<=i)throw Error(de(301));i+=1,Zt=Kt=null,e.updateQueue=null,Jc.current=DT,t=n(r,s)}while(Ua)}if(Jc.current=Dd,e=Kt!==null&&Kt.next!==null,Ei=0,Zt=Kt=$t=null,Ld=!1,e)throw Error(de(300));return t}function Cg(){var t=pl!==0;return pl=0,t}function Cr(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Zt===null?$t.memoizedState=Zt=t:Zt=Zt.next=t,Zt}function rr(){if(Kt===null){var t=$t.alternate;t=t!==null?t.memoizedState:null}else t=Kt.next;var e=Zt===null?$t.memoizedState:Zt.next;if(e!==null)Zt=e,Kt=t;else{if(t===null)throw Error(de(310));Kt=t,t={memoizedState:Kt.memoizedState,baseState:Kt.baseState,baseQueue:Kt.baseQueue,queue:Kt.queue,next:null},Zt===null?$t.memoizedState=Zt=t:Zt=Zt.next=t}return Zt}function gl(t,e){return typeof e=="function"?e(t):e}function qf(t){var e=rr(),n=e.queue;if(n===null)throw Error(de(311));n.lastRenderedReducer=t;var r=Kt,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var l=o=null,c=null,d=i;do{var u=d.lane;if((Ei&u)===u)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:t(r,d.action);else{var h={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(l=c=h,o=r):c=c.next=h,$t.lanes|=u,Si|=u}d=d.next}while(d!==null&&d!==i);c===null?o=r:c.next=l,vr(r,e.memoizedState)||(Ln=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=c,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,$t.lanes|=i,Si|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Zf(t){var e=rr(),n=e.queue;if(n===null)throw Error(de(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var o=s=s.next;do i=t(i,o.action),o=o.next;while(o!==s);vr(i,e.memoizedState)||(Ln=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function n1(){}function r1(t,e){var n=$t,r=rr(),s=e(),i=!vr(r.memoizedState,s);if(i&&(r.memoizedState=s,Ln=!0),r=r.queue,kg(o1.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||Zt!==null&&Zt.memoizedState.tag&1){if(n.flags|=2048,ml(9,i1.bind(null,n,r,s,e),void 0,null),nn===null)throw Error(de(349));Ei&30||s1(n,e,s)}return s}function s1(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=$t.updateQueue,e===null?(e={lastEffect:null,stores:null},$t.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function i1(t,e,n,r){e.value=n,e.getSnapshot=r,a1(e)&&l1(t)}function o1(t,e,n){return n(function(){a1(e)&&l1(t)})}function a1(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!vr(t,n)}catch{return!0}}function l1(t){var e=ts(t,1);e!==null&&mr(e,t,1,-1)}function Cy(t){var e=Cr();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:gl,lastRenderedState:t},e.queue=t,t=t.dispatch=PT.bind(null,$t,t),[e.memoizedState,t]}function ml(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=$t.updateQueue,e===null?(e={lastEffect:null,stores:null},$t.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function c1(){return rr().memoizedState}function qc(t,e,n,r){var s=Cr();$t.flags|=t,s.memoizedState=ml(1|e,n,void 0,r===void 0?null:r)}function _u(t,e,n,r){var s=rr();r=r===void 0?null:r;var i=void 0;if(Kt!==null){var o=Kt.memoizedState;if(i=o.destroy,r!==null&&wg(r,o.deps)){s.memoizedState=ml(e,n,i,r);return}}$t.flags|=t,s.memoizedState=ml(1|e,n,i,r)}function ky(t,e){return qc(8390656,8,t,e)}function kg(t,e){return _u(2048,8,t,e)}function d1(t,e){return _u(4,2,t,e)}function u1(t,e){return _u(4,4,t,e)}function f1(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function h1(t,e,n){return n=n!=null?n.concat([t]):null,_u(4,4,f1.bind(null,e,t),n)}function Rg(){}function p1(t,e){var n=rr();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&wg(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function g1(t,e){var n=rr();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&wg(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function m1(t,e,n){return Ei&21?(vr(n,e)||(n=bx(),$t.lanes|=n,Si|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Ln=!0),t.memoizedState=n)}function RT(t,e){var n=xt;xt=n!==0&&4>n?n:4,t(!0);var r=Jf.transition;Jf.transition={};try{t(!1),e()}finally{xt=n,Jf.transition=r}}function y1(){return rr().memoizedState}function AT(t,e,n){var r=js(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},v1(t))_1(e,n);else if(n=Zx(t,e,n,r),n!==null){var s=In();mr(n,t,r,s),x1(n,e,r)}}function PT(t,e,n){var r=js(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(v1(t))_1(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,l=i(o,n);if(s.hasEagerState=!0,s.eagerState=l,vr(l,o)){var c=e.interleaved;c===null?(s.next=s,xg(e)):(s.next=c.next,c.next=s),e.interleaved=s;return}}catch{}finally{}n=Zx(t,e,s,r),n!==null&&(s=In(),mr(n,t,r,s),x1(n,e,r))}}function v1(t){var e=t.alternate;return t===$t||e!==null&&e===$t}function _1(t,e){Ua=Ld=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function x1(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,og(t,n)}}var Dd={readContext:nr,useCallback:hn,useContext:hn,useEffect:hn,useImperativeHandle:hn,useInsertionEffect:hn,useLayoutEffect:hn,useMemo:hn,useReducer:hn,useRef:hn,useState:hn,useDebugValue:hn,useDeferredValue:hn,useTransition:hn,useMutableSource:hn,useSyncExternalStore:hn,useId:hn,unstable_isNewReconciler:!1},OT={readContext:nr,useCallback:function(t,e){return Cr().memoizedState=[t,e===void 0?null:e],t},useContext:nr,useEffect:ky,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,qc(4194308,4,f1.bind(null,e,t),n)},useLayoutEffect:function(t,e){return qc(4194308,4,t,e)},useInsertionEffect:function(t,e){return qc(4,2,t,e)},useMemo:function(t,e){var n=Cr();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Cr();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=AT.bind(null,$t,t),[r.memoizedState,t]},useRef:function(t){var e=Cr();return t={current:t},e.memoizedState=t},useState:Cy,useDebugValue:Rg,useDeferredValue:function(t){return Cr().memoizedState=t},useTransition:function(){var t=Cy(!1),e=t[0];return t=RT.bind(null,t[1]),Cr().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=$t,s=Cr();if(Lt){if(n===void 0)throw Error(de(407));n=n()}else{if(n=e(),nn===null)throw Error(de(349));Ei&30||s1(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,ky(o1.bind(null,r,i,t),[t]),r.flags|=2048,ml(9,i1.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=Cr(),e=nn.identifierPrefix;if(Lt){var n=Vr,r=Gr;n=(r&~(1<<32-gr(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=pl++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=kT++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},LT={readContext:nr,useCallback:p1,useContext:nr,useEffect:kg,useImperativeHandle:h1,useInsertionEffect:d1,useLayoutEffect:u1,useMemo:g1,useReducer:qf,useRef:c1,useState:function(){return qf(gl)},useDebugValue:Rg,useDeferredValue:function(t){var e=rr();return m1(e,Kt.memoizedState,t)},useTransition:function(){var t=qf(gl)[0],e=rr().memoizedState;return[t,e]},useMutableSource:n1,useSyncExternalStore:r1,useId:y1,unstable_isNewReconciler:!1},DT={readContext:nr,useCallback:p1,useContext:nr,useEffect:kg,useImperativeHandle:h1,useInsertionEffect:d1,useLayoutEffect:u1,useMemo:g1,useReducer:Zf,useRef:c1,useState:function(){return Zf(gl)},useDebugValue:Rg,useDeferredValue:function(t){var e=rr();return Kt===null?e.memoizedState=t:m1(e,Kt.memoizedState,t)},useTransition:function(){var t=Zf(gl)[0],e=rr().memoizedState;return[t,e]},useMutableSource:n1,useSyncExternalStore:r1,useId:y1,unstable_isNewReconciler:!1};function lr(t,e){if(t&&t.defaultProps){e=Ft({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function qh(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:Ft({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var xu={isMounted:function(t){return(t=t._reactInternals)?Li(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=In(),s=js(t),i=Qr(r,s);i.payload=e,n!=null&&(i.callback=n),e=Ms(t,i,s),e!==null&&(mr(e,t,s,r),Qc(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=In(),s=js(t),i=Qr(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=Ms(t,i,s),e!==null&&(mr(e,t,s,r),Qc(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=In(),r=js(t),s=Qr(n,r);s.tag=2,e!=null&&(s.callback=e),e=Ms(t,s,r),e!==null&&(mr(e,t,r,n),Qc(e,t,r))}};function Ry(t,e,n,r,s,i,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!ll(n,r)||!ll(s,i):!0}function b1(t,e,n){var r=!1,s=Vs,i=e.contextType;return typeof i=="object"&&i!==null?i=nr(i):(s=Nn(e)?xi:yn.current,r=e.contextTypes,i=(r=r!=null)?Po(t,s):Vs),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=xu,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function Ay(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&xu.enqueueReplaceState(e,e.state,null)}function Zh(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},bg(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=nr(i):(i=Nn(e)?xi:yn.current,s.context=Po(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(qh(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&xu.enqueueReplaceState(s,s.state,null),Pd(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function Mo(t,e){try{var n="",r=e;do n+=lw(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function eh(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function ep(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var MT=typeof WeakMap=="function"?WeakMap:Map;function E1(t,e,n){n=Qr(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Nd||(Nd=!0,dp=r),ep(t,e)},n}function S1(t,e,n){n=Qr(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){ep(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){ep(t,e),typeof r!="function"&&(Ns===null?Ns=new Set([this]):Ns.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function Py(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new MT;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=XT.bind(null,t,e,n),e.then(t,t))}function Oy(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Ly(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Qr(-1,1),e.tag=2,Ms(n,e,1))),n.lanes|=1),t)}var NT=os.ReactCurrentOwner,Ln=!1;function En(t,e,n,r){e.child=t===null?qx(e,null,n,r):Lo(e,t.child,n,r)}function Dy(t,e,n,r,s){n=n.render;var i=e.ref;return bo(e,s),r=Tg(t,e,n,r,i,s),n=Cg(),t!==null&&!Ln?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,ns(t,e,s)):(Lt&&n&&pg(e),e.flags|=1,En(t,e,r,s),e.child)}function My(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!jg(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,I1(t,e,i,r,s)):(t=nd(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var o=i.memoizedProps;if(n=n.compare,n=n!==null?n:ll,n(o,r)&&t.ref===e.ref)return ns(t,e,s)}return e.flags|=1,t=$s(i,r),t.ref=e.ref,t.return=e,e.child=t}function I1(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(ll(i,r)&&t.ref===e.ref)if(Ln=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(Ln=!0);else return e.lanes=t.lanes,ns(t,e,s)}return tp(t,e,n,r,s)}function w1(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},kt(po,Un),Un|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,kt(po,Un),Un|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,kt(po,Un),Un|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,kt(po,Un),Un|=r;return En(t,e,s,n),e.child}function T1(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function tp(t,e,n,r,s){var i=Nn(n)?xi:yn.current;return i=Po(e,i),bo(e,s),n=Tg(t,e,n,r,i,s),r=Cg(),t!==null&&!Ln?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,ns(t,e,s)):(Lt&&r&&pg(e),e.flags|=1,En(t,e,n,s),e.child)}function Ny(t,e,n,r,s){if(Nn(n)){var i=!0;Td(e)}else i=!1;if(bo(e,s),e.stateNode===null)Zc(t,e),b1(e,n,r),Zh(e,n,r,s),r=!0;else if(t===null){var o=e.stateNode,l=e.memoizedProps;o.props=l;var c=o.context,d=n.contextType;typeof d=="object"&&d!==null?d=nr(d):(d=Nn(n)?xi:yn.current,d=Po(e,d));var u=n.getDerivedStateFromProps,h=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==r||c!==d)&&Ay(e,o,r,d),vs=!1;var f=e.memoizedState;o.state=f,Pd(e,r,o,s),c=e.memoizedState,l!==r||f!==c||Mn.current||vs?(typeof u=="function"&&(qh(e,n,u,r),c=e.memoizedState),(l=vs||Ry(e,n,l,r,f,c,d))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),o.props=r,o.state=c,o.context=d,r=l):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,e1(t,e),l=e.memoizedProps,d=e.type===e.elementType?l:lr(e.type,l),o.props=d,h=e.pendingProps,f=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=nr(c):(c=Nn(n)?xi:yn.current,c=Po(e,c));var S=n.getDerivedStateFromProps;(u=typeof S=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==h||f!==c)&&Ay(e,o,r,c),vs=!1,f=e.memoizedState,o.state=f,Pd(e,r,o,s);var k=e.memoizedState;l!==h||f!==k||Mn.current||vs?(typeof S=="function"&&(qh(e,n,S,r),k=e.memoizedState),(d=vs||Ry(e,n,d,r,f,k,c)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,k,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,k,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=k),o.props=r,o.state=k,o.context=c,r=d):(typeof o.componentDidUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),r=!1)}return np(t,e,n,r,i,s)}function np(t,e,n,r,s,i){T1(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&by(e,n,!1),ns(t,e,i);r=e.stateNode,NT.current=e;var l=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=Lo(e,t.child,null,i),e.child=Lo(e,null,l,i)):En(t,e,l,i),e.memoizedState=r.state,s&&by(e,n,!0),e.child}function C1(t){var e=t.stateNode;e.pendingContext?xy(t,e.pendingContext,e.pendingContext!==e.context):e.context&&xy(t,e.context,!1),Eg(t,e.containerInfo)}function jy(t,e,n,r,s){return Oo(),mg(s),e.flags|=256,En(t,e,n,r),e.child}var rp={dehydrated:null,treeContext:null,retryLane:0};function sp(t){return{baseLanes:t,cachePool:null,transitions:null}}function k1(t,e,n){var r=e.pendingProps,s=Mt.current,i=!1,o=(e.flags&128)!==0,l;if((l=o)||(l=t!==null&&t.memoizedState===null?!1:(s&2)!==0),l?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),kt(Mt,s&1),t===null)return Qh(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=Su(o,r,0,null),t=_i(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=sp(n),e.memoizedState=rp,t):Ag(e,o));if(s=t.memoizedState,s!==null&&(l=s.dehydrated,l!==null))return jT(t,e,o,r,l,s,n);if(i){i=r.fallback,o=e.mode,s=t.child,l=s.sibling;var c={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=$s(s,c),r.subtreeFlags=s.subtreeFlags&14680064),l!==null?i=$s(l,i):(i=_i(i,o,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=t.child.memoizedState,o=o===null?sp(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=t.childLanes&~n,e.memoizedState=rp,r}return i=t.child,t=i.sibling,r=$s(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function Ag(t,e){return e=Su({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Oc(t,e,n,r){return r!==null&&mg(r),Lo(e,t.child,null,n),t=Ag(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function jT(t,e,n,r,s,i,o){if(n)return e.flags&256?(e.flags&=-257,r=eh(Error(de(422))),Oc(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=Su({mode:"visible",children:r.children},s,0,null),i=_i(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&Lo(e,t.child,null,o),e.child.memoizedState=sp(o),e.memoizedState=rp,i);if(!(e.mode&1))return Oc(t,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var l=r.dgst;return r=l,i=Error(de(419)),r=eh(i,r,void 0),Oc(t,e,o,r)}if(l=(o&t.childLanes)!==0,Ln||l){if(r=nn,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,ts(t,s),mr(r,t,s,-1))}return Ng(),r=eh(Error(de(421))),Oc(t,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=QT.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,Bn=Ds(s.nextSibling),zn=e,Lt=!0,dr=null,t!==null&&(Xn[Qn++]=Gr,Xn[Qn++]=Vr,Xn[Qn++]=bi,Gr=t.id,Vr=t.overflow,bi=e),e=Ag(e,r.children),e.flags|=4096,e)}function $y(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),Jh(t.return,e,n)}function th(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function R1(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(En(t,e,r.children,n),r=Mt.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&$y(t,n,e);else if(t.tag===19)$y(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(kt(Mt,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&Od(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),th(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&Od(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}th(e,!0,n,null,i);break;case"together":th(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Zc(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function ns(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Si|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(de(153));if(e.child!==null){for(t=e.child,n=$s(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=$s(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function $T(t,e,n){switch(e.tag){case 3:C1(e),Oo();break;case 5:t1(e);break;case 1:Nn(e.type)&&Td(e);break;case 4:Eg(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;kt(Rd,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(kt(Mt,Mt.current&1),e.flags|=128,null):n&e.child.childLanes?k1(t,e,n):(kt(Mt,Mt.current&1),t=ns(t,e,n),t!==null?t.sibling:null);kt(Mt,Mt.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return R1(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),kt(Mt,Mt.current),r)break;return null;case 22:case 23:return e.lanes=0,w1(t,e,n)}return ns(t,e,n)}var A1,ip,P1,O1;A1=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};ip=function(){};P1=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,mi(Lr.current);var i=null;switch(n){case"input":s=Ch(t,s),r=Ch(t,r),i=[];break;case"select":s=Ft({},s,{value:void 0}),r=Ft({},r,{value:void 0}),i=[];break;case"textarea":s=Ah(t,s),r=Ah(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Id)}Oh(n,r);var o;n=null;for(d in s)if(!r.hasOwnProperty(d)&&s.hasOwnProperty(d)&&s[d]!=null)if(d==="style"){var l=s[d];for(o in l)l.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(tl.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in r){var c=r[d];if(l=s!=null?s[d]:void 0,r.hasOwnProperty(d)&&c!==l&&(c!=null||l!=null))if(d==="style")if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(i||(i=[]),i.push(d,n)),n=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(i=i||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(tl.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&Rt("scroll",t),i||l===c||(i=[])):(i=i||[]).push(d,c))}n&&(i=i||[]).push("style",n);var d=i;(e.updateQueue=d)&&(e.flags|=4)}};O1=function(t,e,n,r){n!==r&&(e.flags|=4)};function xa(t,e){if(!Lt)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function pn(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function FT(t,e,n){var r=e.pendingProps;switch(gg(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return pn(e),null;case 1:return Nn(e.type)&&wd(),pn(e),null;case 3:return r=e.stateNode,Do(),At(Mn),At(yn),Ig(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(Ac(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,dr!==null&&(hp(dr),dr=null))),ip(t,e),pn(e),null;case 5:Sg(e);var s=mi(hl.current);if(n=e.type,t!==null&&e.stateNode!=null)P1(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(de(166));return pn(e),null}if(t=mi(Lr.current),Ac(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[kr]=e,r[ul]=i,t=(e.mode&1)!==0,n){case"dialog":Rt("cancel",r),Rt("close",r);break;case"iframe":case"object":case"embed":Rt("load",r);break;case"video":case"audio":for(s=0;s<Pa.length;s++)Rt(Pa[s],r);break;case"source":Rt("error",r);break;case"img":case"image":case"link":Rt("error",r),Rt("load",r);break;case"details":Rt("toggle",r);break;case"input":Ym(r,i),Rt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Rt("invalid",r);break;case"textarea":Xm(r,i),Rt("invalid",r)}Oh(n,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var l=i[o];o==="children"?typeof l=="string"?r.textContent!==l&&(i.suppressHydrationWarning!==!0&&Rc(r.textContent,l,t),s=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(i.suppressHydrationWarning!==!0&&Rc(r.textContent,l,t),s=["children",""+l]):tl.hasOwnProperty(o)&&l!=null&&o==="onScroll"&&Rt("scroll",r)}switch(n){case"input":bc(r),Km(r,i,!0);break;case"textarea":bc(r),Qm(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=Id)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=ox(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[kr]=e,t[ul]=r,A1(t,e,!1,!1),e.stateNode=t;e:{switch(o=Lh(n,r),n){case"dialog":Rt("cancel",t),Rt("close",t),s=r;break;case"iframe":case"object":case"embed":Rt("load",t),s=r;break;case"video":case"audio":for(s=0;s<Pa.length;s++)Rt(Pa[s],t);s=r;break;case"source":Rt("error",t),s=r;break;case"img":case"image":case"link":Rt("error",t),Rt("load",t),s=r;break;case"details":Rt("toggle",t),s=r;break;case"input":Ym(t,r),s=Ch(t,r),Rt("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=Ft({},r,{value:void 0}),Rt("invalid",t);break;case"textarea":Xm(t,r),s=Ah(t,r),Rt("invalid",t);break;default:s=r}Oh(n,s),l=s;for(i in l)if(l.hasOwnProperty(i)){var c=l[i];i==="style"?cx(t,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&ax(t,c)):i==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&nl(t,c):typeof c=="number"&&nl(t,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(tl.hasOwnProperty(i)?c!=null&&i==="onScroll"&&Rt("scroll",t):c!=null&&eg(t,i,c,o))}switch(n){case"input":bc(t),Km(t,r,!1);break;case"textarea":bc(t),Qm(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Gs(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?yo(t,!!r.multiple,i,!1):r.defaultValue!=null&&yo(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=Id)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return pn(e),null;case 6:if(t&&e.stateNode!=null)O1(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(de(166));if(n=mi(hl.current),mi(Lr.current),Ac(e)){if(r=e.stateNode,n=e.memoizedProps,r[kr]=e,(i=r.nodeValue!==n)&&(t=zn,t!==null))switch(t.tag){case 3:Rc(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Rc(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[kr]=e,e.stateNode=r}return pn(e),null;case 13:if(At(Mt),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Lt&&Bn!==null&&e.mode&1&&!(e.flags&128))Qx(),Oo(),e.flags|=98560,i=!1;else if(i=Ac(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(de(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(de(317));i[kr]=e}else Oo(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;pn(e),i=!1}else dr!==null&&(hp(dr),dr=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||Mt.current&1?Qt===0&&(Qt=3):Ng())),e.updateQueue!==null&&(e.flags|=4),pn(e),null);case 4:return Do(),ip(t,e),t===null&&cl(e.stateNode.containerInfo),pn(e),null;case 10:return _g(e.type._context),pn(e),null;case 17:return Nn(e.type)&&wd(),pn(e),null;case 19:if(At(Mt),i=e.memoizedState,i===null)return pn(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)xa(i,!1);else{if(Qt!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=Od(t),o!==null){for(e.flags|=128,xa(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,t=o.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return kt(Mt,Mt.current&1|2),e.child}t=t.sibling}i.tail!==null&&zt()>No&&(e.flags|=128,r=!0,xa(i,!1),e.lanes=4194304)}else{if(!r)if(t=Od(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),xa(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!Lt)return pn(e),null}else 2*zt()-i.renderingStartTime>No&&n!==1073741824&&(e.flags|=128,r=!0,xa(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(n=i.last,n!==null?n.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=zt(),e.sibling=null,n=Mt.current,kt(Mt,r?n&1|2:n&1),e):(pn(e),null);case 22:case 23:return Mg(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Un&1073741824&&(pn(e),e.subtreeFlags&6&&(e.flags|=8192)):pn(e),null;case 24:return null;case 25:return null}throw Error(de(156,e.tag))}function UT(t,e){switch(gg(e),e.tag){case 1:return Nn(e.type)&&wd(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Do(),At(Mn),At(yn),Ig(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Sg(e),null;case 13:if(At(Mt),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(de(340));Oo()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return At(Mt),null;case 4:return Do(),null;case 10:return _g(e.type._context),null;case 22:case 23:return Mg(),null;case 24:return null;default:return null}}var Lc=!1,mn=!1,BT=typeof WeakSet=="function"?WeakSet:Set,Se=null;function ho(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){Ut(t,e,r)}else n.current=null}function op(t,e,n){try{n()}catch(r){Ut(t,e,r)}}var Fy=!1;function zT(t,e){if(Hh=bd,t=jx(),hg(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var o=0,l=-1,c=-1,d=0,u=0,h=t,f=null;t:for(;;){for(var S;h!==n||s!==0&&h.nodeType!==3||(l=o+s),h!==i||r!==0&&h.nodeType!==3||(c=o+r),h.nodeType===3&&(o+=h.nodeValue.length),(S=h.firstChild)!==null;)f=h,h=S;for(;;){if(h===t)break t;if(f===n&&++d===s&&(l=o),f===i&&++u===r&&(c=o),(S=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=S}n=l===-1||c===-1?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Wh={focusedElem:t,selectionRange:n},bd=!1,Se=e;Se!==null;)if(e=Se,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Se=t;else for(;Se!==null;){e=Se;try{var k=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(k!==null){var w=k.memoizedProps,j=k.memoizedState,_=e.stateNode,x=_.getSnapshotBeforeUpdate(e.elementType===e.type?w:lr(e.type,w),j);_.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var I=e.stateNode.containerInfo;I.nodeType===1?I.textContent="":I.nodeType===9&&I.documentElement&&I.removeChild(I.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(de(163))}}catch(p){Ut(e,e.return,p)}if(t=e.sibling,t!==null){t.return=e.return,Se=t;break}Se=e.return}return k=Fy,Fy=!1,k}function Ba(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&op(e,n,i)}s=s.next}while(s!==r)}}function bu(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function ap(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function L1(t){var e=t.alternate;e!==null&&(t.alternate=null,L1(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[kr],delete e[ul],delete e[Yh],delete e[IT],delete e[wT])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function D1(t){return t.tag===5||t.tag===3||t.tag===4}function Uy(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||D1(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function lp(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Id));else if(r!==4&&(t=t.child,t!==null))for(lp(t,e,n),t=t.sibling;t!==null;)lp(t,e,n),t=t.sibling}function cp(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(cp(t,e,n),t=t.sibling;t!==null;)cp(t,e,n),t=t.sibling}var ln=null,cr=!1;function gs(t,e,n){for(n=n.child;n!==null;)M1(t,e,n),n=n.sibling}function M1(t,e,n){if(Or&&typeof Or.onCommitFiberUnmount=="function")try{Or.onCommitFiberUnmount(hu,n)}catch{}switch(n.tag){case 5:mn||ho(n,e);case 6:var r=ln,s=cr;ln=null,gs(t,e,n),ln=r,cr=s,ln!==null&&(cr?(t=ln,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):ln.removeChild(n.stateNode));break;case 18:ln!==null&&(cr?(t=ln,n=n.stateNode,t.nodeType===8?Kf(t.parentNode,n):t.nodeType===1&&Kf(t,n),ol(t)):Kf(ln,n.stateNode));break;case 4:r=ln,s=cr,ln=n.stateNode.containerInfo,cr=!0,gs(t,e,n),ln=r,cr=s;break;case 0:case 11:case 14:case 15:if(!mn&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&op(n,e,o),s=s.next}while(s!==r)}gs(t,e,n);break;case 1:if(!mn&&(ho(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(l){Ut(n,e,l)}gs(t,e,n);break;case 21:gs(t,e,n);break;case 22:n.mode&1?(mn=(r=mn)||n.memoizedState!==null,gs(t,e,n),mn=r):gs(t,e,n);break;default:gs(t,e,n)}}function By(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new BT),e.forEach(function(r){var s=JT.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function ar(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,o=e,l=o;e:for(;l!==null;){switch(l.tag){case 5:ln=l.stateNode,cr=!1;break e;case 3:ln=l.stateNode.containerInfo,cr=!0;break e;case 4:ln=l.stateNode.containerInfo,cr=!0;break e}l=l.return}if(ln===null)throw Error(de(160));M1(i,o,s),ln=null,cr=!1;var c=s.alternate;c!==null&&(c.return=null),s.return=null}catch(d){Ut(s,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)N1(e,t),e=e.sibling}function N1(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(ar(e,t),Tr(t),r&4){try{Ba(3,t,t.return),bu(3,t)}catch(w){Ut(t,t.return,w)}try{Ba(5,t,t.return)}catch(w){Ut(t,t.return,w)}}break;case 1:ar(e,t),Tr(t),r&512&&n!==null&&ho(n,n.return);break;case 5:if(ar(e,t),Tr(t),r&512&&n!==null&&ho(n,n.return),t.flags&32){var s=t.stateNode;try{nl(s,"")}catch(w){Ut(t,t.return,w)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,o=n!==null?n.memoizedProps:i,l=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{l==="input"&&i.type==="radio"&&i.name!=null&&sx(s,i),Lh(l,o);var d=Lh(l,i);for(o=0;o<c.length;o+=2){var u=c[o],h=c[o+1];u==="style"?cx(s,h):u==="dangerouslySetInnerHTML"?ax(s,h):u==="children"?nl(s,h):eg(s,u,h,d)}switch(l){case"input":kh(s,i);break;case"textarea":ix(s,i);break;case"select":var f=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var S=i.value;S!=null?yo(s,!!i.multiple,S,!1):f!==!!i.multiple&&(i.defaultValue!=null?yo(s,!!i.multiple,i.defaultValue,!0):yo(s,!!i.multiple,i.multiple?[]:"",!1))}s[ul]=i}catch(w){Ut(t,t.return,w)}}break;case 6:if(ar(e,t),Tr(t),r&4){if(t.stateNode===null)throw Error(de(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(w){Ut(t,t.return,w)}}break;case 3:if(ar(e,t),Tr(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{ol(e.containerInfo)}catch(w){Ut(t,t.return,w)}break;case 4:ar(e,t),Tr(t);break;case 13:ar(e,t),Tr(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(Lg=zt())),r&4&&By(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(mn=(d=mn)||u,ar(e,t),mn=d):ar(e,t),Tr(t),r&8192){if(d=t.memoizedState!==null,(t.stateNode.isHidden=d)&&!u&&t.mode&1)for(Se=t,u=t.child;u!==null;){for(h=Se=u;Se!==null;){switch(f=Se,S=f.child,f.tag){case 0:case 11:case 14:case 15:Ba(4,f,f.return);break;case 1:ho(f,f.return);var k=f.stateNode;if(typeof k.componentWillUnmount=="function"){r=f,n=f.return;try{e=r,k.props=e.memoizedProps,k.state=e.memoizedState,k.componentWillUnmount()}catch(w){Ut(r,n,w)}}break;case 5:ho(f,f.return);break;case 22:if(f.memoizedState!==null){Hy(h);continue}}S!==null?(S.return=f,Se=S):Hy(h)}u=u.sibling}e:for(u=null,h=t;;){if(h.tag===5){if(u===null){u=h;try{s=h.stateNode,d?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(l=h.stateNode,c=h.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=lx("display",o))}catch(w){Ut(t,t.return,w)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=d?"":h.memoizedProps}catch(w){Ut(t,t.return,w)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===t)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===t)break e;for(;h.sibling===null;){if(h.return===null||h.return===t)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:ar(e,t),Tr(t),r&4&&By(t);break;case 21:break;default:ar(e,t),Tr(t)}}function Tr(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(D1(n)){var r=n;break e}n=n.return}throw Error(de(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(nl(s,""),r.flags&=-33);var i=Uy(t);cp(t,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,l=Uy(t);lp(t,l,o);break;default:throw Error(de(161))}}catch(c){Ut(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function HT(t,e,n){Se=t,j1(t)}function j1(t,e,n){for(var r=(t.mode&1)!==0;Se!==null;){var s=Se,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||Lc;if(!o){var l=s.alternate,c=l!==null&&l.memoizedState!==null||mn;l=Lc;var d=mn;if(Lc=o,(mn=c)&&!d)for(Se=s;Se!==null;)o=Se,c=o.child,o.tag===22&&o.memoizedState!==null?Wy(s):c!==null?(c.return=o,Se=c):Wy(s);for(;i!==null;)Se=i,j1(i),i=i.sibling;Se=s,Lc=l,mn=d}zy(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,Se=i):zy(t)}}function zy(t){for(;Se!==null;){var e=Se;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:mn||bu(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!mn)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:lr(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&Ty(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Ty(e,o,n)}break;case 5:var l=e.stateNode;if(n===null&&e.flags&4){n=l;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var u=d.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&ol(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(de(163))}mn||e.flags&512&&ap(e)}catch(f){Ut(e,e.return,f)}}if(e===t){Se=null;break}if(n=e.sibling,n!==null){n.return=e.return,Se=n;break}Se=e.return}}function Hy(t){for(;Se!==null;){var e=Se;if(e===t){Se=null;break}var n=e.sibling;if(n!==null){n.return=e.return,Se=n;break}Se=e.return}}function Wy(t){for(;Se!==null;){var e=Se;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{bu(4,e)}catch(c){Ut(e,n,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(c){Ut(e,s,c)}}var i=e.return;try{ap(e)}catch(c){Ut(e,i,c)}break;case 5:var o=e.return;try{ap(e)}catch(c){Ut(e,o,c)}}}catch(c){Ut(e,e.return,c)}if(e===t){Se=null;break}var l=e.sibling;if(l!==null){l.return=e.return,Se=l;break}Se=e.return}}var WT=Math.ceil,Md=os.ReactCurrentDispatcher,Pg=os.ReactCurrentOwner,tr=os.ReactCurrentBatchConfig,ht=0,nn=null,Gt=null,cn=0,Un=0,po=Zs(0),Qt=0,yl=null,Si=0,Eu=0,Og=0,za=null,On=null,Lg=0,No=1/0,zr=null,Nd=!1,dp=null,Ns=null,Dc=!1,Cs=null,jd=0,Ha=0,up=null,ed=-1,td=0;function In(){return ht&6?zt():ed!==-1?ed:ed=zt()}function js(t){return t.mode&1?ht&2&&cn!==0?cn&-cn:CT.transition!==null?(td===0&&(td=bx()),td):(t=xt,t!==0||(t=window.event,t=t===void 0?16:kx(t.type)),t):1}function mr(t,e,n,r){if(50<Ha)throw Ha=0,up=null,Error(de(185));Ll(t,n,r),(!(ht&2)||t!==nn)&&(t===nn&&(!(ht&2)&&(Eu|=n),Qt===4&&xs(t,cn)),jn(t,r),n===1&&ht===0&&!(e.mode&1)&&(No=zt()+500,vu&&ei()))}function jn(t,e){var n=t.callbackNode;Cw(t,e);var r=xd(t,t===nn?cn:0);if(r===0)n!==null&&Zm(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&Zm(n),e===1)t.tag===0?TT(Gy.bind(null,t)):Yx(Gy.bind(null,t)),ET(function(){!(ht&6)&&ei()}),n=null;else{switch(Ex(r)){case 1:n=ig;break;case 4:n=_x;break;case 16:n=_d;break;case 536870912:n=xx;break;default:n=_d}n=G1(n,$1.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function $1(t,e){if(ed=-1,td=0,ht&6)throw Error(de(327));var n=t.callbackNode;if(Eo()&&t.callbackNode!==n)return null;var r=xd(t,t===nn?cn:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=$d(t,r);else{e=r;var s=ht;ht|=2;var i=U1();(nn!==t||cn!==e)&&(zr=null,No=zt()+500,vi(t,e));do try{YT();break}catch(l){F1(t,l)}while(!0);vg(),Md.current=i,ht=s,Gt!==null?e=0:(nn=null,cn=0,e=Qt)}if(e!==0){if(e===2&&(s=$h(t),s!==0&&(r=s,e=fp(t,s))),e===1)throw n=yl,vi(t,0),xs(t,r),jn(t,zt()),n;if(e===6)xs(t,r);else{if(s=t.current.alternate,!(r&30)&&!GT(s)&&(e=$d(t,r),e===2&&(i=$h(t),i!==0&&(r=i,e=fp(t,i))),e===1))throw n=yl,vi(t,0),xs(t,r),jn(t,zt()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(de(345));case 2:di(t,On,zr);break;case 3:if(xs(t,r),(r&130023424)===r&&(e=Lg+500-zt(),10<e)){if(xd(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){In(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=Vh(di.bind(null,t,On,zr),e);break}di(t,On,zr);break;case 4:if(xs(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var o=31-gr(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=zt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*WT(r/1960))-r,10<r){t.timeoutHandle=Vh(di.bind(null,t,On,zr),r);break}di(t,On,zr);break;case 5:di(t,On,zr);break;default:throw Error(de(329))}}}return jn(t,zt()),t.callbackNode===n?$1.bind(null,t):null}function fp(t,e){var n=za;return t.current.memoizedState.isDehydrated&&(vi(t,e).flags|=256),t=$d(t,e),t!==2&&(e=On,On=n,e!==null&&hp(e)),t}function hp(t){On===null?On=t:On.push.apply(On,t)}function GT(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!vr(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function xs(t,e){for(e&=~Og,e&=~Eu,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-gr(e),r=1<<n;t[n]=-1,e&=~r}}function Gy(t){if(ht&6)throw Error(de(327));Eo();var e=xd(t,0);if(!(e&1))return jn(t,zt()),null;var n=$d(t,e);if(t.tag!==0&&n===2){var r=$h(t);r!==0&&(e=r,n=fp(t,r))}if(n===1)throw n=yl,vi(t,0),xs(t,e),jn(t,zt()),n;if(n===6)throw Error(de(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,di(t,On,zr),jn(t,zt()),null}function Dg(t,e){var n=ht;ht|=1;try{return t(e)}finally{ht=n,ht===0&&(No=zt()+500,vu&&ei())}}function Ii(t){Cs!==null&&Cs.tag===0&&!(ht&6)&&Eo();var e=ht;ht|=1;var n=tr.transition,r=xt;try{if(tr.transition=null,xt=1,t)return t()}finally{xt=r,tr.transition=n,ht=e,!(ht&6)&&ei()}}function Mg(){Un=po.current,At(po)}function vi(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,bT(n)),Gt!==null)for(n=Gt.return;n!==null;){var r=n;switch(gg(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&wd();break;case 3:Do(),At(Mn),At(yn),Ig();break;case 5:Sg(r);break;case 4:Do();break;case 13:At(Mt);break;case 19:At(Mt);break;case 10:_g(r.type._context);break;case 22:case 23:Mg()}n=n.return}if(nn=t,Gt=t=$s(t.current,null),cn=Un=e,Qt=0,yl=null,Og=Eu=Si=0,On=za=null,gi!==null){for(e=0;e<gi.length;e++)if(n=gi[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}n.pending=r}gi=null}return t}function F1(t,e){do{var n=Gt;try{if(vg(),Jc.current=Dd,Ld){for(var r=$t.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Ld=!1}if(Ei=0,Zt=Kt=$t=null,Ua=!1,pl=0,Pg.current=null,n===null||n.return===null){Qt=1,yl=e,Gt=null;break}e:{var i=t,o=n.return,l=n,c=e;if(e=cn,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,u=l,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var f=u.alternate;f?(u.updateQueue=f.updateQueue,u.memoizedState=f.memoizedState,u.lanes=f.lanes):(u.updateQueue=null,u.memoizedState=null)}var S=Oy(o);if(S!==null){S.flags&=-257,Ly(S,o,l,i,e),S.mode&1&&Py(i,d,e),e=S,c=d;var k=e.updateQueue;if(k===null){var w=new Set;w.add(c),e.updateQueue=w}else k.add(c);break e}else{if(!(e&1)){Py(i,d,e),Ng();break e}c=Error(de(426))}}else if(Lt&&l.mode&1){var j=Oy(o);if(j!==null){!(j.flags&65536)&&(j.flags|=256),Ly(j,o,l,i,e),mg(Mo(c,l));break e}}i=c=Mo(c,l),Qt!==4&&(Qt=2),za===null?za=[i]:za.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var _=E1(i,c,e);wy(i,_);break e;case 1:l=c;var x=i.type,I=i.stateNode;if(!(i.flags&128)&&(typeof x.getDerivedStateFromError=="function"||I!==null&&typeof I.componentDidCatch=="function"&&(Ns===null||!Ns.has(I)))){i.flags|=65536,e&=-e,i.lanes|=e;var p=S1(i,l,e);wy(i,p);break e}}i=i.return}while(i!==null)}z1(n)}catch(D){e=D,Gt===n&&n!==null&&(Gt=n=n.return);continue}break}while(!0)}function U1(){var t=Md.current;return Md.current=Dd,t===null?Dd:t}function Ng(){(Qt===0||Qt===3||Qt===2)&&(Qt=4),nn===null||!(Si&268435455)&&!(Eu&268435455)||xs(nn,cn)}function $d(t,e){var n=ht;ht|=2;var r=U1();(nn!==t||cn!==e)&&(zr=null,vi(t,e));do try{VT();break}catch(s){F1(t,s)}while(!0);if(vg(),ht=n,Md.current=r,Gt!==null)throw Error(de(261));return nn=null,cn=0,Qt}function VT(){for(;Gt!==null;)B1(Gt)}function YT(){for(;Gt!==null&&!vw();)B1(Gt)}function B1(t){var e=W1(t.alternate,t,Un);t.memoizedProps=t.pendingProps,e===null?z1(t):Gt=e,Pg.current=null}function z1(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=UT(n,e),n!==null){n.flags&=32767,Gt=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Qt=6,Gt=null;return}}else if(n=FT(n,e,Un),n!==null){Gt=n;return}if(e=e.sibling,e!==null){Gt=e;return}Gt=e=t}while(e!==null);Qt===0&&(Qt=5)}function di(t,e,n){var r=xt,s=tr.transition;try{tr.transition=null,xt=1,KT(t,e,n,r)}finally{tr.transition=s,xt=r}return null}function KT(t,e,n,r){do Eo();while(Cs!==null);if(ht&6)throw Error(de(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(de(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(kw(t,i),t===nn&&(Gt=nn=null,cn=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Dc||(Dc=!0,G1(_d,function(){return Eo(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=tr.transition,tr.transition=null;var o=xt;xt=1;var l=ht;ht|=4,Pg.current=null,zT(t,n),N1(n,t),pT(Wh),bd=!!Hh,Wh=Hh=null,t.current=n,HT(n),_w(),ht=l,xt=o,tr.transition=i}else t.current=n;if(Dc&&(Dc=!1,Cs=t,jd=s),i=t.pendingLanes,i===0&&(Ns=null),Ew(n.stateNode),jn(t,zt()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(Nd)throw Nd=!1,t=dp,dp=null,t;return jd&1&&t.tag!==0&&Eo(),i=t.pendingLanes,i&1?t===up?Ha++:(Ha=0,up=t):Ha=0,ei(),null}function Eo(){if(Cs!==null){var t=Ex(jd),e=tr.transition,n=xt;try{if(tr.transition=null,xt=16>t?16:t,Cs===null)var r=!1;else{if(t=Cs,Cs=null,jd=0,ht&6)throw Error(de(331));var s=ht;for(ht|=4,Se=t.current;Se!==null;){var i=Se,o=i.child;if(Se.flags&16){var l=i.deletions;if(l!==null){for(var c=0;c<l.length;c++){var d=l[c];for(Se=d;Se!==null;){var u=Se;switch(u.tag){case 0:case 11:case 15:Ba(8,u,i)}var h=u.child;if(h!==null)h.return=u,Se=h;else for(;Se!==null;){u=Se;var f=u.sibling,S=u.return;if(L1(u),u===d){Se=null;break}if(f!==null){f.return=S,Se=f;break}Se=S}}}var k=i.alternate;if(k!==null){var w=k.child;if(w!==null){k.child=null;do{var j=w.sibling;w.sibling=null,w=j}while(w!==null)}}Se=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,Se=o;else e:for(;Se!==null;){if(i=Se,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Ba(9,i,i.return)}var _=i.sibling;if(_!==null){_.return=i.return,Se=_;break e}Se=i.return}}var x=t.current;for(Se=x;Se!==null;){o=Se;var I=o.child;if(o.subtreeFlags&2064&&I!==null)I.return=o,Se=I;else e:for(o=x;Se!==null;){if(l=Se,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:bu(9,l)}}catch(D){Ut(l,l.return,D)}if(l===o){Se=null;break e}var p=l.sibling;if(p!==null){p.return=l.return,Se=p;break e}Se=l.return}}if(ht=s,ei(),Or&&typeof Or.onPostCommitFiberRoot=="function")try{Or.onPostCommitFiberRoot(hu,t)}catch{}r=!0}return r}finally{xt=n,tr.transition=e}}return!1}function Vy(t,e,n){e=Mo(n,e),e=E1(t,e,1),t=Ms(t,e,1),e=In(),t!==null&&(Ll(t,1,e),jn(t,e))}function Ut(t,e,n){if(t.tag===3)Vy(t,t,n);else for(;e!==null;){if(e.tag===3){Vy(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Ns===null||!Ns.has(r))){t=Mo(n,t),t=S1(e,t,1),e=Ms(e,t,1),t=In(),e!==null&&(Ll(e,1,t),jn(e,t));break}}e=e.return}}function XT(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=In(),t.pingedLanes|=t.suspendedLanes&n,nn===t&&(cn&n)===n&&(Qt===4||Qt===3&&(cn&130023424)===cn&&500>zt()-Lg?vi(t,0):Og|=n),jn(t,e)}function H1(t,e){e===0&&(t.mode&1?(e=Ic,Ic<<=1,!(Ic&130023424)&&(Ic=4194304)):e=1);var n=In();t=ts(t,e),t!==null&&(Ll(t,e,n),jn(t,n))}function QT(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),H1(t,n)}function JT(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(de(314))}r!==null&&r.delete(e),H1(t,n)}var W1;W1=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Mn.current)Ln=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Ln=!1,$T(t,e,n);Ln=!!(t.flags&131072)}else Ln=!1,Lt&&e.flags&1048576&&Kx(e,kd,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Zc(t,e),t=e.pendingProps;var s=Po(e,yn.current);bo(e,n),s=Tg(null,e,r,t,s,n);var i=Cg();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Nn(r)?(i=!0,Td(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,bg(e),s.updater=xu,e.stateNode=s,s._reactInternals=e,Zh(e,r,t,n),e=np(null,e,r,!0,i,n)):(e.tag=0,Lt&&i&&pg(e),En(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(Zc(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=ZT(r),t=lr(r,t),s){case 0:e=tp(null,e,r,t,n);break e;case 1:e=Ny(null,e,r,t,n);break e;case 11:e=Dy(null,e,r,t,n);break e;case 14:e=My(null,e,r,lr(r.type,t),n);break e}throw Error(de(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:lr(r,s),tp(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:lr(r,s),Ny(t,e,r,s,n);case 3:e:{if(C1(e),t===null)throw Error(de(387));r=e.pendingProps,i=e.memoizedState,s=i.element,e1(t,e),Pd(e,r,null,n);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=Mo(Error(de(423)),e),e=jy(t,e,r,n,s);break e}else if(r!==s){s=Mo(Error(de(424)),e),e=jy(t,e,r,n,s);break e}else for(Bn=Ds(e.stateNode.containerInfo.firstChild),zn=e,Lt=!0,dr=null,n=qx(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Oo(),r===s){e=ns(t,e,n);break e}En(t,e,r,n)}e=e.child}return e;case 5:return t1(e),t===null&&Qh(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,o=s.children,Gh(r,s)?o=null:i!==null&&Gh(r,i)&&(e.flags|=32),T1(t,e),En(t,e,o,n),e.child;case 6:return t===null&&Qh(e),null;case 13:return k1(t,e,n);case 4:return Eg(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Lo(e,null,r,n):En(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:lr(r,s),Dy(t,e,r,s,n);case 7:return En(t,e,e.pendingProps,n),e.child;case 8:return En(t,e,e.pendingProps.children,n),e.child;case 12:return En(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,kt(Rd,r._currentValue),r._currentValue=o,i!==null)if(vr(i.value,o)){if(i.children===s.children&&!Mn.current){e=ns(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var l=i.dependencies;if(l!==null){o=i.child;for(var c=l.firstContext;c!==null;){if(c.context===r){if(i.tag===1){c=Qr(-1,n&-n),c.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var u=d.pending;u===null?c.next=c:(c.next=u.next,u.next=c),d.pending=c}}i.lanes|=n,c=i.alternate,c!==null&&(c.lanes|=n),Jh(i.return,n,e),l.lanes|=n;break}c=c.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(de(341));o.lanes|=n,l=o.alternate,l!==null&&(l.lanes|=n),Jh(o,n,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}En(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,bo(e,n),s=nr(s),r=r(s),e.flags|=1,En(t,e,r,n),e.child;case 14:return r=e.type,s=lr(r,e.pendingProps),s=lr(r.type,s),My(t,e,r,s,n);case 15:return I1(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:lr(r,s),Zc(t,e),e.tag=1,Nn(r)?(t=!0,Td(e)):t=!1,bo(e,n),b1(e,r,s),Zh(e,r,s,n),np(null,e,r,!0,t,n);case 19:return R1(t,e,n);case 22:return w1(t,e,n)}throw Error(de(156,e.tag))};function G1(t,e){return vx(t,e)}function qT(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Zn(t,e,n,r){return new qT(t,e,n,r)}function jg(t){return t=t.prototype,!(!t||!t.isReactComponent)}function ZT(t){if(typeof t=="function")return jg(t)?1:0;if(t!=null){if(t=t.$$typeof,t===ng)return 11;if(t===rg)return 14}return 2}function $s(t,e){var n=t.alternate;return n===null?(n=Zn(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function nd(t,e,n,r,s,i){var o=2;if(r=t,typeof t=="function")jg(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case ro:return _i(n.children,s,i,e);case tg:o=8,s|=8;break;case Sh:return t=Zn(12,n,e,s|2),t.elementType=Sh,t.lanes=i,t;case Ih:return t=Zn(13,n,e,s),t.elementType=Ih,t.lanes=i,t;case wh:return t=Zn(19,n,e,s),t.elementType=wh,t.lanes=i,t;case tx:return Su(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Z_:o=10;break e;case ex:o=9;break e;case ng:o=11;break e;case rg:o=14;break e;case ys:o=16,r=null;break e}throw Error(de(130,t==null?t:typeof t,""))}return e=Zn(o,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function _i(t,e,n,r){return t=Zn(7,t,r,e),t.lanes=n,t}function Su(t,e,n,r){return t=Zn(22,t,r,e),t.elementType=tx,t.lanes=n,t.stateNode={isHidden:!1},t}function nh(t,e,n){return t=Zn(6,t,null,e),t.lanes=n,t}function rh(t,e,n){return e=Zn(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function e2(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=jf(0),this.expirationTimes=jf(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=jf(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function $g(t,e,n,r,s,i,o,l,c){return t=new e2(t,e,n,l,c),e===1?(e=1,i===!0&&(e|=8)):e=0,i=Zn(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},bg(i),t}function t2(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:no,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function V1(t){if(!t)return Vs;t=t._reactInternals;e:{if(Li(t)!==t||t.tag!==1)throw Error(de(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Nn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(de(171))}if(t.tag===1){var n=t.type;if(Nn(n))return Vx(t,n,e)}return e}function Y1(t,e,n,r,s,i,o,l,c){return t=$g(n,r,!0,t,s,i,o,l,c),t.context=V1(null),n=t.current,r=In(),s=js(n),i=Qr(r,s),i.callback=e??null,Ms(n,i,s),t.current.lanes=s,Ll(t,s,r),jn(t,r),t}function Iu(t,e,n,r){var s=e.current,i=In(),o=js(s);return n=V1(n),e.context===null?e.context=n:e.pendingContext=n,e=Qr(i,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Ms(s,e,o),t!==null&&(mr(t,s,o,i),Qc(t,s,o)),o}function Fd(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Yy(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Fg(t,e){Yy(t,e),(t=t.alternate)&&Yy(t,e)}function n2(){return null}var K1=typeof reportError=="function"?reportError:function(t){console.error(t)};function Ug(t){this._internalRoot=t}wu.prototype.render=Ug.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(de(409));Iu(t,e,null,null)};wu.prototype.unmount=Ug.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Ii(function(){Iu(null,t,null,null)}),e[es]=null}};function wu(t){this._internalRoot=t}wu.prototype.unstable_scheduleHydration=function(t){if(t){var e=wx();t={blockedOn:null,target:t,priority:e};for(var n=0;n<_s.length&&e!==0&&e<_s[n].priority;n++);_s.splice(n,0,t),n===0&&Cx(t)}};function Bg(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Tu(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Ky(){}function r2(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var d=Fd(o);i.call(d)}}var o=Y1(e,r,t,0,null,!1,!1,"",Ky);return t._reactRootContainer=o,t[es]=o.current,cl(t.nodeType===8?t.parentNode:t),Ii(),o}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var l=r;r=function(){var d=Fd(c);l.call(d)}}var c=$g(t,0,!1,null,null,!1,!1,"",Ky);return t._reactRootContainer=c,t[es]=c.current,cl(t.nodeType===8?t.parentNode:t),Ii(function(){Iu(e,c,n,r)}),c}function Cu(t,e,n,r,s){var i=n._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var l=s;s=function(){var c=Fd(o);l.call(c)}}Iu(e,o,t,s)}else o=r2(n,e,t,s,r);return Fd(o)}Sx=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Aa(e.pendingLanes);n!==0&&(og(e,n|1),jn(e,zt()),!(ht&6)&&(No=zt()+500,ei()))}break;case 13:Ii(function(){var r=ts(t,1);if(r!==null){var s=In();mr(r,t,1,s)}}),Fg(t,1)}};ag=function(t){if(t.tag===13){var e=ts(t,134217728);if(e!==null){var n=In();mr(e,t,134217728,n)}Fg(t,134217728)}};Ix=function(t){if(t.tag===13){var e=js(t),n=ts(t,e);if(n!==null){var r=In();mr(n,t,e,r)}Fg(t,e)}};wx=function(){return xt};Tx=function(t,e){var n=xt;try{return xt=t,e()}finally{xt=n}};Mh=function(t,e,n){switch(e){case"input":if(kh(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=yu(r);if(!s)throw Error(de(90));rx(r),kh(r,s)}}}break;case"textarea":ix(t,n);break;case"select":e=n.value,e!=null&&yo(t,!!n.multiple,e,!1)}};fx=Dg;hx=Ii;var s2={usingClientEntryPoint:!1,Events:[Ml,ao,yu,dx,ux,Dg]},ba={findFiberByHostInstance:pi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},i2={bundleType:ba.bundleType,version:ba.version,rendererPackageName:ba.rendererPackageName,rendererConfig:ba.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:os.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=mx(t),t===null?null:t.stateNode},findFiberByHostInstance:ba.findFiberByHostInstance||n2,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Mc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Mc.isDisabled&&Mc.supportsFiber)try{hu=Mc.inject(i2),Or=Mc}catch{}}Gn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=s2;Gn.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Bg(e))throw Error(de(200));return t2(t,e,null,n)};Gn.createRoot=function(t,e){if(!Bg(t))throw Error(de(299));var n=!1,r="",s=K1;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=$g(t,1,!1,null,null,n,!1,r,s),t[es]=e.current,cl(t.nodeType===8?t.parentNode:t),new Ug(e)};Gn.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(de(188)):(t=Object.keys(t).join(","),Error(de(268,t)));return t=mx(e),t=t===null?null:t.stateNode,t};Gn.flushSync=function(t){return Ii(t)};Gn.hydrate=function(t,e,n){if(!Tu(e))throw Error(de(200));return Cu(null,t,e,!0,n)};Gn.hydrateRoot=function(t,e,n){if(!Bg(t))throw Error(de(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",o=K1;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=Y1(e,null,t,1,n??null,s,!1,i,o),t[es]=e.current,cl(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new wu(e)};Gn.render=function(t,e,n){if(!Tu(e))throw Error(de(200));return Cu(null,t,e,!1,n)};Gn.unmountComponentAtNode=function(t){if(!Tu(t))throw Error(de(40));return t._reactRootContainer?(Ii(function(){Cu(null,null,t,!1,function(){t._reactRootContainer=null,t[es]=null})}),!0):!1};Gn.unstable_batchedUpdates=Dg;Gn.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Tu(n))throw Error(de(200));if(t==null||t._reactInternals===void 0)throw Error(de(38));return Cu(t,e,n,!1,r)};Gn.version="18.3.1-next-f1338f8080-20240426";function X1(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(X1)}catch(t){console.error(t)}}X1(),X_.exports=Gn;var o2=X_.exports,Xy=o2;bh.createRoot=Xy.createRoot,bh.hydrateRoot=Xy.hydrateRoot;const Qy=20,zg=[{id:1,filename:"1_yoroshiku.png",label:"",se:"pa.mp3"},{id:2,filename:"2_nandato.png",label:"",se:"shock.mp3"},{id:3,filename:"3_thank.png",label:"",se:"thanks.mp3"},{id:4,filename:"4_willwin.png",label:"",se:"nt.mp3"},{id:5,filename:"5_dontmind.png",label:"",se:"boyon.mp3"},{id:6,filename:"6_thinking.png",label:"",se:"thinking.mp3"},{id:7,filename:"7_gg.png",label:"GG",se:"kiri.mp3"},{id:8,filename:"8_sorry.png",label:"",se:"gomen.mp3"}],Jy=(t,e)=>{const n=zg.find(s=>s.id===t);return n?`/stamps/${e==="AJA"?"azya":e.toLowerCase()}/${n.filename}`:""},qy=t=>{const e=zg.find(n=>n.id===t);return(e==null?void 0:e.se)||null},Jn=[{id:"s_3cats",name:"",cost:2,type:"SPELL",description:"1",flavorText:"",imageUrl:"/cards/chatora_three_cats.png",triggers:[{trigger:"FANFARE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_CHATORA"},{type:"GENERATE_CARD",targetCardId:"TOKEN_SABATORA"},{type:"GENERATE_CARD",targetCardId:"TOKEN_KIJITORA"}]}]},{id:"s_final_cannon",name:"",cost:10,type:"SPELL",description:"1",flavorText:'""""',imageUrl:"/cards/final_cannon.png",triggers:[{trigger:"FANFARE",effects:[{type:"SET_MAX_HP",value:1,targetType:"OPPONENT"}]}]},{id:"c_senka_knuckler",name:"",cost:8,type:"FOLLOWER",attack:3,health:5,description:`[] []
2
[]
1`,flavorText:`

`,imageUrl:"/cards/senka.png",evolvedImageUrl:"/cards/senka_2.png",tags:["Knuckler"],passiveAbilities:["STORM","DOUBLE_ATTACK"],attackEffectType:"IMPACT",triggers:[{trigger:"SUPER_EVOLVE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_FLICKER_JAB"},{type:"GENERATE_CARD",targetCardId:"TOKEN_QUAKE_HOWLING"},{type:"GENERATE_CARD",targetCardId:"TOKEN_BACKHAND_SMASH"}]}]},{id:"c_ruiyu",name:"",cost:7,type:"FOLLOWER",attack:5,health:5,description:`4cyoriena
14`,flavorText:`
`,imageUrl:"/cards/ruiyu.png",evolvedImageUrl:"/cards/ruiyu_2.png",attackEffectType:"BLUE_FIRE",relatedCards:["c_cyoriena"],triggers:[{trigger:"FANFARE",effects:[{type:"HEAL_LEADER",value:4,targetType:"SELF"},{type:"SUMMON_CARD",targetCardId:"c_cyoriena"}]},{trigger:"EVOLVE",effects:[{type:"DESTROY",targetType:"SELECT_FOLLOWER"},{type:"HEAL_LEADER",value:4,targetType:"SELF"}]}]},{id:"c_y",name:"Y",cost:6,type:"FOLLOWER",attack:3,health:3,description:`[]
142
3`,flavorText:"",imageUrl:"/cards/y.png",evolvedImageUrl:"/cards/y_2.png",passiveAbilities:["STEALTH"],attackEffectType:"SUMI",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:4,targetType:"SELECT_FOLLOWER"},{type:"AOE_DAMAGE",value:2,targetType:"ALL_FOLLOWERS"}]},{trigger:"EVOLVE",effects:[{type:"AOE_DAMAGE",value:3,targetType:"ALL_FOLLOWERS"}]}]},{id:"c_tsubumaru",name:"",cost:2,type:"FOLLOWER",attack:1,health:3,description:`[]
1
1`,flavorText:`

`,imageUrl:"/cards/tsubumaru.png",evolvedImageUrl:"/cards/tsubumaru_2.png",passiveAbilities:["WARD"],attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"GENERATE_CARD",targetCardId:"s_resignation_proxy"}]}]},{id:"c_barura",name:"",cost:4,type:"FOLLOWER",attack:3,health:4,description:`1
13`,flavorText:`

`,imageUrl:"/cards/barura.png",evolvedImageUrl:"/cards/barura_2.png",attackEffectType:"FIRE",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:3,targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_CHATORA",name:"",cost:0,type:"FOLLOWER",attack:1,health:1,description:"",flavorText:"",imageUrl:"/cards/chatora.png",attackEffectType:"SLASH"},{id:"TOKEN_SABATORA",name:"",cost:1,type:"FOLLOWER",attack:1,health:2,description:"[]",flavorText:"",passiveAbilities:["RUSH"],imageUrl:"/cards/sabatora.png",attackEffectType:"SLASH"},{id:"TOKEN_KIJITORA",name:"",cost:3,type:"FOLLOWER",attack:2,health:3,description:"[]",flavorText:"",passiveAbilities:["WARD"],imageUrl:"/cards/kijitora.png",attackEffectType:"SLASH"},{id:"TOKEN_RICE",name:"",cost:0,type:"SPELL",description:"1",flavorText:" ",imageUrl:"/cards/rice.png",triggers:[{trigger:"FANFARE",effects:[{type:"HEAL_LEADER",value:1,targetType:"SELF"}]}]},{id:"c_yunagi",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:`1
11`,flavorText:`


`,imageUrl:"/cards/yunagi.png",evolvedImageUrl:"/cards/yunagi_2.png",attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:1,targetType:"SELECT_FOLLOWER"},{type:"GENERATE_CARD",targetCardId:"TOKEN_OOMORI_RICE"}]}]},{id:"TOKEN_OOMORI_RICE",name:"",cost:1,type:"SPELL",description:"3",flavorText:"",imageUrl:"/cards/oomoririce.png",tags:["Token"],triggers:[{trigger:"FANFARE",effects:[{type:"HEAL_LEADER",value:3,targetType:"SELF"}]}]},{id:"c_nayuta",name:"",cost:4,type:"FOLLOWER",attack:3,health:3,description:`[]
1
1`,flavorText:"",imageUrl:"/cards/nayuta.png",evolvedImageUrl:"/cards/nayuta_2.png",attackEffectType:"RAY",passiveAbilities:["WARD"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]},{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]}]},{id:"c_yunagi_ward",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:`[]
1`,imageUrl:"/cards/yunagi.png",evolvedImageUrl:"/cards/yunagi_2.png",passiveAbilities:["WARD"],triggers:[{trigger:"FANFARE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_RICE"}]}]},{id:"c_nayuta_ward",name:"",cost:4,type:"FOLLOWER",attack:3,health:3,description:`[]
1
1`,imageUrl:"/cards/nayuta.png",evolvedImageUrl:"/cards/nayuta_2.png",passiveAbilities:["WARD"],attackEffectType:"RAY",triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]},{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]}]},{id:"c_azya",name:"",cost:8,type:"FOLLOWER",attack:4,health:4,description:`[]
3211-2
1+1/+2[][]0`,flavorText:`
&&`,imageUrl:"/cards/azya.png",evolvedImageUrl:"/cards/azya_2.png",attackEffectType:"THUNDER",passiveAbilities:["AURA"],relatedCards:["c_tsubumaru","c_yunagi","c_nayuta"],triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:3,targetType:"OPPONENT"},{type:"HEAL_LEADER",value:2,targetType:"SELF"},{type:"RANDOM_DESTROY",value:1},{type:"RANDOM_BOUNCE",value:1},{type:"REDUCE_HAND_COST",value:2,conditions:{nameIn:["","",""]}}]},{trigger:"SUPER_EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_tsubumaru"},{type:"SUMMON_CARD",targetCardId:"c_yunagi"},{type:"SUMMON_CARD",targetCardId:"c_nayuta"},{type:"BUFF_STATS",value:1,value2:2,targetType:"ALL_OTHER_FOLLOWERS"},{type:"GRANT_PASSIVE",targetPassive:"WARD",targetType:"ALL_OTHER_FOLLOWERS"},{type:"GRANT_PASSIVE",targetPassive:"RUSH",targetType:"ALL_OTHER_FOLLOWERS"},{type:"GENERATE_CARD",targetCardId:"s_yucho_of_the_abyss"},{type:"GENERATE_CARD",targetCardId:"s_thats_mine"},{type:"GRANT_LEADER_DAMAGE_SHIELD"}]}]},{id:"c_yuki",name:"",cost:3,type:"FOLLOWER",attack:3,health:2,description:`[]
+1/+1`,flavorText:"",imageUrl:"/cards/yuki.png",evolvedImageUrl:"/cards/yuki_2.png",tags:["Knuckler"],passiveAbilities:["RUSH"],attackEffectType:"IMPACT",triggers:[{trigger:"EVOLVE",effects:[{type:"BUFF_STATS",value:1,value2:1,targetType:"ALL_FOLLOWERS"}]}]},{id:"c_white_tsubaki",name:"",cost:4,type:"FOLLOWER",attack:4,health:3,description:`[]

01
1`,flavorText:`
`,imageUrl:"/cards/white_tsubaki.png",evolvedImageUrl:"/cards/white_tsubaki_2.png",tags:["Knuckler"],passiveAbilities:["RUSH","IMMUNE_TO_FOLLOWER_DAMAGE","GUTS_MY_TURN"],attackEffectType:"ICE",relatedCards:["c_shieko"],triggers:[{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_shieko"}]}]},{id:"c_shieko",name:"",cost:2,type:"FOLLOWER",attack:2,health:1,description:`[]
1+2/+2`,flavorText:`
`,imageUrl:"/cards/shieko.png",evolvedImageUrl:"/cards/shieko_2.png",tags:["Knuckler"],passiveAbilities:["RUSH"],attackEffectType:"IMPACT",triggers:[{trigger:"EVOLVE",effects:[{type:"BUFF_STATS",value:2,value2:2,targetType:"SELECT_OTHER_ALLY_FOLLOWER"}]}]},{id:"c_urara",name:"",cost:3,type:"FOLLOWER",attack:2,health:2,description:`[] []
2`,flavorText:`
`,imageUrl:"/cards/urara.png",evolvedImageUrl:"/cards/urara_2.png",passiveAbilities:["WARD","BARRIER"],attackEffectType:"WATER",triggers:[{trigger:"EVOLVE",effects:[{type:"HEAL_LEADER",value:2}]}]},{id:"c_kasuga",name:"",cost:10,type:"FOLLOWER",attack:8,health:8,description:"",flavorText:`

`,imageUrl:"/cards/kasuga.png",evolvedImageUrl:"/cards/kasuga_2.png",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY",targetType:"ALL_OTHER_FOLLOWERS"}]}],attackEffectType:"SLASH"},{id:"c_kyokune",name:"",cost:4,type:"FOLLOWER",attack:4,health:4,description:"1",imageUrl:"/cards/kyokune.jpg",relatedCards:["c_sia"],triggers:[{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_sia"}]}],attackEffectType:"SLASH"},{id:"c_sia",name:"",cost:2,type:"FOLLOWER",attack:2,health:1,description:"21",flavorText:"",imageUrl:"/cards/sia.png",evolvedImageUrl:"/cards/sia_2.png",attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DAMAGE",value:1,value2:2,targetType:"OPPONENT"}]}]},{id:"TOKEN_BACKHAND_SMASH",name:"",cost:0,type:"SPELL",description:"16",flavorText:`10
`,imageUrl:"/cards/BackhandSmash.jpg",tags:["Token"],attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:6,targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_QUAKE_HOWLING",name:"",cost:0,type:"SPELL",description:"2",flavorText:"",imageUrl:"/cards/QuakeHowling.png",tags:["Token"],attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"AOE_DAMAGE",value:2,targetType:"ALL_FOLLOWERS"}]}]},{id:"TOKEN_FLICKER_JAB",name:"",cost:0,type:"SPELL",description:"12",flavorText:`
BHS
`,imageUrl:"/cards/FlickerJab.png",tags:["Token"],attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:2,targetType:"SELECT_FOLLOWER"}]}]},{id:"c_bucchi",name:"",cost:5,type:"FOLLOWER",attack:1,health:3,description:"3",flavorText:`
`,imageUrl:"/cards/bucchi.png",evolvedImageUrl:"/cards/bucchi_2.png",attackEffectType:"SLASH",relatedCards:["c_manary"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_manary"},{type:"SUMMON_CARD",targetCardId:"c_manary"},{type:"SUMMON_CARD",targetCardId:"c_manary"}]}]},{id:"c_valkyrie",name:"",cost:6,type:"FOLLOWER",attack:6,health:6,description:`[] [] []
[]`,flavorText:"",imageUrl:"/cards/valkyrie.png",evolvedImageUrl:"/cards/valkyrie_2.png",passiveAbilities:["WARD","BARRIER","AURA"],attackEffectType:"RAY",triggers:[{trigger:"END_OF_TURN",effects:[{type:"GRANT_PASSIVE",targetPassive:"BARRIER",targetType:"SELF"}]}]},{id:"c_manary",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:"[]",flavorText:"^^",imageUrl:"/cards/manary.png",evolvedImageUrl:"/cards/manary_2.png",tags:["Token"],passiveAbilities:["WARD"],attackEffectType:"WATER"},{id:"c_potechi",name:"",cost:3,type:"FOLLOWER",attack:2,health:3,description:`[]
1`,flavorText:"",imageUrl:"/cards/potechi.png",evolvedImageUrl:"/cards/potechi_2.png",passiveAbilities:["WARD"],attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]}]},{id:"c_mono",name:"Mono",cost:3,type:"FOLLOWER",attack:2,health:1,description:`15
15`,flavorText:"",imageUrl:"/cards/Mono.png",evolvedImageUrl:"/cards/Mono_2.png",attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:5,targetType:"SELECT_FOLLOWER"}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:5,targetType:"SELECT_FOLLOWER"}]}]},{id:"c_sara",name:"sara",cost:7,type:"FOLLOWER",attack:4,health:6,description:`2111
1`,flavorText:"w",imageUrl:"/cards/sara.png",evolvedImageUrl:"/cards/sara_2.png",attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DESTROY",value:2,targetType:"OPPONENT"},{type:"GENERATE_CARD",targetCardId:"TOKEN_SORRY_THE_END",conditions:{minTurn:11}}]},{trigger:"SUPER_EVOLVE",effects:[{type:"DESTROY",targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_SORRY_THE_END",name:"",cost:3,type:"SPELL",description:"553sara1",flavorText:'""',imageUrl:"/cards/sorryTheEnd.png",tags:["Token"],attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"AOE_DAMAGE",value:5,targetType:"ALL_FOLLOWERS"},{type:"DAMAGE",value:5,targetType:"OPPONENT"},{type:"DRAW",value:3},{type:"SUMMON_CARD",targetCardId:"c_sara"}]}]},{id:"c_blue_tsubaki",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:`1
1`,flavorText:"",imageUrl:"/cards/blue_tsubaki.png",evolvedImageUrl:"/cards/blue_tsubaki_2.png",attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"RANDOM_DESTROY",value:1,targetType:"OPPONENT"}]}]},{id:"s_resignation_proxy",name:"",cost:0,type:"SPELL",description:"11",flavorText:"1",imageUrl:"/cards/taisyokudaiko.png",tags:["Token"],attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DESTROY",targetType:"OPPONENT",value:1},{type:"DRAW",value:1}]}]},{id:"s_yucho_of_the_abyss",name:"",cost:0,type:"SPELL",description:"11",flavorText:"",imageUrl:"/cards/yuchooftheabyss.png",tags:["Token"],attackEffectType:"THUNDER",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DAMAGE_BY_TURN",value:1,targetType:"OPPONENT"}]}]},{id:"s_thats_mine",name:"",cost:2,type:"SPELL",description:"1",flavorText:"",imageUrl:"/cards/thatsmine.png",tags:["Token"],attackEffectType:"ICE",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY_AND_GENERATE",value:0,targetType:"SELECT_FOLLOWER"}]}]},{id:"s_tenfubu_yabe_hutari",name:"2",cost:4,type:"SPELL",description:"11",flavorText:"",imageUrl:"/cards/tenfubuyabehutari.png",relatedCards:["c_yuki","c_potechi"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_yuki"},{type:"SUMMON_CARD",targetCardId:"c_potechi"}]}]},{id:"s_samurai_tea",name:"",cost:2,type:"SPELL",description:"1+1/+1",flavorText:'""""',imageUrl:"/cards/samuraitea.png",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1},{type:"BUFF_STATS",value:1,value2:1,targetType:"ALL_FOLLOWERS"}]}]},{id:"s_crazy_knucklers",name:"",cost:5,type:"SPELL",description:"+1/+11",flavorText:`
www www`,imageUrl:"/cards/crazy_knucklers.png",relatedCards:["c_white_tsubaki","c_shieko"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD_BUFFED",targetCardId:"c_white_tsubaki",value:1,value2:1},{type:"SUMMON_CARD_BUFFED",targetCardId:"c_shieko",value:1,value2:1},{type:"DRAW",value:1}]}]},{id:"s_knuckle_four",name:"",cost:10,type:"SPELL",description:"444",flavorText:"",imageUrl:"/cards/knucklefour.png",attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DESTROY",value:4,targetType:"OPPONENT"},{type:"DRAW",value:4},{type:"HEAL_LEADER",value:4,targetType:"SELF"}]}]},{id:"c_amandava",name:"amandava",cost:5,attack:2,health:3,type:"FOLLOWER",description:`21
1`,flavorText:"",imageUrl:"/cards/amandava.png",evolvedImageUrl:"/cards/amandava_2.png",attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_SET_HP",value:2,value2:1,targetType:"OPPONENT"}]},{trigger:"EVOLVE",effects:[{type:"AOE_DAMAGE",value:1,targetType:"ALL_FOLLOWERS"}]}]},{id:"c_alice",name:"",cost:3,attack:1,health:1,type:"FOLLOWER",description:`22
22`,flavorText:"",imageUrl:"/cards/alice.png",evolvedImageUrl:"/cards/alice_2.png",attackEffectType:"FIRE",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DAMAGE",value:2,value2:2,targetType:"OPPONENT"}]},{trigger:"EVOLVE",effects:[{type:"RANDOM_DAMAGE",value:2,value2:2,targetType:"OPPONENT"}]}]},{id:"c_yuri",name:"",cost:5,type:"FOLLOWER",attack:3,health:3,description:`1
13`,flavorText:`
`,imageUrl:"/cards/yuri.png",evolvedImageUrl:"/cards/yuri_2.png",attackEffectType:"WATER",relatedCards:["TOKEN_SUIHYORYU"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"TOKEN_SUIHYORYU"}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:3,targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_SUIHYORYU",name:"",cost:5,type:"FOLLOWER",attack:4,health:4,description:`[] []
`,flavorText:"",imageUrl:"/cards/suihyoryu.png",evolvedImageUrl:"/cards/suihyoryu.png",tags:["Token"],passiveAbilities:["RUSH","WARD"],attackEffectType:"ICE",triggers:[{trigger:"START_OF_TURN",effects:[{type:"DESTROY_SELF"}]}]},{id:"c_cyoriena",name:"cyoriena",cost:2,type:"FOLLOWER",attack:1,health:2,description:`[] []
HP2
`,flavorText:"7",imageUrl:"/cards/cyoriena.png",evolvedImageUrl:"/cards/cyoriena_2.png",tags:["Token"],passiveAbilities:["WARD","BARRIER"],attackEffectType:"RAY",triggers:[{trigger:"END_OF_TURN",effects:[{type:"HEAL_LEADER",value:2,targetType:"SELF"}]},{trigger:"EVOLVE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_TSUBASA"}]}]},{id:"TOKEN_TSUBASA",name:"",cost:1,type:"SPELL",description:"1[]",flavorText:"",imageUrl:"/cards/tsubasa.png",tags:["Token"],triggers:[{trigger:"FANFARE",effects:[{type:"GRANT_PASSIVE",targetPassive:"STORM",targetType:"SELECT_ALLY_FOLLOWER"}]}]},{id:"c_yamato",name:"",cost:5,type:"FOLLOWER",attack:5,health:1,description:"[]",imageUrl:"/cards/yamato.jpg",passiveAbilities:["STORM"],attackEffectType:"SLASH"},{id:"c_yoruka",name:"yoRuka",cost:8,type:"FOLLOWER",attack:5,health:5,description:`1
 8yoRuka1
2`,flavorText:"Y",imageUrl:"/cards/yoRuka.png",evolvedImageUrl:"/cards/yoRuka_2.png",attackEffectType:"SUMI",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY",targetType:"SELECT_FOLLOWER"}]},{trigger:"LAST_WORD",effects:[{type:"SUMMON_CARD",targetCardId:"c_yoruka",necromance:8}]},{trigger:"SUPER_EVOLVE",effects:[{type:"RANDOM_DESTROY",value:2,targetType:"OPPONENT"}]}]},{id:"c_haruka",name:"",cost:7,type:"FOLLOWER",attack:2,health:3,description:`[]
[]1
4
1 4+2/+0`,flavorText:"",imageUrl:"/cards/haruka.png",evolvedImageUrl:"/cards/haruka_2.png",passiveAbilities:["STEALTH"],attackEffectType:"SLASH",relatedCards:["c_yuka","c_setsuna"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD_RUSH",targetCardId:"c_yuka"},{type:"SUMMON_CARD",targetCardId:"c_setsuna"}]},{trigger:"LAST_WORD",effects:[{type:"ADD_GRAVEYARD",value:4}]},{trigger:"SUPER_EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_setsuna"},{type:"BUFF_STATS",value:2,value2:0,targetType:"ALL_OTHER_FOLLOWERS",necromance:4}]}]},{id:"c_setsuna",name:"",cost:3,type:"FOLLOWER",attack:1,health:1,description:`[] []
-12`,flavorText:"",imageUrl:"/cards/setsuna.png",evolvedImageUrl:"/cards/setsuna_2.png",passiveAbilities:["STORM","BANE"],attackEffectType:"SUMI",triggers:[{trigger:"LAST_WORD",effects:[{type:"BUFF_STATS",value:-1,value2:0,targetType:"RANDOM_FOLLOWER"},{type:"ADD_GRAVEYARD",value:2}]}]},{id:"c_yuka",name:"",cost:5,type:"FOLLOWER",attack:1,health:6,description:`[] []
1
3
132`,flavorText:"",imageUrl:"/cards/yuka.png",evolvedImageUrl:"/cards/yuka_2.png",passiveAbilities:["WARD","AURA"],attackEffectType:"SHOT",relatedCards:["c_setsuna"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_setsuna"}]},{trigger:"LAST_WORD",effects:[{type:"ADD_GRAVEYARD",value:3}]},{trigger:"EVOLVE",effects:[{type:"RANDOM_DAMAGE",value:3,value2:1,targetType:"OPPONENT"},{type:"RANDOM_DAMAGE",value:3,value2:1,targetType:"OPPONENT"}]}]},{id:"s_hayakikoto",name:"",cost:4,type:"SPELL",description:"21",flavorText:"",imageUrl:"/cards/hayakikoto.png",relatedCards:["c_setsuna"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_setsuna"},{type:"SUMMON_CARD",targetCardId:"c_setsuna"},{type:"DRAW",value:1}]}]},{id:"s_keishou",name:"",cost:9,type:"SPELL",description:"1-9",flavorText:`
`,imageUrl:"/cards/keisyopower.png",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY_AND_GENERATE",targetType:"RANDOM_ENEMY_FOLLOWER",value:-9}]}]},{id:"s_night_parade",name:"",cost:10,type:"SPELL",description:` 41
+1/+0`,flavorText:"",imageUrl:"/cards/nightparade.png",relatedCards:["c_setsuna"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD_FILL_BOARD",targetCardId:"c_setsuna",necromance:4},{type:"BUFF_STATS",value:1,value2:0,targetType:"ALL_FOLLOWERS"}]}]}];function Hg(t){let e=t;return()=>(e=(e*1664525+1013904223)%4294967296,e/4294967296)}function a2(t,e){let n=t.length,r;for(;n!=0;)r=Math.floor(e()*n),n--,[t[n],t[r]]=[t[r],t[n]];return t}function l2(t){var s;const e=t.players.p1,n=t.players.p2;return[t.turnCount,t.activePlayerId,e.hp,e.maxHp,e.pp,e.maxPp,e.sep,e.evolutionsUsed,n.hp,n.maxHp,n.pp,n.maxPp,n.sep,n.evolutionsUsed,e.board.map(i=>i?`${i.id}_${i.instanceId}_${i.currentHealth}_${i.hasBarrier?"B":""}`:"null").join(","),n.board.map(i=>i?`${i.id}_${i.instanceId}_${i.currentHealth}_${i.hasBarrier?"B":""}`:"null").join(","),e.hand.length,n.hand.length,((s=t.pendingEffects)==null?void 0:s.length)||0,t.rngSeed].join("|")}const Q1=[{cardId:"c_senka_knuckler",count:3},{cardId:"c_yuki",count:3},{cardId:"c_white_tsubaki",count:3},{cardId:"c_shieko",count:3},{cardId:"s_samurai_tea",count:3},{cardId:"c_bucchi",count:2},{cardId:"c_valkyrie",count:1},{cardId:"c_potechi",count:3},{cardId:"s_tenfubu_yabe_hutari",count:3},{cardId:"s_crazy_knucklers",count:2},{cardId:"c_sia",count:2},{cardId:"c_mono",count:3},{cardId:"c_ruiyu",count:1},{cardId:"c_kasuga",count:1},{cardId:"c_y",count:2},{cardId:"c_sara",count:1},{cardId:"s_knuckle_four",count:1},{cardId:"c_blue_tsubaki",count:3}],J1=[{cardId:"c_azya",count:3},{cardId:"c_ruiyu",count:2},{cardId:"c_y",count:2},{cardId:"c_sara",count:2},{cardId:"c_urara",count:3},{cardId:"c_yunagi",count:3},{cardId:"c_tsubumaru",count:3},{cardId:"c_nayuta",count:3},{cardId:"c_yuri",count:2},{cardId:"c_alice",count:3},{cardId:"c_kasuga",count:1},{cardId:"c_barura",count:3},{cardId:"c_valkyrie",count:3},{cardId:"s_3cats",count:2},{cardId:"s_final_cannon",count:1},{cardId:"c_amandava",count:2},{cardId:"c_mono",count:2}],q1=[{cardId:"c_yoruka",count:3},{cardId:"c_y",count:3},{cardId:"c_haruka",count:3},{cardId:"c_yuka",count:3},{cardId:"c_setsuna",count:3},{cardId:"s_hayakikoto",count:3},{cardId:"s_night_parade",count:1},{cardId:"c_kasuga",count:1},{cardId:"c_yunagi",count:3},{cardId:"c_tsubumaru",count:3},{cardId:"c_nayuta",count:3},{cardId:"c_mono",count:3},{cardId:"c_ruiyu",count:1},{cardId:"c_sara",count:1},{cardId:"s_3cats",count:2},{cardId:"c_yuri",count:2},{cardId:"c_sia",count:2}];function Wr(t){const e=Jn.find(n=>n.id===t);return e||Jn.find(n=>n.name===t)}function Z1(){return Jn.map(t=>t.name).sort((t,e)=>e.length-t.length)}function Nc(t){return{STORM:"",RUSH:"",WARD:"",BARRIER:"",AURA:"",STEALTH:"",BANE:"",DOUBLE_ATTACK:"",IMMUNE_TO_FOLLOWER_DAMAGE:"",GUTS_MY_TURN:""}[t]||t}function c2(t,e){const n=[];let r=0;return t.forEach(s=>{const i=Wr(s.cardId);if(i)for(let o=0;o<s.count;o++)n.push({...i,id:`${e}_c${r}`,instanceId:`inst_${e}_c${r}`}),r++;else console.warn(`Card definition not found: ${s.cardId}`)}),n}function Zy(t,e,n,r){const i=c2(n==="SENKA"?Q1:n==="AJA"?J1:q1,t);return{id:t,name:e,class:n,hp:Qy,maxHp:Qy,pp:0,maxPp:0,sep:2,deck:a2(i,r),hand:[],graveyard:[],board:[],evolutionsUsed:0,canEvolveThisTurn:!1,extraPpUsedEarly:!1,extraPpUsedLate:!1,extraPpActive:!1}}function rd(t,e,n,r,s,i=!0){const o=Math.floor(Math.random()*1e6),l=Hg(o),c=Zy("p1",t,e,l),d=Zy("p2",n,r,l);c.hand=c.deck.splice(0,4),d.hand=d.deck.splice(0,4);let u,h;return i?(u="p1",h=t,c.maxPp=1,c.pp=1,d.maxPp=0,d.pp=0):(u="p2",h=n,c.maxPp=0,c.pp=0,d.maxPp=1,d.pp=1),{phase:"INIT",rngSeed:Math.floor(l()*1e6),activePlayerId:u,firstPlayerId:u,players:{p1:c,p2:d},turnCount:1,pendingEffects:[],logs:[` 1 - ${h} `],winnerId:void 0}}function pp(t){return t==="p1"?"p2":"p1"}function d2(t,e,n,r,s,i){var h,f,S,k,w,j,_,x,I,p,D,z,te,H,q,ue,ye,Me,fe,re,P;let o={...t,players:{p1:{...t.players.p1,hand:[...t.players.p1.hand],deck:[...t.players.p1.deck],board:t.players.p1.board.map(C=>C?{...C,passiveAbilities:C.passiveAbilities?[...C.passiveAbilities]:[]}:null),graveyard:[...t.players.p1.graveyard]},p2:{...t.players.p2,hand:[...t.players.p2.hand],deck:[...t.players.p2.deck],board:t.players.p2.board.map(C=>C?{...C,passiveAbilities:C.passiveAbilities?[...C.passiveAbilities]:[]}:null),graveyard:[...t.players.p2.graveyard]}},logs:[...t.logs||[]]};const l=Hg(o.rngSeed||999);o.rngSeed=Math.floor(l()*1e6);const c=pp(e),d=C=>{for(const R of["p1","p2"]){const v=o.players[R].board.findIndex(g=>(g==null?void 0:g.instanceId)===C);if(v!==-1&&o.players[R].board[v])return{card:o.players[R].board[v],player:o.players[R],index:v}}return null};if(r.necromance!==void 0&&r.necromance>0&&r.type!=="SUMMON_CARD_FILL_BOARD"){const C=o.players[e];if(C.graveyard.length<r.necromance)return console.log(`[Engine] : ${C.graveyard.length} < ${r.necromance}`),o;const R=C.graveyard.splice(-r.necromance,r.necromance);o.logs.push(`${C.name}  ${r.necromance} `),console.log(`[Engine] : ${R.map(v=>v.name).join(", ")} `)}const u=(C,R)=>{var g;const v=(g=C.triggers)==null?void 0:g.find(T=>T.trigger==="LAST_WORD");if(v){const T=v.effects.map(A=>({sourceCard:C,effect:A,sourcePlayerId:R}));o.pendingEffects=[...o.pendingEffects||[],...T],o.logs.push(`${C.name} `),console.log(`[Engine] processSingleEffect: Last Word triggered for ${C.name}. pendingEffects count: ${o.pendingEffects.length}`)}};switch(r.type){case"DAMAGE":{const C=r.value||0;if(r.targetType==="SELECT_FOLLOWER"&&s){const R=d(s);if(R){const{card:v,player:g,index:T}=R;if(v.hasBarrier)v.hasBarrier=!1,o.logs.push(`${v.name} `);else if(v.currentHealth-=C,o.logs.push(`${n.name}  ${v.name}  ${C} `),v.currentHealth<=0){v.currentHealth=Math.min(0,v.currentHealth);const A=Object.keys(o.players).find(y=>o.players[y]===g)||c;u(v,A),g.graveyard.push(v),g.board[T]=null,o.logs.push(`${v.name} `)}}}else if(r.targetType==="OPPONENT"){const R=o.players[c];if(R.leaderDamageShield)R.leaderDamageShield=!1,o.logs.push(`${n.name}  ${C} `);else{const v=R.board.some(T=>{var A;return(A=T==null?void 0:T.passiveAbilities)==null?void 0:A.includes("LEADER_DAMAGE_CAP")}),g=v?Math.min(C,1):C;R.hp-=g,v&&C>1?o.logs.push(`${n.name}  ${C} 1`):o.logs.push(`${n.name}  ${g} `),R.hp<=0&&(o.winnerId=e,o.logs.push(`${R.name} `))}}break}case"AOE_DAMAGE":{const C=r.value||0;if(r.targetType==="ALL_FOLLOWERS"){const R=o.players[c].board,v=i&&i.length>0?new Set(i):null;R.forEach(T=>{if(T){if(v&&!v.has(T.instanceId))return;T.hasBarrier?(T.hasBarrier=!1,o.logs.push(`${T.name} `)):T.currentHealth-=C}}),R.filter(T=>T&&T.currentHealth<=0).forEach(T=>{T&&(T.currentHealth=Math.min(0,T.currentHealth),u(T,c),o.players[c].graveyard.push(T),o.logs.push(`${T.name} `))}),o.logs.push(`${n.name}  ${C} `),R.forEach((T,A)=>{T&&T.currentHealth<=0&&(R[A]=null)})}break}case"DRAW":{const C=r.value||1,R=o.players[e];for(let v=0;v<C;v++)if(R.deck.length>0){const g=R.deck.pop();g&&(R.hand.length<9?R.hand.push(g):(R.graveyard.push(g),o.logs.push(`${R.name}${g.name}`)))}o.logs.push(`${R.name}  ${C} `);break}case"ADD_GRAVEYARD":{const C=r.value||1,R=o.players[e];for(let v=0;v<C;v++){const g={...n,instanceId:`grave_${o.rngSeed}_${Math.floor(l()*1e3)}_${v}`};R.graveyard.push(g)}o.logs.push(`${R.name}  ${C} `);break}case"HEAL_LEADER":{const C=r.value||0,R=o.players[e];R.hp=Math.min(R.maxHp,R.hp+C),o.logs.push(`${R.name}  ${C} HP`);break}case"DESTROY":{const C=(R,v)=>{var g;return((g=R.passiveAbilities)==null?void 0:g.includes("IMMUNE_TO_DAMAGE_MY_TURN"))===!0&&o.activePlayerId===v};if(r.targetType==="ALL_OTHER_FOLLOWERS"){const R=o.players[c].board,v=[];R.forEach(y=>{y&&(C(y,c)?(v.push(y),o.logs.push(`${y.name} `)):(u(y,c),o.players[c].graveyard.push(y)))}),o.players[c].board=v;const g=o.players[e].board,T=[],A=n.instanceId;g.forEach(y=>{y&&(A&&y.instanceId===A?T.push(y):C(y,e)?(T.push(y),o.logs.push(`${y.name} `)):(u(y,e),o.players[e].graveyard.push(y)))}),o.players[e].board=T,o.logs.push(`${n.name} `)}else if((r.targetType==="SELECT_FOLLOWER"||r.targetType==="SELECT_ALLY_FOLLOWER")&&s){const R=d(s);if(R){const{card:v,player:g,index:T}=R,A=Object.keys(o.players).find(y=>o.players[y].board.includes(v))||"";C(v,A)?o.logs.push(`${v.name} `):(v.currentHealth=1,u(v,A),g.graveyard.push(v),g.board[T]=null,o.logs.push(`${v.name}  ${n.name} `))}}break}case"GENERATE_CARD":{if((h=r.conditions)!=null&&h.minTurn&&t.turnCount<r.conditions.minTurn)break;const C=r.targetCardId,R=Jn.find(v=>v.id===C);if(R){const v=o.players[e],g=`gen_${o.rngSeed}_${Date.now()}_${Math.floor(l()*1e4)}`,T={...R,id:`token_${o.rngSeed}_${Math.floor(l()*1e3)}`,instanceId:g};v.hand.length<9?(v.hand.push(T),o.logs.push(`${v.name}  ${R.name} `)):(v.graveyard.push(T),o.logs.push(`${v.name}${R.name}`))}break}case"REDUCE_HAND_COST":{const C=r.value||0,R=((f=r.conditions)==null?void 0:f.nameIn)||[],v=o.players[e];let g=0;v.hand.forEach(T=>{if(R.includes(T.name)){const A=T.cost,y=Math.max(0,A-C);y!==A&&(T.cost=y,T.baseCost=y,g++)}}),g>0&&o.logs.push(`${n.name} -${C}`);break}case"GRANT_LEADER_DAMAGE_SHIELD":{const C=o.players[e];C.leaderDamageShield=!0,o.logs.push(`${C.name} 0`);break}case"RANDOM_DESTROY":{const C=(T,A)=>{var y;return((y=T.passiveAbilities)==null?void 0:y.includes("IMMUNE_TO_DAMAGE_MY_TURN"))===!0&&o.activePlayerId===A},R=r.value||1,v=r.targetType==="SELF"?e:c,g=o.players[v].board;if(i&&i.length>0)i.forEach(T=>{const A=g.findIndex(y=>(y==null?void 0:y.instanceId)===T);if(A!==-1&&g[A]){const y=g[A];C(y,v)?o.logs.push(`${y.name} `):(y.currentHealth=1,u(y,v),o.players[v].graveyard.push(y),g[A]=null,o.logs.push(`${y.name}  ${n.name} `))}});else{const T=g.map((y,X)=>!y||C(y,v)?-1:X).filter(y=>y!==-1);for(let y=T.length-1;y>0;y--){const X=Math.floor(l()*(y+1));[T[y],T[X]]=[T[X],T[y]]}T.slice(0,R).forEach(y=>{const X=g[y];X&&(X.currentHealth=1,u(X,v),o.players[v].graveyard.push(X),g[y]=null,o.logs.push(`${X.name}  ${n.name} `))})}break}case"RANDOM_SET_HP":{const C=r.value||1,R=r.value2||1,v=r.targetType==="SELF"?e:c,g=o.players[v].board;if(i&&i.length>0)i.forEach(T=>{const A=g.findIndex(y=>(y==null?void 0:y.instanceId)===T);A!==-1&&g[A]&&(g[A].currentHealth=R,o.logs.push(`${g[A].name} HP ${R} `))});else{const T=g.map((y,X)=>y?X:-1).filter(y=>y!==-1);for(let y=T.length-1;y>0;y--){const X=Math.floor(l()*(y+1));[T[y],T[X]]=[T[X],T[y]]}T.slice(0,C).forEach(y=>{const X=g[y];X&&(X.currentHealth=R,o.logs.push(`${X.name} HP ${R} `))})}break}case"RANDOM_DAMAGE":{const C=r.value2||1,R=r.value||0,v=r.targetType==="SELF"?e:c,g=o.players[v].board,T=y=>{const X=g[y];X&&(X.hasBarrier?(X.hasBarrier=!1,o.logs.push(`${X.name} `)):(X.currentHealth-=R,o.logs.push(`${n.name}  ${X.name}  ${R} `)),X.currentHealth<=0&&(X.currentHealth=0,u(X,v),o.players[v].graveyard.push(X),g[y]=null,o.logs.push(`${X.name} `)))},A=new Set;if(i&&i.length>0)i.forEach(y=>{const X=g.findIndex(F=>(F==null?void 0:F.instanceId)===y);if(X!==-1&&g[X])A.add(y),T(X);else{const F=g.map((ve,ke)=>ve&&!A.has(ve.instanceId)?ke:-1).filter(ve=>ve!==-1);if(F.length>0){const ve=Math.floor(l()*F.length),ke=F[ve],Ee=g[ke];A.add(Ee.instanceId),T(ke)}}});else{const y=g.map((F,ve)=>F?ve:-1).filter(F=>F!==-1);for(let F=y.length-1;F>0;F--){const ve=Math.floor(l()*(F+1));[y[F],y[ve]]=[y[ve],y[F]]}y.slice(0,C).forEach(F=>{T(F)})}break}case"RANDOM_DAMAGE_BY_TURN":{const C=r.value||1,R=o.turnCount,v=r.targetType==="SELF"?e:c,g=o.players[v].board,T=A=>{var X;const y=g[A];if(!y)return!1;if(y.hasBarrier)return y.hasBarrier=!1,o.logs.push(`${y.name} `),!0;if(y.currentHealth-=C,o.logs.push(`${n.name}  ${y.name}  ${C} `),y.currentHealth<=0){y.currentHealth=0;const F=Object.keys(o.players).find(ke=>o.players[ke]===o.players[v])||v,ve=(X=y.triggers)==null?void 0:X.find(ke=>ke.trigger==="LASTWORD");return ve&&ve.effects.forEach(ke=>{o.pendingEffects.push({sourceCard:y,effect:ke,sourcePlayerId:F})}),o.players[v].graveyard.push(y),g[A]=null,o.logs.push(`${y.name} `),!1}return!0};if(i&&i.length>0)for(let A=0;A<i.length;A++){const y=i[A],X=g.findIndex(F=>(F==null?void 0:F.instanceId)===y);if(X!==-1&&g[X])T(X);else{const F=g.map((ve,ke)=>ve?ke:-1).filter(ve=>ve!==-1);if(F.length>0){const ve=Math.floor(l()*F.length);T(F[ve])}}}else for(let A=0;A<R;A++){const y=g.map((F,ve)=>F?ve:-1).filter(F=>F!==-1);if(y.length===0)break;const X=Math.floor(l()*y.length);T(y[X])}break}case"SET_MAX_HP":{const C=r.value||20;if(r.targetType==="OPPONENT"){const R=o.players[c];R.maxHp=C,R.hp>C&&(R.hp=C)}break}case"SUMMON_CARD":{const C=r.targetCardId,R=Jn.find(v=>v.id===C);if(R){const v=o.players[e];if(v.board.filter(T=>T!==null).length<5){const T={...R,instanceId:`token_${o.rngSeed}_${Math.floor(l()*1e3)}`,canAttack:((S=R.passiveAbilities)==null?void 0:S.includes("STORM"))||((k=R.passiveAbilities)==null?void 0:k.includes("RUSH"))||!1,currentHealth:R.health||1,maxHealth:R.health||1,attack:R.attack||0,currentAttack:R.attack||0,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((w=R.passiveAbilities)==null?void 0:w.includes("BARRIER"))??!1,passiveAbilities:R.passiveAbilities?[...R.passiveAbilities]:[],hadStealth:((j=R.passiveAbilities)==null?void 0:j.includes("STEALTH"))??!1};(_=R.tags)!=null&&_.includes("Knuckler")&&!T.passiveAbilities.includes("STORM")&&v.board.some(y=>(y==null?void 0:y.name)==="")&&(T.passiveAbilities.push("STORM"),T.canAttack=!0,o.logs.push(`${R.name}   `)),v.board.push(T),o.logs.push(`${v.name}  ${R.name} `)}}break}case"SUMMON_CARD_RUSH":{const C=r.targetCardId,R=Jn.find(v=>v.id===C);if(R){const v=o.players[e];if(v.board.filter(T=>T!==null).length<5){const T={...R,instanceId:`token_${o.rngSeed}_${Math.floor(l()*1e3)}`,canAttack:!0,currentHealth:R.health||1,maxHealth:R.health||1,attack:R.attack||0,currentAttack:R.attack||0,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((x=R.passiveAbilities)==null?void 0:x.includes("BARRIER"))??!1,passiveAbilities:R.passiveAbilities?[...R.passiveAbilities]:[],hadStealth:((I=R.passiveAbilities)==null?void 0:I.includes("STEALTH"))??!1};let A=!1;(p=R.tags)!=null&&p.includes("Knuckler")&&!T.passiveAbilities.includes("STORM")&&v.board.some(X=>(X==null?void 0:X.name)==="")&&(T.passiveAbilities.push("STORM"),A=!0,o.logs.push(`${R.name}   `)),!A&&!T.passiveAbilities.includes("RUSH")&&T.passiveAbilities.push("RUSH"),v.board.push(T),o.logs.push(`${v.name}  ${R.name} ${A?"":""}`)}}break}case"SUMMON_CARD_BUFFED":{const C=r.targetCardId,R=Jn.find(T=>T.id===C),v=r.value||0,g=r.value2||0;if(R){const T=o.players[e];if(T.board.filter(y=>y!==null).length<5){const y=R.attack||0,X=R.health||1,F=y+v,ve=X+g,ke={...R,instanceId:`token_${o.rngSeed}_${Math.floor(l()*1e3)}`,canAttack:!1,currentHealth:ve,maxHealth:ve,health:ve,attack:F,currentAttack:F,baseAttack:y,baseHealth:X,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((D=R.passiveAbilities)==null?void 0:D.includes("BARRIER"))??!1,passiveAbilities:R.passiveAbilities?[...R.passiveAbilities]:[],hadStealth:((z=R.passiveAbilities)==null?void 0:z.includes("STEALTH"))??!1};(te=R.tags)!=null&&te.includes("Knuckler")&&!ke.passiveAbilities.includes("STORM")&&T.board.some(ee=>(ee==null?void 0:ee.name)==="")&&(ke.passiveAbilities.push("STORM"),ke.canAttack=!0,o.logs.push(`${R.name}   `)),((H=ke.passiveAbilities)!=null&&H.includes("RUSH")||(q=ke.passiveAbilities)!=null&&q.includes("STORM"))&&(ke.canAttack=!0),T.board.push(ke),o.logs.push(`${T.name}  ${R.name} +${v}/+${g}`),o.pendingEffects=[...o.pendingEffects||[],{sourceCard:ke,effect:{type:"VISUAL_BUFF_ONLY",value:v,value2:g},sourcePlayerId:e}]}}break}case"SUMMON_CARD_FILL_BOARD":{const C=r.targetCardId,R=Jn.find(g=>g.id===C),v=r.necromance||0;if(R){const g=o.players[e];let T=0;for(;!(g.board.filter(X=>X!==null).length>=5);){if(v>0&&g.graveyard.length<v){T===0&&o.logs.push(` ${R.name} `);break}if(v>0){const X=g.graveyard.splice(-v,v);o.logs.push(` ${v} ${X.map(F=>F.name).join(", ")} `)}const y={...R,instanceId:`token_${o.rngSeed}_${Math.floor(l()*1e3)}_${T}`,canAttack:((ue=R.passiveAbilities)==null?void 0:ue.includes("STORM"))||((ye=R.passiveAbilities)==null?void 0:ye.includes("RUSH"))||!1,currentHealth:R.health||1,maxHealth:R.health||1,attack:R.attack||0,currentAttack:R.attack||0,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((Me=R.passiveAbilities)==null?void 0:Me.includes("BARRIER"))??!1,passiveAbilities:R.passiveAbilities?[...R.passiveAbilities]:[],hadStealth:((fe=R.passiveAbilities)==null?void 0:fe.includes("STEALTH"))??!1};(re=R.tags)!=null&&re.includes("Knuckler")&&!y.passiveAbilities.includes("STORM")&&g.board.some(F=>(F==null?void 0:F.name)==="")&&(y.passiveAbilities.push("STORM"),y.canAttack=!0,o.logs.push(`${R.name}   `)),g.board.push(y),T++,o.logs.push(`${g.name}  ${R.name} `)}T>0&&o.logs.push(` ${T}  ${R.name} `)}break}case"DESTROY_AND_STEAL":{if(r.targetType==="SELECT_FOLLOWER"&&s){const C=d(s);if(C){const{card:R,player:v,index:g}=C,T=Object.keys(o.players).find(X=>o.players[X]===v)||c,A=o.players[e];if(A.board.filter(X=>X!==null).length<5){v.board[g]=null,o.logs.push(`${R.name}  ${n.name} `);const X={...R,instanceId:`stolen_${o.rngSeed}_${Math.floor(l()*1e3)}`,canAttack:!1,currentHealth:R.health||R.currentHealth,maxHealth:R.health||R.maxHealth,currentAttack:R.attack||R.currentAttack,attacksMade:0,turnPlayed:o.turnCount,hasEvolved:!1};A.board.push(X),o.logs.push(`${A.name}  ${X.name} `)}else u(R,T),v.graveyard.push(R),v.board[g]=null,o.logs.push(`${R.name}  ${n.name} `)}}break}case"DESTROY_AND_GENERATE":{let C=null;if(r.targetType==="SELECT_FOLLOWER"&&s)C=d(s);else if(r.targetType==="RANDOM_ENEMY_FOLLOWER"){const v=o.players[c].board.map((g,T)=>({card:g,index:T})).filter(g=>g.card!==null);if(v.length>0){const g=Math.floor(l()*v.length),T=v[g];C={card:T.card,player:o.players[c],index:T.index}}}if(C){const{card:R,player:v,index:g}=C,T=Object.keys(o.players).find(X=>o.players[X]===v)||c;u(R,T),v.graveyard.push(R),v.board[g]=null,o.logs.push(`${R.name}  ${n.name} `);const A=o.players[e],y=Wr(R.name);if(y){const X=Math.max(0,y.cost+(r.value||0)),F={...y,instanceId:`generated_${o.rngSeed}_${Math.floor(l()*1e3)}`,baseCost:X,cost:X,attackEffectType:y.attackEffectType};A.hand.push(F);const ve=r.value||0;o.logs.push(`${A.name}  ${F.name} ${ve>=0?"+":""}${ve}`)}}break}case"RETURN_TO_HAND":{const C=o.players[c].board;let R=-1;if(r.targetType==="SELECT_FOLLOWER"&&s?R=C.findIndex(v=>(v==null?void 0:v.instanceId)===s):(r.targetType==="RANDOM_FOLLOWER"||!s)&&C.length>0&&(R=Math.floor(l()*C.length)),R!==-1&&C[R]){const v=C[R];o.players[c].board[R]=null;const g=o.players[c],T=Wr(v.id)||Wr(v.name),{currentHealth:A,maxHealth:y,canAttack:X,attacksMade:F,hasEvolved:ve,baseAttack:ke,baseHealth:Ee,turnPlayed:ee,hasBarrier:Y,attack:Pe,health:xe,...$e}=v,Te={...$e,attack:(T==null?void 0:T.attack)??Pe,health:(T==null?void 0:T.health)??xe};g.hand.length<9?(g.hand.push(Te),o.logs.push(`${v.name} `)):(g.graveyard.push(Te),o.logs.push(`${v.name} `))}break}case"RANDOM_BOUNCE":{const C=r.value||1,R=o.players[c].board;for(let v=0;v<C;v++){const g=R.map((st,qe)=>st?qe:-1).filter(st=>st!==-1);if(g.length===0)break;const T=g[Math.floor(l()*g.length)],A=R[T];R[T]=null;const y=o.players[c],X=Wr(A.id)||Wr(A.name),{currentHealth:F,maxHealth:ve,canAttack:ke,attacksMade:Ee,hasEvolved:ee,baseAttack:Y,baseHealth:Pe,turnPlayed:xe,hasBarrier:$e,attack:Te,health:Ne,...mt}=A,tt={...mt,attack:(X==null?void 0:X.attack)??Te,health:(X==null?void 0:X.health)??Ne};y.hand.length<9?(y.hand.push(tt),o.logs.push(`${A.name} `)):(y.graveyard.push(tt),o.logs.push(`${A.name} `))}break}case"GRANT_PASSIVE":{const C=r.targetPassive;if(!C)break;if(r.targetType==="SELF"){const R=n;if(R.instanceId){const g=o.players[e].board.find(T=>(T==null?void 0:T.instanceId)===R.instanceId);g&&(C==="BARRIER"?(g.hasBarrier=!0,o.logs.push(`${g.name} `)):(g.passiveAbilities||(g.passiveAbilities=[]),g.passiveAbilities.includes(C)||(g.passiveAbilities.push(C),o.logs.push(`${g.name}  ${Nc(C)} `)),(C==="STORM"||C==="RUSH")&&(g.canAttack=!0)))}}else if((r.targetType==="SELECT_FOLLOWER"||r.targetType==="SELECT_ALLY_FOLLOWER")&&s){const R=d(s);if(R){const{card:v}=R;C==="BARRIER"?(v.hasBarrier=!0,o.logs.push(`${v.name} `)):(v.passiveAbilities||(v.passiveAbilities=[]),v.passiveAbilities.includes(C)||(v.passiveAbilities.push(C),o.logs.push(`${v.name}  ${Nc(C)} `)),(C==="STORM"||C==="RUSH")&&(v.canAttack=!0))}}else if(r.targetType==="ALL_FOLLOWERS"){const R=o.players[e];let v=0;console.log(`[GRANT_PASSIVE] ALL_FOLLOWERS: Player board has ${R.board.filter(g=>g).length} units, condition tag=${(P=r.conditions)==null?void 0:P.tag}`),R.board.forEach(g=>{var T,A,y;if(g){if(console.log(`[GRANT_PASSIVE] Checking: ${g.name}, tags=${g.tags}, passives=${g.passiveAbilities}`),(T=r.conditions)!=null&&T.tag&&!((A=g.tags)!=null&&A.includes(r.conditions.tag))){console.log(`[GRANT_PASSIVE] Skipped ${g.name}: no matching tag`);return}if((y=r.conditions)!=null&&y.nameIn&&!r.conditions.nameIn.includes(g.name)){console.log(`[GRANT_PASSIVE] Skipped ${g.name}: no matching nameIn`);return}C==="BARRIER"?(g.hasBarrier=!0,v++):(g.passiveAbilities||(g.passiveAbilities=[]),g.passiveAbilities.includes(C)||(g.passiveAbilities.push(C),v++,console.log(`[GRANT_PASSIVE] Granted ${C} to ${g.name}`),(C==="STORM"||C==="RUSH")&&(g.canAttack=!0)))}}),v>0&&o.logs.push(`${v} ${Nc(C)} `),console.log(`[GRANT_PASSIVE] Total granted: ${v}`)}else if(r.targetType==="ALL_OTHER_FOLLOWERS"){const R=o.players[e];let v=0;R.board.forEach(g=>{var T,A,y;if(g&&g.instanceId!==n.instanceId){if((T=r.conditions)!=null&&T.tag&&!((A=g.tags)!=null&&A.includes(r.conditions.tag))||(y=r.conditions)!=null&&y.nameIn&&!r.conditions.nameIn.includes(g.name))return;C==="BARRIER"?(g.hasBarrier=!0,v++):(g.passiveAbilities||(g.passiveAbilities=[]),g.passiveAbilities.includes(C)||(g.passiveAbilities.push(C),v++,(C==="STORM"||C==="RUSH")&&(g.canAttack=!0)))}}),v>0&&o.logs.push(`${v} ${Nc(C)} `)}break}case"BUFF_STATS":{const C=r.value||0,R=r.value2||0;if(r.targetType==="ALL_FOLLOWERS")o.players[e].board.forEach(g=>{var T,A,y;if(g){if((T=r.conditions)!=null&&T.tag&&!((A=g.tags)!=null&&A.includes(r.conditions.tag))||(y=r.conditions)!=null&&y.nameIn&&!r.conditions.nameIn.includes(g.name))return;g.baseAttack||(g.baseAttack=g.attack||0),g.baseHealth||(g.baseHealth=g.health||0),g.attack=(g.attack||0)+C,g.currentAttack=(g.currentAttack||0)+C,g.health=(g.health||0)+R,g.maxHealth=(g.maxHealth||0)+R,g.currentHealth=(g.currentHealth||0)+R,o.logs.push(`${g.name}  +${C}/+${R} `)}});else if(r.targetType==="ALL_OTHER_FOLLOWERS")o.players[e].board.forEach(g=>{var T,A,y;if(g&&g.instanceId!==n.instanceId){if((T=r.conditions)!=null&&T.tag&&!((A=g.tags)!=null&&A.includes(r.conditions.tag))||(y=r.conditions)!=null&&y.nameIn&&!r.conditions.nameIn.includes(g.name))return;g.baseAttack||(g.baseAttack=g.attack||0),g.baseHealth||(g.baseHealth=g.health||0),g.attack=(g.attack||0)+C,g.currentAttack=(g.currentAttack||0)+C,g.health=(g.health||0)+R,g.maxHealth=(g.maxHealth||0)+R,g.currentHealth=(g.currentHealth||0)+R,o.logs.push(`${g.name}  +${C}/+${R} `)}});else if((r.targetType==="SELECT_FOLLOWER"||r.targetType==="SELECT_ALLY_FOLLOWER"||r.targetType==="SELECT_OTHER_ALLY_FOLLOWER")&&s){const v=d(s);if(v){const{card:g}=v;g.baseAttack||(g.baseAttack=g.attack||0),g.baseHealth||(g.baseHealth=g.health||0),g.attack=(g.attack||0)+C,g.currentAttack=(g.currentAttack||0)+C,g.health=(g.health||0)+R,g.maxHealth=(g.maxHealth||0)+R,g.currentHealth=(g.currentHealth||0)+R,o.logs.push(`${g.name}  +${C}/+${R} `)}}else if(r.targetType==="RANDOM_FOLLOWER"){const v=o.players[c].board,g=v.map((T,A)=>T?A:-1).filter(T=>T!==-1);if(g.length>0){const T=g[Math.floor(l()*g.length)],A=v[T];A.baseAttack||(A.baseAttack=A.attack||0),A.baseHealth||(A.baseHealth=A.health||0),A.attack=(A.attack||0)+C,A.currentAttack=(A.currentAttack||0)+C,A.health=(A.health||0)+R,A.maxHealth=(A.maxHealth||0)+R,A.currentHealth=(A.currentHealth||0)+R,A.currentAttack<0&&(A.currentAttack=0),A.attack&&A.attack<0&&(A.attack=0);const y=C>=0?`+${C}`:`${C}`,X=R>=0?`+${R}`:`${R}`;o.logs.push(`${A.name}  ${y}/${X} `)}else o.logs.push("")}break}}return o}const u2=t=>{const e=n=>{const r=n.board.some(i=>i&&i.name.includes("")),s=n.hand.map(i=>{var c;const o=i.baseCost!==void 0?i.baseCost:i.cost;let l=o;return r&&((c=i.tags)!=null&&c.includes("Knuckler"))&&(l=Math.max(0,o-2)),i.cost!==l?{...i,cost:l,baseCost:o}:i});return{...n,hand:s}};return{...t,players:{p1:e(t.players.p1),p2:e(t.players.p2)}}},f2=(t,e)=>{let n=h2(t,e);return n=u2(n),n.lastHash=l2(n),n},h2=(t,e)=>{var s,i,o,l,c,d,u,h,f,S,k,w,j,_,x,I,p,D,z,te,H,q,ue,ye,Me;console.log(`[Reducer] Action: ${e.type}, isRemote: ${e.isRemote}`);let n={...t,players:{p1:{...t.players.p1,hand:[...t.players.p1.hand],deck:[...t.players.p1.deck],board:t.players.p1.board.map(fe=>fe?{...fe,passiveAbilities:fe.passiveAbilities?[...fe.passiveAbilities]:[]}:null),graveyard:[...t.players.p1.graveyard]},p2:{...t.players.p2,hand:[...t.players.p2.hand],deck:[...t.players.p2.deck],board:t.players.p2.board.map(fe=>fe?{...fe,passiveAbilities:fe.passiveAbilities?[...fe.passiveAbilities]:[]}:null),graveyard:[...t.players.p2.graveyard]}},logs:[...t.logs||[]]};const r=Hg(n.rngSeed||999);switch(n.rngSeed=Math.floor(r()*1e6),e.type){case"START_GAME":return t;case"END_TURN":{const fe=t.activePlayerId,re=n.players[fe];re.extraPpActive&&(re.id!==t.firstPlayerId&&(n.turnCount<=5?re.extraPpUsedEarly=!0:re.extraPpUsedLate=!0),re.extraPpActive=!1);const P=[...n.pendingEffects||[]];re.board.forEach(v=>{v&&v.triggers&&v.triggers.filter(g=>g.trigger==="END_OF_TURN").forEach(g=>{g.effects.forEach(T=>{P.push({sourceCard:v,effect:T,sourcePlayerId:fe})})})});const C=pp(fe),R=n.players[C];if(R.board.forEach((v,g)=>{v&&v.triggers&&v.triggers.filter(T=>T.trigger==="START_OF_TURN").forEach(T=>{T.effects.forEach(A=>{A.type==="DESTROY_SELF"?v&&(n.players[C].graveyard.push(v),n.players[C].board[g]=null,n.logs.push(`${v.name} `)):P.push({sourceCard:v,effect:A,sourcePlayerId:C})})})}),n.players[C].board=n.players[C].board.filter(Boolean),R.maxPp=Math.min(10,R.maxPp+1),R.pp=R.maxPp,R.deck.length>0){const v=R.deck.pop();v&&(R.hand.length<9?R.hand.push(v):(R.graveyard.push(v),n.logs.push(`${R.name}${v.name}`)))}return R.board=R.board.filter(Boolean),R.board.forEach(v=>{v&&(v.canAttack=!0,v.attacksMade=0,v.turnPlayed=-1)}),R.canEvolveThisTurn=!0,n.activePlayerId=C,n.pendingEffects=P,C===t.firstPlayerId&&(n.turnCount+=1),n.logs.push(` ${n.turnCount} - ${R.name} `),n}case"CONCEDE":{const fe=e.playerId,re=n.players[fe];if(!re)return console.warn(`[Engine] CONCEDE: Unknown playerId: ${fe}. Ignoring.`),t;if(t.phase==="GAME_OVER")return console.warn("[Engine] CONCEDE: Game already over. Ignoring."),t;const P=pp(fe);return n.phase="GAME_OVER",n.winnerId=P,n.logs.push(`${re.name} `),console.log(`[Engine] CONCEDE: ${fe} surrendered. Winner: ${P}`),n}case"RESOLVE_EFFECT":{if(!n.pendingEffects||n.pendingEffects.length===0)return n;const[fe,...re]=n.pendingEffects;console.log(`[Engine] RESOLVE_EFFECT: Processing ${fe.effect.type} from ${fe.sourceCard.name}. Remaining: ${re.length}`);const P=((s=e.payload)==null?void 0:s.targetId)||fe.targetId;let C=d2(n,fe.sourcePlayerId,fe.sourceCard,fe.effect,P,fe.targetIds);const R=(C.pendingEffects||[]).filter(g=>{var T;return!((T=n.pendingEffects)!=null&&T.includes(g))}),v=[...re,...R];return console.log(`[Engine] RESOLVE_EFFECT done. Remaining: ${re.length}, NewlyAdded: ${R.length}, Final: ${v.length}`),v.length===0&&Object.values(C.players).forEach(g=>{g.board=g.board.filter(Boolean)}),{...C,pendingEffects:v}}case"PLAY_CARD":{if(!e.isRemote&&n.activePlayerId!==e.playerId)return n;const{cardIndex:fe,targetId:re,instanceId:P}=e.payload,C={...n.players.p1,hand:[...n.players.p1.hand],deck:[...n.players.p1.deck],board:[...n.players.p1.board],graveyard:[...n.players.p1.graveyard]},R={...n.players.p2,hand:[...n.players.p2.hand],deck:[...n.players.p2.deck],board:[...n.players.p2.board],graveyard:[...n.players.p2.graveyard]},v=e.playerId==="p1"?C:R;console.log(`[Engine] PLAY_CARD: playerId=${e.playerId}, cardIndex=${fe}, instanceId=${P}, handLength=${v.hand.length}, isRemote=${e.isRemote}`),console.log("[Engine] PLAY_CARD: hand cards:",v.hand.map(ee=>`${ee.name}(${ee.instanceId})`));let g=fe;if(P){const ee=v.hand.findIndex(Y=>Y.instanceId===P);if(ee>=0)g=ee,console.log(`[Engine] PLAY_CARD: Using instanceId ${P}, found at index ${ee} (was ${fe})`);else return console.log(`[Engine] PLAY_CARD: instanceId ${P} not found in hand!`),n}if(g<0||g>=v.hand.length)return console.log("[Engine] PLAY_CARD: Invalid cardIndex! Returning unchanged state."),n;const T=v.hand[g];let A="";if(re){const Y=(e.playerId==="p1"?R:C).board.find(Pe=>(Pe==null?void 0:Pe.instanceId)===re);Y&&(A=` (: ${Y.name})`)}if(n.logs.push(`${v.name}  ${T.name} ${A}`),v.pp<T.cost)return n;const y=v.board.filter(ee=>ee!==null).length;if(T.type==="FOLLOWER"&&y>=5)return n;const X=v.pp;v.pp-=T.cost,v.extraPpActive&&X-1<T.cost&&(v.id!==t.firstPlayerId&&(n.turnCount<=5?v.extraPpUsedEarly=!0:v.extraPpUsedLate=!0),v.extraPpActive=!1,v.pp<0&&(v.pp=0),console.log("[Engine] PLAY_CARD: Extra PP consumed, marked as used"),n.logs.push(`${v.name} PP`)),v.hand.splice(g,1);let F=T;if(T.type==="FOLLOWER"){const ee={...T,instanceId:e.payload.instanceId||`inst_${n.rngSeed}_${Math.floor(r()*1e3)}`,currentAttack:T.attack||0,currentHealth:T.health||0,maxHealth:T.health||0,canAttack:!1,hasEvolved:!1,attacksMade:0,turnPlayed:n.turnCount,hasBarrier:((i=T.passiveAbilities)==null?void 0:i.includes("BARRIER"))??!1,passiveAbilities:T.passiveAbilities?[...T.passiveAbilities]:[],hadStealth:((o=T.passiveAbilities)==null?void 0:o.includes("STEALTH"))??!1};((l=T.passiveAbilities)!=null&&l.includes("STORM")||(c=T.passiveAbilities)!=null&&c.includes("RUSH"))&&(ee.canAttack=!0),(d=ee.tags)!=null&&d.includes("Knuckler")&&!ee.passiveAbilities.includes("STORM")&&v.board.some(Pe=>(Pe==null?void 0:Pe.name)==="")&&(ee.passiveAbilities.push("STORM"),ee.canAttack=!0,n.logs.push(`${ee.name}   `)),v.board.push(ee),F=ee,ee.name===""&&v.board.forEach(Y=>{var Pe,xe;Y&&((Pe=Y.tags)!=null&&Pe.includes("Knuckler"))&&Y.instanceId!==ee.instanceId&&((xe=Y.passiveAbilities)!=null&&xe.includes("STORM")||(Y.passiveAbilities||(Y.passiveAbilities=[]),Y.passiveAbilities.push("STORM"),Y.canAttack=!0,n.logs.push(`${Y.name}   `)))})}else v.graveyard.push({...T,instanceId:`spell_${n.rngSeed}_${Math.floor(r()*1e3)}`});const ve=[];(u=T.triggers)==null||u.filter(ee=>ee.trigger==="FANFARE").forEach(ee=>ve.push(...ee.effects)),(h=T.triggerAbilities)!=null&&h.FANFARE&&ve.push(T.triggerAbilities.FANFARE);let ke=[...n.pendingEffects||[]];return ve.forEach(ee=>{if(ee.conditions&&ee.conditions.minTurn&&n.turnCount<ee.conditions.minTurn)return;let Y;if(ee.targetType==="OPPONENT"||ee.targetType==="SELF"||ee.targetType==="ALL_FOLLOWERS"||ee.targetType==="ALL_OTHER_FOLLOWERS"||ee.type==="RANDOM_DESTROY"||ee.type==="RANDOM_SET_HP"||ee.type==="AOE_DAMAGE"||ee.type==="RANDOM_DAMAGE"||ee.type==="RANDOM_DAMAGE_BY_TURN"){const xe=e.playerId==="p1"?"p2":"p1",$e=e.playerId;if(ee.type==="RANDOM_DAMAGE_BY_TURN"){const Te=ee.targetType==="SELF"?$e:xe,Ne=n.players[Te].board,mt=n.turnCount;Y=[];for(let tt=0;tt<mt;tt++){const st=Ne.map((B,We)=>B?We:-1).filter(B=>B!==-1);if(st.length===0)break;const qe=Math.floor(r()*st.length);Y.push(Ne[st[qe]].instanceId)}}else if(ee.type==="RANDOM_DESTROY"||ee.type==="RANDOM_SET_HP"||ee.type==="RANDOM_DAMAGE"){const Te=ee.targetType==="SELF"?$e:xe,Ne=n.players[Te].board,mt=ee.type==="RANDOM_DAMAGE"?ee.value2||1:ee.value||1,tt=Ne.map((qe,B)=>qe?B:-1).filter(qe=>qe!==-1);for(let qe=tt.length-1;qe>0;qe--){const B=Math.floor(r()*(qe+1));[tt[qe],tt[B]]=[tt[B],tt[qe]]}Y=tt.slice(0,mt).map(qe=>Ne[qe].instanceId)}else if(ee.targetType==="ALL_FOLLOWERS"||ee.type==="AOE_DAMAGE"){const Te=ee.type==="GRANT_PASSIVE"||ee.type==="BUFF_STATS",Ne=Te?$e:xe;Y=n.players[Ne].board.filter(tt=>tt!==null).map(tt=>tt.instanceId),console.log(`[Engine] Pre-calculated ALL_FOLLOWERS targets (${Te?"ally":"enemy"}): ${Y.length} units`)}else ee.targetType==="ALL_OTHER_FOLLOWERS"&&(Y=n.players[$e].board.filter(Ne=>Ne!==null&&Ne.instanceId!==F.instanceId).map(Ne=>Ne.instanceId))}const Pe=ee.targetType==="SELECT_FOLLOWER"||ee.targetType==="SELECT_ALLY_FOLLOWER"||ee.targetType==="SELECT_OTHER_ALLY_FOLLOWER";ke.push({sourceCard:F,effect:ee,sourcePlayerId:e.playerId,targetId:Pe?re:void 0,targetIds:Y})}),console.log(`[Engine] PLAY_CARD: Queued ${ve.length} effects. Total pending: ${ke.length}`),{...n,players:{p1:C,p2:R},pendingEffects:ke}}case"EVOLVE":{const{followerIndex:fe,targetId:re,useSep:P}=e.payload,C={...n.players.p1,hand:[...n.players.p1.hand],deck:[...n.players.p1.deck],board:n.players.p1.board.map(F=>F?{...F,passiveAbilities:F.passiveAbilities?[...F.passiveAbilities]:void 0}:null),graveyard:[...n.players.p1.graveyard]},R={...n.players.p2,hand:[...n.players.p2.hand],deck:[...n.players.p2.deck],board:n.players.p2.board.map(F=>F?{...F,passiveAbilities:F.passiveAbilities?[...F.passiveAbilities]:void 0}:null),graveyard:[...n.players.p2.graveyard]},v=e.playerId==="p1"?C:R,g=v.board[fe];if(!g||g.hasEvolved)return n;const T=e.isRemote;if(console.log(`[Engine] EVOLVE Logic: name=${g.name}, useSep=${P}, isRemote=${T}, turn=${t.turnCount}`),n.logs.push(`${v.name}  ${g.name} ${P?"":""}`),P){if(!T){if(t.turnCount<6)return console.log(`[Engine] Cannot Super Evolve: Turn ${t.turnCount} < 6`),n;if(v.sep<=0)return console.log("[Engine] Cannot Super Evolve: No SEP"),n;if(!v.canEvolveThisTurn)return console.log("[Engine] Cannot Super Evolve: Already evolved this turn"),n}v.sep=Math.max(0,v.sep-1),v.canEvolveThisTurn=!1,g.hasEvolved=!0,g.currentAttack+=3,g.currentHealth+=3,g.maxHealth+=3,g.canAttack=!0;const F=[...g.passiveAbilities||[]];F.includes("IMMUNE_TO_DAMAGE_MY_TURN")||F.push("IMMUNE_TO_DAMAGE_MY_TURN"),!F.includes("STORM")&&!F.includes("RUSH")&&F.push("RUSH"),g.passiveAbilities=F,console.log(`[Engine] Super Evolved ${g.name}! SEP remaining: ${v.sep}`)}else{if(!T){const ke=e.playerId===t.firstPlayerId?5:4;if(t.turnCount<ke)return console.log(`[Engine] Cannot Evolve: Turn ${t.turnCount} < ${ke}`),n;if(v.evolutionsUsed>=2)return console.log("[Engine] Cannot Evolve: Limit reached"),n;if(!v.canEvolveThisTurn)return console.log("[Engine] Cannot Evolve: Already evolved this turn"),n}v.evolutionsUsed+=1,v.canEvolveThisTurn=!1,g.hasEvolved=!0,g.currentAttack+=2,g.currentHealth+=2,g.maxHealth+=2,g.canAttack=!0;const F=[...g.passiveAbilities||[]];!F.includes("STORM")&&!F.includes("RUSH")&&F.push("RUSH"),g.passiveAbilities=F}const A=[];(f=g.triggers)==null||f.filter(F=>F.trigger==="EVOLVE").forEach(F=>A.push(...F.effects)),(S=g.triggerAbilities)!=null&&S.EVOLVE&&A.push(g.triggerAbilities.EVOLVE),P&&((k=g.triggers)==null||k.filter(F=>F.trigger==="SUPER_EVOLVE").forEach(F=>A.push(...F.effects)));let y=[...n.pendingEffects||[]];return A.forEach(F=>{if(F.conditions&&F.conditions.minTurn&&n.turnCount<F.conditions.minTurn)return;let ve;const ke=e.playerId==="p1"?"p2":"p1",Ee=e.playerId;if(F.type==="RANDOM_DESTROY"||F.type==="RANDOM_SET_HP"||F.type==="RANDOM_DAMAGE"){const ee=F.targetType==="SELF"?Ee:ke,Y=n.players[ee].board,Pe=F.type==="RANDOM_DAMAGE"?F.value2||1:F.value||1,xe=Y.map((Te,Ne)=>Te?Ne:-1).filter(Te=>Te!==-1);for(let Te=xe.length-1;Te>0;Te--){const Ne=Math.floor(r()*(Te+1));[xe[Te],xe[Ne]]=[xe[Ne],xe[Te]]}ve=xe.slice(0,Pe).map(Te=>Y[Te].instanceId)}else F.targetType==="ALL_FOLLOWERS"||F.type==="AOE_DAMAGE"?(ve=n.players[ke].board.filter(Y=>Y!==null).map(Y=>Y.instanceId),console.log(`[Engine EVOLVE] Pre-calculated ALL_FOLLOWERS targets: ${ve.length} units`)):F.targetType==="ALL_OTHER_FOLLOWERS"&&(ve=n.players[Ee].board.filter(Y=>Y!==null&&Y.instanceId!==g.instanceId).map(Y=>Y.instanceId));y.push({sourceCard:g,effect:F,sourcePlayerId:e.playerId,targetId:re,targetIds:ve})}),console.log(`[Engine] EVOLVE: Queued ${A.length} effects. Total pending: ${y.length}`),{...n,players:{p1:C,p2:R},pendingEffects:y}}case"ATTACK":{console.log(`[Engine] ATTACK received. Incoming state P1 HP: ${t.players.p1.hp}, P2 HP: ${t.players.p2.hp}`);const{attackerIndex:fe,targetIndex:re,targetIsLeader:P}=e.payload,C={...n.players.p1,board:n.players.p1.board.map(Y=>Y?{...Y,passiveAbilities:Y.passiveAbilities?[...Y.passiveAbilities]:void 0}:null),graveyard:[...n.players.p1.graveyard]},R={...n.players.p2,board:n.players.p2.board.map(Y=>Y?{...Y,passiveAbilities:Y.passiveAbilities?[...Y.passiveAbilities]:void 0}:null),graveyard:[...n.players.p2.graveyard]},v=e.playerId==="p1",g=v?C:R,T=v?R:C,A=g.board[fe];if(!A||!A.canAttack)return n;const y=T.board.filter(Y=>{var Pe,xe;return Y&&((Pe=Y.passiveAbilities)==null?void 0:Pe.includes("WARD"))&&!((xe=Y.passiveAbilities)!=null&&xe.includes("STEALTH"))}),X=((w=A.passiveAbilities)==null?void 0:w.includes("STEALTH"))||A.hadStealth;if(y.length>0&&!X){if(P)return console.log("[Engine] Attack blocked: Must attack Ward unit first."),n;const Y=T.board[re];if(Y&&!((j=Y.passiveAbilities)!=null&&j.includes("WARD")))return console.log("[Engine] Attack blocked: Must attack Ward unit first."),n}if(P===!1){const Y=T.board[re];if(Y&&((_=Y.passiveAbilities)!=null&&_.includes("STEALTH")))return console.log("[Engine] ATTACK blocked: Target has STEALTH"),n}const F=(x=A.passiveAbilities)==null?void 0:x.includes("RUSH"),ve=(I=A.passiveAbilities)==null?void 0:I.includes("STORM");if(F&&!ve&&P&&A.turnPlayed===n.turnCount)return console.log("[Engine] ATTACK blocked: RUSH unit cannot attack leader on the turn it was played"),n;(p=A.passiveAbilities)!=null&&p.includes("STEALTH")&&(A.passiveAbilities=A.passiveAbilities.filter(Y=>Y!=="STEALTH"),n.logs.push(`${A.name} `)),A.canAttack=!1,A.attacksMade=(A.attacksMade||0)+1,(D=A.passiveAbilities)!=null&&D.includes("DOUBLE_ATTACK")&&A.attacksMade<2&&(A.canAttack=!0);const ke=A.currentAttack;console.log(`[Engine] Attack: ${A.name} (${ke}) -> Target (Leader? ${P}). DefHP before: ${T.hp}`);const Ee=(Y,Pe)=>{var $e;const xe=($e=Y.triggers)==null?void 0:$e.find(Te=>Te.trigger==="LAST_WORD");if(xe){const Te=xe.effects.map(Ne=>({sourceCard:Y,effect:Ne,sourcePlayerId:Pe}));n.pendingEffects=[...n.pendingEffects||[],...Te],n.logs.push(`${Y.name} `),console.log(`[Engine] Last Word triggered for ${Y.name}. pendingEffects count: ${n.pendingEffects.length}`)}};if(P){const Y="";if(n.logs.push(`${A.name}  ${Y} `),T.leaderDamageShield)T.leaderDamageShield=!1,n.logs.push(`${A.name}  ${Y}  ${ke} `);else{const Pe=T.board.some($e=>{var Te;return(Te=$e==null?void 0:$e.passiveAbilities)==null?void 0:Te.includes("LEADER_DAMAGE_CAP")}),xe=Pe?Math.min(ke,1):ke;T.hp-=xe,Pe&&ke>1?n.logs.push(`${A.name}  ${Y}  ${ke} 1`):n.logs.push(`${A.name}  ${Y}  ${xe} `),T.hp<=0&&(n.winnerId=e.playerId)}}else{const Y=T.board[re];if(!Y)return console.log(`[Engine] Attack target at index ${re} no longer exists. Skipping.`),n;n.logs.push(`${A.name}  ${Y.name} `);let Pe=ke;(z=Y.passiveAbilities)!=null&&z.includes("IMMUNE_TO_FOLLOWER_DAMAGE")?(Pe=0,n.logs.push(`${Y.name} `)):Y.hasBarrier&&Pe>0?(Pe=0,Y.hasBarrier=!1,n.logs.push(`${Y.name} `)):n.logs.push(`${A.name}  ${Y.name}  ${Pe} `),Y.currentHealth-=Pe;const xe=v?"p2":"p1",$e=((te=Y.passiveAbilities)==null?void 0:te.includes("IMMUNE_TO_DAMAGE_MY_TURN"))&&n.activePlayerId===xe;(H=A.passiveAbilities)!=null&&H.includes("BANE")&&Y.currentHealth>0&&($e?n.logs.push(`${Y.name} `):(Y.currentHealth=0,Y.killedByBane=!0,n.logs.push(`${A.name}  ${Y.name} `)));let Te=Y.currentAttack;(q=A.passiveAbilities)!=null&&q.includes("IMMUNE_TO_DAMAGE_MY_TURN")&&(Te=0,n.logs.push(`${A.name} `)),A.hasBarrier&&Te>0?(Te=0,A.hasBarrier=!1,n.logs.push(`${A.name} `)):Te>0&&n.logs.push(`${Y.name}  ${A.name}  ${Te} `),A.currentHealth-=Te;const Ne=v?"p1":"p2";A.currentHealth<=0&&((ue=A.passiveAbilities)!=null&&ue.includes("GUTS_MY_TURN"))&&n.activePlayerId===Ne&&(A.currentHealth=1,n.logs.push(`${A.name} 1`));const mt=((ye=A.passiveAbilities)==null?void 0:ye.includes("IMMUNE_TO_DAMAGE_MY_TURN"))&&n.activePlayerId===Ne;(Me=Y.passiveAbilities)!=null&&Me.includes("BANE")&&A.currentHealth>0&&(mt?n.logs.push(`${A.name} `):(A.currentHealth=0,A.killedByBane=!0,n.logs.push(`${Y.name}  ${A.name} `)));const tt=Y.currentHealth<=0,st=A.currentHealth<=0;tt&&(Y.currentHealth=Math.min(0,Y.currentHealth),T.graveyard.push(Y),T.board[re]=null,n.logs.push(`${Y.name} `)),st&&(A.currentHealth=Math.min(0,A.currentHealth),g.graveyard.push(A),g.board[fe]=null,n.logs.push(`${A.name} `)),tt&&Ee(Y,v?"p2":"p1"),st&&Ee(A,v?"p1":"p2")}console.log(`[Engine] Committing state. P1 HP: ${C.hp}, P2 HP: ${R.hp}`);const ee={...n,players:{p1:C,p2:R}};return console.log(`[Engine] After commit. finalState.players.p1.hp: ${ee.players.p1.hp}, finalState.players.p2.hp: ${ee.players.p2.hp}`),ee}case"REINIT_GAME":{const{p1Class:fe,p2Class:re}=e.payload;return console.log(`[Engine] REINIT_GAME: p1=${fe}, p2=${re}`),rd("Player 1",fe,"Player 2",re)}case"SYNC_STATE":return console.log("[Engine] SYNC_STATE received"),e.payload;case"UPDATE_PLAYER_NAME":{const{playerId:fe,name:re}=e.payload;return console.log("[Engine] UPDATE_PLAYER_NAME:",fe,re),t.players[fe]?{...t,players:{...t.players,[fe]:{...t.players[fe],name:re}}}:(console.warn("[Engine] UPDATE_PLAYER_NAME: Unknown playerId:",fe),t)}case"TOGGLE_EXTRA_PP":{const fe=e.playerId,re=n.players[fe];if(!(fe!==t.firstPlayerId))return console.log("[Engine] TOGGLE_EXTRA_PP: Only second player can use Extra PP"),t;if(t.activePlayerId!==fe)return console.log("[Engine] TOGGLE_EXTRA_PP: Can only toggle on your turn"),t;if(re.extraPpActive)return re.extraPpActive=!1,re.pp=Math.max(0,re.pp-1),console.log("[Engine] TOGGLE_EXTRA_PP: Deactivated, PP now",re.pp),n;if(n.turnCount<=5){if(re.extraPpUsedEarly)return console.log("[Engine] TOGGLE_EXTRA_PP: Already used in early turns"),t}else if(re.extraPpUsedLate)return console.log("[Engine] TOGGLE_EXTRA_PP: Already used in late turns"),t;return re.extraPpActive=!0,re.pp+=1,console.log("[Engine] TOGGLE_EXTRA_PP: Activated, PP now",re.pp),n}default:return t}},ku=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},p2=ku("/leaders/azya_leader.png"),g2=ku("/leaders/senka_leader.png"),m2=ku("/leaders/yoRuka_leader.png"),y2=1280,v2=720,_2={SENKA:{primary:"#e94560",gradient:"linear-gradient(135deg, #2c0b0e 0%, #1a1a2e 100%)",shadow:"rgba(233, 69, 96, 0.3)"},AJA:{primary:"#45a2e9",gradient:"linear-gradient(135deg, #0f1c2e 0%, #1a1a2e 100%)",shadow:"rgba(69, 162, 233, 0.3)"},YORUKA:{primary:"#a855f7",gradient:"linear-gradient(135deg, #1a0f2e 0%, #1a1a2e 100%)",shadow:"rgba(168, 85, 247, 0.3)"}},x2={SENKA:"",AJA:"",YORUKA:"Y"},b2={SENKA:g2,AJA:p2,YORUKA:m2},Ea=["SENKA","AJA","YORUKA"],E2=({classType:t,onSelectCard:e})=>{const[n,r]=L.useState(1),[s,i]=L.useState(Ea.indexOf(t));L.useEffect(()=>{const D=()=>{const z=window.innerWidth/y2,te=window.innerHeight/v2;r(Math.min(z,te))};return D(),window.addEventListener("resize",D),()=>window.removeEventListener("resize",D)},[]);const o=D=>D==="SENKA"?Q1:D==="AJA"?J1:q1,l=Ea[s],d=o(l).filter(D=>!D.cardId.startsWith("TOKEN_")).map(D=>({card:Jn.find(z=>z.id===D.cardId),count:D.count})).filter(D=>D.card),u=_2[l],h=x2[l],f=b2[l],S=180*n,k=250*n,w=110*n,j=155*n,_=.6*n,x=1.8*n,I=()=>{i(D=>(D-1+Ea.length)%Ea.length)},p=()=>{i(D=>(D+1)%Ea.length)};return a.jsxs("div",{style:{minHeight:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",background:u.gradient,color:"white",position:"relative",paddingBottom:`${40*n}px`},children:[a.jsxs("h2",{style:{fontSize:`${x}rem`,marginTop:`${80*n}px`,marginBottom:`${20*n}px`,fontFamily:"sans-serif",color:u.primary,textShadow:`0 0 20px ${u.shadow}`},children:[h," - "]}),a.jsxs("div",{style:{display:"flex",gap:`${2*n}rem`,width:"95%",maxWidth:`${1100*n}px`,alignItems:"flex-start",justifyContent:"center"},children:[a.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:`${.8*n}rem`},children:[a.jsx("button",{onClick:I,style:{width:`${45*n}px`,height:`${45*n}px`,background:"rgba(0, 0, 0, 0.5)",border:`2px solid ${u.primary}`,borderRadius:"50%",color:u.primary,fontSize:`${1.5*n}rem`,cursor:"pointer",fontWeight:"bold",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},onMouseOver:D=>{D.currentTarget.style.background=u.primary,D.currentTarget.style.color="white"},onMouseOut:D=>{D.currentTarget.style.background="rgba(0, 0, 0, 0.5)",D.currentTarget.style.color=u.primary},children:"<"}),a.jsxs("div",{style:{width:S,height:k,border:`3px solid ${u.primary}`,borderRadius:10*n,background:"linear-gradient(180deg, rgba(0,0,0,0.5) 0%, rgba(0,0,0,0.8) 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",boxShadow:`0 8px 30px ${u.shadow}`,overflow:"hidden",position:"relative"},children:[a.jsx("img",{src:f,alt:h,style:{width:"100%",height:"75%",objectFit:"cover"}}),a.jsx("div",{style:{padding:`${8*n}px`,display:"flex",flexDirection:"column",alignItems:"center",width:"100%",justifyContent:"center",flex:1},children:a.jsx("h3",{style:{fontSize:`${1.2*n}rem`,color:u.primary,margin:0,fontFamily:"sans-serif"},children:h})})]}),a.jsx("button",{onClick:p,style:{width:`${45*n}px`,height:`${45*n}px`,background:"rgba(0, 0, 0, 0.5)",border:`2px solid ${u.primary}`,borderRadius:"50%",color:u.primary,fontSize:`${1.5*n}rem`,cursor:"pointer",fontWeight:"bold",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},onMouseOver:D=>{D.currentTarget.style.background=u.primary,D.currentTarget.style.color="white"},onMouseOut:D=>{D.currentTarget.style.background="rgba(0, 0, 0, 0.5)",D.currentTarget.style.color=u.primary},children:">"})]}),a.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:`${1*n}rem`},children:[a.jsx("div",{style:{display:"grid",gridTemplateColumns:`repeat(auto-fill, minmax(${w}px, 1fr))`,gap:`${_}rem`,width:"100%",padding:`${10*n}px`,maxHeight:`${(j+_*16)*3+40*n}px`,overflowY:"auto",overflowX:"hidden"},children:d.map(({card:D,count:z})=>a.jsxs("div",{onClick:()=>e(D.id),style:{width:w,height:j,border:`2px solid ${u.primary}`,borderRadius:8*n,background:"linear-gradient(180deg, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.9) 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"all 0.2s",boxShadow:`0 4px 15px ${u.shadow}`,position:"relative",overflow:"hidden"},onMouseOver:te=>{te.currentTarget.style.transform="translateY(-5px) scale(1.05)",te.currentTarget.style.boxShadow=`0 8px 25px ${u.shadow}`},onMouseOut:te=>{te.currentTarget.style.transform="translateY(0) scale(1)",te.currentTarget.style.boxShadow=`0 4px 15px ${u.shadow}`},children:[a.jsx("div",{style:{width:"100%",height:"65%",overflow:"hidden",borderBottom:`1px solid ${u.primary}`},children:a.jsx("img",{src:ku(D.imageUrl||`/cards/${D.id}.png`),alt:D.name,style:{width:"100%",height:"100%",objectFit:"cover"},onError:te=>{te.currentTarget.style.display="none"}})}),a.jsxs("div",{style:{padding:`${5*n}px`,textAlign:"center",flex:1,display:"flex",flexDirection:"column",justifyContent:"center",width:"100%"},children:[a.jsx("h3",{style:{fontSize:`${.7*n}rem`,margin:`0 0 ${3*n}px 0`,fontFamily:"sans-serif",color:u.primary,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:D.name}),a.jsxs("p",{style:{fontSize:`${.6*n}rem`,color:"#ffcc00",margin:0,fontFamily:"sans-serif",fontWeight:"bold"},children:[": ",D.cost]})]}),a.jsx("div",{style:{position:"absolute",bottom:`${5*n}px`,right:`${5*n}px`,background:"rgba(0, 0, 0, 0.8)",color:"white",borderRadius:50,width:`${22*n}px`,height:`${22*n}px`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${.7*n}rem`,fontWeight:"bold",fontFamily:"sans-serif",border:`2px solid ${u.primary}`,boxShadow:`0 0 10px ${u.shadow}`},children:z})]},D.id))}),a.jsxs("div",{style:{fontSize:`${.85*n}rem`,color:"#aaa",fontFamily:"sans-serif",textAlign:"center"},children:[" ",d.length," "]})]})]})]})},S2=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},I2=1280,w2=720,T2=({cardId:t,onOpenRelatedCard:e,onBack:n,onSetHomeCard:r})=>{const[s,i]=L.useState(1),[o,l]=L.useState(!1);L.useEffect(()=>{const _=()=>{const x=window.innerWidth/I2,I=window.innerHeight/w2;i(Math.min(x,I))};return _(),window.addEventListener("resize",_),()=>window.removeEventListener("resize",_)},[]);const c=Jn.find(_=>_.id===t);if(!c)return a.jsx("div",{style:{minHeight:"100dvh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",fontFamily:"sans-serif",fontSize:`${1.5*s}rem`},children:""});const d=(_,x)=>S2(_||x),u=d(c.imageUrl,`/cards/${c.id}.png`),h=c.type==="FOLLOWER"?d(c.evolvedImageUrl,`/cards/${c.id}_evolved.png`):null,f=200*s,S=280*s,k=1*s,w="linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #1a1a2e 100%)",j=()=>{r&&(r(t),l(!0),setTimeout(()=>l(!1),1500))};return a.jsxs("div",{style:{minHeight:"100dvh",display:"flex",flexDirection:"column",background:w,color:"white",fontFamily:"sans-serif",overflow:"auto",paddingTop:`${20*s}px`},children:[a.jsx("div",{style:{position:"absolute",top:`${15*s}px`,left:`${15*s}px`,zIndex:100},children:a.jsx("button",{onClick:n,style:{background:"rgba(255, 255, 255, 0.1)",padding:`${8*s}px ${16*s}px`,fontSize:`${.9*s}rem`,border:"1px solid rgba(255, 255, 255, 0.3)",borderRadius:`${6*s}px`,color:"white",cursor:"pointer",fontFamily:"sans-serif",transition:"all 0.2s"},onMouseOver:_=>_.currentTarget.style.background="rgba(255, 255, 255, 0.2)",onMouseOut:_=>_.currentTarget.style.background="rgba(255, 255, 255, 0.1)",children:""})}),a.jsxs("div",{style:{display:"flex",gap:`${2*s}rem`,padding:`${20*s}px ${30*s}px`,flex:1,justifyContent:"center",alignItems:"flex-start",maxWidth:`${1200*s}px`,width:"100%",margin:"0 auto"},children:[a.jsx("div",{style:{display:"flex",flexDirection:"row",alignItems:"flex-start",gap:`${k}rem`,flex:"0 0 auto"},children:c.type==="FOLLOWER"?a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*s}rem`},children:[a.jsx("div",{style:{width:f,height:S,border:"2px solid rgba(255, 255, 255, 0.3)",borderRadius:`${12*s}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.5)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:u,alt:`${c.name} `,style:{width:"100%",height:"100%",objectFit:"cover"}})}),a.jsx("div",{style:{fontSize:`${.75*s}rem`,color:"#aaa",textAlign:"center"},children:""})]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*s}rem`},children:[a.jsx("div",{style:{width:f,height:S,border:"2px solid rgba(255, 215, 0, 0.5)",borderRadius:`${12*s}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(255, 215, 0, 0.3)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:h||u,alt:`${c.name} `,style:{width:"100%",height:"100%",objectFit:"cover"}})}),a.jsx("div",{style:{fontSize:`${.75*s}rem`,color:"#ffd700",textAlign:"center"},children:""})]})]}):a.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*s}rem`},children:a.jsx("div",{style:{width:f,height:S,border:"2px solid rgba(138, 43, 226, 0.5)",borderRadius:`${12*s}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(138, 43, 226, 0.3)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:u,alt:c.name,style:{width:"100%",height:"100%",objectFit:"cover"}})})})}),a.jsxs("div",{style:{flex:"1 1 auto",maxWidth:`${450*s}px`,background:"rgba(0, 0, 0, 0.5)",padding:`${25*s}px`,borderRadius:`${12*s}px`,border:"1px solid rgba(255, 255, 255, 0.2)",display:"flex",flexDirection:"column",gap:`${18*s}px`,minHeight:`${450*s}px`,maxHeight:`${550*s}px`,overflowY:"auto"},children:[a.jsx("h2",{style:{fontSize:`${1.8*s}rem`,fontWeight:"bold",margin:0,color:"#fff",textAlign:"left"},children:c.name}),a.jsxs("div",{style:{display:"flex",gap:`${20*s}px`,fontSize:`${1.2*s}rem`,flexWrap:"wrap"},children:[a.jsxs("div",{style:{color:"#ffd700"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:c.cost})]}),c.type==="FOLLOWER"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{color:"#ff6b6b"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:c.attack})]}),a.jsxs("div",{style:{color:"#4ecdc4"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:c.health})]})]})]}),a.jsx("div",{style:{height:"1px",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)"}}),a.jsxs("div",{children:[a.jsx("h3",{style:{fontSize:`${1.1*s}rem`,margin:`0 0 ${8*s}px 0`,color:"#aaa"},children:""}),a.jsx("p",{style:{fontSize:`${1*s}rem`,margin:0,whiteSpace:"pre-wrap",lineHeight:1.7,color:"#fff"},children:c.description})]}),c.flavorText&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{height:"1px",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)"}}),a.jsxs("div",{children:[a.jsx("h3",{style:{fontSize:`${1.1*s}rem`,margin:`0 0 ${8*s}px 0`,color:"#aaa"},children:""}),a.jsx("p",{style:{fontSize:`${.95*s}rem`,margin:0,fontStyle:"italic",opacity:.7,lineHeight:1.7,whiteSpace:"pre-wrap",color:"#ccc"},children:c.flavorText})]})]}),a.jsxs("div",{style:{display:"flex",gap:`${12*s}px`,flexWrap:"wrap",marginTop:`${10*s}px`},children:[a.jsx("button",{onClick:j,disabled:o,style:{padding:`${.9*s}rem ${1.8*s}rem`,background:o?"#10b981":"#3b82f6",color:"white",border:"none",borderRadius:`${8*s}px`,fontSize:`${1*s}rem`,fontWeight:"bold",fontFamily:"sans-serif",cursor:o?"default":"pointer",transition:"all 0.2s",boxShadow:o?"0 4px 15px rgba(16, 185, 129, 0.3)":"0 4px 15px rgba(59, 130, 246, 0.3)",flex:1},onMouseOver:_=>{o||(_.currentTarget.style.background="#2563eb",_.currentTarget.style.transform="translateY(-2px)",_.currentTarget.style.boxShadow="0 6px 20px rgba(59, 130, 246, 0.4)")},onMouseOut:_=>{o||(_.currentTarget.style.background="#3b82f6",_.currentTarget.style.transform="translateY(0)",_.currentTarget.style.boxShadow="0 4px 15px rgba(59, 130, 246, 0.3)")},children:o?" ":""}),c.relatedCards&&c.relatedCards.length>0&&a.jsxs("button",{onClick:()=>e(t),style:{padding:`${.9*s}rem ${1.8*s}rem`,background:"#4ade80",color:"white",border:"none",borderRadius:`${8*s}px`,fontSize:`${1*s}rem`,fontWeight:"bold",fontFamily:"sans-serif",cursor:"pointer",transition:"all 0.2s",boxShadow:"0 4px 15px rgba(74, 222, 128, 0.3)",flex:1},onMouseOver:_=>{_.currentTarget.style.background="#22c55e",_.currentTarget.style.transform="translateY(-2px)",_.currentTarget.style.boxShadow="0 6px 20px rgba(74, 222, 128, 0.4)"},onMouseOut:_=>{_.currentTarget.style.background="#4ade80",_.currentTarget.style.transform="translateY(0)",_.currentTarget.style.boxShadow="0 4px 15px rgba(74, 222, 128, 0.3)"},children:[" (",c.relatedCards.length,")"]})]})]})]})]})},C2=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},k2=1280,R2=720,A2=({parentCardId:t,relatedCardIds:e,onBack:n})=>{const[r,s]=L.useState(1),[i,o]=L.useState(0);L.useEffect(()=>{const I=()=>{const p=window.innerWidth/k2,D=window.innerHeight/R2;s(Math.min(p,D))};return I(),window.addEventListener("resize",I),()=>window.removeEventListener("resize",I)},[]);const l=e[i],c=Jn.find(I=>I.id===l),d=()=>{o(I=>I>0?I-1:e.length-1)},u=()=>{o(I=>I<e.length-1?I+1:0)};if(!c)return a.jsx("div",{style:{minHeight:"100dvh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",fontFamily:"Tamanegi, sans-serif",fontSize:`${1.5*r}rem`},children:""});const h=(I,p)=>C2(I||p),f=h(c.imageUrl,`/cards/${c.id}.png`),S=c.type==="FOLLOWER"?h(c.evolvedImageUrl,`/cards/${c.id}_evolved.png`):null,k=200*r,w=280*r,j=2*r,_="linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #1a1a2e 100%)",x={fontSize:`${3*r}rem`,background:"rgba(0, 0, 0, 0.5)",padding:`${1*r}rem`,borderRadius:`${8*r}px`,cursor:"pointer",border:"1px solid rgba(255, 255, 255, 0.2)",color:"white",transition:"all 0.2s",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",width:`${60*r}px`,height:`${60*r}px`};return a.jsxs("div",{style:{minHeight:"100dvh",display:"flex",flexDirection:"column",background:_,color:"white",fontFamily:"Tamanegi, sans-serif",overflow:"auto",paddingBottom:`${40*r}px`},children:[a.jsxs("div",{style:{position:"sticky",top:0,left:0,padding:`${20*r}px`,zIndex:100,background:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(10px)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[a.jsx("button",{onClick:n,style:{background:"rgba(255, 255, 255, 0.1)",padding:`${10*r}px ${20*r}px`,fontSize:`${1*r}rem`,border:"1px solid rgba(255, 255, 255, 0.3)",borderRadius:`${8*r}px`,color:"white",cursor:"pointer",fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s"},onMouseOver:I=>I.currentTarget.style.background="rgba(255, 255, 255, 0.2)",onMouseOut:I=>I.currentTarget.style.background="rgba(255, 255, 255, 0.1)",children:""}),a.jsxs("div",{style:{fontSize:`${1.2*r}rem`,opacity:.8,fontWeight:"bold"},children:[i+1," / ",e.length]})]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${30*r}px`,padding:`${20*r}px`,flex:1},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:`${20*r}px`,flexWrap:"wrap"},children:[a.jsx("button",{onClick:d,style:x,onMouseOver:I=>I.currentTarget.style.background="rgba(0, 0, 0, 0.7)",onMouseOut:I=>I.currentTarget.style.background="rgba(0, 0, 0, 0.5)",children:"<"}),a.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:`${j}rem`,flexWrap:"wrap"},children:c.type==="FOLLOWER"?a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{width:k,height:w,border:"2px solid rgba(255, 255, 255, 0.3)",borderRadius:`${12*r}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.5)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:f,alt:`${c.name} `,style:{width:"100%",height:"100%",objectFit:"cover"}})}),a.jsx("div",{style:{width:k,height:w,border:"2px solid rgba(255, 215, 0, 0.5)",borderRadius:`${12*r}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(255, 215, 0, 0.3)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:S||f,alt:`${c.name} `,style:{width:"100%",height:"100%",objectFit:"cover"}})})]}):a.jsx("div",{style:{width:k,height:w,border:"2px solid rgba(138, 43, 226, 0.5)",borderRadius:`${12*r}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(138, 43, 226, 0.3)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:f,alt:c.name,style:{width:"100%",height:"100%",objectFit:"cover"}})})}),a.jsx("button",{onClick:u,style:x,onMouseOver:I=>I.currentTarget.style.background="rgba(0, 0, 0, 0.7)",onMouseOut:I=>I.currentTarget.style.background="rgba(0, 0, 0, 0.5)",children:">"})]}),a.jsxs("div",{style:{maxWidth:`${600*r}px`,width:"90%",background:"rgba(0, 0, 0, 0.5)",padding:`${25*r}px`,borderRadius:`${12*r}px`,border:"1px solid rgba(255, 255, 255, 0.2)",display:"flex",flexDirection:"column",gap:`${15*r}px`},children:[a.jsx("h2",{style:{fontSize:`${1.8*r}rem`,fontWeight:"bold",margin:0,color:"#fff",textAlign:"center"},children:c.name}),a.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:`${20*r}px`,fontSize:`${1.2*r}rem`,flexWrap:"wrap"},children:[a.jsxs("div",{style:{color:"#ffd700"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:c.cost})]}),c.type==="FOLLOWER"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{color:"#ff6b6b"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:c.attack})]}),a.jsxs("div",{style:{color:"#4ecdc4"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:c.health})]})]})]}),a.jsx("div",{style:{height:"1px",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)"}}),a.jsxs("div",{children:[a.jsx("h3",{style:{fontSize:`${1.1*r}rem`,margin:`0 0 ${8*r}px 0`,color:"#aaa"},children:""}),a.jsx("p",{style:{fontSize:`${1*r}rem`,margin:0,whiteSpace:"pre-wrap",lineHeight:1.6,color:"#fff"},children:c.description})]}),c.flavorText&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{height:"1px",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)"}}),a.jsxs("div",{children:[a.jsx("h3",{style:{fontSize:`${1.1*r}rem`,margin:`0 0 ${8*r}px 0`,color:"#aaa"},children:""}),a.jsx("p",{style:{fontSize:`${.9*r}rem`,margin:0,fontStyle:"italic",opacity:.7,lineHeight:1.6,whiteSpace:"pre-wrap",color:"#ccc"},children:c.flavorText})]})]})]})]})]})},bs=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},P2=1280,O2=720,L2=bs("/leaders/azya_leader.png"),D2=bs("/leaders/senka_leader.png"),M2=bs("/leaders/yoRuka_leader.png"),N2=({onStartConfig:t,audioSettings:e,onAudioSettingsChange:n,playerId:r,onSetHomeCard:s,isAnonymous:i=!0,userId:o=null,onNavigateToRegister:l,onNavigateToLogin:c,onNavigateToProfile:d,onLogout:u})=>{const[h,f]=L.useState("title"),[S,k]=L.useState(!1);L.useEffect(()=>{console.log(" TitleScreen auth state:",{isAnonymous:i,userId:o})},[i,o]);const[w,j]=L.useState("home"),[_,x]=L.useState(!1),[I,p]=L.useState(""),[D,z]=L.useState(!1),[te,H]=L.useState("class"),[q,ue]=L.useState(null),[ye,Me]=L.useState(null),[fe,re]=L.useState([]),[P]=L.useState(()=>localStorage.getItem("homeCardId")),[C,R]=L.useState(25),[v,g]=L.useState(!1),T=L.useRef(0),A=L.useRef(0),[y,X]=L.useState(1);L.useEffect(()=>{const B=()=>{const We=window.innerWidth/P2,ut=window.innerHeight/O2;X(Math.min(We,ut))};return B(),window.addEventListener("resize",B),()=>window.removeEventListener("resize",B)},[]);const F=()=>{k(!0),setTimeout(()=>{f("home"),k(!1)},600)},ve=B=>{g(!0),T.current=B.clientX,A.current=C},ke=B=>{if(!v)return;const We=B.clientX-T.current,ut=A.current+We*.5;R(Math.max(-180,Math.min(180,ut)))},Ee=()=>{g(!1)},ee=B=>{t(B==="casual"?"CASUAL_MATCH":"RANKED_MATCH")},Y=()=>{z(!0)},Pe=()=>{z(!1),u&&u()},xe=()=>{z(!1)},$e=B=>{ue(B),H("card-list")},Te=B=>{Me(B),H("card-detail")},Ne=B=>{const We=Jn.find(ut=>ut.id===B);We&&We.relatedCards&&We.relatedCards.length>0&&(Me(B),re(We.relatedCards),H("related-card"))},mt=()=>{Me(null),H("card-list")},tt=()=>{re([]),H("card-detail")};L.useEffect(()=>{w!=="gallery"&&(H("class"),ue(null),Me(null),re([]))},[w]);const st=9*y;if(h==="title")return a.jsxs("div",{className:"screen title-screen",onClick:F,style:{height:"100dvh",width:"100vw",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative",overflow:"hidden",color:"white",cursor:"pointer"},children:[a.jsx("div",{style:{position:"absolute",inset:0,backgroundImage:`url(${bs("/title/background.png")})`,backgroundSize:"cover",backgroundPosition:"center",zIndex:0}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",zIndex:-1}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(0, 0, 0, 0.3)",zIndex:1}}),a.jsxs("div",{style:{position:"relative",zIndex:2,display:"flex",flexDirection:"column",alignItems:"center",transform:S?"translateY(-100vh)":"translateY(0)",transition:S?"transform 0.6s ease-in":"none"},children:[a.jsx("div",{style:{fontFamily:"Tamanegi, sans-serif",fontSize:`${st}rem`,color:"#fff",textShadow:"0 0 30px rgba(233, 69, 96, 0.9), 0 0 60px rgba(233, 69, 96, 0.5), 3px 3px 6px rgba(0,0,0,0.9)",letterSpacing:`${.5*y}rem`,whiteSpace:"nowrap",marginBottom:`${2*y}rem`},children:""}),a.jsx("div",{style:{fontSize:`${2*y}rem`,color:"#fff",fontWeight:"bold",letterSpacing:`${.3*y}rem`,animation:"blink 1.5s ease-in-out infinite",textShadow:"0 0 10px rgba(255, 255, 255, 0.8)"},children:"GAME START"})]}),a.jsx("p",{style:{position:"absolute",bottom:20*y,opacity:.5,fontSize:`${.8*y}rem`,zIndex:2},children:"Ver 1.04 Beta"}),a.jsx("style",{children:`
                    @keyframes blink {
                        0%, 100% { opacity: 1; }
                        50% { opacity: 0.3; }
                    }
                `})]});const qe=[{id:"solo",label:"",color:"#e94560"},{id:"room",label:"",color:"#60a5fa"},{id:"random",label:"",color:"#4ade80"},{id:"home",label:"",color:"#f59e0b"},{id:"ranking",label:"",color:"#a855f7"},{id:"gallery",label:"",color:"#ec4899"},{id:"settings",label:"",color:"#6b7280"}];return a.jsxs("div",{className:"screen home-screen",style:{height:"100dvh",width:"100vw",display:"flex",flexDirection:"column",position:"relative",overflow:"hidden",color:"white"},onMouseMove:ke,onMouseUp:Ee,onMouseLeave:Ee,children:[a.jsx("div",{style:{position:"absolute",inset:0,backgroundImage:`url(${bs("/title/background.png")})`,backgroundSize:"cover",backgroundPosition:"center",zIndex:0}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",zIndex:-1}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(0, 0, 0, 0.5)",zIndex:1}}),a.jsx("div",{style:{position:"absolute",top:20*y,left:"50%",transform:"translateX(-50%)",fontFamily:"Tamanegi, sans-serif",fontSize:`${2.5*y}rem`,color:"#fff",textShadow:"0 0 15px rgba(233, 69, 96, 0.7)",letterSpacing:`${.2*y}rem`,zIndex:10},children:""}),a.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",paddingBottom:80*y,position:"relative",zIndex:2},children:[w==="home"&&a.jsxs("div",{style:{position:"absolute",left:50*y,top:"50%",transform:"translateY(-50%)",perspective:1e3},children:[a.jsxs("div",{onMouseDown:ve,style:{width:200*y,height:280*y,transformStyle:"preserve-3d",transform:`rotateY(${C}deg)`,transition:v?"none":"transform 0.3s ease-out",cursor:v?"grabbing":"grab"},children:[a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",borderRadius:12*y,background:P?`url(${bs(`/cards/${P}.png`)})`:"linear-gradient(135deg, #2d3748 0%, #1a202c 100%)",backgroundSize:"cover",backgroundPosition:"center",border:`3px solid ${P?"#e94560":"#4a5568"}`,boxShadow:"0 10px 30px rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center"},children:!P&&a.jsxs("span",{style:{fontSize:`${.9*y}rem`,color:"#718096",textAlign:"center",padding:20*y},children:["",a.jsx("br",{}),"",a.jsx("br",{}),""]})}),a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",transform:"rotateY(180deg)",borderRadius:12*y,background:P?`url(${bs(`/cards/${P}_evolved.png`)})`:`url(${bs("/cards/sleeve_default.png")})`,backgroundSize:"cover",backgroundPosition:"center",border:`3px solid ${P?"#a855f7":"#4a5568"}`,boxShadow:"0 10px 30px rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center"},children:!P&&a.jsx("span",{style:{fontSize:`${.8*y}rem`,color:"#718096"},children:""})})]}),a.jsx("p",{style:{textAlign:"center",marginTop:10*y,fontSize:`${.75*y}rem`,color:"#888"},children:""})]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",maxWidth:600*y},children:[w==="home"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*y}rem`,marginBottom:`${1*y}rem`},children:""}),a.jsx("p",{style:{fontSize:`${1*y}rem`,color:"#aaa"},children:""})]}),w==="solo"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*y}rem`,marginBottom:`${1*y}rem`,color:"#e94560"},children:""}),a.jsx("button",{onClick:()=>t("CPU"),style:{padding:`${1*y}rem ${3*y}rem`,fontSize:`${1.2*y}rem`,background:"#e94560",border:"none",borderRadius:8*y,color:"white",cursor:"pointer",fontWeight:"bold"},children:"CPU"})]}),w==="room"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*y}rem`,marginBottom:`${1.5*y}rem`,color:"#60a5fa"},children:""}),_?a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:`${1*y}rem`,alignItems:"center"},children:[a.jsx("input",{type:"text",placeholder:"ID",value:I,onChange:B=>p(B.target.value),style:{padding:`${.8*y}rem`,fontSize:`${1*y}rem`,width:250*y,background:"rgba(255,255,255,0.1)",border:"2px solid #a855f7",borderRadius:8*y,color:"white",textAlign:"center"}}),a.jsxs("div",{style:{display:"flex",gap:`${.5*y}rem`},children:[a.jsx("button",{onClick:()=>x(!1),style:{padding:`${.6*y}rem ${1.5*y}rem`,fontSize:`${1*y}rem`,background:"transparent",border:"1px solid #666",borderRadius:6*y,color:"#888",cursor:"pointer"},children:""}),a.jsx("button",{onClick:()=>t("JOIN",I),disabled:!I,style:{padding:`${.6*y}rem ${1.5*y}rem`,fontSize:`${1*y}rem`,background:I?"#a855f7":"#333",border:"none",borderRadius:6*y,color:"white",cursor:I?"pointer":"not-allowed",opacity:I?1:.5},children:""})]})]}):a.jsxs("div",{style:{display:"flex",gap:`${3*y}rem`,perspective:1200},children:[a.jsxs("div",{onClick:()=>t("HOST"),style:{width:200*y,height:280*y,background:"linear-gradient(135deg, #1a2a3a 0%, #0d1a2a 100%)",border:"3px solid #60a5fa",borderRadius:16*y,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(96, 165, 250, 0.3)"},onMouseOver:B=>{B.currentTarget.style.transform="rotateY(0deg) scale(1.05)",B.currentTarget.style.boxShadow="0 15px 40px rgba(96, 165, 250, 0.5)"},onMouseOut:B=>{B.currentTarget.style.transform="rotateY(15deg)",B.currentTarget.style.boxShadow="0 10px 30px rgba(96, 165, 250, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*y}rem`,marginBottom:`${.5*y}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*y}rem`,color:"#60a5fa",margin:0,marginBottom:`${.5*y}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*y}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*y}rem`},children:["ID",a.jsx("br",{}),""]})]}),a.jsxs("div",{onClick:()=>x(!0),style:{width:200*y,height:280*y,background:"linear-gradient(135deg, #2a1a3a 0%, #1a0d2a 100%)",border:"3px solid #a855f7",borderRadius:16*y,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(-15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(168, 85, 247, 0.3)"},onMouseOver:B=>{B.currentTarget.style.transform="rotateY(0deg) scale(1.05)",B.currentTarget.style.boxShadow="0 15px 40px rgba(168, 85, 247, 0.5)"},onMouseOut:B=>{B.currentTarget.style.transform="rotateY(-15deg)",B.currentTarget.style.boxShadow="0 10px 30px rgba(168, 85, 247, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*y}rem`,marginBottom:`${.5*y}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*y}rem`,color:"#a855f7",margin:0,marginBottom:`${.5*y}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*y}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*y}rem`},children:["ID",a.jsx("br",{}),""]})]})]})]}),w==="random"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*y}rem`,marginBottom:`${1.5*y}rem`,color:"#4ade80"},children:""}),a.jsxs("div",{style:{display:"flex",gap:`${3*y}rem`,perspective:1200},children:[a.jsxs("div",{onClick:()=>ee("casual"),style:{width:200*y,height:280*y,background:"linear-gradient(135deg, #1a3a1a 0%, #0d2d0d 100%)",border:"3px solid #4ade80",borderRadius:16*y,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(74, 222, 128, 0.3)"},onMouseOver:B=>{B.currentTarget.style.transform="rotateY(0deg) scale(1.05)",B.currentTarget.style.boxShadow="0 15px 40px rgba(74, 222, 128, 0.5)"},onMouseOut:B=>{B.currentTarget.style.transform="rotateY(15deg)",B.currentTarget.style.boxShadow="0 10px 30px rgba(74, 222, 128, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*y}rem`,marginBottom:`${.5*y}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*y}rem`,color:"#4ade80",margin:0,marginBottom:`${.5*y}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*y}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*y}rem`},children:["",a.jsx("br",{}),""]})]}),a.jsxs("div",{onClick:()=>ee("ranked"),style:{width:200*y,height:280*y,background:"linear-gradient(135deg, #3a1a1a 0%, #2d0d0d 100%)",border:"3px solid #e94560",borderRadius:16*y,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(-15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(233, 69, 96, 0.3)"},onMouseOver:B=>{B.currentTarget.style.transform="rotateY(0deg) scale(1.05)",B.currentTarget.style.boxShadow="0 15px 40px rgba(233, 69, 96, 0.5)"},onMouseOut:B=>{B.currentTarget.style.transform="rotateY(-15deg)",B.currentTarget.style.boxShadow="0 10px 30px rgba(233, 69, 96, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*y}rem`,marginBottom:`${.5*y}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*y}rem`,color:"#e94560",margin:0,marginBottom:`${.5*y}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*y}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*y}rem`},children:["",a.jsx("br",{}),""]})]})]})]}),w==="ranking"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*y}rem`,marginBottom:`${1*y}rem`,color:"#a855f7"},children:""}),a.jsx("p",{style:{fontSize:`${1*y}rem`,color:"#888"},children:"Coming Soon..."})]}),w==="gallery"&&a.jsxs(a.Fragment,{children:[te==="class"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*y}rem`,marginBottom:`${1.5*y}rem`,color:"#ec4899"},children:" - "}),a.jsxs("div",{style:{display:"flex",gap:`${1.2*y}rem`,justifyContent:"center",marginBottom:`${1*y}rem`},children:[a.jsxs("div",{onClick:()=>$e("SENKA"),style:{width:200*y,height:280*y,border:"1px solid #444",borderRadius:10*y,background:"linear-gradient(180deg, #2c0b0e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:"0 4px 20px rgba(233, 69, 96, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:B=>{B.currentTarget.style.transform="scale(1.05)",B.currentTarget.style.boxShadow="0 8px 30px rgba(233, 69, 96, 0.4)"},onMouseOut:B=>{B.currentTarget.style.transform="scale(1)",B.currentTarget.style.boxShadow="0 4px 20px rgba(233, 69, 96, 0.2)"},children:[a.jsx("img",{src:D2,alt:"Senka",style:{width:"100%",height:"75%",objectFit:"cover"}}),a.jsx("div",{style:{padding:`${8*y}px`,display:"flex",flexDirection:"column",alignItems:"center",width:"100%",justifyContent:"center",flex:1},children:a.jsx("h3",{style:{fontSize:`${1.4*y}rem`,color:"#e94560",margin:0,fontFamily:"sans-serif"},children:""})})]}),a.jsxs("div",{onClick:()=>$e("AJA"),style:{width:200*y,height:280*y,border:"1px solid #444",borderRadius:10*y,background:"linear-gradient(180deg, #0f1c2e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:"0 4px 20px rgba(69, 162, 233, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:B=>{B.currentTarget.style.transform="scale(1.05)",B.currentTarget.style.boxShadow="0 8px 30px rgba(69, 162, 233, 0.4)"},onMouseOut:B=>{B.currentTarget.style.transform="scale(1)",B.currentTarget.style.boxShadow="0 4px 20px rgba(69, 162, 233, 0.2)"},children:[a.jsx("img",{src:L2,alt:"Azya",style:{width:"100%",height:"75%",objectFit:"cover",objectPosition:"center top"}}),a.jsx("div",{style:{padding:`${8*y}px`,display:"flex",flexDirection:"column",alignItems:"center",width:"100%",justifyContent:"center",flex:1},children:a.jsx("h3",{style:{fontSize:`${1.4*y}rem`,color:"#45a2e9",margin:0,fontFamily:"sans-serif"},children:""})})]}),a.jsxs("div",{onClick:()=>$e("YORUKA"),style:{width:200*y,height:280*y,border:"1px solid #444",borderRadius:10*y,background:"linear-gradient(180deg, #1a0f2e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:"0 4px 20px rgba(168, 85, 247, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:B=>{B.currentTarget.style.transform="scale(1.05)",B.currentTarget.style.boxShadow="0 8px 30px rgba(168, 85, 247, 0.4)"},onMouseOut:B=>{B.currentTarget.style.transform="scale(1)",B.currentTarget.style.boxShadow="0 4px 20px rgba(168, 85, 247, 0.2)"},children:[a.jsx("img",{src:M2,alt:"Yoruka",style:{width:"100%",height:"75%",objectFit:"cover"}}),a.jsx("div",{style:{padding:`${8*y}px`,display:"flex",flexDirection:"column",alignItems:"center",width:"100%",justifyContent:"center",flex:1},children:a.jsx("h3",{style:{fontSize:`${1.4*y}rem`,color:"#a855f7",margin:0,fontFamily:"sans-serif"},children:"Y"})})]})]})]}),te==="card-list"&&q&&a.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"auto"},children:a.jsx(E2,{classType:q,onSelectCard:Te})}),te==="card-detail"&&ye&&a.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"auto"},children:a.jsx(T2,{cardId:ye,onOpenRelatedCard:Ne,onBack:mt,onSetHomeCard:s})}),te==="related-card"&&ye&&a.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"auto"},children:a.jsx(A2,{parentCardId:ye,relatedCardIds:fe,onBack:tt})})]}),w==="settings"&&a.jsxs("div",{style:{background:"rgba(0, 0, 0, 0.3)",borderRadius:12*y,padding:`${2*y}rem`,minWidth:400*y},children:[a.jsx("h2",{style:{fontSize:`${1.8*y}rem`,marginBottom:`${1.5*y}rem`,color:"#6b7280",textAlign:"center"},children:""}),a.jsxs("div",{style:{marginBottom:`${1.5*y}rem`},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:`${.5*y}rem`},children:[a.jsx("span",{style:{fontSize:`${1*y}rem`},children:"BGM"}),a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8*y,cursor:"pointer"},children:[a.jsx("input",{type:"checkbox",checked:e.bgmEnabled,onChange:B=>n({bgmEnabled:B.target.checked}),style:{width:18*y,height:18*y}}),a.jsx("span",{style:{color:e.bgmEnabled?"#4ade80":"#888",fontSize:`${.9*y}rem`},children:e.bgmEnabled?"ON":"OFF"})]})]}),a.jsx("input",{type:"range",min:0,max:1,step:.05,value:e.bgm,onChange:B=>n({bgm:parseFloat(B.target.value)}),disabled:!e.bgmEnabled,style:{width:"100%",opacity:e.bgmEnabled?1:.5}})]}),a.jsxs("div",{style:{marginBottom:`${1.5*y}rem`},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:`${.5*y}rem`},children:[a.jsx("span",{style:{fontSize:`${1*y}rem`},children:""}),a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8*y,cursor:"pointer"},children:[a.jsx("input",{type:"checkbox",checked:e.seEnabled,onChange:B=>n({seEnabled:B.target.checked}),style:{width:18*y,height:18*y}}),a.jsx("span",{style:{color:e.seEnabled?"#4ade80":"#888",fontSize:`${.9*y}rem`},children:e.seEnabled?"ON":"OFF"})]})]}),a.jsx("input",{type:"range",min:0,max:1,step:.05,value:e.se,onChange:B=>n({se:parseFloat(B.target.value)}),disabled:!e.seEnabled,style:{width:"100%",opacity:e.seEnabled?1:.5}})]}),a.jsxs("div",{style:{borderTop:"1px solid rgba(255, 255, 255, 0.1)",paddingTop:`${1.5*y}rem`,marginTop:`${1*y}rem`,marginBottom:`${1.5*y}rem`},children:[a.jsx("h3",{style:{fontSize:`${1.2*y}rem`,marginBottom:`${1*y}rem`,color:"#fff"},children:""}),a.jsx("button",{onClick:d,style:{width:"100%",padding:`${.6*y}rem ${1*y}rem`,fontSize:`${.9*y}rem`,background:"linear-gradient(135deg, #a855f7 0%, #7c3aed 100%)",border:"none",borderRadius:6*y,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s"},onMouseEnter:B=>B.currentTarget.style.transform="scale(1.05)",onMouseLeave:B=>B.currentTarget.style.transform="scale(1)",children:""})]}),a.jsxs("div",{style:{borderTop:"1px solid rgba(255, 255, 255, 0.1)",paddingTop:`${1.5*y}rem`,marginTop:`${1*y}rem`},children:[a.jsx("h3",{style:{fontSize:`${1.2*y}rem`,marginBottom:`${1*y}rem`,color:"#fff"},children:""}),i?a.jsxs("div",{children:[a.jsx("p",{style:{fontSize:`${.9*y}rem`,color:"#aaa",marginBottom:`${1*y}rem`},children:""}),a.jsxs("div",{style:{display:"flex",gap:10*y,marginBottom:`${1*y}rem`},children:[a.jsx("button",{onClick:l,style:{flex:1,padding:`${.6*y}rem ${1*y}rem`,fontSize:`${.9*y}rem`,background:"linear-gradient(135deg, #4a9eff 0%, #357abd 100%)",border:"none",borderRadius:6*y,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s"},onMouseEnter:B=>B.currentTarget.style.transform="scale(1.05)",onMouseLeave:B=>B.currentTarget.style.transform="scale(1)",children:""}),a.jsx("button",{onClick:c,style:{flex:1,padding:`${.6*y}rem ${1*y}rem`,fontSize:`${.9*y}rem`,background:"#555",border:"none",borderRadius:6*y,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s"},onMouseEnter:B=>B.currentTarget.style.background="#666",onMouseLeave:B=>B.currentTarget.style.background="#555",children:""})]}),a.jsx("p",{style:{fontSize:`${.75*y}rem`,color:"#888",textAlign:"center",lineHeight:1.4},children:""})]}):a.jsxs("div",{children:[a.jsx("p",{style:{fontSize:`${.9*y}rem`,color:"#4ade80",marginBottom:`${.5*y}rem`,fontWeight:"bold"},children:""}),a.jsxs("p",{style:{fontSize:`${.85*y}rem`,color:"#fff",marginBottom:`${.3*y}rem`},children:["ID: ",a.jsx("span",{style:{color:"#4a9eff",fontWeight:"bold"},children:o||""})]}),a.jsx("button",{onClick:Y,style:{width:"100%",padding:`${.6*y}rem ${1*y}rem`,fontSize:`${.9*y}rem`,background:"#d32f2f",border:"none",borderRadius:6*y,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s",marginTop:`${.5*y}rem`},onMouseEnter:B=>B.currentTarget.style.background="#b71c1c",onMouseLeave:B=>B.currentTarget.style.background="#d32f2f",children:""})]})]})]})]})]}),a.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:70*y,background:"rgba(0, 0, 0, 0.8)",borderTop:"2px solid rgba(255, 255, 255, 0.1)",display:"flex",justifyContent:"center",alignItems:"center",gap:`${.5*y}rem`,padding:`0 ${1*y}rem`,zIndex:3},children:qe.map(B=>a.jsx("button",{onClick:()=>j(B.id),style:{flex:1,maxWidth:140*y,padding:`${.6*y}rem ${.5*y}rem`,fontSize:`${.85*y}rem`,background:w===B.id?B.color:"transparent",border:w===B.id?"none":`2px solid ${B.color}`,borderRadius:8*y,color:w===B.id?"white":B.color,cursor:"pointer",transition:"all 0.2s",fontWeight:w===B.id?"bold":"normal"},children:B.label},B.id))}),a.jsx("p",{style:{position:"absolute",bottom:75*y,right:20*y,opacity:.5,fontSize:`${.7*y}rem`,zIndex:2},children:"Ver 1.04 Beta"}),D&&a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0, 0, 0, 0.7)",zIndex:100},children:a.jsxs("div",{style:{background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",borderRadius:12*y,padding:`${2*y}rem`,minWidth:300*y,border:"2px solid rgba(255, 255, 255, 0.2)",boxShadow:"0 10px 30px rgba(0, 0, 0, 0.5)"},children:[a.jsx("h3",{style:{fontSize:`${1.2*y}rem`,marginBottom:`${1*y}rem`,color:"#fff",textAlign:"center"},children:""}),a.jsxs("div",{style:{display:"flex",gap:10*y,marginTop:`${1.5*y}rem`},children:[a.jsx("button",{onClick:xe,style:{flex:1,padding:`${.6*y}rem ${1*y}rem`,fontSize:`${.9*y}rem`,background:"#555",border:"none",borderRadius:6*y,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s"},onMouseEnter:B=>B.currentTarget.style.background="#666",onMouseLeave:B=>B.currentTarget.style.background="#555",children:""}),a.jsx("button",{onClick:Pe,style:{flex:1,padding:`${.6*y}rem ${1*y}rem`,fontSize:`${.9*y}rem`,background:"#d32f2f",border:"none",borderRadius:6*y,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s"},onMouseEnter:B=>B.currentTarget.style.background="#b71c1c",onMouseLeave:B=>B.currentTarget.style.background="#d32f2f",children:""})]})]})})]})},j2=()=>{};var ev={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eb={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const he=function(t,e){if(!t)throw Ko(e)},Ko=function(t){return new Error("Firebase Database ("+eb.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tb=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},$2=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=t[n++],o=t[n++],l=t[n++],c=((s&7)<<18|(i&63)<<12|(o&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{const i=t[n++],o=t[n++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},Wg={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<t.length;s+=3){const i=t[s],o=s+1<t.length,l=o?t[s+1]:0,c=s+2<t.length,d=c?t[s+2]:0,u=i>>2,h=(i&3)<<4|l>>4;let f=(l&15)<<2|d>>6,S=d&63;c||(S=64,o||(f=64)),r.push(n[u],n[h],n[f],n[S])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(tb(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):$2(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<t.length;){const i=n[t.charAt(s++)],l=s<t.length?n[t.charAt(s)]:0;++s;const d=s<t.length?n[t.charAt(s)]:64;++s;const h=s<t.length?n[t.charAt(s)]:64;if(++s,i==null||l==null||d==null||h==null)throw new F2;const f=i<<2|l>>4;if(r.push(f),d!==64){const S=l<<4&240|d>>2;if(r.push(S),h!==64){const k=d<<6&192|h;r.push(k)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class F2 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const nb=function(t){const e=tb(t);return Wg.encodeByteArray(e,!0)},Ud=function(t){return nb(t).replace(/\./g,"")},Bd=function(t){try{return Wg.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function U2(t){return rb(void 0,t)}function rb(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const n=e;return new Date(n.getTime());case Object:t===void 0&&(t={});break;case Array:t=[];break;default:return e}for(const n in e)!e.hasOwnProperty(n)||!B2(n)||(t[n]=rb(t[n],e[n]));return t}function B2(t){return t!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function z2(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H2=()=>z2().__FIREBASE_DEFAULTS__,W2=()=>{if(typeof process>"u"||typeof ev>"u")return;const t=ev.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},G2=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&Bd(t[1]);return e&&JSON.parse(e)},Gg=()=>{try{return j2()||H2()||W2()||G2()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},sb=t=>{var e,n;return(n=(e=Gg())==null?void 0:e.emulatorHosts)==null?void 0:n[t]},V2=t=>{const e=sb(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},ib=()=>{var t;return(t=Gg())==null?void 0:t.config},ob=t=>{var e;return(e=Gg())==null?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ur{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xo(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function ab(t){return(await fetch(t,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y2(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",s=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...t};return[Ud(JSON.stringify(n)),Ud(JSON.stringify(o)),""].join(".")}const Wa={};function K2(){const t={prod:[],emulator:[]};for(const e of Object.keys(Wa))Wa[e]?t.emulator.push(e):t.prod.push(e);return t}function X2(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let tv=!1;function lb(t,e){if(typeof window>"u"||typeof document>"u"||!Xo(window.location.host)||Wa[t]===e||Wa[t]||tv)return;Wa[t]=e;function n(f){return`__firebase__banner__${f}`}const r="__firebase__banner",i=K2().prod.length>0;function o(){const f=document.getElementById(r);f&&f.remove()}function l(f){f.style.display="flex",f.style.background="#7faaf0",f.style.position="fixed",f.style.bottom="5px",f.style.left="5px",f.style.padding=".5em",f.style.borderRadius="5px",f.style.alignItems="center"}function c(f,S){f.setAttribute("width","24"),f.setAttribute("id",S),f.setAttribute("height","24"),f.setAttribute("viewBox","0 0 24 24"),f.setAttribute("fill","none"),f.style.marginLeft="-6px"}function d(){const f=document.createElement("span");return f.style.cursor="pointer",f.style.marginLeft="16px",f.style.fontSize="24px",f.innerHTML=" &times;",f.onclick=()=>{tv=!0,o()},f}function u(f,S){f.setAttribute("id",S),f.innerText="Learn more",f.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",f.setAttribute("target","__blank"),f.style.paddingLeft="5px",f.style.textDecoration="underline"}function h(){const f=X2(r),S=n("text"),k=document.getElementById(S)||document.createElement("span"),w=n("learnmore"),j=document.getElementById(w)||document.createElement("a"),_=n("preprendIcon"),x=document.getElementById(_)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(f.created){const I=f.element;l(I),u(j,w);const p=d();c(x,_),I.append(x,k,j,p),document.body.appendChild(I)}i?(k.innerText="Preview backend disconnected.",x.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(x.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,k.innerText="Preview backend running in this workspace."),k.setAttribute("id",S)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",h):h()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Vg(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Tn())}function Q2(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function J2(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function cb(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function q2(){const t=Tn();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function Z2(){return eb.NODE_ADMIN===!0}function eC(){try{return typeof indexedDB=="object"}catch{return!1}}function tC(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var i;e(((i=s.error)==null?void 0:i.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nC="FirebaseError";class ti extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=nC,Object.setPrototypeOf(this,ti.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,jl.prototype.create)}}class jl{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?rC(i,r):"Error",l=`${this.serviceName}: ${o} (${s}).`;return new ti(s,l,r)}}function rC(t,e){return t.replace(sC,(n,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const sC=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vl(t){return JSON.parse(t)}function Xt(t){return JSON.stringify(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const db=function(t){let e={},n={},r={},s="";try{const i=t.split(".");e=vl(Bd(i[0])||""),n=vl(Bd(i[1])||""),s=i[2],r=n.d||{},delete n.d}catch{}return{header:e,claims:n,data:r,signature:s}},iC=function(t){const e=db(t),n=e.claims;return!!n&&typeof n=="object"&&n.hasOwnProperty("iat")},oC=function(t){const e=db(t).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xr(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function wi(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}function zd(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Hd(t,e,n){const r={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(r[s]=e.call(n,t[s],s,t));return r}function Ti(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const i=t[s],o=e[s];if(nv(i)&&nv(o)){if(!Ti(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function nv(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qo(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Oa(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function La(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aC{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,n){n||(n=0);const r=this.W_;if(typeof e=="string")for(let h=0;h<16;h++)r[h]=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),n+=4;else for(let h=0;h<16;h++)r[h]=e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3],n+=4;for(let h=16;h<80;h++){const f=r[h-3]^r[h-8]^r[h-14]^r[h-16];r[h]=(f<<1|f>>>31)&4294967295}let s=this.chain_[0],i=this.chain_[1],o=this.chain_[2],l=this.chain_[3],c=this.chain_[4],d,u;for(let h=0;h<80;h++){h<40?h<20?(d=l^i&(o^l),u=1518500249):(d=i^o^l,u=1859775393):h<60?(d=i&o|l&(i|o),u=2400959708):(d=i^o^l,u=3395469782);const f=(s<<5|s>>>27)+d+c+u+r[h]&4294967295;c=l,l=o,o=(i<<30|i>>>2)&4294967295,i=s,s=f}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+i&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,n){if(e==null)return;n===void 0&&(n=e.length);const r=n-this.blockSize;let s=0;const i=this.buf_;let o=this.inbuf_;for(;s<n;){if(o===0)for(;s<=r;)this.compress_(e,s),s+=this.blockSize;if(typeof e=="string"){for(;s<n;)if(i[o]=e.charCodeAt(s),++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}else for(;s<n;)if(i[o]=e[s],++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=n}digest(){const e=[];let n=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=n&255,n/=256;this.compress_(this.buf_);let r=0;for(let s=0;s<5;s++)for(let i=24;i>=0;i-=8)e[r]=this.chain_[s]>>i&255,++r;return e}}function lC(t,e){const n=new cC(t,e);return n.subscribe.bind(n)}class cC{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let s;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");dC(e,["next","error","complete"])?s=e:s={next:e,error:n,complete:r},s.next===void 0&&(s.next=sh),s.error===void 0&&(s.error=sh),s.complete===void 0&&(s.complete=sh);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function dC(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function sh(){}function jo(t,e){return`${t} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uC=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);if(s>=55296&&s<=56319){const i=s-55296;r++,he(r<t.length,"Surrogate pair missing trail surrogate.");const o=t.charCodeAt(r)-56320;s=65536+(i<<10)+o}s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):s<65536?(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},Ru=function(t){let e=0;for(let n=0;n<t.length;n++){const r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,n++):e+=3}return e};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jt(t){return t&&t._delegate?t._delegate:t}class Ci{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ui="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fC{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new ur;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:n});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(pC(e))try{this.getOrInitializeService({instanceIdentifier:ui})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(n);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=ui){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ui){return this.instances.has(e)}getOptions(e=ui){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[i,o]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);r===l&&o.resolve(s)}return s}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const s of r)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:hC(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=ui){return this.component?this.component.multipleInstances?e:ui:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function hC(t){return t===ui?void 0:t}function pC(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gC{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new fC(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var St;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(St||(St={}));const mC={debug:St.DEBUG,verbose:St.VERBOSE,info:St.INFO,warn:St.WARN,error:St.ERROR,silent:St.SILENT},yC=St.INFO,vC={[St.DEBUG]:"log",[St.VERBOSE]:"log",[St.INFO]:"info",[St.WARN]:"warn",[St.ERROR]:"error"},_C=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),s=vC[e];if(s)console[s](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Yg{constructor(e){this.name=e,this._logLevel=yC,this._logHandler=_C,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in St))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?mC[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,St.DEBUG,...e),this._logHandler(this,St.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,St.VERBOSE,...e),this._logHandler(this,St.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,St.INFO,...e),this._logHandler(this,St.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,St.WARN,...e),this._logHandler(this,St.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,St.ERROR,...e),this._logHandler(this,St.ERROR,...e)}}const xC=(t,e)=>e.some(n=>t instanceof n);let rv,sv;function bC(){return rv||(rv=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function EC(){return sv||(sv=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const ub=new WeakMap,gp=new WeakMap,fb=new WeakMap,ih=new WeakMap,Kg=new WeakMap;function SC(t){const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("success",i),t.removeEventListener("error",o)},i=()=>{n(Fs(t.result)),s()},o=()=>{r(t.error),s()};t.addEventListener("success",i),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&ub.set(n,t)}).catch(()=>{}),Kg.set(e,t),e}function IC(t){if(gp.has(t))return;const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",o),t.removeEventListener("abort",o)},i=()=>{n(),s()},o=()=>{r(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",i),t.addEventListener("error",o),t.addEventListener("abort",o)});gp.set(t,e)}let mp={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return gp.get(t);if(e==="objectStoreNames")return t.objectStoreNames||fb.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Fs(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function wC(t){mp=t(mp)}function TC(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(oh(this),e,...n);return fb.set(r,e.sort?e.sort():[e]),Fs(r)}:EC().includes(t)?function(...e){return t.apply(oh(this),e),Fs(ub.get(this))}:function(...e){return Fs(t.apply(oh(this),e))}}function CC(t){return typeof t=="function"?TC(t):(t instanceof IDBTransaction&&IC(t),xC(t,bC())?new Proxy(t,mp):t)}function Fs(t){if(t instanceof IDBRequest)return SC(t);if(ih.has(t))return ih.get(t);const e=CC(t);return e!==t&&(ih.set(t,e),Kg.set(e,t)),e}const oh=t=>Kg.get(t);function kC(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(t,e),l=Fs(o);return r&&o.addEventListener("upgradeneeded",c=>{r(Fs(o.result),c.oldVersion,c.newVersion,Fs(o.transaction),c)}),n&&o.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),l.then(c=>{i&&c.addEventListener("close",()=>i()),s&&c.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),l}const RC=["get","getKey","getAll","getAllKeys","count"],AC=["put","add","delete","clear"],ah=new Map;function iv(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(ah.get(e))return ah.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=AC.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||RC.includes(n)))return;const i=async function(o,...l){const c=this.transaction(o,s?"readwrite":"readonly");let d=c.store;return r&&(d=d.index(l.shift())),(await Promise.all([d[n](...l),s&&c.done]))[0]};return ah.set(e,i),i}wC(t=>({...t,get:(e,n,r)=>iv(e,n)||t.get(e,n,r),has:(e,n)=>!!iv(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PC{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(OC(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function OC(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const yp="@firebase/app",ov="0.14.6";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rs=new Yg("@firebase/app"),LC="@firebase/app-compat",DC="@firebase/analytics-compat",MC="@firebase/analytics",NC="@firebase/app-check-compat",jC="@firebase/app-check",$C="@firebase/auth",FC="@firebase/auth-compat",UC="@firebase/database",BC="@firebase/data-connect",zC="@firebase/database-compat",HC="@firebase/functions",WC="@firebase/functions-compat",GC="@firebase/installations",VC="@firebase/installations-compat",YC="@firebase/messaging",KC="@firebase/messaging-compat",XC="@firebase/performance",QC="@firebase/performance-compat",JC="@firebase/remote-config",qC="@firebase/remote-config-compat",ZC="@firebase/storage",ek="@firebase/storage-compat",tk="@firebase/firestore",nk="@firebase/ai",rk="@firebase/firestore-compat",sk="firebase",ik="12.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vp="[DEFAULT]",ok={[yp]:"fire-core",[LC]:"fire-core-compat",[MC]:"fire-analytics",[DC]:"fire-analytics-compat",[jC]:"fire-app-check",[NC]:"fire-app-check-compat",[$C]:"fire-auth",[FC]:"fire-auth-compat",[UC]:"fire-rtdb",[BC]:"fire-data-connect",[zC]:"fire-rtdb-compat",[HC]:"fire-fn",[WC]:"fire-fn-compat",[GC]:"fire-iid",[VC]:"fire-iid-compat",[YC]:"fire-fcm",[KC]:"fire-fcm-compat",[XC]:"fire-perf",[QC]:"fire-perf-compat",[JC]:"fire-rc",[qC]:"fire-rc-compat",[ZC]:"fire-gcs",[ek]:"fire-gcs-compat",[tk]:"fire-fst",[rk]:"fire-fst-compat",[nk]:"fire-vertex","fire-js":"fire-js",[sk]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wd=new Map,ak=new Map,_p=new Map;function av(t,e){try{t.container.addComponent(e)}catch(n){rs.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function $o(t){const e=t.name;if(_p.has(e))return rs.debug(`There were multiple attempts to register component ${e}.`),!1;_p.set(e,t);for(const n of Wd.values())av(n,t);for(const n of ak.values())av(n,t);return!0}function Xg(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function qn(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lk={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Us=new jl("app","Firebase",lk);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ck{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Ci("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Us.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jo=ik;function hb(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:vp,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw Us.create("bad-app-name",{appName:String(s)});if(n||(n=ib()),!n)throw Us.create("no-options");const i=Wd.get(s);if(i){if(Ti(n,i.options)&&Ti(r,i.config))return i;throw Us.create("duplicate-app",{appName:s})}const o=new gC(s);for(const c of _p.values())o.addComponent(c);const l=new ck(n,r,o);return Wd.set(s,l),l}function pb(t=vp){const e=Wd.get(t);if(!e&&t===vp&&ib())return hb();if(!e)throw Us.create("no-app",{appName:t});return e}function Bs(t,e,n){let r=ok[t]??t;n&&(r+=`-${n}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const o=[`Unable to register library "${r}" with version "${e}":`];s&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),rs.warn(o.join(" "));return}$o(new Ci(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dk="firebase-heartbeat-database",uk=1,_l="firebase-heartbeat-store";let lh=null;function gb(){return lh||(lh=kC(dk,uk,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(_l)}catch(n){console.warn(n)}}}}).catch(t=>{throw Us.create("idb-open",{originalErrorMessage:t.message})})),lh}async function fk(t){try{const n=(await gb()).transaction(_l),r=await n.objectStore(_l).get(mb(t));return await n.done,r}catch(e){if(e instanceof ti)rs.warn(e.message);else{const n=Us.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});rs.warn(n.message)}}}async function lv(t,e){try{const r=(await gb()).transaction(_l,"readwrite");await r.objectStore(_l).put(e,mb(t)),await r.done}catch(n){if(n instanceof ti)rs.warn(n.message);else{const r=Us.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});rs.warn(r.message)}}}function mb(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hk=1024,pk=30;class gk{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new yk(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=cv();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)==null?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats.length>pk){const o=vk(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){rs.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=cv(),{heartbeatsToSend:r,unsentEntries:s}=mk(this._heartbeatsCache.heartbeats),i=Ud(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(n){return rs.warn(n),""}}}function cv(){return new Date().toISOString().substring(0,10)}function mk(t,e=hk){const n=[];let r=t.slice();for(const s of t){const i=n.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),dv(n)>e){i.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),dv(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class yk{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return eC()?tC().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await fk(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return lv(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return lv(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function dv(t){return Ud(JSON.stringify({version:2,heartbeats:t})).length}function vk(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _k(t){$o(new Ci("platform-logger",e=>new PC(e),"PRIVATE")),$o(new Ci("heartbeat",e=>new gk(e),"PRIVATE")),Bs(yp,ov,t),Bs(yp,ov,"esm2020"),Bs("fire-js","")}_k("");var xk="firebase",bk="12.7.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Bs(xk,bk,"app");var uv={};const fv="@firebase/database",hv="1.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yb="";function Ek(t){yb=t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sk{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,n){n==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Xt(n))}get(e){const n=this.domStorage_.getItem(this.prefixedName_(e));return n==null?null:vl(n)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ik{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,n){n==null?delete this.cache_[e]:this.cache_[e]=n}get(e){return xr(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vb=function(t){try{if(typeof window<"u"&&typeof window[t]<"u"){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Sk(e)}}catch{}return new Ik},yi=vb("localStorage"),wk=vb("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const So=new Yg("@firebase/database"),_b=function(){let t=1;return function(){return t++}}(),xb=function(t){const e=uC(t),n=new aC;n.update(e);const r=n.digest();return Wg.encodeByteArray(r)},$l=function(...t){let e="";for(let n=0;n<t.length;n++){const r=t[n];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=$l.apply(null,r):typeof r=="object"?e+=Xt(r):e+=r,e+=" "}return e};let Ga=null,pv=!0;const Tk=function(t,e){he(!0,"Can't turn on custom loggers persistently."),So.logLevel=St.VERBOSE,Ga=So.log.bind(So)},tn=function(...t){if(pv===!0&&(pv=!1,Ga===null&&wk.get("logging_enabled")===!0&&Tk()),Ga){const e=$l.apply(null,t);Ga(e)}},Fl=function(t){return function(...e){tn(t,...e)}},xp=function(...t){const e="FIREBASE INTERNAL ERROR: "+$l(...t);So.error(e)},ss=function(...t){const e=`FIREBASE FATAL ERROR: ${$l(...t)}`;throw So.error(e),new Error(e)},wn=function(...t){const e="FIREBASE WARNING: "+$l(...t);So.warn(e)},Ck=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&wn("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Au=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},kk=function(t){if(document.readyState==="complete")t();else{let e=!1;const n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&n()}),window.attachEvent("onload",n))}},Fo="[MIN_NAME]",ki="[MAX_NAME]",Di=function(t,e){if(t===e)return 0;if(t===Fo||e===ki)return-1;if(e===Fo||t===ki)return 1;{const n=gv(t),r=gv(e);return n!==null?r!==null?n-r===0?t.length-e.length:n-r:-1:r!==null?1:t<e?-1:1}},Rk=function(t,e){return t===e?0:t<e?-1:1},Sa=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+Xt(e))},Qg=function(t){if(typeof t!="object"||t===null)return Xt(t);const e=[];for(const r in t)e.push(r);e.sort();let n="{";for(let r=0;r<e.length;r++)r!==0&&(n+=","),n+=Xt(e[r]),n+=":",n+=Qg(t[e[r]]);return n+="}",n},bb=function(t,e){const n=t.length;if(n<=e)return[t];const r=[];for(let s=0;s<n;s+=e)s+e>n?r.push(t.substring(s,n)):r.push(t.substring(s,s+e));return r};function rn(t,e){for(const n in t)t.hasOwnProperty(n)&&e(n,t[n])}const Eb=function(t){he(!Au(t),"Invalid JSON number");const e=11,n=52,r=(1<<e-1)-1;let s,i,o,l,c;t===0?(i=0,o=0,s=1/t===-1/0?1:0):(s=t<0,t=Math.abs(t),t>=Math.pow(2,1-r)?(l=Math.min(Math.floor(Math.log(t)/Math.LN2),r),i=l+r,o=Math.round(t*Math.pow(2,n-l)-Math.pow(2,n))):(i=0,o=Math.round(t/Math.pow(2,1-r-n))));const d=[];for(c=n;c;c-=1)d.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)d.push(i%2?1:0),i=Math.floor(i/2);d.push(s?1:0),d.reverse();const u=d.join("");let h="";for(c=0;c<64;c+=8){let f=parseInt(u.substr(c,8),2).toString(16);f.length===1&&(f="0"+f),h=h+f}return h.toLowerCase()},Ak=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},Pk=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function Ok(t,e){let n="Unknown Error";t==="too_big"?n="The data requested exceeds the maximum size that can be accessed with a single request.":t==="permission_denied"?n="Client doesn't have permission to access the desired data.":t==="unavailable"&&(n="The service is unavailable");const r=new Error(t+" at "+e._path.toString()+": "+n);return r.code=t.toUpperCase(),r}const Lk=new RegExp("^-?(0*)\\d{1,10}$"),Dk=-2147483648,Mk=2147483647,gv=function(t){if(Lk.test(t)){const e=Number(t);if(e>=Dk&&e<=Mk)return e}return null},qo=function(t){try{t()}catch(e){setTimeout(()=>{const n=e.stack||"";throw wn("Exception was thrown by user callback.",n),e},Math.floor(0))}},Nk=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Va=function(t,e){const n=setTimeout(t,e);return typeof n=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(n):typeof n=="object"&&n.unref&&n.unref(),n};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jk{constructor(e,n){this.appCheckProvider=n,this.appName=e.name,qn(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=n==null?void 0:n.getImmediate({optional:!0}),this.appCheck||n==null||n.get().then(r=>this.appCheck=r)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((n,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(n,r):n(null)},0)})}addTokenChangeListener(e){var n;(n=this.appCheckProvider)==null||n.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){wn(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $k{constructor(e,n,r){this.appName_=e,this.firebaseOptions_=n,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(n=>n&&n.code==="auth/token-not-initialized"?(tn("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(n)):new Promise((n,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(n,r):n(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(n=>n.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(n=>n.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',wn(e)}}class sd{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}sd.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jg="5",Sb="v",Ib="s",wb="r",Tb="f",Cb=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,kb="ls",Rb="p",bp="ac",Ab="websocket",Pb="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ob{constructor(e,n,r,s,i=!1,o="",l=!1,c=!1,d=null){this.secure=n,this.namespace=r,this.webSocketOnly=s,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=l,this.isUsingEmulator=c,this.emulatorOptions=d,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=yi.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&yi.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",n=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${n}`}}function Fk(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function Lb(t,e,n){he(typeof e=="string","typeof type must == string"),he(typeof n=="object","typeof params must == object");let r;if(e===Ab)r=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===Pb)r=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);Fk(t)&&(n.ns=t.namespace);const s=[];return rn(n,(i,o)=>{s.push(i+"="+o)}),r+s.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uk{constructor(){this.counters_={}}incrementCounter(e,n=1){xr(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=n}get(){return U2(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ch={},dh={};function qg(t){const e=t.toString();return ch[e]||(ch[e]=new Uk),ch[e]}function Bk(t,e){const n=t.toString();return dh[n]||(dh[n]=e()),dh[n]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zk{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,n){this.closeAfterResponse=e,this.onClose=n,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,n){for(this.pendingResponses[e]=n;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<r.length;++s)r[s]&&qo(()=>{this.onMessage_(r[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mv="start",Hk="close",Wk="pLPCommand",Gk="pRTLPCB",Db="id",Mb="pw",Nb="ser",Vk="cb",Yk="seg",Kk="ts",Xk="d",Qk="dframe",jb=1870,$b=30,Jk=jb-$b,qk=25e3,Zk=3e4;class go{constructor(e,n,r,s,i,o,l){this.connId=e,this.repoInfo=n,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.transportSessionId=o,this.lastSessionId=l,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Fl(e),this.stats_=qg(n),this.urlFn=c=>(this.appCheckToken&&(c[bp]=this.appCheckToken),Lb(n,Pb,c))}open(e,n){this.curSegmentNum=0,this.onDisconnect_=n,this.myPacketOrderer=new zk(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(Zk)),kk(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Zg((...i)=>{const[o,l,c,d,u]=i;if(this.incrementIncomingBytes_(i),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===mv)this.id=l,this.password=c;else if(o===Hk)l?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(l,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...i)=>{const[o,l]=i;this.incrementIncomingBytes_(i),this.myPacketOrderer.handleResponse(o,l)},()=>{this.onClosed_()},this.urlFn);const r={};r[mv]="t",r[Nb]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[Vk]=this.scriptTagHolder.uniqueCallbackIdentifier),r[Sb]=Jg,this.transportSessionId&&(r[Ib]=this.transportSessionId),this.lastSessionId&&(r[kb]=this.lastSessionId),this.applicationId&&(r[Rb]=this.applicationId),this.appCheckToken&&(r[bp]=this.appCheckToken),typeof location<"u"&&location.hostname&&Cb.test(location.hostname)&&(r[wb]=Tb);const s=this.urlFn(r);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){go.forceAllow_=!0}static forceDisallow(){go.forceDisallow_=!0}static isAvailable(){return go.forceAllow_?!0:!go.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!Ak()&&!Pk()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const n=Xt(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const r=nb(n),s=bb(r,Jk);for(let i=0;i<s.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[i]),this.curSegmentNum++}addDisconnectPingFrame(e,n){this.myDisconnFrame=document.createElement("iframe");const r={};r[Qk]="t",r[Db]=e,r[Mb]=n,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const n=Xt(e).length;this.bytesReceived+=n,this.stats_.incrementCounter("bytes_received",n)}}class Zg{constructor(e,n,r,s){this.onDisconnect=r,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=_b(),window[Wk+this.uniqueCallbackIdentifier]=e,window[Gk+this.uniqueCallbackIdentifier]=n,this.myIFrame=Zg.createIFrame_();let i="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(i='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(l){tn("frame writing exception"),l.stack&&tn(l.stack),tn(l)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||tn("No IE domain setting required")}catch{const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,n){for(this.myID=e,this.myPW=n,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[Db]=this.myID,e[Mb]=this.myPW,e[Nb]=this.currentSerial;let n=this.urlFn(e),r="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+$b+r.length<=jb;){const o=this.pendingSegs.shift();r=r+"&"+Yk+s+"="+o.seg+"&"+Kk+s+"="+o.ts+"&"+Xk+s+"="+o.d,s++}return n=n+r,this.addLongPollTag_(n,this.currentSerial),!0}else return!1}enqueueSegment(e,n,r){this.pendingSegs.push({seg:e,ts:n,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,n){this.outstandingRequests.add(n);const r=()=>{this.outstandingRequests.delete(n),this.newRequest_()},s=setTimeout(r,Math.floor(qk)),i=()=>{clearTimeout(s),r()};this.addTag(e,i)}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const s=r.readyState;(!s||s==="loaded"||s==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),n())},r.onerror=()=>{tn("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e5=16384,t5=45e3;let Gd=null;typeof MozWebSocket<"u"?Gd=MozWebSocket:typeof WebSocket<"u"&&(Gd=WebSocket);class fr{constructor(e,n,r,s,i,o,l){this.connId=e,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Fl(this.connId),this.stats_=qg(n),this.connURL=fr.connectionURL_(n,o,l,s,r),this.nodeAdmin=n.nodeAdmin}static connectionURL_(e,n,r,s,i){const o={};return o[Sb]=Jg,typeof location<"u"&&location.hostname&&Cb.test(location.hostname)&&(o[wb]=Tb),n&&(o[Ib]=n),r&&(o[kb]=r),s&&(o[bp]=s),i&&(o[Rb]=i),Lb(e,Ab,o)}open(e,n){this.onDisconnect=n,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,yi.set("previous_websocket_failure",!0);try{let r;Z2(),this.mySock=new Gd(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){fr.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const n=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(n);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&Gd!==null&&!fr.forceDisallow_}static previouslyFailed(){return yi.isInMemoryStorage||yi.get("previous_websocket_failure")===!0}markConnectionHealthy(){yi.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const n=this.frames.join("");this.frames=null;const r=vl(n);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(he(this.frames===null,"We already have a frame buffer"),e.length<=6){const n=Number(e);if(!isNaN(n))return this.handleNewFrameCount_(n),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const n=e.data;if(this.bytesReceived+=n.length,this.stats_.incrementCounter("bytes_received",n.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(n);else{const r=this.extractFrameCount_(n);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();const n=Xt(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const r=bb(n,e5);r.length>1&&this.sendString_(String(r.length));for(let s=0;s<r.length;s++)this.sendString_(r[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(t5))}sendString_(e){try{this.mySock.send(e)}catch(n){this.log_("Exception thrown from WebSocket.send():",n.message||n.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}fr.responsesRequiredToBeHealthy=2;fr.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xl{static get ALL_TRANSPORTS(){return[go,fr]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const n=fr&&fr.isAvailable();let r=n&&!fr.previouslyFailed();if(e.webSocketOnly&&(n||wn("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[fr];else{const s=this.transports_=[];for(const i of xl.ALL_TRANSPORTS)i&&i.isAvailable()&&s.push(i);xl.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}xl.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n5=6e4,r5=5e3,s5=10*1024,i5=100*1024,uh="t",yv="d",o5="s",vv="r",a5="e",_v="o",xv="a",bv="n",Ev="p",l5="h";class c5{constructor(e,n,r,s,i,o,l,c,d,u){this.id=e,this.repoInfo_=n,this.applicationId_=r,this.appCheckToken_=s,this.authToken_=i,this.onMessage_=o,this.onReady_=l,this.onDisconnect_=c,this.onKill_=d,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Fl("c:"+this.id+":"),this.transportManager_=new xl(n),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(n,r)},Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=Va(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>i5?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>s5?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return n=>{e===this.conn_?this.onConnectionLost_(n):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return n=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(n):e===this.secondaryConn_?this.onSecondaryMessageReceived_(n):this.log_("message on old connection"))}}sendRequest(e){const n={t:"d",d:e};this.sendData_(n)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(uh in e){const n=e[uh];n===xv?this.upgradeIfSecondaryHealthy_():n===vv?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):n===_v&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const n=Sa("t",e),r=Sa("d",e);if(n==="c")this.onSecondaryControl_(r);else if(n==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+n)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:Ev,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:xv,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:bv,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const n=Sa("t",e),r=Sa("d",e);n==="c"?this.onControl_(r):n==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const n=Sa(uh,e);if(yv in e){const r=e[yv];if(n===l5){const s={...r};this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(n===bv){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else n===o5?this.onConnectionShutdown_(r):n===vv?this.onReset_(r):n===a5?xp("Server Error: "+r):n===_v?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):xp("Unknown control packet command: "+n)}}onHandshake_(e){const n=e.ts,r=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,n),Jg!==r&&wn("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),Va(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(n5))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,n){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(n,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Va(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(r5))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:Ev,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(yi.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fb{put(e,n,r,s){}merge(e,n,r,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,n,r){}onDisconnectMerge(e,n,r){}onDisconnectCancel(e,n){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ub{constructor(e){this.allowedEvents_=e,this.listeners_={},he(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...n){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let s=0;s<r.length;s++)r[s].callback.apply(r[s].context,n)}}on(e,n,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:n,context:r});const s=this.getInitialEvent(e);s&&n.apply(r,s)}off(e,n,r){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let i=0;i<s.length;i++)if(s[i].callback===n&&(!r||r===s[i].context)){s.splice(i,1);return}}validateEventType_(e){he(this.allowedEvents_.find(n=>n===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vd extends Ub{static getInstance(){return new Vd}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Vg()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return he(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sv=32,Iv=768;class bt{constructor(e,n){if(n===void 0){this.pieces_=e.split("/");let r=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[r]=this.pieces_[s],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=n}toString(){let e="";for(let n=this.pieceNum_;n<this.pieces_.length;n++)this.pieces_[n]!==""&&(e+="/"+this.pieces_[n]);return e||"/"}}function gt(){return new bt("")}function ot(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function Ys(t){return t.pieces_.length-t.pieceNum_}function wt(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new bt(t.pieces_,e)}function e0(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function d5(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)t.pieces_[n]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}function bl(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function Bb(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new bt(e,0)}function jt(t,e){const n=[];for(let r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);if(e instanceof bt)for(let r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);else{const r=e.split("/");for(let s=0;s<r.length;s++)r[s].length>0&&n.push(r[s])}return new bt(n,0)}function lt(t){return t.pieceNum_>=t.pieces_.length}function Sn(t,e){const n=ot(t),r=ot(e);if(n===null)return e;if(n===r)return Sn(wt(t),wt(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function u5(t,e){const n=bl(t,0),r=bl(e,0);for(let s=0;s<n.length&&s<r.length;s++){const i=Di(n[s],r[s]);if(i!==0)return i}return n.length===r.length?0:n.length<r.length?-1:1}function t0(t,e){if(Ys(t)!==Ys(e))return!1;for(let n=t.pieceNum_,r=e.pieceNum_;n<=t.pieces_.length;n++,r++)if(t.pieces_[n]!==e.pieces_[r])return!1;return!0}function er(t,e){let n=t.pieceNum_,r=e.pieceNum_;if(Ys(t)>Ys(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[r])return!1;++n,++r}return!0}class f5{constructor(e,n){this.errorPrefix_=n,this.parts_=bl(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=Ru(this.parts_[r]);zb(this)}}function h5(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=Ru(e),zb(t)}function p5(t){const e=t.parts_.pop();t.byteLength_-=Ru(e),t.parts_.length>0&&(t.byteLength_-=1)}function zb(t){if(t.byteLength_>Iv)throw new Error(t.errorPrefix_+"has a key path longer than "+Iv+" bytes ("+t.byteLength_+").");if(t.parts_.length>Sv)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Sv+") or object contains a cycle "+fi(t))}function fi(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n0 extends Ub{static getInstance(){return new n0}constructor(){super(["visible"]);let e,n;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(n="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(n="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(n="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(n="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,n&&document.addEventListener(n,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}getInitialEvent(e){return he(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ia=1e3,g5=60*5*1e3,wv=30*1e3,m5=1.3,y5=3e4,v5="server_kill",Tv=3;class Jr extends Fb{constructor(e,n,r,s,i,o,l,c){if(super(),this.repoInfo_=e,this.applicationId_=n,this.onDataUpdate_=r,this.onConnectStatus_=s,this.onServerInfoUpdate_=i,this.authTokenProvider_=o,this.appCheckTokenProvider_=l,this.authOverride_=c,this.id=Jr.nextPersistentConnectionId_++,this.log_=Fl("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Ia,this.maxReconnectDelay_=g5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");n0.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&Vd.getInstance().on("online",this.onOnline_,this)}sendRequest(e,n,r){const s=++this.requestNumber_,i={r:s,a:e,b:n};this.log_(Xt(i)),he(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),r&&(this.requestCBHash_[s]=r)}get(e){this.initConnection_();const n=new ur,s={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const l=o.d;o.s==="ok"?n.resolve(l):n.reject(l)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),n.promise}listen(e,n,r,s){this.initConnection_();const i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),he(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),he(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");const l={onComplete:s,hashFn:n,query:e,tag:r};this.listens.get(o).set(i,l),this.connected_&&this.sendListen_(l)}sendGet_(e){const n=this.outstandingGets_[e];this.sendRequest("g",n.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(r)})}sendListen_(e){const n=e.query,r=n._path.toString(),s=n._queryIdentifier;this.log_("Listen on "+r+" for "+s);const i={p:r},o="q";e.tag&&(i.q=n._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest(o,i,l=>{const c=l.d,d=l.s;Jr.warnOnListenWarnings_(c,n),(this.listens.get(r)&&this.listens.get(r).get(s))===e&&(this.log_("listen response",l),d!=="ok"&&this.removeListen_(r,s),e.onComplete&&e.onComplete(d,c))})}static warnOnListenWarnings_(e,n){if(e&&typeof e=="object"&&xr(e,"w")){const r=wi(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const s='".indexOn": "'+n._queryParams.getIndex().toString()+'"',i=n._path.toString();wn(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${i} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||oC(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=wv)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,n=iC(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(n,r,s=>{const i=s.s,o=s.d||"error";this.authToken_===e&&(i==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(i,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const n=e.s,r=e.d||"error";n==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(n,r)})}unlisten(e,n){const r=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+s),he(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,s)&&this.connected_&&this.sendUnlisten_(r,s,e._queryObject,n)}sendUnlisten_(e,n,r,s){this.log_("Unlisten on "+e+" for "+n);const i={p:e},o="n";s&&(i.q=r,i.t=s),this.sendRequest(o,i)}onDisconnectPut(e,n,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,n,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:n,onComplete:r})}onDisconnectMerge(e,n,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,n,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:n,onComplete:r})}onDisconnectCancel(e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:n})}sendOnDisconnect_(e,n,r,s){const i={p:n,d:r};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,o=>{s&&setTimeout(()=>{s(o.s,o.d)},Math.floor(0))})}put(e,n,r,s){this.putInternal("p",e,n,r,s)}merge(e,n,r,s){this.putInternal("m",e,n,r,s)}putInternal(e,n,r,s,i){this.initConnection_();const o={p:n,d:r};i!==void 0&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:s}),this.outstandingPutCount_++;const l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+n)}sendPut_(e){const n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,s=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,i=>{this.log_(n+" response",i),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(i.s,i.d)})}reportStats(e){if(this.connected_){const n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,r=>{if(r.s!=="ok"){const i=r.d;this.log_("reportStats","Error sending stats: "+i)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Xt(e));const n=e.r,r=this.requestCBHash_[n];r&&(delete this.requestCBHash_[n],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,n){this.log_("handleServerMessage",e,n),e==="d"?this.onDataUpdate_(n.p,n.d,!1,n.t):e==="m"?this.onDataUpdate_(n.p,n.d,!0,n.t):e==="c"?this.onListenRevoked_(n.p,n.q):e==="ac"?this.onAuthRevoked_(n.s,n.d):e==="apc"?this.onAppCheckRevoked_(n.s,n.d):e==="sd"?this.onSecurityDebugPacket_(n):xp("Unrecognized action received from server: "+Xt(e)+`
Are you using the latest client?`)}onReady_(e,n){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=n,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){he(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Ia,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Ia,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>y5&&(this.reconnectDelay_=Ia),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let n=Math.max(0,this.reconnectDelay_-e);n=Math.random()*n,this.log_("Trying to reconnect in "+n+"ms"),this.scheduleConnect_(n),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*m5)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+Jr.nextConnectionId_++,i=this.lastSessionId;let o=!1,l=null;const c=function(){l?l.close():(o=!0,r())},d=function(h){he(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(h)};this.realtime_={close:c,sendRequest:d};const u=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[h,f]=await Promise.all([this.authTokenProvider_.getToken(u),this.appCheckTokenProvider_.getToken(u)]);o?tn("getToken() completed but was canceled"):(tn("getToken() completed. Creating connection."),this.authToken_=h&&h.accessToken,this.appCheckToken_=f&&f.token,l=new c5(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,r,S=>{wn(S+" ("+this.repoInfo_.toString()+")"),this.interrupt(v5)},i))}catch(h){this.log_("Failed to get token: "+h),o||(this.repoInfo_.nodeAdmin&&wn(h),c())}}}interrupt(e){tn("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){tn("Resuming connection for reason: "+e),delete this.interruptReasons_[e],zd(this.interruptReasons_)&&(this.reconnectDelay_=Ia,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const n=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:n})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const n=this.outstandingPuts_[e];n&&"h"in n.request&&n.queued&&(n.onComplete&&n.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,n){let r;n?r=n.map(i=>Qg(i)).join("$"):r="default";const s=this.removeListen_(e,r);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(e,n){const r=new bt(e).toString();let s;if(this.listens.has(r)){const i=this.listens.get(r);s=i.get(n),i.delete(n),i.size===0&&this.listens.delete(r)}else s=void 0;return s}onAuthRevoked_(e,n){tn("Auth token revoked: "+e+"/"+n),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Tv&&(this.reconnectDelay_=wv,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,n){tn("App check token revoked: "+e+"/"+n),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Tv&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const n of e.values())this.sendListen_(n);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let n="js";e["sdk."+n+"."+yb.replace(/\./g,"-")]=1,Vg()?e["framework.cordova"]=1:cb()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Vd.getInstance().currentlyOnline();return zd(this.interruptReasons_)&&e}}Jr.nextPersistentConnectionId_=0;Jr.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ct{constructor(e,n){this.name=e,this.node=n}static Wrap(e,n){return new ct(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pu{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,n){const r=new ct(Fo,e),s=new ct(Fo,n);return this.compare(r,s)!==0}minPost(){return ct.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let jc;class Hb extends Pu{static get __EMPTY_NODE(){return jc}static set __EMPTY_NODE(e){jc=e}compare(e,n){return Di(e.name,n.name)}isDefinedOn(e){throw Ko("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,n){return!1}minPost(){return ct.MIN}maxPost(){return new ct(ki,jc)}makePost(e,n){return he(typeof e=="string","KeyIndex indexValue must always be a string."),new ct(e,jc)}toString(){return".key"}}const Io=new Hb;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $c{constructor(e,n,r,s,i=null){this.isReverse_=s,this.resultGenerator_=i,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=n?r(e.key,n):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),n;if(this.resultGenerator_?n=this.resultGenerator_(e.key,e.value):n={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return n}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class en{constructor(e,n,r,s,i){this.key=e,this.value=n,this.color=r??en.RED,this.left=s??Dn.EMPTY_NODE,this.right=i??Dn.EMPTY_NODE}copy(e,n,r,s,i){return new en(e??this.key,n??this.value,r??this.color,s??this.left,i??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let s=this;const i=r(e,s.key);return i<0?s=s.copy(null,null,null,s.left.insert(e,n,r),null):i===0?s=s.copy(null,n,null,null,null):s=s.copy(null,null,null,null,s.right.insert(e,n,r)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return Dn.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,n){let r,s;if(r=this,n(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,n),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),n(e,r.key)===0){if(r.right.isEmpty())return Dn.EMPTY_NODE;s=r.right.min_(),r=r.copy(s.key,s.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,n))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,en.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,en.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}en.RED=!0;en.BLACK=!1;class _5{copy(e,n,r,s,i){return this}insert(e,n,r){return new en(e,n,null)}remove(e,n){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class Dn{constructor(e,n=Dn.EMPTY_NODE){this.comparator_=e,this.root_=n}insert(e,n){return new Dn(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,en.BLACK,null,null))}remove(e){return new Dn(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,en.BLACK,null,null))}get(e){let n,r=this.root_;for(;!r.isEmpty();){if(n=this.comparator_(e,r.key),n===0)return r.value;n<0?r=r.left:n>0&&(r=r.right)}return null}getPredecessorKey(e){let n,r=this.root_,s=null;for(;!r.isEmpty();)if(n=this.comparator_(e,r.key),n===0){if(r.left.isEmpty())return s?s.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else n<0?r=r.left:n>0&&(s=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new $c(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,n){return new $c(this.root_,e,this.comparator_,!1,n)}getReverseIteratorFrom(e,n){return new $c(this.root_,e,this.comparator_,!0,n)}getReverseIterator(e){return new $c(this.root_,null,this.comparator_,!0,e)}}Dn.EMPTY_NODE=new _5;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x5(t,e){return Di(t.name,e.name)}function r0(t,e){return Di(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ep;function b5(t){Ep=t}const Wb=function(t){return typeof t=="number"?"number:"+Eb(t):"string:"+t},Gb=function(t){if(t.isLeafNode()){const e=t.val();he(typeof e=="string"||typeof e=="number"||typeof e=="object"&&xr(e,".sv"),"Priority must be a string or number.")}else he(t===Ep||t.isEmpty(),"priority of unexpected type.");he(t===Ep||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Cv;class qt{static set __childrenNodeConstructor(e){Cv=e}static get __childrenNodeConstructor(){return Cv}constructor(e,n=qt.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=n,this.lazyHash_=null,he(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),Gb(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new qt(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:qt.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return lt(e)?this:ot(e)===".priority"?this.priorityNode_:qt.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,n){return null}updateImmediateChild(e,n){return e===".priority"?this.updatePriority(n):n.isEmpty()&&e!==".priority"?this:qt.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)}updateChild(e,n){const r=ot(e);return r===null?n:n.isEmpty()&&r!==".priority"?this:(he(r!==".priority"||Ys(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,qt.__childrenNodeConstructor.EMPTY_NODE.updateChild(wt(e),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,n){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Wb(this.priorityNode_.val())+":");const n=typeof this.value_;e+=n+":",n==="number"?e+=Eb(this.value_):e+=this.value_,this.lazyHash_=xb(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===qt.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof qt.__childrenNodeConstructor?-1:(he(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const n=typeof e.value_,r=typeof this.value_,s=qt.VALUE_TYPE_ORDER.indexOf(n),i=qt.VALUE_TYPE_ORDER.indexOf(r);return he(s>=0,"Unknown leaf type: "+n),he(i>=0,"Unknown leaf type: "+r),s===i?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const n=e;return this.value_===n.value_&&this.priorityNode_.equals(n.priorityNode_)}else return!1}}qt.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Vb,Yb;function E5(t){Vb=t}function S5(t){Yb=t}class I5 extends Pu{compare(e,n){const r=e.node.getPriority(),s=n.node.getPriority(),i=r.compareTo(s);return i===0?Di(e.name,n.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,n){return!e.getPriority().equals(n.getPriority())}minPost(){return ct.MIN}maxPost(){return new ct(ki,new qt("[PRIORITY-POST]",Yb))}makePost(e,n){const r=Vb(e);return new ct(n,new qt("[PRIORITY-POST]",r))}toString(){return".priority"}}const Dt=new I5;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w5=Math.log(2);class T5{constructor(e){const n=i=>parseInt(Math.log(i)/w5,10),r=i=>parseInt(Array(i+1).join("1"),2);this.count=n(e+1),this.current_=this.count-1;const s=r(this.count);this.bits_=e+1&s}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Yd=function(t,e,n,r){t.sort(e);const s=function(c,d){const u=d-c;let h,f;if(u===0)return null;if(u===1)return h=t[c],f=n?n(h):h,new en(f,h.node,en.BLACK,null,null);{const S=parseInt(u/2,10)+c,k=s(c,S),w=s(S+1,d);return h=t[S],f=n?n(h):h,new en(f,h.node,en.BLACK,k,w)}},i=function(c){let d=null,u=null,h=t.length;const f=function(k,w){const j=h-k,_=h;h-=k;const x=s(j+1,_),I=t[j],p=n?n(I):I;S(new en(p,I.node,w,null,x))},S=function(k){d?(d.left=k,d=k):(u=k,d=k)};for(let k=0;k<c.count;++k){const w=c.nextBitIsOne(),j=Math.pow(2,c.count-(k+1));w?f(j,en.BLACK):(f(j,en.BLACK),f(j,en.RED))}return u},o=new T5(t.length),l=i(o);return new Dn(r||e,l)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fh;const Zi={};class Yr{static get Default(){return he(Zi&&Dt,"ChildrenNode.ts has not been loaded"),fh=fh||new Yr({".priority":Zi},{".priority":Dt}),fh}constructor(e,n){this.indexes_=e,this.indexSet_=n}get(e){const n=wi(this.indexes_,e);if(!n)throw new Error("No index defined for "+e);return n instanceof Dn?n:null}hasIndex(e){return xr(this.indexSet_,e.toString())}addIndex(e,n){he(e!==Io,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let s=!1;const i=n.getIterator(ct.Wrap);let o=i.getNext();for(;o;)s=s||e.isDefinedOn(o.node),r.push(o),o=i.getNext();let l;s?l=Yd(r,e.getCompare()):l=Zi;const c=e.toString(),d={...this.indexSet_};d[c]=e;const u={...this.indexes_};return u[c]=l,new Yr(u,d)}addToIndexes(e,n){const r=Hd(this.indexes_,(s,i)=>{const o=wi(this.indexSet_,i);if(he(o,"Missing index implementation for "+i),s===Zi)if(o.isDefinedOn(e.node)){const l=[],c=n.getIterator(ct.Wrap);let d=c.getNext();for(;d;)d.name!==e.name&&l.push(d),d=c.getNext();return l.push(e),Yd(l,o.getCompare())}else return Zi;else{const l=n.get(e.name);let c=s;return l&&(c=c.remove(new ct(e.name,l))),c.insert(e,e.node)}});return new Yr(r,this.indexSet_)}removeFromIndexes(e,n){const r=Hd(this.indexes_,s=>{if(s===Zi)return s;{const i=n.get(e.name);return i?s.remove(new ct(e.name,i)):s}});return new Yr(r,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let wa;class ze{static get EMPTY_NODE(){return wa||(wa=new ze(new Dn(r0),null,Yr.Default))}constructor(e,n,r){this.children_=e,this.priorityNode_=n,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&Gb(this.priorityNode_),this.children_.isEmpty()&&he(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||wa}updatePriority(e){return this.children_.isEmpty()?this:new ze(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const n=this.children_.get(e);return n===null?wa:n}}getChild(e){const n=ot(e);return n===null?this:this.getImmediateChild(n).getChild(wt(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,n){if(he(n,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(n);{const r=new ct(e,n);let s,i;n.isEmpty()?(s=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(r,this.children_)):(s=this.children_.insert(e,n),i=this.indexMap_.addToIndexes(r,this.children_));const o=s.isEmpty()?wa:this.priorityNode_;return new ze(s,o,i)}}updateChild(e,n){const r=ot(e);if(r===null)return n;{he(ot(e)!==".priority"||Ys(e)===1,".priority must be the last token in a path");const s=this.getImmediateChild(r).updateChild(wt(e),n);return this.updateImmediateChild(r,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const n={};let r=0,s=0,i=!0;if(this.forEachChild(Dt,(o,l)=>{n[o]=l.val(e),r++,i&&ze.INTEGER_REGEXP_.test(o)?s=Math.max(s,Number(o)):i=!1}),!e&&i&&s<2*r){const o=[];for(const l in n)o[l]=n[l];return o}else return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+Wb(this.getPriority().val())+":"),this.forEachChild(Dt,(n,r)=>{const s=r.hash();s!==""&&(e+=":"+n+":"+s)}),this.lazyHash_=e===""?"":xb(e)}return this.lazyHash_}getPredecessorChildName(e,n,r){const s=this.resolveIndex_(r);if(s){const i=s.getPredecessorKey(new ct(e,n));return i?i.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const n=this.resolveIndex_(e);if(n){const r=n.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){const n=this.getFirstChildName(e);return n?new ct(n,this.children_.get(n)):null}getLastChildName(e){const n=this.resolveIndex_(e);if(n){const r=n.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){const n=this.getLastChildName(e);return n?new ct(n,this.children_.get(n)):null}forEachChild(e,n){const r=this.resolveIndex_(e);return r?r.inorderTraversal(s=>n(s.name,s.node)):this.children_.inorderTraversal(n)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,n){const r=this.resolveIndex_(n);if(r)return r.getIteratorFrom(e,s=>s);{const s=this.children_.getIteratorFrom(e.name,ct.Wrap);let i=s.peek();for(;i!=null&&n.compare(i,e)<0;)s.getNext(),i=s.peek();return s}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,n){const r=this.resolveIndex_(n);if(r)return r.getReverseIteratorFrom(e,s=>s);{const s=this.children_.getReverseIteratorFrom(e.name,ct.Wrap);let i=s.peek();for(;i!=null&&n.compare(i,e)>0;)s.getNext(),i=s.peek();return s}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Ul?-1:0}withIndex(e){if(e===Io||this.indexMap_.hasIndex(e))return this;{const n=this.indexMap_.addIndex(e,this.children_);return new ze(this.children_,this.priorityNode_,n)}}isIndexed(e){return e===Io||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority()))if(this.children_.count()===n.children_.count()){const r=this.getIterator(Dt),s=n.getIterator(Dt);let i=r.getNext(),o=s.getNext();for(;i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=r.getNext(),o=s.getNext()}return i===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===Io?null:this.indexMap_.get(e.toString())}}ze.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class C5 extends ze{constructor(){super(new Dn(r0),ze.EMPTY_NODE,Yr.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return ze.EMPTY_NODE}isEmpty(){return!1}}const Ul=new C5;Object.defineProperties(ct,{MIN:{value:new ct(Fo,ze.EMPTY_NODE)},MAX:{value:new ct(ki,Ul)}});Hb.__EMPTY_NODE=ze.EMPTY_NODE;qt.__childrenNodeConstructor=ze;b5(Ul);S5(Ul);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k5=!0;function Nt(t,e=null){if(t===null)return ze.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),he(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){const n=t;return new qt(n,Nt(e))}if(!(t instanceof Array)&&k5){const n=[];let r=!1;if(rn(t,(o,l)=>{if(o.substring(0,1)!=="."){const c=Nt(l);c.isEmpty()||(r=r||!c.getPriority().isEmpty(),n.push(new ct(o,c)))}}),n.length===0)return ze.EMPTY_NODE;const i=Yd(n,x5,o=>o.name,r0);if(r){const o=Yd(n,Dt.getCompare());return new ze(i,Nt(e),new Yr({".priority":o},{".priority":Dt}))}else return new ze(i,Nt(e),Yr.Default)}else{let n=ze.EMPTY_NODE;return rn(t,(r,s)=>{if(xr(t,r)&&r.substring(0,1)!=="."){const i=Nt(s);(i.isLeafNode()||!i.isEmpty())&&(n=n.updateImmediateChild(r,i))}}),n.updatePriority(Nt(e))}}E5(Nt);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R5 extends Pu{constructor(e){super(),this.indexPath_=e,he(!lt(e)&&ot(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,n){const r=this.extractChild(e.node),s=this.extractChild(n.node),i=r.compareTo(s);return i===0?Di(e.name,n.name):i}makePost(e,n){const r=Nt(e),s=ze.EMPTY_NODE.updateChild(this.indexPath_,r);return new ct(n,s)}maxPost(){const e=ze.EMPTY_NODE.updateChild(this.indexPath_,Ul);return new ct(ki,e)}toString(){return bl(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A5 extends Pu{compare(e,n){const r=e.node.compareTo(n.node);return r===0?Di(e.name,n.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,n){return!e.equals(n)}minPost(){return ct.MIN}maxPost(){return ct.MAX}makePost(e,n){const r=Nt(e);return new ct(n,r)}toString(){return".value"}}const P5=new A5;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kb(t){return{type:"value",snapshotNode:t}}function Uo(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function El(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function Sl(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}function O5(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s0{constructor(e){this.index_=e}updateChild(e,n,r,s,i,o){he(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const l=e.getImmediateChild(n);return l.getChild(s).equals(r.getChild(s))&&l.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(n)?o.trackChildChange(El(n,l)):he(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):l.isEmpty()?o.trackChildChange(Uo(n,r)):o.trackChildChange(Sl(n,r,l))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(n,r).withIndex(this.index_)}updateFullNode(e,n,r){return r!=null&&(e.isLeafNode()||e.forEachChild(Dt,(s,i)=>{n.hasChild(s)||r.trackChildChange(El(s,i))}),n.isLeafNode()||n.forEachChild(Dt,(s,i)=>{if(e.hasChild(s)){const o=e.getImmediateChild(s);o.equals(i)||r.trackChildChange(Sl(s,i,o))}else r.trackChildChange(Uo(s,i))})),n.withIndex(this.index_)}updatePriority(e,n){return e.isEmpty()?ze.EMPTY_NODE:e.updatePriority(n)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Il{constructor(e){this.indexedFilter_=new s0(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Il.getStartPost_(e),this.endPost_=Il.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const n=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return n&&r}updateChild(e,n,r,s,i,o){return this.matches(new ct(n,r))||(r=ze.EMPTY_NODE),this.indexedFilter_.updateChild(e,n,r,s,i,o)}updateFullNode(e,n,r){n.isLeafNode()&&(n=ze.EMPTY_NODE);let s=n.withIndex(this.index_);s=s.updatePriority(ze.EMPTY_NODE);const i=this;return n.forEachChild(Dt,(o,l)=>{i.matches(new ct(o,l))||(s=s.updateImmediateChild(o,ze.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,r)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const n=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),n)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const n=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),n)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L5{constructor(e){this.withinDirectionalStart=n=>this.reverse_?this.withinEndPost(n):this.withinStartPost(n),this.withinDirectionalEnd=n=>this.reverse_?this.withinStartPost(n):this.withinEndPost(n),this.withinStartPost=n=>{const r=this.index_.compare(this.rangedFilter_.getStartPost(),n);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=n=>{const r=this.index_.compare(n,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new Il(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,n,r,s,i,o){return this.rangedFilter_.matches(new ct(n,r))||(r=ze.EMPTY_NODE),e.getImmediateChild(n).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,n,r,s,i,o):this.fullLimitUpdateChild_(e,n,r,i,o)}updateFullNode(e,n,r){let s;if(n.isLeafNode()||n.isEmpty())s=ze.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<n.numChildren()&&n.isIndexed(this.index_)){s=ze.EMPTY_NODE.withIndex(this.index_);let i;this.reverse_?i=n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):i=n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;i.hasNext()&&o<this.limit_;){const l=i.getNext();if(this.withinDirectionalStart(l))if(this.withinDirectionalEnd(l))s=s.updateImmediateChild(l.name,l.node),o++;else break;else continue}}else{s=n.withIndex(this.index_),s=s.updatePriority(ze.EMPTY_NODE);let i;this.reverse_?i=s.getReverseIterator(this.index_):i=s.getIterator(this.index_);let o=0;for(;i.hasNext();){const l=i.getNext();o<this.limit_&&this.withinDirectionalStart(l)&&this.withinDirectionalEnd(l)?o++:s=s.updateImmediateChild(l.name,ze.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,r)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,n,r,s,i){let o;if(this.reverse_){const h=this.index_.getCompare();o=(f,S)=>h(S,f)}else o=this.index_.getCompare();const l=e;he(l.numChildren()===this.limit_,"");const c=new ct(n,r),d=this.reverse_?l.getFirstChild(this.index_):l.getLastChild(this.index_),u=this.rangedFilter_.matches(c);if(l.hasChild(n)){const h=l.getImmediateChild(n);let f=s.getChildAfterChild(this.index_,d,this.reverse_);for(;f!=null&&(f.name===n||l.hasChild(f.name));)f=s.getChildAfterChild(this.index_,f,this.reverse_);const S=f==null?1:o(f,c);if(u&&!r.isEmpty()&&S>=0)return i!=null&&i.trackChildChange(Sl(n,r,h)),l.updateImmediateChild(n,r);{i!=null&&i.trackChildChange(El(n,h));const w=l.updateImmediateChild(n,ze.EMPTY_NODE);return f!=null&&this.rangedFilter_.matches(f)?(i!=null&&i.trackChildChange(Uo(f.name,f.node)),w.updateImmediateChild(f.name,f.node)):w}}else return r.isEmpty()?e:u&&o(d,c)>=0?(i!=null&&(i.trackChildChange(El(d.name,d.node)),i.trackChildChange(Uo(n,r))),l.updateImmediateChild(n,r).updateImmediateChild(d.name,ze.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i0{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Dt}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return he(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return he(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Fo}hasEnd(){return this.endSet_}getIndexEndValue(){return he(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return he(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:ki}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return he(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Dt}copy(){const e=new i0;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function D5(t){return t.loadsAllData()?new s0(t.getIndex()):t.hasLimit()?new L5(t):new Il(t)}function kv(t){const e={};if(t.isDefault())return e;let n;if(t.index_===Dt?n="$priority":t.index_===P5?n="$value":t.index_===Io?n="$key":(he(t.index_ instanceof R5,"Unrecognized index type!"),n=t.index_.toString()),e.orderBy=Xt(n),t.startSet_){const r=t.startAfterSet_?"startAfter":"startAt";e[r]=Xt(t.indexStartValue_),t.startNameSet_&&(e[r]+=","+Xt(t.indexStartName_))}if(t.endSet_){const r=t.endBeforeSet_?"endBefore":"endAt";e[r]=Xt(t.indexEndValue_),t.endNameSet_&&(e[r]+=","+Xt(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function Rv(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;n===""&&(t.isViewFromLeft()?n="l":n="r"),e.vf=n}return t.index_!==Dt&&(e.i=t.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kd extends Fb{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,n){return n!==void 0?"tag$"+n:(he(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,n,r,s){super(),this.repoInfo_=e,this.onDataUpdate_=n,this.authTokenProvider_=r,this.appCheckTokenProvider_=s,this.log_=Fl("p:rest:"),this.listens_={}}listen(e,n,r,s){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const o=Kd.getListenId_(e,r),l={};this.listens_[o]=l;const c=kv(e._queryParams);this.restRequest_(i+".json",c,(d,u)=>{let h=u;if(d===404&&(h=null,d=null),d===null&&this.onDataUpdate_(i,h,!1,r),wi(this.listens_,o)===l){let f;d?d===401?f="permission_denied":f="rest_error:"+d:f="ok",s(f,null)}})}unlisten(e,n){const r=Kd.getListenId_(e,n);delete this.listens_[r]}get(e){const n=kv(e._queryParams),r=e._path.toString(),s=new ur;return this.restRequest_(r+".json",n,(i,o)=>{let l=o;i===404&&(l=null,i=null),i===null?(this.onDataUpdate_(r,l,!1,null),s.resolve(l)):s.reject(new Error(l))}),s.promise}refreshAuthToken(e){}restRequest_(e,n={},r){return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,i])=>{s&&s.accessToken&&(n.auth=s.accessToken),i&&i.token&&(n.ac=i.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Qo(n);this.log_("Sending REST request for "+o);const l=new XMLHttpRequest;l.onreadystatechange=()=>{if(r&&l.readyState===4){this.log_("REST Response for "+o+" received. status:",l.status,"response:",l.responseText);let c=null;if(l.status>=200&&l.status<300){try{c=vl(l.responseText)}catch{wn("Failed to parse JSON response for "+o+": "+l.responseText)}r(null,c)}else l.status!==401&&l.status!==404&&wn("Got unsuccessful REST response for "+o+" Status: "+l.status),r(l.status);r=null}},l.open("GET",o,!0),l.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M5{constructor(){this.rootNode_=ze.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,n){this.rootNode_=this.rootNode_.updateChild(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xd(){return{value:null,children:new Map}}function Zo(t,e,n){if(lt(e))t.value=n,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,n);else{const r=ot(e);t.children.has(r)||t.children.set(r,Xd());const s=t.children.get(r);e=wt(e),Zo(s,e,n)}}function Sp(t,e){if(lt(e))return t.value=null,t.children.clear(),!0;if(t.value!==null){if(t.value.isLeafNode())return!1;{const n=t.value;return t.value=null,n.forEachChild(Dt,(r,s)=>{Zo(t,new bt(r),s)}),Sp(t,e)}}else if(t.children.size>0){const n=ot(e);return e=wt(e),t.children.has(n)&&Sp(t.children.get(n),e)&&t.children.delete(n),t.children.size===0}else return!0}function Ip(t,e,n){t.value!==null?n(e,t.value):N5(t,(r,s)=>{const i=new bt(e.toString()+"/"+r);Ip(s,i,n)})}function N5(t,e){t.children.forEach((n,r)=>{e(r,n)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j5{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),n={...e};return this.last_&&rn(this.last_,(r,s)=>{n[r]=n[r]-s}),this.last_=e,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Av=10*1e3,$5=30*1e3,F5=5*60*1e3;class U5{constructor(e,n){this.server_=n,this.statsToReport_={},this.statsListener_=new j5(e);const r=Av+($5-Av)*Math.random();Va(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),n={};let r=!1;rn(e,(s,i)=>{i>0&&xr(this.statsToReport_,s)&&(n[s]=i,r=!0)}),r&&this.server_.reportStats(n),Va(this.reportStats_.bind(this),Math.floor(Math.random()*2*F5))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var hr;(function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(hr||(hr={}));function o0(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function a0(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function l0(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qd{constructor(e,n,r){this.path=e,this.affectedTree=n,this.revert=r,this.type=hr.ACK_USER_WRITE,this.source=o0()}operationForChild(e){if(lt(this.path)){if(this.affectedTree.value!=null)return he(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const n=this.affectedTree.subtree(new bt(e));return new Qd(gt(),n,this.revert)}}else return he(ot(this.path)===e,"operationForChild called for unrelated child."),new Qd(wt(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wl{constructor(e,n){this.source=e,this.path=n,this.type=hr.LISTEN_COMPLETE}operationForChild(e){return lt(this.path)?new wl(this.source,gt()):new wl(this.source,wt(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ri{constructor(e,n,r){this.source=e,this.path=n,this.snap=r,this.type=hr.OVERWRITE}operationForChild(e){return lt(this.path)?new Ri(this.source,gt(),this.snap.getImmediateChild(e)):new Ri(this.source,wt(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bo{constructor(e,n,r){this.source=e,this.path=n,this.children=r,this.type=hr.MERGE}operationForChild(e){if(lt(this.path)){const n=this.children.subtree(new bt(e));return n.isEmpty()?null:n.value?new Ri(this.source,gt(),n.value):new Bo(this.source,gt(),n)}else return he(ot(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Bo(this.source,wt(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ks{constructor(e,n,r){this.node_=e,this.fullyInitialized_=n,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(lt(e))return this.isFullyInitialized()&&!this.filtered_;const n=ot(e);return this.isCompleteForChild(n)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B5{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function z5(t,e,n,r){const s=[],i=[];return e.forEach(o=>{o.type==="child_changed"&&t.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&i.push(O5(o.childName,o.snapshotNode))}),Ta(t,s,"child_removed",e,r,n),Ta(t,s,"child_added",e,r,n),Ta(t,s,"child_moved",i,r,n),Ta(t,s,"child_changed",e,r,n),Ta(t,s,"value",e,r,n),s}function Ta(t,e,n,r,s,i){const o=r.filter(l=>l.type===n);o.sort((l,c)=>W5(t,l,c)),o.forEach(l=>{const c=H5(t,l,i);s.forEach(d=>{d.respondsTo(l.type)&&e.push(d.createEvent(c,t.query_))})})}function H5(t,e,n){return e.type==="value"||e.type==="child_removed"||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function W5(t,e,n){if(e.childName==null||n.childName==null)throw Ko("Should only compare child_ events.");const r=new ct(e.childName,e.snapshotNode),s=new ct(n.childName,n.snapshotNode);return t.index_.compare(r,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ou(t,e){return{eventCache:t,serverCache:e}}function Ya(t,e,n,r){return Ou(new Ks(e,n,r),t.serverCache)}function Xb(t,e,n,r){return Ou(t.eventCache,new Ks(e,n,r))}function Jd(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function Ai(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let hh;const G5=()=>(hh||(hh=new Dn(Rk)),hh);class Ct{static fromObject(e){let n=new Ct(null);return rn(e,(r,s)=>{n=n.set(new bt(r),s)}),n}constructor(e,n=G5()){this.value=e,this.children=n}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,n){if(this.value!=null&&n(this.value))return{path:gt(),value:this.value};if(lt(e))return null;{const r=ot(e),s=this.children.get(r);if(s!==null){const i=s.findRootMostMatchingPathAndValue(wt(e),n);return i!=null?{path:jt(new bt(r),i.path),value:i.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(lt(e))return this;{const n=ot(e),r=this.children.get(n);return r!==null?r.subtree(wt(e)):new Ct(null)}}set(e,n){if(lt(e))return new Ct(n,this.children);{const r=ot(e),i=(this.children.get(r)||new Ct(null)).set(wt(e),n),o=this.children.insert(r,i);return new Ct(this.value,o)}}remove(e){if(lt(e))return this.children.isEmpty()?new Ct(null):new Ct(null,this.children);{const n=ot(e),r=this.children.get(n);if(r){const s=r.remove(wt(e));let i;return s.isEmpty()?i=this.children.remove(n):i=this.children.insert(n,s),this.value===null&&i.isEmpty()?new Ct(null):new Ct(this.value,i)}else return this}}get(e){if(lt(e))return this.value;{const n=ot(e),r=this.children.get(n);return r?r.get(wt(e)):null}}setTree(e,n){if(lt(e))return n;{const r=ot(e),i=(this.children.get(r)||new Ct(null)).setTree(wt(e),n);let o;return i.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,i),new Ct(this.value,o)}}fold(e){return this.fold_(gt(),e)}fold_(e,n){const r={};return this.children.inorderTraversal((s,i)=>{r[s]=i.fold_(jt(e,s),n)}),n(e,this.value,r)}findOnPath(e,n){return this.findOnPath_(e,gt(),n)}findOnPath_(e,n,r){const s=this.value?r(n,this.value):!1;if(s)return s;if(lt(e))return null;{const i=ot(e),o=this.children.get(i);return o?o.findOnPath_(wt(e),jt(n,i),r):null}}foreachOnPath(e,n){return this.foreachOnPath_(e,gt(),n)}foreachOnPath_(e,n,r){if(lt(e))return this;{this.value&&r(n,this.value);const s=ot(e),i=this.children.get(s);return i?i.foreachOnPath_(wt(e),jt(n,s),r):new Ct(null)}}foreach(e){this.foreach_(gt(),e)}foreach_(e,n){this.children.inorderTraversal((r,s)=>{s.foreach_(jt(e,r),n)}),this.value&&n(e,this.value)}foreachChild(e){this.children.inorderTraversal((n,r)=>{r.value&&e(n,r.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yr{constructor(e){this.writeTree_=e}static empty(){return new yr(new Ct(null))}}function Ka(t,e,n){if(lt(e))return new yr(new Ct(n));{const r=t.writeTree_.findRootMostValueAndPath(e);if(r!=null){const s=r.path;let i=r.value;const o=Sn(s,e);return i=i.updateChild(o,n),new yr(t.writeTree_.set(s,i))}else{const s=new Ct(n),i=t.writeTree_.setTree(e,s);return new yr(i)}}}function wp(t,e,n){let r=t;return rn(n,(s,i)=>{r=Ka(r,jt(e,s),i)}),r}function Pv(t,e){if(lt(e))return yr.empty();{const n=t.writeTree_.setTree(e,new Ct(null));return new yr(n)}}function Tp(t,e){return Mi(t,e)!=null}function Mi(t,e){const n=t.writeTree_.findRootMostValueAndPath(e);return n!=null?t.writeTree_.get(n.path).getChild(Sn(n.path,e)):null}function Ov(t){const e=[],n=t.writeTree_.value;return n!=null?n.isLeafNode()||n.forEachChild(Dt,(r,s)=>{e.push(new ct(r,s))}):t.writeTree_.children.inorderTraversal((r,s)=>{s.value!=null&&e.push(new ct(r,s.value))}),e}function zs(t,e){if(lt(e))return t;{const n=Mi(t,e);return n!=null?new yr(new Ct(n)):new yr(t.writeTree_.subtree(e))}}function Cp(t){return t.writeTree_.isEmpty()}function zo(t,e){return Qb(gt(),t.writeTree_,e)}function Qb(t,e,n){if(e.value!=null)return n.updateChild(t,e.value);{let r=null;return e.children.inorderTraversal((s,i)=>{s===".priority"?(he(i.value!==null,"Priority writes must always be leaf nodes"),r=i.value):n=Qb(jt(t,s),i,n)}),!n.getChild(t).isEmpty()&&r!==null&&(n=n.updateChild(jt(t,".priority"),r)),n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lu(t,e){return eE(e,t)}function V5(t,e,n,r,s){he(r>t.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),t.allWrites.push({path:e,snap:n,writeId:r,visible:s}),s&&(t.visibleWrites=Ka(t.visibleWrites,e,n)),t.lastWriteId=r}function Y5(t,e,n,r){he(r>t.lastWriteId,"Stacking an older merge on top of newer ones"),t.allWrites.push({path:e,children:n,writeId:r,visible:!0}),t.visibleWrites=wp(t.visibleWrites,e,n),t.lastWriteId=r}function K5(t,e){for(let n=0;n<t.allWrites.length;n++){const r=t.allWrites[n];if(r.writeId===e)return r}return null}function X5(t,e){const n=t.allWrites.findIndex(l=>l.writeId===e);he(n>=0,"removeWrite called with nonexistent writeId.");const r=t.allWrites[n];t.allWrites.splice(n,1);let s=r.visible,i=!1,o=t.allWrites.length-1;for(;s&&o>=0;){const l=t.allWrites[o];l.visible&&(o>=n&&Q5(l,r.path)?s=!1:er(r.path,l.path)&&(i=!0)),o--}if(s){if(i)return J5(t),!0;if(r.snap)t.visibleWrites=Pv(t.visibleWrites,r.path);else{const l=r.children;rn(l,c=>{t.visibleWrites=Pv(t.visibleWrites,jt(r.path,c))})}return!0}else return!1}function Q5(t,e){if(t.snap)return er(t.path,e);for(const n in t.children)if(t.children.hasOwnProperty(n)&&er(jt(t.path,n),e))return!0;return!1}function J5(t){t.visibleWrites=Jb(t.allWrites,q5,gt()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function q5(t){return t.visible}function Jb(t,e,n){let r=yr.empty();for(let s=0;s<t.length;++s){const i=t[s];if(e(i)){const o=i.path;let l;if(i.snap)er(n,o)?(l=Sn(n,o),r=Ka(r,l,i.snap)):er(o,n)&&(l=Sn(o,n),r=Ka(r,gt(),i.snap.getChild(l)));else if(i.children){if(er(n,o))l=Sn(n,o),r=wp(r,l,i.children);else if(er(o,n))if(l=Sn(o,n),lt(l))r=wp(r,gt(),i.children);else{const c=wi(i.children,ot(l));if(c){const d=c.getChild(wt(l));r=Ka(r,gt(),d)}}}else throw Ko("WriteRecord should have .snap or .children")}}return r}function qb(t,e,n,r,s){if(!r&&!s){const i=Mi(t.visibleWrites,e);if(i!=null)return i;{const o=zs(t.visibleWrites,e);if(Cp(o))return n;if(n==null&&!Tp(o,gt()))return null;{const l=n||ze.EMPTY_NODE;return zo(o,l)}}}else{const i=zs(t.visibleWrites,e);if(!s&&Cp(i))return n;if(!s&&n==null&&!Tp(i,gt()))return null;{const o=function(d){return(d.visible||s)&&(!r||!~r.indexOf(d.writeId))&&(er(d.path,e)||er(e,d.path))},l=Jb(t.allWrites,o,e),c=n||ze.EMPTY_NODE;return zo(l,c)}}}function Z5(t,e,n){let r=ze.EMPTY_NODE;const s=Mi(t.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(Dt,(i,o)=>{r=r.updateImmediateChild(i,o)}),r;if(n){const i=zs(t.visibleWrites,e);return n.forEachChild(Dt,(o,l)=>{const c=zo(zs(i,new bt(o)),l);r=r.updateImmediateChild(o,c)}),Ov(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{const i=zs(t.visibleWrites,e);return Ov(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function eR(t,e,n,r,s){he(r||s,"Either existingEventSnap or existingServerSnap must exist");const i=jt(e,n);if(Tp(t.visibleWrites,i))return null;{const o=zs(t.visibleWrites,i);return Cp(o)?s.getChild(n):zo(o,s.getChild(n))}}function tR(t,e,n,r){const s=jt(e,n),i=Mi(t.visibleWrites,s);if(i!=null)return i;if(r.isCompleteForChild(n)){const o=zs(t.visibleWrites,s);return zo(o,r.getNode().getImmediateChild(n))}else return null}function nR(t,e){return Mi(t.visibleWrites,e)}function rR(t,e,n,r,s,i,o){let l;const c=zs(t.visibleWrites,e),d=Mi(c,gt());if(d!=null)l=d;else if(n!=null)l=zo(c,n);else return[];if(l=l.withIndex(o),!l.isEmpty()&&!l.isLeafNode()){const u=[],h=o.getCompare(),f=i?l.getReverseIteratorFrom(r,o):l.getIteratorFrom(r,o);let S=f.getNext();for(;S&&u.length<s;)h(S,r)!==0&&u.push(S),S=f.getNext();return u}else return[]}function sR(){return{visibleWrites:yr.empty(),allWrites:[],lastWriteId:-1}}function qd(t,e,n,r){return qb(t.writeTree,t.treePath,e,n,r)}function c0(t,e){return Z5(t.writeTree,t.treePath,e)}function Lv(t,e,n,r){return eR(t.writeTree,t.treePath,e,n,r)}function Zd(t,e){return nR(t.writeTree,jt(t.treePath,e))}function iR(t,e,n,r,s,i){return rR(t.writeTree,t.treePath,e,n,r,s,i)}function d0(t,e,n){return tR(t.writeTree,t.treePath,e,n)}function Zb(t,e){return eE(jt(t.treePath,e),t.writeTree)}function eE(t,e){return{treePath:t,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oR{constructor(){this.changeMap=new Map}trackChildChange(e){const n=e.type,r=e.childName;he(n==="child_added"||n==="child_changed"||n==="child_removed","Only child changes supported for tracking"),he(r!==".priority","Only non-priority child changes can be tracked.");const s=this.changeMap.get(r);if(s){const i=s.type;if(n==="child_added"&&i==="child_removed")this.changeMap.set(r,Sl(r,e.snapshotNode,s.snapshotNode));else if(n==="child_removed"&&i==="child_added")this.changeMap.delete(r);else if(n==="child_removed"&&i==="child_changed")this.changeMap.set(r,El(r,s.oldSnap));else if(n==="child_changed"&&i==="child_added")this.changeMap.set(r,Uo(r,e.snapshotNode));else if(n==="child_changed"&&i==="child_changed")this.changeMap.set(r,Sl(r,e.snapshotNode,s.oldSnap));else throw Ko("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aR{getCompleteChild(e){return null}getChildAfterChild(e,n,r){return null}}const tE=new aR;class u0{constructor(e,n,r=null){this.writes_=e,this.viewCache_=n,this.optCompleteServerCache_=r}getCompleteChild(e){const n=this.viewCache_.eventCache;if(n.isCompleteForChild(e))return n.getNode().getImmediateChild(e);{const r=this.optCompleteServerCache_!=null?new Ks(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return d0(this.writes_,e,r)}}getChildAfterChild(e,n,r){const s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Ai(this.viewCache_),i=iR(this.writes_,s,n,1,r,e);return i.length===0?null:i[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lR(t){return{filter:t}}function cR(t,e){he(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),he(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function dR(t,e,n,r,s){const i=new oR;let o,l;if(n.type===hr.OVERWRITE){const d=n;d.source.fromUser?o=kp(t,e,d.path,d.snap,r,s,i):(he(d.source.fromServer,"Unknown source."),l=d.source.tagged||e.serverCache.isFiltered()&&!lt(d.path),o=eu(t,e,d.path,d.snap,r,s,l,i))}else if(n.type===hr.MERGE){const d=n;d.source.fromUser?o=fR(t,e,d.path,d.children,r,s,i):(he(d.source.fromServer,"Unknown source."),l=d.source.tagged||e.serverCache.isFiltered(),o=Rp(t,e,d.path,d.children,r,s,l,i))}else if(n.type===hr.ACK_USER_WRITE){const d=n;d.revert?o=gR(t,e,d.path,r,s,i):o=hR(t,e,d.path,d.affectedTree,r,s,i)}else if(n.type===hr.LISTEN_COMPLETE)o=pR(t,e,n.path,r,i);else throw Ko("Unknown operation type: "+n.type);const c=i.getChanges();return uR(e,o,c),{viewCache:o,changes:c}}function uR(t,e,n){const r=e.eventCache;if(r.isFullyInitialized()){const s=r.getNode().isLeafNode()||r.getNode().isEmpty(),i=Jd(t);(n.length>0||!t.eventCache.isFullyInitialized()||s&&!r.getNode().equals(i)||!r.getNode().getPriority().equals(i.getPriority()))&&n.push(Kb(Jd(e)))}}function nE(t,e,n,r,s,i){const o=e.eventCache;if(Zd(r,n)!=null)return e;{let l,c;if(lt(n))if(he(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const d=Ai(e),u=d instanceof ze?d:ze.EMPTY_NODE,h=c0(r,u);l=t.filter.updateFullNode(e.eventCache.getNode(),h,i)}else{const d=qd(r,Ai(e));l=t.filter.updateFullNode(e.eventCache.getNode(),d,i)}else{const d=ot(n);if(d===".priority"){he(Ys(n)===1,"Can't have a priority with additional path components");const u=o.getNode();c=e.serverCache.getNode();const h=Lv(r,n,u,c);h!=null?l=t.filter.updatePriority(u,h):l=o.getNode()}else{const u=wt(n);let h;if(o.isCompleteForChild(d)){c=e.serverCache.getNode();const f=Lv(r,n,o.getNode(),c);f!=null?h=o.getNode().getImmediateChild(d).updateChild(u,f):h=o.getNode().getImmediateChild(d)}else h=d0(r,d,e.serverCache);h!=null?l=t.filter.updateChild(o.getNode(),d,h,u,s,i):l=o.getNode()}}return Ya(e,l,o.isFullyInitialized()||lt(n),t.filter.filtersNodes())}}function eu(t,e,n,r,s,i,o,l){const c=e.serverCache;let d;const u=o?t.filter:t.filter.getIndexedFilter();if(lt(n))d=u.updateFullNode(c.getNode(),r,null);else if(u.filtersNodes()&&!c.isFiltered()){const S=c.getNode().updateChild(n,r);d=u.updateFullNode(c.getNode(),S,null)}else{const S=ot(n);if(!c.isCompleteForPath(n)&&Ys(n)>1)return e;const k=wt(n),j=c.getNode().getImmediateChild(S).updateChild(k,r);S===".priority"?d=u.updatePriority(c.getNode(),j):d=u.updateChild(c.getNode(),S,j,k,tE,null)}const h=Xb(e,d,c.isFullyInitialized()||lt(n),u.filtersNodes()),f=new u0(s,h,i);return nE(t,h,n,s,f,l)}function kp(t,e,n,r,s,i,o){const l=e.eventCache;let c,d;const u=new u0(s,e,i);if(lt(n))d=t.filter.updateFullNode(e.eventCache.getNode(),r,o),c=Ya(e,d,!0,t.filter.filtersNodes());else{const h=ot(n);if(h===".priority")d=t.filter.updatePriority(e.eventCache.getNode(),r),c=Ya(e,d,l.isFullyInitialized(),l.isFiltered());else{const f=wt(n),S=l.getNode().getImmediateChild(h);let k;if(lt(f))k=r;else{const w=u.getCompleteChild(h);w!=null?e0(f)===".priority"&&w.getChild(Bb(f)).isEmpty()?k=w:k=w.updateChild(f,r):k=ze.EMPTY_NODE}if(S.equals(k))c=e;else{const w=t.filter.updateChild(l.getNode(),h,k,f,u,o);c=Ya(e,w,l.isFullyInitialized(),t.filter.filtersNodes())}}}return c}function Dv(t,e){return t.eventCache.isCompleteForChild(e)}function fR(t,e,n,r,s,i,o){let l=e;return r.foreach((c,d)=>{const u=jt(n,c);Dv(e,ot(u))&&(l=kp(t,l,u,d,s,i,o))}),r.foreach((c,d)=>{const u=jt(n,c);Dv(e,ot(u))||(l=kp(t,l,u,d,s,i,o))}),l}function Mv(t,e,n){return n.foreach((r,s)=>{e=e.updateChild(r,s)}),e}function Rp(t,e,n,r,s,i,o,l){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,d;lt(n)?d=r:d=new Ct(null).setTree(n,r);const u=e.serverCache.getNode();return d.children.inorderTraversal((h,f)=>{if(u.hasChild(h)){const S=e.serverCache.getNode().getImmediateChild(h),k=Mv(t,S,f);c=eu(t,c,new bt(h),k,s,i,o,l)}}),d.children.inorderTraversal((h,f)=>{const S=!e.serverCache.isCompleteForChild(h)&&f.value===null;if(!u.hasChild(h)&&!S){const k=e.serverCache.getNode().getImmediateChild(h),w=Mv(t,k,f);c=eu(t,c,new bt(h),w,s,i,o,l)}}),c}function hR(t,e,n,r,s,i,o){if(Zd(s,n)!=null)return e;const l=e.serverCache.isFiltered(),c=e.serverCache;if(r.value!=null){if(lt(n)&&c.isFullyInitialized()||c.isCompleteForPath(n))return eu(t,e,n,c.getNode().getChild(n),s,i,l,o);if(lt(n)){let d=new Ct(null);return c.getNode().forEachChild(Io,(u,h)=>{d=d.set(new bt(u),h)}),Rp(t,e,n,d,s,i,l,o)}else return e}else{let d=new Ct(null);return r.foreach((u,h)=>{const f=jt(n,u);c.isCompleteForPath(f)&&(d=d.set(u,c.getNode().getChild(f)))}),Rp(t,e,n,d,s,i,l,o)}}function pR(t,e,n,r,s){const i=e.serverCache,o=Xb(e,i.getNode(),i.isFullyInitialized()||lt(n),i.isFiltered());return nE(t,o,n,r,tE,s)}function gR(t,e,n,r,s,i){let o;if(Zd(r,n)!=null)return e;{const l=new u0(r,e,s),c=e.eventCache.getNode();let d;if(lt(n)||ot(n)===".priority"){let u;if(e.serverCache.isFullyInitialized())u=qd(r,Ai(e));else{const h=e.serverCache.getNode();he(h instanceof ze,"serverChildren would be complete if leaf node"),u=c0(r,h)}u=u,d=t.filter.updateFullNode(c,u,i)}else{const u=ot(n);let h=d0(r,u,e.serverCache);h==null&&e.serverCache.isCompleteForChild(u)&&(h=c.getImmediateChild(u)),h!=null?d=t.filter.updateChild(c,u,h,wt(n),l,i):e.eventCache.getNode().hasChild(u)?d=t.filter.updateChild(c,u,ze.EMPTY_NODE,wt(n),l,i):d=c,d.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=qd(r,Ai(e)),o.isLeafNode()&&(d=t.filter.updateFullNode(d,o,i)))}return o=e.serverCache.isFullyInitialized()||Zd(r,gt())!=null,Ya(e,d,o,t.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mR{constructor(e,n){this.query_=e,this.eventRegistrations_=[];const r=this.query_._queryParams,s=new s0(r.getIndex()),i=D5(r);this.processor_=lR(i);const o=n.serverCache,l=n.eventCache,c=s.updateFullNode(ze.EMPTY_NODE,o.getNode(),null),d=i.updateFullNode(ze.EMPTY_NODE,l.getNode(),null),u=new Ks(c,o.isFullyInitialized(),s.filtersNodes()),h=new Ks(d,l.isFullyInitialized(),i.filtersNodes());this.viewCache_=Ou(h,u),this.eventGenerator_=new B5(this.query_)}get query(){return this.query_}}function yR(t){return t.viewCache_.serverCache.getNode()}function vR(t){return Jd(t.viewCache_)}function _R(t,e){const n=Ai(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!lt(e)&&!n.getImmediateChild(ot(e)).isEmpty())?n.getChild(e):null}function Nv(t){return t.eventRegistrations_.length===0}function xR(t,e){t.eventRegistrations_.push(e)}function jv(t,e,n){const r=[];if(n){he(e==null,"A cancel should cancel all event registrations.");const s=t.query._path;t.eventRegistrations_.forEach(i=>{const o=i.createCancelEvent(n,s);o&&r.push(o)})}if(e){let s=[];for(let i=0;i<t.eventRegistrations_.length;++i){const o=t.eventRegistrations_[i];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(t.eventRegistrations_.slice(i+1));break}}t.eventRegistrations_=s}else t.eventRegistrations_=[];return r}function $v(t,e,n,r){e.type===hr.MERGE&&e.source.queryId!==null&&(he(Ai(t.viewCache_),"We should always have a full cache before handling merges"),he(Jd(t.viewCache_),"Missing event cache, even though we have a server cache"));const s=t.viewCache_,i=dR(t.processor_,s,e,n,r);return cR(t.processor_,i.viewCache),he(i.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=i.viewCache,rE(t,i.changes,i.viewCache.eventCache.getNode(),null)}function bR(t,e){const n=t.viewCache_.eventCache,r=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(Dt,(i,o)=>{r.push(Uo(i,o))}),n.isFullyInitialized()&&r.push(Kb(n.getNode())),rE(t,r,n.getNode(),e)}function rE(t,e,n,r){const s=r?[r]:t.eventRegistrations_;return z5(t.eventGenerator_,e,n,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tu;class sE{constructor(){this.views=new Map}}function ER(t){he(!tu,"__referenceConstructor has already been defined"),tu=t}function SR(){return he(tu,"Reference.ts has not been loaded"),tu}function IR(t){return t.views.size===0}function f0(t,e,n,r){const s=e.source.queryId;if(s!==null){const i=t.views.get(s);return he(i!=null,"SyncTree gave us an op for an invalid query."),$v(i,e,n,r)}else{let i=[];for(const o of t.views.values())i=i.concat($v(o,e,n,r));return i}}function iE(t,e,n,r,s){const i=e._queryIdentifier,o=t.views.get(i);if(!o){let l=qd(n,s?r:null),c=!1;l?c=!0:r instanceof ze?(l=c0(n,r),c=!1):(l=ze.EMPTY_NODE,c=!1);const d=Ou(new Ks(l,c,!1),new Ks(r,s,!1));return new mR(e,d)}return o}function wR(t,e,n,r,s,i){const o=iE(t,e,r,s,i);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,o),xR(o,n),bR(o,n)}function TR(t,e,n,r){const s=e._queryIdentifier,i=[];let o=[];const l=Xs(t);if(s==="default")for(const[c,d]of t.views.entries())o=o.concat(jv(d,n,r)),Nv(d)&&(t.views.delete(c),d.query._queryParams.loadsAllData()||i.push(d.query));else{const c=t.views.get(s);c&&(o=o.concat(jv(c,n,r)),Nv(c)&&(t.views.delete(s),c.query._queryParams.loadsAllData()||i.push(c.query)))}return l&&!Xs(t)&&i.push(new(SR())(e._repo,e._path)),{removed:i,events:o}}function oE(t){const e=[];for(const n of t.views.values())n.query._queryParams.loadsAllData()||e.push(n);return e}function Hs(t,e){let n=null;for(const r of t.views.values())n=n||_R(r,e);return n}function aE(t,e){if(e._queryParams.loadsAllData())return Du(t);{const r=e._queryIdentifier;return t.views.get(r)}}function lE(t,e){return aE(t,e)!=null}function Xs(t){return Du(t)!=null}function Du(t){for(const e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nu;function CR(t){he(!nu,"__referenceConstructor has already been defined"),nu=t}function kR(){return he(nu,"Reference.ts has not been loaded"),nu}let RR=1;class Fv{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Ct(null),this.pendingWriteTree_=sR(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function h0(t,e,n,r,s){return V5(t.pendingWriteTree_,e,n,r,s),s?ea(t,new Ri(o0(),e,n)):[]}function AR(t,e,n,r){Y5(t.pendingWriteTree_,e,n,r);const s=Ct.fromObject(n);return ea(t,new Bo(o0(),e,s))}function ks(t,e,n=!1){const r=K5(t.pendingWriteTree_,e);if(X5(t.pendingWriteTree_,e)){let i=new Ct(null);return r.snap!=null?i=i.set(gt(),!0):rn(r.children,o=>{i=i.set(new bt(o),!0)}),ea(t,new Qd(r.path,i,n))}else return[]}function Bl(t,e,n){return ea(t,new Ri(a0(),e,n))}function PR(t,e,n){const r=Ct.fromObject(n);return ea(t,new Bo(a0(),e,r))}function OR(t,e){return ea(t,new wl(a0(),e))}function LR(t,e,n){const r=p0(t,n);if(r){const s=g0(r),i=s.path,o=s.queryId,l=Sn(i,e),c=new wl(l0(o),l);return m0(t,i,c)}else return[]}function ru(t,e,n,r,s=!1){const i=e._path,o=t.syncPointTree_.get(i);let l=[];if(o&&(e._queryIdentifier==="default"||lE(o,e))){const c=TR(o,e,n,r);IR(o)&&(t.syncPointTree_=t.syncPointTree_.remove(i));const d=c.removed;if(l=c.events,!s){const u=d.findIndex(f=>f._queryParams.loadsAllData())!==-1,h=t.syncPointTree_.findOnPath(i,(f,S)=>Xs(S));if(u&&!h){const f=t.syncPointTree_.subtree(i);if(!f.isEmpty()){const S=NR(f);for(let k=0;k<S.length;++k){const w=S[k],j=w.query,_=fE(t,w);t.listenProvider_.startListening(Xa(j),Tl(t,j),_.hashFn,_.onComplete)}}}!h&&d.length>0&&!r&&(u?t.listenProvider_.stopListening(Xa(e),null):d.forEach(f=>{const S=t.queryToTagMap.get(Nu(f));t.listenProvider_.stopListening(Xa(f),S)}))}jR(t,d)}return l}function cE(t,e,n,r){const s=p0(t,r);if(s!=null){const i=g0(s),o=i.path,l=i.queryId,c=Sn(o,e),d=new Ri(l0(l),c,n);return m0(t,o,d)}else return[]}function DR(t,e,n,r){const s=p0(t,r);if(s){const i=g0(s),o=i.path,l=i.queryId,c=Sn(o,e),d=Ct.fromObject(n),u=new Bo(l0(l),c,d);return m0(t,o,u)}else return[]}function Ap(t,e,n,r=!1){const s=e._path;let i=null,o=!1;t.syncPointTree_.foreachOnPath(s,(f,S)=>{const k=Sn(f,s);i=i||Hs(S,k),o=o||Xs(S)});let l=t.syncPointTree_.get(s);l?(o=o||Xs(l),i=i||Hs(l,gt())):(l=new sE,t.syncPointTree_=t.syncPointTree_.set(s,l));let c;i!=null?c=!0:(c=!1,i=ze.EMPTY_NODE,t.syncPointTree_.subtree(s).foreachChild((S,k)=>{const w=Hs(k,gt());w&&(i=i.updateImmediateChild(S,w))}));const d=lE(l,e);if(!d&&!e._queryParams.loadsAllData()){const f=Nu(e);he(!t.queryToTagMap.has(f),"View does not exist, but we have a tag");const S=$R();t.queryToTagMap.set(f,S),t.tagToQueryMap.set(S,f)}const u=Lu(t.pendingWriteTree_,s);let h=wR(l,e,n,u,i,c);if(!d&&!o&&!r){const f=aE(l,e);h=h.concat(FR(t,e,f))}return h}function Mu(t,e,n){const s=t.pendingWriteTree_,i=t.syncPointTree_.findOnPath(e,(o,l)=>{const c=Sn(o,e),d=Hs(l,c);if(d)return d});return qb(s,e,i,n,!0)}function MR(t,e){const n=e._path;let r=null;t.syncPointTree_.foreachOnPath(n,(d,u)=>{const h=Sn(d,n);r=r||Hs(u,h)});let s=t.syncPointTree_.get(n);s?r=r||Hs(s,gt()):(s=new sE,t.syncPointTree_=t.syncPointTree_.set(n,s));const i=r!=null,o=i?new Ks(r,!0,!1):null,l=Lu(t.pendingWriteTree_,e._path),c=iE(s,e,l,i?o.getNode():ze.EMPTY_NODE,i);return vR(c)}function ea(t,e){return dE(e,t.syncPointTree_,null,Lu(t.pendingWriteTree_,gt()))}function dE(t,e,n,r){if(lt(t.path))return uE(t,e,n,r);{const s=e.get(gt());n==null&&s!=null&&(n=Hs(s,gt()));let i=[];const o=ot(t.path),l=t.operationForChild(o),c=e.children.get(o);if(c&&l){const d=n?n.getImmediateChild(o):null,u=Zb(r,o);i=i.concat(dE(l,c,d,u))}return s&&(i=i.concat(f0(s,t,r,n))),i}}function uE(t,e,n,r){const s=e.get(gt());n==null&&s!=null&&(n=Hs(s,gt()));let i=[];return e.children.inorderTraversal((o,l)=>{const c=n?n.getImmediateChild(o):null,d=Zb(r,o),u=t.operationForChild(o);u&&(i=i.concat(uE(u,l,c,d)))}),s&&(i=i.concat(f0(s,t,r,n))),i}function fE(t,e){const n=e.query,r=Tl(t,n);return{hashFn:()=>(yR(e)||ze.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return r?LR(t,n._path,r):OR(t,n._path);{const i=Ok(s,n);return ru(t,n,null,i)}}}}function Tl(t,e){const n=Nu(e);return t.queryToTagMap.get(n)}function Nu(t){return t._path.toString()+"$"+t._queryIdentifier}function p0(t,e){return t.tagToQueryMap.get(e)}function g0(t){const e=t.indexOf("$");return he(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new bt(t.substr(0,e))}}function m0(t,e,n){const r=t.syncPointTree_.get(e);he(r,"Missing sync point for query tag that we're tracking");const s=Lu(t.pendingWriteTree_,e);return f0(r,n,s,null)}function NR(t){return t.fold((e,n,r)=>{if(n&&Xs(n))return[Du(n)];{let s=[];return n&&(s=oE(n)),rn(r,(i,o)=>{s=s.concat(o)}),s}})}function Xa(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(kR())(t._repo,t._path):t}function jR(t,e){for(let n=0;n<e.length;++n){const r=e[n];if(!r._queryParams.loadsAllData()){const s=Nu(r),i=t.queryToTagMap.get(s);t.queryToTagMap.delete(s),t.tagToQueryMap.delete(i)}}}function $R(){return RR++}function FR(t,e,n){const r=e._path,s=Tl(t,e),i=fE(t,n),o=t.listenProvider_.startListening(Xa(e),s,i.hashFn,i.onComplete),l=t.syncPointTree_.subtree(r);if(s)he(!Xs(l.value),"If we're adding a query, it shouldn't be shadowed");else{const c=l.fold((d,u,h)=>{if(!lt(d)&&u&&Xs(u))return[Du(u).query];{let f=[];return u&&(f=f.concat(oE(u).map(S=>S.query))),rn(h,(S,k)=>{f=f.concat(k)}),f}});for(let d=0;d<c.length;++d){const u=c[d];t.listenProvider_.stopListening(Xa(u),Tl(t,u))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y0{constructor(e){this.node_=e}getImmediateChild(e){const n=this.node_.getImmediateChild(e);return new y0(n)}node(){return this.node_}}class v0{constructor(e,n){this.syncTree_=e,this.path_=n}getImmediateChild(e){const n=jt(this.path_,e);return new v0(this.syncTree_,n)}node(){return Mu(this.syncTree_,this.path_)}}const UR=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},Uv=function(t,e,n){if(!t||typeof t!="object")return t;if(he(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return BR(t[".sv"],e,n);if(typeof t[".sv"]=="object")return zR(t[".sv"],e);he(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},BR=function(t,e,n){switch(t){case"timestamp":return n.timestamp;default:he(!1,"Unexpected server value: "+t)}},zR=function(t,e,n){t.hasOwnProperty("increment")||he(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const r=t.increment;typeof r!="number"&&he(!1,"Unexpected increment value: "+r);const s=e.node();if(he(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return r;const o=s.getValue();return typeof o!="number"?r:o+r},hE=function(t,e,n,r){return x0(e,new v0(n,t),r)},_0=function(t,e,n){return x0(t,new y0(e),n)};function x0(t,e,n){const r=t.getPriority().val(),s=Uv(r,e.getImmediateChild(".priority"),n);let i;if(t.isLeafNode()){const o=t,l=Uv(o.getValue(),e,n);return l!==o.getValue()||s!==o.getPriority().val()?new qt(l,Nt(s)):t}else{const o=t;return i=o,s!==o.getPriority().val()&&(i=i.updatePriority(new qt(s))),o.forEachChild(Dt,(l,c)=>{const d=x0(c,e.getImmediateChild(l),n);d!==c&&(i=i.updateImmediateChild(l,d))}),i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b0{constructor(e="",n=null,r={children:{},childCount:0}){this.name=e,this.parent=n,this.node=r}}function ju(t,e){let n=e instanceof bt?e:new bt(e),r=t,s=ot(n);for(;s!==null;){const i=wi(r.node.children,s)||{children:{},childCount:0};r=new b0(s,r,i),n=wt(n),s=ot(n)}return r}function Ni(t){return t.node.value}function E0(t,e){t.node.value=e,Pp(t)}function pE(t){return t.node.childCount>0}function HR(t){return Ni(t)===void 0&&!pE(t)}function $u(t,e){rn(t.node.children,(n,r)=>{e(new b0(n,t,r))})}function gE(t,e,n,r){n&&e(t),$u(t,s=>{gE(s,e,!0)})}function WR(t,e,n){let r=t.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function zl(t){return new bt(t.parent===null?t.name:zl(t.parent)+"/"+t.name)}function Pp(t){t.parent!==null&&GR(t.parent,t.name,t)}function GR(t,e,n){const r=HR(n),s=xr(t.node.children,e);r&&s?(delete t.node.children[e],t.node.childCount--,Pp(t)):!r&&!s&&(t.node.children[e]=n.node,t.node.childCount++,Pp(t))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VR=/[\[\].#$\/\u0000-\u001F\u007F]/,YR=/[\[\].#$\u0000-\u001F\u007F]/,ph=10*1024*1024,S0=function(t){return typeof t=="string"&&t.length!==0&&!VR.test(t)},mE=function(t){return typeof t=="string"&&t.length!==0&&!YR.test(t)},KR=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),mE(t)},I0=function(t){return t===null||typeof t=="string"||typeof t=="number"&&!Au(t)||t&&typeof t=="object"&&xr(t,".sv")},su=function(t,e,n,r){r&&e===void 0||Hl(jo(t,"value"),e,n)},Hl=function(t,e,n){const r=n instanceof bt?new f5(n,t):n;if(e===void 0)throw new Error(t+"contains undefined "+fi(r));if(typeof e=="function")throw new Error(t+"contains a function "+fi(r)+" with contents = "+e.toString());if(Au(e))throw new Error(t+"contains "+e.toString()+" "+fi(r));if(typeof e=="string"&&e.length>ph/3&&Ru(e)>ph)throw new Error(t+"contains a string greater than "+ph+" utf8 bytes "+fi(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,i=!1;if(rn(e,(o,l)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(i=!0,!S0(o)))throw new Error(t+" contains an invalid key ("+o+") "+fi(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);h5(r,o),Hl(t,l,r),p5(r)}),s&&i)throw new Error(t+' contains ".value" child '+fi(r)+" in addition to actual children.")}},XR=function(t,e){let n,r;for(n=0;n<e.length;n++){r=e[n];const i=bl(r);for(let o=0;o<i.length;o++)if(!(i[o]===".priority"&&o===i.length-1)){if(!S0(i[o]))throw new Error(t+"contains an invalid key ("+i[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(u5);let s=null;for(n=0;n<e.length;n++){if(r=e[n],s!==null&&er(s,r))throw new Error(t+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}},yE=function(t,e,n,r){const s=jo(t,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");const i=[];rn(e,(o,l)=>{const c=new bt(o);if(Hl(s,l,jt(n,c)),e0(c)===".priority"&&!I0(l))throw new Error(s+"contains an invalid value for '"+c.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");i.push(c)}),XR(s,i)},QR=function(t,e,n){if(Au(e))throw new Error(jo(t,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!I0(e))throw new Error(jo(t,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")},vE=function(t,e,n,r){if(!mE(n))throw new Error(jo(t,e)+'was an invalid path = "'+n+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},JR=function(t,e,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),vE(t,e,n)},Rs=function(t,e){if(ot(e)===".info")throw new Error(t+" failed = Can't modify data under /.info/")},qR=function(t,e){const n=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!S0(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||n.length!==0&&!KR(n))throw new Error(jo(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZR{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Fu(t,e){let n=null;for(let r=0;r<e.length;r++){const s=e[r],i=s.getPath();n!==null&&!t0(i,n.path)&&(t.eventLists_.push(n),n=null),n===null&&(n={events:[],path:i}),n.events.push(s)}n&&t.eventLists_.push(n)}function _E(t,e,n){Fu(t,n),xE(t,r=>t0(r,e))}function Wn(t,e,n){Fu(t,n),xE(t,r=>er(r,e)||er(e,r))}function xE(t,e){t.recursionDepth_++;let n=!0;for(let r=0;r<t.eventLists_.length;r++){const s=t.eventLists_[r];if(s){const i=s.path;e(i)?(eA(t.eventLists_[r]),t.eventLists_[r]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function eA(t){for(let e=0;e<t.events.length;e++){const n=t.events[e];if(n!==null){t.events[e]=null;const r=n.getEventRunner();Ga&&tn("event: "+n.toString()),qo(r)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tA="repo_interrupt",nA=25;class rA{constructor(e,n,r,s){this.repoInfo_=e,this.forceRestClient_=n,this.authTokenProvider_=r,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new ZR,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Xd(),this.transactionQueueTree_=new b0,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function sA(t,e,n){if(t.stats_=qg(t.repoInfo_),t.forceRestClient_||Nk())t.server_=new Kd(t.repoInfo_,(r,s,i,o)=>{Bv(t,r,s,i,o)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>zv(t,!0),0);else{if(typeof n<"u"&&n!==null){if(typeof n!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Xt(n)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}t.persistentConnection_=new Jr(t.repoInfo_,e,(r,s,i,o)=>{Bv(t,r,s,i,o)},r=>{zv(t,r)},r=>{iA(t,r)},t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(r=>{t.server_.refreshAuthToken(r)}),t.appCheckProvider_.addTokenChangeListener(r=>{t.server_.refreshAppCheckToken(r.token)}),t.statsReporter_=Bk(t.repoInfo_,()=>new U5(t.stats_,t.server_)),t.infoData_=new M5,t.infoSyncTree_=new Fv({startListening:(r,s,i,o)=>{let l=[];const c=t.infoData_.getNode(r._path);return c.isEmpty()||(l=Bl(t.infoSyncTree_,r._path,c),setTimeout(()=>{o("ok")},0)),l},stopListening:()=>{}}),w0(t,"connected",!1),t.serverSyncTree_=new Fv({startListening:(r,s,i,o)=>(t.server_.listen(r,i,s,(l,c)=>{const d=o(l,c);Wn(t.eventQueue_,r._path,d)}),[]),stopListening:(r,s)=>{t.server_.unlisten(r,s)}})}function bE(t){const n=t.infoData_.getNode(new bt(".info/serverTimeOffset")).val()||0;return new Date().getTime()+n}function Wl(t){return UR({timestamp:bE(t)})}function Bv(t,e,n,r,s){t.dataUpdateCount++;const i=new bt(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let o=[];if(s)if(r){const c=Hd(n,d=>Nt(d));o=DR(t.serverSyncTree_,i,c,s)}else{const c=Nt(n);o=cE(t.serverSyncTree_,i,c,s)}else if(r){const c=Hd(n,d=>Nt(d));o=PR(t.serverSyncTree_,i,c)}else{const c=Nt(n);o=Bl(t.serverSyncTree_,i,c)}let l=i;o.length>0&&(l=Ho(t,i)),Wn(t.eventQueue_,l,o)}function zv(t,e){w0(t,"connected",e),e===!1&&cA(t)}function iA(t,e){rn(e,(n,r)=>{w0(t,n,r)})}function w0(t,e,n){const r=new bt("/.info/"+e),s=Nt(n);t.infoData_.updateSnapshot(r,s);const i=Bl(t.infoSyncTree_,r,s);Wn(t.eventQueue_,r,i)}function Uu(t){return t.nextWriteId_++}function oA(t,e,n){const r=MR(t.serverSyncTree_,e);return r!=null?Promise.resolve(r):t.server_.get(e).then(s=>{const i=Nt(s).withIndex(e._queryParams.getIndex());Ap(t.serverSyncTree_,e,n,!0);let o;if(e._queryParams.loadsAllData())o=Bl(t.serverSyncTree_,e._path,i);else{const l=Tl(t.serverSyncTree_,e);o=cE(t.serverSyncTree_,e._path,i,l)}return Wn(t.eventQueue_,e._path,o),ru(t.serverSyncTree_,e,n,null,!0),i},s=>(ta(t,"get for query "+Xt(e)+" failed: "+s),Promise.reject(new Error(s))))}function aA(t,e,n,r,s){ta(t,"set",{path:e.toString(),value:n,priority:r});const i=Wl(t),o=Nt(n,r),l=Mu(t.serverSyncTree_,e),c=_0(o,l,i),d=Uu(t),u=h0(t.serverSyncTree_,e,c,d,!0);Fu(t.eventQueue_,u),t.server_.put(e.toString(),o.val(!0),(f,S)=>{const k=f==="ok";k||wn("set at "+e+" failed: "+f);const w=ks(t.serverSyncTree_,d,!k);Wn(t.eventQueue_,e,w),Qs(t,s,f,S)});const h=C0(t,e);Ho(t,h),Wn(t.eventQueue_,h,[])}function lA(t,e,n,r){ta(t,"update",{path:e.toString(),value:n});let s=!0;const i=Wl(t),o={};if(rn(n,(l,c)=>{s=!1,o[l]=hE(jt(e,l),Nt(c),t.serverSyncTree_,i)}),s)tn("update() called with empty data.  Don't do anything."),Qs(t,r,"ok",void 0);else{const l=Uu(t),c=AR(t.serverSyncTree_,e,o,l);Fu(t.eventQueue_,c),t.server_.merge(e.toString(),n,(d,u)=>{const h=d==="ok";h||wn("update at "+e+" failed: "+d);const f=ks(t.serverSyncTree_,l,!h),S=f.length>0?Ho(t,e):e;Wn(t.eventQueue_,S,f),Qs(t,r,d,u)}),rn(n,d=>{const u=C0(t,jt(e,d));Ho(t,u)}),Wn(t.eventQueue_,e,[])}}function cA(t){ta(t,"onDisconnectEvents");const e=Wl(t),n=Xd();Ip(t.onDisconnect_,gt(),(s,i)=>{const o=hE(s,i,t.serverSyncTree_,e);Zo(n,s,o)});let r=[];Ip(n,gt(),(s,i)=>{r=r.concat(Bl(t.serverSyncTree_,s,i));const o=C0(t,s);Ho(t,o)}),t.onDisconnect_=Xd(),Wn(t.eventQueue_,gt(),r)}function dA(t,e,n){t.server_.onDisconnectCancel(e.toString(),(r,s)=>{r==="ok"&&Sp(t.onDisconnect_,e),Qs(t,n,r,s)})}function Hv(t,e,n,r){const s=Nt(n);t.server_.onDisconnectPut(e.toString(),s.val(!0),(i,o)=>{i==="ok"&&Zo(t.onDisconnect_,e,s),Qs(t,r,i,o)})}function uA(t,e,n,r,s){const i=Nt(n,r);t.server_.onDisconnectPut(e.toString(),i.val(!0),(o,l)=>{o==="ok"&&Zo(t.onDisconnect_,e,i),Qs(t,s,o,l)})}function fA(t,e,n,r){if(zd(n)){tn("onDisconnect().update() called with empty data.  Don't do anything."),Qs(t,r,"ok",void 0);return}t.server_.onDisconnectMerge(e.toString(),n,(s,i)=>{s==="ok"&&rn(n,(o,l)=>{const c=Nt(l);Zo(t.onDisconnect_,jt(e,o),c)}),Qs(t,r,s,i)})}function hA(t,e,n){let r;ot(e._path)===".info"?r=Ap(t.infoSyncTree_,e,n):r=Ap(t.serverSyncTree_,e,n),_E(t.eventQueue_,e._path,r)}function pA(t,e,n){let r;ot(e._path)===".info"?r=ru(t.infoSyncTree_,e,n):r=ru(t.serverSyncTree_,e,n),_E(t.eventQueue_,e._path,r)}function gA(t){t.persistentConnection_&&t.persistentConnection_.interrupt(tA)}function ta(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),tn(n,...e)}function Qs(t,e,n,r){e&&qo(()=>{if(n==="ok")e(null);else{const s=(n||"error").toUpperCase();let i=s;r&&(i+=": "+r);const o=new Error(i);o.code=s,e(o)}})}function mA(t,e,n,r,s,i){ta(t,"transaction on "+e);const o={path:e,update:n,onComplete:r,status:null,order:_b(),applyLocally:i,retryCount:0,unwatcher:s,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},l=T0(t,e,void 0);o.currentInputSnapshot=l;const c=o.update(l.val());if(c===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{Hl("transaction failed: Data returned ",c,o.path),o.status=0;const d=ju(t.transactionQueueTree_,e),u=Ni(d)||[];u.push(o),E0(d,u);let h;typeof c=="object"&&c!==null&&xr(c,".priority")?(h=wi(c,".priority"),he(I0(h),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):h=(Mu(t.serverSyncTree_,e)||ze.EMPTY_NODE).getPriority().val();const f=Wl(t),S=Nt(c,h),k=_0(S,l,f);o.currentOutputSnapshotRaw=S,o.currentOutputSnapshotResolved=k,o.currentWriteId=Uu(t);const w=h0(t.serverSyncTree_,e,k,o.currentWriteId,o.applyLocally);Wn(t.eventQueue_,e,w),Bu(t,t.transactionQueueTree_)}}function T0(t,e,n){return Mu(t.serverSyncTree_,e,n)||ze.EMPTY_NODE}function Bu(t,e=t.transactionQueueTree_){if(e||zu(t,e),Ni(e)){const n=SE(t,e);he(n.length>0,"Sending zero length transaction queue"),n.every(s=>s.status===0)&&yA(t,zl(e),n)}else pE(e)&&$u(e,n=>{Bu(t,n)})}function yA(t,e,n){const r=n.map(d=>d.currentWriteId),s=T0(t,e,r);let i=s;const o=s.hash();for(let d=0;d<n.length;d++){const u=n[d];he(u.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;const h=Sn(e,u.path);i=i.updateChild(h,u.currentOutputSnapshotRaw)}const l=i.val(!0),c=e;t.server_.put(c.toString(),l,d=>{ta(t,"transaction put response",{path:c.toString(),status:d});let u=[];if(d==="ok"){const h=[];for(let f=0;f<n.length;f++)n[f].status=2,u=u.concat(ks(t.serverSyncTree_,n[f].currentWriteId)),n[f].onComplete&&h.push(()=>n[f].onComplete(null,!0,n[f].currentOutputSnapshotResolved)),n[f].unwatcher();zu(t,ju(t.transactionQueueTree_,e)),Bu(t,t.transactionQueueTree_),Wn(t.eventQueue_,e,u);for(let f=0;f<h.length;f++)qo(h[f])}else{if(d==="datastale")for(let h=0;h<n.length;h++)n[h].status===3?n[h].status=4:n[h].status=0;else{wn("transaction at "+c.toString()+" failed: "+d);for(let h=0;h<n.length;h++)n[h].status=4,n[h].abortReason=d}Ho(t,e)}},o)}function Ho(t,e){const n=EE(t,e),r=zl(n),s=SE(t,n);return vA(t,s,r),r}function vA(t,e,n){if(e.length===0)return;const r=[];let s=[];const o=e.filter(l=>l.status===0).map(l=>l.currentWriteId);for(let l=0;l<e.length;l++){const c=e[l],d=Sn(n,c.path);let u=!1,h;if(he(d!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)u=!0,h=c.abortReason,s=s.concat(ks(t.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=nA)u=!0,h="maxretry",s=s.concat(ks(t.serverSyncTree_,c.currentWriteId,!0));else{const f=T0(t,c.path,o);c.currentInputSnapshot=f;const S=e[l].update(f.val());if(S!==void 0){Hl("transaction failed: Data returned ",S,c.path);let k=Nt(S);typeof S=="object"&&S!=null&&xr(S,".priority")||(k=k.updatePriority(f.getPriority()));const j=c.currentWriteId,_=Wl(t),x=_0(k,f,_);c.currentOutputSnapshotRaw=k,c.currentOutputSnapshotResolved=x,c.currentWriteId=Uu(t),o.splice(o.indexOf(j),1),s=s.concat(h0(t.serverSyncTree_,c.path,x,c.currentWriteId,c.applyLocally)),s=s.concat(ks(t.serverSyncTree_,j,!0))}else u=!0,h="nodata",s=s.concat(ks(t.serverSyncTree_,c.currentWriteId,!0))}Wn(t.eventQueue_,n,s),s=[],u&&(e[l].status=2,function(f){setTimeout(f,Math.floor(0))}(e[l].unwatcher),e[l].onComplete&&(h==="nodata"?r.push(()=>e[l].onComplete(null,!1,e[l].currentInputSnapshot)):r.push(()=>e[l].onComplete(new Error(h),!1,null))))}zu(t,t.transactionQueueTree_);for(let l=0;l<r.length;l++)qo(r[l]);Bu(t,t.transactionQueueTree_)}function EE(t,e){let n,r=t.transactionQueueTree_;for(n=ot(e);n!==null&&Ni(r)===void 0;)r=ju(r,n),e=wt(e),n=ot(e);return r}function SE(t,e){const n=[];return IE(t,e,n),n.sort((r,s)=>r.order-s.order),n}function IE(t,e,n){const r=Ni(e);if(r)for(let s=0;s<r.length;s++)n.push(r[s]);$u(e,s=>{IE(t,s,n)})}function zu(t,e){const n=Ni(e);if(n){let r=0;for(let s=0;s<n.length;s++)n[s].status!==2&&(n[r]=n[s],r++);n.length=r,E0(e,n.length>0?n:void 0)}$u(e,r=>{zu(t,r)})}function C0(t,e){const n=zl(EE(t,e)),r=ju(t.transactionQueueTree_,e);return WR(r,s=>{gh(t,s)}),gh(t,r),gE(r,s=>{gh(t,s)}),n}function gh(t,e){const n=Ni(e);if(n){const r=[];let s=[],i=-1;for(let o=0;o<n.length;o++)n[o].status===3||(n[o].status===1?(he(i===o-1,"All SENT items should be at beginning of queue."),i=o,n[o].status=3,n[o].abortReason="set"):(he(n[o].status===0,"Unexpected transaction status in abort"),n[o].unwatcher(),s=s.concat(ks(t.serverSyncTree_,n[o].currentWriteId,!0)),n[o].onComplete&&r.push(n[o].onComplete.bind(null,new Error("set"),!1,null))));i===-1?E0(e,void 0):n.length=i+1,Wn(t.eventQueue_,zl(e),s);for(let o=0;o<r.length;o++)qo(r[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _A(t){let e="";const n=t.split("/");for(let r=0;r<n.length;r++)if(n[r].length>0){let s=n[r];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function xA(t){const e={};t.charAt(0)==="?"&&(t=t.substring(1));for(const n of t.split("&")){if(n.length===0)continue;const r=n.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):wn(`Invalid query segment '${n}' in query '${t}'`)}return e}const Wv=function(t,e){const n=bA(t),r=n.namespace;n.domain==="firebase.com"&&ss(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&n.domain!=="localhost"&&ss("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||Ck();const s=n.scheme==="ws"||n.scheme==="wss";return{repoInfo:new Ob(n.host,n.secure,r,s,e,"",r!==n.subdomain),path:new bt(n.pathString)}},bA=function(t){let e="",n="",r="",s="",i="",o=!0,l="https",c=443;if(typeof t=="string"){let d=t.indexOf("//");d>=0&&(l=t.substring(0,d-1),t=t.substring(d+2));let u=t.indexOf("/");u===-1&&(u=t.length);let h=t.indexOf("?");h===-1&&(h=t.length),e=t.substring(0,Math.min(u,h)),u<h&&(s=_A(t.substring(u,h)));const f=xA(t.substring(Math.min(t.length,h)));d=e.indexOf(":"),d>=0?(o=l==="https"||l==="wss",c=parseInt(e.substring(d+1),10)):d=e.length;const S=e.slice(0,d);if(S.toLowerCase()==="localhost")n="localhost";else if(S.split(".").length<=2)n=S;else{const k=e.indexOf(".");r=e.substring(0,k).toLowerCase(),n=e.substring(k+1),i=r}"ns"in f&&(i=f.ns)}return{host:e,port:c,domain:n,subdomain:r,secure:o,scheme:l,pathString:s,namespace:i}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gv="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",EA=function(){let t=0;const e=[];return function(n){const r=n===t;t=n;let s;const i=new Array(8);for(s=7;s>=0;s--)i[s]=Gv.charAt(n%64),n=Math.floor(n/64);he(n===0,"Cannot push at time == 0");let o=i.join("");if(r){for(s=11;s>=0&&e[s]===63;s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)o+=Gv.charAt(e[s]);return he(o.length===20,"nextPushId: Length should be 20."),o}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SA{constructor(e,n,r,s){this.eventType=e,this.eventRegistration=n,this.snapshot=r,this.prevName=s}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Xt(this.snapshot.exportVal())}}class IA{constructor(e,n,r){this.eventRegistration=e,this.error=n,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wE{constructor(e,n){this.snapshotCallback=e,this.cancelCallback=n}onValue(e,n){this.snapshotCallback.call(null,e,n)}onCancel(e){return he(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wA{constructor(e,n){this._repo=e,this._path=n}cancel(){const e=new ur;return dA(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Rs("OnDisconnect.remove",this._path);const e=new ur;return Hv(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Rs("OnDisconnect.set",this._path),su("OnDisconnect.set",e,this._path,!1);const n=new ur;return Hv(this._repo,this._path,e,n.wrapCallback(()=>{})),n.promise}setWithPriority(e,n){Rs("OnDisconnect.setWithPriority",this._path),su("OnDisconnect.setWithPriority",e,this._path,!1),QR("OnDisconnect.setWithPriority",n);const r=new ur;return uA(this._repo,this._path,e,n,r.wrapCallback(()=>{})),r.promise}update(e){Rs("OnDisconnect.update",this._path),yE("OnDisconnect.update",e,this._path);const n=new ur;return fA(this._repo,this._path,e,n.wrapCallback(()=>{})),n.promise}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k0{constructor(e,n,r,s){this._repo=e,this._path=n,this._queryParams=r,this._orderByCalled=s}get key(){return lt(this._path)?null:e0(this._path)}get ref(){return new Nr(this._repo,this._path)}get _queryIdentifier(){const e=Rv(this._queryParams),n=Qg(e);return n==="{}"?"default":n}get _queryObject(){return Rv(this._queryParams)}isEqual(e){if(e=Jt(e),!(e instanceof k0))return!1;const n=this._repo===e._repo,r=t0(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return n&&r&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+d5(this._path)}}class Nr extends k0{constructor(e,n){super(e,n,new i0,!1)}get parent(){const e=Bb(this._path);return e===null?null:new Nr(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class Wo{constructor(e,n,r){this._node=e,this.ref=n,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const n=new bt(e),r=Cl(this.ref,e);return new Wo(this._node.getChild(n),r,Dt)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,s)=>e(new Wo(s,Cl(this.ref,r),Dt)))}hasChild(e){const n=new bt(e);return!this._node.getChild(n).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Rr(t,e){return t=Jt(t),t._checkNotDeleted("ref"),e!==void 0?Cl(t._root,e):t._root}function Cl(t,e){return t=Jt(t),ot(t._path)===null?JR("child","path",e):vE("child","path",e),new Nr(t._repo,jt(t._path,e))}function TA(t){return t=Jt(t),new wA(t._repo,t._path)}function CA(t,e){t=Jt(t),Rs("push",t._path),su("push",e,t._path,!0);const n=bE(t._repo),r=EA(n),s=Cl(t,r),i=Cl(t,r);let o;return o=Promise.resolve(i),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function Fc(t){return Rs("remove",t._path),Hu(t,null)}function Hu(t,e){t=Jt(t),Rs("set",t._path),su("set",e,t._path,!1);const n=new ur;return aA(t._repo,t._path,e,null,n.wrapCallback(()=>{})),n.promise}function R0(t,e){yE("update",e,t._path);const n=new ur;return lA(t._repo,t._path,e,n.wrapCallback(()=>{})),n.promise}function Wu(t){t=Jt(t);const e=new wE(()=>{}),n=new Gu(e);return oA(t._repo,t,n).then(r=>new Wo(r,new Nr(t._repo,t._path),t._queryParams.getIndex()))}class Gu{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,n){const r=n._queryParams.getIndex();return new SA("value",this,new Wo(e.snapshotNode,new Nr(n._repo,n._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new IA(this,e,n):null}matches(e){return e instanceof Gu?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function kA(t,e,n,r,s){const i=new wE(n,void 0),o=new Gu(i);return hA(t._repo,t,o),()=>pA(t._repo,t,o)}function TE(t,e,n,r){return kA(t,"value",e)}ER(Nr);CR(Nr);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RA="FIREBASE_DATABASE_EMULATOR_HOST",Op={};let AA=!1;function PA(t,e,n,r){const s=e.lastIndexOf(":"),i=e.substring(0,s),o=Xo(i);t.repoInfo_=new Ob(e,o,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0,n),r&&(t.authTokenProvider_=r)}function OA(t,e,n,r,s){let i=r||t.options.databaseURL;i===void 0&&(t.options.projectId||ss("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),tn("Using default host for project ",t.options.projectId),i=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o=Wv(i,s),l=o.repoInfo,c;typeof process<"u"&&uv&&(c=uv[RA]),c?(i=`http://${c}?ns=${l.namespace}`,o=Wv(i,s),l=o.repoInfo):o.repoInfo.secure;const d=new $k(t.name,t.options,e);qR("Invalid Firebase Database URL",o),lt(o.path)||ss("Database URL must point to the root of a Firebase Database (not including a child path).");const u=DA(l,t,d,new jk(t,n));return new MA(u,t)}function LA(t,e){const n=Op[e];(!n||n[t.key]!==t)&&ss(`Database ${e}(${t.repoInfo_}) has already been deleted.`),gA(t),delete n[t.key]}function DA(t,e,n,r){let s=Op[e.name];s||(s={},Op[e.name]=s);let i=s[t.toURLString()];return i&&ss("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new rA(t,AA,n,r),s[t.toURLString()]=i,i}class MA{constructor(e,n){this._repoInternal=e,this.app=n,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(sA(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Nr(this._repo,gt())),this._rootInternal}_delete(){return this._rootInternal!==null&&(LA(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&ss("Cannot call "+e+" on a deleted database.")}}function NA(t=pb(),e){const n=Xg(t,"database").getImmediate({identifier:e});if(!n._instanceStarted){const r=V2("database");r&&jA(n,...r)}return n}function jA(t,e,n,r={}){t=Jt(t),t._checkNotDeleted("useEmulator");const s=`${e}:${n}`,i=t._repoInternal;if(t._instanceStarted){if(s===t._repoInternal.repoInfo_.host&&Ti(r,i.repoInfo_.emulatorOptions))return;ss("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&ss('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new sd(sd.OWNER);else if(r.mockUserToken){const l=typeof r.mockUserToken=="string"?r.mockUserToken:Y2(r.mockUserToken,t.app.options.projectId);o=new sd(l)}Xo(e)&&(ab(e),lb("Database",!0)),PA(i,s,r,o)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $A(t){Ek(Jo),$o(new Ci("database",(e,{instanceIdentifier:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return OA(r,s,i,n)},"PUBLIC").setMultipleInstances(!0)),Bs(fv,hv,t),Bs(fv,hv,"esm2020")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FA{constructor(e,n){this.committed=e,this.snapshot=n}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function UA(t,e,n){if(t=Jt(t),Rs("Reference.transaction",t._path),t.key===".length"||t.key===".keys")throw"Reference.transaction failed: "+t.key+" is a read-only object.";const r=!0,s=new ur,i=(l,c,d)=>{let u=null;l?s.reject(l):(u=new Wo(d,new Nr(t._repo,t._path),Dt),s.resolve(new FA(c,u)))},o=TE(t,()=>{});return mA(t._repo,t._path,e,i,o,r),s.promise}Jr.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};Jr.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};$A();function CE(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const BA=CE,kE=new jl("auth","Firebase",CE());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iu=new Yg("@firebase/auth");function zA(t,...e){iu.logLevel<=St.WARN&&iu.warn(`Auth (${Jo}): ${t}`,...e)}function id(t,...e){iu.logLevel<=St.ERROR&&iu.error(`Auth (${Jo}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _r(t,...e){throw A0(t,...e)}function Dr(t,...e){return A0(t,...e)}function RE(t,e,n){const r={...BA(),[e]:n};return new jl("auth","Firebase",r).create(e,{appName:t.name})}function qr(t){return RE(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function A0(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return kE.create(t,...e)}function Be(t,e,...n){if(!t)throw A0(e,...n)}function Kr(t){const e="INTERNAL ASSERTION FAILED: "+t;throw id(e),new Error(e)}function is(t,e){t||Kr(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lp(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.href)||""}function HA(){return Vv()==="http:"||Vv()==="https:"}function Vv(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WA(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(HA()||J2()||"connection"in navigator)?navigator.onLine:!0}function GA(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gl{constructor(e,n){this.shortDelay=e,this.longDelay=n,is(n>e,"Short delay should be less than long delay!"),this.isMobile=Vg()||cb()}get(){return WA()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P0(t,e){is(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AE{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Kr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Kr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Kr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VA={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YA=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],KA=new Gl(3e4,6e4);function ni(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function ri(t,e,n,r,s={}){return PE(t,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const l=Qo({key:t.config.apiKey,...o}).slice(1),c=await t._getAdditionalHeaders();c["Content-Type"]="application/json",t.languageCode&&(c["X-Firebase-Locale"]=t.languageCode);const d={method:e,headers:c,...i};return Q2()||(d.referrerPolicy="no-referrer"),t.emulatorConfig&&Xo(t.emulatorConfig.host)&&(d.credentials="include"),AE.fetch()(await OE(t,t.config.apiHost,n,l),d)})}async function PE(t,e,n){t._canInitEmulator=!1;const r={...VA,...e};try{const s=new QA(t),i=await Promise.race([n(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Uc(t,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const l=i.ok?o.errorMessage:o.error.message,[c,d]=l.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw Uc(t,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw Uc(t,"email-already-in-use",o);if(c==="USER_DISABLED")throw Uc(t,"user-disabled",o);const u=r[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw RE(t,u,d);_r(t,u)}}catch(s){if(s instanceof ti)throw s;_r(t,"network-request-failed",{message:String(s)})}}async function Vl(t,e,n,r,s={}){const i=await ri(t,e,n,r,s);return"mfaPendingCredential"in i&&_r(t,"multi-factor-auth-required",{_serverResponse:i}),i}async function OE(t,e,n,r){const s=`${e}${n}?${r}`,i=t,o=i.config.emulator?P0(t.config,s):`${t.config.apiScheme}://${s}`;return YA.includes(n)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(o).toString():o}function XA(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class QA{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(Dr(this.auth,"network-request-failed")),KA.get())})}}function Uc(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=Dr(t,e,r);return s.customData._tokenResponse=n,s}function Yv(t){return t!==void 0&&t.enterprise!==void 0}class JA{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return XA(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function qA(t,e){return ri(t,"GET","/v2/recaptchaConfig",ni(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ZA(t,e){return ri(t,"POST","/v1/accounts:delete",e)}async function ou(t,e){return ri(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qa(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function eP(t,e=!1){const n=Jt(t),r=await n.getIdToken(e),s=O0(r);Be(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:Qa(mh(s.auth_time)),issuedAtTime:Qa(mh(s.iat)),expirationTime:Qa(mh(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function mh(t){return Number(t)*1e3}function O0(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return id("JWT malformed, contained fewer than 3 sections"),null;try{const s=Bd(n);return s?JSON.parse(s):(id("Failed to decode base64 JWT payload"),null)}catch(s){return id("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function Kv(t){const e=O0(t);return Be(e,"internal-error"),Be(typeof e.exp<"u","internal-error"),Be(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kl(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof ti&&tP(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function tP({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nP{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dp{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Qa(this.lastLoginAt),this.creationTime=Qa(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Rl(t){var h;const e=t.auth,n=await t.getIdToken(),r=await kl(t,ou(e,{idToken:n}));Be(r==null?void 0:r.users.length,e,"internal-error");const s=r.users[0];t._notifyReloadListener(s);const i=(h=s.providerUserInfo)!=null&&h.length?LE(s.providerUserInfo):[],o=sP(t.providerData,i),l=t.isAnonymous,c=!(t.email&&s.passwordHash)&&!(o!=null&&o.length),d=l?c:!1,u={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new Dp(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(t,u)}async function rP(t){const e=Jt(t);await Rl(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function sP(t,e){return[...t.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function LE(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iP(t,e){const n=await PE(t,{},async()=>{const r=Qo({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=t.config,o=await OE(t,s,"/v1/token",`key=${i}`),l=await t._getAdditionalHeaders();l["Content-Type"]="application/x-www-form-urlencoded";const c={method:"POST",headers:l,body:r};return t.emulatorConfig&&Xo(t.emulatorConfig.host)&&(c.credentials="include"),AE.fetch()(o,c)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function oP(t,e){return ri(t,"POST","/v2/accounts:revokeToken",ni(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wo{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Be(e.idToken,"internal-error"),Be(typeof e.idToken<"u","internal-error"),Be(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Kv(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){Be(e.length!==0,"internal-error");const n=Kv(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(Be(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:s,expiresIn:i}=await iP(e,n);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:s,expirationTime:i}=n,o=new wo;return r&&(Be(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(Be(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(Be(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new wo,this.toJSON())}_performRefresh(){return Kr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ms(t,e){Be(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class pr{constructor({uid:e,auth:n,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new nP(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Dp(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const n=await kl(this,this.stsTokenManager.getToken(this.auth,e));return Be(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return eP(this,e)}reload(){return rP(this)}_assign(e){this!==e&&(Be(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new pr({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){Be(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await Rl(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(qn(this.auth.app))return Promise.reject(qr(this.auth));const e=await this.getIdToken();return await kl(this,ZA(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const r=n.displayName??void 0,s=n.email??void 0,i=n.phoneNumber??void 0,o=n.photoURL??void 0,l=n.tenantId??void 0,c=n._redirectEventId??void 0,d=n.createdAt??void 0,u=n.lastLoginAt??void 0,{uid:h,emailVerified:f,isAnonymous:S,providerData:k,stsTokenManager:w}=n;Be(h&&w,e,"internal-error");const j=wo.fromJSON(this.name,w);Be(typeof h=="string",e,"internal-error"),ms(r,e.name),ms(s,e.name),Be(typeof f=="boolean",e,"internal-error"),Be(typeof S=="boolean",e,"internal-error"),ms(i,e.name),ms(o,e.name),ms(l,e.name),ms(c,e.name),ms(d,e.name),ms(u,e.name);const _=new pr({uid:h,auth:e,email:s,emailVerified:f,displayName:r,isAnonymous:S,photoURL:o,phoneNumber:i,tenantId:l,stsTokenManager:j,createdAt:d,lastLoginAt:u});return k&&Array.isArray(k)&&(_.providerData=k.map(x=>({...x}))),c&&(_._redirectEventId=c),_}static async _fromIdTokenResponse(e,n,r=!1){const s=new wo;s.updateFromServerResponse(n);const i=new pr({uid:n.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Rl(i),i}static async _fromGetAccountInfoResponse(e,n,r){const s=n.users[0];Be(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?LE(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),l=new wo;l.updateFromIdToken(r);const c=new pr({uid:s.localId,auth:e,stsTokenManager:l,isAnonymous:o}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Dp(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(c,d),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xv=new Map;function Xr(t){is(t instanceof Function,"Expected a class definition");let e=Xv.get(t);return e?(is(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,Xv.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DE{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}DE.type="NONE";const Qv=DE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function od(t,e,n){return`firebase:${t}:${e}:${n}`}class To{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=od(this.userKey,s.apiKey,i),this.fullPersistenceKey=od("persistence",s.apiKey,i),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await ou(this.auth,{idToken:e}).catch(()=>{});return n?pr._fromGetAccountInfoResponse(this.auth,n,e):null}return pr._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new To(Xr(Qv),e,r);const s=(await Promise.all(n.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let i=s[0]||Xr(Qv);const o=od(r,e.config.apiKey,e.name);let l=null;for(const d of n)try{const u=await d._get(o);if(u){let h;if(typeof u=="string"){const f=await ou(e,{idToken:u}).catch(()=>{});if(!f)break;h=await pr._fromGetAccountInfoResponse(e,f,u)}else h=pr._fromJSON(e,u);d!==i&&(l=h),i=d;break}}catch{}const c=s.filter(d=>d._shouldAllowMigration);return!i._shouldAllowMigration||!c.length?new To(i,e,r):(i=c[0],l&&await i._set(o,l.toJSON()),await Promise.all(n.map(async d=>{if(d!==i)try{await d._remove(o)}catch{}})),new To(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jv(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if($E(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(ME(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(UE(e))return"Blackberry";if(BE(e))return"Webos";if(NE(e))return"Safari";if((e.includes("chrome/")||jE(e))&&!e.includes("edge/"))return"Chrome";if(FE(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function ME(t=Tn()){return/firefox\//i.test(t)}function NE(t=Tn()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function jE(t=Tn()){return/crios\//i.test(t)}function $E(t=Tn()){return/iemobile/i.test(t)}function FE(t=Tn()){return/android/i.test(t)}function UE(t=Tn()){return/blackberry/i.test(t)}function BE(t=Tn()){return/webos/i.test(t)}function L0(t=Tn()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function aP(t=Tn()){var e;return L0(t)&&!!((e=window.navigator)!=null&&e.standalone)}function lP(){return q2()&&document.documentMode===10}function zE(t=Tn()){return L0(t)||FE(t)||BE(t)||UE(t)||/windows phone/i.test(t)||$E(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HE(t,e=[]){let n;switch(t){case"Browser":n=Jv(Tn());break;case"Worker":n=`${Jv(Tn())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${Jo}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cP{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=i=>new Promise((o,l)=>{try{const c=e(i);o(c)}catch(c){l(c)}});r.onAbort=n,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const s of n)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dP(t,e={}){return ri(t,"GET","/v2/passwordPolicy",ni(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uP=6;class fP{constructor(e){var r;const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??uP,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((r=e.allowedNonAlphanumericCharacters)==null?void 0:r.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),s&&(n.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hP{constructor(e,n,r,s){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new qv(this),this.idTokenSubscription=new qv(this),this.beforeStateQueue=new cP(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=kE,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=Xr(n)),this._initializationPromise=this.queue(async()=>{var r,s,i;if(!this._deleted&&(this.persistenceManager=await To.create(this,e),(r=this._resolvePersistenceManagerAvailable)==null||r.call(this),!this._deleted)){if((s=this._popupRedirectResolver)!=null&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((i=this.currentUser)==null?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await ou(this,{idToken:e}),r=await pr._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(qn(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(l,l))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(i=this.redirectUser)==null?void 0:i._redirectEventId,l=r==null?void 0:r._redirectEventId,c=await this.tryRedirectSignIn(e);(!o||o===l)&&(c!=null&&c.user)&&(r=c.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Be(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await Rl(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=GA()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(qn(this.app))return Promise.reject(qr(this));const n=e?Jt(e):null;return n&&Be(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&Be(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return qn(this.app)?Promise.reject(qr(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return qn(this.app)?Promise.reject(qr(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Xr(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await dP(this),n=new fP(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new jl("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await oP(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&Xr(e)||this._popupRedirectResolver;Be(n,this,"argument-error"),this.redirectPersistenceManager=await To.create(this,[Xr(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)==null?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)==null?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((n=this.currentUser)==null?void 0:n.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,s){if(this._deleted)return()=>{};const i=typeof n=="function"?n:n.next.bind(n);let o=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(Be(l,this,"internal-error"),l.then(()=>{o||i(this.currentUser)}),typeof n=="function"){const c=e.addObserver(n,r,s);return()=>{o=!0,c()}}else{const c=e.addObserver(n);return()=>{o=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Be(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=HE(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var s;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await((s=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getHeartbeatsHeader());n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var n;if(qn(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((n=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:n.getToken());return e!=null&&e.error&&zA(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function ji(t){return Jt(t)}class qv{constructor(e){this.auth=e,this.observer=null,this.addObserver=lC(n=>this.observer=n)}get next(){return Be(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Vu={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function pP(t){Vu=t}function WE(t){return Vu.loadJS(t)}function gP(){return Vu.recaptchaEnterpriseScript}function mP(){return Vu.gapiScript}function yP(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class vP{constructor(){this.enterprise=new _P}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class _P{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const xP="recaptcha-enterprise",GE="NO_RECAPTCHA";class bP{constructor(e){this.type=xP,this.auth=ji(e)}async verify(e="verify",n=!1){async function r(i){if(!n){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,l)=>{qA(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const d=new JA(c);return i.tenantId==null?i._agentRecaptchaConfig=d:i._tenantRecaptchaConfigs[i.tenantId]=d,o(d.siteKey)}}).catch(c=>{l(c)})})}function s(i,o,l){const c=window.grecaptcha;Yv(c)?c.enterprise.ready(()=>{c.enterprise.execute(i,{action:e}).then(d=>{o(d)}).catch(()=>{o(GE)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new vP().execute("siteKey",{action:"verify"}):new Promise((i,o)=>{r(this.auth).then(l=>{if(!n&&Yv(window.grecaptcha))s(l,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let c=gP();c.length!==0&&(c+=l),WE(c).then(()=>{s(l,i,o)}).catch(d=>{o(d)})}}).catch(l=>{o(l)})})}}async function Zv(t,e,n,r=!1,s=!1){const i=new bP(t);let o;if(s)o=GE;else try{o=await i.verify(n)}catch{o=await i.verify(n,!0)}const l={...e};if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in l){const c=l.phoneEnrollmentInfo.phoneNumber,d=l.phoneEnrollmentInfo.recaptchaToken;Object.assign(l,{phoneEnrollmentInfo:{phoneNumber:c,recaptchaToken:d,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in l){const c=l.phoneSignInInfo.recaptchaToken;Object.assign(l,{phoneSignInInfo:{recaptchaToken:c,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return l}return r?Object.assign(l,{captchaResp:o}):Object.assign(l,{captchaResponse:o}),Object.assign(l,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(l,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),l}async function e_(t,e,n,r,s){var i;if((i=t._getRecaptchaConfig())!=null&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await Zv(t,e,n,n==="getOobCode");return r(t,o)}else return r(t,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await Zv(t,e,n,n==="getOobCode");return r(t,l)}else return Promise.reject(o)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EP(t,e){const n=Xg(t,"auth");if(n.isInitialized()){const s=n.getImmediate(),i=n.getOptions();if(Ti(i,e??{}))return s;_r(s,"already-initialized")}return n.initialize({options:e})}function SP(t,e){const n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(Xr);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function IP(t,e,n){const r=ji(t);Be(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,i=VE(e),{host:o,port:l}=wP(e),c=l===null?"":`:${l}`,d={url:`${i}//${o}${c}/`},u=Object.freeze({host:o,port:l,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){Be(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),Be(Ti(d,r.config.emulator)&&Ti(u,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=d,r.emulatorConfig=u,r.settings.appVerificationDisabledForTesting=!0,Xo(o)?(ab(`${i}//${o}${c}`),lb("Auth",!0)):TP()}function VE(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function wP(t){const e=VE(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:t_(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:t_(o)}}}function t_(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function TP(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D0{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return Kr("not implemented")}_getIdTokenResponse(e){return Kr("not implemented")}_linkToIdToken(e,n){return Kr("not implemented")}_getReauthenticationResolver(e){return Kr("not implemented")}}async function CP(t,e){return ri(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kP(t,e){return Vl(t,"POST","/v1/accounts:signInWithPassword",ni(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function RP(t,e){return Vl(t,"POST","/v1/accounts:signInWithEmailLink",ni(t,e))}async function AP(t,e){return Vl(t,"POST","/v1/accounts:signInWithEmailLink",ni(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Al extends D0{constructor(e,n,r,s=null){super("password",r),this._email=e,this._password=n,this._tenantId=s}static _fromEmailAndPassword(e,n){return new Al(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new Al(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return e_(e,n,"signInWithPassword",kP);case"emailLink":return RP(e,{email:this._email,oobCode:this._password});default:_r(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return e_(e,r,"signUpPassword",CP);case"emailLink":return AP(e,{idToken:n,email:this._email,oobCode:this._password});default:_r(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Co(t,e){return Vl(t,"POST","/v1/accounts:signInWithIdp",ni(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PP="http://localhost";class Pi extends D0{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Pi(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):_r("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=n;if(!r||!s)return null;const o=new Pi(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const n=this.buildRequest();return Co(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,Co(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,Co(e,n)}buildRequest(){const e={requestUri:PP,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=Qo(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OP(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function LP(t){const e=Oa(La(t)).link,n=e?Oa(La(e)).deep_link_id:null,r=Oa(La(t)).deep_link_id;return(r?Oa(La(r)).link:null)||r||n||e||t}class M0{constructor(e){const n=Oa(La(e)),r=n.apiKey??null,s=n.oobCode??null,i=OP(n.mode??null);Be(r&&s&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=s,this.continueUrl=n.continueUrl??null,this.languageCode=n.lang??null,this.tenantId=n.tenantId??null}static parseLink(e){const n=LP(e);try{return new M0(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $i{constructor(){this.providerId=$i.PROVIDER_ID}static credential(e,n){return Al._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=M0.parseLink(n);return Be(r,"argument-error"),Al._fromEmailAndCode(e,r.code,r.tenantId)}}$i.PROVIDER_ID="password";$i.EMAIL_PASSWORD_SIGN_IN_METHOD="password";$i.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YE{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yl extends YE{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Es extends Yl{constructor(){super("facebook.com")}static credential(e){return Pi._fromParams({providerId:Es.PROVIDER_ID,signInMethod:Es.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Es.credentialFromTaggedObject(e)}static credentialFromError(e){return Es.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Es.credential(e.oauthAccessToken)}catch{return null}}}Es.FACEBOOK_SIGN_IN_METHOD="facebook.com";Es.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ss extends Yl{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Pi._fromParams({providerId:Ss.PROVIDER_ID,signInMethod:Ss.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return Ss.credentialFromTaggedObject(e)}static credentialFromError(e){return Ss.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return Ss.credential(n,r)}catch{return null}}}Ss.GOOGLE_SIGN_IN_METHOD="google.com";Ss.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Is extends Yl{constructor(){super("github.com")}static credential(e){return Pi._fromParams({providerId:Is.PROVIDER_ID,signInMethod:Is.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Is.credentialFromTaggedObject(e)}static credentialFromError(e){return Is.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Is.credential(e.oauthAccessToken)}catch{return null}}}Is.GITHUB_SIGN_IN_METHOD="github.com";Is.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ws extends Yl{constructor(){super("twitter.com")}static credential(e,n){return Pi._fromParams({providerId:ws.PROVIDER_ID,signInMethod:ws.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return ws.credentialFromTaggedObject(e)}static credentialFromError(e){return ws.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return ws.credential(n,r)}catch{return null}}}ws.TWITTER_SIGN_IN_METHOD="twitter.com";ws.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function DP(t,e){return Vl(t,"POST","/v1/accounts:signUp",ni(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Js{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,s=!1){const i=await pr._fromIdTokenResponse(e,r,s),o=n_(r);return new Js({user:i,providerId:o,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const s=n_(r);return new Js({user:e,providerId:s,_tokenResponse:r,operationType:n})}}function n_(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function MP(t){var s;if(qn(t.app))return Promise.reject(qr(t));const e=ji(t);if(await e._initializationPromise,(s=e.currentUser)!=null&&s.isAnonymous)return new Js({user:e.currentUser,providerId:null,operationType:"signIn"});const n=await DP(e,{returnSecureToken:!0}),r=await Js._fromIdTokenResponse(e,"signIn",n,!0);return await e._updateCurrentUser(r.user),r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class au extends ti{constructor(e,n,r,s){super(n.code,n.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,au.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,s){return new au(e,n,r,s)}}function KE(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?au._fromErrorAndOperation(t,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NP(t){return new Set(t.map(({providerId:e})=>e).filter(e=>!!e))}async function XE(t,e,n=!1){const r=await kl(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Js._forOperation(t,"link",r)}async function jP(t,e,n){await Rl(e);const r=NP(e.providerData);Be(r.has(n)===t,e.auth,"provider-already-linked")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $P(t,e,n=!1){const{auth:r}=t;if(qn(r.app))return Promise.reject(qr(r));const s="reauthenticate";try{const i=await kl(t,KE(r,s,e,t),n);Be(i.idToken,r,"internal-error");const o=O0(i.idToken);Be(o,r,"internal-error");const{sub:l}=o;return Be(t.uid===l,r,"user-mismatch"),Js._forOperation(t,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&_r(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function QE(t,e,n=!1){if(qn(t.app))return Promise.reject(qr(t));const r="signIn",s=await KE(t,r,e),i=await Js._fromIdTokenResponse(t,r,s);return n||await t._updateCurrentUser(i.user),i}async function FP(t,e){return QE(ji(t),e)}async function UP(t,e){const n=Jt(t);return await jP(!1,n,e.providerId),XE(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BP(t){const e=ji(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}function zP(t,e,n){return qn(t.app)?Promise.reject(qr(t)):FP(Jt(t),$i.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&BP(t),r})}function HP(t,e,n,r){return Jt(t).onIdTokenChanged(e,n,r)}function WP(t,e,n){return Jt(t).beforeAuthStateChanged(e,n)}function GP(t,e,n,r){return Jt(t).onAuthStateChanged(e,n,r)}function VP(t){return Jt(t).signOut()}const lu="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JE{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(lu,"1"),this.storage.removeItem(lu),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YP=1e3,KP=10;class qE extends JE{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=zE(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),s=this.localCache[n];r!==s&&e(n,s,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((o,l,c)=>{this.notifyListeners(o,c)});return}const r=e.key;n?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!n&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);lP()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,KP):s()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},YP)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}qE.type="LOCAL";const XP=qE;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZE extends JE{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}ZE.type="SESSION";const eS=ZE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QP(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yu{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(s=>s.isListeningto(e));if(n)return n;const r=new Yu(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:s,data:i}=n.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const l=Array.from(o).map(async d=>d(n.origin,i)),c=await QP(l);n.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:c})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Yu.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function N0(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JP{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((l,c)=>{const d=N0("",20);s.port1.start();const u=setTimeout(()=>{c(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(h){const f=h;if(f.data.eventId===d)switch(f.data.status){case"ack":clearTimeout(u),i=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),l(f.data.response);break;default:clearTimeout(u),clearTimeout(i),c(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:d,data:n},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mr(){return window}function qP(t){Mr().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tS(){return typeof Mr().WorkerGlobalScope<"u"&&typeof Mr().importScripts=="function"}async function ZP(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function eO(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)==null?void 0:t.controller)||null}function tO(){return tS()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nS="firebaseLocalStorageDb",nO=1,cu="firebaseLocalStorage",rS="fbase_key";class Kl{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function Ku(t,e){return t.transaction([cu],e?"readwrite":"readonly").objectStore(cu)}function rO(){const t=indexedDB.deleteDatabase(nS);return new Kl(t).toPromise()}function Mp(){const t=indexedDB.open(nS,nO);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(cu,{keyPath:rS})}catch(s){n(s)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(cu)?e(r):(r.close(),await rO(),e(await Mp()))})})}async function r_(t,e,n){const r=Ku(t,!0).put({[rS]:e,value:n});return new Kl(r).toPromise()}async function sO(t,e){const n=Ku(t,!1).get(e),r=await new Kl(n).toPromise();return r===void 0?null:r.value}function s_(t,e){const n=Ku(t,!0).delete(e);return new Kl(n).toPromise()}const iO=800,oO=3;class sS{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Mp(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>oO)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return tS()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Yu._getInstance(tO()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var n,r;if(this.activeServiceWorker=await ZP(),!this.activeServiceWorker)return;this.sender=new JP(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(n=e[0])!=null&&n.fulfilled&&(r=e[0])!=null&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||eO()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Mp();return await r_(e,lu,"1"),await s_(e,lu),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>r_(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>sO(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>s_(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Ku(s,!1).getAll();return new Kl(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),n.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),n.push(s));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),iO)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}sS.type="LOCAL";const aO=sS;new Gl(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lO(t,e){return e?Xr(e):(Be(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j0 extends D0{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Co(e,this._buildIdpRequest())}_linkToIdToken(e,n){return Co(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return Co(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function cO(t){return QE(t.auth,new j0(t),t.bypassAuthState)}function dO(t){const{auth:e,user:n}=t;return Be(n,e,"internal-error"),$P(n,new j0(t),t.bypassAuthState)}async function uO(t){const{auth:e,user:n}=t;return Be(n,e,"internal-error"),XE(n,new j0(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iS{constructor(e,n,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:s,tenantId:i,error:o,type:l}=e;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:n,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(c))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return cO;case"linkViaPopup":case"linkViaRedirect":return uO;case"reauthViaPopup":case"reauthViaRedirect":return dO;default:_r(this.auth,"internal-error")}}resolve(e){is(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){is(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fO=new Gl(2e3,1e4);class mo extends iS{constructor(e,n,r,s,i){super(e,n,s,i),this.provider=r,this.authWindow=null,this.pollId=null,mo.currentPopupAction&&mo.currentPopupAction.cancel(),mo.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Be(e,this.auth,"internal-error"),e}async onExecution(){is(this.filter.length===1,"Popup operations only handle one event");const e=N0();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Dr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(Dr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,mo.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if((r=(n=this.authWindow)==null?void 0:n.window)!=null&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Dr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,fO.get())};e()}}mo.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hO="pendingRedirect",ad=new Map;class pO extends iS{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=ad.get(this.auth._key());if(!e){try{const r=await gO(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}ad.set(this.auth._key(),e)}return this.bypassAuthState||ad.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function gO(t,e){const n=vO(e),r=yO(t);if(!await r._isAvailable())return!1;const s=await r._get(n)==="true";return await r._remove(n),s}function mO(t,e){ad.set(t._key(),e)}function yO(t){return Xr(t._redirectPersistence)}function vO(t){return od(hO,t.config.apiKey,t.name)}async function _O(t,e,n=!1){if(qn(t.app))return Promise.reject(qr(t));const r=ji(t),s=lO(r,e),o=await new pO(r,s,n).execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xO=10*60*1e3;class bO{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!EO(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!oS(e)){const s=((r=e.error.code)==null?void 0:r.split("auth/")[1])||"internal-error";n.onError(Dr(this.auth,s))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=xO&&this.cachedEventUids.clear(),this.cachedEventUids.has(i_(e))}saveEventToCache(e){this.cachedEventUids.add(i_(e)),this.lastProcessedEventTime=Date.now()}}function i_(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function oS({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function EO(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return oS(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function SO(t,e={}){return ri(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IO=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,wO=/^https?/;async function TO(t){if(t.config.emulator)return;const{authorizedDomains:e}=await SO(t);for(const n of e)try{if(CO(n))return}catch{}_r(t,"unauthorized-domain")}function CO(t){const e=Lp(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const o=new URL(t);return o.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&o.hostname===r}if(!wO.test(n))return!1;if(IO.test(t))return r===t;const s=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kO=new Gl(3e4,6e4);function o_(){const t=Mr().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function RO(t){return new Promise((e,n)=>{var s,i,o;function r(){o_(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{o_(),n(Dr(t,"network-request-failed"))},timeout:kO.get()})}if((i=(s=Mr().gapi)==null?void 0:s.iframes)!=null&&i.Iframe)e(gapi.iframes.getContext());else if((o=Mr().gapi)!=null&&o.load)r();else{const l=yP("iframefcb");return Mr()[l]=()=>{gapi.load?r():n(Dr(t,"network-request-failed"))},WE(`${mP()}?onload=${l}`).catch(c=>n(c))}}).catch(e=>{throw ld=null,e})}let ld=null;function AO(t){return ld=ld||RO(t),ld}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PO=new Gl(5e3,15e3),OO="__/auth/iframe",LO="emulator/auth/iframe",DO={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},MO=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function NO(t){const e=t.config;Be(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?P0(e,LO):`https://${t.config.authDomain}/${OO}`,r={apiKey:e.apiKey,appName:t.name,v:Jo},s=MO.get(t.config.apiHost);s&&(r.eid=s);const i=t._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${Qo(r).slice(1)}`}async function jO(t){const e=await AO(t),n=Mr().gapi;return Be(n,t,"internal-error"),e.open({where:document.body,url:NO(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:DO,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=Dr(t,"network-request-failed"),l=Mr().setTimeout(()=>{i(o)},PO.get());function c(){Mr().clearTimeout(l),s(r)}r.ping(c).then(c,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $O={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},FO=500,UO=600,BO="_blank",zO="http://localhost";class a_{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function HO(t,e,n,r=FO,s=UO){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const c={...$O,width:r.toString(),height:s.toString(),top:i,left:o},d=Tn().toLowerCase();n&&(l=jE(d)?BO:n),ME(d)&&(e=e||zO,c.scrollbars="yes");const u=Object.entries(c).reduce((f,[S,k])=>`${f}${S}=${k},`,"");if(aP(d)&&l!=="_self")return WO(e||"",l),new a_(null);const h=window.open(e||"",l,u);Be(h,t,"popup-blocked");try{h.focus()}catch{}return new a_(h)}function WO(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GO="__/auth/handler",VO="emulator/auth/handler",YO=encodeURIComponent("fac");async function l_(t,e,n,r,s,i){Be(t.config.authDomain,t,"auth-domain-config-required"),Be(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:Jo,eventId:s};if(e instanceof YE){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",zd(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[u,h]of Object.entries({}))o[u]=h}if(e instanceof Yl){const u=e.getScopes().filter(h=>h!=="");u.length>0&&(o.scopes=u.join(","))}t.tenantId&&(o.tid=t.tenantId);const l=o;for(const u of Object.keys(l))l[u]===void 0&&delete l[u];const c=await t._getAppCheckToken(),d=c?`#${YO}=${encodeURIComponent(c)}`:"";return`${KO(t)}?${Qo(l).slice(1)}${d}`}function KO({config:t}){return t.emulator?P0(t,VO):`https://${t.authDomain}/${GO}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yh="webStorageSupport";class XO{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=eS,this._completeRedirectFn=_O,this._overrideRedirectResult=mO}async _openPopup(e,n,r,s){var o;is((o=this.eventManagers[e._key()])==null?void 0:o.manager,"_initialize() not called before _openPopup()");const i=await l_(e,n,r,Lp(),s);return HO(e,i,N0())}async _openRedirect(e,n,r,s){await this._originValidation(e);const i=await l_(e,n,r,Lp(),s);return qP(i),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:s,promise:i}=this.eventManagers[n];return s?Promise.resolve(s):(is(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await jO(e),r=new bO(e);return n.register("authEvent",s=>(Be(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(yh,{type:yh},s=>{var o;const i=(o=s==null?void 0:s[0])==null?void 0:o[yh];i!==void 0&&n(!!i),_r(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=TO(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return zE()||NE()||L0()}}const QO=XO;var c_="@firebase/auth",d_="1.12.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JO{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){Be(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qO(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function ZO(t){$o(new Ci("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:l}=r.options;Be(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:o,authDomain:l,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:HE(t)},d=new hP(r,s,i,c);return SP(d,n),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),$o(new Ci("auth-internal",e=>{const n=ji(e.getProvider("auth").getImmediate());return(r=>new JO(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Bs(c_,d_,qO(t)),Bs(c_,d_,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eL=5*60,tL=ob("authIdTokenMaxAge")||eL;let u_=null;const nL=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>tL)return;const s=n==null?void 0:n.token;u_!==s&&(u_=s,await fetch(t,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function rL(t=pb()){const e=Xg(t,"auth");if(e.isInitialized())return e.getImmediate();const n=EP(t,{popupRedirectResolver:QO,persistence:[aO,XP,eS]}),r=ob("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=nL(i.toString());WP(n,o,()=>o(n.currentUser)),HP(n,l=>o(l))}}const s=sb("auth");return s&&IP(n,`http://${s}`),n}function sL(){var t;return((t=document.getElementsByTagName("head"))==null?void 0:t[0])??document}pP({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=s=>{const i=Dr("internal-error");i.customData=s,n(i)},r.type="text/javascript",r.charset="UTF-8",sL().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});ZO("Browser");const iL={apiKey:"AIzaSyCqXssa5oOaWY3CiN7ti53Qt1F_AGpBrVE",authDomain:"tenfubu-verse.firebaseapp.com",databaseURL:"https://tenfubu-verse-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"tenfubu-verse",storageBucket:"tenfubu-verse.firebasestorage.app",messagingSenderId:"1047996014362",appId:"1:1047996014362:web:729f6b715d929087e296a3"},aS=hb(iL),Ar=NA(aS),Xl=rL(aS),$0=[{rank:"BRONZE",min:0,max:2e3,lossPoints:0},{rank:"SILVER",min:2001,max:4e3,lossPoints:20},{rank:"GOLD",min:4001,max:6e3,lossPoints:40},{rank:"PLATINUM",min:6001,max:8e3,lossPoints:60},{rank:"DIAMOND",min:8001,max:1e4,lossPoints:80},{rank:"MASTER",min:10001,max:1/0,lossPoints:100}],ko={BRONZE:"",SILVER:"",GOLD:"",PLATINUM:"",DIAMOND:"",MASTER:""},Pr=t=>{for(const e of $0)if(t>=e.min&&t<=e.max)return e.rank;return"BRONZE"},Ja=t=>$0.findIndex(e=>e.rank===t),lS=()=>({rating:0,winStreak:0,totalMatches:0,wins:0,losses:0}),Bc=200,f_=100,oL=10,aL=20,lL=(t,e,n)=>{const r=Pr(t),s=Pr(n),i=Ja(r),o=Ja(s),l=e+1,c=Math.min((l-1)*oL,f_),d=Math.max(0,o-i),u=Math.min(d*aL,f_),h=100+c+u,f=Math.floor(Bc*h/100),S=t+f,k=Pr(S),w=Ja(k);return{newRating:S,ratingChange:f,newWinStreak:l,newRank:k,oldRank:r,isRankUp:w>i,isRankDown:!1,bonusBreakdown:{base:Bc,winStreakBonus:Math.floor(Bc*c/100),rankDiffBonus:Math.floor(Bc*u/100),total:f}}},cL=t=>{const e=Pr(t),r=-$0.find(c=>c.rank===e).lossPoints,s=Math.max(0,t+r),i=Pr(s),o=Ja(e),l=Ja(i);return{newRating:s,ratingChange:r,newWinStreak:0,newRank:i,oldRank:e,isRankUp:!1,isRankDown:l<o,bonusBreakdown:{base:r,winStreakBonus:0,rankDiffBonus:0,total:r}}},h_=async(t,e,n)=>{const r=Rr(Ar,`players/${t}`),s=await Wu(r);if(s.exists()){const o=s.val();return o.userId||(await R0(r,{userId:e}),o.userId=e),o}const i={userId:e,playerName:n||"",createdAt:Date.now(),lastMatchAt:Date.now(),ratings:{}};return await Hu(r,i),i},cS=async(t,e)=>{const n=Rr(Ar,`players/${t}/ratings/${e}`),r=await Wu(n);if(r.exists())return r.val();const s=lS();return await Hu(n,s),s},dL=async t=>{const e=Rr(Ar,`players/${t}/ratings`),n=await Wu(e);return n.exists()?n.val():{}},uL=async(t,e,n,r)=>{const s=Rr(Ar,`players/${t}/ratings/${e}`),i=Rr(Ar,`players/${t}`);await UA(s,o=>{const l=o||lS();return{rating:n.newRating,winStreak:n.newWinStreak,totalMatches:l.totalMatches+1,wins:l.wins+(r?1:0),losses:l.losses+(r?0:1)}}),await R0(i,{lastMatchAt:Date.now()})},fL=async(t,e)=>{const n=Rr(Ar,`players/${t}`);await R0(n,{playerName:e})},F0=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},hL=F0("/leaders/azya_leader.png"),pL=F0("/leaders/senka_leader.png"),gL=F0("/leaders/yoRuka_leader.png"),mL=1280,yL=720,vL={BRONZE:"#cd7f32",SILVER:"#c0c0c0",GOLD:"#ffd700",PLATINUM:"#e5e4e2",DIAMOND:"#b9f2ff",MASTER:"#ff4500"},_L=({onSelectClass:t,onBack:e,gameMode:n="CPU",aiDifficulty:r="NORMAL",onDifficultyChange:s,playerName:i,onPlayerNameChange:o,timerEnabled:l=!0,onTimerEnabledChange:c,playerId:d})=>{const[u,h]=L.useState(1),[f,S]=L.useState({}),[k,w]=L.useState(!1);L.useEffect(()=>{const q=()=>{const ue=window.innerWidth/mL,ye=window.innerHeight/yL;h(Math.min(ue,ye))};return q(),window.addEventListener("resize",q),()=>window.removeEventListener("resize",q)},[]),L.useEffect(()=>{(async()=>{if(!d){w(!1);return}w(!0);try{const ue=await dL(d);S(ue)}catch(ue){console.error("Failed to fetch class ratings:",ue)}finally{w(!1)}})()},[d]);const j=200*u,_=280*u,x=2*u,I=1.4*u,p=.75*u,D=.65*u,z=1.2*u,te=`${8*u}px ${16*u}px`,H=q=>{if(n!=="RANKED_MATCH"||!d||k)return null;const ue=f[q];if(!ue)return null;const ye=Pr(ue.rating),Me=ko[ye],fe=vL[ye];return a.jsxs("div",{style:{marginTop:`${4*u}px`,padding:`${4*u}px ${8*u}px`,background:"rgba(0, 0, 0, 0.3)",borderRadius:4*u,display:"flex",alignItems:"center",gap:`${6*u}px`},children:[a.jsx("span",{style:{fontSize:`${.7*u}rem`,fontWeight:"bold",color:fe,fontFamily:"Tamanegi, sans-serif"},children:Me}),a.jsx("span",{style:{fontSize:`${.75*u}rem`,color:"#fff",fontFamily:"Tamanegi, sans-serif"},children:ue.rating})]})};return a.jsxs("div",{className:"screen",style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"#1a1a2e",color:"white"},children:[a.jsx("h2",{style:{fontSize:`${x}rem`,marginBottom:`${.5*u}rem`,marginTop:0},children:""}),a.jsxs("div",{style:{marginBottom:`${.8*u}rem`,display:"flex",flexDirection:"column",alignItems:"center",gap:`${.3*u}rem`},children:[a.jsx("label",{style:{fontSize:`${.9*u}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif"},children:""}),a.jsx("input",{type:"text",value:i,onChange:q=>o(q.target.value),maxLength:12,placeholder:"",style:{padding:`${6*u}px ${12*u}px`,fontSize:`${.9*u}rem`,background:"#2d3748",border:"2px solid #4a5568",borderRadius:6*u,color:"white",outline:"none",width:180*u,textAlign:"center",fontFamily:"Tamanegi, sans-serif"},onFocus:q=>q.target.style.borderColor="#63b3ed",onBlur:q=>q.target.style.borderColor="#4a5568"})]}),a.jsxs("div",{style:{display:"flex",gap:`${z}rem`,marginBottom:`${1*u}rem`},children:[a.jsxs("div",{onClick:()=>t("SENKA"),style:{width:j,height:_,border:"1px solid #444",borderRadius:10*u,background:"linear-gradient(180deg, #2c0b0e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s",boxShadow:"0 4px 20px rgba(233, 69, 96, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:q=>q.currentTarget.style.transform="scale(1.05)",onMouseOut:q=>q.currentTarget.style.transform="scale(1)",children:[a.jsx("img",{src:pL,alt:"Senka",style:{width:"100%",height:"60%",objectFit:"cover"}}),a.jsxs("div",{style:{padding:`${6*u}px`,display:"flex",flexDirection:"column",alignItems:"center"},children:[a.jsx("h3",{style:{fontSize:`${I}rem`,color:"#e94560",margin:0},children:""}),a.jsx("p",{style:{color:"#aaa",margin:`${3*u}px 0`,fontSize:`${p}rem`,fontFamily:"Tamanegi, sans-serif"},children:" / "}),a.jsxs("p",{style:{padding:`0 ${.5*u}rem`,textAlign:"center",fontSize:`${D}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",lineHeight:1.3},children:["",a.jsx("br",{}),""]}),H("SENKA")]})]}),a.jsxs("div",{onClick:()=>t("AJA"),style:{width:j,height:_,border:"1px solid #444",borderRadius:10*u,background:"linear-gradient(180deg, #0f1c2e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s",boxShadow:"0 4px 20px rgba(69, 162, 233, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:q=>q.currentTarget.style.transform="scale(1.05)",onMouseOut:q=>q.currentTarget.style.transform="scale(1)",children:[a.jsx("img",{src:hL,alt:"Azya",style:{width:"100%",height:"60%",objectFit:"cover",objectPosition:"center top"}}),a.jsxs("div",{style:{padding:`${6*u}px`,display:"flex",flexDirection:"column",alignItems:"center"},children:[a.jsx("h3",{style:{fontSize:`${I}rem`,color:"#45a2e9",margin:0},children:""}),a.jsx("p",{style:{color:"#aaa",margin:`${3*u}px 0`,fontSize:`${p}rem`,fontFamily:"Tamanegi, sans-serif"},children:" / "}),a.jsxs("p",{style:{padding:`${.5*u}rem`,textAlign:"center",fontSize:`${D}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",lineHeight:1.3},children:["",a.jsx("br",{}),""]}),H("AJA")]})]}),a.jsxs("div",{onClick:()=>t("YORUKA"),style:{width:j,height:_,border:"1px solid #444",borderRadius:10*u,background:"linear-gradient(180deg, #1a0f2e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s",boxShadow:"0 4px 20px rgba(168, 85, 247, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:q=>q.currentTarget.style.transform="scale(1.05)",onMouseOut:q=>q.currentTarget.style.transform="scale(1)",children:[a.jsx("img",{src:gL,alt:"Yoruka",style:{width:"100%",height:"60%",objectFit:"cover"}}),a.jsxs("div",{style:{padding:`${6*u}px`,display:"flex",flexDirection:"column",alignItems:"center"},children:[a.jsx("h3",{style:{fontSize:`${I}rem`,color:"#a855f7",margin:0},children:"Y"}),a.jsx("p",{style:{color:"#aaa",margin:`${3*u}px 0`,fontSize:`${p}rem`,fontFamily:"Tamanegi, sans-serif"},children:" / "}),a.jsxs("p",{style:{padding:`0 ${.5*u}rem`,textAlign:"center",fontSize:`${D}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",lineHeight:1.3},children:["",a.jsx("br",{}),""]}),H("YORUKA")]})]})]}),n==="CPU"&&s&&a.jsxs("div",{style:{marginBottom:`${.6*u}rem`,display:"flex",flexDirection:"column",alignItems:"center",gap:`${.3*u}rem`},children:[a.jsx("p",{style:{fontSize:`${.85*u}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",margin:0},children:""}),a.jsx("div",{style:{display:"flex",gap:`${.6*u}rem`},children:["EASY","NORMAL","HARD"].map(q=>a.jsx("button",{onClick:()=>s(q),style:{padding:`${6*u}px ${14*u}px`,fontSize:`${.8*u}rem`,background:r===q?q==="EASY"?"#48bb78":q==="NORMAL"?"#e94560":"#9f7aea":"transparent",border:`2px solid ${q==="EASY"?"#48bb78":q==="NORMAL"?"#e94560":"#9f7aea"}`,color:"#fff",cursor:"pointer",borderRadius:4*u,fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s"},children:q==="EASY"?"":q==="NORMAL"?"":""},q))}),a.jsxs("p",{style:{fontSize:`${.65*u}rem`,opacity:.6,fontFamily:"Tamanegi, sans-serif",margin:0},children:[r==="EASY"&&"CPU",r==="NORMAL"&&"CPU",r==="HARD"&&"CPU"]})]}),c&&a.jsxs("div",{style:{marginBottom:`${.6*u}rem`,display:"flex",flexDirection:"column",alignItems:"center",gap:`${.3*u}rem`},children:[a.jsx("p",{style:{fontSize:`${.85*u}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",margin:0},children:""}),a.jsxs("div",{style:{display:"flex",gap:`${.6*u}rem`},children:[a.jsx("button",{onClick:()=>c(!0),style:{padding:`${6*u}px ${14*u}px`,fontSize:`${.8*u}rem`,background:l?"#3182ce":"transparent",border:"2px solid #3182ce",color:"#fff",cursor:"pointer",borderRadius:4*u,fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s"},children:"ON (60)"}),a.jsx("button",{onClick:()=>c(!1),style:{padding:`${6*u}px ${14*u}px`,fontSize:`${.8*u}rem`,background:l?"transparent":"#718096",border:"2px solid #718096",color:"#fff",cursor:"pointer",borderRadius:4*u,fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s"},children:"OFF"})]}),a.jsx("p",{style:{fontSize:`${.65*u}rem`,opacity:.6,fontFamily:"Tamanegi, sans-serif",margin:0},children:l?"600":""})]}),a.jsx("button",{onClick:e,style:{background:"#333",padding:te,fontSize:`${.9*u}rem`,marginBottom:`${.5*u}rem`},children:""})]})};class xL{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(e){this.flush(),this._parts.push(e)}append(e){this._pieces.push(e)}flush(){if(this._pieces.length>0){const e=new Uint8Array(this._pieces);this._parts.push(e),this._pieces=[]}}toArrayBuffer(){const e=[];for(const n of this._parts)e.push(n);return bL(e).buffer}}function bL(t){let e=0;for(const s of t)e+=s.byteLength;const n=new Uint8Array(e);let r=0;for(const s of t){const i=new Uint8Array(s.buffer,s.byteOffset,s.byteLength);n.set(i,r),r+=s.byteLength}return n}function dS(t){return new EL(t).unpack()}function uS(t){const e=new SL,n=e.pack(t);return n instanceof Promise?n.then(()=>e.getBuffer()):e.getBuffer()}class EL{constructor(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){const e=this.unpack_uint8();if(e<128)return e;if((e^224)<32)return(e^224)-32;let n;if((n=e^160)<=15)return this.unpack_raw(n);if((n=e^176)<=15)return this.unpack_string(n);if((n=e^144)<=15)return this.unpack_array(n);if((n=e^128)<=15)return this.unpack_map(n);switch(e){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return n=this.unpack_uint16(),this.unpack_string(n);case 217:return n=this.unpack_uint32(),this.unpack_string(n);case 218:return n=this.unpack_uint16(),this.unpack_raw(n);case 219:return n=this.unpack_uint32(),this.unpack_raw(n);case 220:return n=this.unpack_uint16(),this.unpack_array(n);case 221:return n=this.unpack_uint32(),this.unpack_array(n);case 222:return n=this.unpack_uint16(),this.unpack_map(n);case 223:return n=this.unpack_uint32(),this.unpack_map(n)}}unpack_uint8(){const e=this.dataView[this.index]&255;return this.index++,e}unpack_uint16(){const e=this.read(2),n=(e[0]&255)*256+(e[1]&255);return this.index+=2,n}unpack_uint32(){const e=this.read(4),n=((e[0]*256+e[1])*256+e[2])*256+e[3];return this.index+=4,n}unpack_uint64(){const e=this.read(8),n=((((((e[0]*256+e[1])*256+e[2])*256+e[3])*256+e[4])*256+e[5])*256+e[6])*256+e[7];return this.index+=8,n}unpack_int8(){const e=this.unpack_uint8();return e<128?e:e-256}unpack_int16(){const e=this.unpack_uint16();return e<32768?e:e-65536}unpack_int32(){const e=this.unpack_uint32();return e<2**31?e:e-2**32}unpack_int64(){const e=this.unpack_uint64();return e<2**63?e:e-2**64}unpack_raw(e){if(this.length<this.index+e)throw new Error(`BinaryPackFailure: index is out of range ${this.index} ${e} ${this.length}`);const n=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,n}unpack_string(e){const n=this.read(e);let r=0,s="",i,o;for(;r<e;)i=n[r],i<160?(o=i,r++):(i^192)<32?(o=(i&31)<<6|n[r+1]&63,r+=2):(i^224)<16?(o=(i&15)<<12|(n[r+1]&63)<<6|n[r+2]&63,r+=3):(o=(i&7)<<18|(n[r+1]&63)<<12|(n[r+2]&63)<<6|n[r+3]&63,r+=4),s+=String.fromCodePoint(o);return this.index+=e,s}unpack_array(e){const n=new Array(e);for(let r=0;r<e;r++)n[r]=this.unpack();return n}unpack_map(e){const n={};for(let r=0;r<e;r++){const s=this.unpack();n[s]=this.unpack()}return n}unpack_float(){const e=this.unpack_uint32(),n=e>>31,r=(e>>23&255)-127,s=e&8388607|8388608;return(n===0?1:-1)*s*2**(r-23)}unpack_double(){const e=this.unpack_uint32(),n=this.unpack_uint32(),r=e>>31,s=(e>>20&2047)-1023,o=(e&1048575|1048576)*2**(s-20)+n*2**(s-52);return(r===0?1:-1)*o}read(e){const n=this.index;if(n+e<=this.length)return this.dataView.subarray(n,n+e);throw new Error("BinaryPackFailure: read index out of range")}}class SL{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(e){if(typeof e=="string")this.pack_string(e);else if(typeof e=="number")Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if(typeof e=="boolean")e===!0?this._bufferBuilder.append(195):e===!1&&this._bufferBuilder.append(194);else if(e===void 0)this._bufferBuilder.append(192);else if(typeof e=="object")if(e===null)this._bufferBuilder.append(192);else{const n=e.constructor;if(e instanceof Array){const r=this.pack_array(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else if(e instanceof ArrayBuffer)this.pack_bin(new Uint8Array(e));else if("BYTES_PER_ELEMENT"in e){const r=e;this.pack_bin(new Uint8Array(r.buffer,r.byteOffset,r.byteLength))}else if(e instanceof Date)this.pack_string(e.toString());else{if(e instanceof Blob)return e.arrayBuffer().then(r=>{this.pack_bin(new Uint8Array(r)),this._bufferBuilder.flush()});if(n==Object||n.toString().startsWith("class")){const r=this.pack_object(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else throw new Error(`Type "${n.toString()}" not yet supported`)}}else throw new Error(`Type "${typeof e}" not yet supported`);this._bufferBuilder.flush()}pack_bin(e){const n=e.length;if(n<=15)this.pack_uint8(160+n);else if(n<=65535)this._bufferBuilder.append(218),this.pack_uint16(n);else if(n<=4294967295)this._bufferBuilder.append(219),this.pack_uint32(n);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(e)}pack_string(e){const n=this._textEncoder.encode(e),r=n.length;if(r<=15)this.pack_uint8(176+r);else if(r<=65535)this._bufferBuilder.append(216),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(217),this.pack_uint32(r);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(n)}pack_array(e){const n=e.length;if(n<=15)this.pack_uint8(144+n);else if(n<=65535)this._bufferBuilder.append(220),this.pack_uint16(n);else if(n<=4294967295)this._bufferBuilder.append(221),this.pack_uint32(n);else throw new Error("Invalid length");const r=s=>{if(s<n){const i=this.pack(e[s]);return i instanceof Promise?i.then(()=>r(s+1)):r(s+1)}};return r(0)}pack_integer(e){if(e>=-32&&e<=127)this._bufferBuilder.append(e&255);else if(e>=0&&e<=255)this._bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&e<=127)this._bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&e<=65535)this._bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&e<=32767)this._bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&e<=4294967295)this._bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-2147483648&&e<=2147483647)this._bufferBuilder.append(210),this.pack_int32(e);else if(e>=-9223372036854776e3&&e<=9223372036854776e3)this._bufferBuilder.append(211),this.pack_int64(e);else if(e>=0&&e<=18446744073709552e3)this._bufferBuilder.append(207),this.pack_uint64(e);else throw new Error("Invalid integer")}pack_double(e){let n=0;e<0&&(n=1,e=-e);const r=Math.floor(Math.log(e)/Math.LN2),s=e/2**r-1,i=Math.floor(s*2**52),o=2**32,l=n<<31|r+1023<<20|i/o&1048575,c=i%o;this._bufferBuilder.append(203),this.pack_int32(l),this.pack_int32(c)}pack_object(e){const n=Object.keys(e),r=n.length;if(r<=15)this.pack_uint8(128+r);else if(r<=65535)this._bufferBuilder.append(222),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(223),this.pack_uint32(r);else throw new Error("Invalid length");const s=i=>{if(i<n.length){const o=n[i];if(e.hasOwnProperty(o)){this.pack(o);const l=this.pack(e[o]);if(l instanceof Promise)return l.then(()=>s(i+1))}return s(i+1)}};return s(0)}pack_uint8(e){this._bufferBuilder.append(e)}pack_uint16(e){this._bufferBuilder.append(e>>8),this._bufferBuilder.append(e&255)}pack_uint32(e){const n=e&4294967295;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255)}pack_uint64(e){const n=e/4294967296,r=e%2**32;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}pack_int8(e){this._bufferBuilder.append(e&255)}pack_int16(e){this._bufferBuilder.append((e&65280)>>8),this._bufferBuilder.append(e&255)}pack_int32(e){this._bufferBuilder.append(e>>>24&255),this._bufferBuilder.append((e&16711680)>>>16),this._bufferBuilder.append((e&65280)>>>8),this._bufferBuilder.append(e&255)}pack_int64(e){const n=Math.floor(e/4294967296),r=e%2**32;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}constructor(){this._bufferBuilder=new xL,this._textEncoder=new TextEncoder}}let fS=!0,hS=!0;function Da(t,e,n){const r=t.match(e);return r&&r.length>=n&&parseFloat(r[n],10)}function Fi(t,e,n){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,s=r.addEventListener;r.addEventListener=function(o,l){if(o!==e)return s.apply(this,arguments);const c=d=>{const u=n(d);u&&(l.handleEvent?l.handleEvent(u):l(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(l,c),s.apply(this,[o,c])};const i=r.removeEventListener;r.removeEventListener=function(o,l){if(o!==e||!this._eventMap||!this._eventMap[e])return i.apply(this,arguments);if(!this._eventMap[e].has(l))return i.apply(this,arguments);const c=this._eventMap[e].get(l);return this._eventMap[e].delete(l),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,i.apply(this,[o,c])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function IL(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(fS=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function wL(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(hS=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function pS(){if(typeof window=="object"){if(fS)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function U0(t,e){hS&&console.warn(t+" is deprecated, please use "+e+" instead.")}function TL(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const r=n.userAgentData.brands.find(s=>s.brand==="Chromium");if(r)return{browser:"chrome",version:parseInt(r.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(Da(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(Da(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(Da(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=Da(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function p_(t){return Object.prototype.toString.call(t)==="[object Object]"}function gS(t){return p_(t)?Object.keys(t).reduce(function(e,n){const r=p_(t[n]),s=r?gS(t[n]):t[n],i=r&&!Object.keys(s).length;return s===void 0||i?e:Object.assign(e,{[n]:s})},{}):t}function Np(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?Np(t,t.get(e[r]),n):r.endsWith("Ids")&&e[r].forEach(s=>{Np(t,t.get(s),n)})}))}function g_(t,e,n){const r=n?"outbound-rtp":"inbound-rtp",s=new Map;if(e===null)return s;const i=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&i.push(o)}),i.forEach(o=>{t.forEach(l=>{l.type===r&&l.trackId===o.id&&Np(t,l,s)})}),s}const m_=pS;function mS(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const r=function(l){if(typeof l!="object"||l.mandatory||l.optional)return l;const c={};return Object.keys(l).forEach(d=>{if(d==="require"||d==="advanced"||d==="mediaSource")return;const u=typeof l[d]=="object"?l[d]:{ideal:l[d]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const h=function(f,S){return f?f+S.charAt(0).toUpperCase()+S.slice(1):S==="deviceId"?"sourceId":S};if(u.ideal!==void 0){c.optional=c.optional||[];let f={};typeof u.ideal=="number"?(f[h("min",d)]=u.ideal,c.optional.push(f),f={},f[h("max",d)]=u.ideal,c.optional.push(f)):(f[h("",d)]=u.ideal,c.optional.push(f))}u.exact!==void 0&&typeof u.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[h("",d)]=u.exact):["min","max"].forEach(f=>{u[f]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[h(f,d)]=u[f])})}),l.advanced&&(c.optional=(c.optional||[]).concat(l.advanced)),c},s=function(l,c){if(e.version>=61)return c(l);if(l=JSON.parse(JSON.stringify(l)),l&&typeof l.audio=="object"){const d=function(u,h,f){h in u&&!(f in u)&&(u[f]=u[h],delete u[h])};l=JSON.parse(JSON.stringify(l)),d(l.audio,"autoGainControl","googAutoGainControl"),d(l.audio,"noiseSuppression","googNoiseSuppression"),l.audio=r(l.audio)}if(l&&typeof l.video=="object"){let d=l.video.facingMode;d=d&&(typeof d=="object"?d:{ideal:d});const u=e.version<66;if(d&&(d.exact==="user"||d.exact==="environment"||d.ideal==="user"||d.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete l.video.facingMode;let h;if(d.exact==="environment"||d.ideal==="environment"?h=["back","rear"]:(d.exact==="user"||d.ideal==="user")&&(h=["front"]),h)return n.mediaDevices.enumerateDevices().then(f=>{f=f.filter(k=>k.kind==="videoinput");let S=f.find(k=>h.some(w=>k.label.toLowerCase().includes(w)));return!S&&f.length&&h.includes("back")&&(S=f[f.length-1]),S&&(l.video.deviceId=d.exact?{exact:S.deviceId}:{ideal:S.deviceId}),l.video=r(l.video),m_("chrome: "+JSON.stringify(l)),c(l)})}l.video=r(l.video)}return m_("chrome: "+JSON.stringify(l)),c(l)},i=function(l){return e.version>=64?l:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[l.name]||l.name,message:l.message,constraint:l.constraint||l.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(l,c,d){s(l,u=>{n.webkitGetUserMedia(u,c,h=>{d&&d(i(h))})})};if(n.getUserMedia=o.bind(n),n.mediaDevices.getUserMedia){const l=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return s(c,d=>l(d).then(u=>{if(d.audio&&!u.getAudioTracks().length||d.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(h=>{h.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(i(u))))}}}function yS(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function vS(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",s=>{let i;t.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(l=>l.track&&l.track.id===s.track.id):i={track:s.track};const o=new Event("track");o.track=s.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[r.stream],this.dispatchEvent(o)}),r.stream.getTracks().forEach(s=>{let i;t.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(l=>l.track&&l.track.id===s.id):i={track:s};const o=new Event("track");o.track=s,o.receiver=i,o.transceiver={receiver:i},o.streams=[r.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Fi(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function _S(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(s,i){return{track:i,get dtmf(){return this._dtmf===void 0&&(i.kind==="audio"?this._dtmf=s.createDTMFSender(i):this._dtmf=null),this._dtmf},_pc:s}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const s=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(l,c){let d=s.apply(this,arguments);return d||(d=e(this,l),this._senders.push(d)),d};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(l){i.apply(this,arguments);const c=this._senders.indexOf(l);c!==-1&&this._senders.splice(c,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],n.apply(this,[i]),i.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach(o=>{const l=this._senders.find(c=>c.track===o);l&&this._senders.splice(this._senders.indexOf(l),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function xS(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=n.apply(this,[]);return i.forEach(o=>o._pc=this),i});const r=t.RTCPeerConnection.prototype.addTrack;r&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=r.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){const i=this;return this._pc.getStats().then(o=>g_(o,i.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const s=n.apply(this,[]);return s.forEach(i=>i._pc=this),s}),Fi(t,"track",r=>(r.receiver._pc=r.srcElement,r)),t.RTCRtpReceiver.prototype.getStats=function(){const s=this;return this._pc.getStats().then(i=>g_(i,s.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const r=arguments[0];let s,i,o;return this.getSenders().forEach(l=>{l.track===r&&(s?o=!0:s=l)}),this.getReceivers().forEach(l=>(l.track===r&&(i?o=!0:i=l),l.track===r)),o||s&&i?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function bS(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,l){if(!l)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[l.id]?this._shimmedLocalStreams[l.id].indexOf(c)===-1&&this._shimmedLocalStreams[l.id].push(c):this._shimmedLocalStreams[l.id]=[l,c],c};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(d=>{if(this.getSenders().find(h=>h.track===d))throw new DOMException("Track already exists.","InvalidAccessError")});const l=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(d=>l.indexOf(d)===-1);this._shimmedLocalStreams[o.id]=[o].concat(c)};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],r.apply(this,arguments)};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(l=>{const c=this._shimmedLocalStreams[l].indexOf(o);c!==-1&&this._shimmedLocalStreams[l].splice(c,1),this._shimmedLocalStreams[l].length===1&&delete this._shimmedLocalStreams[l]}),s.apply(this,arguments)}}function ES(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return bS(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const u=n.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(h=>this._reverseStreams[h.id])};const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(h=>{if(this.getSenders().find(S=>S.track===h))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const h=new t.MediaStream(u.getTracks());this._streams[u.id]=h,this._reverseStreams[h.id]=u,u=h}r.apply(this,[u])};const s=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},t.RTCPeerConnection.prototype.addTrack=function(u,h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const f=[].slice.call(arguments,1);if(f.length!==1||!f[0].getTracks().find(w=>w===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(w=>w.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const k=this._streams[h.id];if(k)k.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const w=new t.MediaStream([u]);this._streams[h.id]=w,this._reverseStreams[w.id]=h,this.addStream(w)}return this.getSenders().find(w=>w.track===u)};function i(d,u){let h=u.sdp;return Object.keys(d._reverseStreams||[]).forEach(f=>{const S=d._reverseStreams[f],k=d._streams[S.id];h=h.replace(new RegExp(k.id,"g"),S.id)}),new RTCSessionDescription({type:u.type,sdp:h})}function o(d,u){let h=u.sdp;return Object.keys(d._reverseStreams||[]).forEach(f=>{const S=d._reverseStreams[f],k=d._streams[S.id];h=h.replace(new RegExp(S.id,"g"),k.id)}),new RTCSessionDescription({type:u.type,sdp:h})}["createOffer","createAnswer"].forEach(function(d){const u=t.RTCPeerConnection.prototype[d],h={[d](){const f=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[k=>{const w=i(this,k);f[0].apply(null,[w])},k=>{f[1]&&f[1].apply(null,k)},arguments[2]]):u.apply(this,arguments).then(k=>i(this,k))}};t.RTCPeerConnection.prototype[d]=h[d]});const l=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?l.apply(this,arguments):(arguments[0]=o(this,arguments[0]),l.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const d=c.get.apply(this);return d.type===""?d:i(this,d)}}),t.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let f;Object.keys(this._streams).forEach(S=>{this._streams[S].getTracks().find(w=>u.track===w)&&(f=this._streams[S])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function jp(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=t.RTCPeerConnection.prototype[n],s={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=s[n]})}function SS(t,e){Fi(t,"negotiationneeded",n=>{const r=n.target;if(!((e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return n})}const y_=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:SS,shimAddTrackRemoveTrack:ES,shimAddTrackRemoveTrackWithNative:bS,shimGetSendersWithDtmf:_S,shimGetUserMedia:mS,shimMediaStream:yS,shimOnTrack:vS,shimPeerConnection:jp,shimSenderReceiverGetStats:xS},Symbol.toStringTag,{value:"Module"}));function IS(t,e){const n=t&&t.navigator,r=t&&t.MediaStreamTrack;if(n.getUserMedia=function(s,i,o){U0("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(s).then(i,o)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const s=function(o,l,c){l in o&&!(c in o)&&(o[c]=o[l],delete o[l])},i=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),s(o.audio,"autoGainControl","mozAutoGainControl"),s(o.audio,"noiseSuppression","mozNoiseSuppression")),i(o)},r&&r.prototype.getSettings){const o=r.prototype.getSettings;r.prototype.getSettings=function(){const l=o.apply(this,arguments);return s(l,"mozAutoGainControl","autoGainControl"),s(l,"mozNoiseSuppression","noiseSuppression"),l}}if(r&&r.prototype.applyConstraints){const o=r.prototype.applyConstraints;r.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),s(l,"autoGainControl","mozAutoGainControl"),s(l,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[l])}}}}function CL(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,Promise.reject(s)}return r.video===!0?r.video={mediaSource:e}:r.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(r)})}function wS(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function $p(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const i=t.RTCPeerConnection.prototype[s],o={[s](){return arguments[0]=new(s==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[s]=o[s]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[i,o,l]=arguments;return r.apply(this,[i||null]).then(c=>{if(e.version<53&&!o)try{c.forEach(d=>{d.type=n[d.type]||d.type})}catch(d){if(d.name!=="TypeError")throw d;c.forEach((u,h)=>{c.set(h,Object.assign({},u,{type:n[u.type]||u.type}))})}return c}).then(o,l)}}function TS(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=e.apply(this,[]);return s.forEach(i=>i._pc=this),s});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=n.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function CS(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r}),Fi(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function kS(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){U0("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&n.getTracks().includes(r.track)&&this.removeTrack(r)})})}function RS(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function AS(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const s=r.length>0;s&&r.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=e.apply(this,arguments);if(s){const{sender:o}=i,l=o.getParameters();(!("encodings"in l)||l.encodings.length===1&&Object.keys(l.encodings[0]).length===0)&&(l.encodings=r,o.sendEncodings=r,this.setParametersPromises.push(o.setParameters(l).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return i})}function PS(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const r=e.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function OS(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function LS(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}const v_=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:AS,shimCreateAnswer:LS,shimCreateOffer:OS,shimGetDisplayMedia:CL,shimGetParameters:PS,shimGetUserMedia:IS,shimOnTrack:wS,shimPeerConnection:$p,shimRTCDataChannel:RS,shimReceiverGetStats:CS,shimRemoveStream:kS,shimSenderGetStats:TS},Symbol.toStringTag,{value:"Module"}));function DS(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(s=>e.call(this,s,r)),r.getVideoTracks().forEach(s=>e.call(this,s,r))},t.RTCPeerConnection.prototype.addTrack=function(r,...s){return s&&s.forEach(i=>{this._localStreams?this._localStreams.includes(i)||this._localStreams.push(i):this._localStreams=[i]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(n);if(r===-1)return;this._localStreams.splice(r,1);const s=n.getTracks();this.getSenders().forEach(i=>{s.includes(i.track)&&this.removeTrack(i)})})}}function MS(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(s=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(s))return;this._remoteStreams.push(s);const i=new Event("addstream");i.stream=s,this.dispatchEvent(i)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){s.streams.forEach(i=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(i)>=0)return;r._remoteStreams.push(i);const o=new Event("addstream");o.stream=i,r.dispatchEvent(o)})}),e.apply(r,arguments)}}}function NS(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,r=e.createAnswer,s=e.setLocalDescription,i=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(d,u){const h=arguments.length>=2?arguments[2]:arguments[0],f=n.apply(this,[h]);return u?(f.then(d,u),Promise.resolve()):f},e.createAnswer=function(d,u){const h=arguments.length>=2?arguments[2]:arguments[0],f=r.apply(this,[h]);return u?(f.then(d,u),Promise.resolve()):f};let l=function(c,d,u){const h=s.apply(this,[c]);return u?(h.then(d,u),Promise.resolve()):h};e.setLocalDescription=l,l=function(c,d,u){const h=i.apply(this,[c]);return u?(h.then(d,u),Promise.resolve()):h},e.setRemoteDescription=l,l=function(c,d,u){const h=o.apply(this,[c]);return u?(h.then(d,u),Promise.resolve()):h},e.addIceCandidate=l}function jS(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,r=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=s=>r($S(s))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(r,s,i){e.mediaDevices.getUserMedia(r).then(s,i)}).bind(e))}function $S(t){return t&&t.video!==void 0?Object.assign({},t,{video:gS(t.video)}):t}function FS(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(r,s){if(r&&r.iceServers){const i=[];for(let o=0;o<r.iceServers.length;o++){let l=r.iceServers[o];l.urls===void 0&&l.url?(U0("RTCIceServer.url","RTCIceServer.urls"),l=JSON.parse(JSON.stringify(l)),l.urls=l.url,delete l.url,i.push(l)):i.push(r.iceServers[o])}r.iceServers=i}return new e(r,s)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function US(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function BS(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):r.offerToReceiveAudio===!0&&!s&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const i=this.getTransceivers().find(o=>o.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveVideo===!0&&!i&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function zS(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}const __=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:zS,shimCallbacksAPI:NS,shimConstraints:$S,shimCreateOfferLegacy:BS,shimGetUserMedia:jS,shimLocalStreamsAPI:DS,shimRTCIceServerUrls:FS,shimRemoteStreamsAPI:MS,shimTrackEventTransceiver:US},Symbol.toStringTag,{value:"Module"}));var HS={exports:{}};(function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},e.splitSections=function(n){return n.split(`
m=`).map((s,i)=>(i>0?"m="+s:s).trim()+`\r
`)},e.getDescription=function(n){const r=e.splitSections(n);return r&&r[0]},e.getMediaSections=function(n){const r=e.splitSections(n);return r.shift(),r},e.matchPrefix=function(n,r){return e.splitLines(n).filter(s=>s.indexOf(r)===0)},e.parseCandidate=function(n){let r;n.indexOf("a=candidate:")===0?r=n.substring(12).split(" "):r=n.substring(10).split(" ");const s={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let i=8;i<r.length;i+=2)switch(r[i]){case"raddr":s.relatedAddress=r[i+1];break;case"rport":s.relatedPort=parseInt(r[i+1],10);break;case"tcptype":s.tcpType=r[i+1];break;case"ufrag":s.ufrag=r[i+1],s.usernameFragment=r[i+1];break;default:s[r[i]]===void 0&&(s[r[i]]=r[i+1]);break}return s},e.writeCandidate=function(n){const r=[];r.push(n.foundation);const s=n.component;s==="rtp"?r.push(1):s==="rtcp"?r.push(2):r.push(s),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const i=n.type;return r.push("typ"),r.push(i),i!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let r=n.substring(9).split(" ");const s={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),s.name=r[0],s.clockRate=parseInt(r[1],10),s.channels=r.length===3?parseInt(r[2],10):1,s.numChannels=s.channels,s},e.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const s=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(s!==1?"/"+s:"")+`\r
`},e.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const r={};let s;const i=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<i.length;o++)s=i[o].trim().split("="),r[s[0].trim()]=s[1];return r},e.writeFmtp=function(n){let r="",s=n.payloadType;if(n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const i=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?i.push(o+"="+n.parameters[o]):i.push(o)}),r+="a=fmtp:"+s+" "+i.join(";")+`\r
`}return r},e.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},e.writeRtcpFb=function(n){let r="",s=n.payloadType;return n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(i=>{r+="a=rtcp-fb:"+s+" "+i.type+(i.parameter&&i.parameter.length?" "+i.parameter:"")+`\r
`}),r},e.parseSsrcMedia=function(n){const r=n.indexOf(" "),s={ssrc:parseInt(n.substring(7,r),10)},i=n.indexOf(":",r);return i>-1?(s.attribute=n.substring(r+1,i),s.value=n.substring(i+1)):s.attribute=n.substring(r+1),s},e.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(s=>parseInt(s,10))}},e.getMid=function(n){const r=e.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},e.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:e.matchPrefix(n+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,r){let s="a=setup:"+r+`\r
`;return n.fingerprints.forEach(i=>{s+="a=fingerprint:"+i.algorithm+" "+i.value+`\r
`}),s},e.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,r){return e.matchPrefix(n+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,r){const s=e.matchPrefix(n+r,"a=ice-ufrag:")[0],i=e.matchPrefix(n+r,"a=ice-pwd:")[0];return s&&i?{usernameFragment:s.substring(12),password:i.substring(10)}:null},e.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},e.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=e.splitLines(n)[0].split(" ");r.profile=i[2];for(let l=3;l<i.length;l++){const c=i[l],d=e.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(d){const u=e.parseRtpMap(d),h=e.matchPrefix(n,"a=fmtp:"+c+" ");switch(u.parameters=h.length?e.parseFmtp(h[0]):{},u.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),r.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(l=>{r.headerExtensions.push(e.parseExtmap(l))});const o=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(l=>{o.forEach(c=>{l.rtcpFeedback.find(u=>u.type===c.type&&u.parameter===c.parameter)||l.rtcpFeedback.push(c)})}),r},e.writeRtpDescription=function(n,r){let s="";s+="m="+n+" ",s+=r.codecs.length>0?"9":"0",s+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",s+=r.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,s+=`c=IN IP4 0.0.0.0\r
`,s+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(o=>{s+=e.writeRtpMap(o),s+=e.writeFmtp(o),s+=e.writeRtcpFb(o)});let i=0;return r.codecs.forEach(o=>{o.maxptime>i&&(i=o.maxptime)}),i>0&&(s+="a=maxptime:"+i+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(o=>{s+=e.writeExtmap(o)}),s},e.parseRtpEncodingParameters=function(n){const r=[],s=e.parseRtpParameters(n),i=s.fecMechanisms.indexOf("RED")!==-1,o=s.fecMechanisms.indexOf("ULPFEC")!==-1,l=e.matchPrefix(n,"a=ssrc:").map(f=>e.parseSsrcMedia(f)).filter(f=>f.attribute==="cname"),c=l.length>0&&l[0].ssrc;let d;const u=e.matchPrefix(n,"a=ssrc-group:FID").map(f=>f.substring(17).split(" ").map(k=>parseInt(k,10)));u.length>0&&u[0].length>1&&u[0][0]===c&&(d=u[0][1]),s.codecs.forEach(f=>{if(f.name.toUpperCase()==="RTX"&&f.parameters.apt){let S={ssrc:c,codecPayloadType:parseInt(f.parameters.apt,10)};c&&d&&(S.rtx={ssrc:d}),r.push(S),i&&(S=JSON.parse(JSON.stringify(S)),S.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},r.push(S))}}),r.length===0&&c&&r.push({ssrc:c});let h=e.matchPrefix(n,"b=");return h.length&&(h[0].indexOf("b=TIAS:")===0?h=parseInt(h[0].substring(7),10):h[0].indexOf("b=AS:")===0?h=parseInt(h[0].substring(5),10)*1e3*.95-50*40*8:h=void 0,r.forEach(f=>{f.maxBitrate=h})),r},e.parseRtcpParameters=function(n){const r={},s=e.matchPrefix(n,"a=ssrc:").map(l=>e.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];s&&(r.cname=s.value,r.ssrc=s.ssrc);const i=e.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=i.length>0,r.compound=i.length===0;const o=e.matchPrefix(n,"a=rtcp-mux");return r.mux=o.length>0,r},e.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},e.parseMsid=function(n){let r;const s=e.matchPrefix(n,"a=msid:");if(s.length===1)return r=s[0].substring(7).split(" "),{stream:r[0],track:r[1]};const i=e.matchPrefix(n,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(i.length>0)return r=i[0].value.split(" "),{stream:r[0],track:r[1]}},e.parseSctpDescription=function(n){const r=e.parseMLine(n),s=e.matchPrefix(n,"a=max-message-size:");let i;s.length>0&&(i=parseInt(s[0].substring(19),10)),isNaN(i)&&(i=65536);const o=e.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:r.fmt,maxMessageSize:i};const l=e.matchPrefix(n,"a=sctpmap:");if(l.length>0){const c=l[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:i}}},e.writeSctpDescription=function(n,r){let s=[];return n.protocol!=="DTLS/SCTP"?s=["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:s=["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&s.push("a=max-message-size:"+r.maxMessageSize+`\r
`),s.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,r,s){let i;const o=r!==void 0?r:2;return n?i=n:i=e.generateSessionId(),`v=0\r
o=`+(s||"thisisadapterortc")+" "+i+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,r){const s=e.splitLines(n);for(let i=0;i<s.length;i++)switch(s[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[i].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const s=e.splitLines(n)[0].substring(2).split(" ");return{kind:s[0],port:parseInt(s[1],10),protocol:s[2],fmt:s.slice(3).join(" ")}},e.parseOLine=function(n){const s=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:s[0],sessionId:s[1],sessionVersion:parseInt(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=e.splitLines(n);for(let s=0;s<r.length;s++)if(r[s].length<2||r[s].charAt(1)!=="=")return!1;return!0},t.exports=e})(HS);var WS=HS.exports;const Ro=j_(WS),kL=DI({__proto__:null,default:Ro},[WS]);function cd(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const s=new e(r),i=Ro.parseCandidate(r.candidate);for(const o in i)o in s||Object.defineProperty(s,o,{value:i[o]});return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new e(r)},t.RTCIceCandidate.prototype=e.prototype,Fi(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function Fp(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Fi(t,"icecandidate",e=>{if(e.candidate){const n=Ro.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function dd(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(l){if(!l||!l.sdp)return!1;const c=Ro.splitSections(l.sdp);return c.shift(),c.some(d=>{const u=Ro.parseMLine(d);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},r=function(l){const c=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const d=parseInt(c[1],10);return d!==d?-1:d},s=function(l){let c=65536;return e.browser==="firefox"&&(e.version<57?l===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},i=function(l,c){let d=65536;e.browser==="firefox"&&e.version===57&&(d=65535);const u=Ro.matchPrefix(l.sdp,"a=max-message-size:");return u.length>0?d=parseInt(u[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(d=2147483637),d},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=r(arguments[0]),d=s(c),u=i(arguments[0],c);let h;d===0&&u===0?h=Number.POSITIVE_INFINITY:d===0||u===0?h=Math.max(d,u):h=Math.min(d,u);const f={};Object.defineProperty(f,"maxMessageSize",{get(){return h}}),this._sctp=f}return o.apply(this,arguments)}}function ud(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(r,s){const i=r.send;r.send=function(){const l=arguments[0],c=l.length||l.size||l.byteLength;if(r.readyState==="open"&&s.sctp&&c>s.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+s.sctp.maxMessageSize+" bytes)");return i.apply(r,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const s=n.apply(this,arguments);return e(s,this),s},Fi(t,"datachannel",r=>(e(r.channel,r.target),r))}function Up(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=s=>{const i=s.target;if(i._lastConnectionState!==i.connectionState){i._lastConnectionState=i.connectionState;const o=new Event("connectionstatechange",s);i.dispatchEvent(o)}return s},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function Bp(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(s){if(s&&s.sdp&&s.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i=s.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&s instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:s.type,sdp:i}):s.sdp=i}return n.apply(this,arguments)}}function fd(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function hd(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let s=arguments[0]||{};if(typeof s!="object"||s.type&&s.sdp)return n.apply(this,arguments);if(s={type:s.type,sdp:s.sdp},!s.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":s.type="offer";break;default:s.type="answer";break}return s.sdp||s.type!=="offer"&&s.type!=="answer"?n.apply(this,[s]):(s.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}const RL=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:Bp,shimAddIceCandidateNullOrEmpty:fd,shimConnectionState:Up,shimMaxMessageSize:dd,shimParameterlessSetLocalDescription:hd,shimRTCIceCandidate:cd,shimRTCIceCandidateRelayProtocol:Fp,shimSendThrowTypeError:ud},Symbol.toStringTag,{value:"Module"}));function AL({window:t}={},e={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const n=pS,r=TL(t),s={browserDetails:r,commonShim:RL,extractVersion:Da,disableLog:IL,disableWarnings:wL,sdp:kL};switch(r.browser){case"chrome":if(!y_||!jp||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),s;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),s;n("adapter.js shimming chrome."),s.browserShim=y_,fd(t,r),hd(t),mS(t,r),yS(t),jp(t,r),vS(t),ES(t,r),_S(t),xS(t),SS(t,r),cd(t),Fp(t),Up(t),dd(t,r),ud(t),Bp(t,r);break;case"firefox":if(!v_||!$p||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),s;n("adapter.js shimming firefox."),s.browserShim=v_,fd(t,r),hd(t),IS(t,r),$p(t,r),wS(t),kS(t),TS(t),CS(t),RS(t),AS(t),PS(t),OS(t),LS(t),cd(t),Up(t),dd(t,r),ud(t);break;case"safari":if(!__||!e.shimSafari)return n("Safari shim is not included in this adapter release."),s;n("adapter.js shimming safari."),s.browserShim=__,fd(t,r),hd(t),FS(t),BS(t),NS(t),DS(t),MS(t),US(t),jS(t),zS(t),cd(t),Fp(t),dd(t,r),ud(t),Bp(t,r);break;default:n("Unsupported browser!");break}return s}const x_=AL({window:typeof window>"u"?void 0:window});function Ui(t,e,n,r){Object.defineProperty(t,e,{get:n,set:r,enumerable:!0,configurable:!0})}class GS{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=e=>{const n=[],r=e.byteLength,s=Math.ceil(r/this.chunkedMTU);let i=0,o=0;for(;o<r;){const l=Math.min(r,o+this.chunkedMTU),c=e.slice(o,l),d={__peerData:this._dataCount,n:i,data:c,total:s};n.push(d),o=l,i++}return this._dataCount++,n}}}function PL(t){let e=0;for(const s of t)e+=s.byteLength;const n=new Uint8Array(e);let r=0;for(const s of t)n.set(s,r),r+=s.byteLength;return n}const vh=x_.default||x_,Ca=new class{isWebRTCSupported(){return typeof RTCPeerConnection<"u"}isBrowserSupported(){const t=this.getBrowser(),e=this.getVersion();return this.supportedBrowsers.includes(t)?t==="chrome"?e>=this.minChromeVersion:t==="firefox"?e>=this.minFirefoxVersion:t==="safari"?!this.isIOS&&e>=this.minSafariVersion:!1:!1}getBrowser(){return vh.browserDetails.browser}getVersion(){return vh.browserDetails.version||0}isUnifiedPlanSupported(){const t=this.getBrowser(),e=vh.browserDetails.version||0;if(t==="chrome"&&e<this.minChromeVersion)return!1;if(t==="firefox"&&e>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let n,r=!1;try{n=new RTCPeerConnection,n.addTransceiver("audio"),r=!0}catch{}finally{n&&n.close()}return r}toString(){return`Supports:
    browser:${this.getBrowser()}
    version:${this.getVersion()}
    isIOS:${this.isIOS}
    isWebRTCSupported:${this.isWebRTCSupported()}
    isBrowserSupported:${this.isBrowserSupported()}
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS=typeof navigator<"u"?["iPad","iPhone","iPod"].includes(navigator.platform):!1,this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},OL=t=>!t||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(t),VS=()=>Math.random().toString(36).slice(2),b_={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};class LL extends GS{noop(){}blobToArrayBuffer(e,n){const r=new FileReader;return r.onload=function(s){s.target&&n(s.target.result)},r.readAsArrayBuffer(e),r}binaryStringToArrayBuffer(e){const n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r)&255;return n.buffer}isSecure(){return location.protocol==="https:"}constructor(...e){super(...e),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=b_,this.browser=Ca.getBrowser(),this.browserVersion=Ca.getVersion(),this.pack=uS,this.unpack=dS,this.supports=function(){const n={browser:Ca.isBrowserSupported(),webRTC:Ca.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!n.webRTC)return n;let r;try{r=new RTCPeerConnection(b_),n.audioVideo=!0;let s;try{s=r.createDataChannel("_PEERJSTEST",{ordered:!0}),n.data=!0,n.reliable=!!s.ordered;try{s.binaryType="blob",n.binaryBlob=!Ca.isIOS}catch{}}catch{}finally{s&&s.close()}}catch{}finally{r&&r.close()}return n}(),this.validateId=OL,this.randomToken=VS}}const Pn=new LL,DL="PeerJS: ";class ML{get logLevel(){return this._logLevel}set logLevel(e){this._logLevel=e}log(...e){this._logLevel>=3&&this._print(3,...e)}warn(...e){this._logLevel>=2&&this._print(2,...e)}error(...e){this._logLevel>=1&&this._print(1,...e)}setLogFunction(e){this._print=e}_print(e,...n){const r=[DL,...n];for(const s in r)r[s]instanceof Error&&(r[s]="("+r[s].name+") "+r[s].message);e>=3?console.log(...r):e>=2?console.warn("WARNING",...r):e>=1&&console.error("ERROR",...r)}constructor(){this._logLevel=0}}var Ce=new ML,B0={},NL=Object.prototype.hasOwnProperty,Cn="~";function Pl(){}Object.create&&(Pl.prototype=Object.create(null),new Pl().__proto__||(Cn=!1));function jL(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function YS(t,e,n,r,s){if(typeof n!="function")throw new TypeError("The listener must be a function");var i=new jL(n,r||t,s),o=Cn?Cn+e:e;return t._events[o]?t._events[o].fn?t._events[o]=[t._events[o],i]:t._events[o].push(i):(t._events[o]=i,t._eventsCount++),t}function pd(t,e){--t._eventsCount===0?t._events=new Pl:delete t._events[e]}function vn(){this._events=new Pl,this._eventsCount=0}vn.prototype.eventNames=function(){var e=[],n,r;if(this._eventsCount===0)return e;for(r in n=this._events)NL.call(n,r)&&e.push(Cn?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(n)):e};vn.prototype.listeners=function(e){var n=Cn?Cn+e:e,r=this._events[n];if(!r)return[];if(r.fn)return[r.fn];for(var s=0,i=r.length,o=new Array(i);s<i;s++)o[s]=r[s].fn;return o};vn.prototype.listenerCount=function(e){var n=Cn?Cn+e:e,r=this._events[n];return r?r.fn?1:r.length:0};vn.prototype.emit=function(e,n,r,s,i,o){var l=Cn?Cn+e:e;if(!this._events[l])return!1;var c=this._events[l],d=arguments.length,u,h;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,n),!0;case 3:return c.fn.call(c.context,n,r),!0;case 4:return c.fn.call(c.context,n,r,s),!0;case 5:return c.fn.call(c.context,n,r,s,i),!0;case 6:return c.fn.call(c.context,n,r,s,i,o),!0}for(h=1,u=new Array(d-1);h<d;h++)u[h-1]=arguments[h];c.fn.apply(c.context,u)}else{var f=c.length,S;for(h=0;h<f;h++)switch(c[h].once&&this.removeListener(e,c[h].fn,void 0,!0),d){case 1:c[h].fn.call(c[h].context);break;case 2:c[h].fn.call(c[h].context,n);break;case 3:c[h].fn.call(c[h].context,n,r);break;case 4:c[h].fn.call(c[h].context,n,r,s);break;default:if(!u)for(S=1,u=new Array(d-1);S<d;S++)u[S-1]=arguments[S];c[h].fn.apply(c[h].context,u)}}return!0};vn.prototype.on=function(e,n,r){return YS(this,e,n,r,!1)};vn.prototype.once=function(e,n,r){return YS(this,e,n,r,!0)};vn.prototype.removeListener=function(e,n,r,s){var i=Cn?Cn+e:e;if(!this._events[i])return this;if(!n)return pd(this,i),this;var o=this._events[i];if(o.fn)o.fn===n&&(!s||o.once)&&(!r||o.context===r)&&pd(this,i);else{for(var l=0,c=[],d=o.length;l<d;l++)(o[l].fn!==n||s&&!o[l].once||r&&o[l].context!==r)&&c.push(o[l]);c.length?this._events[i]=c.length===1?c[0]:c:pd(this,i)}return this};vn.prototype.removeAllListeners=function(e){var n;return e?(n=Cn?Cn+e:e,this._events[n]&&pd(this,n)):(this._events=new Pl,this._eventsCount=0),this};vn.prototype.off=vn.prototype.removeListener;vn.prototype.addListener=vn.prototype.on;vn.prefixed=Cn;vn.EventEmitter=vn;B0=vn;var Bi={};Ui(Bi,"ConnectionType",()=>Ws);Ui(Bi,"PeerErrorType",()=>Wt);Ui(Bi,"BaseConnectionErrorType",()=>zp);Ui(Bi,"DataConnectionErrorType",()=>z0);Ui(Bi,"SerializationType",()=>Xu);Ui(Bi,"SocketEventType",()=>As);Ui(Bi,"ServerMessageType",()=>gn);var Ws=function(t){return t.Data="data",t.Media="media",t}({}),Wt=function(t){return t.BrowserIncompatible="browser-incompatible",t.Disconnected="disconnected",t.InvalidID="invalid-id",t.InvalidKey="invalid-key",t.Network="network",t.PeerUnavailable="peer-unavailable",t.SslUnavailable="ssl-unavailable",t.ServerError="server-error",t.SocketError="socket-error",t.SocketClosed="socket-closed",t.UnavailableID="unavailable-id",t.WebRTC="webrtc",t}({}),zp=function(t){return t.NegotiationFailed="negotiation-failed",t.ConnectionClosed="connection-closed",t}({}),z0=function(t){return t.NotOpenYet="not-open-yet",t.MessageToBig="message-too-big",t}({}),Xu=function(t){return t.Binary="binary",t.BinaryUTF8="binary-utf8",t.JSON="json",t.None="raw",t}({}),As=function(t){return t.Message="message",t.Disconnected="disconnected",t.Error="error",t.Close="close",t}({}),gn=function(t){return t.Heartbeat="HEARTBEAT",t.Candidate="CANDIDATE",t.Offer="OFFER",t.Answer="ANSWER",t.Open="OPEN",t.Error="ERROR",t.IdTaken="ID-TAKEN",t.InvalidKey="INVALID-KEY",t.Leave="LEAVE",t.Expire="EXPIRE",t}({});const KS="1.5.5";class $L extends B0.EventEmitter{constructor(e,n,r,s,i,o=5e3){super(),this.pingInterval=o,this._disconnected=!0,this._messagesQueue=[];const l=e?"wss://":"ws://";this._baseUrl=l+n+":"+r+s+"peerjs?key="+i}start(e,n){this._id=e;const r=`${this._baseUrl}&id=${e}&token=${n}`;this._socket||!this._disconnected||(this._socket=new WebSocket(r+"&version="+KS),this._disconnected=!1,this._socket.onmessage=s=>{let i;try{i=JSON.parse(s.data),Ce.log("Server message received:",i)}catch{Ce.log("Invalid server message",s.data);return}this.emit(As.Message,i)},this._socket.onclose=s=>{this._disconnected||(Ce.log("Socket closed.",s),this._cleanup(),this._disconnected=!0,this.emit(As.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),Ce.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen()){Ce.log("Cannot send heartbeat, because socket closed");return}const e=JSON.stringify({type:gn.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&this._socket.readyState===1}_sendQueuedMessages(){const e=[...this._messagesQueue];this._messagesQueue=[];for(const n of e)this.send(n)}send(e){if(this._disconnected)return;if(!this._id){this._messagesQueue.push(e);return}if(!e.type){this.emit(As.Error,"Invalid message");return}if(!this._wsOpen())return;const n=JSON.stringify(e);this._socket.send(n)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}class XS{constructor(e){this.connection=e}startConnection(e){const n=this._startPeerConnection();if(this.connection.peerConnection=n,this.connection.type===Ws.Media&&e._stream&&this._addTracksToConnection(e._stream,n),e.originator){const r=this.connection,s={ordered:!!e.reliable},i=n.createDataChannel(r.label,s);r._initializeDataChannel(i),this._makeOffer()}else this.handleSDP("OFFER",e.sdp)}_startPeerConnection(){Ce.log("Creating RTCPeerConnection.");const e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e}_setupListeners(e){const n=this.connection.peer,r=this.connection.connectionId,s=this.connection.type,i=this.connection.provider;Ce.log("Listening for ICE candidates."),e.onicecandidate=o=>{!o.candidate||!o.candidate.candidate||(Ce.log(`Received ICE candidates for ${n}:`,o.candidate),i.socket.send({type:gn.Candidate,payload:{candidate:o.candidate,type:s,connectionId:r},dst:n}))},e.oniceconnectionstatechange=()=>{switch(e.iceConnectionState){case"failed":Ce.log("iceConnectionState is failed, closing connections to "+n),this.connection.emitError(zp.NegotiationFailed,"Negotiation of connection to "+n+" failed."),this.connection.close();break;case"closed":Ce.log("iceConnectionState is closed, closing connections to "+n),this.connection.emitError(zp.ConnectionClosed,"Connection to "+n+" closed."),this.connection.close();break;case"disconnected":Ce.log("iceConnectionState changed to disconnected on the connection with "+n);break;case"completed":e.onicecandidate=()=>{};break}this.connection.emit("iceStateChanged",e.iceConnectionState)},Ce.log("Listening for data channel"),e.ondatachannel=o=>{Ce.log("Received data channel");const l=o.channel;i.getConnection(n,r)._initializeDataChannel(l)},Ce.log("Listening for remote stream"),e.ontrack=o=>{Ce.log("Received remote stream");const l=o.streams[0],c=i.getConnection(n,r);if(c.type===Ws.Media){const d=c;this._addStreamToMediaConnection(l,d)}}}cleanup(){Ce.log("Cleaning up PeerConnection to "+this.connection.peer);const e=this.connection.peerConnection;if(!e)return;this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=()=>{};const n=e.signalingState!=="closed";let r=!1;const s=this.connection.dataChannel;s&&(r=!!s.readyState&&s.readyState!=="closed"),(n||r)&&e.close()}async _makeOffer(){const e=this.connection.peerConnection,n=this.connection.provider;try{const r=await e.createOffer(this.connection.options.constraints);Ce.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),Ce.log("Set localDescription:",r,`for:${this.connection.peer}`);let s={sdp:r,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===Ws.Data){const i=this.connection;s={...s,label:i.label,reliable:i.reliable,serialization:i.serialization}}n.socket.send({type:gn.Offer,payload:s,dst:this.connection.peer})}catch(s){s!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(n.emitError(Wt.WebRTC,s),Ce.log("Failed to setLocalDescription, ",s))}}catch(r){n.emitError(Wt.WebRTC,r),Ce.log("Failed to createOffer, ",r)}}async _makeAnswer(){const e=this.connection.peerConnection,n=this.connection.provider;try{const r=await e.createAnswer();Ce.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),Ce.log("Set localDescription:",r,`for:${this.connection.peer}`),n.socket.send({type:gn.Answer,payload:{sdp:r,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(s){n.emitError(Wt.WebRTC,s),Ce.log("Failed to setLocalDescription, ",s)}}catch(r){n.emitError(Wt.WebRTC,r),Ce.log("Failed to create answer, ",r)}}async handleSDP(e,n){n=new RTCSessionDescription(n);const r=this.connection.peerConnection,s=this.connection.provider;Ce.log("Setting remote description",n);const i=this;try{await r.setRemoteDescription(n),Ce.log(`Set remoteDescription:${e} for:${this.connection.peer}`),e==="OFFER"&&await i._makeAnswer()}catch(o){s.emitError(Wt.WebRTC,o),Ce.log("Failed to setRemoteDescription, ",o)}}async handleCandidate(e){Ce.log("handleCandidate:",e);try{await this.connection.peerConnection.addIceCandidate(e),Ce.log(`Added ICE candidate for:${this.connection.peer}`)}catch(n){this.connection.provider.emitError(Wt.WebRTC,n),Ce.log("Failed to handleCandidate, ",n)}}_addTracksToConnection(e,n){if(Ce.log(`add tracks from stream ${e.id} to peer connection`),!n.addTrack)return Ce.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(r=>{n.addTrack(r,e)})}_addStreamToMediaConnection(e,n){Ce.log(`add stream ${e.id} to media connection ${n.connectionId}`),n.addStream(e)}}class QS extends B0.EventEmitter{emitError(e,n){Ce.error("Error:",n),this.emit("error",new FL(`${e}`,n))}}class FL extends Error{constructor(e,n){typeof n=="string"?super(n):(super(),Object.assign(this,n)),this.type=e}}class JS extends QS{get open(){return this._open}constructor(e,n,r){super(),this.peer=e,this.provider=n,this.options=r,this._open=!1,this.metadata=r.metadata}}var Wp;const Za=class Za extends JS{get type(){return Ws.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(e,n,r){super(e,n,r),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||Za.ID_PREFIX+Pn.randomToken(),this._negotiator=new XS(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{Ce.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{Ce.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(e){Ce.log("Receiving stream",e),this._remoteStream=e,super.emit("stream",e)}handleMessage(e){const n=e.type,r=e.payload;switch(e.type){case gn.Answer:this._negotiator.handleSDP(n,r.sdp),this._open=!0;break;case gn.Candidate:this._negotiator.handleCandidate(r.candidate);break;default:Ce.warn(`Unrecognized message type:${n} from peer:${this.peer}`);break}}answer(e,n={}){if(this._localStream){Ce.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=e,n&&n.sdpTransform&&(this.options.sdpTransform=n.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:e});const r=this.provider._getMessages(this.connectionId);for(const s of r)this.handleMessage(s);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit("close"))}};Wp=new WeakMap,ha(Za,Wp,Za.ID_PREFIX="mc_");let du=Za;class UL{constructor(e){this._options=e}_buildRequest(e){const n=this._options.secure?"https":"http",{host:r,port:s,path:i,key:o}=this._options,l=new URL(`${n}://${r}:${s}${i}${o}/${e}`);return l.searchParams.set("ts",`${Date.now()}${Math.random()}`),l.searchParams.set("version",KS),fetch(l.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{const e=await this._buildRequest("id");if(e.status!==200)throw new Error(`Error. Status:${e.status}`);return e.text()}catch(e){Ce.error("Error retrieving ID",e);let n="";throw this._options.path==="/"&&this._options.host!==Pn.CLOUD_HOST&&(n=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+n)}}async listAllPeers(){try{const e=await this._buildRequest("peers");if(e.status!==200){if(e.status===401){let n="";throw this._options.host===Pn.CLOUD_HOST?n="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":n="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+n)}throw new Error(`Error. Status:${e.status}`)}return e.json()}catch(e){throw Ce.error("Error retrieving list peers",e),new Error("Could not get list peers from the server."+e)}}}var Gp,Vp;const hi=class hi extends JS{get type(){return Ws.Data}constructor(e,n,r){super(e,n,r),this.connectionId=this.options.connectionId||hi.ID_PREFIX+VS(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new XS(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{Ce.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=n=>{Ce.log(`DC#${this.connectionId} dc onmessage:`,n.data)},this.dataChannel.onclose=()=>{Ce.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(e){if(e!=null&&e.flush){this.send({__peerData:{type:"close"}});return}this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null),this.open&&(this._open=!1,super.emit("close"))}send(e,n=!1){if(!this.open){this.emitError(z0.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.");return}return this._send(e,n)}async handleMessage(e){const n=e.payload;switch(e.type){case gn.Answer:await this._negotiator.handleSDP(e.type,n.sdp);break;case gn.Candidate:await this._negotiator.handleCandidate(n.candidate);break;default:Ce.warn("Unrecognized message type:",e.type,"from peer:",this.peer);break}}};Gp=new WeakMap,Vp=new WeakMap,ha(hi,Gp,hi.ID_PREFIX="dc_"),ha(hi,Vp,hi.MAX_BUFFERED_AMOUNT=8388608);let uu=hi;class H0 extends uu{get bufferSize(){return this._bufferSize}_initializeDataChannel(e){super._initializeDataChannel(e),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",n=>this._handleDataMessage(n))}_bufferedSend(e){(this._buffering||!this._trySend(e))&&(this._buffer.push(e),this._bufferSize=this._buffer.length)}_trySend(e){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>uu.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(e)}catch(n){return Ce.error(`DC#:${this.connectionId} Error when sending:`,n),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open||this._buffer.length===0)return;const e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(e){if(e!=null&&e.flush){this.send({__peerData:{type:"close"}});return}this._buffer=[],this._bufferSize=0,super.close()}constructor(...e){super(...e),this._buffer=[],this._bufferSize=0,this._buffering=!1}}class _h extends H0{close(e){super.close(e),this._chunkedData={}}constructor(e,n,r){super(e,n,r),this.chunker=new GS,this.serialization=Xu.Binary,this._chunkedData={}}_handleDataMessage({data:e}){const n=dS(e),r=n.__peerData;if(r){if(r.type==="close"){this.close();return}this._handleChunk(n);return}this.emit("data",n)}_handleChunk(e){const n=e.__peerData,r=this._chunkedData[n]||{data:[],count:0,total:e.total};if(r.data[e.n]=new Uint8Array(e.data),r.count++,this._chunkedData[n]=r,r.total===r.count){delete this._chunkedData[n];const s=PL(r.data);this._handleDataMessage({data:s})}}_send(e,n){const r=uS(e);if(r instanceof Promise)return this._send_blob(r);if(!n&&r.byteLength>this.chunker.chunkedMTU){this._sendChunks(r);return}this._bufferedSend(r)}async _send_blob(e){const n=await e;if(n.byteLength>this.chunker.chunkedMTU){this._sendChunks(n);return}this._bufferedSend(n)}_sendChunks(e){const n=this.chunker.chunk(e);Ce.log(`DC#${this.connectionId} Try to send ${n.length} chunks...`);for(const r of n)this.send(r,!0)}}class BL extends H0{_handleDataMessage({data:e}){super.emit("data",e)}_send(e,n){this._bufferedSend(e)}constructor(...e){super(...e),this.serialization=Xu.None}}class zL extends H0{_handleDataMessage({data:e}){const n=this.parse(this.decoder.decode(e)),r=n.__peerData;if(r&&r.type==="close"){this.close();return}this.emit("data",n)}_send(e,n){const r=this.encoder.encode(this.stringify(e));if(r.byteLength>=Pn.chunkedMTU){this.emitError(z0.MessageToBig,"Message too big for JSON channel");return}this._bufferedSend(r)}constructor(...e){super(...e),this.serialization=Xu.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}var Yp;const el=class el extends QS{get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){const e=Object.create(null);for(const[n,r]of this._connections)e[n]=r;return e}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(e,n){super(),this._serializers={raw:BL,json:zL,binary:_h,"binary-utf8":_h,default:_h},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map;let r;if(e&&e.constructor==Object?n=e:e&&(r=e.toString()),n={debug:0,host:Pn.CLOUD_HOST,port:Pn.CLOUD_PORT,path:"/",key:el.DEFAULT_KEY,token:Pn.randomToken(),config:Pn.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...n},this._options=n,this._serializers={...this._serializers,...this.options.serializers},this._options.host==="/"&&(this._options.host=window.location.hostname),this._options.path&&(this._options.path[0]!=="/"&&(this._options.path="/"+this._options.path),this._options.path[this._options.path.length-1]!=="/"&&(this._options.path+="/")),this._options.secure===void 0&&this._options.host!==Pn.CLOUD_HOST?this._options.secure=Pn.isSecure():this._options.host==Pn.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&Ce.setLogFunction(this._options.logFunction),Ce.logLevel=this._options.debug||0,this._api=new UL(n),this._socket=this._createServerConnection(),!Pn.supports.audioVideo&&!Pn.supports.data){this._delayedAbort(Wt.BrowserIncompatible,"The current browser does not support WebRTC");return}if(r&&!Pn.validateId(r)){this._delayedAbort(Wt.InvalidID,`ID "${r}" is invalid`);return}r?this._initialize(r):this._api.retrieveId().then(s=>this._initialize(s)).catch(s=>this._abort(Wt.ServerError,s))}_createServerConnection(){const e=new $L(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return e.on(As.Message,n=>{this._handleMessage(n)}),e.on(As.Error,n=>{this._abort(Wt.SocketError,n)}),e.on(As.Disconnected,()=>{this.disconnected||(this.emitError(Wt.Network,"Lost connection to server."),this.disconnect())}),e.on(As.Close,()=>{this.disconnected||this._abort(Wt.SocketClosed,"Underlying socket is already closed.")}),e}_initialize(e){this._id=e,this.socket.start(e,this._options.token)}_handleMessage(e){const n=e.type,r=e.payload,s=e.src;switch(n){case gn.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case gn.Error:this._abort(Wt.ServerError,r.msg);break;case gn.IdTaken:this._abort(Wt.UnavailableID,`ID "${this.id}" is taken`);break;case gn.InvalidKey:this._abort(Wt.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case gn.Leave:Ce.log(`Received leave message from ${s}`),this._cleanupPeer(s),this._connections.delete(s);break;case gn.Expire:this.emitError(Wt.PeerUnavailable,`Could not connect to peer ${s}`);break;case gn.Offer:{const i=r.connectionId;let o=this.getConnection(s,i);if(o&&(o.close(),Ce.warn(`Offer received for existing Connection ID:${i}`)),r.type===Ws.Media){const c=new du(s,this,{connectionId:i,_payload:r,metadata:r.metadata});o=c,this._addConnection(s,o),this.emit("call",c)}else if(r.type===Ws.Data){const c=new this._serializers[r.serialization](s,this,{connectionId:i,_payload:r,metadata:r.metadata,label:r.label,serialization:r.serialization,reliable:r.reliable});o=c,this._addConnection(s,o),this.emit("connection",c)}else{Ce.warn(`Received malformed connection type:${r.type}`);return}const l=this._getMessages(i);for(const c of l)o.handleMessage(c);break}default:{if(!r){Ce.warn(`You received a malformed message from ${s} of type ${n}`);return}const i=r.connectionId,o=this.getConnection(s,i);o&&o.peerConnection?o.handleMessage(e):i?this._storeMessage(i,e):Ce.warn("You received an unrecognized message:",e);break}}}_storeMessage(e,n){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(n)}_getMessages(e){const n=this._lostMessages.get(e);return n?(this._lostMessages.delete(e),n):[]}connect(e,n={}){if(n={serialization:"default",...n},this.disconnected){Ce.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(Wt.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}const r=new this._serializers[n.serialization](e,this,n);return this._addConnection(e,r),r}call(e,n,r={}){if(this.disconnected){Ce.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(Wt.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!n){Ce.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}const s=new du(e,this,{...r,_stream:n});return this._addConnection(e,s),s}_addConnection(e,n){Ce.log(`add connection ${n.type}:${n.connectionId} to peerId:${e}`),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(n)}_removeConnection(e){const n=this._connections.get(e.peer);if(n){const r=n.indexOf(e);r!==-1&&n.splice(r,1)}this._lostMessages.delete(e.connectionId)}getConnection(e,n){const r=this._connections.get(e);if(!r)return null;for(const s of r)if(s.connectionId===n)return s;return null}_delayedAbort(e,n){setTimeout(()=>{this._abort(e,n)},0)}_abort(e,n){Ce.error("Aborting!"),this.emitError(e,n),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||(Ce.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))}_cleanup(){for(const e of this._connections.keys())this._cleanupPeer(e),this._connections.delete(e);this.socket.removeAllListeners()}_cleanupPeer(e){const n=this._connections.get(e);if(n)for(const r of n)r.close()}disconnect(){if(this.disconnected)return;const e=this.id;Ce.log(`Disconnect peer with ID:${e}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit("disconnected",e)}reconnect(){if(this.disconnected&&!this.destroyed)Ce.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)Ce.error("In a hurry? We're still trying to make the initial connection!");else throw new Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`)}}listAllPeers(e=n=>{}){this._api.listAllPeers().then(n=>e(n)).catch(n=>this._abort(Wt.ServerError,n))}};Yp=new WeakMap,ha(el,Yp,el.DEFAULT_KEY="peerjs");let Hp=el;var qS=Hp;class ZS{constructor(){on(this,"peer",null);on(this,"conn",null);on(this,"isHost",!1);on(this,"messageCallback",null);on(this,"connectionCallback",null);on(this,"closeCallback",null)}async connect(e){return this.peer=new qS,new Promise((n,r)=>{if(!this.peer)return r("Peer not initialized");this.peer.on("open",s=>{console.log("My Peer ID is:",s),e?(this.isHost=!1,this.connectToPeer(e),n(s)):(this.isHost=!0,this.peer.on("connection",i=>{console.log("Incoming connection..."),this.setupConnection(i)}),n(s))}),this.peer.on("error",s=>{console.error(s),r(s)})})}connectToPeer(e){if(!this.peer)return;const n=this.peer.connect(e);this.setupConnection(n)}setupConnection(e){this.conn=e,e.on("open",()=>{console.log("Connection established!"),this.connectionCallback&&this.connectionCallback()}),e.on("data",n=>{this.messageCallback&&this.messageCallback(n)}),e.on("close",()=>{console.log("Connection closed"),this.closeCallback&&this.closeCallback()}),e.on("error",n=>console.error("Connection Error:",n))}onConnection(e){this.connectionCallback=e}onClose(e){this.closeCallback=e}isConnected(){return this.conn!==null&&this.conn.open}send(e){this.conn&&this.conn.open?this.conn.send(e):console.warn("Connection not open, cannot send message")}onMessage(e){this.messageCallback=e}disconnect(){var e,n;(e=this.conn)==null||e.close(),(n=this.peer)==null||n.destroy()}}const HL=({gameMode:t,targetRoomId:e,playerClass:n,onGameStart:r,onBack:s})=>{const[i,o]=L.useState(""),[l,c]=L.useState(!1),[d,u]=L.useState(!0),[h,f]=L.useState(null),[S,k]=L.useState(!1),[w,j]=L.useState(null),[_,x]=L.useState(!1),I=L.useRef(null);L.useEffect(()=>{const z=new ZS;return I.current=z,(async()=>{try{const H=await z.connect(t==="JOIN"?e:void 0);o(H),u(!1),z.onMessage(q=>{console.log("[LobbyScreen] Received message:",q),q.type==="CLASS_INFO"&&(console.log("[LobbyScreen] Received opponent class:",q.playerClass),j(q.playerClass))}),z.onConnection(()=>{console.log("[LobbyScreen] Connection established!"),c(!0)})}catch(H){console.error("[LobbyScreen] Connection error:",H),f(H.toString()),u(!1)}})(),()=>{var H;(H=I.current)!=null&&H.isConnected()||z.disconnect()}},[t,e]),L.useEffect(()=>{l&&I.current&&!_&&(console.log("[LobbyScreen] Sending class info:",n),setTimeout(()=>{var z;(z=I.current)==null||z.send({type:"CLASS_INFO",playerClass:n}),x(!0)},100))},[l,n,_]),L.useEffect(()=>{if(l&&I.current&&w){const z=setTimeout(()=>{console.log("[LobbyScreen] Starting game with opponent class:",w),r(I.current,w)},500);return()=>clearTimeout(z)}},[l,r,w]);const p=async()=>{if(i)try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(i);else{const z=document.createElement("textarea");z.value=i,z.style.position="fixed",z.style.left="-999999px",z.style.top="-999999px",document.body.appendChild(z),z.focus(),z.select(),document.execCommand("copy"),document.body.removeChild(z)}k(!0),setTimeout(()=>k(!1),2e3)}catch(z){console.error("Failed to copy:",z),alert(`Room ID: ${i}

()`)}},D=()=>{I.current&&(I.current.disconnect(),I.current=null),s()};return a.jsxs("div",{className:"screen lobby-screen",style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",gap:"2rem"},children:[a.jsx("h1",{style:{fontSize:"2.5rem",marginBottom:"1rem",textShadow:"0 0 10px #e94560",fontFamily:"Tamanegi, sans-serif",letterSpacing:"2px"},children:t==="HOST"?"":"..."}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1.5rem",padding:"2rem",background:"rgba(0,0,0,0.3)",borderRadius:"10px",minWidth:"400px"},children:[h&&a.jsxs("div",{style:{color:"#ff6b6b",fontSize:"1.2rem",textAlign:"center",fontFamily:"Tamanegi, sans-serif"},children:[a.jsx("p",{children:""}),a.jsx("p",{style:{fontSize:"0.9rem",opacity:.7},children:h})]}),d&&!h&&a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1rem"},children:[a.jsx("div",{className:"loading-spinner",style:{width:"50px",height:"50px",border:"4px solid rgba(233, 69, 96, 0.3)",borderTop:"4px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),a.jsx("p",{style:{opacity:.8,fontFamily:"Tamanegi, sans-serif"},children:t==="HOST"?"...":"..."})]}),t==="HOST"&&i&&!d&&!l&&!h&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.5rem"},children:[a.jsx("p",{style:{fontSize:"1rem",opacity:.7,fontFamily:"Tamanegi, sans-serif"},children:"ID:"}),a.jsx("div",{style:{fontSize:"2rem",fontFamily:"monospace",fontWeight:"bold",padding:"0.5rem 1rem",background:"rgba(233, 69, 96, 0.2)",borderRadius:"8px",border:"1px solid #e94560",letterSpacing:"2px"},children:i})]}),a.jsx("button",{onClick:p,style:{fontSize:"1rem",padding:"0.8rem 2rem",background:S?"#48bb78":"transparent",border:"2px solid "+(S?"#48bb78":"#e94560"),color:"#fff",cursor:"pointer",transition:"all 0.3s",borderRadius:"4px",fontWeight:"bold",fontFamily:"Tamanegi, sans-serif"},children:S?" ":"ID"}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginTop:"1rem",opacity:.7},children:[a.jsx("div",{className:"loading-spinner",style:{width:"20px",height:"20px",border:"2px solid rgba(233, 69, 96, 0.3)",borderTop:"2px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),a.jsx("span",{style:{fontFamily:"Tamanegi, sans-serif"},children:"..."})]})]}),t==="JOIN"&&!d&&!l&&!h&&a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[a.jsx("div",{className:"loading-spinner",style:{width:"20px",height:"20px",border:"2px solid rgba(233, 69, 96, 0.3)",borderTop:"2px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),a.jsxs("span",{style:{fontFamily:"Tamanegi, sans-serif"},children:[" ",e," ..."]})]}),l&&a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1rem"},children:[a.jsx("p",{style:{fontSize:"1.5rem",color:"#48bb78",fontFamily:"Tamanegi, sans-serif"},children:" "}),a.jsx("p",{style:{fontFamily:"Tamanegi, sans-serif"},children:"..."})]}),a.jsxs("div",{style:{marginTop:"1rem",padding:"0.5rem 1rem",background:"rgba(255,255,255,0.1)",borderRadius:"4px",fontSize:"0.9rem",opacity:.7,fontFamily:"Tamanegi, sans-serif"},children:[": ",n==="SENKA"?"":n==="AJA"?"":"yoRuka"]})]}),a.jsx("button",{onClick:D,style:{fontSize:"1rem",padding:"0.8rem 2rem",background:"transparent",border:"1px solid #888",color:"#888",cursor:"pointer",transition:"all 0.3s",borderRadius:"4px",marginTop:"1rem",fontFamily:"Tamanegi, sans-serif"},onMouseOver:z=>{z.currentTarget.style.color="#fff",z.currentTarget.style.borderColor="#fff"},onMouseOut:z=>{z.currentTarget.style.color="#888",z.currentTarget.style.borderColor="#888"},children:" "}),a.jsx("style",{children:`
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `})]})};class WL{constructor(){on(this,"myEntryRef",null);on(this,"listenerUnsubscribe",null);on(this,"myId","");on(this,"myPeerId","");on(this,"hasMatched",!1)}async startMatchmaking(e,n,r,s,i,o,l,c){this.myPeerId=e,this.hasMatched=!1;const d=Rr(Ar,`matchmaking/${s}`);try{const u=await Wu(d),h=[];if(u.exists()&&u.forEach(w=>{const j=w.val(),_=Date.now()-j.timestamp<5*60*1e3;j.peerId!==e&&_&&h.push({key:w.key,data:j})}),h.length>0){const w=h.sort((j,_)=>j.data.timestamp-_.data.timestamp)[0];await Fc(Rr(Ar,`matchmaking/${s}/${w.key}`)),i("matched"),o({peerId:w.data.peerId,playerName:w.data.playerName,playerClass:w.data.playerClass,isHost:!1,playerId:w.data.playerId,rating:w.data.rating});return}i("searching");const f=CA(d);this.myEntryRef=f,this.myId=f.key;const S={id:this.myId,peerId:e,playerName:n,playerClass:r,matchType:s,...l!=null&&{playerId:l},...c!=null&&{rating:c},timestamp:Date.now()};await Hu(f,S),TA(f).remove();const k=s;this.listenerUnsubscribe=TE(d,async w=>{if(this.hasMatched||!w.exists())return;let j=!1,_=null;if(w.forEach(x=>{const I=x.val();x.key===this.myId?j=!0:I.peerId!==this.myPeerId&&(!_||I.timestamp>_.data.timestamp)&&(_={key:x.key,data:I})}),!j&&this.myEntryRef){if(this.hasMatched)return;this.hasMatched=!0,i("matched"),this.cleanup();return}if(_!==null&&j){const x=w.child(this.myId).val(),I=_;if(x&&x.timestamp<I.data.timestamp){if(this.hasMatched)return;this.hasMatched=!0,await Fc(Rr(Ar,`matchmaking/${k}/${I.key}`)),await Fc(Rr(Ar,`matchmaking/${k}/${this.myId}`)),this.cleanup(),i("matched"),o({peerId:I.data.peerId,playerName:I.data.playerName,playerClass:I.data.playerClass,isHost:!0,playerId:I.data.playerId,rating:I.data.rating})}}})}catch(u){console.error("[Matchmaking] Error:",u),i("error"),this.cleanup()}}async cancelMatchmaking(){if(this.myEntryRef)try{await Fc(this.myEntryRef)}catch(e){console.error("[Matchmaking] Error removing entry:",e)}this.cleanup()}cleanup(){this.listenerUnsubscribe&&(this.listenerUnsubscribe(),this.listenerUnsubscribe=null),this.myEntryRef=null,this.myId=""}}const zc=new WL;class E_{constructor(e,n,r=!1){on(this,"peer");on(this,"conn");on(this,"isHost",!1);on(this,"messageCallback",null);on(this,"closeCallback",null);this.peer=e,this.conn=n,this.isHost=r,n.on("data",s=>{this.messageCallback&&this.messageCallback(s)}),n.on("close",()=>{console.log("[PeerJSAdapter] Connection closed"),this.closeCallback&&this.closeCallback()}),n.on("error",s=>console.error("[PeerJSAdapter] Connection Error:",s))}async connect(e){return this.peer.id}onConnection(e){}onClose(e){this.closeCallback=e}isConnected(){return this.conn!==null&&this.conn.open}send(e){this.conn&&this.conn.open?this.conn.send(e):console.warn("[PeerJSAdapter] Connection not open, cannot send message")}onMessage(e){this.messageCallback=e}disconnect(){var e,n;(e=this.conn)==null||e.close(),(n=this.peer)==null||n.destroy()}}const GL=1280,VL=720,S_={BRONZE:"#cd7f32",SILVER:"#c0c0c0",GOLD:"#ffd700",PLATINUM:"#e5e4e2",DIAMOND:"#b9f2ff",MASTER:"#ff4500"},YL=({matchType:t,playerClass:e,playerName:n,playerId:r,onGameStart:s,onCancel:i})=>{const[o,l]=L.useState("idle"),[c,d]=L.useState("..."),[u,h]=L.useState(0),f=L.useRef(null),S=L.useRef(null),k=L.useRef(null),w=L.useRef(!1),j=L.useRef(!1),[_,x]=L.useState(0),[I,p]=L.useState(void 0),[D,z]=L.useState(1);L.useEffect(()=>{const q=()=>{const ue=window.innerWidth/GL,ye=window.innerHeight/VL;z(Math.min(ue,ye))};return q(),window.addEventListener("resize",q),()=>window.removeEventListener("resize",q)},[]),L.useEffect(()=>{if(o!=="searching")return;const q=setInterval(()=>{h(ue=>{const ye=ue+1;return ye>=60&&(l("error"),d(""),zc.cancelMatchmaking(),S.current&&S.current.close(),f.current&&f.current.destroy()),ye})},1e3);return()=>clearInterval(q)},[o]),L.useEffect(()=>{let q=!0,ue=0;return(async()=>{try{if(t==="ranked"&&r)try{ue=(await cS(r,e)).rating,x(ue)}catch(re){console.error("[Matchmaking] Failed to get rating:",re)}const Me=new qS({debug:1,config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]}});if(f.current=Me,await new Promise((re,P)=>{Me.on("open",()=>re()),Me.on("error",C=>P(C))}),!q)return;const fe=Me.id;console.log("[Matchmaking] My PeerJS ID:",fe),Me.on("connection",re=>{console.log("[Matchmaking] Incoming connection from:",re.peer),S.current=re,re.on("open",()=>{console.log("[Matchmaking] Connection opened (as HOST)"),re.on("data",P=>{if(P.type==="PLAYER_INFO"){console.log("[Matchmaking] Received player info:",P),re.send({type:"PLAYER_INFO",playerName:n,playerClass:e,playerId:t==="ranked"?r:void 0,rating:t==="ranked"?ue:void 0}),q&&t==="ranked"&&p(P.rating),j.current=!0;const C=new E_(Me,re,!0);s(C,P.playerClass,!0,P.playerId,P.rating)}})})}),zc.startMatchmaking(fe,n,e,t,re=>{if(q)switch(l(re),re){case"searching":d("...");break;case"matched":d("...");break;case"error":d("");break}},async re=>{if(q)if(console.log("[Matchmaking] Match found:",re),k.current=re,w.current=re.isHost,re.isHost)d("...");else{d("...");const P=Me.connect(re.peerId,{reliable:!0});S.current=P,P.on("open",()=>{console.log("[Matchmaking] Connection opened (as JOIN)"),P.send({type:"PLAYER_INFO",playerName:n,playerClass:e,playerId:t==="ranked"?r:void 0,rating:t==="ranked"?ue:void 0}),P.on("data",C=>{if(C.type==="PLAYER_INFO"){console.log("[Matchmaking] Received player info:",C),q&&t==="ranked"&&p(C.rating),j.current=!0;const R=new E_(Me,P,!1);s(R,C.playerClass,!1,C.playerId,C.rating)}})}),P.on("error",C=>{console.error("[Matchmaking] Connection error:",C),l("error"),d("")})}},t==="ranked"&&r?r:void 0,t==="ranked"?ue:void 0)}catch(Me){console.error("[Matchmaking] Init error:",Me),q&&(l("error"),d(""))}})(),()=>{q=!1,zc.cancelMatchmaking(),j.current||(S.current&&S.current.close(),f.current&&f.current.destroy())}},[t,e,n,r,s]);const te=async()=>{await zc.cancelMatchmaking(),S.current&&S.current.close(),f.current&&f.current.destroy(),i()},H=q=>{const ue=Math.floor(q/60),ye=q%60;return`${ue}:${ye.toString().padStart(2,"0")}`};return a.jsxs("div",{className:"screen",style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white"},children:[a.jsx("div",{style:{fontSize:`${1.2*D}rem`,color:"#4ade80",marginBottom:`${1*D}rem`,fontWeight:"bold"},children:t==="casual"?"":""}),a.jsx("div",{style:{fontSize:`${2*D}rem`,fontWeight:"bold",marginBottom:`${1*D}rem`,textAlign:"center"},children:c}),o==="searching"&&a.jsxs("div",{style:{fontSize:`${1.5*D}rem`,color:"#888",marginBottom:`${2*D}rem`},children:[": ",H(u)]}),(o==="searching"||o==="matched")&&a.jsx("div",{style:{width:80*D,height:80*D,border:"4px solid rgba(255,255,255,0.2)",borderTop:"4px solid #4ade80",borderRadius:"50%",animation:"spin 1s linear infinite",marginBottom:`${2*D}rem`}}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*D}rem`,marginBottom:`${2*D}rem`,padding:`${1*D}rem`,background:"rgba(255,255,255,0.1)",borderRadius:8*D},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:`${1*D}rem`},children:[a.jsx("div",{style:{fontSize:`${1*D}rem`},children:n||""}),a.jsx("div",{style:{fontSize:`${.9*D}rem`,color:e==="SENKA"?"#e94560":e==="AJA"?"#45a2e9":"#a855f7"},children:e==="SENKA"?"":e==="AJA"?"":"Y"})]}),t==="ranked"&&_>0&&a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:`${.5*D}rem`,fontSize:`${.85*D}rem`,color:"#aaa"},children:[a.jsx("span",{style:{fontWeight:"bold",color:S_[Pr(_)],fontFamily:"Tamanegi, sans-serif"},children:ko[Pr(_)]}),a.jsx("span",{style:{fontFamily:"Tamanegi, sans-serif"},children:_})]}),t==="ranked"&&o==="matched"&&I!==void 0&&a.jsxs("div",{style:{marginTop:`${.5*D}rem`,padding:`${.5*D}rem ${1*D}rem`,background:"rgba(0, 0, 0, 0.3)",borderRadius:4*D,fontSize:`${.8*D}rem`,color:"#aaa"},children:[": ",a.jsx("span",{style:{fontWeight:"bold",color:S_[Pr(I)],fontFamily:"Tamanegi, sans-serif"},children:ko[Pr(I)]})," ",I]})]}),o!=="error"&&a.jsx("button",{onClick:te,style:{padding:`${.8*D}rem ${2*D}rem`,fontSize:`${1*D}rem`,background:"transparent",border:"2px solid #e94560",color:"#e94560",borderRadius:8*D,cursor:"pointer",transition:"all 0.2s"},onMouseOver:q=>{q.currentTarget.style.background="#e94560",q.currentTarget.style.color="white"},onMouseOut:q=>{q.currentTarget.style.background="transparent",q.currentTarget.style.color="#e94560"},children:""}),o==="error"&&a.jsx("button",{onClick:i,style:{padding:`${.8*D}rem ${2*D}rem`,fontSize:`${1*D}rem`,background:"#e94560",border:"none",color:"white",borderRadius:8*D,cursor:"pointer"},children:""}),a.jsx("style",{children:`
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `})]})},KL=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},eo=({card:t,onClick:e,style:n,isSelected:r,isPlayable:s,variant:i="normal",turnCount:o,isOnBoard:l,isSpecialSummoning:c,className:d,suppressPassives:u,isMyTurn:h,scale:f=1})=>{const S="currentAttack"in t?t.currentAttack:t.attack,k="currentHealth"in t?t.currentHealth:t.health,w="maxHealth"in t?t.maxHealth:t.health,j="canAttack"in t?t.canAttack:!1,_="turnPlayed"in t?t.turnPlayed:void 0,[x,I]=N.useState(!1);N.useEffect(()=>{if(c&&l){I(!0);const y=setTimeout(()=>I(!1),800);return()=>clearTimeout(y)}},[c,l]);const p="baseAttack"in t?t.baseAttack:void 0,D="baseHealth"in t?t.baseHealth:void 0,z=p!==void 0&&S>p,te=D!==void 0&&(k>D||w>D),H="hasEvolved"in t?t.hasEvolved:!1,q="evolvedImageUrl"in t?t.evolvedImageUrl:void 0,ue=H&&q?q:t.imageUrl,ye=ue?KL(ue):void 0;let Me=n==null?void 0:n.boxShadow,fe;const re=t.passiveAbilities||t.abilities||[],P=re.includes("WARD"),C=re.includes("AURA"),R=re.includes("STEALTH"),v=t.hasBarrier===!0||re.includes("BARRIER")&&t.hasBarrier!==!1;if(r)Me="0 0 15px rgba(255, 255, 255, 0.8)";else if(s)Me="0 0 10px #48bb78",fe="2px solid #48bb78";else if(j&&h){const y=re.includes("STORM"),X=re.includes("RUSH"),F=o!==void 0&&_!==void 0&&_===o;let ve=!1;y||(F?ve=!0:(o===void 0||_===void 0)&&(ve=X)),ve?Me="0 0 10px #f6e05e":Me="0 0 10px #48bb78"}const g=k<w;if(i==="art-only")return a.jsx("div",{className:"card art-only",style:{width:140,height:200,...n,borderRadius:8,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",background:"#2d3748",position:"relative",boxShadow:"0 4px 6px rgba(0,0,0,0.3)"},children:ye?a.jsx("img",{src:ye,alt:t.name,draggable:!1,style:{width:"100%",height:"100%",objectFit:"cover"}}):a.jsx("div",{style:{fontSize:"1.5rem",opacity:.5,color:"white",fontWeight:"bold"},children:t.type})});if(i==="mobile-hand"){const X=t.type==="SPELL"?16:6,F=28*f,ve=.85*f;return a.jsxs("div",{className:`card mobile-hand ${d||""}`,style:{width:80,height:115,...n,position:"relative",cursor:e?"pointer":"default",transform:r?"translateY(-8px)":n==null?void 0:n.transform,boxShadow:Me||(n==null?void 0:n.boxShadow),border:fe||(s?"2px solid #48bb78":void 0),transition:"transform 0.2s, box-shadow 0.2s",background:"#1a202c",overflow:"hidden",borderRadius:`${X}px ${X}px 6px 6px`,backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},onClick:e,children:[a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"hidden",borderRadius:`${X}px ${X}px 6px 6px`},children:ye?a.jsx("img",{src:ye,alt:t.name,draggable:!1,style:{width:"100%",height:"100%",objectFit:"cover"}}):a.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"#4a5568",color:"#a0aec0",fontSize:"0.6rem"},children:t.type})}),a.jsxs("div",{style:{position:"absolute",top:3,left:4,display:"flex",flexDirection:"column",gap:2,zIndex:10},children:[a.jsx("div",{style:{width:F,height:F,borderRadius:"50%",background:"#48bb78",border:"1px solid rgba(255,255,255,0.8)",color:"white",fontSize:`${ve}rem`,fontWeight:900,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.6)"},children:t.cost}),t.type==="FOLLOWER"&&a.jsxs("div",{style:{width:F,height:F,display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[a.jsx("svg",{width:F,height:F,viewBox:"0 0 24 24",fill:"none",style:{position:"absolute",filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.8))"},children:a.jsx("polygon",{points:"12,2 22,22 2,22",fill:"#4299e1",stroke:"rgba(255,255,255,0.8)",strokeWidth:"1",strokeLinejoin:"round"})}),a.jsx("span",{style:{zIndex:1,color:z?"#faf089":"white",fontWeight:"bold",fontSize:`${ve}rem`,textShadow:"0 1px 2px black"},children:S})]}),t.type==="FOLLOWER"&&a.jsxs("div",{style:{width:F,height:F,display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[a.jsx("svg",{width:F,height:F,viewBox:"0 0 24 24",style:{position:"absolute",filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.8))"},children:a.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z",fill:"#c53030",stroke:"rgba(255,255,255,0.8)",strokeWidth:"1"})}),a.jsx("span",{style:{zIndex:1,color:te?"#faf089":g?"#fc8181":"white",fontWeight:"bold",fontSize:`${ve}rem`,textShadow:"0 1px 2px black"},children:k})]})]})]})}const T=t.type==="SPELL"&&!l,A=T?20:8;return a.jsxs("div",{className:`card card-container ${j?"ready":""} ${l?"on-board":""} ${d||""}`,style:{width:140,height:200,...n,position:"relative",cursor:e?"pointer":"default",transform:r?"translateY(-10px)":n==null?void 0:n.transform,boxShadow:Me||(j?"0 0 10px #f6e05e":n==null?void 0:n.boxShadow),border:fe||(s?"2px solid #48bb78":void 0),transition:"transform 0.2s, box-shadow 0.2s",display:"flex",flexDirection:"column",background:"#1a202c",overflow:"visible",animation:x?"cardSummonAppear 0.8s cubic-bezier(0.22, 1, 0.36, 1) forwards":n==null?void 0:n.animation,backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",borderRadius:T?`${A}px ${A}px 8px 8px`:"8px"},onClick:e,children:[!l&&a.jsx("div",{style:{height:20,background:"rgba(0,0,0,0.8)",color:"#e2e8f0",fontSize:t.name.length>10?"0.6rem":"0.7rem",fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid rgba(255,255,255,0.2)",zIndex:2,transform:t.name.length>15?"scaleX(0.9)":"none",borderRadius:T?`${A}px ${A}px 0 0`:"8px 8px 0 0"},children:t.name}),a.jsxs("div",{style:{flex:1,position:"relative",width:"100%",background:"#2d3748",borderRadius:l?"8px":"0 0 8px 8px",minHeight:0},children:[a.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"hidden",borderRadius:l?"8px":"0 0 8px 8px",zIndex:1},children:[ye?a.jsx("img",{src:ye,alt:t.name,draggable:!1,style:{width:"100%",height:"100%",objectFit:"cover",display:"block"}}):a.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"#4a5568",color:"#a0aec0",fontSize:"0.8rem"},children:t.type}),a.jsx("div",{style:{position:"absolute",bottom:0,left:0,width:"100%",height:40,background:"linear-gradient(to top, rgba(0,0,0,0.8), transparent)",pointerEvents:"none",zIndex:3}})]}),!l&&a.jsx("div",{style:{position:"absolute",top:2*f,left:2*f,width:24*f,height:24*f,borderRadius:"50%",background:"#48bb78",border:`${Math.max(1,2*f)}px solid #fff`,color:"white",fontSize:`${.9*f}rem`,fontWeight:900,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 2px 4px rgba(0,0,0,0.5), inset 0 2px 5px rgba(255,255,255,0.3)",zIndex:10},children:t.cost}),t.type==="FOLLOWER"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{position:"absolute",bottom:l?2*f:40*f,left:2*f,width:32*f,height:32*f,zIndex:10,display:"flex",alignItems:"center",justifyContent:"center"},children:[a.jsxs("svg",{width:40*f,height:40*f,viewBox:"0 0 24 24",fill:"none",style:{position:"absolute",filter:"drop-shadow(0 2px 2px rgba(0,0,0,0.8))"},children:[a.jsx("defs",{children:a.jsxs("linearGradient",{id:"blueGrad",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[a.jsx("stop",{offset:"0%",stopColor:"#63b3ed"}),a.jsx("stop",{offset:"100%",stopColor:"#4299e1"})]})}),a.jsx("polygon",{points:"12,2 22,22 2,22",fill:"url(#blueGrad)",stroke:"white",strokeWidth:"1",strokeLinejoin:"round"})]}),a.jsx("span",{style:{zIndex:11,color:z?"#faf089":"white",fontWeight:"bold",fontSize:`${1.2*f}rem`,textShadow:"0 2px 2px black"},children:S})]}),a.jsxs("div",{style:{position:"absolute",bottom:2*f,right:l?2*f:"auto",left:l?"auto":2*f,width:32*f,height:32*f,zIndex:10,display:"flex",alignItems:"center",justifyContent:"center"},children:[a.jsxs("svg",{width:36*f,height:36*f,viewBox:"0 0 24 24",style:{position:"absolute",filter:"drop-shadow(0 2px 2px rgba(0,0,0,0.8))"},children:[a.jsx("defs",{children:a.jsxs("linearGradient",{id:"redGrad",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[a.jsx("stop",{offset:"0%",stopColor:"#f56565"}),a.jsx("stop",{offset:"100%",stopColor:"#c53030"})]})}),a.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z",fill:"url(#redGrad)",stroke:"white",strokeWidth:"1.5"})]}),a.jsx("span",{style:{zIndex:11,color:te?"#faf089":g?"#fc8181":"white",fontWeight:"bold",fontSize:`${1.2*f}rem`,textShadow:"0 2px 2px black"},children:k})]})]}),l&&a.jsx("div",{style:{position:"absolute",top:-6*f,left:-6*f,right:-6*f,bottom:-6*f,zIndex:50,pointerEvents:"none",opacity:P&&!u?1:0,transition:"opacity 0.2s ease-in-out"},children:a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,animation:"wardPulseLoop 2.5s infinite ease-in-out"},children:a.jsxs("svg",{viewBox:"0 0 100 120",preserveAspectRatio:"none",style:{width:"100%",height:"100%"},children:[a.jsx("defs",{children:a.jsxs("filter",{id:"wardGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{stdDeviation:"2",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsx("path",{d:"M50 2 L96 20 V60 C96 90 50 116 50 116 C50 116 4 90 4 60 V20 Z",fill:"rgba(255, 255, 255, 0.12)",stroke:"#ECC94B",strokeWidth:"3",filter:"url(#wardGlow)"})]})})}),l&&a.jsxs("div",{style:{position:"absolute",top:-5*f,left:-5*f,right:-5*f,bottom:-5*f,zIndex:21,pointerEvents:"none",opacity:v&&!x&&!u?1:0,transition:"opacity 0.2s ease-in-out"},children:[a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,borderRadius:"50%",background:"radial-gradient(ellipse at center, rgba(99, 179, 237, 0.12) 0%, transparent 60%)",animation:"barrierGlowLoop 3s infinite ease-in-out"}}),a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,borderRadius:"50%",border:`${Math.max(1.5,2*f)}px solid rgba(99, 179, 237, 0.9)`,boxShadow:"0 0 6px rgba(66, 153, 225, 0.5), inset 0 0 8px rgba(99, 179, 237, 0.15)",animation:"barrierPulseLoop 3s infinite ease-in-out"}})]}),l&&a.jsx("div",{style:{position:"absolute",top:-6*f,left:-6*f,right:-6*f,bottom:-6*f,zIndex:22,pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center",opacity:C&&!x&&!u?1:0,transition:"opacity 0.2s ease-in-out"},children:a.jsx("div",{style:{width:"100%",height:"100%",position:"relative",animation:"auraPulseLoop 3s infinite ease-in-out"},children:a.jsxs("svg",{viewBox:"0 0 100 100",style:{width:"100%",height:"100%"},children:[a.jsx("defs",{children:a.jsxs("filter",{id:"auraGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{stdDeviation:"1.5",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsx("path",{d:"M40 5 L60 5 L60 30 L95 30 L95 45 L60 45 L60 95 L40 95 L40 45 L5 45 L5 30 L40 30 Z",fill:"rgba(255, 204, 0, 0.2)",stroke:"#f6ad55",strokeWidth:"2.5",filter:"url(#auraGlow)"})]})})}),l&&a.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:13,pointerEvents:"none",overflow:"hidden",borderRadius:"0 0 8px 8px",opacity:R&&!x&&!u?1:0,transition:"opacity 0.2s ease-in-out"},children:[a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:"120%",height:"120%",transform:"translate(-50%, -50%)",background:"radial-gradient(circle, rgba(0, 0, 0, 0.9) 0%, rgba(0, 0, 0, 0.6) 30%, rgba(0, 0, 0, 0.2) 60%, transparent 80%)",filter:"blur(10px)",animation:"stealthInkMove 3s infinite ease-in-out",mixBlendMode:"multiply"}}),a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:"100%",height:"100%",transform:"translate(-50%, -50%)",background:"radial-gradient(circle, rgba(20, 20, 30, 0.85) 0%, rgba(10, 10, 20, 0.4) 40%, transparent 70%)",filter:"blur(8px)",animation:"stealthInkPulse 1.5s infinite ease-in-out",mixBlendMode:"multiply"}}),a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:"70%",height:"70%",transform:"translate(-50%, -50%)",background:"radial-gradient(circle, rgba(255, 255, 255, 0.4) 0%, rgba(200, 200, 200, 0.25) 30%, transparent 60%)",filter:"blur(8px)",animation:"stealthMistMove 4s infinite ease-in-out",mixBlendMode:"screen"}}),a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,boxShadow:"inset 0 0 30px rgba(0, 0, 0, 0.85), 0 0 20px rgba(0, 0, 0, 0.6)",animation:"stealthPulse 1.5s infinite ease-in-out"}})]})]}),x&&a.jsx("div",{style:{position:"absolute",inset:0,borderRadius:8,background:"radial-gradient(circle, rgba(255,255,255,0.8) 0%, transparent 70%)",mixBlendMode:"overlay",animation:"cardSummonFlash 0.8s ease-out forwards",pointerEvents:"none",zIndex:100}}),a.jsx("style",{children:`
                @keyframes cardSummonAppear {
                    0% { opacity: 0; transform: scale(1.5); filter: brightness(2) blur(4px); }
                    100% { opacity: 1; transform: scale(1); filter: brightness(1) blur(0px); }
                }
                @keyframes cardSummonFlash {
                    0% { opacity: 0.8; transform: scale(1.2); }
                    100% { opacity: 0; transform: scale(1); }
                }
                @keyframes wardPulseLoop {
                    0% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(255, 255, 255, 0.5)); }
                    50% { transform: scale(1.08); opacity: 0.5; filter: blur(3px) drop-shadow(0 0 15px rgba(255, 255, 255, 0.8)); }
                    100% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(255, 255, 255, 0.5)); }
                }
                @keyframes barrierPulseLoop {
                    0% { transform: scale(1); opacity: 1; box-shadow: 0 0 8px rgba(66, 153, 225, 0.6), inset 0 0 10px rgba(99, 179, 237, 0.2); }
                    50% { transform: scale(1.03); opacity: 0.85; box-shadow: 0 0 12px rgba(99, 179, 237, 0.8), inset 0 0 15px rgba(99, 179, 237, 0.3); }
                    100% { transform: scale(1); opacity: 1; box-shadow: 0 0 8px rgba(66, 153, 225, 0.6), inset 0 0 10px rgba(99, 179, 237, 0.2); }
                }
                @keyframes barrierGlowLoop {
                    0% { transform: scale(1); opacity: 0.6; }
                    50% { transform: scale(1.05); opacity: 0.4; }
                    100% { transform: scale(1); opacity: 0.6; }
                }
                @keyframes auraPulseLoop {
                    0% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(246, 173, 85, 0.5)); }
                    50% { transform: scale(1.12); opacity: 0.4; filter: blur(4px) drop-shadow(0 0 20px rgba(255, 204, 0, 0.8)); }
                    100% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(246, 173, 85, 0.5)); }
                }
                @keyframes stealthInkMove {
                    0%, 100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 0.7; }
                    25% { transform: translate(-45%, -55%) scale(1.15) rotate(3deg); opacity: 1; }
                    50% { transform: translate(-50%, -50%) scale(0.95) rotate(0deg); opacity: 0.5; }
                    75% { transform: translate(-55%, -45%) scale(1.1) rotate(-3deg); opacity: 0.9; }
                }
                @keyframes stealthInkPulse {
                    0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.8; }
                    50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.4; }
                }
                @keyframes stealthMistMove {
                    0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.5; }
                    25% { transform: translate(-48%, -52%) scale(1.1); opacity: 0.8; }
                    50% { transform: translate(-52%, -48%) scale(1.2); opacity: 0.3; }
                    75% { transform: translate(-50%, -50%) scale(0.9); opacity: 0.7; }
                }
                @keyframes stealthPulse {
                    0%, 100% { opacity: 0.6; box-shadow: inset 0 0 50px rgba(0, 0, 0, 0.9), 0 0 30px rgba(0, 0, 0, 0.7); }
                    50% { opacity: 1; box-shadow: inset 0 0 70px rgba(0, 0, 0, 1), 0 0 40px rgba(0, 0, 0, 0.9); }
                }
                /* 3D flip support - ensure all child elements inherit backface-visibility */
                .card, .card * {
                    backface-visibility: hidden !important;
                    -webkit-backface-visibility: hidden !important;
                }
            `})]})},XL=35e5;function eI(){const[t,e]=L.useState(()=>I_());return L.useEffect(()=>{const n=()=>{e(I_())};return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),t}function I_(){const t=window.innerWidth*window.devicePixelRatio,e=window.innerHeight*window.devicePixelRatio,n=t*e,r=n>XL;let s="HD";return n>8e6?s="4K":n>35e5?s="1440p":n>2e6&&(s="1080p"),{isHighRes:r,isLightMode:r,pixelCount:n,resolution:s}}function QL(t){return t?{glowShadow:(e,n)=>`0 0 ${10*n}px ${e}`,blurAmount:4,enableGlowPulse:!1,dropShadow:e=>`drop-shadow(0 0 ${10*e}px rgba(255,255,255,0.6))`}:{glowShadow:(e,n)=>`
            0 0 ${15*n}px ${e},
            0 0 ${30*n}px ${e}80,
            0 0 ${60*n}px ${e}50
        `,blurAmount:8,enableGlowPulse:!0,dropShadow:e=>`drop-shadow(0 0 ${20*e}px rgba(255,255,255,0.8)) drop-shadow(0 0 ${40*e}px rgba(255,255,255,0.6))`}}const gd=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},Hc=t=>gd(t==="YORUKA"?"/leaders/yoRuka_leader.png":t==="AJA"?"/leaders/azya_leader.png":"/leaders/senka_leader.png"),JL=gd("/assets/VS.png"),Kn=8,xh=240,qL=({myPlayer:t,opponentPlayer:e,isFirstPlayer:n,onComplete:r,scale:s=1,onVsImpact:i,onCoinToss:o,onImpact:l,onOrbLand:c,onFadeInBoard:d,isMobile:u=!1})=>{const[h,f]=L.useState("fade-in"),[S,k]=L.useState(!1),{isLightMode:w}=eI(),j=QL(w),[_,x]=L.useState(1),[I,p]=L.useState(1),[D,z]=L.useState(0),[te,H]=L.useState(0),[q,ue]=L.useState(1),[ye,Me]=L.useState({myX:0,myY:0,opX:0,opY:0}),[fe,re]=L.useState(0),[P,C]=L.useState(0),[R,v]=L.useState([]),g=L.useMemo(()=>{const Y=window.innerWidth,Pe=window.innerHeight,xe=s,$e=(u?280:340)*xe,Te=Y-$e,Ne=$e+Te/2,mt=Ne,tt=Pe- -20*xe-xh*xe/2,st=Ne,qe=-20*xe+xh*xe/2;return{player:{x:mt,y:tt},opponent:{x:st,y:qe},leaderSize:xh*xe}},[u,s]),T=L.useMemo(()=>{const Y=window.innerWidth,Pe=window.innerHeight,xe=Y*.25,$e=Pe*.5,Te=Y*.75,Ne=Pe*.5;return{myX:xe,myY:$e,opX:Te,opY:Ne}},[]),A=w?`0 0 ${10*s}px rgba(103, 232, 249, 0.8)`:`0 0 ${15*s}px rgba(103, 232, 249, 1), 0 0 ${30*s}px rgba(34, 211, 238, 0.8), 0 0 ${60*s}px rgba(6, 182, 212, 0.5)`,y=w?`0 0 ${10*s}px rgba(249, 168, 212, 0.8)`:`0 0 ${15*s}px rgba(249, 168, 212, 1), 0 0 ${30*s}px rgba(244, 114, 182, 0.8), 0 0 ${60*s}px rgba(236, 72, 153, 0.5)`,X=j.enableGlowPulse?"glowPulse 2s ease-in-out infinite":"none";L.useEffect(()=>{const Y={"fade-in":500,"leaders-enter":1200,nameplate:800,"vs-display":1500,"coin-toss":1500,"turn-order":1e3,"leader-to-orb":800,"orb-pause":1e3,"orb-fly":900,"leader-appear":600};if(h==="complete"){d==null||d();const $e=setTimeout(()=>{r()},700);return()=>clearTimeout($e)}const Pe={"fade-in":"leaders-enter","leaders-enter":"nameplate",nameplate:"vs-display","vs-display":"coin-toss","coin-toss":"turn-order","turn-order":"leader-to-orb","leader-to-orb":"orb-pause","orb-pause":"orb-fly","orb-fly":"leader-appear","leader-appear":"complete"},xe=setTimeout(()=>{const $e=Pe[h];$e&&f($e)},Y[h]||1e3);return()=>clearTimeout(xe)},[h,r,n]),L.useEffect(()=>{if(h==="vs-display"){const Y=setTimeout(()=>{k(!0),i==null||i(),setTimeout(()=>k(!1),300)},800);return()=>clearTimeout(Y)}},[h,i]),L.useEffect(()=>{h==="coin-toss"&&(o==null||o())},[h,o]),L.useEffect(()=>{if(h==="leaders-enter"){const Y=setTimeout(()=>{l==null||l()},1e3);return()=>clearTimeout(Y)}},[h,l]),L.useEffect(()=>{h==="nameplate"&&(l==null||l())},[h,l]),L.useEffect(()=>{if(h==="leader-to-orb"){const Pe=Date.now();let xe;const $e=()=>{const Te=Date.now()-Pe,Ne=Math.min(Te/800,1),mt=1-Math.pow(1-Ne,3);x(1-mt*.7),p(1-mt),z(mt*1.5),H(Math.min(mt*1.5,1)),Ne<1&&(xe=requestAnimationFrame($e))};return Me(T),xe=requestAnimationFrame($e),()=>cancelAnimationFrame(xe)}},[h,T]),L.useEffect(()=>{if(h==="orb-pause"){const Pe=Date.now();let xe;const $e=()=>{const Te=Date.now()-Pe,Ne=Math.min(Te/800,1);ue(1-Ne),Ne<1&&(xe=requestAnimationFrame($e))};return xe=requestAnimationFrame($e),()=>cancelAnimationFrame(xe)}},[h]),L.useEffect(()=>{if(h==="orb-fly"){const Pe=Date.now();let xe;const $e=T.myX,Te=T.myY,Ne=T.opX,mt=T.opY,tt=g.player.x,st=g.player.y,qe=g.opponent.x,B=g.opponent.y,We=()=>{const ut=Date.now()-Pe,Pt=Math.min(ut/900,1),ie=Pt*Pt*Pt,He=$e-200*s,nt=(Te+st)/2+100*s,Vt=(1-ie)*(1-ie)*$e+2*(1-ie)*ie*He+ie*ie*tt,Bt=(1-ie)*(1-ie)*Te+2*(1-ie)*ie*nt+ie*ie*st,zi=Ne+200*s,Qu=(mt+B)/2-100*s,Ju=(1-ie)*(1-ie)*Ne+2*(1-ie)*ie*zi+ie*ie*qe,as=(1-ie)*(1-ie)*mt+2*(1-ie)*ie*Qu+ie*ie*B;Me({myX:Vt,myY:Bt,opX:Ju,opY:as}),z(1.5-ie*1),Pt<1&&(xe=requestAnimationFrame(We))};return xe=requestAnimationFrame(We),()=>cancelAnimationFrame(xe)}},[h,T,g,s]),L.useEffect(()=>{if(h==="leader-appear"){const Pe=Date.now();let xe;c==null||c(),k(!0),setTimeout(()=>k(!1),300);const $e=g.player.x,Te=g.player.y,Ne=g.opponent.x,mt=g.opponent.y,tt=24,st=[];for(let We=0;We<tt;We++){const ut=We/tt*360+(Math.random()-.5)*15;st.push({id:We,x:$e,y:Te,angle:ut,dist:80+Math.random()*120,size:8+Math.random()*12,delay:Math.random()*.1,color:`hsl(${200+Math.random()*40}, 80%, ${60+Math.random()*20}%)`})}for(let We=0;We<tt;We++){const ut=We/tt*360+(Math.random()-.5)*15;st.push({id:tt+We,x:Ne,y:mt,angle:ut,dist:80+Math.random()*120,size:8+Math.random()*12,delay:Math.random()*.1,color:`hsl(${0+Math.random()*30}, 80%, ${55+Math.random()*20}%)`})}v(st);const qe=setTimeout(()=>{v([])},800),B=()=>{const We=Date.now()-Pe,ut=Math.min(We/600,1),Pt=1-Math.pow(1-ut,3);H(1-Pt),re(Pt),C(Pt),ut<1&&(xe=requestAnimationFrame(B))};return xe=requestAnimationFrame(B),()=>{cancelAnimationFrame(xe),clearTimeout(qe)}}},[h,c,g]);const F=["fade-in","leaders-enter","nameplate","vs-display","coin-toss","turn-order","leader-to-orb","orb-pause","orb-fly","leader-appear","complete"].indexOf(h),ve=F>=3&&F<=9,ke=F>=0&&F<=7,Ee=`polygon(0 0, ${50+Kn}% 0, ${50-Kn}% 100%, 0 100%)`,ee=`polygon(${50+Kn}% 0, 100% 0, 100% 100%, ${50-Kn}% 100%)`;return a.jsxs("div",{style:{position:"fixed",inset:0,background:F>=7?"transparent":"#0a0a0f",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",animation:S?"screenShake 0.3s ease-in-out":void 0,pointerEvents:F>=9?"none":"auto"},children:[a.jsx("div",{style:{position:"absolute",inset:0,background:"black",opacity:h==="fade-in"?1:0,transition:"opacity 0.5s ease-out",pointerEvents:"none",zIndex:1e4}}),ke&&a.jsxs("div",{style:{opacity:q,transition:"opacity 0.3s"},children:[F>=0&&a.jsxs("div",{style:{position:"absolute",inset:0,clipPath:Ee,background:"linear-gradient(135deg, #0a1628 0%, #1a2a4a 50%, #0d1a30 100%)",transform:`translateX(${F>=1?"0":"-100%"})`,transition:"transform 1.2s cubic-bezier(0.22, 1, 0.36, 1)",zIndex:50,overflow:"hidden"},children:[a.jsx("div",{style:{position:"fixed",top:"50%",left:"25%",transform:"translate(-50%, -50%)",opacity:I},children:a.jsx("img",{src:Hc(t.class),alt:t.name,style:{height:"120vh",width:"auto",objectFit:"cover",objectPosition:t.class==="AJA"?"center top":"center",filter:"brightness(0.85) contrast(1.1)",transform:`scale(${_})`,transformOrigin:"center center"}})}),a.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(135deg, rgba(59, 130, 246, 0.3) 0%, transparent 60%)",pointerEvents:"none"}}),F>=2&&F<6&&a.jsx("div",{style:{position:"absolute",bottom:"12%",left:"15%",padding:`${16*s}px ${40*s}px`,background:"rgba(0,0,0,0.85)",borderRadius:8*s,borderLeft:"4px solid #3b82f6",animation:"nameplateSlideUp 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)",whiteSpace:"nowrap",boxShadow:"0 4px 30px rgba(59, 130, 246, 0.4)"},children:a.jsx("div",{style:{color:"white",fontSize:2.2*s+"rem",fontWeight:"bold",textShadow:"0 0 20px rgba(59, 130, 246, 0.8)"},children:t.name})}),F>=5&&F<6&&a.jsx("div",{style:{position:"absolute",top:"10%",left:"15%",padding:`${12*s}px ${32*s}px`,background:n?"rgba(239, 68, 68, 0.9)":"rgba(59, 130, 246, 0.9)",borderRadius:8*s,animation:"turnOrderFadeIn 1s ease-out",boxShadow:n?"0 0 30px rgba(239, 68, 68, 0.6)":"0 0 30px rgba(59, 130, 246, 0.6)"},children:a.jsx("div",{style:{color:"white",fontSize:1.8*s+"rem",fontWeight:"bold",letterSpacing:"0.1em"},children:n?"":""})})]}),F>=0&&a.jsxs("div",{style:{position:"absolute",inset:0,clipPath:ee,background:"linear-gradient(225deg, #280a0a 0%, #4a1a1a 50%, #300d0d 100%)",transform:`translateX(${F>=1?"0":"100%"})`,transition:"transform 1.2s cubic-bezier(0.22, 1, 0.36, 1)",zIndex:50,overflow:"hidden"},children:[a.jsx("div",{style:{position:"fixed",top:"50%",left:"75%",transform:"translate(-50%, -50%)",opacity:I},children:a.jsx("img",{src:Hc(e.class),alt:e.name,style:{height:"120vh",width:"auto",objectFit:"cover",objectPosition:e.class==="AJA"?"center top":"center",filter:"brightness(0.85) contrast(1.1)",transform:`scale(${_})`,transformOrigin:"center center"}})}),a.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(225deg, rgba(239, 68, 68, 0.3) 0%, transparent 60%)",pointerEvents:"none"}}),F>=2&&F<6&&a.jsx("div",{style:{position:"absolute",bottom:"12%",right:"15%",padding:`${16*s}px ${40*s}px`,background:"rgba(0,0,0,0.85)",borderRadius:8*s,borderRight:"4px solid #ef4444",animation:"nameplateSlideUp 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)",whiteSpace:"nowrap",boxShadow:"0 4px 30px rgba(239, 68, 68, 0.4)"},children:a.jsx("div",{style:{color:"white",fontSize:2.2*s+"rem",fontWeight:"bold",textShadow:"0 0 20px rgba(239, 68, 68, 0.8)"},children:e.name})}),F>=5&&F<6&&a.jsx("div",{style:{position:"absolute",top:"10%",right:"15%",padding:`${12*s}px ${32*s}px`,background:n?"rgba(59, 130, 246, 0.9)":"rgba(239, 68, 68, 0.9)",borderRadius:8*s,animation:"turnOrderFadeIn 1s ease-out",boxShadow:n?"0 0 30px rgba(59, 130, 246, 0.6)":"0 0 30px rgba(239, 68, 68, 0.6)"},children:a.jsx("div",{style:{color:"white",fontSize:1.8*s+"rem",fontWeight:"bold",letterSpacing:"0.1em"},children:n?"":""})})]}),F>=1&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{position:"absolute",top:0,left:0,width:4*s,height:"100%",background:"linear-gradient(180deg, #67e8f9 0%, #22d3ee 30%, #06b6d4 50%, #22d3ee 70%, #67e8f9 100%)",boxShadow:A,zIndex:100,animation:X}}),a.jsx("div",{style:{position:"absolute",top:0,left:0,width:`calc(${50+Kn}% + ${2*s}px)`,height:4*s,background:"linear-gradient(90deg, #67e8f9 0%, #22d3ee 30%, #06b6d4 50%, #22d3ee 70%, #67e8f9 100%)",boxShadow:A,zIndex:100,animation:X}}),a.jsx("div",{style:{position:"absolute",bottom:0,left:0,width:`calc(${50-Kn}% + ${2*s}px)`,height:4*s,background:"linear-gradient(90deg, #67e8f9 0%, #22d3ee 30%, #06b6d4 50%, #22d3ee 70%, #67e8f9 100%)",boxShadow:A,zIndex:100,animation:X}}),a.jsxs("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:100,pointerEvents:"none",overflow:"visible"},children:[a.jsxs("defs",{children:[a.jsxs("linearGradient",{id:"cyanGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[a.jsx("stop",{offset:"0%",stopColor:"#67e8f9"}),a.jsx("stop",{offset:"30%",stopColor:"#22d3ee"}),a.jsx("stop",{offset:"50%",stopColor:"#06b6d4"}),a.jsx("stop",{offset:"70%",stopColor:"#22d3ee"}),a.jsx("stop",{offset:"100%",stopColor:"#67e8f9"})]}),a.jsxs("filter",{id:"cyanGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{stdDeviation:j.blurAmount,result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),a.jsx("line",{x1:`${50+Kn-.2}%`,y1:"0",x2:`${50-Kn-.2}%`,y2:"100%",stroke:"url(#cyanGradient)",strokeWidth:4*s,filter:w?void 0:"url(#cyanGlow)",style:{animation:X}})]})]}),F>=1&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{position:"absolute",top:0,right:0,width:4*s,height:"100%",background:"linear-gradient(180deg, #f9a8d4 0%, #f472b6 30%, #ec4899 50%, #f472b6 70%, #f9a8d4 100%)",boxShadow:y,zIndex:100,animation:X,animationDelay:"0.3s"}}),a.jsx("div",{style:{position:"absolute",top:0,right:0,width:`calc(${50-Kn}% + ${2*s}px)`,height:4*s,background:"linear-gradient(90deg, #f9a8d4 0%, #f472b6 30%, #ec4899 50%, #f472b6 70%, #f9a8d4 100%)",boxShadow:y,zIndex:100,animation:X,animationDelay:"0.3s"}}),a.jsx("div",{style:{position:"absolute",bottom:0,right:0,width:`calc(${50+Kn}% + ${2*s}px)`,height:4*s,background:"linear-gradient(90deg, #f9a8d4 0%, #f472b6 30%, #ec4899 50%, #f472b6 70%, #f9a8d4 100%)",boxShadow:y,zIndex:100,animation:X,animationDelay:"0.3s"}}),a.jsxs("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:100,pointerEvents:"none",overflow:"visible"},children:[a.jsxs("defs",{children:[a.jsxs("linearGradient",{id:"pinkGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[a.jsx("stop",{offset:"0%",stopColor:"#f9a8d4"}),a.jsx("stop",{offset:"30%",stopColor:"#f472b6"}),a.jsx("stop",{offset:"50%",stopColor:"#ec4899"}),a.jsx("stop",{offset:"70%",stopColor:"#f472b6"}),a.jsx("stop",{offset:"100%",stopColor:"#f9a8d4"})]}),a.jsxs("filter",{id:"pinkGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{stdDeviation:j.blurAmount,result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),a.jsx("line",{x1:`${50+Kn+.2}%`,y1:"0",x2:`${50-Kn+.2}%`,y2:"100%",stroke:"url(#pinkGradient)",strokeWidth:4*s,filter:w?void 0:"url(#pinkGlow)",style:{animation:X,animationDelay:"0.3s"}})]})]})]}),F>=6&&F<=9&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{position:"fixed",left:ye.myX,top:ye.myY,transform:`translate(-50%, -50%) scale(${D})`,opacity:te,width:150*s,height:150*s,borderRadius:"50%",background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(100,180,255,0.8) 40%, rgba(59,130,246,0.4) 70%, transparent 100%)",boxShadow:w?`0 0 ${30*s}px rgba(59, 130, 246, 0.8)`:`0 0 ${40*s}px rgba(255,255,255,0.9), 0 0 ${80*s}px rgba(59, 130, 246, 0.8), 0 0 ${120*s}px rgba(59, 130, 246, 0.5)`,zIndex:500,pointerEvents:"none"}}),a.jsx("div",{style:{position:"fixed",left:ye.opX,top:ye.opY,transform:`translate(-50%, -50%) scale(${D})`,opacity:te,width:150*s,height:150*s,borderRadius:"50%",background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(255,150,150,0.8) 40%, rgba(239,68,68,0.4) 70%, transparent 100%)",boxShadow:w?`0 0 ${30*s}px rgba(239, 68, 68, 0.8)`:`0 0 ${40*s}px rgba(255,255,255,0.9), 0 0 ${80*s}px rgba(239, 68, 68, 0.8), 0 0 ${120*s}px rgba(239, 68, 68, 0.5)`,zIndex:500,pointerEvents:"none"}})]}),F>=9&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{position:"fixed",left:g.player.x,top:g.player.y,transform:`translate(-50%, -50%) scale(${fe})`,opacity:P,width:g.leaderSize,height:g.leaderSize,borderRadius:"50%",overflow:"hidden",border:"4px solid #3182ce",boxShadow:"0 0 20px rgba(49, 130, 206, 0.4)",background:"#1a202c",zIndex:500,pointerEvents:"none"},children:a.jsx("img",{src:Hc(t.class),alt:t.name,style:{width:"100%",height:"100%",objectFit:"cover",objectPosition:t.class==="AJA"?"center top":"center"}})}),a.jsx("div",{style:{position:"fixed",left:g.opponent.x,top:g.opponent.y,transform:`translate(-50%, -50%) scale(${fe})`,opacity:P,width:g.leaderSize,height:g.leaderSize,borderRadius:"50%",overflow:"hidden",border:"4px solid #c53030",boxShadow:"0 0 20px rgba(197, 48, 48, 0.4)",background:"#1a202c",zIndex:500,pointerEvents:"none"},children:a.jsx("img",{src:Hc(e.class),alt:e.name,style:{width:"100%",height:"100%",objectFit:"cover",objectPosition:e.class==="AJA"?"center top":"center"}})})]}),R.map(Y=>a.jsx("div",{style:{position:"fixed",left:Y.x,top:Y.y,width:Y.size*s,height:Y.size*s,borderRadius:"50%",background:Y.color,boxShadow:`0 0 ${Y.size*.5*s}px ${Y.color}`,pointerEvents:"none",zIndex:600,animation:`landingParticleBurst 0.6s ease-out ${Y.delay}s forwards`,transform:"translate(-50%, -50%)","--particle-angle":`${Y.angle}deg`,"--particle-dist":`${Y.dist*s}px`}},Y.id)),ve&&a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",animation:F===3?"vsZoomIn 1.5s cubic-bezier(0.34, 1.56, 0.64, 1)":void 0,opacity:F>=7?Math.max(0,q):1,zIndex:200,pointerEvents:"none"},children:a.jsx("img",{src:JL,alt:"VS",style:{height:300*s,width:"auto",filter:`drop-shadow(0 0 ${20*s}px rgba(255,255,255,0.8)) drop-shadow(0 0 ${40*s}px rgba(255,255,255,0.6))`}})}),F>=4&&F<5&&a.jsx("div",{style:{position:"absolute",top:"20%",left:"50%",transform:"translate(-50%, -50%)",zIndex:150},children:a.jsx("div",{style:{width:100*s,height:100*s,borderRadius:"50%",background:"linear-gradient(45deg, #f6ad55 0%, #fbd38d 100%)",border:"4px solid white",display:"flex",alignItems:"center",justifyContent:"center",fontSize:2*s+"rem",fontWeight:"bold",color:"white",animation:"coinFlip 1.5s ease-in-out",boxShadow:`0 0 ${30*s}px rgba(246, 173, 85, 0.8)`},children:""})}),a.jsx("style",{children:`
                @keyframes screenShake {
                    0%, 100% { transform: translate(0, 0); }
                    10% { transform: translate(-10px, -10px); }
                    20% { transform: translate(10px, 10px); }
                    30% { transform: translate(-10px, 10px); }
                    40% { transform: translate(10px, -10px); }
                    50% { transform: translate(-10px, -10px); }
                    60% { transform: translate(10px, 10px); }
                    70% { transform: translate(-10px, 10px); }
                    80% { transform: translate(10px, -10px); }
                    90% { transform: translate(-10px, 0); }
                }

                @keyframes nameplateSlideUp {
                    0% {
                        transform: translateY(50px);
                        opacity: 0;
                    }
                    60% {
                        transform: translateY(-10px);
                    }
                    100% {
                        transform: translateY(0);
                        opacity: 1;
                    }
                }

                @keyframes vsZoomIn {
                    0% {
                        transform: translate(-50%, -50%) scale(3) translateZ(0);
                        opacity: 0;
                        filter: blur(20px);
                    }
                    50% {
                        transform: translate(-50%, -50%) scale(1.2) translateZ(0);
                        opacity: 1;
                        filter: blur(0px);
                    }
                    100% {
                        transform: translate(-50%, -50%) scale(1) translateZ(0);
                        opacity: 1;
                        filter: blur(0px);
                    }
                }

                @keyframes coinFlip {
                    0% {
                        transform: rotateY(0deg) scale(1);
                    }
                    50% {
                        transform: rotateY(1800deg) scale(1.2);
                    }
                    100% {
                        transform: rotateY(3600deg) scale(1);
                    }
                }

                @keyframes turnOrderFadeIn {
                    0% {
                        opacity: 0;
                        transform: scale(0.5);
                    }
                    50% {
                        transform: scale(1.2);
                    }
                    100% {
                        opacity: 1;
                        transform: scale(1);
                    }
                }

                @keyframes glowPulse {
                    0%, 100% {
                        opacity: 0.8;
                        filter: brightness(1);
                    }
                    50% {
                        opacity: 1;
                        filter: brightness(1.3);
                    }
                }

                @keyframes landingParticleBurst {
                    0% {
                        transform: translate(-50%, -50%) rotate(var(--particle-angle)) translateX(0);
                        opacity: 1;
                    }
                    100% {
                        transform: translate(-50%, -50%) rotate(var(--particle-angle)) translateX(var(--particle-dist));
                        opacity: 0;
                    }
                }
            `})]})},ZL=({isVictory:t,loserLeaderRef:e,onComplete:n,onPhaseChange:r,onShakeIntensityChange:s,scale:i=1})=>{const[o,l]=L.useState("start"),[c,d]=L.useState(null),[u,h]=L.useState([]);L.useEffect(()=>{if(e.current){const S=e.current.getBoundingClientRect();d({x:S.left+S.width/2,y:S.top+S.height/2,size:S.width})}},[e]),L.useEffect(()=>{r==null||r(o)},[o,r]),L.useEffect(()=>{const S={start:200,zoom:600,"white-fade":800,explode:1200,"result-text":1800,"fade-out":600};if(o==="complete"){n();return}const k={start:"zoom",zoom:"white-fade","white-fade":"explode",explode:"result-text","result-text":"fade-out","fade-out":"complete"},w=setTimeout(()=>{const j=k[o];j&&l(j)},S[o]||1e3);return()=>clearTimeout(w)},[o,n]),L.useEffect(()=>{if(o==="explode"&&c){const k=Array.from({length:60},(x,I)=>{const p=I/60*360,D=(Math.random()-.5)*12,z=p+D,te=150+Math.random()*250,H=12+Math.random()*20;return{id:I,x:c.x,y:c.y,angle:z,distance:te,size:H,delay:Math.random()*.1,duration:.6+Math.random()*.4}});h(k),s==null||s(1);const w=1e3,j=Date.now(),_=setInterval(()=>{const I=(Date.now()-j)/w;if(I>=1)s==null||s(0),clearInterval(_);else{const p=1-Math.pow(I,2);s==null||s(p)}},16);return()=>clearInterval(_)}},[o,c,s]);const f=["start","zoom","white-fade","explode","result-text","fade-out","complete"].indexOf(o);return c?a.jsxs("div",{style:{position:"fixed",inset:0,zIndex:8e3,pointerEvents:"none",overflow:"hidden"},children:[a.jsx("div",{style:{position:"absolute",inset:0,background:"black",opacity:f>=1?f>=5?1:.5:0,transition:"opacity 0.5s ease-out"}}),f>=1&&f<4&&a.jsx("div",{style:{position:"absolute",left:c.x,top:c.y,transform:"translate(-50%, -50%)",width:c.size*1.8,height:c.size*1.8,borderRadius:"50%",background:"radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 60%)",transition:"all 0.4s ease-out"}}),f>=3&&u.map(S=>a.jsx("div",{style:{position:"absolute",left:S.x,top:S.y,width:S.size*i,height:S.size*i,borderRadius:"50%",background:"white",boxShadow:"0 0 15px white, 0 0 30px rgba(255,255,255,0.5)",transform:"translate(-50%, -50%)",animation:`particleFly-${S.id} ${S.duration}s ease-out ${S.delay}s forwards`}},S.id)),f>=3&&a.jsx("style",{children:u.map(S=>{const k=S.angle*Math.PI/180,w=Math.cos(k)*S.distance,j=Math.sin(k)*S.distance;return`
                            @keyframes particleFly-${S.id} {
                                0% {
                                    transform: translate(-50%, -50%) scale(1);
                                    opacity: 1;
                                }
                                100% {
                                    transform: translate(calc(-50% + ${w}px), calc(-50% + ${j}px)) scale(0);
                                    opacity: 0;
                                }
                            }
                        `}).join(`
`)}),f>=4&&f<6&&a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",animation:"resultTextPop 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)"},children:a.jsx("div",{style:{fontSize:`${7*i}rem`,fontWeight:900,fontFamily:"Tamanegi, sans-serif",color:t?"#ffd700":"#718096",textShadow:t?"0 0 30px rgba(255,215,0,0.8), 0 0 60px rgba(255,215,0,0.6), 0 0 90px rgba(255,215,0,0.4), 4px 4px 8px rgba(0,0,0,0.8)":"0 0 20px rgba(113,128,150,0.5), 4px 4px 8px rgba(0,0,0,0.8)",letterSpacing:"0.15em"},children:t?"":"..."})}),a.jsx("style",{children:`
                @keyframes resultTextPop {
                    0% {
                        transform: translate(-50%, -50%) scale(2.5);
                        opacity: 0;
                        filter: blur(20px);
                    }
                    60% {
                        transform: translate(-50%, -50%) scale(0.95);
                        opacity: 1;
                        filter: blur(0px);
                    }
                    100% {
                        transform: translate(-50%, -50%) scale(1);
                        opacity: 1;
                        filter: blur(0px);
                    }
                }
            `})]}):null},e3=({isMyTurn:t,turnCount:e,activePlayerId:n,onTimeUp:r,timerEnabled:s,isGameOver:i=!1,isPaused:o=!1,scale:l=1,buttonSize:c=160,timerDuration:d=60})=>{const[u,h]=L.useState(d),[f,S]=L.useState(!1),[k,w]=L.useState(!1),j=L.useRef(null),_=L.useRef(""),x=L.useRef(0),I=L.useRef(r),p=L.useRef(!1),D=L.useId().replace(/:/g,"_");L.useEffect(()=>{I.current=r},[r]);const z=`${e}-${n}`,te=L.useCallback(()=>{h(d),S(!1),w(!1),x.current=Date.now()+d*1e3,p.current=!1},[d]);if(L.useEffect(()=>{z!==_.current&&(_.current=z,te())},[z,te]),L.useEffect(()=>{if(!s||!t||i||o){j.current&&(clearInterval(j.current),j.current=null);return}return x.current===0&&(x.current=Date.now()+d*1e3),j.current=window.setInterval(()=>{const g=Date.now(),T=Math.max(0,(x.current-g)/1e3);h(T);const A=Math.ceil(T);A<=15&&A>10?(S(!0),w(!1)):A<=10?(S(!0),w(!0)):(S(!1),w(!1)),T<=0&&!p.current&&(p.current=!0,j.current&&(clearInterval(j.current),j.current=null),setTimeout(()=>I.current(),0))},16),()=>{j.current&&(clearInterval(j.current),j.current=null)}},[s,t,i,o,d]),!s||o)return null;const H=u/d,q=(c/2+12)*l,ue=6*l,ye=2*Math.PI*q,Me=-ye*(1-H),fe=Math.ceil(u),re=k?Math.min(1,(10-fe)/10):0,P=Math.max(.05,.15-re*.1);let C="#4299e1";f&&!k?C="#f6ad55":k&&(C="#e53e3e");const R=20*l,v=q*2+ue+R*2;return a.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:v,height:v,pointerEvents:"none",zIndex:10,animation:k?`timerShake${D} ${P}s ease-in-out infinite`:void 0},children:[a.jsxs("svg",{width:v,height:v,style:{position:"absolute",top:0,left:0,overflow:"visible"},children:[a.jsx("circle",{cx:v/2,cy:v/2,r:q,fill:"none",stroke:"rgba(0,0,0,0.3)",strokeWidth:ue}),a.jsx("circle",{cx:v/2,cy:v/2,r:q,fill:"none",stroke:C,strokeWidth:ue,strokeLinecap:"round",strokeDasharray:ye,strokeDashoffset:Me,style:{transform:"rotate(-90deg)",transformOrigin:"center"}}),f&&a.jsx("circle",{cx:v/2,cy:v/2,r:q,fill:"none",stroke:C,strokeWidth:ue*3,opacity:.4,style:{filter:`blur(${12*l}px)`,animation:k?`timerPulse${D} 0.5s ease-in-out infinite`:`timerPulse${D} 1s ease-in-out infinite`}})]}),a.jsx("style",{children:`
                @keyframes timerPulse${D} {
                    0%, 100% { opacity: 0.4; }
                    50% { opacity: 0.7; }
                }
                @keyframes timerShake${D} {
                    0%, 100% { transform: translate(-50%, -50%) translate(0, 0); }
                    25% { transform: translate(-50%, -50%) translate(${2*l}px, ${-2*l}px); }
                    50% { transform: translate(-50%, -50%) translate(${-2*l}px, ${2*l}px); }
                    75% { transform: translate(-50%, -50%) translate(${2*l}px, ${1*l}px); }
                }
            `})]})};function t3(t,e){const[n,r]=L.useState(null),[s,i]=L.useState(""),[o,l]=L.useState(!1),[c,d]=L.useState(null),[u,h]=L.useState(!1);return L.useEffect(()=>{if(t==="CPU")return;const f=new ZS;return h(!0),(async()=>{try{const k=await f.connect(t==="JOIN"?e:void 0);i(k),r(f),f.onConnection(()=>{console.log("[useGameNetwork] Connection established!"),l(!0),h(!1)})}catch(k){d(k.toString()),h(!1)}})(),()=>{f.disconnect()}},[t,e]),{adapter:n,myId:s,connected:o,connecting:u,error:c,setConnected:l}}function w_(t,e,n){return!(!t.canEvolveThisTurn||t.evolutionsUsed>=2||e<(n?5:4))}function T_(t,e,n){return!(!t.canEvolveThisTurn||t.sep<=0||e<(n?7:6))}const et=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},n3=et("/leaders/azya_leader.png"),r3=et("/leaders/senka_leader.png"),s3=et("/leaders/yoRuka_leader.png"),i3=et("/sleeves/azya_sleeve.png"),o3=et("/sleeves/senka_sleeve.png"),a3=et("/sleeves/yoruka_sleeve.png"),qa=t=>t==="YORUKA"?s3:t==="AJA"?n3:r3,ai=t=>t==="YORUKA"?a3:t==="AJA"?i3:o3,l3=1920,tI=1080,c3=()=>{const[t,e]=L.useState({scale:1,toGameX:r=>r,toGameY:r=>r}),n=L.useCallback(()=>{const r=window.visualViewport?window.visualViewport.width:window.innerWidth,s=window.visualViewport?window.visualViewport.height:window.innerHeight;let i=Math.min(r/l3,s/tI);i*=1.5,e({scale:i,toGameX:c=>c,toGameY:c=>c})},[]);return L.useEffect(()=>{n(),window.addEventListener("resize",n),window.addEventListener("orientationchange",()=>{setTimeout(n,150)}),window.visualViewport&&window.visualViewport.addEventListener("resize",n);const r=()=>{document.visibilityState==="visible"&&setTimeout(n,100)};return document.addEventListener("visibilitychange",r),()=>{window.removeEventListener("resize",n),window.removeEventListener("orientationchange",n),window.visualViewport&&window.visualViewport.removeEventListener("resize",n),document.removeEventListener("visibilitychange",r)}},[n]),t},an=90,bn=120,li=an+18,to=240,d3=({x:t,y:e,onComplete:n,scale:r=1})=>{N.useEffect(()=>{const i=setTimeout(n,2e3);return()=>clearTimeout(i)},[n]);const s=N.useMemo(()=>Array(20).fill(0).map((i,o)=>({id:o,angle:Math.random()*360,dist:(30+Math.random()*60)*r,size:(10+Math.random()*15)*r,delay:Math.random()*.5})),[r]);return a.jsxs("div",{style:{position:"absolute",left:t,top:e,pointerEvents:"none",zIndex:6e3},children:[a.jsx("style",{children:`
                @keyframes healGlowFade {
                    0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; filter: blur(10px); }
                    30% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.8; filter: blur(15px); }
                    100% { transform: translate(-50%, -50%) scale(1.6); opacity: 0; filter: blur(30px); }
                }
                @keyframes healParticleRise {
                    0% { transform: translate(-50%, -50%) rotate(var(--angle)) translate(0, 0) scale(0); opacity: 0; }
                    20% { transform: translate(-50%, -50%) rotate(var(--angle)) translate(0, 0) opacity: 0.7; }
                    100% { transform: translate(-50%, -50%) rotate(var(--angle)) translate(calc(var(--dist) * 1px), 0) scale(1.5); opacity: 0; }
                }
            `}),a.jsx("div",{style:{position:"absolute",left:0,top:0,width:150*r,height:150*r,background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(200,255,240,0.5) 50%, transparent 80%)",borderRadius:"50%",transform:"translate(-50%, -50%)",animation:"healGlowFade 1.5s ease-out forwards",filter:`blur(${8*r}px)`}}),s.map(i=>a.jsx("div",{style:{position:"absolute",left:0,top:0,width:i.size,height:i.size,background:"rgba(255,250,240,0.6)",borderRadius:"50%",filter:`blur(${4*r}px)`,"--angle":`${i.angle}deg`,"--dist":i.dist,animation:`healParticleRise 1.2s ease-out ${i.delay}s forwards`,pointerEvents:"none"}},i.id))]})},u3=({x:t,y:e,atkBuff:n,hpBuff:r,onComplete:s})=>{N.useEffect(()=>{const S=setTimeout(s,1500);return()=>clearTimeout(S)},[s]);const i=n<0||r<0,o=i?"radial-gradient(circle, rgba(180,50,50,0.9) 0%, rgba(150,30,30,0.4) 50%, transparent 80%)":"radial-gradient(circle, rgba(255,230,100,0.9) 0%, rgba(255,200,50,0.4) 50%, transparent 80%)",l=i?"#ff4444":"#ffd93d",c="#ffd93d",d="rgba(255,217,61,0.8)",u=S=>S>=0?`+${S}`:`${S}`,h=80,f=110;return a.jsxs("div",{style:{position:"absolute",left:t,top:e,pointerEvents:"none",zIndex:6e3},children:[a.jsx("style",{children:`
                @keyframes buffGlow {
                    0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
                    30% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
                    100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
                }
                @keyframes buffNumberRise {
                    0% { transform: translateY(0); opacity: 0; }
                    20% { opacity: 1; }
                    100% { transform: translateY(-30px); opacity: 0; }
                }
                @keyframes buffSparkle {
                    0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
                    50% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
                    100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
                }
            `}),a.jsx("div",{style:{position:"absolute",left:0,top:0,width:150,height:150,background:o,borderRadius:"50%",transform:"translate(-50%, -50%)",animation:"buffGlow 1.2s ease-out forwards",filter:"blur(8px)"}}),n!==0&&a.jsx("div",{style:{position:"absolute",left:-h/2+12,top:f/2-20,fontSize:"24px",fontWeight:"bold",color:c,textShadow:`0 0 10px ${d}, 2px 2px 4px rgba(0,0,0,0.8)`,fontFamily:"Tamanegi, sans-serif",animation:"buffNumberRise 1.2s ease-out forwards",textAlign:"center"},children:u(n)}),r!==0&&a.jsx("div",{style:{position:"absolute",left:h/2-28,top:f/2-20,fontSize:"24px",fontWeight:"bold",color:c,textShadow:`0 0 10px ${d}, 2px 2px 4px rgba(0,0,0,0.8)`,fontFamily:"Tamanegi, sans-serif",animation:"buffNumberRise 1.2s ease-out forwards",textAlign:"center"},children:u(r)}),[...Array(8)].map((S,k)=>a.jsx("div",{style:{position:"absolute",left:Math.cos(k*Math.PI/4)*60,top:Math.sin(k*Math.PI/4)*60,width:12,height:12,background:l,borderRadius:"50%",boxShadow:`0 0 10px ${l}, 0 0 20px ${l}`,animation:`buffSparkle 0.8s ease-out ${k*.1}s forwards`}},k))]})},f3=({x:t,y:e,onComplete:n,scale:r=1})=>(N.useEffect(()=>{const s=setTimeout(n,1200);return()=>clearTimeout(s)},[n]),a.jsxs("div",{style:{position:"absolute",left:t,top:e,transform:"translate(-50%, -50%)",width:130*r,height:130*r,pointerEvents:"none",zIndex:5e3,display:"flex",alignItems:"center",justifyContent:"center"},children:[a.jsx("div",{style:{fontSize:`${80*r}px`,animation:"baneSkullAppear 1.2s ease-out forwards",textShadow:`0 0 ${20*r}px #9b59b6, 0 0 ${40*r}px #8e44ad, 0 0 ${60*r}px #6c3483`,filter:`drop-shadow(0 0 ${15*r}px #9b59b6) hue-rotate(-10deg)`},children:""}),[...Array(12)].map((s,i)=>a.jsx("div",{style:{position:"absolute",left:"50%",top:"50%",width:6*r,height:6*r,background:"radial-gradient(circle, #9b59b6, #6c3483)",borderRadius:"50%",boxShadow:`0 0 ${8*r}px #9b59b6, 0 0 ${15*r}px #8e44ad`,animation:`baneParticle 1s ease-out ${i*.08}s forwards`,transform:`rotate(${i*30}deg) translateX(0)`}},i)),a.jsx("style",{children:`
                @keyframes baneSkullAppear {
                    0% { transform: scale(0) rotate(-30deg); opacity: 0; }
                    20% { transform: scale(1.3) rotate(10deg); opacity: 1; }
                    40% { transform: scale(1) rotate(-5deg); opacity: 1; }
                    60% { transform: scale(1.1) rotate(0deg); opacity: 1; }
                    80% { transform: scale(1) rotate(0deg); opacity: 0.8; }
                    100% { transform: scale(1.5) rotate(0deg); opacity: 0; }
                }
                @keyframes baneParticle {
                    0% { transform: rotate(0deg) translateX(0); opacity: 1; }
                    100% { transform: rotate(0deg) translateX(${70*r}px); opacity: 0; }
                }
            `})]})),h3=({type:t,x:e,y:n,onComplete:r,audioSettings:s,scale:i=1})=>{const o=N.useMemo(()=>{let f=8,S=8,k=100,w=256;return t==="SHOT"&&(w=128),{cols:f,rows:S,fps:k,size:w}},[t]);if(N.useEffect(()=>{const S=["LIGHTNING","THUNDER","IMPACT","SUMI","SHOT","ICE","WATER","RAY","FIRE","SLASH","BLUE_FIRE"].includes(t)?o.cols*o.rows/o.fps*1e3:t==="FIREBALL"?500:t==="HEAL"?2e3:400,k=setTimeout(r,S);return()=>clearTimeout(k)},[r,t,o]),N.useEffect(()=>{if(!s||!s.seEnabled)return;const f=(S,k=.5,w=0)=>{setTimeout(()=>{const j=new Audio(et(`/se/${S}`));j.volume=(s.se||.5)*k,j.play().catch(_=>console.warn("SE Play prevented",_))},w)};t==="SHOT"?(f("shot.mp3",.6),f("hibi.mp3",.4,400)):t==="IMPACT"?(f("panch1.mp3",.6,100),f("panch2.mp3",.6,500)):t==="LIGHTNING"||t==="THUNDER"?f("thunder.mp3",.5):t==="FIREBALL"?f("explosion.mp3",.5):t==="FIRE"?f("fire.mp3",.5):t==="SLASH"?f("slash.mp3",.5):t==="ICE"?f("ice.mp3",.5):t==="WATER"?f("water.mp3",.5):t==="RAY"?f("ray.mp3",.6):t==="SUMI"?f("yami.mp3",.6):t==="HEAL"?f("heal.mp3",.6):t==="BLUE_FIRE"?f("fire.mp3",.5):t==="BANE"&&f("yami.mp3",.7)},[t,s]),t==="HEAL")return a.jsx(d3,{x:e,y:n,onComplete:r,scale:i});if(t==="BANE")return a.jsx(f3,{x:e,y:n,onComplete:r,scale:i});const l=100*i,c={position:"absolute",left:e,top:n,transform:"translate(-50%, -50%)",width:l,height:l,pointerEvents:"none",zIndex:5e3,display:"flex",alignItems:"center",justifyContent:"center"};if(["LIGHTNING","THUNDER","IMPACT","SUMI","SHOT","ICE","WATER","RAY","FIRE","SLASH","BLUE_FIRE"].includes(t)){let f=et("/effects/thunder.png");t==="IMPACT"&&(f=et("/effects/impact.png")),t==="SUMI"&&(f=et("/effects/sumi.png")),t==="SHOT"&&(f=et("/effects/shot.png")),t==="ICE"&&(f=et("/effects/ice.png")),t==="WATER"&&(f=et("/effects/water.png")),t==="RAY"&&(f=et("/effects/ray.png")),t==="FIRE"&&(f=et("/effects/fire.png")),t==="SLASH"&&(f=et("/effects/slash.png")),t==="BLUE_FIRE"&&(f=et("/effects/blue_fire.png"));const S=o.cols*o.rows,k=Math.min(160,o.size)*i;return a.jsxs("div",{style:{...c,width:k,height:k,transform:`${(c==null?void 0:c.transform)||""}`},children:[a.jsx("div",{style:{width:"100%",height:"100%",backgroundImage:`url(${f})`,backgroundSize:`${o.cols*100}% ${o.rows*100}%`,animation:`spriteAnimation ${S/o.fps}s steps(1) forwards`}}),a.jsx("style",{children:`
                    @keyframes spriteAnimation {
                        ${Array.from({length:S}).map((w,j)=>{const _=j%o.cols,x=Math.floor(j/o.cols),I=_*(100/(o.cols-1)),p=x*(100/(o.rows-1));return`${j/(S-1)*100}% { background-position: ${I}% ${p}%; }`}).join(`
`)}
                    }
                `})]})}let u="",h="";if(t==="FIREBALL")u=et("/effects/fireball.png"),h="explode 0.5s ease-out forwards";else if(t==="BEAM")return a.jsx("div",{style:{position:"fixed",left:e,top:n,width:400,height:30,background:"linear-gradient(90deg, transparent, #faf089, #fff, #faf089, transparent)",transform:"translate(-50%, -50%) rotate(-45deg)",boxShadow:"0 0 20px #faf089",opacity:0,animation:"beamShoot 0.4s ease-out forwards",pointerEvents:"none",zIndex:5e3},children:a.jsx("style",{children:`
                    @keyframes beamShoot {
                        0% { width: 0; opacity: 1; transform: translate(-50%, -50%) rotate(-45deg) scaleX(0); }
                        20% { width: 400px; opacity: 1; transform: translate(-50%, -50%) rotate(-45deg) scaleX(1); }
                        100% { width: 400px; opacity: 0; transform: translate(-50%, -50%) rotate(-45deg) scaleX(1.2); }
                    }
                `})});return u?a.jsxs("div",{style:c,children:[a.jsx("img",{src:u,style:{width:"100%",height:"100%",objectFit:"contain",animation:h}}),a.jsx("style",{children:`
                @keyframes explode { 0% { transform: scale(0.5); opacity: 0; } 20% { opacity: 1; } 100% { transform: scale(2); opacity: 0; } }
            `})]}):null},p3=({value:t,x:e,y:n,color:r,onComplete:s,scale:i=1})=>{N.useEffect(()=>{const d=setTimeout(s,1200);return()=>clearTimeout(d)},[s]);const o=r==="#48bb78",l=r||"#e53e3e",c=o?"linear-gradient(180deg, #68d391 0%, #38a169 50%, #276749 100%)":"linear-gradient(180deg, #fc8181 0%, #e53e3e 50%, #c53030 100%)";return a.jsxs("div",{style:{position:"absolute",left:e,top:n,transform:"translate(-50%, -50%)",pointerEvents:"none",zIndex:6e3,fontSize:`${4*i}rem`,fontWeight:"900",fontFamily:'"Impact", "Arial Black", sans-serif',letterSpacing:`${-2*i}px`,background:c,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",filter:`drop-shadow(0 0 ${8*i}px ${l}) drop-shadow(0 ${2*i}px ${4*i}px rgba(0,0,0,0.8))`,animation:"floatUp 1.2s ease-out forwards"},children:[t,a.jsx("style",{children:`
                @keyframes floatUp {
                    0% { transform: translate(-50%, -50%) scale(0.3); opacity: 0; }
                    15% { transform: translate(-50%, -70%) scale(1.8); opacity: 1; }
                    30% { transform: translate(-50%, -90%) scale(1.4); opacity: 1; }
                    100% { transform: translate(-50%, -180%) scale(1); opacity: 0; }
                }
            `})]})},g3=({x:t,y:e})=>{const n=N.useMemo(()=>Array(16).fill(0).map((r,s)=>({id:s,angle:Math.random()*360,dist:60+Math.random()*120,size:4+Math.random()*8,delay:Math.random()*.3,color:Math.random()>.5?"#f6e05e":"#ffffff"})),[]);return a.jsxs("div",{style:{position:"absolute",left:t,top:e,pointerEvents:"none",zIndex:6e3},children:[a.jsx("style",{children:`
                @keyframes sparkleMove {
                    0% { transform: rotate(var(--angle)) translate(0, 0) scale(0); opacity: 0; }
                    20% { opacity: 1; transform: rotate(var(--angle)) translate(calc(var(--dist) * 0.2px), 0) scale(1.5); }
                    100% { transform: rotate(var(--angle)) translate(calc(var(--dist) * 1px), 0) scale(0); opacity: 0; }
                }
            `}),n.map(r=>a.jsx("div",{style:{position:"absolute",left:0,top:0,width:r.size,height:r.size,background:r.color,borderRadius:"50%",boxShadow:`0 0 10px ${r.color}, 0 0 20px ${r.color}`,"--angle":`${r.angle}deg`,"--dist":r.dist,animation:`sparkleMove 0.8s ease-out ${r.delay}s forwards`,pointerEvents:"none"}},r.id))]})},m3=({onClose:t})=>a.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(0,0,0,0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:t,children:a.jsxs("div",{style:{background:"linear-gradient(135deg, #1a202c 0%, #2d3748 100%)",borderRadius:16,padding:30,maxWidth:700,maxHeight:"80vh",overflowY:"auto",color:"#fff",boxShadow:"0 20px 60px rgba(0,0,0,0.5)",border:"1px solid #4a5568"},onClick:e=>e.stopPropagation(),children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[a.jsx("h2",{style:{margin:0,color:"#63b3ed"},children:""}),a.jsx("button",{onClick:t,style:{background:"transparent",border:"none",color:"#a0aec0",fontSize:"1.5rem",cursor:"pointer"},children:""})]}),a.jsxs("section",{style:{marginBottom:25},children:[a.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),a.jsxs("ul",{style:{lineHeight:1.8,paddingLeft:20,color:"#e2e8f0"},children:[a.jsx("li",{children:"0"}),a.jsx("li",{children:"1PP110"}),a.jsx("li",{children:"PP"}),a.jsx("li",{children:""}),a.jsx("li",{children:"5"}),a.jsx("li",{children:"910"})]})]}),a.jsxs("section",{style:{marginBottom:25},children:[a.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[a.jsxs("div",{children:[a.jsx("span",{style:{color:"#48bb78",fontWeight:"bold"},children:"[]"}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#ed8936",fontWeight:"bold"},children:"[]"}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#4299e1",fontWeight:"bold"},children:"[]"}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#9f7aea",fontWeight:"bold"},children:"[]"}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#f56565",fontWeight:"bold"},children:"[]"}),"12"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#38b2ac",fontWeight:"bold"},children:"[]"}),"1"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#718096",fontWeight:"bold"},children:"[]"}),"AoE"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#d69e2e",fontWeight:"bold"},children:"[]"}),"AoE"]})]})]}),a.jsxs("section",{style:{marginBottom:25},children:[a.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[a.jsxs("div",{children:[a.jsx("span",{style:{color:"#63b3ed",fontWeight:"bold"},children:""}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#f687b3",fontWeight:"bold"},children:""}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#faf089",fontWeight:"bold"},children:""}),"EP"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#b794f4",fontWeight:"bold"},children:""}),"SEP"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#68d391",fontWeight:"bold"},children:""}),""]})]})]}),a.jsxs("section",{style:{marginBottom:25},children:[a.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),a.jsxs("ul",{style:{lineHeight:1.8,paddingLeft:20,color:"#e2e8f0"},children:[a.jsxs("li",{children:[a.jsx("span",{style:{color:"#faf089"},children:"EP"}),"54112"]}),a.jsxs("li",{children:[a.jsx("span",{style:{color:"#b794f4"},children:"SEP"}),"76112"]}),a.jsx("li",{children:"1111"}),a.jsx("li",{children:"+2/+2"}),a.jsx("li",{children:"+3/+3"})]})]}),a.jsxs("section",{children:[a.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),a.jsxs("ul",{style:{lineHeight:1.8,paddingLeft:20,color:"#e2e8f0"},children:[a.jsxs("li",{children:[a.jsx("span",{style:{color:"#ed8936"},children:"PP"}),""]}),a.jsx("li",{children:"151612PP +1"})]})]})]})}),y3=({logs:t,onCardNameClick:e,scale:n=1,isMobile:r=!1})=>{const s=N.useRef(null);N.useEffect(()=>{s.current&&(s.current.scrollTop=s.current.scrollHeight)},[t.length]);const i=(c,d)=>{const u={color:"#ffd700",cursor:"pointer",textDecoration:"underline",textUnderlineOffset:"2px",fontWeight:"bold"},h=p=>{p.target.style.color="#ffec8b",p.target.style.textShadow="0 0 8px rgba(255, 215, 0, 0.8)"},f=p=>{p.target.style.color="#ffd700",p.target.style.textShadow="none"},S=(p,D)=>a.jsx("span",{style:u,onMouseEnter:h,onMouseLeave:f,onClick:z=>{z.stopPropagation(),e==null||e(p)},children:p},D),k=Z1(),w=p=>p?!(/[a-zA-Z0-9]/.test(p)||/[\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/.test(p)):!0,j=[];for(const p of k){let D=0;for(;;){const z=c.indexOf(p,D);if(z===-1)break;const te=z>0?c[z-1]:void 0,H=z+p.length<c.length?c[z+p.length]:void 0,q=w(te)&&w(H),ue=j.some(ye=>z>=ye.start&&z<ye.end||z+p.length>ye.start&&z+p.length<=ye.end||z<=ye.start&&z+p.length>=ye.end);q&&!ue&&j.push({start:z,end:z+p.length,name:p}),D=z+1}}if(j.length===0)return a.jsx("span",{children:c});j.sort((p,D)=>p.start-D.start);const _=[];let x=0,I=0;for(const p of j)p.start>x&&_.push(a.jsx("span",{children:c.slice(x,p.start)},I++)),_.push(S(p.name,I++)),x=p.end;return x<c.length&&_.push(a.jsx("span",{children:c.slice(x)},I++)),a.jsx(a.Fragment,{children:_})},o=r?Math.max(100,140*n):Math.max(150,200*n),l=r?Math.max(140,180*n):Math.max(180,220*n);return a.jsxs("div",{ref:s,style:{position:"absolute",left:0,top:"45%",transform:"translateY(-50%)",width:l,height:o,overflowY:"auto",background:"linear-gradient(to right, rgba(0,0,0,0.8), rgba(0,0,0,0.0))",color:"#fff",fontSize:r?`${Math.max(.55,.65*n)}rem`:`${Math.max(.65,.75*n)}rem`,padding:r?`${6*n}px ${6*n}px ${6*n}px ${10*n}px`:`${8*n}px ${8*n}px ${8*n}px ${12*n}px`,borderLeft:r?"2px solid #63b3ed":"3px solid #63b3ed",zIndex:15,pointerEvents:"auto",scrollbarWidth:"thin"},onMouseDown:c=>c.stopPropagation(),onClick:c=>c.stopPropagation(),children:[a.jsx("div",{style:{fontWeight:"bold",marginBottom:(r?3:4)*n,color:"#a0aec0",borderBottom:"1px solid rgba(255,255,255,0.1)",paddingBottom:2,fontSize:r?`${Math.max(.5,.55*n)}rem`:`${Math.max(.55,.65*n)}rem`,textTransform:"uppercase",letterSpacing:1},children:r?"LOG":"BATTLE LOG"}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:(r?2:3)*n},children:t.map((c,d)=>a.jsx("div",{style:{opacity:.9,lineHeight:r?"1.3":"1.4",textShadow:"0 1px 2px black",animation:"fadeIn 0.3s ease-out"},children:i(c)},d))})]})},v3=({card:t,evolvedImageUrl:e,startX:n,startY:r,phase:s,onPhaseChange:i,onShake:o,useSep:l,playSE:c,scale:d,isLightMode:u=!1})=>{const[h,f]=N.useState(0),[S,k]=N.useState(0),[w,j]=N.useState(0),[_,x]=N.useState(0),[I,p]=N.useState(0),[D,z]=N.useState(.25),[te,H]=N.useState({x:n,y:r}),[q,ue]=N.useState(!1),[ye,Me]=N.useState([]),[fe,re]=N.useState([]),[P,C]=N.useState(!1),R=N.useRef(!1),v=N.useRef(null),g=N.useRef(i),T=N.useRef(o),A=N.useRef(c);N.useEffect(()=>{g.current=i,T.current=o,A.current=c},[i,o,c]);const y=360*d,X=480*d;N.useEffect(()=>{var Y,Pe,xe;console.log("[EvolutionAnimation] Phase:",s);let Ee,ee=null;switch(s){case"ZOOM_IN":{H({x:n,y:r}),z(.25),k(0);const qe=Date.now(),B=650,We=.25,ut=.75,Pt=setInterval(()=>{const nt=Date.now()-qe,Vt=Math.min(nt/B,1),Bt=1-Math.pow(1-Vt,2);k(-5*Bt),z(We+(ut-We)*Bt),Vt>=1&&clearInterval(Pt)},16);Ee=setTimeout(()=>{const nt=280*d,Vt=window.innerWidth-nt,Bt=nt+Vt*.4;H({x:Bt,y:window.innerHeight/2-30*d})},50);const ie=setTimeout(()=>{const nt=new Audio(et("/se/kirakira.mp3"));nt.volume=.35,nt.play().catch(()=>{}),v.current=nt},600),He=setTimeout(()=>{g.current("WHITE_FADE")},700);return()=>{clearTimeout(Ee),clearTimeout(He),clearTimeout(ie),clearInterval(Pt)}}case"WHITE_FADE":(Y=A.current)==null||Y.call(A,"magic_charge.mp3",.3);const $e=Array(80).fill(0).map((qe,B)=>{const We=B/80*360,ut=(Math.random()-.5)*10,Pt=We+ut,ie=200+Math.random()*600,He=Math.random()*1.8,Vt=.5+(ie-200)/600*.5,Bt=24+Math.random()*48;return{id:B,angle:Pt,dist:ie,delay:He,duration:Vt,size:Bt}});Me($e),C(!0);let Te=0;return ee=setInterval(()=>{Te+=.025,x(Math.min(Te,1)),p(Math.min(Te*80,80)),j(Te*15),Te>=1.2&&(ee&&clearInterval(ee),C(!1),g.current("FLIP"))},40),()=>{ee&&clearInterval(ee)};case"FLIP":if((Pe=A.current)==null||Pe.call(A,"syakin.mp3",.8),(xe=A.current)==null||xe.call(A,"KO.mp3",.7),v.current){const qe=v.current,B=300,We=30,ut=B/We,Pt=qe.volume/ut;let ie=0;const He=setInterval(()=>{ie++,qe.volume=Math.max(0,qe.volume-Pt),ie>=ut&&(clearInterval(He),qe.pause(),v.current=null)},We)}Me([]);const Ne=Date.now(),mt=400,tt=1200;return ee=setInterval(()=>{const qe=Date.now()-Ne;if(qe<mt){const B=qe/mt,We=1-Math.pow(1-B,3),ut=10+We*160;if(f(ut),z(.75+We*((l?1.2:1.1)-.75)),k(-5+We*2),x(Math.max(1-B*3,0)),ut>90&&!R.current){R.current=!0;const ie=Array(120).fill(0).map((He,nt)=>{const Vt=nt/120*360,Bt=(Math.random()-.5)*8,zi=18+Math.random()*42;return{id:nt,angle:Vt+Bt,dist:200+Math.random()*400,size:zi*3,delay:Math.random()*.05}});re(ie)}}else{const B=Math.min((qe-mt)/tt,1),We=B<.5?2*B*B:1-Math.pow(-2*B+2,2)/2;if(f(170+We*10),x(0),!R.current){R.current=!0;const ut=Array(120).fill(0).map((Pt,ie)=>{const He=ie/120*360,nt=(Math.random()-.5)*8,Vt=18+Math.random()*42;return{id:ie,angle:He+nt,dist:200+Math.random()*400,size:Vt*3,delay:Math.random()*.05}});re(ut)}B>=1&&(ee&&clearInterval(ee),g.current("REVEAL"))}},16),()=>{ee&&clearInterval(ee)};case"REVEAL":let st=0;return ee=setInterval(()=>{st+=.25,x(Math.max(1-st,0)),p(Math.max(60-st*60,0)),st>=1&&(ee&&clearInterval(ee),re([]),g.current("ZOOM_OUT"))},40),()=>{ee&&clearInterval(ee)};case"ZOOM_OUT":{H({x:n,y:r});const qe=Date.now(),B=250,We=D,ut=-3;return ee=setInterval(()=>{const Pt=Date.now()-qe,ie=Math.min(Pt/B,1),He=1-Math.pow(1-ie,3);z(We-(We-.25)*He),k(ut*(1-He)),ie>=1&&(ee&&clearInterval(ee),f(180),j(0),z(.25),k(0),g.current("LAND"))},16),()=>{ee&&clearInterval(ee)}}case"LAND":return T.current(),ue(!0),Ee=setTimeout(()=>{g.current("DONE")},600),()=>clearTimeout(Ee)}return()=>{Ee&&clearTimeout(Ee),ee&&clearInterval(ee),v.current&&(v.current.pause(),v.current=null)}},[s]);const F=h+w,ve=S,ke=P?{x:(Math.random()-.5)*4,y:(Math.random()-.5)*4}:{x:0,y:0};return a.jsxs("div",{style:{position:"fixed",inset:0,zIndex:1e4,background:"rgba(0,0,0,0.75)",pointerEvents:"none"},children:[a.jsx("style",{children:`
                ${ye.map(Ee=>`
                    @keyframes chargeParticleIn-${Ee.id} {
                        0% { opacity: 0; transform: rotate(${Ee.angle}deg) translateX(${Ee.dist}px) scale(0.5); }
                        20% { opacity: 0.8; transform: rotate(${Ee.angle}deg) translateX(${Ee.dist*.8}px) scale(1.2); }
                        100% { opacity: 1; transform: rotate(${Ee.angle}deg) translateX(0) scale(0.2); } /* Keep visible at end */
                    }
                `).join("")}
                ${fe.map(Ee=>`
                    @keyframes burstParticleOut-${Ee.id} {
                        0% { opacity: 1; transform: translate(-50%, -50%) rotate(${Ee.angle}deg) translateX(0) scale(1.5); }
                        100% { opacity: 0; transform: translate(-50%, -50%) rotate(${Ee.angle}deg) translateX(${Ee.dist*1.5}px) scale(0); }
                    }
                `).join("")}
            `}),(u?ye.filter((Ee,ee)=>ee%2===0):ye).map(Ee=>a.jsx("div",{style:{position:"absolute",left:te.x,top:te.y,width:Ee.size*d,height:Ee.size*d,borderRadius:"50%",background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(200,230,255,0.6) 40%, transparent 70%)",boxShadow:u?"0 0 8px white":"0 0 10px white, 0 0 20px rgba(100,200,255,0.5)",filter:u?void 0:"blur(1px)",animation:`chargeParticleIn-${Ee.id} ${Ee.duration}s ease-in ${Ee.delay}s forwards`,transform:`rotate(${Ee.angle}deg) translateX(${Ee.dist*d}px)`,opacity:0,pointerEvents:"none"}},`charge-${Ee.id}`)),s==="WHITE_FADE"&&a.jsxs("div",{style:{position:"absolute",left:te.x+ke.x,top:te.y+ke.y,width:0,height:0,transformStyle:"preserve-3d"},children:[a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:500*d,height:500*d,border:"8px solid rgba(255, 255, 255, 0.6)",borderRadius:"50%",transform:"translate(-50%, -50%) rotateX(75deg)",boxShadow:u?"0 0 15px rgba(255, 255, 255, 0.6)":"0 0 30px rgba(255, 255, 255, 0.8), inset 0 0 30px rgba(255, 255, 255, 0.8)",animation:"ringSpin 2s linear infinite"}}),!u&&a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:600*d,height:600*d,border:"6px dashed rgba(100, 200, 255, 0.7)",borderRadius:"50%",transform:"translate(-50%, -50%) rotateX(80deg) rotateY(10deg)",boxShadow:"0 0 40px rgba(100, 200, 255, 0.5)",animation:"ringSpinReverse 3s linear infinite"}}),a.jsx("style",{children:`
                        @keyframes ringSpin {
                            0% { transform: translate(-50%, -50%) rotateX(75deg) rotate(0deg); opacity: 0; scale: 0.5; }
                            20% { opacity: 1; scale: 1; }
                            100% { transform: translate(-50%, -50%) rotateX(75deg) rotate(360deg); opacity: 1; scale: 1; }
                        }
                        @keyframes ringSpinReverse {
                            0% { transform: translate(-50%, -50%) rotateX(80deg) rotateY(10deg) rotate(0deg); opacity: 0; scale: 0.6; }
                            20% { opacity: 0.8; scale: 1; }
                            100% { transform: translate(-50%, -50%) rotateX(80deg) rotateY(10deg) rotate(-360deg); opacity: 0.8; scale: 1; }
                        }
                    `})]}),(u?fe.filter((Ee,ee)=>ee%2===0):fe).map(Ee=>a.jsx("div",{style:{position:"absolute",left:te.x,top:te.y,width:Ee.size*d,height:Ee.size*d,borderRadius:"50%",background:l?"radial-gradient(circle, rgba(183, 148, 244, 1) 0%, rgba(159, 122, 234, 0.8) 50%, transparent 100%)":"radial-gradient(circle, rgba(255, 251, 235, 1) 0%, rgba(251, 211, 141, 0.8) 50%, transparent 100%)",boxShadow:u?l?"0 0 8px #b794f4":"0 0 8px #fbd38d":l?"0 0 10px #b794f4, 0 0 20px rgba(159,122,234,0.6)":"0 0 10px #fbd38d, 0 0 20px rgba(251,211,141,0.6)",animation:`burstParticleOut-${Ee.id} 0.4s ease-out ${Ee.delay}s forwards`,pointerEvents:"none"}},`burst-${Ee.id}`)),a.jsxs("div",{style:{position:"absolute",left:te.x+ke.x,top:te.y+ke.y,transform:`translate(-50%, -50%) scale(${D}) perspective(1200px) rotateY(${F}deg) rotateZ(${ve}deg)`,transition:s==="ZOOM_IN"||s==="ZOOM_OUT"?"left 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), top 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)":"none",transformStyle:"preserve-3d"},children:[!u&&a.jsx("div",{style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:y*1.3,height:X*1.2,background:l?"radial-gradient(ellipse, rgba(159, 122, 234, 0.4) 0%, transparent 70%)":"radial-gradient(ellipse, rgba(251, 211, 141, 0.4) 0%, transparent 70%)",filter:"blur(20px)",pointerEvents:"none",opacity:I>1?1:0,transition:"opacity 0.4s"}}),a.jsxs("div",{style:{width:y,height:X,borderRadius:16,overflow:"hidden",boxShadow:u?l?"0 0 20px rgba(159, 122, 234, 0.5)":"0 0 20px rgba(251, 211, 141, 0.5)":l?"0 0 40px rgba(159, 122, 234, 0.7)":"0 0 40px rgba(251, 211, 141, 0.7)",position:"relative",transformStyle:"preserve-3d"},children:[a.jsxs("div",{style:{position:"absolute",inset:0,borderRadius:16,overflow:"hidden",background:"#1a202c",zIndex:F<=90?2:1,opacity:F<=90?1:0},children:[a.jsx("img",{src:et(t.imageUrl||""),alt:t.name,style:{width:"100%",height:"100%",objectFit:"cover",filter:`brightness(${1+_*.5}) contrast(${1-_*.2})`}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"white",opacity:_,pointerEvents:"none"}})]}),a.jsxs("div",{style:{position:"absolute",inset:0,transform:"rotateY(180deg)",borderRadius:16,overflow:"hidden",background:"#1a202c",zIndex:F>90?2:1,opacity:F>90?1:0},children:[a.jsx("img",{src:et(e&&e!==""?e:t.imageUrl||""),alt:`${t.name} Evolved`,style:{width:"100%",height:"100%",objectFit:"cover",filter:`brightness(${1+_*.5}) contrast(${1-_*.2})`}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"white",opacity:_,pointerEvents:"none"}})]})]})]}),q&&a.jsxs("div",{style:{position:"absolute",left:n,top:r,pointerEvents:"none"},children:[a.jsx("style",{children:`
                        @keyframes landParticleMove {
                            0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                            100% { opacity: 0; transform: translate(-50%, -50%) rotate(var(--angle)) translateX(calc(var(--dist) * 1px)) scale(0); }
                        }
                    `}),Array(20).fill(0).map((Ee,ee)=>{const Y=ee/20*360,Pe=40+Math.random()*100;return a.jsx("div",{style:{position:"absolute",left:0,top:0,width:8*d,height:8*d,borderRadius:"50%",background:"white","--angle":`${Y}deg`,"--dist":Pe,animation:"landParticleMove 0.5s ease-out forwards"}},`land-${ee}`)})]})]})},C_=et("/leaders/yoRuka_win.png"),k_=et("/leaders/yoRuka_lose.png"),_3=et("/leaders/senka_win.png"),x3=et("/leaders/senka_lose.png"),b3=et("/leaders/azya_win.png"),E3=et("/leaders/azya_lose.png"),S3=t=>({BRONZE:"#cd7f32",SILVER:"#c0c0c0",GOLD:"#ffd700",PLATINUM:"#e5e4e2",DIAMOND:"#b9f2ff",MASTER:"#ff4500"})[t],I3=({winnerId:t,playerId:e,playerClass:n,onRematch:r,onRematching:s,onLeave:i,isOnline:o,isRoomMatch:l=!0,myRematchRequested:c,opponentRematchRequested:d,battleStats:u,selectedCardInfo:h,onCardInfoClick:f,victoryReason:S="normal",isRankedMatch:k=!1,ratingResult:w})=>{const j=t===e,x=(()=>{if(!j)return null;switch(S){case"disconnect":return"";case"surrender":return"";default:return null}})(),[I,p]=N.useState("bg-fade"),D=["bg-fade","image","result-text","stats","rate","buttons","complete"].indexOf(I);N.useEffect(()=>{const v={"bg-fade":300,image:600,"result-text":400,stats:400,rate:300,buttons:0};if(I==="complete")return;const g={"bg-fade":"image",image:"result-text","result-text":"stats",stats:"rate",rate:"buttons",buttons:"complete"},T=setTimeout(()=>{const A=g[I];A&&p(A)},v[I]||0);return()=>clearTimeout(T)},[I]);const z=()=>n==="SENKA"?j?_3:x3:n==="AJA"?j?b3:E3:j?C_:k_,[te,H]=N.useState(15),[q,ue]=N.useState(!1),[ye,Me]=N.useState(null),fe=o?c||d:c||q;N.useEffect(()=>{if(fe)return;const v=setInterval(()=>{H(g=>g<=1?(clearInterval(v),i(),0):g-1)},1e3);return()=>clearInterval(v)},[i,fe]);const re=v=>{Me(v),o&&!l&&s?s(v):r(v)},P=()=>{const v=!o||l?"":"";return o?c&&d?"...":c?"...":d?`${v}`:v:c?"...":v},C=()=>{const v={padding:"15px 40px",fontSize:"1.5rem",fontWeight:"bold",border:"none",borderRadius:12,cursor:c?"default":"pointer",transform:"scale(1)",transition:"transform 0.1s, background 0.2s"};return d&&!c?{...v,background:"linear-gradient(135deg, #f6e05e, #d69e2e)",color:"black",boxShadow:"0 4px 15px rgba(246, 224, 94, 0.6)",animation:"pulse 1s infinite"}:c?{...v,background:"linear-gradient(135deg, #718096, #4a5568)",color:"white",boxShadow:"none"}:{...v,background:"linear-gradient(135deg, #48bb78, #38a169)",color:"white",boxShadow:"0 4px 15px rgba(72, 187, 120, 0.4)"}},R=(v,g)=>({width:220,height:220,borderRadius:"50%",border:ye===v?"5px solid #f6e05e":"4px solid rgba(255,255,255,0.4)",background:v==="AJA"?`url(${qa(v)}) center top/cover`:`url(${qa(v)}) center/cover`,cursor:"pointer",transform:g?"scale(1.1)":"scale(1)",transition:"all 0.2s ease",boxShadow:g?"0 0 30px rgba(246, 224, 94, 0.7)":"0 6px 15px rgba(0,0,0,0.5)"});return a.jsxs("div",{style:{position:"absolute",inset:0,zIndex:5e3,background:"rgba(0,0,0,0.85)",backdropFilter:"blur(10px)",display:"flex",flexDirection:"row",alignItems:"stretch",opacity:D>=0?1:0,transition:"opacity 0.3s ease-out"},onClick:()=>{},children:[a.jsx("style",{children:`
                @keyframes pulse {
                    0%, 100% { transform: scale(1); }
                    50% { transform: scale(1.05); }
                }
                @keyframes float {
                    0%, 100% { transform: translateY(0); }
                    50% { transform: translateY(-10px); }
                }
                @keyframes slideUpFadeIn {
                    0% { opacity: 0; transform: translateY(30px); }
                    100% { opacity: 1; transform: translateY(0); }
                }
                @keyframes imageFadeIn {
                    0% { opacity: 0; transform: scale(0.95); }
                    100% { opacity: 0.9; transform: scale(1); }
                }
            `}),a.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:40,borderRight:"1px solid rgba(255,255,255,0.1)"},children:h?a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:16,maxWidth:320},children:[a.jsx("div",{style:{width:200,height:280,backgroundImage:`url(${et(`/cards/${h.id}.png`)})`,backgroundSize:"cover",backgroundPosition:"center",borderRadius:12,boxShadow:"0 8px 30px rgba(0,0,0,0.6)"}}),a.jsx("div",{style:{fontFamily:"var(--font-tamanegi)",fontSize:"1.6rem",color:"white",textShadow:"0 2px 6px rgba(0,0,0,0.6)",textAlign:"center"},children:h.name}),a.jsxs("div",{style:{display:"flex",gap:20,fontSize:"1.2rem",color:"rgba(255,255,255,0.9)"},children:[a.jsxs("span",{children:[": ",h.cost]}),h.type==="FOLLOWER"&&a.jsxs(a.Fragment,{children:[a.jsxs("span",{children:[": ",h.attack]}),a.jsxs("span",{children:[": ",h.health]})]})]}),a.jsx("div",{style:{fontSize:"1rem",color:"rgba(255,255,255,0.7)",textAlign:"center",lineHeight:1.5,maxHeight:120,overflow:"auto"},children:h.description||""}),a.jsx("button",{onClick:()=>f(null),style:{padding:"8px 24px",fontSize:"1rem",background:"transparent",border:"1px solid rgba(255,255,255,0.3)",color:"white",borderRadius:8,cursor:"pointer",marginTop:10},children:""})]}):a.jsx("div",{style:{width:"100%",height:"100%",backgroundImage:`url(${z()})`,backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat",opacity:D>=1?.9:0,transform:D>=1?"scale(1)":"scale(0.95)",transition:"opacity 0.6s ease-out, transform 0.6s ease-out"}})}),a.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:40,position:"relative"},children:[a.jsx("div",{style:{fontFamily:"var(--font-tamanegi)",fontSize:"5rem",color:j?"#f6e05e":"#a0aec0",textShadow:j?"0 0 40px rgba(246, 224, 94, 0.7), 4px 4px 8px rgba(0,0,0,0.6)":"0 0 20px rgba(160, 174, 192, 0.5), 4px 4px 8px rgba(0,0,0,0.6)",marginBottom:20,opacity:D>=2?1:0,transform:D>=2?"translateY(0)":"translateY(30px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out",animation:D>=2?"float 3s ease-in-out infinite":"none"},children:j?"":""}),x&&a.jsx("div",{style:{fontSize:"1.1rem",color:"rgba(255, 255, 255, 0.8)",marginTop:-10,marginBottom:20,opacity:D>=2?1:0,transform:D>=2?"translateY(0)":"translateY(20px)",transition:"opacity 0.4s ease-out 0.2s, transform 0.4s ease-out 0.2s"},children:x}),a.jsxs("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"center",gap:16,marginBottom:30,padding:"16px 24px",background:"rgba(0,0,0,0.3)",borderRadius:12,border:"1px solid rgba(255,255,255,0.1)",opacity:D>=3?1:0,transform:D>=3?"translateY(0)":"translateY(30px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out"},children:[a.jsxs("div",{style:{textAlign:"center",minWidth:80},children:[a.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#f6e05e"},children:u.turnCount}),a.jsx("div",{style:{fontSize:"0.9rem",color:"rgba(255,255,255,0.6)"},children:""})]}),a.jsxs("div",{style:{textAlign:"center",minWidth:80},children:[a.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#48bb78"},children:u.damageDealtToOpponent}),a.jsx("div",{style:{fontSize:"0.9rem",color:"rgba(255,255,255,0.6)"},children:""})]}),a.jsxs("div",{style:{textAlign:"center",minWidth:80},children:[a.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#e53e3e"},children:u.damageReceivedFromOpponent}),a.jsx("div",{style:{fontSize:"0.9rem",color:"rgba(255,255,255,0.6)"},children:""})]}),a.jsxs("div",{style:{textAlign:"center",minWidth:80},children:[a.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#63b3ed"},children:u.followersDestroyed}),a.jsx("div",{style:{fontSize:"0.9rem",color:"rgba(255,255,255,0.6)"},children:""})]})]}),k&&w&&a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:8,marginTop:16,opacity:D>=4?1:0,transform:D>=4?"translateY(0)":"translateY(20px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out"},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,background:"rgba(0, 0, 0, 0.5)",padding:"12px 24px",borderRadius:12,border:`2px solid ${w.ratingChange>=0?"#48bb78":"#e53e3e"}`},children:[a.jsx("span",{style:{fontSize:"1.2rem",color:"rgba(255,255,255,0.8)",fontFamily:"var(--font-tamanegi)"},children:""}),a.jsxs("span",{style:{fontSize:"2rem",fontWeight:"bold",color:w.ratingChange>=0?"#48bb78":"#e53e3e",fontFamily:"var(--font-tamanegi)"},children:[w.ratingChange>=0?"+":"",w.ratingChange]})]}),w.ratingChange>0&&(w.bonusBreakdown.winStreakBonus>0||w.bonusBreakdown.rankDiffBonus>0)&&a.jsxs("div",{style:{display:"flex",gap:16,fontSize:"0.85rem",color:"rgba(255,255,255,0.6)",fontFamily:"var(--font-tamanegi)"},children:[a.jsxs("span",{children:[": +",w.bonusBreakdown.base]}),w.bonusBreakdown.winStreakBonus>0&&a.jsxs("span",{style:{color:"#f6e05e"},children:[": +",w.bonusBreakdown.winStreakBonus]}),w.bonusBreakdown.rankDiffBonus>0&&a.jsxs("span",{style:{color:"#63b3ed"},children:[": +",w.bonusBreakdown.rankDiffBonus]})]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,fontSize:"1rem",color:"rgba(255,255,255,0.8)",fontFamily:"var(--font-tamanegi)"},children:[a.jsx("span",{style:{color:S3(w.newRank),fontWeight:"bold"},children:ko[w.newRank]}),a.jsx("span",{children:w.newRating})]}),w.isRankUp&&a.jsxs("div",{style:{fontSize:"1.4rem",fontWeight:"bold",color:"#f6e05e",textShadow:"0 0 20px rgba(246, 224, 94, 0.8)",fontFamily:"var(--font-tamanegi)",animation:"pulse 1s ease-in-out infinite"},children:[ko[w.newRank],""]}),w.isRankDown&&a.jsxs("div",{style:{fontSize:"1.2rem",color:"#e53e3e",fontFamily:"var(--font-tamanegi)"},children:[ko[w.newRank],""]})]}),a.jsx("div",{style:{position:"absolute",right:20,bottom:270,width:180,textAlign:"center",fontFamily:"var(--font-tamanegi)",fontSize:"1.4rem",color:j?"#f6e05e":"#e53e3e",textShadow:j?"0 0 20px rgba(246, 224, 94, 0.8), 2px 2px 4px rgba(0,0,0,0.8)":"0 0 20px rgba(229, 62, 62, 0.8), 2px 2px 4px rgba(0,0,0,0.8)",zIndex:10,opacity:D>=5?1:0,transition:"opacity 0.4s ease-out"},children:j?"":""}),q&&!c?a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",animation:"fadeIn 0.3s ease-out"},children:[a.jsx("div",{style:{fontFamily:"var(--font-tamanegi)",fontSize:"1.6rem",color:"white",marginBottom:24,textShadow:"0 2px 6px rgba(0,0,0,0.6)"},children:""}),a.jsxs("div",{style:{display:"flex",gap:40,marginBottom:24},children:[a.jsx(R_,{deckType:"SENKA",label:"",onSelect:re,getStyle:R}),a.jsx(R_,{deckType:"AJA",label:"",onSelect:re,getStyle:R})]}),a.jsx("button",{onClick:()=>ue(!1),style:{padding:"10px 36px",fontSize:"1.1rem",fontWeight:"bold",background:"transparent",border:"2px solid rgba(255,255,255,0.3)",color:"white",borderRadius:10,cursor:"pointer",marginTop:8},children:""})]}):a.jsxs("div",{style:{display:"flex",gap:20,opacity:D>=5?1:0,transform:D>=5?"translateY(0)":"translateY(30px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out"},children:[a.jsx("button",{onClick:()=>{c||ue(!0)},disabled:c,style:C(),onMouseDown:v=>{c||(v.currentTarget.style.transform="scale(0.95)")},onMouseUp:v=>v.currentTarget.style.transform="scale(1)",children:P()}),a.jsxs("button",{onClick:i,style:{padding:"15px 40px",fontSize:"1.5rem",fontWeight:"bold",background:"transparent",border:"2px solid rgba(255,255,255,0.3)",color:"white",borderRadius:12,cursor:"pointer"},children:[" ",!fe&&`(${te})`]})]}),a.jsx("div",{onClick:()=>{q&&!c&&re("YORUKA")},style:{position:"absolute",right:20,bottom:20,width:180,height:240,backgroundImage:`url(${j?C_:k_})`,backgroundSize:"cover",backgroundPosition:"center",borderRadius:12,cursor:q&&!c?"pointer":"default",opacity:D>=5?.7:0,transition:"opacity 0.4s ease",boxShadow:"0 8px 20px rgba(0,0,0,0.4)"}})]})]})},R_=({deckType:t,label:e,onSelect:n,getStyle:r})=>{const[s,i]=N.useState(!1);return a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:12},children:[a.jsx("button",{onClick:()=>n(t),onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),style:r(t,s)}),a.jsx("span",{style:{color:"white",fontFamily:"var(--font-tamanegi)",fontSize:"1.4rem",textShadow:"0 2px 6px rgba(0,0,0,0.6)"},children:e})]})},A_=(t,e)=>{const[n,r]=N.useState([]),s=N.useRef(!1);return N.useEffect(()=>{r(i=>{const o=[],l=new Map((t||[]).filter(c=>c).map(c=>[c.instanceId,c]));return i.forEach(c=>{var u;if(!c)return;const d=l.get(c.instanceId);d?(o.push({...d,passiveAbilities:d.passiveAbilities?[...d.passiveAbilities]:[],hasBarrier:d.hasBarrier??((u=d.passiveAbilities)==null?void 0:u.includes("BARRIER"))??!1,isDying:!1}),l.delete(c.instanceId)):o.push({...c,isDying:!0,killedByBane:c.killedByBane})}),l.forEach(c=>{var d;o.push({...c,passiveAbilities:c.passiveAbilities?[...c.passiveAbilities]:[],hasBarrier:c.hasBarrier??((d=c.passiveAbilities)==null?void 0:d.includes("BARRIER"))??!1,isDying:!1})}),o})},[t]),N.useEffect(()=>{if(n.some(o=>o.isDying)){if(e!=null&&e.current){s.current=!0;return}const o=setTimeout(()=>{r(l=>l.filter(c=>!c.isDying))},700);return()=>clearTimeout(o)}},[n,e]),N.useEffect(()=>{const o=setInterval(()=>{if(!(e!=null&&e.current)&&s.current){s.current=!1;const l=setTimeout(()=>{r(c=>c.filter(d=>!d.isDying))},300);return()=>clearTimeout(l)}},100);return()=>clearInterval(o)},[e]),n},w3=({playerClass:t,opponentType:e,gameMode:n,targetRoomId:r,onLeave:s,onRematching:i,networkAdapter:o,networkConnected:l,opponentClass:c,aiDifficulty:d="NORMAL",playerName:u,timerEnabled:h=!0,playerId:f,opponentPlayerId:S,opponentRating:k})=>{var Om,Lm,Dm,Mm,Nm,jm,$m,Fm,Um;const w=n==="CPU"||!o,j=t3(w?n==="CPU"?"CPU":n:"CPU",w?r:void 0),_=o||j.adapter,x=l!==void 0?l:j.connected,I=c3(),{scale:p,toGameX:D,toGameY:z}=I,{isLightMode:te}=eI(),[H,q]=L.useState(!1);L.useEffect(()=>{(()=>{q("ontouchstart"in window||navigator.maxTouchPoints>0)})()},[]);const ue=L.useCallback((m,b)=>({x:D(m),y:z(b)}),[D,z]),[ye,Me]=L.useState(null),fe=N.useRef(I);L.useEffect(()=>{fe.current=I},[I]);const re=n==="CPU"||n==="HOST"||(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&(_==null?void 0:_.isHost)===!0,P=re?"p1":"p2",C=re?"p2":"p1";console.log("[GameScreen INIT]",{gameMode:n,"adapter?.isHost":_==null?void 0:_.isHost,isHost:re,currentPlayerId:P,connected:x,"networkAdapter provided":!!o,networkConnected:l});const R=c||(t==="YORUKA"?Math.random()<.5?"SENKA":"AJA":t==="SENKA"?"AJA":"SENKA"),v=n==="JOIN"||(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&!re,[g,T]=L.useReducer(f2,null,()=>{const m=n==="CPU"?"CPU":"";return v?rd(m,R,u,t):rd(u,t,m,R)}),[A,y]=L.useState(!v),X=n==="CASUAL_MATCH"||n==="RANKED_MATCH",[F,ve]=N.useState(X?!1:!v),[ke,Ee]=N.useState(!1),[ee,Y]=N.useState(!1),[Pe,xe]=N.useState(!1),[$e,Te]=N.useState(X),[Ne,mt]=N.useState(!1),tt=N.useRef(!1);console.log("[GameScreen SYNC STATE]",{isCasualOrRanked:X,isJoinSide:v,gameSynced:A,waitingForIntroSync:$e,opponentReadyForIntro:Ne,showBattleIntro:F,"introSyncSentRef.current":tt.current});const[st,qe]=N.useState(!1),[B,We]=N.useState(null),[ut,Pt]=N.useState(0),[ie,He]=N.useState({x:0,y:0}),[nt,Vt]=N.useState("IDLE"),[Bt,zi]=N.useState(null),[Qu,Ju]=N.useState(!1),[as,W0]=N.useState(()=>Math.random()>.5),[nI,G0]=N.useState(!1),[V0,Y0]=N.useState(!1),[rI,K0]=N.useState("normal"),[br,X0]=N.useState(t),[Ql,na]=N.useState({turnCount:0,damageDealtToOpponent:0,damageReceivedFromOpponent:0,followersDestroyed:0,myFollowersDestroyed:0}),[sI,qu]=N.useState(null),[iI,oI]=N.useState(null),[Q0,J0]=N.useState(!1);N.useEffect(()=>{if(n!=="RANKED_MATCH"||!f||!g.winnerId||Q0)return;(async()=>{try{const b=await cS(f,br),E=g.winnerId===P;let O;E?O=lL(b.rating,b.winStreak,k??0):O=cL(b.rating),await uL(f,br,O,E),oI(O),J0(!0),console.log("[RatingUpdate] Rating updated:",O)}catch(b){console.error("[RatingUpdate] Failed to update rating:",b),J0(!0)}})()},[n,f,g.winnerId,P,br,k,Q0]),N.useEffect(()=>{g.winnerId&&!st&&!Pe&&xe(!0)},[g.winnerId,st,Pe]),N.useEffect(()=>{if(ut<=0){He({x:0,y:0});return}let m;const b=()=>{const E=Date.now()*.03,O=25*ut*p,M=Math.sin(E*7)*O+Math.sin(E*13)*O*.5,G=Math.cos(E*11)*O+Math.cos(E*17)*O*.3;He({x:M,y:G}),m=requestAnimationFrame(b)};return m=requestAnimationFrame(b),()=>cancelAnimationFrame(m)},[ut,p]);const[Zu,q0]=N.useState([]),aI=N.useRef(0),[ef,Z0]=N.useState(!1),[tf,Jl]=N.useState(null),[ra,Hi]=N.useState(null),jr=N.useRef(null),Er=N.useRef(null),Sr=N.useRef(null),nf=N.useRef(g.logs.length),ql=L.useRef(!1),em=L.useRef(!1),Zl=L.useRef(null);L.useEffect(()=>{const m=n==="HOST"||(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&re,b=X?x&&_:x&&_&&nt==="DONE";if(console.log("[GameScreen INIT_GAME useEffect]",{isHostSide:m,isCasualOrRanked:X,connected:x,"adapter exists":!!_,coinTossPhase:nt,canSendInitGame:b,"initialStateSentRef.current":ql.current}),m&&b&&!ql.current){console.log("[GameScreen] HOST side: Sending initial game state to JOIN"),ql.current=!0;const E=()=>{console.log("[GameScreen] HOST side: Actually sending INIT_GAME now, isFirstPlayer:",as);const O=X?{...g,firstPlayerId:as?"p1":"p2"}:g;_.send({type:"INIT_GAME",payload:O}),(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&(console.log("[GameScreen] HOST side: Sending READY_FOR_INTRO"),_.send({type:"READY_FOR_INTRO"}),tt.current=!0)};setTimeout(E,500),(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&setTimeout(()=>{Ne||(console.log("[GameScreen] HOST side: Retrying INIT_GAME (no response yet)"),E())},2500)}},[n,x,_,g,nt,re,X,Ne]),L.useEffect(()=>{!X||!_||!A||tt.current||v&&(console.log("[GameScreen] JOIN side: Sending READY_FOR_INTRO after game sync"),_.send({type:"READY_FOR_INTRO"}),tt.current=!0)},[X,_,A,v]),L.useEffect(()=>{!X||!_||!$e||re&&Ne&&tt.current&&(console.log("[GameScreen] HOST side: Both ready, sending START_INTRO"),_.send({type:"START_INTRO"}),Te(!1),ve(!0))},[X,_,re,Ne,$e]);const ae=g.players[P],Le=g.players[C];L.useEffect(()=>{var b,E;const m=g.logs.length;if(m>nf.current)for(let O=nf.current;O<m;O++){const M=g.logs[O],G=M.match(/(.+?)  (\d+) /);if(G){const $=G[1],U=parseInt(G[2],10),V=(ae==null?void 0:ae.name)===$?P:C,ce=aI.current++;q0(Z=>[...Z,{playerId:V,amount:U,key:ce}]),setTimeout(()=>{q0(Z=>Z.filter(pe=>pe.key!==ce))},1500)}const J=M.match(/(.+?) (?:)?/);if(J){const $=J[1],U=(b=g.players[P])==null?void 0:b.board.find(pe=>(pe==null?void 0:pe.name)===$),V=(E=g.players[C])==null?void 0:E.board.find(pe=>(pe==null?void 0:pe.name)===$),ce=U||V,Z=U?P:C;if(ce){const pe=g.players[Z].board.findIndex(Ie=>(Ie==null?void 0:Ie.instanceId)===ce.instanceId),Xe=(Z===P?Ir.current:ir.current)[pe];if(Xe){const Ie=Xe.getBoundingClientRect(),Ye=Ie.left+Ie.width/2,Ze=Ie.top+Ie.height/2;cc(Ge=>[...Ge,{id:Date.now()+Math.random(),value:0,x:Ye,y:Ze,color:"#e53e3e"}])}}}}nf.current=m},[g.logs.length,P,C,ae==null?void 0:ae.name,g.players]);const[rf,sa]=N.useState(!1),$r=N.useRef(!1),_n=A_(((Om=g.players[P])==null?void 0:Om.board)||[],$r),un=A_(((Lm=g.players[C])==null?void 0:Lm.board)||[],$r),ia=N.useRef(_n),ec=N.useRef(un),[si,tc]=N.useState(null),[sf,tm]=N.useState(-1),nc=N.useRef(null),[Wi,oa]=N.useState([]),[Q,Fr]=N.useState(null),[ft,Yn]=N.useState(null),[lI,nm]=N.useState([]),cI=N.useRef(0),rm=N.useRef(0),sm=N.useRef(null),im=N.useRef(Q);im.current=Q,N.useEffect(()=>{const m=Q==null?void 0:Q.sourceType;if(!m||m!=="BOARD"&&m!=="EVOLVE"){nm([]);return}const b=400,E=setInterval(()=>{const O=im.current;if(!O||O.sourceType!=="BOARD"&&O.sourceType!=="EVOLVE")return;const M=Date.now(),G=Math.PI*(3-Math.sqrt(5));rm.current+=G+(Math.random()-.5)*.3;const J=rm.current,$=4+Math.random()*3,U={id:cI.current++,x:O.currentX,y:O.currentY,vx:Math.cos(J)*$,vy:Math.sin(J)*$,opacity:1,radius:3+Math.random()*2,createdAt:M};nm(V=>[...V.filter(Z=>M-Z.createdAt<b).map(Z=>({...Z,x:Z.x+Z.vx,y:Z.y+Z.vy,opacity:Math.max(0,1-(M-Z.createdAt)/b)})),U])},80);return()=>clearInterval(E)},[Q==null?void 0:Q.sourceType]),N.useEffect(()=>{const m=(Q==null?void 0:Q.sourceType)==="EVOLVE";if(m&&!Sr.current){const b=new Audio(et("/se/aura.mp3"));b.loop=!0,b.volume=0,b.play().catch(()=>{}),Sr.current=b;const E=300,O=30,M=E/O,G=.25/M;let J=0;const $=setInterval(()=>{J++,Sr.current&&(Sr.current.volume=Math.min(J*G,.25)),J>=M&&clearInterval($)},O)}else if(!m&&Sr.current){const b=Sr.current,E=200,O=20,M=E/O,G=b.volume/M;let J=0;const $=setInterval(()=>{J++,b.volume=Math.max(0,b.volume-G),J>=M&&(clearInterval($),b.pause(),b.currentTime=0)},O);Sr.current=null}return()=>{!Q&&Sr.current&&(Sr.current.pause(),Sr.current=null)}},[Q==null?void 0:Q.sourceType]);const[om,of]=N.useState(new Set),[am,rc]=N.useState(null),[lm,sc]=N.useState(null),[dI,cm]=N.useState(null),[Fe,Ur]=N.useState(null),af=N.useCallback(m=>{const b=Wr(m);b&&(g.winnerId?qu(b):Ur({card:b,owner:"OPPONENT",source:"LOG"}))},[g.winnerId]),uI=N.useCallback(m=>{const b=/([^]+)/g,E=[];let O=0,M,G=0;const J=Z1();for(;(M=b.exec(m))!==null;){M.index>O&&E.push(a.jsx("span",{children:m.slice(O,M.index)},G++));const $=M[1];J.includes($)?E.push(a.jsxs("span",{style:{color:"#ffd700",cursor:"pointer",textDecoration:"underline",textUnderlineOffset:"2px",fontWeight:"bold"},onMouseEnter:V=>{V.target.style.color="#ffec8b",V.target.style.textShadow="0 0 8px rgba(255, 215, 0, 0.8)"},onMouseLeave:V=>{V.target.style.color="#ffd700",V.target.style.textShadow="none"},onClick:V=>{V.stopPropagation(),af($)},children:["",$,""]},G++)):E.push(a.jsxs("span",{children:["",$,""]},G++)),O=M.index+M[0].length}return O<m.length&&E.push(a.jsx("span",{children:m.slice(O)},G++)),E.length>0?a.jsx(a.Fragment,{children:E}):m},[af]),[ic,Gi]=N.useState([]),Ht=(m,b,E,O)=>{if(!m)return;let M=window.innerWidth/2,G=window.innerHeight/2;const J=b===C;if(E===void 0||E===-1){const U=J?Yi:oi;if(U.current){const V=U.current.getBoundingClientRect(),ce=ue(V.left+V.width/2,V.top+V.height/2);M=ce.x,G=ce.y}else G=J?150:tI-250}else if(E!==void 0&&E>=0){const U=J?ir:Ir,V=J?ec.current:ia.current;let ce=E;if(O){const pe=V.findIndex(be=>be&&be.instanceId===O);pe>=0&&(ce=pe)}const Z=U.current[ce];if(Z){const pe=Z.getBoundingClientRect(),be=ue(pe.left+pe.width/2,pe.top+pe.height/2);M=be.x,G=be.y}}Gi(U=>[...U,{type:m,x:M,y:G,key:Date.now()+Math.random()}])},dm=(m,b,E,O,M)=>{let G=window.innerWidth/2,J=window.innerHeight/2;const $=m===C,U=$?ir:Ir,V=$?ec.current:ia.current;let ce=b;if(M){const pe=V.findIndex(be=>be&&be.instanceId===M);pe>=0&&(ce=pe)}const Z=U.current[ce];if(Z){const pe=Z.getBoundingClientRect(),be=ue(pe.left+pe.width/2,pe.top+pe.height/2);G=be.x,J=be.y}Gi(pe=>[...pe,{type:"BUFF",x:G,y:J,key:Date.now()+Math.random(),atkBuff:E,hpBuff:O}])},sr=(m,b,E,O)=>{Ht(m,b,E,O),n==="HOST"&&x&&_&&_.send({type:"EFFECT",payload:{effectType:m,targetPlayerId:b||"",targetIndex:E??-1,targetInstanceId:O}})},aa=(m,b,E,O,M)=>{dm(m,b,E,O,M),n==="HOST"&&x&&_&&_.send({type:"EFFECT",payload:{effectType:"BUFF",targetPlayerId:m,targetIndex:b,targetInstanceId:M,isBuff:!0,atkBuff:E,hpBuff:O}})},um=N.useRef([]),fm=N.useRef([]);N.useEffect(()=>{var O,M;const m=(G,J,$)=>{J.forEach(U=>{if(!U)return;if(!G.find(ce=>ce&&ce.instanceId===U.instanceId)&&U.killedByBane){const ce=$===C,Z=ce?ir:Ir,be=(ce?ec.current:ia.current).findIndex(Xe=>Xe&&Xe.instanceId===U.instanceId);if(be>=0&&Z.current[be]){const Ie=Z.current[be].getBoundingClientRect(),Ye=ue(Ie.left+Ie.width/2,Ie.top+Ie.height/2);Gi(Ze=>[...Ze,{type:"BANE",x:Ye.x,y:Ye.y,key:Date.now()+Math.random()}])}}})},b=((O=g.players[P])==null?void 0:O.board)||[],E=((M=g.players[C])==null?void 0:M.board)||[];m(b,um.current,P),m(E,fm.current,C),um.current=b.map(G=>G?{...G}:null),fm.current=E.map(G=>G?{...G}:null)},[g.players,P,C]);const lf=600,[ls,la]=N.useState(null),cf=N.useRef({player:0,opponent:0}),[Tt,ca]=N.useState(()=>{try{const m=localStorage.getItem("audioSettings");if(m){const b=JSON.parse(m);if(b.enabled!==void 0){const{enabled:E,...O}=b;return{...O,bgmEnabled:E,seEnabled:E}}return b}return{bgm:.3,se:.5,voice:.5,bgmEnabled:!0,seEnabled:!0}}catch{return{bgm:.3,se:.5,voice:.5,bgmEnabled:!0,seEnabled:!0}}}),vt=N.useCallback((m,b=.5)=>{if(!Tt.seEnabled)return;const E=new Audio(et(`/se/${m}`));E.volume=Tt.se*b,E.play().catch(O=>console.warn("SE Play prevented",O))},[Tt]),oc=N.useRef(null);N.useEffect(()=>{if(Q&&ft&&!oc.current)vt("Buon.mp3",.25);else if(Q&&ft&&oc.current){const m=oc.current;(m.instanceId!==ft.instanceId||m.index!==ft.index||m.playerId!==ft.playerId)&&vt("Buon.mp3",.25)}oc.current=ft},[ft,Q,vt]);const xn=N.useRef(null),[fI,hm]=N.useState(!1);N.useEffect(()=>{localStorage.setItem("audioSettings",JSON.stringify(Tt)),xn.current&&(xn.current.volume=Tt.bgmEnabled?Tt.bgm:0,Tt.bgmEnabled?xn.current.paused&&xn.current.play().catch(m=>console.warn("Auto-play prevented",m)):xn.current.pause())},[Tt]);const[hI,ac]=N.useState(!1),[pI,df]=N.useState(!1),[gI,lc]=N.useState(!1),mI=N.useCallback(()=>{console.log("[GameScreen] handleSurrender called"),lc(!1),ac(!1),n!=="CPU"&&_&&_.send({type:"SURRENDER",payload:{playerId:P}}),T({type:"CONCEDE",playerId:P})},[n,_,P]),[Br,uf]=N.useState(!1),ff=N.useRef(!1),[pm,gm]=N.useState(!1),[it,ii]=N.useState(null),Vi=N.useRef(null),Yi=N.useRef(null),ir=N.useRef([]),Ir=N.useRef([]),oi=N.useRef(null),[yI,cc]=N.useState([]),dc=N.useRef({player:20,opponent:20}),uc=N.useRef({player:0,opponent:0}),da=N.useRef(new Map);N.useEffect(()=>{var M,G,J,$;if(!ae||!Le)return;const m=dc.current.opponent-Le.hp;m>0&&na(U=>({...U,damageDealtToOpponent:U.damageDealtToOpponent+m}));const b=dc.current.player-ae.hp;b>0&&na(U=>({...U,damageReceivedFromOpponent:U.damageReceivedFromOpponent+b}));const E=uc.current.opponent-(((M=Le.board)==null?void 0:M.filter(U=>U).length)||0);E>0&&na(U=>({...U,followersDestroyed:U.followersDestroyed+E}));const O=uc.current.player-(((G=ae.board)==null?void 0:G.filter(U=>U).length)||0);O>0&&na(U=>({...U,myFollowersDestroyed:U.myFollowersDestroyed+O})),dc.current={player:ae.hp,opponent:Le.hp},uc.current={player:((J=ae.board)==null?void 0:J.filter(U=>U).length)||0,opponent:(($=Le.board)==null?void 0:$.filter(U=>U).length)||0}},[ae==null?void 0:ae.hp,Le==null?void 0:Le.hp,(Dm=ae==null?void 0:ae.board)==null?void 0:Dm.length,(Mm=Le==null?void 0:Le.board)==null?void 0:Mm.length]);const sn=N.useRef(null),mm="lastPlayedBgm",ym=N.useCallback(m=>{const b={AJA:[et("/bgm/Green Misty Mountains.mp3"),et("/bgm/Jade Moon.mp3"),et("/bgm/amaama.mp3"),et("/bgm/kingetsu.mp3")],SENKA:[et("/bgm/ouka.mp3"),et("/bgm/Jade Moon.mp3"),et("/bgm/amaama.mp3"),et("/bgm/kingetsu.mp3")]},E=b[m]||b.SENKA,O=sessionStorage.getItem(mm),M=E.length>1?E.filter(J=>J!==O):E,G=M[Math.floor(Math.random()*M.length)];return sessionStorage.setItem(mm,G),encodeURI(G)},[]),[hf,vm]=N.useState(null);N.useEffect(()=>{var m,b;if(console.log(`[PendingEffects] useEffect fired. isProcessingEffect=${rf}, pendingEffects.length=${((m=g.pendingEffects)==null?void 0:m.length)||0}, gameMode=${n}`),n==="JOIN"){console.log("[PendingEffects] Early return: JOIN mode waits for EFFECT messages from HOST");return}if(rf){console.log("[PendingEffects] Early return: isProcessingEffect=true");return}if(g.pendingEffects&&g.pendingEffects.length>0){const E=g.pendingEffects[0];if(console.log(`[PendingEffects] Processing effect: ${E.effect.type} from ${E.sourceCard.name}`),nc.current===E){console.log("[PendingEffects] Early return: same effect already processed");return}if(nc.current=E,sa(!0),$r.current=!0,E.effect.type==="GENERATE_CARD"&&E.effect.targetCardId){const ge=[E],K=g.pendingEffects||[];for(let Re=1;Re<K.length;Re++){const _e=K[Re];if(_e.effect.type==="GENERATE_CARD"&&_e.sourceCard.id===E.sourceCard.id&&_e.sourcePlayerId===E.sourcePlayerId)ge.push(_e);else break}const le=120,ne=20,W=-(ge.length*le+(ge.length-1)*ne-le)/2,se=E.sourcePlayerId===P,me=se?window.innerWidth-200*p:200*p,Oe=se?window.innerHeight-100*p:100*p,we=ge.map((Re,_e)=>({card:Wr(Re.effect.targetCardId),status:"APPEAR",targetX:me,targetY:Oe,xOffset:W+_e*(le+ne)})).filter(Re=>Re.card);if(we.length>0){oa(we),sn.current&&clearTimeout(sn.current),sn.current=setTimeout(()=>{oa(Re=>Re.map(_e=>({..._e,status:"FLY"}))),sn.current=setTimeout(()=>{oa([]),sa(!1),$r.current=!1,(n==="CPU"||n==="HOST")&&(ge.forEach(Re=>{T({type:"RESOLVE_EFFECT",playerId:Re.sourcePlayerId,payload:{targetId:Re.targetId}})}),n==="HOST"&&x&&_&&setTimeout(()=>{const Re=rt.current;_.send({type:"GAME_STATE",payload:Re})},50)),sn.current=null},600)},800);return}}const O=E.effect.type==="DAMAGE"||E.effect.type==="AOE_DAMAGE"||E.effect.type==="RANDOM_DAMAGE"||E.effect.type==="RANDOM_DAMAGE_BY_TURN",M=E.effect.type==="DESTROY"||E.effect.type==="RANDOM_DESTROY",G=E.effect.type==="HEAL_LEADER",J=E.effect.type==="RANDOM_SET_HP",$=E.effect.type==="SET_MAX_HP",U=E.effect.type==="RETURN_TO_HAND",V=E.effect.type==="SUMMON_CARD"||E.effect.type==="SUMMON_CARD_RUSH",ce=E.effect.type==="VISUAL_BUFF_ONLY",Z=E.effect.type==="BUFF_STATS",pe=G||U||V||ce||Z?600:50;if(O){let ge=E.sourceCard.attackEffectType||"SLASH";E.sourceCard.id==="c_alice"&&E.effect.targetType==="SELECT_FOLLOWER"&&(ge="WATER");const K=E.sourcePlayerId===P?C:P,le=K===P?_n:un;if(E.effect.type==="AOE_DAMAGE")g.players[K].board.forEach(oe=>{if(oe){const W=le.findIndex(se=>(se==null?void 0:se.instanceId)===oe.instanceId);W!==-1&&sr(ge,K,W,oe.instanceId)}});else if(E.targetIds)E.effect.type==="RANDOM_DAMAGE_BY_TURN"?E.targetIds.forEach((oe,W)=>{setTimeout(()=>{const se=le.findIndex(me=>(me==null?void 0:me.instanceId)===oe);se!==-1&&sr(ge,K,se,oe)},W*300)}):E.targetIds.forEach(ne=>{const oe=le.findIndex(W=>(W==null?void 0:W.instanceId)===ne);oe!==-1&&sr(ge,K,oe,ne)});else if(E.effect.targetType==="OPPONENT")sr(ge,K,-1),$n();else if(E.targetId){const ne=le.findIndex(oe=>(oe==null?void 0:oe.instanceId)===E.targetId);ne!==-1&&sr(ge,K,ne,E.targetId)}}else if(M){let ge=E.sourceCard.attackEffectType||"IMPACT";const K=E.sourcePlayerId===P?C:P,le=K===P?_n:un;if(E.effect.targetType==="ALL_OTHER_FOLLOWERS"){le.forEach((W,se)=>{W&&W.instanceId!==E.sourceCard.instanceId&&sr(ge,K,se,W.instanceId)});const ne=E.sourcePlayerId;(ne===P?_n:un).forEach((W,se)=>{W&&W.instanceId!==E.sourceCard.instanceId&&sr(ge,ne,se,W.instanceId)}),$n()}else if(E.targetIds)E.targetIds.forEach(ne=>{const oe=le.findIndex(W=>(W==null?void 0:W.instanceId)===ne);oe!==-1&&sr(ge,K,oe,ne)});else if(E.targetId){const ne=le.findIndex(oe=>(oe==null?void 0:oe.instanceId)===E.targetId);ne!==-1&&sr(ge,K,ne,E.targetId)}}else if(G){const ge=E.sourcePlayerId;sr("HEAL",ge)}else if($){const ge=E.sourcePlayerId===P?C:P;sr("RAY",ge,-1),$n()}if(E.effect.type==="BUFF_STATS"){const ge=E.effect.value??0,K=E.effect.value2??0,le=E.sourcePlayerId;if(E.effect.targetType==="SELF"){const oe=(le===P?_n:un).findIndex(W=>(W==null?void 0:W.instanceId)===E.sourceCard.instanceId);oe!==-1&&aa(le,oe,ge,K,E.sourceCard.instanceId)}else if(E.effect.targetType==="ALL_FOLLOWERS"){const ne=le===P?_n:un,oe=g.players[le].board,W=E.effect.conditions;oe.forEach(se=>{var me;if(se){if(W!=null&&W.tag&&!((me=se.tags)!=null&&me.includes(W.tag))||W!=null&&W.nameIn&&!W.nameIn.includes(se.name))return;const Oe=ne.findIndex(we=>(we==null?void 0:we.instanceId)===se.instanceId);Oe!==-1&&aa(le,Oe,ge,K,se.instanceId)}})}else if(E.effect.targetType==="ALL_OTHER_FOLLOWERS"){const ne=le===P?_n:un,oe=g.players[le].board,W=E.effect.conditions;oe.forEach(se=>{var me;if(se&&se.instanceId!==E.sourceCard.instanceId){if(W!=null&&W.tag&&!((me=se.tags)!=null&&me.includes(W.tag))||W!=null&&W.nameIn&&!W.nameIn.includes(se.name))return;const Oe=ne.findIndex(we=>(we==null?void 0:we.instanceId)===se.instanceId);Oe!==-1&&aa(le,Oe,ge,K,se.instanceId)}})}else if(E.targetId){const oe=(le===P?_n:un).findIndex(W=>(W==null?void 0:W.instanceId)===E.targetId);oe!==-1&&aa(le,oe,ge,K,E.targetId)}}if(ce){const ge=E.effect.value??0,K=E.effect.value2??0,le=E.sourcePlayerId,ne=E.sourceCard;setTimeout(()=>{const oe=le===P?_n:un;if(ne!=null&&ne.instanceId){const W=oe.findIndex(se=>(se==null?void 0:se.instanceId)===ne.instanceId);W!==-1&&aa(le,W,ge,K,ne.instanceId)}},300)}sn.current&&clearTimeout(sn.current);const Xe=O||M||J||$,Ie=E.effect.type==="RANDOM_DAMAGE_BY_TURN",Ye=Ie?((b=E.targetIds)==null?void 0:b.length)||g.turnCount:1,Ze=Ie?Ye*300+300:0,Ge=Ie?Ze:Xe?700:pe,Ve=Ie?200:Xe?700:0;sn.current=setTimeout(()=>{(n==="CPU"||n==="HOST")&&(T({type:"RESOLVE_EFFECT",playerId:E.sourcePlayerId,payload:{targetId:E.targetId}}),n==="HOST"&&x&&_&&setTimeout(()=>{const ge=rt.current;_.send({type:"GAME_STATE",payload:ge})},50)),Ve>0?sn.current=setTimeout(()=>{sa(!1),$r.current=!1,sn.current=null},Ve):(sa(!1),$r.current=!1,sn.current=null)},Ge)}else nc.current=null,sn.current&&(clearTimeout(sn.current),sn.current=null)},[g.pendingEffects,rf,P,C,n,x,_]),N.useEffect(()=>{if(g.activePlayerId!==P)return;const m=P===g.firstPlayerId,b=g.turnCount,E=m?5:4;if(b===(m?7:6)){if(sf===b)return;tc("SUPER_EVOLVE_READY"),tm(b),setTimeout(()=>tc(null),2500)}else if(b===E){if(sf===b)return;tc("EVOLVE_READY"),tm(b),setTimeout(()=>tc(null),2500)}},[g.turnCount,g.activePlayerId,P,sf,g.firstPlayerId]);const fc=N.useRef(g.players);N.useEffect(()=>{const m=fc.current,b=new Set;if(Object.keys(g.players).forEach(E=>{const O=g.players[E],M=m[E];if(!M)return;const G=new Set(M.board.filter($=>$).map($=>$.instanceId)),J=new Set(M.hand.filter($=>$).map($=>$.instanceId));O.board.forEach($=>{if(!$)return;const U=$.instanceId;!G.has(U)&&!J.has(U)&&b.add(U)})}),b.size>0){of(O=>new Set([...O,...b]));const E=setTimeout(()=>{of(new Set)},1e3);return()=>clearTimeout(E)}},[g.players]),N.useEffect(()=>{const m=fc.current,b=g.players;let E=[];const O=M=>{const G=M.getBoundingClientRect();return{x:G.left+G.width/2,y:G.top+G.height/2}};Object.keys(b).forEach(M=>{const G=b[M],J=m[M];if(J&&G.hp<J.hp){const $=J.hp-G.hp,V=M===P?oi.current:Yi.current;if(V){const ce=O(V);E.push({id:Date.now()+Math.random(),value:$,x:ce.x,y:ce.y,color:"#e53e3e"})}}else if(J&&G.hp>J.hp){const $=G.hp-J.hp,V=M===P?oi.current:Yi.current;if(V){const ce=O(V);E.push({id:Date.now()+Math.random(),value:"+"+$,x:ce.x,y:ce.y,color:"#48bb78"})}}J==null||J.board.forEach($=>{if(!$)return;const U=G.board.find(V=>(V==null?void 0:V.instanceId)===$.instanceId);if(U){const V=G.board.findIndex(be=>(be==null?void 0:be.instanceId)===U.instanceId),pe=(M===P?Ir.current:ir.current)[V];if(pe){const be=O(pe);if(da.current.set($.instanceId,be),U.currentHealth<$.currentHealth){const Xe=$.currentHealth-U.currentHealth;E.push({id:Date.now()+Math.random(),value:Xe,x:be.x,y:be.y,color:"#e53e3e"})}else if(U.currentHealth>$.currentHealth){const Xe=U.hasEvolved&&!$.hasEvolved,Ie=U.currentAttack!==$.currentAttack||U.maxHealth!==$.maxHealth;if(!Xe&&!Ie){const Ye=U.currentHealth-$.currentHealth;E.push({id:Date.now()+Math.random(),value:"+"+Ye,x:be.x,y:be.y,color:"#48bb78"})}}else U.currentHealth===$.currentHealth&&$.hasBarrier&&!U.hasBarrier&&E.push({id:Date.now()+Math.random(),value:0,x:be.x,y:be.y,color:"#e53e3e"})}}else{const V=G.graveyard.find(Z=>Z.instanceId===$.instanceId);let ce=0;if(V){const Z=V.currentHealth||0;Z<=0?ce=$.currentHealth-Z:ce=0}else ce=$.currentHealth;if(ce>0){const Z=da.current.get($.instanceId);Z&&(Z.x!==0||Z.y!==0)&&E.push({id:Date.now()+Math.random(),value:ce,x:Z.x,y:Z.y,color:"#e53e3e"})}da.current.delete($.instanceId)}})}),E.length>0&&(cc(G=>[...G,...E]),E.some(G=>G.color!=="#48bb78")&&$n()),fc.current=b},[g.players,P,C]);const pf=N.useRef(null),$n=()=>{pf.current||(gm(!0),pf.current=setTimeout(()=>{gm(!1),pf.current=null},300))},gf=L.useCallback(m=>{cc([]),Gi([]),oa([]),Fn(null),Ki(null),la(null),of(new Set),cs.current=!1,mf.current=null,na({turnCount:0,damageDealtToOpponent:0,damageReceivedFromOpponent:0,followersDestroyed:0,myFollowersDestroyed:0}),dc.current={player:20,opponent:20},uc.current={player:0,opponent:0},qu(null),xe(!1),qe(!1),We(null),G0(!1),Y0(!1);const b=m||br;m&&X0(m);let E=R;e==="CPU"&&(b==="YORUKA"?E=Math.random()<.5?"SENKA":"AJA":E=b==="SENKA"?"AJA":"SENKA");const M=rd(u,b,e==="ONLINE"?"":"CPU",E);fc.current=M.players,cf.current={player:M.players.p1.hand.length,opponent:M.players.p2.hand.length},vm(null),ve(n!=="JOIN"),W0(Math.random()>.5),Vt("IDLE"),zi(null),Ju(!1),n==="HOST"&&(ql.current=!1),T({type:"SYNC_STATE",payload:M})},[br,R,e,n]),vI=L.useCallback(()=>{if(ve(!1),Ee(!1),Y(!0),zi(as?"FIRST":"SECOND"),!as){const m={...g,activePlayerId:"p2",firstPlayerId:"p2",players:{p1:{...g.players.p1,maxPp:0,pp:0},p2:{...g.players.p2,maxPp:1,pp:1}},logs:[` 1 - ${g.players.p2.name} `]};T({type:"SYNC_STATE",payload:m})}Vt("DONE")},[g,as]);L.useEffect(()=>{},[g.phase,nt,n,vt,x]),N.useEffect(()=>{if(hf===ae.class&&xn.current)return;const m=ym(ae.class);console.log(`[BGM] Initializing track: ${m} for class: ${ae.class}`),xn.current&&(xn.current.pause(),xn.current=null);const b=new Audio(m);b.loop=!0,b.volume=Tt.bgm,xn.current=b,vm(ae.class)},[ae.class,ym,hf]),N.useEffect(()=>()=>{xn.current&&(console.log("[GameScreen] Stopping BGM on unmount"),xn.current.pause(),xn.current=null)},[]),N.useEffect(()=>{if(!xn.current)return;const m=xn.current,b=()=>{m.paused&&Tt.bgmEnabled&&(console.log("[BGM] Attempting play on interaction..."),m.play().then(()=>{console.log("[BGM] Play success"),E()}).catch(O=>console.warn("[BGM] Play failed on interaction:",O)))},E=()=>{document.removeEventListener("click",b),document.removeEventListener("keydown",b),document.removeEventListener("touchstart",b)};return Tt.bgmEnabled?(document.addEventListener("click",b),document.addEventListener("keydown",b),document.addEventListener("touchstart",b),m.play().then(()=>{console.log("[BGM] Immediate play success"),E()}).catch(()=>console.log("[BGM] Immediate play blocked, waiting for interaction"))):(m.pause(),E()),()=>{E()}},[Tt.bgmEnabled,Tt.bgm,hf]),L.useEffect(()=>{if(!_){console.log("[GameScreen] Message handler setup skipped - no adapter yet");return}console.log("[GameScreen] Setting up message handler, adapter.isHost:",_.isHost);const m=b=>{var E,O,M,G,J;if(console.log("[GameScreen] Received message:",b.type,b),b.type==="HANDSHAKE"){const $=(E=b.payload)==null?void 0:E.name,U=typeof $=="string"&&$.trim().slice(0,12)||"";console.log("[GameScreen] Received HANDSHAKE from opponent:",U),Zl.current=U,T({type:"UPDATE_PLAYER_NAME",payload:{playerId:P==="p1"?"p2":"p1",name:U}});return}if(b.type==="INIT_GAME"){console.log("[GameScreen] JOIN side: Received initial game state from HOST"),T({type:"SYNC_STATE",payload:b.payload}),T({type:"UPDATE_PLAYER_NAME",payload:{playerId:P,name:u}});const $=P==="p1"?"p2":"p1";Zl.current&&(console.log("[GameScreen] Re-applying opponent name after INIT_GAME:",Zl.current),T({type:"UPDATE_PLAYER_NAME",payload:{playerId:$,name:Zl.current}})),y(!0);const U=b.payload.firstPlayerId===P;console.log("[GameScreen] JOIN side: Setting isFirstPlayer, firstPlayerId:",b.payload.firstPlayerId,"currentPlayerId:",P,"isJoinSideFirst:",U),W0(U),n==="CASUAL_MATCH"||n==="RANKED_MATCH"?console.log("[GameScreen] CASUAL_MATCH JOIN side: Waiting for intro sync"):ve(!0);return}if(b.type==="READY_FOR_INTRO"){console.log("[GameScreen] Received READY_FOR_INTRO from opponent"),mt(!0);return}if(b.type==="START_INTRO"){console.log("[GameScreen] Received START_INTRO - starting BattleIntro now"),Te(!1),ve(!0);return}if(b.type==="GAME_STATE"){console.log("[GameScreen] JOIN: Received GAME_STATE sync from HOST"),T({type:"SYNC_STATE",payload:b.payload}),sa(!1),$r.current=!1,nc.current=null,oa([]),sn.current&&(clearTimeout(sn.current),sn.current=null),!fa.current&&!Qi.current&&(fn.current=!1);return}if(b.type==="EFFECT"){const{effectType:$,targetPlayerId:U,targetIndex:V,targetInstanceId:ce,isBuff:Z,atkBuff:pe,hpBuff:be}=b.payload;console.log("[GameScreen] JOIN: Received EFFECT from HOST:",$,U,V,ce),setTimeout(()=>{Z&&pe!==void 0&&be!==void 0?dm(U,V,pe,be,ce):Ht($,U,V,ce)},50);return}if(b.type==="EVOLVE_ANIM"){const{playerId:$,followerIndex:U,useSep:V,targetId:ce,instanceId:Z}=b.payload,pe=(O=g.players[$])==null?void 0:O.board[U];if(pe){const be=pe.evolvedImageUrl||((M=Wr(pe.id))==null?void 0:M.evolvedImageUrl),Xe=Z||pe.instanceId,Ie=un.findIndex(K=>K&&K.instanceId===Xe),Ye=Ie>=0?ir.current[Ie]:null,Ze=fe.current.scale,Ge=window.innerHeight/2;let Ve=window.innerWidth/2,ge=Ge-70*Ze;if(Ye){const K=Ye.getBoundingClientRect();Ve=K.left+K.width/2,ge=K.top+K.height/2}Ki({card:pe,evolvedImageUrl:be,startX:Ve,startY:ge,phase:"ZOOM_IN",followerIndex:U,sourcePlayerId:$,useSep:V||!1,targetId:ce,isRemote:!0}),vt("fon.mp3",.7)}return}if(b.type==="PLAY_CARD_ANIM"){const{playerId:$,card:U,targetBoardIndex:V}=b.payload;if(U){const ce=((G=g.players[$])==null?void 0:G.board)||[],Z=typeof V=="number"?V:ce.filter(W=>W!==null).length,pe=fe.current.scale,be=window.innerWidth/2,Xe=window.innerHeight/2,Ie=be,Ye=80*pe,Ze=be,Ge=Xe-100*pe,le=-((Math.max(1,Z+1)-1)*li*pe)/2+Z*li*pe,ne=be+le,oe=Xe-70*pe;U.type==="SPELL"?Fn({card:U,sourceIndex:-1,startX:Ie,startY:Ye,targetX:Ze,targetY:Ge,playerClass:(Le==null?void 0:Le.class)||"SENKA",onComplete:()=>{Fn(null)}}):Fn({card:U,sourceIndex:-1,startX:Ie,startY:Ye,targetX:Ze,targetY:Ge,finalX:ne,finalY:oe,playerClass:(Le==null?void 0:Le.class)||"SENKA",onComplete:()=>{vt("gan.mp3",.6),$n(),Fn(null)}})}return}if(b.type==="REMATCH_REQUEST"){console.log("[GameScreen] Opponent requested rematch"),Y0(!0);return}if(b.type==="REMATCH_ACCEPT"){console.log("[GameScreen] Opponent accepted rematch - starting new game"),gf(br);return}if(b.type==="SURRENDER"){const $=(J=b.payload)==null?void 0:J.playerId;if(g.phase==="GAME_OVER"){console.warn("[GameScreen] Ignoring SURRENDER - game already over");return}if($===P){console.warn(`[GameScreen] Security Alert: Received SURRENDER message targeting self (${P}). Ignoring.`);return}if($!==C){console.warn(`[GameScreen] Security Alert: Invalid playerId in SURRENDER: ${$}. Expected: ${C}. Ignoring.`);return}console.log("[GameScreen] Opponent surrendered:",$),K0("surrender"),T({type:"CONCEDE",playerId:$});return}if(b.type==="STAMP"){console.log("[GameScreen] Opponent sent stamp:",b.stampId),Er.current&&(clearTimeout(Er.current),Er.current=null);const $=qy(b.stampId);$&&vt($,.6);const U={stampId:b.stampId,playerId:C,playerClass:b.playerClass||(Le==null?void 0:Le.class)||"SENKA",timestamp:Date.now()};Hi(null),requestAnimationFrame(()=>{Hi(U)}),Er.current=setTimeout(()=>{Hi(V=>(V==null?void 0:V.timestamp)===U.timestamp?null:V),Er.current=null},3e3);return}if(b.type==="ACTION"){const $=b.payload;if(console.log("[GameScreen] Processing remote action:",$.type,"from player:",$.playerId),T({...$,isRemote:!0}),$.type==="ATTACK"){const{playerId:U,payload:V}=$,ce=g.players[U],Z=ce==null?void 0:ce.board[V.attackerIndex],pe=V.targetIsLeader?-1:V.targetIndex,be=U==="p1"?"p2":"p1";if(Z){const Xe=g.players[be],Ie=V.targetIsLeader?null:Xe==null?void 0:Xe.board[V.targetIndex],Ye=Ie?Ie.instanceId:void 0;Ht(Z.attackEffectType,be,pe,Ye)}}else $.type==="PLAY_CARD"||$.type==="EVOLVE"||$.type==="END_TURN"&&(console.log("[GameScreen] Remote END_TURN received, turn switching to:",$.playerId==="p1"?"p2":"p1"),Xi.current=!1)}};return _.onMessage(m),n!=="CPU"&&!em.current&&(em.current=!0,_.send({type:"HANDSHAKE",payload:{name:u,class:t}}),console.log("[GameScreen] Sent HANDSHAKE:",u,t)),_.onClose(()=>{if((n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&g.phase==="GAME_OVER"){console.log("[GameScreen] Connection closed after game over (casual match) - silent disconnect");return}if(n!=="CPU"&&g.phase!=="GAME_OVER"){console.log("[GameScreen] Opponent disconnected during game - treating as surrender, player wins"),K0("disconnect");const b={...g,phase:"GAME_OVER",winnerId:P,logs:[...g.logs,""]};T({type:"SYNC_STATE",payload:b});return}alert(`
`),s()}),()=>{}},[_,g,vt,Ht,n,s,P]);const cs=N.useRef(!1),mf=N.useRef(null),An=N.useRef(null),[Ke,Fn]=N.useState(null),[Ot,Ki]=N.useState(null),fn=N.useRef(!1),ua=N.useRef(null),Xi=N.useRef(!1),yf=N.useRef(ic),vf=N.useRef(Wi),fa=N.useRef(Ke),Qi=N.useRef(Ot);L.useEffect(()=>{yf.current=ic,vf.current=Wi,fa.current=Ke,Qi.current=Ot},[ic,Wi,Ke,Ot]),L.useEffect(()=>{if(Ke&&Ke.card.name===""&&Tt.seEnabled){const m=new Audio(et("/se/beam.mp3"));m.volume=Tt.se*.8,m.play().catch(b=>console.warn("SE Play prevented",b))}},[Ke,Tt]),L.useEffect(()=>{ia.current=_n,ec.current=un},[_n,un]),L.useEffect(()=>{const m=b=>{const E=b.getBoundingClientRect();return{x:E.left+E.width/2,y:E.top}};_n.forEach((b,E)=>{if(b&&b.instanceId){const O=Ir.current[E];if(O){const M=m(O);(M.x!==0||M.y!==0)&&da.current.set(b.instanceId,M)}}}),un.forEach((b,E)=>{if(b&&b.instanceId){const O=ir.current[E];if(O){const M=m(O);(M.x!==0||M.y!==0)&&da.current.set(b.instanceId,M)}}})},[_n,un]);const hc=(m,b,E,O)=>{const M=wr.current.board,G=O?M.findIndex(Z=>Z&&Z.instanceId===O):m,J=G>=0?M[G]:null;if(!J)return;if(J.hasEvolved){console.log("[GameScreen] Cannot evolve: card already evolved");return}const $=Ir.current[m];let U=window.innerWidth/2,V=window.innerHeight/2;if($){const Z=$.getBoundingClientRect();U=Z.left+Z.width/2,V=Z.top+Z.height/2}const ce=J.instanceId;n!=="CPU"&&x&&_&&_.send({type:"EVOLVE_ANIM",payload:{playerId:P,followerIndex:G,useSep:b,targetId:E,instanceId:ce}}),Ki({card:J,evolvedImageUrl:J.evolvedImageUrl,startX:U,startY:V,phase:"ZOOM_IN",followerIndex:G,useSep:b,targetId:E,sourcePlayerId:P}),vt("fon.mp3",.7)},_f=N.useRef(null),_I=N.useCallback(m=>{if(console.log("[GameScreen] handleEvolvePhaseChange:",m),m==="WHITE_FADE"&&vt("fon.mp3",.7),m==="LAND"&&vt("gan.mp3",.6),m==="DONE"){const b=Qi.current;if(b&&!b.isRemote){const O={type:"EVOLVE",playerId:b.sourcePlayerId||P,payload:{followerIndex:b.followerIndex,useSep:b.useSep,targetId:b.targetId}};T(O),_&&n!=="CPU"&&_.send({type:"ACTION",payload:O})}Ki(null)}else Ki(b=>b?{...b,phase:m}:null)},[_,T,n,P,vt]),xf=(m,b,E)=>{var Ve,ge,K,le,ne,oe;const M=wr.current.hand[m];if(!M){console.warn("[handlePlayCard] Card not found at index:",m);return}if(M.instanceId&&ua.current===M.instanceId){console.warn("[handlePlayCard] Duplicate play blocked for instanceId:",M.instanceId);return}if(fn.current){console.warn("[handlePlayCard] Card play locked, ignoring duplicate call");return}fn.current=!0,ua.current=M.instanceId||null,vt("card.mp3",.5);const G=(Ve=M.triggers)==null?void 0:Ve.find(W=>W.trigger==="FANFARE"),J=G==null?void 0:G.effects[0];let $=C;const U=(J==null?void 0:J.targetType)==="SELECT_ALLY_FOLLOWER"||(J==null?void 0:J.targetType)==="SELECT_OTHER_ALLY_FOLLOWER";J&&(U||["GRANT_PASSIVE","BUFF_STATS","HEAL_FOLLOWER"].includes(J.type))&&($=P);const V=["SELECT_FOLLOWER","SELECT_ALLY_FOLLOWER","SELECT_OTHER_ALLY_FOLLOWER"],ce=M.type==="SPELL"&&((ge=M.triggers)==null?void 0:ge.some(W=>W.effects.some(se=>se.targetType&&V.includes(se.targetType))))||M.type==="FOLLOWER"&&(((le=(K=M.triggerAbilities)==null?void 0:K.FANFARE)==null?void 0:le.targetType)&&V.includes(M.triggerAbilities.FANFARE.targetType)||((ne=M.triggers)==null?void 0:ne.some(W=>W.trigger==="FANFARE"&&W.effects.some(se=>se.targetType&&V.includes(se.targetType))))),pe=rt.current.players[$].board.some(W=>{var se,me;return W&&($===P||!((se=W.passiveAbilities)!=null&&se.includes("STEALTH"))&&!((me=W.passiveAbilities)!=null&&me.includes("AURA")))});if(console.log(`[handlePlayCard] needsTarget: ${ce}, allowedTarget: ${$}, hasValidTargets: ${pe}`),ce&&pe){ii({type:"PLAY",sourceIndex:m,sourceInstanceId:M.instanceId,allowedTargetPlayerId:$}),Fr(null);return}const be=window.innerWidth/2,Xe=window.innerHeight/2;let Ie,Ye;if(M.type==="FOLLOWER"){const se=rt.current.players[P].board.filter(Ae=>Ae!==null),me=se.length+1,Oe=se.length,we=li*p,Re=(Oe-(me-1)/2)*we,_e=(oe=Vi.current)==null?void 0:oe.getBoundingClientRect();Ie=(_e?_e.left+_e.width/2:window.innerWidth/2)+Re,Ye=window.innerHeight/2+70*p}const Ze=()=>{M.type!=="SPELL"&&(vt("gan.mp3",.6),$n()),ds({type:"PLAY_CARD",playerId:P,payload:{cardIndex:m,instanceId:M.instanceId}}),Fn(null),setTimeout(()=>{fn.current=!1},100)},Ge=M.type==="FOLLOWER"?rt.current.players[P].board.filter(W=>W!==null).length:void 0;n!=="CPU"&&x&&_&&_.send({type:"PLAY_CARD_ANIM",payload:{playerId:P,cardIndex:m,card:M,targetBoardIndex:Ge}}),Fn({card:M,sourceIndex:m,startX:b,startY:E,targetX:be,targetY:Xe,finalX:Ie,finalY:Ye,playerClass:(ae==null?void 0:ae.class)||"SENKA",onComplete:Ze}),setTimeout(()=>{Fn(W=>(W==null?void 0:W.card.id)===M.id?(Ze(),null):W)},2e3)},ds=m=>{T(m),n!=="CPU"&&x&&!m.isRemote&&(_==null||_.send({type:"ACTION",payload:m}))};N.useEffect(()=>{if(!Ot&&_f.current){const m=_f.current;_f.current=null,console.log("[GameScreen] Dispatching pending evolve action for:",m.playerId),ds({type:"EVOLVE",playerId:m.playerId,payload:{followerIndex:m.followerIndex,useSep:m.useSep,targetId:m.targetId}})}},[Ot,P,ds]);const wr=N.useRef(ae),rt=N.useRef(g);N.useEffect(()=>{wr.current=ae,rt.current=g},[ae,g]);const or=N.useRef(!1);N.useEffect(()=>{const m=cf.current,b=ae.hand.length,E=Le.hand.length;if(b>m.player){const O=b-m.player;la({isPlayer:!0,count:O}),vt("card.mp3",.5),setTimeout(()=>la(null),lf)}if(E>m.opponent){const O=E-m.opponent;la({isPlayer:!1,count:O}),vt("card.mp3",.5),setTimeout(()=>la(null),lf)}cf.current={player:b,opponent:E}},[ae.hand.length,Le.hand.length,Tt,vt]),L.useEffect(()=>{g.activePlayerId===P&&(console.log("[GameScreen] Player turn started - resetting card play lock and ending turn state"),fn.current=!1,ua.current=null,Xi.current=!1)},[g.activePlayerId,g.turnCount,P]),L.useEffect(()=>{if(n==="CPU")return;const m=setInterval(()=>{fn.current&&!fa.current&&!Qi.current&&!it&&g.activePlayerId===P&&(console.warn("[GameScreen] Safety release: Card play lock was stuck, releasing"),fn.current=!1)},3e3);return()=>clearInterval(m)},[n,it,g.activePlayerId,P]),L.useEffect(()=>{if(n!=="CPU")return;if(g.winnerId){cs.current=!1;return}const m=`${g.turnCount}-${g.activePlayerId}`;if(g.activePlayerId===P){cs.current=!1;return}if(g.activePlayerId===C){if(cs.current||mf.current===m)return;(async()=>{var Ie,Ye,Ze,Ge,Ve,ge;cs.current=!0,mf.current=m;const E=async(K=300)=>{await new Promise(oe=>setTimeout(oe,K));const le=()=>{const oe=rt.current,W=oe.pendingEffects&&oe.pendingEffects.length>0,se=yf.current.length>0,me=vf.current.length>0,Oe=fa.current!==null,we=Qi.current!==null;return!W&&!se&&!me&&!Oe&&!we};let ne=0;for(;!le()&&ne<60;){await new Promise(W=>setTimeout(W,100)),ne++;const oe=rt.current;if(oe.pendingEffects&&oe.pendingEffects.length>0&&!$r.current){console.log("[waitForIdle] Forcing RESOLVE_EFFECT for stuck pending effect");const W=oe.pendingEffects[0];T({type:"RESOLVE_EFFECT",playerId:W.sourcePlayerId,payload:{targetId:W.targetId}}),await new Promise(se=>setTimeout(se,200))}}},O=(K,le)=>{var ne;return K?!!((ne=K.passiveAbilities)!=null&&ne.includes("IMMUNE_TO_FOLLOWER_DAMAGE")):!1},M=(K,le)=>{var ne;return!le||!K?!1:(ne=le.passiveAbilities)!=null&&ne.includes("BANE")&&!K.hasBarrier?!0:(le.currentAttack||0)>=K.currentHealth},G=(K,le)=>{var ne;return!le||!K?!1:(ne=K.passiveAbilities)!=null&&ne.includes("BANE")?!le.hasBarrier:K.currentAttack>=le.currentHealth},J=K=>{var se,me,Oe;let le=0;const ne=K.players[C].board.filter(we=>we!==null),W=K.players[P].board.filter(we=>we!==null).some(we=>{var Re,_e;return((Re=we.passiveAbilities)==null?void 0:Re.includes("WARD"))&&!((_e=we.passiveAbilities)!=null&&_e.includes("STEALTH"))});for(const we of ne)!we.canAttack||!((se=we.passiveAbilities)!=null&&se.includes("STORM")||we.turnPlayed!==K.turnCount)||W&&!((me=we.passiveAbilities)!=null&&me.includes("STEALTH"))&&!we.hadStealth||(le+=we.currentAttack||0,(Oe=we.passiveAbilities)!=null&&Oe.includes("DOUBLE_ATTACK")&&(le+=we.currentAttack||0));return le},$=K=>{var oe,W,se;let le=0;const ne=K.players[P].board.filter(me=>me!==null);for(const me of ne)le+=me.currentAttack||0,(oe=me.passiveAbilities)!=null&&oe.includes("DOUBLE_ATTACK")&&(le+=me.currentAttack||0),(W=me.passiveAbilities)!=null&&W.includes("BANE")&&(le+=15),(se=me.passiveAbilities)!=null&&se.includes("STORM")&&(le+=10);return le},U=(K,le)=>{var Re,_e,Qe,Ae;let ne=K.cost*10;const oe=le.players[P].board.filter(je=>je!==null),W=le.players[C].board.filter(je=>je!==null),se=le.players[P].hp,me=le.players[C].hp,Oe=le.players[C].pp;if((Re=K.passiveAbilities)!=null&&Re.includes("STORM")){const je=J(le),De=K.attack||0;je+De>=se?ne+=500:se<=10?ne+=100:ne+=30}if(oe.length>0){const je=K.triggers||[],De=$(le);for(const Et of je)if(Et.trigger==="FANFARE")for(const Ue of Et.effects||[]){if(Ue.type==="DESTROY"&&(ne+=60+(De>10?30:0)),Ue.type==="RANDOM_DESTROY"){const Je=Ue.value||1;ne+=40*Je+(De>10?20:0)}["DAMAGE","SELECT_DAMAGE"].includes(Ue.type)&&(ne+=35),Ue.type==="AOE_DAMAGE"&&(ne+=25*Math.min(oe.length,3))}}me<=10&&((_e=K.passiveAbilities)!=null&&_e.includes("WARD")&&(ne+=80),ne+=20),K.cost===Oe?ne+=15:Oe-K.cost<=1&&(ne+=10);const we=K.triggers||[];for(const je of we)if(je.trigger==="FANFARE")for(const De of je.effects||[])De.type==="DRAW"&&(ne+=20*(De.value||1)),(De.type==="SUMMON_CARD"||De.type==="SUMMON_CARD_RUSH")&&(ne+=30),De.type==="GENERATE_CARD"&&(ne+=15),De.type==="HEAL"&&(ne+=me<15?25:10);return K.type==="FOLLOWER"&&((K.attack||0)+(K.health||0)>=K.cost*2.5&&(ne+=15),(Qe=K.passiveAbilities)!=null&&Qe.includes("WARD")&&oe.length>0&&(ne+=25),(Ae=K.passiveAbilities)!=null&&Ae.includes("BANE")&&(ne+=20)),K.type==="FOLLOWER"&&W.length>=5&&(ne-=200),ne},V=(K,le,ne,oe)=>{let W=0;const se=ne.players[P].board.filter(_e=>_e!==null),me=ne.players[C].board.filter(_e=>_e!==null),Oe=K.triggers||[],we=oe?"SUPER_EVOLVE":"EVOLVE";let Re=!1;for(const _e of Oe)if(_e.trigger===we){Re=!0;for(const Qe of _e.effects||[]){if(["DESTROY","RANDOM_DESTROY","DAMAGE","SELECT_DAMAGE","AOE_DAMAGE"].includes(Qe.type)&&(W+=se.length>0?80:5),["SUMMON_CARD","SUMMON_CARD_RUSH"].includes(Qe.type)&&(W+=60),Qe.type==="BUFF_STATS"){const Ae=Qe.targetType||"SELF";Ae==="ALL_OTHER_FOLLOWERS"||Ae==="ALL_FOLLOWERS"?W+=25*Math.max(1,me.length-1):W+=30}Qe.type==="DRAW"&&(W+=35),Qe.type==="GENERATE_CARD"&&(W+=25)}}return K.canAttack?(W+=30,W+=(K.currentAttack||0)*5):W+=(K.currentAttack||0)*2,K.cost>=6&&Re&&(W+=20),!Re&&K.cost<=3&&(W-=30),W},ce=(K,le)=>{const oe=K.players[C].board.filter(Ae=>Ae!==null),W=K.players[P].board.filter(Ae=>Ae!==null),se=K.players[P].hp,me=K.players[C].hp,Oe=K.turnCount,we=oe.filter(Ae=>Ae&&!Ae.hasEvolved);if(we.length===0)return!1;const Re=we.map((Ae,je)=>({c:Ae,i:je,score:V(Ae,je,K,le)})),_e=Math.max(...Re.map(Ae=>Ae.score));if(se<=12&&oe.some(Ae=>Ae&&Ae.canAttack)||me<=10)return!0;const Qe=$(K);return Qe>=8&&we.some(je=>{const De=je.triggers||[];for(const Et of De)if(Et.trigger===(le?"SUPER_EVOLVE":"EVOLVE")){for(const Ue of Et.effects||[])if(["DESTROY","RANDOM_DESTROY","DAMAGE","AOE_DAMAGE"].includes(Ue.type))return!0}return!1})&&W.length>0||_e>=80||le&&_e>=50?!0:Oe<=5&&me>=15&&Qe<8?_e>=100:_e<30?!1:_e>=50},Z=(K,le,ne)=>{var Oe,we,Re,_e,Qe;const oe=((Oe=K.passiveAbilities)==null?void 0:Oe.includes("STORM"))||K.turnPlayed!==ne.turnCount,W=le.map((Ae,je)=>({c:Ae,i:je})).filter(({c:Ae})=>{var je,De;return Ae!==null&&!((je=Ae.passiveAbilities)!=null&&je.includes("STEALTH"))&&!((De=Ae.passiveAbilities)!=null&&De.includes("AURA"))});if(!(((we=K.passiveAbilities)==null?void 0:we.includes("STEALTH"))||K.hadStealth)){const Ae=W.find(({c:je})=>{var De;return(De=je.passiveAbilities)==null?void 0:De.includes("WARD")});if(Ae)return O(Ae.c)?{index:-1,isLeader:!1}:{index:Ae.i,isLeader:!1}}let me={index:-1,isLeader:oe,score:oe?0:-1e3};for(const{c:Ae,i:je}of W){if(O(Ae))continue;let De=0;const Et=K.isEvolved,Ue=(Re=Ae.passiveAbilities)==null?void 0:Re.includes("BANE"),Je=M(K,Ae);G(K,Ae)?(De+=50,De+=(Ae.currentAttack||0)*5,Je?Ue&&Et?De-=60:Ue&&(De-=30):De+=30,Ue&&!Je&&(De+=40),(_e=Ae.passiveAbilities)!=null&&_e.includes("STORM")&&(De+=30),(Qe=Ae.passiveAbilities)!=null&&Qe.includes("DOUBLE_ATTACK")&&(De+=35)):!Je&&K.currentAttack>=Ae.currentHealth/2?De+=10:Je&&(De-=50,Et&&(De-=40),(Ae.currentAttack||0)>=5&&(De+=10)),De>me.score&&(me={index:je,isLeader:!1,score:De})}return oe&&(me.index===-1||me.score<=0)?{index:-1,isLeader:!0}:me},pe=d==="EASY"?1200:d==="HARD"?400:800;if(await new Promise(K=>setTimeout(K,pe)),!cs.current)return;let be=0;const Xe=d==="EASY"?1:d==="HARD"?5:3;for(;be<Xe;){const K=rt.current,le=K.players[C].hand,ne=K.players[C].pp,W=K.players[C].board.filter(Ue=>Ue!==null).length>=5;let se=le.map((Ue,Je)=>({...Ue,originalIndex:Je})).filter(Ue=>Ue.cost<=ne).filter(Ue=>!(Ue.type==="FOLLOWER"&&W));if(se.length===0||(d==="HARD"?se=se.sort((Ue,Je)=>U(Je,K)-U(Ue,K)):se=se.sort((Ue,Je)=>Je.cost-Ue.cost),d==="EASY"&&Math.random()<.3&&be>0))break;const me=se[0];let Oe;const Re=K.players[P].board.filter(Ue=>{var Je,yt;return Ue&&!((Je=Ue.passiveAbilities)!=null&&Je.includes("STEALTH"))&&!((yt=Ue.passiveAbilities)!=null&&yt.includes("AURA"))});Re.length>0&&(d==="HARD"?Oe=[...Re].sort((Je,yt)=>{var _t,It;let at=(Je.currentAttack||0)+(Je.currentHealth||0),pt=(yt.currentAttack||0)+(yt.currentHealth||0);return(_t=Je.passiveAbilities)!=null&&_t.includes("BANE")&&(at+=10),(It=yt.passiveAbilities)!=null&&It.includes("BANE")&&(pt+=10),pt-at})[0].instanceId:Oe=Re[0].instanceId);const _e=window.innerWidth-20*p-80*p/2,Qe=20*p+110*p/2,Ae=window.innerWidth/2,je=window.innerHeight/2;let De,Et;if(me.type==="FOLLOWER"){const Je=rt.current.players[C].board.filter(vc=>vc!==null),yt=Je.length+1,at=Je.length,pt=li*p,_t=(at-(yt-1)/2)*pt,It=(Ie=Vi.current)==null?void 0:Ie.getBoundingClientRect();De=(It?It.left+It.width/2:window.innerWidth/2)+_t,Et=window.innerHeight/2-70*p}Fn({card:me,sourceIndex:-1,startX:_e,startY:Qe,targetX:Ae,targetY:je,finalX:De,finalY:Et,playerClass:(Le==null?void 0:Le.class)||"SENKA",onComplete:()=>{if(me.type!=="SPELL"&&(vt("gan.mp3",.6),$n()),T({type:"PLAY_CARD",playerId:C,payload:{cardIndex:me.originalIndex,targetId:Oe,instanceId:me.instanceId}}),me.id==="c_amandava"&&rt.current.players[P].board.forEach((Je,yt)=>{if(Je){const at=Je.instanceId;setTimeout(()=>{Ht("SHOT",P,yt,at)},200)}}),me.id==="c_azya"){if(setTimeout(()=>{Ht("THUNDER",P,-1)},200),Oe){const Je=rt.current.players[P].board.findIndex(yt=>(yt==null?void 0:yt.instanceId)===Oe);Je!==-1&&setTimeout(()=>{Ht("ICE",P,Je,Oe)},400)}setTimeout(()=>{const Ue=rt.current.players[P].board,Je=Ue.filter(yt=>yt!==null);if(Je.length>0){const yt=Je[Math.floor(Math.random()*Je.length)],at=Ue.findIndex(pt=>(pt==null?void 0:pt.instanceId)===(yt==null?void 0:yt.instanceId));at!==-1&&Ht("WATER",P,at,yt==null?void 0:yt.instanceId)}},600)}Fn(null)}}),await E(600),be++}{const K=rt.current,le=K.players[C],ne=C===K.firstPlayerId,oe=K.turnCount,W=T_(le,oe,ne);if((w_(le,oe,ne)||W)&&le.board.length>0){const me=le.board.map((Oe,we)=>({c:Oe,i:we})).filter(({c:Oe})=>Oe&&Oe.type==="FOLLOWER"&&!Oe.hasEvolved);if(me.length>0){let Oe;const we=W;if(d==="HARD"&&(ce(K,we)||console.log("[AI HARD] Skipping evolution - saving EP for better opportunity")),d==="HARD"&&!ce(K,we))Oe=null;else if(d==="EASY")Oe=me[Math.floor(Math.random()*me.length)];else{const _e=me.map(({c:Qe,i:Ae})=>({c:Qe,i:Ae,score:V(Qe,Ae,K,we)}));_e.sort((Qe,Ae)=>Ae.score-Qe.score),d==="HARD"&&_e[0].score<5?(console.log("[AI HARD] Evolution target score too low:",_e[0].score),Oe=null):Oe=_e[0]}if(Oe){let _e;const Ae=K.players[P].board.filter(De=>{var Et,Ue;return De!==null&&!((Et=De.passiveAbilities)!=null&&Et.includes("STEALTH"))&&!((Ue=De.passiveAbilities)!=null&&Ue.includes("AURA"))});Ae.length>0&&(d==="HARD"?_e=[...Ae].sort((Et,Ue)=>{var at,pt,_t,It;let Je=(Et.currentAttack||0)*2+(Et.currentHealth||0),yt=(Ue.currentAttack||0)*2+(Ue.currentHealth||0);return(at=Et.passiveAbilities)!=null&&at.includes("BANE")&&(Je+=10),(pt=Ue.passiveAbilities)!=null&&pt.includes("BANE")&&(yt+=10),(_t=Et.passiveAbilities)!=null&&_t.includes("DOUBLE_ATTACK")&&(Je+=5),(It=Ue.passiveAbilities)!=null&&It.includes("DOUBLE_ATTACK")&&(yt+=5),yt-Je})[0].instanceId:_e=Ae[0].instanceId);const je=(Ye=ir.current[Oe.i])==null?void 0:Ye.getBoundingClientRect();je?(Ki({card:Oe.c,evolvedImageUrl:Oe.c.evolvedImageUrl,startX:je.left+je.width/2,startY:je.top+je.height/2,useSep:we,phase:"ZOOM_IN",followerIndex:Oe.i,sourcePlayerId:C,targetId:_e}),await E(800)):(ds({type:"EVOLVE",playerId:C,payload:{followerIndex:Oe.i,useSep:we,targetId:_e}}),await E(400))}}}}{let K=!0,le=0;const ne=oe=>{if(d!=="HARD")return!1;const W=oe.players[P].hp;return J(oe)>=W};for(;K&&le<15;){if(rt.current.winnerId){K=!1;break}le++;const oe=rt.current,W=oe.players[C].board,se=oe.players[P].board,me=ne(oe);let Oe=!1;for(let we=0;we<W.length;we++){const Re=W[we];if(!Re||!Re.canAttack)continue;let _e=-1,Qe=!0;const Ae=((Ze=Re.passiveAbilities)==null?void 0:Ze.includes("STEALTH"))||Re.hadStealth,je=Ae?-1:se.findIndex(at=>{var pt,_t;return at&&((pt=at.passiveAbilities)==null?void 0:pt.includes("WARD"))&&!((_t=at.passiveAbilities)!=null&&_t.includes("STEALTH"))&&!O(at)});if(me&&je===-1)if(((Ge=Re.passiveAbilities)==null?void 0:Ge.includes("STORM"))||Re.turnPlayed!==oe.turnCount)_e=-1,Qe=!0;else{const _t=se.map((It,ps)=>({c:It,idx:ps})).filter(({c:It})=>{var ps,vc;return It&&!((ps=It.passiveAbilities)!=null&&ps.includes("STEALTH"))&&!((vc=It.passiveAbilities)!=null&&vc.includes("AURA"))&&!O(It)});if(_t.length>0)_e=_t[0].idx,Qe=!1;else continue}else if(je!==-1)_e=je,Qe=!1;else if(d==="EASY"){const at=se.map((_t,It)=>({c:_t,idx:It})).filter(({c:_t})=>{var It,ps;return _t&&!((It=_t.passiveAbilities)!=null&&It.includes("STEALTH"))&&!((ps=_t.passiveAbilities)!=null&&ps.includes("AURA"))&&!O(_t)}),pt=((Ve=Re.passiveAbilities)==null?void 0:Ve.includes("STORM"))||Re.turnPlayed!==oe.turnCount;if(!pt&&at.length>0)_e=at[Math.floor(Math.random()*at.length)].idx,Qe=!1;else{if(!pt&&at.length===0)continue;pt&&at.length>0&&Math.random()<.5&&(_e=at[Math.floor(Math.random()*at.length)].idx,Qe=!1)}}else{const at=Z(Re,se,oe);if(_e=at.index,Qe=at.isLeader,_e===-1&&!Qe)continue}const De=(ge=Re.passiveAbilities)==null?void 0:ge.includes("STORM"),Et=Re.turnPlayed===oe.turnCount;if(!De&&Et&&Qe){const at=se.map((pt,_t)=>({c:pt,idx:_t})).filter(({c:pt})=>{var _t,It;return pt&&!((_t=pt.passiveAbilities)!=null&&_t.includes("STEALTH"))&&!((It=pt.passiveAbilities)!=null&&It.includes("AURA"))&&!O(pt)});if(at.length>0){const pt=Ae?null:at.find(({c:_t})=>{var It;return(It=_t.passiveAbilities)==null?void 0:It.includes("WARD")});pt?_e=pt.idx:_e=at[0].idx,Qe=!1}else continue}const Ue=Qe?null:se[_e],Je=Ue?Ue.instanceId:void 0,yt=Re.instanceId;if(yt&&(rc(yt),setTimeout(()=>rc(null),300)),Ht(Re.attackEffectType||"SLASH",P,Qe?-1:_e,Je),!Qe&&_e>=0){const at=se[_e];if(at&&(at.currentAttack||0)>0){const pt=at.instanceId;setTimeout(()=>{pt&&(sc(pt),setTimeout(()=>sc(null),300)),Ht(at.attackEffectType||"SLASH",C,we,yt)},200)}}Oe=!0,await E(1e3),T({type:"ATTACK",playerId:C,payload:{attackerIndex:we,targetIndex:_e,targetIsLeader:Qe}}),await E(1e3);break}Oe||(K=!1)}}if(await E(300),rt.current.winnerId){cs.current=!1;return}T({type:"END_TURN",playerId:C}),cs.current=!1})()}},[g.activePlayerId,g.turnCount,n,g.phase,d,g.winnerId]);const _m=(m,b)=>{if(An.current||Ke||Wi.length>0)return;const E=ae.hand[b];m.stopPropagation();const O="touches"in m?m.touches[0].clientX:m.clientX,M="touches"in m?m.touches[0].clientY:m.clientY,G=m.currentTarget.getBoundingClientRect();if(!Br){uf(!0),Ur({card:E,owner:"PLAYER",source:"HAND"}),ff.current=!0;return}if(Ur({card:E,owner:"PLAYER",source:"HAND"}),g.activePlayerId!==P)return;if(fn.current){console.warn("[handleHandMouseDown] Card play in progress, blocking drag start");return}const J=rt.current;if(J.winnerId){console.log("UI: Card play drag blocked - game has ended");return}if(J.pendingEffects&&J.pendingEffects.length>0){console.log("UI: Card play drag blocked - pendingEffects still processing");return}const $={sourceType:"HAND",sourceIndex:b,sourceInstanceId:E.instanceId,startX:G.left+G.width/2,startY:G.top+G.height/2,currentX:O,currentY:M,offsetX:0,offsetY:0,canDrag:!0};Fr($),An.current=$},xm=(m,b,E)=>{m.stopPropagation();const O="touches"in m?m.touches[0].clientX:m.clientX,M="touches"in m?m.touches[0].clientY:m.clientY,G=rt.current;if(G.winnerId){console.log("UI: Attack drag blocked - game has ended");return}const J=G.players[P].board,$=E?J.findIndex(V=>V&&V.instanceId===E):b,U=$>=0?J[$]:null;if(it&&it.allowedTargetPlayerId===P&&U){bf("FOLLOWER",$,P,E);return}if(U&&Ur({card:U,owner:"PLAYER",source:"BOARD"}),G.pendingEffects&&G.pendingEffects.length>0){console.log("UI: Attack drag blocked - pendingEffects still processing");return}if(G.activePlayerId===P&&(U!=null&&U.canAttack)){const V=m.currentTarget.getBoundingClientRect(),ce={x:V.left+V.width/2,y:V.top+V.height/2},Z={sourceType:"BOARD",sourceIndex:$,sourceInstanceId:U.instanceId,startX:ce.x,startY:ce.y,currentX:O,currentY:M,offsetX:0,offsetY:0};Fr(Z),An.current=Z}},pc=(m,b=!1)=>{if(g.activePlayerId!==P)return;m.stopPropagation();const E="touches"in m?m.touches[0].clientX:m.clientX,O="touches"in m?m.touches[0].clientY:m.clientY,M=rt.current;if(M.winnerId){console.log("UI: Evolve drag blocked - game has ended");return}if(M.pendingEffects&&M.pendingEffects.length>0){console.log("UI: Evolve drag blocked - pendingEffects still processing");return}const G=P===g.firstPlayerId;if(b){if(!T_(ae,g.turnCount,G))return}else if(!w_(ae,g.turnCount,G))return;const J=m.currentTarget.getBoundingClientRect(),$=J.left+J.width/2,U=J.top+J.height/2,V={sourceType:"EVOLVE",sourceIndex:0,startX:$,startY:U,currentX:E,currentY:O,offsetX:0,offsetY:0,useSep:b};Fr(V),An.current=V},bm=L.useCallback(m=>{Er.current&&(clearTimeout(Er.current),Er.current=null);const b={stampId:m,playerId:P,playerClass:br,timestamp:Date.now()},E=qy(m);E&&vt(E,.6),Hi(null),requestAnimationFrame(()=>{Hi(b)}),e==="ONLINE"&&_&&_.send({type:"STAMP",stampId:m,playerClass:br}),Er.current=setTimeout(()=>{Hi(O=>(O==null?void 0:O.timestamp)===b.timestamp?null:O),Er.current=null},3e3)},[P,br,e,_]),xI=L.useCallback(m=>{if(m.stopPropagation(),m.preventDefault(),oi.current){const b=oi.current.getBoundingClientRect();jr.current={x:b.left+b.width/2,y:b.top+b.height/2}}else jr.current={x:m.clientX,y:m.clientY};Z0(!0),Jl(null)},[]),Em=N.useRef(null);N.useEffect(()=>{Em.current=tf},[tf]),L.useEffect(()=>{if(!ef)return;const m=E=>{if(!jr.current)return;const O=E.clientX-jr.current.x,M=E.clientY-jr.current.y,G=Math.sqrt(O*O+M*M),J=Math.atan2(M,O)*(180/Math.PI);if(G>=200&&G<=320&&M<0){const ce=180- -J,Z=Math.floor(ce/22.5),be=Math.max(0,Math.min(7,Z))+1;Jl(be)}else Jl(null)},b=()=>{const E=Em.current;E&&bm(E),Z0(!1),Jl(null),jr.current=null};return window.addEventListener("mousemove",m),window.addEventListener("mouseup",b),()=>{window.removeEventListener("mousemove",m),window.removeEventListener("mouseup",b)}},[ef,bm]),L.useEffect(()=>{const m=(O,M,G=!1)=>{var U,V,ce,Z;if(!An.current)return;const{canDrag:J,sourceType:$}=An.current;if(!($==="HAND"&&!J)&&(An.current={...An.current,currentX:O,currentY:M},Fr(pe=>pe?{...pe,currentX:O,currentY:M}:null),G&&($==="BOARD"||$==="EVOLVE"))){const pe=Yi.current;if(pe){const Ie=pe.getBoundingClientRect();if(O>=Ie.left&&O<=Ie.right&&M>=Ie.top&&M<=Ie.bottom){Yn({type:"LEADER",index:0,playerId:C});return}}const be=rt.current,Xe=((U=be.players[C])==null?void 0:U.board)||[];for(let Ie=0;Ie<ir.current.length;Ie++){const Ye=ir.current[Ie];if(Ye&&Xe[Ie]){const Ze=Ye.getBoundingClientRect();if(O>=Ze.left&&O<=Ze.right&&M>=Ze.top&&M<=Ze.bottom){Yn({type:"FOLLOWER",index:Ie,playerId:C,instanceId:(V=Xe[Ie])==null?void 0:V.instanceId});return}}}if($==="EVOLVE"){const Ie=((ce=be.players[P])==null?void 0:ce.board)||[];for(let Ye=0;Ye<Ir.current.length;Ye++){const Ze=Ir.current[Ye];if(Ze&&Ie[Ye]){const Ge=Ze.getBoundingClientRect();if(O>=Ge.left&&O<=Ge.right&&M>=Ge.top&&M<=Ge.bottom){Yn({type:"FOLLOWER",index:Ye,playerId:P,instanceId:(Z=Ie[Ye])==null?void 0:Z.instanceId});return}}}}Yn(null)}},b=O=>{m(O.clientX,O.clientY)},E=O=>{O.touches.length>0&&(An.current&&O.preventDefault(),m(O.touches[0].clientX,O.touches[0].clientY,!0))};return window.addEventListener("mousemove",b),window.addEventListener("touchmove",E,{passive:!1}),()=>{window.removeEventListener("mousemove",b),window.removeEventListener("touchmove",E)}},[]);const Sm=N.useRef(null),bI=N.useRef(null);L.useEffect(()=>{Sm.current=ft,bI.current=ft},[ft]),L.useEffect(()=>{const m=()=>{var M,G,J,$,U,V,ce,Z,pe,be,Xe,Ie,Ye;const E=An.current,O=Sm.current;if(rt.current.winnerId){console.log("[handleGlobalMouseUp] Game has ended, cancelling all actions"),Fr(null),An.current=null,Yn(null);return}if(E){if(E.sourceType==="HAND"){if(fn.current){console.warn("[handleGlobalMouseUp] Card play in progress, cancelling drag"),An.current=null,Fr(null);return}const Ze=Math.sqrt(Math.pow(E.startX-E.currentX,2)+Math.pow(E.startY-E.currentY,2)),Ge=E.currentY<window.innerHeight-200*p;if(E.canDrag&&Ze>30&&Ge){const Ve=wr.current.hand[E.sourceIndex];if(wr.current.pp>=Ve.cost){const ge=((G=(M=Ve.triggerAbilities)==null?void 0:M.FANFARE)==null?void 0:G.targetType)==="SELECT_FOLLOWER"||((J=Ve.triggers)==null?void 0:J.some(oe=>oe.trigger==="FANFARE"&&oe.effects.some(W=>W.targetType==="SELECT_FOLLOWER"))),K=((U=($=Ve.triggerAbilities)==null?void 0:$.FANFARE)==null?void 0:U.targetType)==="SELECT_ALLY_FOLLOWER"||((V=Ve.triggers)==null?void 0:V.some(oe=>oe.trigger==="FANFARE"&&oe.effects.some(W=>W.targetType==="SELECT_ALLY_FOLLOWER"))),le=((Z=(ce=Ve.triggerAbilities)==null?void 0:ce.FANFARE)==null?void 0:Z.targetType)==="SELECT_OTHER_ALLY_FOLLOWER"||((pe=Ve.triggers)==null?void 0:pe.some(oe=>oe.trigger==="FANFARE"&&oe.effects.some(W=>W.targetType==="SELECT_OTHER_ALLY_FOLLOWER")));if(ge||K||le){const oe=K||le?P:C;rt.current.players[oe].board.some(me=>{var Oe,we;return!(!me||oe!==P&&((Oe=me.passiveAbilities)!=null&&Oe.includes("STEALTH")||(we=me.passiveAbilities)!=null&&we.includes("AURA")))})?(fn.current=!0,ua.current=Ve.instanceId||null,ii({type:"PLAY",sourceIndex:E.sourceIndex,sourceInstanceId:Ve.instanceId,allowedTargetPlayerId:oe}),or.current=!0,setTimeout(()=>{or.current=!1},100)):(console.log("[handleGlobalMouseUp] No valid targets, skipping target selection"),xf(E.sourceIndex,E.startX,E.startY),Ur(null),or.current=!0,setTimeout(()=>{or.current=!1},100))}else xf(E.sourceIndex,E.startX,E.startY),Ur(null),or.current=!0,setTimeout(()=>{or.current=!1},100);An.current=null,Fr(null);return}}else E.canDrag||uf(!0)}else if(E.sourceType==="BOARD"){if(O&&O.playerId===C){const Ge=rt.current.players[C],Ve=Ge.board.filter(W=>{var se,me;return W&&((se=W.passiveAbilities)==null?void 0:se.includes("WARD"))&&!((me=W.passiveAbilities)!=null&&me.includes("STEALTH"))});let ge=!1;const K=W=>W?Ge.board.findIndex(se=>se&&se.instanceId===W):-1,le=O.type==="LEADER"?-1:K(O.instanceId),ne=wr.current.board[E.sourceIndex],oe=((be=ne==null?void 0:ne.passiveAbilities)==null?void 0:be.includes("STEALTH"))||(ne==null?void 0:ne.hadStealth);if(Ve.length>0&&!oe){if(O.type==="LEADER")ge=!0;else if(O.type==="FOLLOWER"&&le>=0){const W=Ge.board[le];W&&!((Xe=W.passiveAbilities)!=null&&Xe.includes("WARD"))&&(ge=!0)}}if(ge)console.log("UI: Attack blocked by WARD");else{const W=wr.current.board.findIndex(Qe=>Qe&&Qe.instanceId===E.sourceInstanceId),se=W>=0?wr.current.board[W]:null,me=(Ie=se==null?void 0:se.passiveAbilities)==null?void 0:Ie.includes("RUSH"),Oe=(Ye=se==null?void 0:se.passiveAbilities)==null?void 0:Ye.includes("STORM"),we=(se==null?void 0:se.turnPlayed)===rt.current.turnCount,Re=O.type==="LEADER",_e=le;if(Re&&me&&!Oe&&we)console.log("UI: Attack blocked by RUSH rule (Cannot attack leader)");else{if(W<0||!se){console.log("UI: Attack blocked - invalid attacker");return}const Qe=rt.current;if(Qe.pendingEffects&&Qe.pendingEffects.length>0){console.log("UI: Attack blocked - pendingEffects still processing");return}const Ae=O.instanceId,je=E.sourceInstanceId,De=!Re&&_e>=0?Ge.board[_e]:null;ds({type:"ATTACK",playerId:P,payload:{attackerIndex:W,targetIndex:Re?-1:_e,targetIsLeader:Re}}),je&&(rc(je),setTimeout(()=>rc(null),300));const Ue=(se==null?void 0:se.attackEffectType)||"SLASH";if(Ht(Ue,C,Re?-1:_e,Ae),$n(),!Re&&De&&(De.currentAttack||0)>0){const Je=De.instanceId;setTimeout(()=>{Je&&(sc(Je),setTimeout(()=>sc(null),300)),Ht(De.attackEffectType||"SLASH",P,W,je)},200)}}}}}else if(E.sourceType==="EVOLVE"&&O&&O.type==="FOLLOWER"&&O.playerId===P){const Ze=O.index,Ve=ia.current[Ze],ge=(Ve==null?void 0:Ve.instanceId)||O.instanceId,K=wr.current.board,le=ge?K.findIndex(je=>je&&je.instanceId===ge):Ze,ne=le>=0?K[le]:null;if(!ne)return;if(ne.hasEvolved){console.log("[GameScreen] Cannot evolve: card already evolved (drag drop)");return}const W=E.useSep?["SUPER_EVOLVE","EVOLVE"]:["EVOLVE"],me=(()=>{var De,Et;const je=(Et=(De=ne==null?void 0:ne.triggerAbilities)==null?void 0:De.EVOLVE)==null?void 0:Et.targetType;if(je)return je;for(const Ue of(ne==null?void 0:ne.triggers)||[])if(W.includes(Ue.trigger)){for(const Je of Ue.effects)if(Je.targetType&&["SELECT_FOLLOWER","SELECT_ALLY_FOLLOWER","SELECT_OTHER_ALLY_FOLLOWER"].includes(Je.targetType))return Je.targetType}return null})(),Oe=!!me,we=me==="SELECT_ALLY_FOLLOWER"||me==="SELECT_OTHER_ALLY_FOLLOWER",Re=me==="SELECT_OTHER_ALLY_FOLLOWER",_e=we?P:C,Ae=rt.current.players[_e].board.some(je=>{var De,Et;return!(!je||we&&Re&&je.instanceId===ge||!we&&((De=je.passiveAbilities)!=null&&De.includes("STEALTH")||(Et=je.passiveAbilities)!=null&&Et.includes("AURA")))});Oe&&Ae?(ii({type:"EVOLVE",sourceIndex:le,sourceInstanceId:ge,sourceVisualIndex:Ze,useSep:E.useSep,allowedTargetPlayerId:_e,excludeInstanceId:Re?ge:void 0}),or.current=!0,setTimeout(()=>{or.current=!1},100)):(hc(Ze,E.useSep,void 0,ge),or.current=!0,setTimeout(()=>{or.current=!1},100))}}E&&E.sourceType==="HAND"&&E.canDrag&&(cm(E.sourceIndex),setTimeout(()=>cm(null),300)),Fr(null),An.current=null,Yn(null)},b=()=>{m()};return window.addEventListener("mouseup",m),window.addEventListener("touchend",b),()=>{window.removeEventListener("mouseup",m),window.removeEventListener("touchend",b)}},[C,P,Br,p]);const EI=()=>{if(!or.current){if(it){it.type==="PLAY"&&(fn.current=!1),ii(null);return}if(Br){if(ff.current){ff.current=!1;return}uf(!1),Ur(null),Me(null)}}},us=()=>{if(!Q||Q.sourceType!=="BOARD"&&Q.sourceType!=="EVOLVE")return"";const m=Q.currentX-Q.startX,b=Q.currentY-Q.startY,E=Math.sqrt(m*m+b*b);if(E<10)return"";const O=(Q.startX+Q.currentX)/2,M=(Q.startY+Q.currentY)/2,G=Math.min(200,E*.3),J=Math.abs(m),$=Math.min(150,J*.4),U=G+$,ce=-(m/(E+1))*U*.5,Z=-U*.8,pe=O+ce,be=M+Z;return`M${Q.startX},${Q.startY} Q${pe},${be} ${Q.currentX},${Q.currentY}`},bf=(m,b,E,O)=>{var J;if(!it)return;if(it.allowedTargetPlayerId&&it.allowedTargetPlayerId!==E){console.log("Invalid target side");return}if(it.excludeInstanceId&&O===it.excludeInstanceId){console.log("Cannot target self (SELECT_OTHER_ALLY_FOLLOWER)"),$n();return}let M,G=b;if(m==="FOLLOWER"){if(O&&(G=g.players[E].board.findIndex(U=>U&&U.instanceId===O),G<0))return;const $=g.players[E].board[G];if(!$)return;if(M=$.instanceId,E!==P){const U=$.passiveAbilities||[];if(U.includes("STEALTH")){console.log("Cannot target unit with STEALTH"),vt("cancel"),$n();return}if(U.includes("AURA")){console.log("Cannot target unit with AURA"),vt("cancel"),$n();return}}}else return;if(it.type==="PLAY"){const $=wr.current;let U=it.sourceIndex,V=$.hand[U];if(it.sourceInstanceId){const Ge=$.hand.findIndex(Ve=>Ve.instanceId===it.sourceInstanceId);if(Ge>=0)U=Ge,V=$.hand[Ge],console.log(`[handleTargetClick] Using sourceInstanceId ${it.sourceInstanceId}, found at index ${Ge} (was ${it.sourceIndex})`);else{console.error("[handleTargetClick] Card not found with instanceId:",it.sourceInstanceId),ii(null);return}}if(!V){console.error("[handleTargetClick] Card not found at index:",U),ii(null),fn.current=!1;return}fn.current=!0,ua.current=V.instanceId||null,V.id==="c_y"&&(Ht("SUMI","p2",G,M),rt.current.players[C].board.forEach((Ve,ge)=>{if(Ve){const K=Ve.instanceId;setTimeout(()=>{Ht("SUMI",C,ge,K)},300)}})),V.id==="s_resignation_proxy"&&(Ht("SUMI",E,G,M),setTimeout(()=>{const Ge=rt.current.players[P].board,Ve=[];if(Ge.forEach((ge,K)=>{ge&&Ve.push({index:K,instanceId:ge.instanceId})}),Ve.length>0){const ge=Ve[Math.floor(Math.random()*Ve.length)];Ht("SUMI",P,ge.index,ge.instanceId)}},500)),V.id==="c_azya"&&(Ht("THUNDER",C,-1),setTimeout(()=>{Ht("ICE",E,G,M)},300),setTimeout(()=>{const Ge=rt.current.players[C].board,Ve=Ge.filter(ge=>ge!==null);if(Ve.length>0){const ge=Ve[Math.floor(Math.random()*Ve.length)],K=Ge.findIndex(le=>(le==null?void 0:le.instanceId)===(ge==null?void 0:ge.instanceId));K!==-1&&Ht("WATER",C,K,ge==null?void 0:ge.instanceId)}},600));const ce=window.innerWidth/2,Z=window.innerHeight-200*p/2,pe=window.innerWidth/2,be=window.innerHeight/2,Xe=()=>{V.type==="SPELL"||$n(),ds({type:"PLAY_CARD",playerId:P,payload:{cardIndex:U,targetId:M,instanceId:V.instanceId}}),V.id==="c_amandava"&&rt.current.players[C].board.forEach((ge,K)=>{if(ge){const le=ge.instanceId;setTimeout(()=>{Ht("SHOT",C,K,le)},200)}}),Fn(null),setTimeout(()=>{fn.current=!1},100)};let Ie,Ye;if(V.type==="FOLLOWER"){const Ve=rt.current.players[P].board.filter(se=>se!==null),ge=Ve.length+1,K=Ve.length,le=li*p,ne=(K-(ge-1)/2)*le,oe=(J=Vi.current)==null?void 0:J.getBoundingClientRect();Ie=(oe?oe.left+oe.width/2:window.innerWidth/2)+ne,Ye=window.innerHeight/2+70*p}const Ze=V.type==="FOLLOWER"?rt.current.players[P].board.filter(Ge=>Ge!==null).length:void 0;n!=="CPU"&&x&&_&&_.send({type:"PLAY_CARD_ANIM",payload:{playerId:P,cardIndex:U,card:V,targetBoardIndex:Ze}}),Fn({card:V,sourceIndex:it.sourceIndex??-1,startX:ce,startY:Z,targetX:pe,targetY:be,finalX:Ie,finalY:Ye,playerClass:(ae==null?void 0:ae.class)||"SENKA",onComplete:Xe}),setTimeout(()=>{Fn(Ge=>(Ge==null?void 0:Ge.card.id)===V.id?(Xe(),null):Ge)},2e3)}else if(it.type==="EVOLVE"){const $=it.sourceVisualIndex??it.sourceIndex;hc($,!!it.useSep,M,it.sourceInstanceId)}ii(null)},Im=()=>{if(!Fe||Fe.owner!=="PLAYER")return;if(fn.current){console.warn("[handleUseButtonClick] Card play in progress, ignoring");return}const m=ae.hand.findIndex(O=>O.id===Fe.card.id);if(m===-1)return;const b=window.innerWidth/2,E=window.innerHeight-200*p/2;xf(m,b,E),Ur(null)},[Ji,Ef]=N.useState(!1),[gc,Sf]=N.useState(!1),[Yt,If]=N.useState(null),SI=N.useRef(0);N.useEffect(()=>{if(!(Yt!=null&&Yt.active))return;const m=Date.now(),b=800,E=()=>{const O=Date.now()-m;if(O>=b){If(null);return}const M=O/b;If(G=>G?{...G,ringRadius:20+M*100,particles:G.particles.map(J=>({...J,x:J.x+J.vx,y:J.y+J.vy,opacity:1-M}))}:null),requestAnimationFrame(E)};requestAnimationFrame(E)},[Yt==null?void 0:Yt.active]);const wm=(m,b)=>{const E=[];for(let O=0;O<20;O++){const M=Math.random()*Math.PI*2,G=2+Math.random()*3;E.push({id:SI.current++,x:m,y:b,vx:Math.cos(M)*G,vy:Math.sin(M)*G,opacity:1,createdAt:Date.now()})}If({active:!0,x:m,y:b,ringRadius:20,particles:E})},wf=async()=>{if(g.winnerId){console.log("[handleEndTurn] Game is over, ignoring");return}if(g.activePlayerId!==P){console.log("[handleEndTurn] Not my turn, ignoring");return}if(Xi.current){console.log("[handleEndTurn] Already ending turn, ignoring");return}Xi.current=!0,Ef(!0);const m=rt.current.turnCount,b=rt.current.activePlayerId;if(!await(async()=>{const M=()=>{const V=rt.current,ce=V.pendingEffects&&V.pendingEffects.length>0,Z=yf.current.length>0,pe=vf.current.length>0,be=fa.current!==null,Xe=Qi.current!==null,Ie=$r.current,Ye=fn.current;return!ce&&!Z&&!pe&&!be&&!Xe&&!Ie&&!Ye};let $=0,U=0;for(;$<3e3;){if(rt.current.turnCount!==m||rt.current.activePlayerId!==b)return console.log("[handleEndTurn] Turn changed during wait, aborting local END_TURN"),!1;if(M()){if(U++,U>=2)break}else U=0;await new Promise(V=>setTimeout(V,50)),$+=50}return $>=3e3&&console.warn("[handleEndTurn] Timeout waiting for processing to complete - forcing end turn"),!0})()||rt.current.turnCount!==m||rt.current.activePlayerId!==b||rt.current.activePlayerId!==P){console.log("[handleEndTurn] Turn state changed, aborting END_TURN dispatch"),Xi.current=!1,Ef(!1);return}console.log("[handleEndTurn] Dispatching END_TURN"),ds({type:"END_TURN",playerId:P}),Xi.current=!1,Ef(!1)},II=L.useCallback(()=>{vt("sisiodosi.mp3",.6);const m=sm.current;if(m){const b=m.getBoundingClientRect();wm(b.left+b.width/2,b.top+b.height/2)}wf()},[vt,wf]),Tm=2-((ae==null?void 0:ae.evolutionsUsed)||0),Tf=P===g.firstPlayerId,Cm=(m,b)=>b?Math.ceil(g.turnCount/2):Math.floor(g.turnCount/2),km=Cm(P,Tf),wI=Tf?3:2,TI=Tf?4:3,mc=km>=wI,yc=km>=TI,fs=(ae==null?void 0:ae.canEvolveThisTurn)&&Tm>0&&g.activePlayerId===P&&mc,hs=(ae==null?void 0:ae.canEvolveThisTurn)&&ae.sep>0&&g.activePlayerId===P&&yc,Cf=C===g.firstPlayerId,Rm=Cm(C,Cf),CI=Cf?3:2,kI=Cf?4:3,kf=Rm>=CI,Rf=Rm>=kI,Af=((Nm=ae==null?void 0:ae.board)==null?void 0:Nm.some(m=>{var b;return(b=m==null?void 0:m.passiveAbilities)==null?void 0:b.includes("LEADER_DAMAGE_CAP")}))??!1,Pf=((jm=Le==null?void 0:Le.board)==null?void 0:jm.some(m=>{var b;return(b=m==null?void 0:m.passiveAbilities)==null?void 0:b.includes("LEADER_DAMAGE_CAP")}))??!1,RI=(ae==null?void 0:ae.leaderDamageShield)??!1,AI=(Le==null?void 0:Le.leaderDamageShield)??!1,Am=Af||RI,Pm=Pf||AI;return L.useLayoutEffect(()=>{window.scrollTo(0,0),Vi.current&&(Vi.current.scrollTop=0);const m=()=>{window.scrollTo(0,0)};return window.addEventListener("scroll",m,{passive:!1}),()=>{window.removeEventListener("scroll",m)}},[]),n==="JOIN"&&!A||X&&v&&!A?a.jsxs("div",{style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",gap:"1rem"},children:[a.jsx("div",{style:{width:"50px",height:"50px",border:"4px solid rgba(233, 69, 96, 0.3)",borderTop:"4px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),a.jsx("p",{children:"..."}),a.jsx("button",{onClick:s,style:{marginTop:"1rem",padding:"0.5rem 1rem",background:"transparent",border:"1px solid #888",color:"#888",cursor:"pointer",borderRadius:"4px"},children:""}),a.jsx("style",{children:`
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                `})]}):X&&$e&&A?a.jsxs("div",{style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",gap:"1rem"},children:[a.jsx("div",{style:{fontSize:"2rem",fontWeight:"bold",color:"#4ade80",textShadow:"0 0 10px rgba(74, 222, 128, 0.5)",marginBottom:"0.5rem"},children:""}),a.jsx("div",{style:{width:"50px",height:"50px",border:"4px solid rgba(74, 222, 128, 0.3)",borderTop:"4px solid #4ade80",borderRadius:"50%",animation:"spin 1s linear infinite"}}),a.jsx("p",{style:{color:"#a0aec0"},children:"..."}),a.jsx("style",{children:`
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                `})]}):a.jsxs("div",{className:"game-screen-wrapper",style:{width:"100vw",height:"100dvh",overflow:"hidden",background:"#000",position:"relative"},children:[F&&a.jsx(qL,{myPlayer:ae,opponentPlayer:Le,isFirstPlayer:as,onComplete:vI,scale:p,onVsImpact:()=>vt("vs.mp3",.7),onCoinToss:()=>vt("coin.mp3",.7),onImpact:()=>vt("gan.mp3",.7),onOrbLand:()=>vt("gan.mp3",.8),onFadeInBoard:()=>Ee(!0),isMobile:H}),a.jsxs("div",{className:"game-screen",style:{width:"100%",height:"100%",transform:ut>0?`translate(${ie.x}px, ${ie.y}px)`:"none",display:"flex",overflow:"hidden",background:"radial-gradient(circle at center, #1a202c 0%, #000 100%)",fontFamily:"'Helvetica Neue', sans-serif",userSelect:"none",color:"#fff",position:"absolute",top:0,left:0,opacity:F&&!ke?0:1,transition:"opacity 0.5s ease-in"},onClick:EI,children:[a.jsx("style",{children:`
                    html, body {
                        margin: 0; padding: 0; height: 100%; background: #000;
                        overflow: hidden !important;
                        position: fixed !important;
                        width: 100% !important;
                        top: 0 !important;
                        left: 0 !important;
                    }
                    * { box-sizing: border-box; }
                    .shake-target { animation: shake 0.3s cubic-bezier(.36,.07,.19,.97) both; }
                    @keyframes shake {
                        10%, 90% { transform: translate3d(-1px, 0, 0); }
                        20%, 80% { transform: translate3d(2px, 0, 0); }
                        30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
                        40%, 60% { transform: translate3d(4px, 0, 0); }
                    }
                    @keyframes attackRotate {
                        0% { transform: rotateY(0deg); }
                        100% { transform: rotateY(360deg); }
                    }
                    .attack-rotating {
                        animation: attackRotate 0.2s linear forwards !important;
                        transform-style: preserve-3d;
                    }
                    @keyframes cardDie {
                        0% { transform: scale(1); filter: brightness(1) drop-shadow(0 0 0 white); opacity: 1; }
                        40% { transform: scale(1.15); filter: brightness(3) drop-shadow(0 0 20px white); opacity: 0.9; }
                        100% { transform: scale(0.4) rotate(8deg); filter: brightness(5) drop-shadow(0 0 40px white); opacity: 0; }
                    }
                    .card-dying { animation: cardDie 0.7s forwards; }
                    /* Necromance effect animations */
                    @keyframes necromanceFloat {
                        0% { transform: translateX(-50%) translateY(0) scale(1); opacity: 1; }
                        50% { transform: translateX(-50%) translateY(-20px) scale(1.2); opacity: 1; }
                        100% { transform: translateX(-50%) translateY(-40px) scale(0.8); opacity: 0; }
                    }
                    @keyframes necromanceFloatOpponent {
                        0% { transform: translateX(-50%) translateY(0) scale(1); opacity: 1; }
                        50% { transform: translateX(-50%) translateY(15px) scale(1.2); opacity: 1; }
                        100% { transform: translateX(-50%) translateY(30px) scale(0.8); opacity: 0; }
                    }
                    @keyframes necroPulse {
                        0%, 100% { box-shadow: 0 0 10px #d946ef, 0 0 20px #a855f7, inset 0 0 15px rgba(217, 70, 239, 0.3); }
                        50% { box-shadow: 0 0 25px #d946ef, 0 0 40px #a855f7, 0 0 60px #7c3aed, inset 0 0 25px rgba(217, 70, 239, 0.5); }
                    }
                    @keyframes leaderDamageCapPulse {
                        0%, 100% {
                            box-shadow: 0 0 20px rgba(103, 232, 249, 0.4), 0 0 40px rgba(103, 232, 249, 0.2);
                            border-color: #67e8f9;
                        }
                        50% {
                            box-shadow: 0 0 35px rgba(103, 232, 249, 0.7), 0 0 55px rgba(103, 232, 249, 0.4);
                            border-color: #a5f3fc;
                        }
                    }
                    @keyframes leaderDamageCapOverlay {
                        0%, 100% { opacity: 0.15; }
                        50% { opacity: 0.45; }
                    }
                    /* EP/SEP pulse animations for usable state - box-shadow only, no transform override */
                    @keyframes epPulse {
                        0%, 100% {
                            box-shadow: 0 0 12px #ffd700, 0 0 25px rgba(255,215,0,0.6);
                        }
                        50% {
                            box-shadow: 0 0 20px #ffd700, 0 0 40px rgba(255,215,0,0.8), 0 0 55px rgba(255,180,0,0.5);
                        }
                    }
                    @keyframes sepPulse {
                        0%, 100% {
                            box-shadow: 0 0 12px #b794f4, 0 0 25px rgba(159,122,234,0.6);
                        }
                        50% {
                            box-shadow: 0 0 20px #b794f4, 0 0 40px rgba(159,122,234,0.8), 0 0 55px rgba(180,0,255,0.5);
                        }
                    }
                `}),it&&a.jsx("div",{style:{position:"absolute",top:"15%",left:"50%",transform:"translate(-50%, -50%)",background:"rgba(0, 0, 0, 0.7)",color:"#fff",padding:"10px 20px",borderRadius:20,pointerEvents:"none",zIndex:1e3,fontWeight:"bold",border:it.allowedTargetPlayerId===P?"2px solid #48bb78":"2px solid #f56565"},children:it.allowedTargetPlayerId===P?"":""}),pI&&a.jsx(m3,{onClose:()=>df(!1)}),hI&&a.jsx("div",{style:{position:"absolute",inset:0,zIndex:4e3,background:"rgba(0,0,0,0.8)",backdropFilter:"blur(5px)",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>ac(!1),children:a.jsxs("div",{style:{background:"#2d3748",padding:40,borderRadius:16,display:"flex",flexDirection:"column",gap:20,minWidth:300,border:"1px solid rgba(255,255,255,0.1)"},onClick:m=>m.stopPropagation(),children:[a.jsx("h2",{style:{margin:0,textAlign:"center",borderBottom:"1px solid #4a5568",paddingBottom:10,color:"#fff"},children:""}),fI?a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:15},children:[a.jsx("h3",{style:{margin:0,color:"#cbd5e0"},children:""}),a.jsxs("label",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",color:"white"},children:["BGM",a.jsx("input",{type:"checkbox",checked:Tt.bgmEnabled,onChange:m=>ca(b=>({...b,bgmEnabled:m.target.checked})),style:{width:20,height:20}})]}),a.jsxs("label",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",color:"white"},children:["SE",a.jsx("input",{type:"checkbox",checked:Tt.seEnabled,onChange:m=>ca(b=>({...b,seEnabled:m.target.checked})),style:{width:20,height:20}})]}),a.jsxs("div",{children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",color:"#a0aec0",marginBottom:5},children:[a.jsx("span",{children:"BGM"}),a.jsxs("span",{children:[Math.round(Tt.bgm*100),"%"]})]}),a.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:Tt.bgm,onChange:m=>ca(b=>({...b,bgm:parseFloat(m.target.value)})),style:{width:"100%"}})]}),a.jsxs("div",{children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",color:"#a0aec0",marginBottom:5},children:[a.jsx("span",{children:"SE"}),a.jsxs("span",{children:[Math.round(Tt.se*100),"%"]})]}),a.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:Tt.se,onChange:m=>ca(b=>({...b,se:parseFloat(m.target.value)})),style:{width:"100%"}})]}),a.jsxs("div",{children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",color:"#a0aec0",marginBottom:5},children:[a.jsx("span",{children:""}),a.jsxs("span",{children:[Math.round(Tt.voice*100),"%"]})]}),a.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:Tt.voice,onChange:m=>ca(b=>({...b,voice:parseFloat(m.target.value)})),style:{width:"100%"}})]}),a.jsx("button",{onClick:()=>hm(!1),style:{padding:10,background:"#4a5568",border:"none",color:"white",borderRadius:8,cursor:"pointer",marginTop:10},children:""})]}):a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:()=>ac(!1),style:{padding:15,background:"#4a5568",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.2rem"},children:""}),a.jsx("button",{onClick:()=>hm(!0),style:{padding:15,background:"#2b6cb0",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.2rem"},children:""}),a.jsx("button",{onClick:()=>lc(!0),style:{padding:15,background:"#e53e3e",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.2rem"},children:""})]})]})}),gI&&a.jsx("div",{style:{position:"absolute",inset:0,zIndex:4100,background:"rgba(0,0,0,0.85)",backdropFilter:"blur(5px)",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>lc(!1),children:a.jsxs("div",{style:{background:"#2d3748",padding:40,borderRadius:16,display:"flex",flexDirection:"column",gap:20,minWidth:320,border:"2px solid #e53e3e",boxShadow:"0 0 30px rgba(229, 62, 62, 0.3)"},onClick:m=>m.stopPropagation(),children:[a.jsx("h2",{style:{margin:0,textAlign:"center",color:"#fff",fontSize:"1.5rem"},children:""}),a.jsx("p",{style:{margin:0,textAlign:"center",color:"#a0aec0",fontSize:"1rem"},children:""}),a.jsxs("div",{style:{display:"flex",gap:15,marginTop:10},children:[a.jsx("button",{onClick:()=>lc(!1),style:{flex:1,padding:15,background:"#4a5568",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.1rem"},children:""}),a.jsx("button",{onClick:mI,style:{flex:1,padding:15,background:"#e53e3e",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.1rem"},children:""})]})]})}),a.jsxs("div",{className:pm?"shake-target":"",style:{width:(H?280:340)*p,borderRight:"1px solid rgba(255,255,255,0.1)",background:"rgba(0,0,0,0.3)",padding:H?`${10*p}px ${12*p}px`:`${20*p}px ${20*p}px ${20*p}px`,display:"flex",flexDirection:"column",zIndex:20,flexShrink:0},onClick:m=>m.stopPropagation(),children:[a.jsx("div",{style:{marginBottom:(H?6:12)*p},children:a.jsxs("button",{onClick:()=>ac(!0),style:{background:"transparent",border:"none",cursor:"pointer",padding:H?3:5},children:[a.jsx("div",{style:{width:(H?22:30)*p,height:(H?2:3)*p,background:"#cbd5e0",marginBottom:(H?4:6)*p}}),a.jsx("div",{style:{width:(H?22:30)*p,height:(H?2:3)*p,background:"#cbd5e0",marginBottom:(H?4:6)*p}}),a.jsx("div",{style:{width:(H?22:30)*p,height:(H?2:3)*p,background:"#cbd5e0"}})]})}),a.jsx("h3",{style:{color:"#a0aec0",borderBottom:"1px solid #4a5568",paddingBottom:(H?4:8)*p,marginTop:0,marginBottom:0,flexShrink:0,fontSize:H?`${.85*p}rem`:void 0},children:""}),Fe?a.jsx("div",{style:{marginTop:(H?4:10)*p,display:"flex",flexDirection:"column",flex:1,overflow:"hidden",minHeight:0},children:a.jsxs("div",{style:{flex:1,overflow:"auto",minHeight:0,display:"flex",flexDirection:"column"},children:[a.jsxs("div",{style:{flexShrink:0},children:[a.jsx("div",{style:{width:"100%",aspectRatio:"1/1",marginBottom:(H?6:12)*p,display:"flex",alignItems:"center",justifyContent:"center",...H?{maxHeight:"28vh"}:{}},children:a.jsx(eo,{card:Fe.card,style:{width:"100%",height:"100%",...H?{maxHeight:"28vh"}:{}},variant:"art-only"})}),a.jsx("div",{style:{fontSize:H?`${(Fe.card.name.length>12?.9:Fe.card.name.length>8?1:1.1)*p}rem`:`${Fe.card.name.length>12?1.1:Fe.card.name.length>8?1.2:1.4}rem`,fontWeight:"bold",marginBottom:(H?4:6)*p,textAlign:"center"},children:Fe.card.name}),a.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:(H?10:15)*p,marginBottom:(H?6:10)*p},children:[a.jsx("div",{style:{width:24*p,height:24*p,borderRadius:"50%",background:"radial-gradient(circle at 30% 30%, #68d391, #276749)",border:"1px solid #fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${.85*p}rem`,fontWeight:900,color:"white",textShadow:"0 1px 2px rgba(0,0,0,0.5)",boxShadow:"0 2px 4px rgba(0,0,0,0.3)"},children:Fe.card.cost}),Fe.card.type==="FOLLOWER"&&a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:3*p},children:[a.jsx("svg",{width:18*p,height:18*p,viewBox:"0 0 24 24",fill:"none",children:a.jsx("polygon",{points:"12,2 22,22 2,22",fill:"#63b3ed",stroke:"none"})}),a.jsx("span",{style:{fontSize:`${.95*p}rem`,fontWeight:"bold",color:"#4299e1"},children:"currentAttack"in Fe.card?Fe.card.currentAttack:Fe.card.attack})]}),Fe.card.type==="FOLLOWER"&&a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:3*p},children:[a.jsx("svg",{width:18*p,height:18*p,viewBox:"0 0 24 24",fill:"#f56565",children:a.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})}),a.jsx("span",{style:{fontSize:`${.95*p}rem`,fontWeight:"bold",color:"#f56565"},children:"currentHealth"in Fe.card?Fe.card.currentHealth:Fe.card.health})]})]}),a.jsx("div",{style:{fontSize:`${(((($m=Fe.card.description)==null?void 0:$m.length)||0)>150?.7:(((Fm=Fe.card.description)==null?void 0:Fm.length)||0)>100?.8:.9)*p}rem`,color:"#cbd5e0",lineHeight:"1.4",whiteSpace:"pre-wrap",borderTop:"1px solid #4a5568",paddingTop:4*p},children:uI(Fe.card.description)})]}),Fe.card.flavorText&&a.jsx("div",{style:{marginTop:"auto",paddingTop:8*p,paddingBottom:4*p,flexShrink:0},children:a.jsx("div",{style:{fontSize:`${((((Um=Fe.card.flavorText)==null?void 0:Um.length)||0)>100?.6:.7)*p}rem`,color:"rgba(160, 174, 192, 0.6)",lineHeight:"1.3",fontStyle:"italic",whiteSpace:"pre-wrap",textAlign:"right"},children:Fe.card.flavorText})})]})}):a.jsx("div",{style:{marginTop:10*p,color:"#718096",fontStyle:"italic",flex:1,fontSize:`${.7*p}rem`},children:""})]}),a.jsxs("div",{ref:Vi,className:pm?"shake-target":"",style:{flex:1,height:"100%",position:"relative",background:"rgba(0,0,0,0.1)",overflow:"hidden"},children:[a.jsxs("div",{ref:Yi,onMouseEnter:()=>Yn({type:"LEADER",playerId:C}),onMouseLeave:()=>Yn(null),onClick:m=>{m.stopPropagation(),it&&bf("LEADER",-1,C)},style:{position:"absolute",top:-20*p,left:"50%",transform:"translateX(-50%)",width:to*p,height:to*p,borderRadius:"50%",zIndex:100,cursor:"default"},children:[a.jsx("div",{style:{position:"absolute",inset:0,borderRadius:"50%",background:Le.class==="AJA"?`url(${qa(Le.class)}) center top/cover`:`url(${qa(Le.class)}) center/cover`,border:Pf?"4px solid #67e8f9":(ft==null?void 0:ft.type)==="LEADER"&&ft.playerId===C&&!it?"4px solid #f56565":"4px solid #4a5568",boxShadow:Pf?"0 0 20px rgba(103, 232, 249, 0.4), 0 0 40px rgba(103, 232, 249, 0.2)":"0 0 20px rgba(0,0,0,0.5)",transition:"border-color 0.3s, box-shadow 0.3s, filter 0.5s, opacity 0.5s",animation:Pm?"leaderDamageCapPulse 2s ease-in-out infinite":"none",...g.winnerId===P&&(B||st)?{filter:B==="white-fade"?"brightness(2) saturate(0.3)":B==="explode"||B==="result-text"||B==="fade-out"||st?"brightness(3) saturate(0) blur(10px)":"none",opacity:B==="explode"||B==="result-text"||B==="fade-out"||st?0:1}:{}},children:Pm&&a.jsx("div",{style:{position:"absolute",inset:0,borderRadius:"50%",background:"radial-gradient(circle, rgba(103, 232, 249, 0.5) 0%, rgba(103, 232, 249, 0.2) 70%, rgba(103, 232, 249, 0.1) 100%)",pointerEvents:"none",animation:"leaderDamageCapOverlay 2s ease-in-out infinite",zIndex:1}})}),a.jsx("div",{style:{position:"absolute",bottom:0,left:"50%",transform:`translateX(-50%) translateX(${-140*p}px)`,width:55*p,height:55*p,background:"radial-gradient(circle at 30% 30%, #feb2b2, #c53030)",borderRadius:"50%",border:`${Math.max(2,3*p)}px solid #fff`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${1.2*p}rem`,fontWeight:900,color:"white",textShadow:"0 2px 2px rgba(0,0,0,0.5)",zIndex:10,boxShadow:"0 4px 6px rgba(0,0,0,0.4)",opacity:ee?1:0,transition:"opacity 0.3s ease-in"},children:Le.hp}),a.jsx("div",{style:{position:"absolute",bottom:10*p,left:"50%",transform:`translateX(-50%) translateX(${-80*p}px)`,width:45*p,height:45*p,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,opacity:ee?kf?1:.5:0,filter:kf?"none":"grayscale(0.8)",transition:"opacity 0.3s ease-in"},children:a.jsx("div",{style:{display:"flex",gap:3*p},children:Array(2).fill(0).map((m,b)=>{const E=b<2-Le.evolutionsUsed;return a.jsx("div",{style:{width:12*p,height:12*p,borderRadius:"50%",background:E?"#ecc94b":"#2d3748",boxShadow:E&&kf?"0 0 8px #ecc94b, 0 0 15px #ecc94b":"none",border:"2px solid rgba(0,0,0,0.5)"}},b)})})}),a.jsx("div",{style:{position:"absolute",bottom:10*p,left:"50%",transform:`translateX(-50%) translateX(${80*p}px)`,width:45*p,height:45*p,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,opacity:ee?Rf?1:.5:0,filter:Rf?"none":"grayscale(0.8)",transition:"opacity 0.3s ease-in"},children:a.jsx("div",{style:{display:"flex",gap:3*p},children:Array(2).fill(0).map((m,b)=>{const E=b<Le.sep;return a.jsx("div",{style:{width:12*p,height:12*p,borderRadius:"50%",background:E?"#9f7aea":"#2d3748",boxShadow:E&&Rf?"0 0 8px #9f7aea, 0 0 15px #9f7aea":"none",border:"2px solid rgba(0,0,0,0.5)"}},b)})})}),a.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:to*p*.75,height:to*p*.75,pointerEvents:"none",zIndex:20,opacity:(ft==null?void 0:ft.type)==="LEADER"&&ft.playerId===C&&Q?1:0,transition:"opacity 0.1s ease-out"},children:[a.jsxs("svg",{width:"100%",height:"100%",viewBox:"0 0 100 100",children:[a.jsx("defs",{children:a.jsxs("filter",{id:"leaderCyanMarkerGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"4",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsxs("g",{style:{transformOrigin:"50% 50%",animation:"leaderMarkerSpin 2s linear infinite"},children:[a.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"rgba(100, 200, 255, 0.9)",strokeWidth:"3",strokeDasharray:"15 8",filter:"url(#leaderCyanMarkerGlow)"}),a.jsx("polygon",{points:"50,5 44,18 56,18",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"}),a.jsx("polygon",{points:"95,50 82,44 82,56",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"}),a.jsx("polygon",{points:"50,95 56,82 44,82",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"}),a.jsx("polygon",{points:"5,50 18,56 18,44",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"})]})]}),a.jsx("style",{children:`
                                @keyframes leaderMarkerSpin {
                                    0% { transform: rotate(0deg); }
                                    100% { transform: rotate(360deg); }
                                }
                            `})]})]}),a.jsxs("div",{style:{position:"absolute",top:20*p,left:20*p,width:60*p,height:85*p,zIndex:50},children:[[...Array(Math.min(5,Math.ceil(Le.deck.length/5)))].map((m,b)=>a.jsx("div",{style:{position:"absolute",inset:0,transform:`translate(${b*2*p}px, ${-b*2*p}px)`,borderRadius:6,border:"1px solid #718096",overflow:"hidden"},children:a.jsx("img",{src:ai((Le==null?void 0:Le.class)||"SENKA"),alt:"Deck",style:{width:"100%",height:"100%",objectFit:"cover"},onError:E=>{E.target.style.display="none",E.target.parentElement.style.background="linear-gradient(45deg, #2d3748, #1a202c)"}})},b)),a.jsx("div",{style:{position:"absolute",bottom:-20*p,width:"100%",textAlign:"center",fontWeight:"bold",color:"#a0aec0",fontSize:"0.9rem"},children:Le.deck.length})]}),a.jsxs("div",{style:{position:"absolute",top:20*p,right:20*p,display:"flex",alignItems:"center",gap:8,zIndex:50,pointerEvents:"none"},children:[a.jsxs("div",{style:{position:"relative",width:24,height:30},children:[a.jsx("div",{style:{position:"absolute",inset:0,background:"#4a192c",borderRadius:2,border:"1px solid #742a3a",transform:"rotate(-15deg) translate(-3px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#3d1525",borderRadius:2,border:"1px solid #742a3a",transform:"rotate(-5deg) translate(-1px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#2d1a20",borderRadius:2,border:"1px solid #8b3a4a",transform:"rotate(5deg)"}})]}),a.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(74, 25, 44, 0.8), rgba(45, 26, 32, 0.9))",padding:"3px 8px",borderRadius:5,color:"#f0b8c4",fontSize:"0.64rem",fontWeight:"bold",border:"1px solid rgba(116, 42, 58, 0.5)",boxShadow:"0 2px 4px rgba(0,0,0,0.4)"},children:[" ",Le.hand.length]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5,marginLeft:6},children:[a.jsx("div",{style:{fontSize:"0.9rem",filter:"drop-shadow(0 0 2px rgba(128, 90, 213, 0.6)) grayscale(30%)"},children:""}),a.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(128, 90, 213, 0.7), rgba(76, 29, 149, 0.8))",padding:"3px 8px",borderRadius:5,color:"#c4b5fd",fontSize:"0.64rem",fontWeight:"bold",border:"1px solid rgba(167, 139, 250, 0.4)",boxShadow:"0 2px 4px rgba(0,0,0,0.4)",position:"relative"},children:[" ",Le.graveyard.length,Zu.filter(m=>m.playerId===C).map(m=>a.jsxs("div",{style:{position:"absolute",bottom:-25,left:"50%",transform:"translateX(-50%)",color:"#d946ef",fontSize:"1.2rem",fontWeight:"bold",textShadow:"0 0 8px #d946ef, 0 0 15px #a855f7, 0 0 25px #7c3aed",animation:"necromanceFloatOpponent 1.5s ease-out forwards",pointerEvents:"none",whiteSpace:"nowrap"},children:["-",m.amount]},m.key))]})]})]}),a.jsx("div",{style:{position:"absolute",top:`calc(50% - ${bn*p/2}px - ${70*p}px)`,left:"0",width:"100%",height:bn*p,pointerEvents:"none",zIndex:10},children:a.jsx("div",{style:{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center"},children:un.map((m,b)=>{const E=un.length,O=(b-(E-1)/2)*li*p;return a.jsxs("div",{ref:M=>ir.current[b]=M,onMouseEnter:()=>{Q&&Yn({type:"FOLLOWER",index:b,playerId:C,instanceId:m==null?void 0:m.instanceId})},onMouseLeave:()=>{Q&&Yn(null)},onClick:M=>{if(M.stopPropagation(),it){if(!m)return;bf("FOLLOWER",b,C,m==null?void 0:m.instanceId)}else m&&Ur({card:m,owner:"OPPONENT",source:"BOARD"})},style:{position:"absolute",left:"50%",top:0,transform:`translateX(calc(-50% + ${O}px))`,transition:"transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1), left 0.4s ease",border:it&&m&&it.allowedTargetPlayerId===C?"2px solid #f56565":"none",boxShadow:it&&m&&it.allowedTargetPlayerId===C?"0 0 15px #f56565":"none",borderRadius:8,cursor:it?"crosshair":"default",width:an*p,height:bn*p,pointerEvents:"auto",opacity:Ot&&Ot.sourcePlayerId===C&&Ot.followerIndex===b?0:m!=null&&m.isDying?.8:1,transitionProperty:Ot&&Ot.sourcePlayerId===C&&Ot.followerIndex===b?"none":"transform, left, opacity"},children:[a.jsx("div",{style:{width:"100%",height:"100%",perspective:"800px"},children:a.jsxs("div",{className:am===(m==null?void 0:m.instanceId)||lm===(m==null?void 0:m.instanceId)?"attack-rotating":"",style:{width:"100%",height:"100%",position:"relative",transformStyle:"preserve-3d"},children:[a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},children:m?a.jsx(eo,{card:m,turnCount:g.turnCount,className:m.isDying?"card-dying":"",scale:p,style:{width:an*p,height:bn*p,opacity:1,filter:m.isDying?"grayscale(0.5) brightness(2)":"none",boxShadow:(ft==null?void 0:ft.type)==="FOLLOWER"&&ft.index===b&&(Q==null?void 0:Q.sourceType)==="BOARD"?"0 0 20px #f56565":(Q==null?void 0:Q.sourceType)==="BOARD"?"0 0 20px #f6e05e":void 0},isOnBoard:!0,isSpecialSummoning:om.has(m.instanceId)}):a.jsx("div",{style:{width:an*p,height:bn*p,border:"1px dashed rgba(255,255,255,0.1)",borderRadius:8}})}),m&&a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",transform:"rotateY(180deg)",borderRadius:12,overflow:"hidden"},children:a.jsx("img",{src:ai((Le==null?void 0:Le.class)||"SENKA"),alt:"Card Sleeve",style:{width:"100%",height:"100%",objectFit:"cover"}})})]})}),m&&(Q==null?void 0:Q.sourceType)==="BOARD"&&a.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",width:"100%",height:"100%",transform:"translate(-50%, -50%)",pointerEvents:"none",zIndex:20,opacity:(ft==null?void 0:ft.type)==="FOLLOWER"&&ft.index===b&&ft.playerId===C?1:0,transition:"opacity 0.1s ease-out"},children:[a.jsxs("svg",{viewBox:"0 0 100 100",style:{width:"100%",height:"100%",filter:"drop-shadow(0 0 12px rgba(100, 200, 255, 0.9))"},children:[a.jsx("defs",{children:a.jsxs("filter",{id:"cyanMarkerGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"4",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsxs("g",{style:{transformOrigin:"50px 50px",animation:"attackMarkerSpin 1.5s linear infinite reverse"},children:[a.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:"rgba(100, 200, 255, 0.95)",strokeWidth:"4",strokeDasharray:"12 6",filter:"url(#cyanMarkerGlow)"}),a.jsx("polygon",{points:"50,10 45,20 55,20",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"}),a.jsx("polygon",{points:"90,50 80,45 80,55",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"}),a.jsx("polygon",{points:"50,90 55,80 45,80",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"}),a.jsx("polygon",{points:"10,50 20,55 20,45",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"})]})]}),a.jsx("style",{children:`
                                                    @keyframes attackMarkerSpin {
                                                        0% { transform: rotate(0deg); }
                                                        100% { transform: rotate(360deg); }
                                                    }
                                                `})]})]},(m==null?void 0:m.instanceId)||`empty-opp-${b}`)})})}),a.jsx("div",{style:{position:"absolute",bottom:`calc(50% - ${bn*p/2}px - ${70*p}px)`,left:"0",width:"100%",height:bn*p,pointerEvents:"none",zIndex:10},children:a.jsx("div",{style:{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center"},children:_n.map((m,b)=>{const E=_n.length,O=(b-(E-1)/2)*li*p;return a.jsxs("div",{ref:M=>Ir.current[b]=M,onMouseDown:M=>xm(M,b,m==null?void 0:m.instanceId),onTouchStart:M=>xm(M,b,m==null?void 0:m.instanceId),onClick:M=>M.stopPropagation(),onMouseEnter:()=>{Q&&Yn({type:"FOLLOWER",index:b,playerId:P,instanceId:m==null?void 0:m.instanceId})},onMouseLeave:()=>{Q&&Yn(null)},style:{position:"absolute",left:"50%",top:0,"--offsetX":`calc(-50% + ${O}px)`,transform:`translateX(calc(-50% + ${O}px)) ${(Q==null?void 0:Q.sourceType)==="BOARD"&&Q.sourceInstanceId===(m==null?void 0:m.instanceId)?"translateY(-20px) scale(1.1)":""}`,transition:"transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1), left 0.4s ease",cursor:"pointer",pointerEvents:"auto",width:an*p,height:bn*p,border:it&&m&&it.allowedTargetPlayerId===P?"2px solid #48bb78":"none",boxShadow:it&&m&&it.allowedTargetPlayerId===P?"0 0 15px #48bb78":"none",borderRadius:8,zIndex:(Q==null?void 0:Q.sourceType)==="BOARD"&&Q.sourceInstanceId===(m==null?void 0:m.instanceId)?10:1,opacity:Ot&&Ot.sourcePlayerId===P&&Ot.followerIndex===b?0:m!=null&&m.isDying?.8:1,transitionProperty:Ot&&Ot.sourcePlayerId===P&&Ot.followerIndex===b?"none":"transform, left, opacity"},children:[a.jsx("div",{style:{width:"100%",height:"100%",perspective:"800px"},children:a.jsxs("div",{className:am===(m==null?void 0:m.instanceId)||lm===(m==null?void 0:m.instanceId)?"attack-rotating":"",style:{width:"100%",height:"100%",position:"relative",transformStyle:"preserve-3d"},children:[a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},children:m?a.jsx(eo,{card:m,turnCount:g.turnCount,className:m.isDying?"card-dying":"",scale:p,style:{width:an*p,height:bn*p,opacity:1,filter:m.isDying?"grayscale(0.5) brightness(2)":"none",boxShadow:(Q==null?void 0:Q.sourceType)==="BOARD"&&Q.sourceInstanceId===(m==null?void 0:m.instanceId)&&(ft==null?void 0:ft.type)==="FOLLOWER"?"0 0 30px #f56565":(Q==null?void 0:Q.sourceType)==="BOARD"&&Q.sourceInstanceId===(m==null?void 0:m.instanceId)?"0 20px 30px rgba(0,0,0,0.6)":void 0,pointerEvents:(Q==null?void 0:Q.sourceType)==="BOARD"&&Q.sourceInstanceId===(m==null?void 0:m.instanceId)?"none":"auto"},isSelected:(Fe==null?void 0:Fe.card)===m,isOnBoard:!0,isSpecialSummoning:om.has(m.instanceId),isMyTurn:g.activePlayerId===P}):a.jsx("div",{style:{width:an*p,height:bn*p,border:"1px dashed rgba(255,255,255,0.2)",borderRadius:8}})}),m&&a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",transform:"rotateY(180deg)",borderRadius:12,overflow:"hidden"},children:a.jsx("img",{src:ai((ae==null?void 0:ae.class)||"SENKA"),alt:"Card Sleeve",style:{width:"100%",height:"100%",objectFit:"cover"}})})]})}),m&&(Q==null?void 0:Q.sourceType)==="EVOLVE"&&!m.hasEvolved&&a.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",width:"120%",height:"120%",transform:"translate(-50%, -50%)",pointerEvents:"none",border:Q.useSep?"2px dashed rgba(183, 148, 244, 0.9)":"2px dashed rgba(255, 230, 100, 0.9)",borderRadius:"50%",boxShadow:Q.useSep?"0 0 15px rgba(159, 122, 234, 0.8)":"0 0 15px rgba(255, 200, 50, 0.8)",animation:"evolveMarkerSpin 1.5s linear infinite",zIndex:20,opacity:(ft==null?void 0:ft.type)==="FOLLOWER"&&ft.index===b&&ft.playerId===P?1:0,transition:"opacity 0.1s ease-out"},children:[a.jsxs("svg",{viewBox:"0 0 100 100",style:{width:"100%",height:"100%",filter:"drop-shadow(0 0 8px currentColor)"},children:[a.jsx("defs",{children:a.jsxs("filter",{id:Q.useSep?"purpleMarkerGlow":"yellowMarkerGlow",x:"-30%",y:"-30%",width:"160%",height:"160%",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"3",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:Q.useSep?"#b794f4":"#f6e05e",strokeWidth:"4",strokeDasharray:"15 8",filter:`url(#${Q.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`,opacity:"0.95"}),a.jsx("polygon",{points:"50,5 45,15 55,15",fill:Q.useSep?"#b794f4":"#f6e05e",filter:`url(#${Q.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`}),a.jsx("polygon",{points:"95,50 85,45 85,55",fill:Q.useSep?"#b794f4":"#f6e05e",filter:`url(#${Q.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`}),a.jsx("polygon",{points:"50,95 55,85 45,85",fill:Q.useSep?"#b794f4":"#f6e05e",filter:`url(#${Q.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`}),a.jsx("polygon",{points:"5,50 15,55 15,45",fill:Q.useSep?"#b794f4":"#f6e05e",filter:`url(#${Q.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`})]}),a.jsx("style",{children:`
                                                @keyframes evolveMarkerSpin {
                                                    0% { transform: translate(-50%, -50%) rotate(0deg); }
                                                    100% { transform: translate(-50%, -50%) rotate(360deg); }
                                                }
                                            `})]})]},(m==null?void 0:m.instanceId)||`empty-plr-${b}`)})})}),a.jsxs("div",{style:{position:"absolute",right:30*p,top:"50%",transform:"translateY(-50%)",display:"flex",flexDirection:"column",alignItems:"center",gap:30*p,zIndex:50},children:[a.jsx("div",{style:{textAlign:"center"},children:a.jsxs("div",{style:{fontSize:`${1.2*p}rem`,fontWeight:700,color:"#a0aec0",fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif'},children:["Turn ",g.turnCount]})}),a.jsxs("div",{style:{textAlign:"center"},children:[a.jsxs("div",{style:{fontSize:`${1.8*p}rem`,fontWeight:900,color:"#f6e05e",fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif'},children:[Le.pp,"/",Le.maxPp]}),a.jsx("div",{style:{display:"flex",gap:4*p,justifyContent:"center"},children:Array(Math.min(10,Le.maxPp)).fill(0).map((m,b)=>a.jsx("div",{style:{width:10*p,height:10*p,borderRadius:"50%",background:b<Le.pp?"#f6e05e":"#2d3748"}},b))})]}),a.jsxs("div",{style:{position:"relative",width:160*p,height:160*p},children:[a.jsx(e3,{isMyTurn:g.activePlayerId===P,turnCount:g.turnCount,activePlayerId:g.activePlayerId,onTimeUp:II,timerEnabled:h,isGameOver:!!g.winnerId,isPaused:F,scale:p,buttonSize:160,timerDuration:60}),a.jsxs("button",{ref:sm,disabled:g.activePlayerId!==P||Ji,onMouseDown:m=>{m.stopPropagation(),g.activePlayerId===P&&!Ji&&Sf(!0)},onMouseUp:m=>{var b;if(m.stopPropagation(),gc&&g.activePlayerId===P&&!Ji){Sf(!1),vt("sisiodosi.mp3",.6);const E=(b=m.target.closest("button"))==null?void 0:b.getBoundingClientRect();E&&wm(E.left+E.width/2,E.top+E.height/2),wf()}},onMouseLeave:()=>{Sf(!1)},style:{width:160*p,height:160*p,borderRadius:"50%",border:"4px solid rgba(255,255,255,0.2)",background:Ji?"linear-gradient(135deg, #805ad5, #6b46c1)":gc?"linear-gradient(135deg, #5a9bd5, #4a7fb0)":g.activePlayerId===P?"linear-gradient(135deg, #3182ce, #2b6cb0)":"#2d3748",color:"white",fontWeight:900,fontSize:`${2*p}rem`,fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif',boxShadow:g.activePlayerId===P?gc?"0 0 20px rgba(66, 153, 225, 0.5)":"0 0 40px rgba(66, 153, 225, 0.8)":"none",opacity:gc?.8:1,cursor:g.activePlayerId===P&&!Ji?"pointer":"default",transition:"all 0.1s",position:"relative",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",lineHeight:1.2},children:[a.jsx("img",{src:et("/assets/tenfubu_mark.png"),alt:"",style:{position:"absolute",width:"80%",height:"80%",objectFit:"contain",opacity:.25,pointerEvents:"none"}}),Ji?a.jsx("span",{style:{position:"relative",zIndex:1,whiteSpace:"nowrap"},children:"..."}):a.jsxs(a.Fragment,{children:[a.jsx("span",{style:{position:"relative",zIndex:1,whiteSpace:"nowrap"},children:""}),a.jsx("span",{style:{position:"relative",zIndex:1,whiteSpace:"nowrap"},children:""})]})]})]}),a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("div",{style:{fontSize:`${2.4*p}rem`,fontWeight:900,color:"#f6e05e",fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif'},children:ae.extraPpActive?a.jsxs("span",{children:[Math.max(0,ae.pp-1),"/",ae.maxPp," ",a.jsx("span",{style:{color:"#ed8936"},children:"+1"})]}):a.jsxs("span",{children:[ae.pp,"/",ae.maxPp]})}),a.jsx("div",{style:{display:"flex",gap:3*p,justifyContent:"center"},children:Array(10).fill(0).map((m,b)=>{const E=b<ae.pp,O=b<ae.maxPp;let M;return E?M="#f6e05e":O?M="#744210":M="#2d3748",a.jsx("div",{style:{width:11*p,height:11*p,borderRadius:"50%",background:M}},b)})})]}),(()=>{const m=P!==g.firstPlayerId,b=g.activePlayerId===P,E=g.turnCount,O=E<=5&&!ae.extraPpUsedEarly,M=E>=6&&!ae.extraPpUsedLate,G=m&&b&&!ae.extraPpActive&&(O||M),J=ae.extraPpActive;if(!m)return null;const $=E<=5&&ae.extraPpUsedEarly||E>=6&&ae.extraPpUsedLate,U=!G&&!J;return a.jsxs("button",{disabled:U,onClick:V=>{V.stopPropagation(),U||ds({type:"TOGGLE_EXTRA_PP",playerId:P})},style:{width:160*p,height:45*p,borderRadius:12*p,border:J?"3px solid #ed8936":"3px solid rgba(255,255,255,0.2)",background:J?"linear-gradient(135deg, #ed8936, #dd6b20)":G?"linear-gradient(135deg, #744210, #5a3510)":"#2d3748",color:J?"white":G?"#f6e05e":"#718096",fontWeight:700,fontSize:"1rem",boxShadow:J?"0 0 20px rgba(237, 137, 54, 0.6)":"none",cursor:U?"default":"pointer",transition:"all 0.3s",display:"flex",alignItems:"center",justifyContent:"center",gap:6*p,opacity:$&&!J?.5:1},children:[a.jsx("span",{children:"PP"}),a.jsx("span",{style:{fontSize:"1.3rem"},children:"+1"}),J&&a.jsx("span",{style:{fontSize:"0.8rem"},children:"ON"}),$&&!J&&a.jsx("span",{style:{fontSize:"0.7rem",marginLeft:2},children:""})]})})()]}),H?a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:m=>{m.stopPropagation(),df(!0)},style:{position:"absolute",left:15*p,top:120*p,width:64*p,height:64*p,minWidth:64*p,maxWidth:64*p,minHeight:64*p,maxHeight:64*p,borderRadius:"50%",background:"linear-gradient(135deg, #4a5568 0%, #2d3748 100%)",border:"3px solid #63b3ed",color:"#63b3ed",fontSize:`${1.8*p}rem`,fontWeight:"bold",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,padding:0,zIndex:16,boxShadow:"0 2px 8px rgba(0,0,0,0.4)",transition:"all 0.2s ease"},onMouseEnter:m=>{m.currentTarget.style.transform="scale(1.1)",m.currentTarget.style.boxShadow="0 0 15px rgba(99, 179, 237, 0.5)"},onMouseLeave:m=>{m.currentTarget.style.transform="scale(1)",m.currentTarget.style.boxShadow="0 2px 8px rgba(0,0,0,0.4)"},children:"?"}),a.jsx(y3,{logs:g.logs||[],onCardNameClick:af,scale:p,isMobile:H})]}):a.jsxs("div",{style:{position:"absolute",left:15,top:"50%",transform:"translateY(-50%)",display:"flex",flexDirection:"column",alignItems:"flex-start",gap:8,zIndex:16,pointerEvents:"none"},children:[a.jsx("button",{onClick:m=>{m.stopPropagation(),df(!0)},style:{width:36,height:36,borderRadius:"50%",background:"linear-gradient(135deg, #4a5568 0%, #2d3748 100%)",border:"2px solid #63b3ed",color:"#63b3ed",fontSize:"1.2rem",fontWeight:"bold",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",padding:0,boxShadow:"0 4px 12px rgba(0,0,0,0.4)",transition:"all 0.2s ease",pointerEvents:"auto"},onMouseEnter:m=>{m.currentTarget.style.transform="scale(1.1)",m.currentTarget.style.boxShadow="0 0 15px rgba(99, 179, 237, 0.5)"},onMouseLeave:m=>{m.currentTarget.style.transform="scale(1)",m.currentTarget.style.boxShadow="0 4px 12px rgba(0,0,0,0.4)"},children:"?"}),a.jsxs("div",{style:{width:Math.max(180,220*p),height:Math.max(200,280*p),overflowY:"auto",background:"linear-gradient(to right, rgba(0,0,0,0.8), rgba(0,0,0,0.0))",color:"#fff",fontSize:`${Math.max(.65,.75*p)}rem`,padding:`${8*p}px ${8*p}px ${8*p}px ${12*p}px`,borderLeft:"3px solid #63b3ed",pointerEvents:"auto",scrollbarWidth:"thin"},onMouseDown:m=>m.stopPropagation(),onClick:m=>m.stopPropagation(),ref:m=>{m&&(m.scrollTop=m.scrollHeight)},children:[a.jsx("div",{style:{fontWeight:"bold",marginBottom:4*p,color:"#a0aec0",borderBottom:"1px solid rgba(255,255,255,0.1)",paddingBottom:2,fontSize:`${Math.max(.55,.65*p)}rem`,textTransform:"uppercase",letterSpacing:1},children:"BATTLE LOG"}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:3*p},children:(g.logs||[]).map((m,b)=>a.jsx("div",{style:{opacity:.9,lineHeight:"1.4",textShadow:"0 1px 2px black",animation:"fadeIn 0.3s ease-out"},children:m},b))})]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,pointerEvents:"none"},children:[a.jsxs("div",{style:{position:"relative",width:32,height:40},children:[a.jsx("div",{style:{position:"absolute",inset:0,background:"#4a5568",borderRadius:4,border:"1px solid #718096",transform:"rotate(-15deg) translate(-5px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#2d3748",borderRadius:4,border:"1px solid #718096",transform:"rotate(-5deg) translate(-2px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#1a202c",borderRadius:4,border:"1px solid #cbd5e0",transform:"rotate(5deg)"}})]}),a.jsxs("div",{style:{background:"rgba(0,0,0,0.7)",padding:"4px 12px",borderRadius:8,color:"#e2e8f0",fontSize:"0.9rem",fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5)"},children:[" ",ae.hand.length]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,marginLeft:6},children:[a.jsx("div",{style:{fontSize:"1.2rem",filter:"drop-shadow(0 0 3px rgba(128, 90, 213, 0.8))"},children:""}),a.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(128, 90, 213, 0.8), rgba(76, 29, 149, 0.9))",padding:"4px 12px",borderRadius:8,color:"#e2e8f0",fontSize:"0.9rem",fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5), inset 0 1px rgba(255,255,255,0.1)",border:"1px solid rgba(167, 139, 250, 0.5)",position:"relative"},children:[" ",ae.graveyard.length,Zu.filter(m=>m.playerId===P).map(m=>a.jsxs("div",{style:{position:"absolute",top:-30,left:"50%",transform:"translateX(-50%)",color:"#d946ef",fontSize:"1.5rem",fontWeight:"bold",textShadow:"0 0 10px #d946ef, 0 0 20px #a855f7, 0 0 30px #7c3aed",animation:"necromanceFloat 1.5s ease-out forwards",pointerEvents:"none",whiteSpace:"nowrap"},children:["-",m.amount]},m.key))]})]})]}),Fe&&Fe.owner==="PLAYER"&&Fe.source==="HAND"&&Br&&(()=>{const E=((H?Math.max(140,180*p):Math.max(180,220*p))-6)/2,O=ae.pp>=Fe.card.cost;return a.jsxs("button",{disabled:!O,onClick:M=>{M.stopPropagation(),Im()},className:O?"play-button-active":"",style:{width:E,background:O?"linear-gradient(to bottom, #48bb78, #38a169)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:"8px 4px",borderRadius:12,fontSize:"0.85rem",fontWeight:"bold",cursor:O?"pointer":"not-allowed",boxShadow:O?"0 0 15px rgba(72, 187, 120, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease",pointerEvents:"auto"},onMouseDown:M=>M.stopPropagation(),children:["",a.jsxs("div",{style:{fontSize:"0.6rem",opacity:.8,marginTop:2},children:["pp ",Fe.card.cost]})]})})(),Fe&&Fe.owner==="PLAYER"&&Fe.source==="BOARD"&&(()=>{const m=H?Math.max(140,180*p):Math.max(180,220*p),b=6,E=(m-b)/2,O=Fe.card,M=O==null?void 0:O.hasEvolved,G=!M&&fs,J=!M&&hs,$=O==null?void 0:O.instanceId,U=ae.board.findIndex(Z=>Z&&Z.instanceId===$),V=ae.board.slice(0,U+1).filter(Z=>Z).length-1,ce=Z=>{U<0||hc(V>=0?V:U,Z,void 0,$)};return a.jsxs("div",{style:{display:"flex",gap:b,pointerEvents:"auto"},onMouseDown:Z=>Z.stopPropagation(),children:[a.jsxs("button",{disabled:!G,onClick:Z=>{Z.stopPropagation(),ce(!1)},style:{width:E,background:G?"linear-gradient(to bottom, #faf089, #d69e2e)":"#718096",color:G?"#1a202c":"white",border:"2px solid rgba(255,255,255,0.2)",padding:"8px 4px",borderRadius:12,fontSize:"0.85rem",fontWeight:"bold",cursor:G?"pointer":"not-allowed",boxShadow:G?"0 0 15px rgba(250, 240, 137, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:G?"0 1px 1px rgba(255,255,255,0.3)":"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",a.jsx("div",{style:{fontSize:"0.6rem",opacity:.8,marginTop:2},children:"EP"})]}),a.jsxs("button",{disabled:!J,onClick:Z=>{Z.stopPropagation(),ce(!0)},style:{width:E,background:J?"linear-gradient(to bottom, #b794f4, #805ad5)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:"8px 4px",borderRadius:12,fontSize:"0.85rem",fontWeight:"bold",cursor:J?"pointer":"not-allowed",boxShadow:J?"0 0 15px rgba(183, 148, 244, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",a.jsx("div",{style:{fontSize:"0.6rem",opacity:.8,marginTop:2},children:"SEP"})]})]})})(),!(Fe&&Fe.owner==="PLAYER"&&(Fe.source==="HAND"||Fe.source==="BOARD"))&&(()=>{const m=H?Math.max(140,180*p):Math.max(180,220*p);return a.jsx("div",{style:{width:m,height:52,visibility:"hidden",pointerEvents:"none"}})})()]}),(nt==="TOSSING"||nt==="RESULT")&&a.jsxs("div",{style:{position:"absolute",inset:0,zIndex:4e3,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.85)",pointerEvents:"none"},children:[a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("div",{style:{width:120*p,height:120*p,margin:`0 auto ${30*p}px`,borderRadius:"50%",background:nt==="RESULT"?Bt==="FIRST"?"linear-gradient(135deg, #ffd700, #ff8c00)":"linear-gradient(135deg, #c0c0c0, #808080)":"linear-gradient(135deg, #ffd700, #ff8c00)",boxShadow:nt==="RESULT"?`0 0 ${40*p}px ${Bt==="FIRST"?"#ffd700":"#c0c0c0"}, 0 0 ${80*p}px ${Bt==="FIRST"?"rgba(255,215,0,0.5)":"rgba(192,192,192,0.5)"}`:`0 0 ${30*p}px #ffd700`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"3rem",fontWeight:900,color:"#1a202c",textShadow:"0 2px 2px rgba(0,0,0,0.5)",animation:nt==="TOSSING"?"coinFlip 0.3s ease-in-out infinite":"coinLand 0.5s ease-out",border:"4px solid rgba(255,255,255,0.3)"},children:nt==="RESULT"?Bt==="FIRST"?"":"":"?"}),a.jsxs("div",{style:{fontSize:nt==="RESULT"?"2.5rem":"1.8rem",fontWeight:900,color:Bt==="FIRST"?"#ffd700":Bt==="SECOND"?"#c0c0c0":"white",textShadow:"0 0 20px currentColor, 0 2px 4px black",animation:nt==="RESULT"?"textPop 0.5s ease-out":"none"},children:[nt==="TOSSING"&&"...",nt==="RESULT"&&(Bt==="FIRST"?"":"")]}),nt==="RESULT"&&a.jsx("div",{style:{fontSize:"1rem",color:"#a0aec0",marginTop:10*p,animation:"fadeIn 0.5s ease-out 0.3s both"},children:Bt==="FIRST"?"":""})]}),a.jsx("style",{children:`
                            @keyframes coinFlip {
                                0%, 100% { transform: rotateY(0deg) scale(1); }
                                50% { transform: rotateY(180deg) scale(1.1); }
                            }
                            @keyframes coinLand {
                                0% { transform: rotateY(720deg) scale(0.5); }
                                70% { transform: rotateY(0deg) scale(1.2); }
                                100% { transform: rotateY(0deg) scale(1); }
                            }
                            @keyframes textPop {
                                0% { transform: scale(0.5); opacity: 0; }
                                70% { transform: scale(1.2); }
                                100% { transform: scale(1); opacity: 1; }
                            }
                        `})]}),Qu&&a.jsxs("div",{style:{position:"absolute",inset:0,zIndex:3e3,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.7)",pointerEvents:"none",animation:"fadeIn 0.2s ease-out"},children:[a.jsx("div",{style:{fontSize:`${3.5*p}rem`,fontWeight:900,fontFamily:"Tamanegi, sans-serif",background:"linear-gradient(135deg, #ffd700, #ff6b6b, #ffd700)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",textShadow:"none",filter:`drop-shadow(0 0 ${15*p}px rgba(255,215,0,0.8)) drop-shadow(0 0 ${30*p}px rgba(255,107,107,0.5))`,animation:"gameStartPop 0.8s ease-out",letterSpacing:"0.2em"},children:" "}),a.jsx("style",{children:`
                            @keyframes gameStartPop {
                                0% { transform: scale(0.3) rotate(-10deg); opacity: 0; }
                                50% { transform: scale(1.2) rotate(5deg); opacity: 1; }
                                70% { transform: scale(0.95) rotate(-2deg); }
                                100% { transform: scale(1) rotate(0deg); opacity: 1; }
                            }
                        `})]}),a.jsxs("div",{ref:oi,style:{position:"absolute",bottom:-20*p,left:"50%",transform:"translateX(-50%)",width:to*p,height:to*p,borderRadius:"50%",zIndex:200},children:[a.jsxs("div",{onMouseDown:xI,style:{width:"100%",height:"100%",borderRadius:"50%",overflow:"hidden",border:Af?"4px solid #67e8f9":"4px solid #3182ce",boxShadow:Af?"0 0 20px rgba(103, 232, 249, 0.4), 0 0 40px rgba(103, 232, 249, 0.2)":"0 0 20px rgba(49, 130, 206, 0.4)",background:"#1a202c",cursor:"grab",transition:"border-color 0.3s, box-shadow 0.3s, filter 0.5s, opacity 0.5s",animation:Am?"leaderDamageCapPulse 2s ease-in-out infinite":"none",position:"relative",...g.winnerId&&g.winnerId!==P&&(B||st)?{filter:B==="white-fade"?"brightness(2) saturate(0.3)":B==="explode"||B==="result-text"||B==="fade-out"||st?"brightness(3) saturate(0) blur(10px)":"none",opacity:B==="explode"||B==="result-text"||B==="fade-out"||st?0:1}:{}},children:[a.jsx("img",{src:qa(ae.class),style:ae.class==="AJA"?{width:"100%",height:"100%",objectFit:"cover",objectPosition:"center top",pointerEvents:"none"}:{width:"100%",height:"100%",objectFit:"cover",pointerEvents:"none"}}),Am&&a.jsx("div",{style:{position:"absolute",inset:0,borderRadius:"50%",background:"radial-gradient(circle, rgba(103, 232, 249, 0.5) 0%, rgba(103, 232, 249, 0.2) 70%, rgba(103, 232, 249, 0.1) 100%)",pointerEvents:"none",animation:"leaderDamageCapOverlay 2s ease-in-out infinite",zIndex:1}})]}),a.jsx("div",{style:{position:"absolute",top:0,left:"50%",transform:`translateX(-50%) translateX(${-140*p}px)`,width:55*p,height:55*p,background:"radial-gradient(circle at 30% 30%, #feb2b2, #c53030)",borderRadius:"50%",border:`${Math.max(2,3*p)}px solid #fff`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${1.2*p}rem`,fontWeight:900,color:"white",textShadow:"0 2px 2px rgba(0,0,0,0.5)",boxShadow:"0 4px 6px rgba(0,0,0,0.4)",zIndex:10,opacity:ee?1:0,transition:"opacity 0.3s ease-in"},children:ae.hp}),a.jsx("div",{onMouseDown:m=>pc(m,!1),onTouchStart:m=>pc(m,!1),style:{position:"absolute",top:10*p,left:"50%",transform:`translateX(-50%) translateX(${-80*p}px)`,width:45*p,height:45*p,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:fs?"rgba(255,235,100,0.2)":"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",cursor:fs?"grab":"default",zIndex:10,opacity:ee?mc?1:.5:0,filter:mc?"none":"grayscale(0.8)",transition:"opacity 0.3s ease-in, filter 0.3s, background 0.3s",boxShadow:fs?"0 0 12px #ffd700, 0 0 25px rgba(255,215,0,0.5)":"none",animation:fs?"epPulse 1.5s ease-in-out infinite":"none"},children:a.jsx("div",{style:{display:"flex",gap:3*p},children:Array(2).fill(0).map((m,b)=>{const E=b<Tm;let O="none";return E&&mc&&(O=fs?"0 0 10px #fff59d, 0 0 20px #ffd700, 0 0 30px #ecc94b":"0 0 8px #ecc94b, 0 0 15px #ecc94b"),a.jsx("div",{style:{width:12*p,height:12*p,borderRadius:"50%",background:E?fs?"#fff59d":"#ecc94b":"#2d3748",boxShadow:O,border:"2px solid rgba(0,0,0,0.5)",transition:"box-shadow 0.3s, background 0.3s"}},b)})})}),a.jsx("div",{onMouseDown:m=>pc(m,!0),onTouchStart:m=>pc(m,!0),style:{position:"absolute",top:10*p,left:"50%",transform:`translateX(-50%) translateX(${80*p}px)`,width:45*p,height:45*p,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:hs?"rgba(200,160,255,0.2)":"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,cursor:hs?"grab":"default",opacity:ee?yc?1:.5:0,filter:yc?"none":"grayscale(0.8)",transition:"opacity 0.3s ease-in, filter 0.3s, background 0.3s",boxShadow:hs?"0 0 12px #b794f4, 0 0 25px rgba(159,122,234,0.5)":"none",animation:hs?"sepPulse 1.5s ease-in-out infinite":"none"},children:a.jsx("div",{style:{display:"flex",gap:3*p},children:Array(2).fill(0).map((m,b)=>{const E=b<ae.sep;let O="none";return E&&yc&&(O=hs?"0 0 10px #d6bcfa, 0 0 20px #b794f4, 0 0 30px #9f7aea":"0 0 8px #9f7aea, 0 0 15px #9f7aea"),a.jsx("div",{style:{width:12*p,height:12*p,borderRadius:"50%",background:E?hs?"#d6bcfa":"#9f7aea":"#2d3748",boxShadow:O,border:"2px solid rgba(0,0,0,0.5)",transition:"box-shadow 0.3s, background 0.3s"}},b)})})})]}),a.jsxs("div",{style:{position:"absolute",bottom:10*p,right:15*p,width:60*p,height:85*p,zIndex:50},children:[[...Array(Math.min(5,Math.ceil(ae.deck.length/5)))].map((m,b)=>a.jsx("div",{style:{position:"absolute",inset:0,transform:`translate(${b*2*p}px, ${-b*2*p}px)`,borderRadius:6,border:"1px solid #718096",boxShadow:"1px 1px 3px rgba(0,0,0,0.5)",overflow:"hidden"},children:a.jsx("img",{src:ai((ae==null?void 0:ae.class)||"SENKA"),alt:"Deck",style:{width:"100%",height:"100%",objectFit:"cover"},onError:E=>{E.target.style.display="none",E.target.parentElement.style.background="linear-gradient(45deg, #2d3748, #1a202c)"}})},b)),a.jsx("div",{style:{position:"absolute",top:-20*p,width:"100%",textAlign:"center",color:"#a0aec0",fontSize:"0.9rem",fontWeight:"bold",textShadow:"0 1px 2px black"},children:ae.deck.length})]}),a.jsx("div",{style:{position:"absolute",bottom:0,left:0,width:"100%",height:200*p,display:"flex",justifyContent:"center",alignItems:"flex-end",pointerEvents:"none",zIndex:500},children:ae.hand.map((m,b)=>{if(Ke!==null&&Ke.sourceIndex===b)return null;const O=ae.hand.length;let M=0,G=0,J=0;if(Br){const U=100*p,V=window.innerWidth-40*p,ce=(O-1)*U+an*p;let Z=U;ce>V&&(Z=(V-an*p)/Math.max(1,O-1)),M=(b-(O-1)/2)*Z,G=ye===b?-8*p:0,J=0}else{const U=45*p,V=160*p,ce=an*p/2,Z=window.innerWidth/2-V-ce,pe=window.innerWidth-340*p-V,be=(O-1)*U+an*p;let Xe=U;be>pe&&(Xe=(pe-an*p)/Math.max(1,O-1)),M=Z-(O-1-b)*Xe,G=0,J=(b-(O-1)/2)*3}const $=ae.pp>=m.cost&&g.activePlayerId===P;return a.jsx("div",{onMouseDown:U=>{_m(U,b),Br&&Me(b===ye?null:b)},onTouchStart:U=>{_m(U,b),Br&&Me(b===ye?null:b)},style:{position:"absolute",left:"50%",bottom:5*p,transform:`translateX(calc(-50% + ${M}px)) translateY(${G}px) rotate(${J}deg) ${(Q==null?void 0:Q.sourceType)==="HAND"&&Q.sourceIndex===b?"scale(1.05) translateY(-10px)":Br?"translateY(-3px)":""}`,transition:dI===b?"all 0.3s ease-in":(Q==null?void 0:Q.sourceType)==="HAND"&&Q.sourceIndex===b?"none":"all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1)",zIndex:(Q==null?void 0:Q.sourceType)==="HAND"&&Q.sourceIndex===b?1e3:b+100,width:(H?80:an)*p,height:(H?115:bn)*p,pointerEvents:"auto",cursor:$?"grab":"not-allowed"},onClick:U=>U.stopPropagation(),children:a.jsx(eo,{card:m,turnCount:g.turnCount,isMyTurn:g.activePlayerId===P,isPlayable:$,scale:p,variant:H?"mobile-hand":"normal",style:{width:H?80*p:an*p,height:H?115*p:bn*p,boxShadow:(Q==null?void 0:Q.sourceType)==="HAND"&&Q.sourceIndex===b?"0 0 40px rgba(49, 130, 206, 0.8)":$?"0 0 15px rgba(40, 180, 100, 0.6)":"none"}})},m.instanceId)})}),H&&a.jsxs("div",{style:{position:"absolute",bottom:200*p,left:15*p,display:"flex",alignItems:"center",gap:10*p,zIndex:601,pointerEvents:"none"},children:[a.jsxs("div",{style:{position:"relative",width:50*p,height:62*p},children:[a.jsx("div",{style:{position:"absolute",inset:0,background:"#4a5568",borderRadius:6*p,border:"1px solid #718096",transform:"rotate(-15deg) translate(-5px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#2d3748",borderRadius:6*p,border:"1px solid #718096",transform:"rotate(-5deg) translate(-2px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#1a202c",borderRadius:6*p,border:"1px solid #cbd5e0",transform:"rotate(5deg)"}})]}),a.jsxs("div",{style:{background:"rgba(0,0,0,0.7)",padding:`${6*p}px ${16*p}px`,borderRadius:10*p,color:"#e2e8f0",fontSize:`${1.32*p}rem`,fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5)"},children:[" ",ae.hand.length]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6*p,marginLeft:10*p},children:[a.jsx("div",{style:{fontSize:`${1.87*p}rem`,filter:"drop-shadow(0 0 3px rgba(128, 90, 213, 0.8))"},children:""}),a.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(128, 90, 213, 0.8), rgba(76, 29, 149, 0.9))",padding:`${6*p}px ${16*p}px`,borderRadius:10*p,color:"#e2e8f0",fontSize:`${1.32*p}rem`,fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5), inset 0 1px rgba(255,255,255,0.1)",border:"1px solid rgba(167, 139, 250, 0.5)",position:"relative"},children:[" ",ae.graveyard.length,Zu.filter(m=>m.playerId===P).map(m=>a.jsxs("div",{style:{position:"absolute",top:-30,left:"50%",transform:"translateX(-50%)",color:"#d946ef",fontSize:"1.5rem",fontWeight:"bold",textShadow:"0 0 10px #d946ef, 0 0 20px #a855f7, 0 0 30px #7c3aed",animation:"necromanceFloat 1.5s ease-out forwards",pointerEvents:"none",whiteSpace:"nowrap"},children:["-",m.amount]},m.key))]})]})]}),H&&Fe&&Fe.owner==="PLAYER"&&Fe.source==="HAND"&&Br&&(()=>{const m=Math.max(140,180*p),b=4*p,E=(m-b)/2,O=ae.pp>=Fe.card.cost;return a.jsxs("div",{style:{position:"absolute",left:15*p,bottom:135*p,zIndex:600,pointerEvents:"auto"},children:[a.jsxs("button",{disabled:!O,onClick:M=>{M.stopPropagation(),Im()},className:O?"play-button-active":"",style:{width:E,background:O?"linear-gradient(to bottom, #48bb78, #38a169)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:`${5*p}px ${3*p}px`,borderRadius:10*p,fontSize:`${.7*p}rem`,fontWeight:"bold",cursor:O?"pointer":"not-allowed",boxShadow:O?"0 0 12px rgba(72, 187, 120, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},onMouseDown:M=>M.stopPropagation(),children:["",a.jsxs("div",{style:{fontSize:`${.5*p}rem`,opacity:.8,marginTop:1},children:["pp ",Fe.card.cost]})]}),a.jsx("style",{children:`
                                @keyframes playGlowPulse {
                                    0% { box-shadow: 0 0 10px rgba(72, 187, 120, 0.4); }
                                    50% { box-shadow: 0 0 25px rgba(72, 187, 120, 0.8); }
                                    100% { box-shadow: 0 0 10px rgba(72, 187, 120, 0.4); }
                                }
                                .play-button-active {
                                    animation: playGlowPulse 2s infinite ease-in-out;
                                }
                            `})]})})(),H&&Fe&&Fe.owner==="PLAYER"&&Fe.source==="BOARD"&&(()=>{const m=Math.max(140,180*p),b=4*p,E=(m-b)/2,O=Fe.card,M=O==null?void 0:O.hasEvolved,G=!M&&fs,J=!M&&hs,$=O==null?void 0:O.instanceId,U=ae.board.findIndex(Z=>Z&&Z.instanceId===$),V=ae.board.slice(0,U+1).filter(Z=>Z).length-1,ce=Z=>{U<0||hc(V>=0?V:U,Z,void 0,$)};return a.jsxs("div",{style:{position:"absolute",left:15*p,bottom:135*p,zIndex:600,pointerEvents:"auto",display:"flex",gap:b},onMouseDown:Z=>Z.stopPropagation(),children:[a.jsxs("button",{disabled:!G,onClick:Z=>{Z.stopPropagation(),ce(!1)},style:{width:E,background:G?"linear-gradient(to bottom, #faf089, #d69e2e)":"#718096",color:G?"#1a202c":"white",border:"2px solid rgba(255,255,255,0.2)",padding:`${5*p}px ${3*p}px`,borderRadius:10*p,fontSize:`${.7*p}rem`,fontWeight:"bold",cursor:G?"pointer":"not-allowed",boxShadow:G?"0 0 12px rgba(250, 240, 137, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:G?"0 1px 1px rgba(255,255,255,0.3)":"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",a.jsx("div",{style:{fontSize:`${.5*p}rem`,opacity:.8,marginTop:1},children:"EP"})]}),a.jsxs("button",{disabled:!J,onClick:Z=>{Z.stopPropagation(),ce(!0)},style:{width:E,background:J?"linear-gradient(to bottom, #b794f4, #805ad5)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:`${5*p}px ${3*p}px`,borderRadius:10*p,fontSize:`${.7*p}rem`,fontWeight:"bold",cursor:J?"pointer":"not-allowed",boxShadow:J?"0 0 12px rgba(183, 148, 244, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",a.jsx("div",{style:{fontSize:`${.5*p}rem`,opacity:.8,marginTop:1},children:"SEP"})]})]})})(),ls&&Array.from({length:ls.count},(m,b)=>{const J=-(ls.count*80+(ls.count-1)*20-80)/2+b*100,$=ls.isPlayer?ai((ae==null?void 0:ae.class)||"SENKA"):ai((Le==null?void 0:Le.class)||"SENKA");return a.jsx("div",{style:{position:"absolute",left:ls.isPlayer?"calc(100% - 90px)":90,top:ls.isPlayer?"calc(100% - 105px)":105,width:80,height:110,borderRadius:8,border:"2px solid white",overflow:"hidden",transform:`translateX(${J}px)`,animation:`drawCard${ls.isPlayer?"Player":"Opponent"} ${lf}ms cubic-bezier(0.2, 0.8, 0.2, 1) forwards`,zIndex:9e3+b,boxShadow:"0 0 10px rgba(255,255,255,0.5)"},children:a.jsx("img",{src:$,alt:"Card Back",style:{width:"100%",height:"100%",objectFit:"cover"},onError:U=>{U.target.style.display="none",U.target.parentElement.style.background="repeating-linear-gradient(45deg, #2d3748, #2d3748 10px, #1a202c 10px, #1a202c 20px)"}})},b)}),a.jsx("style",{children:`
                        @keyframes drawCardPlayer {
                            0% { opacity: 1; }
                            100% { transform: translate(-50vw, -100px) scale(0.5) rotate(-10deg); opacity: 0; }
                        }
                        @keyframes drawCardOpponent {
                            0% { opacity: 1; }
                            100% { transform: translate(50vw, 200px) scale(0.5) rotate(10deg); opacity: 0; }
                        }
                    `})]}),yI.map(m=>a.jsx(p3,{value:m.value,x:m.x,y:m.y,color:m.color,scale:p,onComplete:()=>cc(b=>b.filter(E=>E.id!==m.id))},m.id)),ef&&jr.current&&(()=>{const m=jr.current.x,b=jr.current.y,E=200,O=320,G=180/8,J=($,U,V,ce)=>{const Z=$*Math.PI/180,pe=U*Math.PI/180,be=Math.cos(Z)*ce,Xe=-Math.sin(Z)*ce,Ie=Math.cos(pe)*ce,Ye=-Math.sin(pe)*ce,Ze=Math.cos(pe)*V,Ge=-Math.sin(pe)*V,Ve=Math.cos(Z)*V,ge=-Math.sin(Z)*V;return`M ${be} ${Xe} A ${ce} ${ce} 0 0 0 ${Ie} ${Ye} L ${Ze} ${Ge} A ${V} ${V} 0 0 1 ${Ve} ${ge} Z`};return a.jsxs("div",{style:{position:"fixed",left:m,top:b,zIndex:2e3,pointerEvents:"none",animation:"stampUIFadeIn 0.15s ease-out"},children:[a.jsx("svg",{width:O*2+20,height:O+20,style:{position:"absolute",left:-330,top:-330,overflow:"visible"},children:a.jsx("g",{transform:`translate(${O+10}, ${O+10})`,children:zg.map(($,U)=>{const V=180-U*G,ce=V-G,Z=tf===$.id,be=(V+ce)/2*Math.PI/180,Xe=(E+O)/2,Ie=Math.cos(be)*Xe,Ye=-Math.sin(be)*Xe,Ze=85;return a.jsxs("g",{children:[a.jsx("path",{d:J(V,ce,E,O),fill:Z?"rgba(255, 215, 0, 0.4)":"rgba(0, 0, 0, 0.7)",stroke:Z?"#ffd700":"rgba(255, 255, 255, 0.3)",strokeWidth:Z?3:1,style:{transition:"all 0.1s ease-out"}}),a.jsx("defs",{children:a.jsx("clipPath",{id:`stampClip-${$.id}`,children:a.jsx("circle",{cx:Ie,cy:Ye,r:Ze/2})})}),a.jsx("image",{href:et(Jy($.id,br)),x:Ie-Ze/2,y:Ye-Ze/2,width:Ze,height:Ze,clipPath:`url(#stampClip-${$.id})`,style:{transform:Z?"scale(1.15)":"scale(1)",transformOrigin:`${Ie}px ${Ye}px`,transition:"transform 0.1s ease-out"}}),a.jsx("circle",{cx:Ie,cy:Ye,r:Ze/2,fill:"none",stroke:Z?"#ffd700":"rgba(255, 255, 255, 0.5)",strokeWidth:Z?2:1})]},$.id)})})}),a.jsx("style",{children:`
                                @keyframes stampUIFadeIn {
                                    from { opacity: 0; transform: scale(0.8); }
                                    to { opacity: 1; transform: scale(1); }
                                }
                            `})]})})(),ra&&a.jsxs("div",{style:{position:"fixed",left:"50%",top:"40%",transform:"translate(-50%, -50%)",zIndex:2500,pointerEvents:"none",animation:"stampDisplay 3s ease-out forwards"},children:[a.jsx("div",{style:{width:250,height:250,borderRadius:20,overflow:"hidden",boxShadow:"0 0 40px rgba(0,0,0,0.5), 0 0 60px rgba(255,255,255,0.2)",border:"4px solid rgba(255,255,255,0.3)"},children:a.jsx("img",{src:et(Jy(ra.stampId,ra.playerClass)),alt:"",style:{width:"100%",height:"100%",objectFit:"cover"}})}),ra.playerId!==P&&a.jsx("div",{style:{position:"absolute",bottom:-30,left:"50%",transform:"translateX(-50%)",background:"rgba(0,0,0,0.7)",padding:"5px 15px",borderRadius:15,color:"#fff",fontSize:"0.9rem",whiteSpace:"nowrap"},children:""}),a.jsx("style",{children:`
                            @keyframes stampDisplay {
                                0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
                                10% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
                                20% { transform: translate(-50%, -50%) scale(1); }
                                80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                                100% { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
                            }
                        `})]},ra.timestamp),a.jsx("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:1e3},children:Q&&(Q.sourceType==="BOARD"||Q.sourceType==="EVOLVE")&&a.jsxs(a.Fragment,{children:[a.jsxs("defs",{children:[a.jsxs("filter",{id:"cyanGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{stdDeviation:"10",result:"blur1"}),a.jsx("feFlood",{floodColor:"rgba(100, 200, 255, 0.7)",result:"color1"}),a.jsx("feComposite",{in:"color1",in2:"blur1",operator:"in",result:"glow1"}),a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"5",result:"blur2"}),a.jsx("feFlood",{floodColor:"rgba(150, 220, 255, 0.5)",result:"color2"}),a.jsx("feComposite",{in:"color2",in2:"blur2",operator:"in",result:"glow2"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"glow1"}),a.jsx("feMergeNode",{in:"glow2"})]})]}),a.jsxs("filter",{id:"yellowGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{stdDeviation:"10",result:"blur1"}),a.jsx("feFlood",{floodColor:"rgba(255, 255, 50, 0.7)",result:"color1"}),a.jsx("feComposite",{in:"color1",in2:"blur1",operator:"in",result:"glow1"}),a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"5",result:"blur2"}),a.jsx("feFlood",{floodColor:"rgba(255, 240, 100, 0.5)",result:"color2"}),a.jsx("feComposite",{in:"color2",in2:"blur2",operator:"in",result:"glow2"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"glow1"}),a.jsx("feMergeNode",{in:"glow2"})]})]}),a.jsxs("filter",{id:"softWhiteGlow",x:"-300%",y:"-300%",width:"700%",height:"700%",children:[a.jsx("feGaussianBlur",{stdDeviation:"20",result:"blur"}),a.jsx("feFlood",{floodColor:"rgba(255, 255, 255, 0.9)",result:"color"}),a.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"glow"}),a.jsx("feMergeNode",{in:"glow"}),a.jsx("feMergeNode",{in:"glow"})]})]}),a.jsxs("filter",{id:"innerCoreGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{stdDeviation:"4",result:"blur"}),a.jsx("feFlood",{floodColor:"rgba(255, 255, 255, 0.8)",result:"color"}),a.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),a.jsx("feMerge",{children:a.jsx("feMergeNode",{in:"glow"})})]}),a.jsxs("filter",{id:"coloredBallGlow",x:"-150%",y:"-150%",width:"400%",height:"400%",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"6",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"blur"})]})]}),a.jsxs("filter",{id:"particleGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"2",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),a.jsxs("filter",{id:"purpleGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{stdDeviation:"10",result:"blur1"}),a.jsx("feFlood",{floodColor:"rgba(183, 148, 244, 0.7)",result:"color1"}),a.jsx("feComposite",{in:"color1",in2:"blur1",operator:"in",result:"glow1"}),a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"5",result:"blur2"}),a.jsx("feFlood",{floodColor:"rgba(200, 170, 255, 0.5)",result:"color2"}),a.jsx("feComposite",{in:"color2",in2:"blur2",operator:"in",result:"glow2"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"glow1"}),a.jsx("feMergeNode",{in:"glow2"})]})]})]}),Q.sourceType==="BOARD"&&a.jsxs(a.Fragment,{children:[a.jsx("path",{d:us(),fill:"none",stroke:"rgba(100, 200, 255, 0.3)",strokeWidth:"20",strokeLinecap:"butt",filter:"url(#cyanGlow)"}),a.jsx("path",{d:us(),fill:"none",stroke:"rgba(150, 220, 255, 0.5)",strokeWidth:"10",strokeLinecap:"butt"}),a.jsx("path",{d:us(),fill:"none",stroke:"rgba(200, 240, 255, 0.9)",strokeWidth:"4",strokeLinecap:"butt"}),a.jsx("path",{d:us(),fill:"none",stroke:"rgba(255, 255, 255, 1)",strokeWidth:"2",strokeLinecap:"butt"})]}),Q.sourceType==="EVOLVE"&&a.jsxs(a.Fragment,{children:[a.jsx("path",{d:us(),fill:"none",stroke:Q.useSep?"rgba(159, 122, 234, 0.3)":"rgba(236, 201, 75, 0.3)",strokeWidth:"20",strokeLinecap:"butt",filter:Q.useSep?"url(#purpleGlow)":"url(#yellowGlow)"}),a.jsx("path",{d:us(),fill:"none",stroke:Q.useSep?"rgba(183, 148, 244, 0.5)":"rgba(246, 224, 94, 0.5)",strokeWidth:"10",strokeLinecap:"butt"}),a.jsx("path",{d:us(),fill:"none",stroke:Q.useSep?"rgba(214, 188, 250, 0.9)":"rgba(250, 240, 137, 0.9)",strokeWidth:"4",strokeLinecap:"butt"}),a.jsx("path",{d:us(),fill:"none",stroke:"rgba(255, 255, 255, 1)",strokeWidth:"2",strokeLinecap:"butt"})]}),(Q.sourceType==="BOARD"||Q.sourceType==="EVOLVE")&&a.jsxs(a.Fragment,{children:[a.jsx("circle",{cx:Q.startX,cy:Q.startY,r:"15",fill:"rgba(255, 255, 255, 0.3)",filter:"url(#softWhiteGlow)"}),a.jsx("circle",{cx:Q.startX,cy:Q.startY,r:"8",fill:"rgba(255, 255, 255, 0.4)",filter:"url(#softWhiteGlow)"})]}),(Q.sourceType==="BOARD"||Q.sourceType==="EVOLVE")&&a.jsxs(a.Fragment,{children:[a.jsx("circle",{cx:Q.currentX,cy:Q.currentY,r:"18",fill:"rgba(255, 255, 255, 0.25)",filter:"url(#softWhiteGlow)"}),a.jsx("circle",{cx:Q.currentX,cy:Q.currentY,r:"8",fill:"rgba(255, 255, 255, 0.35)",filter:"url(#softWhiteGlow)"}),a.jsx("circle",{cx:Q.currentX,cy:Q.currentY,r:"3",fill:"rgba(255, 255, 255, 0.7)",filter:"url(#innerCoreGlow)"})]}),lI.map(m=>{const b=Q.sourceType==="EVOLVE"?Q.useSep?`rgba(230, 220, 255, ${m.opacity})`:`rgba(255, 255, 230, ${m.opacity})`:`rgba(220, 245, 255, ${m.opacity})`;return a.jsx("circle",{cx:m.x,cy:m.y,r:m.radius,fill:b,filter:"url(#particleGlow)"},m.id)})]})}),Yt&&a.jsxs("svg",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100dvh",pointerEvents:"none",zIndex:99999},children:[a.jsx("defs",{children:a.jsxs("filter",{id:"endTurnGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{stdDeviation:"6",result:"blur"}),a.jsx("feFlood",{floodColor:"rgba(100, 200, 255, 0.8)",result:"color"}),a.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"glow"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsx("circle",{cx:Yt.x,cy:Yt.y,r:Yt.ringRadius,fill:"none",stroke:`rgba(100, 200, 255, ${Math.max(0,1-Yt.ringRadius/120)*.8})`,strokeWidth:"4",filter:"url(#endTurnGlow)"}),a.jsx("circle",{cx:Yt.x,cy:Yt.y,r:Yt.ringRadius*.8,fill:"none",stroke:`rgba(255, 255, 255, ${Math.max(0,1-Yt.ringRadius/120)*.6})`,strokeWidth:"2"}),a.jsx("circle",{cx:Yt.x,cy:Yt.y,r:20,fill:`rgba(255, 255, 255, ${Math.max(0,1-Yt.ringRadius/120)*.9})`}),Yt.particles.map(m=>a.jsx("circle",{cx:m.x,cy:m.y,r:4,fill:`rgba(255, 255, 255, ${m.opacity*.8})`},m.id))]}),Ke&&a.jsxs("div",{style:{position:"absolute",inset:0,zIndex:9999,pointerEvents:"auto",background:"rgba(0,0,0,0.5)",perspective:"1200px"},children:[a.jsx("style",{children:`
                                @keyframes playCardSequence {
                                    ${Ke.finalX!==void 0?`
                                    /* Phase 1: Start at hand position (0%) */
                                    0% {
                                        transform: translate(${Ke.startX-Ke.targetX}px, ${Ke.startY-Ke.targetY}px) translate(-50%, -50%) scale(1.0) rotateY(0deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Phase 1b: Mid-rotation during move (12.5%) - CRITICAL: explicit 180deg to force rotation direction */
                                    12.5% {
                                        transform: translate(${(Ke.startX-Ke.targetX)*.5}px, ${(Ke.startY-Ke.targetY)*.5}px) translate(-50%, -50%) scale(1.5) rotateY(180deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Phase 2: Arrive at center with rotation complete (25%) */
                                    25% {
                                        transform: translate(-50%, -50%) scale(1.8) rotateY(360deg);
                                        opacity: 1;
                                        animation-timing-function: ease-out;
                                    }
                                    /* Phase 3: Hold at center (25%-80%) */
                                    80% {
                                        transform: translate(-50%, -50%) scale(2.4) rotateY(360deg);
                                        opacity: 1;
                                    }
                                    /* Phase 4: Move to board position (80%-100%) */
                                    100% {
                                        transform: translate(calc(-50% + ${Ke.finalX-Ke.targetX}px), calc(-50% + ${Ke.finalY-Ke.targetY}px)) scale(1.0) rotateY(360deg);
                                        opacity: 1;
                                    }
                                    `:`
                                    /* Spell: Move to center while rotating, then fade */
                                    0% {
                                        transform: translate(${Ke.startX-Ke.targetX}px, ${Ke.startY-Ke.targetY}px) translate(-50%, -50%) scale(1.0) rotateY(0deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Mid-rotation during move (15%) - CRITICAL: explicit 180deg */
                                    15% {
                                        transform: translate(${(Ke.startX-Ke.targetX)*.5}px, ${(Ke.startY-Ke.targetY)*.5}px) translate(-50%, -50%) scale(1.7) rotateY(180deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    30% {
                                        transform: translate(-50%, -50%) scale(2.2) rotateY(360deg);
                                        opacity: 1;
                                        animation-timing-function: ease-out;
                                    }
                                    80% {
                                        transform: translate(-50%, -50%) scale(2.4) rotateY(360deg);
                                        opacity: 1;
                                    }
                                    100% {
                                        transform: translate(-50%, -50%) scale(3.0) rotateY(360deg);
                                        opacity: 0;
                                    }
                                    `}
                                }
                                @keyframes playSpellSequence {
                                    /* Move from hand to center while rotating (0-30%) */
                                    0% {
                                        transform: translate(${Ke.startX-Ke.targetX}px, ${Ke.startY-Ke.targetY}px) translate(-50%, -50%) scale(1.0) rotateY(0deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Mid-rotation during move (15%) - CRITICAL: explicit 180deg to force rotation direction */
                                    15% {
                                        transform: translate(${(Ke.startX-Ke.targetX)*.5}px, ${(Ke.startY-Ke.targetY)*.5}px) translate(-50%, -50%) scale(1.7) rotateY(180deg);
                                        opacity: 1;
                                        filter: brightness(1);
                                        animation-timing-function: linear;
                                    }
                                    /* Arrive at center with rotation complete (30%) */
                                    30% {
                                        transform: translate(-50%, -50%) scale(2.2) rotateY(360deg);
                                        opacity: 1;
                                        filter: brightness(1);
                                        animation-timing-function: ease-out;
                                    }
                                    /* Hold at center (30%-75%) */
                                    75% {
                                        transform: translate(-50%, -50%) scale(2.4) rotateY(360deg);
                                        opacity: 1;
                                        filter: brightness(1.2);
                                    }
                                    /* Fade out (75%-100%) */
                                    100% {
                                        transform: translate(-50%, -50%) scale(3.0) rotateY(360deg);
                                        opacity: 0;
                                        filter: brightness(3);
                                    }
                                }
                                .play-card-flipper {
                                    transform-style: preserve-3d !important;
                                }
                                .play-card-front, .play-card-back {
                                    backface-visibility: hidden !important;
                                    -webkit-backface-visibility: hidden !important;
                                    position: absolute;
                                    width: 100%;
                                    height: 100%;
                                }
                                .play-card-back {
                                    transform: rotateY(180deg) translateZ(1px);
                                }
                            `}),a.jsxs("div",{className:"play-card-flipper",onAnimationEnd:Ke.onComplete,style:{position:"absolute",left:Ke.targetX,top:Ke.targetY,width:an*p,height:bn*p,transformStyle:"preserve-3d",animation:Ke.card.type==="SPELL"?"playSpellSequence 1s forwards":"playCardSequence 0.8s forwards"},children:[a.jsx("div",{className:"play-card-front",children:a.jsx(eo,{card:Ke.card,isOnBoard:!0,suppressPassives:!0,scale:p,style:{width:an*p,height:bn*p,boxShadow:"0 0 50px rgba(255,215,0,0.8)"}})}),a.jsx("div",{className:"play-card-back",style:{borderRadius:12,boxShadow:"0 0 50px rgba(255,215,0,0.8)",overflow:"hidden"},children:a.jsx("img",{src:ai(Ke.playerClass),alt:"Card Sleeve",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:12},onError:m=>{const b=m.target;b.style.display="none",b.parentElement&&(b.parentElement.style.background="linear-gradient(135deg, #1e3a5f 0%, #0d1b2a 50%, #1e3a5f 100%)")}})}),Ke.card.type==="SPELL"&&a.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none"},children:a.jsx(g3,{x:0,y:0})})]})]}),Wi.length>0&&Wi.map((m,b)=>a.jsx("div",{style:{position:"absolute",left:m.status==="FLY"&&m.targetX!==void 0?m.targetX:window.innerWidth/2+m.xOffset,top:m.status==="FLY"&&m.targetY!==void 0?m.targetY:window.innerHeight/2,transform:m.status==="APPEAR"?"translate(-50%, -50%) scale(1.2)":"translate(-50%, -50%) scale(0.2)",zIndex:7e3+b,pointerEvents:"none",transition:m.status==="FLY"?"all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)":"none",opacity:m.status==="FLY"?.3:1,animation:m.status==="APPEAR"?"cardAppear 0.8s ease-out":void 0},children:a.jsx(eo,{card:m.card,scale:p,style:{width:an*p,height:bn*p}})},b)),a.jsx("style",{children:`
                    @keyframes cardAppear {
                        0% { transform: translate(-50%, -50%) scale(0) rotate(-10deg); opacity: 0; }
                        50% { transform: translate(-50%, -50%) scale(1.3) rotate(5deg); opacity: 1; }
                        100% { transform: translate(-50%, -50%) scale(1.2) rotate(0deg); opacity: 1; }
                    }
                `}),ic.map(m=>m.type==="BUFF"?a.jsx(u3,{x:m.x,y:m.y,atkBuff:m.atkBuff??0,hpBuff:m.hpBuff??0,onComplete:()=>Gi(b=>b.filter(E=>E.key!==m.key))},m.key):a.jsx(h3,{type:m.type,x:m.x,y:m.y,onComplete:()=>Gi(b=>b.filter(E=>E.key!==m.key)),audioSettings:Tt,scale:p},m.key)),Ot&&a.jsx(v3,{card:Ot.card,evolvedImageUrl:Ot.evolvedImageUrl,startX:Ot.startX,startY:Ot.startY,phase:Ot.phase,onPhaseChange:_I,onShake:$n,useSep:Ot.useSep,playSE:vt,scale:p,isLightMode:te}),si&&a.jsxs("div",{style:{position:"fixed",top:"45%",left:`${340*p}px`,width:`calc(100% - ${340*p}px)`,display:"flex",justifyContent:"center",alignItems:"center",transform:"translateY(-50%)",zIndex:9e3,pointerEvents:"none",animation:"notificationFade 2.5s forwards"},children:[a.jsx("div",{style:{padding:`${20*p}px ${90*p}px`,background:"rgba(0, 0, 0, 0.75)",backdropFilter:"blur(16px)",borderTop:`${3*p}px solid ${si==="EVOLVE_READY"?"rgba(255, 215, 0, 0.7)":"rgba(180, 0, 255, 0.7)"}`,borderBottom:`${3*p}px solid ${si==="EVOLVE_READY"?"rgba(255, 215, 0, 0.7)":"rgba(180, 0, 255, 0.7)"}`,boxShadow:si==="EVOLVE_READY"?`0 0 ${50*p}px rgba(255, 180, 0, 0.5), inset 0 0 ${30*p}px rgba(255, 215, 0, 0.2)`:`0 0 ${50*p}px rgba(180, 0, 255, 0.5), inset 0 0 ${30*p}px rgba(180, 0, 255, 0.2)`,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",borderRadius:`${4*p}px`},children:a.jsx("span",{style:{fontSize:`${5*p}rem`,fontWeight:"900",fontFamily:'"YuMincho", "Hiragino Mincho ProN", "MS Mincho", serif',color:"#fff",letterSpacing:`${.8*p}rem`,whiteSpace:"nowrap",textShadow:si==="EVOLVE_READY"?`0 0 ${15*p}px rgba(255, 215, 0, 1), 0 0 ${30*p}px rgba(255, 180, 0, 0.8), ${2*p}px ${2*p}px ${4*p}px rgba(0,0,0,0.9)`:`0 0 ${15*p}px rgba(180, 0, 255, 1), 0 0 ${30*p}px rgba(140, 0, 255, 0.8), ${2*p}px ${2*p}px ${4*p}px rgba(0,0,0,0.9)`,WebkitTextStroke:si==="EVOLVE_READY"?`${1.5*p}px #ffd700`:`${1.5*p}px #b400ff`},children:si==="EVOLVE_READY"?"":""})}),a.jsx("style",{children:`
                            @keyframes notificationFade {
                                0% { opacity: 0; transform: translateY(-40%) scale(0.8); filter: blur(15px); }
                                10% { opacity: 1; transform: translateY(-50%) scale(1); filter: blur(0px); }
                                90% { opacity: 1; transform: translateY(-50%) scale(1); filter: blur(0px); }
                                100% { opacity: 0; transform: translateY(-60%) scale(1.15); filter: blur(20px); }
                            }
                        `})]}),Pe&&g.winnerId&&a.jsx(ZL,{isVictory:g.winnerId===P,loserLeaderRef:g.winnerId===P?Yi:oi,onComplete:()=>{xe(!1),qe(!0),We(null),Pt(0),(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&_&&(console.log("[GameScreen] Disconnecting after game over (casual match)"),_.disconnect())},onPhaseChange:We,onShakeIntensityChange:Pt,scale:p}),g.winnerId&&st&&a.jsx(I3,{winnerId:g.winnerId,playerId:P,playerClass:(ae==null?void 0:ae.class)||"SENKA",isOnline:e==="ONLINE",isRoomMatch:n==="HOST"||n==="JOIN",myRematchRequested:nI,opponentRematchRequested:V0,battleStats:{turnCount:g.turnCount,damageDealtToOpponent:Ql.damageDealtToOpponent,damageReceivedFromOpponent:Ql.damageReceivedFromOpponent,followersDestroyed:Ql.followersDestroyed,myFollowersDestroyed:Ql.myFollowersDestroyed},selectedCardInfo:sI,onCardInfoClick:qu,victoryReason:rI,isRankedMatch:n==="RANKED_MATCH",ratingResult:iI,onRematching:i,onRematch:m=>{e==="ONLINE"?(G0(!0),V0?(_==null||_.send({type:"REMATCH_ACCEPT"}),gf(m)):(_==null||_.send({type:"REMATCH_REQUEST"}),X0(m))):gf(m)},onLeave:s})]})]})},T3=async()=>(await MP(Xl)).user,C3=async(t,e)=>(await zP(Xl,t,e)).user,k3=async(t,e)=>{const n=Xl.currentUser;if(!n)throw new Error("No user logged in");const r=$i.credential(t,e);return(await UP(n,r)).user},R3=async()=>{await VP(Xl)},A3=t=>GP(Xl,t),P_=1280,O_=720,P3=({onRegisterSuccess:t,onBack:e})=>{const[n,r]=L.useState(""),[s,i]=L.useState(""),[o,l]=L.useState(""),[c,d]=L.useState(""),[u,h]=L.useState(!1),[f,S]=L.useState(1);L.useEffect(()=>{const x=()=>{const I=window.innerWidth/P_,p=window.innerHeight/O_;S(Math.min(I,p))};return x(),window.addEventListener("resize",x),()=>window.removeEventListener("resize",x)},[]);const k=x=>/^[a-zA-Z0-9_]{3,20}$/.test(x),w=x=>`${x}@tenfubu-game.local`,j=async()=>{if(d(""),!n||!s||!o){d("");return}if(!k(n)){d("ID3-20");return}if(s.length<6){d("6");return}if(s!==o){d("");return}h(!0);try{const x=w(n);await k3(x,s),t()}catch(x){console.error("Registration error:",x),console.error("Error code:",x==null?void 0:x.code),console.error("Error message:",x==null?void 0:x.message);const I=(x==null?void 0:x.code)||"";d(I==="auth/email-already-in-use"?"ID":I==="auth/invalid-email"?"ID":I==="auth/weak-password"?"6":I==="auth/requires-recent-login"?"":I==="auth/provider-already-linked"?"ID":I==="auth/credential-already-in-use"?"ID":` (${I||"unknown error"})`)}finally{h(!1)}},_=x=>{x.key==="Enter"&&!u&&j()};return a.jsx("div",{style:{width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",overflow:"hidden"},children:a.jsxs("div",{style:{width:P_*f,height:O_*f,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative"},children:[a.jsx("h1",{style:{fontSize:48*f,fontWeight:"bold",color:"#fff",marginBottom:40*f,textShadow:"0 4px 8px rgba(0,0,0,0.5)"},children:""}),a.jsxs("div",{style:{width:400*f,display:"flex",flexDirection:"column",gap:20*f},children:[a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*f,color:"#fff",marginBottom:8*f,fontWeight:"bold"},children:"ID"}),a.jsx("input",{type:"text",value:n,onChange:x=>r(x.target.value),onKeyPress:_,placeholder:"player123",disabled:u,style:{width:"100%",padding:`${12*f}px ${16*f}px`,fontSize:16*f,borderRadius:8*f,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:x=>x.currentTarget.style.borderColor="#4a9eff",onBlur:x=>x.currentTarget.style.borderColor="#444"}),a.jsx("p",{style:{fontSize:12*f,color:"#888",marginTop:4*f,marginBottom:0},children:"3-20"})]}),a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*f,color:"#fff",marginBottom:8*f,fontWeight:"bold"},children:"6"}),a.jsx("input",{type:"password",value:s,onChange:x=>i(x.target.value),onKeyPress:_,placeholder:"",disabled:u,style:{width:"100%",padding:`${12*f}px ${16*f}px`,fontSize:16*f,borderRadius:8*f,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:x=>x.currentTarget.style.borderColor="#4a9eff",onBlur:x=>x.currentTarget.style.borderColor="#444"})]}),a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*f,color:"#fff",marginBottom:8*f,fontWeight:"bold"},children:""}),a.jsx("input",{type:"password",value:o,onChange:x=>l(x.target.value),onKeyPress:_,placeholder:"",disabled:u,style:{width:"100%",padding:`${12*f}px ${16*f}px`,fontSize:16*f,borderRadius:8*f,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:x=>x.currentTarget.style.borderColor="#4a9eff",onBlur:x=>x.currentTarget.style.borderColor="#444"})]}),c&&a.jsx("div",{style:{padding:`${12*f}px ${16*f}px`,borderRadius:8*f,background:"rgba(255, 80, 80, 0.2)",border:"2px solid #ff5050",color:"#ff5050",fontSize:14*f,textAlign:"center"},children:c}),a.jsxs("div",{style:{display:"flex",gap:16*f,marginTop:20*f},children:[a.jsx("button",{onClick:e,disabled:u,style:{flex:1,padding:`${16*f}px ${32*f}px`,fontSize:18*f,fontWeight:"bold",borderRadius:8*f,border:"none",background:"#555",color:"#fff",cursor:u?"not-allowed":"pointer",transition:"all 0.3s",opacity:u?.5:1},onMouseEnter:x=>!u&&(x.currentTarget.style.background="#666"),onMouseLeave:x=>!u&&(x.currentTarget.style.background="#555"),children:""}),a.jsx("button",{onClick:j,disabled:u,style:{flex:1,padding:`${16*f}px ${32*f}px`,fontSize:18*f,fontWeight:"bold",borderRadius:8*f,border:"none",background:u?"#555":"linear-gradient(135deg, #4a9eff 0%, #357abd 100%)",color:"#fff",cursor:u?"not-allowed":"pointer",transition:"all 0.3s",boxShadow:u?"none":"0 4px 8px rgba(0,0,0,0.3)"},onMouseEnter:x=>!u&&(x.currentTarget.style.transform="scale(1.05)"),onMouseLeave:x=>!u&&(x.currentTarget.style.transform="scale(1)"),children:u?"...":""})]}),a.jsxs("div",{style:{marginTop:20*f,padding:`${12*f}px ${16*f}px`,borderRadius:8*f,background:"rgba(74, 158, 255, 0.1)",border:"1px solid rgba(74, 158, 255, 0.3)",fontSize:13*f,color:"#aaa",textAlign:"center",lineHeight:1.6},children:["ID",a.jsx("br",{}),""]})]})]})})},L_=1280,D_=720,O3=({onLoginSuccess:t,onBack:e})=>{const[n,r]=L.useState(""),[s,i]=L.useState(""),[o,l]=L.useState(""),[c,d]=L.useState(!1),[u,h]=L.useState(1);L.useEffect(()=>{const w=()=>{const j=window.innerWidth/L_,_=window.innerHeight/D_;h(Math.min(j,_))};return w(),window.addEventListener("resize",w),()=>window.removeEventListener("resize",w)},[]);const f=w=>`${w}@tenfubu-game.local`,S=async()=>{if(l(""),!n||!s){l("ID");return}d(!0);try{const w=f(n);await C3(w,s),t()}catch(w){const j=(w==null?void 0:w.code)||"";l(j==="auth/user-not-found"?"":j==="auth/wrong-password"?"":j==="auth/invalid-email"?"ID":j==="auth/invalid-credential"?"ID":"")}finally{d(!1)}},k=w=>{w.key==="Enter"&&!c&&S()};return a.jsx("div",{style:{width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",overflow:"hidden"},children:a.jsxs("div",{style:{width:L_*u,height:D_*u,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative"},children:[a.jsx("h1",{style:{fontSize:48*u,fontWeight:"bold",color:"#fff",marginBottom:40*u,textShadow:"0 4px 8px rgba(0,0,0,0.5)"},children:""}),a.jsxs("div",{style:{width:400*u,display:"flex",flexDirection:"column",gap:20*u},children:[a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*u,color:"#fff",marginBottom:8*u,fontWeight:"bold"},children:"ID"}),a.jsx("input",{type:"text",value:n,onChange:w=>r(w.target.value),onKeyPress:k,placeholder:"player123",disabled:c,style:{width:"100%",padding:`${12*u}px ${16*u}px`,fontSize:16*u,borderRadius:8*u,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:w=>w.currentTarget.style.borderColor="#4a9eff",onBlur:w=>w.currentTarget.style.borderColor="#444"})]}),a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*u,color:"#fff",marginBottom:8*u,fontWeight:"bold"},children:""}),a.jsx("input",{type:"password",value:s,onChange:w=>i(w.target.value),onKeyPress:k,placeholder:"",disabled:c,style:{width:"100%",padding:`${12*u}px ${16*u}px`,fontSize:16*u,borderRadius:8*u,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:w=>w.currentTarget.style.borderColor="#4a9eff",onBlur:w=>w.currentTarget.style.borderColor="#444"})]}),o&&a.jsx("div",{style:{padding:`${12*u}px ${16*u}px`,borderRadius:8*u,background:"rgba(255, 80, 80, 0.2)",border:"2px solid #ff5050",color:"#ff5050",fontSize:14*u,textAlign:"center"},children:o}),a.jsxs("div",{style:{display:"flex",gap:16*u,marginTop:20*u},children:[a.jsx("button",{onClick:e,disabled:c,style:{flex:1,padding:`${16*u}px ${32*u}px`,fontSize:18*u,fontWeight:"bold",borderRadius:8*u,border:"none",background:"#555",color:"#fff",cursor:c?"not-allowed":"pointer",transition:"all 0.3s",opacity:c?.5:1},onMouseEnter:w=>!c&&(w.currentTarget.style.background="#666"),onMouseLeave:w=>!c&&(w.currentTarget.style.background="#555"),children:""}),a.jsx("button",{onClick:S,disabled:c,style:{flex:1,padding:`${16*u}px ${32*u}px`,fontSize:18*u,fontWeight:"bold",borderRadius:8*u,border:"none",background:c?"#555":"linear-gradient(135deg, #4a9eff 0%, #357abd 100%)",color:"#fff",cursor:c?"not-allowed":"pointer",transition:"all 0.3s",boxShadow:c?"none":"0 4px 8px rgba(0,0,0,0.3)"},onMouseEnter:w=>!c&&(w.currentTarget.style.transform="scale(1.05)"),onMouseLeave:w=>!c&&(w.currentTarget.style.transform="scale(1)"),children:c?"...":""})]}),a.jsx("div",{style:{marginTop:20*u,padding:`${12*u}px ${16*u}px`,borderRadius:8*u,background:"rgba(255, 200, 80, 0.1)",border:"1px solid rgba(255, 200, 80, 0.3)",fontSize:13*u,color:"#ffcc80",textAlign:"center",lineHeight:1.6},children:" "})]})]})})},M_=1280,N_=720,L3=({playerId:t,currentPlayerName:e,onUpdateSuccess:n,onBack:r})=>{const[s,i]=L.useState(e),[o,l]=L.useState(""),[c,d]=L.useState(!1),[u,h]=L.useState(!1),[f,S]=L.useState(1);L.useEffect(()=>{const j=()=>{const _=window.innerWidth/M_,x=window.innerHeight/N_;S(Math.min(_,x))};return j(),window.addEventListener("resize",j),()=>window.removeEventListener("resize",j)},[]);const k=async()=>{if(l(""),h(!1),!s.trim()){l("");return}if(s.length>20){l("20");return}if(!t){l("ID");return}d(!0);try{await fL(t,s.trim()),h(!0),setTimeout(()=>{n(s.trim())},1e3)}catch(j){console.error("Failed to update player name:",j),l("")}finally{d(!1)}},w=j=>{j.key==="Enter"&&!c&&k()};return a.jsx("div",{style:{width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",overflow:"hidden"},children:a.jsxs("div",{style:{width:M_*f,height:N_*f,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative"},children:[a.jsx("h1",{style:{fontSize:48*f,fontWeight:"bold",color:"#fff",marginBottom:40*f,textShadow:"0 4px 8px rgba(0,0,0,0.5)"},children:""}),a.jsxs("div",{style:{width:400*f,display:"flex",flexDirection:"column",gap:20*f},children:[a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*f,color:"#fff",marginBottom:8*f,fontWeight:"bold"},children:""}),a.jsx("input",{type:"text",value:s,onChange:j=>i(j.target.value),onKeyPress:w,placeholder:"",disabled:c,maxLength:20,style:{width:"100%",padding:`${12*f}px ${16*f}px`,fontSize:16*f,borderRadius:8*f,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:j=>j.currentTarget.style.borderColor="#4a9eff",onBlur:j=>j.currentTarget.style.borderColor="#444"}),a.jsx("p",{style:{fontSize:12*f,color:"#888",marginTop:4*f,marginBottom:0},children:"20"})]}),o&&a.jsx("div",{style:{padding:`${12*f}px ${16*f}px`,borderRadius:8*f,background:"rgba(255, 80, 80, 0.2)",border:"2px solid #ff5050",color:"#ff5050",fontSize:14*f,textAlign:"center"},children:o}),u&&a.jsx("div",{style:{padding:`${12*f}px ${16*f}px`,borderRadius:8*f,background:"rgba(80, 255, 120, 0.2)",border:"2px solid #50ff78",color:"#50ff78",fontSize:14*f,textAlign:"center"},children:" "}),a.jsxs("div",{style:{display:"flex",gap:16*f,marginTop:20*f},children:[a.jsx("button",{onClick:r,disabled:c,style:{flex:1,padding:`${16*f}px ${32*f}px`,fontSize:18*f,fontWeight:"bold",borderRadius:8*f,border:"none",background:"#555",color:"#fff",cursor:c?"not-allowed":"pointer",transition:"all 0.3s",opacity:c?.5:1},onMouseEnter:j=>!c&&(j.currentTarget.style.background="#666"),onMouseLeave:j=>!c&&(j.currentTarget.style.background="#555"),children:""}),a.jsx("button",{onClick:k,disabled:c,style:{flex:1,padding:`${16*f}px ${32*f}px`,fontSize:18*f,fontWeight:"bold",borderRadius:8*f,border:"none",background:c?"#555":"linear-gradient(135deg, #4a9eff 0%, #357abd 100%)",color:"#fff",cursor:c?"not-allowed":"pointer",transition:"all 0.3s",boxShadow:c?"none":"0 4px 8px rgba(0,0,0,0.3)"},onMouseEnter:j=>!c&&(j.currentTarget.style.transform="scale(1.05)"),onMouseLeave:j=>!c&&(j.currentTarget.style.transform="scale(1)"),children:c?"...":""})]})]})]})})},D3=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},M3=D3("/bgm/tenfubu.mp3"),Wc={bgm:.3,se:.5,voice:.5,bgmEnabled:!0,seEnabled:!0},N3=()=>{try{const t=localStorage.getItem("audioSettings");if(t){const e=JSON.parse(t);if(e.enabled!==void 0){const{enabled:n,...r}=e;return{...Wc,...r,bgmEnabled:n,seEnabled:n}}return{...Wc,...e}}return Wc}catch{return Wc}},j3=()=>{const[t,e]=L.useState(!1);return L.useEffect(()=>{const n=()=>{const r="ontouchstart"in window||navigator.maxTouchPoints>0,s=window.innerHeight>window.innerWidth;e(r&&s)};return n(),window.addEventListener("resize",n),window.addEventListener("orientationchange",n),()=>{window.removeEventListener("resize",n),window.removeEventListener("orientationchange",n)}},[]),t};function $3(){const[t,e]=L.useState("TITLE"),[n,r]=L.useState("SENKA"),[s,i]=L.useState("CPU"),[o,l]=L.useState(""),[c,d]=L.useState(void 0),[u,h]=L.useState("NORMAL"),[f,S]=L.useState(null),[k,w]=L.useState(!0),[j,_]=L.useState(null),[x,I]=L.useState(null),[p,D]=L.useState(!0),[z,te]=L.useState(()=>{const ie=localStorage.getItem("timerEnabled");return ie!==null?JSON.parse(ie):!0}),[H,q]=L.useState(()=>localStorage.getItem("playerName")||""),[ue,ye]=L.useState(void 0),[Me,fe]=L.useState(void 0),re=j3(),P=L.useRef(null),[C,R]=L.useState(!1),[v,g]=L.useState(N3),[T,A]=L.useState(()=>localStorage.getItem("homeCardId")),y=ie=>ie&&ie.endsWith("@tenfubu-game.local")?ie.replace("@tenfubu-game.local",""):null;L.useEffect(()=>{const ie=A3(async He=>{if(console.log(" Auth state changed:",{uid:He==null?void 0:He.uid,email:He==null?void 0:He.email,isAnonymous:He==null?void 0:He.isAnonymous}),He){S(He.uid),w(He.isAnonymous),_(He.email),I(y(He.email));const nt=y(He.email);console.log(" State updated:",{playerId:He.uid,isAnonymous:He.isAnonymous,userId:nt});try{await h_(He.uid,nt||"anonymous",H||"")}catch(Vt){console.error("Failed to create player data:",Vt)}}else try{const nt=await T3();S(nt.uid),w(!0),_(null),I(null),await h_(nt.uid,"anonymous",H||"")}catch(nt){console.error("Failed to sign in:",nt)}D(!1)});return()=>ie()},[]),L.useEffect(()=>{localStorage.setItem("audioSettings",JSON.stringify(v))},[v]);const X=L.useCallback(ie=>{g(He=>({...He,...ie}))},[]),F=L.useCallback((ie,He)=>{P.current=ie,R(!0),He&&d(He),e("GAME")},[]),ve=L.useCallback((ie,He,nt,Vt,Bt)=>{P.current=ie,R(!0),d(He),ye(Vt),fe(Bt),e("GAME")},[]),ke=L.useCallback(ie=>{P.current&&(P.current.disconnect(),P.current=null),R(!1),d(void 0),ye(void 0),fe(void 0),r(ie),e("MATCHMAKING")},[]),Ee=L.useRef(null),ee=L.useRef(!1);L.useEffect(()=>{const ie=new Audio(M3);return ie.loop=!0,ie.volume=v.bgmEnabled?v.bgm:0,Ee.current=ie,ee.current=!0,()=>{ie.pause(),ie.src=""}},[]),L.useEffect(()=>{const ie=Ee.current;!ie||!ee.current||(ie.volume=v.bgmEnabled?v.bgm:0,v.bgmEnabled?ie.paused&&(t==="TITLE"||t==="CLASS_SELECT")&&ie.play().catch(()=>{}):ie.pause())},[v.bgm,v.bgmEnabled,t]),L.useEffect(()=>{const ie=Ee.current;ie&&(t==="TITLE"||t==="CLASS_SELECT"||t==="LOBBY"?ie.paused&&v.bgmEnabled&&ie.play().catch(()=>{}):(ie.pause(),ie.currentTime=0))},[t,v.bgmEnabled]),L.useEffect(()=>{const ie=()=>{const He=Ee.current;He&&He.paused&&v.bgmEnabled&&(t==="TITLE"||t==="CLASS_SELECT"||t==="LOBBY")&&He.play().catch(()=>{})};return document.addEventListener("click",ie),()=>document.removeEventListener("click",ie)},[t,v.bgmEnabled]);const Y=L.useCallback((ie,He)=>{i(ie),He&&l(He),e("CLASS_SELECT")},[]),Pe=L.useCallback(ie=>{r(ie),e(s==="CPU"?"GAME":s==="CASUAL_MATCH"||s==="RANKED_MATCH"?"MATCHMAKING":"LOBBY")},[s]),xe=L.useCallback(()=>{P.current&&(P.current.disconnect(),P.current=null),R(!1),e("TITLE"),l(""),i("CPU"),d(void 0),ye(void 0),fe(void 0)},[]),$e=L.useCallback(ie=>{A(ie),localStorage.setItem("homeCardId",ie)},[]),Te=L.useCallback(()=>{e("REGISTER")},[]),Ne=L.useCallback(()=>{e("LOGIN")},[]),mt=L.useCallback(()=>{e("TITLE")},[]),tt=L.useCallback(()=>{e("TITLE")},[]),st=L.useCallback(async()=>{try{await R3(),e("TITLE")}catch(ie){console.error("Failed to logout:",ie)}},[]),qe=L.useCallback(()=>{e("TITLE")},[]),B=L.useCallback(()=>{e("TITLE")},[]),We=L.useCallback(()=>{e("PROFILE")},[]),ut=L.useCallback(ie=>{q(ie),localStorage.setItem("playerName",ie),e("TITLE")},[]),Pt=L.useCallback(()=>{e("TITLE")},[]);return p?a.jsx("div",{style:{width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",color:"white",fontSize:"1.5rem",fontWeight:"bold"},children:"Loading..."}):a.jsxs("div",{className:"app-container",children:[re&&a.jsxs("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100dvh",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:99999,color:"white",textAlign:"center",padding:20},children:[a.jsx("div",{style:{fontSize:"4rem",marginBottom:20,animation:"rotatePhone 2s ease-in-out infinite"},children:""}),a.jsx("h2",{style:{fontSize:"1.5rem",fontWeight:"bold",marginBottom:10,textShadow:"0 2px 4px rgba(0,0,0,0.5)"},children:""}),a.jsx("p",{style:{fontSize:"1rem",opacity:.8,maxWidth:280},children:""}),a.jsx("style",{children:`
                        @keyframes rotatePhone {
                            0%, 100% { transform: rotate(0deg); }
                            25% { transform: rotate(-30deg); }
                            75% { transform: rotate(30deg); }
                        }
                    `})]}),t==="TITLE"&&a.jsx(N2,{onStartConfig:Y,audioSettings:v,onAudioSettingsChange:X,playerId:f,onSetHomeCard:$e,isAnonymous:k,userId:x,onNavigateToRegister:Te,onNavigateToLogin:Ne,onNavigateToProfile:We,onLogout:st}),t==="CLASS_SELECT"&&a.jsx(_L,{onSelectClass:Pe,onBack:xe,gameMode:s,aiDifficulty:u,onDifficultyChange:h,playerName:H,onPlayerNameChange:ie=>{q(ie),localStorage.setItem("playerName",ie)},timerEnabled:z,onTimerEnabledChange:ie=>{te(ie),localStorage.setItem("timerEnabled",JSON.stringify(ie))},playerId:f}),t==="LOBBY"&&a.jsx(HL,{gameMode:s,targetRoomId:o,playerClass:n,onGameStart:F,onBack:xe}),t==="MATCHMAKING"&&a.jsx(YL,{matchType:s==="CASUAL_MATCH"?"casual":"ranked",playerClass:n,playerName:H||"",playerId:f,onGameStart:ve,onCancel:xe}),t==="GAME"&&a.jsx(w3,{playerClass:n,opponentType:s==="CPU"?"CPU":"ONLINE",gameMode:s,targetRoomId:o,onLeave:xe,onRematching:ke,networkAdapter:P.current,networkConnected:C,opponentClass:c,aiDifficulty:u,playerName:H||"",timerEnabled:s==="CASUAL_MATCH"||s==="RANKED_MATCH"?!0:z,playerId:f,opponentPlayerId:ue,opponentRating:Me}),t==="REGISTER"&&a.jsx(P3,{onRegisterSuccess:mt,onBack:qe}),t==="LOGIN"&&a.jsx(O3,{onLoginSuccess:tt,onBack:B}),t==="PROFILE"&&a.jsx(L3,{playerId:f,currentPlayerName:H,onUpdateSuccess:ut,onBack:Pt})]})}bh.createRoot(document.getElementById("root")).render(a.jsx($3,{}));
