var pE=Object.defineProperty;var hE=t=>{throw TypeError(t)};var gE=(t,e,n)=>e in t?pE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var zt=(t,e,n)=>gE(t,typeof e!="symbol"?e+"":e,n);var go=(t,e,n)=>e.has(t)?hE("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n);function mE(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in t)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function oy(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ay={exports:{}},Wc={},ly={exports:{}},Ke={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wa=Symbol.for("react.element"),yE=Symbol.for("react.portal"),vE=Symbol.for("react.fragment"),_E=Symbol.for("react.strict_mode"),xE=Symbol.for("react.profiler"),EE=Symbol.for("react.provider"),bE=Symbol.for("react.context"),SE=Symbol.for("react.forward_ref"),CE=Symbol.for("react.suspense"),TE=Symbol.for("react.memo"),IE=Symbol.for("react.lazy"),Fg=Symbol.iterator;function kE(t){return t===null||typeof t!="object"?null:(t=Fg&&t[Fg]||t["@@iterator"],typeof t=="function"?t:null)}var cy={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},uy=Object.assign,dy={};function Qi(t,e,n){this.props=t,this.context=e,this.refs=dy,this.updater=n||cy}Qi.prototype.isReactComponent={};Qi.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Qi.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function fy(){}fy.prototype=Qi.prototype;function pp(t,e,n){this.props=t,this.context=e,this.refs=dy,this.updater=n||cy}var hp=pp.prototype=new fy;hp.constructor=pp;uy(hp,Qi.prototype);hp.isPureReactComponent=!0;var $g=Array.isArray,py=Object.prototype.hasOwnProperty,gp={current:null},hy={key:!0,ref:!0,__self:!0,__source:!0};function gy(t,e,n){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)py.call(e,r)&&!hy.hasOwnProperty(r)&&(s[r]=e[r]);var a=arguments.length-2;if(a===1)s.children=n;else if(1<a){for(var c=Array(a),u=0;u<a;u++)c[u]=arguments[u+2];s.children=c}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)s[r]===void 0&&(s[r]=a[r]);return{$$typeof:wa,type:t,key:i,ref:o,props:s,_owner:gp.current}}function wE(t,e){return{$$typeof:wa,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function mp(t){return typeof t=="object"&&t!==null&&t.$$typeof===wa}function RE(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Bg=/\/+/g;function Zu(t,e){return typeof t=="object"&&t!==null&&t.key!=null?RE(""+t.key):e.toString(36)}function Ll(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case wa:case yE:o=!0}}if(o)return o=t,s=s(o),t=r===""?"."+Zu(o,0):r,$g(s)?(n="",t!=null&&(n=t.replace(Bg,"$&/")+"/"),Ll(s,e,n,"",function(u){return u})):s!=null&&(mp(s)&&(s=wE(s,n+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(Bg,"$&/")+"/")+t)),e.push(s)),1;if(o=0,r=r===""?".":r+":",$g(t))for(var a=0;a<t.length;a++){i=t[a];var c=r+Zu(i,a);o+=Ll(i,e,n,c,s)}else if(c=kE(t),typeof c=="function")for(t=c.call(t),a=0;!(i=t.next()).done;)i=i.value,c=r+Zu(i,a++),o+=Ll(i,e,n,c,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function cl(t,e,n){if(t==null)return t;var r=[],s=0;return Ll(t,r,"","",function(i){return e.call(n,i,s++)}),r}function AE(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var fn={current:null},Dl={transition:null},PE={ReactCurrentDispatcher:fn,ReactCurrentBatchConfig:Dl,ReactCurrentOwner:gp};function my(){throw Error("act(...) is not supported in production builds of React.")}Ke.Children={map:cl,forEach:function(t,e,n){cl(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return cl(t,function(){e++}),e},toArray:function(t){return cl(t,function(e){return e})||[]},only:function(t){if(!mp(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Ke.Component=Qi;Ke.Fragment=vE;Ke.Profiler=xE;Ke.PureComponent=pp;Ke.StrictMode=_E;Ke.Suspense=CE;Ke.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=PE;Ke.act=my;Ke.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=uy({},t.props),s=t.key,i=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=gp.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(c in e)py.call(e,c)&&!hy.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){a=Array(c);for(var u=0;u<c;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:wa,type:t.type,key:s,ref:i,props:r,_owner:o}};Ke.createContext=function(t){return t={$$typeof:bE,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:EE,_context:t},t.Consumer=t};Ke.createElement=gy;Ke.createFactory=function(t){var e=gy.bind(null,t);return e.type=t,e};Ke.createRef=function(){return{current:null}};Ke.forwardRef=function(t){return{$$typeof:SE,render:t}};Ke.isValidElement=mp;Ke.lazy=function(t){return{$$typeof:IE,_payload:{_status:-1,_result:t},_init:AE}};Ke.memo=function(t,e){return{$$typeof:TE,type:t,compare:e===void 0?null:e}};Ke.startTransition=function(t){var e=Dl.transition;Dl.transition={};try{t()}finally{Dl.transition=e}};Ke.unstable_act=my;Ke.useCallback=function(t,e){return fn.current.useCallback(t,e)};Ke.useContext=function(t){return fn.current.useContext(t)};Ke.useDebugValue=function(){};Ke.useDeferredValue=function(t){return fn.current.useDeferredValue(t)};Ke.useEffect=function(t,e){return fn.current.useEffect(t,e)};Ke.useId=function(){return fn.current.useId()};Ke.useImperativeHandle=function(t,e,n){return fn.current.useImperativeHandle(t,e,n)};Ke.useInsertionEffect=function(t,e){return fn.current.useInsertionEffect(t,e)};Ke.useLayoutEffect=function(t,e){return fn.current.useLayoutEffect(t,e)};Ke.useMemo=function(t,e){return fn.current.useMemo(t,e)};Ke.useReducer=function(t,e,n){return fn.current.useReducer(t,e,n)};Ke.useRef=function(t){return fn.current.useRef(t)};Ke.useState=function(t){return fn.current.useState(t)};Ke.useSyncExternalStore=function(t,e,n){return fn.current.useSyncExternalStore(t,e,n)};Ke.useTransition=function(){return fn.current.useTransition()};Ke.version="18.3.1";ly.exports=Ke;var V=ly.exports;const M=oy(V);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var OE=V,LE=Symbol.for("react.element"),DE=Symbol.for("react.fragment"),ME=Object.prototype.hasOwnProperty,NE=OE.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,jE={key:!0,ref:!0,__self:!0,__source:!0};function yy(t,e,n){var r,s={},i=null,o=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)ME.call(e,r)&&!jE.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:LE,type:t,key:i,ref:o,props:s,_owner:NE.current}}Wc.Fragment=DE;Wc.jsx=yy;Wc.jsxs=yy;ay.exports=Wc;var l=ay.exports,Bd={},vy={exports:{}},On={},_y={exports:{}},xy={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(T,B){var U=T.length;T.push(B);e:for(;0<U;){var Y=U-1>>>1,Me=T[Y];if(0<s(Me,B))T[Y]=B,T[U]=Me,U=Y;else break e}}function n(T){return T.length===0?null:T[0]}function r(T){if(T.length===0)return null;var B=T[0],U=T.pop();if(U!==B){T[0]=U;e:for(var Y=0,Me=T.length,Je=Me>>>1;Y<Je;){var de=2*(Y+1)-1,Ue=T[de],_e=de+1,Le=T[_e];if(0>s(Ue,U))_e<Me&&0>s(Le,Ue)?(T[Y]=Le,T[_e]=U,Y=_e):(T[Y]=Ue,T[de]=U,Y=de);else if(_e<Me&&0>s(Le,U))T[Y]=Le,T[_e]=U,Y=_e;else break e}}return B}function s(T,B){var U=T.sortIndex-B.sortIndex;return U!==0?U:T.id-B.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var c=[],u=[],p=1,f=null,d=3,y=!1,S=!1,P=!1,g=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function E(T){for(var B=n(u);B!==null;){if(B.callback===null)r(u);else if(B.startTime<=T)r(u),B.sortIndex=B.expirationTime,e(c,B);else break;B=n(u)}}function O(T){if(P=!1,E(T),!S)if(n(c)!==null)S=!0,$(Q);else{var B=n(u);B!==null&&L(O,B.startTime-T)}}function Q(T,B){S=!1,P&&(P=!1,b(J),J=-1),y=!0;var U=d;try{for(E(B),f=n(c);f!==null&&(!(f.expirationTime>B)||T&&!C());){var Y=f.callback;if(typeof Y=="function"){f.callback=null,d=f.priorityLevel;var Me=Y(f.expirationTime<=B);B=t.unstable_now(),typeof Me=="function"?f.callback=Me:f===n(c)&&r(c),E(B)}else r(c);f=n(c)}if(f!==null)var Je=!0;else{var de=n(u);de!==null&&L(O,de.startTime-B),Je=!1}return Je}finally{f=null,d=U,y=!1}}var F=!1,se=null,J=-1,me=5,A=-1;function C(){return!(t.unstable_now()-A<me)}function k(){if(se!==null){var T=t.unstable_now();A=T;var B=!0;try{B=se(!0,T)}finally{B?I():(F=!1,se=null)}}else F=!1}var I;if(typeof x=="function")I=function(){x(k)};else if(typeof MessageChannel<"u"){var m=new MessageChannel,R=m.port2;m.port1.onmessage=k,I=function(){R.postMessage(null)}}else I=function(){g(k,0)};function $(T){se=T,F||(F=!0,I())}function L(T,B){J=g(function(){T(t.unstable_now())},B)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(T){T.callback=null},t.unstable_continueExecution=function(){S||y||(S=!0,$(Q))},t.unstable_forceFrameRate=function(T){0>T||125<T?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):me=0<T?Math.floor(1e3/T):5},t.unstable_getCurrentPriorityLevel=function(){return d},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(T){switch(d){case 1:case 2:case 3:var B=3;break;default:B=d}var U=d;d=B;try{return T()}finally{d=U}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(T,B){switch(T){case 1:case 2:case 3:case 4:case 5:break;default:T=3}var U=d;d=T;try{return B()}finally{d=U}},t.unstable_scheduleCallback=function(T,B,U){var Y=t.unstable_now();switch(typeof U=="object"&&U!==null?(U=U.delay,U=typeof U=="number"&&0<U?Y+U:Y):U=Y,T){case 1:var Me=-1;break;case 2:Me=250;break;case 5:Me=1073741823;break;case 4:Me=1e4;break;default:Me=5e3}return Me=U+Me,T={id:p++,callback:B,priorityLevel:T,startTime:U,expirationTime:Me,sortIndex:-1},U>Y?(T.sortIndex=U,e(u,T),n(c)===null&&T===n(u)&&(P?(b(J),J=-1):P=!0,L(O,U-Y))):(T.sortIndex=Me,e(c,T),S||y||(S=!0,$(Q))),T},t.unstable_shouldYield=C,t.unstable_wrapCallback=function(T){var B=d;return function(){var U=d;d=B;try{return T.apply(this,arguments)}finally{d=U}}}})(xy);_y.exports=xy;var FE=_y.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $E=V,Pn=FE;function ie(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Ey=new Set,Jo={};function Ys(t,e){ji(t,e),ji(t+"Capture",e)}function ji(t,e){for(Jo[t]=e,t=0;t<e.length;t++)Ey.add(e[t])}var kr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ud=Object.prototype.hasOwnProperty,BE=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Ug={},zg={};function UE(t){return Ud.call(zg,t)?!0:Ud.call(Ug,t)?!1:BE.test(t)?zg[t]=!0:(Ug[t]=!0,!1)}function zE(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function HE(t,e,n,r){if(e===null||typeof e>"u"||zE(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function pn(t,e,n,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var Yt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Yt[t]=new pn(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Yt[e]=new pn(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Yt[t]=new pn(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Yt[t]=new pn(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Yt[t]=new pn(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Yt[t]=new pn(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Yt[t]=new pn(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Yt[t]=new pn(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Yt[t]=new pn(t,5,!1,t.toLowerCase(),null,!1,!1)});var yp=/[\-:]([a-z])/g;function vp(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(yp,vp);Yt[e]=new pn(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(yp,vp);Yt[e]=new pn(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(yp,vp);Yt[e]=new pn(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Yt[t]=new pn(t,1,!1,t.toLowerCase(),null,!1,!1)});Yt.xlinkHref=new pn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Yt[t]=new pn(t,1,!1,t.toLowerCase(),null,!0,!0)});function _p(t,e,n,r){var s=Yt.hasOwnProperty(e)?Yt[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(HE(e,n,s,r)&&(n=null),r||s===null?UE(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var Lr=$E.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ul=Symbol.for("react.element"),hi=Symbol.for("react.portal"),gi=Symbol.for("react.fragment"),xp=Symbol.for("react.strict_mode"),zd=Symbol.for("react.profiler"),by=Symbol.for("react.provider"),Sy=Symbol.for("react.context"),Ep=Symbol.for("react.forward_ref"),Hd=Symbol.for("react.suspense"),Wd=Symbol.for("react.suspense_list"),bp=Symbol.for("react.memo"),Hr=Symbol.for("react.lazy"),Cy=Symbol.for("react.offscreen"),Hg=Symbol.iterator;function mo(t){return t===null||typeof t!="object"?null:(t=Hg&&t[Hg]||t["@@iterator"],typeof t=="function"?t:null)}var St=Object.assign,ed;function Ro(t){if(ed===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);ed=e&&e[1]||""}return`
`+ed+t}var td=!1;function nd(t,e){if(!t||td)return"";td=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){r=u}t.call(e.prototype)}else{try{throw Error()}catch(u){r=u}t()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var s=u.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,a=i.length-1;1<=o&&0<=a&&s[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||s[o]!==i[a]){var c=`
`+s[o].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=o&&0<=a);break}}}finally{td=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Ro(t):""}function WE(t){switch(t.tag){case 5:return Ro(t.type);case 16:return Ro("Lazy");case 13:return Ro("Suspense");case 19:return Ro("SuspenseList");case 0:case 2:case 15:return t=nd(t.type,!1),t;case 11:return t=nd(t.type.render,!1),t;case 1:return t=nd(t.type,!0),t;default:return""}}function Gd(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case gi:return"Fragment";case hi:return"Portal";case zd:return"Profiler";case xp:return"StrictMode";case Hd:return"Suspense";case Wd:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Sy:return(t.displayName||"Context")+".Consumer";case by:return(t._context.displayName||"Context")+".Provider";case Ep:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case bp:return e=t.displayName||null,e!==null?e:Gd(t.type)||"Memo";case Hr:e=t._payload,t=t._init;try{return Gd(t(e))}catch{}}return null}function GE(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Gd(e);case 8:return e===xp?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function cs(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Ty(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function VE(t){var e=Ty(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function dl(t){t._valueTracker||(t._valueTracker=VE(t))}function Iy(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=Ty(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Zl(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Vd(t,e){var n=e.checked;return St({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Wg(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=cs(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function ky(t,e){e=e.checked,e!=null&&_p(t,"checked",e,!1)}function Yd(t,e){ky(t,e);var n=cs(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Kd(t,e.type,n):e.hasOwnProperty("defaultValue")&&Kd(t,e.type,cs(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Gg(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Kd(t,e,n){(e!=="number"||Zl(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Ao=Array.isArray;function ki(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+cs(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function Xd(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ie(91));return St({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Vg(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(ie(92));if(Ao(n)){if(1<n.length)throw Error(ie(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:cs(n)}}function wy(t,e){var n=cs(e.value),r=cs(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function Yg(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function Ry(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Qd(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?Ry(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var fl,Ay=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(fl=fl||document.createElement("div"),fl.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=fl.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function qo(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Do={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},YE=["Webkit","ms","Moz","O"];Object.keys(Do).forEach(function(t){YE.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Do[e]=Do[t]})});function Py(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Do.hasOwnProperty(t)&&Do[t]?(""+e).trim():e+"px"}function Oy(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=Py(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var KE=St({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Jd(t,e){if(e){if(KE[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ie(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ie(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ie(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ie(62))}}function qd(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Zd=null;function Sp(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var ef=null,wi=null,Ri=null;function Kg(t){if(t=Pa(t)){if(typeof ef!="function")throw Error(ie(280));var e=t.stateNode;e&&(e=Xc(e),ef(t.stateNode,t.type,e))}}function Ly(t){wi?Ri?Ri.push(t):Ri=[t]:wi=t}function Dy(){if(wi){var t=wi,e=Ri;if(Ri=wi=null,Kg(t),e)for(t=0;t<e.length;t++)Kg(e[t])}}function My(t,e){return t(e)}function Ny(){}var rd=!1;function jy(t,e,n){if(rd)return t(e,n);rd=!0;try{return My(t,e,n)}finally{rd=!1,(wi!==null||Ri!==null)&&(Ny(),Dy())}}function Zo(t,e){var n=t.stateNode;if(n===null)return null;var r=Xc(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(ie(231,e,typeof n));return n}var tf=!1;if(kr)try{var yo={};Object.defineProperty(yo,"passive",{get:function(){tf=!0}}),window.addEventListener("test",yo,yo),window.removeEventListener("test",yo,yo)}catch{tf=!1}function XE(t,e,n,r,s,i,o,a,c){var u=Array.prototype.slice.call(arguments,3);try{e.apply(n,u)}catch(p){this.onError(p)}}var Mo=!1,ec=null,tc=!1,nf=null,QE={onError:function(t){Mo=!0,ec=t}};function JE(t,e,n,r,s,i,o,a,c){Mo=!1,ec=null,XE.apply(QE,arguments)}function qE(t,e,n,r,s,i,o,a,c){if(JE.apply(this,arguments),Mo){if(Mo){var u=ec;Mo=!1,ec=null}else throw Error(ie(198));tc||(tc=!0,nf=u)}}function Ks(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function Fy(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Xg(t){if(Ks(t)!==t)throw Error(ie(188))}function ZE(t){var e=t.alternate;if(!e){if(e=Ks(t),e===null)throw Error(ie(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return Xg(s),t;if(i===r)return Xg(s),e;i=i.sibling}throw Error(ie(188))}if(n.return!==r.return)n=s,r=i;else{for(var o=!1,a=s.child;a;){if(a===n){o=!0,n=s,r=i;break}if(a===r){o=!0,r=s,n=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===n){o=!0,n=i,r=s;break}if(a===r){o=!0,r=i,n=s;break}a=a.sibling}if(!o)throw Error(ie(189))}}if(n.alternate!==r)throw Error(ie(190))}if(n.tag!==3)throw Error(ie(188));return n.stateNode.current===n?t:e}function $y(t){return t=ZE(t),t!==null?By(t):null}function By(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=By(t);if(e!==null)return e;t=t.sibling}return null}var Uy=Pn.unstable_scheduleCallback,Qg=Pn.unstable_cancelCallback,eb=Pn.unstable_shouldYield,tb=Pn.unstable_requestPaint,It=Pn.unstable_now,nb=Pn.unstable_getCurrentPriorityLevel,Cp=Pn.unstable_ImmediatePriority,zy=Pn.unstable_UserBlockingPriority,nc=Pn.unstable_NormalPriority,rb=Pn.unstable_LowPriority,Hy=Pn.unstable_IdlePriority,Gc=null,dr=null;function sb(t){if(dr&&typeof dr.onCommitFiberRoot=="function")try{dr.onCommitFiberRoot(Gc,t,void 0,(t.current.flags&128)===128)}catch{}}var er=Math.clz32?Math.clz32:ab,ib=Math.log,ob=Math.LN2;function ab(t){return t>>>=0,t===0?32:31-(ib(t)/ob|0)|0}var pl=64,hl=4194304;function Po(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function rc(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~s;a!==0?r=Po(a):(i&=o,i!==0&&(r=Po(i)))}else o=n&~s,o!==0?r=Po(o):i!==0&&(r=Po(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-er(e),s=1<<n,r|=t[n],e&=~s;return r}function lb(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function cb(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var o=31-er(i),a=1<<o,c=s[o];c===-1?(!(a&n)||a&r)&&(s[o]=lb(a,e)):c<=e&&(t.expiredLanes|=a),i&=~a}}function rf(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Wy(){var t=pl;return pl<<=1,!(pl&4194240)&&(pl=64),t}function sd(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Ra(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-er(e),t[e]=n}function ub(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-er(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function Tp(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-er(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var rt=0;function Gy(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Vy,Ip,Yy,Ky,Xy,sf=!1,gl=[],Qr=null,Jr=null,qr=null,ea=new Map,ta=new Map,Gr=[],db="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Jg(t,e){switch(t){case"focusin":case"focusout":Qr=null;break;case"dragenter":case"dragleave":Jr=null;break;case"mouseover":case"mouseout":qr=null;break;case"pointerover":case"pointerout":ea.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ta.delete(e.pointerId)}}function vo(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=Pa(e),e!==null&&Ip(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function fb(t,e,n,r,s){switch(e){case"focusin":return Qr=vo(Qr,t,e,n,r,s),!0;case"dragenter":return Jr=vo(Jr,t,e,n,r,s),!0;case"mouseover":return qr=vo(qr,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return ea.set(i,vo(ea.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,ta.set(i,vo(ta.get(i)||null,t,e,n,r,s)),!0}return!1}function Qy(t){var e=As(t.target);if(e!==null){var n=Ks(e);if(n!==null){if(e=n.tag,e===13){if(e=Fy(n),e!==null){t.blockedOn=e,Xy(t.priority,function(){Yy(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Ml(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=of(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);Zd=r,n.target.dispatchEvent(r),Zd=null}else return e=Pa(n),e!==null&&Ip(e),t.blockedOn=n,!1;e.shift()}return!0}function qg(t,e,n){Ml(t)&&n.delete(e)}function pb(){sf=!1,Qr!==null&&Ml(Qr)&&(Qr=null),Jr!==null&&Ml(Jr)&&(Jr=null),qr!==null&&Ml(qr)&&(qr=null),ea.forEach(qg),ta.forEach(qg)}function _o(t,e){t.blockedOn===e&&(t.blockedOn=null,sf||(sf=!0,Pn.unstable_scheduleCallback(Pn.unstable_NormalPriority,pb)))}function na(t){function e(s){return _o(s,t)}if(0<gl.length){_o(gl[0],t);for(var n=1;n<gl.length;n++){var r=gl[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Qr!==null&&_o(Qr,t),Jr!==null&&_o(Jr,t),qr!==null&&_o(qr,t),ea.forEach(e),ta.forEach(e),n=0;n<Gr.length;n++)r=Gr[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Gr.length&&(n=Gr[0],n.blockedOn===null);)Qy(n),n.blockedOn===null&&Gr.shift()}var Ai=Lr.ReactCurrentBatchConfig,sc=!0;function hb(t,e,n,r){var s=rt,i=Ai.transition;Ai.transition=null;try{rt=1,kp(t,e,n,r)}finally{rt=s,Ai.transition=i}}function gb(t,e,n,r){var s=rt,i=Ai.transition;Ai.transition=null;try{rt=4,kp(t,e,n,r)}finally{rt=s,Ai.transition=i}}function kp(t,e,n,r){if(sc){var s=of(t,e,n,r);if(s===null)hd(t,e,r,ic,n),Jg(t,r);else if(fb(s,t,e,n,r))r.stopPropagation();else if(Jg(t,r),e&4&&-1<db.indexOf(t)){for(;s!==null;){var i=Pa(s);if(i!==null&&Vy(i),i=of(t,e,n,r),i===null&&hd(t,e,r,ic,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else hd(t,e,r,null,n)}}var ic=null;function of(t,e,n,r){if(ic=null,t=Sp(r),t=As(t),t!==null)if(e=Ks(t),e===null)t=null;else if(n=e.tag,n===13){if(t=Fy(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return ic=t,null}function Jy(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(nb()){case Cp:return 1;case zy:return 4;case nc:case rb:return 16;case Hy:return 536870912;default:return 16}default:return 16}}var Yr=null,wp=null,Nl=null;function qy(){if(Nl)return Nl;var t,e=wp,n=e.length,r,s="value"in Yr?Yr.value:Yr.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===s[i-r];r++);return Nl=s.slice(t,1<r?1-r:void 0)}function jl(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function ml(){return!0}function Zg(){return!1}function Ln(t){function e(n,r,s,i,o){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?ml:Zg,this.isPropagationStopped=Zg,this}return St(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=ml)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=ml)},persist:function(){},isPersistent:ml}),e}var Ji={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Rp=Ln(Ji),Aa=St({},Ji,{view:0,detail:0}),mb=Ln(Aa),id,od,xo,Vc=St({},Aa,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ap,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==xo&&(xo&&t.type==="mousemove"?(id=t.screenX-xo.screenX,od=t.screenY-xo.screenY):od=id=0,xo=t),id)},movementY:function(t){return"movementY"in t?t.movementY:od}}),e0=Ln(Vc),yb=St({},Vc,{dataTransfer:0}),vb=Ln(yb),_b=St({},Aa,{relatedTarget:0}),ad=Ln(_b),xb=St({},Ji,{animationName:0,elapsedTime:0,pseudoElement:0}),Eb=Ln(xb),bb=St({},Ji,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Sb=Ln(bb),Cb=St({},Ji,{data:0}),t0=Ln(Cb),Tb={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ib={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},kb={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function wb(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=kb[t])?!!e[t]:!1}function Ap(){return wb}var Rb=St({},Aa,{key:function(t){if(t.key){var e=Tb[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=jl(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Ib[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ap,charCode:function(t){return t.type==="keypress"?jl(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?jl(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Ab=Ln(Rb),Pb=St({},Vc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),n0=Ln(Pb),Ob=St({},Aa,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ap}),Lb=Ln(Ob),Db=St({},Ji,{propertyName:0,elapsedTime:0,pseudoElement:0}),Mb=Ln(Db),Nb=St({},Vc,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),jb=Ln(Nb),Fb=[9,13,27,32],Pp=kr&&"CompositionEvent"in window,No=null;kr&&"documentMode"in document&&(No=document.documentMode);var $b=kr&&"TextEvent"in window&&!No,Zy=kr&&(!Pp||No&&8<No&&11>=No),r0=" ",s0=!1;function ev(t,e){switch(t){case"keyup":return Fb.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function tv(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var mi=!1;function Bb(t,e){switch(t){case"compositionend":return tv(e);case"keypress":return e.which!==32?null:(s0=!0,r0);case"textInput":return t=e.data,t===r0&&s0?null:t;default:return null}}function Ub(t,e){if(mi)return t==="compositionend"||!Pp&&ev(t,e)?(t=qy(),Nl=wp=Yr=null,mi=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Zy&&e.locale!=="ko"?null:e.data;default:return null}}var zb={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function i0(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!zb[t.type]:e==="textarea"}function nv(t,e,n,r){Ly(r),e=oc(e,"onChange"),0<e.length&&(n=new Rp("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var jo=null,ra=null;function Hb(t){pv(t,0)}function Yc(t){var e=_i(t);if(Iy(e))return t}function Wb(t,e){if(t==="change")return e}var rv=!1;if(kr){var ld;if(kr){var cd="oninput"in document;if(!cd){var o0=document.createElement("div");o0.setAttribute("oninput","return;"),cd=typeof o0.oninput=="function"}ld=cd}else ld=!1;rv=ld&&(!document.documentMode||9<document.documentMode)}function a0(){jo&&(jo.detachEvent("onpropertychange",sv),ra=jo=null)}function sv(t){if(t.propertyName==="value"&&Yc(ra)){var e=[];nv(e,ra,t,Sp(t)),jy(Hb,e)}}function Gb(t,e,n){t==="focusin"?(a0(),jo=e,ra=n,jo.attachEvent("onpropertychange",sv)):t==="focusout"&&a0()}function Vb(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Yc(ra)}function Yb(t,e){if(t==="click")return Yc(e)}function Kb(t,e){if(t==="input"||t==="change")return Yc(e)}function Xb(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var rr=typeof Object.is=="function"?Object.is:Xb;function sa(t,e){if(rr(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!Ud.call(e,s)||!rr(t[s],e[s]))return!1}return!0}function l0(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function c0(t,e){var n=l0(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=l0(n)}}function iv(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?iv(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function ov(){for(var t=window,e=Zl();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Zl(t.document)}return e}function Op(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function Qb(t){var e=ov(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&iv(n.ownerDocument.documentElement,n)){if(r!==null&&Op(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=c0(n,i);var o=c0(n,r);s&&o&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var Jb=kr&&"documentMode"in document&&11>=document.documentMode,yi=null,af=null,Fo=null,lf=!1;function u0(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;lf||yi==null||yi!==Zl(r)||(r=yi,"selectionStart"in r&&Op(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Fo&&sa(Fo,r)||(Fo=r,r=oc(af,"onSelect"),0<r.length&&(e=new Rp("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=yi)))}function yl(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var vi={animationend:yl("Animation","AnimationEnd"),animationiteration:yl("Animation","AnimationIteration"),animationstart:yl("Animation","AnimationStart"),transitionend:yl("Transition","TransitionEnd")},ud={},av={};kr&&(av=document.createElement("div").style,"AnimationEvent"in window||(delete vi.animationend.animation,delete vi.animationiteration.animation,delete vi.animationstart.animation),"TransitionEvent"in window||delete vi.transitionend.transition);function Kc(t){if(ud[t])return ud[t];if(!vi[t])return t;var e=vi[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in av)return ud[t]=e[n];return t}var lv=Kc("animationend"),cv=Kc("animationiteration"),uv=Kc("animationstart"),dv=Kc("transitionend"),fv=new Map,d0="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function hs(t,e){fv.set(t,e),Ys(e,[t])}for(var dd=0;dd<d0.length;dd++){var fd=d0[dd],qb=fd.toLowerCase(),Zb=fd[0].toUpperCase()+fd.slice(1);hs(qb,"on"+Zb)}hs(lv,"onAnimationEnd");hs(cv,"onAnimationIteration");hs(uv,"onAnimationStart");hs("dblclick","onDoubleClick");hs("focusin","onFocus");hs("focusout","onBlur");hs(dv,"onTransitionEnd");ji("onMouseEnter",["mouseout","mouseover"]);ji("onMouseLeave",["mouseout","mouseover"]);ji("onPointerEnter",["pointerout","pointerover"]);ji("onPointerLeave",["pointerout","pointerover"]);Ys("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ys("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ys("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ys("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ys("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ys("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Oo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),eS=new Set("cancel close invalid load scroll toggle".split(" ").concat(Oo));function f0(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,qE(r,e,void 0,t),t.currentTarget=null}function pv(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],c=a.instance,u=a.currentTarget;if(a=a.listener,c!==i&&s.isPropagationStopped())break e;f0(s,a,u),i=c}else for(o=0;o<r.length;o++){if(a=r[o],c=a.instance,u=a.currentTarget,a=a.listener,c!==i&&s.isPropagationStopped())break e;f0(s,a,u),i=c}}}if(tc)throw t=nf,tc=!1,nf=null,t}function pt(t,e){var n=e[pf];n===void 0&&(n=e[pf]=new Set);var r=t+"__bubble";n.has(r)||(hv(e,t,2,!1),n.add(r))}function pd(t,e,n){var r=0;e&&(r|=4),hv(n,t,r,e)}var vl="_reactListening"+Math.random().toString(36).slice(2);function ia(t){if(!t[vl]){t[vl]=!0,Ey.forEach(function(n){n!=="selectionchange"&&(eS.has(n)||pd(n,!1,t),pd(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[vl]||(e[vl]=!0,pd("selectionchange",!1,e))}}function hv(t,e,n,r){switch(Jy(e)){case 1:var s=hb;break;case 4:s=gb;break;default:s=kp}n=s.bind(null,e,n,t),s=void 0,!tf||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function hd(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===s||c.nodeType===8&&c.parentNode===s))return;o=o.return}for(;a!==null;){if(o=As(a),o===null)return;if(c=o.tag,c===5||c===6){r=i=o;continue e}a=a.parentNode}}r=r.return}jy(function(){var u=i,p=Sp(n),f=[];e:{var d=fv.get(t);if(d!==void 0){var y=Rp,S=t;switch(t){case"keypress":if(jl(n)===0)break e;case"keydown":case"keyup":y=Ab;break;case"focusin":S="focus",y=ad;break;case"focusout":S="blur",y=ad;break;case"beforeblur":case"afterblur":y=ad;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":y=e0;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":y=vb;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":y=Lb;break;case lv:case cv:case uv:y=Eb;break;case dv:y=Mb;break;case"scroll":y=mb;break;case"wheel":y=jb;break;case"copy":case"cut":case"paste":y=Sb;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":y=n0}var P=(e&4)!==0,g=!P&&t==="scroll",b=P?d!==null?d+"Capture":null:d;P=[];for(var x=u,E;x!==null;){E=x;var O=E.stateNode;if(E.tag===5&&O!==null&&(E=O,b!==null&&(O=Zo(x,b),O!=null&&P.push(oa(x,O,E)))),g)break;x=x.return}0<P.length&&(d=new y(d,S,null,n,p),f.push({event:d,listeners:P}))}}if(!(e&7)){e:{if(d=t==="mouseover"||t==="pointerover",y=t==="mouseout"||t==="pointerout",d&&n!==Zd&&(S=n.relatedTarget||n.fromElement)&&(As(S)||S[wr]))break e;if((y||d)&&(d=p.window===p?p:(d=p.ownerDocument)?d.defaultView||d.parentWindow:window,y?(S=n.relatedTarget||n.toElement,y=u,S=S?As(S):null,S!==null&&(g=Ks(S),S!==g||S.tag!==5&&S.tag!==6)&&(S=null)):(y=null,S=u),y!==S)){if(P=e0,O="onMouseLeave",b="onMouseEnter",x="mouse",(t==="pointerout"||t==="pointerover")&&(P=n0,O="onPointerLeave",b="onPointerEnter",x="pointer"),g=y==null?d:_i(y),E=S==null?d:_i(S),d=new P(O,x+"leave",y,n,p),d.target=g,d.relatedTarget=E,O=null,As(p)===u&&(P=new P(b,x+"enter",S,n,p),P.target=E,P.relatedTarget=g,O=P),g=O,y&&S)t:{for(P=y,b=S,x=0,E=P;E;E=ui(E))x++;for(E=0,O=b;O;O=ui(O))E++;for(;0<x-E;)P=ui(P),x--;for(;0<E-x;)b=ui(b),E--;for(;x--;){if(P===b||b!==null&&P===b.alternate)break t;P=ui(P),b=ui(b)}P=null}else P=null;y!==null&&p0(f,d,y,P,!1),S!==null&&g!==null&&p0(f,g,S,P,!0)}}e:{if(d=u?_i(u):window,y=d.nodeName&&d.nodeName.toLowerCase(),y==="select"||y==="input"&&d.type==="file")var Q=Wb;else if(i0(d))if(rv)Q=Kb;else{Q=Vb;var F=Gb}else(y=d.nodeName)&&y.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(Q=Yb);if(Q&&(Q=Q(t,u))){nv(f,Q,n,p);break e}F&&F(t,d,u),t==="focusout"&&(F=d._wrapperState)&&F.controlled&&d.type==="number"&&Kd(d,"number",d.value)}switch(F=u?_i(u):window,t){case"focusin":(i0(F)||F.contentEditable==="true")&&(yi=F,af=u,Fo=null);break;case"focusout":Fo=af=yi=null;break;case"mousedown":lf=!0;break;case"contextmenu":case"mouseup":case"dragend":lf=!1,u0(f,n,p);break;case"selectionchange":if(Jb)break;case"keydown":case"keyup":u0(f,n,p)}var se;if(Pp)e:{switch(t){case"compositionstart":var J="onCompositionStart";break e;case"compositionend":J="onCompositionEnd";break e;case"compositionupdate":J="onCompositionUpdate";break e}J=void 0}else mi?ev(t,n)&&(J="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(J="onCompositionStart");J&&(Zy&&n.locale!=="ko"&&(mi||J!=="onCompositionStart"?J==="onCompositionEnd"&&mi&&(se=qy()):(Yr=p,wp="value"in Yr?Yr.value:Yr.textContent,mi=!0)),F=oc(u,J),0<F.length&&(J=new t0(J,t,null,n,p),f.push({event:J,listeners:F}),se?J.data=se:(se=tv(n),se!==null&&(J.data=se)))),(se=$b?Bb(t,n):Ub(t,n))&&(u=oc(u,"onBeforeInput"),0<u.length&&(p=new t0("onBeforeInput","beforeinput",null,n,p),f.push({event:p,listeners:u}),p.data=se))}pv(f,e)})}function oa(t,e,n){return{instance:t,listener:e,currentTarget:n}}function oc(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=Zo(t,n),i!=null&&r.unshift(oa(t,i,s)),i=Zo(t,e),i!=null&&r.push(oa(t,i,s))),t=t.return}return r}function ui(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function p0(t,e,n,r,s){for(var i=e._reactName,o=[];n!==null&&n!==r;){var a=n,c=a.alternate,u=a.stateNode;if(c!==null&&c===r)break;a.tag===5&&u!==null&&(a=u,s?(c=Zo(n,i),c!=null&&o.unshift(oa(n,c,a))):s||(c=Zo(n,i),c!=null&&o.push(oa(n,c,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var tS=/\r\n?/g,nS=/\u0000|\uFFFD/g;function h0(t){return(typeof t=="string"?t:""+t).replace(tS,`
`).replace(nS,"")}function _l(t,e,n){if(e=h0(e),h0(t)!==e&&n)throw Error(ie(425))}function ac(){}var cf=null,uf=null;function df(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var ff=typeof setTimeout=="function"?setTimeout:void 0,rS=typeof clearTimeout=="function"?clearTimeout:void 0,g0=typeof Promise=="function"?Promise:void 0,sS=typeof queueMicrotask=="function"?queueMicrotask:typeof g0<"u"?function(t){return g0.resolve(null).then(t).catch(iS)}:ff;function iS(t){setTimeout(function(){throw t})}function gd(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),na(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);na(e)}function Zr(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function m0(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var qi=Math.random().toString(36).slice(2),ur="__reactFiber$"+qi,aa="__reactProps$"+qi,wr="__reactContainer$"+qi,pf="__reactEvents$"+qi,oS="__reactListeners$"+qi,aS="__reactHandles$"+qi;function As(t){var e=t[ur];if(e)return e;for(var n=t.parentNode;n;){if(e=n[wr]||n[ur]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=m0(t);t!==null;){if(n=t[ur])return n;t=m0(t)}return e}t=n,n=t.parentNode}return null}function Pa(t){return t=t[ur]||t[wr],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function _i(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(ie(33))}function Xc(t){return t[aa]||null}var hf=[],xi=-1;function gs(t){return{current:t}}function gt(t){0>xi||(t.current=hf[xi],hf[xi]=null,xi--)}function dt(t,e){xi++,hf[xi]=t.current,t.current=e}var us={},tn=gs(us),xn=gs(!1),$s=us;function Fi(t,e){var n=t.type.contextTypes;if(!n)return us;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function En(t){return t=t.childContextTypes,t!=null}function lc(){gt(xn),gt(tn)}function y0(t,e,n){if(tn.current!==us)throw Error(ie(168));dt(tn,e),dt(xn,n)}function gv(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(ie(108,GE(t)||"Unknown",s));return St({},n,r)}function cc(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||us,$s=tn.current,dt(tn,t),dt(xn,xn.current),!0}function v0(t,e,n){var r=t.stateNode;if(!r)throw Error(ie(169));n?(t=gv(t,e,$s),r.__reactInternalMemoizedMergedChildContext=t,gt(xn),gt(tn),dt(tn,t)):gt(xn),dt(xn,n)}var _r=null,Qc=!1,md=!1;function mv(t){_r===null?_r=[t]:_r.push(t)}function lS(t){Qc=!0,mv(t)}function ms(){if(!md&&_r!==null){md=!0;var t=0,e=rt;try{var n=_r;for(rt=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}_r=null,Qc=!1}catch(s){throw _r!==null&&(_r=_r.slice(t+1)),Uy(Cp,ms),s}finally{rt=e,md=!1}}return null}var Ei=[],bi=0,uc=null,dc=0,Mn=[],Nn=0,Bs=null,br=1,Sr="";function Ts(t,e){Ei[bi++]=dc,Ei[bi++]=uc,uc=t,dc=e}function yv(t,e,n){Mn[Nn++]=br,Mn[Nn++]=Sr,Mn[Nn++]=Bs,Bs=t;var r=br;t=Sr;var s=32-er(r)-1;r&=~(1<<s),n+=1;var i=32-er(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,br=1<<32-er(e)+s|n<<s|r,Sr=i+t}else br=1<<i|n<<s|r,Sr=t}function Lp(t){t.return!==null&&(Ts(t,1),yv(t,1,0))}function Dp(t){for(;t===uc;)uc=Ei[--bi],Ei[bi]=null,dc=Ei[--bi],Ei[bi]=null;for(;t===Bs;)Bs=Mn[--Nn],Mn[Nn]=null,Sr=Mn[--Nn],Mn[Nn]=null,br=Mn[--Nn],Mn[Nn]=null}var An=null,Rn=null,_t=!1,Jn=null;function vv(t,e){var n=jn(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function _0(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,An=t,Rn=Zr(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,An=t,Rn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Bs!==null?{id:br,overflow:Sr}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=jn(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,An=t,Rn=null,!0):!1;default:return!1}}function gf(t){return(t.mode&1)!==0&&(t.flags&128)===0}function mf(t){if(_t){var e=Rn;if(e){var n=e;if(!_0(t,e)){if(gf(t))throw Error(ie(418));e=Zr(n.nextSibling);var r=An;e&&_0(t,e)?vv(r,n):(t.flags=t.flags&-4097|2,_t=!1,An=t)}}else{if(gf(t))throw Error(ie(418));t.flags=t.flags&-4097|2,_t=!1,An=t}}}function x0(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;An=t}function xl(t){if(t!==An)return!1;if(!_t)return x0(t),_t=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!df(t.type,t.memoizedProps)),e&&(e=Rn)){if(gf(t))throw _v(),Error(ie(418));for(;e;)vv(t,e),e=Zr(e.nextSibling)}if(x0(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(ie(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Rn=Zr(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Rn=null}}else Rn=An?Zr(t.stateNode.nextSibling):null;return!0}function _v(){for(var t=Rn;t;)t=Zr(t.nextSibling)}function $i(){Rn=An=null,_t=!1}function Mp(t){Jn===null?Jn=[t]:Jn.push(t)}var cS=Lr.ReactCurrentBatchConfig;function Eo(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(ie(309));var r=n.stateNode}if(!r)throw Error(ie(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=s.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof t!="string")throw Error(ie(284));if(!n._owner)throw Error(ie(290,t))}return t}function El(t,e){throw t=Object.prototype.toString.call(e),Error(ie(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function E0(t){var e=t._init;return e(t._payload)}function xv(t){function e(b,x){if(t){var E=b.deletions;E===null?(b.deletions=[x],b.flags|=16):E.push(x)}}function n(b,x){if(!t)return null;for(;x!==null;)e(b,x),x=x.sibling;return null}function r(b,x){for(b=new Map;x!==null;)x.key!==null?b.set(x.key,x):b.set(x.index,x),x=x.sibling;return b}function s(b,x){return b=rs(b,x),b.index=0,b.sibling=null,b}function i(b,x,E){return b.index=E,t?(E=b.alternate,E!==null?(E=E.index,E<x?(b.flags|=2,x):E):(b.flags|=2,x)):(b.flags|=1048576,x)}function o(b){return t&&b.alternate===null&&(b.flags|=2),b}function a(b,x,E,O){return x===null||x.tag!==6?(x=Sd(E,b.mode,O),x.return=b,x):(x=s(x,E),x.return=b,x)}function c(b,x,E,O){var Q=E.type;return Q===gi?p(b,x,E.props.children,O,E.key):x!==null&&(x.elementType===Q||typeof Q=="object"&&Q!==null&&Q.$$typeof===Hr&&E0(Q)===x.type)?(O=s(x,E.props),O.ref=Eo(b,x,E),O.return=b,O):(O=Wl(E.type,E.key,E.props,null,b.mode,O),O.ref=Eo(b,x,E),O.return=b,O)}function u(b,x,E,O){return x===null||x.tag!==4||x.stateNode.containerInfo!==E.containerInfo||x.stateNode.implementation!==E.implementation?(x=Cd(E,b.mode,O),x.return=b,x):(x=s(x,E.children||[]),x.return=b,x)}function p(b,x,E,O,Q){return x===null||x.tag!==7?(x=Fs(E,b.mode,O,Q),x.return=b,x):(x=s(x,E),x.return=b,x)}function f(b,x,E){if(typeof x=="string"&&x!==""||typeof x=="number")return x=Sd(""+x,b.mode,E),x.return=b,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case ul:return E=Wl(x.type,x.key,x.props,null,b.mode,E),E.ref=Eo(b,null,x),E.return=b,E;case hi:return x=Cd(x,b.mode,E),x.return=b,x;case Hr:var O=x._init;return f(b,O(x._payload),E)}if(Ao(x)||mo(x))return x=Fs(x,b.mode,E,null),x.return=b,x;El(b,x)}return null}function d(b,x,E,O){var Q=x!==null?x.key:null;if(typeof E=="string"&&E!==""||typeof E=="number")return Q!==null?null:a(b,x,""+E,O);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case ul:return E.key===Q?c(b,x,E,O):null;case hi:return E.key===Q?u(b,x,E,O):null;case Hr:return Q=E._init,d(b,x,Q(E._payload),O)}if(Ao(E)||mo(E))return Q!==null?null:p(b,x,E,O,null);El(b,E)}return null}function y(b,x,E,O,Q){if(typeof O=="string"&&O!==""||typeof O=="number")return b=b.get(E)||null,a(x,b,""+O,Q);if(typeof O=="object"&&O!==null){switch(O.$$typeof){case ul:return b=b.get(O.key===null?E:O.key)||null,c(x,b,O,Q);case hi:return b=b.get(O.key===null?E:O.key)||null,u(x,b,O,Q);case Hr:var F=O._init;return y(b,x,E,F(O._payload),Q)}if(Ao(O)||mo(O))return b=b.get(E)||null,p(x,b,O,Q,null);El(x,O)}return null}function S(b,x,E,O){for(var Q=null,F=null,se=x,J=x=0,me=null;se!==null&&J<E.length;J++){se.index>J?(me=se,se=null):me=se.sibling;var A=d(b,se,E[J],O);if(A===null){se===null&&(se=me);break}t&&se&&A.alternate===null&&e(b,se),x=i(A,x,J),F===null?Q=A:F.sibling=A,F=A,se=me}if(J===E.length)return n(b,se),_t&&Ts(b,J),Q;if(se===null){for(;J<E.length;J++)se=f(b,E[J],O),se!==null&&(x=i(se,x,J),F===null?Q=se:F.sibling=se,F=se);return _t&&Ts(b,J),Q}for(se=r(b,se);J<E.length;J++)me=y(se,b,J,E[J],O),me!==null&&(t&&me.alternate!==null&&se.delete(me.key===null?J:me.key),x=i(me,x,J),F===null?Q=me:F.sibling=me,F=me);return t&&se.forEach(function(C){return e(b,C)}),_t&&Ts(b,J),Q}function P(b,x,E,O){var Q=mo(E);if(typeof Q!="function")throw Error(ie(150));if(E=Q.call(E),E==null)throw Error(ie(151));for(var F=Q=null,se=x,J=x=0,me=null,A=E.next();se!==null&&!A.done;J++,A=E.next()){se.index>J?(me=se,se=null):me=se.sibling;var C=d(b,se,A.value,O);if(C===null){se===null&&(se=me);break}t&&se&&C.alternate===null&&e(b,se),x=i(C,x,J),F===null?Q=C:F.sibling=C,F=C,se=me}if(A.done)return n(b,se),_t&&Ts(b,J),Q;if(se===null){for(;!A.done;J++,A=E.next())A=f(b,A.value,O),A!==null&&(x=i(A,x,J),F===null?Q=A:F.sibling=A,F=A);return _t&&Ts(b,J),Q}for(se=r(b,se);!A.done;J++,A=E.next())A=y(se,b,J,A.value,O),A!==null&&(t&&A.alternate!==null&&se.delete(A.key===null?J:A.key),x=i(A,x,J),F===null?Q=A:F.sibling=A,F=A);return t&&se.forEach(function(k){return e(b,k)}),_t&&Ts(b,J),Q}function g(b,x,E,O){if(typeof E=="object"&&E!==null&&E.type===gi&&E.key===null&&(E=E.props.children),typeof E=="object"&&E!==null){switch(E.$$typeof){case ul:e:{for(var Q=E.key,F=x;F!==null;){if(F.key===Q){if(Q=E.type,Q===gi){if(F.tag===7){n(b,F.sibling),x=s(F,E.props.children),x.return=b,b=x;break e}}else if(F.elementType===Q||typeof Q=="object"&&Q!==null&&Q.$$typeof===Hr&&E0(Q)===F.type){n(b,F.sibling),x=s(F,E.props),x.ref=Eo(b,F,E),x.return=b,b=x;break e}n(b,F);break}else e(b,F);F=F.sibling}E.type===gi?(x=Fs(E.props.children,b.mode,O,E.key),x.return=b,b=x):(O=Wl(E.type,E.key,E.props,null,b.mode,O),O.ref=Eo(b,x,E),O.return=b,b=O)}return o(b);case hi:e:{for(F=E.key;x!==null;){if(x.key===F)if(x.tag===4&&x.stateNode.containerInfo===E.containerInfo&&x.stateNode.implementation===E.implementation){n(b,x.sibling),x=s(x,E.children||[]),x.return=b,b=x;break e}else{n(b,x);break}else e(b,x);x=x.sibling}x=Cd(E,b.mode,O),x.return=b,b=x}return o(b);case Hr:return F=E._init,g(b,x,F(E._payload),O)}if(Ao(E))return S(b,x,E,O);if(mo(E))return P(b,x,E,O);El(b,E)}return typeof E=="string"&&E!==""||typeof E=="number"?(E=""+E,x!==null&&x.tag===6?(n(b,x.sibling),x=s(x,E),x.return=b,b=x):(n(b,x),x=Sd(E,b.mode,O),x.return=b,b=x),o(b)):n(b,x)}return g}var Bi=xv(!0),Ev=xv(!1),fc=gs(null),pc=null,Si=null,Np=null;function jp(){Np=Si=pc=null}function Fp(t){var e=fc.current;gt(fc),t._currentValue=e}function yf(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function Pi(t,e){pc=t,Np=Si=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(vn=!0),t.firstContext=null)}function Bn(t){var e=t._currentValue;if(Np!==t)if(t={context:t,memoizedValue:e,next:null},Si===null){if(pc===null)throw Error(ie(308));Si=t,pc.dependencies={lanes:0,firstContext:t}}else Si=Si.next=t;return e}var Ps=null;function $p(t){Ps===null?Ps=[t]:Ps.push(t)}function bv(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,$p(e)):(n.next=s.next,s.next=n),e.interleaved=n,Rr(t,r)}function Rr(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Wr=!1;function Bp(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Sv(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Tr(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function es(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,Ze&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,Rr(t,n)}return s=r.interleaved,s===null?(e.next=e,$p(r)):(e.next=s.next,s.next=e),r.interleaved=e,Rr(t,n)}function Fl(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Tp(t,n)}}function b0(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=o:i=i.next=o,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function hc(t,e,n,r){var s=t.updateQueue;Wr=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var c=a,u=c.next;c.next=null,o===null?i=u:o.next=u,o=c;var p=t.alternate;p!==null&&(p=p.updateQueue,a=p.lastBaseUpdate,a!==o&&(a===null?p.firstBaseUpdate=u:a.next=u,p.lastBaseUpdate=c))}if(i!==null){var f=s.baseState;o=0,p=u=c=null,a=i;do{var d=a.lane,y=a.eventTime;if((r&d)===d){p!==null&&(p=p.next={eventTime:y,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var S=t,P=a;switch(d=e,y=n,P.tag){case 1:if(S=P.payload,typeof S=="function"){f=S.call(y,f,d);break e}f=S;break e;case 3:S.flags=S.flags&-65537|128;case 0:if(S=P.payload,d=typeof S=="function"?S.call(y,f,d):S,d==null)break e;f=St({},f,d);break e;case 2:Wr=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,d=s.effects,d===null?s.effects=[a]:d.push(a))}else y={eventTime:y,lane:d,tag:a.tag,payload:a.payload,callback:a.callback,next:null},p===null?(u=p=y,c=f):p=p.next=y,o|=d;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;d=a,a=d.next,d.next=null,s.lastBaseUpdate=d,s.shared.pending=null}}while(!0);if(p===null&&(c=f),s.baseState=c,s.firstBaseUpdate=u,s.lastBaseUpdate=p,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);zs|=o,t.lanes=o,t.memoizedState=f}}function S0(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(ie(191,s));s.call(r)}}}var Oa={},fr=gs(Oa),la=gs(Oa),ca=gs(Oa);function Os(t){if(t===Oa)throw Error(ie(174));return t}function Up(t,e){switch(dt(ca,e),dt(la,t),dt(fr,Oa),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Qd(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Qd(e,t)}gt(fr),dt(fr,e)}function Ui(){gt(fr),gt(la),gt(ca)}function Cv(t){Os(ca.current);var e=Os(fr.current),n=Qd(e,t.type);e!==n&&(dt(la,t),dt(fr,n))}function zp(t){la.current===t&&(gt(fr),gt(la))}var xt=gs(0);function gc(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var yd=[];function Hp(){for(var t=0;t<yd.length;t++)yd[t]._workInProgressVersionPrimary=null;yd.length=0}var $l=Lr.ReactCurrentDispatcher,vd=Lr.ReactCurrentBatchConfig,Us=0,bt=null,Lt=null,jt=null,mc=!1,$o=!1,ua=0,uS=0;function Jt(){throw Error(ie(321))}function Wp(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!rr(t[n],e[n]))return!1;return!0}function Gp(t,e,n,r,s,i){if(Us=i,bt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,$l.current=t===null||t.memoizedState===null?hS:gS,t=n(r,s),$o){i=0;do{if($o=!1,ua=0,25<=i)throw Error(ie(301));i+=1,jt=Lt=null,e.updateQueue=null,$l.current=mS,t=n(r,s)}while($o)}if($l.current=yc,e=Lt!==null&&Lt.next!==null,Us=0,jt=Lt=bt=null,mc=!1,e)throw Error(ie(300));return t}function Vp(){var t=ua!==0;return ua=0,t}function cr(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return jt===null?bt.memoizedState=jt=t:jt=jt.next=t,jt}function Un(){if(Lt===null){var t=bt.alternate;t=t!==null?t.memoizedState:null}else t=Lt.next;var e=jt===null?bt.memoizedState:jt.next;if(e!==null)jt=e,Lt=t;else{if(t===null)throw Error(ie(310));Lt=t,t={memoizedState:Lt.memoizedState,baseState:Lt.baseState,baseQueue:Lt.baseQueue,queue:Lt.queue,next:null},jt===null?bt.memoizedState=jt=t:jt=jt.next=t}return jt}function da(t,e){return typeof e=="function"?e(t):e}function _d(t){var e=Un(),n=e.queue;if(n===null)throw Error(ie(311));n.lastRenderedReducer=t;var r=Lt,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var a=o=null,c=null,u=i;do{var p=u.lane;if((Us&p)===p)c!==null&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:t(r,u.action);else{var f={lane:p,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};c===null?(a=c=f,o=r):c=c.next=f,bt.lanes|=p,zs|=p}u=u.next}while(u!==null&&u!==i);c===null?o=r:c.next=a,rr(r,e.memoizedState)||(vn=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=c,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,bt.lanes|=i,zs|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function xd(t){var e=Un(),n=e.queue;if(n===null)throw Error(ie(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var o=s=s.next;do i=t(i,o.action),o=o.next;while(o!==s);rr(i,e.memoizedState)||(vn=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function Tv(){}function Iv(t,e){var n=bt,r=Un(),s=e(),i=!rr(r.memoizedState,s);if(i&&(r.memoizedState=s,vn=!0),r=r.queue,Yp(Rv.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||jt!==null&&jt.memoizedState.tag&1){if(n.flags|=2048,fa(9,wv.bind(null,n,r,s,e),void 0,null),$t===null)throw Error(ie(349));Us&30||kv(n,e,s)}return s}function kv(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=bt.updateQueue,e===null?(e={lastEffect:null,stores:null},bt.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function wv(t,e,n,r){e.value=n,e.getSnapshot=r,Av(e)&&Pv(t)}function Rv(t,e,n){return n(function(){Av(e)&&Pv(t)})}function Av(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!rr(t,n)}catch{return!0}}function Pv(t){var e=Rr(t,1);e!==null&&tr(e,t,1,-1)}function C0(t){var e=cr();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:da,lastRenderedState:t},e.queue=t,t=t.dispatch=pS.bind(null,bt,t),[e.memoizedState,t]}function fa(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=bt.updateQueue,e===null?(e={lastEffect:null,stores:null},bt.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function Ov(){return Un().memoizedState}function Bl(t,e,n,r){var s=cr();bt.flags|=t,s.memoizedState=fa(1|e,n,void 0,r===void 0?null:r)}function Jc(t,e,n,r){var s=Un();r=r===void 0?null:r;var i=void 0;if(Lt!==null){var o=Lt.memoizedState;if(i=o.destroy,r!==null&&Wp(r,o.deps)){s.memoizedState=fa(e,n,i,r);return}}bt.flags|=t,s.memoizedState=fa(1|e,n,i,r)}function T0(t,e){return Bl(8390656,8,t,e)}function Yp(t,e){return Jc(2048,8,t,e)}function Lv(t,e){return Jc(4,2,t,e)}function Dv(t,e){return Jc(4,4,t,e)}function Mv(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Nv(t,e,n){return n=n!=null?n.concat([t]):null,Jc(4,4,Mv.bind(null,e,t),n)}function Kp(){}function jv(t,e){var n=Un();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Wp(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function Fv(t,e){var n=Un();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Wp(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function $v(t,e,n){return Us&21?(rr(n,e)||(n=Wy(),bt.lanes|=n,zs|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,vn=!0),t.memoizedState=n)}function dS(t,e){var n=rt;rt=n!==0&&4>n?n:4,t(!0);var r=vd.transition;vd.transition={};try{t(!1),e()}finally{rt=n,vd.transition=r}}function Bv(){return Un().memoizedState}function fS(t,e,n){var r=ns(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Uv(t))zv(e,n);else if(n=bv(t,e,n,r),n!==null){var s=un();tr(n,t,r,s),Hv(n,e,r)}}function pS(t,e,n){var r=ns(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Uv(t))zv(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,n);if(s.hasEagerState=!0,s.eagerState=a,rr(a,o)){var c=e.interleaved;c===null?(s.next=s,$p(e)):(s.next=c.next,c.next=s),e.interleaved=s;return}}catch{}finally{}n=bv(t,e,s,r),n!==null&&(s=un(),tr(n,t,r,s),Hv(n,e,r))}}function Uv(t){var e=t.alternate;return t===bt||e!==null&&e===bt}function zv(t,e){$o=mc=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function Hv(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Tp(t,n)}}var yc={readContext:Bn,useCallback:Jt,useContext:Jt,useEffect:Jt,useImperativeHandle:Jt,useInsertionEffect:Jt,useLayoutEffect:Jt,useMemo:Jt,useReducer:Jt,useRef:Jt,useState:Jt,useDebugValue:Jt,useDeferredValue:Jt,useTransition:Jt,useMutableSource:Jt,useSyncExternalStore:Jt,useId:Jt,unstable_isNewReconciler:!1},hS={readContext:Bn,useCallback:function(t,e){return cr().memoizedState=[t,e===void 0?null:e],t},useContext:Bn,useEffect:T0,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Bl(4194308,4,Mv.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Bl(4194308,4,t,e)},useInsertionEffect:function(t,e){return Bl(4,2,t,e)},useMemo:function(t,e){var n=cr();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=cr();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=fS.bind(null,bt,t),[r.memoizedState,t]},useRef:function(t){var e=cr();return t={current:t},e.memoizedState=t},useState:C0,useDebugValue:Kp,useDeferredValue:function(t){return cr().memoizedState=t},useTransition:function(){var t=C0(!1),e=t[0];return t=dS.bind(null,t[1]),cr().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=bt,s=cr();if(_t){if(n===void 0)throw Error(ie(407));n=n()}else{if(n=e(),$t===null)throw Error(ie(349));Us&30||kv(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,T0(Rv.bind(null,r,i,t),[t]),r.flags|=2048,fa(9,wv.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=cr(),e=$t.identifierPrefix;if(_t){var n=Sr,r=br;n=(r&~(1<<32-er(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=ua++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=uS++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},gS={readContext:Bn,useCallback:jv,useContext:Bn,useEffect:Yp,useImperativeHandle:Nv,useInsertionEffect:Lv,useLayoutEffect:Dv,useMemo:Fv,useReducer:_d,useRef:Ov,useState:function(){return _d(da)},useDebugValue:Kp,useDeferredValue:function(t){var e=Un();return $v(e,Lt.memoizedState,t)},useTransition:function(){var t=_d(da)[0],e=Un().memoizedState;return[t,e]},useMutableSource:Tv,useSyncExternalStore:Iv,useId:Bv,unstable_isNewReconciler:!1},mS={readContext:Bn,useCallback:jv,useContext:Bn,useEffect:Yp,useImperativeHandle:Nv,useInsertionEffect:Lv,useLayoutEffect:Dv,useMemo:Fv,useReducer:xd,useRef:Ov,useState:function(){return xd(da)},useDebugValue:Kp,useDeferredValue:function(t){var e=Un();return Lt===null?e.memoizedState=t:$v(e,Lt.memoizedState,t)},useTransition:function(){var t=xd(da)[0],e=Un().memoizedState;return[t,e]},useMutableSource:Tv,useSyncExternalStore:Iv,useId:Bv,unstable_isNewReconciler:!1};function Xn(t,e){if(t&&t.defaultProps){e=St({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function vf(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:St({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var qc={isMounted:function(t){return(t=t._reactInternals)?Ks(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=un(),s=ns(t),i=Tr(r,s);i.payload=e,n!=null&&(i.callback=n),e=es(t,i,s),e!==null&&(tr(e,t,s,r),Fl(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=un(),s=ns(t),i=Tr(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=es(t,i,s),e!==null&&(tr(e,t,s,r),Fl(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=un(),r=ns(t),s=Tr(n,r);s.tag=2,e!=null&&(s.callback=e),e=es(t,s,r),e!==null&&(tr(e,t,r,n),Fl(e,t,r))}};function I0(t,e,n,r,s,i,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!sa(n,r)||!sa(s,i):!0}function Wv(t,e,n){var r=!1,s=us,i=e.contextType;return typeof i=="object"&&i!==null?i=Bn(i):(s=En(e)?$s:tn.current,r=e.contextTypes,i=(r=r!=null)?Fi(t,s):us),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=qc,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function k0(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&qc.enqueueReplaceState(e,e.state,null)}function _f(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},Bp(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=Bn(i):(i=En(e)?$s:tn.current,s.context=Fi(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(vf(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&qc.enqueueReplaceState(s,s.state,null),hc(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function zi(t,e){try{var n="",r=e;do n+=WE(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function Ed(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function xf(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var yS=typeof WeakMap=="function"?WeakMap:Map;function Gv(t,e,n){n=Tr(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){_c||(_c=!0,Af=r),xf(t,e)},n}function Vv(t,e,n){n=Tr(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){xf(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){xf(t,e),typeof r!="function"&&(ts===null?ts=new Set([this]):ts.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function w0(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new yS;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=PS.bind(null,t,e,n),e.then(t,t))}function R0(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function A0(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Tr(-1,1),e.tag=2,es(n,e,1))),n.lanes|=1),t)}var vS=Lr.ReactCurrentOwner,vn=!1;function ln(t,e,n,r){e.child=t===null?Ev(e,null,n,r):Bi(e,t.child,n,r)}function P0(t,e,n,r,s){n=n.render;var i=e.ref;return Pi(e,s),r=Gp(t,e,n,r,i,s),n=Vp(),t!==null&&!vn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Ar(t,e,s)):(_t&&n&&Lp(e),e.flags|=1,ln(t,e,r,s),e.child)}function O0(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!nh(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,Yv(t,e,i,r,s)):(t=Wl(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var o=i.memoizedProps;if(n=n.compare,n=n!==null?n:sa,n(o,r)&&t.ref===e.ref)return Ar(t,e,s)}return e.flags|=1,t=rs(i,r),t.ref=e.ref,t.return=e,e.child=t}function Yv(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(sa(i,r)&&t.ref===e.ref)if(vn=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(vn=!0);else return e.lanes=t.lanes,Ar(t,e,s)}return Ef(t,e,n,r,s)}function Kv(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},dt(Ti,wn),wn|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,dt(Ti,wn),wn|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,dt(Ti,wn),wn|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,dt(Ti,wn),wn|=r;return ln(t,e,s,n),e.child}function Xv(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Ef(t,e,n,r,s){var i=En(n)?$s:tn.current;return i=Fi(e,i),Pi(e,s),n=Gp(t,e,n,r,i,s),r=Vp(),t!==null&&!vn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Ar(t,e,s)):(_t&&r&&Lp(e),e.flags|=1,ln(t,e,n,s),e.child)}function L0(t,e,n,r,s){if(En(n)){var i=!0;cc(e)}else i=!1;if(Pi(e,s),e.stateNode===null)Ul(t,e),Wv(e,n,r),_f(e,n,r,s),r=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var c=o.context,u=n.contextType;typeof u=="object"&&u!==null?u=Bn(u):(u=En(n)?$s:tn.current,u=Fi(e,u));var p=n.getDerivedStateFromProps,f=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||c!==u)&&k0(e,o,r,u),Wr=!1;var d=e.memoizedState;o.state=d,hc(e,r,o,s),c=e.memoizedState,a!==r||d!==c||xn.current||Wr?(typeof p=="function"&&(vf(e,n,p,r),c=e.memoizedState),(a=Wr||I0(e,n,a,r,d,c,u))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),o.props=r,o.state=c,o.context=u,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,Sv(t,e),a=e.memoizedProps,u=e.type===e.elementType?a:Xn(e.type,a),o.props=u,f=e.pendingProps,d=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=Bn(c):(c=En(n)?$s:tn.current,c=Fi(e,c));var y=n.getDerivedStateFromProps;(p=typeof y=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==f||d!==c)&&k0(e,o,r,c),Wr=!1,d=e.memoizedState,o.state=d,hc(e,r,o,s);var S=e.memoizedState;a!==f||d!==S||xn.current||Wr?(typeof y=="function"&&(vf(e,n,y,r),S=e.memoizedState),(u=Wr||I0(e,n,u,r,d,S,c)||!1)?(p||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,S,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,S,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=S),o.props=r,o.state=S,o.context=c,r=u):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),r=!1)}return bf(t,e,n,r,i,s)}function bf(t,e,n,r,s,i){Xv(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&v0(e,n,!1),Ar(t,e,i);r=e.stateNode,vS.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=Bi(e,t.child,null,i),e.child=Bi(e,null,a,i)):ln(t,e,a,i),e.memoizedState=r.state,s&&v0(e,n,!0),e.child}function Qv(t){var e=t.stateNode;e.pendingContext?y0(t,e.pendingContext,e.pendingContext!==e.context):e.context&&y0(t,e.context,!1),Up(t,e.containerInfo)}function D0(t,e,n,r,s){return $i(),Mp(s),e.flags|=256,ln(t,e,n,r),e.child}var Sf={dehydrated:null,treeContext:null,retryLane:0};function Cf(t){return{baseLanes:t,cachePool:null,transitions:null}}function Jv(t,e,n){var r=e.pendingProps,s=xt.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(s&2)!==0),a?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),dt(xt,s&1),t===null)return mf(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=tu(o,r,0,null),t=Fs(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=Cf(n),e.memoizedState=Sf,t):Xp(e,o));if(s=t.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return _S(t,e,o,r,a,s,n);if(i){i=r.fallback,o=e.mode,s=t.child,a=s.sibling;var c={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=rs(s,c),r.subtreeFlags=s.subtreeFlags&14680064),a!==null?i=rs(a,i):(i=Fs(i,o,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=t.child.memoizedState,o=o===null?Cf(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=t.childLanes&~n,e.memoizedState=Sf,r}return i=t.child,t=i.sibling,r=rs(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function Xp(t,e){return e=tu({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function bl(t,e,n,r){return r!==null&&Mp(r),Bi(e,t.child,null,n),t=Xp(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function _S(t,e,n,r,s,i,o){if(n)return e.flags&256?(e.flags&=-257,r=Ed(Error(ie(422))),bl(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=tu({mode:"visible",children:r.children},s,0,null),i=Fs(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&Bi(e,t.child,null,o),e.child.memoizedState=Cf(o),e.memoizedState=Sf,i);if(!(e.mode&1))return bl(t,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var a=r.dgst;return r=a,i=Error(ie(419)),r=Ed(i,r,void 0),bl(t,e,o,r)}if(a=(o&t.childLanes)!==0,vn||a){if(r=$t,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,Rr(t,s),tr(r,t,s,-1))}return th(),r=Ed(Error(ie(421))),bl(t,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=OS.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,Rn=Zr(s.nextSibling),An=e,_t=!0,Jn=null,t!==null&&(Mn[Nn++]=br,Mn[Nn++]=Sr,Mn[Nn++]=Bs,br=t.id,Sr=t.overflow,Bs=e),e=Xp(e,r.children),e.flags|=4096,e)}function M0(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),yf(t.return,e,n)}function bd(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function qv(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(ln(t,e,r.children,n),r=xt.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&M0(t,n,e);else if(t.tag===19)M0(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(dt(xt,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&gc(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),bd(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&gc(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}bd(e,!0,n,null,i);break;case"together":bd(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Ul(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Ar(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),zs|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(ie(153));if(e.child!==null){for(t=e.child,n=rs(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=rs(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function xS(t,e,n){switch(e.tag){case 3:Qv(e),$i();break;case 5:Cv(e);break;case 1:En(e.type)&&cc(e);break;case 4:Up(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;dt(fc,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(dt(xt,xt.current&1),e.flags|=128,null):n&e.child.childLanes?Jv(t,e,n):(dt(xt,xt.current&1),t=Ar(t,e,n),t!==null?t.sibling:null);dt(xt,xt.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return qv(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),dt(xt,xt.current),r)break;return null;case 22:case 23:return e.lanes=0,Kv(t,e,n)}return Ar(t,e,n)}var Zv,Tf,e_,t_;Zv=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Tf=function(){};e_=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,Os(fr.current);var i=null;switch(n){case"input":s=Vd(t,s),r=Vd(t,r),i=[];break;case"select":s=St({},s,{value:void 0}),r=St({},r,{value:void 0}),i=[];break;case"textarea":s=Xd(t,s),r=Xd(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=ac)}Jd(n,r);var o;n=null;for(u in s)if(!r.hasOwnProperty(u)&&s.hasOwnProperty(u)&&s[u]!=null)if(u==="style"){var a=s[u];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Jo.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in r){var c=r[u];if(a=s!=null?s[u]:void 0,r.hasOwnProperty(u)&&c!==a&&(c!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&a[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(i||(i=[]),i.push(u,n)),n=c;else u==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,a=a?a.__html:void 0,c!=null&&a!==c&&(i=i||[]).push(u,c)):u==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(u,""+c):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Jo.hasOwnProperty(u)?(c!=null&&u==="onScroll"&&pt("scroll",t),i||a===c||(i=[])):(i=i||[]).push(u,c))}n&&(i=i||[]).push("style",n);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};t_=function(t,e,n,r){n!==r&&(e.flags|=4)};function bo(t,e){if(!_t)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function qt(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function ES(t,e,n){var r=e.pendingProps;switch(Dp(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qt(e),null;case 1:return En(e.type)&&lc(),qt(e),null;case 3:return r=e.stateNode,Ui(),gt(xn),gt(tn),Hp(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(xl(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Jn!==null&&(Lf(Jn),Jn=null))),Tf(t,e),qt(e),null;case 5:zp(e);var s=Os(ca.current);if(n=e.type,t!==null&&e.stateNode!=null)e_(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(ie(166));return qt(e),null}if(t=Os(fr.current),xl(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[ur]=e,r[aa]=i,t=(e.mode&1)!==0,n){case"dialog":pt("cancel",r),pt("close",r);break;case"iframe":case"object":case"embed":pt("load",r);break;case"video":case"audio":for(s=0;s<Oo.length;s++)pt(Oo[s],r);break;case"source":pt("error",r);break;case"img":case"image":case"link":pt("error",r),pt("load",r);break;case"details":pt("toggle",r);break;case"input":Wg(r,i),pt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},pt("invalid",r);break;case"textarea":Vg(r,i),pt("invalid",r)}Jd(n,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?r.textContent!==a&&(i.suppressHydrationWarning!==!0&&_l(r.textContent,a,t),s=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&_l(r.textContent,a,t),s=["children",""+a]):Jo.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&pt("scroll",r)}switch(n){case"input":dl(r),Gg(r,i,!0);break;case"textarea":dl(r),Yg(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=ac)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Ry(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[ur]=e,t[aa]=r,Zv(t,e,!1,!1),e.stateNode=t;e:{switch(o=qd(n,r),n){case"dialog":pt("cancel",t),pt("close",t),s=r;break;case"iframe":case"object":case"embed":pt("load",t),s=r;break;case"video":case"audio":for(s=0;s<Oo.length;s++)pt(Oo[s],t);s=r;break;case"source":pt("error",t),s=r;break;case"img":case"image":case"link":pt("error",t),pt("load",t),s=r;break;case"details":pt("toggle",t),s=r;break;case"input":Wg(t,r),s=Vd(t,r),pt("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=St({},r,{value:void 0}),pt("invalid",t);break;case"textarea":Vg(t,r),s=Xd(t,r),pt("invalid",t);break;default:s=r}Jd(n,s),a=s;for(i in a)if(a.hasOwnProperty(i)){var c=a[i];i==="style"?Oy(t,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&Ay(t,c)):i==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&qo(t,c):typeof c=="number"&&qo(t,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Jo.hasOwnProperty(i)?c!=null&&i==="onScroll"&&pt("scroll",t):c!=null&&_p(t,i,c,o))}switch(n){case"input":dl(t),Gg(t,r,!1);break;case"textarea":dl(t),Yg(t);break;case"option":r.value!=null&&t.setAttribute("value",""+cs(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?ki(t,!!r.multiple,i,!1):r.defaultValue!=null&&ki(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=ac)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return qt(e),null;case 6:if(t&&e.stateNode!=null)t_(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(ie(166));if(n=Os(ca.current),Os(fr.current),xl(e)){if(r=e.stateNode,n=e.memoizedProps,r[ur]=e,(i=r.nodeValue!==n)&&(t=An,t!==null))switch(t.tag){case 3:_l(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&_l(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[ur]=e,e.stateNode=r}return qt(e),null;case 13:if(gt(xt),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(_t&&Rn!==null&&e.mode&1&&!(e.flags&128))_v(),$i(),e.flags|=98560,i=!1;else if(i=xl(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(ie(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(ie(317));i[ur]=e}else $i(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;qt(e),i=!1}else Jn!==null&&(Lf(Jn),Jn=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||xt.current&1?Mt===0&&(Mt=3):th())),e.updateQueue!==null&&(e.flags|=4),qt(e),null);case 4:return Ui(),Tf(t,e),t===null&&ia(e.stateNode.containerInfo),qt(e),null;case 10:return Fp(e.type._context),qt(e),null;case 17:return En(e.type)&&lc(),qt(e),null;case 19:if(gt(xt),i=e.memoizedState,i===null)return qt(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)bo(i,!1);else{if(Mt!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=gc(t),o!==null){for(e.flags|=128,bo(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,t=o.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return dt(xt,xt.current&1|2),e.child}t=t.sibling}i.tail!==null&&It()>Hi&&(e.flags|=128,r=!0,bo(i,!1),e.lanes=4194304)}else{if(!r)if(t=gc(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),bo(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!_t)return qt(e),null}else 2*It()-i.renderingStartTime>Hi&&n!==1073741824&&(e.flags|=128,r=!0,bo(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(n=i.last,n!==null?n.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=It(),e.sibling=null,n=xt.current,dt(xt,r?n&1|2:n&1),e):(qt(e),null);case 22:case 23:return eh(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?wn&1073741824&&(qt(e),e.subtreeFlags&6&&(e.flags|=8192)):qt(e),null;case 24:return null;case 25:return null}throw Error(ie(156,e.tag))}function bS(t,e){switch(Dp(e),e.tag){case 1:return En(e.type)&&lc(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Ui(),gt(xn),gt(tn),Hp(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return zp(e),null;case 13:if(gt(xt),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(ie(340));$i()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return gt(xt),null;case 4:return Ui(),null;case 10:return Fp(e.type._context),null;case 22:case 23:return eh(),null;case 24:return null;default:return null}}var Sl=!1,en=!1,SS=typeof WeakSet=="function"?WeakSet:Set,ve=null;function Ci(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){Tt(t,e,r)}else n.current=null}function If(t,e,n){try{n()}catch(r){Tt(t,e,r)}}var N0=!1;function CS(t,e){if(cf=sc,t=ov(),Op(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var o=0,a=-1,c=-1,u=0,p=0,f=t,d=null;t:for(;;){for(var y;f!==n||s!==0&&f.nodeType!==3||(a=o+s),f!==i||r!==0&&f.nodeType!==3||(c=o+r),f.nodeType===3&&(o+=f.nodeValue.length),(y=f.firstChild)!==null;)d=f,f=y;for(;;){if(f===t)break t;if(d===n&&++u===s&&(a=o),d===i&&++p===r&&(c=o),(y=f.nextSibling)!==null)break;f=d,d=f.parentNode}f=y}n=a===-1||c===-1?null:{start:a,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(uf={focusedElem:t,selectionRange:n},sc=!1,ve=e;ve!==null;)if(e=ve,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,ve=t;else for(;ve!==null;){e=ve;try{var S=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(S!==null){var P=S.memoizedProps,g=S.memoizedState,b=e.stateNode,x=b.getSnapshotBeforeUpdate(e.elementType===e.type?P:Xn(e.type,P),g);b.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var E=e.stateNode.containerInfo;E.nodeType===1?E.textContent="":E.nodeType===9&&E.documentElement&&E.removeChild(E.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ie(163))}}catch(O){Tt(e,e.return,O)}if(t=e.sibling,t!==null){t.return=e.return,ve=t;break}ve=e.return}return S=N0,N0=!1,S}function Bo(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&If(e,n,i)}s=s.next}while(s!==r)}}function Zc(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function kf(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function n_(t){var e=t.alternate;e!==null&&(t.alternate=null,n_(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[ur],delete e[aa],delete e[pf],delete e[oS],delete e[aS])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function r_(t){return t.tag===5||t.tag===3||t.tag===4}function j0(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||r_(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function wf(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=ac));else if(r!==4&&(t=t.child,t!==null))for(wf(t,e,n),t=t.sibling;t!==null;)wf(t,e,n),t=t.sibling}function Rf(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Rf(t,e,n),t=t.sibling;t!==null;)Rf(t,e,n),t=t.sibling}var Wt=null,Qn=!1;function zr(t,e,n){for(n=n.child;n!==null;)s_(t,e,n),n=n.sibling}function s_(t,e,n){if(dr&&typeof dr.onCommitFiberUnmount=="function")try{dr.onCommitFiberUnmount(Gc,n)}catch{}switch(n.tag){case 5:en||Ci(n,e);case 6:var r=Wt,s=Qn;Wt=null,zr(t,e,n),Wt=r,Qn=s,Wt!==null&&(Qn?(t=Wt,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Wt.removeChild(n.stateNode));break;case 18:Wt!==null&&(Qn?(t=Wt,n=n.stateNode,t.nodeType===8?gd(t.parentNode,n):t.nodeType===1&&gd(t,n),na(t)):gd(Wt,n.stateNode));break;case 4:r=Wt,s=Qn,Wt=n.stateNode.containerInfo,Qn=!0,zr(t,e,n),Wt=r,Qn=s;break;case 0:case 11:case 14:case 15:if(!en&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&If(n,e,o),s=s.next}while(s!==r)}zr(t,e,n);break;case 1:if(!en&&(Ci(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){Tt(n,e,a)}zr(t,e,n);break;case 21:zr(t,e,n);break;case 22:n.mode&1?(en=(r=en)||n.memoizedState!==null,zr(t,e,n),en=r):zr(t,e,n);break;default:zr(t,e,n)}}function F0(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new SS),e.forEach(function(r){var s=LS.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function Kn(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Wt=a.stateNode,Qn=!1;break e;case 3:Wt=a.stateNode.containerInfo,Qn=!0;break e;case 4:Wt=a.stateNode.containerInfo,Qn=!0;break e}a=a.return}if(Wt===null)throw Error(ie(160));s_(i,o,s),Wt=null,Qn=!1;var c=s.alternate;c!==null&&(c.return=null),s.return=null}catch(u){Tt(s,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)i_(e,t),e=e.sibling}function i_(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Kn(e,t),lr(t),r&4){try{Bo(3,t,t.return),Zc(3,t)}catch(P){Tt(t,t.return,P)}try{Bo(5,t,t.return)}catch(P){Tt(t,t.return,P)}}break;case 1:Kn(e,t),lr(t),r&512&&n!==null&&Ci(n,n.return);break;case 5:if(Kn(e,t),lr(t),r&512&&n!==null&&Ci(n,n.return),t.flags&32){var s=t.stateNode;try{qo(s,"")}catch(P){Tt(t,t.return,P)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,o=n!==null?n.memoizedProps:i,a=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&ky(s,i),qd(a,o);var u=qd(a,i);for(o=0;o<c.length;o+=2){var p=c[o],f=c[o+1];p==="style"?Oy(s,f):p==="dangerouslySetInnerHTML"?Ay(s,f):p==="children"?qo(s,f):_p(s,p,f,u)}switch(a){case"input":Yd(s,i);break;case"textarea":wy(s,i);break;case"select":var d=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var y=i.value;y!=null?ki(s,!!i.multiple,y,!1):d!==!!i.multiple&&(i.defaultValue!=null?ki(s,!!i.multiple,i.defaultValue,!0):ki(s,!!i.multiple,i.multiple?[]:"",!1))}s[aa]=i}catch(P){Tt(t,t.return,P)}}break;case 6:if(Kn(e,t),lr(t),r&4){if(t.stateNode===null)throw Error(ie(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(P){Tt(t,t.return,P)}}break;case 3:if(Kn(e,t),lr(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{na(e.containerInfo)}catch(P){Tt(t,t.return,P)}break;case 4:Kn(e,t),lr(t);break;case 13:Kn(e,t),lr(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(qp=It())),r&4&&F0(t);break;case 22:if(p=n!==null&&n.memoizedState!==null,t.mode&1?(en=(u=en)||p,Kn(e,t),en=u):Kn(e,t),lr(t),r&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!p&&t.mode&1)for(ve=t,p=t.child;p!==null;){for(f=ve=p;ve!==null;){switch(d=ve,y=d.child,d.tag){case 0:case 11:case 14:case 15:Bo(4,d,d.return);break;case 1:Ci(d,d.return);var S=d.stateNode;if(typeof S.componentWillUnmount=="function"){r=d,n=d.return;try{e=r,S.props=e.memoizedProps,S.state=e.memoizedState,S.componentWillUnmount()}catch(P){Tt(r,n,P)}}break;case 5:Ci(d,d.return);break;case 22:if(d.memoizedState!==null){B0(f);continue}}y!==null?(y.return=d,ve=y):B0(f)}p=p.sibling}e:for(p=null,f=t;;){if(f.tag===5){if(p===null){p=f;try{s=f.stateNode,u?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=f.stateNode,c=f.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,a.style.display=Py("display",o))}catch(P){Tt(t,t.return,P)}}}else if(f.tag===6){if(p===null)try{f.stateNode.nodeValue=u?"":f.memoizedProps}catch(P){Tt(t,t.return,P)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===t)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===t)break e;for(;f.sibling===null;){if(f.return===null||f.return===t)break e;p===f&&(p=null),f=f.return}p===f&&(p=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:Kn(e,t),lr(t),r&4&&F0(t);break;case 21:break;default:Kn(e,t),lr(t)}}function lr(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(r_(n)){var r=n;break e}n=n.return}throw Error(ie(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(qo(s,""),r.flags&=-33);var i=j0(t);Rf(t,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,a=j0(t);wf(t,a,o);break;default:throw Error(ie(161))}}catch(c){Tt(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function TS(t,e,n){ve=t,o_(t)}function o_(t,e,n){for(var r=(t.mode&1)!==0;ve!==null;){var s=ve,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||Sl;if(!o){var a=s.alternate,c=a!==null&&a.memoizedState!==null||en;a=Sl;var u=en;if(Sl=o,(en=c)&&!u)for(ve=s;ve!==null;)o=ve,c=o.child,o.tag===22&&o.memoizedState!==null?U0(s):c!==null?(c.return=o,ve=c):U0(s);for(;i!==null;)ve=i,o_(i),i=i.sibling;ve=s,Sl=a,en=u}$0(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,ve=i):$0(t)}}function $0(t){for(;ve!==null;){var e=ve;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:en||Zc(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!en)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:Xn(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&S0(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}S0(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var p=u.memoizedState;if(p!==null){var f=p.dehydrated;f!==null&&na(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ie(163))}en||e.flags&512&&kf(e)}catch(d){Tt(e,e.return,d)}}if(e===t){ve=null;break}if(n=e.sibling,n!==null){n.return=e.return,ve=n;break}ve=e.return}}function B0(t){for(;ve!==null;){var e=ve;if(e===t){ve=null;break}var n=e.sibling;if(n!==null){n.return=e.return,ve=n;break}ve=e.return}}function U0(t){for(;ve!==null;){var e=ve;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Zc(4,e)}catch(c){Tt(e,n,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(c){Tt(e,s,c)}}var i=e.return;try{kf(e)}catch(c){Tt(e,i,c)}break;case 5:var o=e.return;try{kf(e)}catch(c){Tt(e,o,c)}}}catch(c){Tt(e,e.return,c)}if(e===t){ve=null;break}var a=e.sibling;if(a!==null){a.return=e.return,ve=a;break}ve=e.return}}var IS=Math.ceil,vc=Lr.ReactCurrentDispatcher,Qp=Lr.ReactCurrentOwner,$n=Lr.ReactCurrentBatchConfig,Ze=0,$t=null,Pt=null,Vt=0,wn=0,Ti=gs(0),Mt=0,pa=null,zs=0,eu=0,Jp=0,Uo=null,yn=null,qp=0,Hi=1/0,vr=null,_c=!1,Af=null,ts=null,Cl=!1,Kr=null,xc=0,zo=0,Pf=null,zl=-1,Hl=0;function un(){return Ze&6?It():zl!==-1?zl:zl=It()}function ns(t){return t.mode&1?Ze&2&&Vt!==0?Vt&-Vt:cS.transition!==null?(Hl===0&&(Hl=Wy()),Hl):(t=rt,t!==0||(t=window.event,t=t===void 0?16:Jy(t.type)),t):1}function tr(t,e,n,r){if(50<zo)throw zo=0,Pf=null,Error(ie(185));Ra(t,n,r),(!(Ze&2)||t!==$t)&&(t===$t&&(!(Ze&2)&&(eu|=n),Mt===4&&Vr(t,Vt)),bn(t,r),n===1&&Ze===0&&!(e.mode&1)&&(Hi=It()+500,Qc&&ms()))}function bn(t,e){var n=t.callbackNode;cb(t,e);var r=rc(t,t===$t?Vt:0);if(r===0)n!==null&&Qg(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&Qg(n),e===1)t.tag===0?lS(z0.bind(null,t)):mv(z0.bind(null,t)),sS(function(){!(Ze&6)&&ms()}),n=null;else{switch(Gy(r)){case 1:n=Cp;break;case 4:n=zy;break;case 16:n=nc;break;case 536870912:n=Hy;break;default:n=nc}n=h_(n,a_.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function a_(t,e){if(zl=-1,Hl=0,Ze&6)throw Error(ie(327));var n=t.callbackNode;if(Oi()&&t.callbackNode!==n)return null;var r=rc(t,t===$t?Vt:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=Ec(t,r);else{e=r;var s=Ze;Ze|=2;var i=c_();($t!==t||Vt!==e)&&(vr=null,Hi=It()+500,js(t,e));do try{RS();break}catch(a){l_(t,a)}while(!0);jp(),vc.current=i,Ze=s,Pt!==null?e=0:($t=null,Vt=0,e=Mt)}if(e!==0){if(e===2&&(s=rf(t),s!==0&&(r=s,e=Of(t,s))),e===1)throw n=pa,js(t,0),Vr(t,r),bn(t,It()),n;if(e===6)Vr(t,r);else{if(s=t.current.alternate,!(r&30)&&!kS(s)&&(e=Ec(t,r),e===2&&(i=rf(t),i!==0&&(r=i,e=Of(t,i))),e===1))throw n=pa,js(t,0),Vr(t,r),bn(t,It()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(ie(345));case 2:Is(t,yn,vr);break;case 3:if(Vr(t,r),(r&130023424)===r&&(e=qp+500-It(),10<e)){if(rc(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){un(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=ff(Is.bind(null,t,yn,vr),e);break}Is(t,yn,vr);break;case 4:if(Vr(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var o=31-er(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=It()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*IS(r/1960))-r,10<r){t.timeoutHandle=ff(Is.bind(null,t,yn,vr),r);break}Is(t,yn,vr);break;case 5:Is(t,yn,vr);break;default:throw Error(ie(329))}}}return bn(t,It()),t.callbackNode===n?a_.bind(null,t):null}function Of(t,e){var n=Uo;return t.current.memoizedState.isDehydrated&&(js(t,e).flags|=256),t=Ec(t,e),t!==2&&(e=yn,yn=n,e!==null&&Lf(e)),t}function Lf(t){yn===null?yn=t:yn.push.apply(yn,t)}function kS(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!rr(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Vr(t,e){for(e&=~Jp,e&=~eu,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-er(e),r=1<<n;t[n]=-1,e&=~r}}function z0(t){if(Ze&6)throw Error(ie(327));Oi();var e=rc(t,0);if(!(e&1))return bn(t,It()),null;var n=Ec(t,e);if(t.tag!==0&&n===2){var r=rf(t);r!==0&&(e=r,n=Of(t,r))}if(n===1)throw n=pa,js(t,0),Vr(t,e),bn(t,It()),n;if(n===6)throw Error(ie(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Is(t,yn,vr),bn(t,It()),null}function Zp(t,e){var n=Ze;Ze|=1;try{return t(e)}finally{Ze=n,Ze===0&&(Hi=It()+500,Qc&&ms())}}function Hs(t){Kr!==null&&Kr.tag===0&&!(Ze&6)&&Oi();var e=Ze;Ze|=1;var n=$n.transition,r=rt;try{if($n.transition=null,rt=1,t)return t()}finally{rt=r,$n.transition=n,Ze=e,!(Ze&6)&&ms()}}function eh(){wn=Ti.current,gt(Ti)}function js(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,rS(n)),Pt!==null)for(n=Pt.return;n!==null;){var r=n;switch(Dp(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&lc();break;case 3:Ui(),gt(xn),gt(tn),Hp();break;case 5:zp(r);break;case 4:Ui();break;case 13:gt(xt);break;case 19:gt(xt);break;case 10:Fp(r.type._context);break;case 22:case 23:eh()}n=n.return}if($t=t,Pt=t=rs(t.current,null),Vt=wn=e,Mt=0,pa=null,Jp=eu=zs=0,yn=Uo=null,Ps!==null){for(e=0;e<Ps.length;e++)if(n=Ps[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}n.pending=r}Ps=null}return t}function l_(t,e){do{var n=Pt;try{if(jp(),$l.current=yc,mc){for(var r=bt.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}mc=!1}if(Us=0,jt=Lt=bt=null,$o=!1,ua=0,Qp.current=null,n===null||n.return===null){Mt=1,pa=e,Pt=null;break}e:{var i=t,o=n.return,a=n,c=e;if(e=Vt,a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var u=c,p=a,f=p.tag;if(!(p.mode&1)&&(f===0||f===11||f===15)){var d=p.alternate;d?(p.updateQueue=d.updateQueue,p.memoizedState=d.memoizedState,p.lanes=d.lanes):(p.updateQueue=null,p.memoizedState=null)}var y=R0(o);if(y!==null){y.flags&=-257,A0(y,o,a,i,e),y.mode&1&&w0(i,u,e),e=y,c=u;var S=e.updateQueue;if(S===null){var P=new Set;P.add(c),e.updateQueue=P}else S.add(c);break e}else{if(!(e&1)){w0(i,u,e),th();break e}c=Error(ie(426))}}else if(_t&&a.mode&1){var g=R0(o);if(g!==null){!(g.flags&65536)&&(g.flags|=256),A0(g,o,a,i,e),Mp(zi(c,a));break e}}i=c=zi(c,a),Mt!==4&&(Mt=2),Uo===null?Uo=[i]:Uo.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var b=Gv(i,c,e);b0(i,b);break e;case 1:a=c;var x=i.type,E=i.stateNode;if(!(i.flags&128)&&(typeof x.getDerivedStateFromError=="function"||E!==null&&typeof E.componentDidCatch=="function"&&(ts===null||!ts.has(E)))){i.flags|=65536,e&=-e,i.lanes|=e;var O=Vv(i,a,e);b0(i,O);break e}}i=i.return}while(i!==null)}d_(n)}catch(Q){e=Q,Pt===n&&n!==null&&(Pt=n=n.return);continue}break}while(!0)}function c_(){var t=vc.current;return vc.current=yc,t===null?yc:t}function th(){(Mt===0||Mt===3||Mt===2)&&(Mt=4),$t===null||!(zs&268435455)&&!(eu&268435455)||Vr($t,Vt)}function Ec(t,e){var n=Ze;Ze|=2;var r=c_();($t!==t||Vt!==e)&&(vr=null,js(t,e));do try{wS();break}catch(s){l_(t,s)}while(!0);if(jp(),Ze=n,vc.current=r,Pt!==null)throw Error(ie(261));return $t=null,Vt=0,Mt}function wS(){for(;Pt!==null;)u_(Pt)}function RS(){for(;Pt!==null&&!eb();)u_(Pt)}function u_(t){var e=p_(t.alternate,t,wn);t.memoizedProps=t.pendingProps,e===null?d_(t):Pt=e,Qp.current=null}function d_(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=bS(n,e),n!==null){n.flags&=32767,Pt=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Mt=6,Pt=null;return}}else if(n=ES(n,e,wn),n!==null){Pt=n;return}if(e=e.sibling,e!==null){Pt=e;return}Pt=e=t}while(e!==null);Mt===0&&(Mt=5)}function Is(t,e,n){var r=rt,s=$n.transition;try{$n.transition=null,rt=1,AS(t,e,n,r)}finally{$n.transition=s,rt=r}return null}function AS(t,e,n,r){do Oi();while(Kr!==null);if(Ze&6)throw Error(ie(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(ie(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(ub(t,i),t===$t&&(Pt=$t=null,Vt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Cl||(Cl=!0,h_(nc,function(){return Oi(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=$n.transition,$n.transition=null;var o=rt;rt=1;var a=Ze;Ze|=4,Qp.current=null,CS(t,n),i_(n,t),Qb(uf),sc=!!cf,uf=cf=null,t.current=n,TS(n),tb(),Ze=a,rt=o,$n.transition=i}else t.current=n;if(Cl&&(Cl=!1,Kr=t,xc=s),i=t.pendingLanes,i===0&&(ts=null),sb(n.stateNode),bn(t,It()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(_c)throw _c=!1,t=Af,Af=null,t;return xc&1&&t.tag!==0&&Oi(),i=t.pendingLanes,i&1?t===Pf?zo++:(zo=0,Pf=t):zo=0,ms(),null}function Oi(){if(Kr!==null){var t=Gy(xc),e=$n.transition,n=rt;try{if($n.transition=null,rt=16>t?16:t,Kr===null)var r=!1;else{if(t=Kr,Kr=null,xc=0,Ze&6)throw Error(ie(331));var s=Ze;for(Ze|=4,ve=t.current;ve!==null;){var i=ve,o=i.child;if(ve.flags&16){var a=i.deletions;if(a!==null){for(var c=0;c<a.length;c++){var u=a[c];for(ve=u;ve!==null;){var p=ve;switch(p.tag){case 0:case 11:case 15:Bo(8,p,i)}var f=p.child;if(f!==null)f.return=p,ve=f;else for(;ve!==null;){p=ve;var d=p.sibling,y=p.return;if(n_(p),p===u){ve=null;break}if(d!==null){d.return=y,ve=d;break}ve=y}}}var S=i.alternate;if(S!==null){var P=S.child;if(P!==null){S.child=null;do{var g=P.sibling;P.sibling=null,P=g}while(P!==null)}}ve=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,ve=o;else e:for(;ve!==null;){if(i=ve,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Bo(9,i,i.return)}var b=i.sibling;if(b!==null){b.return=i.return,ve=b;break e}ve=i.return}}var x=t.current;for(ve=x;ve!==null;){o=ve;var E=o.child;if(o.subtreeFlags&2064&&E!==null)E.return=o,ve=E;else e:for(o=x;ve!==null;){if(a=ve,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Zc(9,a)}}catch(Q){Tt(a,a.return,Q)}if(a===o){ve=null;break e}var O=a.sibling;if(O!==null){O.return=a.return,ve=O;break e}ve=a.return}}if(Ze=s,ms(),dr&&typeof dr.onPostCommitFiberRoot=="function")try{dr.onPostCommitFiberRoot(Gc,t)}catch{}r=!0}return r}finally{rt=n,$n.transition=e}}return!1}function H0(t,e,n){e=zi(n,e),e=Gv(t,e,1),t=es(t,e,1),e=un(),t!==null&&(Ra(t,1,e),bn(t,e))}function Tt(t,e,n){if(t.tag===3)H0(t,t,n);else for(;e!==null;){if(e.tag===3){H0(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(ts===null||!ts.has(r))){t=zi(n,t),t=Vv(e,t,1),e=es(e,t,1),t=un(),e!==null&&(Ra(e,1,t),bn(e,t));break}}e=e.return}}function PS(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=un(),t.pingedLanes|=t.suspendedLanes&n,$t===t&&(Vt&n)===n&&(Mt===4||Mt===3&&(Vt&130023424)===Vt&&500>It()-qp?js(t,0):Jp|=n),bn(t,e)}function f_(t,e){e===0&&(t.mode&1?(e=hl,hl<<=1,!(hl&130023424)&&(hl=4194304)):e=1);var n=un();t=Rr(t,e),t!==null&&(Ra(t,e,n),bn(t,n))}function OS(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),f_(t,n)}function LS(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(ie(314))}r!==null&&r.delete(e),f_(t,n)}var p_;p_=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||xn.current)vn=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return vn=!1,xS(t,e,n);vn=!!(t.flags&131072)}else vn=!1,_t&&e.flags&1048576&&yv(e,dc,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Ul(t,e),t=e.pendingProps;var s=Fi(e,tn.current);Pi(e,n),s=Gp(null,e,r,t,s,n);var i=Vp();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,En(r)?(i=!0,cc(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Bp(e),s.updater=qc,e.stateNode=s,s._reactInternals=e,_f(e,r,t,n),e=bf(null,e,r,!0,i,n)):(e.tag=0,_t&&i&&Lp(e),ln(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(Ul(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=MS(r),t=Xn(r,t),s){case 0:e=Ef(null,e,r,t,n);break e;case 1:e=L0(null,e,r,t,n);break e;case 11:e=P0(null,e,r,t,n);break e;case 14:e=O0(null,e,r,Xn(r.type,t),n);break e}throw Error(ie(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Xn(r,s),Ef(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Xn(r,s),L0(t,e,r,s,n);case 3:e:{if(Qv(e),t===null)throw Error(ie(387));r=e.pendingProps,i=e.memoizedState,s=i.element,Sv(t,e),hc(e,r,null,n);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=zi(Error(ie(423)),e),e=D0(t,e,r,n,s);break e}else if(r!==s){s=zi(Error(ie(424)),e),e=D0(t,e,r,n,s);break e}else for(Rn=Zr(e.stateNode.containerInfo.firstChild),An=e,_t=!0,Jn=null,n=Ev(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if($i(),r===s){e=Ar(t,e,n);break e}ln(t,e,r,n)}e=e.child}return e;case 5:return Cv(e),t===null&&mf(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,o=s.children,df(r,s)?o=null:i!==null&&df(r,i)&&(e.flags|=32),Xv(t,e),ln(t,e,o,n),e.child;case 6:return t===null&&mf(e),null;case 13:return Jv(t,e,n);case 4:return Up(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Bi(e,null,r,n):ln(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Xn(r,s),P0(t,e,r,s,n);case 7:return ln(t,e,e.pendingProps,n),e.child;case 8:return ln(t,e,e.pendingProps.children,n),e.child;case 12:return ln(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,dt(fc,r._currentValue),r._currentValue=o,i!==null)if(rr(i.value,o)){if(i.children===s.children&&!xn.current){e=Ar(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var c=a.firstContext;c!==null;){if(c.context===r){if(i.tag===1){c=Tr(-1,n&-n),c.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var p=u.pending;p===null?c.next=c:(c.next=p.next,p.next=c),u.pending=c}}i.lanes|=n,c=i.alternate,c!==null&&(c.lanes|=n),yf(i.return,n,e),a.lanes|=n;break}c=c.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(ie(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),yf(o,n,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}ln(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,Pi(e,n),s=Bn(s),r=r(s),e.flags|=1,ln(t,e,r,n),e.child;case 14:return r=e.type,s=Xn(r,e.pendingProps),s=Xn(r.type,s),O0(t,e,r,s,n);case 15:return Yv(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Xn(r,s),Ul(t,e),e.tag=1,En(r)?(t=!0,cc(e)):t=!1,Pi(e,n),Wv(e,r,s),_f(e,r,s,n),bf(null,e,r,!0,t,n);case 19:return qv(t,e,n);case 22:return Kv(t,e,n)}throw Error(ie(156,e.tag))};function h_(t,e){return Uy(t,e)}function DS(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function jn(t,e,n,r){return new DS(t,e,n,r)}function nh(t){return t=t.prototype,!(!t||!t.isReactComponent)}function MS(t){if(typeof t=="function")return nh(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Ep)return 11;if(t===bp)return 14}return 2}function rs(t,e){var n=t.alternate;return n===null?(n=jn(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Wl(t,e,n,r,s,i){var o=2;if(r=t,typeof t=="function")nh(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case gi:return Fs(n.children,s,i,e);case xp:o=8,s|=8;break;case zd:return t=jn(12,n,e,s|2),t.elementType=zd,t.lanes=i,t;case Hd:return t=jn(13,n,e,s),t.elementType=Hd,t.lanes=i,t;case Wd:return t=jn(19,n,e,s),t.elementType=Wd,t.lanes=i,t;case Cy:return tu(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case by:o=10;break e;case Sy:o=9;break e;case Ep:o=11;break e;case bp:o=14;break e;case Hr:o=16,r=null;break e}throw Error(ie(130,t==null?t:typeof t,""))}return e=jn(o,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function Fs(t,e,n,r){return t=jn(7,t,r,e),t.lanes=n,t}function tu(t,e,n,r){return t=jn(22,t,r,e),t.elementType=Cy,t.lanes=n,t.stateNode={isHidden:!1},t}function Sd(t,e,n){return t=jn(6,t,null,e),t.lanes=n,t}function Cd(t,e,n){return e=jn(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function NS(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=sd(0),this.expirationTimes=sd(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=sd(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function rh(t,e,n,r,s,i,o,a,c){return t=new NS(t,e,n,a,c),e===1?(e=1,i===!0&&(e|=8)):e=0,i=jn(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Bp(i),t}function jS(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:hi,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function g_(t){if(!t)return us;t=t._reactInternals;e:{if(Ks(t)!==t||t.tag!==1)throw Error(ie(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(En(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ie(171))}if(t.tag===1){var n=t.type;if(En(n))return gv(t,n,e)}return e}function m_(t,e,n,r,s,i,o,a,c){return t=rh(n,r,!0,t,s,i,o,a,c),t.context=g_(null),n=t.current,r=un(),s=ns(n),i=Tr(r,s),i.callback=e??null,es(n,i,s),t.current.lanes=s,Ra(t,s,r),bn(t,r),t}function nu(t,e,n,r){var s=e.current,i=un(),o=ns(s);return n=g_(n),e.context===null?e.context=n:e.pendingContext=n,e=Tr(i,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=es(s,e,o),t!==null&&(tr(t,s,o,i),Fl(t,s,o)),o}function bc(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function W0(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function sh(t,e){W0(t,e),(t=t.alternate)&&W0(t,e)}function FS(){return null}var y_=typeof reportError=="function"?reportError:function(t){console.error(t)};function ih(t){this._internalRoot=t}ru.prototype.render=ih.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(ie(409));nu(t,e,null,null)};ru.prototype.unmount=ih.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Hs(function(){nu(null,t,null,null)}),e[wr]=null}};function ru(t){this._internalRoot=t}ru.prototype.unstable_scheduleHydration=function(t){if(t){var e=Ky();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Gr.length&&e!==0&&e<Gr[n].priority;n++);Gr.splice(n,0,t),n===0&&Qy(t)}};function oh(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function su(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function G0(){}function $S(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var u=bc(o);i.call(u)}}var o=m_(e,r,t,0,null,!1,!1,"",G0);return t._reactRootContainer=o,t[wr]=o.current,ia(t.nodeType===8?t.parentNode:t),Hs(),o}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var a=r;r=function(){var u=bc(c);a.call(u)}}var c=rh(t,0,!1,null,null,!1,!1,"",G0);return t._reactRootContainer=c,t[wr]=c.current,ia(t.nodeType===8?t.parentNode:t),Hs(function(){nu(e,c,n,r)}),c}function iu(t,e,n,r,s){var i=n._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var a=s;s=function(){var c=bc(o);a.call(c)}}nu(e,o,t,s)}else o=$S(n,e,t,s,r);return bc(o)}Vy=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Po(e.pendingLanes);n!==0&&(Tp(e,n|1),bn(e,It()),!(Ze&6)&&(Hi=It()+500,ms()))}break;case 13:Hs(function(){var r=Rr(t,1);if(r!==null){var s=un();tr(r,t,1,s)}}),sh(t,1)}};Ip=function(t){if(t.tag===13){var e=Rr(t,134217728);if(e!==null){var n=un();tr(e,t,134217728,n)}sh(t,134217728)}};Yy=function(t){if(t.tag===13){var e=ns(t),n=Rr(t,e);if(n!==null){var r=un();tr(n,t,e,r)}sh(t,e)}};Ky=function(){return rt};Xy=function(t,e){var n=rt;try{return rt=t,e()}finally{rt=n}};ef=function(t,e,n){switch(e){case"input":if(Yd(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=Xc(r);if(!s)throw Error(ie(90));Iy(r),Yd(r,s)}}}break;case"textarea":wy(t,n);break;case"select":e=n.value,e!=null&&ki(t,!!n.multiple,e,!1)}};My=Zp;Ny=Hs;var BS={usingClientEntryPoint:!1,Events:[Pa,_i,Xc,Ly,Dy,Zp]},So={findFiberByHostInstance:As,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},US={bundleType:So.bundleType,version:So.version,rendererPackageName:So.rendererPackageName,rendererConfig:So.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Lr.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=$y(t),t===null?null:t.stateNode},findFiberByHostInstance:So.findFiberByHostInstance||FS,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Tl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Tl.isDisabled&&Tl.supportsFiber)try{Gc=Tl.inject(US),dr=Tl}catch{}}On.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=BS;On.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!oh(e))throw Error(ie(200));return jS(t,e,null,n)};On.createRoot=function(t,e){if(!oh(t))throw Error(ie(299));var n=!1,r="",s=y_;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=rh(t,1,!1,null,null,n,!1,r,s),t[wr]=e.current,ia(t.nodeType===8?t.parentNode:t),new ih(e)};On.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(ie(188)):(t=Object.keys(t).join(","),Error(ie(268,t)));return t=$y(e),t=t===null?null:t.stateNode,t};On.flushSync=function(t){return Hs(t)};On.hydrate=function(t,e,n){if(!su(e))throw Error(ie(200));return iu(null,t,e,!0,n)};On.hydrateRoot=function(t,e,n){if(!oh(t))throw Error(ie(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",o=y_;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=m_(e,null,t,1,n??null,s,!1,i,o),t[wr]=e.current,ia(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new ru(e)};On.render=function(t,e,n){if(!su(e))throw Error(ie(200));return iu(null,t,e,!1,n)};On.unmountComponentAtNode=function(t){if(!su(t))throw Error(ie(40));return t._reactRootContainer?(Hs(function(){iu(null,null,t,!1,function(){t._reactRootContainer=null,t[wr]=null})}),!0):!1};On.unstable_batchedUpdates=Zp;On.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!su(n))throw Error(ie(200));if(t==null||t._reactInternals===void 0)throw Error(ie(38));return iu(t,e,n,!1,r)};On.version="18.3.1-next-f1338f8080-20240426";function v_(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(v_)}catch(t){console.error(t)}}v_(),vy.exports=On;var zS=vy.exports,V0=zS;Bd.createRoot=V0.createRoot,Bd.hydrateRoot=V0.hydrateRoot;const HS=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},WS=1280,GS=720,VS=({onStartConfig:t,audioSettings:e,onAudioSettingsChange:n})=>{const[r,s]=V.useState(!1),[i,o]=V.useState(""),[a,c]=V.useState(!1),[u,p]=V.useState(!1),[f,d]=V.useState(1);V.useEffect(()=>{const x=()=>{const E=window.innerWidth/WS,O=window.innerHeight/GS;d(Math.min(E,O))};return x(),window.addEventListener("resize",x),()=>window.removeEventListener("resize",x)},[]);const y=9*f,S=300*f,P=1.2*f,g=`${1*f}rem 0`,b={fontSize:`${P}rem`,padding:g,background:"transparent",border:"2px solid #e94560",color:"#fff",cursor:"pointer",transition:"all 0.3s",borderRadius:4*f,fontWeight:"bold",letterSpacing:"1px",width:"100%"};return l.jsxs("div",{className:"screen title-screen",style:{height:"100dvh",width:"100vw",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative",overflow:"hidden",color:"white"},children:[l.jsx("div",{style:{position:"absolute",inset:0,backgroundImage:`url(${HS("/title/background.png")})`,backgroundSize:"cover",backgroundPosition:"center",zIndex:0}}),l.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",zIndex:-1}}),l.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(0, 0, 0, 0.3)",zIndex:1}}),l.jsxs("div",{style:{position:"relative",zIndex:2,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-end",height:"100%",width:"100%",paddingBottom:`${1*f}rem`,boxSizing:"border-box"},children:[l.jsx("div",{style:{fontFamily:"Tamanegi, sans-serif",fontSize:`${y}rem`,color:"#fff",textShadow:"0 0 30px rgba(233, 69, 96, 0.9), 0 0 60px rgba(233, 69, 96, 0.5), 3px 3px 6px rgba(0,0,0,0.9)",letterSpacing:`${.5*f}rem`,whiteSpace:"nowrap",marginBottom:`${.5*f}rem`},children:""}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[!r&&!u?l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:`${1*f}rem`,width:S},children:[l.jsx("button",{onClick:()=>t("CPU"),style:b,onMouseOver:x=>x.currentTarget.style.background="#e94560",onMouseOut:x=>x.currentTarget.style.background="transparent",children:""}),l.jsx("button",{onClick:()=>p(!0),style:{...b,border:"2px solid #4ade80",background:"rgba(74, 222, 128, 0.1)"},onMouseOver:x=>x.currentTarget.style.background="#4ade80",onMouseOut:x=>x.currentTarget.style.background="rgba(74, 222, 128, 0.1)",children:""}),l.jsx("button",{onClick:()=>t("HOST"),style:b,onMouseOver:x=>x.currentTarget.style.background="#e94560",onMouseOut:x=>x.currentTarget.style.background="transparent",children:""}),l.jsx("button",{onClick:()=>s(!0),style:b,onMouseOver:x=>x.currentTarget.style.background="#e94560",onMouseOut:x=>x.currentTarget.style.background="transparent",children:""})]}):u?l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:`${1*f}rem`,width:S},children:[l.jsx("p",{style:{textAlign:"center",fontSize:`${1.2*f}rem`,marginBottom:`${.5*f}rem`,color:"#fff"},children:""}),l.jsx("button",{onClick:()=>{p(!1),t("CASUAL_MATCH")},style:{...b,border:"2px solid #4ade80"},onMouseOver:x=>x.currentTarget.style.background="#4ade80",onMouseOut:x=>x.currentTarget.style.background="transparent",children:""}),l.jsx("p",{style:{textAlign:"center",fontSize:`${.8*f}rem`,color:"#888",marginTop:`-${.5*f}rem`,marginBottom:`${.5*f}rem`},children:""}),l.jsx("button",{disabled:!0,style:{...b,border:"2px solid #666",color:"#666",cursor:"not-allowed",opacity:.5},children:""}),l.jsx("p",{style:{textAlign:"center",fontSize:`${.8*f}rem`,color:"#666",marginTop:`-${.5*f}rem`,marginBottom:`${.5*f}rem`},children:"Coming Soon..."}),l.jsx("button",{onClick:()=>p(!1),style:{...b,border:"none",fontSize:`${1*f}rem`,color:"#888"},children:""})]}):l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:`${1*f}rem`,width:S},children:[l.jsx("input",{type:"text",placeholder:"ID",value:i,onChange:x=>o(x.target.value),style:{padding:`${1*f}rem`,fontSize:`${1.2*f}rem`,background:"rgba(255,255,255,0.1)",border:"1px solid #444",color:"white",borderRadius:4*f,textAlign:"center"}}),l.jsx("button",{onClick:()=>t("JOIN",i),disabled:!i,style:{...b,opacity:i?1:.5},children:""}),l.jsx("button",{onClick:()=>s(!1),style:{...b,border:"none",fontSize:`${1*f}rem`,color:"#888"},children:""})]}),l.jsx("p",{style:{marginTop:`${1.5*f}rem`,opacity:.5,fontSize:`${.8*f}rem`},children:"Ver 1.03 Beta"})]})]}),l.jsxs("button",{onClick:()=>c(!0),style:{position:"absolute",top:20*f,right:20*f,zIndex:10,background:"rgba(0, 0, 0, 0.5)",border:"2px solid rgba(255, 255, 255, 0.3)",borderRadius:8*f,padding:`${.6*f}rem ${1*f}rem`,color:"white",fontSize:`${1*f}rem`,cursor:"pointer",display:"flex",alignItems:"center",gap:8*f,transition:"all 0.2s"},onMouseOver:x=>{x.currentTarget.style.background="rgba(233, 69, 96, 0.6)",x.currentTarget.style.borderColor="#e94560"},onMouseOut:x=>{x.currentTarget.style.background="rgba(0, 0, 0, 0.5)",x.currentTarget.style.borderColor="rgba(255, 255, 255, 0.3)"},children:[l.jsx("span",{style:{fontSize:`${1.2*f}rem`},children:""}),""]}),a&&l.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.8)",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>c(!1),children:l.jsxs("div",{style:{background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",borderRadius:12*f,padding:`${2*f}rem`,minWidth:400*f,maxWidth:500*f,border:"2px solid rgba(255, 255, 255, 0.2)",boxShadow:"0 10px 40px rgba(0, 0, 0, 0.5)"},onClick:x=>x.stopPropagation(),children:[l.jsx("h2",{style:{margin:0,marginBottom:`${1.5*f}rem`,fontSize:`${1.8*f}rem`,color:"white",textAlign:"center"},children:""}),l.jsxs("div",{style:{marginBottom:`${1.5*f}rem`},children:[l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:`${.5*f}rem`},children:[l.jsx("span",{style:{color:"white",fontSize:`${1*f}rem`},children:"BGM"}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8*f,cursor:"pointer"},children:[l.jsx("input",{type:"checkbox",checked:e.bgmEnabled,onChange:x=>n({bgmEnabled:x.target.checked}),style:{width:18*f,height:18*f,cursor:"pointer"}}),l.jsx("span",{style:{color:e.bgmEnabled?"#4ade80":"#888",fontSize:`${.9*f}rem`},children:e.bgmEnabled?"ON":"OFF"})]})]}),l.jsx("input",{type:"range",min:0,max:1,step:.05,value:e.bgm,onChange:x=>n({bgm:parseFloat(x.target.value)}),disabled:!e.bgmEnabled,style:{width:"100%",height:8*f,cursor:e.bgmEnabled?"pointer":"not-allowed",opacity:e.bgmEnabled?1:.5}})]}),l.jsxs("div",{style:{marginBottom:`${1.5*f}rem`},children:[l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:`${.5*f}rem`},children:[l.jsx("span",{style:{color:"white",fontSize:`${1*f}rem`},children:""}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8*f,cursor:"pointer"},children:[l.jsx("input",{type:"checkbox",checked:e.seEnabled,onChange:x=>n({seEnabled:x.target.checked}),style:{width:18*f,height:18*f,cursor:"pointer"}}),l.jsx("span",{style:{color:e.seEnabled?"#4ade80":"#888",fontSize:`${.9*f}rem`},children:e.seEnabled?"ON":"OFF"})]})]}),l.jsx("input",{type:"range",min:0,max:1,step:.05,value:e.se,onChange:x=>n({se:parseFloat(x.target.value)}),disabled:!e.seEnabled,style:{width:"100%",height:8*f,cursor:e.seEnabled?"pointer":"not-allowed",opacity:e.seEnabled?1:.5}})]}),l.jsx("button",{onClick:()=>c(!1),style:{width:"100%",padding:`${.8*f}rem`,fontSize:`${1*f}rem`,background:"#e94560",border:"none",borderRadius:6*f,color:"white",cursor:"pointer",fontWeight:"bold",marginTop:`${.5*f}rem`},children:""})]})})]})},ah=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},YS=ah("/leaders/azya_leader.png"),KS=ah("/leaders/senka_leader.png"),XS=ah("/leaders/yoruka_secret.png"),QS=1280,JS=720,qS=({onSelectClass:t,onBack:e,gameMode:n="CPU",aiDifficulty:r="NORMAL",onDifficultyChange:s,playerName:i,onPlayerNameChange:o,timerEnabled:a=!0,onTimerEnabledChange:c})=>{const[u,p]=V.useState(1);V.useEffect(()=>{const E=()=>{const O=window.innerWidth/QS,Q=window.innerHeight/JS;p(Math.min(O,Q))};return E(),window.addEventListener("resize",E),()=>window.removeEventListener("resize",E)},[]);const f=250*u,d=350*u,y=2.5*u,S=2*u,P=.9*u,g=.8*u,b=2*u,x=`${10*u}px ${20*u}px`;return l.jsxs("div",{className:"screen",style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"#1a1a2e",color:"white"},children:[l.jsx("h2",{style:{fontSize:`${y}rem`,marginBottom:`${1.5*u}rem`},children:""}),l.jsxs("div",{style:{marginBottom:`${2*u}rem`,display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*u}rem`},children:[l.jsx("label",{style:{fontSize:`${1*u}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif"},children:""}),l.jsx("input",{type:"text",value:i,onChange:E=>o(E.target.value),maxLength:12,placeholder:"",style:{padding:`${8*u}px ${16*u}px`,fontSize:`${1*u}rem`,background:"#2d3748",border:"2px solid #4a5568",borderRadius:8*u,color:"white",outline:"none",width:200*u,textAlign:"center",fontFamily:"Tamanegi, sans-serif"},onFocus:E=>E.target.style.borderColor="#63b3ed",onBlur:E=>E.target.style.borderColor="#4a5568"})]}),l.jsxs("div",{style:{display:"flex",gap:`${b}rem`,marginBottom:`${3*u}rem`},children:[l.jsxs("div",{onClick:()=>t("SENKA"),style:{width:f,height:d,border:"1px solid #444",borderRadius:12*u,background:"linear-gradient(180deg, #2c0b0e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s",boxShadow:"0 4px 20px rgba(233, 69, 96, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:E=>E.currentTarget.style.transform="scale(1.05)",onMouseOut:E=>E.currentTarget.style.transform="scale(1)",children:[l.jsx("img",{src:KS,alt:"Senka",style:{width:"100%",height:"60%",objectFit:"cover"}}),l.jsxs("div",{style:{padding:`${10*u}px`,display:"flex",flexDirection:"column",alignItems:"center"},children:[l.jsx("h3",{style:{fontSize:`${S}rem`,color:"#e94560",margin:0},children:""}),l.jsx("p",{style:{color:"#aaa",margin:`${5*u}px 0`,fontSize:`${P}rem`,fontFamily:"Tamanegi, sans-serif"},children:" / "}),l.jsxs("p",{style:{padding:`0 ${1*u}rem`,textAlign:"center",fontSize:`${g}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif"},children:["",l.jsx("br",{}),""]})]})]}),l.jsxs("div",{onClick:()=>t("AJA"),style:{width:f,height:d,border:"1px solid #444",borderRadius:12*u,background:"linear-gradient(180deg, #0f1c2e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s",boxShadow:"0 4px 20px rgba(69, 162, 233, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:E=>E.currentTarget.style.transform="scale(1.05)",onMouseOut:E=>E.currentTarget.style.transform="scale(1)",children:[l.jsx("img",{src:YS,alt:"Azya",style:{width:"100%",height:"60%",objectFit:"cover"}}),l.jsxs("div",{style:{padding:`${10*u}px`,display:"flex",flexDirection:"column",alignItems:"center"},children:[l.jsx("h3",{style:{fontSize:`${S}rem`,color:"#45a2e9",margin:0},children:""}),l.jsx("p",{style:{color:"#aaa",margin:`${5*u}px 0`,fontSize:`${P}rem`,fontFamily:"Tamanegi, sans-serif"},children:" / "}),l.jsxs("p",{style:{padding:`0 ${1*u}rem`,textAlign:"center",fontSize:`${g}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif"},children:["",l.jsx("br",{}),""]})]})]})]}),n==="CPU"&&s&&l.jsxs("div",{style:{marginBottom:`${2*u}rem`,display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*u}rem`},children:[l.jsx("p",{style:{fontSize:`${1*u}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",marginBottom:`${.5*u}rem`},children:""}),l.jsx("div",{style:{display:"flex",gap:`${1*u}rem`},children:["EASY","NORMAL","HARD"].map(E=>l.jsx("button",{onClick:()=>s(E),style:{padding:`${8*u}px ${20*u}px`,fontSize:`${.9*u}rem`,background:r===E?E==="EASY"?"#48bb78":E==="NORMAL"?"#e94560":"#9f7aea":"transparent",border:`2px solid ${E==="EASY"?"#48bb78":E==="NORMAL"?"#e94560":"#9f7aea"}`,color:"#fff",cursor:"pointer",borderRadius:4*u,fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s"},children:E==="EASY"?"":E==="NORMAL"?"":""},E))}),l.jsxs("p",{style:{fontSize:`${.75*u}rem`,opacity:.6,fontFamily:"Tamanegi, sans-serif",marginTop:`${.3*u}rem`},children:[r==="EASY"&&"CPU",r==="NORMAL"&&"CPU",r==="HARD"&&"CPU"]})]}),c&&l.jsxs("div",{style:{marginBottom:`${2*u}rem`,display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*u}rem`},children:[l.jsx("p",{style:{fontSize:`${1*u}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",marginBottom:`${.5*u}rem`},children:""}),l.jsxs("div",{style:{display:"flex",gap:`${1*u}rem`},children:[l.jsx("button",{onClick:()=>c(!0),style:{padding:`${8*u}px ${20*u}px`,fontSize:`${.9*u}rem`,background:a?"#3182ce":"transparent",border:"2px solid #3182ce",color:"#fff",cursor:"pointer",borderRadius:4*u,fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s"},children:"ON (60)"}),l.jsx("button",{onClick:()=>c(!1),style:{padding:`${8*u}px ${20*u}px`,fontSize:`${.9*u}rem`,background:a?"transparent":"#718096",border:"2px solid #718096",color:"#fff",cursor:"pointer",borderRadius:4*u,fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s"},children:"OFF"})]}),l.jsx("p",{style:{fontSize:`${.75*u}rem`,opacity:.6,fontFamily:"Tamanegi, sans-serif",marginTop:`${.3*u}rem`},children:a?"600":""})]}),l.jsx("button",{onClick:e,style:{background:"#333",padding:x,fontSize:`${1*u}rem`,marginBottom:`${1.5*u}rem`},children:""}),l.jsxs("div",{onClick:()=>t("YORUKA"),style:{position:"absolute",bottom:20*u,right:20*u,display:"flex",flexDirection:"column",alignItems:"center",cursor:"pointer",opacity:.6},children:[l.jsx("img",{src:XS,alt:"?",style:{width:80*u,height:80*u,objectFit:"contain"}}),l.jsx("div",{style:{marginTop:8*u,padding:`${4*u}px ${10*u}px`,background:"rgba(0, 0, 0, 0.7)",borderRadius:8*u,fontSize:`${.7*u}rem`,color:"#e2e8f0",fontFamily:"Tamanegi, sans-serif",whiteSpace:"nowrap"},children:"AI"})]})]})};class ZS{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(e){this.flush(),this._parts.push(e)}append(e){this._pieces.push(e)}flush(){if(this._pieces.length>0){const e=new Uint8Array(this._pieces);this._parts.push(e),this._pieces=[]}}toArrayBuffer(){const e=[];for(const n of this._parts)e.push(n);return e2(e).buffer}}function e2(t){let e=0;for(const s of t)e+=s.byteLength;const n=new Uint8Array(e);let r=0;for(const s of t){const i=new Uint8Array(s.buffer,s.byteOffset,s.byteLength);n.set(i,r),r+=s.byteLength}return n}function __(t){return new t2(t).unpack()}function x_(t){const e=new n2,n=e.pack(t);return n instanceof Promise?n.then(()=>e.getBuffer()):e.getBuffer()}class t2{constructor(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){const e=this.unpack_uint8();if(e<128)return e;if((e^224)<32)return(e^224)-32;let n;if((n=e^160)<=15)return this.unpack_raw(n);if((n=e^176)<=15)return this.unpack_string(n);if((n=e^144)<=15)return this.unpack_array(n);if((n=e^128)<=15)return this.unpack_map(n);switch(e){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return n=this.unpack_uint16(),this.unpack_string(n);case 217:return n=this.unpack_uint32(),this.unpack_string(n);case 218:return n=this.unpack_uint16(),this.unpack_raw(n);case 219:return n=this.unpack_uint32(),this.unpack_raw(n);case 220:return n=this.unpack_uint16(),this.unpack_array(n);case 221:return n=this.unpack_uint32(),this.unpack_array(n);case 222:return n=this.unpack_uint16(),this.unpack_map(n);case 223:return n=this.unpack_uint32(),this.unpack_map(n)}}unpack_uint8(){const e=this.dataView[this.index]&255;return this.index++,e}unpack_uint16(){const e=this.read(2),n=(e[0]&255)*256+(e[1]&255);return this.index+=2,n}unpack_uint32(){const e=this.read(4),n=((e[0]*256+e[1])*256+e[2])*256+e[3];return this.index+=4,n}unpack_uint64(){const e=this.read(8),n=((((((e[0]*256+e[1])*256+e[2])*256+e[3])*256+e[4])*256+e[5])*256+e[6])*256+e[7];return this.index+=8,n}unpack_int8(){const e=this.unpack_uint8();return e<128?e:e-256}unpack_int16(){const e=this.unpack_uint16();return e<32768?e:e-65536}unpack_int32(){const e=this.unpack_uint32();return e<2**31?e:e-2**32}unpack_int64(){const e=this.unpack_uint64();return e<2**63?e:e-2**64}unpack_raw(e){if(this.length<this.index+e)throw new Error(`BinaryPackFailure: index is out of range ${this.index} ${e} ${this.length}`);const n=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,n}unpack_string(e){const n=this.read(e);let r=0,s="",i,o;for(;r<e;)i=n[r],i<160?(o=i,r++):(i^192)<32?(o=(i&31)<<6|n[r+1]&63,r+=2):(i^224)<16?(o=(i&15)<<12|(n[r+1]&63)<<6|n[r+2]&63,r+=3):(o=(i&7)<<18|(n[r+1]&63)<<12|(n[r+2]&63)<<6|n[r+3]&63,r+=4),s+=String.fromCodePoint(o);return this.index+=e,s}unpack_array(e){const n=new Array(e);for(let r=0;r<e;r++)n[r]=this.unpack();return n}unpack_map(e){const n={};for(let r=0;r<e;r++){const s=this.unpack();n[s]=this.unpack()}return n}unpack_float(){const e=this.unpack_uint32(),n=e>>31,r=(e>>23&255)-127,s=e&8388607|8388608;return(n===0?1:-1)*s*2**(r-23)}unpack_double(){const e=this.unpack_uint32(),n=this.unpack_uint32(),r=e>>31,s=(e>>20&2047)-1023,o=(e&1048575|1048576)*2**(s-20)+n*2**(s-52);return(r===0?1:-1)*o}read(e){const n=this.index;if(n+e<=this.length)return this.dataView.subarray(n,n+e);throw new Error("BinaryPackFailure: read index out of range")}}class n2{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(e){if(typeof e=="string")this.pack_string(e);else if(typeof e=="number")Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if(typeof e=="boolean")e===!0?this._bufferBuilder.append(195):e===!1&&this._bufferBuilder.append(194);else if(e===void 0)this._bufferBuilder.append(192);else if(typeof e=="object")if(e===null)this._bufferBuilder.append(192);else{const n=e.constructor;if(e instanceof Array){const r=this.pack_array(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else if(e instanceof ArrayBuffer)this.pack_bin(new Uint8Array(e));else if("BYTES_PER_ELEMENT"in e){const r=e;this.pack_bin(new Uint8Array(r.buffer,r.byteOffset,r.byteLength))}else if(e instanceof Date)this.pack_string(e.toString());else{if(e instanceof Blob)return e.arrayBuffer().then(r=>{this.pack_bin(new Uint8Array(r)),this._bufferBuilder.flush()});if(n==Object||n.toString().startsWith("class")){const r=this.pack_object(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else throw new Error(`Type "${n.toString()}" not yet supported`)}}else throw new Error(`Type "${typeof e}" not yet supported`);this._bufferBuilder.flush()}pack_bin(e){const n=e.length;if(n<=15)this.pack_uint8(160+n);else if(n<=65535)this._bufferBuilder.append(218),this.pack_uint16(n);else if(n<=4294967295)this._bufferBuilder.append(219),this.pack_uint32(n);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(e)}pack_string(e){const n=this._textEncoder.encode(e),r=n.length;if(r<=15)this.pack_uint8(176+r);else if(r<=65535)this._bufferBuilder.append(216),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(217),this.pack_uint32(r);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(n)}pack_array(e){const n=e.length;if(n<=15)this.pack_uint8(144+n);else if(n<=65535)this._bufferBuilder.append(220),this.pack_uint16(n);else if(n<=4294967295)this._bufferBuilder.append(221),this.pack_uint32(n);else throw new Error("Invalid length");const r=s=>{if(s<n){const i=this.pack(e[s]);return i instanceof Promise?i.then(()=>r(s+1)):r(s+1)}};return r(0)}pack_integer(e){if(e>=-32&&e<=127)this._bufferBuilder.append(e&255);else if(e>=0&&e<=255)this._bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&e<=127)this._bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&e<=65535)this._bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&e<=32767)this._bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&e<=4294967295)this._bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-2147483648&&e<=2147483647)this._bufferBuilder.append(210),this.pack_int32(e);else if(e>=-9223372036854776e3&&e<=9223372036854776e3)this._bufferBuilder.append(211),this.pack_int64(e);else if(e>=0&&e<=18446744073709552e3)this._bufferBuilder.append(207),this.pack_uint64(e);else throw new Error("Invalid integer")}pack_double(e){let n=0;e<0&&(n=1,e=-e);const r=Math.floor(Math.log(e)/Math.LN2),s=e/2**r-1,i=Math.floor(s*2**52),o=2**32,a=n<<31|r+1023<<20|i/o&1048575,c=i%o;this._bufferBuilder.append(203),this.pack_int32(a),this.pack_int32(c)}pack_object(e){const n=Object.keys(e),r=n.length;if(r<=15)this.pack_uint8(128+r);else if(r<=65535)this._bufferBuilder.append(222),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(223),this.pack_uint32(r);else throw new Error("Invalid length");const s=i=>{if(i<n.length){const o=n[i];if(e.hasOwnProperty(o)){this.pack(o);const a=this.pack(e[o]);if(a instanceof Promise)return a.then(()=>s(i+1))}return s(i+1)}};return s(0)}pack_uint8(e){this._bufferBuilder.append(e)}pack_uint16(e){this._bufferBuilder.append(e>>8),this._bufferBuilder.append(e&255)}pack_uint32(e){const n=e&4294967295;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255)}pack_uint64(e){const n=e/4294967296,r=e%2**32;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}pack_int8(e){this._bufferBuilder.append(e&255)}pack_int16(e){this._bufferBuilder.append((e&65280)>>8),this._bufferBuilder.append(e&255)}pack_int32(e){this._bufferBuilder.append(e>>>24&255),this._bufferBuilder.append((e&16711680)>>>16),this._bufferBuilder.append((e&65280)>>>8),this._bufferBuilder.append(e&255)}pack_int64(e){const n=Math.floor(e/4294967296),r=e%2**32;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}constructor(){this._bufferBuilder=new ZS,this._textEncoder=new TextEncoder}}let E_=!0,b_=!0;function Lo(t,e,n){const r=t.match(e);return r&&r.length>=n&&parseFloat(r[n],10)}function Xs(t,e,n){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,s=r.addEventListener;r.addEventListener=function(o,a){if(o!==e)return s.apply(this,arguments);const c=u=>{const p=n(u);p&&(a.handleEvent?a.handleEvent(p):a(p))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,c),s.apply(this,[o,c])};const i=r.removeEventListener;r.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return i.apply(this,arguments);if(!this._eventMap[e].has(a))return i.apply(this,arguments);const c=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,i.apply(this,[o,c])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function r2(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(E_=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function s2(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(b_=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function S_(){if(typeof window=="object"){if(E_)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function lh(t,e){b_&&console.warn(t+" is deprecated, please use "+e+" instead.")}function i2(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const r=n.userAgentData.brands.find(s=>s.brand==="Chromium");if(r)return{browser:"chrome",version:parseInt(r.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(Lo(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(Lo(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(Lo(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=Lo(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function Y0(t){return Object.prototype.toString.call(t)==="[object Object]"}function C_(t){return Y0(t)?Object.keys(t).reduce(function(e,n){const r=Y0(t[n]),s=r?C_(t[n]):t[n],i=r&&!Object.keys(s).length;return s===void 0||i?e:Object.assign(e,{[n]:s})},{}):t}function Df(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?Df(t,t.get(e[r]),n):r.endsWith("Ids")&&e[r].forEach(s=>{Df(t,t.get(s),n)})}))}function K0(t,e,n){const r=n?"outbound-rtp":"inbound-rtp",s=new Map;if(e===null)return s;const i=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&i.push(o)}),i.forEach(o=>{t.forEach(a=>{a.type===r&&a.trackId===o.id&&Df(t,a,s)})}),s}const X0=S_;function T_(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const r=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const c={};return Object.keys(a).forEach(u=>{if(u==="require"||u==="advanced"||u==="mediaSource")return;const p=typeof a[u]=="object"?a[u]:{ideal:a[u]};p.exact!==void 0&&typeof p.exact=="number"&&(p.min=p.max=p.exact);const f=function(d,y){return d?d+y.charAt(0).toUpperCase()+y.slice(1):y==="deviceId"?"sourceId":y};if(p.ideal!==void 0){c.optional=c.optional||[];let d={};typeof p.ideal=="number"?(d[f("min",u)]=p.ideal,c.optional.push(d),d={},d[f("max",u)]=p.ideal,c.optional.push(d)):(d[f("",u)]=p.ideal,c.optional.push(d))}p.exact!==void 0&&typeof p.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[f("",u)]=p.exact):["min","max"].forEach(d=>{p[d]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[f(d,u)]=p[d])})}),a.advanced&&(c.optional=(c.optional||[]).concat(a.advanced)),c},s=function(a,c){if(e.version>=61)return c(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const u=function(p,f,d){f in p&&!(d in p)&&(p[d]=p[f],delete p[f])};a=JSON.parse(JSON.stringify(a)),u(a.audio,"autoGainControl","googAutoGainControl"),u(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=r(a.audio)}if(a&&typeof a.video=="object"){let u=a.video.facingMode;u=u&&(typeof u=="object"?u:{ideal:u});const p=e.version<66;if(u&&(u.exact==="user"||u.exact==="environment"||u.ideal==="user"||u.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!p)){delete a.video.facingMode;let f;if(u.exact==="environment"||u.ideal==="environment"?f=["back","rear"]:(u.exact==="user"||u.ideal==="user")&&(f=["front"]),f)return n.mediaDevices.enumerateDevices().then(d=>{d=d.filter(S=>S.kind==="videoinput");let y=d.find(S=>f.some(P=>S.label.toLowerCase().includes(P)));return!y&&d.length&&f.includes("back")&&(y=d[d.length-1]),y&&(a.video.deviceId=u.exact?{exact:y.deviceId}:{ideal:y.deviceId}),a.video=r(a.video),X0("chrome: "+JSON.stringify(a)),c(a)})}a.video=r(a.video)}return X0("chrome: "+JSON.stringify(a)),c(a)},i=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,c,u){s(a,p=>{n.webkitGetUserMedia(p,c,f=>{u&&u(i(f))})})};if(n.getUserMedia=o.bind(n),n.mediaDevices.getUserMedia){const a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return s(c,u=>a(u).then(p=>{if(u.audio&&!p.getAudioTracks().length||u.video&&!p.getVideoTracks().length)throw p.getTracks().forEach(f=>{f.stop()}),new DOMException("","NotFoundError");return p},p=>Promise.reject(i(p))))}}}function I_(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function k_(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",s=>{let i;t.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(a=>a.track&&a.track.id===s.track.id):i={track:s.track};const o=new Event("track");o.track=s.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[r.stream],this.dispatchEvent(o)}),r.stream.getTracks().forEach(s=>{let i;t.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(a=>a.track&&a.track.id===s.id):i={track:s};const o=new Event("track");o.track=s,o.receiver=i,o.transceiver={receiver:i},o.streams=[r.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Xs(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function w_(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(s,i){return{track:i,get dtmf(){return this._dtmf===void 0&&(i.kind==="audio"?this._dtmf=s.createDTMFSender(i):this._dtmf=null),this._dtmf},_pc:s}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const s=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,c){let u=s.apply(this,arguments);return u||(u=e(this,a),this._senders.push(u)),u};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){i.apply(this,arguments);const c=this._senders.indexOf(a);c!==-1&&this._senders.splice(c,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],n.apply(this,[i]),i.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach(o=>{const a=this._senders.find(c=>c.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function R_(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=n.apply(this,[]);return i.forEach(o=>o._pc=this),i});const r=t.RTCPeerConnection.prototype.addTrack;r&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=r.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){const i=this;return this._pc.getStats().then(o=>K0(o,i.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const s=n.apply(this,[]);return s.forEach(i=>i._pc=this),s}),Xs(t,"track",r=>(r.receiver._pc=r.srcElement,r)),t.RTCRtpReceiver.prototype.getStats=function(){const s=this;return this._pc.getStats().then(i=>K0(i,s.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const r=arguments[0];let s,i,o;return this.getSenders().forEach(a=>{a.track===r&&(s?o=!0:s=a)}),this.getReceivers().forEach(a=>(a.track===r&&(i?o=!0:i=a),a.track===r)),o||s&&i?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function A_(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(c)===-1&&this._shimmedLocalStreams[a.id].push(c):this._shimmedLocalStreams[a.id]=[a,c],c};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(u=>{if(this.getSenders().find(f=>f.track===u))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(u=>a.indexOf(u)===-1);this._shimmedLocalStreams[o.id]=[o].concat(c)};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],r.apply(this,arguments)};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const c=this._shimmedLocalStreams[a].indexOf(o);c!==-1&&this._shimmedLocalStreams[a].splice(c,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),s.apply(this,arguments)}}function P_(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return A_(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const p=n.apply(this);return this._reverseStreams=this._reverseStreams||{},p.map(f=>this._reverseStreams[f.id])};const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(p){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},p.getTracks().forEach(f=>{if(this.getSenders().find(y=>y.track===f))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[p.id]){const f=new t.MediaStream(p.getTracks());this._streams[p.id]=f,this._reverseStreams[f.id]=p,p=f}r.apply(this,[p])};const s=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(p){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[p.id]||p]),delete this._reverseStreams[this._streams[p.id]?this._streams[p.id].id:p.id],delete this._streams[p.id]},t.RTCPeerConnection.prototype.addTrack=function(p,f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const d=[].slice.call(arguments,1);if(d.length!==1||!d[0].getTracks().find(P=>P===p))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(P=>P.track===p))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const S=this._streams[f.id];if(S)S.addTrack(p),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const P=new t.MediaStream([p]);this._streams[f.id]=P,this._reverseStreams[P.id]=f,this.addStream(P)}return this.getSenders().find(P=>P.track===p)};function i(u,p){let f=p.sdp;return Object.keys(u._reverseStreams||[]).forEach(d=>{const y=u._reverseStreams[d],S=u._streams[y.id];f=f.replace(new RegExp(S.id,"g"),y.id)}),new RTCSessionDescription({type:p.type,sdp:f})}function o(u,p){let f=p.sdp;return Object.keys(u._reverseStreams||[]).forEach(d=>{const y=u._reverseStreams[d],S=u._streams[y.id];f=f.replace(new RegExp(y.id,"g"),S.id)}),new RTCSessionDescription({type:p.type,sdp:f})}["createOffer","createAnswer"].forEach(function(u){const p=t.RTCPeerConnection.prototype[u],f={[u](){const d=arguments;return arguments.length&&typeof arguments[0]=="function"?p.apply(this,[S=>{const P=i(this,S);d[0].apply(null,[P])},S=>{d[1]&&d[1].apply(null,S)},arguments[2]]):p.apply(this,arguments).then(S=>i(this,S))}};t.RTCPeerConnection.prototype[u]=f[u]});const a=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const u=c.get.apply(this);return u.type===""?u:i(this,u)}}),t.RTCPeerConnection.prototype.removeTrack=function(p){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!p._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(p._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let d;Object.keys(this._streams).forEach(y=>{this._streams[y].getTracks().find(P=>p.track===P)&&(d=this._streams[y])}),d&&(d.getTracks().length===1?this.removeStream(this._reverseStreams[d.id]):d.removeTrack(p.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Mf(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=t.RTCPeerConnection.prototype[n],s={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=s[n]})}function O_(t,e){Xs(t,"negotiationneeded",n=>{const r=n.target;if(!((e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return n})}const Q0=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:O_,shimAddTrackRemoveTrack:P_,shimAddTrackRemoveTrackWithNative:A_,shimGetSendersWithDtmf:w_,shimGetUserMedia:T_,shimMediaStream:I_,shimOnTrack:k_,shimPeerConnection:Mf,shimSenderReceiverGetStats:R_},Symbol.toStringTag,{value:"Module"}));function L_(t,e){const n=t&&t.navigator,r=t&&t.MediaStreamTrack;if(n.getUserMedia=function(s,i,o){lh("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(s).then(i,o)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const s=function(o,a,c){a in o&&!(c in o)&&(o[c]=o[a],delete o[a])},i=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),s(o.audio,"autoGainControl","mozAutoGainControl"),s(o.audio,"noiseSuppression","mozNoiseSuppression")),i(o)},r&&r.prototype.getSettings){const o=r.prototype.getSettings;r.prototype.getSettings=function(){const a=o.apply(this,arguments);return s(a,"mozAutoGainControl","autoGainControl"),s(a,"mozNoiseSuppression","noiseSuppression"),a}}if(r&&r.prototype.applyConstraints){const o=r.prototype.applyConstraints;r.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),s(a,"autoGainControl","mozAutoGainControl"),s(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function o2(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,Promise.reject(s)}return r.video===!0?r.video={mediaSource:e}:r.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(r)})}function D_(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Nf(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const i=t.RTCPeerConnection.prototype[s],o={[s](){return arguments[0]=new(s==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[s]=o[s]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[i,o,a]=arguments;return r.apply(this,[i||null]).then(c=>{if(e.version<53&&!o)try{c.forEach(u=>{u.type=n[u.type]||u.type})}catch(u){if(u.name!=="TypeError")throw u;c.forEach((p,f)=>{c.set(f,Object.assign({},p,{type:n[p.type]||p.type}))})}return c}).then(o,a)}}function M_(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=e.apply(this,[]);return s.forEach(i=>i._pc=this),s});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=n.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function N_(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r}),Xs(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function j_(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){lh("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&n.getTracks().includes(r.track)&&this.removeTrack(r)})})}function F_(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function $_(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const s=r.length>0;s&&r.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=e.apply(this,arguments);if(s){const{sender:o}=i,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=r,o.sendEncodings=r,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return i})}function B_(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const r=e.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function U_(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function z_(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}const J0=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:$_,shimCreateAnswer:z_,shimCreateOffer:U_,shimGetDisplayMedia:o2,shimGetParameters:B_,shimGetUserMedia:L_,shimOnTrack:D_,shimPeerConnection:Nf,shimRTCDataChannel:F_,shimReceiverGetStats:N_,shimRemoveStream:j_,shimSenderGetStats:M_},Symbol.toStringTag,{value:"Module"}));function H_(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(s=>e.call(this,s,r)),r.getVideoTracks().forEach(s=>e.call(this,s,r))},t.RTCPeerConnection.prototype.addTrack=function(r,...s){return s&&s.forEach(i=>{this._localStreams?this._localStreams.includes(i)||this._localStreams.push(i):this._localStreams=[i]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(n);if(r===-1)return;this._localStreams.splice(r,1);const s=n.getTracks();this.getSenders().forEach(i=>{s.includes(i.track)&&this.removeTrack(i)})})}}function W_(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(s=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(s))return;this._remoteStreams.push(s);const i=new Event("addstream");i.stream=s,this.dispatchEvent(i)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){s.streams.forEach(i=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(i)>=0)return;r._remoteStreams.push(i);const o=new Event("addstream");o.stream=i,r.dispatchEvent(o)})}),e.apply(r,arguments)}}}function G_(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,r=e.createAnswer,s=e.setLocalDescription,i=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(u,p){const f=arguments.length>=2?arguments[2]:arguments[0],d=n.apply(this,[f]);return p?(d.then(u,p),Promise.resolve()):d},e.createAnswer=function(u,p){const f=arguments.length>=2?arguments[2]:arguments[0],d=r.apply(this,[f]);return p?(d.then(u,p),Promise.resolve()):d};let a=function(c,u,p){const f=s.apply(this,[c]);return p?(f.then(u,p),Promise.resolve()):f};e.setLocalDescription=a,a=function(c,u,p){const f=i.apply(this,[c]);return p?(f.then(u,p),Promise.resolve()):f},e.setRemoteDescription=a,a=function(c,u,p){const f=o.apply(this,[c]);return p?(f.then(u,p),Promise.resolve()):f},e.addIceCandidate=a}function V_(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,r=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=s=>r(Y_(s))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(r,s,i){e.mediaDevices.getUserMedia(r).then(s,i)}).bind(e))}function Y_(t){return t&&t.video!==void 0?Object.assign({},t,{video:C_(t.video)}):t}function K_(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(r,s){if(r&&r.iceServers){const i=[];for(let o=0;o<r.iceServers.length;o++){let a=r.iceServers[o];a.urls===void 0&&a.url?(lh("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,i.push(a)):i.push(r.iceServers[o])}r.iceServers=i}return new e(r,s)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function X_(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Q_(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):r.offerToReceiveAudio===!0&&!s&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const i=this.getTransceivers().find(o=>o.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveVideo===!0&&!i&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function J_(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}const q0=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:J_,shimCallbacksAPI:G_,shimConstraints:Y_,shimCreateOfferLegacy:Q_,shimGetUserMedia:V_,shimLocalStreamsAPI:H_,shimRTCIceServerUrls:K_,shimRemoteStreamsAPI:W_,shimTrackEventTransceiver:X_},Symbol.toStringTag,{value:"Module"}));var q_={exports:{}};(function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},e.splitSections=function(n){return n.split(`
m=`).map((s,i)=>(i>0?"m="+s:s).trim()+`\r
`)},e.getDescription=function(n){const r=e.splitSections(n);return r&&r[0]},e.getMediaSections=function(n){const r=e.splitSections(n);return r.shift(),r},e.matchPrefix=function(n,r){return e.splitLines(n).filter(s=>s.indexOf(r)===0)},e.parseCandidate=function(n){let r;n.indexOf("a=candidate:")===0?r=n.substring(12).split(" "):r=n.substring(10).split(" ");const s={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let i=8;i<r.length;i+=2)switch(r[i]){case"raddr":s.relatedAddress=r[i+1];break;case"rport":s.relatedPort=parseInt(r[i+1],10);break;case"tcptype":s.tcpType=r[i+1];break;case"ufrag":s.ufrag=r[i+1],s.usernameFragment=r[i+1];break;default:s[r[i]]===void 0&&(s[r[i]]=r[i+1]);break}return s},e.writeCandidate=function(n){const r=[];r.push(n.foundation);const s=n.component;s==="rtp"?r.push(1):s==="rtcp"?r.push(2):r.push(s),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const i=n.type;return r.push("typ"),r.push(i),i!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let r=n.substring(9).split(" ");const s={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),s.name=r[0],s.clockRate=parseInt(r[1],10),s.channels=r.length===3?parseInt(r[2],10):1,s.numChannels=s.channels,s},e.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const s=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(s!==1?"/"+s:"")+`\r
`},e.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const r={};let s;const i=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<i.length;o++)s=i[o].trim().split("="),r[s[0].trim()]=s[1];return r},e.writeFmtp=function(n){let r="",s=n.payloadType;if(n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const i=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?i.push(o+"="+n.parameters[o]):i.push(o)}),r+="a=fmtp:"+s+" "+i.join(";")+`\r
`}return r},e.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},e.writeRtcpFb=function(n){let r="",s=n.payloadType;return n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(i=>{r+="a=rtcp-fb:"+s+" "+i.type+(i.parameter&&i.parameter.length?" "+i.parameter:"")+`\r
`}),r},e.parseSsrcMedia=function(n){const r=n.indexOf(" "),s={ssrc:parseInt(n.substring(7,r),10)},i=n.indexOf(":",r);return i>-1?(s.attribute=n.substring(r+1,i),s.value=n.substring(i+1)):s.attribute=n.substring(r+1),s},e.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(s=>parseInt(s,10))}},e.getMid=function(n){const r=e.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},e.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:e.matchPrefix(n+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,r){let s="a=setup:"+r+`\r
`;return n.fingerprints.forEach(i=>{s+="a=fingerprint:"+i.algorithm+" "+i.value+`\r
`}),s},e.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,r){return e.matchPrefix(n+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,r){const s=e.matchPrefix(n+r,"a=ice-ufrag:")[0],i=e.matchPrefix(n+r,"a=ice-pwd:")[0];return s&&i?{usernameFragment:s.substring(12),password:i.substring(10)}:null},e.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},e.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=e.splitLines(n)[0].split(" ");r.profile=i[2];for(let a=3;a<i.length;a++){const c=i[a],u=e.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(u){const p=e.parseRtpMap(u),f=e.matchPrefix(n,"a=fmtp:"+c+" ");switch(p.parameters=f.length?e.parseFmtp(f[0]):{},p.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),r.codecs.push(p),p.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(p.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(a=>{r.headerExtensions.push(e.parseExtmap(a))});const o=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(a=>{o.forEach(c=>{a.rtcpFeedback.find(p=>p.type===c.type&&p.parameter===c.parameter)||a.rtcpFeedback.push(c)})}),r},e.writeRtpDescription=function(n,r){let s="";s+="m="+n+" ",s+=r.codecs.length>0?"9":"0",s+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",s+=r.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,s+=`c=IN IP4 0.0.0.0\r
`,s+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(o=>{s+=e.writeRtpMap(o),s+=e.writeFmtp(o),s+=e.writeRtcpFb(o)});let i=0;return r.codecs.forEach(o=>{o.maxptime>i&&(i=o.maxptime)}),i>0&&(s+="a=maxptime:"+i+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(o=>{s+=e.writeExtmap(o)}),s},e.parseRtpEncodingParameters=function(n){const r=[],s=e.parseRtpParameters(n),i=s.fecMechanisms.indexOf("RED")!==-1,o=s.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(n,"a=ssrc:").map(d=>e.parseSsrcMedia(d)).filter(d=>d.attribute==="cname"),c=a.length>0&&a[0].ssrc;let u;const p=e.matchPrefix(n,"a=ssrc-group:FID").map(d=>d.substring(17).split(" ").map(S=>parseInt(S,10)));p.length>0&&p[0].length>1&&p[0][0]===c&&(u=p[0][1]),s.codecs.forEach(d=>{if(d.name.toUpperCase()==="RTX"&&d.parameters.apt){let y={ssrc:c,codecPayloadType:parseInt(d.parameters.apt,10)};c&&u&&(y.rtx={ssrc:u}),r.push(y),i&&(y=JSON.parse(JSON.stringify(y)),y.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},r.push(y))}}),r.length===0&&c&&r.push({ssrc:c});let f=e.matchPrefix(n,"b=");return f.length&&(f[0].indexOf("b=TIAS:")===0?f=parseInt(f[0].substring(7),10):f[0].indexOf("b=AS:")===0?f=parseInt(f[0].substring(5),10)*1e3*.95-50*40*8:f=void 0,r.forEach(d=>{d.maxBitrate=f})),r},e.parseRtcpParameters=function(n){const r={},s=e.matchPrefix(n,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];s&&(r.cname=s.value,r.ssrc=s.ssrc);const i=e.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=i.length>0,r.compound=i.length===0;const o=e.matchPrefix(n,"a=rtcp-mux");return r.mux=o.length>0,r},e.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},e.parseMsid=function(n){let r;const s=e.matchPrefix(n,"a=msid:");if(s.length===1)return r=s[0].substring(7).split(" "),{stream:r[0],track:r[1]};const i=e.matchPrefix(n,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(i.length>0)return r=i[0].value.split(" "),{stream:r[0],track:r[1]}},e.parseSctpDescription=function(n){const r=e.parseMLine(n),s=e.matchPrefix(n,"a=max-message-size:");let i;s.length>0&&(i=parseInt(s[0].substring(19),10)),isNaN(i)&&(i=65536);const o=e.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:r.fmt,maxMessageSize:i};const a=e.matchPrefix(n,"a=sctpmap:");if(a.length>0){const c=a[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:i}}},e.writeSctpDescription=function(n,r){let s=[];return n.protocol!=="DTLS/SCTP"?s=["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:s=["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&s.push("a=max-message-size:"+r.maxMessageSize+`\r
`),s.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,r,s){let i;const o=r!==void 0?r:2;return n?i=n:i=e.generateSessionId(),`v=0\r
o=`+(s||"thisisadapterortc")+" "+i+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,r){const s=e.splitLines(n);for(let i=0;i<s.length;i++)switch(s[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[i].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const s=e.splitLines(n)[0].substring(2).split(" ");return{kind:s[0],port:parseInt(s[1],10),protocol:s[2],fmt:s.slice(3).join(" ")}},e.parseOLine=function(n){const s=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:s[0],sessionId:s[1],sessionVersion:parseInt(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=e.splitLines(n);for(let s=0;s<r.length;s++)if(r[s].length<2||r[s].charAt(1)!=="=")return!1;return!0},t.exports=e})(q_);var Z_=q_.exports;const Li=oy(Z_),a2=mE({__proto__:null,default:Li},[Z_]);function Gl(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const s=new e(r),i=Li.parseCandidate(r.candidate);for(const o in i)o in s||Object.defineProperty(s,o,{value:i[o]});return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new e(r)},t.RTCIceCandidate.prototype=e.prototype,Xs(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function jf(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Xs(t,"icecandidate",e=>{if(e.candidate){const n=Li.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function Vl(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(a){if(!a||!a.sdp)return!1;const c=Li.splitSections(a.sdp);return c.shift(),c.some(u=>{const p=Li.parseMLine(u);return p&&p.kind==="application"&&p.protocol.indexOf("SCTP")!==-1})},r=function(a){const c=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const u=parseInt(c[1],10);return u!==u?-1:u},s=function(a){let c=65536;return e.browser==="firefox"&&(e.version<57?a===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},i=function(a,c){let u=65536;e.browser==="firefox"&&e.version===57&&(u=65535);const p=Li.matchPrefix(a.sdp,"a=max-message-size:");return p.length>0?u=parseInt(p[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(u=2147483637),u},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=r(arguments[0]),u=s(c),p=i(arguments[0],c);let f;u===0&&p===0?f=Number.POSITIVE_INFINITY:u===0||p===0?f=Math.max(u,p):f=Math.min(u,p);const d={};Object.defineProperty(d,"maxMessageSize",{get(){return f}}),this._sctp=d}return o.apply(this,arguments)}}function Yl(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(r,s){const i=r.send;r.send=function(){const a=arguments[0],c=a.length||a.size||a.byteLength;if(r.readyState==="open"&&s.sctp&&c>s.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+s.sctp.maxMessageSize+" bytes)");return i.apply(r,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const s=n.apply(this,arguments);return e(s,this),s},Xs(t,"datachannel",r=>(e(r.channel,r.target),r))}function Ff(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=s=>{const i=s.target;if(i._lastConnectionState!==i.connectionState){i._lastConnectionState=i.connectionState;const o=new Event("connectionstatechange",s);i.dispatchEvent(o)}return s},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function $f(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(s){if(s&&s.sdp&&s.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i=s.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&s instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:s.type,sdp:i}):s.sdp=i}return n.apply(this,arguments)}}function Kl(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Xl(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let s=arguments[0]||{};if(typeof s!="object"||s.type&&s.sdp)return n.apply(this,arguments);if(s={type:s.type,sdp:s.sdp},!s.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":s.type="offer";break;default:s.type="answer";break}return s.sdp||s.type!=="offer"&&s.type!=="answer"?n.apply(this,[s]):(s.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}const l2=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:$f,shimAddIceCandidateNullOrEmpty:Kl,shimConnectionState:Ff,shimMaxMessageSize:Vl,shimParameterlessSetLocalDescription:Xl,shimRTCIceCandidate:Gl,shimRTCIceCandidateRelayProtocol:jf,shimSendThrowTypeError:Yl},Symbol.toStringTag,{value:"Module"}));function c2({window:t}={},e={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const n=S_,r=i2(t),s={browserDetails:r,commonShim:l2,extractVersion:Lo,disableLog:r2,disableWarnings:s2,sdp:a2};switch(r.browser){case"chrome":if(!Q0||!Mf||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),s;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),s;n("adapter.js shimming chrome."),s.browserShim=Q0,Kl(t,r),Xl(t),T_(t,r),I_(t),Mf(t,r),k_(t),P_(t,r),w_(t),R_(t),O_(t,r),Gl(t),jf(t),Ff(t),Vl(t,r),Yl(t),$f(t,r);break;case"firefox":if(!J0||!Nf||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),s;n("adapter.js shimming firefox."),s.browserShim=J0,Kl(t,r),Xl(t),L_(t,r),Nf(t,r),D_(t),j_(t),M_(t),N_(t),F_(t),$_(t),B_(t),U_(t),z_(t),Gl(t),Ff(t),Vl(t,r),Yl(t);break;case"safari":if(!q0||!e.shimSafari)return n("Safari shim is not included in this adapter release."),s;n("adapter.js shimming safari."),s.browserShim=q0,Kl(t,r),Xl(t),K_(t),Q_(t),G_(t),H_(t),W_(t),X_(t),V_(t),J_(t),Gl(t),jf(t),Vl(t,r),Yl(t),$f(t,r);break;default:n("Unsupported browser!");break}return s}const Z0=c2({window:typeof window>"u"?void 0:window});function Qs(t,e,n,r){Object.defineProperty(t,e,{get:n,set:r,enumerable:!0,configurable:!0})}class e1{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=e=>{const n=[],r=e.byteLength,s=Math.ceil(r/this.chunkedMTU);let i=0,o=0;for(;o<r;){const a=Math.min(r,o+this.chunkedMTU),c=e.slice(o,a),u={__peerData:this._dataCount,n:i,data:c,total:s};n.push(u),o=a,i++}return this._dataCount++,n}}}function u2(t){let e=0;for(const s of t)e+=s.byteLength;const n=new Uint8Array(e);let r=0;for(const s of t)n.set(s,r),r+=s.byteLength;return n}const Td=Z0.default||Z0,Co=new class{isWebRTCSupported(){return typeof RTCPeerConnection<"u"}isBrowserSupported(){const t=this.getBrowser(),e=this.getVersion();return this.supportedBrowsers.includes(t)?t==="chrome"?e>=this.minChromeVersion:t==="firefox"?e>=this.minFirefoxVersion:t==="safari"?!this.isIOS&&e>=this.minSafariVersion:!1:!1}getBrowser(){return Td.browserDetails.browser}getVersion(){return Td.browserDetails.version||0}isUnifiedPlanSupported(){const t=this.getBrowser(),e=Td.browserDetails.version||0;if(t==="chrome"&&e<this.minChromeVersion)return!1;if(t==="firefox"&&e>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let n,r=!1;try{n=new RTCPeerConnection,n.addTransceiver("audio"),r=!0}catch{}finally{n&&n.close()}return r}toString(){return`Supports:
    browser:${this.getBrowser()}
    version:${this.getVersion()}
    isIOS:${this.isIOS}
    isWebRTCSupported:${this.isWebRTCSupported()}
    isBrowserSupported:${this.isBrowserSupported()}
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS=typeof navigator<"u"?["iPad","iPhone","iPod"].includes(navigator.platform):!1,this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},d2=t=>!t||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(t),t1=()=>Math.random().toString(36).slice(2),em={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};class f2 extends e1{noop(){}blobToArrayBuffer(e,n){const r=new FileReader;return r.onload=function(s){s.target&&n(s.target.result)},r.readAsArrayBuffer(e),r}binaryStringToArrayBuffer(e){const n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r)&255;return n.buffer}isSecure(){return location.protocol==="https:"}constructor(...e){super(...e),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=em,this.browser=Co.getBrowser(),this.browserVersion=Co.getVersion(),this.pack=x_,this.unpack=__,this.supports=function(){const n={browser:Co.isBrowserSupported(),webRTC:Co.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!n.webRTC)return n;let r;try{r=new RTCPeerConnection(em),n.audioVideo=!0;let s;try{s=r.createDataChannel("_PEERJSTEST",{ordered:!0}),n.data=!0,n.reliable=!!s.ordered;try{s.binaryType="blob",n.binaryBlob=!Co.isIOS}catch{}}catch{}finally{s&&s.close()}}catch{}finally{r&&r.close()}return n}(),this.validateId=d2,this.randomToken=t1}}const mn=new f2,p2="PeerJS: ";class h2{get logLevel(){return this._logLevel}set logLevel(e){this._logLevel=e}log(...e){this._logLevel>=3&&this._print(3,...e)}warn(...e){this._logLevel>=2&&this._print(2,...e)}error(...e){this._logLevel>=1&&this._print(1,...e)}setLogFunction(e){this._print=e}_print(e,...n){const r=[p2,...n];for(const s in r)r[s]instanceof Error&&(r[s]="("+r[s].name+") "+r[s].message);e>=3?console.log(...r):e>=2?console.warn("WARNING",...r):e>=1&&console.error("ERROR",...r)}constructor(){this._logLevel=0}}var be=new h2,ch={},g2=Object.prototype.hasOwnProperty,dn="~";function ha(){}Object.create&&(ha.prototype=Object.create(null),new ha().__proto__||(dn=!1));function m2(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function n1(t,e,n,r,s){if(typeof n!="function")throw new TypeError("The listener must be a function");var i=new m2(n,r||t,s),o=dn?dn+e:e;return t._events[o]?t._events[o].fn?t._events[o]=[t._events[o],i]:t._events[o].push(i):(t._events[o]=i,t._eventsCount++),t}function Ql(t,e){--t._eventsCount===0?t._events=new ha:delete t._events[e]}function nn(){this._events=new ha,this._eventsCount=0}nn.prototype.eventNames=function(){var e=[],n,r;if(this._eventsCount===0)return e;for(r in n=this._events)g2.call(n,r)&&e.push(dn?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(n)):e};nn.prototype.listeners=function(e){var n=dn?dn+e:e,r=this._events[n];if(!r)return[];if(r.fn)return[r.fn];for(var s=0,i=r.length,o=new Array(i);s<i;s++)o[s]=r[s].fn;return o};nn.prototype.listenerCount=function(e){var n=dn?dn+e:e,r=this._events[n];return r?r.fn?1:r.length:0};nn.prototype.emit=function(e,n,r,s,i,o){var a=dn?dn+e:e;if(!this._events[a])return!1;var c=this._events[a],u=arguments.length,p,f;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,n),!0;case 3:return c.fn.call(c.context,n,r),!0;case 4:return c.fn.call(c.context,n,r,s),!0;case 5:return c.fn.call(c.context,n,r,s,i),!0;case 6:return c.fn.call(c.context,n,r,s,i,o),!0}for(f=1,p=new Array(u-1);f<u;f++)p[f-1]=arguments[f];c.fn.apply(c.context,p)}else{var d=c.length,y;for(f=0;f<d;f++)switch(c[f].once&&this.removeListener(e,c[f].fn,void 0,!0),u){case 1:c[f].fn.call(c[f].context);break;case 2:c[f].fn.call(c[f].context,n);break;case 3:c[f].fn.call(c[f].context,n,r);break;case 4:c[f].fn.call(c[f].context,n,r,s);break;default:if(!p)for(y=1,p=new Array(u-1);y<u;y++)p[y-1]=arguments[y];c[f].fn.apply(c[f].context,p)}}return!0};nn.prototype.on=function(e,n,r){return n1(this,e,n,r,!1)};nn.prototype.once=function(e,n,r){return n1(this,e,n,r,!0)};nn.prototype.removeListener=function(e,n,r,s){var i=dn?dn+e:e;if(!this._events[i])return this;if(!n)return Ql(this,i),this;var o=this._events[i];if(o.fn)o.fn===n&&(!s||o.once)&&(!r||o.context===r)&&Ql(this,i);else{for(var a=0,c=[],u=o.length;a<u;a++)(o[a].fn!==n||s&&!o[a].once||r&&o[a].context!==r)&&c.push(o[a]);c.length?this._events[i]=c.length===1?c[0]:c:Ql(this,i)}return this};nn.prototype.removeAllListeners=function(e){var n;return e?(n=dn?dn+e:e,this._events[n]&&Ql(this,n)):(this._events=new ha,this._eventsCount=0),this};nn.prototype.off=nn.prototype.removeListener;nn.prototype.addListener=nn.prototype.on;nn.prefixed=dn;nn.EventEmitter=nn;ch=nn;var Js={};Qs(Js,"ConnectionType",()=>ss);Qs(Js,"PeerErrorType",()=>At);Qs(Js,"BaseConnectionErrorType",()=>Bf);Qs(Js,"DataConnectionErrorType",()=>uh);Qs(Js,"SerializationType",()=>ou);Qs(Js,"SocketEventType",()=>Xr);Qs(Js,"ServerMessageType",()=>Zt);var ss=function(t){return t.Data="data",t.Media="media",t}({}),At=function(t){return t.BrowserIncompatible="browser-incompatible",t.Disconnected="disconnected",t.InvalidID="invalid-id",t.InvalidKey="invalid-key",t.Network="network",t.PeerUnavailable="peer-unavailable",t.SslUnavailable="ssl-unavailable",t.ServerError="server-error",t.SocketError="socket-error",t.SocketClosed="socket-closed",t.UnavailableID="unavailable-id",t.WebRTC="webrtc",t}({}),Bf=function(t){return t.NegotiationFailed="negotiation-failed",t.ConnectionClosed="connection-closed",t}({}),uh=function(t){return t.NotOpenYet="not-open-yet",t.MessageToBig="message-too-big",t}({}),ou=function(t){return t.Binary="binary",t.BinaryUTF8="binary-utf8",t.JSON="json",t.None="raw",t}({}),Xr=function(t){return t.Message="message",t.Disconnected="disconnected",t.Error="error",t.Close="close",t}({}),Zt=function(t){return t.Heartbeat="HEARTBEAT",t.Candidate="CANDIDATE",t.Offer="OFFER",t.Answer="ANSWER",t.Open="OPEN",t.Error="ERROR",t.IdTaken="ID-TAKEN",t.InvalidKey="INVALID-KEY",t.Leave="LEAVE",t.Expire="EXPIRE",t}({});const r1="1.5.5";class y2 extends ch.EventEmitter{constructor(e,n,r,s,i,o=5e3){super(),this.pingInterval=o,this._disconnected=!0,this._messagesQueue=[];const a=e?"wss://":"ws://";this._baseUrl=a+n+":"+r+s+"peerjs?key="+i}start(e,n){this._id=e;const r=`${this._baseUrl}&id=${e}&token=${n}`;this._socket||!this._disconnected||(this._socket=new WebSocket(r+"&version="+r1),this._disconnected=!1,this._socket.onmessage=s=>{let i;try{i=JSON.parse(s.data),be.log("Server message received:",i)}catch{be.log("Invalid server message",s.data);return}this.emit(Xr.Message,i)},this._socket.onclose=s=>{this._disconnected||(be.log("Socket closed.",s),this._cleanup(),this._disconnected=!0,this.emit(Xr.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),be.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen()){be.log("Cannot send heartbeat, because socket closed");return}const e=JSON.stringify({type:Zt.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&this._socket.readyState===1}_sendQueuedMessages(){const e=[...this._messagesQueue];this._messagesQueue=[];for(const n of e)this.send(n)}send(e){if(this._disconnected)return;if(!this._id){this._messagesQueue.push(e);return}if(!e.type){this.emit(Xr.Error,"Invalid message");return}if(!this._wsOpen())return;const n=JSON.stringify(e);this._socket.send(n)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}class s1{constructor(e){this.connection=e}startConnection(e){const n=this._startPeerConnection();if(this.connection.peerConnection=n,this.connection.type===ss.Media&&e._stream&&this._addTracksToConnection(e._stream,n),e.originator){const r=this.connection,s={ordered:!!e.reliable},i=n.createDataChannel(r.label,s);r._initializeDataChannel(i),this._makeOffer()}else this.handleSDP("OFFER",e.sdp)}_startPeerConnection(){be.log("Creating RTCPeerConnection.");const e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e}_setupListeners(e){const n=this.connection.peer,r=this.connection.connectionId,s=this.connection.type,i=this.connection.provider;be.log("Listening for ICE candidates."),e.onicecandidate=o=>{!o.candidate||!o.candidate.candidate||(be.log(`Received ICE candidates for ${n}:`,o.candidate),i.socket.send({type:Zt.Candidate,payload:{candidate:o.candidate,type:s,connectionId:r},dst:n}))},e.oniceconnectionstatechange=()=>{switch(e.iceConnectionState){case"failed":be.log("iceConnectionState is failed, closing connections to "+n),this.connection.emitError(Bf.NegotiationFailed,"Negotiation of connection to "+n+" failed."),this.connection.close();break;case"closed":be.log("iceConnectionState is closed, closing connections to "+n),this.connection.emitError(Bf.ConnectionClosed,"Connection to "+n+" closed."),this.connection.close();break;case"disconnected":be.log("iceConnectionState changed to disconnected on the connection with "+n);break;case"completed":e.onicecandidate=()=>{};break}this.connection.emit("iceStateChanged",e.iceConnectionState)},be.log("Listening for data channel"),e.ondatachannel=o=>{be.log("Received data channel");const a=o.channel;i.getConnection(n,r)._initializeDataChannel(a)},be.log("Listening for remote stream"),e.ontrack=o=>{be.log("Received remote stream");const a=o.streams[0],c=i.getConnection(n,r);if(c.type===ss.Media){const u=c;this._addStreamToMediaConnection(a,u)}}}cleanup(){be.log("Cleaning up PeerConnection to "+this.connection.peer);const e=this.connection.peerConnection;if(!e)return;this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=()=>{};const n=e.signalingState!=="closed";let r=!1;const s=this.connection.dataChannel;s&&(r=!!s.readyState&&s.readyState!=="closed"),(n||r)&&e.close()}async _makeOffer(){const e=this.connection.peerConnection,n=this.connection.provider;try{const r=await e.createOffer(this.connection.options.constraints);be.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),be.log("Set localDescription:",r,`for:${this.connection.peer}`);let s={sdp:r,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===ss.Data){const i=this.connection;s={...s,label:i.label,reliable:i.reliable,serialization:i.serialization}}n.socket.send({type:Zt.Offer,payload:s,dst:this.connection.peer})}catch(s){s!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(n.emitError(At.WebRTC,s),be.log("Failed to setLocalDescription, ",s))}}catch(r){n.emitError(At.WebRTC,r),be.log("Failed to createOffer, ",r)}}async _makeAnswer(){const e=this.connection.peerConnection,n=this.connection.provider;try{const r=await e.createAnswer();be.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),be.log("Set localDescription:",r,`for:${this.connection.peer}`),n.socket.send({type:Zt.Answer,payload:{sdp:r,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(s){n.emitError(At.WebRTC,s),be.log("Failed to setLocalDescription, ",s)}}catch(r){n.emitError(At.WebRTC,r),be.log("Failed to create answer, ",r)}}async handleSDP(e,n){n=new RTCSessionDescription(n);const r=this.connection.peerConnection,s=this.connection.provider;be.log("Setting remote description",n);const i=this;try{await r.setRemoteDescription(n),be.log(`Set remoteDescription:${e} for:${this.connection.peer}`),e==="OFFER"&&await i._makeAnswer()}catch(o){s.emitError(At.WebRTC,o),be.log("Failed to setRemoteDescription, ",o)}}async handleCandidate(e){be.log("handleCandidate:",e);try{await this.connection.peerConnection.addIceCandidate(e),be.log(`Added ICE candidate for:${this.connection.peer}`)}catch(n){this.connection.provider.emitError(At.WebRTC,n),be.log("Failed to handleCandidate, ",n)}}_addTracksToConnection(e,n){if(be.log(`add tracks from stream ${e.id} to peer connection`),!n.addTrack)return be.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(r=>{n.addTrack(r,e)})}_addStreamToMediaConnection(e,n){be.log(`add stream ${e.id} to media connection ${n.connectionId}`),n.addStream(e)}}class i1 extends ch.EventEmitter{emitError(e,n){be.error("Error:",n),this.emit("error",new v2(`${e}`,n))}}class v2 extends Error{constructor(e,n){typeof n=="string"?super(n):(super(),Object.assign(this,n)),this.type=e}}class o1 extends i1{get open(){return this._open}constructor(e,n,r){super(),this.peer=e,this.provider=n,this.options=r,this._open=!1,this.metadata=r.metadata}}var cp;const Xo=class Xo extends o1{get type(){return ss.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(e,n,r){super(e,n,r),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||Xo.ID_PREFIX+mn.randomToken(),this._negotiator=new s1(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{be.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{be.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(e){be.log("Receiving stream",e),this._remoteStream=e,super.emit("stream",e)}handleMessage(e){const n=e.type,r=e.payload;switch(e.type){case Zt.Answer:this._negotiator.handleSDP(n,r.sdp),this._open=!0;break;case Zt.Candidate:this._negotiator.handleCandidate(r.candidate);break;default:be.warn(`Unrecognized message type:${n} from peer:${this.peer}`);break}}answer(e,n={}){if(this._localStream){be.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=e,n&&n.sdpTransform&&(this.options.sdpTransform=n.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:e});const r=this.provider._getMessages(this.connectionId);for(const s of r)this.handleMessage(s);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit("close"))}};cp=new WeakMap,go(Xo,cp,Xo.ID_PREFIX="mc_");let Sc=Xo;class _2{constructor(e){this._options=e}_buildRequest(e){const n=this._options.secure?"https":"http",{host:r,port:s,path:i,key:o}=this._options,a=new URL(`${n}://${r}:${s}${i}${o}/${e}`);return a.searchParams.set("ts",`${Date.now()}${Math.random()}`),a.searchParams.set("version",r1),fetch(a.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{const e=await this._buildRequest("id");if(e.status!==200)throw new Error(`Error. Status:${e.status}`);return e.text()}catch(e){be.error("Error retrieving ID",e);let n="";throw this._options.path==="/"&&this._options.host!==mn.CLOUD_HOST&&(n=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+n)}}async listAllPeers(){try{const e=await this._buildRequest("peers");if(e.status!==200){if(e.status===401){let n="";throw this._options.host===mn.CLOUD_HOST?n="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":n="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+n)}throw new Error(`Error. Status:${e.status}`)}return e.json()}catch(e){throw be.error("Error retrieving list peers",e),new Error("Could not get list peers from the server."+e)}}}var up,dp;const Rs=class Rs extends o1{get type(){return ss.Data}constructor(e,n,r){super(e,n,r),this.connectionId=this.options.connectionId||Rs.ID_PREFIX+t1(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new s1(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{be.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=n=>{be.log(`DC#${this.connectionId} dc onmessage:`,n.data)},this.dataChannel.onclose=()=>{be.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(e){if(e!=null&&e.flush){this.send({__peerData:{type:"close"}});return}this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null),this.open&&(this._open=!1,super.emit("close"))}send(e,n=!1){if(!this.open){this.emitError(uh.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.");return}return this._send(e,n)}async handleMessage(e){const n=e.payload;switch(e.type){case Zt.Answer:await this._negotiator.handleSDP(e.type,n.sdp);break;case Zt.Candidate:await this._negotiator.handleCandidate(n.candidate);break;default:be.warn("Unrecognized message type:",e.type,"from peer:",this.peer);break}}};up=new WeakMap,dp=new WeakMap,go(Rs,up,Rs.ID_PREFIX="dc_"),go(Rs,dp,Rs.MAX_BUFFERED_AMOUNT=8388608);let Cc=Rs;class dh extends Cc{get bufferSize(){return this._bufferSize}_initializeDataChannel(e){super._initializeDataChannel(e),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",n=>this._handleDataMessage(n))}_bufferedSend(e){(this._buffering||!this._trySend(e))&&(this._buffer.push(e),this._bufferSize=this._buffer.length)}_trySend(e){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>Cc.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(e)}catch(n){return be.error(`DC#:${this.connectionId} Error when sending:`,n),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open||this._buffer.length===0)return;const e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(e){if(e!=null&&e.flush){this.send({__peerData:{type:"close"}});return}this._buffer=[],this._bufferSize=0,super.close()}constructor(...e){super(...e),this._buffer=[],this._bufferSize=0,this._buffering=!1}}class Id extends dh{close(e){super.close(e),this._chunkedData={}}constructor(e,n,r){super(e,n,r),this.chunker=new e1,this.serialization=ou.Binary,this._chunkedData={}}_handleDataMessage({data:e}){const n=__(e),r=n.__peerData;if(r){if(r.type==="close"){this.close();return}this._handleChunk(n);return}this.emit("data",n)}_handleChunk(e){const n=e.__peerData,r=this._chunkedData[n]||{data:[],count:0,total:e.total};if(r.data[e.n]=new Uint8Array(e.data),r.count++,this._chunkedData[n]=r,r.total===r.count){delete this._chunkedData[n];const s=u2(r.data);this._handleDataMessage({data:s})}}_send(e,n){const r=x_(e);if(r instanceof Promise)return this._send_blob(r);if(!n&&r.byteLength>this.chunker.chunkedMTU){this._sendChunks(r);return}this._bufferedSend(r)}async _send_blob(e){const n=await e;if(n.byteLength>this.chunker.chunkedMTU){this._sendChunks(n);return}this._bufferedSend(n)}_sendChunks(e){const n=this.chunker.chunk(e);be.log(`DC#${this.connectionId} Try to send ${n.length} chunks...`);for(const r of n)this.send(r,!0)}}class x2 extends dh{_handleDataMessage({data:e}){super.emit("data",e)}_send(e,n){this._bufferedSend(e)}constructor(...e){super(...e),this.serialization=ou.None}}class E2 extends dh{_handleDataMessage({data:e}){const n=this.parse(this.decoder.decode(e)),r=n.__peerData;if(r&&r.type==="close"){this.close();return}this.emit("data",n)}_send(e,n){const r=this.encoder.encode(this.stringify(e));if(r.byteLength>=mn.chunkedMTU){this.emitError(uh.MessageToBig,"Message too big for JSON channel");return}this._bufferedSend(r)}constructor(...e){super(...e),this.serialization=ou.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}var fp;const Qo=class Qo extends i1{get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){const e=Object.create(null);for(const[n,r]of this._connections)e[n]=r;return e}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(e,n){super(),this._serializers={raw:x2,json:E2,binary:Id,"binary-utf8":Id,default:Id},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map;let r;if(e&&e.constructor==Object?n=e:e&&(r=e.toString()),n={debug:0,host:mn.CLOUD_HOST,port:mn.CLOUD_PORT,path:"/",key:Qo.DEFAULT_KEY,token:mn.randomToken(),config:mn.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...n},this._options=n,this._serializers={...this._serializers,...this.options.serializers},this._options.host==="/"&&(this._options.host=window.location.hostname),this._options.path&&(this._options.path[0]!=="/"&&(this._options.path="/"+this._options.path),this._options.path[this._options.path.length-1]!=="/"&&(this._options.path+="/")),this._options.secure===void 0&&this._options.host!==mn.CLOUD_HOST?this._options.secure=mn.isSecure():this._options.host==mn.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&be.setLogFunction(this._options.logFunction),be.logLevel=this._options.debug||0,this._api=new _2(n),this._socket=this._createServerConnection(),!mn.supports.audioVideo&&!mn.supports.data){this._delayedAbort(At.BrowserIncompatible,"The current browser does not support WebRTC");return}if(r&&!mn.validateId(r)){this._delayedAbort(At.InvalidID,`ID "${r}" is invalid`);return}r?this._initialize(r):this._api.retrieveId().then(s=>this._initialize(s)).catch(s=>this._abort(At.ServerError,s))}_createServerConnection(){const e=new y2(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return e.on(Xr.Message,n=>{this._handleMessage(n)}),e.on(Xr.Error,n=>{this._abort(At.SocketError,n)}),e.on(Xr.Disconnected,()=>{this.disconnected||(this.emitError(At.Network,"Lost connection to server."),this.disconnect())}),e.on(Xr.Close,()=>{this.disconnected||this._abort(At.SocketClosed,"Underlying socket is already closed.")}),e}_initialize(e){this._id=e,this.socket.start(e,this._options.token)}_handleMessage(e){const n=e.type,r=e.payload,s=e.src;switch(n){case Zt.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case Zt.Error:this._abort(At.ServerError,r.msg);break;case Zt.IdTaken:this._abort(At.UnavailableID,`ID "${this.id}" is taken`);break;case Zt.InvalidKey:this._abort(At.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case Zt.Leave:be.log(`Received leave message from ${s}`),this._cleanupPeer(s),this._connections.delete(s);break;case Zt.Expire:this.emitError(At.PeerUnavailable,`Could not connect to peer ${s}`);break;case Zt.Offer:{const i=r.connectionId;let o=this.getConnection(s,i);if(o&&(o.close(),be.warn(`Offer received for existing Connection ID:${i}`)),r.type===ss.Media){const c=new Sc(s,this,{connectionId:i,_payload:r,metadata:r.metadata});o=c,this._addConnection(s,o),this.emit("call",c)}else if(r.type===ss.Data){const c=new this._serializers[r.serialization](s,this,{connectionId:i,_payload:r,metadata:r.metadata,label:r.label,serialization:r.serialization,reliable:r.reliable});o=c,this._addConnection(s,o),this.emit("connection",c)}else{be.warn(`Received malformed connection type:${r.type}`);return}const a=this._getMessages(i);for(const c of a)o.handleMessage(c);break}default:{if(!r){be.warn(`You received a malformed message from ${s} of type ${n}`);return}const i=r.connectionId,o=this.getConnection(s,i);o&&o.peerConnection?o.handleMessage(e):i?this._storeMessage(i,e):be.warn("You received an unrecognized message:",e);break}}}_storeMessage(e,n){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(n)}_getMessages(e){const n=this._lostMessages.get(e);return n?(this._lostMessages.delete(e),n):[]}connect(e,n={}){if(n={serialization:"default",...n},this.disconnected){be.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(At.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}const r=new this._serializers[n.serialization](e,this,n);return this._addConnection(e,r),r}call(e,n,r={}){if(this.disconnected){be.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(At.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!n){be.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}const s=new Sc(e,this,{...r,_stream:n});return this._addConnection(e,s),s}_addConnection(e,n){be.log(`add connection ${n.type}:${n.connectionId} to peerId:${e}`),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(n)}_removeConnection(e){const n=this._connections.get(e.peer);if(n){const r=n.indexOf(e);r!==-1&&n.splice(r,1)}this._lostMessages.delete(e.connectionId)}getConnection(e,n){const r=this._connections.get(e);if(!r)return null;for(const s of r)if(s.connectionId===n)return s;return null}_delayedAbort(e,n){setTimeout(()=>{this._abort(e,n)},0)}_abort(e,n){be.error("Aborting!"),this.emitError(e,n),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||(be.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))}_cleanup(){for(const e of this._connections.keys())this._cleanupPeer(e),this._connections.delete(e);this.socket.removeAllListeners()}_cleanupPeer(e){const n=this._connections.get(e);if(n)for(const r of n)r.close()}disconnect(){if(this.disconnected)return;const e=this.id;be.log(`Disconnect peer with ID:${e}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit("disconnected",e)}reconnect(){if(this.disconnected&&!this.destroyed)be.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)be.error("In a hurry? We're still trying to make the initial connection!");else throw new Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`)}}listAllPeers(e=n=>{}){this._api.listAllPeers().then(n=>e(n)).catch(n=>this._abort(At.ServerError,n))}};fp=new WeakMap,go(Qo,fp,Qo.DEFAULT_KEY="peerjs");let Uf=Qo;var a1=Uf;class l1{constructor(){zt(this,"peer",null);zt(this,"conn",null);zt(this,"isHost",!1);zt(this,"messageCallback",null);zt(this,"connectionCallback",null);zt(this,"closeCallback",null)}async connect(e){return this.peer=new a1,new Promise((n,r)=>{if(!this.peer)return r("Peer not initialized");this.peer.on("open",s=>{console.log("My Peer ID is:",s),e?(this.isHost=!1,this.connectToPeer(e),n(s)):(this.isHost=!0,this.peer.on("connection",i=>{console.log("Incoming connection..."),this.setupConnection(i)}),n(s))}),this.peer.on("error",s=>{console.error(s),r(s)})})}connectToPeer(e){if(!this.peer)return;const n=this.peer.connect(e);this.setupConnection(n)}setupConnection(e){this.conn=e,e.on("open",()=>{console.log("Connection established!"),this.connectionCallback&&this.connectionCallback()}),e.on("data",n=>{this.messageCallback&&this.messageCallback(n)}),e.on("close",()=>{console.log("Connection closed"),this.closeCallback&&this.closeCallback()}),e.on("error",n=>console.error("Connection Error:",n))}onConnection(e){this.connectionCallback=e}onClose(e){this.closeCallback=e}isConnected(){return this.conn!==null&&this.conn.open}send(e){this.conn&&this.conn.open?this.conn.send(e):console.warn("Connection not open, cannot send message")}onMessage(e){this.messageCallback=e}disconnect(){var e,n;(e=this.conn)==null||e.close(),(n=this.peer)==null||n.destroy()}}const b2=({gameMode:t,targetRoomId:e,playerClass:n,onGameStart:r,onBack:s})=>{const[i,o]=V.useState(""),[a,c]=V.useState(!1),[u,p]=V.useState(!0),[f,d]=V.useState(null),[y,S]=V.useState(!1),[P,g]=V.useState(null),[b,x]=V.useState(!1),E=V.useRef(null);V.useEffect(()=>{const F=new l1;return E.current=F,(async()=>{try{const J=await F.connect(t==="JOIN"?e:void 0);o(J),p(!1),F.onMessage(me=>{console.log("[LobbyScreen] Received message:",me),me.type==="CLASS_INFO"&&(console.log("[LobbyScreen] Received opponent class:",me.playerClass),g(me.playerClass))}),F.onConnection(()=>{console.log("[LobbyScreen] Connection established!"),c(!0)})}catch(J){console.error("[LobbyScreen] Connection error:",J),d(J.toString()),p(!1)}})(),()=>{var J;(J=E.current)!=null&&J.isConnected()||F.disconnect()}},[t,e]),V.useEffect(()=>{a&&E.current&&!b&&(console.log("[LobbyScreen] Sending class info:",n),setTimeout(()=>{var F;(F=E.current)==null||F.send({type:"CLASS_INFO",playerClass:n}),x(!0)},100))},[a,n,b]),V.useEffect(()=>{if(a&&E.current&&P){const F=setTimeout(()=>{console.log("[LobbyScreen] Starting game with opponent class:",P),r(E.current,P)},500);return()=>clearTimeout(F)}},[a,r,P]);const O=async()=>{if(i)try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(i);else{const F=document.createElement("textarea");F.value=i,F.style.position="fixed",F.style.left="-999999px",F.style.top="-999999px",document.body.appendChild(F),F.focus(),F.select(),document.execCommand("copy"),document.body.removeChild(F)}S(!0),setTimeout(()=>S(!1),2e3)}catch(F){console.error("Failed to copy:",F),alert(`Room ID: ${i}

()`)}},Q=()=>{E.current&&(E.current.disconnect(),E.current=null),s()};return l.jsxs("div",{className:"screen lobby-screen",style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",gap:"2rem"},children:[l.jsx("h1",{style:{fontSize:"2.5rem",marginBottom:"1rem",textShadow:"0 0 10px #e94560",fontFamily:"Tamanegi, sans-serif",letterSpacing:"2px"},children:t==="HOST"?"":"..."}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1.5rem",padding:"2rem",background:"rgba(0,0,0,0.3)",borderRadius:"10px",minWidth:"400px"},children:[f&&l.jsxs("div",{style:{color:"#ff6b6b",fontSize:"1.2rem",textAlign:"center",fontFamily:"Tamanegi, sans-serif"},children:[l.jsx("p",{children:""}),l.jsx("p",{style:{fontSize:"0.9rem",opacity:.7},children:f})]}),u&&!f&&l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1rem"},children:[l.jsx("div",{className:"loading-spinner",style:{width:"50px",height:"50px",border:"4px solid rgba(233, 69, 96, 0.3)",borderTop:"4px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),l.jsx("p",{style:{opacity:.8,fontFamily:"Tamanegi, sans-serif"},children:t==="HOST"?"...":"..."})]}),t==="HOST"&&i&&!u&&!a&&!f&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.5rem"},children:[l.jsx("p",{style:{fontSize:"1rem",opacity:.7,fontFamily:"Tamanegi, sans-serif"},children:"ID:"}),l.jsx("div",{style:{fontSize:"2rem",fontFamily:"monospace",fontWeight:"bold",padding:"0.5rem 1rem",background:"rgba(233, 69, 96, 0.2)",borderRadius:"8px",border:"1px solid #e94560",letterSpacing:"2px"},children:i})]}),l.jsx("button",{onClick:O,style:{fontSize:"1rem",padding:"0.8rem 2rem",background:y?"#48bb78":"transparent",border:"2px solid "+(y?"#48bb78":"#e94560"),color:"#fff",cursor:"pointer",transition:"all 0.3s",borderRadius:"4px",fontWeight:"bold",fontFamily:"Tamanegi, sans-serif"},children:y?" ":"ID"}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginTop:"1rem",opacity:.7},children:[l.jsx("div",{className:"loading-spinner",style:{width:"20px",height:"20px",border:"2px solid rgba(233, 69, 96, 0.3)",borderTop:"2px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),l.jsx("span",{style:{fontFamily:"Tamanegi, sans-serif"},children:"..."})]})]}),t==="JOIN"&&!u&&!a&&!f&&l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[l.jsx("div",{className:"loading-spinner",style:{width:"20px",height:"20px",border:"2px solid rgba(233, 69, 96, 0.3)",borderTop:"2px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),l.jsxs("span",{style:{fontFamily:"Tamanegi, sans-serif"},children:[" ",e," ..."]})]}),a&&l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1rem"},children:[l.jsx("p",{style:{fontSize:"1.5rem",color:"#48bb78",fontFamily:"Tamanegi, sans-serif"},children:" "}),l.jsx("p",{style:{fontFamily:"Tamanegi, sans-serif"},children:"..."})]}),l.jsxs("div",{style:{marginTop:"1rem",padding:"0.5rem 1rem",background:"rgba(255,255,255,0.1)",borderRadius:"4px",fontSize:"0.9rem",opacity:.7,fontFamily:"Tamanegi, sans-serif"},children:[": ",n==="SENKA"?"":n==="AJA"?"":"yoRuka"]})]}),l.jsx("button",{onClick:Q,style:{fontSize:"1rem",padding:"0.8rem 2rem",background:"transparent",border:"1px solid #888",color:"#888",cursor:"pointer",transition:"all 0.3s",borderRadius:"4px",marginTop:"1rem",fontFamily:"Tamanegi, sans-serif"},onMouseOver:F=>{F.currentTarget.style.color="#fff",F.currentTarget.style.borderColor="#fff"},onMouseOut:F=>{F.currentTarget.style.color="#888",F.currentTarget.style.borderColor="#888"},children:" "}),l.jsx("style",{children:`
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `})]})},S2=()=>{};var tm={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c1={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ce=function(t,e){if(!t)throw Zi(e)},Zi=function(t){return new Error("Firebase Database ("+c1.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u1=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},C2=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=t[n++],o=t[n++],a=t[n++],c=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{const i=t[n++],o=t[n++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},fh={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<t.length;s+=3){const i=t[s],o=s+1<t.length,a=o?t[s+1]:0,c=s+2<t.length,u=c?t[s+2]:0,p=i>>2,f=(i&3)<<4|a>>4;let d=(a&15)<<2|u>>6,y=u&63;c||(y=64,o||(d=64)),r.push(n[p],n[f],n[d],n[y])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(u1(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):C2(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<t.length;){const i=n[t.charAt(s++)],a=s<t.length?n[t.charAt(s)]:0;++s;const u=s<t.length?n[t.charAt(s)]:64;++s;const f=s<t.length?n[t.charAt(s)]:64;if(++s,i==null||a==null||u==null||f==null)throw new T2;const d=i<<2|a>>4;if(r.push(d),u!==64){const y=a<<4&240|u>>2;if(r.push(y),f!==64){const S=u<<6&192|f;r.push(S)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class T2 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const d1=function(t){const e=u1(t);return fh.encodeByteArray(e,!0)},Tc=function(t){return d1(t).replace(/\./g,"")},zf=function(t){try{return fh.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function I2(t){return f1(void 0,t)}function f1(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const n=e;return new Date(n.getTime());case Object:t===void 0&&(t={});break;case Array:t=[];break;default:return e}for(const n in e)!e.hasOwnProperty(n)||!k2(n)||(t[n]=f1(t[n],e[n]));return t}function k2(t){return t!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w2(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R2=()=>w2().__FIREBASE_DEFAULTS__,A2=()=>{if(typeof process>"u"||typeof tm>"u")return;const t=tm.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},P2=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&zf(t[1]);return e&&JSON.parse(e)},p1=()=>{try{return S2()||R2()||A2()||P2()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},O2=t=>{var e,n;return(n=(e=p1())==null?void 0:e.emulatorHosts)==null?void 0:n[t]},L2=t=>{const e=O2(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},h1=()=>{var t;return(t=p1())==null?void 0:t.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xr{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ph(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function D2(t){return(await fetch(t,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M2(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",s=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...t};return[Tc(JSON.stringify(n)),Tc(JSON.stringify(o)),""].join(".")}const Ho={};function N2(){const t={prod:[],emulator:[]};for(const e of Object.keys(Ho))Ho[e]?t.emulator.push(e):t.prod.push(e);return t}function j2(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let nm=!1;function F2(t,e){if(typeof window>"u"||typeof document>"u"||!ph(window.location.host)||Ho[t]===e||Ho[t]||nm)return;Ho[t]=e;function n(d){return`__firebase__banner__${d}`}const r="__firebase__banner",i=N2().prod.length>0;function o(){const d=document.getElementById(r);d&&d.remove()}function a(d){d.style.display="flex",d.style.background="#7faaf0",d.style.position="fixed",d.style.bottom="5px",d.style.left="5px",d.style.padding=".5em",d.style.borderRadius="5px",d.style.alignItems="center"}function c(d,y){d.setAttribute("width","24"),d.setAttribute("id",y),d.setAttribute("height","24"),d.setAttribute("viewBox","0 0 24 24"),d.setAttribute("fill","none"),d.style.marginLeft="-6px"}function u(){const d=document.createElement("span");return d.style.cursor="pointer",d.style.marginLeft="16px",d.style.fontSize="24px",d.innerHTML=" &times;",d.onclick=()=>{nm=!0,o()},d}function p(d,y){d.setAttribute("id",y),d.innerText="Learn more",d.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",d.setAttribute("target","__blank"),d.style.paddingLeft="5px",d.style.textDecoration="underline"}function f(){const d=j2(r),y=n("text"),S=document.getElementById(y)||document.createElement("span"),P=n("learnmore"),g=document.getElementById(P)||document.createElement("a"),b=n("preprendIcon"),x=document.getElementById(b)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(d.created){const E=d.element;a(E),p(g,P);const O=u();c(x,b),E.append(x,S,g,O),document.body.appendChild(E)}i?(S.innerText="Preview backend disconnected.",x.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(x.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,S.innerText="Preview backend running in this workspace."),S.setAttribute("id",y)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",f):f()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $2(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function g1(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test($2())}function B2(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function U2(){return c1.NODE_ADMIN===!0}function z2(){try{return typeof indexedDB=="object"}catch{return!1}}function H2(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var i;e(((i=s.error)==null?void 0:i.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W2="FirebaseError";class La extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=W2,Object.setPrototypeOf(this,La.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,m1.prototype.create)}}class m1{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?G2(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new La(s,a,r)}}function G2(t,e){return t.replace(V2,(n,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const V2=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ga(t){return JSON.parse(t)}function Dt(t){return JSON.stringify(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y1=function(t){let e={},n={},r={},s="";try{const i=t.split(".");e=ga(zf(i[0])||""),n=ga(zf(i[1])||""),s=i[2],r=n.d||{},delete n.d}catch{}return{header:e,claims:n,data:r,signature:s}},Y2=function(t){const e=y1(t),n=e.claims;return!!n&&typeof n=="object"&&n.hasOwnProperty("iat")},K2=function(t){const e=y1(t).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hr(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Wi(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}function Hf(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Ic(t,e,n){const r={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(r[s]=e.call(n,t[s],s,t));return r}function kc(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const i=t[s],o=e[s];if(rm(i)&&rm(o)){if(!kc(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function rm(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X2(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q2{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,n){n||(n=0);const r=this.W_;if(typeof e=="string")for(let f=0;f<16;f++)r[f]=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),n+=4;else for(let f=0;f<16;f++)r[f]=e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3],n+=4;for(let f=16;f<80;f++){const d=r[f-3]^r[f-8]^r[f-14]^r[f-16];r[f]=(d<<1|d>>>31)&4294967295}let s=this.chain_[0],i=this.chain_[1],o=this.chain_[2],a=this.chain_[3],c=this.chain_[4],u,p;for(let f=0;f<80;f++){f<40?f<20?(u=a^i&(o^a),p=1518500249):(u=i^o^a,p=1859775393):f<60?(u=i&o|a&(i|o),p=2400959708):(u=i^o^a,p=3395469782);const d=(s<<5|s>>>27)+u+c+p+r[f]&4294967295;c=a,a=o,o=(i<<30|i>>>2)&4294967295,i=s,s=d}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+i&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,n){if(e==null)return;n===void 0&&(n=e.length);const r=n-this.blockSize;let s=0;const i=this.buf_;let o=this.inbuf_;for(;s<n;){if(o===0)for(;s<=r;)this.compress_(e,s),s+=this.blockSize;if(typeof e=="string"){for(;s<n;)if(i[o]=e.charCodeAt(s),++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}else for(;s<n;)if(i[o]=e[s],++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=n}digest(){const e=[];let n=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=n&255,n/=256;this.compress_(this.buf_);let r=0;for(let s=0;s<5;s++)for(let i=24;i>=0;i-=8)e[r]=this.chain_[s]>>i&255,++r;return e}}function Gi(t,e){return`${t} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J2=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);if(s>=55296&&s<=56319){const i=s-55296;r++,ce(r<t.length,"Surrogate pair missing trail surrogate.");const o=t.charCodeAt(r)-56320;s=65536+(i<<10)+o}s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):s<65536?(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},au=function(t){let e=0;for(let n=0;n<t.length;n++){const r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,n++):e+=3}return e};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ys(t){return t&&t._delegate?t._delegate:t}class ma{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ks="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q2{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new xr;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:n});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(eC(e))try{this.getOrInitializeService({instanceIdentifier:ks})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(n);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=ks){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ks){return this.instances.has(e)}getOptions(e=ks){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const s of r)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Z2(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=ks){return this.component?this.component.multipleInstances?e:ks:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Z2(t){return t===ks?void 0:t}function eC(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tC{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new q2(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ut;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(ut||(ut={}));const nC={debug:ut.DEBUG,verbose:ut.VERBOSE,info:ut.INFO,warn:ut.WARN,error:ut.ERROR,silent:ut.SILENT},rC=ut.INFO,sC={[ut.DEBUG]:"log",[ut.VERBOSE]:"log",[ut.INFO]:"info",[ut.WARN]:"warn",[ut.ERROR]:"error"},iC=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),s=sC[e];if(s)console[s](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class v1{constructor(e){this.name=e,this._logLevel=rC,this._logHandler=iC,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ut))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?nC[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ut.DEBUG,...e),this._logHandler(this,ut.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ut.VERBOSE,...e),this._logHandler(this,ut.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ut.INFO,...e),this._logHandler(this,ut.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ut.WARN,...e),this._logHandler(this,ut.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ut.ERROR,...e),this._logHandler(this,ut.ERROR,...e)}}const oC=(t,e)=>e.some(n=>t instanceof n);let sm,im;function aC(){return sm||(sm=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function lC(){return im||(im=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const _1=new WeakMap,Wf=new WeakMap,x1=new WeakMap,kd=new WeakMap,hh=new WeakMap;function cC(t){const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("success",i),t.removeEventListener("error",o)},i=()=>{n(is(t.result)),s()},o=()=>{r(t.error),s()};t.addEventListener("success",i),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&_1.set(n,t)}).catch(()=>{}),hh.set(e,t),e}function uC(t){if(Wf.has(t))return;const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",o),t.removeEventListener("abort",o)},i=()=>{n(),s()},o=()=>{r(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",i),t.addEventListener("error",o),t.addEventListener("abort",o)});Wf.set(t,e)}let Gf={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return Wf.get(t);if(e==="objectStoreNames")return t.objectStoreNames||x1.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return is(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function dC(t){Gf=t(Gf)}function fC(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(wd(this),e,...n);return x1.set(r,e.sort?e.sort():[e]),is(r)}:lC().includes(t)?function(...e){return t.apply(wd(this),e),is(_1.get(this))}:function(...e){return is(t.apply(wd(this),e))}}function pC(t){return typeof t=="function"?fC(t):(t instanceof IDBTransaction&&uC(t),oC(t,aC())?new Proxy(t,Gf):t)}function is(t){if(t instanceof IDBRequest)return cC(t);if(kd.has(t))return kd.get(t);const e=pC(t);return e!==t&&(kd.set(t,e),hh.set(e,t)),e}const wd=t=>hh.get(t);function hC(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(t,e),a=is(o);return r&&o.addEventListener("upgradeneeded",c=>{r(is(o.result),c.oldVersion,c.newVersion,is(o.transaction),c)}),n&&o.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),a.then(c=>{i&&c.addEventListener("close",()=>i()),s&&c.addEventListener("versionchange",u=>s(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const gC=["get","getKey","getAll","getAllKeys","count"],mC=["put","add","delete","clear"],Rd=new Map;function om(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Rd.get(e))return Rd.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=mC.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||gC.includes(n)))return;const i=async function(o,...a){const c=this.transaction(o,s?"readwrite":"readonly");let u=c.store;return r&&(u=u.index(a.shift())),(await Promise.all([u[n](...a),s&&c.done]))[0]};return Rd.set(e,i),i}dC(t=>({...t,get:(e,n,r)=>om(e,n)||t.get(e,n,r),has:(e,n)=>!!om(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yC{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(vC(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function vC(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Vf="@firebase/app",am="0.14.6";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pr=new v1("@firebase/app"),_C="@firebase/app-compat",xC="@firebase/analytics-compat",EC="@firebase/analytics",bC="@firebase/app-check-compat",SC="@firebase/app-check",CC="@firebase/auth",TC="@firebase/auth-compat",IC="@firebase/database",kC="@firebase/data-connect",wC="@firebase/database-compat",RC="@firebase/functions",AC="@firebase/functions-compat",PC="@firebase/installations",OC="@firebase/installations-compat",LC="@firebase/messaging",DC="@firebase/messaging-compat",MC="@firebase/performance",NC="@firebase/performance-compat",jC="@firebase/remote-config",FC="@firebase/remote-config-compat",$C="@firebase/storage",BC="@firebase/storage-compat",UC="@firebase/firestore",zC="@firebase/ai",HC="@firebase/firestore-compat",WC="firebase",GC="12.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yf="[DEFAULT]",VC={[Vf]:"fire-core",[_C]:"fire-core-compat",[EC]:"fire-analytics",[xC]:"fire-analytics-compat",[SC]:"fire-app-check",[bC]:"fire-app-check-compat",[CC]:"fire-auth",[TC]:"fire-auth-compat",[IC]:"fire-rtdb",[kC]:"fire-data-connect",[wC]:"fire-rtdb-compat",[RC]:"fire-fn",[AC]:"fire-fn-compat",[PC]:"fire-iid",[OC]:"fire-iid-compat",[LC]:"fire-fcm",[DC]:"fire-fcm-compat",[MC]:"fire-perf",[NC]:"fire-perf-compat",[jC]:"fire-rc",[FC]:"fire-rc-compat",[$C]:"fire-gcs",[BC]:"fire-gcs-compat",[UC]:"fire-fst",[HC]:"fire-fst-compat",[zC]:"fire-vertex","fire-js":"fire-js",[WC]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wc=new Map,YC=new Map,Kf=new Map;function lm(t,e){try{t.container.addComponent(e)}catch(n){Pr.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Rc(t){const e=t.name;if(Kf.has(e))return Pr.debug(`There were multiple attempts to register component ${e}.`),!1;Kf.set(e,t);for(const n of wc.values())lm(n,t);for(const n of YC.values())lm(n,t);return!0}function KC(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function XC(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QC={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},os=new m1("app","Firebase",QC);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JC{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new ma("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw os.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qC=GC;function E1(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:Yf,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw os.create("bad-app-name",{appName:String(s)});if(n||(n=h1()),!n)throw os.create("no-options");const i=wc.get(s);if(i){if(kc(n,i.options)&&kc(r,i.config))return i;throw os.create("duplicate-app",{appName:s})}const o=new tC(s);for(const c of Kf.values())o.addComponent(c);const a=new JC(n,r,o);return wc.set(s,a),a}function ZC(t=Yf){const e=wc.get(t);if(!e&&t===Yf&&h1())return E1();if(!e)throw os.create("no-app",{appName:t});return e}function Di(t,e,n){let r=VC[t]??t;n&&(r+=`-${n}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const o=[`Unable to register library "${r}" with version "${e}":`];s&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Pr.warn(o.join(" "));return}Rc(new ma(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eT="firebase-heartbeat-database",tT=1,ya="firebase-heartbeat-store";let Ad=null;function b1(){return Ad||(Ad=hC(eT,tT,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(ya)}catch(n){console.warn(n)}}}}).catch(t=>{throw os.create("idb-open",{originalErrorMessage:t.message})})),Ad}async function nT(t){try{const n=(await b1()).transaction(ya),r=await n.objectStore(ya).get(S1(t));return await n.done,r}catch(e){if(e instanceof La)Pr.warn(e.message);else{const n=os.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Pr.warn(n.message)}}}async function cm(t,e){try{const r=(await b1()).transaction(ya,"readwrite");await r.objectStore(ya).put(e,S1(t)),await r.done}catch(n){if(n instanceof La)Pr.warn(n.message);else{const r=os.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});Pr.warn(r.message)}}}function S1(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rT=1024,sT=30;class iT{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new aT(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=um();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)==null?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats.length>sT){const o=lT(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){Pr.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=um(),{heartbeatsToSend:r,unsentEntries:s}=oT(this._heartbeatsCache.heartbeats),i=Tc(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(n){return Pr.warn(n),""}}}function um(){return new Date().toISOString().substring(0,10)}function oT(t,e=rT){const n=[];let r=t.slice();for(const s of t){const i=n.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),dm(n)>e){i.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),dm(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class aT{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return z2()?H2().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await nT(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return cm(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return cm(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function dm(t){return Tc(JSON.stringify({version:2,heartbeats:t})).length}function lT(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cT(t){Rc(new ma("platform-logger",e=>new yC(e),"PRIVATE")),Rc(new ma("heartbeat",e=>new iT(e),"PRIVATE")),Di(Vf,am,t),Di(Vf,am,"esm2020"),Di("fire-js","")}cT("");var uT="firebase",dT="12.7.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Di(uT,dT,"app");var fm={};const pm="@firebase/database",hm="1.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let C1="";function fT(t){C1=t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pT{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,n){n==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Dt(n))}get(e){const n=this.domStorage_.getItem(this.prefixedName_(e));return n==null?null:ga(n)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hT{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,n){n==null?delete this.cache_[e]:this.cache_[e]=n}get(e){return hr(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T1=function(t){try{if(typeof window<"u"&&typeof window[t]<"u"){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new pT(e)}}catch{}return new hT},Ls=T1("localStorage"),gT=T1("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mi=new v1("@firebase/database"),mT=function(){let t=1;return function(){return t++}}(),I1=function(t){const e=J2(t),n=new Q2;n.update(e);const r=n.digest();return fh.encodeByteArray(r)},Da=function(...t){let e="";for(let n=0;n<t.length;n++){const r=t[n];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=Da.apply(null,r):typeof r=="object"?e+=Dt(r):e+=r,e+=" "}return e};let Wo=null,gm=!0;const yT=function(t,e){ce(!0,"Can't turn on custom loggers persistently."),Mi.logLevel=ut.VERBOSE,Wo=Mi.log.bind(Mi)},Gt=function(...t){if(gm===!0&&(gm=!1,Wo===null&&gT.get("logging_enabled")===!0&&yT()),Wo){const e=Da.apply(null,t);Wo(e)}},Ma=function(t){return function(...e){Gt(t,...e)}},Xf=function(...t){const e="FIREBASE INTERNAL ERROR: "+Da(...t);Mi.error(e)},Or=function(...t){const e=`FIREBASE FATAL ERROR: ${Da(...t)}`;throw Mi.error(e),new Error(e)},Sn=function(...t){const e="FIREBASE WARNING: "+Da(...t);Mi.warn(e)},vT=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Sn("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},lu=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},_T=function(t){if(document.readyState==="complete")t();else{let e=!1;const n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&n()}),window.attachEvent("onload",n))}},Vi="[MIN_NAME]",Ws="[MAX_NAME]",qs=function(t,e){if(t===e)return 0;if(t===Vi||e===Ws)return-1;if(e===Vi||t===Ws)return 1;{const n=mm(t),r=mm(e);return n!==null?r!==null?n-r===0?t.length-e.length:n-r:-1:r!==null?1:t<e?-1:1}},xT=function(t,e){return t===e?0:t<e?-1:1},To=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+Dt(e))},gh=function(t){if(typeof t!="object"||t===null)return Dt(t);const e=[];for(const r in t)e.push(r);e.sort();let n="{";for(let r=0;r<e.length;r++)r!==0&&(n+=","),n+=Dt(e[r]),n+=":",n+=gh(t[e[r]]);return n+="}",n},k1=function(t,e){const n=t.length;if(n<=e)return[t];const r=[];for(let s=0;s<n;s+=e)s+e>n?r.push(t.substring(s,n)):r.push(t.substring(s,s+e));return r};function rn(t,e){for(const n in t)t.hasOwnProperty(n)&&e(n,t[n])}const w1=function(t){ce(!lu(t),"Invalid JSON number");const e=11,n=52,r=(1<<e-1)-1;let s,i,o,a,c;t===0?(i=0,o=0,s=1/t===-1/0?1:0):(s=t<0,t=Math.abs(t),t>=Math.pow(2,1-r)?(a=Math.min(Math.floor(Math.log(t)/Math.LN2),r),i=a+r,o=Math.round(t*Math.pow(2,n-a)-Math.pow(2,n))):(i=0,o=Math.round(t/Math.pow(2,1-r-n))));const u=[];for(c=n;c;c-=1)u.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)u.push(i%2?1:0),i=Math.floor(i/2);u.push(s?1:0),u.reverse();const p=u.join("");let f="";for(c=0;c<64;c+=8){let d=parseInt(p.substr(c,8),2).toString(16);d.length===1&&(d="0"+d),f=f+d}return f.toLowerCase()},ET=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},bT=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function ST(t,e){let n="Unknown Error";t==="too_big"?n="The data requested exceeds the maximum size that can be accessed with a single request.":t==="permission_denied"?n="Client doesn't have permission to access the desired data.":t==="unavailable"&&(n="The service is unavailable");const r=new Error(t+" at "+e._path.toString()+": "+n);return r.code=t.toUpperCase(),r}const CT=new RegExp("^-?(0*)\\d{1,10}$"),TT=-2147483648,IT=2147483647,mm=function(t){if(CT.test(t)){const e=Number(t);if(e>=TT&&e<=IT)return e}return null},eo=function(t){try{t()}catch(e){setTimeout(()=>{const n=e.stack||"";throw Sn("Exception was thrown by user callback.",n),e},Math.floor(0))}},kT=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Go=function(t,e){const n=setTimeout(t,e);return typeof n=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(n):typeof n=="object"&&n.unref&&n.unref(),n};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wT{constructor(e,n){this.appCheckProvider=n,this.appName=e.name,XC(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=n==null?void 0:n.getImmediate({optional:!0}),this.appCheck||n==null||n.get().then(r=>this.appCheck=r)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((n,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(n,r):n(null)},0)})}addTokenChangeListener(e){var n;(n=this.appCheckProvider)==null||n.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){Sn(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RT{constructor(e,n,r){this.appName_=e,this.firebaseOptions_=n,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(n=>n&&n.code==="auth/token-not-initialized"?(Gt("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(n)):new Promise((n,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(n,r):n(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(n=>n.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(n=>n.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Sn(e)}}class Jl{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Jl.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mh="5",R1="v",A1="s",P1="r",O1="f",L1=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,D1="ls",M1="p",Qf="ac",N1="websocket",j1="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F1{constructor(e,n,r,s,i=!1,o="",a=!1,c=!1,u=null){this.secure=n,this.namespace=r,this.webSocketOnly=s,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=c,this.emulatorOptions=u,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Ls.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Ls.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",n=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${n}`}}function AT(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function $1(t,e,n){ce(typeof e=="string","typeof type must == string"),ce(typeof n=="object","typeof params must == object");let r;if(e===N1)r=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===j1)r=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);AT(t)&&(n.ns=t.namespace);const s=[];return rn(n,(i,o)=>{s.push(i+"="+o)}),r+s.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PT{constructor(){this.counters_={}}incrementCounter(e,n=1){hr(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=n}get(){return I2(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pd={},Od={};function yh(t){const e=t.toString();return Pd[e]||(Pd[e]=new PT),Pd[e]}function OT(t,e){const n=t.toString();return Od[n]||(Od[n]=e()),Od[n]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LT{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,n){this.closeAfterResponse=e,this.onClose=n,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,n){for(this.pendingResponses[e]=n;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<r.length;++s)r[s]&&eo(()=>{this.onMessage_(r[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ym="start",DT="close",MT="pLPCommand",NT="pRTLPCB",B1="id",U1="pw",z1="ser",jT="cb",FT="seg",$T="ts",BT="d",UT="dframe",H1=1870,W1=30,zT=H1-W1,HT=25e3,WT=3e4;class Ii{constructor(e,n,r,s,i,o,a){this.connId=e,this.repoInfo=n,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Ma(e),this.stats_=yh(n),this.urlFn=c=>(this.appCheckToken&&(c[Qf]=this.appCheckToken),$1(n,j1,c))}open(e,n){this.curSegmentNum=0,this.onDisconnect_=n,this.myPacketOrderer=new LT(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(WT)),_T(()=>{if(this.isClosed_)return;this.scriptTagHolder=new vh((...i)=>{const[o,a,c,u,p]=i;if(this.incrementIncomingBytes_(i),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===ym)this.id=a,this.password=c;else if(o===DT)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...i)=>{const[o,a]=i;this.incrementIncomingBytes_(i),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const r={};r[ym]="t",r[z1]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[jT]=this.scriptTagHolder.uniqueCallbackIdentifier),r[R1]=mh,this.transportSessionId&&(r[A1]=this.transportSessionId),this.lastSessionId&&(r[D1]=this.lastSessionId),this.applicationId&&(r[M1]=this.applicationId),this.appCheckToken&&(r[Qf]=this.appCheckToken),typeof location<"u"&&location.hostname&&L1.test(location.hostname)&&(r[P1]=O1);const s=this.urlFn(r);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Ii.forceAllow_=!0}static forceDisallow(){Ii.forceDisallow_=!0}static isAvailable(){return Ii.forceAllow_?!0:!Ii.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!ET()&&!bT()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const n=Dt(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const r=d1(n),s=k1(r,zT);for(let i=0;i<s.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[i]),this.curSegmentNum++}addDisconnectPingFrame(e,n){this.myDisconnFrame=document.createElement("iframe");const r={};r[UT]="t",r[B1]=e,r[U1]=n,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const n=Dt(e).length;this.bytesReceived+=n,this.stats_.incrementCounter("bytes_received",n)}}class vh{constructor(e,n,r,s){this.onDisconnect=r,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=mT(),window[MT+this.uniqueCallbackIdentifier]=e,window[NT+this.uniqueCallbackIdentifier]=n,this.myIFrame=vh.createIFrame_();let i="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(i='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){Gt("frame writing exception"),a.stack&&Gt(a.stack),Gt(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Gt("No IE domain setting required")}catch{const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,n){for(this.myID=e,this.myPW=n,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[B1]=this.myID,e[U1]=this.myPW,e[z1]=this.currentSerial;let n=this.urlFn(e),r="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+W1+r.length<=H1;){const o=this.pendingSegs.shift();r=r+"&"+FT+s+"="+o.seg+"&"+$T+s+"="+o.ts+"&"+BT+s+"="+o.d,s++}return n=n+r,this.addLongPollTag_(n,this.currentSerial),!0}else return!1}enqueueSegment(e,n,r){this.pendingSegs.push({seg:e,ts:n,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,n){this.outstandingRequests.add(n);const r=()=>{this.outstandingRequests.delete(n),this.newRequest_()},s=setTimeout(r,Math.floor(HT)),i=()=>{clearTimeout(s),r()};this.addTag(e,i)}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const s=r.readyState;(!s||s==="loaded"||s==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),n())},r.onerror=()=>{Gt("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GT=16384,VT=45e3;let Ac=null;typeof MozWebSocket<"u"?Ac=MozWebSocket:typeof WebSocket<"u"&&(Ac=WebSocket);class qn{constructor(e,n,r,s,i,o,a){this.connId=e,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Ma(this.connId),this.stats_=yh(n),this.connURL=qn.connectionURL_(n,o,a,s,r),this.nodeAdmin=n.nodeAdmin}static connectionURL_(e,n,r,s,i){const o={};return o[R1]=mh,typeof location<"u"&&location.hostname&&L1.test(location.hostname)&&(o[P1]=O1),n&&(o[A1]=n),r&&(o[D1]=r),s&&(o[Qf]=s),i&&(o[M1]=i),$1(e,N1,o)}open(e,n){this.onDisconnect=n,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Ls.set("previous_websocket_failure",!0);try{let r;U2(),this.mySock=new Ac(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){qn.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const n=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(n);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&Ac!==null&&!qn.forceDisallow_}static previouslyFailed(){return Ls.isInMemoryStorage||Ls.get("previous_websocket_failure")===!0}markConnectionHealthy(){Ls.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const n=this.frames.join("");this.frames=null;const r=ga(n);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(ce(this.frames===null,"We already have a frame buffer"),e.length<=6){const n=Number(e);if(!isNaN(n))return this.handleNewFrameCount_(n),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const n=e.data;if(this.bytesReceived+=n.length,this.stats_.incrementCounter("bytes_received",n.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(n);else{const r=this.extractFrameCount_(n);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();const n=Dt(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const r=k1(n,GT);r.length>1&&this.sendString_(String(r.length));for(let s=0;s<r.length;s++)this.sendString_(r[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(VT))}sendString_(e){try{this.mySock.send(e)}catch(n){this.log_("Exception thrown from WebSocket.send():",n.message||n.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}qn.responsesRequiredToBeHealthy=2;qn.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class va{static get ALL_TRANSPORTS(){return[Ii,qn]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const n=qn&&qn.isAvailable();let r=n&&!qn.previouslyFailed();if(e.webSocketOnly&&(n||Sn("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[qn];else{const s=this.transports_=[];for(const i of va.ALL_TRANSPORTS)i&&i.isAvailable()&&s.push(i);va.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}va.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YT=6e4,KT=5e3,XT=10*1024,QT=100*1024,Ld="t",vm="d",JT="s",_m="r",qT="e",xm="o",Em="a",bm="n",Sm="p",ZT="h";class eI{constructor(e,n,r,s,i,o,a,c,u,p){this.id=e,this.repoInfo_=n,this.applicationId_=r,this.appCheckToken_=s,this.authToken_=i,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=c,this.onKill_=u,this.lastSessionId=p,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Ma("c:"+this.id+":"),this.transportManager_=new va(n),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(n,r)},Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=Go(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>QT?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>XT?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return n=>{e===this.conn_?this.onConnectionLost_(n):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return n=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(n):e===this.secondaryConn_?this.onSecondaryMessageReceived_(n):this.log_("message on old connection"))}}sendRequest(e){const n={t:"d",d:e};this.sendData_(n)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Ld in e){const n=e[Ld];n===Em?this.upgradeIfSecondaryHealthy_():n===_m?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):n===xm&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const n=To("t",e),r=To("d",e);if(n==="c")this.onSecondaryControl_(r);else if(n==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+n)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:Sm,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Em,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:bm,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const n=To("t",e),r=To("d",e);n==="c"?this.onControl_(r):n==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const n=To(Ld,e);if(vm in e){const r=e[vm];if(n===ZT){const s={...r};this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(n===bm){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else n===JT?this.onConnectionShutdown_(r):n===_m?this.onReset_(r):n===qT?Xf("Server Error: "+r):n===xm?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Xf("Unknown control packet command: "+n)}}onHandshake_(e){const n=e.ts,r=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,n),mh!==r&&Sn("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),Go(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(YT))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,n){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(n,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Go(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(KT))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:Sm,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Ls.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G1{put(e,n,r,s){}merge(e,n,r,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,n,r){}onDisconnectMerge(e,n,r){}onDisconnectCancel(e,n){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V1{constructor(e){this.allowedEvents_=e,this.listeners_={},ce(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...n){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let s=0;s<r.length;s++)r[s].callback.apply(r[s].context,n)}}on(e,n,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:n,context:r});const s=this.getInitialEvent(e);s&&n.apply(r,s)}off(e,n,r){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let i=0;i<s.length;i++)if(s[i].callback===n&&(!r||r===s[i].context)){s.splice(i,1);return}}validateEventType_(e){ce(this.allowedEvents_.find(n=>n===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pc extends V1{static getInstance(){return new Pc}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!g1()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return ce(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cm=32,Tm=768;class st{constructor(e,n){if(n===void 0){this.pieces_=e.split("/");let r=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[r]=this.pieces_[s],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=n}toString(){let e="";for(let n=this.pieceNum_;n<this.pieces_.length;n++)this.pieces_[n]!==""&&(e+="/"+this.pieces_[n]);return e||"/"}}function et(){return new st("")}function He(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function ds(t){return t.pieces_.length-t.pieceNum_}function lt(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new st(t.pieces_,e)}function _h(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function tI(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)t.pieces_[n]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}function _a(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function Y1(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new st(e,0)}function wt(t,e){const n=[];for(let r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);if(e instanceof st)for(let r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);else{const r=e.split("/");for(let s=0;s<r.length;s++)r[s].length>0&&n.push(r[s])}return new st(n,0)}function Ge(t){return t.pieceNum_>=t.pieces_.length}function cn(t,e){const n=He(t),r=He(e);if(n===null)return e;if(n===r)return cn(lt(t),lt(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function nI(t,e){const n=_a(t,0),r=_a(e,0);for(let s=0;s<n.length&&s<r.length;s++){const i=qs(n[s],r[s]);if(i!==0)return i}return n.length===r.length?0:n.length<r.length?-1:1}function xh(t,e){if(ds(t)!==ds(e))return!1;for(let n=t.pieceNum_,r=e.pieceNum_;n<=t.pieces_.length;n++,r++)if(t.pieces_[n]!==e.pieces_[r])return!1;return!0}function Fn(t,e){let n=t.pieceNum_,r=e.pieceNum_;if(ds(t)>ds(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[r])return!1;++n,++r}return!0}class rI{constructor(e,n){this.errorPrefix_=n,this.parts_=_a(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=au(this.parts_[r]);K1(this)}}function sI(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=au(e),K1(t)}function iI(t){const e=t.parts_.pop();t.byteLength_-=au(e),t.parts_.length>0&&(t.byteLength_-=1)}function K1(t){if(t.byteLength_>Tm)throw new Error(t.errorPrefix_+"has a key path longer than "+Tm+" bytes ("+t.byteLength_+").");if(t.parts_.length>Cm)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Cm+") or object contains a cycle "+ws(t))}function ws(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eh extends V1{static getInstance(){return new Eh}constructor(){super(["visible"]);let e,n;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(n="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(n="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(n="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(n="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,n&&document.addEventListener(n,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}getInitialEvent(e){return ce(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Io=1e3,oI=60*5*1e3,Im=30*1e3,aI=1.3,lI=3e4,cI="server_kill",km=3;class Ir extends G1{constructor(e,n,r,s,i,o,a,c){if(super(),this.repoInfo_=e,this.applicationId_=n,this.onDataUpdate_=r,this.onConnectStatus_=s,this.onServerInfoUpdate_=i,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=c,this.id=Ir.nextPersistentConnectionId_++,this.log_=Ma("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Io,this.maxReconnectDelay_=oI,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Eh.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&Pc.getInstance().on("online",this.onOnline_,this)}sendRequest(e,n,r){const s=++this.requestNumber_,i={r:s,a:e,b:n};this.log_(Dt(i)),ce(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),r&&(this.requestCBHash_[s]=r)}get(e){this.initConnection_();const n=new xr,s={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?n.resolve(a):n.reject(a)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),n.promise}listen(e,n,r,s){this.initConnection_();const i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),ce(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),ce(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");const a={onComplete:s,hashFn:n,query:e,tag:r};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const n=this.outstandingGets_[e];this.sendRequest("g",n.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(r)})}sendListen_(e){const n=e.query,r=n._path.toString(),s=n._queryIdentifier;this.log_("Listen on "+r+" for "+s);const i={p:r},o="q";e.tag&&(i.q=n._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest(o,i,a=>{const c=a.d,u=a.s;Ir.warnOnListenWarnings_(c,n),(this.listens.get(r)&&this.listens.get(r).get(s))===e&&(this.log_("listen response",a),u!=="ok"&&this.removeListen_(r,s),e.onComplete&&e.onComplete(u,c))})}static warnOnListenWarnings_(e,n){if(e&&typeof e=="object"&&hr(e,"w")){const r=Wi(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const s='".indexOn": "'+n._queryParams.getIndex().toString()+'"',i=n._path.toString();Sn(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${i} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||K2(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Im)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,n=Y2(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(n,r,s=>{const i=s.s,o=s.d||"error";this.authToken_===e&&(i==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(i,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const n=e.s,r=e.d||"error";n==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(n,r)})}unlisten(e,n){const r=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+s),ce(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,s)&&this.connected_&&this.sendUnlisten_(r,s,e._queryObject,n)}sendUnlisten_(e,n,r,s){this.log_("Unlisten on "+e+" for "+n);const i={p:e},o="n";s&&(i.q=r,i.t=s),this.sendRequest(o,i)}onDisconnectPut(e,n,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,n,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:n,onComplete:r})}onDisconnectMerge(e,n,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,n,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:n,onComplete:r})}onDisconnectCancel(e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:n})}sendOnDisconnect_(e,n,r,s){const i={p:n,d:r};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,o=>{s&&setTimeout(()=>{s(o.s,o.d)},Math.floor(0))})}put(e,n,r,s){this.putInternal("p",e,n,r,s)}merge(e,n,r,s){this.putInternal("m",e,n,r,s)}putInternal(e,n,r,s,i){this.initConnection_();const o={p:n,d:r};i!==void 0&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:s}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+n)}sendPut_(e){const n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,s=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,i=>{this.log_(n+" response",i),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(i.s,i.d)})}reportStats(e){if(this.connected_){const n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,r=>{if(r.s!=="ok"){const i=r.d;this.log_("reportStats","Error sending stats: "+i)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Dt(e));const n=e.r,r=this.requestCBHash_[n];r&&(delete this.requestCBHash_[n],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,n){this.log_("handleServerMessage",e,n),e==="d"?this.onDataUpdate_(n.p,n.d,!1,n.t):e==="m"?this.onDataUpdate_(n.p,n.d,!0,n.t):e==="c"?this.onListenRevoked_(n.p,n.q):e==="ac"?this.onAuthRevoked_(n.s,n.d):e==="apc"?this.onAppCheckRevoked_(n.s,n.d):e==="sd"?this.onSecurityDebugPacket_(n):Xf("Unrecognized action received from server: "+Dt(e)+`
Are you using the latest client?`)}onReady_(e,n){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=n,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){ce(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Io,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Io,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>lI&&(this.reconnectDelay_=Io),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let n=Math.max(0,this.reconnectDelay_-e);n=Math.random()*n,this.log_("Trying to reconnect in "+n+"ms"),this.scheduleConnect_(n),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*aI)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+Ir.nextConnectionId_++,i=this.lastSessionId;let o=!1,a=null;const c=function(){a?a.close():(o=!0,r())},u=function(f){ce(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(f)};this.realtime_={close:c,sendRequest:u};const p=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[f,d]=await Promise.all([this.authTokenProvider_.getToken(p),this.appCheckTokenProvider_.getToken(p)]);o?Gt("getToken() completed but was canceled"):(Gt("getToken() completed. Creating connection."),this.authToken_=f&&f.accessToken,this.appCheckToken_=d&&d.token,a=new eI(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,r,y=>{Sn(y+" ("+this.repoInfo_.toString()+")"),this.interrupt(cI)},i))}catch(f){this.log_("Failed to get token: "+f),o||(this.repoInfo_.nodeAdmin&&Sn(f),c())}}}interrupt(e){Gt("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Gt("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Hf(this.interruptReasons_)&&(this.reconnectDelay_=Io,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const n=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:n})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const n=this.outstandingPuts_[e];n&&"h"in n.request&&n.queued&&(n.onComplete&&n.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,n){let r;n?r=n.map(i=>gh(i)).join("$"):r="default";const s=this.removeListen_(e,r);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(e,n){const r=new st(e).toString();let s;if(this.listens.has(r)){const i=this.listens.get(r);s=i.get(n),i.delete(n),i.size===0&&this.listens.delete(r)}else s=void 0;return s}onAuthRevoked_(e,n){Gt("Auth token revoked: "+e+"/"+n),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=km&&(this.reconnectDelay_=Im,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,n){Gt("App check token revoked: "+e+"/"+n),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=km&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const n of e.values())this.sendListen_(n);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let n="js";e["sdk."+n+"."+C1.replace(/\./g,"-")]=1,g1()?e["framework.cordova"]=1:B2()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Pc.getInstance().currentlyOnline();return Hf(this.interruptReasons_)&&e}}Ir.nextPersistentConnectionId_=0;Ir.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ve{constructor(e,n){this.name=e,this.node=n}static Wrap(e,n){return new Ve(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cu{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,n){const r=new Ve(Vi,e),s=new Ve(Vi,n);return this.compare(r,s)!==0}minPost(){return Ve.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Il;class X1 extends cu{static get __EMPTY_NODE(){return Il}static set __EMPTY_NODE(e){Il=e}compare(e,n){return qs(e.name,n.name)}isDefinedOn(e){throw Zi("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,n){return!1}minPost(){return Ve.MIN}maxPost(){return new Ve(Ws,Il)}makePost(e,n){return ce(typeof e=="string","KeyIndex indexValue must always be a string."),new Ve(e,Il)}toString(){return".key"}}const Ni=new X1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kl{constructor(e,n,r,s,i=null){this.isReverse_=s,this.resultGenerator_=i,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=n?r(e.key,n):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),n;if(this.resultGenerator_?n=this.resultGenerator_(e.key,e.value):n={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return n}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Ft{constructor(e,n,r,s,i){this.key=e,this.value=n,this.color=r??Ft.RED,this.left=s??_n.EMPTY_NODE,this.right=i??_n.EMPTY_NODE}copy(e,n,r,s,i){return new Ft(e??this.key,n??this.value,r??this.color,s??this.left,i??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let s=this;const i=r(e,s.key);return i<0?s=s.copy(null,null,null,s.left.insert(e,n,r),null):i===0?s=s.copy(null,n,null,null,null):s=s.copy(null,null,null,null,s.right.insert(e,n,r)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return _n.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,n){let r,s;if(r=this,n(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,n),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),n(e,r.key)===0){if(r.right.isEmpty())return _n.EMPTY_NODE;s=r.right.min_(),r=r.copy(s.key,s.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,n))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Ft.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Ft.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Ft.RED=!0;Ft.BLACK=!1;class uI{copy(e,n,r,s,i){return this}insert(e,n,r){return new Ft(e,n,null)}remove(e,n){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class _n{constructor(e,n=_n.EMPTY_NODE){this.comparator_=e,this.root_=n}insert(e,n){return new _n(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,Ft.BLACK,null,null))}remove(e){return new _n(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Ft.BLACK,null,null))}get(e){let n,r=this.root_;for(;!r.isEmpty();){if(n=this.comparator_(e,r.key),n===0)return r.value;n<0?r=r.left:n>0&&(r=r.right)}return null}getPredecessorKey(e){let n,r=this.root_,s=null;for(;!r.isEmpty();)if(n=this.comparator_(e,r.key),n===0){if(r.left.isEmpty())return s?s.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else n<0?r=r.left:n>0&&(s=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new kl(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,n){return new kl(this.root_,e,this.comparator_,!1,n)}getReverseIteratorFrom(e,n){return new kl(this.root_,e,this.comparator_,!0,n)}getReverseIterator(e){return new kl(this.root_,null,this.comparator_,!0,e)}}_n.EMPTY_NODE=new uI;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dI(t,e){return qs(t.name,e.name)}function bh(t,e){return qs(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Jf;function fI(t){Jf=t}const Q1=function(t){return typeof t=="number"?"number:"+w1(t):"string:"+t},J1=function(t){if(t.isLeafNode()){const e=t.val();ce(typeof e=="string"||typeof e=="number"||typeof e=="object"&&hr(e,".sv"),"Priority must be a string or number.")}else ce(t===Jf||t.isEmpty(),"priority of unexpected type.");ce(t===Jf||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let wm;class Nt{static set __childrenNodeConstructor(e){wm=e}static get __childrenNodeConstructor(){return wm}constructor(e,n=Nt.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=n,this.lazyHash_=null,ce(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),J1(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Nt(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:Nt.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Ge(e)?this:He(e)===".priority"?this.priorityNode_:Nt.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,n){return null}updateImmediateChild(e,n){return e===".priority"?this.updatePriority(n):n.isEmpty()&&e!==".priority"?this:Nt.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)}updateChild(e,n){const r=He(e);return r===null?n:n.isEmpty()&&r!==".priority"?this:(ce(r!==".priority"||ds(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,Nt.__childrenNodeConstructor.EMPTY_NODE.updateChild(lt(e),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,n){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Q1(this.priorityNode_.val())+":");const n=typeof this.value_;e+=n+":",n==="number"?e+=w1(this.value_):e+=this.value_,this.lazyHash_=I1(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Nt.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Nt.__childrenNodeConstructor?-1:(ce(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const n=typeof e.value_,r=typeof this.value_,s=Nt.VALUE_TYPE_ORDER.indexOf(n),i=Nt.VALUE_TYPE_ORDER.indexOf(r);return ce(s>=0,"Unknown leaf type: "+n),ce(i>=0,"Unknown leaf type: "+r),s===i?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const n=e;return this.value_===n.value_&&this.priorityNode_.equals(n.priorityNode_)}else return!1}}Nt.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let q1,Z1;function pI(t){q1=t}function hI(t){Z1=t}class gI extends cu{compare(e,n){const r=e.node.getPriority(),s=n.node.getPriority(),i=r.compareTo(s);return i===0?qs(e.name,n.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,n){return!e.getPriority().equals(n.getPriority())}minPost(){return Ve.MIN}maxPost(){return new Ve(Ws,new Nt("[PRIORITY-POST]",Z1))}makePost(e,n){const r=q1(e);return new Ve(n,new Nt("[PRIORITY-POST]",r))}toString(){return".priority"}}const Et=new gI;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mI=Math.log(2);class yI{constructor(e){const n=i=>parseInt(Math.log(i)/mI,10),r=i=>parseInt(Array(i+1).join("1"),2);this.count=n(e+1),this.current_=this.count-1;const s=r(this.count);this.bits_=e+1&s}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Oc=function(t,e,n,r){t.sort(e);const s=function(c,u){const p=u-c;let f,d;if(p===0)return null;if(p===1)return f=t[c],d=n?n(f):f,new Ft(d,f.node,Ft.BLACK,null,null);{const y=parseInt(p/2,10)+c,S=s(c,y),P=s(y+1,u);return f=t[y],d=n?n(f):f,new Ft(d,f.node,Ft.BLACK,S,P)}},i=function(c){let u=null,p=null,f=t.length;const d=function(S,P){const g=f-S,b=f;f-=S;const x=s(g+1,b),E=t[g],O=n?n(E):E;y(new Ft(O,E.node,P,null,x))},y=function(S){u?(u.left=S,u=S):(p=S,u=S)};for(let S=0;S<c.count;++S){const P=c.nextBitIsOne(),g=Math.pow(2,c.count-(S+1));P?d(g,Ft.BLACK):(d(g,Ft.BLACK),d(g,Ft.RED))}return p},o=new yI(t.length),a=i(o);return new _n(r||e,a)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Dd;const di={};class Cr{static get Default(){return ce(di&&Et,"ChildrenNode.ts has not been loaded"),Dd=Dd||new Cr({".priority":di},{".priority":Et}),Dd}constructor(e,n){this.indexes_=e,this.indexSet_=n}get(e){const n=Wi(this.indexes_,e);if(!n)throw new Error("No index defined for "+e);return n instanceof _n?n:null}hasIndex(e){return hr(this.indexSet_,e.toString())}addIndex(e,n){ce(e!==Ni,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let s=!1;const i=n.getIterator(Ve.Wrap);let o=i.getNext();for(;o;)s=s||e.isDefinedOn(o.node),r.push(o),o=i.getNext();let a;s?a=Oc(r,e.getCompare()):a=di;const c=e.toString(),u={...this.indexSet_};u[c]=e;const p={...this.indexes_};return p[c]=a,new Cr(p,u)}addToIndexes(e,n){const r=Ic(this.indexes_,(s,i)=>{const o=Wi(this.indexSet_,i);if(ce(o,"Missing index implementation for "+i),s===di)if(o.isDefinedOn(e.node)){const a=[],c=n.getIterator(Ve.Wrap);let u=c.getNext();for(;u;)u.name!==e.name&&a.push(u),u=c.getNext();return a.push(e),Oc(a,o.getCompare())}else return di;else{const a=n.get(e.name);let c=s;return a&&(c=c.remove(new Ve(e.name,a))),c.insert(e,e.node)}});return new Cr(r,this.indexSet_)}removeFromIndexes(e,n){const r=Ic(this.indexes_,s=>{if(s===di)return s;{const i=n.get(e.name);return i?s.remove(new Ve(e.name,i)):s}});return new Cr(r,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ko;class Re{static get EMPTY_NODE(){return ko||(ko=new Re(new _n(bh),null,Cr.Default))}constructor(e,n,r){this.children_=e,this.priorityNode_=n,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&J1(this.priorityNode_),this.children_.isEmpty()&&ce(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||ko}updatePriority(e){return this.children_.isEmpty()?this:new Re(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const n=this.children_.get(e);return n===null?ko:n}}getChild(e){const n=He(e);return n===null?this:this.getImmediateChild(n).getChild(lt(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,n){if(ce(n,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(n);{const r=new Ve(e,n);let s,i;n.isEmpty()?(s=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(r,this.children_)):(s=this.children_.insert(e,n),i=this.indexMap_.addToIndexes(r,this.children_));const o=s.isEmpty()?ko:this.priorityNode_;return new Re(s,o,i)}}updateChild(e,n){const r=He(e);if(r===null)return n;{ce(He(e)!==".priority"||ds(e)===1,".priority must be the last token in a path");const s=this.getImmediateChild(r).updateChild(lt(e),n);return this.updateImmediateChild(r,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const n={};let r=0,s=0,i=!0;if(this.forEachChild(Et,(o,a)=>{n[o]=a.val(e),r++,i&&Re.INTEGER_REGEXP_.test(o)?s=Math.max(s,Number(o)):i=!1}),!e&&i&&s<2*r){const o=[];for(const a in n)o[a]=n[a];return o}else return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+Q1(this.getPriority().val())+":"),this.forEachChild(Et,(n,r)=>{const s=r.hash();s!==""&&(e+=":"+n+":"+s)}),this.lazyHash_=e===""?"":I1(e)}return this.lazyHash_}getPredecessorChildName(e,n,r){const s=this.resolveIndex_(r);if(s){const i=s.getPredecessorKey(new Ve(e,n));return i?i.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const n=this.resolveIndex_(e);if(n){const r=n.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){const n=this.getFirstChildName(e);return n?new Ve(n,this.children_.get(n)):null}getLastChildName(e){const n=this.resolveIndex_(e);if(n){const r=n.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){const n=this.getLastChildName(e);return n?new Ve(n,this.children_.get(n)):null}forEachChild(e,n){const r=this.resolveIndex_(e);return r?r.inorderTraversal(s=>n(s.name,s.node)):this.children_.inorderTraversal(n)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,n){const r=this.resolveIndex_(n);if(r)return r.getIteratorFrom(e,s=>s);{const s=this.children_.getIteratorFrom(e.name,Ve.Wrap);let i=s.peek();for(;i!=null&&n.compare(i,e)<0;)s.getNext(),i=s.peek();return s}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,n){const r=this.resolveIndex_(n);if(r)return r.getReverseIteratorFrom(e,s=>s);{const s=this.children_.getReverseIteratorFrom(e.name,Ve.Wrap);let i=s.peek();for(;i!=null&&n.compare(i,e)>0;)s.getNext(),i=s.peek();return s}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Na?-1:0}withIndex(e){if(e===Ni||this.indexMap_.hasIndex(e))return this;{const n=this.indexMap_.addIndex(e,this.children_);return new Re(this.children_,this.priorityNode_,n)}}isIndexed(e){return e===Ni||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority()))if(this.children_.count()===n.children_.count()){const r=this.getIterator(Et),s=n.getIterator(Et);let i=r.getNext(),o=s.getNext();for(;i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=r.getNext(),o=s.getNext()}return i===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===Ni?null:this.indexMap_.get(e.toString())}}Re.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class vI extends Re{constructor(){super(new _n(bh),Re.EMPTY_NODE,Cr.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Re.EMPTY_NODE}isEmpty(){return!1}}const Na=new vI;Object.defineProperties(Ve,{MIN:{value:new Ve(Vi,Re.EMPTY_NODE)},MAX:{value:new Ve(Ws,Na)}});X1.__EMPTY_NODE=Re.EMPTY_NODE;Nt.__childrenNodeConstructor=Re;fI(Na);hI(Na);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _I=!0;function kt(t,e=null){if(t===null)return Re.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),ce(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){const n=t;return new Nt(n,kt(e))}if(!(t instanceof Array)&&_I){const n=[];let r=!1;if(rn(t,(o,a)=>{if(o.substring(0,1)!=="."){const c=kt(a);c.isEmpty()||(r=r||!c.getPriority().isEmpty(),n.push(new Ve(o,c)))}}),n.length===0)return Re.EMPTY_NODE;const i=Oc(n,dI,o=>o.name,bh);if(r){const o=Oc(n,Et.getCompare());return new Re(i,kt(e),new Cr({".priority":o},{".priority":Et}))}else return new Re(i,kt(e),Cr.Default)}else{let n=Re.EMPTY_NODE;return rn(t,(r,s)=>{if(hr(t,r)&&r.substring(0,1)!=="."){const i=kt(s);(i.isLeafNode()||!i.isEmpty())&&(n=n.updateImmediateChild(r,i))}}),n.updatePriority(kt(e))}}pI(kt);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xI extends cu{constructor(e){super(),this.indexPath_=e,ce(!Ge(e)&&He(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,n){const r=this.extractChild(e.node),s=this.extractChild(n.node),i=r.compareTo(s);return i===0?qs(e.name,n.name):i}makePost(e,n){const r=kt(e),s=Re.EMPTY_NODE.updateChild(this.indexPath_,r);return new Ve(n,s)}maxPost(){const e=Re.EMPTY_NODE.updateChild(this.indexPath_,Na);return new Ve(Ws,e)}toString(){return _a(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EI extends cu{compare(e,n){const r=e.node.compareTo(n.node);return r===0?qs(e.name,n.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,n){return!e.equals(n)}minPost(){return Ve.MIN}maxPost(){return Ve.MAX}makePost(e,n){const r=kt(e);return new Ve(n,r)}toString(){return".value"}}const bI=new EI;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ex(t){return{type:"value",snapshotNode:t}}function Yi(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function xa(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function Ea(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}function SI(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sh{constructor(e){this.index_=e}updateChild(e,n,r,s,i,o){ce(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(n);return a.getChild(s).equals(r.getChild(s))&&a.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(n)?o.trackChildChange(xa(n,a)):ce(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Yi(n,r)):o.trackChildChange(Ea(n,r,a))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(n,r).withIndex(this.index_)}updateFullNode(e,n,r){return r!=null&&(e.isLeafNode()||e.forEachChild(Et,(s,i)=>{n.hasChild(s)||r.trackChildChange(xa(s,i))}),n.isLeafNode()||n.forEachChild(Et,(s,i)=>{if(e.hasChild(s)){const o=e.getImmediateChild(s);o.equals(i)||r.trackChildChange(Ea(s,i,o))}else r.trackChildChange(Yi(s,i))})),n.withIndex(this.index_)}updatePriority(e,n){return e.isEmpty()?Re.EMPTY_NODE:e.updatePriority(n)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ba{constructor(e){this.indexedFilter_=new Sh(e.getIndex()),this.index_=e.getIndex(),this.startPost_=ba.getStartPost_(e),this.endPost_=ba.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const n=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return n&&r}updateChild(e,n,r,s,i,o){return this.matches(new Ve(n,r))||(r=Re.EMPTY_NODE),this.indexedFilter_.updateChild(e,n,r,s,i,o)}updateFullNode(e,n,r){n.isLeafNode()&&(n=Re.EMPTY_NODE);let s=n.withIndex(this.index_);s=s.updatePriority(Re.EMPTY_NODE);const i=this;return n.forEachChild(Et,(o,a)=>{i.matches(new Ve(o,a))||(s=s.updateImmediateChild(o,Re.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,r)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const n=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),n)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const n=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),n)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CI{constructor(e){this.withinDirectionalStart=n=>this.reverse_?this.withinEndPost(n):this.withinStartPost(n),this.withinDirectionalEnd=n=>this.reverse_?this.withinStartPost(n):this.withinEndPost(n),this.withinStartPost=n=>{const r=this.index_.compare(this.rangedFilter_.getStartPost(),n);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=n=>{const r=this.index_.compare(n,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new ba(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,n,r,s,i,o){return this.rangedFilter_.matches(new Ve(n,r))||(r=Re.EMPTY_NODE),e.getImmediateChild(n).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,n,r,s,i,o):this.fullLimitUpdateChild_(e,n,r,i,o)}updateFullNode(e,n,r){let s;if(n.isLeafNode()||n.isEmpty())s=Re.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<n.numChildren()&&n.isIndexed(this.index_)){s=Re.EMPTY_NODE.withIndex(this.index_);let i;this.reverse_?i=n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):i=n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;i.hasNext()&&o<this.limit_;){const a=i.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))s=s.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{s=n.withIndex(this.index_),s=s.updatePriority(Re.EMPTY_NODE);let i;this.reverse_?i=s.getReverseIterator(this.index_):i=s.getIterator(this.index_);let o=0;for(;i.hasNext();){const a=i.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:s=s.updateImmediateChild(a.name,Re.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,r)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,n,r,s,i){let o;if(this.reverse_){const f=this.index_.getCompare();o=(d,y)=>f(y,d)}else o=this.index_.getCompare();const a=e;ce(a.numChildren()===this.limit_,"");const c=new Ve(n,r),u=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),p=this.rangedFilter_.matches(c);if(a.hasChild(n)){const f=a.getImmediateChild(n);let d=s.getChildAfterChild(this.index_,u,this.reverse_);for(;d!=null&&(d.name===n||a.hasChild(d.name));)d=s.getChildAfterChild(this.index_,d,this.reverse_);const y=d==null?1:o(d,c);if(p&&!r.isEmpty()&&y>=0)return i!=null&&i.trackChildChange(Ea(n,r,f)),a.updateImmediateChild(n,r);{i!=null&&i.trackChildChange(xa(n,f));const P=a.updateImmediateChild(n,Re.EMPTY_NODE);return d!=null&&this.rangedFilter_.matches(d)?(i!=null&&i.trackChildChange(Yi(d.name,d.node)),P.updateImmediateChild(d.name,d.node)):P}}else return r.isEmpty()?e:p&&o(u,c)>=0?(i!=null&&(i.trackChildChange(xa(u.name,u.node)),i.trackChildChange(Yi(n,r))),a.updateImmediateChild(n,r).updateImmediateChild(u.name,Re.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ch{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Et}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return ce(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return ce(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Vi}hasEnd(){return this.endSet_}getIndexEndValue(){return ce(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return ce(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Ws}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return ce(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Et}copy(){const e=new Ch;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function TI(t){return t.loadsAllData()?new Sh(t.getIndex()):t.hasLimit()?new CI(t):new ba(t)}function Rm(t){const e={};if(t.isDefault())return e;let n;if(t.index_===Et?n="$priority":t.index_===bI?n="$value":t.index_===Ni?n="$key":(ce(t.index_ instanceof xI,"Unrecognized index type!"),n=t.index_.toString()),e.orderBy=Dt(n),t.startSet_){const r=t.startAfterSet_?"startAfter":"startAt";e[r]=Dt(t.indexStartValue_),t.startNameSet_&&(e[r]+=","+Dt(t.indexStartName_))}if(t.endSet_){const r=t.endBeforeSet_?"endBefore":"endAt";e[r]=Dt(t.indexEndValue_),t.endNameSet_&&(e[r]+=","+Dt(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function Am(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;n===""&&(t.isViewFromLeft()?n="l":n="r"),e.vf=n}return t.index_!==Et&&(e.i=t.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lc extends G1{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,n){return n!==void 0?"tag$"+n:(ce(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,n,r,s){super(),this.repoInfo_=e,this.onDataUpdate_=n,this.authTokenProvider_=r,this.appCheckTokenProvider_=s,this.log_=Ma("p:rest:"),this.listens_={}}listen(e,n,r,s){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const o=Lc.getListenId_(e,r),a={};this.listens_[o]=a;const c=Rm(e._queryParams);this.restRequest_(i+".json",c,(u,p)=>{let f=p;if(u===404&&(f=null,u=null),u===null&&this.onDataUpdate_(i,f,!1,r),Wi(this.listens_,o)===a){let d;u?u===401?d="permission_denied":d="rest_error:"+u:d="ok",s(d,null)}})}unlisten(e,n){const r=Lc.getListenId_(e,n);delete this.listens_[r]}get(e){const n=Rm(e._queryParams),r=e._path.toString(),s=new xr;return this.restRequest_(r+".json",n,(i,o)=>{let a=o;i===404&&(a=null,i=null),i===null?(this.onDataUpdate_(r,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(e){}restRequest_(e,n={},r){return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,i])=>{s&&s.accessToken&&(n.auth=s.accessToken),i&&i.token&&(n.ac=i.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+X2(n);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(r&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let c=null;if(a.status>=200&&a.status<300){try{c=ga(a.responseText)}catch{Sn("Failed to parse JSON response for "+o+": "+a.responseText)}r(null,c)}else a.status!==401&&a.status!==404&&Sn("Got unsuccessful REST response for "+o+" Status: "+a.status),r(a.status);r=null}},a.open("GET",o,!0),a.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class II{constructor(){this.rootNode_=Re.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,n){this.rootNode_=this.rootNode_.updateChild(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dc(){return{value:null,children:new Map}}function to(t,e,n){if(Ge(e))t.value=n,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,n);else{const r=He(e);t.children.has(r)||t.children.set(r,Dc());const s=t.children.get(r);e=lt(e),to(s,e,n)}}function qf(t,e){if(Ge(e))return t.value=null,t.children.clear(),!0;if(t.value!==null){if(t.value.isLeafNode())return!1;{const n=t.value;return t.value=null,n.forEachChild(Et,(r,s)=>{to(t,new st(r),s)}),qf(t,e)}}else if(t.children.size>0){const n=He(e);return e=lt(e),t.children.has(n)&&qf(t.children.get(n),e)&&t.children.delete(n),t.children.size===0}else return!0}function Zf(t,e,n){t.value!==null?n(e,t.value):kI(t,(r,s)=>{const i=new st(e.toString()+"/"+r);Zf(s,i,n)})}function kI(t,e){t.children.forEach((n,r)=>{e(r,n)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wI{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),n={...e};return this.last_&&rn(this.last_,(r,s)=>{n[r]=n[r]-s}),this.last_=e,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pm=10*1e3,RI=30*1e3,AI=5*60*1e3;class PI{constructor(e,n){this.server_=n,this.statsToReport_={},this.statsListener_=new wI(e);const r=Pm+(RI-Pm)*Math.random();Go(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),n={};let r=!1;rn(e,(s,i)=>{i>0&&hr(this.statsToReport_,s)&&(n[s]=i,r=!0)}),r&&this.server_.reportStats(n),Go(this.reportStats_.bind(this),Math.floor(Math.random()*2*AI))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Zn;(function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Zn||(Zn={}));function tx(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Th(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Ih(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mc{constructor(e,n,r){this.path=e,this.affectedTree=n,this.revert=r,this.type=Zn.ACK_USER_WRITE,this.source=tx()}operationForChild(e){if(Ge(this.path)){if(this.affectedTree.value!=null)return ce(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const n=this.affectedTree.subtree(new st(e));return new Mc(et(),n,this.revert)}}else return ce(He(this.path)===e,"operationForChild called for unrelated child."),new Mc(lt(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sa{constructor(e,n){this.source=e,this.path=n,this.type=Zn.LISTEN_COMPLETE}operationForChild(e){return Ge(this.path)?new Sa(this.source,et()):new Sa(this.source,lt(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gs{constructor(e,n,r){this.source=e,this.path=n,this.snap=r,this.type=Zn.OVERWRITE}operationForChild(e){return Ge(this.path)?new Gs(this.source,et(),this.snap.getImmediateChild(e)):new Gs(this.source,lt(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ca{constructor(e,n,r){this.source=e,this.path=n,this.children=r,this.type=Zn.MERGE}operationForChild(e){if(Ge(this.path)){const n=this.children.subtree(new st(e));return n.isEmpty()?null:n.value?new Gs(this.source,et(),n.value):new Ca(this.source,et(),n)}else return ce(He(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Ca(this.source,lt(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fs{constructor(e,n,r){this.node_=e,this.fullyInitialized_=n,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Ge(e))return this.isFullyInitialized()&&!this.filtered_;const n=He(e);return this.isCompleteForChild(n)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OI{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function LI(t,e,n,r){const s=[],i=[];return e.forEach(o=>{o.type==="child_changed"&&t.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&i.push(SI(o.childName,o.snapshotNode))}),wo(t,s,"child_removed",e,r,n),wo(t,s,"child_added",e,r,n),wo(t,s,"child_moved",i,r,n),wo(t,s,"child_changed",e,r,n),wo(t,s,"value",e,r,n),s}function wo(t,e,n,r,s,i){const o=r.filter(a=>a.type===n);o.sort((a,c)=>MI(t,a,c)),o.forEach(a=>{const c=DI(t,a,i);s.forEach(u=>{u.respondsTo(a.type)&&e.push(u.createEvent(c,t.query_))})})}function DI(t,e,n){return e.type==="value"||e.type==="child_removed"||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function MI(t,e,n){if(e.childName==null||n.childName==null)throw Zi("Should only compare child_ events.");const r=new Ve(e.childName,e.snapshotNode),s=new Ve(n.childName,n.snapshotNode);return t.index_.compare(r,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uu(t,e){return{eventCache:t,serverCache:e}}function Vo(t,e,n,r){return uu(new fs(e,n,r),t.serverCache)}function nx(t,e,n,r){return uu(t.eventCache,new fs(e,n,r))}function Nc(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function Vs(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Md;const NI=()=>(Md||(Md=new _n(xT)),Md);class ht{static fromObject(e){let n=new ht(null);return rn(e,(r,s)=>{n=n.set(new st(r),s)}),n}constructor(e,n=NI()){this.value=e,this.children=n}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,n){if(this.value!=null&&n(this.value))return{path:et(),value:this.value};if(Ge(e))return null;{const r=He(e),s=this.children.get(r);if(s!==null){const i=s.findRootMostMatchingPathAndValue(lt(e),n);return i!=null?{path:wt(new st(r),i.path),value:i.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(Ge(e))return this;{const n=He(e),r=this.children.get(n);return r!==null?r.subtree(lt(e)):new ht(null)}}set(e,n){if(Ge(e))return new ht(n,this.children);{const r=He(e),i=(this.children.get(r)||new ht(null)).set(lt(e),n),o=this.children.insert(r,i);return new ht(this.value,o)}}remove(e){if(Ge(e))return this.children.isEmpty()?new ht(null):new ht(null,this.children);{const n=He(e),r=this.children.get(n);if(r){const s=r.remove(lt(e));let i;return s.isEmpty()?i=this.children.remove(n):i=this.children.insert(n,s),this.value===null&&i.isEmpty()?new ht(null):new ht(this.value,i)}else return this}}get(e){if(Ge(e))return this.value;{const n=He(e),r=this.children.get(n);return r?r.get(lt(e)):null}}setTree(e,n){if(Ge(e))return n;{const r=He(e),i=(this.children.get(r)||new ht(null)).setTree(lt(e),n);let o;return i.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,i),new ht(this.value,o)}}fold(e){return this.fold_(et(),e)}fold_(e,n){const r={};return this.children.inorderTraversal((s,i)=>{r[s]=i.fold_(wt(e,s),n)}),n(e,this.value,r)}findOnPath(e,n){return this.findOnPath_(e,et(),n)}findOnPath_(e,n,r){const s=this.value?r(n,this.value):!1;if(s)return s;if(Ge(e))return null;{const i=He(e),o=this.children.get(i);return o?o.findOnPath_(lt(e),wt(n,i),r):null}}foreachOnPath(e,n){return this.foreachOnPath_(e,et(),n)}foreachOnPath_(e,n,r){if(Ge(e))return this;{this.value&&r(n,this.value);const s=He(e),i=this.children.get(s);return i?i.foreachOnPath_(lt(e),wt(n,s),r):new ht(null)}}foreach(e){this.foreach_(et(),e)}foreach_(e,n){this.children.inorderTraversal((r,s)=>{s.foreach_(wt(e,r),n)}),this.value&&n(e,this.value)}foreachChild(e){this.children.inorderTraversal((n,r)=>{r.value&&e(n,r.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nr{constructor(e){this.writeTree_=e}static empty(){return new nr(new ht(null))}}function Yo(t,e,n){if(Ge(e))return new nr(new ht(n));{const r=t.writeTree_.findRootMostValueAndPath(e);if(r!=null){const s=r.path;let i=r.value;const o=cn(s,e);return i=i.updateChild(o,n),new nr(t.writeTree_.set(s,i))}else{const s=new ht(n),i=t.writeTree_.setTree(e,s);return new nr(i)}}}function Om(t,e,n){let r=t;return rn(n,(s,i)=>{r=Yo(r,wt(e,s),i)}),r}function Lm(t,e){if(Ge(e))return nr.empty();{const n=t.writeTree_.setTree(e,new ht(null));return new nr(n)}}function ep(t,e){return Zs(t,e)!=null}function Zs(t,e){const n=t.writeTree_.findRootMostValueAndPath(e);return n!=null?t.writeTree_.get(n.path).getChild(cn(n.path,e)):null}function Dm(t){const e=[],n=t.writeTree_.value;return n!=null?n.isLeafNode()||n.forEachChild(Et,(r,s)=>{e.push(new Ve(r,s))}):t.writeTree_.children.inorderTraversal((r,s)=>{s.value!=null&&e.push(new Ve(r,s.value))}),e}function as(t,e){if(Ge(e))return t;{const n=Zs(t,e);return n!=null?new nr(new ht(n)):new nr(t.writeTree_.subtree(e))}}function tp(t){return t.writeTree_.isEmpty()}function Ki(t,e){return rx(et(),t.writeTree_,e)}function rx(t,e,n){if(e.value!=null)return n.updateChild(t,e.value);{let r=null;return e.children.inorderTraversal((s,i)=>{s===".priority"?(ce(i.value!==null,"Priority writes must always be leaf nodes"),r=i.value):n=rx(wt(t,s),i,n)}),!n.getChild(t).isEmpty()&&r!==null&&(n=n.updateChild(wt(t,".priority"),r)),n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function du(t,e){return ax(e,t)}function jI(t,e,n,r,s){ce(r>t.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),t.allWrites.push({path:e,snap:n,writeId:r,visible:s}),s&&(t.visibleWrites=Yo(t.visibleWrites,e,n)),t.lastWriteId=r}function FI(t,e){for(let n=0;n<t.allWrites.length;n++){const r=t.allWrites[n];if(r.writeId===e)return r}return null}function $I(t,e){const n=t.allWrites.findIndex(a=>a.writeId===e);ce(n>=0,"removeWrite called with nonexistent writeId.");const r=t.allWrites[n];t.allWrites.splice(n,1);let s=r.visible,i=!1,o=t.allWrites.length-1;for(;s&&o>=0;){const a=t.allWrites[o];a.visible&&(o>=n&&BI(a,r.path)?s=!1:Fn(r.path,a.path)&&(i=!0)),o--}if(s){if(i)return UI(t),!0;if(r.snap)t.visibleWrites=Lm(t.visibleWrites,r.path);else{const a=r.children;rn(a,c=>{t.visibleWrites=Lm(t.visibleWrites,wt(r.path,c))})}return!0}else return!1}function BI(t,e){if(t.snap)return Fn(t.path,e);for(const n in t.children)if(t.children.hasOwnProperty(n)&&Fn(wt(t.path,n),e))return!0;return!1}function UI(t){t.visibleWrites=sx(t.allWrites,zI,et()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function zI(t){return t.visible}function sx(t,e,n){let r=nr.empty();for(let s=0;s<t.length;++s){const i=t[s];if(e(i)){const o=i.path;let a;if(i.snap)Fn(n,o)?(a=cn(n,o),r=Yo(r,a,i.snap)):Fn(o,n)&&(a=cn(o,n),r=Yo(r,et(),i.snap.getChild(a)));else if(i.children){if(Fn(n,o))a=cn(n,o),r=Om(r,a,i.children);else if(Fn(o,n))if(a=cn(o,n),Ge(a))r=Om(r,et(),i.children);else{const c=Wi(i.children,He(a));if(c){const u=c.getChild(lt(a));r=Yo(r,et(),u)}}}else throw Zi("WriteRecord should have .snap or .children")}}return r}function ix(t,e,n,r,s){if(!r&&!s){const i=Zs(t.visibleWrites,e);if(i!=null)return i;{const o=as(t.visibleWrites,e);if(tp(o))return n;if(n==null&&!ep(o,et()))return null;{const a=n||Re.EMPTY_NODE;return Ki(o,a)}}}else{const i=as(t.visibleWrites,e);if(!s&&tp(i))return n;if(!s&&n==null&&!ep(i,et()))return null;{const o=function(u){return(u.visible||s)&&(!r||!~r.indexOf(u.writeId))&&(Fn(u.path,e)||Fn(e,u.path))},a=sx(t.allWrites,o,e),c=n||Re.EMPTY_NODE;return Ki(a,c)}}}function HI(t,e,n){let r=Re.EMPTY_NODE;const s=Zs(t.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(Et,(i,o)=>{r=r.updateImmediateChild(i,o)}),r;if(n){const i=as(t.visibleWrites,e);return n.forEachChild(Et,(o,a)=>{const c=Ki(as(i,new st(o)),a);r=r.updateImmediateChild(o,c)}),Dm(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{const i=as(t.visibleWrites,e);return Dm(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function WI(t,e,n,r,s){ce(r||s,"Either existingEventSnap or existingServerSnap must exist");const i=wt(e,n);if(ep(t.visibleWrites,i))return null;{const o=as(t.visibleWrites,i);return tp(o)?s.getChild(n):Ki(o,s.getChild(n))}}function GI(t,e,n,r){const s=wt(e,n),i=Zs(t.visibleWrites,s);if(i!=null)return i;if(r.isCompleteForChild(n)){const o=as(t.visibleWrites,s);return Ki(o,r.getNode().getImmediateChild(n))}else return null}function VI(t,e){return Zs(t.visibleWrites,e)}function YI(t,e,n,r,s,i,o){let a;const c=as(t.visibleWrites,e),u=Zs(c,et());if(u!=null)a=u;else if(n!=null)a=Ki(c,n);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const p=[],f=o.getCompare(),d=i?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o);let y=d.getNext();for(;y&&p.length<s;)f(y,r)!==0&&p.push(y),y=d.getNext();return p}else return[]}function KI(){return{visibleWrites:nr.empty(),allWrites:[],lastWriteId:-1}}function jc(t,e,n,r){return ix(t.writeTree,t.treePath,e,n,r)}function kh(t,e){return HI(t.writeTree,t.treePath,e)}function Mm(t,e,n,r){return WI(t.writeTree,t.treePath,e,n,r)}function Fc(t,e){return VI(t.writeTree,wt(t.treePath,e))}function XI(t,e,n,r,s,i){return YI(t.writeTree,t.treePath,e,n,r,s,i)}function wh(t,e,n){return GI(t.writeTree,t.treePath,e,n)}function ox(t,e){return ax(wt(t.treePath,e),t.writeTree)}function ax(t,e){return{treePath:t,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QI{constructor(){this.changeMap=new Map}trackChildChange(e){const n=e.type,r=e.childName;ce(n==="child_added"||n==="child_changed"||n==="child_removed","Only child changes supported for tracking"),ce(r!==".priority","Only non-priority child changes can be tracked.");const s=this.changeMap.get(r);if(s){const i=s.type;if(n==="child_added"&&i==="child_removed")this.changeMap.set(r,Ea(r,e.snapshotNode,s.snapshotNode));else if(n==="child_removed"&&i==="child_added")this.changeMap.delete(r);else if(n==="child_removed"&&i==="child_changed")this.changeMap.set(r,xa(r,s.oldSnap));else if(n==="child_changed"&&i==="child_added")this.changeMap.set(r,Yi(r,e.snapshotNode));else if(n==="child_changed"&&i==="child_changed")this.changeMap.set(r,Ea(r,e.snapshotNode,s.oldSnap));else throw Zi("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JI{getCompleteChild(e){return null}getChildAfterChild(e,n,r){return null}}const lx=new JI;class Rh{constructor(e,n,r=null){this.writes_=e,this.viewCache_=n,this.optCompleteServerCache_=r}getCompleteChild(e){const n=this.viewCache_.eventCache;if(n.isCompleteForChild(e))return n.getNode().getImmediateChild(e);{const r=this.optCompleteServerCache_!=null?new fs(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return wh(this.writes_,e,r)}}getChildAfterChild(e,n,r){const s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Vs(this.viewCache_),i=XI(this.writes_,s,n,1,r,e);return i.length===0?null:i[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qI(t){return{filter:t}}function ZI(t,e){ce(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),ce(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function e5(t,e,n,r,s){const i=new QI;let o,a;if(n.type===Zn.OVERWRITE){const u=n;u.source.fromUser?o=np(t,e,u.path,u.snap,r,s,i):(ce(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered()&&!Ge(u.path),o=$c(t,e,u.path,u.snap,r,s,a,i))}else if(n.type===Zn.MERGE){const u=n;u.source.fromUser?o=n5(t,e,u.path,u.children,r,s,i):(ce(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered(),o=rp(t,e,u.path,u.children,r,s,a,i))}else if(n.type===Zn.ACK_USER_WRITE){const u=n;u.revert?o=i5(t,e,u.path,r,s,i):o=r5(t,e,u.path,u.affectedTree,r,s,i)}else if(n.type===Zn.LISTEN_COMPLETE)o=s5(t,e,n.path,r,i);else throw Zi("Unknown operation type: "+n.type);const c=i.getChanges();return t5(e,o,c),{viewCache:o,changes:c}}function t5(t,e,n){const r=e.eventCache;if(r.isFullyInitialized()){const s=r.getNode().isLeafNode()||r.getNode().isEmpty(),i=Nc(t);(n.length>0||!t.eventCache.isFullyInitialized()||s&&!r.getNode().equals(i)||!r.getNode().getPriority().equals(i.getPriority()))&&n.push(ex(Nc(e)))}}function cx(t,e,n,r,s,i){const o=e.eventCache;if(Fc(r,n)!=null)return e;{let a,c;if(Ge(n))if(ce(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const u=Vs(e),p=u instanceof Re?u:Re.EMPTY_NODE,f=kh(r,p);a=t.filter.updateFullNode(e.eventCache.getNode(),f,i)}else{const u=jc(r,Vs(e));a=t.filter.updateFullNode(e.eventCache.getNode(),u,i)}else{const u=He(n);if(u===".priority"){ce(ds(n)===1,"Can't have a priority with additional path components");const p=o.getNode();c=e.serverCache.getNode();const f=Mm(r,n,p,c);f!=null?a=t.filter.updatePriority(p,f):a=o.getNode()}else{const p=lt(n);let f;if(o.isCompleteForChild(u)){c=e.serverCache.getNode();const d=Mm(r,n,o.getNode(),c);d!=null?f=o.getNode().getImmediateChild(u).updateChild(p,d):f=o.getNode().getImmediateChild(u)}else f=wh(r,u,e.serverCache);f!=null?a=t.filter.updateChild(o.getNode(),u,f,p,s,i):a=o.getNode()}}return Vo(e,a,o.isFullyInitialized()||Ge(n),t.filter.filtersNodes())}}function $c(t,e,n,r,s,i,o,a){const c=e.serverCache;let u;const p=o?t.filter:t.filter.getIndexedFilter();if(Ge(n))u=p.updateFullNode(c.getNode(),r,null);else if(p.filtersNodes()&&!c.isFiltered()){const y=c.getNode().updateChild(n,r);u=p.updateFullNode(c.getNode(),y,null)}else{const y=He(n);if(!c.isCompleteForPath(n)&&ds(n)>1)return e;const S=lt(n),g=c.getNode().getImmediateChild(y).updateChild(S,r);y===".priority"?u=p.updatePriority(c.getNode(),g):u=p.updateChild(c.getNode(),y,g,S,lx,null)}const f=nx(e,u,c.isFullyInitialized()||Ge(n),p.filtersNodes()),d=new Rh(s,f,i);return cx(t,f,n,s,d,a)}function np(t,e,n,r,s,i,o){const a=e.eventCache;let c,u;const p=new Rh(s,e,i);if(Ge(n))u=t.filter.updateFullNode(e.eventCache.getNode(),r,o),c=Vo(e,u,!0,t.filter.filtersNodes());else{const f=He(n);if(f===".priority")u=t.filter.updatePriority(e.eventCache.getNode(),r),c=Vo(e,u,a.isFullyInitialized(),a.isFiltered());else{const d=lt(n),y=a.getNode().getImmediateChild(f);let S;if(Ge(d))S=r;else{const P=p.getCompleteChild(f);P!=null?_h(d)===".priority"&&P.getChild(Y1(d)).isEmpty()?S=P:S=P.updateChild(d,r):S=Re.EMPTY_NODE}if(y.equals(S))c=e;else{const P=t.filter.updateChild(a.getNode(),f,S,d,p,o);c=Vo(e,P,a.isFullyInitialized(),t.filter.filtersNodes())}}}return c}function Nm(t,e){return t.eventCache.isCompleteForChild(e)}function n5(t,e,n,r,s,i,o){let a=e;return r.foreach((c,u)=>{const p=wt(n,c);Nm(e,He(p))&&(a=np(t,a,p,u,s,i,o))}),r.foreach((c,u)=>{const p=wt(n,c);Nm(e,He(p))||(a=np(t,a,p,u,s,i,o))}),a}function jm(t,e,n){return n.foreach((r,s)=>{e=e.updateChild(r,s)}),e}function rp(t,e,n,r,s,i,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,u;Ge(n)?u=r:u=new ht(null).setTree(n,r);const p=e.serverCache.getNode();return u.children.inorderTraversal((f,d)=>{if(p.hasChild(f)){const y=e.serverCache.getNode().getImmediateChild(f),S=jm(t,y,d);c=$c(t,c,new st(f),S,s,i,o,a)}}),u.children.inorderTraversal((f,d)=>{const y=!e.serverCache.isCompleteForChild(f)&&d.value===null;if(!p.hasChild(f)&&!y){const S=e.serverCache.getNode().getImmediateChild(f),P=jm(t,S,d);c=$c(t,c,new st(f),P,s,i,o,a)}}),c}function r5(t,e,n,r,s,i,o){if(Fc(s,n)!=null)return e;const a=e.serverCache.isFiltered(),c=e.serverCache;if(r.value!=null){if(Ge(n)&&c.isFullyInitialized()||c.isCompleteForPath(n))return $c(t,e,n,c.getNode().getChild(n),s,i,a,o);if(Ge(n)){let u=new ht(null);return c.getNode().forEachChild(Ni,(p,f)=>{u=u.set(new st(p),f)}),rp(t,e,n,u,s,i,a,o)}else return e}else{let u=new ht(null);return r.foreach((p,f)=>{const d=wt(n,p);c.isCompleteForPath(d)&&(u=u.set(p,c.getNode().getChild(d)))}),rp(t,e,n,u,s,i,a,o)}}function s5(t,e,n,r,s){const i=e.serverCache,o=nx(e,i.getNode(),i.isFullyInitialized()||Ge(n),i.isFiltered());return cx(t,o,n,r,lx,s)}function i5(t,e,n,r,s,i){let o;if(Fc(r,n)!=null)return e;{const a=new Rh(r,e,s),c=e.eventCache.getNode();let u;if(Ge(n)||He(n)===".priority"){let p;if(e.serverCache.isFullyInitialized())p=jc(r,Vs(e));else{const f=e.serverCache.getNode();ce(f instanceof Re,"serverChildren would be complete if leaf node"),p=kh(r,f)}p=p,u=t.filter.updateFullNode(c,p,i)}else{const p=He(n);let f=wh(r,p,e.serverCache);f==null&&e.serverCache.isCompleteForChild(p)&&(f=c.getImmediateChild(p)),f!=null?u=t.filter.updateChild(c,p,f,lt(n),a,i):e.eventCache.getNode().hasChild(p)?u=t.filter.updateChild(c,p,Re.EMPTY_NODE,lt(n),a,i):u=c,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=jc(r,Vs(e)),o.isLeafNode()&&(u=t.filter.updateFullNode(u,o,i)))}return o=e.serverCache.isFullyInitialized()||Fc(r,et())!=null,Vo(e,u,o,t.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o5{constructor(e,n){this.query_=e,this.eventRegistrations_=[];const r=this.query_._queryParams,s=new Sh(r.getIndex()),i=TI(r);this.processor_=qI(i);const o=n.serverCache,a=n.eventCache,c=s.updateFullNode(Re.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(Re.EMPTY_NODE,a.getNode(),null),p=new fs(c,o.isFullyInitialized(),s.filtersNodes()),f=new fs(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=uu(f,p),this.eventGenerator_=new OI(this.query_)}get query(){return this.query_}}function a5(t){return t.viewCache_.serverCache.getNode()}function l5(t){return Nc(t.viewCache_)}function c5(t,e){const n=Vs(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!Ge(e)&&!n.getImmediateChild(He(e)).isEmpty())?n.getChild(e):null}function Fm(t){return t.eventRegistrations_.length===0}function u5(t,e){t.eventRegistrations_.push(e)}function $m(t,e,n){const r=[];if(n){ce(e==null,"A cancel should cancel all event registrations.");const s=t.query._path;t.eventRegistrations_.forEach(i=>{const o=i.createCancelEvent(n,s);o&&r.push(o)})}if(e){let s=[];for(let i=0;i<t.eventRegistrations_.length;++i){const o=t.eventRegistrations_[i];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(t.eventRegistrations_.slice(i+1));break}}t.eventRegistrations_=s}else t.eventRegistrations_=[];return r}function Bm(t,e,n,r){e.type===Zn.MERGE&&e.source.queryId!==null&&(ce(Vs(t.viewCache_),"We should always have a full cache before handling merges"),ce(Nc(t.viewCache_),"Missing event cache, even though we have a server cache"));const s=t.viewCache_,i=e5(t.processor_,s,e,n,r);return ZI(t.processor_,i.viewCache),ce(i.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=i.viewCache,ux(t,i.changes,i.viewCache.eventCache.getNode(),null)}function d5(t,e){const n=t.viewCache_.eventCache,r=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(Et,(i,o)=>{r.push(Yi(i,o))}),n.isFullyInitialized()&&r.push(ex(n.getNode())),ux(t,r,n.getNode(),e)}function ux(t,e,n,r){const s=r?[r]:t.eventRegistrations_;return LI(t.eventGenerator_,e,n,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Bc;class dx{constructor(){this.views=new Map}}function f5(t){ce(!Bc,"__referenceConstructor has already been defined"),Bc=t}function p5(){return ce(Bc,"Reference.ts has not been loaded"),Bc}function h5(t){return t.views.size===0}function Ah(t,e,n,r){const s=e.source.queryId;if(s!==null){const i=t.views.get(s);return ce(i!=null,"SyncTree gave us an op for an invalid query."),Bm(i,e,n,r)}else{let i=[];for(const o of t.views.values())i=i.concat(Bm(o,e,n,r));return i}}function fx(t,e,n,r,s){const i=e._queryIdentifier,o=t.views.get(i);if(!o){let a=jc(n,s?r:null),c=!1;a?c=!0:r instanceof Re?(a=kh(n,r),c=!1):(a=Re.EMPTY_NODE,c=!1);const u=uu(new fs(a,c,!1),new fs(r,s,!1));return new o5(e,u)}return o}function g5(t,e,n,r,s,i){const o=fx(t,e,r,s,i);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,o),u5(o,n),d5(o,n)}function m5(t,e,n,r){const s=e._queryIdentifier,i=[];let o=[];const a=ps(t);if(s==="default")for(const[c,u]of t.views.entries())o=o.concat($m(u,n,r)),Fm(u)&&(t.views.delete(c),u.query._queryParams.loadsAllData()||i.push(u.query));else{const c=t.views.get(s);c&&(o=o.concat($m(c,n,r)),Fm(c)&&(t.views.delete(s),c.query._queryParams.loadsAllData()||i.push(c.query)))}return a&&!ps(t)&&i.push(new(p5())(e._repo,e._path)),{removed:i,events:o}}function px(t){const e=[];for(const n of t.views.values())n.query._queryParams.loadsAllData()||e.push(n);return e}function ls(t,e){let n=null;for(const r of t.views.values())n=n||c5(r,e);return n}function hx(t,e){if(e._queryParams.loadsAllData())return fu(t);{const r=e._queryIdentifier;return t.views.get(r)}}function gx(t,e){return hx(t,e)!=null}function ps(t){return fu(t)!=null}function fu(t){for(const e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Uc;function y5(t){ce(!Uc,"__referenceConstructor has already been defined"),Uc=t}function v5(){return ce(Uc,"Reference.ts has not been loaded"),Uc}let _5=1;class Um{constructor(e){this.listenProvider_=e,this.syncPointTree_=new ht(null),this.pendingWriteTree_=KI(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function mx(t,e,n,r,s){return jI(t.pendingWriteTree_,e,n,r,s),s?Fa(t,new Gs(tx(),e,n)):[]}function Ds(t,e,n=!1){const r=FI(t.pendingWriteTree_,e);if($I(t.pendingWriteTree_,e)){let i=new ht(null);return r.snap!=null?i=i.set(et(),!0):rn(r.children,o=>{i=i.set(new st(o),!0)}),Fa(t,new Mc(r.path,i,n))}else return[]}function ja(t,e,n){return Fa(t,new Gs(Th(),e,n))}function x5(t,e,n){const r=ht.fromObject(n);return Fa(t,new Ca(Th(),e,r))}function E5(t,e){return Fa(t,new Sa(Th(),e))}function b5(t,e,n){const r=Oh(t,n);if(r){const s=Lh(r),i=s.path,o=s.queryId,a=cn(i,e),c=new Sa(Ih(o),a);return Dh(t,i,c)}else return[]}function zc(t,e,n,r,s=!1){const i=e._path,o=t.syncPointTree_.get(i);let a=[];if(o&&(e._queryIdentifier==="default"||gx(o,e))){const c=m5(o,e,n,r);h5(o)&&(t.syncPointTree_=t.syncPointTree_.remove(i));const u=c.removed;if(a=c.events,!s){const p=u.findIndex(d=>d._queryParams.loadsAllData())!==-1,f=t.syncPointTree_.findOnPath(i,(d,y)=>ps(y));if(p&&!f){const d=t.syncPointTree_.subtree(i);if(!d.isEmpty()){const y=T5(d);for(let S=0;S<y.length;++S){const P=y[S],g=P.query,b=xx(t,P);t.listenProvider_.startListening(Ko(g),Ta(t,g),b.hashFn,b.onComplete)}}}!f&&u.length>0&&!r&&(p?t.listenProvider_.stopListening(Ko(e),null):u.forEach(d=>{const y=t.queryToTagMap.get(pu(d));t.listenProvider_.stopListening(Ko(d),y)}))}I5(t,u)}return a}function yx(t,e,n,r){const s=Oh(t,r);if(s!=null){const i=Lh(s),o=i.path,a=i.queryId,c=cn(o,e),u=new Gs(Ih(a),c,n);return Dh(t,o,u)}else return[]}function S5(t,e,n,r){const s=Oh(t,r);if(s){const i=Lh(s),o=i.path,a=i.queryId,c=cn(o,e),u=ht.fromObject(n),p=new Ca(Ih(a),c,u);return Dh(t,o,p)}else return[]}function sp(t,e,n,r=!1){const s=e._path;let i=null,o=!1;t.syncPointTree_.foreachOnPath(s,(d,y)=>{const S=cn(d,s);i=i||ls(y,S),o=o||ps(y)});let a=t.syncPointTree_.get(s);a?(o=o||ps(a),i=i||ls(a,et())):(a=new dx,t.syncPointTree_=t.syncPointTree_.set(s,a));let c;i!=null?c=!0:(c=!1,i=Re.EMPTY_NODE,t.syncPointTree_.subtree(s).foreachChild((y,S)=>{const P=ls(S,et());P&&(i=i.updateImmediateChild(y,P))}));const u=gx(a,e);if(!u&&!e._queryParams.loadsAllData()){const d=pu(e);ce(!t.queryToTagMap.has(d),"View does not exist, but we have a tag");const y=k5();t.queryToTagMap.set(d,y),t.tagToQueryMap.set(y,d)}const p=du(t.pendingWriteTree_,s);let f=g5(a,e,n,p,i,c);if(!u&&!o&&!r){const d=hx(a,e);f=f.concat(w5(t,e,d))}return f}function Ph(t,e,n){const s=t.pendingWriteTree_,i=t.syncPointTree_.findOnPath(e,(o,a)=>{const c=cn(o,e),u=ls(a,c);if(u)return u});return ix(s,e,i,n,!0)}function C5(t,e){const n=e._path;let r=null;t.syncPointTree_.foreachOnPath(n,(u,p)=>{const f=cn(u,n);r=r||ls(p,f)});let s=t.syncPointTree_.get(n);s?r=r||ls(s,et()):(s=new dx,t.syncPointTree_=t.syncPointTree_.set(n,s));const i=r!=null,o=i?new fs(r,!0,!1):null,a=du(t.pendingWriteTree_,e._path),c=fx(s,e,a,i?o.getNode():Re.EMPTY_NODE,i);return l5(c)}function Fa(t,e){return vx(e,t.syncPointTree_,null,du(t.pendingWriteTree_,et()))}function vx(t,e,n,r){if(Ge(t.path))return _x(t,e,n,r);{const s=e.get(et());n==null&&s!=null&&(n=ls(s,et()));let i=[];const o=He(t.path),a=t.operationForChild(o),c=e.children.get(o);if(c&&a){const u=n?n.getImmediateChild(o):null,p=ox(r,o);i=i.concat(vx(a,c,u,p))}return s&&(i=i.concat(Ah(s,t,r,n))),i}}function _x(t,e,n,r){const s=e.get(et());n==null&&s!=null&&(n=ls(s,et()));let i=[];return e.children.inorderTraversal((o,a)=>{const c=n?n.getImmediateChild(o):null,u=ox(r,o),p=t.operationForChild(o);p&&(i=i.concat(_x(p,a,c,u)))}),s&&(i=i.concat(Ah(s,t,r,n))),i}function xx(t,e){const n=e.query,r=Ta(t,n);return{hashFn:()=>(a5(e)||Re.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return r?b5(t,n._path,r):E5(t,n._path);{const i=ST(s,n);return zc(t,n,null,i)}}}}function Ta(t,e){const n=pu(e);return t.queryToTagMap.get(n)}function pu(t){return t._path.toString()+"$"+t._queryIdentifier}function Oh(t,e){return t.tagToQueryMap.get(e)}function Lh(t){const e=t.indexOf("$");return ce(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new st(t.substr(0,e))}}function Dh(t,e,n){const r=t.syncPointTree_.get(e);ce(r,"Missing sync point for query tag that we're tracking");const s=du(t.pendingWriteTree_,e);return Ah(r,n,s,null)}function T5(t){return t.fold((e,n,r)=>{if(n&&ps(n))return[fu(n)];{let s=[];return n&&(s=px(n)),rn(r,(i,o)=>{s=s.concat(o)}),s}})}function Ko(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(v5())(t._repo,t._path):t}function I5(t,e){for(let n=0;n<e.length;++n){const r=e[n];if(!r._queryParams.loadsAllData()){const s=pu(r),i=t.queryToTagMap.get(s);t.queryToTagMap.delete(s),t.tagToQueryMap.delete(i)}}}function k5(){return _5++}function w5(t,e,n){const r=e._path,s=Ta(t,e),i=xx(t,n),o=t.listenProvider_.startListening(Ko(e),s,i.hashFn,i.onComplete),a=t.syncPointTree_.subtree(r);if(s)ce(!ps(a.value),"If we're adding a query, it shouldn't be shadowed");else{const c=a.fold((u,p,f)=>{if(!Ge(u)&&p&&ps(p))return[fu(p).query];{let d=[];return p&&(d=d.concat(px(p).map(y=>y.query))),rn(f,(y,S)=>{d=d.concat(S)}),d}});for(let u=0;u<c.length;++u){const p=c[u];t.listenProvider_.stopListening(Ko(p),Ta(t,p))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mh{constructor(e){this.node_=e}getImmediateChild(e){const n=this.node_.getImmediateChild(e);return new Mh(n)}node(){return this.node_}}class Nh{constructor(e,n){this.syncTree_=e,this.path_=n}getImmediateChild(e){const n=wt(this.path_,e);return new Nh(this.syncTree_,n)}node(){return Ph(this.syncTree_,this.path_)}}const R5=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},zm=function(t,e,n){if(!t||typeof t!="object")return t;if(ce(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return A5(t[".sv"],e,n);if(typeof t[".sv"]=="object")return P5(t[".sv"],e);ce(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},A5=function(t,e,n){switch(t){case"timestamp":return n.timestamp;default:ce(!1,"Unexpected server value: "+t)}},P5=function(t,e,n){t.hasOwnProperty("increment")||ce(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const r=t.increment;typeof r!="number"&&ce(!1,"Unexpected increment value: "+r);const s=e.node();if(ce(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return r;const o=s.getValue();return typeof o!="number"?r:o+r},O5=function(t,e,n,r){return jh(e,new Nh(n,t),r)},Ex=function(t,e,n){return jh(t,new Mh(e),n)};function jh(t,e,n){const r=t.getPriority().val(),s=zm(r,e.getImmediateChild(".priority"),n);let i;if(t.isLeafNode()){const o=t,a=zm(o.getValue(),e,n);return a!==o.getValue()||s!==o.getPriority().val()?new Nt(a,kt(s)):t}else{const o=t;return i=o,s!==o.getPriority().val()&&(i=i.updatePriority(new Nt(s))),o.forEachChild(Et,(a,c)=>{const u=jh(c,e.getImmediateChild(a),n);u!==c&&(i=i.updateImmediateChild(a,u))}),i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fh{constructor(e="",n=null,r={children:{},childCount:0}){this.name=e,this.parent=n,this.node=r}}function $h(t,e){let n=e instanceof st?e:new st(e),r=t,s=He(n);for(;s!==null;){const i=Wi(r.node.children,s)||{children:{},childCount:0};r=new Fh(s,r,i),n=lt(n),s=He(n)}return r}function no(t){return t.node.value}function bx(t,e){t.node.value=e,ip(t)}function Sx(t){return t.node.childCount>0}function L5(t){return no(t)===void 0&&!Sx(t)}function hu(t,e){rn(t.node.children,(n,r)=>{e(new Fh(n,t,r))})}function Cx(t,e,n,r){n&&e(t),hu(t,s=>{Cx(s,e,!0)})}function D5(t,e,n){let r=t.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function $a(t){return new st(t.parent===null?t.name:$a(t.parent)+"/"+t.name)}function ip(t){t.parent!==null&&M5(t.parent,t.name,t)}function M5(t,e,n){const r=L5(n),s=hr(t.node.children,e);r&&s?(delete t.node.children[e],t.node.childCount--,ip(t)):!r&&!s&&(t.node.children[e]=n.node,t.node.childCount++,ip(t))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N5=/[\[\].#$\/\u0000-\u001F\u007F]/,j5=/[\[\].#$\u0000-\u001F\u007F]/,Nd=10*1024*1024,Bh=function(t){return typeof t=="string"&&t.length!==0&&!N5.test(t)},Tx=function(t){return typeof t=="string"&&t.length!==0&&!j5.test(t)},F5=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Tx(t)},Ix=function(t){return t===null||typeof t=="string"||typeof t=="number"&&!lu(t)||t&&typeof t=="object"&&hr(t,".sv")},Hc=function(t,e,n,r){r&&e===void 0||gu(Gi(t,"value"),e,n)},gu=function(t,e,n){const r=n instanceof st?new rI(n,t):n;if(e===void 0)throw new Error(t+"contains undefined "+ws(r));if(typeof e=="function")throw new Error(t+"contains a function "+ws(r)+" with contents = "+e.toString());if(lu(e))throw new Error(t+"contains "+e.toString()+" "+ws(r));if(typeof e=="string"&&e.length>Nd/3&&au(e)>Nd)throw new Error(t+"contains a string greater than "+Nd+" utf8 bytes "+ws(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,i=!1;if(rn(e,(o,a)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(i=!0,!Bh(o)))throw new Error(t+" contains an invalid key ("+o+") "+ws(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);sI(r,o),gu(t,a,r),iI(r)}),s&&i)throw new Error(t+' contains ".value" child '+ws(r)+" in addition to actual children.")}},$5=function(t,e){let n,r;for(n=0;n<e.length;n++){r=e[n];const i=_a(r);for(let o=0;o<i.length;o++)if(!(i[o]===".priority"&&o===i.length-1)){if(!Bh(i[o]))throw new Error(t+"contains an invalid key ("+i[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(nI);let s=null;for(n=0;n<e.length;n++){if(r=e[n],s!==null&&Fn(s,r))throw new Error(t+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}},B5=function(t,e,n,r){const s=Gi(t,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");const i=[];rn(e,(o,a)=>{const c=new st(o);if(gu(s,a,wt(n,c)),_h(c)===".priority"&&!Ix(a))throw new Error(s+"contains an invalid value for '"+c.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");i.push(c)}),$5(s,i)},U5=function(t,e,n){if(lu(e))throw new Error(Gi(t,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Ix(e))throw new Error(Gi(t,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")},kx=function(t,e,n,r){if(!Tx(n))throw new Error(Gi(t,e)+'was an invalid path = "'+n+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},z5=function(t,e,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),kx(t,e,n)},Ms=function(t,e){if(He(e)===".info")throw new Error(t+" failed = Can't modify data under /.info/")},H5=function(t,e){const n=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Bh(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||n.length!==0&&!F5(n))throw new Error(Gi(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W5{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Uh(t,e){let n=null;for(let r=0;r<e.length;r++){const s=e[r],i=s.getPath();n!==null&&!xh(i,n.path)&&(t.eventLists_.push(n),n=null),n===null&&(n={events:[],path:i}),n.events.push(s)}n&&t.eventLists_.push(n)}function wx(t,e,n){Uh(t,n),Rx(t,r=>xh(r,e))}function pr(t,e,n){Uh(t,n),Rx(t,r=>Fn(r,e)||Fn(e,r))}function Rx(t,e){t.recursionDepth_++;let n=!0;for(let r=0;r<t.eventLists_.length;r++){const s=t.eventLists_[r];if(s){const i=s.path;e(i)?(G5(t.eventLists_[r]),t.eventLists_[r]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function G5(t){for(let e=0;e<t.events.length;e++){const n=t.events[e];if(n!==null){t.events[e]=null;const r=n.getEventRunner();Wo&&Gt("event: "+n.toString()),eo(r)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V5="repo_interrupt",Y5=25;class K5{constructor(e,n,r,s){this.repoInfo_=e,this.forceRestClient_=n,this.authTokenProvider_=r,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new W5,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Dc(),this.transactionQueueTree_=new Fh,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function X5(t,e,n){if(t.stats_=yh(t.repoInfo_),t.forceRestClient_||kT())t.server_=new Lc(t.repoInfo_,(r,s,i,o)=>{Hm(t,r,s,i,o)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>Wm(t,!0),0);else{if(typeof n<"u"&&n!==null){if(typeof n!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Dt(n)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}t.persistentConnection_=new Ir(t.repoInfo_,e,(r,s,i,o)=>{Hm(t,r,s,i,o)},r=>{Wm(t,r)},r=>{Q5(t,r)},t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(r=>{t.server_.refreshAuthToken(r)}),t.appCheckProvider_.addTokenChangeListener(r=>{t.server_.refreshAppCheckToken(r.token)}),t.statsReporter_=OT(t.repoInfo_,()=>new PI(t.stats_,t.server_)),t.infoData_=new II,t.infoSyncTree_=new Um({startListening:(r,s,i,o)=>{let a=[];const c=t.infoData_.getNode(r._path);return c.isEmpty()||(a=ja(t.infoSyncTree_,r._path,c),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),Hh(t,"connected",!1),t.serverSyncTree_=new Um({startListening:(r,s,i,o)=>(t.server_.listen(r,i,s,(a,c)=>{const u=o(a,c);pr(t.eventQueue_,r._path,u)}),[]),stopListening:(r,s)=>{t.server_.unlisten(r,s)}})}function Ax(t){const n=t.infoData_.getNode(new st(".info/serverTimeOffset")).val()||0;return new Date().getTime()+n}function zh(t){return R5({timestamp:Ax(t)})}function Hm(t,e,n,r,s){t.dataUpdateCount++;const i=new st(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let o=[];if(s)if(r){const c=Ic(n,u=>kt(u));o=S5(t.serverSyncTree_,i,c,s)}else{const c=kt(n);o=yx(t.serverSyncTree_,i,c,s)}else if(r){const c=Ic(n,u=>kt(u));o=x5(t.serverSyncTree_,i,c)}else{const c=kt(n);o=ja(t.serverSyncTree_,i,c)}let a=i;o.length>0&&(a=yu(t,i)),pr(t.eventQueue_,a,o)}function Wm(t,e){Hh(t,"connected",e),e===!1&&Z5(t)}function Q5(t,e){rn(e,(n,r)=>{Hh(t,n,r)})}function Hh(t,e,n){const r=new st("/.info/"+e),s=kt(n);t.infoData_.updateSnapshot(r,s);const i=ja(t.infoSyncTree_,r,s);pr(t.eventQueue_,r,i)}function Px(t){return t.nextWriteId_++}function J5(t,e,n){const r=C5(t.serverSyncTree_,e);return r!=null?Promise.resolve(r):t.server_.get(e).then(s=>{const i=kt(s).withIndex(e._queryParams.getIndex());sp(t.serverSyncTree_,e,n,!0);let o;if(e._queryParams.loadsAllData())o=ja(t.serverSyncTree_,e._path,i);else{const a=Ta(t.serverSyncTree_,e);o=yx(t.serverSyncTree_,e._path,i,a)}return pr(t.eventQueue_,e._path,o),zc(t.serverSyncTree_,e,n,null,!0),i},s=>(mu(t,"get for query "+Dt(e)+" failed: "+s),Promise.reject(new Error(s))))}function q5(t,e,n,r,s){mu(t,"set",{path:e.toString(),value:n,priority:r});const i=zh(t),o=kt(n,r),a=Ph(t.serverSyncTree_,e),c=Ex(o,a,i),u=Px(t),p=mx(t.serverSyncTree_,e,c,u,!0);Uh(t.eventQueue_,p),t.server_.put(e.toString(),o.val(!0),(d,y)=>{const S=d==="ok";S||Sn("set at "+e+" failed: "+d);const P=Ds(t.serverSyncTree_,u,!S);pr(t.eventQueue_,e,P),Xi(t,s,d,y)});const f=Nx(t,e);yu(t,f),pr(t.eventQueue_,f,[])}function Z5(t){mu(t,"onDisconnectEvents");const e=zh(t),n=Dc();Zf(t.onDisconnect_,et(),(s,i)=>{const o=O5(s,i,t.serverSyncTree_,e);to(n,s,o)});let r=[];Zf(n,et(),(s,i)=>{r=r.concat(ja(t.serverSyncTree_,s,i));const o=Nx(t,s);yu(t,o)}),t.onDisconnect_=Dc(),pr(t.eventQueue_,et(),r)}function ek(t,e,n){t.server_.onDisconnectCancel(e.toString(),(r,s)=>{r==="ok"&&qf(t.onDisconnect_,e),Xi(t,n,r,s)})}function Gm(t,e,n,r){const s=kt(n);t.server_.onDisconnectPut(e.toString(),s.val(!0),(i,o)=>{i==="ok"&&to(t.onDisconnect_,e,s),Xi(t,r,i,o)})}function tk(t,e,n,r,s){const i=kt(n,r);t.server_.onDisconnectPut(e.toString(),i.val(!0),(o,a)=>{o==="ok"&&to(t.onDisconnect_,e,i),Xi(t,s,o,a)})}function nk(t,e,n,r){if(Hf(n)){Gt("onDisconnect().update() called with empty data.  Don't do anything."),Xi(t,r,"ok",void 0);return}t.server_.onDisconnectMerge(e.toString(),n,(s,i)=>{s==="ok"&&rn(n,(o,a)=>{const c=kt(a);to(t.onDisconnect_,wt(e,o),c)}),Xi(t,r,s,i)})}function rk(t,e,n){let r;He(e._path)===".info"?r=sp(t.infoSyncTree_,e,n):r=sp(t.serverSyncTree_,e,n),wx(t.eventQueue_,e._path,r)}function sk(t,e,n){let r;He(e._path)===".info"?r=zc(t.infoSyncTree_,e,n):r=zc(t.serverSyncTree_,e,n),wx(t.eventQueue_,e._path,r)}function ik(t){t.persistentConnection_&&t.persistentConnection_.interrupt(V5)}function mu(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),Gt(n,...e)}function Xi(t,e,n,r){e&&eo(()=>{if(n==="ok")e(null);else{const s=(n||"error").toUpperCase();let i=s;r&&(i+=": "+r);const o=new Error(i);o.code=s,e(o)}})}function Ox(t,e,n){return Ph(t.serverSyncTree_,e,n)||Re.EMPTY_NODE}function Wh(t,e=t.transactionQueueTree_){if(e||vu(t,e),no(e)){const n=Dx(t,e);ce(n.length>0,"Sending zero length transaction queue"),n.every(s=>s.status===0)&&ok(t,$a(e),n)}else Sx(e)&&hu(e,n=>{Wh(t,n)})}function ok(t,e,n){const r=n.map(u=>u.currentWriteId),s=Ox(t,e,r);let i=s;const o=s.hash();for(let u=0;u<n.length;u++){const p=n[u];ce(p.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),p.status=1,p.retryCount++;const f=cn(e,p.path);i=i.updateChild(f,p.currentOutputSnapshotRaw)}const a=i.val(!0),c=e;t.server_.put(c.toString(),a,u=>{mu(t,"transaction put response",{path:c.toString(),status:u});let p=[];if(u==="ok"){const f=[];for(let d=0;d<n.length;d++)n[d].status=2,p=p.concat(Ds(t.serverSyncTree_,n[d].currentWriteId)),n[d].onComplete&&f.push(()=>n[d].onComplete(null,!0,n[d].currentOutputSnapshotResolved)),n[d].unwatcher();vu(t,$h(t.transactionQueueTree_,e)),Wh(t,t.transactionQueueTree_),pr(t.eventQueue_,e,p);for(let d=0;d<f.length;d++)eo(f[d])}else{if(u==="datastale")for(let f=0;f<n.length;f++)n[f].status===3?n[f].status=4:n[f].status=0;else{Sn("transaction at "+c.toString()+" failed: "+u);for(let f=0;f<n.length;f++)n[f].status=4,n[f].abortReason=u}yu(t,e)}},o)}function yu(t,e){const n=Lx(t,e),r=$a(n),s=Dx(t,n);return ak(t,s,r),r}function ak(t,e,n){if(e.length===0)return;const r=[];let s=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const c=e[a],u=cn(n,c.path);let p=!1,f;if(ce(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)p=!0,f=c.abortReason,s=s.concat(Ds(t.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=Y5)p=!0,f="maxretry",s=s.concat(Ds(t.serverSyncTree_,c.currentWriteId,!0));else{const d=Ox(t,c.path,o);c.currentInputSnapshot=d;const y=e[a].update(d.val());if(y!==void 0){gu("transaction failed: Data returned ",y,c.path);let S=kt(y);typeof y=="object"&&y!=null&&hr(y,".priority")||(S=S.updatePriority(d.getPriority()));const g=c.currentWriteId,b=zh(t),x=Ex(S,d,b);c.currentOutputSnapshotRaw=S,c.currentOutputSnapshotResolved=x,c.currentWriteId=Px(t),o.splice(o.indexOf(g),1),s=s.concat(mx(t.serverSyncTree_,c.path,x,c.currentWriteId,c.applyLocally)),s=s.concat(Ds(t.serverSyncTree_,g,!0))}else p=!0,f="nodata",s=s.concat(Ds(t.serverSyncTree_,c.currentWriteId,!0))}pr(t.eventQueue_,n,s),s=[],p&&(e[a].status=2,function(d){setTimeout(d,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(f==="nodata"?r.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):r.push(()=>e[a].onComplete(new Error(f),!1,null))))}vu(t,t.transactionQueueTree_);for(let a=0;a<r.length;a++)eo(r[a]);Wh(t,t.transactionQueueTree_)}function Lx(t,e){let n,r=t.transactionQueueTree_;for(n=He(e);n!==null&&no(r)===void 0;)r=$h(r,n),e=lt(e),n=He(e);return r}function Dx(t,e){const n=[];return Mx(t,e,n),n.sort((r,s)=>r.order-s.order),n}function Mx(t,e,n){const r=no(e);if(r)for(let s=0;s<r.length;s++)n.push(r[s]);hu(e,s=>{Mx(t,s,n)})}function vu(t,e){const n=no(e);if(n){let r=0;for(let s=0;s<n.length;s++)n[s].status!==2&&(n[r]=n[s],r++);n.length=r,bx(e,n.length>0?n:void 0)}hu(e,r=>{vu(t,r)})}function Nx(t,e){const n=$a(Lx(t,e)),r=$h(t.transactionQueueTree_,e);return D5(r,s=>{jd(t,s)}),jd(t,r),Cx(r,s=>{jd(t,s)}),n}function jd(t,e){const n=no(e);if(n){const r=[];let s=[],i=-1;for(let o=0;o<n.length;o++)n[o].status===3||(n[o].status===1?(ce(i===o-1,"All SENT items should be at beginning of queue."),i=o,n[o].status=3,n[o].abortReason="set"):(ce(n[o].status===0,"Unexpected transaction status in abort"),n[o].unwatcher(),s=s.concat(Ds(t.serverSyncTree_,n[o].currentWriteId,!0)),n[o].onComplete&&r.push(n[o].onComplete.bind(null,new Error("set"),!1,null))));i===-1?bx(e,void 0):n.length=i+1,pr(t.eventQueue_,$a(e),s);for(let o=0;o<r.length;o++)eo(r[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lk(t){let e="";const n=t.split("/");for(let r=0;r<n.length;r++)if(n[r].length>0){let s=n[r];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function ck(t){const e={};t.charAt(0)==="?"&&(t=t.substring(1));for(const n of t.split("&")){if(n.length===0)continue;const r=n.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):Sn(`Invalid query segment '${n}' in query '${t}'`)}return e}const Vm=function(t,e){const n=uk(t),r=n.namespace;n.domain==="firebase.com"&&Or(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&n.domain!=="localhost"&&Or("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||vT();const s=n.scheme==="ws"||n.scheme==="wss";return{repoInfo:new F1(n.host,n.secure,r,s,e,"",r!==n.subdomain),path:new st(n.pathString)}},uk=function(t){let e="",n="",r="",s="",i="",o=!0,a="https",c=443;if(typeof t=="string"){let u=t.indexOf("//");u>=0&&(a=t.substring(0,u-1),t=t.substring(u+2));let p=t.indexOf("/");p===-1&&(p=t.length);let f=t.indexOf("?");f===-1&&(f=t.length),e=t.substring(0,Math.min(p,f)),p<f&&(s=lk(t.substring(p,f)));const d=ck(t.substring(Math.min(t.length,f)));u=e.indexOf(":"),u>=0?(o=a==="https"||a==="wss",c=parseInt(e.substring(u+1),10)):u=e.length;const y=e.slice(0,u);if(y.toLowerCase()==="localhost")n="localhost";else if(y.split(".").length<=2)n=y;else{const S=e.indexOf(".");r=e.substring(0,S).toLowerCase(),n=e.substring(S+1),i=r}"ns"in d&&(i=d.ns)}return{host:e,port:c,domain:n,subdomain:r,secure:o,scheme:a,pathString:s,namespace:i}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ym="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",dk=function(){let t=0;const e=[];return function(n){const r=n===t;t=n;let s;const i=new Array(8);for(s=7;s>=0;s--)i[s]=Ym.charAt(n%64),n=Math.floor(n/64);ce(n===0,"Cannot push at time == 0");let o=i.join("");if(r){for(s=11;s>=0&&e[s]===63;s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)o+=Ym.charAt(e[s]);return ce(o.length===20,"nextPushId: Length should be 20."),o}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fk{constructor(e,n,r,s){this.eventType=e,this.eventRegistration=n,this.snapshot=r,this.prevName=s}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Dt(this.snapshot.exportVal())}}class pk{constructor(e,n,r){this.eventRegistration=e,this.error=n,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jx{constructor(e,n){this.snapshotCallback=e,this.cancelCallback=n}onValue(e,n){this.snapshotCallback.call(null,e,n)}onCancel(e){return ce(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hk{constructor(e,n){this._repo=e,this._path=n}cancel(){const e=new xr;return ek(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Ms("OnDisconnect.remove",this._path);const e=new xr;return Gm(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Ms("OnDisconnect.set",this._path),Hc("OnDisconnect.set",e,this._path,!1);const n=new xr;return Gm(this._repo,this._path,e,n.wrapCallback(()=>{})),n.promise}setWithPriority(e,n){Ms("OnDisconnect.setWithPriority",this._path),Hc("OnDisconnect.setWithPriority",e,this._path,!1),U5("OnDisconnect.setWithPriority",n);const r=new xr;return tk(this._repo,this._path,e,n,r.wrapCallback(()=>{})),r.promise}update(e){Ms("OnDisconnect.update",this._path),B5("OnDisconnect.update",e,this._path);const n=new xr;return nk(this._repo,this._path,e,n.wrapCallback(()=>{})),n.promise}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gh{constructor(e,n,r,s){this._repo=e,this._path=n,this._queryParams=r,this._orderByCalled=s}get key(){return Ge(this._path)?null:_h(this._path)}get ref(){return new Dr(this._repo,this._path)}get _queryIdentifier(){const e=Am(this._queryParams),n=gh(e);return n==="{}"?"default":n}get _queryObject(){return Am(this._queryParams)}isEqual(e){if(e=ys(e),!(e instanceof Gh))return!1;const n=this._repo===e._repo,r=xh(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return n&&r&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+tI(this._path)}}class Dr extends Gh{constructor(e,n){super(e,n,new Ch,!1)}get parent(){const e=Y1(this._path);return e===null?null:new Dr(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class Ia{constructor(e,n,r){this._node=e,this.ref=n,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const n=new st(e),r=ka(this.ref,e);return new Ia(this._node.getChild(n),r,Et)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,s)=>e(new Ia(s,ka(this.ref,r),Et)))}hasChild(e){const n=new st(e);return!this._node.getChild(n).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function wl(t,e){return t=ys(t),t._checkNotDeleted("ref"),e!==void 0?ka(t._root,e):t._root}function ka(t,e){return t=ys(t),He(t._path)===null?z5("child","path",e):kx("child","path",e),new Dr(t._repo,wt(t._path,e))}function gk(t){return t=ys(t),new hk(t._repo,t._path)}function mk(t,e){t=ys(t),Ms("push",t._path),Hc("push",e,t._path,!0);const n=Ax(t._repo),r=dk(n),s=ka(t,r),i=ka(t,r);let o;return o=Promise.resolve(i),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function Rl(t){return Ms("remove",t._path),Fx(t,null)}function Fx(t,e){t=ys(t),Ms("set",t._path),Hc("set",e,t._path,!1);const n=new xr;return q5(t._repo,t._path,e,null,n.wrapCallback(()=>{})),n.promise}function yk(t){t=ys(t);const e=new jx(()=>{}),n=new _u(e);return J5(t._repo,t,n).then(r=>new Ia(r,new Dr(t._repo,t._path),t._queryParams.getIndex()))}class _u{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,n){const r=n._queryParams.getIndex();return new fk("value",this,new Ia(e.snapshotNode,new Dr(n._repo,n._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new pk(this,e,n):null}matches(e){return e instanceof _u?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function vk(t,e,n,r,s){const i=new jx(n,void 0),o=new _u(i);return rk(t._repo,t,o),()=>sk(t._repo,t,o)}function _k(t,e,n,r){return vk(t,"value",e)}f5(Dr);y5(Dr);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xk="FIREBASE_DATABASE_EMULATOR_HOST",op={};let Ek=!1;function bk(t,e,n,r){const s=e.lastIndexOf(":"),i=e.substring(0,s),o=ph(i);t.repoInfo_=new F1(e,o,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0,n),r&&(t.authTokenProvider_=r)}function Sk(t,e,n,r,s){let i=r||t.options.databaseURL;i===void 0&&(t.options.projectId||Or("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Gt("Using default host for project ",t.options.projectId),i=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o=Vm(i,s),a=o.repoInfo,c;typeof process<"u"&&fm&&(c=fm[xk]),c?(i=`http://${c}?ns=${a.namespace}`,o=Vm(i,s),a=o.repoInfo):o.repoInfo.secure;const u=new RT(t.name,t.options,e);H5("Invalid Firebase Database URL",o),Ge(o.path)||Or("Database URL must point to the root of a Firebase Database (not including a child path).");const p=Tk(a,t,u,new wT(t,n));return new Ik(p,t)}function Ck(t,e){const n=op[e];(!n||n[t.key]!==t)&&Or(`Database ${e}(${t.repoInfo_}) has already been deleted.`),ik(t),delete n[t.key]}function Tk(t,e,n,r){let s=op[e.name];s||(s={},op[e.name]=s);let i=s[t.toURLString()];return i&&Or("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new K5(t,Ek,n,r),s[t.toURLString()]=i,i}class Ik{constructor(e,n){this._repoInternal=e,this.app=n,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(X5(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Dr(this._repo,et())),this._rootInternal}_delete(){return this._rootInternal!==null&&(Ck(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Or("Cannot call "+e+" on a deleted database.")}}function kk(t=ZC(),e){const n=KC(t,"database").getImmediate({identifier:e});if(!n._instanceStarted){const r=L2("database");r&&wk(n,...r)}return n}function wk(t,e,n,r={}){t=ys(t),t._checkNotDeleted("useEmulator");const s=`${e}:${n}`,i=t._repoInternal;if(t._instanceStarted){if(s===t._repoInternal.repoInfo_.host&&kc(r,i.repoInfo_.emulatorOptions))return;Or("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&Or('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new Jl(Jl.OWNER);else if(r.mockUserToken){const a=typeof r.mockUserToken=="string"?r.mockUserToken:M2(r.mockUserToken,t.app.options.projectId);o=new Jl(a)}ph(e)&&(D2(e),F2("Database",!0)),bk(i,s,r,o)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rk(t){fT(qC),Rc(new ma("database",(e,{instanceIdentifier:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return Sk(r,s,i,n)},"PUBLIC").setMultipleInstances(!0)),Di(pm,hm,t),Di(pm,hm,"esm2020")}Ir.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};Ir.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};Rk();const Ak={apiKey:"AIzaSyCqXssa5oOaWY3CiN7ti53Qt1F_AGpBrVE",authDomain:"tenfubu-verse.firebaseapp.com",databaseURL:"https://tenfubu-verse-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"tenfubu-verse",storageBucket:"tenfubu-verse.firebasestorage.app",messagingSenderId:"1047996014362",appId:"1:1047996014362:web:729f6b715d929087e296a3"},Pk=E1(Ak),Al=kk(Pk);class Ok{constructor(){zt(this,"myEntryRef",null);zt(this,"listenerUnsubscribe",null);zt(this,"myId","");zt(this,"myPeerId","");zt(this,"hasMatched",!1)}async startMatchmaking(e,n,r,s,i,o){this.myPeerId=e,this.hasMatched=!1;const a=wl(Al,`matchmaking/${s}`);try{const c=await yk(a),u=[];if(c.exists()&&c.forEach(y=>{const S=y.val(),P=Date.now()-S.timestamp<5*60*1e3;S.peerId!==e&&P&&u.push({key:y.key,data:S})}),u.length>0){const y=u.sort((S,P)=>S.data.timestamp-P.data.timestamp)[0];await Rl(wl(Al,`matchmaking/${s}/${y.key}`)),i("matched"),o({peerId:y.data.peerId,playerName:y.data.playerName,playerClass:y.data.playerClass,isHost:!1});return}i("searching");const p=mk(a);this.myEntryRef=p,this.myId=p.key;const f={id:this.myId,peerId:e,playerName:n,playerClass:r,matchType:s,timestamp:Date.now()};await Fx(p,f),gk(p).remove();const d=s;this.listenerUnsubscribe=_k(a,async y=>{if(this.hasMatched||!y.exists())return;let S=!1,P=null;if(y.forEach(g=>{const b=g.val();g.key===this.myId?S=!0:b.peerId!==this.myPeerId&&(!P||b.timestamp>P.data.timestamp)&&(P={key:g.key,data:b})}),!S&&this.myEntryRef){if(this.hasMatched)return;this.hasMatched=!0,i("matched"),this.cleanup();return}if(P!==null&&S){const g=y.child(this.myId).val(),b=P;if(g&&g.timestamp<b.data.timestamp){if(this.hasMatched)return;this.hasMatched=!0,await Rl(wl(Al,`matchmaking/${d}/${b.key}`)),await Rl(wl(Al,`matchmaking/${d}/${this.myId}`)),this.cleanup(),i("matched"),o({peerId:b.data.peerId,playerName:b.data.playerName,playerClass:b.data.playerClass,isHost:!0})}}})}catch(c){console.error("[Matchmaking] Error:",c),i("error"),this.cleanup()}}async cancelMatchmaking(){if(this.myEntryRef)try{await Rl(this.myEntryRef)}catch(e){console.error("[Matchmaking] Error removing entry:",e)}this.cleanup()}cleanup(){this.listenerUnsubscribe&&(this.listenerUnsubscribe(),this.listenerUnsubscribe=null),this.myEntryRef=null,this.myId=""}}const Fd=new Ok;class Km{constructor(e,n,r=!1){zt(this,"peer");zt(this,"conn");zt(this,"isHost",!1);zt(this,"messageCallback",null);zt(this,"closeCallback",null);this.peer=e,this.conn=n,this.isHost=r,n.on("data",s=>{this.messageCallback&&this.messageCallback(s)}),n.on("close",()=>{console.log("[PeerJSAdapter] Connection closed"),this.closeCallback&&this.closeCallback()}),n.on("error",s=>console.error("[PeerJSAdapter] Connection Error:",s))}async connect(e){return this.peer.id}onConnection(e){}onClose(e){this.closeCallback=e}isConnected(){return this.conn!==null&&this.conn.open}send(e){this.conn&&this.conn.open?this.conn.send(e):console.warn("[PeerJSAdapter] Connection not open, cannot send message")}onMessage(e){this.messageCallback=e}disconnect(){var e,n;(e=this.conn)==null||e.close(),(n=this.peer)==null||n.destroy()}}const Lk=1280,Dk=720,Mk=({matchType:t,playerClass:e,playerName:n,onGameStart:r,onCancel:s})=>{const[i,o]=V.useState("idle"),[a,c]=V.useState("..."),[u,p]=V.useState(0),f=V.useRef(null),d=V.useRef(null),y=V.useRef(null),S=V.useRef(!1),P=V.useRef(!1),[g,b]=V.useState(1);V.useEffect(()=>{const O=()=>{const Q=window.innerWidth/Lk,F=window.innerHeight/Dk;b(Math.min(Q,F))};return O(),window.addEventListener("resize",O),()=>window.removeEventListener("resize",O)},[]),V.useEffect(()=>{if(i!=="searching")return;const O=setInterval(()=>{p(Q=>Q+1)},1e3);return()=>clearInterval(O)},[i]),V.useEffect(()=>{let O=!0;return(async()=>{try{const F=new a1({debug:1,config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]}});if(f.current=F,await new Promise((J,me)=>{F.on("open",()=>J()),F.on("error",A=>me(A))}),!O)return;const se=F.id;console.log("[Matchmaking] My PeerJS ID:",se),F.on("connection",J=>{console.log("[Matchmaking] Incoming connection from:",J.peer),d.current=J,J.on("open",()=>{console.log("[Matchmaking] Connection opened (as HOST)"),J.on("data",me=>{if(me.type==="PLAYER_INFO"){console.log("[Matchmaking] Received player info:",me),J.send({type:"PLAYER_INFO",playerName:n,playerClass:e}),P.current=!0;const A=new Km(F,J,!0);r(A,me.playerClass,!0)}})})}),Fd.startMatchmaking(se,n,e,t,J=>{if(O)switch(o(J),J){case"searching":c("...");break;case"matched":c("...");break;case"error":c("");break}},async J=>{if(O)if(console.log("[Matchmaking] Match found:",J),y.current=J,S.current=J.isHost,J.isHost)c("...");else{c("...");const me=F.connect(J.peerId,{reliable:!0});d.current=me,me.on("open",()=>{console.log("[Matchmaking] Connection opened (as JOIN)"),me.send({type:"PLAYER_INFO",playerName:n,playerClass:e}),me.on("data",A=>{if(A.type==="PLAYER_INFO"){console.log("[Matchmaking] Received player info:",A),P.current=!0;const C=new Km(F,me,!1);r(C,A.playerClass,!1)}})}),me.on("error",A=>{console.error("[Matchmaking] Connection error:",A),o("error"),c("")})}})}catch(F){console.error("[Matchmaking] Init error:",F),O&&(o("error"),c(""))}})(),()=>{O=!1,Fd.cancelMatchmaking(),P.current||(d.current&&d.current.close(),f.current&&f.current.destroy())}},[t,e,n,r]);const x=async()=>{await Fd.cancelMatchmaking(),d.current&&d.current.close(),f.current&&f.current.destroy(),s()},E=O=>{const Q=Math.floor(O/60),F=O%60;return`${Q}:${F.toString().padStart(2,"0")}`};return l.jsxs("div",{className:"screen",style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white"},children:[l.jsx("div",{style:{fontSize:`${1.2*g}rem`,color:"#4ade80",marginBottom:`${1*g}rem`,fontWeight:"bold"},children:t==="casual"?"":""}),l.jsx("div",{style:{fontSize:`${2*g}rem`,fontWeight:"bold",marginBottom:`${1*g}rem`,textAlign:"center"},children:a}),i==="searching"&&l.jsxs("div",{style:{fontSize:`${1.5*g}rem`,color:"#888",marginBottom:`${2*g}rem`},children:[": ",E(u)]}),(i==="searching"||i==="matched")&&l.jsx("div",{style:{width:80*g,height:80*g,border:"4px solid rgba(255,255,255,0.2)",borderTop:"4px solid #4ade80",borderRadius:"50%",animation:"spin 1s linear infinite",marginBottom:`${2*g}rem`}}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:`${1*g}rem`,marginBottom:`${2*g}rem`,padding:`${1*g}rem`,background:"rgba(255,255,255,0.1)",borderRadius:8*g},children:[l.jsx("div",{style:{fontSize:`${1*g}rem`},children:n||""}),l.jsx("div",{style:{fontSize:`${.9*g}rem`,color:e==="SENKA"?"#e94560":"#45a2e9"},children:e==="SENKA"?"":e==="AJA"?"":""})]}),i!=="error"&&l.jsx("button",{onClick:x,style:{padding:`${.8*g}rem ${2*g}rem`,fontSize:`${1*g}rem`,background:"transparent",border:"2px solid #e94560",color:"#e94560",borderRadius:8*g,cursor:"pointer",transition:"all 0.2s"},onMouseOver:O=>{O.currentTarget.style.background="#e94560",O.currentTarget.style.color="white"},onMouseOut:O=>{O.currentTarget.style.background="transparent",O.currentTarget.style.color="#e94560"},children:""}),i==="error"&&l.jsx("button",{onClick:s,style:{padding:`${.8*g}rem ${2*g}rem`,fontSize:`${1*g}rem`,background:"#e94560",border:"none",color:"white",borderRadius:8*g,cursor:"pointer"},children:""}),l.jsx("style",{children:`
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `})]})},Xm=20,Vh=[{id:1,filename:"1_yoroshiku.png",label:"",se:"pa.mp3"},{id:2,filename:"2_nandato.png",label:"",se:"shock.mp3"},{id:3,filename:"3_thank.png",label:"",se:"thanks.mp3"},{id:4,filename:"4_willwin.png",label:"",se:"nt.mp3"},{id:5,filename:"5_dontmind.png",label:"",se:"boyon.mp3"},{id:6,filename:"6_thinking.png",label:"",se:"thinking.mp3"},{id:7,filename:"7_gg.png",label:"GG",se:"kiri.mp3"},{id:8,filename:"8_sorry.png",label:"",se:"gomen.mp3"}],Qm=(t,e)=>{const n=Vh.find(s=>s.id===t);return n?`/stamps/${e==="AJA"?"azya":e.toLowerCase()}/${n.filename}`:""},Jm=t=>{const e=Vh.find(n=>n.id===t);return(e==null?void 0:e.se)||null},Ns=[{id:"s_3cats",name:"",cost:2,type:"SPELL",description:"1",flavorText:"",imageUrl:"/cards/chatora_three_cats.png",triggers:[{trigger:"FANFARE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_CHATORA"},{type:"GENERATE_CARD",targetCardId:"TOKEN_SABATORA"},{type:"GENERATE_CARD",targetCardId:"TOKEN_KIJITORA"}]}]},{id:"s_final_cannon",name:"",cost:10,type:"SPELL",description:"1",flavorText:'""""',imageUrl:"/cards/final_cannon.png",triggers:[{trigger:"FANFARE",effects:[{type:"SET_MAX_HP",value:1,targetType:"OPPONENT"}]}]},{id:"c_senka_knuckler",name:"",cost:8,type:"FOLLOWER",attack:3,health:5,description:`[] []
2
[]
1`,flavorText:`

`,imageUrl:"/cards/senka.png",evolvedImageUrl:"/cards/senka_2.png",tags:["Knuckler"],passiveAbilities:["STORM","DOUBLE_ATTACK"],attackEffectType:"IMPACT",triggers:[{trigger:"SUPER_EVOLVE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_FLICKER_JAB"},{type:"GENERATE_CARD",targetCardId:"TOKEN_QUAKE_HOWLING"},{type:"GENERATE_CARD",targetCardId:"TOKEN_BACKHAND_SMASH"}]}]},{id:"c_ruiyu",name:"",cost:7,type:"FOLLOWER",attack:5,health:5,description:`4cyoriena
14`,flavorText:`
`,imageUrl:"/cards/ruiyu.png",evolvedImageUrl:"/cards/ruiyu_2.png",attackEffectType:"BLUE_FIRE",triggers:[{trigger:"FANFARE",effects:[{type:"HEAL_LEADER",value:4,targetType:"SELF"},{type:"SUMMON_CARD",targetCardId:"c_cyoriena"}]},{trigger:"EVOLVE",effects:[{type:"DESTROY",targetType:"SELECT_FOLLOWER"},{type:"HEAL_LEADER",value:4,targetType:"SELF"}]}]},{id:"c_y",name:"Y",cost:6,type:"FOLLOWER",attack:3,health:3,description:`[]
142
3`,flavorText:"",imageUrl:"/cards/y.png",evolvedImageUrl:"/cards/y_2.png",passiveAbilities:["STEALTH"],attackEffectType:"SUMI",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:4,targetType:"SELECT_FOLLOWER"},{type:"AOE_DAMAGE",value:2,targetType:"ALL_FOLLOWERS"}]},{trigger:"EVOLVE",effects:[{type:"AOE_DAMAGE",value:3,targetType:"ALL_FOLLOWERS"}]}]},{id:"c_tsubumaru",name:"",cost:2,type:"FOLLOWER",attack:1,health:3,description:`[]
1
1`,flavorText:`

`,imageUrl:"/cards/tsubumaru.png",evolvedImageUrl:"/cards/tsubumaru_2.png",passiveAbilities:["WARD"],attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"GENERATE_CARD",targetCardId:"s_resignation_proxy"}]}]},{id:"c_barura",name:"",cost:4,type:"FOLLOWER",attack:3,health:4,description:`1
13`,flavorText:`

`,imageUrl:"/cards/barura.png",evolvedImageUrl:"/cards/barura_2.png",attackEffectType:"FIRE",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:3,targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_CHATORA",name:"",cost:0,type:"FOLLOWER",attack:1,health:1,description:"",flavorText:"",imageUrl:"/cards/chatora.png",attackEffectType:"SLASH"},{id:"TOKEN_SABATORA",name:"",cost:1,type:"FOLLOWER",attack:1,health:2,description:"[]",flavorText:"",passiveAbilities:["RUSH"],imageUrl:"/cards/sabatora.png",attackEffectType:"SLASH"},{id:"TOKEN_KIJITORA",name:"",cost:3,type:"FOLLOWER",attack:2,health:3,description:"[]",flavorText:"",passiveAbilities:["WARD"],imageUrl:"/cards/kijitora.png",attackEffectType:"SLASH"},{id:"TOKEN_RICE",name:"",cost:0,type:"SPELL",description:"1",flavorText:" ",imageUrl:"/cards/rice.png",triggers:[{trigger:"FANFARE",effects:[{type:"HEAL_LEADER",value:1,targetType:"SELF"}]}]},{id:"c_yunagi",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:`1
11`,flavorText:`


`,imageUrl:"/cards/yunagi.png",evolvedImageUrl:"/cards/yunagi_2.png",attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:1,targetType:"SELECT_FOLLOWER"},{type:"GENERATE_CARD",targetCardId:"TOKEN_OOMORI_RICE"}]}]},{id:"TOKEN_OOMORI_RICE",name:"",cost:1,type:"SPELL",description:"3",flavorText:"",imageUrl:"/cards/oomoririce.png",tags:["Token"],triggers:[{trigger:"FANFARE",effects:[{type:"HEAL_LEADER",value:3,targetType:"SELF"}]}]},{id:"c_nayuta",name:"",cost:4,type:"FOLLOWER",attack:3,health:3,description:`[]
1
1`,flavorText:"",imageUrl:"/cards/nayuta.png",evolvedImageUrl:"/cards/nayuta_2.png",attackEffectType:"RAY",passiveAbilities:["WARD"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]},{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]}]},{id:"c_yunagi_ward",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:`[]
1`,imageUrl:"/cards/yunagi.png",evolvedImageUrl:"/cards/yunagi_2.png",passiveAbilities:["WARD"],triggers:[{trigger:"FANFARE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_RICE"}]}]},{id:"c_nayuta_ward",name:"",cost:4,type:"FOLLOWER",attack:3,health:3,description:`[]
1
1`,imageUrl:"/cards/nayuta.png",evolvedImageUrl:"/cards/nayuta_2.png",passiveAbilities:["WARD"],attackEffectType:"RAY",triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]},{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]}]},{id:"c_azya",name:"",cost:8,type:"FOLLOWER",attack:4,health:4,description:`[]
3211-2
1+1/+2[][]0`,flavorText:`
&&`,imageUrl:"/cards/azya.png",evolvedImageUrl:"/cards/azya_2.png",attackEffectType:"THUNDER",passiveAbilities:["AURA"],triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:3,targetType:"OPPONENT"},{type:"HEAL_LEADER",value:2,targetType:"SELF"},{type:"RANDOM_DESTROY",value:1},{type:"RANDOM_BOUNCE",value:1},{type:"REDUCE_HAND_COST",value:2,conditions:{nameIn:["","",""]}}]},{trigger:"SUPER_EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_tsubumaru"},{type:"SUMMON_CARD",targetCardId:"c_yunagi"},{type:"SUMMON_CARD",targetCardId:"c_nayuta"},{type:"BUFF_STATS",value:1,value2:2,targetType:"ALL_OTHER_FOLLOWERS"},{type:"GRANT_PASSIVE",targetPassive:"WARD",targetType:"ALL_OTHER_FOLLOWERS"},{type:"GRANT_PASSIVE",targetPassive:"RUSH",targetType:"ALL_OTHER_FOLLOWERS"},{type:"GENERATE_CARD",targetCardId:"s_yucho_of_the_abyss"},{type:"GENERATE_CARD",targetCardId:"s_thats_mine"},{type:"GRANT_LEADER_DAMAGE_SHIELD"}]}]},{id:"c_yuki",name:"",cost:3,type:"FOLLOWER",attack:3,health:2,description:`[]
+1/+1`,flavorText:"",imageUrl:"/cards/yuki.png",evolvedImageUrl:"/cards/yuki_2.png",tags:["Knuckler"],passiveAbilities:["RUSH"],attackEffectType:"IMPACT",triggers:[{trigger:"EVOLVE",effects:[{type:"BUFF_STATS",value:1,value2:1,targetType:"ALL_FOLLOWERS"}]}]},{id:"c_white_tsubaki",name:"",cost:4,type:"FOLLOWER",attack:4,health:3,description:`[]

01
1`,flavorText:`
`,imageUrl:"/cards/white_tsubaki.png",evolvedImageUrl:"/cards/white_tsubaki_2.png",tags:["Knuckler"],passiveAbilities:["RUSH","IMMUNE_TO_FOLLOWER_DAMAGE","GUTS_MY_TURN"],attackEffectType:"ICE",triggers:[{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_shieko"}]}]},{id:"c_shieko",name:"",cost:2,type:"FOLLOWER",attack:2,health:1,description:`[]
1+2/+2`,flavorText:`
`,imageUrl:"/cards/shieko.png",evolvedImageUrl:"/cards/shieko_2.png",tags:["Knuckler"],passiveAbilities:["RUSH"],attackEffectType:"IMPACT",triggers:[{trigger:"EVOLVE",effects:[{type:"BUFF_STATS",value:2,value2:2,targetType:"SELECT_OTHER_ALLY_FOLLOWER"}]}]},{id:"c_urara",name:"",cost:3,type:"FOLLOWER",attack:2,health:2,description:`[] []
2`,flavorText:`
`,imageUrl:"/cards/urara.png",evolvedImageUrl:"/cards/urara_2.png",passiveAbilities:["WARD","BARRIER"],attackEffectType:"WATER",triggers:[{trigger:"EVOLVE",effects:[{type:"HEAL_LEADER",value:2}]}]},{id:"c_kasuga",name:"",cost:10,type:"FOLLOWER",attack:8,health:8,description:"",flavorText:`

`,imageUrl:"/cards/kasuga.png",evolvedImageUrl:"/cards/kasuga_2.png",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY",targetType:"ALL_OTHER_FOLLOWERS"}]}],attackEffectType:"SLASH"},{id:"c_kyokune",name:"",cost:4,type:"FOLLOWER",attack:4,health:4,description:"1",imageUrl:"/cards/kyokune.jpg",triggers:[{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_sia"}]}],attackEffectType:"SLASH"},{id:"c_sia",name:"",cost:2,type:"FOLLOWER",attack:2,health:1,description:"21",flavorText:"",imageUrl:"/cards/sia.png",evolvedImageUrl:"/cards/sia_2.png",attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DAMAGE",value:1,value2:2,targetType:"OPPONENT"}]}]},{id:"TOKEN_BACKHAND_SMASH",name:"",cost:0,type:"SPELL",description:"16",flavorText:`10
`,imageUrl:"/cards/BackhandSmash.jpg",tags:["Token"],attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:6,targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_QUAKE_HOWLING",name:"",cost:0,type:"SPELL",description:"2",flavorText:"",imageUrl:"/cards/QuakeHowling.png",tags:["Token"],attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"AOE_DAMAGE",value:2,targetType:"ALL_FOLLOWERS"}]}]},{id:"TOKEN_FLICKER_JAB",name:"",cost:0,type:"SPELL",description:"12",flavorText:`
BHS
`,imageUrl:"/cards/FlickerJab.png",tags:["Token"],attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:2,targetType:"SELECT_FOLLOWER"}]}]},{id:"c_bucchi",name:"",cost:5,type:"FOLLOWER",attack:1,health:3,description:"3",flavorText:`
`,imageUrl:"/cards/bucchi.png",evolvedImageUrl:"/cards/bucchi_2.png",attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_manary"},{type:"SUMMON_CARD",targetCardId:"c_manary"},{type:"SUMMON_CARD",targetCardId:"c_manary"}]}]},{id:"c_valkyrie",name:"",cost:6,type:"FOLLOWER",attack:6,health:6,description:`[] [] []
[]`,flavorText:"",imageUrl:"/cards/valkyrie.png",evolvedImageUrl:"/cards/valkyrie_2.png",passiveAbilities:["WARD","BARRIER","AURA"],attackEffectType:"RAY",triggers:[{trigger:"END_OF_TURN",effects:[{type:"GRANT_PASSIVE",targetPassive:"BARRIER",targetType:"SELF"}]}]},{id:"c_manary",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:"[]",flavorText:"^^",imageUrl:"/cards/manary.png",evolvedImageUrl:"/cards/manary_2.png",tags:["Token"],passiveAbilities:["WARD"],attackEffectType:"WATER"},{id:"c_potechi",name:"",cost:3,type:"FOLLOWER",attack:2,health:3,description:`[]
1`,flavorText:"",imageUrl:"/cards/potechi.png",evolvedImageUrl:"/cards/potechi_2.png",passiveAbilities:["WARD"],attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]}]},{id:"c_mono",name:"Mono",cost:3,type:"FOLLOWER",attack:2,health:1,description:`15
15`,flavorText:"",imageUrl:"/cards/Mono.png",evolvedImageUrl:"/cards/Mono_2.png",attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:5,targetType:"SELECT_FOLLOWER"}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:5,targetType:"SELECT_FOLLOWER"}]}]},{id:"c_sara",name:"sara",cost:7,type:"FOLLOWER",attack:4,health:6,description:`2111
1`,flavorText:"w",imageUrl:"/cards/sara.png",evolvedImageUrl:"/cards/sara_2.png",attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DESTROY",value:2,targetType:"OPPONENT"},{type:"GENERATE_CARD",targetCardId:"TOKEN_SORRY_THE_END",conditions:{minTurn:11}}]},{trigger:"SUPER_EVOLVE",effects:[{type:"DESTROY",targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_SORRY_THE_END",name:"",cost:3,type:"SPELL",description:"553sara1",flavorText:'""',imageUrl:"/cards/sorryTheEnd.png",tags:["Token"],attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"AOE_DAMAGE",value:5,targetType:"ALL_FOLLOWERS"},{type:"DAMAGE",value:5,targetType:"OPPONENT"},{type:"DRAW",value:3},{type:"SUMMON_CARD",targetCardId:"c_sara"}]}]},{id:"c_blue_tsubaki",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:`1
1`,flavorText:"",imageUrl:"/cards/blue_tsubaki.png",evolvedImageUrl:"/cards/blue_tsubaki_2.png",attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"RANDOM_DESTROY",value:1,targetType:"OPPONENT"}]}]},{id:"s_resignation_proxy",name:"",cost:0,type:"SPELL",description:"11",flavorText:"1",imageUrl:"/cards/taisyokudaiko.png",tags:["Token"],attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DESTROY",targetType:"OPPONENT",value:1},{type:"DRAW",value:1}]}]},{id:"s_yucho_of_the_abyss",name:"",cost:0,type:"SPELL",description:"11",flavorText:"",imageUrl:"/cards/yuchooftheabyss.png",tags:["Token"],attackEffectType:"THUNDER",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DAMAGE_BY_TURN",value:1,targetType:"OPPONENT"}]}]},{id:"s_thats_mine",name:"",cost:2,type:"SPELL",description:"1",flavorText:"",imageUrl:"/cards/thatsmine.png",tags:["Token"],attackEffectType:"ICE",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY_AND_GENERATE",value:0,targetType:"SELECT_FOLLOWER"}]}]},{id:"s_tenfubu_yabe_hutari",name:"2",cost:4,type:"SPELL",description:"11",flavorText:"",imageUrl:"/cards/tenfubuyabehutari.png",triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_yuki"},{type:"SUMMON_CARD",targetCardId:"c_potechi"}]}]},{id:"s_samurai_tea",name:"",cost:2,type:"SPELL",description:"1+1/+1",flavorText:'""""',imageUrl:"/cards/samuraitea.png",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1},{type:"BUFF_STATS",value:1,value2:1,targetType:"ALL_FOLLOWERS"}]}]},{id:"s_crazy_knucklers",name:"",cost:5,type:"SPELL",description:"+1/+11",flavorText:`
www www`,imageUrl:"/cards/crazy_knucklers.png",triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD_BUFFED",targetCardId:"c_white_tsubaki",value:1,value2:1},{type:"SUMMON_CARD_BUFFED",targetCardId:"c_shieko",value:1,value2:1},{type:"DRAW",value:1}]}]},{id:"s_knuckle_four",name:"",cost:10,type:"SPELL",description:"444",flavorText:"",imageUrl:"/cards/knucklefour.png",attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DESTROY",value:4,targetType:"OPPONENT"},{type:"DRAW",value:4},{type:"HEAL_LEADER",value:4,targetType:"SELF"}]}]},{id:"c_amandava",name:"amandava",cost:5,attack:2,health:3,type:"FOLLOWER",description:`21
1`,flavorText:"",imageUrl:"/cards/amandava.png",evolvedImageUrl:"/cards/amandava_2.png",attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_SET_HP",value:2,value2:1,targetType:"OPPONENT"}]},{trigger:"EVOLVE",effects:[{type:"AOE_DAMAGE",value:1,targetType:"ALL_FOLLOWERS"}]}]},{id:"c_alice",name:"",cost:3,attack:1,health:1,type:"FOLLOWER",description:`22
22`,flavorText:"",imageUrl:"/cards/alice.png",evolvedImageUrl:"/cards/alice_2.png",attackEffectType:"FIRE",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DAMAGE",value:2,value2:2,targetType:"OPPONENT"}]},{trigger:"EVOLVE",effects:[{type:"RANDOM_DAMAGE",value:2,value2:2,targetType:"OPPONENT"}]}]},{id:"c_yuri",name:"",cost:5,type:"FOLLOWER",attack:3,health:3,description:`1
13`,flavorText:`
`,imageUrl:"/cards/yuri.png",evolvedImageUrl:"/cards/yuri_2.png",attackEffectType:"WATER",triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"TOKEN_SUIHYORYU"}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:3,targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_SUIHYORYU",name:"",cost:5,type:"FOLLOWER",attack:4,health:4,description:`[] []
`,flavorText:"",imageUrl:"/cards/suihyoryu.png",evolvedImageUrl:"/cards/suihyoryu.png",tags:["Token"],passiveAbilities:["RUSH","WARD"],attackEffectType:"ICE",triggers:[{trigger:"START_OF_TURN",effects:[{type:"DESTROY_SELF"}]}]},{id:"c_cyoriena",name:"cyoriena",cost:2,type:"FOLLOWER",attack:1,health:2,description:`[] []
HP2
`,flavorText:"7",imageUrl:"/cards/cyoriena.png",evolvedImageUrl:"/cards/cyoriena_2.png",tags:["Token"],passiveAbilities:["WARD","BARRIER"],attackEffectType:"RAY",triggers:[{trigger:"END_OF_TURN",effects:[{type:"HEAL_LEADER",value:2,targetType:"SELF"}]},{trigger:"EVOLVE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_TSUBASA"}]}]},{id:"TOKEN_TSUBASA",name:"",cost:1,type:"SPELL",description:"1[]",flavorText:"",imageUrl:"/cards/tsubasa.png",tags:["Token"],triggers:[{trigger:"FANFARE",effects:[{type:"GRANT_PASSIVE",targetPassive:"STORM",targetType:"SELECT_ALLY_FOLLOWER"}]}]},{id:"c_yamato",name:"",cost:5,type:"FOLLOWER",attack:5,health:1,description:"[]",imageUrl:"/cards/yamato.jpg",passiveAbilities:["STORM"],attackEffectType:"SLASH"},{id:"c_yoruka",name:"yoRuka",cost:8,type:"FOLLOWER",attack:5,health:5,description:`1
 5yoRuka1
2`,flavorText:"Y",imageUrl:"/cards/yoRuka.png",evolvedImageUrl:"/cards/yoRuka_2.png",attackEffectType:"SUMI",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY",targetType:"SELECT_FOLLOWER"}]},{trigger:"LAST_WORD",effects:[{type:"SUMMON_CARD",targetCardId:"c_yoruka",necromance:5}]},{trigger:"SUPER_EVOLVE",effects:[{type:"RANDOM_DESTROY",value:2,targetType:"OPPONENT"}]}]},{id:"c_haruka",name:"",cost:7,type:"FOLLOWER",attack:2,health:3,description:`[]
[]1
1 5+2/+0`,flavorText:"",imageUrl:"/cards/haruka.png",evolvedImageUrl:"/cards/haruka_2.png",passiveAbilities:["STEALTH"],attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD_RUSH",targetCardId:"c_yuka"},{type:"SUMMON_CARD",targetCardId:"c_setsuna"}]},{trigger:"SUPER_EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_setsuna"},{type:"BUFF_STATS",value:2,value2:0,targetType:"ALL_OTHER_FOLLOWERS",necromance:5}]}]},{id:"c_setsuna",name:"",cost:3,type:"FOLLOWER",attack:1,health:1,description:`[] []
-11`,flavorText:"",imageUrl:"/cards/setsuna.png",evolvedImageUrl:"/cards/setsuna_2.png",passiveAbilities:["STORM","BANE"],attackEffectType:"SUMI",triggers:[{trigger:"LAST_WORD",effects:[{type:"BUFF_STATS",value:-1,value2:0,targetType:"RANDOM_FOLLOWER"},{type:"ADD_GRAVEYARD",value:1}]}]},{id:"c_yuka",name:"",cost:5,type:"FOLLOWER",attack:1,health:6,description:`[] []
1
132`,flavorText:"",imageUrl:"/cards/yuka.png",evolvedImageUrl:"/cards/yuka_2.png",passiveAbilities:["WARD","AURA"],attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_setsuna"}]},{trigger:"EVOLVE",effects:[{type:"RANDOM_DAMAGE",value:3,value2:1,targetType:"OPPONENT"},{type:"RANDOM_DAMAGE",value:3,value2:1,targetType:"OPPONENT"}]}]},{id:"s_hayakikoto",name:"",cost:4,type:"SPELL",description:"12",flavorText:"",imageUrl:"/cards/hayakikoto.png",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1},{type:"SUMMON_CARD",targetCardId:"c_setsuna"},{type:"SUMMON_CARD",targetCardId:"c_setsuna"}]}]},{id:"s_keishou",name:"",cost:9,type:"SPELL",description:"1-9",flavorText:`
`,imageUrl:"/cards/keisyopower.png",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY_AND_GENERATE",targetType:"SELECT_FOLLOWER",value:-9}]}]}];function Yh(t){let e=t;return()=>(e=(e*1664525+1013904223)%4294967296,e/4294967296)}function Nk(t,e){let n=t.length,r;for(;n!=0;)r=Math.floor(e()*n),n--,[t[n],t[r]]=[t[r],t[n]];return t}function jk(t){var s;const e=t.players.p1,n=t.players.p2;return[t.turnCount,t.activePlayerId,e.hp,e.maxHp,e.pp,e.maxPp,e.sep,e.evolutionsUsed,n.hp,n.maxHp,n.pp,n.maxPp,n.sep,n.evolutionsUsed,e.board.map(i=>i?`${i.id}_${i.instanceId}_${i.currentHealth}_${i.hasBarrier?"B":""}`:"null").join(","),n.board.map(i=>i?`${i.id}_${i.instanceId}_${i.currentHealth}_${i.hasBarrier?"B":""}`:"null").join(","),e.hand.length,n.hand.length,((s=t.pendingEffects)==null?void 0:s.length)||0,t.rngSeed].join("|")}const Fk=[{cardId:"c_senka_knuckler",count:3},{cardId:"c_yuki",count:3},{cardId:"c_white_tsubaki",count:3},{cardId:"c_shieko",count:3},{cardId:"s_samurai_tea",count:3},{cardId:"c_bucchi",count:2},{cardId:"c_valkyrie",count:1},{cardId:"c_potechi",count:3},{cardId:"s_tenfubu_yabe_hutari",count:3},{cardId:"s_crazy_knucklers",count:2},{cardId:"c_sia",count:2},{cardId:"c_mono",count:3},{cardId:"c_ruiyu",count:1},{cardId:"c_kasuga",count:1},{cardId:"c_y",count:2},{cardId:"c_sara",count:1},{cardId:"s_knuckle_four",count:1},{cardId:"c_blue_tsubaki",count:3}],$k=[{cardId:"c_azya",count:3},{cardId:"c_ruiyu",count:2},{cardId:"c_y",count:2},{cardId:"c_sara",count:2},{cardId:"c_urara",count:3},{cardId:"c_yunagi",count:3},{cardId:"c_tsubumaru",count:3},{cardId:"c_nayuta",count:3},{cardId:"c_yuri",count:2},{cardId:"c_alice",count:3},{cardId:"c_kasuga",count:1},{cardId:"c_barura",count:3},{cardId:"c_valkyrie",count:3},{cardId:"s_3cats",count:2},{cardId:"s_final_cannon",count:1},{cardId:"c_amandava",count:2},{cardId:"c_mono",count:2}],Bk=[{cardId:"c_yoruka",count:3},{cardId:"c_y",count:3},{cardId:"c_haruka",count:3},{cardId:"c_yuka",count:3},{cardId:"c_setsuna",count:3},{cardId:"s_hayakikoto",count:3},{cardId:"s_keishou",count:1},{cardId:"c_kasuga",count:1},{cardId:"c_yunagi",count:3},{cardId:"c_tsubumaru",count:3},{cardId:"c_nayuta",count:3},{cardId:"c_mono",count:3},{cardId:"c_ruiyu",count:1},{cardId:"c_sara",count:1},{cardId:"s_3cats",count:2},{cardId:"c_yuri",count:2},{cardId:"c_sia",count:2}];function Er(t){const e=Ns.find(n=>n.id===t);return e||Ns.find(n=>n.name===t)}function $x(){return Ns.map(t=>t.name).sort((t,e)=>e.length-t.length)}function Pl(t){return{STORM:"",RUSH:"",WARD:"",BARRIER:"",AURA:"",STEALTH:"",BANE:"",DOUBLE_ATTACK:"",IMMUNE_TO_FOLLOWER_DAMAGE:"",GUTS_MY_TURN:""}[t]||t}function Uk(t,e){const n=[];let r=0;return t.forEach(s=>{const i=Er(s.cardId);if(i)for(let o=0;o<s.count;o++)n.push({...i,id:`${e}_c${r}`,instanceId:`inst_${e}_c${r}`}),r++;else console.warn(`Card definition not found: ${s.cardId}`)}),n}function qm(t,e,n,r){const i=Uk(n==="SENKA"?Fk:n==="AJA"?$k:Bk,t);return{id:t,name:e,class:n,hp:Xm,maxHp:Xm,pp:0,maxPp:0,sep:2,deck:Nk(i,r),hand:[],graveyard:[],board:[],evolutionsUsed:0,canEvolveThisTurn:!1,extraPpUsedEarly:!1,extraPpUsedLate:!1,extraPpActive:!1}}function ql(t,e,n,r,s,i=!0){const o=Math.floor(Math.random()*1e6),a=Yh(o),c=qm("p1",t,e,a),u=qm("p2",n,r,a);c.hand=c.deck.splice(0,4),u.hand=u.deck.splice(0,4);let p,f;return i?(p="p1",f=t,c.maxPp=1,c.pp=1,u.maxPp=0,u.pp=0):(p="p2",f=n,c.maxPp=0,c.pp=0,u.maxPp=1,u.pp=1),{phase:"INIT",rngSeed:Math.floor(a()*1e6),activePlayerId:p,firstPlayerId:p,players:{p1:c,p2:u},turnCount:1,pendingEffects:[],logs:[` 1 - ${f} `],winnerId:void 0}}function ap(t){return t==="p1"?"p2":"p1"}function zk(t,e,n,r,s,i){var f,d,y,S,P,g,b,x,E,O,Q,F,se,J,me,A;let o={...t,players:{p1:{...t.players.p1,hand:[...t.players.p1.hand],deck:[...t.players.p1.deck],board:t.players.p1.board.map(C=>C?{...C,passiveAbilities:C.passiveAbilities?[...C.passiveAbilities]:[]}:null),graveyard:[...t.players.p1.graveyard]},p2:{...t.players.p2,hand:[...t.players.p2.hand],deck:[...t.players.p2.deck],board:t.players.p2.board.map(C=>C?{...C,passiveAbilities:C.passiveAbilities?[...C.passiveAbilities]:[]}:null),graveyard:[...t.players.p2.graveyard]}},logs:[...t.logs||[]]};const a=Yh(o.rngSeed||999);o.rngSeed=Math.floor(a()*1e6);const c=ap(e),u=C=>{for(const k of["p1","p2"]){const I=o.players[k].board.findIndex(m=>(m==null?void 0:m.instanceId)===C);if(I!==-1&&o.players[k].board[I])return{card:o.players[k].board[I],player:o.players[k],index:I}}return null};if(r.necromance!==void 0&&r.necromance>0){const C=o.players[e];if(C.graveyard.length<r.necromance)return console.log(`[Engine] : ${C.graveyard.length} < ${r.necromance}`),o;const k=C.graveyard.splice(-r.necromance,r.necromance);o.logs.push(`${C.name}  ${r.necromance} `),console.log(`[Engine] : ${k.map(I=>I.name).join(", ")} `)}const p=(C,k)=>{var m;const I=(m=C.triggers)==null?void 0:m.find(R=>R.trigger==="LAST_WORD");if(I){const R=I.effects.map($=>({sourceCard:C,effect:$,sourcePlayerId:k}));o.pendingEffects=[...o.pendingEffects||[],...R],o.logs.push(`${C.name} `),console.log(`[Engine] processSingleEffect: Last Word triggered for ${C.name}. pendingEffects count: ${o.pendingEffects.length}`)}};switch(r.type){case"DAMAGE":{const C=r.value||0;if(r.targetType==="SELECT_FOLLOWER"&&s){const k=u(s);if(k){const{card:I,player:m,index:R}=k;if(I.hasBarrier)I.hasBarrier=!1,o.logs.push(`${I.name} `);else if(I.currentHealth-=C,o.logs.push(`${n.name}  ${I.name}  ${C} `),I.currentHealth<=0){I.currentHealth=Math.min(0,I.currentHealth);const $=Object.keys(o.players).find(L=>o.players[L]===m)||c;p(I,$),m.graveyard.push(I),m.board[R]=null,o.logs.push(`${I.name} `)}}}else if(r.targetType==="OPPONENT"){const k=o.players[c];if(k.leaderDamageShield)k.leaderDamageShield=!1,o.logs.push(`${n.name}  ${C} `);else{const I=k.board.some(R=>{var $;return($=R==null?void 0:R.passiveAbilities)==null?void 0:$.includes("LEADER_DAMAGE_CAP")}),m=I?Math.min(C,1):C;k.hp-=m,I&&C>1?o.logs.push(`${n.name}  ${C} 1`):o.logs.push(`${n.name}  ${m} `),k.hp<=0&&(o.winnerId=e,o.logs.push(`${k.name} `))}}break}case"AOE_DAMAGE":{const C=r.value||0;if(r.targetType==="ALL_FOLLOWERS"){const k=o.players[c].board,I=i&&i.length>0?new Set(i):null;k.forEach(R=>{if(R){if(I&&!I.has(R.instanceId))return;R.hasBarrier?(R.hasBarrier=!1,o.logs.push(`${R.name} `)):R.currentHealth-=C}}),k.filter(R=>R&&R.currentHealth<=0).forEach(R=>{R&&(R.currentHealth=Math.min(0,R.currentHealth),p(R,c),o.players[c].graveyard.push(R),o.logs.push(`${R.name} `))}),o.logs.push(`${n.name}  ${C} `),k.forEach((R,$)=>{R&&R.currentHealth<=0&&(k[$]=null)})}break}case"DRAW":{const C=r.value||1,k=o.players[e];for(let I=0;I<C;I++)if(k.deck.length>0){const m=k.deck.pop();m&&(k.hand.length<9?k.hand.push(m):(k.graveyard.push(m),o.logs.push(`${k.name}${m.name}`)))}o.logs.push(`${k.name}  ${C} `);break}case"ADD_GRAVEYARD":{const C=r.value||1,k=o.players[e];for(let I=0;I<C;I++){const m={...n,instanceId:`grave_${o.rngSeed}_${Math.floor(a()*1e3)}_${I}`};k.graveyard.push(m)}o.logs.push(`${k.name}  ${C} `);break}case"HEAL_LEADER":{const C=r.value||0,k=o.players[e];k.hp=Math.min(k.maxHp,k.hp+C),o.logs.push(`${k.name}  ${C} HP`);break}case"DESTROY":{const C=(k,I)=>{var m;return((m=k.passiveAbilities)==null?void 0:m.includes("IMMUNE_TO_DAMAGE_MY_TURN"))===!0&&o.activePlayerId===I};if(r.targetType==="ALL_OTHER_FOLLOWERS"){const k=o.players[c].board,I=[];k.forEach(L=>{L&&(C(L,c)?(I.push(L),o.logs.push(`${L.name} `)):(p(L,c),o.players[c].graveyard.push(L)))}),o.players[c].board=I;const m=o.players[e].board,R=[],$=n.instanceId;m.forEach(L=>{L&&($&&L.instanceId===$?R.push(L):C(L,e)?(R.push(L),o.logs.push(`${L.name} `)):(p(L,e),o.players[e].graveyard.push(L)))}),o.players[e].board=R,o.logs.push(`${n.name} `)}else if((r.targetType==="SELECT_FOLLOWER"||r.targetType==="SELECT_ALLY_FOLLOWER")&&s){const k=u(s);if(k){const{card:I,player:m,index:R}=k,$=Object.keys(o.players).find(L=>o.players[L].board.includes(I))||"";C(I,$)?o.logs.push(`${I.name} `):(I.currentHealth=1,p(I,$),m.graveyard.push(I),m.board[R]=null,o.logs.push(`${I.name}  ${n.name} `))}}break}case"GENERATE_CARD":{if((f=r.conditions)!=null&&f.minTurn&&t.turnCount<r.conditions.minTurn)break;const C=r.targetCardId,k=Ns.find(I=>I.id===C);if(k){const I=o.players[e],m=`gen_${o.rngSeed}_${Date.now()}_${Math.floor(a()*1e4)}`,R={...k,id:`token_${o.rngSeed}_${Math.floor(a()*1e3)}`,instanceId:m};I.hand.length<9?(I.hand.push(R),o.logs.push(`${I.name}  ${k.name} `)):(I.graveyard.push(R),o.logs.push(`${I.name}${k.name}`))}break}case"REDUCE_HAND_COST":{const C=r.value||0,k=((d=r.conditions)==null?void 0:d.nameIn)||[],I=o.players[e];let m=0;I.hand.forEach(R=>{if(k.includes(R.name)){const $=R.cost,L=Math.max(0,$-C);L!==$&&(R.cost=L,R.baseCost=L,m++)}}),m>0&&o.logs.push(`${n.name} -${C}`);break}case"GRANT_LEADER_DAMAGE_SHIELD":{const C=o.players[e];C.leaderDamageShield=!0,o.logs.push(`${C.name} 0`);break}case"RANDOM_DESTROY":{const C=(R,$)=>{var L;return((L=R.passiveAbilities)==null?void 0:L.includes("IMMUNE_TO_DAMAGE_MY_TURN"))===!0&&o.activePlayerId===$},k=r.value||1,I=r.targetType==="SELF"?e:c,m=o.players[I].board;if(i&&i.length>0)i.forEach(R=>{const $=m.findIndex(L=>(L==null?void 0:L.instanceId)===R);if($!==-1&&m[$]){const L=m[$];C(L,I)?o.logs.push(`${L.name} `):(L.currentHealth=1,p(L,I),o.players[I].graveyard.push(L),m[$]=null,o.logs.push(`${L.name}  ${n.name} `))}});else{const R=m.map((L,T)=>!L||C(L,I)?-1:T).filter(L=>L!==-1);for(let L=R.length-1;L>0;L--){const T=Math.floor(a()*(L+1));[R[L],R[T]]=[R[T],R[L]]}R.slice(0,k).forEach(L=>{const T=m[L];T&&(T.currentHealth=1,p(T,I),o.players[I].graveyard.push(T),m[L]=null,o.logs.push(`${T.name}  ${n.name} `))})}break}case"RANDOM_SET_HP":{const C=r.value||1,k=r.value2||1,I=r.targetType==="SELF"?e:c,m=o.players[I].board;if(i&&i.length>0)i.forEach(R=>{const $=m.findIndex(L=>(L==null?void 0:L.instanceId)===R);$!==-1&&m[$]&&(m[$].currentHealth=k,o.logs.push(`${m[$].name} HP ${k} `))});else{const R=m.map((L,T)=>L?T:-1).filter(L=>L!==-1);for(let L=R.length-1;L>0;L--){const T=Math.floor(a()*(L+1));[R[L],R[T]]=[R[T],R[L]]}R.slice(0,C).forEach(L=>{const T=m[L];T&&(T.currentHealth=k,o.logs.push(`${T.name} HP ${k} `))})}break}case"RANDOM_DAMAGE":{const C=r.value2||1,k=r.value||0,I=r.targetType==="SELF"?e:c,m=o.players[I].board,R=L=>{const T=m[L];T&&(T.hasBarrier?(T.hasBarrier=!1,o.logs.push(`${T.name} `)):(T.currentHealth-=k,o.logs.push(`${n.name}  ${T.name}  ${k} `)),T.currentHealth<=0&&(T.currentHealth=0,p(T,I),o.players[I].graveyard.push(T),m[L]=null,o.logs.push(`${T.name} `)))},$=new Set;if(i&&i.length>0)i.forEach(L=>{const T=m.findIndex(B=>(B==null?void 0:B.instanceId)===L);if(T!==-1&&m[T])$.add(L),R(T);else{const B=m.map((U,Y)=>U&&!$.has(U.instanceId)?Y:-1).filter(U=>U!==-1);if(B.length>0){const U=Math.floor(a()*B.length),Y=B[U],Me=m[Y];$.add(Me.instanceId),R(Y)}}});else{const L=m.map((B,U)=>B?U:-1).filter(B=>B!==-1);for(let B=L.length-1;B>0;B--){const U=Math.floor(a()*(B+1));[L[B],L[U]]=[L[U],L[B]]}L.slice(0,C).forEach(B=>{R(B)})}break}case"RANDOM_DAMAGE_BY_TURN":{const C=r.value||1,k=o.turnCount,I=r.targetType==="SELF"?e:c,m=o.players[I].board,R=$=>{var T;const L=m[$];if(!L)return!1;if(L.hasBarrier)return L.hasBarrier=!1,o.logs.push(`${L.name} `),!0;if(L.currentHealth-=C,o.logs.push(`${n.name}  ${L.name}  ${C} `),L.currentHealth<=0){L.currentHealth=0;const B=Object.keys(o.players).find(Y=>o.players[Y]===o.players[I])||I,U=(T=L.triggers)==null?void 0:T.find(Y=>Y.trigger==="LASTWORD");return U&&U.effects.forEach(Y=>{o.pendingEffects.push({sourceCard:L,effect:Y,sourcePlayerId:B})}),o.players[I].graveyard.push(L),m[$]=null,o.logs.push(`${L.name} `),!1}return!0};if(i&&i.length>0)for(let $=0;$<i.length;$++){const L=i[$],T=m.findIndex(B=>(B==null?void 0:B.instanceId)===L);if(T!==-1&&m[T])R(T);else{const B=m.map((U,Y)=>U?Y:-1).filter(U=>U!==-1);if(B.length>0){const U=Math.floor(a()*B.length);R(B[U])}}}else for(let $=0;$<k;$++){const L=m.map((B,U)=>B?U:-1).filter(B=>B!==-1);if(L.length===0)break;const T=Math.floor(a()*L.length);R(L[T])}break}case"SET_MAX_HP":{const C=r.value||20;if(r.targetType==="OPPONENT"){const k=o.players[c];k.maxHp=C,k.hp>C&&(k.hp=C)}break}case"SUMMON_CARD":{const C=r.targetCardId,k=Ns.find(I=>I.id===C);if(k){const I=o.players[e];if(I.board.filter(R=>R!==null).length<5){const R={...k,instanceId:`token_${o.rngSeed}_${Math.floor(a()*1e3)}`,canAttack:((y=k.passiveAbilities)==null?void 0:y.includes("STORM"))||((S=k.passiveAbilities)==null?void 0:S.includes("RUSH"))||!1,currentHealth:k.health||1,maxHealth:k.health||1,attack:k.attack||0,currentAttack:k.attack||0,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((P=k.passiveAbilities)==null?void 0:P.includes("BARRIER"))??!1,passiveAbilities:k.passiveAbilities?[...k.passiveAbilities]:[],hadStealth:((g=k.passiveAbilities)==null?void 0:g.includes("STEALTH"))??!1};(b=k.tags)!=null&&b.includes("Knuckler")&&!R.passiveAbilities.includes("STORM")&&I.board.some(L=>(L==null?void 0:L.name)==="")&&(R.passiveAbilities.push("STORM"),R.canAttack=!0,o.logs.push(`${k.name}   `)),I.board.push(R),o.logs.push(`${I.name}  ${k.name} `)}}break}case"SUMMON_CARD_RUSH":{const C=r.targetCardId,k=Ns.find(I=>I.id===C);if(k){const I=o.players[e];if(I.board.filter(R=>R!==null).length<5){const R={...k,instanceId:`token_${o.rngSeed}_${Math.floor(a()*1e3)}`,canAttack:!0,currentHealth:k.health||1,maxHealth:k.health||1,attack:k.attack||0,currentAttack:k.attack||0,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((x=k.passiveAbilities)==null?void 0:x.includes("BARRIER"))??!1,passiveAbilities:k.passiveAbilities?[...k.passiveAbilities]:[],hadStealth:((E=k.passiveAbilities)==null?void 0:E.includes("STEALTH"))??!1};let $=!1;(O=k.tags)!=null&&O.includes("Knuckler")&&!R.passiveAbilities.includes("STORM")&&I.board.some(T=>(T==null?void 0:T.name)==="")&&(R.passiveAbilities.push("STORM"),$=!0,o.logs.push(`${k.name}   `)),!$&&!R.passiveAbilities.includes("RUSH")&&R.passiveAbilities.push("RUSH"),I.board.push(R),o.logs.push(`${I.name}  ${k.name} ${$?"":""}`)}}break}case"SUMMON_CARD_BUFFED":{const C=r.targetCardId,k=Ns.find(R=>R.id===C),I=r.value||0,m=r.value2||0;if(k){const R=o.players[e];if(R.board.filter(L=>L!==null).length<5){const L=k.attack||0,T=k.health||1,B=L+I,U=T+m,Y={...k,instanceId:`token_${o.rngSeed}_${Math.floor(a()*1e3)}`,canAttack:!1,currentHealth:U,maxHealth:U,health:U,attack:B,currentAttack:B,baseAttack:L,baseHealth:T,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((Q=k.passiveAbilities)==null?void 0:Q.includes("BARRIER"))??!1,passiveAbilities:k.passiveAbilities?[...k.passiveAbilities]:[],hadStealth:((F=k.passiveAbilities)==null?void 0:F.includes("STEALTH"))??!1};(se=k.tags)!=null&&se.includes("Knuckler")&&!Y.passiveAbilities.includes("STORM")&&R.board.some(Je=>(Je==null?void 0:Je.name)==="")&&(Y.passiveAbilities.push("STORM"),Y.canAttack=!0,o.logs.push(`${k.name}   `)),((J=Y.passiveAbilities)!=null&&J.includes("RUSH")||(me=Y.passiveAbilities)!=null&&me.includes("STORM"))&&(Y.canAttack=!0),R.board.push(Y),o.logs.push(`${R.name}  ${k.name} +${I}/+${m}`),o.pendingEffects=[...o.pendingEffects||[],{sourceCard:Y,effect:{type:"VISUAL_BUFF_ONLY",value:I,value2:m},sourcePlayerId:e}]}}break}case"DESTROY_AND_STEAL":{if(r.targetType==="SELECT_FOLLOWER"&&s){const C=u(s);if(C){const{card:k,player:I,index:m}=C,R=Object.keys(o.players).find(T=>o.players[T]===I)||c,$=o.players[e];if($.board.filter(T=>T!==null).length<5){I.board[m]=null,o.logs.push(`${k.name}  ${n.name} `);const T={...k,instanceId:`stolen_${o.rngSeed}_${Math.floor(a()*1e3)}`,canAttack:!1,currentHealth:k.health||k.currentHealth,maxHealth:k.health||k.maxHealth,currentAttack:k.attack||k.currentAttack,attacksMade:0,turnPlayed:o.turnCount,hasEvolved:!1};$.board.push(T),o.logs.push(`${$.name}  ${T.name} `)}else p(k,R),I.graveyard.push(k),I.board[m]=null,o.logs.push(`${k.name}  ${n.name} `)}}break}case"DESTROY_AND_GENERATE":{if(r.targetType==="SELECT_FOLLOWER"&&s){const C=u(s);if(C){const{card:k,player:I,index:m}=C,R=Object.keys(o.players).find(T=>o.players[T]===I)||c;p(k,R),I.graveyard.push(k),I.board[m]=null,o.logs.push(`${k.name}  ${n.name} `);const $=o.players[e],L=Er(k.name);if(L){const T=Math.max(0,L.cost+(r.value||0)),B={...L,instanceId:`generated_${o.rngSeed}_${Math.floor(a()*1e3)}`,baseCost:T,cost:T,attackEffectType:L.attackEffectType};$.hand.push(B);const U=r.value||0;o.logs.push(`${$.name}  ${B.name} ${U>=0?"+":""}${U}`)}}}break}case"RETURN_TO_HAND":{const C=o.players[c].board;let k=-1;if(r.targetType==="SELECT_FOLLOWER"&&s?k=C.findIndex(I=>(I==null?void 0:I.instanceId)===s):(r.targetType==="RANDOM_FOLLOWER"||!s)&&C.length>0&&(k=Math.floor(a()*C.length)),k!==-1&&C[k]){const I=C[k];o.players[c].board[k]=null;const m=o.players[c],R=Er(I.id)||Er(I.name),{currentHealth:$,maxHealth:L,canAttack:T,attacksMade:B,hasEvolved:U,baseAttack:Y,baseHealth:Me,turnPlayed:Je,hasBarrier:de,attack:Ue,health:_e,...Le}=I,fe={...Le,attack:(R==null?void 0:R.attack)??Ue,health:(R==null?void 0:R.health)??_e};m.hand.length<9?(m.hand.push(fe),o.logs.push(`${I.name} `)):(m.graveyard.push(fe),o.logs.push(`${I.name} `))}break}case"RANDOM_BOUNCE":{const C=r.value||1,k=o.players[c].board;for(let I=0;I<C;I++){const m=k.map((tt,$e)=>tt?$e:-1).filter(tt=>tt!==-1);if(m.length===0)break;const R=m[Math.floor(a()*m.length)],$=k[R];k[R]=null;const L=o.players[c],T=Er($.id)||Er($.name),{currentHealth:B,maxHealth:U,canAttack:Y,attacksMade:Me,hasEvolved:Je,baseAttack:de,baseHealth:Ue,turnPlayed:_e,hasBarrier:Le,attack:fe,health:Z,...ke}=$,qe={...ke,attack:(T==null?void 0:T.attack)??fe,health:(T==null?void 0:T.health)??Z};L.hand.length<9?(L.hand.push(qe),o.logs.push(`${$.name} `)):(L.graveyard.push(qe),o.logs.push(`${$.name} `))}break}case"GRANT_PASSIVE":{const C=r.targetPassive;if(!C)break;if(r.targetType==="SELF"){const k=n;if(k.instanceId){const m=o.players[e].board.find(R=>(R==null?void 0:R.instanceId)===k.instanceId);m&&(C==="BARRIER"?(m.hasBarrier=!0,o.logs.push(`${m.name} `)):(m.passiveAbilities||(m.passiveAbilities=[]),m.passiveAbilities.includes(C)||(m.passiveAbilities.push(C),o.logs.push(`${m.name}  ${Pl(C)} `)),(C==="STORM"||C==="RUSH")&&(m.canAttack=!0)))}}else if((r.targetType==="SELECT_FOLLOWER"||r.targetType==="SELECT_ALLY_FOLLOWER")&&s){const k=u(s);if(k){const{card:I}=k;C==="BARRIER"?(I.hasBarrier=!0,o.logs.push(`${I.name} `)):(I.passiveAbilities||(I.passiveAbilities=[]),I.passiveAbilities.includes(C)||(I.passiveAbilities.push(C),o.logs.push(`${I.name}  ${Pl(C)} `)),(C==="STORM"||C==="RUSH")&&(I.canAttack=!0))}}else if(r.targetType==="ALL_FOLLOWERS"){const k=o.players[e];let I=0;console.log(`[GRANT_PASSIVE] ALL_FOLLOWERS: Player board has ${k.board.filter(m=>m).length} units, condition tag=${(A=r.conditions)==null?void 0:A.tag}`),k.board.forEach(m=>{var R,$,L;if(m){if(console.log(`[GRANT_PASSIVE] Checking: ${m.name}, tags=${m.tags}, passives=${m.passiveAbilities}`),(R=r.conditions)!=null&&R.tag&&!(($=m.tags)!=null&&$.includes(r.conditions.tag))){console.log(`[GRANT_PASSIVE] Skipped ${m.name}: no matching tag`);return}if((L=r.conditions)!=null&&L.nameIn&&!r.conditions.nameIn.includes(m.name)){console.log(`[GRANT_PASSIVE] Skipped ${m.name}: no matching nameIn`);return}C==="BARRIER"?(m.hasBarrier=!0,I++):(m.passiveAbilities||(m.passiveAbilities=[]),m.passiveAbilities.includes(C)||(m.passiveAbilities.push(C),I++,console.log(`[GRANT_PASSIVE] Granted ${C} to ${m.name}`),(C==="STORM"||C==="RUSH")&&(m.canAttack=!0)))}}),I>0&&o.logs.push(`${I} ${Pl(C)} `),console.log(`[GRANT_PASSIVE] Total granted: ${I}`)}else if(r.targetType==="ALL_OTHER_FOLLOWERS"){const k=o.players[e];let I=0;k.board.forEach(m=>{var R,$,L;if(m&&m.instanceId!==n.instanceId){if((R=r.conditions)!=null&&R.tag&&!(($=m.tags)!=null&&$.includes(r.conditions.tag))||(L=r.conditions)!=null&&L.nameIn&&!r.conditions.nameIn.includes(m.name))return;C==="BARRIER"?(m.hasBarrier=!0,I++):(m.passiveAbilities||(m.passiveAbilities=[]),m.passiveAbilities.includes(C)||(m.passiveAbilities.push(C),I++,(C==="STORM"||C==="RUSH")&&(m.canAttack=!0)))}}),I>0&&o.logs.push(`${I} ${Pl(C)} `)}break}case"BUFF_STATS":{const C=r.value||0,k=r.value2||0;if(r.targetType==="ALL_FOLLOWERS")o.players[e].board.forEach(m=>{var R,$,L;if(m){if((R=r.conditions)!=null&&R.tag&&!(($=m.tags)!=null&&$.includes(r.conditions.tag))||(L=r.conditions)!=null&&L.nameIn&&!r.conditions.nameIn.includes(m.name))return;m.baseAttack||(m.baseAttack=m.attack||0),m.baseHealth||(m.baseHealth=m.health||0),m.attack=(m.attack||0)+C,m.currentAttack=(m.currentAttack||0)+C,m.health=(m.health||0)+k,m.maxHealth=(m.maxHealth||0)+k,m.currentHealth=(m.currentHealth||0)+k,o.logs.push(`${m.name}  +${C}/+${k} `)}});else if(r.targetType==="ALL_OTHER_FOLLOWERS")o.players[e].board.forEach(m=>{var R,$,L;if(m&&m.instanceId!==n.instanceId){if((R=r.conditions)!=null&&R.tag&&!(($=m.tags)!=null&&$.includes(r.conditions.tag))||(L=r.conditions)!=null&&L.nameIn&&!r.conditions.nameIn.includes(m.name))return;m.baseAttack||(m.baseAttack=m.attack||0),m.baseHealth||(m.baseHealth=m.health||0),m.attack=(m.attack||0)+C,m.currentAttack=(m.currentAttack||0)+C,m.health=(m.health||0)+k,m.maxHealth=(m.maxHealth||0)+k,m.currentHealth=(m.currentHealth||0)+k,o.logs.push(`${m.name}  +${C}/+${k} `)}});else if((r.targetType==="SELECT_FOLLOWER"||r.targetType==="SELECT_ALLY_FOLLOWER"||r.targetType==="SELECT_OTHER_ALLY_FOLLOWER")&&s){const I=u(s);if(I){const{card:m}=I;m.baseAttack||(m.baseAttack=m.attack||0),m.baseHealth||(m.baseHealth=m.health||0),m.attack=(m.attack||0)+C,m.currentAttack=(m.currentAttack||0)+C,m.health=(m.health||0)+k,m.maxHealth=(m.maxHealth||0)+k,m.currentHealth=(m.currentHealth||0)+k,o.logs.push(`${m.name}  +${C}/+${k} `)}}else if(r.targetType==="RANDOM_FOLLOWER"){const I=o.players[c].board,m=I.map((R,$)=>R?$:-1).filter(R=>R!==-1);if(m.length>0){const R=m[Math.floor(a()*m.length)],$=I[R];$.baseAttack||($.baseAttack=$.attack||0),$.baseHealth||($.baseHealth=$.health||0),$.attack=($.attack||0)+C,$.currentAttack=($.currentAttack||0)+C,$.health=($.health||0)+k,$.maxHealth=($.maxHealth||0)+k,$.currentHealth=($.currentHealth||0)+k,$.currentAttack<0&&($.currentAttack=0),$.attack&&$.attack<0&&($.attack=0);const L=C>=0?`+${C}`:`${C}`,T=k>=0?`+${k}`:`${k}`;o.logs.push(`${$.name}  ${L}/${T} `)}else o.logs.push("")}break}}return o}const Hk=t=>{const e=n=>{const r=n.board.some(i=>i&&i.name.includes("")),s=n.hand.map(i=>{var c;const o=i.baseCost!==void 0?i.baseCost:i.cost;let a=o;return r&&((c=i.tags)!=null&&c.includes("Knuckler"))&&(a=Math.max(0,o-2)),i.cost!==a?{...i,cost:a,baseCost:o}:i});return{...n,hand:s}};return{...t,players:{p1:e(t.players.p1),p2:e(t.players.p2)}}},Wk=(t,e)=>{let n=Gk(t,e);return n=Hk(n),n.lastHash=jk(n),n},Gk=(t,e)=>{var s,i,o,a,c,u,p,f,d,y,S,P,g,b,x,E,O,Q,F,se,J,me,A,C,k;console.log(`[Reducer] Action: ${e.type}, isRemote: ${e.isRemote}`);let n={...t,players:{p1:{...t.players.p1,hand:[...t.players.p1.hand],deck:[...t.players.p1.deck],board:t.players.p1.board.map(I=>I?{...I,passiveAbilities:I.passiveAbilities?[...I.passiveAbilities]:[]}:null),graveyard:[...t.players.p1.graveyard]},p2:{...t.players.p2,hand:[...t.players.p2.hand],deck:[...t.players.p2.deck],board:t.players.p2.board.map(I=>I?{...I,passiveAbilities:I.passiveAbilities?[...I.passiveAbilities]:[]}:null),graveyard:[...t.players.p2.graveyard]}},logs:[...t.logs||[]]};const r=Yh(n.rngSeed||999);switch(n.rngSeed=Math.floor(r()*1e6),e.type){case"START_GAME":return t;case"END_TURN":{const I=t.activePlayerId,m=n.players[I];m.extraPpActive&&(m.id!==t.firstPlayerId&&(n.turnCount<=5?m.extraPpUsedEarly=!0:m.extraPpUsedLate=!0),m.extraPpActive=!1);const R=[...n.pendingEffects||[]];m.board.forEach(T=>{T&&T.triggers&&T.triggers.filter(B=>B.trigger==="END_OF_TURN").forEach(B=>{B.effects.forEach(U=>{R.push({sourceCard:T,effect:U,sourcePlayerId:I})})})});const $=ap(I),L=n.players[$];if(L.board.forEach((T,B)=>{T&&T.triggers&&T.triggers.filter(U=>U.trigger==="START_OF_TURN").forEach(U=>{U.effects.forEach(Y=>{Y.type==="DESTROY_SELF"?T&&(n.players[$].graveyard.push(T),n.players[$].board[B]=null,n.logs.push(`${T.name} `)):R.push({sourceCard:T,effect:Y,sourcePlayerId:$})})})}),n.players[$].board=n.players[$].board.filter(Boolean),L.maxPp=Math.min(10,L.maxPp+1),L.pp=L.maxPp,L.deck.length>0){const T=L.deck.pop();T&&(L.hand.length<9?L.hand.push(T):(L.graveyard.push(T),n.logs.push(`${L.name}${T.name}`)))}return L.board=L.board.filter(Boolean),L.board.forEach(T=>{T&&(T.canAttack=!0,T.attacksMade=0,T.turnPlayed=-1)}),L.canEvolveThisTurn=!0,n.activePlayerId=$,n.pendingEffects=R,$===t.firstPlayerId&&(n.turnCount+=1),n.logs.push(` ${n.turnCount} - ${L.name} `),n}case"CONCEDE":{const I=e.playerId,m=n.players[I];if(!m)return console.warn(`[Engine] CONCEDE: Unknown playerId: ${I}. Ignoring.`),t;if(t.phase==="GAME_OVER")return console.warn("[Engine] CONCEDE: Game already over. Ignoring."),t;const R=ap(I);return n.phase="GAME_OVER",n.winnerId=R,n.logs.push(`${m.name} `),console.log(`[Engine] CONCEDE: ${I} surrendered. Winner: ${R}`),n}case"RESOLVE_EFFECT":{if(!n.pendingEffects||n.pendingEffects.length===0)return n;const[I,...m]=n.pendingEffects;console.log(`[Engine] RESOLVE_EFFECT: Processing ${I.effect.type} from ${I.sourceCard.name}. Remaining: ${m.length}`);const R=((s=e.payload)==null?void 0:s.targetId)||I.targetId;let $=zk(n,I.sourcePlayerId,I.sourceCard,I.effect,R,I.targetIds);const L=($.pendingEffects||[]).filter(B=>{var U;return!((U=n.pendingEffects)!=null&&U.includes(B))}),T=[...m,...L];return console.log(`[Engine] RESOLVE_EFFECT done. Remaining: ${m.length}, NewlyAdded: ${L.length}, Final: ${T.length}`),T.length===0&&Object.values($.players).forEach(B=>{B.board=B.board.filter(Boolean)}),{...$,pendingEffects:T}}case"PLAY_CARD":{if(!e.isRemote&&n.activePlayerId!==e.playerId)return n;const{cardIndex:I,targetId:m,instanceId:R}=e.payload,$={...n.players.p1,hand:[...n.players.p1.hand],deck:[...n.players.p1.deck],board:[...n.players.p1.board],graveyard:[...n.players.p1.graveyard]},L={...n.players.p2,hand:[...n.players.p2.hand],deck:[...n.players.p2.deck],board:[...n.players.p2.board],graveyard:[...n.players.p2.graveyard]},T=e.playerId==="p1"?$:L;console.log(`[Engine] PLAY_CARD: playerId=${e.playerId}, cardIndex=${I}, instanceId=${R}, handLength=${T.hand.length}, isRemote=${e.isRemote}`),console.log("[Engine] PLAY_CARD: hand cards:",T.hand.map(fe=>`${fe.name}(${fe.instanceId})`));let B=I;if(R){const fe=T.hand.findIndex(Z=>Z.instanceId===R);if(fe>=0)B=fe,console.log(`[Engine] PLAY_CARD: Using instanceId ${R}, found at index ${fe} (was ${I})`);else return console.log(`[Engine] PLAY_CARD: instanceId ${R} not found in hand!`),n}if(B<0||B>=T.hand.length)return console.log("[Engine] PLAY_CARD: Invalid cardIndex! Returning unchanged state."),n;const U=T.hand[B];let Y="";if(m){const Z=(e.playerId==="p1"?L:$).board.find(ke=>(ke==null?void 0:ke.instanceId)===m);Z&&(Y=` (: ${Z.name})`)}if(n.logs.push(`${T.name}  ${U.name} ${Y}`),T.pp<U.cost)return n;const Me=T.board.filter(fe=>fe!==null).length;if(U.type==="FOLLOWER"&&Me>=5)return n;const Je=T.pp;T.pp-=U.cost,T.extraPpActive&&Je-1<U.cost&&(T.id!==t.firstPlayerId&&(n.turnCount<=5?T.extraPpUsedEarly=!0:T.extraPpUsedLate=!0),T.extraPpActive=!1,T.pp<0&&(T.pp=0),console.log("[Engine] PLAY_CARD: Extra PP consumed, marked as used"),n.logs.push(`${T.name} PP`)),T.hand.splice(B,1);let de=U;if(U.type==="FOLLOWER"){const fe={...U,instanceId:e.payload.instanceId||`inst_${n.rngSeed}_${Math.floor(r()*1e3)}`,currentAttack:U.attack||0,currentHealth:U.health||0,maxHealth:U.health||0,canAttack:!1,hasEvolved:!1,attacksMade:0,turnPlayed:n.turnCount,hasBarrier:((i=U.passiveAbilities)==null?void 0:i.includes("BARRIER"))??!1,passiveAbilities:U.passiveAbilities?[...U.passiveAbilities]:[],hadStealth:((o=U.passiveAbilities)==null?void 0:o.includes("STEALTH"))??!1};((a=U.passiveAbilities)!=null&&a.includes("STORM")||(c=U.passiveAbilities)!=null&&c.includes("RUSH"))&&(fe.canAttack=!0),(u=fe.tags)!=null&&u.includes("Knuckler")&&!fe.passiveAbilities.includes("STORM")&&T.board.some(ke=>(ke==null?void 0:ke.name)==="")&&(fe.passiveAbilities.push("STORM"),fe.canAttack=!0,n.logs.push(`${fe.name}   `)),T.board.push(fe),de=fe,fe.name===""&&T.board.forEach(Z=>{var ke,qe;Z&&((ke=Z.tags)!=null&&ke.includes("Knuckler"))&&Z.instanceId!==fe.instanceId&&((qe=Z.passiveAbilities)!=null&&qe.includes("STORM")||(Z.passiveAbilities||(Z.passiveAbilities=[]),Z.passiveAbilities.push("STORM"),Z.canAttack=!0,n.logs.push(`${Z.name}   `)))})}else T.graveyard.push({...U,instanceId:`spell_${n.rngSeed}_${Math.floor(r()*1e3)}`});const Ue=[];(p=U.triggers)==null||p.filter(fe=>fe.trigger==="FANFARE").forEach(fe=>Ue.push(...fe.effects)),(f=U.triggerAbilities)!=null&&f.FANFARE&&Ue.push(U.triggerAbilities.FANFARE);let _e=[...n.pendingEffects||[]];return Ue.forEach(fe=>{if(fe.conditions&&fe.conditions.minTurn&&n.turnCount<fe.conditions.minTurn)return;let Z;if(fe.targetType==="OPPONENT"||fe.targetType==="SELF"||fe.targetType==="ALL_FOLLOWERS"||fe.targetType==="ALL_OTHER_FOLLOWERS"||fe.type==="RANDOM_DESTROY"||fe.type==="RANDOM_SET_HP"||fe.type==="AOE_DAMAGE"||fe.type==="RANDOM_DAMAGE"||fe.type==="RANDOM_DAMAGE_BY_TURN"){const qe=e.playerId==="p1"?"p2":"p1",tt=e.playerId;if(fe.type==="RANDOM_DAMAGE_BY_TURN"){const $e=fe.targetType==="SELF"?tt:qe,nt=n.players[$e].board,zn=n.turnCount;Z=[];for(let Ye=0;Ye<zn;Ye++){const mt=nt.map((it,Bt)=>it?Bt:-1).filter(it=>it!==-1);if(mt.length===0)break;const Ne=Math.floor(r()*mt.length);Z.push(nt[mt[Ne]].instanceId)}}else if(fe.type==="RANDOM_DESTROY"||fe.type==="RANDOM_SET_HP"||fe.type==="RANDOM_DAMAGE"){const $e=fe.targetType==="SELF"?tt:qe,nt=n.players[$e].board,zn=fe.type==="RANDOM_DAMAGE"?fe.value2||1:fe.value||1,Ye=nt.map((Ne,it)=>Ne?it:-1).filter(Ne=>Ne!==-1);for(let Ne=Ye.length-1;Ne>0;Ne--){const it=Math.floor(r()*(Ne+1));[Ye[Ne],Ye[it]]=[Ye[it],Ye[Ne]]}Z=Ye.slice(0,zn).map(Ne=>nt[Ne].instanceId)}else if(fe.targetType==="ALL_FOLLOWERS"||fe.type==="AOE_DAMAGE"){const $e=fe.type==="GRANT_PASSIVE"||fe.type==="BUFF_STATS",nt=$e?tt:qe;Z=n.players[nt].board.filter(Ye=>Ye!==null).map(Ye=>Ye.instanceId),console.log(`[Engine] Pre-calculated ALL_FOLLOWERS targets (${$e?"ally":"enemy"}): ${Z.length} units`)}else fe.targetType==="ALL_OTHER_FOLLOWERS"&&(Z=n.players[tt].board.filter(nt=>nt!==null&&nt.instanceId!==de.instanceId).map(nt=>nt.instanceId))}const ke=fe.targetType==="SELECT_FOLLOWER"||fe.targetType==="SELECT_ALLY_FOLLOWER"||fe.targetType==="SELECT_OTHER_ALLY_FOLLOWER";_e.push({sourceCard:de,effect:fe,sourcePlayerId:e.playerId,targetId:ke?m:void 0,targetIds:Z})}),console.log(`[Engine] PLAY_CARD: Queued ${Ue.length} effects. Total pending: ${_e.length}`),{...n,players:{p1:$,p2:L},pendingEffects:_e}}case"EVOLVE":{const{followerIndex:I,targetId:m,useSep:R}=e.payload,$={...n.players.p1,hand:[...n.players.p1.hand],deck:[...n.players.p1.deck],board:n.players.p1.board.map(de=>de?{...de,passiveAbilities:de.passiveAbilities?[...de.passiveAbilities]:void 0}:null),graveyard:[...n.players.p1.graveyard]},L={...n.players.p2,hand:[...n.players.p2.hand],deck:[...n.players.p2.deck],board:n.players.p2.board.map(de=>de?{...de,passiveAbilities:de.passiveAbilities?[...de.passiveAbilities]:void 0}:null),graveyard:[...n.players.p2.graveyard]},T=e.playerId==="p1"?$:L,B=T.board[I];if(!B||B.hasEvolved)return n;const U=e.isRemote;if(console.log(`[Engine] EVOLVE Logic: name=${B.name}, useSep=${R}, isRemote=${U}, turn=${t.turnCount}`),n.logs.push(`${T.name}  ${B.name} ${R?"":""}`),R){if(!U){if(t.turnCount<6)return console.log(`[Engine] Cannot Super Evolve: Turn ${t.turnCount} < 6`),n;if(T.sep<=0)return console.log("[Engine] Cannot Super Evolve: No SEP"),n;if(!T.canEvolveThisTurn)return console.log("[Engine] Cannot Super Evolve: Already evolved this turn"),n}T.sep=Math.max(0,T.sep-1),T.canEvolveThisTurn=!1,B.hasEvolved=!0,B.currentAttack+=3,B.currentHealth+=3,B.maxHealth+=3,B.canAttack=!0;const de=[...B.passiveAbilities||[]];de.includes("IMMUNE_TO_DAMAGE_MY_TURN")||de.push("IMMUNE_TO_DAMAGE_MY_TURN"),!de.includes("STORM")&&!de.includes("RUSH")&&de.push("RUSH"),B.passiveAbilities=de,console.log(`[Engine] Super Evolved ${B.name}! SEP remaining: ${T.sep}`)}else{if(!U){const _e=e.playerId===t.firstPlayerId?5:4;if(t.turnCount<_e)return console.log(`[Engine] Cannot Evolve: Turn ${t.turnCount} < ${_e}`),n;if(T.evolutionsUsed>=2)return console.log("[Engine] Cannot Evolve: Limit reached"),n;if(!T.canEvolveThisTurn)return console.log("[Engine] Cannot Evolve: Already evolved this turn"),n}T.evolutionsUsed+=1,T.canEvolveThisTurn=!1,B.hasEvolved=!0,B.currentAttack+=2,B.currentHealth+=2,B.maxHealth+=2,B.canAttack=!0;const de=[...B.passiveAbilities||[]];!de.includes("STORM")&&!de.includes("RUSH")&&de.push("RUSH"),B.passiveAbilities=de}const Y=[];(d=B.triggers)==null||d.filter(de=>de.trigger==="EVOLVE").forEach(de=>Y.push(...de.effects)),(y=B.triggerAbilities)!=null&&y.EVOLVE&&Y.push(B.triggerAbilities.EVOLVE),R&&((S=B.triggers)==null||S.filter(de=>de.trigger==="SUPER_EVOLVE").forEach(de=>Y.push(...de.effects)));let Me=[...n.pendingEffects||[]];return Y.forEach(de=>{if(de.conditions&&de.conditions.minTurn&&n.turnCount<de.conditions.minTurn)return;let Ue;const _e=e.playerId==="p1"?"p2":"p1",Le=e.playerId;if(de.type==="RANDOM_DESTROY"||de.type==="RANDOM_SET_HP"||de.type==="RANDOM_DAMAGE"){const fe=de.targetType==="SELF"?Le:_e,Z=n.players[fe].board,ke=de.type==="RANDOM_DAMAGE"?de.value2||1:de.value||1,qe=Z.map(($e,nt)=>$e?nt:-1).filter($e=>$e!==-1);for(let $e=qe.length-1;$e>0;$e--){const nt=Math.floor(r()*($e+1));[qe[$e],qe[nt]]=[qe[nt],qe[$e]]}Ue=qe.slice(0,ke).map($e=>Z[$e].instanceId)}else de.targetType==="ALL_FOLLOWERS"||de.type==="AOE_DAMAGE"?(Ue=n.players[_e].board.filter(Z=>Z!==null).map(Z=>Z.instanceId),console.log(`[Engine EVOLVE] Pre-calculated ALL_FOLLOWERS targets: ${Ue.length} units`)):de.targetType==="ALL_OTHER_FOLLOWERS"&&(Ue=n.players[Le].board.filter(Z=>Z!==null&&Z.instanceId!==B.instanceId).map(Z=>Z.instanceId));Me.push({sourceCard:B,effect:de,sourcePlayerId:e.playerId,targetId:m,targetIds:Ue})}),console.log(`[Engine] EVOLVE: Queued ${Y.length} effects. Total pending: ${Me.length}`),{...n,players:{p1:$,p2:L},pendingEffects:Me}}case"ATTACK":{console.log(`[Engine] ATTACK received. Incoming state P1 HP: ${t.players.p1.hp}, P2 HP: ${t.players.p2.hp}`);const{attackerIndex:I,targetIndex:m,targetIsLeader:R}=e.payload,$={...n.players.p1,board:n.players.p1.board.map(Z=>Z?{...Z,passiveAbilities:Z.passiveAbilities?[...Z.passiveAbilities]:void 0}:null),graveyard:[...n.players.p1.graveyard]},L={...n.players.p2,board:n.players.p2.board.map(Z=>Z?{...Z,passiveAbilities:Z.passiveAbilities?[...Z.passiveAbilities]:void 0}:null),graveyard:[...n.players.p2.graveyard]},T=e.playerId==="p1",B=T?$:L,U=T?L:$,Y=B.board[I];if(!Y||!Y.canAttack)return n;const Me=U.board.filter(Z=>{var ke,qe;return Z&&((ke=Z.passiveAbilities)==null?void 0:ke.includes("WARD"))&&!((qe=Z.passiveAbilities)!=null&&qe.includes("STEALTH"))}),Je=((P=Y.passiveAbilities)==null?void 0:P.includes("STEALTH"))||Y.hadStealth;if(Me.length>0&&!Je){if(R)return console.log("[Engine] Attack blocked: Must attack Ward unit first."),n;const Z=U.board[m];if(Z&&!((g=Z.passiveAbilities)!=null&&g.includes("WARD")))return console.log("[Engine] Attack blocked: Must attack Ward unit first."),n}if(R===!1){const Z=U.board[m];if(Z&&((b=Z.passiveAbilities)!=null&&b.includes("STEALTH")))return console.log("[Engine] ATTACK blocked: Target has STEALTH"),n}const de=(x=Y.passiveAbilities)==null?void 0:x.includes("RUSH"),Ue=(E=Y.passiveAbilities)==null?void 0:E.includes("STORM");if(de&&!Ue&&R&&Y.turnPlayed===n.turnCount)return console.log("[Engine] ATTACK blocked: RUSH unit cannot attack leader on the turn it was played"),n;(O=Y.passiveAbilities)!=null&&O.includes("STEALTH")&&(Y.passiveAbilities=Y.passiveAbilities.filter(Z=>Z!=="STEALTH"),n.logs.push(`${Y.name} `)),Y.canAttack=!1,Y.attacksMade=(Y.attacksMade||0)+1,(Q=Y.passiveAbilities)!=null&&Q.includes("DOUBLE_ATTACK")&&Y.attacksMade<2&&(Y.canAttack=!0);const _e=Y.currentAttack;console.log(`[Engine] Attack: ${Y.name} (${_e}) -> Target (Leader? ${R}). DefHP before: ${U.hp}`);const Le=(Z,ke)=>{var tt;const qe=(tt=Z.triggers)==null?void 0:tt.find($e=>$e.trigger==="LAST_WORD");if(qe){const $e=qe.effects.map(nt=>({sourceCard:Z,effect:nt,sourcePlayerId:ke}));n.pendingEffects=[...n.pendingEffects||[],...$e],n.logs.push(`${Z.name} `),console.log(`[Engine] Last Word triggered for ${Z.name}. pendingEffects count: ${n.pendingEffects.length}`)}};if(R){const Z="";if(n.logs.push(`${Y.name}  ${Z} `),U.leaderDamageShield)U.leaderDamageShield=!1,n.logs.push(`${Y.name}  ${Z}  ${_e} `);else{const ke=U.board.some(tt=>{var $e;return($e=tt==null?void 0:tt.passiveAbilities)==null?void 0:$e.includes("LEADER_DAMAGE_CAP")}),qe=ke?Math.min(_e,1):_e;U.hp-=qe,ke&&_e>1?n.logs.push(`${Y.name}  ${Z}  ${_e} 1`):n.logs.push(`${Y.name}  ${Z}  ${qe} `),U.hp<=0&&(n.winnerId=e.playerId)}}else{const Z=U.board[m];if(!Z)return console.log(`[Engine] Attack target at index ${m} no longer exists. Skipping.`),n;n.logs.push(`${Y.name}  ${Z.name} `);let ke=_e;(F=Z.passiveAbilities)!=null&&F.includes("IMMUNE_TO_FOLLOWER_DAMAGE")?(ke=0,n.logs.push(`${Z.name} `)):Z.hasBarrier&&ke>0?(ke=0,Z.hasBarrier=!1,n.logs.push(`${Z.name} `)):n.logs.push(`${Y.name}  ${Z.name}  ${ke} `),Z.currentHealth-=ke;const qe=T?"p2":"p1",tt=((se=Z.passiveAbilities)==null?void 0:se.includes("IMMUNE_TO_DAMAGE_MY_TURN"))&&n.activePlayerId===qe;(J=Y.passiveAbilities)!=null&&J.includes("BANE")&&Z.currentHealth>0&&(tt?n.logs.push(`${Z.name} `):(Z.currentHealth=0,Z.killedByBane=!0,n.logs.push(`${Y.name}  ${Z.name} `)));let $e=Z.currentAttack;(me=Y.passiveAbilities)!=null&&me.includes("IMMUNE_TO_DAMAGE_MY_TURN")&&($e=0,n.logs.push(`${Y.name} `)),Y.hasBarrier&&$e>0?($e=0,Y.hasBarrier=!1,n.logs.push(`${Y.name} `)):$e>0&&n.logs.push(`${Z.name}  ${Y.name}  ${$e} `),Y.currentHealth-=$e;const nt=T?"p1":"p2";Y.currentHealth<=0&&((A=Y.passiveAbilities)!=null&&A.includes("GUTS_MY_TURN"))&&n.activePlayerId===nt&&(Y.currentHealth=1,n.logs.push(`${Y.name} 1`));const zn=((C=Y.passiveAbilities)==null?void 0:C.includes("IMMUNE_TO_DAMAGE_MY_TURN"))&&n.activePlayerId===nt;(k=Z.passiveAbilities)!=null&&k.includes("BANE")&&Y.currentHealth>0&&(zn?n.logs.push(`${Y.name} `):(Y.currentHealth=0,Y.killedByBane=!0,n.logs.push(`${Z.name}  ${Y.name} `)));const Ye=Z.currentHealth<=0,mt=Y.currentHealth<=0;Ye&&(Z.currentHealth=Math.min(0,Z.currentHealth),U.graveyard.push(Z),U.board[m]=null,n.logs.push(`${Z.name} `)),mt&&(Y.currentHealth=Math.min(0,Y.currentHealth),B.graveyard.push(Y),B.board[I]=null,n.logs.push(`${Y.name} `)),Ye&&Le(Z,T?"p2":"p1"),mt&&Le(Y,T?"p1":"p2")}console.log(`[Engine] Committing state. P1 HP: ${$.hp}, P2 HP: ${L.hp}`);const fe={...n,players:{p1:$,p2:L}};return console.log(`[Engine] After commit. finalState.players.p1.hp: ${fe.players.p1.hp}, finalState.players.p2.hp: ${fe.players.p2.hp}`),fe}case"REINIT_GAME":{const{p1Class:I,p2Class:m}=e.payload;return console.log(`[Engine] REINIT_GAME: p1=${I}, p2=${m}`),ql("Player 1",I,"Player 2",m)}case"SYNC_STATE":return console.log("[Engine] SYNC_STATE received"),e.payload;case"UPDATE_PLAYER_NAME":{const{playerId:I,name:m}=e.payload;return console.log("[Engine] UPDATE_PLAYER_NAME:",I,m),t.players[I]?{...t,players:{...t.players,[I]:{...t.players[I],name:m}}}:(console.warn("[Engine] UPDATE_PLAYER_NAME: Unknown playerId:",I),t)}case"TOGGLE_EXTRA_PP":{const I=e.playerId,m=n.players[I];if(!(I!==t.firstPlayerId))return console.log("[Engine] TOGGLE_EXTRA_PP: Only second player can use Extra PP"),t;if(t.activePlayerId!==I)return console.log("[Engine] TOGGLE_EXTRA_PP: Can only toggle on your turn"),t;if(m.extraPpActive)return m.extraPpActive=!1,m.pp=Math.max(0,m.pp-1),console.log("[Engine] TOGGLE_EXTRA_PP: Deactivated, PP now",m.pp),n;if(n.turnCount<=5){if(m.extraPpUsedEarly)return console.log("[Engine] TOGGLE_EXTRA_PP: Already used in early turns"),t}else if(m.extraPpUsedLate)return console.log("[Engine] TOGGLE_EXTRA_PP: Already used in late turns"),t;return m.extraPpActive=!0,m.pp+=1,console.log("[Engine] TOGGLE_EXTRA_PP: Activated, PP now",m.pp),n}default:return t}},Vk=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},fi=({card:t,onClick:e,style:n,isSelected:r,isPlayable:s,variant:i="normal",turnCount:o,isOnBoard:a,isSpecialSummoning:c,className:u,suppressPassives:p,isMyTurn:f,scale:d=1})=>{const y="currentAttack"in t?t.currentAttack:t.attack,S="currentHealth"in t?t.currentHealth:t.health,P="maxHealth"in t?t.maxHealth:t.health,g="canAttack"in t?t.canAttack:!1,b="turnPlayed"in t?t.turnPlayed:void 0,[x,E]=M.useState(!1);M.useEffect(()=>{if(c&&a){E(!0);const Me=setTimeout(()=>E(!1),800);return()=>clearTimeout(Me)}},[c,a]);const O="baseAttack"in t?t.baseAttack:void 0,Q="baseHealth"in t?t.baseHealth:void 0,F=O!==void 0&&y>O,se=Q!==void 0&&(S>Q||P>Q),J="hasEvolved"in t?t.hasEvolved:!1,me="evolvedImageUrl"in t?t.evolvedImageUrl:void 0,A=J&&me?me:t.imageUrl,C=A?Vk(A):void 0;let k=n==null?void 0:n.boxShadow,I;const m=t.passiveAbilities||t.abilities||[],R=m.includes("WARD"),$=m.includes("AURA"),L=m.includes("STEALTH"),T=t.hasBarrier===!0||m.includes("BARRIER")&&t.hasBarrier!==!1;if(r)k="0 0 15px rgba(255, 255, 255, 0.8)";else if(s)k="0 0 10px #48bb78",I="2px solid #48bb78";else if(g&&f){const Me=m.includes("STORM"),Je=m.includes("RUSH"),de=o!==void 0&&b!==void 0&&b===o;let Ue=!1;Me||(de?Ue=!0:(o===void 0||b===void 0)&&(Ue=Je)),Ue?k="0 0 10px #f6e05e":k="0 0 10px #48bb78"}const B=S<P;if(i==="art-only")return l.jsx("div",{className:"card art-only",style:{width:140,height:200,...n,borderRadius:8,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",background:"#2d3748",position:"relative",boxShadow:"0 4px 6px rgba(0,0,0,0.3)"},children:C?l.jsx("img",{src:C,alt:t.name,draggable:!1,style:{width:"100%",height:"100%",objectFit:"cover"}}):l.jsx("div",{style:{fontSize:"1.5rem",opacity:.5,color:"white",fontWeight:"bold"},children:t.type})});if(i==="mobile-hand"){const Je=t.type==="SPELL"?16:6,de=28*d,Ue=.85*d;return l.jsxs("div",{className:`card mobile-hand ${u||""}`,style:{width:80,height:115,...n,position:"relative",cursor:e?"pointer":"default",transform:r?"translateY(-8px)":n==null?void 0:n.transform,boxShadow:k||(n==null?void 0:n.boxShadow),border:I||(s?"2px solid #48bb78":void 0),transition:"transform 0.2s, box-shadow 0.2s",background:"#1a202c",overflow:"hidden",borderRadius:`${Je}px ${Je}px 6px 6px`,backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},onClick:e,children:[l.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"hidden",borderRadius:`${Je}px ${Je}px 6px 6px`},children:C?l.jsx("img",{src:C,alt:t.name,draggable:!1,style:{width:"100%",height:"100%",objectFit:"cover"}}):l.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"#4a5568",color:"#a0aec0",fontSize:"0.6rem"},children:t.type})}),l.jsxs("div",{style:{position:"absolute",top:3,left:4,display:"flex",flexDirection:"column",gap:2,zIndex:10},children:[l.jsx("div",{style:{width:de,height:de,borderRadius:"50%",background:"#48bb78",border:"1px solid rgba(255,255,255,0.8)",color:"white",fontSize:`${Ue}rem`,fontWeight:900,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.6)"},children:t.cost}),t.type==="FOLLOWER"&&l.jsxs("div",{style:{width:de,height:de,display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[l.jsx("svg",{width:de,height:de,viewBox:"0 0 24 24",fill:"none",style:{position:"absolute",filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.8))"},children:l.jsx("polygon",{points:"12,2 22,22 2,22",fill:"#4299e1",stroke:"rgba(255,255,255,0.8)",strokeWidth:"1",strokeLinejoin:"round"})}),l.jsx("span",{style:{zIndex:1,color:F?"#faf089":"white",fontWeight:"bold",fontSize:`${Ue}rem`,textShadow:"0 1px 2px black"},children:y})]}),t.type==="FOLLOWER"&&l.jsxs("div",{style:{width:de,height:de,display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[l.jsx("svg",{width:de,height:de,viewBox:"0 0 24 24",style:{position:"absolute",filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.8))"},children:l.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z",fill:"#c53030",stroke:"rgba(255,255,255,0.8)",strokeWidth:"1"})}),l.jsx("span",{style:{zIndex:1,color:se?"#faf089":B?"#fc8181":"white",fontWeight:"bold",fontSize:`${Ue}rem`,textShadow:"0 1px 2px black"},children:S})]})]})]})}const U=t.type==="SPELL"&&!a,Y=U?20:8;return l.jsxs("div",{className:`card card-container ${g?"ready":""} ${a?"on-board":""} ${u||""}`,style:{width:140,height:200,...n,position:"relative",cursor:e?"pointer":"default",transform:r?"translateY(-10px)":n==null?void 0:n.transform,boxShadow:k||(g?"0 0 10px #f6e05e":n==null?void 0:n.boxShadow),border:I||(s?"2px solid #48bb78":void 0),transition:"transform 0.2s, box-shadow 0.2s",display:"flex",flexDirection:"column",background:"#1a202c",overflow:"visible",animation:x?"cardSummonAppear 0.8s cubic-bezier(0.22, 1, 0.36, 1) forwards":n==null?void 0:n.animation,backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",borderRadius:U?`${Y}px ${Y}px 8px 8px`:"8px"},onClick:e,children:[!a&&l.jsx("div",{style:{height:20,background:"rgba(0,0,0,0.8)",color:"#e2e8f0",fontSize:t.name.length>10?"0.6rem":"0.7rem",fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid rgba(255,255,255,0.2)",zIndex:2,transform:t.name.length>15?"scaleX(0.9)":"none",borderRadius:U?`${Y}px ${Y}px 0 0`:"8px 8px 0 0"},children:t.name}),l.jsxs("div",{style:{flex:1,position:"relative",width:"100%",background:"#2d3748",borderRadius:a?"8px":"0 0 8px 8px",minHeight:0},children:[l.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"hidden",borderRadius:a?"8px":"0 0 8px 8px",zIndex:1},children:[C?l.jsx("img",{src:C,alt:t.name,draggable:!1,style:{width:"100%",height:"100%",objectFit:"cover",display:"block"}}):l.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"#4a5568",color:"#a0aec0",fontSize:"0.8rem"},children:t.type}),l.jsx("div",{style:{position:"absolute",bottom:0,left:0,width:"100%",height:40,background:"linear-gradient(to top, rgba(0,0,0,0.8), transparent)",pointerEvents:"none",zIndex:3}})]}),!a&&l.jsx("div",{style:{position:"absolute",top:2*d,left:2*d,width:24*d,height:24*d,borderRadius:"50%",background:"#48bb78",border:`${Math.max(1,2*d)}px solid #fff`,color:"white",fontSize:`${.9*d}rem`,fontWeight:900,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 2px 4px rgba(0,0,0,0.5), inset 0 2px 5px rgba(255,255,255,0.3)",zIndex:10},children:t.cost}),t.type==="FOLLOWER"&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{style:{position:"absolute",bottom:a?2*d:40*d,left:2*d,width:32*d,height:32*d,zIndex:10,display:"flex",alignItems:"center",justifyContent:"center"},children:[l.jsxs("svg",{width:40*d,height:40*d,viewBox:"0 0 24 24",fill:"none",style:{position:"absolute",filter:"drop-shadow(0 2px 2px rgba(0,0,0,0.8))"},children:[l.jsx("defs",{children:l.jsxs("linearGradient",{id:"blueGrad",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[l.jsx("stop",{offset:"0%",stopColor:"#63b3ed"}),l.jsx("stop",{offset:"100%",stopColor:"#4299e1"})]})}),l.jsx("polygon",{points:"12,2 22,22 2,22",fill:"url(#blueGrad)",stroke:"white",strokeWidth:"1",strokeLinejoin:"round"})]}),l.jsx("span",{style:{zIndex:11,color:F?"#faf089":"white",fontWeight:"bold",fontSize:`${1.2*d}rem`,textShadow:"0 2px 2px black"},children:y})]}),l.jsxs("div",{style:{position:"absolute",bottom:2*d,right:a?2*d:"auto",left:a?"auto":2*d,width:32*d,height:32*d,zIndex:10,display:"flex",alignItems:"center",justifyContent:"center"},children:[l.jsxs("svg",{width:36*d,height:36*d,viewBox:"0 0 24 24",style:{position:"absolute",filter:"drop-shadow(0 2px 2px rgba(0,0,0,0.8))"},children:[l.jsx("defs",{children:l.jsxs("linearGradient",{id:"redGrad",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[l.jsx("stop",{offset:"0%",stopColor:"#f56565"}),l.jsx("stop",{offset:"100%",stopColor:"#c53030"})]})}),l.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z",fill:"url(#redGrad)",stroke:"white",strokeWidth:"1.5"})]}),l.jsx("span",{style:{zIndex:11,color:se?"#faf089":B?"#fc8181":"white",fontWeight:"bold",fontSize:`${1.2*d}rem`,textShadow:"0 2px 2px black"},children:S})]})]}),a&&l.jsx("div",{style:{position:"absolute",top:-6*d,left:-6*d,right:-6*d,bottom:-6*d,zIndex:50,pointerEvents:"none",opacity:R&&!p?1:0,transition:"opacity 0.2s ease-in-out"},children:l.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,animation:"wardPulseLoop 2.5s infinite ease-in-out"},children:l.jsxs("svg",{viewBox:"0 0 100 120",preserveAspectRatio:"none",style:{width:"100%",height:"100%"},children:[l.jsx("defs",{children:l.jsxs("filter",{id:"wardGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[l.jsx("feGaussianBlur",{stdDeviation:"2",result:"blur"}),l.jsxs("feMerge",{children:[l.jsx("feMergeNode",{in:"blur"}),l.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),l.jsx("path",{d:"M50 2 L96 20 V60 C96 90 50 116 50 116 C50 116 4 90 4 60 V20 Z",fill:"rgba(255, 255, 255, 0.12)",stroke:"#ECC94B",strokeWidth:"3",filter:"url(#wardGlow)"})]})})}),a&&l.jsxs("div",{style:{position:"absolute",top:-5*d,left:-5*d,right:-5*d,bottom:-5*d,zIndex:21,pointerEvents:"none",opacity:T&&!x&&!p?1:0,transition:"opacity 0.2s ease-in-out"},children:[l.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,borderRadius:"50%",background:"radial-gradient(ellipse at center, rgba(99, 179, 237, 0.12) 0%, transparent 60%)",animation:"barrierGlowLoop 3s infinite ease-in-out"}}),l.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,borderRadius:"50%",border:`${Math.max(1.5,2*d)}px solid rgba(99, 179, 237, 0.9)`,boxShadow:"0 0 6px rgba(66, 153, 225, 0.5), inset 0 0 8px rgba(99, 179, 237, 0.15)",animation:"barrierPulseLoop 3s infinite ease-in-out"}})]}),a&&l.jsx("div",{style:{position:"absolute",top:-6*d,left:-6*d,right:-6*d,bottom:-6*d,zIndex:22,pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center",opacity:$&&!x&&!p?1:0,transition:"opacity 0.2s ease-in-out"},children:l.jsx("div",{style:{width:"100%",height:"100%",position:"relative",animation:"auraPulseLoop 3s infinite ease-in-out"},children:l.jsxs("svg",{viewBox:"0 0 100 100",style:{width:"100%",height:"100%"},children:[l.jsx("defs",{children:l.jsxs("filter",{id:"auraGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[l.jsx("feGaussianBlur",{stdDeviation:"1.5",result:"blur"}),l.jsxs("feMerge",{children:[l.jsx("feMergeNode",{in:"blur"}),l.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),l.jsx("path",{d:"M40 5 L60 5 L60 30 L95 30 L95 45 L60 45 L60 95 L40 95 L40 45 L5 45 L5 30 L40 30 Z",fill:"rgba(255, 204, 0, 0.2)",stroke:"#f6ad55",strokeWidth:"2.5",filter:"url(#auraGlow)"})]})})}),a&&l.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:13,pointerEvents:"none",overflow:"hidden",borderRadius:"0 0 8px 8px",opacity:L&&!x&&!p?1:0,transition:"opacity 0.2s ease-in-out"},children:[l.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:"120%",height:"120%",transform:"translate(-50%, -50%)",background:"radial-gradient(circle, rgba(0, 0, 0, 0.9) 0%, rgba(0, 0, 0, 0.6) 30%, rgba(0, 0, 0, 0.2) 60%, transparent 80%)",filter:"blur(10px)",animation:"stealthInkMove 3s infinite ease-in-out",mixBlendMode:"multiply"}}),l.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:"100%",height:"100%",transform:"translate(-50%, -50%)",background:"radial-gradient(circle, rgba(20, 20, 30, 0.85) 0%, rgba(10, 10, 20, 0.4) 40%, transparent 70%)",filter:"blur(8px)",animation:"stealthInkPulse 1.5s infinite ease-in-out",mixBlendMode:"multiply"}}),l.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:"70%",height:"70%",transform:"translate(-50%, -50%)",background:"radial-gradient(circle, rgba(255, 255, 255, 0.4) 0%, rgba(200, 200, 200, 0.25) 30%, transparent 60%)",filter:"blur(8px)",animation:"stealthMistMove 4s infinite ease-in-out",mixBlendMode:"screen"}}),l.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,boxShadow:"inset 0 0 30px rgba(0, 0, 0, 0.85), 0 0 20px rgba(0, 0, 0, 0.6)",animation:"stealthPulse 1.5s infinite ease-in-out"}})]})]}),x&&l.jsx("div",{style:{position:"absolute",inset:0,borderRadius:8,background:"radial-gradient(circle, rgba(255,255,255,0.8) 0%, transparent 70%)",mixBlendMode:"overlay",animation:"cardSummonFlash 0.8s ease-out forwards",pointerEvents:"none",zIndex:100}}),l.jsx("style",{children:`
                @keyframes cardSummonAppear {
                    0% { opacity: 0; transform: scale(1.5); filter: brightness(2) blur(4px); }
                    100% { opacity: 1; transform: scale(1); filter: brightness(1) blur(0px); }
                }
                @keyframes cardSummonFlash {
                    0% { opacity: 0.8; transform: scale(1.2); }
                    100% { opacity: 0; transform: scale(1); }
                }
                @keyframes wardPulseLoop {
                    0% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(255, 255, 255, 0.5)); }
                    50% { transform: scale(1.08); opacity: 0.5; filter: blur(3px) drop-shadow(0 0 15px rgba(255, 255, 255, 0.8)); }
                    100% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(255, 255, 255, 0.5)); }
                }
                @keyframes barrierPulseLoop {
                    0% { transform: scale(1); opacity: 1; box-shadow: 0 0 8px rgba(66, 153, 225, 0.6), inset 0 0 10px rgba(99, 179, 237, 0.2); }
                    50% { transform: scale(1.03); opacity: 0.85; box-shadow: 0 0 12px rgba(99, 179, 237, 0.8), inset 0 0 15px rgba(99, 179, 237, 0.3); }
                    100% { transform: scale(1); opacity: 1; box-shadow: 0 0 8px rgba(66, 153, 225, 0.6), inset 0 0 10px rgba(99, 179, 237, 0.2); }
                }
                @keyframes barrierGlowLoop {
                    0% { transform: scale(1); opacity: 0.6; }
                    50% { transform: scale(1.05); opacity: 0.4; }
                    100% { transform: scale(1); opacity: 0.6; }
                }
                @keyframes auraPulseLoop {
                    0% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(246, 173, 85, 0.5)); }
                    50% { transform: scale(1.12); opacity: 0.4; filter: blur(4px) drop-shadow(0 0 20px rgba(255, 204, 0, 0.8)); }
                    100% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(246, 173, 85, 0.5)); }
                }
                @keyframes stealthInkMove {
                    0%, 100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 0.7; }
                    25% { transform: translate(-45%, -55%) scale(1.15) rotate(3deg); opacity: 1; }
                    50% { transform: translate(-50%, -50%) scale(0.95) rotate(0deg); opacity: 0.5; }
                    75% { transform: translate(-55%, -45%) scale(1.1) rotate(-3deg); opacity: 0.9; }
                }
                @keyframes stealthInkPulse {
                    0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.8; }
                    50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.4; }
                }
                @keyframes stealthMistMove {
                    0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.5; }
                    25% { transform: translate(-48%, -52%) scale(1.1); opacity: 0.8; }
                    50% { transform: translate(-52%, -48%) scale(1.2); opacity: 0.3; }
                    75% { transform: translate(-50%, -50%) scale(0.9); opacity: 0.7; }
                }
                @keyframes stealthPulse {
                    0%, 100% { opacity: 0.6; box-shadow: inset 0 0 50px rgba(0, 0, 0, 0.9), 0 0 30px rgba(0, 0, 0, 0.7); }
                    50% { opacity: 1; box-shadow: inset 0 0 70px rgba(0, 0, 0, 1), 0 0 40px rgba(0, 0, 0, 0.9); }
                }
                /* 3D flip support - ensure all child elements inherit backface-visibility */
                .card, .card * {
                    backface-visibility: hidden !important;
                    -webkit-backface-visibility: hidden !important;
                }
            `})]})},$d=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},Zm=t=>$d(t==="YORUKA"?"/leaders/yoRuka_leader.png":t==="AJA"?"/leaders/azya_leader.png":"/leaders/senka_leader.png"),Yk=({myPlayer:t,opponentPlayer:e,isFirstPlayer:n,onComplete:r,scale:s=1})=>{const[i,o]=V.useState("fade-in"),[a,c]=V.useState(!1);V.useEffect(()=>{const p={"fade-in":500,"leaders-enter":1200,nameplate:800,"vs-display":1500,"coin-toss":1500,"turn-order":1e3,"ui-build":1500};if(i==="complete"){r();return}const f={"fade-in":"leaders-enter","leaders-enter":"nameplate",nameplate:"vs-display","vs-display":"coin-toss","coin-toss":"turn-order","turn-order":"ui-build","ui-build":"complete"},d=setTimeout(()=>{const y=f[i];y&&o(y)},p[i]||1e3);return()=>clearTimeout(d)},[i,r,n]),V.useEffect(()=>{if(i==="vs-display"){const p=setTimeout(()=>{c(!0),setTimeout(()=>c(!1),300)},800);return()=>clearTimeout(p)}},[i]);const u=["fade-in","leaders-enter","nameplate","vs-display","coin-toss","turn-order","ui-build","complete"].indexOf(i);return l.jsxs("div",{style:{position:"fixed",inset:0,background:"linear-gradient(135deg, #1a202c 0%, #2d3748 100%)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",animation:a?"screenShake 0.3s ease-in-out":void 0},children:[l.jsx("div",{style:{position:"absolute",inset:0,background:"black",opacity:i==="fade-in"?1:0,transition:"opacity 0.5s ease-out",pointerEvents:"none",zIndex:1e4}}),u>=0&&l.jsxs("div",{style:{position:"absolute",left:"25%",top:"50%",transform:`translate(-50%, -50%) translateX(${u>=1?"0":"-150%"})`,transition:"transform 1.2s cubic-bezier(0.22, 1, 0.36, 1)",zIndex:100},children:[l.jsx("div",{style:{width:600*s,height:600*s,overflow:"hidden",boxShadow:`0 20px 60px rgba(0,0,0,0.8), 0 0 40px ${n?"rgba(72, 187, 120, 0.3)":"rgba(246, 173, 85, 0.3)"}`},children:l.jsx("img",{src:Zm(t.class),alt:t.name,style:{width:"100%",height:"100%",objectFit:"cover"}})}),u>=2&&l.jsx("div",{style:{position:"absolute",bottom:-40*s,left:"50%",transform:"translateX(-50%)",padding:`${16*s}px ${40*s}px`,background:"rgba(0,0,0,0.9)",borderRadius:30*s,border:"3px solid rgba(255,255,255,0.4)",animation:"nameplateSlideUp 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)",whiteSpace:"nowrap"},children:l.jsx("div",{style:{color:"white",fontSize:2.5*s+"rem",fontWeight:"bold",textAlign:"center"},children:t.name})}),u>=5&&l.jsx("div",{style:{position:"absolute",top:-60*s,left:"50%",transform:"translateX(-50%)",padding:`${12*s}px ${32*s}px`,background:n?"rgba(72, 187, 120, 0.9)":"rgba(246, 173, 85, 0.9)",borderRadius:20*s,border:"3px solid white",animation:"turnOrderFadeIn 1s ease-out"},children:l.jsx("div",{style:{color:"white",fontSize:2*s+"rem",fontWeight:"bold"},children:n?"":""})})]}),u>=0&&l.jsxs("div",{style:{position:"absolute",right:"25%",top:"50%",transform:`translate(50%, -50%) translateX(${u>=1?"0":"150%"})`,transition:"transform 1.2s cubic-bezier(0.22, 1, 0.36, 1)",zIndex:100},children:[l.jsx("div",{style:{width:600*s,height:600*s,overflow:"hidden",boxShadow:`0 20px 60px rgba(0,0,0,0.8), 0 0 40px ${n?"rgba(246, 173, 85, 0.3)":"rgba(72, 187, 120, 0.3)"}`},children:l.jsx("img",{src:Zm(e.class),alt:e.name,style:{width:"100%",height:"100%",objectFit:"cover"}})}),u>=2&&l.jsx("div",{style:{position:"absolute",bottom:-40*s,left:"50%",transform:"translateX(-50%)",padding:`${16*s}px ${40*s}px`,background:"rgba(0,0,0,0.9)",borderRadius:30*s,border:"3px solid rgba(255,255,255,0.4)",animation:"nameplateSlideUp 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)",whiteSpace:"nowrap"},children:l.jsx("div",{style:{color:"white",fontSize:2.5*s+"rem",fontWeight:"bold",textAlign:"center"},children:e.name})}),u>=5&&l.jsx("div",{style:{position:"absolute",top:-60*s,left:"50%",transform:"translateX(-50%)",padding:`${12*s}px ${32*s}px`,background:n?"rgba(246, 173, 85, 0.9)":"rgba(72, 187, 120, 0.9)",borderRadius:20*s,border:"3px solid white",animation:"turnOrderFadeIn 1s ease-out"},children:l.jsx("div",{style:{color:"white",fontSize:2*s+"rem",fontWeight:"bold"},children:n?"":""})})]}),u>=3&&u<6&&l.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",animation:"vsZoomIn 1.5s cubic-bezier(0.34, 1.56, 0.64, 1)",zIndex:200},children:l.jsx("div",{style:{fontSize:8*s+"rem",fontWeight:900,color:"white",textShadow:`
                                0 0 ${20*s}px rgba(255,255,255,0.8),
                                0 0 ${40*s}px rgba(255,255,255,0.6),
                                ${4*s}px ${4*s}px ${8*s}px rgba(0,0,0,0.8)
                            `,letterSpacing:"0.1em"},children:"VS"})}),u>=4&&u<5&&l.jsx("div",{style:{position:"absolute",top:"20%",left:"50%",transform:"translate(-50%, -50%)",zIndex:150},children:l.jsx("div",{style:{width:100*s,height:100*s,borderRadius:"50%",background:"linear-gradient(45deg, #f6ad55 0%, #fbd38d 100%)",border:"4px solid white",display:"flex",alignItems:"center",justifyContent:"center",fontSize:2*s+"rem",fontWeight:"bold",color:"white",animation:"coinFlip 1.5s ease-in-out",boxShadow:`0 0 ${30*s}px rgba(246, 173, 85, 0.8)`},children:""})}),u>=6&&l.jsx("div",{style:{position:"absolute",inset:0,background:"radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 70%)",animation:"uiBuildFlash 1.5s ease-out",pointerEvents:"none",zIndex:300}}),l.jsx("style",{children:`
                @keyframes screenShake {
                    0%, 100% { transform: translate(0, 0); }
                    10% { transform: translate(-10px, -10px); }
                    20% { transform: translate(10px, 10px); }
                    30% { transform: translate(-10px, 10px); }
                    40% { transform: translate(10px, -10px); }
                    50% { transform: translate(-10px, -10px); }
                    60% { transform: translate(10px, 10px); }
                    70% { transform: translate(-10px, 10px); }
                    80% { transform: translate(10px, -10px); }
                    90% { transform: translate(-10px, 0); }
                }

                @keyframes nameplateSlideUp {
                    0% {
                        transform: translateX(-50%) translateY(50px);
                        opacity: 0;
                    }
                    60% {
                        transform: translateX(-50%) translateY(-10px);
                    }
                    100% {
                        transform: translateX(-50%) translateY(0);
                        opacity: 1;
                    }
                }

                @keyframes vsZoomIn {
                    0% {
                        transform: translate(-50%, -50%) scale(3) translateZ(0);
                        opacity: 0;
                        filter: blur(20px);
                    }
                    50% {
                        transform: translate(-50%, -50%) scale(1.2) translateZ(0);
                        opacity: 1;
                        filter: blur(0px);
                    }
                    100% {
                        transform: translate(-50%, -50%) scale(1) translateZ(0);
                        opacity: 1;
                        filter: blur(0px);
                    }
                }

                @keyframes coinFlip {
                    0% {
                        transform: rotateY(0deg) scale(1);
                    }
                    50% {
                        transform: rotateY(1800deg) scale(1.2);
                    }
                    100% {
                        transform: rotateY(3600deg) scale(1);
                    }
                }

                @keyframes turnOrderFadeIn {
                    0% {
                        opacity: 0;
                        transform: translateX(-50%) scale(0.5);
                    }
                    50% {
                        transform: translateX(-50%) scale(1.2);
                    }
                    100% {
                        opacity: 1;
                        transform: translateX(-50%) scale(1);
                    }
                }

                @keyframes uiBuildFlash {
                    0% {
                        opacity: 0;
                    }
                    50% {
                        opacity: 1;
                    }
                    100% {
                        opacity: 0;
                    }
                }
            `})]})},Kk=({isVictory:t,loserLeaderRef:e,onComplete:n,onPhaseChange:r,onShakeIntensityChange:s,scale:i=1})=>{const[o,a]=V.useState("start"),[c,u]=V.useState(null),[p,f]=V.useState([]);V.useEffect(()=>{if(e.current){const y=e.current.getBoundingClientRect();u({x:y.left+y.width/2,y:y.top+y.height/2,size:y.width})}},[e]),V.useEffect(()=>{r==null||r(o)},[o,r]),V.useEffect(()=>{const y={start:200,zoom:600,"white-fade":800,explode:1200,"result-text":1800,"fade-out":600};if(o==="complete"){n();return}const S={start:"zoom",zoom:"white-fade","white-fade":"explode",explode:"result-text","result-text":"fade-out","fade-out":"complete"},P=setTimeout(()=>{const g=S[o];g&&a(g)},y[o]||1e3);return()=>clearTimeout(P)},[o,n]),V.useEffect(()=>{if(o==="explode"&&c){const S=Array.from({length:60},(x,E)=>{const O=E/60*360,Q=(Math.random()-.5)*12,F=O+Q,se=150+Math.random()*250,J=12+Math.random()*20;return{id:E,x:c.x,y:c.y,angle:F,distance:se,size:J,delay:Math.random()*.1,duration:.6+Math.random()*.4}});f(S),s==null||s(1);const P=1e3,g=Date.now(),b=setInterval(()=>{const E=(Date.now()-g)/P;if(E>=1)s==null||s(0),clearInterval(b);else{const O=1-Math.pow(E,2);s==null||s(O)}},16);return()=>clearInterval(b)}},[o,c,s]);const d=["start","zoom","white-fade","explode","result-text","fade-out","complete"].indexOf(o);return c?l.jsxs("div",{style:{position:"fixed",inset:0,zIndex:8e3,pointerEvents:"none",overflow:"hidden"},children:[l.jsx("div",{style:{position:"absolute",inset:0,background:"black",opacity:d>=1?d>=5?1:.5:0,transition:"opacity 0.5s ease-out"}}),d>=1&&d<4&&l.jsx("div",{style:{position:"absolute",left:c.x,top:c.y,transform:"translate(-50%, -50%)",width:c.size*1.8,height:c.size*1.8,borderRadius:"50%",background:"radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 60%)",transition:"all 0.4s ease-out"}}),d>=3&&p.map(y=>l.jsx("div",{style:{position:"absolute",left:y.x,top:y.y,width:y.size*i,height:y.size*i,borderRadius:"50%",background:"white",boxShadow:"0 0 15px white, 0 0 30px rgba(255,255,255,0.5)",transform:"translate(-50%, -50%)",animation:`particleFly-${y.id} ${y.duration}s ease-out ${y.delay}s forwards`}},y.id)),d>=3&&l.jsx("style",{children:p.map(y=>{const S=y.angle*Math.PI/180,P=Math.cos(S)*y.distance,g=Math.sin(S)*y.distance;return`
                            @keyframes particleFly-${y.id} {
                                0% {
                                    transform: translate(-50%, -50%) scale(1);
                                    opacity: 1;
                                }
                                100% {
                                    transform: translate(calc(-50% + ${P}px), calc(-50% + ${g}px)) scale(0);
                                    opacity: 0;
                                }
                            }
                        `}).join(`
`)}),d>=4&&d<6&&l.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",animation:"resultTextPop 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)"},children:l.jsx("div",{style:{fontSize:`${7*i}rem`,fontWeight:900,fontFamily:"Tamanegi, sans-serif",color:t?"#ffd700":"#718096",textShadow:t?"0 0 30px rgba(255,215,0,0.8), 0 0 60px rgba(255,215,0,0.6), 0 0 90px rgba(255,215,0,0.4), 4px 4px 8px rgba(0,0,0,0.8)":"0 0 20px rgba(113,128,150,0.5), 4px 4px 8px rgba(0,0,0,0.8)",letterSpacing:"0.15em"},children:t?"":"..."})}),l.jsx("style",{children:`
                @keyframes resultTextPop {
                    0% {
                        transform: translate(-50%, -50%) scale(2.5);
                        opacity: 0;
                        filter: blur(20px);
                    }
                    60% {
                        transform: translate(-50%, -50%) scale(0.95);
                        opacity: 1;
                        filter: blur(0px);
                    }
                    100% {
                        transform: translate(-50%, -50%) scale(1);
                        opacity: 1;
                        filter: blur(0px);
                    }
                }
            `})]}):null},Xk=({isMyTurn:t,turnCount:e,activePlayerId:n,onTimeUp:r,timerEnabled:s,isGameOver:i=!1,scale:o=1,buttonSize:a=160,timerDuration:c=60})=>{const[u,p]=V.useState(c),[f,d]=V.useState(!1),[y,S]=V.useState(!1),P=V.useRef(null),g=V.useRef(""),b=V.useRef(0),x=V.useRef(r),E=V.useRef(!1),O=V.useId().replace(/:/g,"_");V.useEffect(()=>{x.current=r},[r]);const Q=`${e}-${n}`,F=V.useCallback(()=>{p(c),d(!1),S(!1),b.current=Date.now()+c*1e3,E.current=!1},[c]);if(V.useEffect(()=>{Q!==g.current&&(g.current=Q,F())},[Q,F]),V.useEffect(()=>{if(!s||!t||i){P.current&&(clearInterval(P.current),P.current=null);return}return b.current===0&&(b.current=Date.now()+c*1e3),P.current=window.setInterval(()=>{const T=Date.now(),B=Math.max(0,(b.current-T)/1e3);p(B);const U=Math.ceil(B);U<=15&&U>10?(d(!0),S(!1)):U<=10?(d(!0),S(!0)):(d(!1),S(!1)),B<=0&&!E.current&&(E.current=!0,P.current&&(clearInterval(P.current),P.current=null),setTimeout(()=>x.current(),0))},16),()=>{P.current&&(clearInterval(P.current),P.current=null)}},[s,t,i,c]),!s)return null;const se=u/c,J=(a/2+12)*o,me=6*o,A=2*Math.PI*J,C=-A*(1-se),k=Math.ceil(u),I=y?Math.min(1,(10-k)/10):0,m=Math.max(.05,.15-I*.1);let R="#4299e1";f&&!y?R="#f6ad55":y&&(R="#e53e3e");const $=20*o,L=J*2+me+$*2;return l.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:L,height:L,pointerEvents:"none",zIndex:10,animation:y?`timerShake${O} ${m}s ease-in-out infinite`:void 0},children:[l.jsxs("svg",{width:L,height:L,style:{position:"absolute",top:0,left:0,overflow:"visible"},children:[l.jsx("circle",{cx:L/2,cy:L/2,r:J,fill:"none",stroke:"rgba(0,0,0,0.3)",strokeWidth:me}),l.jsx("circle",{cx:L/2,cy:L/2,r:J,fill:"none",stroke:R,strokeWidth:me,strokeLinecap:"round",strokeDasharray:A,strokeDashoffset:C,style:{transform:"rotate(-90deg)",transformOrigin:"center"}}),f&&l.jsx("circle",{cx:L/2,cy:L/2,r:J,fill:"none",stroke:R,strokeWidth:me*3,opacity:.4,style:{filter:`blur(${12*o}px)`,animation:y?`timerPulse${O} 0.5s ease-in-out infinite`:`timerPulse${O} 1s ease-in-out infinite`}})]}),l.jsx("style",{children:`
                @keyframes timerPulse${O} {
                    0%, 100% { opacity: 0.4; }
                    50% { opacity: 0.7; }
                }
                @keyframes timerShake${O} {
                    0%, 100% { transform: translate(-50%, -50%) translate(0, 0); }
                    25% { transform: translate(-50%, -50%) translate(${2*o}px, ${-2*o}px); }
                    50% { transform: translate(-50%, -50%) translate(${-2*o}px, ${2*o}px); }
                    75% { transform: translate(-50%, -50%) translate(${2*o}px, ${1*o}px); }
                }
            `})]})};function Qk(t,e){const[n,r]=V.useState(null),[s,i]=V.useState(""),[o,a]=V.useState(!1),[c,u]=V.useState(null),[p,f]=V.useState(!1);return V.useEffect(()=>{if(t==="CPU")return;const d=new l1;return f(!0),(async()=>{try{const S=await d.connect(t==="JOIN"?e:void 0);i(S),r(d),d.onConnection(()=>{console.log("[useGameNetwork] Connection established!"),a(!0),f(!1)})}catch(S){u(S.toString()),f(!1)}})(),()=>{d.disconnect()}},[t,e]),{adapter:n,myId:s,connected:o,connecting:p,error:c,setConnected:a}}function ey(t,e,n){return!(!t.canEvolveThisTurn||t.evolutionsUsed>=2||e<(n?5:4))}function ty(t,e,n){return!(!t.canEvolveThisTurn||t.sep<=0||e<(n?7:6))}const je=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},Jk=je("/leaders/azya_leader.png"),qk=je("/leaders/senka_leader.png"),Zk=je("/leaders/yoRuka_leader.png"),ew=je("/sleeves/azya_sleeve.png"),tw=je("/sleeves/senka_sleeve.png"),nw=je("/sleeves/yoruka_sleeve.png"),lp=t=>t==="YORUKA"?Zk:t==="AJA"?Jk:qk,Ss=t=>t==="YORUKA"?nw:t==="AJA"?ew:tw,rw=1920,Bx=1080,sw=()=>{const[t,e]=V.useState({scale:1,toGameX:r=>r,toGameY:r=>r}),n=V.useCallback(()=>{const r=window.visualViewport?window.visualViewport.width:window.innerWidth,s=window.visualViewport?window.visualViewport.height:window.innerHeight;let i=Math.min(r/rw,s/Bx);i*=1.5,e({scale:i,toGameX:c=>c,toGameY:c=>c})},[]);return V.useEffect(()=>{n(),window.addEventListener("resize",n),window.addEventListener("orientationchange",()=>{setTimeout(n,150)}),window.visualViewport&&window.visualViewport.addEventListener("resize",n);const r=()=>{document.visibilityState==="visible"&&setTimeout(n,100)};return document.addEventListener("visibilitychange",r),()=>{window.removeEventListener("resize",n),window.removeEventListener("orientationchange",n),window.visualViewport&&window.visualViewport.removeEventListener("resize",n),document.removeEventListener("visibilitychange",r)}},[n]),t},Ht=90,an=120,Cs=Ht+18,pi=240,iw=({x:t,y:e,onComplete:n,scale:r=1})=>{M.useEffect(()=>{const i=setTimeout(n,2e3);return()=>clearTimeout(i)},[n]);const s=M.useMemo(()=>Array(20).fill(0).map((i,o)=>({id:o,angle:Math.random()*360,dist:(30+Math.random()*60)*r,size:(10+Math.random()*15)*r,delay:Math.random()*.5})),[r]);return l.jsxs("div",{style:{position:"absolute",left:t,top:e,pointerEvents:"none",zIndex:6e3},children:[l.jsx("style",{children:`
                @keyframes healGlowFade {
                    0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; filter: blur(10px); }
                    30% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.8; filter: blur(15px); }
                    100% { transform: translate(-50%, -50%) scale(1.6); opacity: 0; filter: blur(30px); }
                }
                @keyframes healParticleRise {
                    0% { transform: translate(-50%, -50%) rotate(var(--angle)) translate(0, 0) scale(0); opacity: 0; }
                    20% { transform: translate(-50%, -50%) rotate(var(--angle)) translate(0, 0) opacity: 0.7; }
                    100% { transform: translate(-50%, -50%) rotate(var(--angle)) translate(calc(var(--dist) * 1px), 0) scale(1.5); opacity: 0; }
                }
            `}),l.jsx("div",{style:{position:"absolute",left:0,top:0,width:150*r,height:150*r,background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(200,255,240,0.5) 50%, transparent 80%)",borderRadius:"50%",transform:"translate(-50%, -50%)",animation:"healGlowFade 1.5s ease-out forwards",filter:`blur(${8*r}px)`}}),s.map(i=>l.jsx("div",{style:{position:"absolute",left:0,top:0,width:i.size,height:i.size,background:"rgba(255,250,240,0.6)",borderRadius:"50%",filter:`blur(${4*r}px)`,"--angle":`${i.angle}deg`,"--dist":i.dist,animation:`healParticleRise 1.2s ease-out ${i.delay}s forwards`,pointerEvents:"none"}},i.id))]})},ow=({x:t,y:e,atkBuff:n,hpBuff:r,onComplete:s})=>{M.useEffect(()=>{const y=setTimeout(s,1500);return()=>clearTimeout(y)},[s]);const i=n<0||r<0,o=i?"radial-gradient(circle, rgba(180,50,50,0.9) 0%, rgba(150,30,30,0.4) 50%, transparent 80%)":"radial-gradient(circle, rgba(255,230,100,0.9) 0%, rgba(255,200,50,0.4) 50%, transparent 80%)",a=i?"#ff4444":"#ffd93d",c="#ffd93d",u="rgba(255,217,61,0.8)",p=y=>y>=0?`+${y}`:`${y}`,f=80,d=110;return l.jsxs("div",{style:{position:"absolute",left:t,top:e,pointerEvents:"none",zIndex:6e3},children:[l.jsx("style",{children:`
                @keyframes buffGlow {
                    0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
                    30% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
                    100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
                }
                @keyframes buffNumberRise {
                    0% { transform: translateY(0); opacity: 0; }
                    20% { opacity: 1; }
                    100% { transform: translateY(-30px); opacity: 0; }
                }
                @keyframes buffSparkle {
                    0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
                    50% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
                    100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
                }
            `}),l.jsx("div",{style:{position:"absolute",left:0,top:0,width:150,height:150,background:o,borderRadius:"50%",transform:"translate(-50%, -50%)",animation:"buffGlow 1.2s ease-out forwards",filter:"blur(8px)"}}),n!==0&&l.jsx("div",{style:{position:"absolute",left:-f/2+12,top:d/2-20,fontSize:"24px",fontWeight:"bold",color:c,textShadow:`0 0 10px ${u}, 2px 2px 4px rgba(0,0,0,0.8)`,fontFamily:"Tamanegi, sans-serif",animation:"buffNumberRise 1.2s ease-out forwards",textAlign:"center"},children:p(n)}),r!==0&&l.jsx("div",{style:{position:"absolute",left:f/2-28,top:d/2-20,fontSize:"24px",fontWeight:"bold",color:c,textShadow:`0 0 10px ${u}, 2px 2px 4px rgba(0,0,0,0.8)`,fontFamily:"Tamanegi, sans-serif",animation:"buffNumberRise 1.2s ease-out forwards",textAlign:"center"},children:p(r)}),[...Array(8)].map((y,S)=>l.jsx("div",{style:{position:"absolute",left:Math.cos(S*Math.PI/4)*60,top:Math.sin(S*Math.PI/4)*60,width:12,height:12,background:a,borderRadius:"50%",boxShadow:`0 0 10px ${a}, 0 0 20px ${a}`,animation:`buffSparkle 0.8s ease-out ${S*.1}s forwards`}},S))]})},aw=({x:t,y:e,onComplete:n,scale:r=1})=>(M.useEffect(()=>{const s=setTimeout(n,1200);return()=>clearTimeout(s)},[n]),l.jsxs("div",{style:{position:"absolute",left:t,top:e,transform:"translate(-50%, -50%)",width:130*r,height:130*r,pointerEvents:"none",zIndex:5e3,display:"flex",alignItems:"center",justifyContent:"center"},children:[l.jsx("div",{style:{fontSize:`${80*r}px`,animation:"baneSkullAppear 1.2s ease-out forwards",textShadow:`0 0 ${20*r}px #9b59b6, 0 0 ${40*r}px #8e44ad, 0 0 ${60*r}px #6c3483`,filter:`drop-shadow(0 0 ${15*r}px #9b59b6) hue-rotate(-10deg)`},children:""}),[...Array(12)].map((s,i)=>l.jsx("div",{style:{position:"absolute",left:"50%",top:"50%",width:6*r,height:6*r,background:"radial-gradient(circle, #9b59b6, #6c3483)",borderRadius:"50%",boxShadow:`0 0 ${8*r}px #9b59b6, 0 0 ${15*r}px #8e44ad`,animation:`baneParticle 1s ease-out ${i*.08}s forwards`,transform:`rotate(${i*30}deg) translateX(0)`}},i)),l.jsx("style",{children:`
                @keyframes baneSkullAppear {
                    0% { transform: scale(0) rotate(-30deg); opacity: 0; }
                    20% { transform: scale(1.3) rotate(10deg); opacity: 1; }
                    40% { transform: scale(1) rotate(-5deg); opacity: 1; }
                    60% { transform: scale(1.1) rotate(0deg); opacity: 1; }
                    80% { transform: scale(1) rotate(0deg); opacity: 0.8; }
                    100% { transform: scale(1.5) rotate(0deg); opacity: 0; }
                }
                @keyframes baneParticle {
                    0% { transform: rotate(0deg) translateX(0); opacity: 1; }
                    100% { transform: rotate(0deg) translateX(${70*r}px); opacity: 0; }
                }
            `})]})),lw=({type:t,x:e,y:n,onComplete:r,audioSettings:s,scale:i=1})=>{const o=M.useMemo(()=>{let d=8,y=8,S=100,P=256;return t==="SHOT"&&(P=128),{cols:d,rows:y,fps:S,size:P}},[t]);if(M.useEffect(()=>{const y=["LIGHTNING","THUNDER","IMPACT","SUMI","SHOT","ICE","WATER","RAY","FIRE","SLASH","BLUE_FIRE"].includes(t)?o.cols*o.rows/o.fps*1e3:t==="FIREBALL"?500:t==="HEAL"?2e3:400,S=setTimeout(r,y);return()=>clearTimeout(S)},[r,t,o]),M.useEffect(()=>{if(!s||!s.seEnabled)return;const d=(y,S=.5,P=0)=>{setTimeout(()=>{const g=new Audio(je(`/se/${y}`));g.volume=(s.se||.5)*S,g.play().catch(b=>console.warn("SE Play prevented",b))},P)};t==="SHOT"?(d("shot.mp3",.6),d("hibi.mp3",.4,400)):t==="IMPACT"?(d("panch1.mp3",.6,100),d("panch2.mp3",.6,500)):t==="LIGHTNING"||t==="THUNDER"?d("thunder.mp3",.5):t==="FIREBALL"?d("explosion.mp3",.5):t==="FIRE"?d("fire.mp3",.5):t==="SLASH"?d("slash.mp3",.5):t==="ICE"?d("ice.mp3",.5):t==="WATER"?d("water.mp3",.5):t==="RAY"?d("ray.mp3",.6):t==="SUMI"?d("yami.mp3",.6):t==="HEAL"?d("heal.mp3",.6):t==="BLUE_FIRE"?d("fire.mp3",.5):t==="BANE"&&d("yami.mp3",.7)},[t,s]),t==="HEAL")return l.jsx(iw,{x:e,y:n,onComplete:r,scale:i});if(t==="BANE")return l.jsx(aw,{x:e,y:n,onComplete:r,scale:i});const a=100*i,c={position:"absolute",left:e,top:n,transform:"translate(-50%, -50%)",width:a,height:a,pointerEvents:"none",zIndex:5e3,display:"flex",alignItems:"center",justifyContent:"center"};if(["LIGHTNING","THUNDER","IMPACT","SUMI","SHOT","ICE","WATER","RAY","FIRE","SLASH","BLUE_FIRE"].includes(t)){let d=je("/effects/thunder.png");t==="IMPACT"&&(d=je("/effects/impact.png")),t==="SUMI"&&(d=je("/effects/sumi.png")),t==="SHOT"&&(d=je("/effects/shot.png")),t==="ICE"&&(d=je("/effects/ice.png")),t==="WATER"&&(d=je("/effects/water.png")),t==="RAY"&&(d=je("/effects/ray.png")),t==="FIRE"&&(d=je("/effects/fire.png")),t==="SLASH"&&(d=je("/effects/slash.png")),t==="BLUE_FIRE"&&(d=je("/effects/blue_fire.png"));const y=o.cols*o.rows,S=Math.min(160,o.size)*i;return l.jsxs("div",{style:{...c,width:S,height:S,transform:`${(c==null?void 0:c.transform)||""}`},children:[l.jsx("div",{style:{width:"100%",height:"100%",backgroundImage:`url(${d})`,backgroundSize:`${o.cols*100}% ${o.rows*100}%`,animation:`spriteAnimation ${y/o.fps}s steps(1) forwards`}}),l.jsx("style",{children:`
                    @keyframes spriteAnimation {
                        ${Array.from({length:y}).map((P,g)=>{const b=g%o.cols,x=Math.floor(g/o.cols),E=b*(100/(o.cols-1)),O=x*(100/(o.rows-1));return`${g/(y-1)*100}% { background-position: ${E}% ${O}%; }`}).join(`
`)}
                    }
                `})]})}let p="",f="";if(t==="FIREBALL")p=je("/effects/fireball.png"),f="explode 0.5s ease-out forwards";else if(t==="BEAM")return l.jsx("div",{style:{position:"fixed",left:e,top:n,width:400,height:30,background:"linear-gradient(90deg, transparent, #faf089, #fff, #faf089, transparent)",transform:"translate(-50%, -50%) rotate(-45deg)",boxShadow:"0 0 20px #faf089",opacity:0,animation:"beamShoot 0.4s ease-out forwards",pointerEvents:"none",zIndex:5e3},children:l.jsx("style",{children:`
                    @keyframes beamShoot {
                        0% { width: 0; opacity: 1; transform: translate(-50%, -50%) rotate(-45deg) scaleX(0); }
                        20% { width: 400px; opacity: 1; transform: translate(-50%, -50%) rotate(-45deg) scaleX(1); }
                        100% { width: 400px; opacity: 0; transform: translate(-50%, -50%) rotate(-45deg) scaleX(1.2); }
                    }
                `})});return p?l.jsxs("div",{style:c,children:[l.jsx("img",{src:p,style:{width:"100%",height:"100%",objectFit:"contain",animation:f}}),l.jsx("style",{children:`
                @keyframes explode { 0% { transform: scale(0.5); opacity: 0; } 20% { opacity: 1; } 100% { transform: scale(2); opacity: 0; } }
            `})]}):null},cw=({value:t,x:e,y:n,color:r,onComplete:s,scale:i=1})=>{M.useEffect(()=>{const u=setTimeout(s,1200);return()=>clearTimeout(u)},[s]);const o=r==="#48bb78",a=r||"#e53e3e",c=o?"linear-gradient(180deg, #68d391 0%, #38a169 50%, #276749 100%)":"linear-gradient(180deg, #fc8181 0%, #e53e3e 50%, #c53030 100%)";return l.jsxs("div",{style:{position:"absolute",left:e,top:n,transform:"translate(-50%, -50%)",pointerEvents:"none",zIndex:6e3,fontSize:`${4*i}rem`,fontWeight:"900",fontFamily:'"Impact", "Arial Black", sans-serif',letterSpacing:`${-2*i}px`,background:c,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",filter:`drop-shadow(0 0 ${8*i}px ${a}) drop-shadow(0 ${2*i}px ${4*i}px rgba(0,0,0,0.8))`,animation:"floatUp 1.2s ease-out forwards"},children:[t,l.jsx("style",{children:`
                @keyframes floatUp {
                    0% { transform: translate(-50%, -50%) scale(0.3); opacity: 0; }
                    15% { transform: translate(-50%, -70%) scale(1.8); opacity: 1; }
                    30% { transform: translate(-50%, -90%) scale(1.4); opacity: 1; }
                    100% { transform: translate(-50%, -180%) scale(1); opacity: 0; }
                }
            `})]})},uw=({x:t,y:e})=>{const n=M.useMemo(()=>Array(16).fill(0).map((r,s)=>({id:s,angle:Math.random()*360,dist:60+Math.random()*120,size:4+Math.random()*8,delay:Math.random()*.3,color:Math.random()>.5?"#f6e05e":"#ffffff"})),[]);return l.jsxs("div",{style:{position:"absolute",left:t,top:e,pointerEvents:"none",zIndex:6e3},children:[l.jsx("style",{children:`
                @keyframes sparkleMove {
                    0% { transform: rotate(var(--angle)) translate(0, 0) scale(0); opacity: 0; }
                    20% { opacity: 1; transform: rotate(var(--angle)) translate(calc(var(--dist) * 0.2px), 0) scale(1.5); }
                    100% { transform: rotate(var(--angle)) translate(calc(var(--dist) * 1px), 0) scale(0); opacity: 0; }
                }
            `}),n.map(r=>l.jsx("div",{style:{position:"absolute",left:0,top:0,width:r.size,height:r.size,background:r.color,borderRadius:"50%",boxShadow:`0 0 10px ${r.color}, 0 0 20px ${r.color}`,"--angle":`${r.angle}deg`,"--dist":r.dist,animation:`sparkleMove 0.8s ease-out ${r.delay}s forwards`,pointerEvents:"none"}},r.id))]})},dw=({onClose:t})=>l.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(0,0,0,0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:t,children:l.jsxs("div",{style:{background:"linear-gradient(135deg, #1a202c 0%, #2d3748 100%)",borderRadius:16,padding:30,maxWidth:700,maxHeight:"80vh",overflowY:"auto",color:"#fff",boxShadow:"0 20px 60px rgba(0,0,0,0.5)",border:"1px solid #4a5568"},onClick:e=>e.stopPropagation(),children:[l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[l.jsx("h2",{style:{margin:0,color:"#63b3ed"},children:""}),l.jsx("button",{onClick:t,style:{background:"transparent",border:"none",color:"#a0aec0",fontSize:"1.5rem",cursor:"pointer"},children:""})]}),l.jsxs("section",{style:{marginBottom:25},children:[l.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),l.jsxs("ul",{style:{lineHeight:1.8,paddingLeft:20,color:"#e2e8f0"},children:[l.jsx("li",{children:"0"}),l.jsx("li",{children:"1PP110"}),l.jsx("li",{children:"PP"}),l.jsx("li",{children:""}),l.jsx("li",{children:"5"}),l.jsx("li",{children:"910"})]})]}),l.jsxs("section",{style:{marginBottom:25},children:[l.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[l.jsxs("div",{children:[l.jsx("span",{style:{color:"#48bb78",fontWeight:"bold"},children:"[]"}),""]}),l.jsxs("div",{children:[l.jsx("span",{style:{color:"#ed8936",fontWeight:"bold"},children:"[]"}),""]}),l.jsxs("div",{children:[l.jsx("span",{style:{color:"#4299e1",fontWeight:"bold"},children:"[]"}),""]}),l.jsxs("div",{children:[l.jsx("span",{style:{color:"#9f7aea",fontWeight:"bold"},children:"[]"}),""]}),l.jsxs("div",{children:[l.jsx("span",{style:{color:"#f56565",fontWeight:"bold"},children:"[]"}),"12"]}),l.jsxs("div",{children:[l.jsx("span",{style:{color:"#38b2ac",fontWeight:"bold"},children:"[]"}),"1"]}),l.jsxs("div",{children:[l.jsx("span",{style:{color:"#718096",fontWeight:"bold"},children:"[]"}),"AoE"]}),l.jsxs("div",{children:[l.jsx("span",{style:{color:"#d69e2e",fontWeight:"bold"},children:"[]"}),"AoE"]})]})]}),l.jsxs("section",{style:{marginBottom:25},children:[l.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[l.jsxs("div",{children:[l.jsx("span",{style:{color:"#63b3ed",fontWeight:"bold"},children:""}),""]}),l.jsxs("div",{children:[l.jsx("span",{style:{color:"#f687b3",fontWeight:"bold"},children:""}),""]}),l.jsxs("div",{children:[l.jsx("span",{style:{color:"#faf089",fontWeight:"bold"},children:""}),"EP"]}),l.jsxs("div",{children:[l.jsx("span",{style:{color:"#b794f4",fontWeight:"bold"},children:""}),"SEP"]}),l.jsxs("div",{children:[l.jsx("span",{style:{color:"#68d391",fontWeight:"bold"},children:""}),""]})]})]}),l.jsxs("section",{style:{marginBottom:25},children:[l.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),l.jsxs("ul",{style:{lineHeight:1.8,paddingLeft:20,color:"#e2e8f0"},children:[l.jsxs("li",{children:[l.jsx("span",{style:{color:"#faf089"},children:"EP"}),"54112"]}),l.jsxs("li",{children:[l.jsx("span",{style:{color:"#b794f4"},children:"SEP"}),"76112"]}),l.jsx("li",{children:"1111"}),l.jsx("li",{children:"+2/+2"}),l.jsx("li",{children:"+3/+3"})]})]}),l.jsxs("section",{children:[l.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),l.jsxs("ul",{style:{lineHeight:1.8,paddingLeft:20,color:"#e2e8f0"},children:[l.jsxs("li",{children:[l.jsx("span",{style:{color:"#ed8936"},children:"PP"}),""]}),l.jsx("li",{children:"151612PP +1"})]})]})]})}),fw=({logs:t,onCardNameClick:e,scale:n=1,isMobile:r=!1})=>{const s=M.useRef(null);M.useEffect(()=>{s.current&&(s.current.scrollTop=s.current.scrollHeight)},[t.length]);const i=(c,u)=>{const p={color:"#ffd700",cursor:"pointer",textDecoration:"underline",textUnderlineOffset:"2px",fontWeight:"bold"},f=O=>{O.target.style.color="#ffec8b",O.target.style.textShadow="0 0 8px rgba(255, 215, 0, 0.8)"},d=O=>{O.target.style.color="#ffd700",O.target.style.textShadow="none"},y=(O,Q)=>l.jsx("span",{style:p,onMouseEnter:f,onMouseLeave:d,onClick:F=>{F.stopPropagation(),e==null||e(O)},children:O},Q),S=$x(),P=O=>O?!(/[a-zA-Z0-9]/.test(O)||/[\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/.test(O)):!0,g=[];for(const O of S){let Q=0;for(;;){const F=c.indexOf(O,Q);if(F===-1)break;const se=F>0?c[F-1]:void 0,J=F+O.length<c.length?c[F+O.length]:void 0,me=P(se)&&P(J),A=g.some(C=>F>=C.start&&F<C.end||F+O.length>C.start&&F+O.length<=C.end||F<=C.start&&F+O.length>=C.end);me&&!A&&g.push({start:F,end:F+O.length,name:O}),Q=F+1}}if(g.length===0)return l.jsx("span",{children:c});g.sort((O,Q)=>O.start-Q.start);const b=[];let x=0,E=0;for(const O of g)O.start>x&&b.push(l.jsx("span",{children:c.slice(x,O.start)},E++)),b.push(y(O.name,E++)),x=O.end;return x<c.length&&b.push(l.jsx("span",{children:c.slice(x)},E++)),l.jsx(l.Fragment,{children:b})},o=r?Math.max(100,140*n):Math.max(150,200*n),a=r?Math.max(140,180*n):Math.max(180,220*n);return l.jsxs("div",{ref:s,style:{position:"absolute",left:0,top:"45%",transform:"translateY(-50%)",width:a,height:o,overflowY:"auto",background:"linear-gradient(to right, rgba(0,0,0,0.8), rgba(0,0,0,0.0))",color:"#fff",fontSize:r?`${Math.max(.55,.65*n)}rem`:`${Math.max(.65,.75*n)}rem`,padding:r?`${6*n}px ${6*n}px ${6*n}px ${10*n}px`:`${8*n}px ${8*n}px ${8*n}px ${12*n}px`,borderLeft:r?"2px solid #63b3ed":"3px solid #63b3ed",zIndex:15,pointerEvents:"auto",scrollbarWidth:"thin"},onMouseDown:c=>c.stopPropagation(),onClick:c=>c.stopPropagation(),children:[l.jsx("div",{style:{fontWeight:"bold",marginBottom:(r?3:4)*n,color:"#a0aec0",borderBottom:"1px solid rgba(255,255,255,0.1)",paddingBottom:2,fontSize:r?`${Math.max(.5,.55*n)}rem`:`${Math.max(.55,.65*n)}rem`,textTransform:"uppercase",letterSpacing:1},children:r?"LOG":"BATTLE LOG"}),l.jsx("div",{style:{display:"flex",flexDirection:"column",gap:(r?2:3)*n},children:t.map((c,u)=>l.jsx("div",{style:{opacity:.9,lineHeight:r?"1.3":"1.4",textShadow:"0 1px 2px black",animation:"fadeIn 0.3s ease-out"},children:i(c)},u))})]})},pw=({card:t,evolvedImageUrl:e,startX:n,startY:r,phase:s,onPhaseChange:i,onShake:o,useSep:a,playSE:c,scale:u})=>{const[p,f]=M.useState(0),[d,y]=M.useState(0),[S,P]=M.useState(0),[g,b]=M.useState(0),[x,E]=M.useState(0),[O,Q]=M.useState(.25),[F,se]=M.useState({x:n,y:r}),[J,me]=M.useState(!1),[A,C]=M.useState([]),[k,I]=M.useState([]),[m,R]=M.useState(!1),$=M.useRef(!1),L=M.useRef(null),T=M.useRef(i),B=M.useRef(o),U=M.useRef(c);M.useEffect(()=>{T.current=i,B.current=o,U.current=c},[i,o,c]);const Y=360*u,Me=480*u;M.useEffect(()=>{var fe,Z,ke;console.log("[EvolutionAnimation] Phase:",s);let _e,Le=null;switch(s){case"ZOOM_IN":{se({x:n,y:r}),Q(.25),y(0);const mt=Date.now(),Ne=650,it=.25,Bt=.75,Dn=setInterval(()=>{const Kt=Date.now()-mt,Cn=Math.min(Kt/Ne,1),Hn=1-Math.pow(1-Cn,2);y(-5*Hn),Q(it+(Bt-it)*Hn),Cn>=1&&clearInterval(Dn)},16);_e=setTimeout(()=>{const Kt=280*u,Cn=window.innerWidth-Kt,Hn=Kt+Cn*.4;se({x:Hn,y:window.innerHeight/2-30*u})},50);const Ct=setTimeout(()=>{const Kt=new Audio(je("/se/kirakira.mp3"));Kt.volume=.35,Kt.play().catch(()=>{}),L.current=Kt},600),hn=setTimeout(()=>{T.current("WHITE_FADE")},700);return()=>{clearTimeout(_e),clearTimeout(hn),clearTimeout(Ct),clearInterval(Dn)}}case"WHITE_FADE":(fe=U.current)==null||fe.call(U,"magic_charge.mp3",.3);const qe=Array(80).fill(0).map((mt,Ne)=>{const it=Ne/80*360,Bt=(Math.random()-.5)*10,Dn=it+Bt,Ct=200+Math.random()*600,hn=Math.random()*1.8,Cn=.5+(Ct-200)/600*.5,Hn=24+Math.random()*48;return{id:Ne,angle:Dn,dist:Ct,delay:hn,duration:Cn,size:Hn}});C(qe),R(!0);let tt=0;return Le=setInterval(()=>{tt+=.025,b(Math.min(tt,1)),E(Math.min(tt*80,80)),P(tt*15),tt>=1.2&&(Le&&clearInterval(Le),R(!1),T.current("FLIP"))},40),()=>{Le&&clearInterval(Le)};case"FLIP":if((Z=U.current)==null||Z.call(U,"syakin.mp3",.8),(ke=U.current)==null||ke.call(U,"KO.mp3",.7),L.current){const mt=L.current,Ne=300,it=30,Bt=Ne/it,Dn=mt.volume/Bt;let Ct=0;const hn=setInterval(()=>{Ct++,mt.volume=Math.max(0,mt.volume-Dn),Ct>=Bt&&(clearInterval(hn),mt.pause(),L.current=null)},it)}C([]);const $e=Date.now(),nt=400,zn=1200;return Le=setInterval(()=>{const mt=Date.now()-$e;if(mt<nt){const Ne=mt/nt,it=1-Math.pow(1-Ne,3),Bt=10+it*160;if(f(Bt),Q(.75+it*((a?1.2:1.1)-.75)),y(-5+it*2),b(Math.max(1-Ne*3,0)),Bt>90&&!$.current){$.current=!0;const Ct=Array(120).fill(0).map((hn,Kt)=>{const Cn=Kt/120*360,Hn=(Math.random()-.5)*8,Ba=18+Math.random()*42;return{id:Kt,angle:Cn+Hn,dist:200+Math.random()*400,size:Ba*3,delay:Math.random()*.05}});I(Ct)}}else{const Ne=Math.min((mt-nt)/zn,1),it=Ne<.5?2*Ne*Ne:1-Math.pow(-2*Ne+2,2)/2;if(f(170+it*10),b(0),!$.current){$.current=!0;const Bt=Array(120).fill(0).map((Dn,Ct)=>{const hn=Ct/120*360,Kt=(Math.random()-.5)*8,Cn=18+Math.random()*42;return{id:Ct,angle:hn+Kt,dist:200+Math.random()*400,size:Cn*3,delay:Math.random()*.05}});I(Bt)}Ne>=1&&(Le&&clearInterval(Le),T.current("REVEAL"))}},16),()=>{Le&&clearInterval(Le)};case"REVEAL":let Ye=0;return Le=setInterval(()=>{Ye+=.25,b(Math.max(1-Ye,0)),E(Math.max(60-Ye*60,0)),Ye>=1&&(Le&&clearInterval(Le),I([]),T.current("ZOOM_OUT"))},40),()=>{Le&&clearInterval(Le)};case"ZOOM_OUT":{se({x:n,y:r});const mt=Date.now(),Ne=250,it=O,Bt=-3;return Le=setInterval(()=>{const Dn=Date.now()-mt,Ct=Math.min(Dn/Ne,1),hn=1-Math.pow(1-Ct,3);Q(it-(it-.25)*hn),y(Bt*(1-hn)),Ct>=1&&(Le&&clearInterval(Le),f(180),P(0),Q(.25),y(0),T.current("LAND"))},16),()=>{Le&&clearInterval(Le)}}case"LAND":return B.current(),me(!0),_e=setTimeout(()=>{T.current("DONE")},600),()=>clearTimeout(_e)}return()=>{_e&&clearTimeout(_e),Le&&clearInterval(Le),L.current&&(L.current.pause(),L.current=null)}},[s]);const Je=p+S,de=d,Ue=m?{x:(Math.random()-.5)*4,y:(Math.random()-.5)*4}:{x:0,y:0};return l.jsxs("div",{style:{position:"fixed",inset:0,zIndex:1e4,background:"rgba(0,0,0,0.75)",pointerEvents:"none"},children:[l.jsx("style",{children:`
                ${A.map(_e=>`
                    @keyframes chargeParticleIn-${_e.id} {
                        0% { opacity: 0; transform: rotate(${_e.angle}deg) translateX(${_e.dist}px) scale(0.5); }
                        20% { opacity: 0.8; transform: rotate(${_e.angle}deg) translateX(${_e.dist*.8}px) scale(1.2); }
                        100% { opacity: 1; transform: rotate(${_e.angle}deg) translateX(0) scale(0.2); } /* Keep visible at end */
                    }
                `).join("")}
                ${k.map(_e=>`
                    @keyframes burstParticleOut-${_e.id} {
                        0% { opacity: 1; transform: translate(-50%, -50%) rotate(${_e.angle}deg) translateX(0) scale(1.5); }
                        100% { opacity: 0; transform: translate(-50%, -50%) rotate(${_e.angle}deg) translateX(${_e.dist*1.5}px) scale(0); }
                    }
                `).join("")}
            `}),A.map(_e=>l.jsx("div",{style:{position:"absolute",left:F.x,top:F.y,width:_e.size*u,height:_e.size*u,borderRadius:"50%",background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(200,230,255,0.6) 40%, transparent 70%)",boxShadow:"0 0 10px white, 0 0 20px rgba(100,200,255,0.5)",filter:"blur(1px)",animation:`chargeParticleIn-${_e.id} ${_e.duration}s ease-in ${_e.delay}s forwards`,transform:`rotate(${_e.angle}deg) translateX(${_e.dist*u}px)`,opacity:0,pointerEvents:"none"}},`charge-${_e.id}`)),s==="WHITE_FADE"&&l.jsxs("div",{style:{position:"absolute",left:F.x+Ue.x,top:F.y+Ue.y,width:0,height:0,transformStyle:"preserve-3d"},children:[l.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:500*u,height:500*u,border:"8px solid rgba(255, 255, 255, 0.6)",borderRadius:"50%",transform:"translate(-50%, -50%) rotateX(75deg)",boxShadow:"0 0 30px rgba(255, 255, 255, 0.8), inset 0 0 30px rgba(255, 255, 255, 0.8)",animation:"ringSpin 2s linear infinite"}}),l.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:600*u,height:600*u,border:"6px dashed rgba(100, 200, 255, 0.7)",borderRadius:"50%",transform:"translate(-50%, -50%) rotateX(80deg) rotateY(10deg)",boxShadow:"0 0 40px rgba(100, 200, 255, 0.5)",animation:"ringSpinReverse 3s linear infinite"}}),l.jsx("style",{children:`
                        @keyframes ringSpin {
                            0% { transform: translate(-50%, -50%) rotateX(75deg) rotate(0deg); opacity: 0; scale: 0.5; }
                            20% { opacity: 1; scale: 1; }
                            100% { transform: translate(-50%, -50%) rotateX(75deg) rotate(360deg); opacity: 1; scale: 1; }
                        }
                        @keyframes ringSpinReverse {
                            0% { transform: translate(-50%, -50%) rotateX(80deg) rotateY(10deg) rotate(0deg); opacity: 0; scale: 0.6; }
                            20% { opacity: 0.8; scale: 1; }
                            100% { transform: translate(-50%, -50%) rotateX(80deg) rotateY(10deg) rotate(-360deg); opacity: 0.8; scale: 1; }
                        }
                    `})]}),k.map(_e=>l.jsx("div",{style:{position:"absolute",left:F.x,top:F.y,width:_e.size*u,height:_e.size*u,borderRadius:"50%",background:a?"radial-gradient(circle, rgba(183, 148, 244, 1) 0%, rgba(159, 122, 234, 0.8) 50%, transparent 100%)":"radial-gradient(circle, rgba(255, 251, 235, 1) 0%, rgba(251, 211, 141, 0.8) 50%, transparent 100%)",boxShadow:a?"0 0 10px #b794f4, 0 0 20px rgba(159,122,234,0.6)":"0 0 10px #fbd38d, 0 0 20px rgba(251,211,141,0.6)",animation:`burstParticleOut-${_e.id} 0.4s ease-out ${_e.delay}s forwards`,pointerEvents:"none"}},`burst-${_e.id}`)),l.jsxs("div",{style:{position:"absolute",left:F.x+Ue.x,top:F.y+Ue.y,transform:`translate(-50%, -50%) scale(${O}) perspective(1200px) rotateY(${Je}deg) rotateZ(${de}deg)`,transition:s==="ZOOM_IN"||s==="ZOOM_OUT"?"left 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), top 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)":"none",transformStyle:"preserve-3d"},children:[l.jsx("div",{style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:Y*1.3,height:Me*1.2,background:a?"radial-gradient(ellipse, rgba(159, 122, 234, 0.4) 0%, transparent 70%)":"radial-gradient(ellipse, rgba(251, 211, 141, 0.4) 0%, transparent 70%)",filter:"blur(20px)",pointerEvents:"none",opacity:x>1?1:0,transition:"opacity 0.4s"}}),l.jsxs("div",{style:{width:Y,height:Me,borderRadius:16,overflow:"hidden",boxShadow:a?"0 0 40px rgba(159, 122, 234, 0.7)":"0 0 40px rgba(251, 211, 141, 0.7)",position:"relative",transformStyle:"preserve-3d"},children:[l.jsxs("div",{style:{position:"absolute",inset:0,borderRadius:16,overflow:"hidden",background:"#1a202c",zIndex:Je<=90?2:1,opacity:Je<=90?1:0},children:[l.jsx("img",{src:je(t.imageUrl||""),alt:t.name,style:{width:"100%",height:"100%",objectFit:"cover",filter:`brightness(${1+g*.5}) contrast(${1-g*.2})`}}),l.jsx("div",{style:{position:"absolute",inset:0,background:"white",opacity:g,pointerEvents:"none"}})]}),l.jsxs("div",{style:{position:"absolute",inset:0,transform:"rotateY(180deg)",borderRadius:16,overflow:"hidden",background:"#1a202c",zIndex:Je>90?2:1,opacity:Je>90?1:0},children:[l.jsx("img",{src:je(e&&e!==""?e:t.imageUrl||""),alt:`${t.name} Evolved`,style:{width:"100%",height:"100%",objectFit:"cover",filter:`brightness(${1+g*.5}) contrast(${1-g*.2})`}}),l.jsx("div",{style:{position:"absolute",inset:0,background:"white",opacity:g,pointerEvents:"none"}})]})]})]}),J&&l.jsxs("div",{style:{position:"absolute",left:n,top:r,pointerEvents:"none"},children:[l.jsx("style",{children:`
                        @keyframes landParticleMove {
                            0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                            100% { opacity: 0; transform: translate(-50%, -50%) rotate(var(--angle)) translateX(calc(var(--dist) * 1px)) scale(0); }
                        }
                    `}),Array(20).fill(0).map((_e,Le)=>{const fe=Le/20*360,Z=40+Math.random()*100;return l.jsx("div",{style:{position:"absolute",left:0,top:0,width:8*u,height:8*u,borderRadius:"50%",background:"white","--angle":`${fe}deg`,"--dist":Z,animation:"landParticleMove 0.5s ease-out forwards"}},`land-${Le}`)})]})]})},ny=je("/leaders/yoRuka_win.png"),ry=je("/leaders/yoRuka_lose.png"),hw=je("/leaders/senka_win.png"),gw=je("/leaders/senka_lose.png"),mw=je("/leaders/azya_win.png"),yw=je("/leaders/azya_lose.png"),vw=({winnerId:t,playerId:e,playerClass:n,onRematch:r,onLeave:s,isOnline:i,isRoomMatch:o=!0,myRematchRequested:a,opponentRematchRequested:c,battleStats:u,selectedCardInfo:p,onCardInfoClick:f})=>{const d=t===e,[y,S]=M.useState("bg-fade"),P=["bg-fade","image","result-text","stats","rate","buttons","complete"].indexOf(y);M.useEffect(()=>{const k={"bg-fade":300,image:600,"result-text":400,stats:400,rate:300,buttons:0};if(y==="complete")return;const I={"bg-fade":"image",image:"result-text","result-text":"stats",stats:"rate",rate:"buttons",buttons:"complete"},m=setTimeout(()=>{const R=I[y];R&&S(R)},k[y]||0);return()=>clearTimeout(m)},[y]);const g=()=>n==="SENKA"?d?hw:gw:n==="AJA"?d?mw:yw:d?ny:ry,[b,x]=M.useState(15),[E,O]=M.useState(!1),[Q,F]=M.useState(null),se=i?a||c:a||E;M.useEffect(()=>{if(se)return;const k=setInterval(()=>{x(I=>I<=1?(clearInterval(k),s(),0):I-1)},1e3);return()=>clearInterval(k)},[s,se]);const J=k=>{F(k),r(k)},me=()=>{const k=o?"":"";return i?a&&c?"...":a?"...":c?`${k}`:k:a?"...":k},A=()=>{const k={padding:"15px 40px",fontSize:"1.5rem",fontWeight:"bold",border:"none",borderRadius:12,cursor:a?"default":"pointer",transform:"scale(1)",transition:"transform 0.1s, background 0.2s"};return c&&!a?{...k,background:"linear-gradient(135deg, #f6e05e, #d69e2e)",color:"black",boxShadow:"0 4px 15px rgba(246, 224, 94, 0.6)",animation:"pulse 1s infinite"}:a?{...k,background:"linear-gradient(135deg, #718096, #4a5568)",color:"white",boxShadow:"none"}:{...k,background:"linear-gradient(135deg, #48bb78, #38a169)",color:"white",boxShadow:"0 4px 15px rgba(72, 187, 120, 0.4)"}},C=(k,I)=>({width:220,height:220,borderRadius:"50%",border:Q===k?"5px solid #f6e05e":"4px solid rgba(255,255,255,0.4)",background:`url(${lp(k)}) center/cover`,cursor:"pointer",transform:I?"scale(1.1)":"scale(1)",transition:"all 0.2s ease",boxShadow:I?"0 0 30px rgba(246, 224, 94, 0.7)":"0 6px 15px rgba(0,0,0,0.5)"});return l.jsxs("div",{style:{position:"absolute",inset:0,zIndex:5e3,background:"rgba(0,0,0,0.85)",backdropFilter:"blur(10px)",display:"flex",flexDirection:"row",alignItems:"stretch",opacity:P>=0?1:0,transition:"opacity 0.3s ease-out"},onClick:()=>{},children:[l.jsx("style",{children:`
                @keyframes pulse {
                    0%, 100% { transform: scale(1); }
                    50% { transform: scale(1.05); }
                }
                @keyframes float {
                    0%, 100% { transform: translateY(0); }
                    50% { transform: translateY(-10px); }
                }
                @keyframes slideUpFadeIn {
                    0% { opacity: 0; transform: translateY(30px); }
                    100% { opacity: 1; transform: translateY(0); }
                }
                @keyframes imageFadeIn {
                    0% { opacity: 0; transform: scale(0.95); }
                    100% { opacity: 0.9; transform: scale(1); }
                }
            `}),l.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:40,borderRight:"1px solid rgba(255,255,255,0.1)"},children:p?l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:16,maxWidth:320},children:[l.jsx("div",{style:{width:200,height:280,backgroundImage:`url(${je(`/cards/${p.id}.png`)})`,backgroundSize:"cover",backgroundPosition:"center",borderRadius:12,boxShadow:"0 8px 30px rgba(0,0,0,0.6)"}}),l.jsx("div",{style:{fontFamily:"var(--font-tamanegi)",fontSize:"1.6rem",color:"white",textShadow:"0 2px 6px rgba(0,0,0,0.6)",textAlign:"center"},children:p.name}),l.jsxs("div",{style:{display:"flex",gap:20,fontSize:"1.2rem",color:"rgba(255,255,255,0.9)"},children:[l.jsxs("span",{children:[": ",p.cost]}),p.type==="FOLLOWER"&&l.jsxs(l.Fragment,{children:[l.jsxs("span",{children:[": ",p.attack]}),l.jsxs("span",{children:[": ",p.health]})]})]}),l.jsx("div",{style:{fontSize:"1rem",color:"rgba(255,255,255,0.7)",textAlign:"center",lineHeight:1.5,maxHeight:120,overflow:"auto"},children:p.description||""}),l.jsx("button",{onClick:()=>f(null),style:{padding:"8px 24px",fontSize:"1rem",background:"transparent",border:"1px solid rgba(255,255,255,0.3)",color:"white",borderRadius:8,cursor:"pointer",marginTop:10},children:""})]}):l.jsx("div",{style:{width:"100%",height:"100%",backgroundImage:`url(${g()})`,backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat",opacity:P>=1?.9:0,transform:P>=1?"scale(1)":"scale(0.95)",transition:"opacity 0.6s ease-out, transform 0.6s ease-out"}})}),l.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:40,position:"relative"},children:[l.jsx("div",{style:{fontFamily:"var(--font-tamanegi)",fontSize:"5rem",color:d?"#f6e05e":"#a0aec0",textShadow:d?"0 0 40px rgba(246, 224, 94, 0.7), 4px 4px 8px rgba(0,0,0,0.6)":"0 0 20px rgba(160, 174, 192, 0.5), 4px 4px 8px rgba(0,0,0,0.6)",marginBottom:20,opacity:P>=2?1:0,transform:P>=2?"translateY(0)":"translateY(30px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out",animation:P>=2?"float 3s ease-in-out infinite":"none"},children:d?"":""}),l.jsxs("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"center",gap:16,marginBottom:30,padding:"16px 24px",background:"rgba(0,0,0,0.3)",borderRadius:12,border:"1px solid rgba(255,255,255,0.1)",opacity:P>=3?1:0,transform:P>=3?"translateY(0)":"translateY(30px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out"},children:[l.jsxs("div",{style:{textAlign:"center",minWidth:80},children:[l.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#f6e05e"},children:u.turnCount}),l.jsx("div",{style:{fontSize:"0.9rem",color:"rgba(255,255,255,0.6)"},children:""})]}),l.jsxs("div",{style:{textAlign:"center",minWidth:80},children:[l.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#48bb78"},children:u.damageDealtToOpponent}),l.jsx("div",{style:{fontSize:"0.9rem",color:"rgba(255,255,255,0.6)"},children:""})]}),l.jsxs("div",{style:{textAlign:"center",minWidth:80},children:[l.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#e53e3e"},children:u.damageReceivedFromOpponent}),l.jsx("div",{style:{fontSize:"0.9rem",color:"rgba(255,255,255,0.6)"},children:""})]}),l.jsxs("div",{style:{textAlign:"center",minWidth:80},children:[l.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#63b3ed"},children:u.followersDestroyed}),l.jsx("div",{style:{fontSize:"0.9rem",color:"rgba(255,255,255,0.6)"},children:""})]})]}),l.jsx("div",{style:{position:"absolute",right:20,bottom:270,width:180,textAlign:"center",fontFamily:"var(--font-tamanegi)",fontSize:"1.4rem",color:d?"#f6e05e":"#e53e3e",textShadow:d?"0 0 20px rgba(246, 224, 94, 0.8), 2px 2px 4px rgba(0,0,0,0.8)":"0 0 20px rgba(229, 62, 62, 0.8), 2px 2px 4px rgba(0,0,0,0.8)",zIndex:10,opacity:P>=5?1:0,transition:"opacity 0.4s ease-out"},children:d?"":""}),E&&!a?l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",animation:"fadeIn 0.3s ease-out"},children:[l.jsx("div",{style:{fontFamily:"var(--font-tamanegi)",fontSize:"1.6rem",color:"white",marginBottom:24,textShadow:"0 2px 6px rgba(0,0,0,0.6)"},children:""}),l.jsxs("div",{style:{display:"flex",gap:40,marginBottom:24},children:[l.jsx(sy,{deckType:"SENKA",label:"",onSelect:J,getStyle:C}),l.jsx(sy,{deckType:"AJA",label:"",onSelect:J,getStyle:C})]}),l.jsx("button",{onClick:()=>O(!1),style:{padding:"10px 36px",fontSize:"1.1rem",fontWeight:"bold",background:"transparent",border:"2px solid rgba(255,255,255,0.3)",color:"white",borderRadius:10,cursor:"pointer",marginTop:8},children:""})]}):l.jsxs("div",{style:{display:"flex",gap:20,opacity:P>=5?1:0,transform:P>=5?"translateY(0)":"translateY(30px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out"},children:[l.jsx("button",{onClick:()=>{a||O(!0)},disabled:a,style:A(),onMouseDown:k=>{a||(k.currentTarget.style.transform="scale(0.95)")},onMouseUp:k=>k.currentTarget.style.transform="scale(1)",children:me()}),l.jsxs("button",{onClick:s,style:{padding:"15px 40px",fontSize:"1.5rem",fontWeight:"bold",background:"transparent",border:"2px solid rgba(255,255,255,0.3)",color:"white",borderRadius:12,cursor:"pointer"},children:[" ",!se&&`(${b})`]})]}),l.jsx("div",{onClick:()=>{E&&!a&&J("YORUKA")},style:{position:"absolute",right:20,bottom:20,width:180,height:240,backgroundImage:`url(${d?ny:ry})`,backgroundSize:"cover",backgroundPosition:"center",borderRadius:12,cursor:E&&!a?"pointer":"default",opacity:P>=5?.7:0,transition:"opacity 0.4s ease",boxShadow:"0 8px 20px rgba(0,0,0,0.4)"}})]})]})},sy=({deckType:t,label:e,onSelect:n,getStyle:r})=>{const[s,i]=M.useState(!1);return l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:12},children:[l.jsx("button",{onClick:()=>n(t),onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),style:r(t,s)}),l.jsx("span",{style:{color:"white",fontFamily:"var(--font-tamanegi)",fontSize:"1.4rem",textShadow:"0 2px 6px rgba(0,0,0,0.6)"},children:e})]})},iy=t=>{const[e,n]=M.useState([]);return M.useEffect(()=>{n(r=>{const s=[],i=new Map((t||[]).filter(o=>o).map(o=>[o.instanceId,o]));return r.forEach(o=>{var c;if(!o)return;const a=i.get(o.instanceId);a?(s.push({...a,passiveAbilities:a.passiveAbilities?[...a.passiveAbilities]:[],hasBarrier:a.hasBarrier??((c=a.passiveAbilities)==null?void 0:c.includes("BARRIER"))??!1,isDying:!1}),i.delete(o.instanceId)):s.push({...o,isDying:!0,killedByBane:o.killedByBane})}),i.forEach(o=>{var a;s.push({...o,passiveAbilities:o.passiveAbilities?[...o.passiveAbilities]:[],hasBarrier:o.hasBarrier??((a=o.passiveAbilities)==null?void 0:a.includes("BARRIER"))??!1,isDying:!1})}),s})},[t]),M.useEffect(()=>{if(e.some(s=>s.isDying)){const s=setTimeout(()=>{n(i=>i.filter(o=>!o.isDying))},700);return()=>clearTimeout(s)}},[e]),e},_w=({playerClass:t,opponentType:e,gameMode:n,targetRoomId:r,onLeave:s,networkAdapter:i,networkConnected:o,opponentClass:a,aiDifficulty:c="NORMAL",playerName:u,timerEnabled:p=!0})=>{var Rg,Ag,Pg,Og,Lg,Dg,Mg,Ng,jg;const f=n==="CPU"||!i,d=Qk(f?n==="CPU"?"CPU":n:"CPU",f?r:void 0),y=i||d.adapter,S=o!==void 0?o:d.connected,P=sw(),{scale:g,toGameX:b,toGameY:x}=P,[E,O]=V.useState(!1);V.useEffect(()=>{(()=>{O("ontouchstart"in window||navigator.maxTouchPoints>0)})()},[]);const Q=V.useCallback((h,v)=>({x:b(h),y:x(v)}),[b,x]),[F,se]=V.useState(null),J=M.useRef(P);V.useEffect(()=>{J.current=P},[P]);const me=n==="CPU"||n==="HOST"||(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&(y==null?void 0:y.isHost)===!0,A=me?"p1":"p2",C=me?"p2":"p1";console.log("[GameScreen INIT]",{gameMode:n,"adapter?.isHost":y==null?void 0:y.isHost,isHost:me,currentPlayerId:A,connected:S,"networkAdapter provided":!!i,networkConnected:o});const k=a||(t==="YORUKA"?Math.random()<.5?"SENKA":"AJA":t==="SENKA"?"AJA":"SENKA"),I=n==="JOIN"||(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&!me,[m,R]=V.useReducer(Wk,null,()=>{const h=n==="CPU"?"CPU":"";return I?ql(h,k,u,t):ql(u,t,h,k)}),[$,L]=V.useState(!I),T=n==="CASUAL_MATCH"||n==="RANKED_MATCH",[B,U]=M.useState(T?!1:!I),[Y,Me]=M.useState(!1),[Je,de]=M.useState(T),[Ue,_e]=M.useState(!1),Le=M.useRef(!1);console.log("[GameScreen SYNC STATE]",{isCasualOrRanked:T,isJoinSide:I,gameSynced:$,waitingForIntroSync:Je,opponentReadyForIntro:Ue,showBattleIntro:B,"introSyncSentRef.current":Le.current});const[fe,Z]=M.useState(!1),[ke,qe]=M.useState(null),[tt,$e]=M.useState(0),[nt,zn]=M.useState({x:0,y:0}),[Ye,mt]=M.useState("IDLE"),[Ne,it]=M.useState(null),[Bt,Dn]=M.useState(!1),[Ct,hn]=M.useState(()=>Math.random()>.5),[Kt,Cn]=M.useState(!1),[Hn,Ba]=M.useState(!1),[vs,Kh]=M.useState(t),[Ua,ro]=M.useState({turnCount:0,damageDealtToOpponent:0,damageReceivedFromOpponent:0,followersDestroyed:0,myFollowersDestroyed:0}),[Ux,xu]=M.useState(null);M.useEffect(()=>{m.winnerId&&!fe&&!Y&&Me(!0)},[m.winnerId,fe,Y]),M.useEffect(()=>{if(tt<=0){zn({x:0,y:0});return}let h;const v=()=>{const _=Date.now()*.03,w=25*tt*g,D=Math.sin(_*7)*w+Math.sin(_*13)*w*.5,z=Math.cos(_*11)*w+Math.cos(_*17)*w*.3;zn({x:D,y:z}),h=requestAnimationFrame(v)};return h=requestAnimationFrame(v),()=>cancelAnimationFrame(h)},[tt,g]);const[Eu,Xh]=M.useState([]),zx=M.useRef(0),[bu,Qh]=M.useState(!1),[Su,za]=M.useState(null),[so,ei]=M.useState(null),gr=M.useRef(null),sr=M.useRef(null),ir=M.useRef(null),Cu=M.useRef(m.logs.length),Ha=V.useRef(!1),Jh=V.useRef(!1),Wa=V.useRef(null);V.useEffect(()=>{const h=n==="HOST"||(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&me,v=T?S&&y:S&&y&&Ye==="DONE";if(console.log("[GameScreen INIT_GAME useEffect]",{isHostSide:h,isCasualOrRanked:T,connected:S,"adapter exists":!!y,coinTossPhase:Ye,canSendInitGame:v,"initialStateSentRef.current":Ha.current}),h&&v&&!Ha.current){console.log("[GameScreen] HOST side: Sending initial game state to JOIN"),Ha.current=!0;const _=()=>{console.log("[GameScreen] HOST side: Actually sending INIT_GAME now, isFirstPlayer:",Ct);const w=T?{...m,firstPlayerId:Ct?"p1":"p2"}:m;y.send({type:"INIT_GAME",payload:w}),(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&(console.log("[GameScreen] HOST side: Sending READY_FOR_INTRO"),y.send({type:"READY_FOR_INTRO"}),Le.current=!0)};setTimeout(_,500),(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&setTimeout(()=>{Ue||(console.log("[GameScreen] HOST side: Retrying INIT_GAME (no response yet)"),_())},2500)}},[n,S,y,m,Ye,me,T,Ue]),V.useEffect(()=>{!T||!y||!$||Le.current||I&&(console.log("[GameScreen] JOIN side: Sending READY_FOR_INTRO after game sync"),y.send({type:"READY_FOR_INTRO"}),Le.current=!0)},[T,y,$,I]),V.useEffect(()=>{!T||!y||!Je||me&&Ue&&Le.current&&(console.log("[GameScreen] HOST side: Both ready, sending START_INTRO"),y.send({type:"START_INTRO"}),de(!1),U(!0))},[T,y,me,Ue,Je]);const ne=m.players[A],Te=m.players[C];V.useEffect(()=>{var v,_;const h=m.logs.length;if(h>Cu.current)for(let w=Cu.current;w<h;w++){const D=m.logs[w],z=D.match(/(.+?)  (\d+) /);if(z){const N=z[1],j=parseInt(z[2],10),H=(ne==null?void 0:ne.name)===N?A:C,re=zx.current++;Xh(X=>[...X,{playerId:H,amount:j,key:re}]),setTimeout(()=>{Xh(X=>X.filter(ue=>ue.key!==re))},1500)}const K=D.match(/(.+?) (?:)?/);if(K){const N=K[1],j=(v=m.players[A])==null?void 0:v.board.find(ue=>(ue==null?void 0:ue.name)===N),H=(_=m.players[C])==null?void 0:_.board.find(ue=>(ue==null?void 0:ue.name)===N),re=j||H,X=j?A:C;if(re){const ue=m.players[X].board.findIndex(Ee=>(Ee==null?void 0:Ee.instanceId)===re.instanceId),Ae=(X===A?or.current:Vn.current)[ue];if(Ae){const Ee=Ae.getBoundingClientRect(),Pe=Ee.left+Ee.width/2,oe=Ee.top+Ee.height/2;el(he=>[...he,{id:Date.now()+Math.random(),value:0,x:Pe,y:oe,color:"#e53e3e"}])}}}}Cu.current=h},[m.logs.length,A,C,ne==null?void 0:ne.name,m.players]);const sn=iy(((Rg=m.players[A])==null?void 0:Rg.board)||[]),Xt=iy(((Ag=m.players[C])==null?void 0:Ag.board)||[]),io=M.useRef(sn),Ga=M.useRef(Xt),[Tu,oo]=M.useState(!1),_s=M.useRef(!1),[xs,Va]=M.useState(null),[Iu,qh]=M.useState(-1),Ya=M.useRef(null),[ti,ao]=M.useState([]),[G,Mr]=M.useState(null),[Xe,Wn]=M.useState(null),[Hx,Zh]=M.useState([]),Wx=M.useRef(0),eg=M.useRef(0),tg=M.useRef(null),ng=M.useRef(G);ng.current=G,M.useEffect(()=>{const h=G==null?void 0:G.sourceType;if(!h||h!=="BOARD"&&h!=="EVOLVE"){Zh([]);return}const v=400,_=setInterval(()=>{const w=ng.current;if(!w||w.sourceType!=="BOARD"&&w.sourceType!=="EVOLVE")return;const D=Date.now(),z=Math.PI*(3-Math.sqrt(5));eg.current+=z+(Math.random()-.5)*.3;const K=eg.current,N=4+Math.random()*3,j={id:Wx.current++,x:w.currentX,y:w.currentY,vx:Math.cos(K)*N,vy:Math.sin(K)*N,opacity:1,radius:3+Math.random()*2,createdAt:D};Zh(H=>[...H.filter(X=>D-X.createdAt<v).map(X=>({...X,x:X.x+X.vx,y:X.y+X.vy,opacity:Math.max(0,1-(D-X.createdAt)/v)})),j])},80);return()=>clearInterval(_)},[G==null?void 0:G.sourceType]),M.useEffect(()=>{const h=(G==null?void 0:G.sourceType)==="EVOLVE";if(h&&!ir.current){const v=new Audio(je("/se/aura.mp3"));v.loop=!0,v.volume=0,v.play().catch(()=>{}),ir.current=v;const _=300,w=30,D=_/w,z=.25/D;let K=0;const N=setInterval(()=>{K++,ir.current&&(ir.current.volume=Math.min(K*z,.25)),K>=D&&clearInterval(N)},w)}else if(!h&&ir.current){const v=ir.current,_=200,w=20,D=_/w,z=v.volume/D;let K=0;const N=setInterval(()=>{K++,v.volume=Math.max(0,v.volume-z),K>=D&&(clearInterval(N),v.pause(),v.currentTime=0)},w);ir.current=null}return()=>{!G&&ir.current&&(ir.current.pause(),ir.current=null)}},[G==null?void 0:G.sourceType]);const[rg,ku]=M.useState(new Set),[sg,Ka]=M.useState(null),[ig,Xa]=M.useState(null),[Gx,og]=M.useState(null),[we,mr]=M.useState(null),wu=M.useCallback(h=>{const v=Er(h);v&&(m.winnerId?xu(v):mr({card:v,owner:"OPPONENT",source:"LOG"}))},[m.winnerId]),Vx=M.useCallback(h=>{const v=/([^]+)/g,_=[];let w=0,D,z=0;const K=$x();for(;(D=v.exec(h))!==null;){D.index>w&&_.push(l.jsx("span",{children:h.slice(w,D.index)},z++));const N=D[1];K.includes(N)?_.push(l.jsxs("span",{style:{color:"#ffd700",cursor:"pointer",textDecoration:"underline",textUnderlineOffset:"2px",fontWeight:"bold"},onMouseEnter:H=>{H.target.style.color="#ffec8b",H.target.style.textShadow="0 0 8px rgba(255, 215, 0, 0.8)"},onMouseLeave:H=>{H.target.style.color="#ffd700",H.target.style.textShadow="none"},onClick:H=>{H.stopPropagation(),wu(N)},children:["",N,""]},z++)):_.push(l.jsxs("span",{children:["",N,""]},z++)),w=D.index+D[0].length}return w<h.length&&_.push(l.jsx("span",{children:h.slice(w)},z++)),_.length>0?l.jsx(l.Fragment,{children:_}):h},[wu]),[Qa,ni]=M.useState([]),Rt=(h,v,_,w)=>{if(!h)return;let D=window.innerWidth/2,z=window.innerHeight/2;const K=v===C;if(_===void 0||_===-1){const j=K?si:bs;if(j.current){const H=j.current.getBoundingClientRect(),re=Q(H.left+H.width/2,H.top+H.height/2);D=re.x,z=re.y}else z=K?150:Bx-250}else if(_!==void 0&&_>=0){const j=K?Vn:or,H=K?Ga.current:io.current;let re=_;if(w){const ue=H.findIndex(xe=>xe&&xe.instanceId===w);ue>=0&&(re=ue)}const X=j.current[re];if(X){const ue=X.getBoundingClientRect(),xe=Q(ue.left+ue.width/2,ue.top+ue.height/2);D=xe.x,z=xe.y}}ni(j=>[...j,{type:h,x:D,y:z,key:Date.now()+Math.random()}])},ag=(h,v,_,w,D)=>{let z=window.innerWidth/2,K=window.innerHeight/2;const N=h===C,j=N?Vn:or,H=N?Ga.current:io.current;let re=v;if(D){const ue=H.findIndex(xe=>xe&&xe.instanceId===D);ue>=0&&(re=ue)}const X=j.current[re];if(X){const ue=X.getBoundingClientRect(),xe=Q(ue.left+ue.width/2,ue.top+ue.height/2);z=xe.x,K=xe.y}ni(ue=>[...ue,{type:"BUFF",x:z,y:K,key:Date.now()+Math.random(),atkBuff:_,hpBuff:w}])},Gn=(h,v,_,w)=>{Rt(h,v,_,w),n==="HOST"&&S&&y&&y.send({type:"EFFECT",payload:{effectType:h,targetPlayerId:v||"",targetIndex:_??-1,targetInstanceId:w}})},lo=(h,v,_,w,D)=>{ag(h,v,_,w,D),n==="HOST"&&S&&y&&y.send({type:"EFFECT",payload:{effectType:"BUFF",targetPlayerId:h,targetIndex:v,targetInstanceId:D,isBuff:!0,atkBuff:_,hpBuff:w}})},lg=M.useRef([]),cg=M.useRef([]);M.useEffect(()=>{var w,D;const h=(z,K,N)=>{K.forEach(j=>{if(!j)return;if(!z.find(re=>re&&re.instanceId===j.instanceId)&&j.killedByBane){const re=N===C,X=re?Vn:or,xe=(re?Ga.current:io.current).findIndex(Ae=>Ae&&Ae.instanceId===j.instanceId);if(xe>=0&&X.current[xe]){const Ee=X.current[xe].getBoundingClientRect(),Pe=Q(Ee.left+Ee.width/2,Ee.top+Ee.height/2);ni(oe=>[...oe,{type:"BANE",x:Pe.x,y:Pe.y,key:Date.now()+Math.random()}])}}})},v=((w=m.players[A])==null?void 0:w.board)||[],_=((D=m.players[C])==null?void 0:D.board)||[];h(v,lg.current,A),h(_,cg.current,C),lg.current=v.map(z=>z?{...z}:null),cg.current=_.map(z=>z?{...z}:null)},[m.players,A,C]);const Ru=600,[Nr,co]=M.useState(null),Au=M.useRef({player:0,opponent:0}),[ct,uo]=M.useState(()=>{try{const h=localStorage.getItem("audioSettings");if(h){const v=JSON.parse(h);if(v.enabled!==void 0){const{enabled:_,...w}=v;return{...w,bgmEnabled:_,seEnabled:_}}return v}return{bgm:.3,se:.5,voice:.5,bgmEnabled:!0,seEnabled:!0}}catch{return{bgm:.3,se:.5,voice:.5,bgmEnabled:!0,seEnabled:!0}}}),ft=M.useCallback((h,v=.5)=>{if(!ct.seEnabled)return;const _=new Audio(je(`/se/${h}`));_.volume=ct.se*v,_.play().catch(w=>console.warn("SE Play prevented",w))},[ct]),Ja=M.useRef(null);M.useEffect(()=>{if(G&&Xe&&!Ja.current)ft("Buon.mp3",.25);else if(G&&Xe&&Ja.current){const h=Ja.current;(h.instanceId!==Xe.instanceId||h.index!==Xe.index||h.playerId!==Xe.playerId)&&ft("Buon.mp3",.25)}Ja.current=Xe},[Xe,G,ft]);const on=M.useRef(null),[Yx,ug]=M.useState(!1);M.useEffect(()=>{localStorage.setItem("audioSettings",JSON.stringify(ct)),on.current&&(on.current.volume=ct.bgmEnabled?ct.bgm:0,ct.bgmEnabled?on.current.paused&&on.current.play().catch(h=>console.warn("Auto-play prevented",h)):on.current.pause())},[ct]);const[Kx,qa]=M.useState(!1),[Xx,Pu]=M.useState(!1),[Qx,Za]=M.useState(!1),Jx=M.useCallback(()=>{console.log("[GameScreen] handleSurrender called"),Za(!1),qa(!1),n!=="CPU"&&y&&y.send({type:"SURRENDER",payload:{playerId:A}}),R({type:"CONCEDE",playerId:A})},[n,y,A]),[yr,Ou]=M.useState(!1),Lu=M.useRef(!1),[dg,fg]=M.useState(!1),[ze,Es]=M.useState(null),ri=M.useRef(null),si=M.useRef(null),Vn=M.useRef([]),or=M.useRef([]),bs=M.useRef(null),[qx,el]=M.useState([]),tl=M.useRef({player:20,opponent:20}),nl=M.useRef({player:0,opponent:0}),fo=M.useRef(new Map);M.useEffect(()=>{var D,z,K,N;if(!ne||!Te)return;const h=tl.current.opponent-Te.hp;h>0&&ro(j=>({...j,damageDealtToOpponent:j.damageDealtToOpponent+h}));const v=tl.current.player-ne.hp;v>0&&ro(j=>({...j,damageReceivedFromOpponent:j.damageReceivedFromOpponent+v}));const _=nl.current.opponent-(((D=Te.board)==null?void 0:D.filter(j=>j).length)||0);_>0&&ro(j=>({...j,followersDestroyed:j.followersDestroyed+_}));const w=nl.current.player-(((z=ne.board)==null?void 0:z.filter(j=>j).length)||0);w>0&&ro(j=>({...j,myFollowersDestroyed:j.myFollowersDestroyed+w})),tl.current={player:ne.hp,opponent:Te.hp},nl.current={player:((K=ne.board)==null?void 0:K.filter(j=>j).length)||0,opponent:((N=Te.board)==null?void 0:N.filter(j=>j).length)||0}},[ne==null?void 0:ne.hp,Te==null?void 0:Te.hp,(Pg=ne==null?void 0:ne.board)==null?void 0:Pg.length,(Og=Te==null?void 0:Te.board)==null?void 0:Og.length]);const Ut=M.useRef(null),pg="lastPlayedBgm",hg=M.useCallback(h=>{const v={AJA:[je("/bgm/Green Misty Mountains.mp3"),je("/bgm/Jade Moon.mp3"),je("/bgm/amaama.mp3"),je("/bgm/kingetsu.mp3")],SENKA:[je("/bgm/ouka.mp3"),je("/bgm/Jade Moon.mp3"),je("/bgm/amaama.mp3"),je("/bgm/kingetsu.mp3")]},_=v[h]||v.SENKA,w=sessionStorage.getItem(pg),D=_.length>1?_.filter(K=>K!==w):_,z=D[Math.floor(Math.random()*D.length)];return sessionStorage.setItem(pg,z),encodeURI(z)},[]),[Du,gg]=M.useState(null);M.useEffect(()=>{var h,v;if(console.log(`[PendingEffects] useEffect fired. isProcessingEffect=${Tu}, pendingEffects.length=${((h=m.pendingEffects)==null?void 0:h.length)||0}, gameMode=${n}`),n==="JOIN"){console.log("[PendingEffects] Early return: JOIN mode waits for EFFECT messages from HOST");return}if(Tu){console.log("[PendingEffects] Early return: isProcessingEffect=true");return}if(m.pendingEffects&&m.pendingEffects.length>0){const _=m.pendingEffects[0];if(console.log(`[PendingEffects] Processing effect: ${_.effect.type} from ${_.sourceCard.name}`),Ya.current===_){console.log("[PendingEffects] Early return: same effect already processed");return}if(Ya.current=_,oo(!0),_s.current=!0,_.effect.type==="GENERATE_CARD"&&_.effect.targetCardId){const ee=[_],le=m.pendingEffects||[];for(let Oe=1;Oe<le.length;Oe++){const Se=le[Oe];if(Se.effect.type==="GENERATE_CARD"&&Se.sourceCard.id===_.sourceCard.id&&Se.sourcePlayerId===_.sourcePlayerId)ee.push(Se);else break}const ye=120,ae=20,W=-(ee.length*ye+(ee.length-1)*ae-ye)/2,te=_.sourcePlayerId===A,Fe=te?window.innerWidth-200*g:200*g,ot=te?window.innerHeight-100*g:100*g,Ie=ee.map((Oe,Se)=>({card:Er(Oe.effect.targetCardId),status:"APPEAR",targetX:Fe,targetY:ot,xOffset:W+Se*(ye+ae)})).filter(Oe=>Oe.card);if(Ie.length>0){ao(Ie),Ut.current&&clearTimeout(Ut.current),Ut.current=setTimeout(()=>{ao(Oe=>Oe.map(Se=>({...Se,status:"FLY"}))),Ut.current=setTimeout(()=>{ao([]),oo(!1),_s.current=!1,(n==="CPU"||n==="HOST")&&(ee.forEach(Oe=>{R({type:"RESOLVE_EFFECT",playerId:Oe.sourcePlayerId,payload:{targetId:Oe.targetId}})}),n==="HOST"&&S&&y&&setTimeout(()=>{const Oe=Be.current;y.send({type:"GAME_STATE",payload:Oe})},50)),Ut.current=null},600)},800);return}}const w=_.effect.type==="DAMAGE"||_.effect.type==="AOE_DAMAGE"||_.effect.type==="RANDOM_DAMAGE"||_.effect.type==="RANDOM_DAMAGE_BY_TURN",D=_.effect.type==="DESTROY"||_.effect.type==="RANDOM_DESTROY",z=_.effect.type==="HEAL_LEADER",K=_.effect.type==="RANDOM_SET_HP",N=_.effect.type==="SET_MAX_HP",j=_.effect.type==="RETURN_TO_HAND",H=_.effect.type==="SUMMON_CARD"||_.effect.type==="SUMMON_CARD_RUSH",re=_.effect.type==="VISUAL_BUFF_ONLY",X=_.effect.type==="BUFF_STATS",ue=z||j||H||re||X?600:50;if(w){let ee=_.sourceCard.attackEffectType||"SLASH";_.sourceCard.id==="c_alice"&&_.effect.targetType==="SELECT_FOLLOWER"&&(ee="WATER");const le=_.sourcePlayerId===A?C:A,ye=le===A?sn:Xt;if(_.effect.type==="AOE_DAMAGE")m.players[le].board.forEach(q=>{if(q){const W=ye.findIndex(te=>(te==null?void 0:te.instanceId)===q.instanceId);W!==-1&&Gn(ee,le,W,q.instanceId)}});else if(_.targetIds)_.effect.type==="RANDOM_DAMAGE_BY_TURN"?_.targetIds.forEach((q,W)=>{setTimeout(()=>{const te=ye.findIndex(Fe=>(Fe==null?void 0:Fe.instanceId)===q);te!==-1&&Gn(ee,le,te,q)},W*300)}):_.targetIds.forEach(ae=>{const q=ye.findIndex(W=>(W==null?void 0:W.instanceId)===ae);q!==-1&&Gn(ee,le,q,ae)});else if(_.effect.targetType==="OPPONENT")Gn(ee,le,-1),Tn();else if(_.targetId){const ae=ye.findIndex(q=>(q==null?void 0:q.instanceId)===_.targetId);ae!==-1&&Gn(ee,le,ae,_.targetId)}}else if(D){let ee=_.sourceCard.attackEffectType||"IMPACT";const le=_.sourcePlayerId===A?C:A,ye=le===A?sn:Xt;if(_.effect.targetType==="ALL_OTHER_FOLLOWERS"){ye.forEach((W,te)=>{W&&W.instanceId!==_.sourceCard.instanceId&&Gn(ee,le,te,W.instanceId)});const ae=_.sourcePlayerId;(ae===A?sn:Xt).forEach((W,te)=>{W&&W.instanceId!==_.sourceCard.instanceId&&Gn(ee,ae,te,W.instanceId)}),Tn()}else if(_.targetIds)_.targetIds.forEach(ae=>{const q=ye.findIndex(W=>(W==null?void 0:W.instanceId)===ae);q!==-1&&Gn(ee,le,q,ae)});else if(_.targetId){const ae=ye.findIndex(q=>(q==null?void 0:q.instanceId)===_.targetId);ae!==-1&&Gn(ee,le,ae,_.targetId)}}else if(z){const ee=_.sourcePlayerId;Gn("HEAL",ee)}else if(N){const ee=_.sourcePlayerId===A?C:A;Gn("RAY",ee,-1),Tn()}if(_.effect.type==="BUFF_STATS"){const ee=_.effect.value??0,le=_.effect.value2??0,ye=_.sourcePlayerId;if(_.effect.targetType==="SELF"){const q=(ye===A?sn:Xt).findIndex(W=>(W==null?void 0:W.instanceId)===_.sourceCard.instanceId);q!==-1&&lo(ye,q,ee,le,_.sourceCard.instanceId)}else if(_.effect.targetType==="ALL_FOLLOWERS"){const ae=ye===A?sn:Xt,q=m.players[ye].board,W=_.effect.conditions;q.forEach(te=>{var Fe;if(te){if(W!=null&&W.tag&&!((Fe=te.tags)!=null&&Fe.includes(W.tag))||W!=null&&W.nameIn&&!W.nameIn.includes(te.name))return;const ot=ae.findIndex(Ie=>(Ie==null?void 0:Ie.instanceId)===te.instanceId);ot!==-1&&lo(ye,ot,ee,le,te.instanceId)}})}else if(_.effect.targetType==="ALL_OTHER_FOLLOWERS"){const ae=ye===A?sn:Xt,q=m.players[ye].board,W=_.effect.conditions;q.forEach(te=>{var Fe;if(te&&te.instanceId!==_.sourceCard.instanceId){if(W!=null&&W.tag&&!((Fe=te.tags)!=null&&Fe.includes(W.tag))||W!=null&&W.nameIn&&!W.nameIn.includes(te.name))return;const ot=ae.findIndex(Ie=>(Ie==null?void 0:Ie.instanceId)===te.instanceId);ot!==-1&&lo(ye,ot,ee,le,te.instanceId)}})}else if(_.targetId){const q=(ye===A?sn:Xt).findIndex(W=>(W==null?void 0:W.instanceId)===_.targetId);q!==-1&&lo(ye,q,ee,le,_.targetId)}}if(re){const ee=_.effect.value??0,le=_.effect.value2??0,ye=_.sourcePlayerId,ae=_.sourceCard;setTimeout(()=>{const q=ye===A?sn:Xt;if(ae!=null&&ae.instanceId){const W=q.findIndex(te=>(te==null?void 0:te.instanceId)===ae.instanceId);W!==-1&&lo(ye,W,ee,le,ae.instanceId)}},300)}Ut.current&&clearTimeout(Ut.current);const Ae=w||D||K||N,Ee=_.effect.type==="RANDOM_DAMAGE_BY_TURN",Pe=Ee?((v=_.targetIds)==null?void 0:v.length)||m.turnCount:1,oe=Ee?Pe*300+300:0,he=Ee?oe:Ae?700:ue,pe=Ee?200:Ae?700:0;Ut.current=setTimeout(()=>{(n==="CPU"||n==="HOST")&&(R({type:"RESOLVE_EFFECT",playerId:_.sourcePlayerId,payload:{targetId:_.targetId}}),n==="HOST"&&S&&y&&setTimeout(()=>{const ee=Be.current;y.send({type:"GAME_STATE",payload:ee})},50)),pe>0?Ut.current=setTimeout(()=>{oo(!1),_s.current=!1,Ut.current=null},pe):(oo(!1),_s.current=!1,Ut.current=null)},he)}else Ya.current=null,Ut.current&&(clearTimeout(Ut.current),Ut.current=null)},[m.pendingEffects,Tu,A,C,n,S,y]),M.useEffect(()=>{if(m.activePlayerId!==A)return;const h=A===m.firstPlayerId,v=m.turnCount,_=h?5:4;if(v===(h?7:6)){if(Iu===v)return;Va("SUPER_EVOLVE_READY"),qh(v),setTimeout(()=>Va(null),2500)}else if(v===_){if(Iu===v)return;Va("EVOLVE_READY"),qh(v),setTimeout(()=>Va(null),2500)}},[m.turnCount,m.activePlayerId,A,Iu,m.firstPlayerId]);const rl=M.useRef(m.players);M.useEffect(()=>{const h=rl.current,v=new Set;if(Object.keys(m.players).forEach(_=>{const w=m.players[_],D=h[_];if(!D)return;const z=new Set(D.board.filter(N=>N).map(N=>N.instanceId)),K=new Set(D.hand.filter(N=>N).map(N=>N.instanceId));w.board.forEach(N=>{if(!N)return;const j=N.instanceId;!z.has(j)&&!K.has(j)&&v.add(j)})}),v.size>0){ku(w=>new Set([...w,...v]));const _=setTimeout(()=>{ku(new Set)},1e3);return()=>clearTimeout(_)}},[m.players]),M.useEffect(()=>{const h=rl.current,v=m.players;let _=[];const w=D=>{const z=D.getBoundingClientRect();return{x:z.left+z.width/2,y:z.top+z.height/2}};Object.keys(v).forEach(D=>{const z=v[D],K=h[D];if(K&&z.hp<K.hp){const N=K.hp-z.hp,H=D===A?bs.current:si.current;if(H){const re=w(H);_.push({id:Date.now()+Math.random(),value:N,x:re.x,y:re.y,color:"#e53e3e"})}}else if(K&&z.hp>K.hp){const N=z.hp-K.hp,H=D===A?bs.current:si.current;if(H){const re=w(H);_.push({id:Date.now()+Math.random(),value:"+"+N,x:re.x,y:re.y,color:"#48bb78"})}}K==null||K.board.forEach(N=>{if(!N)return;const j=z.board.find(H=>(H==null?void 0:H.instanceId)===N.instanceId);if(j){const H=z.board.findIndex(xe=>(xe==null?void 0:xe.instanceId)===j.instanceId),ue=(D===A?or.current:Vn.current)[H];if(ue){const xe=w(ue);if(fo.current.set(N.instanceId,xe),j.currentHealth<N.currentHealth){const Ae=N.currentHealth-j.currentHealth;_.push({id:Date.now()+Math.random(),value:Ae,x:xe.x,y:xe.y,color:"#e53e3e"})}else if(j.currentHealth>N.currentHealth){const Ae=j.hasEvolved&&!N.hasEvolved,Ee=j.currentAttack!==N.currentAttack||j.maxHealth!==N.maxHealth;if(!Ae&&!Ee){const Pe=j.currentHealth-N.currentHealth;_.push({id:Date.now()+Math.random(),value:"+"+Pe,x:xe.x,y:xe.y,color:"#48bb78"})}}else j.currentHealth===N.currentHealth&&N.hasBarrier&&!j.hasBarrier&&_.push({id:Date.now()+Math.random(),value:0,x:xe.x,y:xe.y,color:"#e53e3e"})}}else{const H=z.graveyard.find(X=>X.instanceId===N.instanceId);let re=0;if(H){const X=H.currentHealth||0;X<=0?re=N.currentHealth-X:re=0}else re=N.currentHealth;if(re>0){const X=fo.current.get(N.instanceId);X&&(X.x!==0||X.y!==0)&&_.push({id:Date.now()+Math.random(),value:re,x:X.x,y:X.y,color:"#e53e3e"})}fo.current.delete(N.instanceId)}})}),_.length>0&&(el(z=>[...z,..._]),_.some(z=>z.color!=="#48bb78")&&Tn()),rl.current=v},[m.players,A,C]);const Mu=M.useRef(null),Tn=()=>{Mu.current||(fg(!0),Mu.current=setTimeout(()=>{fg(!1),Mu.current=null},300))},Nu=V.useCallback(h=>{el([]),ni([]),ao([]),kn(null),ii(null),co(null),ku(new Set),jr.current=!1,ju.current=null,ro({turnCount:0,damageDealtToOpponent:0,damageReceivedFromOpponent:0,followersDestroyed:0,myFollowersDestroyed:0}),tl.current={player:20,opponent:20},nl.current={player:0,opponent:0},xu(null),Me(!1),Z(!1),qe(null),Cn(!1),Ba(!1);const v=h||vs;h&&Kh(h);let _=k;e==="CPU"&&(v==="YORUKA"?_=Math.random()<.5?"SENKA":"AJA":_=v==="SENKA"?"AJA":"SENKA");const D=ql(u,v,e==="ONLINE"?"":"CPU",_);rl.current=D.players,Au.current={player:D.players.p1.hand.length,opponent:D.players.p2.hand.length},gg(null),U(n!=="JOIN"),hn(Math.random()>.5),mt("IDLE"),it(null),Dn(!1),n==="HOST"&&(Ha.current=!1),R({type:"SYNC_STATE",payload:D})},[vs,k,e,n]),Zx=V.useCallback(()=>{if(U(!1),it(Ct?"FIRST":"SECOND"),!Ct){const h={...m,activePlayerId:"p2",firstPlayerId:"p2",players:{p1:{...m.players.p1,maxPp:0,pp:0},p2:{...m.players.p2,maxPp:1,pp:1}},logs:[` 1 - ${m.players.p2.name} `]};R({type:"SYNC_STATE",payload:h})}mt("DONE")},[m,Ct]);V.useEffect(()=>{},[m.phase,Ye,n,ft,S]),M.useEffect(()=>{if(Du===ne.class&&on.current)return;const h=hg(ne.class);console.log(`[BGM] Initializing track: ${h} for class: ${ne.class}`),on.current&&(on.current.pause(),on.current=null);const v=new Audio(h);v.loop=!0,v.volume=ct.bgm,on.current=v,gg(ne.class)},[ne.class,hg,Du]),M.useEffect(()=>()=>{on.current&&(console.log("[GameScreen] Stopping BGM on unmount"),on.current.pause(),on.current=null)},[]),M.useEffect(()=>{if(!on.current)return;const h=on.current,v=()=>{h.paused&&ct.bgmEnabled&&(console.log("[BGM] Attempting play on interaction..."),h.play().then(()=>{console.log("[BGM] Play success"),_()}).catch(w=>console.warn("[BGM] Play failed on interaction:",w)))},_=()=>{document.removeEventListener("click",v),document.removeEventListener("keydown",v),document.removeEventListener("touchstart",v)};return ct.bgmEnabled?(document.addEventListener("click",v),document.addEventListener("keydown",v),document.addEventListener("touchstart",v),h.play().then(()=>{console.log("[BGM] Immediate play success"),_()}).catch(()=>console.log("[BGM] Immediate play blocked, waiting for interaction"))):(h.pause(),_()),()=>{_()}},[ct.bgmEnabled,ct.bgm,Du]),V.useEffect(()=>{if(!y){console.log("[GameScreen] Message handler setup skipped - no adapter yet");return}console.log("[GameScreen] Setting up message handler, adapter.isHost:",y.isHost);const h=v=>{var _,w,D,z,K;if(console.log("[GameScreen] Received message:",v.type,v),v.type==="HANDSHAKE"){const N=(_=v.payload)==null?void 0:_.name,j=typeof N=="string"&&N.trim().slice(0,12)||"";console.log("[GameScreen] Received HANDSHAKE from opponent:",j),Wa.current=j,R({type:"UPDATE_PLAYER_NAME",payload:{playerId:A==="p1"?"p2":"p1",name:j}});return}if(v.type==="INIT_GAME"){console.log("[GameScreen] JOIN side: Received initial game state from HOST"),R({type:"SYNC_STATE",payload:v.payload}),R({type:"UPDATE_PLAYER_NAME",payload:{playerId:A,name:u}});const N=A==="p1"?"p2":"p1";Wa.current&&(console.log("[GameScreen] Re-applying opponent name after INIT_GAME:",Wa.current),R({type:"UPDATE_PLAYER_NAME",payload:{playerId:N,name:Wa.current}})),L(!0);const j=v.payload.firstPlayerId===A;console.log("[GameScreen] JOIN side: Setting isFirstPlayer, firstPlayerId:",v.payload.firstPlayerId,"currentPlayerId:",A,"isJoinSideFirst:",j),hn(j),n==="CASUAL_MATCH"||n==="RANKED_MATCH"?console.log("[GameScreen] CASUAL_MATCH JOIN side: Waiting for intro sync"):U(!0);return}if(v.type==="READY_FOR_INTRO"){console.log("[GameScreen] Received READY_FOR_INTRO from opponent"),_e(!0);return}if(v.type==="START_INTRO"){console.log("[GameScreen] Received START_INTRO - starting BattleIntro now"),de(!1),U(!0);return}if(v.type==="GAME_STATE"){console.log("[GameScreen] JOIN: Received GAME_STATE sync from HOST"),R({type:"SYNC_STATE",payload:v.payload}),oo(!1),_s.current=!1,Ya.current=null,ao([]),Ut.current&&(clearTimeout(Ut.current),Ut.current=null),!ho.current&&!ai.current&&(Qt.current=!1);return}if(v.type==="EFFECT"){const{effectType:N,targetPlayerId:j,targetIndex:H,targetInstanceId:re,isBuff:X,atkBuff:ue,hpBuff:xe}=v.payload;console.log("[GameScreen] JOIN: Received EFFECT from HOST:",N,j,H,re),setTimeout(()=>{X&&ue!==void 0&&xe!==void 0?ag(j,H,ue,xe,re):Rt(N,j,H,re)},50);return}if(v.type==="EVOLVE_ANIM"){const{playerId:N,followerIndex:j,useSep:H,targetId:re,instanceId:X}=v.payload,ue=(w=m.players[N])==null?void 0:w.board[j];if(ue){const xe=ue.evolvedImageUrl||((D=Er(ue.id))==null?void 0:D.evolvedImageUrl),Ae=X||ue.instanceId,Ee=Xt.findIndex(le=>le&&le.instanceId===Ae),Pe=Ee>=0?Vn.current[Ee]:null,oe=J.current.scale,he=window.innerHeight/2;let pe=window.innerWidth/2,ee=he-70*oe;if(Pe){const le=Pe.getBoundingClientRect();pe=le.left+le.width/2,ee=le.top+le.height/2}ii({card:ue,evolvedImageUrl:xe,startX:pe,startY:ee,phase:"ZOOM_IN",followerIndex:j,sourcePlayerId:N,useSep:H||!1,targetId:re,isRemote:!0}),ft("fon.mp3",.7)}return}if(v.type==="PLAY_CARD_ANIM"){const{playerId:N,card:j,targetBoardIndex:H}=v.payload;if(j){const re=((z=m.players[N])==null?void 0:z.board)||[],X=typeof H=="number"?H:re.filter(W=>W!==null).length,ue=J.current.scale,xe=window.innerWidth/2,Ae=window.innerHeight/2,Ee=xe,Pe=80*ue,oe=xe,he=Ae-100*ue,ye=-((Math.max(1,X+1)-1)*Cs*ue)/2+X*Cs*ue,ae=xe+ye,q=Ae-70*ue;j.type==="SPELL"?kn({card:j,sourceIndex:-1,startX:Ee,startY:Pe,targetX:oe,targetY:he,playerClass:(Te==null?void 0:Te.class)||"SENKA",onComplete:()=>{kn(null)}}):kn({card:j,sourceIndex:-1,startX:Ee,startY:Pe,targetX:oe,targetY:he,finalX:ae,finalY:q,playerClass:(Te==null?void 0:Te.class)||"SENKA",onComplete:()=>{ft("gan.mp3",.6),Tn(),kn(null)}})}return}if(v.type==="REMATCH_REQUEST"){console.log("[GameScreen] Opponent requested rematch"),Ba(!0);return}if(v.type==="REMATCH_ACCEPT"){console.log("[GameScreen] Opponent accepted rematch - starting new game"),Nu(vs);return}if(v.type==="SURRENDER"){const N=(K=v.payload)==null?void 0:K.playerId;if(m.phase==="GAME_OVER"){console.warn("[GameScreen] Ignoring SURRENDER - game already over");return}if(N===A){console.warn(`[GameScreen] Security Alert: Received SURRENDER message targeting self (${A}). Ignoring.`);return}if(N!==C){console.warn(`[GameScreen] Security Alert: Invalid playerId in SURRENDER: ${N}. Expected: ${C}. Ignoring.`);return}console.log("[GameScreen] Opponent surrendered:",N),R({type:"CONCEDE",playerId:N});return}if(v.type==="STAMP"){console.log("[GameScreen] Opponent sent stamp:",v.stampId),sr.current&&(clearTimeout(sr.current),sr.current=null);const N=Jm(v.stampId);N&&ft(N,.6);const j={stampId:v.stampId,playerId:C,playerClass:v.playerClass||(Te==null?void 0:Te.class)||"SENKA",timestamp:Date.now()};ei(null),requestAnimationFrame(()=>{ei(j)}),sr.current=setTimeout(()=>{ei(H=>(H==null?void 0:H.timestamp)===j.timestamp?null:H),sr.current=null},3e3);return}if(v.type==="ACTION"){const N=v.payload;if(console.log("[GameScreen] Processing remote action:",N.type,"from player:",N.playerId),R({...N,isRemote:!0}),N.type==="ATTACK"){const{playerId:j,payload:H}=N,re=m.players[j],X=re==null?void 0:re.board[H.attackerIndex],ue=H.targetIsLeader?-1:H.targetIndex,xe=j==="p1"?"p2":"p1";if(X){const Ae=m.players[xe],Ee=H.targetIsLeader?null:Ae==null?void 0:Ae.board[H.targetIndex],Pe=Ee?Ee.instanceId:void 0;Rt(X.attackEffectType,xe,ue,Pe)}}else N.type==="PLAY_CARD"||N.type==="EVOLVE"||N.type==="END_TURN"&&(console.log("[GameScreen] Remote END_TURN received, turn switching to:",N.playerId==="p1"?"p2":"p1"),oi.current=!1)}};return y.onMessage(h),n!=="CPU"&&!Jh.current&&(Jh.current=!0,y.send({type:"HANDSHAKE",payload:{name:u,class:t}}),console.log("[GameScreen] Sent HANDSHAKE:",u,t)),y.onClose(()=>{if((n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&m.phase==="GAME_OVER"){console.log("[GameScreen] Connection closed after game over (casual match) - silent disconnect");return}if(n!=="CPU"&&m.phase!=="GAME_OVER"){console.log("[GameScreen] Opponent disconnected during game - treating as surrender, player wins");const v={...m,phase:"GAME_OVER",winnerId:A,logs:[...m.logs,""]};R({type:"SYNC_STATE",payload:v});return}alert(`
`),s()}),()=>{}},[y,m,ft,Rt,n,s,A]);const jr=M.useRef(!1),ju=M.useRef(null),In=M.useRef(null),[De,kn]=M.useState(null),[yt,ii]=M.useState(null),Qt=M.useRef(!1),po=M.useRef(null),oi=M.useRef(!1),Fu=M.useRef(Qa),$u=M.useRef(ti),ho=M.useRef(De),ai=M.useRef(yt);V.useEffect(()=>{Fu.current=Qa,$u.current=ti,ho.current=De,ai.current=yt},[Qa,ti,De,yt]),V.useEffect(()=>{if(De&&De.card.name===""&&ct.seEnabled){const h=new Audio(je("/se/beam.mp3"));h.volume=ct.se*.8,h.play().catch(v=>console.warn("SE Play prevented",v))}},[De,ct]),V.useEffect(()=>{io.current=sn,Ga.current=Xt},[sn,Xt]),V.useEffect(()=>{const h=v=>{const _=v.getBoundingClientRect();return{x:_.left+_.width/2,y:_.top}};sn.forEach((v,_)=>{if(v&&v.instanceId){const w=or.current[_];if(w){const D=h(w);(D.x!==0||D.y!==0)&&fo.current.set(v.instanceId,D)}}}),Xt.forEach((v,_)=>{if(v&&v.instanceId){const w=Vn.current[_];if(w){const D=h(w);(D.x!==0||D.y!==0)&&fo.current.set(v.instanceId,D)}}})},[sn,Xt]);const sl=(h,v,_,w)=>{const D=ar.current.board,z=w?D.findIndex(X=>X&&X.instanceId===w):h,K=z>=0?D[z]:null;if(!K)return;if(K.hasEvolved){console.log("[GameScreen] Cannot evolve: card already evolved");return}const N=or.current[h];let j=window.innerWidth/2,H=window.innerHeight/2;if(N){const X=N.getBoundingClientRect();j=X.left+X.width/2,H=X.top+X.height/2}const re=K.instanceId;n!=="CPU"&&S&&y&&y.send({type:"EVOLVE_ANIM",payload:{playerId:A,followerIndex:z,useSep:v,targetId:_,instanceId:re}}),ii({card:K,evolvedImageUrl:K.evolvedImageUrl,startX:j,startY:H,phase:"ZOOM_IN",followerIndex:z,useSep:v,targetId:_,sourcePlayerId:A}),ft("fon.mp3",.7)},Bu=M.useRef(null),eE=M.useCallback(h=>{if(console.log("[GameScreen] handleEvolvePhaseChange:",h),h==="WHITE_FADE"&&ft("fon.mp3",.7),h==="LAND"&&ft("gan.mp3",.6),h==="DONE"){const v=ai.current;if(v&&!v.isRemote){const w={type:"EVOLVE",playerId:v.sourcePlayerId||A,payload:{followerIndex:v.followerIndex,useSep:v.useSep,targetId:v.targetId}};R(w),y&&n!=="CPU"&&y.send({type:"ACTION",payload:w})}ii(null)}else ii(v=>v?{...v,phase:h}:null)},[y,R,n,A,ft]),Uu=(h,v,_)=>{var pe,ee,le,ye,ae,q;const D=ar.current.hand[h];if(!D){console.warn("[handlePlayCard] Card not found at index:",h);return}if(D.instanceId&&po.current===D.instanceId){console.warn("[handlePlayCard] Duplicate play blocked for instanceId:",D.instanceId);return}if(Qt.current){console.warn("[handlePlayCard] Card play locked, ignoring duplicate call");return}Qt.current=!0,po.current=D.instanceId||null,ft("card.mp3",.5);const z=(pe=D.triggers)==null?void 0:pe.find(W=>W.trigger==="FANFARE"),K=z==null?void 0:z.effects[0];let N=C;const j=(K==null?void 0:K.targetType)==="SELECT_ALLY_FOLLOWER"||(K==null?void 0:K.targetType)==="SELECT_OTHER_ALLY_FOLLOWER";K&&(j||["GRANT_PASSIVE","BUFF_STATS","HEAL_FOLLOWER"].includes(K.type))&&(N=A);const H=["SELECT_FOLLOWER","SELECT_ALLY_FOLLOWER","SELECT_OTHER_ALLY_FOLLOWER"],re=D.type==="SPELL"&&((ee=D.triggers)==null?void 0:ee.some(W=>W.effects.some(te=>te.targetType&&H.includes(te.targetType))))||D.type==="FOLLOWER"&&(((ye=(le=D.triggerAbilities)==null?void 0:le.FANFARE)==null?void 0:ye.targetType)&&H.includes(D.triggerAbilities.FANFARE.targetType)||((ae=D.triggers)==null?void 0:ae.some(W=>W.trigger==="FANFARE"&&W.effects.some(te=>te.targetType&&H.includes(te.targetType))))),ue=Be.current.players[N].board.some(W=>{var te,Fe;return W&&(N===A||!((te=W.passiveAbilities)!=null&&te.includes("STEALTH"))&&!((Fe=W.passiveAbilities)!=null&&Fe.includes("AURA")))});if(console.log(`[handlePlayCard] needsTarget: ${re}, allowedTarget: ${N}, hasValidTargets: ${ue}`),re&&ue){Es({type:"PLAY",sourceIndex:h,sourceInstanceId:D.instanceId,allowedTargetPlayerId:N}),Mr(null);return}const xe=window.innerWidth/2,Ae=window.innerHeight/2;let Ee,Pe;if(D.type==="FOLLOWER"){const te=Be.current.players[A].board.filter(We=>We!==null),Fe=te.length+1,ot=te.length,Ie=Cs*g,Oe=(ot-(Fe-1)/2)*Ie,Se=(q=ri.current)==null?void 0:q.getBoundingClientRect();Ee=(Se?Se.left+Se.width/2:window.innerWidth/2)+Oe,Pe=window.innerHeight/2+70*g}const oe=()=>{D.type!=="SPELL"&&(ft("gan.mp3",.6),Tn()),Fr({type:"PLAY_CARD",playerId:A,payload:{cardIndex:h,instanceId:D.instanceId}}),kn(null),setTimeout(()=>{Qt.current=!1},100)},he=D.type==="FOLLOWER"?Be.current.players[A].board.filter(W=>W!==null).length:void 0;n!=="CPU"&&S&&y&&y.send({type:"PLAY_CARD_ANIM",payload:{playerId:A,cardIndex:h,card:D,targetBoardIndex:he}}),kn({card:D,sourceIndex:h,startX:v,startY:_,targetX:xe,targetY:Ae,finalX:Ee,finalY:Pe,playerClass:(ne==null?void 0:ne.class)||"SENKA",onComplete:oe}),setTimeout(()=>{kn(W=>(W==null?void 0:W.card.id)===D.id?(oe(),null):W)},2e3)},Fr=h=>{R(h),n!=="CPU"&&S&&!h.isRemote&&(y==null||y.send({type:"ACTION",payload:h}))};M.useEffect(()=>{if(!yt&&Bu.current){const h=Bu.current;Bu.current=null,console.log("[GameScreen] Dispatching pending evolve action for:",h.playerId),Fr({type:"EVOLVE",playerId:h.playerId,payload:{followerIndex:h.followerIndex,useSep:h.useSep,targetId:h.targetId}})}},[yt,A,Fr]);const ar=M.useRef(ne),Be=M.useRef(m);M.useEffect(()=>{ar.current=ne,Be.current=m},[ne,m]);const Yn=M.useRef(!1);M.useEffect(()=>{const h=Au.current,v=ne.hand.length,_=Te.hand.length;if(v>h.player){const w=v-h.player;co({isPlayer:!0,count:w}),ft("card.mp3",.5),setTimeout(()=>co(null),Ru)}if(_>h.opponent){const w=_-h.opponent;co({isPlayer:!1,count:w}),ft("card.mp3",.5),setTimeout(()=>co(null),Ru)}Au.current={player:v,opponent:_}},[ne.hand.length,Te.hand.length,ct,ft]),V.useEffect(()=>{m.activePlayerId===A&&(console.log("[GameScreen] Player turn started - resetting card play lock and ending turn state"),Qt.current=!1,po.current=null,oi.current=!1)},[m.activePlayerId,m.turnCount,A]),V.useEffect(()=>{if(n==="CPU")return;const h=setInterval(()=>{Qt.current&&!ho.current&&!ai.current&&!ze&&m.activePlayerId===A&&(console.warn("[GameScreen] Safety release: Card play lock was stuck, releasing"),Qt.current=!1)},3e3);return()=>clearInterval(h)},[n,ze,m.activePlayerId,A]),V.useEffect(()=>{if(n!=="CPU")return;if(m.winnerId){jr.current=!1;return}const h=`${m.turnCount}-${m.activePlayerId}`;if(m.activePlayerId===A){jr.current=!1;return}if(m.activePlayerId===C){if(jr.current||ju.current===h)return;(async()=>{var ue,xe,Ae,Ee,Pe;jr.current=!0,ju.current=h;const _=async(oe=300)=>{await new Promise(ee=>setTimeout(ee,oe));const he=()=>{const ee=Be.current,le=ee.pendingEffects&&ee.pendingEffects.length>0,ye=Fu.current.length>0,ae=$u.current.length>0,q=ho.current!==null,W=ai.current!==null;return!le&&!ye&&!ae&&!q&&!W};let pe=0;for(;!he()&&pe<60;){await new Promise(le=>setTimeout(le,100)),pe++;const ee=Be.current;if(ee.pendingEffects&&ee.pendingEffects.length>0&&!_s.current){console.log("[waitForIdle] Forcing RESOLVE_EFFECT for stuck pending effect");const le=ee.pendingEffects[0];R({type:"RESOLVE_EFFECT",playerId:le.sourcePlayerId,payload:{targetId:le.targetId}}),await new Promise(ye=>setTimeout(ye,200))}}},w=(oe,he)=>{var pe;return oe?!!((pe=oe.passiveAbilities)!=null&&pe.includes("IMMUNE_TO_FOLLOWER_DAMAGE")):!1},D=(oe,he)=>{var pe;return!he||!oe?!1:(pe=he.passiveAbilities)!=null&&pe.includes("BANE")&&!oe.hasBarrier?!0:(he.currentAttack||0)>=oe.currentHealth},z=(oe,he)=>{var pe;return!he||!oe?!1:(pe=oe.passiveAbilities)!=null&&pe.includes("BANE")?!he.hasBarrier:oe.currentAttack>=he.currentHealth},K=(oe,he)=>{var ae,q;let pe=oe.cost*10;const ee=he.players[A].board.filter(W=>W!==null),le=he.players[C].board.filter(W=>W!==null);if(ee.length>0){const W=oe.triggers||[];for(const te of W)if(te.trigger==="FANFARE")for(const Fe of te.effects||[])["DESTROY","RANDOM_DESTROY","DAMAGE","SELECT_DAMAGE","AOE_DAMAGE"].includes(Fe.type)&&(pe+=30)}const ye=he.players[A].hp;return(ae=oe.passiveAbilities)!=null&&ae.includes("STORM")&&ye<=10&&(pe+=50),oe.type==="FOLLOWER"&&le.length>=5&&(pe-=100),(q=oe.passiveAbilities)!=null&&q.includes("WARD")&&ee.length>0&&(pe+=20),pe},N=(oe,he,pe,ee)=>{let le=0;const ye=pe.players[A].board.filter(q=>q!==null),ae=oe.triggers||[];for(const q of ae){const W=ee?"SUPER_EVOLVE":"EVOLVE";if(q.trigger===W)for(const te of q.effects||[])["DESTROY","RANDOM_DESTROY","DAMAGE","SELECT_DAMAGE","AOE_DAMAGE"].includes(te.type)&&(le+=ye.length>0?50:10),["SUMMON_CARD","SUMMON_CARD_RUSH"].includes(te.type)&&(le+=40),te.type==="BUFF_STATS"&&(le+=30),te.type==="DRAW"&&(le+=25),te.type==="GENERATE_CARD"&&(le+=20)}return oe.canAttack&&(le+=20),le+=(oe.currentAttack||0)*3,le},j=(oe,he,pe)=>{var q,W,te,Fe,ot;const ee=((q=oe.passiveAbilities)==null?void 0:q.includes("STORM"))||oe.turnPlayed!==pe.turnCount,le=he.map((Ie,Oe)=>({c:Ie,i:Oe})).filter(({c:Ie})=>{var Oe,Se;return Ie!==null&&!((Oe=Ie.passiveAbilities)!=null&&Oe.includes("STEALTH"))&&!((Se=Ie.passiveAbilities)!=null&&Se.includes("AURA"))});if(!(((W=oe.passiveAbilities)==null?void 0:W.includes("STEALTH"))||oe.hadStealth)){const Ie=le.find(({c:Oe})=>{var Se;return(Se=Oe.passiveAbilities)==null?void 0:Se.includes("WARD")});if(Ie)return w(Ie.c)?{index:-1,isLeader:!1}:{index:Ie.i,isLeader:!1}}let ae={index:-1,isLeader:ee,score:ee?0:-1e3};for(const{c:Ie,i:Oe}of le){if(w(Ie))continue;let Se=0;const at=oe.isEvolved,We=(te=Ie.passiveAbilities)==null?void 0:te.includes("BANE"),ge=D(oe,Ie);z(oe,Ie)?(Se+=50,Se+=(Ie.currentAttack||0)*5,ge?We&&at?Se-=60:We&&(Se-=30):Se+=30,We&&!ge&&(Se+=40),(Fe=Ie.passiveAbilities)!=null&&Fe.includes("STORM")&&(Se+=30),(ot=Ie.passiveAbilities)!=null&&ot.includes("DOUBLE_ATTACK")&&(Se+=35)):!ge&&oe.currentAttack>=Ie.currentHealth/2?Se+=10:ge&&(Se-=50,at&&(Se-=40),(Ie.currentAttack||0)>=5&&(Se+=10)),Se>ae.score&&(ae={index:Oe,isLeader:!1,score:Se})}return ee&&(ae.index===-1||ae.score<=0)?{index:-1,isLeader:!0}:ae},H=c==="EASY"?1200:c==="HARD"?400:800;if(await new Promise(oe=>setTimeout(oe,H)),!jr.current)return;let re=0;const X=c==="EASY"?1:c==="HARD"?5:3;for(;re<X;){const oe=Be.current,he=oe.players[C].hand,pe=oe.players[C].pp,le=oe.players[C].board.filter(We=>We!==null).length>=5;let ye=he.map((We,ge)=>({...We,originalIndex:ge})).filter(We=>We.cost<=pe).filter(We=>!(We.type==="FOLLOWER"&&le));if(ye.length===0||(c==="HARD"?ye=ye.sort((We,ge)=>K(ge,oe)-K(We,oe)):ye=ye.sort((We,ge)=>ge.cost-We.cost),c==="EASY"&&Math.random()<.3&&re>0))break;const ae=ye[0];let q;const te=oe.players[A].board.filter(We=>{var ge,Ce;return We&&!((ge=We.passiveAbilities)!=null&&ge.includes("STEALTH"))&&!((Ce=We.passiveAbilities)!=null&&Ce.includes("AURA"))});te.length>0&&(c==="HARD"?q=[...te].sort((ge,Ce)=>{var gn,ci;let Qe=(ge.currentAttack||0)+(ge.currentHealth||0),vt=(Ce.currentAttack||0)+(Ce.currentHealth||0);return(gn=ge.passiveAbilities)!=null&&gn.includes("BANE")&&(Qe+=10),(ci=Ce.passiveAbilities)!=null&&ci.includes("BANE")&&(vt+=10),vt-Qe})[0].instanceId:q=te[0].instanceId);const Fe=window.innerWidth-20*g-80*g/2,ot=20*g+110*g/2,Ie=window.innerWidth/2,Oe=window.innerHeight/2;let Se,at;if(ae.type==="FOLLOWER"){const ge=Be.current.players[C].board.filter(fE=>fE!==null),Ce=ge.length+1,Qe=ge.length,vt=Cs*g,gn=(Qe-(Ce-1)/2)*vt,ci=(ue=ri.current)==null?void 0:ue.getBoundingClientRect();Se=(ci?ci.left+ci.width/2:window.innerWidth/2)+gn,at=window.innerHeight/2-70*g}kn({card:ae,sourceIndex:-1,startX:Fe,startY:ot,targetX:Ie,targetY:Oe,finalX:Se,finalY:at,playerClass:(Te==null?void 0:Te.class)||"SENKA",onComplete:()=>{if(ae.type!=="SPELL"&&(ft("gan.mp3",.6),Tn()),R({type:"PLAY_CARD",playerId:C,payload:{cardIndex:ae.originalIndex,targetId:q,instanceId:ae.instanceId}}),ae.id==="c_amandava"&&Be.current.players[A].board.forEach((ge,Ce)=>{if(ge){const Qe=ge.instanceId;setTimeout(()=>{Rt("SHOT",A,Ce,Qe)},200)}}),ae.id==="c_azya"){if(setTimeout(()=>{Rt("THUNDER",A,-1)},200),q){const ge=Be.current.players[A].board.findIndex(Ce=>(Ce==null?void 0:Ce.instanceId)===q);ge!==-1&&setTimeout(()=>{Rt("ICE",A,ge,q)},400)}setTimeout(()=>{const We=Be.current.players[A].board,ge=We.filter(Ce=>Ce!==null);if(ge.length>0){const Ce=ge[Math.floor(Math.random()*ge.length)],Qe=We.findIndex(vt=>(vt==null?void 0:vt.instanceId)===(Ce==null?void 0:Ce.instanceId));Qe!==-1&&Rt("WATER",A,Qe,Ce==null?void 0:Ce.instanceId)}},600)}kn(null)}}),await _(600),re++}{const oe=Be.current,he=oe.players[C],pe=C===oe.firstPlayerId,ee=oe.turnCount,le=ty(he,ee,pe);if((ey(he,ee,pe)||le)&&he.board.length>0){const ae=he.board.map((q,W)=>({c:q,i:W})).filter(({c:q})=>q&&q.type==="FOLLOWER"&&!q.hasEvolved);if(ae.length>0){let q;const W=le;if(c==="EASY")q=ae[Math.floor(Math.random()*ae.length)];else{const Oe=ae.map(({c:Se,i:at})=>({c:Se,i:at,score:N(Se,at,oe,W)}));Oe.sort((Se,at)=>at.score-Se.score),q=Oe[0]}let te;const ot=oe.players[A].board.filter(Oe=>{var Se,at;return Oe!==null&&!((Se=Oe.passiveAbilities)!=null&&Se.includes("STEALTH"))&&!((at=Oe.passiveAbilities)!=null&&at.includes("AURA"))});ot.length>0&&(c==="HARD"?te=[...ot].sort((Se,at)=>{let We=(Se.currentAttack||0)+(Se.currentHealth||0);return(at.currentAttack||0)+(at.currentHealth||0)-We})[0].instanceId:te=ot[0].instanceId);const Ie=(xe=Vn.current[q.i])==null?void 0:xe.getBoundingClientRect();Ie?(ii({card:q.c,evolvedImageUrl:q.c.evolvedImageUrl,startX:Ie.left+Ie.width/2,startY:Ie.top+Ie.height/2,useSep:W,phase:"ZOOM_IN",followerIndex:q.i,sourcePlayerId:C,targetId:te}),await _(800)):(Fr({type:"EVOLVE",playerId:C,payload:{followerIndex:q.i,useSep:W,targetId:te}}),await _(400))}}}{let oe=!0,he=0;for(;oe&&he<15;){if(Be.current.winnerId){oe=!1;break}he++;const pe=Be.current,ee=pe.players[C].board,le=pe.players[A].board;let ye=!1;for(let ae=0;ae<ee.length;ae++){const q=ee[ae];if(!q||!q.canAttack)continue;let W=-1,te=!0;const Fe=((Ae=q.passiveAbilities)==null?void 0:Ae.includes("STEALTH"))||q.hadStealth,ot=Fe?-1:le.findIndex(ge=>{var Ce,Qe;return ge&&((Ce=ge.passiveAbilities)==null?void 0:Ce.includes("WARD"))&&!((Qe=ge.passiveAbilities)!=null&&Qe.includes("STEALTH"))&&!w(ge)});if(ot!==-1)W=ot,te=!1;else if(c==="EASY"){const ge=le.map((Qe,vt)=>({c:Qe,idx:vt})).filter(({c:Qe})=>{var vt,gn;return Qe&&!((vt=Qe.passiveAbilities)!=null&&vt.includes("STEALTH"))&&!((gn=Qe.passiveAbilities)!=null&&gn.includes("AURA"))&&!w(Qe)}),Ce=((Ee=q.passiveAbilities)==null?void 0:Ee.includes("STORM"))||q.turnPlayed!==pe.turnCount;if(!Ce&&ge.length>0)W=ge[Math.floor(Math.random()*ge.length)].idx,te=!1;else{if(!Ce&&ge.length===0)continue;Ce&&ge.length>0&&Math.random()<.5&&(W=ge[Math.floor(Math.random()*ge.length)].idx,te=!1)}}else{const ge=j(q,le,pe);if(W=ge.index,te=ge.isLeader,W===-1&&!te)continue}const Ie=(Pe=q.passiveAbilities)==null?void 0:Pe.includes("STORM"),Oe=q.turnPlayed===pe.turnCount;if(!Ie&&Oe&&te){const ge=le.map((Ce,Qe)=>({c:Ce,idx:Qe})).filter(({c:Ce})=>{var Qe,vt;return Ce&&!((Qe=Ce.passiveAbilities)!=null&&Qe.includes("STEALTH"))&&!((vt=Ce.passiveAbilities)!=null&&vt.includes("AURA"))&&!w(Ce)});if(ge.length>0){const Ce=Fe?null:ge.find(({c:Qe})=>{var vt;return(vt=Qe.passiveAbilities)==null?void 0:vt.includes("WARD")});Ce?W=Ce.idx:W=ge[0].idx,te=!1}else continue}const Se=te?null:le[W],at=Se?Se.instanceId:void 0,We=q.instanceId;if(We&&(Ka(We),setTimeout(()=>Ka(null),300)),Rt(q.attackEffectType||"SLASH",A,te?-1:W,at),!te&&W>=0){const ge=le[W];if(ge&&(ge.currentAttack||0)>0){const Ce=ge.instanceId;setTimeout(()=>{Ce&&(Xa(Ce),setTimeout(()=>Xa(null),300)),Rt(ge.attackEffectType||"SLASH",C,ae,We)},200)}}ye=!0,await _(1e3),R({type:"ATTACK",playerId:C,payload:{attackerIndex:ae,targetIndex:W,targetIsLeader:te}}),await _(1e3);break}ye||(oe=!1)}}if(await _(300),Be.current.winnerId){jr.current=!1;return}R({type:"END_TURN",playerId:C}),jr.current=!1})()}},[m.activePlayerId,m.turnCount,n,m.phase,c,m.winnerId]);const mg=(h,v)=>{if(In.current||De||ti.length>0)return;const _=ne.hand[v];h.stopPropagation();const w="touches"in h?h.touches[0].clientX:h.clientX,D="touches"in h?h.touches[0].clientY:h.clientY,z=h.currentTarget.getBoundingClientRect();if(!yr){Ou(!0),mr({card:_,owner:"PLAYER",source:"HAND"}),Lu.current=!0;return}if(mr({card:_,owner:"PLAYER",source:"HAND"}),m.activePlayerId!==A)return;if(Qt.current){console.warn("[handleHandMouseDown] Card play in progress, blocking drag start");return}const K=Be.current;if(K.pendingEffects&&K.pendingEffects.length>0){console.log("UI: Card play drag blocked - pendingEffects still processing");return}const N={sourceType:"HAND",sourceIndex:v,sourceInstanceId:_.instanceId,startX:z.left+z.width/2,startY:z.top+z.height/2,currentX:w,currentY:D,offsetX:0,offsetY:0,canDrag:!0};Mr(N),In.current=N},yg=(h,v,_)=>{h.stopPropagation();const w="touches"in h?h.touches[0].clientX:h.clientX,D="touches"in h?h.touches[0].clientY:h.clientY,z=Be.current,K=z.players[A].board,N=_?K.findIndex(H=>H&&H.instanceId===_):v,j=N>=0?K[N]:null;if(ze&&ze.allowedTargetPlayerId===A&&j){zu("FOLLOWER",N,A,_);return}if(j&&mr({card:j,owner:"PLAYER",source:"BOARD"}),z.pendingEffects&&z.pendingEffects.length>0){console.log("UI: Attack drag blocked - pendingEffects still processing");return}if(z.activePlayerId===A&&(j!=null&&j.canAttack)){const H=h.currentTarget.getBoundingClientRect(),re={x:H.left+H.width/2,y:H.top+H.height/2},X={sourceType:"BOARD",sourceIndex:N,sourceInstanceId:j.instanceId,startX:re.x,startY:re.y,currentX:w,currentY:D,offsetX:0,offsetY:0};Mr(X),In.current=X}},il=(h,v=!1)=>{if(m.activePlayerId!==A)return;h.stopPropagation();const _="touches"in h?h.touches[0].clientX:h.clientX,w="touches"in h?h.touches[0].clientY:h.clientY,D=Be.current;if(D.pendingEffects&&D.pendingEffects.length>0){console.log("UI: Evolve drag blocked - pendingEffects still processing");return}const z=A===m.firstPlayerId;if(v){if(!ty(ne,m.turnCount,z))return}else if(!ey(ne,m.turnCount,z))return;const K={sourceType:"EVOLVE",sourceIndex:0,startX:_,startY:w,currentX:_,currentY:w,offsetX:0,offsetY:0,useSep:v};Mr(K),In.current=K},vg=V.useCallback(h=>{sr.current&&(clearTimeout(sr.current),sr.current=null);const v={stampId:h,playerId:A,playerClass:vs,timestamp:Date.now()},_=Jm(h);_&&ft(_,.6),ei(null),requestAnimationFrame(()=>{ei(v)}),e==="ONLINE"&&y&&y.send({type:"STAMP",stampId:h,playerClass:vs}),sr.current=setTimeout(()=>{ei(w=>(w==null?void 0:w.timestamp)===v.timestamp?null:w),sr.current=null},3e3)},[A,vs,e,y]),tE=V.useCallback(h=>{if(h.stopPropagation(),h.preventDefault(),bs.current){const v=bs.current.getBoundingClientRect();gr.current={x:v.left+v.width/2,y:v.top+v.height/2}}else gr.current={x:h.clientX,y:h.clientY};Qh(!0),za(null)},[]),_g=M.useRef(null);M.useEffect(()=>{_g.current=Su},[Su]),V.useEffect(()=>{if(!bu)return;const h=_=>{if(!gr.current)return;const w=_.clientX-gr.current.x,D=_.clientY-gr.current.y,z=Math.sqrt(w*w+D*D),K=Math.atan2(D,w)*(180/Math.PI);if(z>60&&D<0){const j=180- -K,H=Math.floor(j/22.5),X=Math.max(0,Math.min(7,H))+1;za(X)}else za(null)},v=()=>{const _=_g.current;_&&vg(_),Qh(!1),za(null),gr.current=null};return window.addEventListener("mousemove",h),window.addEventListener("mouseup",v),()=>{window.removeEventListener("mousemove",h),window.removeEventListener("mouseup",v)}},[bu,vg]),V.useEffect(()=>{const h=(w,D,z=!1)=>{var j,H,re,X;if(!In.current)return;const{canDrag:K,sourceType:N}=In.current;if(!(N==="HAND"&&!K)&&(In.current={...In.current,currentX:w,currentY:D},Mr(ue=>ue?{...ue,currentX:w,currentY:D}:null),z&&(N==="BOARD"||N==="EVOLVE"))){const ue=si.current;if(ue){const Ee=ue.getBoundingClientRect();if(w>=Ee.left&&w<=Ee.right&&D>=Ee.top&&D<=Ee.bottom){Wn({type:"LEADER",index:0,playerId:C});return}}const xe=Be.current,Ae=((j=xe.players[C])==null?void 0:j.board)||[];for(let Ee=0;Ee<Vn.current.length;Ee++){const Pe=Vn.current[Ee];if(Pe&&Ae[Ee]){const oe=Pe.getBoundingClientRect();if(w>=oe.left&&w<=oe.right&&D>=oe.top&&D<=oe.bottom){Wn({type:"FOLLOWER",index:Ee,playerId:C,instanceId:(H=Ae[Ee])==null?void 0:H.instanceId});return}}}if(N==="EVOLVE"){const Ee=((re=xe.players[A])==null?void 0:re.board)||[];for(let Pe=0;Pe<or.current.length;Pe++){const oe=or.current[Pe];if(oe&&Ee[Pe]){const he=oe.getBoundingClientRect();if(w>=he.left&&w<=he.right&&D>=he.top&&D<=he.bottom){Wn({type:"FOLLOWER",index:Pe,playerId:A,instanceId:(X=Ee[Pe])==null?void 0:X.instanceId});return}}}}Wn(null)}},v=w=>{h(w.clientX,w.clientY)},_=w=>{w.touches.length>0&&(In.current&&w.preventDefault(),h(w.touches[0].clientX,w.touches[0].clientY,!0))};return window.addEventListener("mousemove",v),window.addEventListener("touchmove",_,{passive:!1}),()=>{window.removeEventListener("mousemove",v),window.removeEventListener("touchmove",_)}},[]);const xg=M.useRef(null),nE=M.useRef(null);V.useEffect(()=>{xg.current=Xe,nE.current=Xe},[Xe]),V.useEffect(()=>{const h=()=>{var D,z,K,N,j,H,re,X,ue,xe,Ae,Ee,Pe;const _=In.current,w=xg.current;if(_){if(_.sourceType==="HAND"){if(Qt.current){console.warn("[handleGlobalMouseUp] Card play in progress, cancelling drag"),In.current=null,Mr(null);return}const oe=Math.sqrt(Math.pow(_.startX-_.currentX,2)+Math.pow(_.startY-_.currentY,2)),he=_.currentY<window.innerHeight-200*g;if(_.canDrag&&oe>30&&he){const pe=ar.current.hand[_.sourceIndex];if(ar.current.pp>=pe.cost){const ee=((z=(D=pe.triggerAbilities)==null?void 0:D.FANFARE)==null?void 0:z.targetType)==="SELECT_FOLLOWER"||((K=pe.triggers)==null?void 0:K.some(q=>q.trigger==="FANFARE"&&q.effects.some(W=>W.targetType==="SELECT_FOLLOWER"))),le=((j=(N=pe.triggerAbilities)==null?void 0:N.FANFARE)==null?void 0:j.targetType)==="SELECT_ALLY_FOLLOWER"||((H=pe.triggers)==null?void 0:H.some(q=>q.trigger==="FANFARE"&&q.effects.some(W=>W.targetType==="SELECT_ALLY_FOLLOWER"))),ye=((X=(re=pe.triggerAbilities)==null?void 0:re.FANFARE)==null?void 0:X.targetType)==="SELECT_OTHER_ALLY_FOLLOWER"||((ue=pe.triggers)==null?void 0:ue.some(q=>q.trigger==="FANFARE"&&q.effects.some(W=>W.targetType==="SELECT_OTHER_ALLY_FOLLOWER")));if(ee||le||ye){const q=le||ye?A:C;Be.current.players[q].board.some(Fe=>{var ot,Ie;return!(!Fe||q!==A&&((ot=Fe.passiveAbilities)!=null&&ot.includes("STEALTH")||(Ie=Fe.passiveAbilities)!=null&&Ie.includes("AURA")))})?(Qt.current=!0,po.current=pe.instanceId||null,Es({type:"PLAY",sourceIndex:_.sourceIndex,sourceInstanceId:pe.instanceId,allowedTargetPlayerId:q}),Yn.current=!0,setTimeout(()=>{Yn.current=!1},100)):(console.log("[handleGlobalMouseUp] No valid targets, skipping target selection"),Uu(_.sourceIndex,_.startX,_.startY),mr(null),Yn.current=!0,setTimeout(()=>{Yn.current=!1},100))}else Uu(_.sourceIndex,_.startX,_.startY),mr(null),Yn.current=!0,setTimeout(()=>{Yn.current=!1},100);In.current=null,Mr(null);return}}else _.canDrag||Ou(!0)}else if(_.sourceType==="BOARD"){if(w&&w.playerId===C){const he=Be.current.players[C],pe=he.board.filter(W=>{var te,Fe;return W&&((te=W.passiveAbilities)==null?void 0:te.includes("WARD"))&&!((Fe=W.passiveAbilities)!=null&&Fe.includes("STEALTH"))});let ee=!1;const le=W=>W?he.board.findIndex(te=>te&&te.instanceId===W):-1,ye=w.type==="LEADER"?-1:le(w.instanceId),ae=ar.current.board[_.sourceIndex],q=((xe=ae==null?void 0:ae.passiveAbilities)==null?void 0:xe.includes("STEALTH"))||(ae==null?void 0:ae.hadStealth);if(pe.length>0&&!q){if(w.type==="LEADER")ee=!0;else if(w.type==="FOLLOWER"&&ye>=0){const W=he.board[ye];W&&!((Ae=W.passiveAbilities)!=null&&Ae.includes("WARD"))&&(ee=!0)}}if(ee)console.log("UI: Attack blocked by WARD");else{const W=ar.current.board.findIndex(at=>at&&at.instanceId===_.sourceInstanceId),te=W>=0?ar.current.board[W]:null,Fe=(Ee=te==null?void 0:te.passiveAbilities)==null?void 0:Ee.includes("RUSH"),ot=(Pe=te==null?void 0:te.passiveAbilities)==null?void 0:Pe.includes("STORM"),Ie=(te==null?void 0:te.turnPlayed)===Be.current.turnCount,Oe=w.type==="LEADER",Se=ye;if(Oe&&Fe&&!ot&&Ie)console.log("UI: Attack blocked by RUSH rule (Cannot attack leader)");else{if(W<0||!te){console.log("UI: Attack blocked - invalid attacker");return}const at=Be.current;if(at.pendingEffects&&at.pendingEffects.length>0){console.log("UI: Attack blocked - pendingEffects still processing");return}const We=w.instanceId,ge=_.sourceInstanceId,Ce=!Oe&&Se>=0?he.board[Se]:null;Fr({type:"ATTACK",playerId:A,payload:{attackerIndex:W,targetIndex:Oe?-1:Se,targetIsLeader:Oe}}),ge&&(Ka(ge),setTimeout(()=>Ka(null),300));const vt=(te==null?void 0:te.attackEffectType)||"SLASH";if(Rt(vt,C,Oe?-1:Se,We),Tn(),!Oe&&Ce&&(Ce.currentAttack||0)>0){const gn=Ce.instanceId;setTimeout(()=>{gn&&(Xa(gn),setTimeout(()=>Xa(null),300)),Rt(Ce.attackEffectType||"SLASH",A,W,ge)},200)}}}}}else if(_.sourceType==="EVOLVE"&&w&&w.type==="FOLLOWER"&&w.playerId===A){const oe=w.index,pe=io.current[oe],ee=(pe==null?void 0:pe.instanceId)||w.instanceId,le=ar.current.board,ye=ee?le.findIndex(ge=>ge&&ge.instanceId===ee):oe,ae=ye>=0?le[ye]:null;if(!ae)return;if(ae.hasEvolved){console.log("[GameScreen] Cannot evolve: card already evolved (drag drop)");return}const W=_.useSep?["SUPER_EVOLVE","EVOLVE"]:["EVOLVE"],Fe=(()=>{var Ce,Qe;const ge=(Qe=(Ce=ae==null?void 0:ae.triggerAbilities)==null?void 0:Ce.EVOLVE)==null?void 0:Qe.targetType;if(ge)return ge;for(const vt of(ae==null?void 0:ae.triggers)||[])if(W.includes(vt.trigger)){for(const gn of vt.effects)if(gn.targetType&&["SELECT_FOLLOWER","SELECT_ALLY_FOLLOWER","SELECT_OTHER_ALLY_FOLLOWER"].includes(gn.targetType))return gn.targetType}return null})(),ot=!!Fe,Ie=Fe==="SELECT_ALLY_FOLLOWER"||Fe==="SELECT_OTHER_ALLY_FOLLOWER",Oe=Fe==="SELECT_OTHER_ALLY_FOLLOWER",Se=Ie?A:C,We=Be.current.players[Se].board.some(ge=>{var Ce,Qe;return!(!ge||Ie&&Oe&&ge.instanceId===ee||!Ie&&((Ce=ge.passiveAbilities)!=null&&Ce.includes("STEALTH")||(Qe=ge.passiveAbilities)!=null&&Qe.includes("AURA")))});ot&&We?(Es({type:"EVOLVE",sourceIndex:ye,sourceInstanceId:ee,sourceVisualIndex:oe,useSep:_.useSep,allowedTargetPlayerId:Se,excludeInstanceId:Oe?ee:void 0}),Yn.current=!0,setTimeout(()=>{Yn.current=!1},100)):(sl(oe,_.useSep,void 0,ee),Yn.current=!0,setTimeout(()=>{Yn.current=!1},100))}}_&&_.sourceType==="HAND"&&_.canDrag&&(og(_.sourceIndex),setTimeout(()=>og(null),300)),Mr(null),In.current=null,Wn(null)},v=()=>{h()};return window.addEventListener("mouseup",h),window.addEventListener("touchend",v),()=>{window.removeEventListener("mouseup",h),window.removeEventListener("touchend",v)}},[C,A,yr,g]);const rE=()=>{if(!Yn.current){if(ze){ze.type==="PLAY"&&(Qt.current=!1),Es(null);return}if(yr){if(Lu.current){Lu.current=!1;return}Ou(!1),mr(null),se(null)}}},$r=()=>{if(!G||G.sourceType!=="BOARD"&&G.sourceType!=="EVOLVE")return"";const h=G.currentX-G.startX,v=G.currentY-G.startY,_=Math.sqrt(h*h+v*v);if(_<10)return"";const w=(G.startX+G.currentX)/2,D=(G.startY+G.currentY)/2,z=Math.min(200,_*.3),K=Math.abs(h),N=Math.min(150,K*.4),j=z+N,re=-(h/(_+1))*j*.5,X=-j*.8,ue=w+re,xe=D+X;return`M${G.startX},${G.startY} Q${ue},${xe} ${G.currentX},${G.currentY}`},zu=(h,v,_,w)=>{var K;if(!ze)return;if(ze.allowedTargetPlayerId&&ze.allowedTargetPlayerId!==_){console.log("Invalid target side");return}if(ze.excludeInstanceId&&w===ze.excludeInstanceId){console.log("Cannot target self (SELECT_OTHER_ALLY_FOLLOWER)"),Tn();return}let D,z=v;if(h==="FOLLOWER"){if(w&&(z=m.players[_].board.findIndex(j=>j&&j.instanceId===w),z<0))return;const N=m.players[_].board[z];if(!N)return;if(D=N.instanceId,_!==A){const j=N.passiveAbilities||[];if(j.includes("STEALTH")){console.log("Cannot target unit with STEALTH"),ft("cancel"),Tn();return}if(j.includes("AURA")){console.log("Cannot target unit with AURA"),ft("cancel"),Tn();return}}}else return;if(ze.type==="PLAY"){const N=ar.current;let j=ze.sourceIndex,H=N.hand[j];if(ze.sourceInstanceId){const he=N.hand.findIndex(pe=>pe.instanceId===ze.sourceInstanceId);if(he>=0)j=he,H=N.hand[he],console.log(`[handleTargetClick] Using sourceInstanceId ${ze.sourceInstanceId}, found at index ${he} (was ${ze.sourceIndex})`);else{console.error("[handleTargetClick] Card not found with instanceId:",ze.sourceInstanceId),Es(null);return}}if(!H){console.error("[handleTargetClick] Card not found at index:",j),Es(null),Qt.current=!1;return}Qt.current=!0,po.current=H.instanceId||null,H.id==="c_y"&&(Rt("SUMI","p2",z,D),Be.current.players[C].board.forEach((pe,ee)=>{if(pe){const le=pe.instanceId;setTimeout(()=>{Rt("SUMI",C,ee,le)},300)}})),H.id==="s_resignation_proxy"&&(Rt("SUMI",_,z,D),setTimeout(()=>{const he=Be.current.players[A].board,pe=[];if(he.forEach((ee,le)=>{ee&&pe.push({index:le,instanceId:ee.instanceId})}),pe.length>0){const ee=pe[Math.floor(Math.random()*pe.length)];Rt("SUMI",A,ee.index,ee.instanceId)}},500)),H.id==="c_azya"&&(Rt("THUNDER",C,-1),setTimeout(()=>{Rt("ICE",_,z,D)},300),setTimeout(()=>{const he=Be.current.players[C].board,pe=he.filter(ee=>ee!==null);if(pe.length>0){const ee=pe[Math.floor(Math.random()*pe.length)],le=he.findIndex(ye=>(ye==null?void 0:ye.instanceId)===(ee==null?void 0:ee.instanceId));le!==-1&&Rt("WATER",C,le,ee==null?void 0:ee.instanceId)}},600));const re=window.innerWidth/2,X=window.innerHeight-200*g/2,ue=window.innerWidth/2,xe=window.innerHeight/2,Ae=()=>{H.type==="SPELL"||Tn(),Fr({type:"PLAY_CARD",playerId:A,payload:{cardIndex:j,targetId:D,instanceId:H.instanceId}}),H.id==="c_amandava"&&Be.current.players[C].board.forEach((ee,le)=>{if(ee){const ye=ee.instanceId;setTimeout(()=>{Rt("SHOT",C,le,ye)},200)}}),kn(null),setTimeout(()=>{Qt.current=!1},100)};let Ee,Pe;if(H.type==="FOLLOWER"){const pe=Be.current.players[A].board.filter(te=>te!==null),ee=pe.length+1,le=pe.length,ye=Cs*g,ae=(le-(ee-1)/2)*ye,q=(K=ri.current)==null?void 0:K.getBoundingClientRect();Ee=(q?q.left+q.width/2:window.innerWidth/2)+ae,Pe=window.innerHeight/2+70*g}const oe=H.type==="FOLLOWER"?Be.current.players[A].board.filter(he=>he!==null).length:void 0;n!=="CPU"&&S&&y&&y.send({type:"PLAY_CARD_ANIM",payload:{playerId:A,cardIndex:j,card:H,targetBoardIndex:oe}}),kn({card:H,sourceIndex:ze.sourceIndex??-1,startX:re,startY:X,targetX:ue,targetY:xe,finalX:Ee,finalY:Pe,playerClass:(ne==null?void 0:ne.class)||"SENKA",onComplete:Ae}),setTimeout(()=>{kn(he=>(he==null?void 0:he.card.id)===H.id?(Ae(),null):he)},2e3)}else if(ze.type==="EVOLVE"){const N=ze.sourceVisualIndex??ze.sourceIndex;sl(N,!!ze.useSep,D,ze.sourceInstanceId)}Es(null)},Eg=()=>{if(!we||we.owner!=="PLAYER")return;if(Qt.current){console.warn("[handleUseButtonClick] Card play in progress, ignoring");return}const h=ne.hand.findIndex(w=>w.id===we.card.id);if(h===-1)return;const v=window.innerWidth/2,_=window.innerHeight-200*g/2;Uu(h,v,_),mr(null)},[li,Hu]=M.useState(!1),[ol,Wu]=M.useState(!1),[Ot,Gu]=M.useState(null),sE=M.useRef(0);M.useEffect(()=>{if(!(Ot!=null&&Ot.active))return;const h=Date.now(),v=800,_=()=>{const w=Date.now()-h;if(w>=v){Gu(null);return}const D=w/v;Gu(z=>z?{...z,ringRadius:20+D*100,particles:z.particles.map(K=>({...K,x:K.x+K.vx,y:K.y+K.vy,opacity:1-D}))}:null),requestAnimationFrame(_)};requestAnimationFrame(_)},[Ot==null?void 0:Ot.active]);const bg=(h,v)=>{const _=[];for(let w=0;w<20;w++){const D=Math.random()*Math.PI*2,z=2+Math.random()*3;_.push({id:sE.current++,x:h,y:v,vx:Math.cos(D)*z,vy:Math.sin(D)*z,opacity:1,createdAt:Date.now()})}Gu({active:!0,x:h,y:v,ringRadius:20,particles:_})},Vu=async()=>{if(m.winnerId){console.log("[handleEndTurn] Game is over, ignoring");return}if(m.activePlayerId!==A){console.log("[handleEndTurn] Not my turn, ignoring");return}if(oi.current){console.log("[handleEndTurn] Already ending turn, ignoring");return}oi.current=!0,Hu(!0);const h=Be.current.turnCount,v=Be.current.activePlayerId;if(!await(async()=>{const D=()=>{const H=Be.current,re=H.pendingEffects&&H.pendingEffects.length>0,X=Fu.current.length>0,ue=$u.current.length>0,xe=ho.current!==null,Ae=ai.current!==null,Ee=_s.current,Pe=Qt.current;return!re&&!X&&!ue&&!xe&&!Ae&&!Ee&&!Pe};let N=0,j=0;for(;N<3e3;){if(Be.current.turnCount!==h||Be.current.activePlayerId!==v)return console.log("[handleEndTurn] Turn changed during wait, aborting local END_TURN"),!1;if(D()){if(j++,j>=2)break}else j=0;await new Promise(H=>setTimeout(H,50)),N+=50}return N>=3e3&&console.warn("[handleEndTurn] Timeout waiting for processing to complete - forcing end turn"),!0})()||Be.current.turnCount!==h||Be.current.activePlayerId!==v||Be.current.activePlayerId!==A){console.log("[handleEndTurn] Turn state changed, aborting END_TURN dispatch"),oi.current=!1,Hu(!1);return}console.log("[handleEndTurn] Dispatching END_TURN"),Fr({type:"END_TURN",playerId:A}),oi.current=!1,Hu(!1)},iE=V.useCallback(()=>{ft("sisiodosi.mp3",.6);const h=tg.current;if(h){const v=h.getBoundingClientRect();bg(v.left+v.width/2,v.top+v.height/2)}Vu()},[ft,Vu]),Sg=2-((ne==null?void 0:ne.evolutionsUsed)||0),Yu=A===m.firstPlayerId,Cg=(h,v)=>v?Math.ceil(m.turnCount/2):Math.floor(m.turnCount/2),Tg=Cg(A,Yu),oE=Yu?3:2,aE=Yu?4:3,al=Tg>=oE,ll=Tg>=aE,Br=(ne==null?void 0:ne.canEvolveThisTurn)&&Sg>0&&m.activePlayerId===A&&al,Ur=(ne==null?void 0:ne.canEvolveThisTurn)&&ne.sep>0&&m.activePlayerId===A&&ll,Ku=C===m.firstPlayerId,Ig=Cg(C,Ku),lE=Ku?3:2,cE=Ku?4:3,Xu=Ig>=lE,Qu=Ig>=cE,Ju=((Lg=ne==null?void 0:ne.board)==null?void 0:Lg.some(h=>{var v;return(v=h==null?void 0:h.passiveAbilities)==null?void 0:v.includes("LEADER_DAMAGE_CAP")}))??!1,qu=((Dg=Te==null?void 0:Te.board)==null?void 0:Dg.some(h=>{var v;return(v=h==null?void 0:h.passiveAbilities)==null?void 0:v.includes("LEADER_DAMAGE_CAP")}))??!1,uE=(ne==null?void 0:ne.leaderDamageShield)??!1,dE=(Te==null?void 0:Te.leaderDamageShield)??!1,kg=Ju||uE,wg=qu||dE;return V.useLayoutEffect(()=>{window.scrollTo(0,0),ri.current&&(ri.current.scrollTop=0);const h=()=>{window.scrollTo(0,0)};return window.addEventListener("scroll",h,{passive:!1}),()=>{window.removeEventListener("scroll",h)}},[]),n==="JOIN"&&!$||T&&I&&!$?l.jsxs("div",{style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",gap:"1rem"},children:[l.jsx("div",{style:{width:"50px",height:"50px",border:"4px solid rgba(233, 69, 96, 0.3)",borderTop:"4px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),l.jsx("p",{children:"..."}),l.jsx("button",{onClick:s,style:{marginTop:"1rem",padding:"0.5rem 1rem",background:"transparent",border:"1px solid #888",color:"#888",cursor:"pointer",borderRadius:"4px"},children:""}),l.jsx("style",{children:`
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                `})]}):T&&Je&&$?l.jsxs("div",{style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",gap:"1rem"},children:[l.jsx("div",{style:{fontSize:"2rem",fontWeight:"bold",color:"#4ade80",textShadow:"0 0 10px rgba(74, 222, 128, 0.5)",marginBottom:"0.5rem"},children:""}),l.jsx("div",{style:{width:"50px",height:"50px",border:"4px solid rgba(74, 222, 128, 0.3)",borderTop:"4px solid #4ade80",borderRadius:"50%",animation:"spin 1s linear infinite"}}),l.jsx("p",{style:{color:"#a0aec0"},children:"..."}),l.jsx("style",{children:`
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                `})]}):l.jsxs("div",{className:"game-screen-wrapper",style:{width:"100vw",height:"100dvh",overflow:"hidden",background:"#000",position:"relative"},children:[B&&l.jsx(Yk,{myPlayer:ne,opponentPlayer:Te,isFirstPlayer:Ct,onComplete:Zx,scale:g}),l.jsxs("div",{className:"game-screen",style:{width:"100%",height:"100%",transform:tt>0?`translate(${nt.x}px, ${nt.y}px)`:"none",display:"flex",overflow:"hidden",background:"radial-gradient(circle at center, #1a202c 0%, #000 100%)",fontFamily:"'Helvetica Neue', sans-serif",userSelect:"none",color:"#fff",position:"absolute",top:0,left:0,opacity:B?0:1,transition:"opacity 0.5s ease-in"},onClick:rE,children:[l.jsx("style",{children:`
                    html, body {
                        margin: 0; padding: 0; height: 100%; background: #000;
                        overflow: hidden !important;
                        position: fixed !important;
                        width: 100% !important;
                        top: 0 !important;
                        left: 0 !important;
                    }
                    * { box-sizing: border-box; }
                    .shake-target { animation: shake 0.3s cubic-bezier(.36,.07,.19,.97) both; }
                    @keyframes shake {
                        10%, 90% { transform: translate3d(-1px, 0, 0); }
                        20%, 80% { transform: translate3d(2px, 0, 0); }
                        30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
                        40%, 60% { transform: translate3d(4px, 0, 0); }
                    }
                    @keyframes attackRotate {
                        0% { transform: rotateY(0deg); }
                        100% { transform: rotateY(360deg); }
                    }
                    .attack-rotating {
                        animation: attackRotate 0.2s linear forwards !important;
                        transform-style: preserve-3d;
                    }
                    @keyframes cardDie {
                        0% { transform: scale(1); filter: brightness(1) drop-shadow(0 0 0 white); opacity: 1; }
                        40% { transform: scale(1.15); filter: brightness(3) drop-shadow(0 0 20px white); opacity: 0.9; }
                        100% { transform: scale(0.4) rotate(8deg); filter: brightness(5) drop-shadow(0 0 40px white); opacity: 0; }
                    }
                    .card-dying { animation: cardDie 0.7s forwards; }
                    /* Necromance effect animations */
                    @keyframes necromanceFloat {
                        0% { transform: translateX(-50%) translateY(0) scale(1); opacity: 1; }
                        50% { transform: translateX(-50%) translateY(-20px) scale(1.2); opacity: 1; }
                        100% { transform: translateX(-50%) translateY(-40px) scale(0.8); opacity: 0; }
                    }
                    @keyframes necromanceFloatOpponent {
                        0% { transform: translateX(-50%) translateY(0) scale(1); opacity: 1; }
                        50% { transform: translateX(-50%) translateY(15px) scale(1.2); opacity: 1; }
                        100% { transform: translateX(-50%) translateY(30px) scale(0.8); opacity: 0; }
                    }
                    @keyframes necroPulse {
                        0%, 100% { box-shadow: 0 0 10px #d946ef, 0 0 20px #a855f7, inset 0 0 15px rgba(217, 70, 239, 0.3); }
                        50% { box-shadow: 0 0 25px #d946ef, 0 0 40px #a855f7, 0 0 60px #7c3aed, inset 0 0 25px rgba(217, 70, 239, 0.5); }
                    }
                    @keyframes leaderDamageCapPulse {
                        0%, 100% {
                            box-shadow: 0 0 20px rgba(103, 232, 249, 0.4), 0 0 40px rgba(103, 232, 249, 0.2);
                            border-color: #67e8f9;
                        }
                        50% {
                            box-shadow: 0 0 35px rgba(103, 232, 249, 0.7), 0 0 55px rgba(103, 232, 249, 0.4);
                            border-color: #a5f3fc;
                        }
                    }
                    @keyframes leaderDamageCapOverlay {
                        0%, 100% { opacity: 0.15; }
                        50% { opacity: 0.45; }
                    }
                    /* EP/SEP pulse animations for usable state - box-shadow only, no transform override */
                    @keyframes epPulse {
                        0%, 100% {
                            box-shadow: 0 0 12px #ffd700, 0 0 25px rgba(255,215,0,0.6);
                        }
                        50% {
                            box-shadow: 0 0 20px #ffd700, 0 0 40px rgba(255,215,0,0.8), 0 0 55px rgba(255,180,0,0.5);
                        }
                    }
                    @keyframes sepPulse {
                        0%, 100% {
                            box-shadow: 0 0 12px #b794f4, 0 0 25px rgba(159,122,234,0.6);
                        }
                        50% {
                            box-shadow: 0 0 20px #b794f4, 0 0 40px rgba(159,122,234,0.8), 0 0 55px rgba(180,0,255,0.5);
                        }
                    }
                `}),ze&&l.jsx("div",{style:{position:"absolute",top:"15%",left:"50%",transform:"translate(-50%, -50%)",background:"rgba(0, 0, 0, 0.7)",color:"#fff",padding:"10px 20px",borderRadius:20,pointerEvents:"none",zIndex:1e3,fontWeight:"bold",border:ze.allowedTargetPlayerId===A?"2px solid #48bb78":"2px solid #f56565"},children:ze.allowedTargetPlayerId===A?"":""}),Xx&&l.jsx(dw,{onClose:()=>Pu(!1)}),Kx&&l.jsx("div",{style:{position:"absolute",inset:0,zIndex:4e3,background:"rgba(0,0,0,0.8)",backdropFilter:"blur(5px)",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>qa(!1),children:l.jsxs("div",{style:{background:"#2d3748",padding:40,borderRadius:16,display:"flex",flexDirection:"column",gap:20,minWidth:300,border:"1px solid rgba(255,255,255,0.1)"},onClick:h=>h.stopPropagation(),children:[l.jsx("h2",{style:{margin:0,textAlign:"center",borderBottom:"1px solid #4a5568",paddingBottom:10,color:"#fff"},children:""}),Yx?l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:15},children:[l.jsx("h3",{style:{margin:0,color:"#cbd5e0"},children:""}),l.jsxs("label",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",color:"white"},children:["BGM",l.jsx("input",{type:"checkbox",checked:ct.bgmEnabled,onChange:h=>uo(v=>({...v,bgmEnabled:h.target.checked})),style:{width:20,height:20}})]}),l.jsxs("label",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",color:"white"},children:["SE",l.jsx("input",{type:"checkbox",checked:ct.seEnabled,onChange:h=>uo(v=>({...v,seEnabled:h.target.checked})),style:{width:20,height:20}})]}),l.jsxs("div",{children:[l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",color:"#a0aec0",marginBottom:5},children:[l.jsx("span",{children:"BGM"}),l.jsxs("span",{children:[Math.round(ct.bgm*100),"%"]})]}),l.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:ct.bgm,onChange:h=>uo(v=>({...v,bgm:parseFloat(h.target.value)})),style:{width:"100%"}})]}),l.jsxs("div",{children:[l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",color:"#a0aec0",marginBottom:5},children:[l.jsx("span",{children:"SE"}),l.jsxs("span",{children:[Math.round(ct.se*100),"%"]})]}),l.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:ct.se,onChange:h=>uo(v=>({...v,se:parseFloat(h.target.value)})),style:{width:"100%"}})]}),l.jsxs("div",{children:[l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",color:"#a0aec0",marginBottom:5},children:[l.jsx("span",{children:""}),l.jsxs("span",{children:[Math.round(ct.voice*100),"%"]})]}),l.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:ct.voice,onChange:h=>uo(v=>({...v,voice:parseFloat(h.target.value)})),style:{width:"100%"}})]}),l.jsx("button",{onClick:()=>ug(!1),style:{padding:10,background:"#4a5568",border:"none",color:"white",borderRadius:8,cursor:"pointer",marginTop:10},children:""})]}):l.jsxs(l.Fragment,{children:[l.jsx("button",{onClick:()=>qa(!1),style:{padding:15,background:"#4a5568",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.2rem"},children:""}),l.jsx("button",{onClick:()=>ug(!0),style:{padding:15,background:"#2b6cb0",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.2rem"},children:""}),l.jsx("button",{onClick:()=>Za(!0),style:{padding:15,background:"#e53e3e",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.2rem"},children:""})]})]})}),Qx&&l.jsx("div",{style:{position:"absolute",inset:0,zIndex:4100,background:"rgba(0,0,0,0.85)",backdropFilter:"blur(5px)",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>Za(!1),children:l.jsxs("div",{style:{background:"#2d3748",padding:40,borderRadius:16,display:"flex",flexDirection:"column",gap:20,minWidth:320,border:"2px solid #e53e3e",boxShadow:"0 0 30px rgba(229, 62, 62, 0.3)"},onClick:h=>h.stopPropagation(),children:[l.jsx("h2",{style:{margin:0,textAlign:"center",color:"#fff",fontSize:"1.5rem"},children:""}),l.jsx("p",{style:{margin:0,textAlign:"center",color:"#a0aec0",fontSize:"1rem"},children:""}),l.jsxs("div",{style:{display:"flex",gap:15,marginTop:10},children:[l.jsx("button",{onClick:()=>Za(!1),style:{flex:1,padding:15,background:"#4a5568",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.1rem"},children:""}),l.jsx("button",{onClick:Jx,style:{flex:1,padding:15,background:"#e53e3e",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.1rem"},children:""})]})]})}),l.jsxs("div",{className:dg?"shake-target":"",style:{width:(E?280:340)*g,borderRight:"1px solid rgba(255,255,255,0.1)",background:"rgba(0,0,0,0.3)",padding:E?`${10*g}px ${12*g}px`:`${20*g}px ${20*g}px ${20*g}px`,display:"flex",flexDirection:"column",zIndex:20,flexShrink:0},onClick:h=>h.stopPropagation(),children:[l.jsx("div",{style:{marginBottom:(E?6:12)*g},children:l.jsxs("button",{onClick:()=>qa(!0),style:{background:"transparent",border:"none",cursor:"pointer",padding:E?3:5},children:[l.jsx("div",{style:{width:(E?22:30)*g,height:(E?2:3)*g,background:"#cbd5e0",marginBottom:(E?4:6)*g}}),l.jsx("div",{style:{width:(E?22:30)*g,height:(E?2:3)*g,background:"#cbd5e0",marginBottom:(E?4:6)*g}}),l.jsx("div",{style:{width:(E?22:30)*g,height:(E?2:3)*g,background:"#cbd5e0"}})]})}),l.jsx("h3",{style:{color:"#a0aec0",borderBottom:"1px solid #4a5568",paddingBottom:(E?4:8)*g,marginTop:0,marginBottom:0,flexShrink:0,fontSize:E?`${.85*g}rem`:void 0},children:""}),we?l.jsx("div",{style:{marginTop:(E?4:10)*g,display:"flex",flexDirection:"column",flex:1,overflow:"hidden",minHeight:0},children:l.jsxs("div",{style:{flex:1,overflow:"auto",minHeight:0,display:"flex",flexDirection:"column"},children:[l.jsxs("div",{style:{flexShrink:0},children:[l.jsx("div",{style:{width:"100%",aspectRatio:"1/1",marginBottom:(E?6:12)*g,display:"flex",alignItems:"center",justifyContent:"center",...E?{maxHeight:"28vh"}:{}},children:l.jsx(fi,{card:we.card,style:{width:"100%",height:"100%",...E?{maxHeight:"28vh"}:{}},variant:"art-only"})}),l.jsx("div",{style:{fontSize:E?`${(we.card.name.length>12?.9:we.card.name.length>8?1:1.1)*g}rem`:`${we.card.name.length>12?1.1:we.card.name.length>8?1.2:1.4}rem`,fontWeight:"bold",marginBottom:(E?4:6)*g,textAlign:"center"},children:we.card.name}),l.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:(E?10:15)*g,marginBottom:(E?6:10)*g},children:[l.jsx("div",{style:{width:24*g,height:24*g,borderRadius:"50%",background:"radial-gradient(circle at 30% 30%, #68d391, #276749)",border:"1px solid #fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${.85*g}rem`,fontWeight:900,color:"white",textShadow:"0 1px 2px rgba(0,0,0,0.5)",boxShadow:"0 2px 4px rgba(0,0,0,0.3)"},children:we.card.cost}),we.card.type==="FOLLOWER"&&l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:3*g},children:[l.jsx("svg",{width:18*g,height:18*g,viewBox:"0 0 24 24",fill:"none",children:l.jsx("polygon",{points:"12,2 22,22 2,22",fill:"#63b3ed",stroke:"none"})}),l.jsx("span",{style:{fontSize:`${.95*g}rem`,fontWeight:"bold",color:"#4299e1"},children:"currentAttack"in we.card?we.card.currentAttack:we.card.attack})]}),we.card.type==="FOLLOWER"&&l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:3*g},children:[l.jsx("svg",{width:18*g,height:18*g,viewBox:"0 0 24 24",fill:"#f56565",children:l.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})}),l.jsx("span",{style:{fontSize:`${.95*g}rem`,fontWeight:"bold",color:"#f56565"},children:"currentHealth"in we.card?we.card.currentHealth:we.card.health})]})]}),l.jsx("div",{style:{fontSize:`${((((Mg=we.card.description)==null?void 0:Mg.length)||0)>150?.7:(((Ng=we.card.description)==null?void 0:Ng.length)||0)>100?.8:.9)*g}rem`,color:"#cbd5e0",lineHeight:"1.4",whiteSpace:"pre-wrap",borderTop:"1px solid #4a5568",paddingTop:4*g},children:Vx(we.card.description)})]}),we.card.flavorText&&l.jsx("div",{style:{marginTop:"auto",paddingTop:8*g,paddingBottom:4*g,flexShrink:0},children:l.jsx("div",{style:{fontSize:`${((((jg=we.card.flavorText)==null?void 0:jg.length)||0)>100?.6:.7)*g}rem`,color:"rgba(160, 174, 192, 0.6)",lineHeight:"1.3",fontStyle:"italic",whiteSpace:"pre-wrap",textAlign:"right"},children:we.card.flavorText})})]})}):l.jsx("div",{style:{marginTop:10*g,color:"#718096",fontStyle:"italic",flex:1,fontSize:`${.7*g}rem`},children:""})]}),l.jsxs("div",{ref:ri,className:dg?"shake-target":"",style:{flex:1,height:"100%",position:"relative",background:"rgba(0,0,0,0.1)",overflow:"hidden"},children:[l.jsxs("div",{ref:si,onMouseEnter:()=>Wn({type:"LEADER",playerId:C}),onMouseLeave:()=>Wn(null),onClick:h=>{h.stopPropagation(),ze&&zu("LEADER",-1,C)},style:{position:"absolute",top:-20*g,left:"50%",transform:"translateX(-50%)",width:pi*g,height:pi*g,borderRadius:"50%",zIndex:100,cursor:"default"},children:[l.jsx("div",{style:{position:"absolute",inset:0,borderRadius:"50%",background:`url(${lp(Te.class)}) center/cover`,border:qu?"4px solid #67e8f9":(Xe==null?void 0:Xe.type)==="LEADER"&&Xe.playerId===C&&!ze?"4px solid #f56565":"4px solid #4a5568",boxShadow:qu?"0 0 20px rgba(103, 232, 249, 0.4), 0 0 40px rgba(103, 232, 249, 0.2)":"0 0 20px rgba(0,0,0,0.5)",transition:"border-color 0.3s, box-shadow 0.3s, filter 0.5s, opacity 0.5s",animation:wg?"leaderDamageCapPulse 2s ease-in-out infinite":"none",...m.winnerId===A&&ke?{filter:ke==="white-fade"?"brightness(2) saturate(0.3)":ke==="explode"||ke==="result-text"||ke==="fade-out"?"brightness(3) saturate(0) blur(10px)":"none",opacity:ke==="explode"||ke==="result-text"||ke==="fade-out"?0:1}:{}},children:wg&&l.jsx("div",{style:{position:"absolute",inset:0,borderRadius:"50%",background:"radial-gradient(circle, rgba(103, 232, 249, 0.5) 0%, rgba(103, 232, 249, 0.2) 70%, rgba(103, 232, 249, 0.1) 100%)",pointerEvents:"none",animation:"leaderDamageCapOverlay 2s ease-in-out infinite",zIndex:1}})}),l.jsx("div",{style:{position:"absolute",bottom:0,left:"50%",transform:`translateX(-50%) translateX(${-140*g}px)`,width:55*g,height:55*g,background:"radial-gradient(circle at 30% 30%, #feb2b2, #c53030)",borderRadius:"50%",border:`${Math.max(2,3*g)}px solid #fff`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${1.2*g}rem`,fontWeight:900,color:"white",textShadow:"0 2px 2px rgba(0,0,0,0.5)",zIndex:10,boxShadow:"0 4px 6px rgba(0,0,0,0.4)"},children:Te.hp}),l.jsx("div",{style:{position:"absolute",bottom:10*g,left:"50%",transform:`translateX(-50%) translateX(${-80*g}px)`,width:45*g,height:45*g,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,opacity:Xu?1:.5,filter:Xu?"none":"grayscale(0.8)"},children:l.jsx("div",{style:{display:"flex",gap:3*g},children:Array(2).fill(0).map((h,v)=>{const _=v<2-Te.evolutionsUsed;return l.jsx("div",{style:{width:12*g,height:12*g,borderRadius:"50%",background:_?"#ecc94b":"#2d3748",boxShadow:_&&Xu?"0 0 8px #ecc94b, 0 0 15px #ecc94b":"none",border:"2px solid rgba(0,0,0,0.5)"}},v)})})}),l.jsx("div",{style:{position:"absolute",bottom:10*g,left:"50%",transform:`translateX(-50%) translateX(${80*g}px)`,width:45*g,height:45*g,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,opacity:Qu?1:.5,filter:Qu?"none":"grayscale(0.8)"},children:l.jsx("div",{style:{display:"flex",gap:3*g},children:Array(2).fill(0).map((h,v)=>{const _=v<Te.sep;return l.jsx("div",{style:{width:12*g,height:12*g,borderRadius:"50%",background:_?"#9f7aea":"#2d3748",boxShadow:_&&Qu?"0 0 8px #9f7aea, 0 0 15px #9f7aea":"none",border:"2px solid rgba(0,0,0,0.5)"}},v)})})}),l.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:pi*g*.75,height:pi*g*.75,pointerEvents:"none",zIndex:20,opacity:(Xe==null?void 0:Xe.type)==="LEADER"&&Xe.playerId===C&&G?1:0,transition:"opacity 0.1s ease-out"},children:[l.jsxs("svg",{width:"100%",height:"100%",viewBox:"0 0 100 100",children:[l.jsx("defs",{children:l.jsxs("filter",{id:"leaderCyanMarkerGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"4",result:"blur"}),l.jsxs("feMerge",{children:[l.jsx("feMergeNode",{in:"blur"}),l.jsx("feMergeNode",{in:"blur"}),l.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),l.jsxs("g",{style:{transformOrigin:"50% 50%",animation:"leaderMarkerSpin 2s linear infinite"},children:[l.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"rgba(100, 200, 255, 0.9)",strokeWidth:"3",strokeDasharray:"15 8",filter:"url(#leaderCyanMarkerGlow)"}),l.jsx("polygon",{points:"50,5 44,18 56,18",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"}),l.jsx("polygon",{points:"95,50 82,44 82,56",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"}),l.jsx("polygon",{points:"50,95 56,82 44,82",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"}),l.jsx("polygon",{points:"5,50 18,56 18,44",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"})]})]}),l.jsx("style",{children:`
                                @keyframes leaderMarkerSpin {
                                    0% { transform: rotate(0deg); }
                                    100% { transform: rotate(360deg); }
                                }
                            `})]})]}),l.jsxs("div",{style:{position:"absolute",top:20*g,left:20*g,width:60*g,height:85*g,zIndex:50},children:[[...Array(Math.min(5,Math.ceil(Te.deck.length/5)))].map((h,v)=>l.jsx("div",{style:{position:"absolute",inset:0,transform:`translate(${v*2*g}px, ${-v*2*g}px)`,borderRadius:6,border:"1px solid #718096",overflow:"hidden"},children:l.jsx("img",{src:Ss((Te==null?void 0:Te.class)||"SENKA"),alt:"Deck",style:{width:"100%",height:"100%",objectFit:"cover"},onError:_=>{_.target.style.display="none",_.target.parentElement.style.background="linear-gradient(45deg, #2d3748, #1a202c)"}})},v)),l.jsx("div",{style:{position:"absolute",bottom:-20*g,width:"100%",textAlign:"center",fontWeight:"bold",color:"#a0aec0",fontSize:"0.9rem"},children:Te.deck.length})]}),l.jsxs("div",{style:{position:"absolute",top:20*g,right:20*g,display:"flex",alignItems:"center",gap:8,zIndex:50,pointerEvents:"none"},children:[l.jsxs("div",{style:{position:"relative",width:24,height:30},children:[l.jsx("div",{style:{position:"absolute",inset:0,background:"#4a192c",borderRadius:2,border:"1px solid #742a3a",transform:"rotate(-15deg) translate(-3px, 0)"}}),l.jsx("div",{style:{position:"absolute",inset:0,background:"#3d1525",borderRadius:2,border:"1px solid #742a3a",transform:"rotate(-5deg) translate(-1px, 0)"}}),l.jsx("div",{style:{position:"absolute",inset:0,background:"#2d1a20",borderRadius:2,border:"1px solid #8b3a4a",transform:"rotate(5deg)"}})]}),l.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(74, 25, 44, 0.8), rgba(45, 26, 32, 0.9))",padding:"3px 8px",borderRadius:5,color:"#f0b8c4",fontSize:"0.64rem",fontWeight:"bold",border:"1px solid rgba(116, 42, 58, 0.5)",boxShadow:"0 2px 4px rgba(0,0,0,0.4)"},children:[" ",Te.hand.length]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5,marginLeft:6},children:[l.jsx("div",{style:{fontSize:"0.9rem",filter:"drop-shadow(0 0 2px rgba(128, 90, 213, 0.6)) grayscale(30%)"},children:""}),l.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(128, 90, 213, 0.7), rgba(76, 29, 149, 0.8))",padding:"3px 8px",borderRadius:5,color:"#c4b5fd",fontSize:"0.64rem",fontWeight:"bold",border:"1px solid rgba(167, 139, 250, 0.4)",boxShadow:"0 2px 4px rgba(0,0,0,0.4)",position:"relative"},children:[" ",Te.graveyard.length,Eu.filter(h=>h.playerId===C).map(h=>l.jsxs("div",{style:{position:"absolute",bottom:-25,left:"50%",transform:"translateX(-50%)",color:"#d946ef",fontSize:"1.2rem",fontWeight:"bold",textShadow:"0 0 8px #d946ef, 0 0 15px #a855f7, 0 0 25px #7c3aed",animation:"necromanceFloatOpponent 1.5s ease-out forwards",pointerEvents:"none",whiteSpace:"nowrap"},children:["-",h.amount]},h.key))]})]})]}),l.jsx("div",{style:{position:"absolute",top:`calc(50% - ${an*g/2}px - ${70*g}px)`,left:"0",width:"100%",height:an*g,pointerEvents:"none",zIndex:10},children:l.jsx("div",{style:{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center"},children:Xt.map((h,v)=>{const _=Xt.length,w=(v-(_-1)/2)*Cs*g;return l.jsxs("div",{ref:D=>Vn.current[v]=D,onMouseEnter:()=>{G&&Wn({type:"FOLLOWER",index:v,playerId:C,instanceId:h==null?void 0:h.instanceId})},onMouseLeave:()=>{G&&Wn(null)},onClick:D=>{if(D.stopPropagation(),ze){if(!h)return;zu("FOLLOWER",v,C,h==null?void 0:h.instanceId)}else h&&mr({card:h,owner:"OPPONENT",source:"BOARD"})},style:{position:"absolute",left:"50%",top:0,transform:`translateX(calc(-50% + ${w}px))`,transition:"transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1), left 0.4s ease",border:ze&&h&&ze.allowedTargetPlayerId===C?"2px solid #f56565":"none",boxShadow:ze&&h&&ze.allowedTargetPlayerId===C?"0 0 15px #f56565":"none",borderRadius:8,cursor:ze?"crosshair":"default",width:Ht*g,height:an*g,pointerEvents:"auto",opacity:yt&&yt.sourcePlayerId===C&&yt.followerIndex===v?0:h!=null&&h.isDying?.8:1,transitionProperty:yt&&yt.sourcePlayerId===C&&yt.followerIndex===v?"none":"transform, left, opacity"},children:[l.jsx("div",{style:{width:"100%",height:"100%",perspective:"800px"},children:l.jsxs("div",{className:sg===(h==null?void 0:h.instanceId)||ig===(h==null?void 0:h.instanceId)?"attack-rotating":"",style:{width:"100%",height:"100%",position:"relative",transformStyle:"preserve-3d"},children:[l.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},children:h?l.jsx(fi,{card:h,turnCount:m.turnCount,className:h.isDying?"card-dying":"",scale:g,style:{width:Ht*g,height:an*g,opacity:1,filter:h.isDying?"grayscale(0.5) brightness(2)":"none",boxShadow:(Xe==null?void 0:Xe.type)==="FOLLOWER"&&Xe.index===v&&(G==null?void 0:G.sourceType)==="BOARD"?"0 0 20px #f56565":(G==null?void 0:G.sourceType)==="BOARD"?"0 0 20px #f6e05e":void 0},isOnBoard:!0,isSpecialSummoning:rg.has(h.instanceId)}):l.jsx("div",{style:{width:Ht*g,height:an*g,border:"1px dashed rgba(255,255,255,0.1)",borderRadius:8}})}),h&&l.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",transform:"rotateY(180deg)",borderRadius:12,overflow:"hidden"},children:l.jsx("img",{src:Ss((Te==null?void 0:Te.class)||"SENKA"),alt:"Card Sleeve",style:{width:"100%",height:"100%",objectFit:"cover"}})})]})}),h&&(G==null?void 0:G.sourceType)==="BOARD"&&l.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",width:"100%",height:"100%",transform:"translate(-50%, -50%)",pointerEvents:"none",zIndex:20,opacity:(Xe==null?void 0:Xe.type)==="FOLLOWER"&&Xe.index===v&&Xe.playerId===C?1:0,transition:"opacity 0.1s ease-out"},children:[l.jsxs("svg",{viewBox:"0 0 100 100",style:{width:"100%",height:"100%",filter:"drop-shadow(0 0 12px rgba(100, 200, 255, 0.9))"},children:[l.jsx("defs",{children:l.jsxs("filter",{id:"cyanMarkerGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"4",result:"blur"}),l.jsxs("feMerge",{children:[l.jsx("feMergeNode",{in:"blur"}),l.jsx("feMergeNode",{in:"blur"}),l.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),l.jsxs("g",{style:{transformOrigin:"50px 50px",animation:"attackMarkerSpin 1.5s linear infinite reverse"},children:[l.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:"rgba(100, 200, 255, 0.95)",strokeWidth:"4",strokeDasharray:"12 6",filter:"url(#cyanMarkerGlow)"}),l.jsx("polygon",{points:"50,10 45,20 55,20",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"}),l.jsx("polygon",{points:"90,50 80,45 80,55",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"}),l.jsx("polygon",{points:"50,90 55,80 45,80",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"}),l.jsx("polygon",{points:"10,50 20,55 20,45",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"})]})]}),l.jsx("style",{children:`
                                                    @keyframes attackMarkerSpin {
                                                        0% { transform: rotate(0deg); }
                                                        100% { transform: rotate(360deg); }
                                                    }
                                                `})]})]},(h==null?void 0:h.instanceId)||`empty-opp-${v}`)})})}),l.jsx("div",{style:{position:"absolute",bottom:`calc(50% - ${an*g/2}px - ${70*g}px)`,left:"0",width:"100%",height:an*g,pointerEvents:"none",zIndex:10},children:l.jsx("div",{style:{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center"},children:sn.map((h,v)=>{const _=sn.length,w=(v-(_-1)/2)*Cs*g;return l.jsxs("div",{ref:D=>or.current[v]=D,onMouseDown:D=>yg(D,v,h==null?void 0:h.instanceId),onTouchStart:D=>yg(D,v,h==null?void 0:h.instanceId),onClick:D=>D.stopPropagation(),onMouseEnter:()=>{G&&Wn({type:"FOLLOWER",index:v,playerId:A,instanceId:h==null?void 0:h.instanceId})},onMouseLeave:()=>{G&&Wn(null)},style:{position:"absolute",left:"50%",top:0,"--offsetX":`calc(-50% + ${w}px)`,transform:`translateX(calc(-50% + ${w}px)) ${(G==null?void 0:G.sourceType)==="BOARD"&&G.sourceInstanceId===(h==null?void 0:h.instanceId)?"translateY(-20px) scale(1.1)":""}`,transition:"transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1), left 0.4s ease",cursor:"pointer",pointerEvents:"auto",width:Ht*g,height:an*g,border:ze&&h&&ze.allowedTargetPlayerId===A?"2px solid #48bb78":"none",boxShadow:ze&&h&&ze.allowedTargetPlayerId===A?"0 0 15px #48bb78":"none",borderRadius:8,zIndex:(G==null?void 0:G.sourceType)==="BOARD"&&G.sourceInstanceId===(h==null?void 0:h.instanceId)?10:1,opacity:yt&&yt.sourcePlayerId===A&&yt.followerIndex===v?0:h!=null&&h.isDying?.8:1,transitionProperty:yt&&yt.sourcePlayerId===A&&yt.followerIndex===v?"none":"transform, left, opacity"},children:[l.jsx("div",{style:{width:"100%",height:"100%",perspective:"800px"},children:l.jsxs("div",{className:sg===(h==null?void 0:h.instanceId)||ig===(h==null?void 0:h.instanceId)?"attack-rotating":"",style:{width:"100%",height:"100%",position:"relative",transformStyle:"preserve-3d"},children:[l.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},children:h?l.jsx(fi,{card:h,turnCount:m.turnCount,className:h.isDying?"card-dying":"",scale:g,style:{width:Ht*g,height:an*g,opacity:1,filter:h.isDying?"grayscale(0.5) brightness(2)":"none",boxShadow:(G==null?void 0:G.sourceType)==="BOARD"&&G.sourceInstanceId===(h==null?void 0:h.instanceId)&&(Xe==null?void 0:Xe.type)==="FOLLOWER"?"0 0 30px #f56565":(G==null?void 0:G.sourceType)==="BOARD"&&G.sourceInstanceId===(h==null?void 0:h.instanceId)?"0 20px 30px rgba(0,0,0,0.6)":void 0,pointerEvents:(G==null?void 0:G.sourceType)==="BOARD"&&G.sourceInstanceId===(h==null?void 0:h.instanceId)?"none":"auto"},isSelected:(we==null?void 0:we.card)===h,isOnBoard:!0,isSpecialSummoning:rg.has(h.instanceId),isMyTurn:m.activePlayerId===A}):l.jsx("div",{style:{width:Ht*g,height:an*g,border:"1px dashed rgba(255,255,255,0.2)",borderRadius:8}})}),h&&l.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",transform:"rotateY(180deg)",borderRadius:12,overflow:"hidden"},children:l.jsx("img",{src:Ss((ne==null?void 0:ne.class)||"SENKA"),alt:"Card Sleeve",style:{width:"100%",height:"100%",objectFit:"cover"}})})]})}),h&&(G==null?void 0:G.sourceType)==="EVOLVE"&&!h.hasEvolved&&l.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",width:"120%",height:"120%",transform:"translate(-50%, -50%)",pointerEvents:"none",border:G.useSep?"2px dashed rgba(183, 148, 244, 0.9)":"2px dashed rgba(255, 230, 100, 0.9)",borderRadius:"50%",boxShadow:G.useSep?"0 0 15px rgba(159, 122, 234, 0.8)":"0 0 15px rgba(255, 200, 50, 0.8)",animation:"evolveMarkerSpin 1.5s linear infinite",zIndex:20,opacity:(Xe==null?void 0:Xe.type)==="FOLLOWER"&&Xe.index===v&&Xe.playerId===A?1:0,transition:"opacity 0.1s ease-out"},children:[l.jsxs("svg",{viewBox:"0 0 100 100",style:{width:"100%",height:"100%",filter:"drop-shadow(0 0 8px currentColor)"},children:[l.jsx("defs",{children:l.jsxs("filter",{id:G.useSep?"purpleMarkerGlow":"yellowMarkerGlow",x:"-30%",y:"-30%",width:"160%",height:"160%",children:[l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"3",result:"blur"}),l.jsxs("feMerge",{children:[l.jsx("feMergeNode",{in:"blur"}),l.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),l.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:G.useSep?"#b794f4":"#f6e05e",strokeWidth:"4",strokeDasharray:"15 8",filter:`url(#${G.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`,opacity:"0.95"}),l.jsx("polygon",{points:"50,5 45,15 55,15",fill:G.useSep?"#b794f4":"#f6e05e",filter:`url(#${G.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`}),l.jsx("polygon",{points:"95,50 85,45 85,55",fill:G.useSep?"#b794f4":"#f6e05e",filter:`url(#${G.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`}),l.jsx("polygon",{points:"50,95 55,85 45,85",fill:G.useSep?"#b794f4":"#f6e05e",filter:`url(#${G.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`}),l.jsx("polygon",{points:"5,50 15,55 15,45",fill:G.useSep?"#b794f4":"#f6e05e",filter:`url(#${G.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`})]}),l.jsx("style",{children:`
                                                @keyframes evolveMarkerSpin {
                                                    0% { transform: translate(-50%, -50%) rotate(0deg); }
                                                    100% { transform: translate(-50%, -50%) rotate(360deg); }
                                                }
                                            `})]})]},(h==null?void 0:h.instanceId)||`empty-plr-${v}`)})})}),l.jsxs("div",{style:{position:"absolute",right:30*g,top:"50%",transform:"translateY(-50%)",display:"flex",flexDirection:"column",alignItems:"center",gap:30*g,zIndex:50},children:[l.jsx("div",{style:{textAlign:"center"},children:l.jsxs("div",{style:{fontSize:`${1.2*g}rem`,fontWeight:700,color:"#a0aec0",fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif'},children:["Turn ",m.turnCount]})}),l.jsxs("div",{style:{textAlign:"center"},children:[l.jsxs("div",{style:{fontSize:`${1.8*g}rem`,fontWeight:900,color:"#f6e05e",fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif'},children:[Te.pp,"/",Te.maxPp]}),l.jsx("div",{style:{display:"flex",gap:4*g,justifyContent:"center"},children:Array(Math.min(10,Te.maxPp)).fill(0).map((h,v)=>l.jsx("div",{style:{width:10*g,height:10*g,borderRadius:"50%",background:v<Te.pp?"#f6e05e":"#2d3748"}},v))})]}),l.jsxs("div",{style:{position:"relative",width:160*g,height:160*g},children:[l.jsx(Xk,{isMyTurn:m.activePlayerId===A,turnCount:m.turnCount,activePlayerId:m.activePlayerId,onTimeUp:iE,timerEnabled:p,isGameOver:!!m.winnerId,scale:g,buttonSize:160,timerDuration:60}),l.jsxs("button",{ref:tg,disabled:m.activePlayerId!==A||li,onMouseDown:h=>{h.stopPropagation(),m.activePlayerId===A&&!li&&Wu(!0)},onMouseUp:h=>{var v;if(h.stopPropagation(),ol&&m.activePlayerId===A&&!li){Wu(!1),ft("sisiodosi.mp3",.6);const _=(v=h.target.closest("button"))==null?void 0:v.getBoundingClientRect();_&&bg(_.left+_.width/2,_.top+_.height/2),Vu()}},onMouseLeave:()=>{Wu(!1)},style:{width:160*g,height:160*g,borderRadius:"50%",border:"4px solid rgba(255,255,255,0.2)",background:li?"linear-gradient(135deg, #805ad5, #6b46c1)":ol?"linear-gradient(135deg, #5a9bd5, #4a7fb0)":m.activePlayerId===A?"linear-gradient(135deg, #3182ce, #2b6cb0)":"#2d3748",color:"white",fontWeight:900,fontSize:`${2*g}rem`,fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif',boxShadow:m.activePlayerId===A?ol?"0 0 20px rgba(66, 153, 225, 0.5)":"0 0 40px rgba(66, 153, 225, 0.8)":"none",opacity:ol?.8:1,cursor:m.activePlayerId===A&&!li?"pointer":"default",transition:"all 0.1s",position:"relative",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",lineHeight:1.2},children:[l.jsx("img",{src:je("/assets/tenfubu_mark.png"),alt:"",style:{position:"absolute",width:"80%",height:"80%",objectFit:"contain",opacity:.25,pointerEvents:"none"}}),li?l.jsx("span",{style:{position:"relative",zIndex:1,whiteSpace:"nowrap"},children:"..."}):l.jsxs(l.Fragment,{children:[l.jsx("span",{style:{position:"relative",zIndex:1,whiteSpace:"nowrap"},children:""}),l.jsx("span",{style:{position:"relative",zIndex:1,whiteSpace:"nowrap"},children:""})]})]})]}),l.jsxs("div",{style:{textAlign:"center"},children:[l.jsx("div",{style:{fontSize:`${2.4*g}rem`,fontWeight:900,color:"#f6e05e",fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif'},children:ne.extraPpActive?l.jsxs("span",{children:[Math.max(0,ne.pp-1),"/",ne.maxPp," ",l.jsx("span",{style:{color:"#ed8936"},children:"+1"})]}):l.jsxs("span",{children:[ne.pp,"/",ne.maxPp]})}),l.jsx("div",{style:{display:"flex",gap:3*g,justifyContent:"center"},children:Array(10).fill(0).map((h,v)=>{const _=v<ne.pp,w=v<ne.maxPp;let D;return _?D="#f6e05e":w?D="#744210":D="#2d3748",l.jsx("div",{style:{width:11*g,height:11*g,borderRadius:"50%",background:D}},v)})})]}),(()=>{const h=A!==m.firstPlayerId,v=m.activePlayerId===A,_=m.turnCount,w=_<=5&&!ne.extraPpUsedEarly,D=_>=6&&!ne.extraPpUsedLate,z=h&&v&&!ne.extraPpActive&&(w||D),K=ne.extraPpActive;if(!h)return null;const N=_<=5&&ne.extraPpUsedEarly||_>=6&&ne.extraPpUsedLate,j=!z&&!K;return l.jsxs("button",{disabled:j,onClick:H=>{H.stopPropagation(),j||Fr({type:"TOGGLE_EXTRA_PP",playerId:A})},style:{width:160*g,height:45*g,borderRadius:12*g,border:K?"3px solid #ed8936":"3px solid rgba(255,255,255,0.2)",background:K?"linear-gradient(135deg, #ed8936, #dd6b20)":z?"linear-gradient(135deg, #744210, #5a3510)":"#2d3748",color:K?"white":z?"#f6e05e":"#718096",fontWeight:700,fontSize:"1rem",boxShadow:K?"0 0 20px rgba(237, 137, 54, 0.6)":"none",cursor:j?"default":"pointer",transition:"all 0.3s",display:"flex",alignItems:"center",justifyContent:"center",gap:6*g,opacity:N&&!K?.5:1},children:[l.jsx("span",{children:"PP"}),l.jsx("span",{style:{fontSize:"1.3rem"},children:"+1"}),K&&l.jsx("span",{style:{fontSize:"0.8rem"},children:"ON"}),N&&!K&&l.jsx("span",{style:{fontSize:"0.7rem",marginLeft:2},children:""})]})})()]}),E?l.jsxs(l.Fragment,{children:[l.jsx("button",{onClick:h=>{h.stopPropagation(),Pu(!0)},style:{position:"absolute",left:15*g,top:120*g,width:64*g,height:64*g,minWidth:64*g,maxWidth:64*g,minHeight:64*g,maxHeight:64*g,borderRadius:"50%",background:"linear-gradient(135deg, #4a5568 0%, #2d3748 100%)",border:"3px solid #63b3ed",color:"#63b3ed",fontSize:`${1.8*g}rem`,fontWeight:"bold",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,padding:0,zIndex:16,boxShadow:"0 2px 8px rgba(0,0,0,0.4)",transition:"all 0.2s ease"},onMouseEnter:h=>{h.currentTarget.style.transform="scale(1.1)",h.currentTarget.style.boxShadow="0 0 15px rgba(99, 179, 237, 0.5)"},onMouseLeave:h=>{h.currentTarget.style.transform="scale(1)",h.currentTarget.style.boxShadow="0 2px 8px rgba(0,0,0,0.4)"},children:"?"}),l.jsx(fw,{logs:m.logs||[],onCardNameClick:wu,scale:g,isMobile:E})]}):l.jsxs("div",{style:{position:"absolute",left:15,top:"50%",transform:"translateY(-50%)",display:"flex",flexDirection:"column",alignItems:"flex-start",gap:8,zIndex:16,pointerEvents:"none"},children:[l.jsx("button",{onClick:h=>{h.stopPropagation(),Pu(!0)},style:{width:36,height:36,borderRadius:"50%",background:"linear-gradient(135deg, #4a5568 0%, #2d3748 100%)",border:"2px solid #63b3ed",color:"#63b3ed",fontSize:"1.2rem",fontWeight:"bold",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",padding:0,boxShadow:"0 4px 12px rgba(0,0,0,0.4)",transition:"all 0.2s ease",pointerEvents:"auto"},onMouseEnter:h=>{h.currentTarget.style.transform="scale(1.1)",h.currentTarget.style.boxShadow="0 0 15px rgba(99, 179, 237, 0.5)"},onMouseLeave:h=>{h.currentTarget.style.transform="scale(1)",h.currentTarget.style.boxShadow="0 4px 12px rgba(0,0,0,0.4)"},children:"?"}),l.jsxs("div",{style:{width:Math.max(180,220*g),height:Math.max(200,280*g),overflowY:"auto",background:"linear-gradient(to right, rgba(0,0,0,0.8), rgba(0,0,0,0.0))",color:"#fff",fontSize:`${Math.max(.65,.75*g)}rem`,padding:`${8*g}px ${8*g}px ${8*g}px ${12*g}px`,borderLeft:"3px solid #63b3ed",pointerEvents:"auto",scrollbarWidth:"thin"},onMouseDown:h=>h.stopPropagation(),onClick:h=>h.stopPropagation(),ref:h=>{h&&(h.scrollTop=h.scrollHeight)},children:[l.jsx("div",{style:{fontWeight:"bold",marginBottom:4*g,color:"#a0aec0",borderBottom:"1px solid rgba(255,255,255,0.1)",paddingBottom:2,fontSize:`${Math.max(.55,.65*g)}rem`,textTransform:"uppercase",letterSpacing:1},children:"BATTLE LOG"}),l.jsx("div",{style:{display:"flex",flexDirection:"column",gap:3*g},children:(m.logs||[]).map((h,v)=>l.jsx("div",{style:{opacity:.9,lineHeight:"1.4",textShadow:"0 1px 2px black",animation:"fadeIn 0.3s ease-out"},children:h},v))})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,pointerEvents:"none"},children:[l.jsxs("div",{style:{position:"relative",width:32,height:40},children:[l.jsx("div",{style:{position:"absolute",inset:0,background:"#4a5568",borderRadius:4,border:"1px solid #718096",transform:"rotate(-15deg) translate(-5px, 0)"}}),l.jsx("div",{style:{position:"absolute",inset:0,background:"#2d3748",borderRadius:4,border:"1px solid #718096",transform:"rotate(-5deg) translate(-2px, 0)"}}),l.jsx("div",{style:{position:"absolute",inset:0,background:"#1a202c",borderRadius:4,border:"1px solid #cbd5e0",transform:"rotate(5deg)"}})]}),l.jsxs("div",{style:{background:"rgba(0,0,0,0.7)",padding:"4px 12px",borderRadius:8,color:"#e2e8f0",fontSize:"0.9rem",fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5)"},children:[" ",ne.hand.length]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,marginLeft:6},children:[l.jsx("div",{style:{fontSize:"1.2rem",filter:"drop-shadow(0 0 3px rgba(128, 90, 213, 0.8))"},children:""}),l.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(128, 90, 213, 0.8), rgba(76, 29, 149, 0.9))",padding:"4px 12px",borderRadius:8,color:"#e2e8f0",fontSize:"0.9rem",fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5), inset 0 1px rgba(255,255,255,0.1)",border:"1px solid rgba(167, 139, 250, 0.5)",position:"relative"},children:[" ",ne.graveyard.length,Eu.filter(h=>h.playerId===A).map(h=>l.jsxs("div",{style:{position:"absolute",top:-30,left:"50%",transform:"translateX(-50%)",color:"#d946ef",fontSize:"1.5rem",fontWeight:"bold",textShadow:"0 0 10px #d946ef, 0 0 20px #a855f7, 0 0 30px #7c3aed",animation:"necromanceFloat 1.5s ease-out forwards",pointerEvents:"none",whiteSpace:"nowrap"},children:["-",h.amount]},h.key))]})]})]}),we&&we.owner==="PLAYER"&&we.source==="HAND"&&yr&&(()=>{const _=((E?Math.max(140,180*g):Math.max(180,220*g))-6)/2,w=ne.pp>=we.card.cost;return l.jsxs("button",{disabled:!w,onClick:D=>{D.stopPropagation(),Eg()},className:w?"play-button-active":"",style:{width:_,background:w?"linear-gradient(to bottom, #48bb78, #38a169)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:"8px 4px",borderRadius:12,fontSize:"0.85rem",fontWeight:"bold",cursor:w?"pointer":"not-allowed",boxShadow:w?"0 0 15px rgba(72, 187, 120, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease",pointerEvents:"auto"},onMouseDown:D=>D.stopPropagation(),children:["",l.jsxs("div",{style:{fontSize:"0.6rem",opacity:.8,marginTop:2},children:["pp ",we.card.cost]})]})})(),we&&we.owner==="PLAYER"&&we.source==="BOARD"&&(()=>{const h=E?Math.max(140,180*g):Math.max(180,220*g),v=6,_=(h-v)/2,w=we.card,D=w==null?void 0:w.hasEvolved,z=!D&&Br,K=!D&&Ur,N=w==null?void 0:w.instanceId,j=ne.board.findIndex(X=>X&&X.instanceId===N),H=ne.board.slice(0,j+1).filter(X=>X).length-1,re=X=>{j<0||sl(H>=0?H:j,X,void 0,N)};return l.jsxs("div",{style:{display:"flex",gap:v,pointerEvents:"auto"},onMouseDown:X=>X.stopPropagation(),children:[l.jsxs("button",{disabled:!z,onClick:X=>{X.stopPropagation(),re(!1)},style:{width:_,background:z?"linear-gradient(to bottom, #faf089, #d69e2e)":"#718096",color:z?"#1a202c":"white",border:"2px solid rgba(255,255,255,0.2)",padding:"8px 4px",borderRadius:12,fontSize:"0.85rem",fontWeight:"bold",cursor:z?"pointer":"not-allowed",boxShadow:z?"0 0 15px rgba(250, 240, 137, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:z?"0 1px 1px rgba(255,255,255,0.3)":"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",l.jsx("div",{style:{fontSize:"0.6rem",opacity:.8,marginTop:2},children:"EP"})]}),l.jsxs("button",{disabled:!K,onClick:X=>{X.stopPropagation(),re(!0)},style:{width:_,background:K?"linear-gradient(to bottom, #b794f4, #805ad5)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:"8px 4px",borderRadius:12,fontSize:"0.85rem",fontWeight:"bold",cursor:K?"pointer":"not-allowed",boxShadow:K?"0 0 15px rgba(183, 148, 244, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",l.jsx("div",{style:{fontSize:"0.6rem",opacity:.8,marginTop:2},children:"SEP"})]})]})})(),!(we&&we.owner==="PLAYER"&&(we.source==="HAND"||we.source==="BOARD"))&&(()=>{const h=E?Math.max(140,180*g):Math.max(180,220*g);return l.jsx("div",{style:{width:h,height:52,visibility:"hidden",pointerEvents:"none"}})})()]}),(Ye==="TOSSING"||Ye==="RESULT")&&l.jsxs("div",{style:{position:"absolute",inset:0,zIndex:4e3,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.85)",pointerEvents:"none"},children:[l.jsxs("div",{style:{textAlign:"center"},children:[l.jsx("div",{style:{width:120*g,height:120*g,margin:`0 auto ${30*g}px`,borderRadius:"50%",background:Ye==="RESULT"?Ne==="FIRST"?"linear-gradient(135deg, #ffd700, #ff8c00)":"linear-gradient(135deg, #c0c0c0, #808080)":"linear-gradient(135deg, #ffd700, #ff8c00)",boxShadow:Ye==="RESULT"?`0 0 ${40*g}px ${Ne==="FIRST"?"#ffd700":"#c0c0c0"}, 0 0 ${80*g}px ${Ne==="FIRST"?"rgba(255,215,0,0.5)":"rgba(192,192,192,0.5)"}`:`0 0 ${30*g}px #ffd700`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"3rem",fontWeight:900,color:"#1a202c",textShadow:"0 2px 2px rgba(0,0,0,0.5)",animation:Ye==="TOSSING"?"coinFlip 0.3s ease-in-out infinite":"coinLand 0.5s ease-out",border:"4px solid rgba(255,255,255,0.3)"},children:Ye==="RESULT"?Ne==="FIRST"?"":"":"?"}),l.jsxs("div",{style:{fontSize:Ye==="RESULT"?"2.5rem":"1.8rem",fontWeight:900,color:Ne==="FIRST"?"#ffd700":Ne==="SECOND"?"#c0c0c0":"white",textShadow:"0 0 20px currentColor, 0 2px 4px black",animation:Ye==="RESULT"?"textPop 0.5s ease-out":"none"},children:[Ye==="TOSSING"&&"...",Ye==="RESULT"&&(Ne==="FIRST"?"":"")]}),Ye==="RESULT"&&l.jsx("div",{style:{fontSize:"1rem",color:"#a0aec0",marginTop:10*g,animation:"fadeIn 0.5s ease-out 0.3s both"},children:Ne==="FIRST"?"":""})]}),l.jsx("style",{children:`
                            @keyframes coinFlip {
                                0%, 100% { transform: rotateY(0deg) scale(1); }
                                50% { transform: rotateY(180deg) scale(1.1); }
                            }
                            @keyframes coinLand {
                                0% { transform: rotateY(720deg) scale(0.5); }
                                70% { transform: rotateY(0deg) scale(1.2); }
                                100% { transform: rotateY(0deg) scale(1); }
                            }
                            @keyframes textPop {
                                0% { transform: scale(0.5); opacity: 0; }
                                70% { transform: scale(1.2); }
                                100% { transform: scale(1); opacity: 1; }
                            }
                        `})]}),Bt&&l.jsxs("div",{style:{position:"absolute",inset:0,zIndex:3e3,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.7)",pointerEvents:"none",animation:"fadeIn 0.2s ease-out"},children:[l.jsx("div",{style:{fontSize:`${3.5*g}rem`,fontWeight:900,fontFamily:"Tamanegi, sans-serif",background:"linear-gradient(135deg, #ffd700, #ff6b6b, #ffd700)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",textShadow:"none",filter:`drop-shadow(0 0 ${15*g}px rgba(255,215,0,0.8)) drop-shadow(0 0 ${30*g}px rgba(255,107,107,0.5))`,animation:"gameStartPop 0.8s ease-out",letterSpacing:"0.2em"},children:" "}),l.jsx("style",{children:`
                            @keyframes gameStartPop {
                                0% { transform: scale(0.3) rotate(-10deg); opacity: 0; }
                                50% { transform: scale(1.2) rotate(5deg); opacity: 1; }
                                70% { transform: scale(0.95) rotate(-2deg); }
                                100% { transform: scale(1) rotate(0deg); opacity: 1; }
                            }
                        `})]}),l.jsxs("div",{ref:bs,style:{position:"absolute",bottom:-20*g,left:"50%",transform:"translateX(-50%)",width:pi*g,height:pi*g,borderRadius:"50%",zIndex:200},children:[l.jsxs("div",{onMouseDown:tE,style:{width:"100%",height:"100%",borderRadius:"50%",overflow:"hidden",border:Ju?"4px solid #67e8f9":"4px solid #3182ce",boxShadow:Ju?"0 0 20px rgba(103, 232, 249, 0.4), 0 0 40px rgba(103, 232, 249, 0.2)":"0 0 20px rgba(49, 130, 206, 0.4)",background:"#1a202c",cursor:"grab",transition:"border-color 0.3s, box-shadow 0.3s, filter 0.5s, opacity 0.5s",animation:kg?"leaderDamageCapPulse 2s ease-in-out infinite":"none",position:"relative",...m.winnerId&&m.winnerId!==A&&ke?{filter:ke==="white-fade"?"brightness(2) saturate(0.3)":ke==="explode"||ke==="result-text"||ke==="fade-out"?"brightness(3) saturate(0) blur(10px)":"none",opacity:ke==="explode"||ke==="result-text"||ke==="fade-out"?0:1}:{}},children:[l.jsx("img",{src:lp(ne.class),style:{width:"100%",height:"100%",objectFit:"cover",pointerEvents:"none"}}),kg&&l.jsx("div",{style:{position:"absolute",inset:0,borderRadius:"50%",background:"radial-gradient(circle, rgba(103, 232, 249, 0.5) 0%, rgba(103, 232, 249, 0.2) 70%, rgba(103, 232, 249, 0.1) 100%)",pointerEvents:"none",animation:"leaderDamageCapOverlay 2s ease-in-out infinite",zIndex:1}})]}),l.jsx("div",{style:{position:"absolute",top:0,left:"50%",transform:`translateX(-50%) translateX(${-140*g}px)`,width:55*g,height:55*g,background:"radial-gradient(circle at 30% 30%, #feb2b2, #c53030)",borderRadius:"50%",border:`${Math.max(2,3*g)}px solid #fff`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${1.2*g}rem`,fontWeight:900,color:"white",textShadow:"0 2px 2px rgba(0,0,0,0.5)",boxShadow:"0 4px 6px rgba(0,0,0,0.4)",zIndex:10},children:ne.hp}),l.jsx("div",{onMouseDown:h=>il(h,!1),onTouchStart:h=>il(h,!1),style:{position:"absolute",top:10*g,left:"50%",transform:`translateX(-50%) translateX(${-80*g}px)`,width:45*g,height:45*g,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:Br?"rgba(255,235,100,0.2)":"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",cursor:Br?"grab":"default",zIndex:10,opacity:al?1:.5,filter:al?"none":"grayscale(0.8)",transition:"opacity 0.3s, filter 0.3s, background 0.3s",boxShadow:Br?"0 0 12px #ffd700, 0 0 25px rgba(255,215,0,0.5)":"none",animation:Br?"epPulse 1.5s ease-in-out infinite":"none"},children:l.jsx("div",{style:{display:"flex",gap:3*g},children:Array(2).fill(0).map((h,v)=>{const _=v<Sg;let w="none";return _&&al&&(w=Br?"0 0 10px #fff59d, 0 0 20px #ffd700, 0 0 30px #ecc94b":"0 0 8px #ecc94b, 0 0 15px #ecc94b"),l.jsx("div",{style:{width:12*g,height:12*g,borderRadius:"50%",background:_?Br?"#fff59d":"#ecc94b":"#2d3748",boxShadow:w,border:"2px solid rgba(0,0,0,0.5)",transition:"box-shadow 0.3s, background 0.3s"}},v)})})}),l.jsx("div",{onMouseDown:h=>il(h,!0),onTouchStart:h=>il(h,!0),style:{position:"absolute",top:10*g,left:"50%",transform:`translateX(-50%) translateX(${80*g}px)`,width:45*g,height:45*g,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:Ur?"rgba(200,160,255,0.2)":"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,cursor:Ur?"grab":"default",opacity:ll?1:.5,filter:ll?"none":"grayscale(0.8)",transition:"opacity 0.3s, filter 0.3s, background 0.3s",boxShadow:Ur?"0 0 12px #b794f4, 0 0 25px rgba(159,122,234,0.5)":"none",animation:Ur?"sepPulse 1.5s ease-in-out infinite":"none"},children:l.jsx("div",{style:{display:"flex",gap:3*g},children:Array(2).fill(0).map((h,v)=>{const _=v<ne.sep;let w="none";return _&&ll&&(w=Ur?"0 0 10px #d6bcfa, 0 0 20px #b794f4, 0 0 30px #9f7aea":"0 0 8px #9f7aea, 0 0 15px #9f7aea"),l.jsx("div",{style:{width:12*g,height:12*g,borderRadius:"50%",background:_?Ur?"#d6bcfa":"#9f7aea":"#2d3748",boxShadow:w,border:"2px solid rgba(0,0,0,0.5)",transition:"box-shadow 0.3s, background 0.3s"}},v)})})})]}),l.jsxs("div",{style:{position:"absolute",bottom:10*g,right:15*g,width:60*g,height:85*g,zIndex:50},children:[[...Array(Math.min(5,Math.ceil(ne.deck.length/5)))].map((h,v)=>l.jsx("div",{style:{position:"absolute",inset:0,transform:`translate(${v*2*g}px, ${-v*2*g}px)`,borderRadius:6,border:"1px solid #718096",boxShadow:"1px 1px 3px rgba(0,0,0,0.5)",overflow:"hidden"},children:l.jsx("img",{src:Ss((ne==null?void 0:ne.class)||"SENKA"),alt:"Deck",style:{width:"100%",height:"100%",objectFit:"cover"},onError:_=>{_.target.style.display="none",_.target.parentElement.style.background="linear-gradient(45deg, #2d3748, #1a202c)"}})},v)),l.jsx("div",{style:{position:"absolute",top:-20*g,width:"100%",textAlign:"center",color:"#a0aec0",fontSize:"0.9rem",fontWeight:"bold",textShadow:"0 1px 2px black"},children:ne.deck.length})]}),l.jsx("div",{style:{position:"absolute",bottom:0,left:0,width:"100%",height:200*g,display:"flex",justifyContent:"center",alignItems:"flex-end",pointerEvents:"none",zIndex:500},children:ne.hand.map((h,v)=>{if(De!==null&&De.sourceIndex===v)return null;const w=ne.hand.length;let D=0,z=0,K=0;if(yr){const j=100*g,H=window.innerWidth-40*g,re=(w-1)*j+Ht*g;let X=j;re>H&&(X=(H-Ht*g)/Math.max(1,w-1)),D=(v-(w-1)/2)*X,z=F===v?-8*g:0,K=0}else{const j=45*g,H=160*g,re=Ht*g/2,X=window.innerWidth/2-H-re,ue=window.innerWidth-340*g-H,xe=(w-1)*j+Ht*g;let Ae=j;xe>ue&&(Ae=(ue-Ht*g)/Math.max(1,w-1)),D=X-(w-1-v)*Ae,z=0,K=(v-(w-1)/2)*3}const N=ne.pp>=h.cost&&m.activePlayerId===A;return l.jsx("div",{onMouseDown:j=>{mg(j,v),yr&&se(v===F?null:v)},onTouchStart:j=>{mg(j,v),yr&&se(v===F?null:v)},style:{position:"absolute",left:"50%",bottom:5*g,transform:`translateX(calc(-50% + ${D}px)) translateY(${z}px) rotate(${K}deg) ${(G==null?void 0:G.sourceType)==="HAND"&&G.sourceIndex===v?"scale(1.05) translateY(-10px)":yr?"translateY(-3px)":""}`,transition:Gx===v?"all 0.3s ease-in":(G==null?void 0:G.sourceType)==="HAND"&&G.sourceIndex===v?"none":"all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1)",zIndex:(G==null?void 0:G.sourceType)==="HAND"&&G.sourceIndex===v?1e3:v+100,width:(E?80:Ht)*g,height:(E?115:an)*g,pointerEvents:"auto",cursor:N?"grab":"not-allowed"},onClick:j=>j.stopPropagation(),children:l.jsx(fi,{card:h,turnCount:m.turnCount,isMyTurn:m.activePlayerId===A,isPlayable:N,scale:g,variant:E?"mobile-hand":"normal",style:{width:E?80*g:Ht*g,height:E?115*g:an*g,boxShadow:(G==null?void 0:G.sourceType)==="HAND"&&G.sourceIndex===v?"0 0 40px rgba(49, 130, 206, 0.8)":N?"0 0 15px rgba(40, 180, 100, 0.6)":"none"}})},h.instanceId)})}),E&&l.jsxs("div",{style:{position:"absolute",bottom:200*g,left:15*g,display:"flex",alignItems:"center",gap:10*g,zIndex:601,pointerEvents:"none"},children:[l.jsxs("div",{style:{position:"relative",width:50*g,height:62*g},children:[l.jsx("div",{style:{position:"absolute",inset:0,background:"#4a5568",borderRadius:6*g,border:"1px solid #718096",transform:"rotate(-15deg) translate(-5px, 0)"}}),l.jsx("div",{style:{position:"absolute",inset:0,background:"#2d3748",borderRadius:6*g,border:"1px solid #718096",transform:"rotate(-5deg) translate(-2px, 0)"}}),l.jsx("div",{style:{position:"absolute",inset:0,background:"#1a202c",borderRadius:6*g,border:"1px solid #cbd5e0",transform:"rotate(5deg)"}})]}),l.jsxs("div",{style:{background:"rgba(0,0,0,0.7)",padding:`${6*g}px ${16*g}px`,borderRadius:10*g,color:"#e2e8f0",fontSize:`${1.32*g}rem`,fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5)"},children:[" ",ne.hand.length]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6*g,marginLeft:10*g},children:[l.jsx("div",{style:{fontSize:`${1.87*g}rem`,filter:"drop-shadow(0 0 3px rgba(128, 90, 213, 0.8))"},children:""}),l.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(128, 90, 213, 0.8), rgba(76, 29, 149, 0.9))",padding:`${6*g}px ${16*g}px`,borderRadius:10*g,color:"#e2e8f0",fontSize:`${1.32*g}rem`,fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5), inset 0 1px rgba(255,255,255,0.1)",border:"1px solid rgba(167, 139, 250, 0.5)",position:"relative"},children:[" ",ne.graveyard.length,Eu.filter(h=>h.playerId===A).map(h=>l.jsxs("div",{style:{position:"absolute",top:-30,left:"50%",transform:"translateX(-50%)",color:"#d946ef",fontSize:"1.5rem",fontWeight:"bold",textShadow:"0 0 10px #d946ef, 0 0 20px #a855f7, 0 0 30px #7c3aed",animation:"necromanceFloat 1.5s ease-out forwards",pointerEvents:"none",whiteSpace:"nowrap"},children:["-",h.amount]},h.key))]})]})]}),E&&we&&we.owner==="PLAYER"&&we.source==="HAND"&&yr&&(()=>{const h=Math.max(140,180*g),v=4*g,_=(h-v)/2,w=ne.pp>=we.card.cost;return l.jsxs("div",{style:{position:"absolute",left:15*g,bottom:135*g,zIndex:600,pointerEvents:"auto"},children:[l.jsxs("button",{disabled:!w,onClick:D=>{D.stopPropagation(),Eg()},className:w?"play-button-active":"",style:{width:_,background:w?"linear-gradient(to bottom, #48bb78, #38a169)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:`${5*g}px ${3*g}px`,borderRadius:10*g,fontSize:`${.7*g}rem`,fontWeight:"bold",cursor:w?"pointer":"not-allowed",boxShadow:w?"0 0 12px rgba(72, 187, 120, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},onMouseDown:D=>D.stopPropagation(),children:["",l.jsxs("div",{style:{fontSize:`${.5*g}rem`,opacity:.8,marginTop:1},children:["pp ",we.card.cost]})]}),l.jsx("style",{children:`
                                @keyframes playGlowPulse {
                                    0% { box-shadow: 0 0 10px rgba(72, 187, 120, 0.4); }
                                    50% { box-shadow: 0 0 25px rgba(72, 187, 120, 0.8); }
                                    100% { box-shadow: 0 0 10px rgba(72, 187, 120, 0.4); }
                                }
                                .play-button-active {
                                    animation: playGlowPulse 2s infinite ease-in-out;
                                }
                            `})]})})(),E&&we&&we.owner==="PLAYER"&&we.source==="BOARD"&&(()=>{const h=Math.max(140,180*g),v=4*g,_=(h-v)/2,w=we.card,D=w==null?void 0:w.hasEvolved,z=!D&&Br,K=!D&&Ur,N=w==null?void 0:w.instanceId,j=ne.board.findIndex(X=>X&&X.instanceId===N),H=ne.board.slice(0,j+1).filter(X=>X).length-1,re=X=>{j<0||sl(H>=0?H:j,X,void 0,N)};return l.jsxs("div",{style:{position:"absolute",left:15*g,bottom:135*g,zIndex:600,pointerEvents:"auto",display:"flex",gap:v},onMouseDown:X=>X.stopPropagation(),children:[l.jsxs("button",{disabled:!z,onClick:X=>{X.stopPropagation(),re(!1)},style:{width:_,background:z?"linear-gradient(to bottom, #faf089, #d69e2e)":"#718096",color:z?"#1a202c":"white",border:"2px solid rgba(255,255,255,0.2)",padding:`${5*g}px ${3*g}px`,borderRadius:10*g,fontSize:`${.7*g}rem`,fontWeight:"bold",cursor:z?"pointer":"not-allowed",boxShadow:z?"0 0 12px rgba(250, 240, 137, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:z?"0 1px 1px rgba(255,255,255,0.3)":"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",l.jsx("div",{style:{fontSize:`${.5*g}rem`,opacity:.8,marginTop:1},children:"EP"})]}),l.jsxs("button",{disabled:!K,onClick:X=>{X.stopPropagation(),re(!0)},style:{width:_,background:K?"linear-gradient(to bottom, #b794f4, #805ad5)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:`${5*g}px ${3*g}px`,borderRadius:10*g,fontSize:`${.7*g}rem`,fontWeight:"bold",cursor:K?"pointer":"not-allowed",boxShadow:K?"0 0 12px rgba(183, 148, 244, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",l.jsx("div",{style:{fontSize:`${.5*g}rem`,opacity:.8,marginTop:1},children:"SEP"})]})]})})(),Nr&&Array.from({length:Nr.count},(h,v)=>{const K=-(Nr.count*80+(Nr.count-1)*20-80)/2+v*100,N=Nr.isPlayer?Ss((ne==null?void 0:ne.class)||"SENKA"):Ss((Te==null?void 0:Te.class)||"SENKA");return l.jsx("div",{style:{position:"absolute",left:Nr.isPlayer?"calc(100% - 90px)":90,top:Nr.isPlayer?"calc(100% - 105px)":105,width:80,height:110,borderRadius:8,border:"2px solid white",overflow:"hidden",transform:`translateX(${K}px)`,animation:`drawCard${Nr.isPlayer?"Player":"Opponent"} ${Ru}ms cubic-bezier(0.2, 0.8, 0.2, 1) forwards`,zIndex:9e3+v,boxShadow:"0 0 10px rgba(255,255,255,0.5)"},children:l.jsx("img",{src:N,alt:"Card Back",style:{width:"100%",height:"100%",objectFit:"cover"},onError:j=>{j.target.style.display="none",j.target.parentElement.style.background="repeating-linear-gradient(45deg, #2d3748, #2d3748 10px, #1a202c 10px, #1a202c 20px)"}})},v)}),l.jsx("style",{children:`
                        @keyframes drawCardPlayer {
                            0% { opacity: 1; }
                            100% { transform: translate(-50vw, -100px) scale(0.5) rotate(-10deg); opacity: 0; }
                        }
                        @keyframes drawCardOpponent {
                            0% { opacity: 1; }
                            100% { transform: translate(50vw, 200px) scale(0.5) rotate(10deg); opacity: 0; }
                        }
                    `})]}),qx.map(h=>l.jsx(cw,{value:h.value,x:h.x,y:h.y,color:h.color,scale:g,onComplete:()=>el(v=>v.filter(_=>_.id!==h.id))},h.id)),bu&&gr.current&&(()=>{const h=gr.current.x,v=gr.current.y,_=200,w=320,z=180/8,K=(N,j,H,re)=>{const X=N*Math.PI/180,ue=j*Math.PI/180,xe=Math.cos(X)*re,Ae=-Math.sin(X)*re,Ee=Math.cos(ue)*re,Pe=-Math.sin(ue)*re,oe=Math.cos(ue)*H,he=-Math.sin(ue)*H,pe=Math.cos(X)*H,ee=-Math.sin(X)*H;return`M ${xe} ${Ae} A ${re} ${re} 0 0 0 ${Ee} ${Pe} L ${oe} ${he} A ${H} ${H} 0 0 1 ${pe} ${ee} Z`};return l.jsxs("div",{style:{position:"fixed",left:h,top:v,zIndex:2e3,pointerEvents:"none",animation:"stampUIFadeIn 0.15s ease-out"},children:[l.jsx("svg",{width:w*2+20,height:w+20,style:{position:"absolute",left:-330,top:-330,overflow:"visible"},children:l.jsx("g",{transform:`translate(${w+10}, ${w+10})`,children:Vh.map((N,j)=>{const H=180-j*z,re=H-z,X=Su===N.id,xe=(H+re)/2*Math.PI/180,Ae=(_+w)/2,Ee=Math.cos(xe)*Ae,Pe=-Math.sin(xe)*Ae,oe=85;return l.jsxs("g",{children:[l.jsx("path",{d:K(H,re,_,w),fill:X?"rgba(255, 215, 0, 0.4)":"rgba(0, 0, 0, 0.7)",stroke:X?"#ffd700":"rgba(255, 255, 255, 0.3)",strokeWidth:X?3:1,style:{transition:"all 0.1s ease-out"}}),l.jsx("defs",{children:l.jsx("clipPath",{id:`stampClip-${N.id}`,children:l.jsx("circle",{cx:Ee,cy:Pe,r:oe/2})})}),l.jsx("image",{href:je(Qm(N.id,vs)),x:Ee-oe/2,y:Pe-oe/2,width:oe,height:oe,clipPath:`url(#stampClip-${N.id})`,style:{transform:X?"scale(1.15)":"scale(1)",transformOrigin:`${Ee}px ${Pe}px`,transition:"transform 0.1s ease-out"}}),l.jsx("circle",{cx:Ee,cy:Pe,r:oe/2,fill:"none",stroke:X?"#ffd700":"rgba(255, 255, 255, 0.5)",strokeWidth:X?2:1})]},N.id)})})}),l.jsx("style",{children:`
                                @keyframes stampUIFadeIn {
                                    from { opacity: 0; transform: scale(0.8); }
                                    to { opacity: 1; transform: scale(1); }
                                }
                            `})]})})(),so&&l.jsxs("div",{style:{position:"fixed",left:"50%",top:"40%",transform:"translate(-50%, -50%)",zIndex:2500,pointerEvents:"none",animation:"stampDisplay 3s ease-out forwards"},children:[l.jsx("div",{style:{width:250,height:250,borderRadius:20,overflow:"hidden",boxShadow:"0 0 40px rgba(0,0,0,0.5), 0 0 60px rgba(255,255,255,0.2)",border:"4px solid rgba(255,255,255,0.3)"},children:l.jsx("img",{src:je(Qm(so.stampId,so.playerClass)),alt:"",style:{width:"100%",height:"100%",objectFit:"cover"}})}),so.playerId!==A&&l.jsx("div",{style:{position:"absolute",bottom:-30,left:"50%",transform:"translateX(-50%)",background:"rgba(0,0,0,0.7)",padding:"5px 15px",borderRadius:15,color:"#fff",fontSize:"0.9rem",whiteSpace:"nowrap"},children:""}),l.jsx("style",{children:`
                            @keyframes stampDisplay {
                                0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
                                10% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
                                20% { transform: translate(-50%, -50%) scale(1); }
                                80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                                100% { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
                            }
                        `})]},so.timestamp),l.jsx("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:1e3},children:G&&(G.sourceType==="BOARD"||G.sourceType==="EVOLVE")&&l.jsxs(l.Fragment,{children:[l.jsxs("defs",{children:[l.jsxs("filter",{id:"cyanGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[l.jsx("feGaussianBlur",{stdDeviation:"10",result:"blur1"}),l.jsx("feFlood",{floodColor:"rgba(100, 200, 255, 0.7)",result:"color1"}),l.jsx("feComposite",{in:"color1",in2:"blur1",operator:"in",result:"glow1"}),l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"5",result:"blur2"}),l.jsx("feFlood",{floodColor:"rgba(150, 220, 255, 0.5)",result:"color2"}),l.jsx("feComposite",{in:"color2",in2:"blur2",operator:"in",result:"glow2"}),l.jsxs("feMerge",{children:[l.jsx("feMergeNode",{in:"glow1"}),l.jsx("feMergeNode",{in:"glow2"})]})]}),l.jsxs("filter",{id:"yellowGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[l.jsx("feGaussianBlur",{stdDeviation:"10",result:"blur1"}),l.jsx("feFlood",{floodColor:"rgba(255, 255, 50, 0.7)",result:"color1"}),l.jsx("feComposite",{in:"color1",in2:"blur1",operator:"in",result:"glow1"}),l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"5",result:"blur2"}),l.jsx("feFlood",{floodColor:"rgba(255, 240, 100, 0.5)",result:"color2"}),l.jsx("feComposite",{in:"color2",in2:"blur2",operator:"in",result:"glow2"}),l.jsxs("feMerge",{children:[l.jsx("feMergeNode",{in:"glow1"}),l.jsx("feMergeNode",{in:"glow2"})]})]}),l.jsxs("filter",{id:"softWhiteGlow",x:"-300%",y:"-300%",width:"700%",height:"700%",children:[l.jsx("feGaussianBlur",{stdDeviation:"20",result:"blur"}),l.jsx("feFlood",{floodColor:"rgba(255, 255, 255, 0.9)",result:"color"}),l.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),l.jsxs("feMerge",{children:[l.jsx("feMergeNode",{in:"glow"}),l.jsx("feMergeNode",{in:"glow"}),l.jsx("feMergeNode",{in:"glow"})]})]}),l.jsxs("filter",{id:"innerCoreGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[l.jsx("feGaussianBlur",{stdDeviation:"4",result:"blur"}),l.jsx("feFlood",{floodColor:"rgba(255, 255, 255, 0.8)",result:"color"}),l.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),l.jsx("feMerge",{children:l.jsx("feMergeNode",{in:"glow"})})]}),l.jsxs("filter",{id:"coloredBallGlow",x:"-150%",y:"-150%",width:"400%",height:"400%",children:[l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"6",result:"blur"}),l.jsxs("feMerge",{children:[l.jsx("feMergeNode",{in:"blur"}),l.jsx("feMergeNode",{in:"blur"})]})]}),l.jsxs("filter",{id:"particleGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"2",result:"blur"}),l.jsxs("feMerge",{children:[l.jsx("feMergeNode",{in:"blur"}),l.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),l.jsxs("filter",{id:"purpleGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[l.jsx("feGaussianBlur",{stdDeviation:"10",result:"blur1"}),l.jsx("feFlood",{floodColor:"rgba(183, 148, 244, 0.7)",result:"color1"}),l.jsx("feComposite",{in:"color1",in2:"blur1",operator:"in",result:"glow1"}),l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"5",result:"blur2"}),l.jsx("feFlood",{floodColor:"rgba(200, 170, 255, 0.5)",result:"color2"}),l.jsx("feComposite",{in:"color2",in2:"blur2",operator:"in",result:"glow2"}),l.jsxs("feMerge",{children:[l.jsx("feMergeNode",{in:"glow1"}),l.jsx("feMergeNode",{in:"glow2"})]})]})]}),G.sourceType==="BOARD"&&l.jsxs(l.Fragment,{children:[l.jsx("path",{d:$r(),fill:"none",stroke:"rgba(100, 200, 255, 0.3)",strokeWidth:"20",strokeLinecap:"butt",filter:"url(#cyanGlow)"}),l.jsx("path",{d:$r(),fill:"none",stroke:"rgba(150, 220, 255, 0.5)",strokeWidth:"10",strokeLinecap:"butt"}),l.jsx("path",{d:$r(),fill:"none",stroke:"rgba(200, 240, 255, 0.9)",strokeWidth:"4",strokeLinecap:"butt"}),l.jsx("path",{d:$r(),fill:"none",stroke:"rgba(255, 255, 255, 1)",strokeWidth:"2",strokeLinecap:"butt"})]}),G.sourceType==="EVOLVE"&&l.jsxs(l.Fragment,{children:[l.jsx("path",{d:$r(),fill:"none",stroke:G.useSep?"rgba(159, 122, 234, 0.3)":"rgba(236, 201, 75, 0.3)",strokeWidth:"20",strokeLinecap:"butt",filter:G.useSep?"url(#purpleGlow)":"url(#yellowGlow)"}),l.jsx("path",{d:$r(),fill:"none",stroke:G.useSep?"rgba(183, 148, 244, 0.5)":"rgba(246, 224, 94, 0.5)",strokeWidth:"10",strokeLinecap:"butt"}),l.jsx("path",{d:$r(),fill:"none",stroke:G.useSep?"rgba(214, 188, 250, 0.9)":"rgba(250, 240, 137, 0.9)",strokeWidth:"4",strokeLinecap:"butt"}),l.jsx("path",{d:$r(),fill:"none",stroke:"rgba(255, 255, 255, 1)",strokeWidth:"2",strokeLinecap:"butt"})]}),(G.sourceType==="BOARD"||G.sourceType==="EVOLVE")&&l.jsxs(l.Fragment,{children:[l.jsx("circle",{cx:G.startX,cy:G.startY,r:"15",fill:"rgba(255, 255, 255, 0.3)",filter:"url(#softWhiteGlow)"}),l.jsx("circle",{cx:G.startX,cy:G.startY,r:"8",fill:"rgba(255, 255, 255, 0.4)",filter:"url(#softWhiteGlow)"})]}),(G.sourceType==="BOARD"||G.sourceType==="EVOLVE")&&l.jsxs(l.Fragment,{children:[l.jsx("circle",{cx:G.currentX,cy:G.currentY,r:"18",fill:"rgba(255, 255, 255, 0.25)",filter:"url(#softWhiteGlow)"}),l.jsx("circle",{cx:G.currentX,cy:G.currentY,r:"8",fill:"rgba(255, 255, 255, 0.35)",filter:"url(#softWhiteGlow)"}),l.jsx("circle",{cx:G.currentX,cy:G.currentY,r:"3",fill:"rgba(255, 255, 255, 0.7)",filter:"url(#innerCoreGlow)"})]}),Hx.map(h=>{const v=G.sourceType==="EVOLVE"?G.useSep?`rgba(230, 220, 255, ${h.opacity})`:`rgba(255, 255, 230, ${h.opacity})`:`rgba(220, 245, 255, ${h.opacity})`;return l.jsx("circle",{cx:h.x,cy:h.y,r:h.radius,fill:v,filter:"url(#particleGlow)"},h.id)})]})}),Ot&&l.jsxs("svg",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100dvh",pointerEvents:"none",zIndex:99999},children:[l.jsx("defs",{children:l.jsxs("filter",{id:"endTurnGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[l.jsx("feGaussianBlur",{stdDeviation:"6",result:"blur"}),l.jsx("feFlood",{floodColor:"rgba(100, 200, 255, 0.8)",result:"color"}),l.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),l.jsxs("feMerge",{children:[l.jsx("feMergeNode",{in:"glow"}),l.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),l.jsx("circle",{cx:Ot.x,cy:Ot.y,r:Ot.ringRadius,fill:"none",stroke:`rgba(100, 200, 255, ${Math.max(0,1-Ot.ringRadius/120)*.8})`,strokeWidth:"4",filter:"url(#endTurnGlow)"}),l.jsx("circle",{cx:Ot.x,cy:Ot.y,r:Ot.ringRadius*.8,fill:"none",stroke:`rgba(255, 255, 255, ${Math.max(0,1-Ot.ringRadius/120)*.6})`,strokeWidth:"2"}),l.jsx("circle",{cx:Ot.x,cy:Ot.y,r:20,fill:`rgba(255, 255, 255, ${Math.max(0,1-Ot.ringRadius/120)*.9})`}),Ot.particles.map(h=>l.jsx("circle",{cx:h.x,cy:h.y,r:4,fill:`rgba(255, 255, 255, ${h.opacity*.8})`},h.id))]}),De&&l.jsxs("div",{style:{position:"absolute",inset:0,zIndex:9999,pointerEvents:"auto",background:"rgba(0,0,0,0.5)",perspective:"1200px"},children:[l.jsx("style",{children:`
                                @keyframes playCardSequence {
                                    ${De.finalX!==void 0?`
                                    /* Phase 1: Start at hand position (0%) */
                                    0% {
                                        transform: translate(${De.startX-De.targetX}px, ${De.startY-De.targetY}px) translate(-50%, -50%) scale(1.0) rotateY(0deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Phase 1b: Mid-rotation during move (12.5%) - CRITICAL: explicit 180deg to force rotation direction */
                                    12.5% {
                                        transform: translate(${(De.startX-De.targetX)*.5}px, ${(De.startY-De.targetY)*.5}px) translate(-50%, -50%) scale(1.5) rotateY(180deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Phase 2: Arrive at center with rotation complete (25%) */
                                    25% {
                                        transform: translate(-50%, -50%) scale(1.8) rotateY(360deg);
                                        opacity: 1;
                                        animation-timing-function: ease-out;
                                    }
                                    /* Phase 3: Hold at center (25%-80%) */
                                    80% {
                                        transform: translate(-50%, -50%) scale(2.4) rotateY(360deg);
                                        opacity: 1;
                                    }
                                    /* Phase 4: Move to board position (80%-100%) */
                                    100% {
                                        transform: translate(calc(-50% + ${De.finalX-De.targetX}px), calc(-50% + ${De.finalY-De.targetY}px)) scale(1.0) rotateY(360deg);
                                        opacity: 1;
                                    }
                                    `:`
                                    /* Spell: Move to center while rotating, then fade */
                                    0% {
                                        transform: translate(${De.startX-De.targetX}px, ${De.startY-De.targetY}px) translate(-50%, -50%) scale(1.0) rotateY(0deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Mid-rotation during move (15%) - CRITICAL: explicit 180deg */
                                    15% {
                                        transform: translate(${(De.startX-De.targetX)*.5}px, ${(De.startY-De.targetY)*.5}px) translate(-50%, -50%) scale(1.7) rotateY(180deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    30% {
                                        transform: translate(-50%, -50%) scale(2.2) rotateY(360deg);
                                        opacity: 1;
                                        animation-timing-function: ease-out;
                                    }
                                    80% {
                                        transform: translate(-50%, -50%) scale(2.4) rotateY(360deg);
                                        opacity: 1;
                                    }
                                    100% {
                                        transform: translate(-50%, -50%) scale(3.0) rotateY(360deg);
                                        opacity: 0;
                                    }
                                    `}
                                }
                                @keyframes playSpellSequence {
                                    /* Move from hand to center while rotating (0-30%) */
                                    0% {
                                        transform: translate(${De.startX-De.targetX}px, ${De.startY-De.targetY}px) translate(-50%, -50%) scale(1.0) rotateY(0deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Mid-rotation during move (15%) - CRITICAL: explicit 180deg to force rotation direction */
                                    15% {
                                        transform: translate(${(De.startX-De.targetX)*.5}px, ${(De.startY-De.targetY)*.5}px) translate(-50%, -50%) scale(1.7) rotateY(180deg);
                                        opacity: 1;
                                        filter: brightness(1);
                                        animation-timing-function: linear;
                                    }
                                    /* Arrive at center with rotation complete (30%) */
                                    30% {
                                        transform: translate(-50%, -50%) scale(2.2) rotateY(360deg);
                                        opacity: 1;
                                        filter: brightness(1);
                                        animation-timing-function: ease-out;
                                    }
                                    /* Hold at center (30%-75%) */
                                    75% {
                                        transform: translate(-50%, -50%) scale(2.4) rotateY(360deg);
                                        opacity: 1;
                                        filter: brightness(1.2);
                                    }
                                    /* Fade out (75%-100%) */
                                    100% {
                                        transform: translate(-50%, -50%) scale(3.0) rotateY(360deg);
                                        opacity: 0;
                                        filter: brightness(3);
                                    }
                                }
                                .play-card-flipper {
                                    transform-style: preserve-3d !important;
                                }
                                .play-card-front, .play-card-back {
                                    backface-visibility: hidden !important;
                                    -webkit-backface-visibility: hidden !important;
                                    position: absolute;
                                    width: 100%;
                                    height: 100%;
                                }
                                .play-card-back {
                                    transform: rotateY(180deg) translateZ(1px);
                                }
                            `}),l.jsxs("div",{className:"play-card-flipper",onAnimationEnd:De.onComplete,style:{position:"absolute",left:De.targetX,top:De.targetY,width:Ht*g,height:an*g,transformStyle:"preserve-3d",animation:De.card.type==="SPELL"?"playSpellSequence 1s forwards":"playCardSequence 0.8s forwards"},children:[l.jsx("div",{className:"play-card-front",children:l.jsx(fi,{card:De.card,isOnBoard:!0,suppressPassives:!0,scale:g,style:{width:Ht*g,height:an*g,boxShadow:"0 0 50px rgba(255,215,0,0.8)"}})}),l.jsx("div",{className:"play-card-back",style:{borderRadius:12,boxShadow:"0 0 50px rgba(255,215,0,0.8)",overflow:"hidden"},children:l.jsx("img",{src:Ss(De.playerClass),alt:"Card Sleeve",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:12},onError:h=>{const v=h.target;v.style.display="none",v.parentElement&&(v.parentElement.style.background="linear-gradient(135deg, #1e3a5f 0%, #0d1b2a 50%, #1e3a5f 100%)")}})}),De.card.type==="SPELL"&&l.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none"},children:l.jsx(uw,{x:0,y:0})})]})]}),ti.length>0&&ti.map((h,v)=>l.jsx("div",{style:{position:"absolute",left:h.status==="FLY"&&h.targetX!==void 0?h.targetX:window.innerWidth/2+h.xOffset,top:h.status==="FLY"&&h.targetY!==void 0?h.targetY:window.innerHeight/2,transform:h.status==="APPEAR"?"translate(-50%, -50%) scale(1.2)":"translate(-50%, -50%) scale(0.2)",zIndex:7e3+v,pointerEvents:"none",transition:h.status==="FLY"?"all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)":"none",opacity:h.status==="FLY"?.3:1,animation:h.status==="APPEAR"?"cardAppear 0.8s ease-out":void 0},children:l.jsx(fi,{card:h.card,scale:g,style:{width:Ht*g,height:an*g}})},v)),l.jsx("style",{children:`
                    @keyframes cardAppear {
                        0% { transform: translate(-50%, -50%) scale(0) rotate(-10deg); opacity: 0; }
                        50% { transform: translate(-50%, -50%) scale(1.3) rotate(5deg); opacity: 1; }
                        100% { transform: translate(-50%, -50%) scale(1.2) rotate(0deg); opacity: 1; }
                    }
                `}),Qa.map(h=>h.type==="BUFF"?l.jsx(ow,{x:h.x,y:h.y,atkBuff:h.atkBuff??0,hpBuff:h.hpBuff??0,onComplete:()=>ni(v=>v.filter(_=>_.key!==h.key))},h.key):l.jsx(lw,{type:h.type,x:h.x,y:h.y,onComplete:()=>ni(v=>v.filter(_=>_.key!==h.key)),audioSettings:ct,scale:g},h.key)),yt&&l.jsx(pw,{card:yt.card,evolvedImageUrl:yt.evolvedImageUrl,startX:yt.startX,startY:yt.startY,phase:yt.phase,onPhaseChange:eE,onShake:Tn,useSep:yt.useSep,playSE:ft,scale:g}),xs&&l.jsxs("div",{style:{position:"fixed",top:"45%",left:`${340*g}px`,width:`calc(100% - ${340*g}px)`,display:"flex",justifyContent:"center",alignItems:"center",transform:"translateY(-50%)",zIndex:9e3,pointerEvents:"none",animation:"notificationFade 2.5s forwards"},children:[l.jsx("div",{style:{padding:`${20*g}px ${90*g}px`,background:"rgba(0, 0, 0, 0.75)",backdropFilter:"blur(16px)",borderTop:`${3*g}px solid ${xs==="EVOLVE_READY"?"rgba(255, 215, 0, 0.7)":"rgba(180, 0, 255, 0.7)"}`,borderBottom:`${3*g}px solid ${xs==="EVOLVE_READY"?"rgba(255, 215, 0, 0.7)":"rgba(180, 0, 255, 0.7)"}`,boxShadow:xs==="EVOLVE_READY"?`0 0 ${50*g}px rgba(255, 180, 0, 0.5), inset 0 0 ${30*g}px rgba(255, 215, 0, 0.2)`:`0 0 ${50*g}px rgba(180, 0, 255, 0.5), inset 0 0 ${30*g}px rgba(180, 0, 255, 0.2)`,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",borderRadius:`${4*g}px`},children:l.jsx("span",{style:{fontSize:`${5*g}rem`,fontWeight:"900",fontFamily:'"YuMincho", "Hiragino Mincho ProN", "MS Mincho", serif',color:"#fff",letterSpacing:`${.8*g}rem`,whiteSpace:"nowrap",textShadow:xs==="EVOLVE_READY"?`0 0 ${15*g}px rgba(255, 215, 0, 1), 0 0 ${30*g}px rgba(255, 180, 0, 0.8), ${2*g}px ${2*g}px ${4*g}px rgba(0,0,0,0.9)`:`0 0 ${15*g}px rgba(180, 0, 255, 1), 0 0 ${30*g}px rgba(140, 0, 255, 0.8), ${2*g}px ${2*g}px ${4*g}px rgba(0,0,0,0.9)`,WebkitTextStroke:xs==="EVOLVE_READY"?`${1.5*g}px #ffd700`:`${1.5*g}px #b400ff`},children:xs==="EVOLVE_READY"?"":""})}),l.jsx("style",{children:`
                            @keyframes notificationFade {
                                0% { opacity: 0; transform: translateY(-40%) scale(0.8); filter: blur(15px); }
                                10% { opacity: 1; transform: translateY(-50%) scale(1); filter: blur(0px); }
                                90% { opacity: 1; transform: translateY(-50%) scale(1); filter: blur(0px); }
                                100% { opacity: 0; transform: translateY(-60%) scale(1.15); filter: blur(20px); }
                            }
                        `})]}),Y&&m.winnerId&&l.jsx(Kk,{isVictory:m.winnerId===A,loserLeaderRef:m.winnerId===A?si:bs,onComplete:()=>{Me(!1),Z(!0),qe(null),$e(0),(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&y&&(console.log("[GameScreen] Disconnecting after game over (casual match)"),y.disconnect())},onPhaseChange:qe,onShakeIntensityChange:$e,scale:g}),m.winnerId&&fe&&l.jsx(vw,{winnerId:m.winnerId,playerId:A,playerClass:(ne==null?void 0:ne.class)||"SENKA",isOnline:e==="ONLINE",myRematchRequested:Kt,opponentRematchRequested:Hn,battleStats:{turnCount:m.turnCount,damageDealtToOpponent:Ua.damageDealtToOpponent,damageReceivedFromOpponent:Ua.damageReceivedFromOpponent,followersDestroyed:Ua.followersDestroyed,myFollowersDestroyed:Ua.myFollowersDestroyed},selectedCardInfo:Ux,onCardInfoClick:xu,onRematch:h=>{e==="ONLINE"?(Cn(!0),Hn?(y==null||y.send({type:"REMATCH_ACCEPT"}),Nu(h)):(y==null||y.send({type:"REMATCH_REQUEST"}),Kh(h))):Nu(h)},onLeave:s})]})]})},xw=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},Ew=xw("/bgm/tenfubu.mp3"),Ol={bgm:.3,se:.5,voice:.5,bgmEnabled:!0,seEnabled:!0},bw=()=>{try{const t=localStorage.getItem("audioSettings");if(t){const e=JSON.parse(t);if(e.enabled!==void 0){const{enabled:n,...r}=e;return{...Ol,...r,bgmEnabled:n,seEnabled:n}}return{...Ol,...e}}return Ol}catch{return Ol}},Sw=()=>{const[t,e]=V.useState(!1);return V.useEffect(()=>{const n=()=>{const r="ontouchstart"in window||navigator.maxTouchPoints>0,s=window.innerHeight>window.innerWidth;e(r&&s)};return n(),window.addEventListener("resize",n),window.addEventListener("orientationchange",n),()=>{window.removeEventListener("resize",n),window.removeEventListener("orientationchange",n)}},[]),t};function Cw(){const[t,e]=V.useState("TITLE"),[n,r]=V.useState("SENKA"),[s,i]=V.useState("CPU"),[o,a]=V.useState(""),[c,u]=V.useState(void 0),[p,f]=V.useState("NORMAL"),[d,y]=V.useState(()=>{const m=localStorage.getItem("timerEnabled");return m!==null?JSON.parse(m):!0}),[S,P]=V.useState(()=>localStorage.getItem("playerName")||""),g=Sw(),b=V.useRef(null),[x,E]=V.useState(!1),[O,Q]=V.useState(bw);V.useEffect(()=>{localStorage.setItem("audioSettings",JSON.stringify(O))},[O]);const F=V.useCallback(m=>{Q(R=>({...R,...m}))},[]),se=V.useRef(null),J=V.useRef(!1);V.useEffect(()=>{const m=new Audio(Ew);return m.loop=!0,m.volume=O.bgmEnabled?O.bgm:0,se.current=m,J.current=!0,()=>{m.pause(),m.src=""}},[]),V.useEffect(()=>{const m=se.current;!m||!J.current||(m.volume=O.bgmEnabled?O.bgm:0,O.bgmEnabled?m.paused&&(t==="TITLE"||t==="CLASS_SELECT")&&m.play().catch(()=>{}):m.pause())},[O.bgm,O.bgmEnabled,t]),V.useEffect(()=>{const m=se.current;m&&(t==="TITLE"||t==="CLASS_SELECT"||t==="LOBBY"?m.paused&&O.bgmEnabled&&m.play().catch(()=>{}):(m.pause(),m.currentTime=0))},[t,O.bgmEnabled]),V.useEffect(()=>{const m=()=>{const R=se.current;R&&R.paused&&O.bgmEnabled&&(t==="TITLE"||t==="CLASS_SELECT"||t==="LOBBY")&&R.play().catch(()=>{})};return document.addEventListener("click",m),()=>document.removeEventListener("click",m)},[t,O.bgmEnabled]);const me=(m,R)=>{i(m),R&&a(R),e("CLASS_SELECT")},A=m=>{r(m),e(s==="CPU"?"GAME":s==="CASUAL_MATCH"||s==="RANKED_MATCH"?"MATCHMAKING":"LOBBY")},C=(m,R)=>{b.current=m,E(!0),R&&u(R),e("GAME")},k=(m,R,$)=>{b.current=m,E(!0),u(R),e("GAME")},I=()=>{b.current&&(b.current.disconnect(),b.current=null),E(!1),e("TITLE"),a(""),i("CPU"),u(void 0)};return l.jsxs("div",{className:"app-container",children:[g&&l.jsxs("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100dvh",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:99999,color:"white",textAlign:"center",padding:20},children:[l.jsx("div",{style:{fontSize:"4rem",marginBottom:20,animation:"rotatePhone 2s ease-in-out infinite"},children:""}),l.jsx("h2",{style:{fontSize:"1.5rem",fontWeight:"bold",marginBottom:10,textShadow:"0 2px 4px rgba(0,0,0,0.5)"},children:""}),l.jsx("p",{style:{fontSize:"1rem",opacity:.8,maxWidth:280},children:""}),l.jsx("style",{children:`
                        @keyframes rotatePhone {
                            0%, 100% { transform: rotate(0deg); }
                            25% { transform: rotate(-30deg); }
                            75% { transform: rotate(30deg); }
                        }
                    `})]}),t==="TITLE"&&l.jsx(VS,{onStartConfig:me,audioSettings:O,onAudioSettingsChange:F}),t==="CLASS_SELECT"&&l.jsx(qS,{onSelectClass:A,onBack:I,gameMode:s,aiDifficulty:p,onDifficultyChange:f,playerName:S,onPlayerNameChange:m=>{P(m),localStorage.setItem("playerName",m)},timerEnabled:d,onTimerEnabledChange:m=>{y(m),localStorage.setItem("timerEnabled",JSON.stringify(m))}}),t==="LOBBY"&&l.jsx(b2,{gameMode:s,targetRoomId:o,playerClass:n,onGameStart:C,onBack:I}),t==="MATCHMAKING"&&l.jsx(Mk,{matchType:s==="CASUAL_MATCH"?"casual":"ranked",playerClass:n,playerName:S||"",onGameStart:k,onCancel:I}),t==="GAME"&&l.jsx(_w,{playerClass:n,opponentType:s==="CPU"?"CPU":"ONLINE",gameMode:s,targetRoomId:o,onLeave:I,networkAdapter:b.current,networkConnected:x,opponentClass:c,aiDifficulty:p,playerName:S||"",timerEnabled:s==="CASUAL_MATCH"||s==="RANKED_MATCH"?!0:d})]})}Bd.createRoot(document.getElementById("root")).render(l.jsx(Cw,{}));
