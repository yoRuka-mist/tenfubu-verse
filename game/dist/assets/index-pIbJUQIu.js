var H2=Object.defineProperty;var W2=t=>{throw TypeError(t)};var G2=(t,e,n)=>e in t?H2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var un=(t,e,n)=>G2(t,typeof e!="symbol"?e+"":e,n);var $a=(t,e,n)=>e.has(t)?W2("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n);function V2(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in t)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function r_(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var s_={exports:{}},zu={},i_={exports:{}},gt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sc=Symbol.for("react.element"),Y2=Symbol.for("react.portal"),K2=Symbol.for("react.fragment"),X2=Symbol.for("react.strict_mode"),J2=Symbol.for("react.profiler"),Q2=Symbol.for("react.provider"),q2=Symbol.for("react.context"),Z2=Symbol.for("react.forward_ref"),eT=Symbol.for("react.suspense"),tT=Symbol.for("react.memo"),nT=Symbol.for("react.lazy"),sy=Symbol.iterator;function rT(t){return t===null||typeof t!="object"?null:(t=sy&&t[sy]||t["@@iterator"],typeof t=="function"?t:null)}var o_={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},a_=Object.assign,l_={};function aa(t,e,n){this.props=t,this.context=e,this.refs=l_,this.updater=n||o_}aa.prototype.isReactComponent={};aa.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};aa.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function c_(){}c_.prototype=aa.prototype;function _g(t,e,n){this.props=t,this.context=e,this.refs=l_,this.updater=n||o_}var bg=_g.prototype=new c_;bg.constructor=_g;a_(bg,aa.prototype);bg.isPureReactComponent=!0;var iy=Array.isArray,d_=Object.prototype.hasOwnProperty,Eg={current:null},u_={key:!0,ref:!0,__self:!0,__source:!0};function f_(t,e,n){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)d_.call(e,r)&&!u_.hasOwnProperty(r)&&(s[r]=e[r]);var l=arguments.length-2;if(l===1)s.children=n;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];s.children=c}if(t&&t.defaultProps)for(r in l=t.defaultProps,l)s[r]===void 0&&(s[r]=l[r]);return{$$typeof:sc,type:t,key:i,ref:o,props:s,_owner:Eg.current}}function sT(t,e){return{$$typeof:sc,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Sg(t){return typeof t=="object"&&t!==null&&t.$$typeof===sc}function iT(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var oy=/\/+/g;function rh(t,e){return typeof t=="object"&&t!==null&&t.key!=null?iT(""+t.key):e.toString(36)}function bd(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case sc:case Y2:o=!0}}if(o)return o=t,s=s(o),t=r===""?"."+rh(o,0):r,iy(s)?(n="",t!=null&&(n=t.replace(oy,"$&/")+"/"),bd(s,e,n,"",function(d){return d})):s!=null&&(Sg(s)&&(s=sT(s,n+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(oy,"$&/")+"/")+t)),e.push(s)),1;if(o=0,r=r===""?".":r+":",iy(t))for(var l=0;l<t.length;l++){i=t[l];var c=r+rh(i,l);o+=bd(i,e,n,c,s)}else if(c=rT(t),typeof c=="function")for(t=c.call(t),l=0;!(i=t.next()).done;)i=i.value,c=r+rh(i,l++),o+=bd(i,e,n,c,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Yc(t,e,n){if(t==null)return t;var r=[],s=0;return bd(t,r,"","",function(i){return e.call(n,i,s++)}),r}function oT(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Dn={current:null},Ed={transition:null},aT={ReactCurrentDispatcher:Dn,ReactCurrentBatchConfig:Ed,ReactCurrentOwner:Eg};function h_(){throw Error("act(...) is not supported in production builds of React.")}gt.Children={map:Yc,forEach:function(t,e,n){Yc(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Yc(t,function(){e++}),e},toArray:function(t){return Yc(t,function(e){return e})||[]},only:function(t){if(!Sg(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};gt.Component=aa;gt.Fragment=K2;gt.Profiler=J2;gt.PureComponent=_g;gt.StrictMode=X2;gt.Suspense=eT;gt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=aT;gt.act=h_;gt.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=a_({},t.props),s=t.key,i=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=Eg.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(c in e)d_.call(e,c)&&!u_.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&l!==void 0?l[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];r.children=l}return{$$typeof:sc,type:t.type,key:s,ref:i,props:r,_owner:o}};gt.createContext=function(t){return t={$$typeof:q2,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:Q2,_context:t},t.Consumer=t};gt.createElement=f_;gt.createFactory=function(t){var e=f_.bind(null,t);return e.type=t,e};gt.createRef=function(){return{current:null}};gt.forwardRef=function(t){return{$$typeof:Z2,render:t}};gt.isValidElement=Sg;gt.lazy=function(t){return{$$typeof:nT,_payload:{_status:-1,_result:t},_init:oT}};gt.memo=function(t,e){return{$$typeof:tT,type:t,compare:e===void 0?null:e}};gt.startTransition=function(t){var e=Ed.transition;Ed.transition={};try{t()}finally{Ed.transition=e}};gt.unstable_act=h_;gt.useCallback=function(t,e){return Dn.current.useCallback(t,e)};gt.useContext=function(t){return Dn.current.useContext(t)};gt.useDebugValue=function(){};gt.useDeferredValue=function(t){return Dn.current.useDeferredValue(t)};gt.useEffect=function(t,e){return Dn.current.useEffect(t,e)};gt.useId=function(){return Dn.current.useId()};gt.useImperativeHandle=function(t,e,n){return Dn.current.useImperativeHandle(t,e,n)};gt.useInsertionEffect=function(t,e){return Dn.current.useInsertionEffect(t,e)};gt.useLayoutEffect=function(t,e){return Dn.current.useLayoutEffect(t,e)};gt.useMemo=function(t,e){return Dn.current.useMemo(t,e)};gt.useReducer=function(t,e,n){return Dn.current.useReducer(t,e,n)};gt.useRef=function(t){return Dn.current.useRef(t)};gt.useState=function(t){return Dn.current.useState(t)};gt.useSyncExternalStore=function(t,e,n){return Dn.current.useSyncExternalStore(t,e,n)};gt.useTransition=function(){return Dn.current.useTransition()};gt.version="18.3.1";i_.exports=gt;var A=i_.exports;const $=r_(A);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lT=A,cT=Symbol.for("react.element"),dT=Symbol.for("react.fragment"),uT=Object.prototype.hasOwnProperty,fT=lT.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,hT={key:!0,ref:!0,__self:!0,__source:!0};function p_(t,e,n){var r,s={},i=null,o=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)uT.call(e,r)&&!hT.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:cT,type:t,key:i,ref:o,props:s,_owner:fT.current}}zu.Fragment=dT;zu.jsx=p_;zu.jsxs=p_;s_.exports=zu;var a=s_.exports,Vh={},g_={exports:{}},nr={},m_={exports:{}},y_={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(y,g){var C=y.length;y.push(g);e:for(;0<C;){var O=C-1>>>1,M=y[O];if(0<s(M,g))y[O]=g,y[C]=M,C=O;else break e}}function n(y){return y.length===0?null:y[0]}function r(y){if(y.length===0)return null;var g=y[0],C=y.pop();if(C!==g){y[0]=C;e:for(var O=0,M=y.length,U=M>>>1;O<U;){var H=2*(O+1)-1,me=y[H],ve=H+1,ue=y[ve];if(0>s(me,C))ve<M&&0>s(ue,me)?(y[O]=ue,y[ve]=C,O=ve):(y[O]=me,y[H]=C,O=H);else if(ve<M&&0>s(ue,C))y[O]=ue,y[ve]=C,O=ve;else break e}}return g}function s(y,g){var C=y.sortIndex-g.sortIndex;return C!==0?C:y.id-g.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],d=[],u=1,p=null,f=3,b=!1,I=!1,k=!1,F=typeof setTimeout=="function"?setTimeout:null,x=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function T(y){for(var g=n(d);g!==null;){if(g.callback===null)r(d);else if(g.startTime<=y)r(d),g.sortIndex=g.expirationTime,e(c,g);else break;g=n(d)}}function h(y){if(k=!1,T(y),!I)if(n(c)!==null)I=!0,w(W);else{var g=n(d);g!==null&&R(h,g.startTime-y)}}function W(y,g){I=!1,k&&(k=!1,x(N),N=-1),b=!0;var C=f;try{for(T(g),p=n(c);p!==null&&(!(p.expirationTime>g)||y&&!Ie());){var O=p.callback;if(typeof O=="function"){p.callback=null,f=p.priorityLevel;var M=O(p.expirationTime<=g);g=t.unstable_now(),typeof M=="function"?p.callback=M:p===n(c)&&r(c),T(g)}else r(c);p=n(c)}if(p!==null)var U=!0;else{var H=n(d);H!==null&&R(h,H.startTime-g),U=!1}return U}finally{p=null,f=C,b=!1}}var G=!1,ce=null,N=-1,J=5,Q=-1;function Ie(){return!(t.unstable_now()-Q<J)}function Je(){if(ce!==null){var y=t.unstable_now();Q=y;var g=!0;try{g=ce(!0,y)}finally{g?pe():(G=!1,ce=null)}}else G=!1}var pe;if(typeof v=="function")pe=function(){v(Je)};else if(typeof MessageChannel<"u"){var se=new MessageChannel,P=se.port2;se.port1.onmessage=Je,pe=function(){P.postMessage(null)}}else pe=function(){F(Je,0)};function w(y){ce=y,G||(G=!0,pe())}function R(y,g){N=F(function(){y(t.unstable_now())},g)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(y){y.callback=null},t.unstable_continueExecution=function(){I||b||(I=!0,w(W))},t.unstable_forceFrameRate=function(y){0>y||125<y?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):J=0<y?Math.floor(1e3/y):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(y){switch(f){case 1:case 2:case 3:var g=3;break;default:g=f}var C=f;f=g;try{return y()}finally{f=C}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(y,g){switch(y){case 1:case 2:case 3:case 4:case 5:break;default:y=3}var C=f;f=y;try{return g()}finally{f=C}},t.unstable_scheduleCallback=function(y,g,C){var O=t.unstable_now();switch(typeof C=="object"&&C!==null?(C=C.delay,C=typeof C=="number"&&0<C?O+C:O):C=O,y){case 1:var M=-1;break;case 2:M=250;break;case 5:M=1073741823;break;case 4:M=1e4;break;default:M=5e3}return M=C+M,y={id:u++,callback:g,priorityLevel:y,startTime:C,expirationTime:M,sortIndex:-1},C>O?(y.sortIndex=C,e(d,y),n(c)===null&&y===n(d)&&(k?(x(N),N=-1):k=!0,R(h,C-O))):(y.sortIndex=M,e(c,y),I||b||(I=!0,w(W))),y},t.unstable_shouldYield=Ie,t.unstable_wrapCallback=function(y){var g=f;return function(){var C=f;f=g;try{return y.apply(this,arguments)}finally{f=C}}}})(y_);m_.exports=y_;var pT=m_.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gT=A,er=pT;function he(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var v_=new Set,Cl={};function Ki(t,e){Vo(t,e),Vo(t+"Capture",e)}function Vo(t,e){for(Cl[t]=e,t=0;t<e.length;t++)v_.add(e[t])}var fs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Yh=Object.prototype.hasOwnProperty,mT=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,ay={},ly={};function yT(t){return Yh.call(ly,t)?!0:Yh.call(ay,t)?!1:mT.test(t)?ly[t]=!0:(ay[t]=!0,!1)}function vT(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function xT(t,e,n,r){if(e===null||typeof e>"u"||vT(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Mn(t,e,n,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var gn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){gn[t]=new Mn(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];gn[e]=new Mn(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){gn[t]=new Mn(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){gn[t]=new Mn(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){gn[t]=new Mn(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){gn[t]=new Mn(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){gn[t]=new Mn(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){gn[t]=new Mn(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){gn[t]=new Mn(t,5,!1,t.toLowerCase(),null,!1,!1)});var Tg=/[\-:]([a-z])/g;function Ig(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Tg,Ig);gn[e]=new Mn(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Tg,Ig);gn[e]=new Mn(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Tg,Ig);gn[e]=new Mn(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){gn[t]=new Mn(t,1,!1,t.toLowerCase(),null,!1,!1)});gn.xlinkHref=new Mn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){gn[t]=new Mn(t,1,!1,t.toLowerCase(),null,!0,!0)});function wg(t,e,n,r){var s=gn.hasOwnProperty(e)?gn[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(xT(e,n,s,r)&&(n=null),r||s===null?yT(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var xs=gT.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Kc=Symbol.for("react.element"),xo=Symbol.for("react.portal"),_o=Symbol.for("react.fragment"),Cg=Symbol.for("react.strict_mode"),Kh=Symbol.for("react.profiler"),x_=Symbol.for("react.provider"),__=Symbol.for("react.context"),kg=Symbol.for("react.forward_ref"),Xh=Symbol.for("react.suspense"),Jh=Symbol.for("react.suspense_list"),Rg=Symbol.for("react.memo"),Os=Symbol.for("react.lazy"),b_=Symbol.for("react.offscreen"),cy=Symbol.iterator;function Fa(t){return t===null||typeof t!="object"?null:(t=cy&&t[cy]||t["@@iterator"],typeof t=="function"?t:null)}var Gt=Object.assign,sh;function el(t){if(sh===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);sh=e&&e[1]||""}return`
`+sh+t}var ih=!1;function oh(t,e){if(!t||ih)return"";ih=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var r=d}Reflect.construct(t,[],e)}else{try{e.call()}catch(d){r=d}t.call(e.prototype)}else{try{throw Error()}catch(d){r=d}t()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var s=d.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,l=i.length-1;1<=o&&0<=l&&s[o]!==i[l];)l--;for(;1<=o&&0<=l;o--,l--)if(s[o]!==i[l]){if(o!==1||l!==1)do if(o--,l--,0>l||s[o]!==i[l]){var c=`
`+s[o].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=o&&0<=l);break}}}finally{ih=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?el(t):""}function _T(t){switch(t.tag){case 5:return el(t.type);case 16:return el("Lazy");case 13:return el("Suspense");case 19:return el("SuspenseList");case 0:case 2:case 15:return t=oh(t.type,!1),t;case 11:return t=oh(t.type.render,!1),t;case 1:return t=oh(t.type,!0),t;default:return""}}function Qh(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case _o:return"Fragment";case xo:return"Portal";case Kh:return"Profiler";case Cg:return"StrictMode";case Xh:return"Suspense";case Jh:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case __:return(t.displayName||"Context")+".Consumer";case x_:return(t._context.displayName||"Context")+".Provider";case kg:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Rg:return e=t.displayName||null,e!==null?e:Qh(t.type)||"Memo";case Os:e=t._payload,t=t._init;try{return Qh(t(e))}catch{}}return null}function bT(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qh(e);case 8:return e===Cg?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function ii(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function E_(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function ET(t){var e=E_(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Xc(t){t._valueTracker||(t._valueTracker=ET(t))}function S_(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=E_(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Vd(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function qh(t,e){var n=e.checked;return Gt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function dy(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=ii(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function T_(t,e){e=e.checked,e!=null&&wg(t,"checked",e,!1)}function Zh(t,e){T_(t,e);var n=ii(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?ep(t,e.type,n):e.hasOwnProperty("defaultValue")&&ep(t,e.type,ii(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function uy(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function ep(t,e,n){(e!=="number"||Vd(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var tl=Array.isArray;function Lo(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+ii(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function tp(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(he(91));return Gt({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function fy(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(he(92));if(tl(n)){if(1<n.length)throw Error(he(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:ii(n)}}function I_(t,e){var n=ii(e.value),r=ii(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function hy(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function w_(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function np(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?w_(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Jc,C_=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Jc=Jc||document.createElement("div"),Jc.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Jc.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function kl(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var al={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ST=["Webkit","ms","Moz","O"];Object.keys(al).forEach(function(t){ST.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),al[e]=al[t]})});function k_(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||al.hasOwnProperty(t)&&al[t]?(""+e).trim():e+"px"}function R_(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=k_(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var TT=Gt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function rp(t,e){if(e){if(TT[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(he(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(he(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(he(61))}if(e.style!=null&&typeof e.style!="object")throw Error(he(62))}}function sp(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ip=null;function Ag(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var op=null,Do=null,Mo=null;function py(t){if(t=ac(t)){if(typeof op!="function")throw Error(he(280));var e=t.stateNode;e&&(e=Yu(e),op(t.stateNode,t.type,e))}}function A_(t){Do?Mo?Mo.push(t):Mo=[t]:Do=t}function P_(){if(Do){var t=Do,e=Mo;if(Mo=Do=null,py(t),e)for(t=0;t<e.length;t++)py(e[t])}}function O_(t,e){return t(e)}function L_(){}var ah=!1;function D_(t,e,n){if(ah)return t(e,n);ah=!0;try{return O_(t,e,n)}finally{ah=!1,(Do!==null||Mo!==null)&&(L_(),P_())}}function Rl(t,e){var n=t.stateNode;if(n===null)return null;var r=Yu(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(he(231,e,typeof n));return n}var ap=!1;if(fs)try{var Ua={};Object.defineProperty(Ua,"passive",{get:function(){ap=!0}}),window.addEventListener("test",Ua,Ua),window.removeEventListener("test",Ua,Ua)}catch{ap=!1}function IT(t,e,n,r,s,i,o,l,c){var d=Array.prototype.slice.call(arguments,3);try{e.apply(n,d)}catch(u){this.onError(u)}}var ll=!1,Yd=null,Kd=!1,lp=null,wT={onError:function(t){ll=!0,Yd=t}};function CT(t,e,n,r,s,i,o,l,c){ll=!1,Yd=null,IT.apply(wT,arguments)}function kT(t,e,n,r,s,i,o,l,c){if(CT.apply(this,arguments),ll){if(ll){var d=Yd;ll=!1,Yd=null}else throw Error(he(198));Kd||(Kd=!0,lp=d)}}function Xi(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function M_(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function gy(t){if(Xi(t)!==t)throw Error(he(188))}function RT(t){var e=t.alternate;if(!e){if(e=Xi(t),e===null)throw Error(he(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return gy(s),t;if(i===r)return gy(s),e;i=i.sibling}throw Error(he(188))}if(n.return!==r.return)n=s,r=i;else{for(var o=!1,l=s.child;l;){if(l===n){o=!0,n=s,r=i;break}if(l===r){o=!0,r=s,n=i;break}l=l.sibling}if(!o){for(l=i.child;l;){if(l===n){o=!0,n=i,r=s;break}if(l===r){o=!0,r=i,n=s;break}l=l.sibling}if(!o)throw Error(he(189))}}if(n.alternate!==r)throw Error(he(190))}if(n.tag!==3)throw Error(he(188));return n.stateNode.current===n?t:e}function N_(t){return t=RT(t),t!==null?j_(t):null}function j_(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=j_(t);if(e!==null)return e;t=t.sibling}return null}var $_=er.unstable_scheduleCallback,my=er.unstable_cancelCallback,AT=er.unstable_shouldYield,PT=er.unstable_requestPaint,Yt=er.unstable_now,OT=er.unstable_getCurrentPriorityLevel,Pg=er.unstable_ImmediatePriority,F_=er.unstable_UserBlockingPriority,Xd=er.unstable_NormalPriority,LT=er.unstable_LowPriority,U_=er.unstable_IdlePriority,Hu=null,zr=null;function DT(t){if(zr&&typeof zr.onCommitFiberRoot=="function")try{zr.onCommitFiberRoot(Hu,t,void 0,(t.current.flags&128)===128)}catch{}}var Rr=Math.clz32?Math.clz32:jT,MT=Math.log,NT=Math.LN2;function jT(t){return t>>>=0,t===0?32:31-(MT(t)/NT|0)|0}var Qc=64,qc=4194304;function nl(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Jd(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,o=n&268435455;if(o!==0){var l=o&~s;l!==0?r=nl(l):(i&=o,i!==0&&(r=nl(i)))}else o=n&~s,o!==0?r=nl(o):i!==0&&(r=nl(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Rr(e),s=1<<n,r|=t[n],e&=~s;return r}function $T(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function FT(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var o=31-Rr(i),l=1<<o,c=s[o];c===-1?(!(l&n)||l&r)&&(s[o]=$T(l,e)):c<=e&&(t.expiredLanes|=l),i&=~l}}function cp(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function B_(){var t=Qc;return Qc<<=1,!(Qc&4194240)&&(Qc=64),t}function lh(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function ic(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Rr(e),t[e]=n}function UT(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-Rr(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function Og(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Rr(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var It=0;function z_(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var H_,Lg,W_,G_,V_,dp=!1,Zc=[],Gs=null,Vs=null,Ys=null,Al=new Map,Pl=new Map,Ds=[],BT="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function yy(t,e){switch(t){case"focusin":case"focusout":Gs=null;break;case"dragenter":case"dragleave":Vs=null;break;case"mouseover":case"mouseout":Ys=null;break;case"pointerover":case"pointerout":Al.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pl.delete(e.pointerId)}}function Ba(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=ac(e),e!==null&&Lg(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function zT(t,e,n,r,s){switch(e){case"focusin":return Gs=Ba(Gs,t,e,n,r,s),!0;case"dragenter":return Vs=Ba(Vs,t,e,n,r,s),!0;case"mouseover":return Ys=Ba(Ys,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return Al.set(i,Ba(Al.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,Pl.set(i,Ba(Pl.get(i)||null,t,e,n,r,s)),!0}return!1}function Y_(t){var e=Ai(t.target);if(e!==null){var n=Xi(e);if(n!==null){if(e=n.tag,e===13){if(e=M_(n),e!==null){t.blockedOn=e,V_(t.priority,function(){W_(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Sd(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=up(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);ip=r,n.target.dispatchEvent(r),ip=null}else return e=ac(n),e!==null&&Lg(e),t.blockedOn=n,!1;e.shift()}return!0}function vy(t,e,n){Sd(t)&&n.delete(e)}function HT(){dp=!1,Gs!==null&&Sd(Gs)&&(Gs=null),Vs!==null&&Sd(Vs)&&(Vs=null),Ys!==null&&Sd(Ys)&&(Ys=null),Al.forEach(vy),Pl.forEach(vy)}function za(t,e){t.blockedOn===e&&(t.blockedOn=null,dp||(dp=!0,er.unstable_scheduleCallback(er.unstable_NormalPriority,HT)))}function Ol(t){function e(s){return za(s,t)}if(0<Zc.length){za(Zc[0],t);for(var n=1;n<Zc.length;n++){var r=Zc[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Gs!==null&&za(Gs,t),Vs!==null&&za(Vs,t),Ys!==null&&za(Ys,t),Al.forEach(e),Pl.forEach(e),n=0;n<Ds.length;n++)r=Ds[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Ds.length&&(n=Ds[0],n.blockedOn===null);)Y_(n),n.blockedOn===null&&Ds.shift()}var No=xs.ReactCurrentBatchConfig,Qd=!0;function WT(t,e,n,r){var s=It,i=No.transition;No.transition=null;try{It=1,Dg(t,e,n,r)}finally{It=s,No.transition=i}}function GT(t,e,n,r){var s=It,i=No.transition;No.transition=null;try{It=4,Dg(t,e,n,r)}finally{It=s,No.transition=i}}function Dg(t,e,n,r){if(Qd){var s=up(t,e,n,r);if(s===null)vh(t,e,r,qd,n),yy(t,r);else if(zT(s,t,e,n,r))r.stopPropagation();else if(yy(t,r),e&4&&-1<BT.indexOf(t)){for(;s!==null;){var i=ac(s);if(i!==null&&H_(i),i=up(t,e,n,r),i===null&&vh(t,e,r,qd,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else vh(t,e,r,null,n)}}var qd=null;function up(t,e,n,r){if(qd=null,t=Ag(r),t=Ai(t),t!==null)if(e=Xi(t),e===null)t=null;else if(n=e.tag,n===13){if(t=M_(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return qd=t,null}function K_(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(OT()){case Pg:return 1;case F_:return 4;case Xd:case LT:return 16;case U_:return 536870912;default:return 16}default:return 16}}var Us=null,Mg=null,Td=null;function X_(){if(Td)return Td;var t,e=Mg,n=e.length,r,s="value"in Us?Us.value:Us.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===s[i-r];r++);return Td=s.slice(t,1<r?1-r:void 0)}function Id(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function ed(){return!0}function xy(){return!1}function rr(t){function e(n,r,s,i,o){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(i):i[l]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?ed:xy,this.isPropagationStopped=xy,this}return Gt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=ed)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=ed)},persist:function(){},isPersistent:ed}),e}var la={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ng=rr(la),oc=Gt({},la,{view:0,detail:0}),VT=rr(oc),ch,dh,Ha,Wu=Gt({},oc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:jg,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Ha&&(Ha&&t.type==="mousemove"?(ch=t.screenX-Ha.screenX,dh=t.screenY-Ha.screenY):dh=ch=0,Ha=t),ch)},movementY:function(t){return"movementY"in t?t.movementY:dh}}),_y=rr(Wu),YT=Gt({},Wu,{dataTransfer:0}),KT=rr(YT),XT=Gt({},oc,{relatedTarget:0}),uh=rr(XT),JT=Gt({},la,{animationName:0,elapsedTime:0,pseudoElement:0}),QT=rr(JT),qT=Gt({},la,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),ZT=rr(qT),eI=Gt({},la,{data:0}),by=rr(eI),tI={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},nI={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},rI={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function sI(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=rI[t])?!!e[t]:!1}function jg(){return sI}var iI=Gt({},oc,{key:function(t){if(t.key){var e=tI[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Id(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?nI[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:jg,charCode:function(t){return t.type==="keypress"?Id(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Id(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),oI=rr(iI),aI=Gt({},Wu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ey=rr(aI),lI=Gt({},oc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:jg}),cI=rr(lI),dI=Gt({},la,{propertyName:0,elapsedTime:0,pseudoElement:0}),uI=rr(dI),fI=Gt({},Wu,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),hI=rr(fI),pI=[9,13,27,32],$g=fs&&"CompositionEvent"in window,cl=null;fs&&"documentMode"in document&&(cl=document.documentMode);var gI=fs&&"TextEvent"in window&&!cl,J_=fs&&(!$g||cl&&8<cl&&11>=cl),Sy=" ",Ty=!1;function Q_(t,e){switch(t){case"keyup":return pI.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function q_(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var bo=!1;function mI(t,e){switch(t){case"compositionend":return q_(e);case"keypress":return e.which!==32?null:(Ty=!0,Sy);case"textInput":return t=e.data,t===Sy&&Ty?null:t;default:return null}}function yI(t,e){if(bo)return t==="compositionend"||!$g&&Q_(t,e)?(t=X_(),Td=Mg=Us=null,bo=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return J_&&e.locale!=="ko"?null:e.data;default:return null}}var vI={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Iy(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!vI[t.type]:e==="textarea"}function Z_(t,e,n,r){A_(r),e=Zd(e,"onChange"),0<e.length&&(n=new Ng("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var dl=null,Ll=null;function xI(t){d1(t,0)}function Gu(t){var e=To(t);if(S_(e))return t}function _I(t,e){if(t==="change")return e}var e1=!1;if(fs){var fh;if(fs){var hh="oninput"in document;if(!hh){var wy=document.createElement("div");wy.setAttribute("oninput","return;"),hh=typeof wy.oninput=="function"}fh=hh}else fh=!1;e1=fh&&(!document.documentMode||9<document.documentMode)}function Cy(){dl&&(dl.detachEvent("onpropertychange",t1),Ll=dl=null)}function t1(t){if(t.propertyName==="value"&&Gu(Ll)){var e=[];Z_(e,Ll,t,Ag(t)),D_(xI,e)}}function bI(t,e,n){t==="focusin"?(Cy(),dl=e,Ll=n,dl.attachEvent("onpropertychange",t1)):t==="focusout"&&Cy()}function EI(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Gu(Ll)}function SI(t,e){if(t==="click")return Gu(e)}function TI(t,e){if(t==="input"||t==="change")return Gu(e)}function II(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Or=typeof Object.is=="function"?Object.is:II;function Dl(t,e){if(Or(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!Yh.call(e,s)||!Or(t[s],e[s]))return!1}return!0}function ky(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Ry(t,e){var n=ky(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=ky(n)}}function n1(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?n1(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function r1(){for(var t=window,e=Vd();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Vd(t.document)}return e}function Fg(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function wI(t){var e=r1(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&n1(n.ownerDocument.documentElement,n)){if(r!==null&&Fg(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=Ry(n,i);var o=Ry(n,r);s&&o&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var CI=fs&&"documentMode"in document&&11>=document.documentMode,Eo=null,fp=null,ul=null,hp=!1;function Ay(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;hp||Eo==null||Eo!==Vd(r)||(r=Eo,"selectionStart"in r&&Fg(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),ul&&Dl(ul,r)||(ul=r,r=Zd(fp,"onSelect"),0<r.length&&(e=new Ng("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=Eo)))}function td(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var So={animationend:td("Animation","AnimationEnd"),animationiteration:td("Animation","AnimationIteration"),animationstart:td("Animation","AnimationStart"),transitionend:td("Transition","TransitionEnd")},ph={},s1={};fs&&(s1=document.createElement("div").style,"AnimationEvent"in window||(delete So.animationend.animation,delete So.animationiteration.animation,delete So.animationstart.animation),"TransitionEvent"in window||delete So.transitionend.transition);function Vu(t){if(ph[t])return ph[t];if(!So[t])return t;var e=So[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in s1)return ph[t]=e[n];return t}var i1=Vu("animationend"),o1=Vu("animationiteration"),a1=Vu("animationstart"),l1=Vu("transitionend"),c1=new Map,Py="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function fi(t,e){c1.set(t,e),Ki(e,[t])}for(var gh=0;gh<Py.length;gh++){var mh=Py[gh],kI=mh.toLowerCase(),RI=mh[0].toUpperCase()+mh.slice(1);fi(kI,"on"+RI)}fi(i1,"onAnimationEnd");fi(o1,"onAnimationIteration");fi(a1,"onAnimationStart");fi("dblclick","onDoubleClick");fi("focusin","onFocus");fi("focusout","onBlur");fi(l1,"onTransitionEnd");Vo("onMouseEnter",["mouseout","mouseover"]);Vo("onMouseLeave",["mouseout","mouseover"]);Vo("onPointerEnter",["pointerout","pointerover"]);Vo("onPointerLeave",["pointerout","pointerover"]);Ki("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ki("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ki("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ki("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ki("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ki("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var rl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),AI=new Set("cancel close invalid load scroll toggle".split(" ").concat(rl));function Oy(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,kT(r,e,void 0,t),t.currentTarget=null}function d1(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var l=r[o],c=l.instance,d=l.currentTarget;if(l=l.listener,c!==i&&s.isPropagationStopped())break e;Oy(s,l,d),i=c}else for(o=0;o<r.length;o++){if(l=r[o],c=l.instance,d=l.currentTarget,l=l.listener,c!==i&&s.isPropagationStopped())break e;Oy(s,l,d),i=c}}}if(Kd)throw t=lp,Kd=!1,lp=null,t}function Nt(t,e){var n=e[vp];n===void 0&&(n=e[vp]=new Set);var r=t+"__bubble";n.has(r)||(u1(e,t,2,!1),n.add(r))}function yh(t,e,n){var r=0;e&&(r|=4),u1(n,t,r,e)}var nd="_reactListening"+Math.random().toString(36).slice(2);function Ml(t){if(!t[nd]){t[nd]=!0,v_.forEach(function(n){n!=="selectionchange"&&(AI.has(n)||yh(n,!1,t),yh(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[nd]||(e[nd]=!0,yh("selectionchange",!1,e))}}function u1(t,e,n,r){switch(K_(e)){case 1:var s=WT;break;case 4:s=GT;break;default:s=Dg}n=s.bind(null,e,n,t),s=void 0,!ap||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function vh(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var l=r.stateNode.containerInfo;if(l===s||l.nodeType===8&&l.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===s||c.nodeType===8&&c.parentNode===s))return;o=o.return}for(;l!==null;){if(o=Ai(l),o===null)return;if(c=o.tag,c===5||c===6){r=i=o;continue e}l=l.parentNode}}r=r.return}D_(function(){var d=i,u=Ag(n),p=[];e:{var f=c1.get(t);if(f!==void 0){var b=Ng,I=t;switch(t){case"keypress":if(Id(n)===0)break e;case"keydown":case"keyup":b=oI;break;case"focusin":I="focus",b=uh;break;case"focusout":I="blur",b=uh;break;case"beforeblur":case"afterblur":b=uh;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":b=_y;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":b=KT;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":b=cI;break;case i1:case o1:case a1:b=QT;break;case l1:b=uI;break;case"scroll":b=VT;break;case"wheel":b=hI;break;case"copy":case"cut":case"paste":b=ZT;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":b=Ey}var k=(e&4)!==0,F=!k&&t==="scroll",x=k?f!==null?f+"Capture":null:f;k=[];for(var v=d,T;v!==null;){T=v;var h=T.stateNode;if(T.tag===5&&h!==null&&(T=h,x!==null&&(h=Rl(v,x),h!=null&&k.push(Nl(v,h,T)))),F)break;v=v.return}0<k.length&&(f=new b(f,I,null,n,u),p.push({event:f,listeners:k}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",b=t==="mouseout"||t==="pointerout",f&&n!==ip&&(I=n.relatedTarget||n.fromElement)&&(Ai(I)||I[hs]))break e;if((b||f)&&(f=u.window===u?u:(f=u.ownerDocument)?f.defaultView||f.parentWindow:window,b?(I=n.relatedTarget||n.toElement,b=d,I=I?Ai(I):null,I!==null&&(F=Xi(I),I!==F||I.tag!==5&&I.tag!==6)&&(I=null)):(b=null,I=d),b!==I)){if(k=_y,h="onMouseLeave",x="onMouseEnter",v="mouse",(t==="pointerout"||t==="pointerover")&&(k=Ey,h="onPointerLeave",x="onPointerEnter",v="pointer"),F=b==null?f:To(b),T=I==null?f:To(I),f=new k(h,v+"leave",b,n,u),f.target=F,f.relatedTarget=T,h=null,Ai(u)===d&&(k=new k(x,v+"enter",I,n,u),k.target=T,k.relatedTarget=F,h=k),F=h,b&&I)t:{for(k=b,x=I,v=0,T=k;T;T=go(T))v++;for(T=0,h=x;h;h=go(h))T++;for(;0<v-T;)k=go(k),v--;for(;0<T-v;)x=go(x),T--;for(;v--;){if(k===x||x!==null&&k===x.alternate)break t;k=go(k),x=go(x)}k=null}else k=null;b!==null&&Ly(p,f,b,k,!1),I!==null&&F!==null&&Ly(p,F,I,k,!0)}}e:{if(f=d?To(d):window,b=f.nodeName&&f.nodeName.toLowerCase(),b==="select"||b==="input"&&f.type==="file")var W=_I;else if(Iy(f))if(e1)W=TI;else{W=EI;var G=bI}else(b=f.nodeName)&&b.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(W=SI);if(W&&(W=W(t,d))){Z_(p,W,n,u);break e}G&&G(t,f,d),t==="focusout"&&(G=f._wrapperState)&&G.controlled&&f.type==="number"&&ep(f,"number",f.value)}switch(G=d?To(d):window,t){case"focusin":(Iy(G)||G.contentEditable==="true")&&(Eo=G,fp=d,ul=null);break;case"focusout":ul=fp=Eo=null;break;case"mousedown":hp=!0;break;case"contextmenu":case"mouseup":case"dragend":hp=!1,Ay(p,n,u);break;case"selectionchange":if(CI)break;case"keydown":case"keyup":Ay(p,n,u)}var ce;if($g)e:{switch(t){case"compositionstart":var N="onCompositionStart";break e;case"compositionend":N="onCompositionEnd";break e;case"compositionupdate":N="onCompositionUpdate";break e}N=void 0}else bo?Q_(t,n)&&(N="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(N="onCompositionStart");N&&(J_&&n.locale!=="ko"&&(bo||N!=="onCompositionStart"?N==="onCompositionEnd"&&bo&&(ce=X_()):(Us=u,Mg="value"in Us?Us.value:Us.textContent,bo=!0)),G=Zd(d,N),0<G.length&&(N=new by(N,t,null,n,u),p.push({event:N,listeners:G}),ce?N.data=ce:(ce=q_(n),ce!==null&&(N.data=ce)))),(ce=gI?mI(t,n):yI(t,n))&&(d=Zd(d,"onBeforeInput"),0<d.length&&(u=new by("onBeforeInput","beforeinput",null,n,u),p.push({event:u,listeners:d}),u.data=ce))}d1(p,e)})}function Nl(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Zd(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=Rl(t,n),i!=null&&r.unshift(Nl(t,i,s)),i=Rl(t,e),i!=null&&r.push(Nl(t,i,s))),t=t.return}return r}function go(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Ly(t,e,n,r,s){for(var i=e._reactName,o=[];n!==null&&n!==r;){var l=n,c=l.alternate,d=l.stateNode;if(c!==null&&c===r)break;l.tag===5&&d!==null&&(l=d,s?(c=Rl(n,i),c!=null&&o.unshift(Nl(n,c,l))):s||(c=Rl(n,i),c!=null&&o.push(Nl(n,c,l)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var PI=/\r\n?/g,OI=/\u0000|\uFFFD/g;function Dy(t){return(typeof t=="string"?t:""+t).replace(PI,`
`).replace(OI,"")}function rd(t,e,n){if(e=Dy(e),Dy(t)!==e&&n)throw Error(he(425))}function eu(){}var pp=null,gp=null;function mp(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var yp=typeof setTimeout=="function"?setTimeout:void 0,LI=typeof clearTimeout=="function"?clearTimeout:void 0,My=typeof Promise=="function"?Promise:void 0,DI=typeof queueMicrotask=="function"?queueMicrotask:typeof My<"u"?function(t){return My.resolve(null).then(t).catch(MI)}:yp;function MI(t){setTimeout(function(){throw t})}function xh(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),Ol(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);Ol(e)}function Ks(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Ny(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var ca=Math.random().toString(36).slice(2),Fr="__reactFiber$"+ca,jl="__reactProps$"+ca,hs="__reactContainer$"+ca,vp="__reactEvents$"+ca,NI="__reactListeners$"+ca,jI="__reactHandles$"+ca;function Ai(t){var e=t[Fr];if(e)return e;for(var n=t.parentNode;n;){if(e=n[hs]||n[Fr]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Ny(t);t!==null;){if(n=t[Fr])return n;t=Ny(t)}return e}t=n,n=t.parentNode}return null}function ac(t){return t=t[Fr]||t[hs],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function To(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(he(33))}function Yu(t){return t[jl]||null}var xp=[],Io=-1;function hi(t){return{current:t}}function jt(t){0>Io||(t.current=xp[Io],xp[Io]=null,Io--)}function Dt(t,e){Io++,xp[Io]=t.current,t.current=e}var oi={},Sn=hi(oi),Gn=hi(!1),Ni=oi;function Yo(t,e){var n=t.type.contextTypes;if(!n)return oi;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function Vn(t){return t=t.childContextTypes,t!=null}function tu(){jt(Gn),jt(Sn)}function jy(t,e,n){if(Sn.current!==oi)throw Error(he(168));Dt(Sn,e),Dt(Gn,n)}function f1(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(he(108,bT(t)||"Unknown",s));return Gt({},n,r)}function nu(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||oi,Ni=Sn.current,Dt(Sn,t),Dt(Gn,Gn.current),!0}function $y(t,e,n){var r=t.stateNode;if(!r)throw Error(he(169));n?(t=f1(t,e,Ni),r.__reactInternalMemoizedMergedChildContext=t,jt(Gn),jt(Sn),Dt(Sn,t)):jt(Gn),Dt(Gn,n)}var ts=null,Ku=!1,_h=!1;function h1(t){ts===null?ts=[t]:ts.push(t)}function $I(t){Ku=!0,h1(t)}function pi(){if(!_h&&ts!==null){_h=!0;var t=0,e=It;try{var n=ts;for(It=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}ts=null,Ku=!1}catch(s){throw ts!==null&&(ts=ts.slice(t+1)),$_(Pg,pi),s}finally{It=e,_h=!1}}return null}var wo=[],Co=0,ru=null,su=0,cr=[],dr=0,ji=null,ss=1,is="";function Ii(t,e){wo[Co++]=su,wo[Co++]=ru,ru=t,su=e}function p1(t,e,n){cr[dr++]=ss,cr[dr++]=is,cr[dr++]=ji,ji=t;var r=ss;t=is;var s=32-Rr(r)-1;r&=~(1<<s),n+=1;var i=32-Rr(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,ss=1<<32-Rr(e)+s|n<<s|r,is=i+t}else ss=1<<i|n<<s|r,is=t}function Ug(t){t.return!==null&&(Ii(t,1),p1(t,1,0))}function Bg(t){for(;t===ru;)ru=wo[--Co],wo[Co]=null,su=wo[--Co],wo[Co]=null;for(;t===ji;)ji=cr[--dr],cr[dr]=null,is=cr[--dr],cr[dr]=null,ss=cr[--dr],cr[dr]=null}var Zn=null,qn=null,Ft=!1,Tr=null;function g1(t,e){var n=fr(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Fy(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Zn=t,qn=Ks(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Zn=t,qn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=ji!==null?{id:ss,overflow:is}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=fr(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Zn=t,qn=null,!0):!1;default:return!1}}function _p(t){return(t.mode&1)!==0&&(t.flags&128)===0}function bp(t){if(Ft){var e=qn;if(e){var n=e;if(!Fy(t,e)){if(_p(t))throw Error(he(418));e=Ks(n.nextSibling);var r=Zn;e&&Fy(t,e)?g1(r,n):(t.flags=t.flags&-4097|2,Ft=!1,Zn=t)}}else{if(_p(t))throw Error(he(418));t.flags=t.flags&-4097|2,Ft=!1,Zn=t}}}function Uy(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Zn=t}function sd(t){if(t!==Zn)return!1;if(!Ft)return Uy(t),Ft=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!mp(t.type,t.memoizedProps)),e&&(e=qn)){if(_p(t))throw m1(),Error(he(418));for(;e;)g1(t,e),e=Ks(e.nextSibling)}if(Uy(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(he(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){qn=Ks(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}qn=null}}else qn=Zn?Ks(t.stateNode.nextSibling):null;return!0}function m1(){for(var t=qn;t;)t=Ks(t.nextSibling)}function Ko(){qn=Zn=null,Ft=!1}function zg(t){Tr===null?Tr=[t]:Tr.push(t)}var FI=xs.ReactCurrentBatchConfig;function Wa(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(he(309));var r=n.stateNode}if(!r)throw Error(he(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var l=s.refs;o===null?delete l[i]:l[i]=o},e._stringRef=i,e)}if(typeof t!="string")throw Error(he(284));if(!n._owner)throw Error(he(290,t))}return t}function id(t,e){throw t=Object.prototype.toString.call(e),Error(he(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function By(t){var e=t._init;return e(t._payload)}function y1(t){function e(x,v){if(t){var T=x.deletions;T===null?(x.deletions=[v],x.flags|=16):T.push(v)}}function n(x,v){if(!t)return null;for(;v!==null;)e(x,v),v=v.sibling;return null}function r(x,v){for(x=new Map;v!==null;)v.key!==null?x.set(v.key,v):x.set(v.index,v),v=v.sibling;return x}function s(x,v){return x=qs(x,v),x.index=0,x.sibling=null,x}function i(x,v,T){return x.index=T,t?(T=x.alternate,T!==null?(T=T.index,T<v?(x.flags|=2,v):T):(x.flags|=2,v)):(x.flags|=1048576,v)}function o(x){return t&&x.alternate===null&&(x.flags|=2),x}function l(x,v,T,h){return v===null||v.tag!==6?(v=Ch(T,x.mode,h),v.return=x,v):(v=s(v,T),v.return=x,v)}function c(x,v,T,h){var W=T.type;return W===_o?u(x,v,T.props.children,h,T.key):v!==null&&(v.elementType===W||typeof W=="object"&&W!==null&&W.$$typeof===Os&&By(W)===v.type)?(h=s(v,T.props),h.ref=Wa(x,v,T),h.return=x,h):(h=Od(T.type,T.key,T.props,null,x.mode,h),h.ref=Wa(x,v,T),h.return=x,h)}function d(x,v,T,h){return v===null||v.tag!==4||v.stateNode.containerInfo!==T.containerInfo||v.stateNode.implementation!==T.implementation?(v=kh(T,x.mode,h),v.return=x,v):(v=s(v,T.children||[]),v.return=x,v)}function u(x,v,T,h,W){return v===null||v.tag!==7?(v=Mi(T,x.mode,h,W),v.return=x,v):(v=s(v,T),v.return=x,v)}function p(x,v,T){if(typeof v=="string"&&v!==""||typeof v=="number")return v=Ch(""+v,x.mode,T),v.return=x,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Kc:return T=Od(v.type,v.key,v.props,null,x.mode,T),T.ref=Wa(x,null,v),T.return=x,T;case xo:return v=kh(v,x.mode,T),v.return=x,v;case Os:var h=v._init;return p(x,h(v._payload),T)}if(tl(v)||Fa(v))return v=Mi(v,x.mode,T,null),v.return=x,v;id(x,v)}return null}function f(x,v,T,h){var W=v!==null?v.key:null;if(typeof T=="string"&&T!==""||typeof T=="number")return W!==null?null:l(x,v,""+T,h);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case Kc:return T.key===W?c(x,v,T,h):null;case xo:return T.key===W?d(x,v,T,h):null;case Os:return W=T._init,f(x,v,W(T._payload),h)}if(tl(T)||Fa(T))return W!==null?null:u(x,v,T,h,null);id(x,T)}return null}function b(x,v,T,h,W){if(typeof h=="string"&&h!==""||typeof h=="number")return x=x.get(T)||null,l(v,x,""+h,W);if(typeof h=="object"&&h!==null){switch(h.$$typeof){case Kc:return x=x.get(h.key===null?T:h.key)||null,c(v,x,h,W);case xo:return x=x.get(h.key===null?T:h.key)||null,d(v,x,h,W);case Os:var G=h._init;return b(x,v,T,G(h._payload),W)}if(tl(h)||Fa(h))return x=x.get(T)||null,u(v,x,h,W,null);id(v,h)}return null}function I(x,v,T,h){for(var W=null,G=null,ce=v,N=v=0,J=null;ce!==null&&N<T.length;N++){ce.index>N?(J=ce,ce=null):J=ce.sibling;var Q=f(x,ce,T[N],h);if(Q===null){ce===null&&(ce=J);break}t&&ce&&Q.alternate===null&&e(x,ce),v=i(Q,v,N),G===null?W=Q:G.sibling=Q,G=Q,ce=J}if(N===T.length)return n(x,ce),Ft&&Ii(x,N),W;if(ce===null){for(;N<T.length;N++)ce=p(x,T[N],h),ce!==null&&(v=i(ce,v,N),G===null?W=ce:G.sibling=ce,G=ce);return Ft&&Ii(x,N),W}for(ce=r(x,ce);N<T.length;N++)J=b(ce,x,N,T[N],h),J!==null&&(t&&J.alternate!==null&&ce.delete(J.key===null?N:J.key),v=i(J,v,N),G===null?W=J:G.sibling=J,G=J);return t&&ce.forEach(function(Ie){return e(x,Ie)}),Ft&&Ii(x,N),W}function k(x,v,T,h){var W=Fa(T);if(typeof W!="function")throw Error(he(150));if(T=W.call(T),T==null)throw Error(he(151));for(var G=W=null,ce=v,N=v=0,J=null,Q=T.next();ce!==null&&!Q.done;N++,Q=T.next()){ce.index>N?(J=ce,ce=null):J=ce.sibling;var Ie=f(x,ce,Q.value,h);if(Ie===null){ce===null&&(ce=J);break}t&&ce&&Ie.alternate===null&&e(x,ce),v=i(Ie,v,N),G===null?W=Ie:G.sibling=Ie,G=Ie,ce=J}if(Q.done)return n(x,ce),Ft&&Ii(x,N),W;if(ce===null){for(;!Q.done;N++,Q=T.next())Q=p(x,Q.value,h),Q!==null&&(v=i(Q,v,N),G===null?W=Q:G.sibling=Q,G=Q);return Ft&&Ii(x,N),W}for(ce=r(x,ce);!Q.done;N++,Q=T.next())Q=b(ce,x,N,Q.value,h),Q!==null&&(t&&Q.alternate!==null&&ce.delete(Q.key===null?N:Q.key),v=i(Q,v,N),G===null?W=Q:G.sibling=Q,G=Q);return t&&ce.forEach(function(Je){return e(x,Je)}),Ft&&Ii(x,N),W}function F(x,v,T,h){if(typeof T=="object"&&T!==null&&T.type===_o&&T.key===null&&(T=T.props.children),typeof T=="object"&&T!==null){switch(T.$$typeof){case Kc:e:{for(var W=T.key,G=v;G!==null;){if(G.key===W){if(W=T.type,W===_o){if(G.tag===7){n(x,G.sibling),v=s(G,T.props.children),v.return=x,x=v;break e}}else if(G.elementType===W||typeof W=="object"&&W!==null&&W.$$typeof===Os&&By(W)===G.type){n(x,G.sibling),v=s(G,T.props),v.ref=Wa(x,G,T),v.return=x,x=v;break e}n(x,G);break}else e(x,G);G=G.sibling}T.type===_o?(v=Mi(T.props.children,x.mode,h,T.key),v.return=x,x=v):(h=Od(T.type,T.key,T.props,null,x.mode,h),h.ref=Wa(x,v,T),h.return=x,x=h)}return o(x);case xo:e:{for(G=T.key;v!==null;){if(v.key===G)if(v.tag===4&&v.stateNode.containerInfo===T.containerInfo&&v.stateNode.implementation===T.implementation){n(x,v.sibling),v=s(v,T.children||[]),v.return=x,x=v;break e}else{n(x,v);break}else e(x,v);v=v.sibling}v=kh(T,x.mode,h),v.return=x,x=v}return o(x);case Os:return G=T._init,F(x,v,G(T._payload),h)}if(tl(T))return I(x,v,T,h);if(Fa(T))return k(x,v,T,h);id(x,T)}return typeof T=="string"&&T!==""||typeof T=="number"?(T=""+T,v!==null&&v.tag===6?(n(x,v.sibling),v=s(v,T),v.return=x,x=v):(n(x,v),v=Ch(T,x.mode,h),v.return=x,x=v),o(x)):n(x,v)}return F}var Xo=y1(!0),v1=y1(!1),iu=hi(null),ou=null,ko=null,Hg=null;function Wg(){Hg=ko=ou=null}function Gg(t){var e=iu.current;jt(iu),t._currentValue=e}function Ep(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function jo(t,e){ou=t,Hg=ko=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Hn=!0),t.firstContext=null)}function mr(t){var e=t._currentValue;if(Hg!==t)if(t={context:t,memoizedValue:e,next:null},ko===null){if(ou===null)throw Error(he(308));ko=t,ou.dependencies={lanes:0,firstContext:t}}else ko=ko.next=t;return e}var Pi=null;function Vg(t){Pi===null?Pi=[t]:Pi.push(t)}function x1(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,Vg(e)):(n.next=s.next,s.next=n),e.interleaved=n,ps(t,r)}function ps(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Ls=!1;function Yg(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function _1(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function cs(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Xs(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,vt&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,ps(t,n)}return s=r.interleaved,s===null?(e.next=e,Vg(r)):(e.next=s.next,s.next=e),r.interleaved=e,ps(t,n)}function wd(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Og(t,n)}}function zy(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=o:i=i.next=o,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function au(t,e,n,r){var s=t.updateQueue;Ls=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,l=s.shared.pending;if(l!==null){s.shared.pending=null;var c=l,d=c.next;c.next=null,o===null?i=d:o.next=d,o=c;var u=t.alternate;u!==null&&(u=u.updateQueue,l=u.lastBaseUpdate,l!==o&&(l===null?u.firstBaseUpdate=d:l.next=d,u.lastBaseUpdate=c))}if(i!==null){var p=s.baseState;o=0,u=d=c=null,l=i;do{var f=l.lane,b=l.eventTime;if((r&f)===f){u!==null&&(u=u.next={eventTime:b,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var I=t,k=l;switch(f=e,b=n,k.tag){case 1:if(I=k.payload,typeof I=="function"){p=I.call(b,p,f);break e}p=I;break e;case 3:I.flags=I.flags&-65537|128;case 0:if(I=k.payload,f=typeof I=="function"?I.call(b,p,f):I,f==null)break e;p=Gt({},p,f);break e;case 2:Ls=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,f=s.effects,f===null?s.effects=[l]:f.push(l))}else b={eventTime:b,lane:f,tag:l.tag,payload:l.payload,callback:l.callback,next:null},u===null?(d=u=b,c=p):u=u.next=b,o|=f;if(l=l.next,l===null){if(l=s.shared.pending,l===null)break;f=l,l=f.next,f.next=null,s.lastBaseUpdate=f,s.shared.pending=null}}while(!0);if(u===null&&(c=p),s.baseState=c,s.firstBaseUpdate=d,s.lastBaseUpdate=u,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);Fi|=o,t.lanes=o,t.memoizedState=p}}function Hy(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(he(191,s));s.call(r)}}}var lc={},Hr=hi(lc),$l=hi(lc),Fl=hi(lc);function Oi(t){if(t===lc)throw Error(he(174));return t}function Kg(t,e){switch(Dt(Fl,e),Dt($l,t),Dt(Hr,lc),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:np(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=np(e,t)}jt(Hr),Dt(Hr,e)}function Jo(){jt(Hr),jt($l),jt(Fl)}function b1(t){Oi(Fl.current);var e=Oi(Hr.current),n=np(e,t.type);e!==n&&(Dt($l,t),Dt(Hr,n))}function Xg(t){$l.current===t&&(jt(Hr),jt($l))}var Bt=hi(0);function lu(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var bh=[];function Jg(){for(var t=0;t<bh.length;t++)bh[t]._workInProgressVersionPrimary=null;bh.length=0}var Cd=xs.ReactCurrentDispatcher,Eh=xs.ReactCurrentBatchConfig,$i=0,Wt=null,qt=null,sn=null,cu=!1,fl=!1,Ul=0,UI=0;function vn(){throw Error(he(321))}function Qg(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Or(t[n],e[n]))return!1;return!0}function qg(t,e,n,r,s,i){if($i=i,Wt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Cd.current=t===null||t.memoizedState===null?WI:GI,t=n(r,s),fl){i=0;do{if(fl=!1,Ul=0,25<=i)throw Error(he(301));i+=1,sn=qt=null,e.updateQueue=null,Cd.current=VI,t=n(r,s)}while(fl)}if(Cd.current=du,e=qt!==null&&qt.next!==null,$i=0,sn=qt=Wt=null,cu=!1,e)throw Error(he(300));return t}function Zg(){var t=Ul!==0;return Ul=0,t}function $r(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return sn===null?Wt.memoizedState=sn=t:sn=sn.next=t,sn}function yr(){if(qt===null){var t=Wt.alternate;t=t!==null?t.memoizedState:null}else t=qt.next;var e=sn===null?Wt.memoizedState:sn.next;if(e!==null)sn=e,qt=t;else{if(t===null)throw Error(he(310));qt=t,t={memoizedState:qt.memoizedState,baseState:qt.baseState,baseQueue:qt.baseQueue,queue:qt.queue,next:null},sn===null?Wt.memoizedState=sn=t:sn=sn.next=t}return sn}function Bl(t,e){return typeof e=="function"?e(t):e}function Sh(t){var e=yr(),n=e.queue;if(n===null)throw Error(he(311));n.lastRenderedReducer=t;var r=qt,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var l=o=null,c=null,d=i;do{var u=d.lane;if(($i&u)===u)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:t(r,d.action);else{var p={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(l=c=p,o=r):c=c.next=p,Wt.lanes|=u,Fi|=u}d=d.next}while(d!==null&&d!==i);c===null?o=r:c.next=l,Or(r,e.memoizedState)||(Hn=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=c,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,Wt.lanes|=i,Fi|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Th(t){var e=yr(),n=e.queue;if(n===null)throw Error(he(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var o=s=s.next;do i=t(i,o.action),o=o.next;while(o!==s);Or(i,e.memoizedState)||(Hn=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function E1(){}function S1(t,e){var n=Wt,r=yr(),s=e(),i=!Or(r.memoizedState,s);if(i&&(r.memoizedState=s,Hn=!0),r=r.queue,e0(w1.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||sn!==null&&sn.memoizedState.tag&1){if(n.flags|=2048,zl(9,I1.bind(null,n,r,s,e),void 0,null),ln===null)throw Error(he(349));$i&30||T1(n,e,s)}return s}function T1(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Wt.updateQueue,e===null?(e={lastEffect:null,stores:null},Wt.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function I1(t,e,n,r){e.value=n,e.getSnapshot=r,C1(e)&&k1(t)}function w1(t,e,n){return n(function(){C1(e)&&k1(t)})}function C1(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Or(t,n)}catch{return!0}}function k1(t){var e=ps(t,1);e!==null&&Ar(e,t,1,-1)}function Wy(t){var e=$r();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Bl,lastRenderedState:t},e.queue=t,t=t.dispatch=HI.bind(null,Wt,t),[e.memoizedState,t]}function zl(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=Wt.updateQueue,e===null?(e={lastEffect:null,stores:null},Wt.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function R1(){return yr().memoizedState}function kd(t,e,n,r){var s=$r();Wt.flags|=t,s.memoizedState=zl(1|e,n,void 0,r===void 0?null:r)}function Xu(t,e,n,r){var s=yr();r=r===void 0?null:r;var i=void 0;if(qt!==null){var o=qt.memoizedState;if(i=o.destroy,r!==null&&Qg(r,o.deps)){s.memoizedState=zl(e,n,i,r);return}}Wt.flags|=t,s.memoizedState=zl(1|e,n,i,r)}function Gy(t,e){return kd(8390656,8,t,e)}function e0(t,e){return Xu(2048,8,t,e)}function A1(t,e){return Xu(4,2,t,e)}function P1(t,e){return Xu(4,4,t,e)}function O1(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function L1(t,e,n){return n=n!=null?n.concat([t]):null,Xu(4,4,O1.bind(null,e,t),n)}function t0(){}function D1(t,e){var n=yr();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Qg(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function M1(t,e){var n=yr();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Qg(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function N1(t,e,n){return $i&21?(Or(n,e)||(n=B_(),Wt.lanes|=n,Fi|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Hn=!0),t.memoizedState=n)}function BI(t,e){var n=It;It=n!==0&&4>n?n:4,t(!0);var r=Eh.transition;Eh.transition={};try{t(!1),e()}finally{It=n,Eh.transition=r}}function j1(){return yr().memoizedState}function zI(t,e,n){var r=Qs(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},$1(t))F1(e,n);else if(n=x1(t,e,n,r),n!==null){var s=An();Ar(n,t,r,s),U1(n,e,r)}}function HI(t,e,n){var r=Qs(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if($1(t))F1(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,l=i(o,n);if(s.hasEagerState=!0,s.eagerState=l,Or(l,o)){var c=e.interleaved;c===null?(s.next=s,Vg(e)):(s.next=c.next,c.next=s),e.interleaved=s;return}}catch{}finally{}n=x1(t,e,s,r),n!==null&&(s=An(),Ar(n,t,r,s),U1(n,e,r))}}function $1(t){var e=t.alternate;return t===Wt||e!==null&&e===Wt}function F1(t,e){fl=cu=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function U1(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Og(t,n)}}var du={readContext:mr,useCallback:vn,useContext:vn,useEffect:vn,useImperativeHandle:vn,useInsertionEffect:vn,useLayoutEffect:vn,useMemo:vn,useReducer:vn,useRef:vn,useState:vn,useDebugValue:vn,useDeferredValue:vn,useTransition:vn,useMutableSource:vn,useSyncExternalStore:vn,useId:vn,unstable_isNewReconciler:!1},WI={readContext:mr,useCallback:function(t,e){return $r().memoizedState=[t,e===void 0?null:e],t},useContext:mr,useEffect:Gy,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,kd(4194308,4,O1.bind(null,e,t),n)},useLayoutEffect:function(t,e){return kd(4194308,4,t,e)},useInsertionEffect:function(t,e){return kd(4,2,t,e)},useMemo:function(t,e){var n=$r();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=$r();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=zI.bind(null,Wt,t),[r.memoizedState,t]},useRef:function(t){var e=$r();return t={current:t},e.memoizedState=t},useState:Wy,useDebugValue:t0,useDeferredValue:function(t){return $r().memoizedState=t},useTransition:function(){var t=Wy(!1),e=t[0];return t=BI.bind(null,t[1]),$r().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=Wt,s=$r();if(Ft){if(n===void 0)throw Error(he(407));n=n()}else{if(n=e(),ln===null)throw Error(he(349));$i&30||T1(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,Gy(w1.bind(null,r,i,t),[t]),r.flags|=2048,zl(9,I1.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=$r(),e=ln.identifierPrefix;if(Ft){var n=is,r=ss;n=(r&~(1<<32-Rr(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=Ul++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=UI++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},GI={readContext:mr,useCallback:D1,useContext:mr,useEffect:e0,useImperativeHandle:L1,useInsertionEffect:A1,useLayoutEffect:P1,useMemo:M1,useReducer:Sh,useRef:R1,useState:function(){return Sh(Bl)},useDebugValue:t0,useDeferredValue:function(t){var e=yr();return N1(e,qt.memoizedState,t)},useTransition:function(){var t=Sh(Bl)[0],e=yr().memoizedState;return[t,e]},useMutableSource:E1,useSyncExternalStore:S1,useId:j1,unstable_isNewReconciler:!1},VI={readContext:mr,useCallback:D1,useContext:mr,useEffect:e0,useImperativeHandle:L1,useInsertionEffect:A1,useLayoutEffect:P1,useMemo:M1,useReducer:Th,useRef:R1,useState:function(){return Th(Bl)},useDebugValue:t0,useDeferredValue:function(t){var e=yr();return qt===null?e.memoizedState=t:N1(e,qt.memoizedState,t)},useTransition:function(){var t=Th(Bl)[0],e=yr().memoizedState;return[t,e]},useMutableSource:E1,useSyncExternalStore:S1,useId:j1,unstable_isNewReconciler:!1};function Er(t,e){if(t&&t.defaultProps){e=Gt({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Sp(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:Gt({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Ju={isMounted:function(t){return(t=t._reactInternals)?Xi(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=An(),s=Qs(t),i=cs(r,s);i.payload=e,n!=null&&(i.callback=n),e=Xs(t,i,s),e!==null&&(Ar(e,t,s,r),wd(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=An(),s=Qs(t),i=cs(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=Xs(t,i,s),e!==null&&(Ar(e,t,s,r),wd(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=An(),r=Qs(t),s=cs(n,r);s.tag=2,e!=null&&(s.callback=e),e=Xs(t,s,r),e!==null&&(Ar(e,t,r,n),wd(e,t,r))}};function Vy(t,e,n,r,s,i,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!Dl(n,r)||!Dl(s,i):!0}function B1(t,e,n){var r=!1,s=oi,i=e.contextType;return typeof i=="object"&&i!==null?i=mr(i):(s=Vn(e)?Ni:Sn.current,r=e.contextTypes,i=(r=r!=null)?Yo(t,s):oi),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Ju,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function Yy(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&Ju.enqueueReplaceState(e,e.state,null)}function Tp(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},Yg(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=mr(i):(i=Vn(e)?Ni:Sn.current,s.context=Yo(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(Sp(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&Ju.enqueueReplaceState(s,s.state,null),au(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function Qo(t,e){try{var n="",r=e;do n+=_T(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function Ih(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Ip(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var YI=typeof WeakMap=="function"?WeakMap:Map;function z1(t,e,n){n=cs(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){fu||(fu=!0,Mp=r),Ip(t,e)},n}function H1(t,e,n){n=cs(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){Ip(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){Ip(t,e),typeof r!="function"&&(Js===null?Js=new Set([this]):Js.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function Ky(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new YI;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=aw.bind(null,t,e,n),e.then(t,t))}function Xy(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Jy(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=cs(-1,1),e.tag=2,Xs(n,e,1))),n.lanes|=1),t)}var KI=xs.ReactCurrentOwner,Hn=!1;function kn(t,e,n,r){e.child=t===null?v1(e,null,n,r):Xo(e,t.child,n,r)}function Qy(t,e,n,r,s){n=n.render;var i=e.ref;return jo(e,s),r=qg(t,e,n,r,i,s),n=Zg(),t!==null&&!Hn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,gs(t,e,s)):(Ft&&n&&Ug(e),e.flags|=1,kn(t,e,r,s),e.child)}function qy(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!c0(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,W1(t,e,i,r,s)):(t=Od(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var o=i.memoizedProps;if(n=n.compare,n=n!==null?n:Dl,n(o,r)&&t.ref===e.ref)return gs(t,e,s)}return e.flags|=1,t=qs(i,r),t.ref=e.ref,t.return=e,e.child=t}function W1(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(Dl(i,r)&&t.ref===e.ref)if(Hn=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(Hn=!0);else return e.lanes=t.lanes,gs(t,e,s)}return wp(t,e,n,r,s)}function G1(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Dt(Ao,Qn),Qn|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Dt(Ao,Qn),Qn|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,Dt(Ao,Qn),Qn|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,Dt(Ao,Qn),Qn|=r;return kn(t,e,s,n),e.child}function V1(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function wp(t,e,n,r,s){var i=Vn(n)?Ni:Sn.current;return i=Yo(e,i),jo(e,s),n=qg(t,e,n,r,i,s),r=Zg(),t!==null&&!Hn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,gs(t,e,s)):(Ft&&r&&Ug(e),e.flags|=1,kn(t,e,n,s),e.child)}function Zy(t,e,n,r,s){if(Vn(n)){var i=!0;nu(e)}else i=!1;if(jo(e,s),e.stateNode===null)Rd(t,e),B1(e,n,r),Tp(e,n,r,s),r=!0;else if(t===null){var o=e.stateNode,l=e.memoizedProps;o.props=l;var c=o.context,d=n.contextType;typeof d=="object"&&d!==null?d=mr(d):(d=Vn(n)?Ni:Sn.current,d=Yo(e,d));var u=n.getDerivedStateFromProps,p=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";p||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==r||c!==d)&&Yy(e,o,r,d),Ls=!1;var f=e.memoizedState;o.state=f,au(e,r,o,s),c=e.memoizedState,l!==r||f!==c||Gn.current||Ls?(typeof u=="function"&&(Sp(e,n,u,r),c=e.memoizedState),(l=Ls||Vy(e,n,l,r,f,c,d))?(p||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),o.props=r,o.state=c,o.context=d,r=l):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,_1(t,e),l=e.memoizedProps,d=e.type===e.elementType?l:Er(e.type,l),o.props=d,p=e.pendingProps,f=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=mr(c):(c=Vn(n)?Ni:Sn.current,c=Yo(e,c));var b=n.getDerivedStateFromProps;(u=typeof b=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==p||f!==c)&&Yy(e,o,r,c),Ls=!1,f=e.memoizedState,o.state=f,au(e,r,o,s);var I=e.memoizedState;l!==p||f!==I||Gn.current||Ls?(typeof b=="function"&&(Sp(e,n,b,r),I=e.memoizedState),(d=Ls||Vy(e,n,d,r,f,I,c)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,I,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,I,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=I),o.props=r,o.state=I,o.context=c,r=d):(typeof o.componentDidUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),r=!1)}return Cp(t,e,n,r,i,s)}function Cp(t,e,n,r,s,i){V1(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&$y(e,n,!1),gs(t,e,i);r=e.stateNode,KI.current=e;var l=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=Xo(e,t.child,null,i),e.child=Xo(e,null,l,i)):kn(t,e,l,i),e.memoizedState=r.state,s&&$y(e,n,!0),e.child}function Y1(t){var e=t.stateNode;e.pendingContext?jy(t,e.pendingContext,e.pendingContext!==e.context):e.context&&jy(t,e.context,!1),Kg(t,e.containerInfo)}function ev(t,e,n,r,s){return Ko(),zg(s),e.flags|=256,kn(t,e,n,r),e.child}var kp={dehydrated:null,treeContext:null,retryLane:0};function Rp(t){return{baseLanes:t,cachePool:null,transitions:null}}function K1(t,e,n){var r=e.pendingProps,s=Bt.current,i=!1,o=(e.flags&128)!==0,l;if((l=o)||(l=t!==null&&t.memoizedState===null?!1:(s&2)!==0),l?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),Dt(Bt,s&1),t===null)return bp(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=Zu(o,r,0,null),t=Mi(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=Rp(n),e.memoizedState=kp,t):n0(e,o));if(s=t.memoizedState,s!==null&&(l=s.dehydrated,l!==null))return XI(t,e,o,r,l,s,n);if(i){i=r.fallback,o=e.mode,s=t.child,l=s.sibling;var c={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=qs(s,c),r.subtreeFlags=s.subtreeFlags&14680064),l!==null?i=qs(l,i):(i=Mi(i,o,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=t.child.memoizedState,o=o===null?Rp(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=t.childLanes&~n,e.memoizedState=kp,r}return i=t.child,t=i.sibling,r=qs(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function n0(t,e){return e=Zu({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function od(t,e,n,r){return r!==null&&zg(r),Xo(e,t.child,null,n),t=n0(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function XI(t,e,n,r,s,i,o){if(n)return e.flags&256?(e.flags&=-257,r=Ih(Error(he(422))),od(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=Zu({mode:"visible",children:r.children},s,0,null),i=Mi(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&Xo(e,t.child,null,o),e.child.memoizedState=Rp(o),e.memoizedState=kp,i);if(!(e.mode&1))return od(t,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var l=r.dgst;return r=l,i=Error(he(419)),r=Ih(i,r,void 0),od(t,e,o,r)}if(l=(o&t.childLanes)!==0,Hn||l){if(r=ln,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,ps(t,s),Ar(r,t,s,-1))}return l0(),r=Ih(Error(he(421))),od(t,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=lw.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,qn=Ks(s.nextSibling),Zn=e,Ft=!0,Tr=null,t!==null&&(cr[dr++]=ss,cr[dr++]=is,cr[dr++]=ji,ss=t.id,is=t.overflow,ji=e),e=n0(e,r.children),e.flags|=4096,e)}function tv(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),Ep(t.return,e,n)}function wh(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function X1(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(kn(t,e,r.children,n),r=Bt.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&tv(t,n,e);else if(t.tag===19)tv(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(Dt(Bt,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&lu(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),wh(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&lu(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}wh(e,!0,n,null,i);break;case"together":wh(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Rd(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function gs(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Fi|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(he(153));if(e.child!==null){for(t=e.child,n=qs(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=qs(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function JI(t,e,n){switch(e.tag){case 3:Y1(e),Ko();break;case 5:b1(e);break;case 1:Vn(e.type)&&nu(e);break;case 4:Kg(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;Dt(iu,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Dt(Bt,Bt.current&1),e.flags|=128,null):n&e.child.childLanes?K1(t,e,n):(Dt(Bt,Bt.current&1),t=gs(t,e,n),t!==null?t.sibling:null);Dt(Bt,Bt.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return X1(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Dt(Bt,Bt.current),r)break;return null;case 22:case 23:return e.lanes=0,G1(t,e,n)}return gs(t,e,n)}var J1,Ap,Q1,q1;J1=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Ap=function(){};Q1=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,Oi(Hr.current);var i=null;switch(n){case"input":s=qh(t,s),r=qh(t,r),i=[];break;case"select":s=Gt({},s,{value:void 0}),r=Gt({},r,{value:void 0}),i=[];break;case"textarea":s=tp(t,s),r=tp(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=eu)}rp(n,r);var o;n=null;for(d in s)if(!r.hasOwnProperty(d)&&s.hasOwnProperty(d)&&s[d]!=null)if(d==="style"){var l=s[d];for(o in l)l.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(Cl.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in r){var c=r[d];if(l=s!=null?s[d]:void 0,r.hasOwnProperty(d)&&c!==l&&(c!=null||l!=null))if(d==="style")if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(i||(i=[]),i.push(d,n)),n=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(i=i||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(Cl.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&Nt("scroll",t),i||l===c||(i=[])):(i=i||[]).push(d,c))}n&&(i=i||[]).push("style",n);var d=i;(e.updateQueue=d)&&(e.flags|=4)}};q1=function(t,e,n,r){n!==r&&(e.flags|=4)};function Ga(t,e){if(!Ft)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function xn(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function QI(t,e,n){var r=e.pendingProps;switch(Bg(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return xn(e),null;case 1:return Vn(e.type)&&tu(),xn(e),null;case 3:return r=e.stateNode,Jo(),jt(Gn),jt(Sn),Jg(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(sd(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Tr!==null&&($p(Tr),Tr=null))),Ap(t,e),xn(e),null;case 5:Xg(e);var s=Oi(Fl.current);if(n=e.type,t!==null&&e.stateNode!=null)Q1(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(he(166));return xn(e),null}if(t=Oi(Hr.current),sd(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[Fr]=e,r[jl]=i,t=(e.mode&1)!==0,n){case"dialog":Nt("cancel",r),Nt("close",r);break;case"iframe":case"object":case"embed":Nt("load",r);break;case"video":case"audio":for(s=0;s<rl.length;s++)Nt(rl[s],r);break;case"source":Nt("error",r);break;case"img":case"image":case"link":Nt("error",r),Nt("load",r);break;case"details":Nt("toggle",r);break;case"input":dy(r,i),Nt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Nt("invalid",r);break;case"textarea":fy(r,i),Nt("invalid",r)}rp(n,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var l=i[o];o==="children"?typeof l=="string"?r.textContent!==l&&(i.suppressHydrationWarning!==!0&&rd(r.textContent,l,t),s=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(i.suppressHydrationWarning!==!0&&rd(r.textContent,l,t),s=["children",""+l]):Cl.hasOwnProperty(o)&&l!=null&&o==="onScroll"&&Nt("scroll",r)}switch(n){case"input":Xc(r),uy(r,i,!0);break;case"textarea":Xc(r),hy(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=eu)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=w_(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[Fr]=e,t[jl]=r,J1(t,e,!1,!1),e.stateNode=t;e:{switch(o=sp(n,r),n){case"dialog":Nt("cancel",t),Nt("close",t),s=r;break;case"iframe":case"object":case"embed":Nt("load",t),s=r;break;case"video":case"audio":for(s=0;s<rl.length;s++)Nt(rl[s],t);s=r;break;case"source":Nt("error",t),s=r;break;case"img":case"image":case"link":Nt("error",t),Nt("load",t),s=r;break;case"details":Nt("toggle",t),s=r;break;case"input":dy(t,r),s=qh(t,r),Nt("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=Gt({},r,{value:void 0}),Nt("invalid",t);break;case"textarea":fy(t,r),s=tp(t,r),Nt("invalid",t);break;default:s=r}rp(n,s),l=s;for(i in l)if(l.hasOwnProperty(i)){var c=l[i];i==="style"?R_(t,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&C_(t,c)):i==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&kl(t,c):typeof c=="number"&&kl(t,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Cl.hasOwnProperty(i)?c!=null&&i==="onScroll"&&Nt("scroll",t):c!=null&&wg(t,i,c,o))}switch(n){case"input":Xc(t),uy(t,r,!1);break;case"textarea":Xc(t),hy(t);break;case"option":r.value!=null&&t.setAttribute("value",""+ii(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?Lo(t,!!r.multiple,i,!1):r.defaultValue!=null&&Lo(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=eu)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return xn(e),null;case 6:if(t&&e.stateNode!=null)q1(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(he(166));if(n=Oi(Fl.current),Oi(Hr.current),sd(e)){if(r=e.stateNode,n=e.memoizedProps,r[Fr]=e,(i=r.nodeValue!==n)&&(t=Zn,t!==null))switch(t.tag){case 3:rd(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&rd(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Fr]=e,e.stateNode=r}return xn(e),null;case 13:if(jt(Bt),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Ft&&qn!==null&&e.mode&1&&!(e.flags&128))m1(),Ko(),e.flags|=98560,i=!1;else if(i=sd(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(he(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(he(317));i[Fr]=e}else Ko(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;xn(e),i=!1}else Tr!==null&&($p(Tr),Tr=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||Bt.current&1?en===0&&(en=3):l0())),e.updateQueue!==null&&(e.flags|=4),xn(e),null);case 4:return Jo(),Ap(t,e),t===null&&Ml(e.stateNode.containerInfo),xn(e),null;case 10:return Gg(e.type._context),xn(e),null;case 17:return Vn(e.type)&&tu(),xn(e),null;case 19:if(jt(Bt),i=e.memoizedState,i===null)return xn(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)Ga(i,!1);else{if(en!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=lu(t),o!==null){for(e.flags|=128,Ga(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,t=o.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Dt(Bt,Bt.current&1|2),e.child}t=t.sibling}i.tail!==null&&Yt()>qo&&(e.flags|=128,r=!0,Ga(i,!1),e.lanes=4194304)}else{if(!r)if(t=lu(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Ga(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!Ft)return xn(e),null}else 2*Yt()-i.renderingStartTime>qo&&n!==1073741824&&(e.flags|=128,r=!0,Ga(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(n=i.last,n!==null?n.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Yt(),e.sibling=null,n=Bt.current,Dt(Bt,r?n&1|2:n&1),e):(xn(e),null);case 22:case 23:return a0(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Qn&1073741824&&(xn(e),e.subtreeFlags&6&&(e.flags|=8192)):xn(e),null;case 24:return null;case 25:return null}throw Error(he(156,e.tag))}function qI(t,e){switch(Bg(e),e.tag){case 1:return Vn(e.type)&&tu(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Jo(),jt(Gn),jt(Sn),Jg(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Xg(e),null;case 13:if(jt(Bt),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(he(340));Ko()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return jt(Bt),null;case 4:return Jo(),null;case 10:return Gg(e.type._context),null;case 22:case 23:return a0(),null;case 24:return null;default:return null}}var ad=!1,bn=!1,ZI=typeof WeakSet=="function"?WeakSet:Set,Ce=null;function Ro(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){Vt(t,e,r)}else n.current=null}function Pp(t,e,n){try{n()}catch(r){Vt(t,e,r)}}var nv=!1;function ew(t,e){if(pp=Qd,t=r1(),Fg(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var o=0,l=-1,c=-1,d=0,u=0,p=t,f=null;t:for(;;){for(var b;p!==n||s!==0&&p.nodeType!==3||(l=o+s),p!==i||r!==0&&p.nodeType!==3||(c=o+r),p.nodeType===3&&(o+=p.nodeValue.length),(b=p.firstChild)!==null;)f=p,p=b;for(;;){if(p===t)break t;if(f===n&&++d===s&&(l=o),f===i&&++u===r&&(c=o),(b=p.nextSibling)!==null)break;p=f,f=p.parentNode}p=b}n=l===-1||c===-1?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(gp={focusedElem:t,selectionRange:n},Qd=!1,Ce=e;Ce!==null;)if(e=Ce,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Ce=t;else for(;Ce!==null;){e=Ce;try{var I=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(I!==null){var k=I.memoizedProps,F=I.memoizedState,x=e.stateNode,v=x.getSnapshotBeforeUpdate(e.elementType===e.type?k:Er(e.type,k),F);x.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var T=e.stateNode.containerInfo;T.nodeType===1?T.textContent="":T.nodeType===9&&T.documentElement&&T.removeChild(T.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(he(163))}}catch(h){Vt(e,e.return,h)}if(t=e.sibling,t!==null){t.return=e.return,Ce=t;break}Ce=e.return}return I=nv,nv=!1,I}function hl(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&Pp(e,n,i)}s=s.next}while(s!==r)}}function Qu(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Op(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function Z1(t){var e=t.alternate;e!==null&&(t.alternate=null,Z1(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Fr],delete e[jl],delete e[vp],delete e[NI],delete e[jI])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function eb(t){return t.tag===5||t.tag===3||t.tag===4}function rv(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||eb(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Lp(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=eu));else if(r!==4&&(t=t.child,t!==null))for(Lp(t,e,n),t=t.sibling;t!==null;)Lp(t,e,n),t=t.sibling}function Dp(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Dp(t,e,n),t=t.sibling;t!==null;)Dp(t,e,n),t=t.sibling}var hn=null,Sr=!1;function As(t,e,n){for(n=n.child;n!==null;)tb(t,e,n),n=n.sibling}function tb(t,e,n){if(zr&&typeof zr.onCommitFiberUnmount=="function")try{zr.onCommitFiberUnmount(Hu,n)}catch{}switch(n.tag){case 5:bn||Ro(n,e);case 6:var r=hn,s=Sr;hn=null,As(t,e,n),hn=r,Sr=s,hn!==null&&(Sr?(t=hn,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):hn.removeChild(n.stateNode));break;case 18:hn!==null&&(Sr?(t=hn,n=n.stateNode,t.nodeType===8?xh(t.parentNode,n):t.nodeType===1&&xh(t,n),Ol(t)):xh(hn,n.stateNode));break;case 4:r=hn,s=Sr,hn=n.stateNode.containerInfo,Sr=!0,As(t,e,n),hn=r,Sr=s;break;case 0:case 11:case 14:case 15:if(!bn&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&Pp(n,e,o),s=s.next}while(s!==r)}As(t,e,n);break;case 1:if(!bn&&(Ro(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(l){Vt(n,e,l)}As(t,e,n);break;case 21:As(t,e,n);break;case 22:n.mode&1?(bn=(r=bn)||n.memoizedState!==null,As(t,e,n),bn=r):As(t,e,n);break;default:As(t,e,n)}}function sv(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new ZI),e.forEach(function(r){var s=cw.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function br(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,o=e,l=o;e:for(;l!==null;){switch(l.tag){case 5:hn=l.stateNode,Sr=!1;break e;case 3:hn=l.stateNode.containerInfo,Sr=!0;break e;case 4:hn=l.stateNode.containerInfo,Sr=!0;break e}l=l.return}if(hn===null)throw Error(he(160));tb(i,o,s),hn=null,Sr=!1;var c=s.alternate;c!==null&&(c.return=null),s.return=null}catch(d){Vt(s,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)nb(e,t),e=e.sibling}function nb(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(br(e,t),jr(t),r&4){try{hl(3,t,t.return),Qu(3,t)}catch(k){Vt(t,t.return,k)}try{hl(5,t,t.return)}catch(k){Vt(t,t.return,k)}}break;case 1:br(e,t),jr(t),r&512&&n!==null&&Ro(n,n.return);break;case 5:if(br(e,t),jr(t),r&512&&n!==null&&Ro(n,n.return),t.flags&32){var s=t.stateNode;try{kl(s,"")}catch(k){Vt(t,t.return,k)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,o=n!==null?n.memoizedProps:i,l=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{l==="input"&&i.type==="radio"&&i.name!=null&&T_(s,i),sp(l,o);var d=sp(l,i);for(o=0;o<c.length;o+=2){var u=c[o],p=c[o+1];u==="style"?R_(s,p):u==="dangerouslySetInnerHTML"?C_(s,p):u==="children"?kl(s,p):wg(s,u,p,d)}switch(l){case"input":Zh(s,i);break;case"textarea":I_(s,i);break;case"select":var f=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var b=i.value;b!=null?Lo(s,!!i.multiple,b,!1):f!==!!i.multiple&&(i.defaultValue!=null?Lo(s,!!i.multiple,i.defaultValue,!0):Lo(s,!!i.multiple,i.multiple?[]:"",!1))}s[jl]=i}catch(k){Vt(t,t.return,k)}}break;case 6:if(br(e,t),jr(t),r&4){if(t.stateNode===null)throw Error(he(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(k){Vt(t,t.return,k)}}break;case 3:if(br(e,t),jr(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Ol(e.containerInfo)}catch(k){Vt(t,t.return,k)}break;case 4:br(e,t),jr(t);break;case 13:br(e,t),jr(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(i0=Yt())),r&4&&sv(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(bn=(d=bn)||u,br(e,t),bn=d):br(e,t),jr(t),r&8192){if(d=t.memoizedState!==null,(t.stateNode.isHidden=d)&&!u&&t.mode&1)for(Ce=t,u=t.child;u!==null;){for(p=Ce=u;Ce!==null;){switch(f=Ce,b=f.child,f.tag){case 0:case 11:case 14:case 15:hl(4,f,f.return);break;case 1:Ro(f,f.return);var I=f.stateNode;if(typeof I.componentWillUnmount=="function"){r=f,n=f.return;try{e=r,I.props=e.memoizedProps,I.state=e.memoizedState,I.componentWillUnmount()}catch(k){Vt(r,n,k)}}break;case 5:Ro(f,f.return);break;case 22:if(f.memoizedState!==null){ov(p);continue}}b!==null?(b.return=f,Ce=b):ov(p)}u=u.sibling}e:for(u=null,p=t;;){if(p.tag===5){if(u===null){u=p;try{s=p.stateNode,d?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(l=p.stateNode,c=p.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=k_("display",o))}catch(k){Vt(t,t.return,k)}}}else if(p.tag===6){if(u===null)try{p.stateNode.nodeValue=d?"":p.memoizedProps}catch(k){Vt(t,t.return,k)}}else if((p.tag!==22&&p.tag!==23||p.memoizedState===null||p===t)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===t)break e;for(;p.sibling===null;){if(p.return===null||p.return===t)break e;u===p&&(u=null),p=p.return}u===p&&(u=null),p.sibling.return=p.return,p=p.sibling}}break;case 19:br(e,t),jr(t),r&4&&sv(t);break;case 21:break;default:br(e,t),jr(t)}}function jr(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(eb(n)){var r=n;break e}n=n.return}throw Error(he(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(kl(s,""),r.flags&=-33);var i=rv(t);Dp(t,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,l=rv(t);Lp(t,l,o);break;default:throw Error(he(161))}}catch(c){Vt(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function tw(t,e,n){Ce=t,rb(t)}function rb(t,e,n){for(var r=(t.mode&1)!==0;Ce!==null;){var s=Ce,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||ad;if(!o){var l=s.alternate,c=l!==null&&l.memoizedState!==null||bn;l=ad;var d=bn;if(ad=o,(bn=c)&&!d)for(Ce=s;Ce!==null;)o=Ce,c=o.child,o.tag===22&&o.memoizedState!==null?av(s):c!==null?(c.return=o,Ce=c):av(s);for(;i!==null;)Ce=i,rb(i),i=i.sibling;Ce=s,ad=l,bn=d}iv(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,Ce=i):iv(t)}}function iv(t){for(;Ce!==null;){var e=Ce;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:bn||Qu(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!bn)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:Er(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&Hy(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Hy(e,o,n)}break;case 5:var l=e.stateNode;if(n===null&&e.flags&4){n=l;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var u=d.memoizedState;if(u!==null){var p=u.dehydrated;p!==null&&Ol(p)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(he(163))}bn||e.flags&512&&Op(e)}catch(f){Vt(e,e.return,f)}}if(e===t){Ce=null;break}if(n=e.sibling,n!==null){n.return=e.return,Ce=n;break}Ce=e.return}}function ov(t){for(;Ce!==null;){var e=Ce;if(e===t){Ce=null;break}var n=e.sibling;if(n!==null){n.return=e.return,Ce=n;break}Ce=e.return}}function av(t){for(;Ce!==null;){var e=Ce;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Qu(4,e)}catch(c){Vt(e,n,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(c){Vt(e,s,c)}}var i=e.return;try{Op(e)}catch(c){Vt(e,i,c)}break;case 5:var o=e.return;try{Op(e)}catch(c){Vt(e,o,c)}}}catch(c){Vt(e,e.return,c)}if(e===t){Ce=null;break}var l=e.sibling;if(l!==null){l.return=e.return,Ce=l;break}Ce=e.return}}var nw=Math.ceil,uu=xs.ReactCurrentDispatcher,r0=xs.ReactCurrentOwner,gr=xs.ReactCurrentBatchConfig,vt=0,ln=null,Jt=null,pn=0,Qn=0,Ao=hi(0),en=0,Hl=null,Fi=0,qu=0,s0=0,pl=null,Bn=null,i0=0,qo=1/0,es=null,fu=!1,Mp=null,Js=null,ld=!1,Bs=null,hu=0,gl=0,Np=null,Ad=-1,Pd=0;function An(){return vt&6?Yt():Ad!==-1?Ad:Ad=Yt()}function Qs(t){return t.mode&1?vt&2&&pn!==0?pn&-pn:FI.transition!==null?(Pd===0&&(Pd=B_()),Pd):(t=It,t!==0||(t=window.event,t=t===void 0?16:K_(t.type)),t):1}function Ar(t,e,n,r){if(50<gl)throw gl=0,Np=null,Error(he(185));ic(t,n,r),(!(vt&2)||t!==ln)&&(t===ln&&(!(vt&2)&&(qu|=n),en===4&&Ms(t,pn)),Yn(t,r),n===1&&vt===0&&!(e.mode&1)&&(qo=Yt()+500,Ku&&pi()))}function Yn(t,e){var n=t.callbackNode;FT(t,e);var r=Jd(t,t===ln?pn:0);if(r===0)n!==null&&my(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&my(n),e===1)t.tag===0?$I(lv.bind(null,t)):h1(lv.bind(null,t)),DI(function(){!(vt&6)&&pi()}),n=null;else{switch(z_(r)){case 1:n=Pg;break;case 4:n=F_;break;case 16:n=Xd;break;case 536870912:n=U_;break;default:n=Xd}n=ub(n,sb.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function sb(t,e){if(Ad=-1,Pd=0,vt&6)throw Error(he(327));var n=t.callbackNode;if($o()&&t.callbackNode!==n)return null;var r=Jd(t,t===ln?pn:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=pu(t,r);else{e=r;var s=vt;vt|=2;var i=ob();(ln!==t||pn!==e)&&(es=null,qo=Yt()+500,Di(t,e));do try{iw();break}catch(l){ib(t,l)}while(!0);Wg(),uu.current=i,vt=s,Jt!==null?e=0:(ln=null,pn=0,e=en)}if(e!==0){if(e===2&&(s=cp(t),s!==0&&(r=s,e=jp(t,s))),e===1)throw n=Hl,Di(t,0),Ms(t,r),Yn(t,Yt()),n;if(e===6)Ms(t,r);else{if(s=t.current.alternate,!(r&30)&&!rw(s)&&(e=pu(t,r),e===2&&(i=cp(t),i!==0&&(r=i,e=jp(t,i))),e===1))throw n=Hl,Di(t,0),Ms(t,r),Yn(t,Yt()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(he(345));case 2:wi(t,Bn,es);break;case 3:if(Ms(t,r),(r&130023424)===r&&(e=i0+500-Yt(),10<e)){if(Jd(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){An(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=yp(wi.bind(null,t,Bn,es),e);break}wi(t,Bn,es);break;case 4:if(Ms(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var o=31-Rr(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=Yt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*nw(r/1960))-r,10<r){t.timeoutHandle=yp(wi.bind(null,t,Bn,es),r);break}wi(t,Bn,es);break;case 5:wi(t,Bn,es);break;default:throw Error(he(329))}}}return Yn(t,Yt()),t.callbackNode===n?sb.bind(null,t):null}function jp(t,e){var n=pl;return t.current.memoizedState.isDehydrated&&(Di(t,e).flags|=256),t=pu(t,e),t!==2&&(e=Bn,Bn=n,e!==null&&$p(e)),t}function $p(t){Bn===null?Bn=t:Bn.push.apply(Bn,t)}function rw(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!Or(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Ms(t,e){for(e&=~s0,e&=~qu,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Rr(e),r=1<<n;t[n]=-1,e&=~r}}function lv(t){if(vt&6)throw Error(he(327));$o();var e=Jd(t,0);if(!(e&1))return Yn(t,Yt()),null;var n=pu(t,e);if(t.tag!==0&&n===2){var r=cp(t);r!==0&&(e=r,n=jp(t,r))}if(n===1)throw n=Hl,Di(t,0),Ms(t,e),Yn(t,Yt()),n;if(n===6)throw Error(he(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,wi(t,Bn,es),Yn(t,Yt()),null}function o0(t,e){var n=vt;vt|=1;try{return t(e)}finally{vt=n,vt===0&&(qo=Yt()+500,Ku&&pi())}}function Ui(t){Bs!==null&&Bs.tag===0&&!(vt&6)&&$o();var e=vt;vt|=1;var n=gr.transition,r=It;try{if(gr.transition=null,It=1,t)return t()}finally{It=r,gr.transition=n,vt=e,!(vt&6)&&pi()}}function a0(){Qn=Ao.current,jt(Ao)}function Di(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,LI(n)),Jt!==null)for(n=Jt.return;n!==null;){var r=n;switch(Bg(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&tu();break;case 3:Jo(),jt(Gn),jt(Sn),Jg();break;case 5:Xg(r);break;case 4:Jo();break;case 13:jt(Bt);break;case 19:jt(Bt);break;case 10:Gg(r.type._context);break;case 22:case 23:a0()}n=n.return}if(ln=t,Jt=t=qs(t.current,null),pn=Qn=e,en=0,Hl=null,s0=qu=Fi=0,Bn=pl=null,Pi!==null){for(e=0;e<Pi.length;e++)if(n=Pi[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}n.pending=r}Pi=null}return t}function ib(t,e){do{var n=Jt;try{if(Wg(),Cd.current=du,cu){for(var r=Wt.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}cu=!1}if($i=0,sn=qt=Wt=null,fl=!1,Ul=0,r0.current=null,n===null||n.return===null){en=1,Hl=e,Jt=null;break}e:{var i=t,o=n.return,l=n,c=e;if(e=pn,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,u=l,p=u.tag;if(!(u.mode&1)&&(p===0||p===11||p===15)){var f=u.alternate;f?(u.updateQueue=f.updateQueue,u.memoizedState=f.memoizedState,u.lanes=f.lanes):(u.updateQueue=null,u.memoizedState=null)}var b=Xy(o);if(b!==null){b.flags&=-257,Jy(b,o,l,i,e),b.mode&1&&Ky(i,d,e),e=b,c=d;var I=e.updateQueue;if(I===null){var k=new Set;k.add(c),e.updateQueue=k}else I.add(c);break e}else{if(!(e&1)){Ky(i,d,e),l0();break e}c=Error(he(426))}}else if(Ft&&l.mode&1){var F=Xy(o);if(F!==null){!(F.flags&65536)&&(F.flags|=256),Jy(F,o,l,i,e),zg(Qo(c,l));break e}}i=c=Qo(c,l),en!==4&&(en=2),pl===null?pl=[i]:pl.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var x=z1(i,c,e);zy(i,x);break e;case 1:l=c;var v=i.type,T=i.stateNode;if(!(i.flags&128)&&(typeof v.getDerivedStateFromError=="function"||T!==null&&typeof T.componentDidCatch=="function"&&(Js===null||!Js.has(T)))){i.flags|=65536,e&=-e,i.lanes|=e;var h=H1(i,l,e);zy(i,h);break e}}i=i.return}while(i!==null)}lb(n)}catch(W){e=W,Jt===n&&n!==null&&(Jt=n=n.return);continue}break}while(!0)}function ob(){var t=uu.current;return uu.current=du,t===null?du:t}function l0(){(en===0||en===3||en===2)&&(en=4),ln===null||!(Fi&268435455)&&!(qu&268435455)||Ms(ln,pn)}function pu(t,e){var n=vt;vt|=2;var r=ob();(ln!==t||pn!==e)&&(es=null,Di(t,e));do try{sw();break}catch(s){ib(t,s)}while(!0);if(Wg(),vt=n,uu.current=r,Jt!==null)throw Error(he(261));return ln=null,pn=0,en}function sw(){for(;Jt!==null;)ab(Jt)}function iw(){for(;Jt!==null&&!AT();)ab(Jt)}function ab(t){var e=db(t.alternate,t,Qn);t.memoizedProps=t.pendingProps,e===null?lb(t):Jt=e,r0.current=null}function lb(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=qI(n,e),n!==null){n.flags&=32767,Jt=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{en=6,Jt=null;return}}else if(n=QI(n,e,Qn),n!==null){Jt=n;return}if(e=e.sibling,e!==null){Jt=e;return}Jt=e=t}while(e!==null);en===0&&(en=5)}function wi(t,e,n){var r=It,s=gr.transition;try{gr.transition=null,It=1,ow(t,e,n,r)}finally{gr.transition=s,It=r}return null}function ow(t,e,n,r){do $o();while(Bs!==null);if(vt&6)throw Error(he(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(he(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(UT(t,i),t===ln&&(Jt=ln=null,pn=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||ld||(ld=!0,ub(Xd,function(){return $o(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=gr.transition,gr.transition=null;var o=It;It=1;var l=vt;vt|=4,r0.current=null,ew(t,n),nb(n,t),wI(gp),Qd=!!pp,gp=pp=null,t.current=n,tw(n),PT(),vt=l,It=o,gr.transition=i}else t.current=n;if(ld&&(ld=!1,Bs=t,hu=s),i=t.pendingLanes,i===0&&(Js=null),DT(n.stateNode),Yn(t,Yt()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(fu)throw fu=!1,t=Mp,Mp=null,t;return hu&1&&t.tag!==0&&$o(),i=t.pendingLanes,i&1?t===Np?gl++:(gl=0,Np=t):gl=0,pi(),null}function $o(){if(Bs!==null){var t=z_(hu),e=gr.transition,n=It;try{if(gr.transition=null,It=16>t?16:t,Bs===null)var r=!1;else{if(t=Bs,Bs=null,hu=0,vt&6)throw Error(he(331));var s=vt;for(vt|=4,Ce=t.current;Ce!==null;){var i=Ce,o=i.child;if(Ce.flags&16){var l=i.deletions;if(l!==null){for(var c=0;c<l.length;c++){var d=l[c];for(Ce=d;Ce!==null;){var u=Ce;switch(u.tag){case 0:case 11:case 15:hl(8,u,i)}var p=u.child;if(p!==null)p.return=u,Ce=p;else for(;Ce!==null;){u=Ce;var f=u.sibling,b=u.return;if(Z1(u),u===d){Ce=null;break}if(f!==null){f.return=b,Ce=f;break}Ce=b}}}var I=i.alternate;if(I!==null){var k=I.child;if(k!==null){I.child=null;do{var F=k.sibling;k.sibling=null,k=F}while(k!==null)}}Ce=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,Ce=o;else e:for(;Ce!==null;){if(i=Ce,i.flags&2048)switch(i.tag){case 0:case 11:case 15:hl(9,i,i.return)}var x=i.sibling;if(x!==null){x.return=i.return,Ce=x;break e}Ce=i.return}}var v=t.current;for(Ce=v;Ce!==null;){o=Ce;var T=o.child;if(o.subtreeFlags&2064&&T!==null)T.return=o,Ce=T;else e:for(o=v;Ce!==null;){if(l=Ce,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:Qu(9,l)}}catch(W){Vt(l,l.return,W)}if(l===o){Ce=null;break e}var h=l.sibling;if(h!==null){h.return=l.return,Ce=h;break e}Ce=l.return}}if(vt=s,pi(),zr&&typeof zr.onPostCommitFiberRoot=="function")try{zr.onPostCommitFiberRoot(Hu,t)}catch{}r=!0}return r}finally{It=n,gr.transition=e}}return!1}function cv(t,e,n){e=Qo(n,e),e=z1(t,e,1),t=Xs(t,e,1),e=An(),t!==null&&(ic(t,1,e),Yn(t,e))}function Vt(t,e,n){if(t.tag===3)cv(t,t,n);else for(;e!==null;){if(e.tag===3){cv(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Js===null||!Js.has(r))){t=Qo(n,t),t=H1(e,t,1),e=Xs(e,t,1),t=An(),e!==null&&(ic(e,1,t),Yn(e,t));break}}e=e.return}}function aw(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=An(),t.pingedLanes|=t.suspendedLanes&n,ln===t&&(pn&n)===n&&(en===4||en===3&&(pn&130023424)===pn&&500>Yt()-i0?Di(t,0):s0|=n),Yn(t,e)}function cb(t,e){e===0&&(t.mode&1?(e=qc,qc<<=1,!(qc&130023424)&&(qc=4194304)):e=1);var n=An();t=ps(t,e),t!==null&&(ic(t,e,n),Yn(t,n))}function lw(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),cb(t,n)}function cw(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(he(314))}r!==null&&r.delete(e),cb(t,n)}var db;db=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Gn.current)Hn=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Hn=!1,JI(t,e,n);Hn=!!(t.flags&131072)}else Hn=!1,Ft&&e.flags&1048576&&p1(e,su,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Rd(t,e),t=e.pendingProps;var s=Yo(e,Sn.current);jo(e,n),s=qg(null,e,r,t,s,n);var i=Zg();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Vn(r)?(i=!0,nu(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Yg(e),s.updater=Ju,e.stateNode=s,s._reactInternals=e,Tp(e,r,t,n),e=Cp(null,e,r,!0,i,n)):(e.tag=0,Ft&&i&&Ug(e),kn(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(Rd(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=uw(r),t=Er(r,t),s){case 0:e=wp(null,e,r,t,n);break e;case 1:e=Zy(null,e,r,t,n);break e;case 11:e=Qy(null,e,r,t,n);break e;case 14:e=qy(null,e,r,Er(r.type,t),n);break e}throw Error(he(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Er(r,s),wp(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Er(r,s),Zy(t,e,r,s,n);case 3:e:{if(Y1(e),t===null)throw Error(he(387));r=e.pendingProps,i=e.memoizedState,s=i.element,_1(t,e),au(e,r,null,n);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=Qo(Error(he(423)),e),e=ev(t,e,r,n,s);break e}else if(r!==s){s=Qo(Error(he(424)),e),e=ev(t,e,r,n,s);break e}else for(qn=Ks(e.stateNode.containerInfo.firstChild),Zn=e,Ft=!0,Tr=null,n=v1(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Ko(),r===s){e=gs(t,e,n);break e}kn(t,e,r,n)}e=e.child}return e;case 5:return b1(e),t===null&&bp(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,o=s.children,mp(r,s)?o=null:i!==null&&mp(r,i)&&(e.flags|=32),V1(t,e),kn(t,e,o,n),e.child;case 6:return t===null&&bp(e),null;case 13:return K1(t,e,n);case 4:return Kg(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Xo(e,null,r,n):kn(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Er(r,s),Qy(t,e,r,s,n);case 7:return kn(t,e,e.pendingProps,n),e.child;case 8:return kn(t,e,e.pendingProps.children,n),e.child;case 12:return kn(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,Dt(iu,r._currentValue),r._currentValue=o,i!==null)if(Or(i.value,o)){if(i.children===s.children&&!Gn.current){e=gs(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var l=i.dependencies;if(l!==null){o=i.child;for(var c=l.firstContext;c!==null;){if(c.context===r){if(i.tag===1){c=cs(-1,n&-n),c.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var u=d.pending;u===null?c.next=c:(c.next=u.next,u.next=c),d.pending=c}}i.lanes|=n,c=i.alternate,c!==null&&(c.lanes|=n),Ep(i.return,n,e),l.lanes|=n;break}c=c.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(he(341));o.lanes|=n,l=o.alternate,l!==null&&(l.lanes|=n),Ep(o,n,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}kn(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,jo(e,n),s=mr(s),r=r(s),e.flags|=1,kn(t,e,r,n),e.child;case 14:return r=e.type,s=Er(r,e.pendingProps),s=Er(r.type,s),qy(t,e,r,s,n);case 15:return W1(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Er(r,s),Rd(t,e),e.tag=1,Vn(r)?(t=!0,nu(e)):t=!1,jo(e,n),B1(e,r,s),Tp(e,r,s,n),Cp(null,e,r,!0,t,n);case 19:return X1(t,e,n);case 22:return G1(t,e,n)}throw Error(he(156,e.tag))};function ub(t,e){return $_(t,e)}function dw(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function fr(t,e,n,r){return new dw(t,e,n,r)}function c0(t){return t=t.prototype,!(!t||!t.isReactComponent)}function uw(t){if(typeof t=="function")return c0(t)?1:0;if(t!=null){if(t=t.$$typeof,t===kg)return 11;if(t===Rg)return 14}return 2}function qs(t,e){var n=t.alternate;return n===null?(n=fr(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Od(t,e,n,r,s,i){var o=2;if(r=t,typeof t=="function")c0(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case _o:return Mi(n.children,s,i,e);case Cg:o=8,s|=8;break;case Kh:return t=fr(12,n,e,s|2),t.elementType=Kh,t.lanes=i,t;case Xh:return t=fr(13,n,e,s),t.elementType=Xh,t.lanes=i,t;case Jh:return t=fr(19,n,e,s),t.elementType=Jh,t.lanes=i,t;case b_:return Zu(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case x_:o=10;break e;case __:o=9;break e;case kg:o=11;break e;case Rg:o=14;break e;case Os:o=16,r=null;break e}throw Error(he(130,t==null?t:typeof t,""))}return e=fr(o,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function Mi(t,e,n,r){return t=fr(7,t,r,e),t.lanes=n,t}function Zu(t,e,n,r){return t=fr(22,t,r,e),t.elementType=b_,t.lanes=n,t.stateNode={isHidden:!1},t}function Ch(t,e,n){return t=fr(6,t,null,e),t.lanes=n,t}function kh(t,e,n){return e=fr(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function fw(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=lh(0),this.expirationTimes=lh(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=lh(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function d0(t,e,n,r,s,i,o,l,c){return t=new fw(t,e,n,l,c),e===1?(e=1,i===!0&&(e|=8)):e=0,i=fr(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Yg(i),t}function hw(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:xo,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function fb(t){if(!t)return oi;t=t._reactInternals;e:{if(Xi(t)!==t||t.tag!==1)throw Error(he(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Vn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(he(171))}if(t.tag===1){var n=t.type;if(Vn(n))return f1(t,n,e)}return e}function hb(t,e,n,r,s,i,o,l,c){return t=d0(n,r,!0,t,s,i,o,l,c),t.context=fb(null),n=t.current,r=An(),s=Qs(n),i=cs(r,s),i.callback=e??null,Xs(n,i,s),t.current.lanes=s,ic(t,s,r),Yn(t,r),t}function ef(t,e,n,r){var s=e.current,i=An(),o=Qs(s);return n=fb(n),e.context===null?e.context=n:e.pendingContext=n,e=cs(i,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Xs(s,e,o),t!==null&&(Ar(t,s,o,i),wd(t,s,o)),o}function gu(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function dv(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function u0(t,e){dv(t,e),(t=t.alternate)&&dv(t,e)}function pw(){return null}var pb=typeof reportError=="function"?reportError:function(t){console.error(t)};function f0(t){this._internalRoot=t}tf.prototype.render=f0.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(he(409));ef(t,e,null,null)};tf.prototype.unmount=f0.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Ui(function(){ef(null,t,null,null)}),e[hs]=null}};function tf(t){this._internalRoot=t}tf.prototype.unstable_scheduleHydration=function(t){if(t){var e=G_();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Ds.length&&e!==0&&e<Ds[n].priority;n++);Ds.splice(n,0,t),n===0&&Y_(t)}};function h0(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function nf(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function uv(){}function gw(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var d=gu(o);i.call(d)}}var o=hb(e,r,t,0,null,!1,!1,"",uv);return t._reactRootContainer=o,t[hs]=o.current,Ml(t.nodeType===8?t.parentNode:t),Ui(),o}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var l=r;r=function(){var d=gu(c);l.call(d)}}var c=d0(t,0,!1,null,null,!1,!1,"",uv);return t._reactRootContainer=c,t[hs]=c.current,Ml(t.nodeType===8?t.parentNode:t),Ui(function(){ef(e,c,n,r)}),c}function rf(t,e,n,r,s){var i=n._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var l=s;s=function(){var c=gu(o);l.call(c)}}ef(e,o,t,s)}else o=gw(n,e,t,s,r);return gu(o)}H_=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=nl(e.pendingLanes);n!==0&&(Og(e,n|1),Yn(e,Yt()),!(vt&6)&&(qo=Yt()+500,pi()))}break;case 13:Ui(function(){var r=ps(t,1);if(r!==null){var s=An();Ar(r,t,1,s)}}),u0(t,1)}};Lg=function(t){if(t.tag===13){var e=ps(t,134217728);if(e!==null){var n=An();Ar(e,t,134217728,n)}u0(t,134217728)}};W_=function(t){if(t.tag===13){var e=Qs(t),n=ps(t,e);if(n!==null){var r=An();Ar(n,t,e,r)}u0(t,e)}};G_=function(){return It};V_=function(t,e){var n=It;try{return It=t,e()}finally{It=n}};op=function(t,e,n){switch(e){case"input":if(Zh(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=Yu(r);if(!s)throw Error(he(90));S_(r),Zh(r,s)}}}break;case"textarea":I_(t,n);break;case"select":e=n.value,e!=null&&Lo(t,!!n.multiple,e,!1)}};O_=o0;L_=Ui;var mw={usingClientEntryPoint:!1,Events:[ac,To,Yu,A_,P_,o0]},Va={findFiberByHostInstance:Ai,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},yw={bundleType:Va.bundleType,version:Va.version,rendererPackageName:Va.rendererPackageName,rendererConfig:Va.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:xs.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=N_(t),t===null?null:t.stateNode},findFiberByHostInstance:Va.findFiberByHostInstance||pw,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var cd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!cd.isDisabled&&cd.supportsFiber)try{Hu=cd.inject(yw),zr=cd}catch{}}nr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=mw;nr.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h0(e))throw Error(he(200));return hw(t,e,null,n)};nr.createRoot=function(t,e){if(!h0(t))throw Error(he(299));var n=!1,r="",s=pb;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=d0(t,1,!1,null,null,n,!1,r,s),t[hs]=e.current,Ml(t.nodeType===8?t.parentNode:t),new f0(e)};nr.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(he(188)):(t=Object.keys(t).join(","),Error(he(268,t)));return t=N_(e),t=t===null?null:t.stateNode,t};nr.flushSync=function(t){return Ui(t)};nr.hydrate=function(t,e,n){if(!nf(e))throw Error(he(200));return rf(null,t,e,!0,n)};nr.hydrateRoot=function(t,e,n){if(!h0(t))throw Error(he(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",o=pb;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=hb(e,null,t,1,n??null,s,!1,i,o),t[hs]=e.current,Ml(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new tf(e)};nr.render=function(t,e,n){if(!nf(e))throw Error(he(200));return rf(null,t,e,!1,n)};nr.unmountComponentAtNode=function(t){if(!nf(t))throw Error(he(40));return t._reactRootContainer?(Ui(function(){rf(null,null,t,!1,function(){t._reactRootContainer=null,t[hs]=null})}),!0):!1};nr.unstable_batchedUpdates=o0;nr.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!nf(n))throw Error(he(200));if(t==null||t._reactInternals===void 0)throw Error(he(38));return rf(t,e,n,!1,r)};nr.version="18.3.1-next-f1338f8080-20240426";function gb(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(gb)}catch(t){console.error(t)}}gb(),g_.exports=nr;var vw=g_.exports,fv=vw;Vh.createRoot=fv.createRoot,Vh.hydrateRoot=fv.hydrateRoot;const hv=20,p0=[{id:1,filename:"1_yoroshiku.png",label:"",se:"pa.mp3"},{id:2,filename:"2_nandato.png",label:"",se:"shock.mp3"},{id:3,filename:"3_thank.png",label:"",se:"thanks.mp3"},{id:4,filename:"4_willwin.png",label:"",se:"nt.mp3"},{id:5,filename:"5_dontmind.png",label:"",se:"boyon.mp3"},{id:6,filename:"6_thinking.png",label:"",se:"thinking.mp3"},{id:7,filename:"7_gg.png",label:"GG",se:"kiri.mp3"},{id:8,filename:"8_sorry.png",label:"",se:"gomen.mp3"}],pv=(t,e)=>{const n=p0.find(s=>s.id===t);return n?`/stamps/${e==="AJA"?"azya":e.toLowerCase()}/${n.filename}`:""},gv=t=>{const e=p0.find(n=>n.id===t);return(e==null?void 0:e.se)||null},zn=[{id:"s_3cats",name:"",cost:2,type:"SPELL",description:"1",flavorText:"",imageUrl:"/cards/chatora_three_cats.png",relatedCards:["TOKEN_CHATORA","TOKEN_SABATORA","TOKEN_KIJITORA"],triggers:[{trigger:"FANFARE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_CHATORA"},{type:"GENERATE_CARD",targetCardId:"TOKEN_SABATORA"},{type:"GENERATE_CARD",targetCardId:"TOKEN_KIJITORA"}]}]},{id:"s_final_cannon",name:"",cost:10,type:"SPELL",description:"1",flavorText:'""""',imageUrl:"/cards/final_cannon.png",triggers:[{trigger:"FANFARE",effects:[{type:"SET_MAX_HP",value:1,targetType:"OPPONENT"}]}]},{id:"c_senka_knuckler",name:"",cost:8,type:"FOLLOWER",attack:3,health:5,description:`[] []
2
[]
1`,flavorText:`

`,imageUrl:"/cards/senka.png",evolvedImageUrl:"/cards/senka_2.png",tags:["Knuckler"],passiveAbilities:["STORM","DOUBLE_ATTACK"],attackEffectType:"IMPACT",triggers:[{trigger:"SUPER_EVOLVE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_FLICKER_JAB"},{type:"GENERATE_CARD",targetCardId:"TOKEN_QUAKE_HOWLING"},{type:"GENERATE_CARD",targetCardId:"TOKEN_BACKHAND_SMASH"}]}]},{id:"c_ruiyu",name:"",cost:7,type:"FOLLOWER",attack:5,health:5,description:`4cyoriena
14`,flavorText:`
`,imageUrl:"/cards/ruiyu.png",evolvedImageUrl:"/cards/ruiyu_2.png",attackEffectType:"BLUE_FIRE",relatedCards:["c_cyoriena"],triggers:[{trigger:"FANFARE",effects:[{type:"HEAL_LEADER",value:4,targetType:"SELF"},{type:"SUMMON_CARD",targetCardId:"c_cyoriena"}]},{trigger:"EVOLVE",effects:[{type:"DESTROY",targetType:"SELECT_FOLLOWER"},{type:"HEAL_LEADER",value:4,targetType:"SELF"}]}]},{id:"c_y",name:"Y",cost:6,type:"FOLLOWER",attack:3,health:3,description:`[]
142
3`,flavorText:"",imageUrl:"/cards/y.png",evolvedImageUrl:"/cards/y_2.png",passiveAbilities:["STEALTH"],attackEffectType:"SUMI",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:4,targetType:"SELECT_FOLLOWER"},{type:"AOE_DAMAGE",value:2,targetType:"ALL_FOLLOWERS"}]},{trigger:"EVOLVE",effects:[{type:"AOE_DAMAGE",value:3,targetType:"ALL_FOLLOWERS"}]}]},{id:"c_tsubumaru",name:"",cost:2,type:"FOLLOWER",attack:1,health:3,description:`[]
1
1`,flavorText:`

`,imageUrl:"/cards/tsubumaru.png",evolvedImageUrl:"/cards/tsubumaru_2.png",relatedCards:["s_resignation_proxy"],passiveAbilities:["WARD"],attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"GENERATE_CARD",targetCardId:"s_resignation_proxy"}]}]},{id:"c_barura",name:"",cost:4,type:"FOLLOWER",attack:3,health:4,description:`1
13`,flavorText:`

`,imageUrl:"/cards/barura.png",evolvedImageUrl:"/cards/barura_2.png",attackEffectType:"FIRE",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:3,targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_CHATORA",name:"",cost:0,type:"FOLLOWER",attack:1,health:1,description:"",flavorText:"",imageUrl:"/cards/chatora.png",attackEffectType:"SLASH"},{id:"TOKEN_SABATORA",name:"",cost:1,type:"FOLLOWER",attack:1,health:2,description:"[]",flavorText:"",passiveAbilities:["RUSH"],imageUrl:"/cards/sabatora.png",attackEffectType:"SLASH"},{id:"TOKEN_KIJITORA",name:"",cost:3,type:"FOLLOWER",attack:2,health:3,description:"[]",flavorText:"",passiveAbilities:["WARD"],imageUrl:"/cards/kijitora.png",attackEffectType:"SLASH"},{id:"TOKEN_RICE",name:"",cost:0,type:"SPELL",description:"1",flavorText:" ",imageUrl:"/cards/rice.png",triggers:[{trigger:"FANFARE",effects:[{type:"HEAL_LEADER",value:1,targetType:"SELF"}]}]},{id:"c_yunagi",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:`1
11`,flavorText:`


`,imageUrl:"/cards/yunagi.png",evolvedImageUrl:"/cards/yunagi_2.png",relatedCards:["TOKEN_OOMORI_RICE"],attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:1,targetType:"SELECT_FOLLOWER"},{type:"GENERATE_CARD",targetCardId:"TOKEN_OOMORI_RICE"}]}]},{id:"TOKEN_OOMORI_RICE",name:"",cost:1,type:"SPELL",description:"3",flavorText:"",imageUrl:"/cards/oomoririce.png",tags:["Token"],triggers:[{trigger:"FANFARE",effects:[{type:"HEAL_LEADER",value:3,targetType:"SELF"}]}]},{id:"c_nayuta",name:"",cost:4,type:"FOLLOWER",attack:3,health:3,description:`[]
1
1`,flavorText:"",imageUrl:"/cards/nayuta.png",evolvedImageUrl:"/cards/nayuta_2.png",attackEffectType:"RAY",passiveAbilities:["WARD"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]},{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]}]},{id:"c_yunagi_ward",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:`[]
1`,imageUrl:"/cards/yunagi.png",evolvedImageUrl:"/cards/yunagi_2.png",relatedCards:["TOKEN_RICE"],passiveAbilities:["WARD"],triggers:[{trigger:"FANFARE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_RICE"}]}]},{id:"c_nayuta_ward",name:"",cost:4,type:"FOLLOWER",attack:3,health:3,description:`[]
1
1`,imageUrl:"/cards/nayuta.png",evolvedImageUrl:"/cards/nayuta_2.png",passiveAbilities:["WARD"],attackEffectType:"RAY",triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]},{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_nayuta"}]}]},{id:"c_azya",name:"",cost:8,type:"FOLLOWER",attack:4,health:4,description:`[]
3211-2
1+1/+2[][]0`,flavorText:`
&&`,imageUrl:"/cards/azya.png",evolvedImageUrl:"/cards/azya_2.png",attackEffectType:"THUNDER",passiveAbilities:["AURA"],relatedCards:["c_tsubumaru","c_yunagi","c_nayuta"],triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:3,targetType:"OPPONENT"},{type:"HEAL_LEADER",value:2,targetType:"SELF"},{type:"RANDOM_DESTROY",value:1},{type:"RANDOM_BOUNCE",value:1},{type:"REDUCE_HAND_COST",value:2,conditions:{nameIn:["","",""]}}]},{trigger:"SUPER_EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_tsubumaru"},{type:"SUMMON_CARD",targetCardId:"c_yunagi"},{type:"SUMMON_CARD",targetCardId:"c_nayuta"},{type:"BUFF_STATS",value:1,value2:2,targetType:"ALL_OTHER_FOLLOWERS"},{type:"GRANT_PASSIVE",targetPassive:"WARD",targetType:"ALL_OTHER_FOLLOWERS"},{type:"GRANT_PASSIVE",targetPassive:"RUSH",targetType:"ALL_OTHER_FOLLOWERS"},{type:"GENERATE_CARD",targetCardId:"s_yucho_of_the_abyss"},{type:"GENERATE_CARD",targetCardId:"s_thats_mine"},{type:"GRANT_LEADER_DAMAGE_SHIELD"}]}]},{id:"c_yuki",name:"",cost:3,type:"FOLLOWER",attack:3,health:2,description:`[]
+1/+1`,flavorText:"",imageUrl:"/cards/yuki.png",evolvedImageUrl:"/cards/yuki_2.png",tags:["Knuckler"],passiveAbilities:["RUSH"],attackEffectType:"IMPACT",triggers:[{trigger:"EVOLVE",effects:[{type:"BUFF_STATS",value:1,value2:1,targetType:"ALL_FOLLOWERS"}]}]},{id:"c_white_tsubaki",name:"",cost:4,type:"FOLLOWER",attack:4,health:3,description:`[]

01
1`,flavorText:`
`,imageUrl:"/cards/white_tsubaki.png",evolvedImageUrl:"/cards/white_tsubaki_2.png",tags:["Knuckler"],passiveAbilities:["RUSH","IMMUNE_TO_FOLLOWER_DAMAGE","GUTS_MY_TURN"],attackEffectType:"ICE",relatedCards:["c_shieko"],triggers:[{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_shieko"}]}]},{id:"c_shieko",name:"",cost:2,type:"FOLLOWER",attack:2,health:1,description:`[]
1+2/+2`,flavorText:`
`,imageUrl:"/cards/shieko.png",evolvedImageUrl:"/cards/shieko_2.png",tags:["Knuckler"],passiveAbilities:["RUSH"],attackEffectType:"IMPACT",triggers:[{trigger:"EVOLVE",effects:[{type:"BUFF_STATS",value:2,value2:2,targetType:"SELECT_OTHER_ALLY_FOLLOWER"}]}]},{id:"c_urara",name:"",cost:3,type:"FOLLOWER",attack:2,health:2,description:`[] []
2`,flavorText:`
`,imageUrl:"/cards/urara.png",evolvedImageUrl:"/cards/urara_2.png",passiveAbilities:["WARD","BARRIER"],attackEffectType:"WATER",triggers:[{trigger:"EVOLVE",effects:[{type:"HEAL_LEADER",value:2}]}]},{id:"c_kasuga",name:"",cost:10,type:"FOLLOWER",attack:8,health:8,description:"",flavorText:`

`,imageUrl:"/cards/kasuga.png",evolvedImageUrl:"/cards/kasuga_2.png",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY",targetType:"ALL_OTHER_FOLLOWERS"}]}],attackEffectType:"SLASH"},{id:"c_kyokune",name:"",cost:4,type:"FOLLOWER",attack:4,health:4,description:"1",imageUrl:"/cards/kyokune.jpg",relatedCards:["c_sia"],triggers:[{trigger:"EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_sia"}]}],attackEffectType:"SLASH"},{id:"c_sia",name:"",cost:2,type:"FOLLOWER",attack:2,health:1,description:"21",flavorText:"",imageUrl:"/cards/sia.png",evolvedImageUrl:"/cards/sia_2.png",attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DAMAGE",value:1,value2:2,targetType:"OPPONENT"}]}]},{id:"TOKEN_BACKHAND_SMASH",name:"",cost:0,type:"SPELL",description:"16",flavorText:`10
`,imageUrl:"/cards/BackhandSmash.jpg",tags:["Token"],attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:6,targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_QUAKE_HOWLING",name:"",cost:0,type:"SPELL",description:"2",flavorText:"",imageUrl:"/cards/QuakeHowling.png",tags:["Token"],attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"AOE_DAMAGE",value:2,targetType:"ALL_FOLLOWERS"}]}]},{id:"TOKEN_FLICKER_JAB",name:"",cost:0,type:"SPELL",description:"12",flavorText:`
BHS
`,imageUrl:"/cards/FlickerJab.png",tags:["Token"],attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:2,targetType:"SELECT_FOLLOWER"}]}]},{id:"c_bucchi",name:"",cost:5,type:"FOLLOWER",attack:1,health:3,description:"3",flavorText:`
`,imageUrl:"/cards/bucchi.png",evolvedImageUrl:"/cards/bucchi_2.png",attackEffectType:"SLASH",relatedCards:["c_manary"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_manary"},{type:"SUMMON_CARD",targetCardId:"c_manary"},{type:"SUMMON_CARD",targetCardId:"c_manary"}]}]},{id:"c_valkyrie",name:"",cost:6,type:"FOLLOWER",attack:6,health:6,description:`[] [] []
[]`,flavorText:"",imageUrl:"/cards/valkyrie.png",evolvedImageUrl:"/cards/valkyrie_2.png",passiveAbilities:["WARD","BARRIER","AURA"],attackEffectType:"RAY",triggers:[{trigger:"END_OF_TURN",effects:[{type:"GRANT_PASSIVE",targetPassive:"BARRIER",targetType:"SELF"}]}]},{id:"c_manary",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:"[]",flavorText:"^^",imageUrl:"/cards/manary.png",evolvedImageUrl:"/cards/manary_2.png",tags:["Token"],passiveAbilities:["WARD"],attackEffectType:"WATER"},{id:"c_potechi",name:"",cost:3,type:"FOLLOWER",attack:2,health:3,description:`[]
1`,flavorText:"",imageUrl:"/cards/potechi.png",evolvedImageUrl:"/cards/potechi_2.png",passiveAbilities:["WARD"],attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]}]},{id:"c_mono",name:"Mono",cost:3,type:"FOLLOWER",attack:2,health:1,description:`15
15`,flavorText:"",imageUrl:"/cards/Mono.png",evolvedImageUrl:"/cards/Mono_2.png",attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"DAMAGE",value:5,targetType:"SELECT_FOLLOWER"}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:5,targetType:"SELECT_FOLLOWER"}]}]},{id:"c_sara",name:"sara",cost:7,type:"FOLLOWER",attack:4,health:6,description:`2111
1`,flavorText:"w",imageUrl:"/cards/sara.png",evolvedImageUrl:"/cards/sara_2.png",relatedCards:["TOKEN_SORRY_THE_END"],attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DESTROY",value:2,targetType:"OPPONENT"},{type:"GENERATE_CARD",targetCardId:"TOKEN_SORRY_THE_END",conditions:{minTurn:11}}]},{trigger:"SUPER_EVOLVE",effects:[{type:"DESTROY",targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_SORRY_THE_END",name:"",cost:3,type:"SPELL",description:"553sara1",flavorText:'""',imageUrl:"/cards/sorryTheEnd.png",tags:["Token"],attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"AOE_DAMAGE",value:5,targetType:"ALL_FOLLOWERS"},{type:"DAMAGE",value:5,targetType:"OPPONENT"},{type:"DRAW",value:3},{type:"SUMMON_CARD",targetCardId:"c_sara"}]}]},{id:"c_blue_tsubaki",name:"",cost:2,type:"FOLLOWER",attack:2,health:2,description:`1
1`,flavorText:"",imageUrl:"/cards/blue_tsubaki.png",evolvedImageUrl:"/cards/blue_tsubaki_2.png",attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1}]},{trigger:"EVOLVE",effects:[{type:"RANDOM_DESTROY",value:1,targetType:"OPPONENT"}]}]},{id:"s_resignation_proxy",name:"",cost:0,type:"SPELL",description:"11",flavorText:"1",imageUrl:"/cards/taisyokudaiko.png",tags:["Token"],attackEffectType:"SLASH",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DESTROY",targetType:"OPPONENT",value:1},{type:"DRAW",value:1}]}]},{id:"s_yucho_of_the_abyss",name:"",cost:0,type:"SPELL",description:"11",flavorText:"",imageUrl:"/cards/yuchooftheabyss.png",tags:["Token"],attackEffectType:"THUNDER",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DAMAGE_BY_TURN",value:1,targetType:"OPPONENT"}]}]},{id:"s_thats_mine",name:"",cost:2,type:"SPELL",description:"1",flavorText:"",imageUrl:"/cards/thatsmine.png",tags:["Token"],attackEffectType:"ICE",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY_AND_GENERATE",value:0,targetType:"SELECT_FOLLOWER"}]}]},{id:"s_tenfubu_yabe_hutari",name:"2",cost:4,type:"SPELL",description:"11",flavorText:"",imageUrl:"/cards/tenfubuyabehutari.png",relatedCards:["c_yuki","c_potechi"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_yuki"},{type:"SUMMON_CARD",targetCardId:"c_potechi"}]}]},{id:"s_samurai_tea",name:"",cost:2,type:"SPELL",description:"1+1/+1",flavorText:'""""',imageUrl:"/cards/samuraitea.png",triggers:[{trigger:"FANFARE",effects:[{type:"DRAW",value:1},{type:"BUFF_STATS",value:1,value2:1,targetType:"ALL_FOLLOWERS"}]}]},{id:"s_crazy_knucklers",name:"",cost:5,type:"SPELL",description:"+1/+11",flavorText:`
www www`,imageUrl:"/cards/crazy_knucklers.png",relatedCards:["c_white_tsubaki","c_shieko"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD_BUFFED",targetCardId:"c_white_tsubaki",value:1,value2:1},{type:"SUMMON_CARD_BUFFED",targetCardId:"c_shieko",value:1,value2:1},{type:"DRAW",value:1}]}]},{id:"s_knuckle_four",name:"",cost:10,type:"SPELL",description:"444",flavorText:"",imageUrl:"/cards/knucklefour.png",attackEffectType:"IMPACT",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DESTROY",value:4,targetType:"OPPONENT"},{type:"DRAW",value:4},{type:"HEAL_LEADER",value:4,targetType:"SELF"}]}]},{id:"c_amandava",name:"amandava",cost:5,attack:2,health:3,type:"FOLLOWER",description:`21
1`,flavorText:"",imageUrl:"/cards/amandava.png",evolvedImageUrl:"/cards/amandava_2.png",attackEffectType:"SHOT",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_SET_HP",value:2,value2:1,targetType:"OPPONENT"}]},{trigger:"EVOLVE",effects:[{type:"AOE_DAMAGE",value:1,targetType:"ALL_FOLLOWERS"}]}]},{id:"c_alice",name:"",cost:3,attack:1,health:1,type:"FOLLOWER",description:`22
22`,flavorText:"",imageUrl:"/cards/alice.png",evolvedImageUrl:"/cards/alice_2.png",attackEffectType:"FIRE",triggers:[{trigger:"FANFARE",effects:[{type:"RANDOM_DAMAGE",value:2,value2:2,targetType:"OPPONENT"}]},{trigger:"EVOLVE",effects:[{type:"RANDOM_DAMAGE",value:2,value2:2,targetType:"OPPONENT"}]}]},{id:"c_yuri",name:"",cost:5,type:"FOLLOWER",attack:3,health:3,description:`1
13`,flavorText:`
`,imageUrl:"/cards/yuri.png",evolvedImageUrl:"/cards/yuri_2.png",attackEffectType:"WATER",relatedCards:["TOKEN_SUIHYORYU"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"TOKEN_SUIHYORYU"}]},{trigger:"EVOLVE",effects:[{type:"DAMAGE",value:3,targetType:"SELECT_FOLLOWER"}]}]},{id:"TOKEN_SUIHYORYU",name:"",cost:5,type:"FOLLOWER",attack:4,health:4,description:`[] []
`,flavorText:"",imageUrl:"/cards/suihyoryu.png",evolvedImageUrl:"/cards/suihyoryu.png",tags:["Token"],passiveAbilities:["RUSH","WARD"],attackEffectType:"ICE",triggers:[{trigger:"START_OF_TURN",effects:[{type:"DESTROY_SELF"}]}]},{id:"c_cyoriena",name:"cyoriena",cost:2,type:"FOLLOWER",attack:1,health:2,description:`[] []
HP2
`,flavorText:"7",imageUrl:"/cards/cyoriena.png",evolvedImageUrl:"/cards/cyoriena_2.png",relatedCards:["TOKEN_TSUBASA"],tags:["Token"],passiveAbilities:["WARD","BARRIER"],attackEffectType:"RAY",triggers:[{trigger:"END_OF_TURN",effects:[{type:"HEAL_LEADER",value:2,targetType:"SELF"}]},{trigger:"EVOLVE",effects:[{type:"GENERATE_CARD",targetCardId:"TOKEN_TSUBASA"}]}]},{id:"TOKEN_TSUBASA",name:"",cost:1,type:"SPELL",description:"1[]",flavorText:"",imageUrl:"/cards/tsubasa.png",tags:["Token"],triggers:[{trigger:"FANFARE",effects:[{type:"GRANT_PASSIVE",targetPassive:"STORM",targetType:"SELECT_ALLY_FOLLOWER"}]}]},{id:"c_yamato",name:"",cost:5,type:"FOLLOWER",attack:5,health:1,description:"[]",imageUrl:"/cards/yamato.jpg",passiveAbilities:["STORM"],attackEffectType:"SLASH"},{id:"c_yoruka",name:"yoRuka",cost:8,type:"FOLLOWER",attack:5,health:5,description:`1
 8yoRuka1
2`,flavorText:"Y",imageUrl:"/cards/yoRuka.png",evolvedImageUrl:"/cards/yoRuka_2.png",attackEffectType:"SUMI",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY",targetType:"SELECT_FOLLOWER"}]},{trigger:"LAST_WORD",effects:[{type:"SUMMON_CARD",targetCardId:"c_yoruka",necromance:8}]},{trigger:"SUPER_EVOLVE",effects:[{type:"RANDOM_DESTROY",value:2,targetType:"OPPONENT"}]}]},{id:"c_haruka",name:"",cost:7,type:"FOLLOWER",attack:2,health:3,description:`[]
[]1
4
1 4+2/+0`,flavorText:"",imageUrl:"/cards/haruka.png",evolvedImageUrl:"/cards/haruka_2.png",passiveAbilities:["STEALTH"],attackEffectType:"SLASH",relatedCards:["c_yuka","c_setsuna"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD_RUSH",targetCardId:"c_yuka"},{type:"SUMMON_CARD",targetCardId:"c_setsuna"}]},{trigger:"LAST_WORD",effects:[{type:"ADD_GRAVEYARD",value:4}]},{trigger:"SUPER_EVOLVE",effects:[{type:"SUMMON_CARD",targetCardId:"c_setsuna"},{type:"BUFF_STATS",value:2,value2:0,targetType:"ALL_OTHER_FOLLOWERS",necromance:4}]}]},{id:"c_setsuna",name:"",cost:3,type:"FOLLOWER",attack:1,health:1,description:`[] []
-12`,flavorText:"",imageUrl:"/cards/setsuna.png",evolvedImageUrl:"/cards/setsuna_2.png",passiveAbilities:["STORM","BANE"],attackEffectType:"SUMI",triggers:[{trigger:"LAST_WORD",effects:[{type:"BUFF_STATS",value:-1,value2:0,targetType:"RANDOM_FOLLOWER"},{type:"ADD_GRAVEYARD",value:2}]}]},{id:"c_yuka",name:"",cost:5,type:"FOLLOWER",attack:1,health:6,description:`[] []
1
3
132`,flavorText:"",imageUrl:"/cards/yuka.png",evolvedImageUrl:"/cards/yuka_2.png",passiveAbilities:["WARD","AURA"],attackEffectType:"SHOT",relatedCards:["c_setsuna"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_setsuna"}]},{trigger:"LAST_WORD",effects:[{type:"ADD_GRAVEYARD",value:3}]},{trigger:"EVOLVE",effects:[{type:"RANDOM_DAMAGE",value:3,value2:1,targetType:"OPPONENT"},{type:"RANDOM_DAMAGE",value:3,value2:1,targetType:"OPPONENT"}]}]},{id:"s_hayakikoto",name:"",cost:4,type:"SPELL",description:"21",flavorText:"",imageUrl:"/cards/hayakikoto.png",relatedCards:["c_setsuna"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD",targetCardId:"c_setsuna"},{type:"SUMMON_CARD",targetCardId:"c_setsuna"},{type:"DRAW",value:1}]}]},{id:"s_keishou",name:"",cost:9,type:"SPELL",description:"1-9",flavorText:`
`,imageUrl:"/cards/keisyopower.png",triggers:[{trigger:"FANFARE",effects:[{type:"DESTROY_AND_GENERATE",targetType:"RANDOM_ENEMY_FOLLOWER",value:-9}]}]},{id:"s_night_parade",name:"",cost:10,type:"SPELL",description:` 41
+1/+0`,flavorText:"",imageUrl:"/cards/nightparade.png",relatedCards:["c_setsuna"],triggers:[{trigger:"FANFARE",effects:[{type:"SUMMON_CARD_FILL_BOARD",targetCardId:"c_setsuna",necromance:4},{type:"BUFF_STATS",value:1,value2:0,targetType:"ALL_FOLLOWERS"}]}]}];function g0(t){let e=t;return()=>(e=(e*1664525+1013904223)%4294967296,e/4294967296)}function xw(t,e){let n=t.length,r;for(;n!=0;)r=Math.floor(e()*n),n--,[t[n],t[r]]=[t[r],t[n]];return t}function _w(t){var s;const e=t.players.p1,n=t.players.p2;return[t.turnCount,t.activePlayerId,e.hp,e.maxHp,e.pp,e.maxPp,e.sep,e.evolutionsUsed,n.hp,n.maxHp,n.pp,n.maxPp,n.sep,n.evolutionsUsed,e.board.map(i=>i?`${i.id}_${i.instanceId}_${i.currentHealth}_${i.hasBarrier?"B":""}`:"null").join(","),n.board.map(i=>i?`${i.id}_${i.instanceId}_${i.currentHealth}_${i.hasBarrier?"B":""}`:"null").join(","),e.hand.length,n.hand.length,((s=t.pendingEffects)==null?void 0:s.length)||0,t.rngSeed].join("|")}const m0=[{cardId:"c_senka_knuckler",count:3},{cardId:"c_yuki",count:3},{cardId:"c_white_tsubaki",count:3},{cardId:"c_shieko",count:3},{cardId:"s_samurai_tea",count:3},{cardId:"c_bucchi",count:2},{cardId:"c_valkyrie",count:1},{cardId:"c_potechi",count:3},{cardId:"s_tenfubu_yabe_hutari",count:3},{cardId:"s_crazy_knucklers",count:2},{cardId:"c_sia",count:2},{cardId:"c_mono",count:3},{cardId:"c_ruiyu",count:1},{cardId:"c_kasuga",count:1},{cardId:"c_y",count:2},{cardId:"c_sara",count:1},{cardId:"s_knuckle_four",count:1},{cardId:"c_blue_tsubaki",count:3}],y0=[{cardId:"c_azya",count:3},{cardId:"c_ruiyu",count:2},{cardId:"c_y",count:2},{cardId:"c_sara",count:2},{cardId:"c_urara",count:3},{cardId:"c_yunagi",count:3},{cardId:"c_tsubumaru",count:3},{cardId:"c_nayuta",count:3},{cardId:"c_yuri",count:2},{cardId:"c_alice",count:3},{cardId:"c_kasuga",count:1},{cardId:"c_barura",count:3},{cardId:"c_valkyrie",count:3},{cardId:"s_3cats",count:2},{cardId:"s_final_cannon",count:1},{cardId:"c_amandava",count:2},{cardId:"c_mono",count:2}],v0=[{cardId:"c_yoruka",count:3},{cardId:"c_y",count:3},{cardId:"c_haruka",count:3},{cardId:"c_yuka",count:3},{cardId:"c_setsuna",count:3},{cardId:"s_hayakikoto",count:3},{cardId:"s_night_parade",count:1},{cardId:"c_kasuga",count:1},{cardId:"c_yunagi",count:3},{cardId:"c_tsubumaru",count:3},{cardId:"c_nayuta",count:3},{cardId:"c_mono",count:3},{cardId:"c_ruiyu",count:1},{cardId:"c_sara",count:1},{cardId:"s_3cats",count:2},{cardId:"c_yuri",count:2},{cardId:"c_sia",count:2}];function rs(t){const e=zn.find(n=>n.id===t);return e||zn.find(n=>n.name===t)}function mb(){return zn.map(t=>t.name).sort((t,e)=>e.length-t.length)}function dd(t){return{STORM:"",RUSH:"",WARD:"",BARRIER:"",AURA:"",STEALTH:"",BANE:"",DOUBLE_ATTACK:"",IMMUNE_TO_FOLLOWER_DAMAGE:"",GUTS_MY_TURN:""}[t]||t}function bw(t,e){const n=[];let r=0;return t.forEach(s=>{const i=rs(s.cardId);if(i)for(let o=0;o<s.count;o++)n.push({...i,id:`${e}_c${r}`,instanceId:`inst_${e}_c${r}`}),r++;else console.warn(`Card definition not found: ${s.cardId}`)}),n}function mv(t,e,n,r){const i=bw(n==="SENKA"?m0:n==="AJA"?y0:v0,t);return{id:t,name:e,class:n,hp:hv,maxHp:hv,pp:0,maxPp:0,sep:2,deck:xw(i,r),hand:[],graveyard:[],board:[],evolutionsUsed:0,canEvolveThisTurn:!1,extraPpUsedEarly:!1,extraPpUsedLate:!1,extraPpActive:!1}}function Ld(t,e,n,r,s,i=!0){const o=Math.floor(Math.random()*1e6),l=g0(o),c=mv("p1",t,e,l),d=mv("p2",n,r,l);c.hand=c.deck.splice(0,4),d.hand=d.deck.splice(0,4);let u,p;return i?(u="p1",p=t,c.maxPp=1,c.pp=1,d.maxPp=0,d.pp=0):(u="p2",p=n,c.maxPp=0,c.pp=0,d.maxPp=1,d.pp=1),{phase:"INIT",rngSeed:Math.floor(l()*1e6),activePlayerId:u,firstPlayerId:u,players:{p1:c,p2:d},turnCount:1,pendingEffects:[],logs:[` 1 - ${p} `],winnerId:void 0}}function Fp(t){return t==="p1"?"p2":"p1"}function Ew(t,e,n,r,s,i){var p,f,b,I,k,F,x,v,T,h,W,G,ce,N,J,Q,Ie,Je,pe,se,P;let o={...t,players:{p1:{...t.players.p1,hand:[...t.players.p1.hand],deck:[...t.players.p1.deck],board:t.players.p1.board.map(w=>w?{...w,passiveAbilities:w.passiveAbilities?[...w.passiveAbilities]:[]}:null),graveyard:[...t.players.p1.graveyard]},p2:{...t.players.p2,hand:[...t.players.p2.hand],deck:[...t.players.p2.deck],board:t.players.p2.board.map(w=>w?{...w,passiveAbilities:w.passiveAbilities?[...w.passiveAbilities]:[]}:null),graveyard:[...t.players.p2.graveyard]}},logs:[...t.logs||[]]};const l=g0(o.rngSeed||999);o.rngSeed=Math.floor(l()*1e6);const c=Fp(e),d=w=>{for(const R of["p1","p2"]){const y=o.players[R].board.findIndex(g=>(g==null?void 0:g.instanceId)===w);if(y!==-1&&o.players[R].board[y])return{card:o.players[R].board[y],player:o.players[R],index:y}}return null};if(r.necromance!==void 0&&r.necromance>0&&r.type!=="SUMMON_CARD_FILL_BOARD"){const w=o.players[e];if(w.graveyard.length<r.necromance)return console.log(`[Engine] : ${w.graveyard.length} < ${r.necromance}`),o;const R=w.graveyard.splice(-r.necromance,r.necromance);o.logs.push(`${w.name}  ${r.necromance} `),console.log(`[Engine] : ${R.map(y=>y.name).join(", ")} `)}const u=(w,R)=>{var g;const y=(g=w.triggers)==null?void 0:g.find(C=>C.trigger==="LAST_WORD");if(y){const C=y.effects.map(O=>({sourceCard:w,effect:O,sourcePlayerId:R}));o.pendingEffects=[...o.pendingEffects||[],...C],o.logs.push(`${w.name} `),console.log(`[Engine] processSingleEffect: Last Word triggered for ${w.name}. pendingEffects count: ${o.pendingEffects.length}`)}};switch(r.type){case"DAMAGE":{const w=r.value||0;if(r.targetType==="SELECT_FOLLOWER"&&s){const R=d(s);if(R){const{card:y,player:g,index:C}=R;if(y.hasBarrier)y.hasBarrier=!1,o.logs.push(`${y.name} `);else if(y.currentHealth-=w,o.logs.push(`${n.name}  ${y.name}  ${w} `),y.currentHealth<=0){y.currentHealth=Math.min(0,y.currentHealth);const O=Object.keys(o.players).find(M=>o.players[M]===g)||c;u(y,O),g.graveyard.push(y),g.board[C]=null,o.logs.push(`${y.name} `)}}}else if(r.targetType==="OPPONENT"){const R=o.players[c];if(R.leaderDamageShield)R.leaderDamageShield=!1,o.logs.push(`${n.name}  ${w} `);else{const y=R.board.some(C=>{var O;return(O=C==null?void 0:C.passiveAbilities)==null?void 0:O.includes("LEADER_DAMAGE_CAP")}),g=y?Math.min(w,1):w;R.hp-=g,y&&w>1?o.logs.push(`${n.name}  ${w} 1`):o.logs.push(`${n.name}  ${g} `),R.hp<=0&&(o.winnerId=e,o.logs.push(`${R.name} `))}}break}case"AOE_DAMAGE":{const w=r.value||0;if(r.targetType==="ALL_FOLLOWERS"){const R=o.players[c].board,y=i&&i.length>0?new Set(i):null;R.forEach(C=>{if(C){if(y&&!y.has(C.instanceId))return;C.hasBarrier?(C.hasBarrier=!1,o.logs.push(`${C.name} `)):C.currentHealth-=w}}),R.filter(C=>C&&C.currentHealth<=0).forEach(C=>{C&&(C.currentHealth=Math.min(0,C.currentHealth),u(C,c),o.players[c].graveyard.push(C),o.logs.push(`${C.name} `))}),o.logs.push(`${n.name}  ${w} `),R.forEach((C,O)=>{C&&C.currentHealth<=0&&(R[O]=null)})}break}case"DRAW":{const w=r.value||1,R=o.players[e];for(let y=0;y<w;y++)if(R.deck.length>0){const g=R.deck.pop();g&&(R.hand.length<9?R.hand.push(g):(R.graveyard.push(g),o.logs.push(`${R.name}${g.name}`)))}o.logs.push(`${R.name}  ${w} `);break}case"ADD_GRAVEYARD":{const w=r.value||1,R=o.players[e];for(let y=0;y<w;y++){const g={...n,instanceId:`grave_${o.rngSeed}_${Math.floor(l()*1e3)}_${y}`};R.graveyard.push(g)}o.logs.push(`${R.name}  ${w} `);break}case"HEAL_LEADER":{const w=r.value||0,R=o.players[e];R.hp=Math.min(R.maxHp,R.hp+w),o.logs.push(`${R.name}  ${w} HP`);break}case"DESTROY":{const w=(R,y)=>{var g;return((g=R.passiveAbilities)==null?void 0:g.includes("IMMUNE_TO_DAMAGE_MY_TURN"))===!0&&o.activePlayerId===y};if(r.targetType==="ALL_OTHER_FOLLOWERS"){const R=o.players[c].board,y=[];R.forEach(M=>{M&&(w(M,c)?(y.push(M),o.logs.push(`${M.name} `)):(u(M,c),o.players[c].graveyard.push(M)))}),o.players[c].board=y;const g=o.players[e].board,C=[],O=n.instanceId;g.forEach(M=>{M&&(O&&M.instanceId===O?C.push(M):w(M,e)?(C.push(M),o.logs.push(`${M.name} `)):(u(M,e),o.players[e].graveyard.push(M)))}),o.players[e].board=C,o.logs.push(`${n.name} `)}else if((r.targetType==="SELECT_FOLLOWER"||r.targetType==="SELECT_ALLY_FOLLOWER")&&s){const R=d(s);if(R){const{card:y,player:g,index:C}=R,O=Object.keys(o.players).find(M=>o.players[M].board.includes(y))||"";w(y,O)?o.logs.push(`${y.name} `):(y.currentHealth=1,u(y,O),g.graveyard.push(y),g.board[C]=null,o.logs.push(`${y.name}  ${n.name} `))}}break}case"GENERATE_CARD":{if((p=r.conditions)!=null&&p.minTurn&&t.turnCount<r.conditions.minTurn)break;const w=r.targetCardId,R=zn.find(y=>y.id===w);if(R){const y=o.players[e],g=`gen_${o.rngSeed}_${Date.now()}_${Math.floor(l()*1e4)}`,C={...R,id:`token_${o.rngSeed}_${Math.floor(l()*1e3)}`,instanceId:g};y.hand.length<9?(y.hand.push(C),o.logs.push(`${y.name}  ${R.name} `)):(y.graveyard.push(C),o.logs.push(`${y.name}${R.name}`))}break}case"REDUCE_HAND_COST":{const w=r.value||0,R=((f=r.conditions)==null?void 0:f.nameIn)||[],y=o.players[e];let g=0;y.hand.forEach(C=>{if(R.includes(C.name)){const O=C.cost,M=Math.max(0,O-w);M!==O&&(C.cost=M,C.baseCost=M,g++)}}),g>0&&o.logs.push(`${n.name} -${w}`);break}case"GRANT_LEADER_DAMAGE_SHIELD":{const w=o.players[e];w.leaderDamageShield=!0,o.logs.push(`${w.name} 0`);break}case"RANDOM_DESTROY":{const w=(C,O)=>{var M;return((M=C.passiveAbilities)==null?void 0:M.includes("IMMUNE_TO_DAMAGE_MY_TURN"))===!0&&o.activePlayerId===O},R=r.value||1,y=r.targetType==="SELF"?e:c,g=o.players[y].board;if(i&&i.length>0)i.forEach(C=>{const O=g.findIndex(M=>(M==null?void 0:M.instanceId)===C);if(O!==-1&&g[O]){const M=g[O];w(M,y)?o.logs.push(`${M.name} `):(M.currentHealth=1,u(M,y),o.players[y].graveyard.push(M),g[O]=null,o.logs.push(`${M.name}  ${n.name} `))}});else{const C=g.map((M,U)=>!M||w(M,y)?-1:U).filter(M=>M!==-1);for(let M=C.length-1;M>0;M--){const U=Math.floor(l()*(M+1));[C[M],C[U]]=[C[U],C[M]]}C.slice(0,R).forEach(M=>{const U=g[M];U&&(U.currentHealth=1,u(U,y),o.players[y].graveyard.push(U),g[M]=null,o.logs.push(`${U.name}  ${n.name} `))})}break}case"RANDOM_SET_HP":{const w=r.value||1,R=r.value2||1,y=r.targetType==="SELF"?e:c,g=o.players[y].board;if(i&&i.length>0)i.forEach(C=>{const O=g.findIndex(M=>(M==null?void 0:M.instanceId)===C);O!==-1&&g[O]&&(g[O].currentHealth=R,o.logs.push(`${g[O].name} HP ${R} `))});else{const C=g.map((M,U)=>M?U:-1).filter(M=>M!==-1);for(let M=C.length-1;M>0;M--){const U=Math.floor(l()*(M+1));[C[M],C[U]]=[C[U],C[M]]}C.slice(0,w).forEach(M=>{const U=g[M];U&&(U.currentHealth=R,o.logs.push(`${U.name} HP ${R} `))})}break}case"RANDOM_DAMAGE":{const w=r.value2||1,R=r.value||0,y=r.targetType==="SELF"?e:c,g=o.players[y].board,C=M=>{const U=g[M];U&&(U.hasBarrier?(U.hasBarrier=!1,o.logs.push(`${U.name} `)):(U.currentHealth-=R,o.logs.push(`${n.name}  ${U.name}  ${R} `)),U.currentHealth<=0&&(U.currentHealth=0,u(U,y),o.players[y].graveyard.push(U),g[M]=null,o.logs.push(`${U.name} `)))},O=new Set;if(i&&i.length>0)i.forEach(M=>{const U=g.findIndex(H=>(H==null?void 0:H.instanceId)===M);if(U!==-1&&g[U])O.add(M),C(U);else{const H=g.map((me,ve)=>me&&!O.has(me.instanceId)?ve:-1).filter(me=>me!==-1);if(H.length>0){const me=Math.floor(l()*H.length),ve=H[me],ue=g[ve];O.add(ue.instanceId),C(ve)}}});else{const M=g.map((H,me)=>H?me:-1).filter(H=>H!==-1);for(let H=M.length-1;H>0;H--){const me=Math.floor(l()*(H+1));[M[H],M[me]]=[M[me],M[H]]}M.slice(0,w).forEach(H=>{C(H)})}break}case"RANDOM_DAMAGE_BY_TURN":{const w=r.value||1,R=o.turnCount,y=r.targetType==="SELF"?e:c,g=o.players[y].board,C=O=>{var U;const M=g[O];if(!M)return!1;if(M.hasBarrier)return M.hasBarrier=!1,o.logs.push(`${M.name} `),!0;if(M.currentHealth-=w,o.logs.push(`${n.name}  ${M.name}  ${w} `),M.currentHealth<=0){M.currentHealth=0;const H=Object.keys(o.players).find(ve=>o.players[ve]===o.players[y])||y,me=(U=M.triggers)==null?void 0:U.find(ve=>ve.trigger==="LASTWORD");return me&&me.effects.forEach(ve=>{o.pendingEffects.push({sourceCard:M,effect:ve,sourcePlayerId:H})}),o.players[y].graveyard.push(M),g[O]=null,o.logs.push(`${M.name} `),!1}return!0};if(i&&i.length>0)for(let O=0;O<i.length;O++){const M=i[O],U=g.findIndex(H=>(H==null?void 0:H.instanceId)===M);if(U!==-1&&g[U])C(U);else{const H=g.map((me,ve)=>me?ve:-1).filter(me=>me!==-1);if(H.length>0){const me=Math.floor(l()*H.length);C(H[me])}}}else for(let O=0;O<R;O++){const M=g.map((H,me)=>H?me:-1).filter(H=>H!==-1);if(M.length===0)break;const U=Math.floor(l()*M.length);C(M[U])}break}case"SET_MAX_HP":{const w=r.value||20;if(r.targetType==="OPPONENT"){const R=o.players[c];R.maxHp=w,R.hp>w&&(R.hp=w)}break}case"SUMMON_CARD":{const w=r.targetCardId,R=zn.find(y=>y.id===w);if(R){const y=o.players[e];if(y.board.filter(C=>C!==null).length<5){const C={...R,instanceId:`token_${o.rngSeed}_${Math.floor(l()*1e3)}`,canAttack:((b=R.passiveAbilities)==null?void 0:b.includes("STORM"))||((I=R.passiveAbilities)==null?void 0:I.includes("RUSH"))||!1,currentHealth:R.health||1,maxHealth:R.health||1,attack:R.attack||0,currentAttack:R.attack||0,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((k=R.passiveAbilities)==null?void 0:k.includes("BARRIER"))??!1,passiveAbilities:R.passiveAbilities?[...R.passiveAbilities]:[],hadStealth:((F=R.passiveAbilities)==null?void 0:F.includes("STEALTH"))??!1};(x=R.tags)!=null&&x.includes("Knuckler")&&!C.passiveAbilities.includes("STORM")&&y.board.some(M=>(M==null?void 0:M.name)==="")&&(C.passiveAbilities.push("STORM"),C.canAttack=!0,o.logs.push(`${R.name}   `)),y.board.push(C),o.logs.push(`${y.name}  ${R.name} `)}}break}case"SUMMON_CARD_RUSH":{const w=r.targetCardId,R=zn.find(y=>y.id===w);if(R){const y=o.players[e];if(y.board.filter(C=>C!==null).length<5){const C={...R,instanceId:`token_${o.rngSeed}_${Math.floor(l()*1e3)}`,canAttack:!0,currentHealth:R.health||1,maxHealth:R.health||1,attack:R.attack||0,currentAttack:R.attack||0,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((v=R.passiveAbilities)==null?void 0:v.includes("BARRIER"))??!1,passiveAbilities:R.passiveAbilities?[...R.passiveAbilities]:[],hadStealth:((T=R.passiveAbilities)==null?void 0:T.includes("STEALTH"))??!1};let O=!1;(h=R.tags)!=null&&h.includes("Knuckler")&&!C.passiveAbilities.includes("STORM")&&y.board.some(U=>(U==null?void 0:U.name)==="")&&(C.passiveAbilities.push("STORM"),O=!0,o.logs.push(`${R.name}   `)),!O&&!C.passiveAbilities.includes("RUSH")&&C.passiveAbilities.push("RUSH"),y.board.push(C),o.logs.push(`${y.name}  ${R.name} ${O?"":""}`)}}break}case"SUMMON_CARD_BUFFED":{const w=r.targetCardId,R=zn.find(C=>C.id===w),y=r.value||0,g=r.value2||0;if(R){const C=o.players[e];if(C.board.filter(M=>M!==null).length<5){const M=R.attack||0,U=R.health||1,H=M+y,me=U+g,ve={...R,instanceId:`token_${o.rngSeed}_${Math.floor(l()*1e3)}`,canAttack:!1,currentHealth:me,maxHealth:me,health:me,attack:H,currentAttack:H,baseAttack:M,baseHealth:U,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((W=R.passiveAbilities)==null?void 0:W.includes("BARRIER"))??!1,passiveAbilities:R.passiveAbilities?[...R.passiveAbilities]:[],hadStealth:((G=R.passiveAbilities)==null?void 0:G.includes("STEALTH"))??!1};(ce=R.tags)!=null&&ce.includes("Knuckler")&&!ve.passiveAbilities.includes("STORM")&&C.board.some(ne=>(ne==null?void 0:ne.name)==="")&&(ve.passiveAbilities.push("STORM"),ve.canAttack=!0,o.logs.push(`${R.name}   `)),((N=ve.passiveAbilities)!=null&&N.includes("RUSH")||(J=ve.passiveAbilities)!=null&&J.includes("STORM"))&&(ve.canAttack=!0),C.board.push(ve),o.logs.push(`${C.name}  ${R.name} +${y}/+${g}`),o.pendingEffects=[...o.pendingEffects||[],{sourceCard:ve,effect:{type:"VISUAL_BUFF_ONLY",value:y,value2:g},sourcePlayerId:e}]}}break}case"SUMMON_CARD_FILL_BOARD":{const w=r.targetCardId,R=zn.find(g=>g.id===w),y=r.necromance||0;if(R){const g=o.players[e];let C=0;for(;!(g.board.filter(U=>U!==null).length>=5);){if(y>0&&g.graveyard.length<y){C===0&&o.logs.push(` ${R.name} `);break}if(y>0){const U=g.graveyard.splice(-y,y);o.logs.push(` ${y} ${U.map(H=>H.name).join(", ")} `)}const M={...R,instanceId:`token_${o.rngSeed}_${Math.floor(l()*1e3)}_${C}`,canAttack:((Q=R.passiveAbilities)==null?void 0:Q.includes("STORM"))||((Ie=R.passiveAbilities)==null?void 0:Ie.includes("RUSH"))||!1,currentHealth:R.health||1,maxHealth:R.health||1,attack:R.attack||0,currentAttack:R.attack||0,attacksMade:0,turnPlayed:o.turnCount,hasBarrier:((Je=R.passiveAbilities)==null?void 0:Je.includes("BARRIER"))??!1,passiveAbilities:R.passiveAbilities?[...R.passiveAbilities]:[],hadStealth:((pe=R.passiveAbilities)==null?void 0:pe.includes("STEALTH"))??!1};(se=R.tags)!=null&&se.includes("Knuckler")&&!M.passiveAbilities.includes("STORM")&&g.board.some(H=>(H==null?void 0:H.name)==="")&&(M.passiveAbilities.push("STORM"),M.canAttack=!0,o.logs.push(`${R.name}   `)),g.board.push(M),C++,o.logs.push(`${g.name}  ${R.name} `)}C>0&&o.logs.push(` ${C}  ${R.name} `)}break}case"DESTROY_AND_STEAL":{if(r.targetType==="SELECT_FOLLOWER"&&s){const w=d(s);if(w){const{card:R,player:y,index:g}=w,C=Object.keys(o.players).find(U=>o.players[U]===y)||c,O=o.players[e];if(O.board.filter(U=>U!==null).length<5){y.board[g]=null,o.logs.push(`${R.name}  ${n.name} `);const U={...R,instanceId:`stolen_${o.rngSeed}_${Math.floor(l()*1e3)}`,canAttack:!1,currentHealth:R.health||R.currentHealth,maxHealth:R.health||R.maxHealth,currentAttack:R.attack||R.currentAttack,attacksMade:0,turnPlayed:o.turnCount,hasEvolved:!1};O.board.push(U),o.logs.push(`${O.name}  ${U.name} `)}else u(R,C),y.graveyard.push(R),y.board[g]=null,o.logs.push(`${R.name}  ${n.name} `)}}break}case"DESTROY_AND_GENERATE":{let w=null;if(r.targetType==="SELECT_FOLLOWER"&&s)w=d(s);else if(r.targetType==="RANDOM_ENEMY_FOLLOWER"){const y=o.players[c].board.map((g,C)=>({card:g,index:C})).filter(g=>g.card!==null);if(y.length>0){const g=Math.floor(l()*y.length),C=y[g];w={card:C.card,player:o.players[c],index:C.index}}}if(w){const{card:R,player:y,index:g}=w,C=Object.keys(o.players).find(U=>o.players[U]===y)||c;u(R,C),y.graveyard.push(R),y.board[g]=null,o.logs.push(`${R.name}  ${n.name} `);const O=o.players[e],M=rs(R.name);if(M){const U=Math.max(0,M.cost+(r.value||0)),H={...M,instanceId:`generated_${o.rngSeed}_${Math.floor(l()*1e3)}`,baseCost:U,cost:U,attackEffectType:M.attackEffectType};O.hand.push(H);const me=r.value||0;o.logs.push(`${O.name}  ${H.name} ${me>=0?"+":""}${me}`)}}break}case"RETURN_TO_HAND":{const w=o.players[c].board;let R=-1;if(r.targetType==="SELECT_FOLLOWER"&&s?R=w.findIndex(y=>(y==null?void 0:y.instanceId)===s):(r.targetType==="RANDOM_FOLLOWER"||!s)&&w.length>0&&(R=Math.floor(l()*w.length)),R!==-1&&w[R]){const y=w[R];o.players[c].board[R]=null;const g=o.players[c],C=rs(y.id)||rs(y.name),{currentHealth:O,maxHealth:M,canAttack:U,attacksMade:H,hasEvolved:me,baseAttack:ve,baseHealth:ue,turnPlayed:ne,hasBarrier:re,attack:He,health:st,...je}=y,we={...je,attack:(C==null?void 0:C.attack)??He,health:(C==null?void 0:C.health)??st};g.hand.length<9?(g.hand.push(we),o.logs.push(`${y.name} `)):(g.graveyard.push(we),o.logs.push(`${y.name} `))}break}case"RANDOM_BOUNCE":{const w=r.value||1,R=o.players[c].board;for(let y=0;y<w;y++){const g=R.map((Ze,Ue)=>Ze?Ue:-1).filter(Ze=>Ze!==-1);if(g.length===0)break;const C=g[Math.floor(l()*g.length)],O=R[C];R[C]=null;const M=o.players[c],U=rs(O.id)||rs(O.name),{currentHealth:H,maxHealth:me,canAttack:ve,attacksMade:ue,hasEvolved:ne,baseAttack:re,baseHealth:He,turnPlayed:st,hasBarrier:je,attack:we,health:Re,...at}=O,qe={...at,attack:(U==null?void 0:U.attack)??we,health:(U==null?void 0:U.health)??Re};M.hand.length<9?(M.hand.push(qe),o.logs.push(`${O.name} `)):(M.graveyard.push(qe),o.logs.push(`${O.name} `))}break}case"GRANT_PASSIVE":{const w=r.targetPassive;if(!w)break;if(r.targetType==="SELF"){const R=n;if(R.instanceId){const g=o.players[e].board.find(C=>(C==null?void 0:C.instanceId)===R.instanceId);g&&(w==="BARRIER"?(g.hasBarrier=!0,o.logs.push(`${g.name} `)):(g.passiveAbilities||(g.passiveAbilities=[]),g.passiveAbilities.includes(w)||(g.passiveAbilities.push(w),o.logs.push(`${g.name}  ${dd(w)} `)),(w==="STORM"||w==="RUSH")&&(g.canAttack=!0)))}}else if((r.targetType==="SELECT_FOLLOWER"||r.targetType==="SELECT_ALLY_FOLLOWER")&&s){const R=d(s);if(R){const{card:y}=R;w==="BARRIER"?(y.hasBarrier=!0,o.logs.push(`${y.name} `)):(y.passiveAbilities||(y.passiveAbilities=[]),y.passiveAbilities.includes(w)||(y.passiveAbilities.push(w),o.logs.push(`${y.name}  ${dd(w)} `)),(w==="STORM"||w==="RUSH")&&(y.canAttack=!0))}}else if(r.targetType==="ALL_FOLLOWERS"){const R=o.players[e];let y=0;console.log(`[GRANT_PASSIVE] ALL_FOLLOWERS: Player board has ${R.board.filter(g=>g).length} units, condition tag=${(P=r.conditions)==null?void 0:P.tag}`),R.board.forEach(g=>{var C,O,M;if(g){if(console.log(`[GRANT_PASSIVE] Checking: ${g.name}, tags=${g.tags}, passives=${g.passiveAbilities}`),(C=r.conditions)!=null&&C.tag&&!((O=g.tags)!=null&&O.includes(r.conditions.tag))){console.log(`[GRANT_PASSIVE] Skipped ${g.name}: no matching tag`);return}if((M=r.conditions)!=null&&M.nameIn&&!r.conditions.nameIn.includes(g.name)){console.log(`[GRANT_PASSIVE] Skipped ${g.name}: no matching nameIn`);return}w==="BARRIER"?(g.hasBarrier=!0,y++):(g.passiveAbilities||(g.passiveAbilities=[]),g.passiveAbilities.includes(w)||(g.passiveAbilities.push(w),y++,console.log(`[GRANT_PASSIVE] Granted ${w} to ${g.name}`),(w==="STORM"||w==="RUSH")&&(g.canAttack=!0)))}}),y>0&&o.logs.push(`${y} ${dd(w)} `),console.log(`[GRANT_PASSIVE] Total granted: ${y}`)}else if(r.targetType==="ALL_OTHER_FOLLOWERS"){const R=o.players[e];let y=0;R.board.forEach(g=>{var C,O,M;if(g&&g.instanceId!==n.instanceId){if((C=r.conditions)!=null&&C.tag&&!((O=g.tags)!=null&&O.includes(r.conditions.tag))||(M=r.conditions)!=null&&M.nameIn&&!r.conditions.nameIn.includes(g.name))return;w==="BARRIER"?(g.hasBarrier=!0,y++):(g.passiveAbilities||(g.passiveAbilities=[]),g.passiveAbilities.includes(w)||(g.passiveAbilities.push(w),y++,(w==="STORM"||w==="RUSH")&&(g.canAttack=!0)))}}),y>0&&o.logs.push(`${y} ${dd(w)} `)}break}case"BUFF_STATS":{const w=r.value||0,R=r.value2||0;if(r.targetType==="ALL_FOLLOWERS")o.players[e].board.forEach(g=>{var C,O,M;if(g){if((C=r.conditions)!=null&&C.tag&&!((O=g.tags)!=null&&O.includes(r.conditions.tag))||(M=r.conditions)!=null&&M.nameIn&&!r.conditions.nameIn.includes(g.name))return;g.baseAttack||(g.baseAttack=g.attack||0),g.baseHealth||(g.baseHealth=g.health||0),g.attack=(g.attack||0)+w,g.currentAttack=(g.currentAttack||0)+w,g.health=(g.health||0)+R,g.maxHealth=(g.maxHealth||0)+R,g.currentHealth=(g.currentHealth||0)+R,o.logs.push(`${g.name}  +${w}/+${R} `)}});else if(r.targetType==="ALL_OTHER_FOLLOWERS")o.players[e].board.forEach(g=>{var C,O,M;if(g&&g.instanceId!==n.instanceId){if((C=r.conditions)!=null&&C.tag&&!((O=g.tags)!=null&&O.includes(r.conditions.tag))||(M=r.conditions)!=null&&M.nameIn&&!r.conditions.nameIn.includes(g.name))return;g.baseAttack||(g.baseAttack=g.attack||0),g.baseHealth||(g.baseHealth=g.health||0),g.attack=(g.attack||0)+w,g.currentAttack=(g.currentAttack||0)+w,g.health=(g.health||0)+R,g.maxHealth=(g.maxHealth||0)+R,g.currentHealth=(g.currentHealth||0)+R,o.logs.push(`${g.name}  +${w}/+${R} `)}});else if((r.targetType==="SELECT_FOLLOWER"||r.targetType==="SELECT_ALLY_FOLLOWER"||r.targetType==="SELECT_OTHER_ALLY_FOLLOWER")&&s){const y=d(s);if(y){const{card:g}=y;g.baseAttack||(g.baseAttack=g.attack||0),g.baseHealth||(g.baseHealth=g.health||0),g.attack=(g.attack||0)+w,g.currentAttack=(g.currentAttack||0)+w,g.health=(g.health||0)+R,g.maxHealth=(g.maxHealth||0)+R,g.currentHealth=(g.currentHealth||0)+R,o.logs.push(`${g.name}  +${w}/+${R} `)}}else if(r.targetType==="RANDOM_FOLLOWER"){const y=o.players[c].board,g=y.map((C,O)=>C?O:-1).filter(C=>C!==-1);if(g.length>0){const C=g[Math.floor(l()*g.length)],O=y[C];O.baseAttack||(O.baseAttack=O.attack||0),O.baseHealth||(O.baseHealth=O.health||0),O.attack=(O.attack||0)+w,O.currentAttack=(O.currentAttack||0)+w,O.health=(O.health||0)+R,O.maxHealth=(O.maxHealth||0)+R,O.currentHealth=(O.currentHealth||0)+R,O.currentAttack<0&&(O.currentAttack=0),O.attack&&O.attack<0&&(O.attack=0);const M=w>=0?`+${w}`:`${w}`,U=R>=0?`+${R}`:`${R}`;o.logs.push(`${O.name}  ${M}/${U} `)}else o.logs.push("")}break}}return o}const Sw=t=>{const e=n=>{const r=n.board.some(i=>i&&i.name.includes("")),s=n.hand.map(i=>{var c;const o=i.baseCost!==void 0?i.baseCost:i.cost;let l=o;return r&&((c=i.tags)!=null&&c.includes("Knuckler"))&&(l=Math.max(0,o-2)),i.cost!==l?{...i,cost:l,baseCost:o}:i});return{...n,hand:s}};return{...t,players:{p1:e(t.players.p1),p2:e(t.players.p2)}}},Tw=(t,e)=>{let n=Iw(t,e);return n=Sw(n),n.lastHash=_w(n),n},Iw=(t,e)=>{var s,i,o,l,c,d,u,p,f,b,I,k,F,x,v,T,h,W,G,ce,N,J,Q,Ie,Je;console.log(`[Reducer] Action: ${e.type}, isRemote: ${e.isRemote}`);let n={...t,players:{p1:{...t.players.p1,hand:[...t.players.p1.hand],deck:[...t.players.p1.deck],board:t.players.p1.board.map(pe=>pe?{...pe,passiveAbilities:pe.passiveAbilities?[...pe.passiveAbilities]:[]}:null),graveyard:[...t.players.p1.graveyard]},p2:{...t.players.p2,hand:[...t.players.p2.hand],deck:[...t.players.p2.deck],board:t.players.p2.board.map(pe=>pe?{...pe,passiveAbilities:pe.passiveAbilities?[...pe.passiveAbilities]:[]}:null),graveyard:[...t.players.p2.graveyard]}},logs:[...t.logs||[]]};const r=g0(n.rngSeed||999);switch(n.rngSeed=Math.floor(r()*1e6),e.type){case"START_GAME":return t;case"END_TURN":{const pe=t.activePlayerId,se=n.players[pe];se.extraPpActive&&(se.id!==t.firstPlayerId&&(n.turnCount<=5?se.extraPpUsedEarly=!0:se.extraPpUsedLate=!0),se.extraPpActive=!1);const P=[...n.pendingEffects||[]];se.board.forEach(y=>{y&&y.triggers&&y.triggers.filter(g=>g.trigger==="END_OF_TURN").forEach(g=>{g.effects.forEach(C=>{P.push({sourceCard:y,effect:C,sourcePlayerId:pe})})})});const w=Fp(pe),R=n.players[w];if(R.board.forEach((y,g)=>{y&&y.triggers&&y.triggers.filter(C=>C.trigger==="START_OF_TURN").forEach(C=>{C.effects.forEach(O=>{O.type==="DESTROY_SELF"?y&&(n.players[w].graveyard.push(y),n.players[w].board[g]=null,n.logs.push(`${y.name} `)):P.push({sourceCard:y,effect:O,sourcePlayerId:w})})})}),n.players[w].board=n.players[w].board.filter(Boolean),R.maxPp=Math.min(10,R.maxPp+1),R.pp=R.maxPp,R.deck.length>0){const y=R.deck.pop();y&&(R.hand.length<9?R.hand.push(y):(R.graveyard.push(y),n.logs.push(`${R.name}${y.name}`)))}return R.board=R.board.filter(Boolean),R.board.forEach(y=>{y&&(y.canAttack=!0,y.attacksMade=0,y.turnPlayed=-1)}),R.canEvolveThisTurn=!0,n.activePlayerId=w,n.pendingEffects=P,w===t.firstPlayerId&&(n.turnCount+=1),n.logs.push(` ${n.turnCount} - ${R.name} `),n}case"CONCEDE":{const pe=e.playerId,se=n.players[pe];if(!se)return console.warn(`[Engine] CONCEDE: Unknown playerId: ${pe}. Ignoring.`),t;if(t.phase==="GAME_OVER")return console.warn("[Engine] CONCEDE: Game already over. Ignoring."),t;const P=Fp(pe);return n.phase="GAME_OVER",n.winnerId=P,n.logs.push(`${se.name} `),console.log(`[Engine] CONCEDE: ${pe} surrendered. Winner: ${P}`),n}case"RESOLVE_EFFECT":{if(!n.pendingEffects||n.pendingEffects.length===0)return n;const[pe,...se]=n.pendingEffects;console.log(`[Engine] RESOLVE_EFFECT: Processing ${pe.effect.type} from ${pe.sourceCard.name}. Remaining: ${se.length}`);const P=((s=e.payload)==null?void 0:s.targetId)||pe.targetId;let w=Ew(n,pe.sourcePlayerId,pe.sourceCard,pe.effect,P,pe.targetIds);const R=(w.pendingEffects||[]).filter(g=>{var C;return!((C=n.pendingEffects)!=null&&C.includes(g))}),y=[...se,...R];return console.log(`[Engine] RESOLVE_EFFECT done. Remaining: ${se.length}, NewlyAdded: ${R.length}, Final: ${y.length}`),y.length===0&&Object.values(w.players).forEach(g=>{g.board=g.board.filter(Boolean)}),{...w,pendingEffects:y}}case"PLAY_CARD":{if(!e.isRemote&&n.activePlayerId!==e.playerId)return n;const{cardIndex:pe,targetId:se,instanceId:P}=e.payload,w={...n.players.p1,hand:[...n.players.p1.hand],deck:[...n.players.p1.deck],board:[...n.players.p1.board],graveyard:[...n.players.p1.graveyard]},R={...n.players.p2,hand:[...n.players.p2.hand],deck:[...n.players.p2.deck],board:[...n.players.p2.board],graveyard:[...n.players.p2.graveyard]},y=e.playerId==="p1"?w:R;console.log(`[Engine] PLAY_CARD: playerId=${e.playerId}, cardIndex=${pe}, instanceId=${P}, handLength=${y.hand.length}, isRemote=${e.isRemote}`),console.log("[Engine] PLAY_CARD: hand cards:",y.hand.map(ne=>`${ne.name}(${ne.instanceId})`));let g=pe;if(P){const ne=y.hand.findIndex(re=>re.instanceId===P);if(ne>=0)g=ne,console.log(`[Engine] PLAY_CARD: Using instanceId ${P}, found at index ${ne} (was ${pe})`);else return console.log(`[Engine] PLAY_CARD: instanceId ${P} not found in hand!`),n}if(g<0||g>=y.hand.length)return console.log("[Engine] PLAY_CARD: Invalid cardIndex! Returning unchanged state."),n;const C=y.hand[g];let O="";if(se){const re=(e.playerId==="p1"?R:w).board.find(He=>(He==null?void 0:He.instanceId)===se);re&&(O=` (: ${re.name})`)}if(n.logs.push(`${y.name}  ${C.name} ${O}`),y.pp<C.cost)return n;const M=y.board.filter(ne=>ne!==null).length;if(C.type==="FOLLOWER"&&M>=5)return n;const U=y.pp;y.pp-=C.cost,y.extraPpActive&&U-1<C.cost&&(y.id!==t.firstPlayerId&&(n.turnCount<=5?y.extraPpUsedEarly=!0:y.extraPpUsedLate=!0),y.extraPpActive=!1,y.pp<0&&(y.pp=0),console.log("[Engine] PLAY_CARD: Extra PP consumed, marked as used"),n.logs.push(`${y.name} PP`)),y.hand.splice(g,1);let H=C;if(C.type==="FOLLOWER"){const ne={...C,instanceId:e.payload.instanceId||`inst_${n.rngSeed}_${Math.floor(r()*1e3)}`,currentAttack:C.attack||0,currentHealth:C.health||0,maxHealth:C.health||0,canAttack:!1,hasEvolved:!1,attacksMade:0,turnPlayed:n.turnCount,hasBarrier:((i=C.passiveAbilities)==null?void 0:i.includes("BARRIER"))??!1,passiveAbilities:C.passiveAbilities?[...C.passiveAbilities]:[],hadStealth:((o=C.passiveAbilities)==null?void 0:o.includes("STEALTH"))??!1};((l=C.passiveAbilities)!=null&&l.includes("STORM")||(c=C.passiveAbilities)!=null&&c.includes("RUSH"))&&(ne.canAttack=!0),(d=ne.tags)!=null&&d.includes("Knuckler")&&!ne.passiveAbilities.includes("STORM")&&y.board.some(He=>(He==null?void 0:He.name)==="")&&(ne.passiveAbilities.push("STORM"),ne.canAttack=!0,n.logs.push(`${ne.name}   `)),y.board.push(ne),H=ne,ne.name===""&&y.board.forEach(re=>{var He,st;re&&((He=re.tags)!=null&&He.includes("Knuckler"))&&re.instanceId!==ne.instanceId&&((st=re.passiveAbilities)!=null&&st.includes("STORM")||(re.passiveAbilities||(re.passiveAbilities=[]),re.passiveAbilities.push("STORM"),re.canAttack=!0,n.logs.push(`${re.name}   `)))})}else y.graveyard.push({...C,instanceId:`spell_${n.rngSeed}_${Math.floor(r()*1e3)}`});const me=[];(u=C.triggers)==null||u.filter(ne=>ne.trigger==="FANFARE").forEach(ne=>me.push(...ne.effects)),(p=C.triggerAbilities)!=null&&p.FANFARE&&me.push(C.triggerAbilities.FANFARE);let ve=[...n.pendingEffects||[]];return me.forEach(ne=>{if(ne.conditions&&ne.conditions.minTurn&&n.turnCount<ne.conditions.minTurn)return;let re;if(ne.targetType==="OPPONENT"||ne.targetType==="SELF"||ne.targetType==="ALL_FOLLOWERS"||ne.targetType==="ALL_OTHER_FOLLOWERS"||ne.type==="RANDOM_DESTROY"||ne.type==="RANDOM_SET_HP"||ne.type==="AOE_DAMAGE"||ne.type==="RANDOM_DAMAGE"||ne.type==="RANDOM_DAMAGE_BY_TURN"){const st=e.playerId==="p1"?"p2":"p1",je=e.playerId;if(ne.type==="RANDOM_DAMAGE_BY_TURN"){const we=ne.targetType==="SELF"?je:st,Re=n.players[we].board,at=n.turnCount;re=[];for(let qe=0;qe<at;qe++){const Ze=Re.map((De,mt)=>De?mt:-1).filter(De=>De!==-1);if(Ze.length===0)break;const Ue=Math.floor(r()*Ze.length);re.push(Re[Ze[Ue]].instanceId)}}else if(ne.type==="RANDOM_DESTROY"||ne.type==="RANDOM_SET_HP"||ne.type==="RANDOM_DAMAGE"){const we=ne.targetType==="SELF"?je:st,Re=n.players[we].board,at=ne.type==="RANDOM_DAMAGE"?ne.value2||1:ne.value||1,qe=Re.map((Ue,De)=>Ue?De:-1).filter(Ue=>Ue!==-1);for(let Ue=qe.length-1;Ue>0;Ue--){const De=Math.floor(r()*(Ue+1));[qe[Ue],qe[De]]=[qe[De],qe[Ue]]}re=qe.slice(0,at).map(Ue=>Re[Ue].instanceId)}else if(ne.targetType==="ALL_FOLLOWERS"||ne.type==="AOE_DAMAGE"){const we=ne.type==="GRANT_PASSIVE"||ne.type==="BUFF_STATS",Re=we?je:st;re=n.players[Re].board.filter(qe=>qe!==null).map(qe=>qe.instanceId),console.log(`[Engine] Pre-calculated ALL_FOLLOWERS targets (${we?"ally":"enemy"}): ${re.length} units`)}else ne.targetType==="ALL_OTHER_FOLLOWERS"&&(re=n.players[je].board.filter(Re=>Re!==null&&Re.instanceId!==H.instanceId).map(Re=>Re.instanceId))}const He=ne.targetType==="SELECT_FOLLOWER"||ne.targetType==="SELECT_ALLY_FOLLOWER"||ne.targetType==="SELECT_OTHER_ALLY_FOLLOWER";ve.push({sourceCard:H,effect:ne,sourcePlayerId:e.playerId,targetId:He?se:void 0,targetIds:re})}),console.log(`[Engine] PLAY_CARD: Queued ${me.length} effects. Total pending: ${ve.length}`),{...n,players:{p1:w,p2:R},pendingEffects:ve}}case"EVOLVE":{const{followerIndex:pe,targetId:se,useSep:P}=e.payload,w={...n.players.p1,hand:[...n.players.p1.hand],deck:[...n.players.p1.deck],board:n.players.p1.board.map(H=>H?{...H,passiveAbilities:H.passiveAbilities?[...H.passiveAbilities]:void 0}:null),graveyard:[...n.players.p1.graveyard]},R={...n.players.p2,hand:[...n.players.p2.hand],deck:[...n.players.p2.deck],board:n.players.p2.board.map(H=>H?{...H,passiveAbilities:H.passiveAbilities?[...H.passiveAbilities]:void 0}:null),graveyard:[...n.players.p2.graveyard]},y=e.playerId==="p1"?w:R,g=y.board[pe];if(!g||g.hasEvolved)return n;const C=e.isRemote;if(console.log(`[Engine] EVOLVE Logic: name=${g.name}, useSep=${P}, isRemote=${C}, turn=${t.turnCount}`),n.logs.push(`${y.name}  ${g.name} ${P?"":""}`),P){if(!C){if(t.turnCount<6)return console.log(`[Engine] Cannot Super Evolve: Turn ${t.turnCount} < 6`),n;if(y.sep<=0)return console.log("[Engine] Cannot Super Evolve: No SEP"),n;if(!y.canEvolveThisTurn)return console.log("[Engine] Cannot Super Evolve: Already evolved this turn"),n}y.sep=Math.max(0,y.sep-1),y.canEvolveThisTurn=!1,g.hasEvolved=!0,g.currentAttack+=3,g.currentHealth+=3,g.maxHealth+=3,g.canAttack=!0;const H=[...g.passiveAbilities||[]];H.includes("IMMUNE_TO_DAMAGE_MY_TURN")||H.push("IMMUNE_TO_DAMAGE_MY_TURN"),!H.includes("STORM")&&!H.includes("RUSH")&&H.push("RUSH"),g.passiveAbilities=H,console.log(`[Engine] Super Evolved ${g.name}! SEP remaining: ${y.sep}`)}else{if(!C){const ve=e.playerId===t.firstPlayerId?5:4;if(t.turnCount<ve)return console.log(`[Engine] Cannot Evolve: Turn ${t.turnCount} < ${ve}`),n;if(y.evolutionsUsed>=2)return console.log("[Engine] Cannot Evolve: Limit reached"),n;if(!y.canEvolveThisTurn)return console.log("[Engine] Cannot Evolve: Already evolved this turn"),n}y.evolutionsUsed+=1,y.canEvolveThisTurn=!1,g.hasEvolved=!0,g.currentAttack+=2,g.currentHealth+=2,g.maxHealth+=2,g.canAttack=!0;const H=[...g.passiveAbilities||[]];!H.includes("STORM")&&!H.includes("RUSH")&&H.push("RUSH"),g.passiveAbilities=H}const O=[];(f=g.triggers)==null||f.filter(H=>H.trigger==="EVOLVE").forEach(H=>O.push(...H.effects)),(b=g.triggerAbilities)!=null&&b.EVOLVE&&O.push(g.triggerAbilities.EVOLVE),P&&((I=g.triggers)==null||I.filter(H=>H.trigger==="SUPER_EVOLVE").forEach(H=>O.push(...H.effects)));let M=[...n.pendingEffects||[]];return O.forEach(H=>{if(H.conditions&&H.conditions.minTurn&&n.turnCount<H.conditions.minTurn)return;let me;const ve=e.playerId==="p1"?"p2":"p1",ue=e.playerId;if(H.type==="RANDOM_DESTROY"||H.type==="RANDOM_SET_HP"||H.type==="RANDOM_DAMAGE"){const ne=H.targetType==="SELF"?ue:ve,re=n.players[ne].board,He=H.type==="RANDOM_DAMAGE"?H.value2||1:H.value||1,st=re.map((we,Re)=>we?Re:-1).filter(we=>we!==-1);for(let we=st.length-1;we>0;we--){const Re=Math.floor(r()*(we+1));[st[we],st[Re]]=[st[Re],st[we]]}me=st.slice(0,He).map(we=>re[we].instanceId)}else H.targetType==="ALL_FOLLOWERS"||H.type==="AOE_DAMAGE"?(me=n.players[ve].board.filter(re=>re!==null).map(re=>re.instanceId),console.log(`[Engine EVOLVE] Pre-calculated ALL_FOLLOWERS targets: ${me.length} units`)):H.targetType==="ALL_OTHER_FOLLOWERS"&&(me=n.players[ue].board.filter(re=>re!==null&&re.instanceId!==g.instanceId).map(re=>re.instanceId));M.push({sourceCard:g,effect:H,sourcePlayerId:e.playerId,targetId:se,targetIds:me})}),console.log(`[Engine] EVOLVE: Queued ${O.length} effects. Total pending: ${M.length}`),{...n,players:{p1:w,p2:R},pendingEffects:M}}case"ATTACK":{console.log(`[Engine] ATTACK received. Incoming state P1 HP: ${t.players.p1.hp}, P2 HP: ${t.players.p2.hp}`);const{attackerIndex:pe,targetIndex:se,targetIsLeader:P}=e.payload,w={...n.players.p1,board:n.players.p1.board.map(re=>re?{...re,passiveAbilities:re.passiveAbilities?[...re.passiveAbilities]:void 0}:null),graveyard:[...n.players.p1.graveyard]},R={...n.players.p2,board:n.players.p2.board.map(re=>re?{...re,passiveAbilities:re.passiveAbilities?[...re.passiveAbilities]:void 0}:null),graveyard:[...n.players.p2.graveyard]},y=e.playerId==="p1",g=y?w:R,C=y?R:w,O=g.board[pe];if(!O||!O.canAttack)return n;const M=C.board.filter(re=>{var He,st;return re&&((He=re.passiveAbilities)==null?void 0:He.includes("WARD"))&&!((st=re.passiveAbilities)!=null&&st.includes("STEALTH"))}),U=((k=O.passiveAbilities)==null?void 0:k.includes("STEALTH"))||O.hadStealth;if(M.length>0&&!U){if(P)return console.log("[Engine] Attack blocked: Must attack Ward unit first."),n;const re=C.board[se];if(re&&!((F=re.passiveAbilities)!=null&&F.includes("WARD")))return console.log("[Engine] Attack blocked: Must attack Ward unit first."),n}if(P===!1){const re=C.board[se];if(re&&((x=re.passiveAbilities)!=null&&x.includes("STEALTH")))return console.log("[Engine] ATTACK blocked: Target has STEALTH"),n}const H=(v=O.passiveAbilities)==null?void 0:v.includes("RUSH"),me=(T=O.passiveAbilities)==null?void 0:T.includes("STORM");if(H&&!me&&P&&O.turnPlayed===n.turnCount)return console.log("[Engine] ATTACK blocked: RUSH unit cannot attack leader on the turn it was played"),n;(h=O.passiveAbilities)!=null&&h.includes("STEALTH")&&(O.passiveAbilities=O.passiveAbilities.filter(re=>re!=="STEALTH"),n.logs.push(`${O.name} `)),O.canAttack=!1,O.attacksMade=(O.attacksMade||0)+1,(W=O.passiveAbilities)!=null&&W.includes("DOUBLE_ATTACK")&&O.attacksMade<2&&(O.canAttack=!0);const ve=O.currentAttack;console.log(`[Engine] Attack: ${O.name} (${ve}) -> Target (Leader? ${P}). DefHP before: ${C.hp}`);const ue=(re,He)=>{var je;const st=(je=re.triggers)==null?void 0:je.find(we=>we.trigger==="LAST_WORD");if(st){const we=st.effects.map(Re=>({sourceCard:re,effect:Re,sourcePlayerId:He}));n.pendingEffects=[...n.pendingEffects||[],...we],n.logs.push(`${re.name} `),console.log(`[Engine] Last Word triggered for ${re.name}. pendingEffects count: ${n.pendingEffects.length}`)}};if(P){const re="";if(n.logs.push(`${O.name}  ${re} `),C.leaderDamageShield)C.leaderDamageShield=!1,n.logs.push(`${O.name}  ${re}  ${ve} `);else{const He=C.board.some(je=>{var we;return(we=je==null?void 0:je.passiveAbilities)==null?void 0:we.includes("LEADER_DAMAGE_CAP")}),st=He?Math.min(ve,1):ve;C.hp-=st,He&&ve>1?n.logs.push(`${O.name}  ${re}  ${ve} 1`):n.logs.push(`${O.name}  ${re}  ${st} `),C.hp<=0&&(n.winnerId=e.playerId)}}else{const re=C.board[se];if(!re)return console.log(`[Engine] Attack target at index ${se} no longer exists. Skipping.`),n;n.logs.push(`${O.name}  ${re.name} `);let He=ve;(G=re.passiveAbilities)!=null&&G.includes("IMMUNE_TO_FOLLOWER_DAMAGE")?(He=0,n.logs.push(`${re.name} `)):re.hasBarrier&&He>0?(He=0,re.hasBarrier=!1,n.logs.push(`${re.name} `)):n.logs.push(`${O.name}  ${re.name}  ${He} `),re.currentHealth-=He;const st=y?"p2":"p1",je=((ce=re.passiveAbilities)==null?void 0:ce.includes("IMMUNE_TO_DAMAGE_MY_TURN"))&&n.activePlayerId===st;(N=O.passiveAbilities)!=null&&N.includes("BANE")&&re.currentHealth>0&&(je?n.logs.push(`${re.name} `):(re.currentHealth=0,re.killedByBane=!0,n.logs.push(`${O.name}  ${re.name} `)));let we=re.currentAttack;(J=O.passiveAbilities)!=null&&J.includes("IMMUNE_TO_DAMAGE_MY_TURN")&&(we=0,n.logs.push(`${O.name} `)),O.hasBarrier&&we>0?(we=0,O.hasBarrier=!1,n.logs.push(`${O.name} `)):we>0&&n.logs.push(`${re.name}  ${O.name}  ${we} `),O.currentHealth-=we;const Re=y?"p1":"p2";O.currentHealth<=0&&((Q=O.passiveAbilities)!=null&&Q.includes("GUTS_MY_TURN"))&&n.activePlayerId===Re&&(O.currentHealth=1,n.logs.push(`${O.name} 1`));const at=((Ie=O.passiveAbilities)==null?void 0:Ie.includes("IMMUNE_TO_DAMAGE_MY_TURN"))&&n.activePlayerId===Re;(Je=re.passiveAbilities)!=null&&Je.includes("BANE")&&O.currentHealth>0&&(at?n.logs.push(`${O.name} `):(O.currentHealth=0,O.killedByBane=!0,n.logs.push(`${re.name}  ${O.name} `)));const qe=re.currentHealth<=0,Ze=O.currentHealth<=0;qe&&(re.currentHealth=Math.min(0,re.currentHealth),C.graveyard.push(re),C.board[se]=null,n.logs.push(`${re.name} `)),Ze&&(O.currentHealth=Math.min(0,O.currentHealth),g.graveyard.push(O),g.board[pe]=null,n.logs.push(`${O.name} `)),qe&&ue(re,y?"p2":"p1"),Ze&&ue(O,y?"p1":"p2")}console.log(`[Engine] Committing state. P1 HP: ${w.hp}, P2 HP: ${R.hp}`);const ne={...n,players:{p1:w,p2:R}};return console.log(`[Engine] After commit. finalState.players.p1.hp: ${ne.players.p1.hp}, finalState.players.p2.hp: ${ne.players.p2.hp}`),ne}case"REINIT_GAME":{const{p1Class:pe,p2Class:se}=e.payload;return console.log(`[Engine] REINIT_GAME: p1=${pe}, p2=${se}`),Ld("Player 1",pe,"Player 2",se)}case"SYNC_STATE":return console.log("[Engine] SYNC_STATE received"),e.payload;case"UPDATE_PLAYER_NAME":{const{playerId:pe,name:se}=e.payload;return console.log("[Engine] UPDATE_PLAYER_NAME:",pe,se),t.players[pe]?{...t,players:{...t.players,[pe]:{...t.players[pe],name:se}}}:(console.warn("[Engine] UPDATE_PLAYER_NAME: Unknown playerId:",pe),t)}case"SET_FIRST_PLAYER_ID":{const{firstPlayerId:pe}=e.payload;return console.log("[Engine] SET_FIRST_PLAYER_ID:",pe),{...t,firstPlayerId:pe}}case"TOGGLE_EXTRA_PP":{const pe=e.playerId,se=n.players[pe];if(!(pe!==t.firstPlayerId))return console.log("[Engine] TOGGLE_EXTRA_PP: Only second player can use Extra PP"),t;if(t.activePlayerId!==pe)return console.log("[Engine] TOGGLE_EXTRA_PP: Can only toggle on your turn"),t;if(se.extraPpActive)return se.extraPpActive=!1,se.pp=Math.max(0,se.pp-1),console.log("[Engine] TOGGLE_EXTRA_PP: Deactivated, PP now",se.pp),n;if(n.turnCount<=5){if(se.extraPpUsedEarly)return console.log("[Engine] TOGGLE_EXTRA_PP: Already used in early turns"),t}else if(se.extraPpUsedLate)return console.log("[Engine] TOGGLE_EXTRA_PP: Already used in late turns"),t;return se.extraPpActive=!0,se.pp+=1,console.log("[Engine] TOGGLE_EXTRA_PP: Activated, PP now",se.pp),n}default:return t}},sf=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},ww=sf("/leaders/azya_leader.png"),Cw=sf("/leaders/senka_leader.png"),kw=sf("/leaders/yoRuka_leader.png"),Rw=1280,Aw=720,Pw={SENKA:{primary:"#e94560",gradient:"linear-gradient(135deg, #2c0b0e 0%, #1a1a2e 100%)",shadow:"rgba(233, 69, 96, 0.3)"},AJA:{primary:"#45a2e9",gradient:"linear-gradient(135deg, #0f1c2e 0%, #1a1a2e 100%)",shadow:"rgba(69, 162, 233, 0.3)"},YORUKA:{primary:"#a855f7",gradient:"linear-gradient(135deg, #1a0f2e 0%, #1a1a2e 100%)",shadow:"rgba(168, 85, 247, 0.3)"}},Ow={SENKA:"",AJA:"",YORUKA:"Y"},Lw={SENKA:Cw,AJA:ww,YORUKA:kw},Ya=["SENKA","AJA","YORUKA"],Dw=({classType:t,onSelectCard:e})=>{const[n,r]=A.useState(1),[s,i]=A.useState(Ya.indexOf(t));A.useEffect(()=>{const N=()=>{const J=window.innerWidth/Rw,Q=window.innerHeight/Aw;r(Math.min(J,Q))};return N(),window.addEventListener("resize",N),()=>window.removeEventListener("resize",N)},[]);const o=N=>N==="SENKA"?m0:N==="AJA"?y0:v0,l=Ya[s],d=o(l).filter(N=>!N.cardId.startsWith("TOKEN_")).map(N=>({card:zn.find(J=>J.id===N.cardId),count:N.count})).filter(N=>N.card).sort((N,J)=>N.card.cost-J.card.cost),u={};d.forEach(({card:N,count:J})=>{u[N.cost]=(u[N.cost]||0)+J});const p=Math.max(...Object.keys(u).map(Number),10),f=Math.max(...Object.values(u),1),b=Pw[l],I=Ow[l],k=Lw[l],F=180*n,x=250*n,v=110*n,T=155*n,h=.6*n,W=1.8*n,G=()=>{i(N=>(N-1+Ya.length)%Ya.length)},ce=()=>{i(N=>(N+1)%Ya.length)};return a.jsxs("div",{style:{minHeight:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",background:b.gradient,color:"white",position:"relative",paddingTop:`${10*n}px`,paddingBottom:`${120*n}px`},children:[a.jsxs("h2",{style:{fontSize:`${W}rem`,marginTop:"0px",marginBottom:`${10*n}px`,fontFamily:"sans-serif",color:b.primary,textShadow:`0 0 20px ${b.shadow}`},children:[I," - "]}),a.jsxs("div",{style:{display:"flex",gap:`${2*n}rem`,width:"95%",maxWidth:`${1100*n}px`,alignItems:"flex-start",justifyContent:"center"},children:[a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${1.5*n}rem`},children:[a.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:`${.8*n}rem`},children:[a.jsx("button",{onClick:G,style:{width:`${45*n}px`,height:`${45*n}px`,background:"rgba(0, 0, 0, 0.5)",border:`2px solid ${b.primary}`,borderRadius:"50%",color:b.primary,fontSize:`${1.5*n}rem`,cursor:"pointer",fontWeight:"bold",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},onMouseOver:N=>{N.currentTarget.style.background=b.primary,N.currentTarget.style.color="white"},onMouseOut:N=>{N.currentTarget.style.background="rgba(0, 0, 0, 0.5)",N.currentTarget.style.color=b.primary},children:"<"}),a.jsxs("div",{style:{width:F,height:x,border:`3px solid ${b.primary}`,borderRadius:10*n,background:"linear-gradient(180deg, rgba(0,0,0,0.5) 0%, rgba(0,0,0,0.8) 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",boxShadow:`0 8px 30px ${b.shadow}`,overflow:"hidden",position:"relative"},children:[a.jsx("img",{src:k,alt:I,style:{width:"100%",height:"75%",objectFit:"cover"}}),a.jsx("div",{style:{padding:`${8*n}px`,display:"flex",flexDirection:"column",alignItems:"center",width:"100%",justifyContent:"center",flex:1},children:a.jsx("h3",{style:{fontSize:`${1.2*n}rem`,color:b.primary,margin:0,fontFamily:"sans-serif"},children:I})})]}),a.jsx("button",{onClick:ce,style:{width:`${45*n}px`,height:`${45*n}px`,background:"rgba(0, 0, 0, 0.5)",border:`2px solid ${b.primary}`,borderRadius:"50%",color:b.primary,fontSize:`${1.5*n}rem`,cursor:"pointer",fontWeight:"bold",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},onMouseOver:N=>{N.currentTarget.style.background=b.primary,N.currentTarget.style.color="white"},onMouseOut:N=>{N.currentTarget.style.background="rgba(0, 0, 0, 0.5)",N.currentTarget.style.color=b.primary},children:">"})]}),a.jsxs("div",{style:{width:F+45*2*n+.8*2*n*16,padding:`${12*n}px`,background:"rgba(0, 0, 0, 0.5)",borderRadius:8*n,border:`1px solid ${b.primary}30`},children:[a.jsx("h4",{style:{fontSize:`${.8*n}rem`,margin:`0 0 ${8*n}px 0`,color:b.primary,textAlign:"center",fontFamily:"sans-serif"},children:""}),a.jsx("div",{style:{display:"flex",alignItems:"flex-end",justifyContent:"space-between",height:`${100*n}px`,gap:`${2*n}px`,borderBottom:`1px solid ${b.primary}40`,paddingBottom:`${4*n}px`},children:Array.from({length:p+1},(N,J)=>{const Q=u[J]||0,Ie=f>0?Q/f*80*n:0;return a.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:`${2*n}px`},children:[Q>0&&a.jsx("div",{style:{fontSize:`${.6*n}rem`,color:b.primary,fontWeight:"bold",fontFamily:"sans-serif"},children:Q}),a.jsx("div",{style:{width:"100%",height:`${Ie}px`,background:Q>0?`linear-gradient(180deg, ${b.primary} 0%, ${b.primary}80 100%)`:"transparent",borderRadius:`${2*n}px`,transition:"all 0.3s",boxShadow:Q>0?`0 0 8px ${b.shadow}`:"none"}}),a.jsx("div",{style:{fontSize:`${.65*n}rem`,color:"#aaa",fontFamily:"sans-serif"},children:J})]},J)})})]})]}),a.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:`${1*n}rem`},children:[a.jsx("div",{style:{display:"grid",gridTemplateColumns:`repeat(auto-fill, minmax(${v}px, 1fr))`,gap:`${h}rem`,width:"100%",padding:`${10*n}px`,maxHeight:`${(T+h*16)*3+40*n}px`,overflowY:"auto",overflowX:"hidden"},children:d.map(({card:N,count:J})=>a.jsxs("div",{onClick:()=>e(N.id),style:{width:v,height:T,border:`2px solid ${b.primary}`,borderRadius:8*n,background:"linear-gradient(180deg, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.9) 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"all 0.2s",boxShadow:`0 4px 15px ${b.shadow}`,position:"relative",overflow:"hidden"},onMouseOver:Q=>{Q.currentTarget.style.transform="translateY(-5px) scale(1.05)",Q.currentTarget.style.boxShadow=`0 8px 25px ${b.shadow}`},onMouseOut:Q=>{Q.currentTarget.style.transform="translateY(0) scale(1)",Q.currentTarget.style.boxShadow=`0 4px 15px ${b.shadow}`},children:[a.jsx("div",{style:{width:"100%",height:"65%",overflow:"hidden",borderBottom:`1px solid ${b.primary}`},children:a.jsx("img",{src:sf(N.imageUrl||`/cards/${N.id}.png`),alt:N.name,style:{width:"100%",height:"100%",objectFit:"cover"},onError:Q=>{Q.currentTarget.style.display="none"}})}),a.jsxs("div",{style:{padding:`${5*n}px`,textAlign:"center",flex:1,display:"flex",flexDirection:"column",justifyContent:"center",width:"100%"},children:[a.jsx("h3",{style:{fontSize:`${.7*n}rem`,margin:`0 0 ${3*n}px 0`,fontFamily:"sans-serif",color:b.primary,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:N.name}),a.jsxs("p",{style:{fontSize:`${.6*n}rem`,color:"#ffcc00",margin:0,fontFamily:"sans-serif",fontWeight:"bold"},children:[": ",N.cost]})]}),a.jsx("div",{style:{position:"absolute",bottom:`${5*n}px`,right:`${5*n}px`,background:"rgba(0, 0, 0, 0.8)",color:"white",borderRadius:50,width:`${22*n}px`,height:`${22*n}px`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${.7*n}rem`,fontWeight:"bold",fontFamily:"sans-serif",border:`2px solid ${b.primary}`,boxShadow:`0 0 10px ${b.shadow}`},children:J})]},N.id))}),a.jsxs("div",{style:{fontSize:`${.85*n}rem`,color:"#aaa",fontFamily:"sans-serif",textAlign:"center"},children:[" ",d.length," "]})]})]})]})},Mw=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},Nw=1280,jw=720,$w=({cardId:t,allCardIds:e=[],onNavigate:n,onOpenRelatedCard:r,onBack:s,onSetHomeCard:i})=>{const[o,l]=A.useState(1),[c,d]=A.useState(!1);A.useEffect(()=>{const h=()=>{const W=window.innerWidth/Nw,G=window.innerHeight/jw;l(Math.min(W,G))};return h(),window.addEventListener("resize",h),()=>window.removeEventListener("resize",h)},[]);const u=zn.find(h=>h.id===t);if(!u)return a.jsx("div",{style:{minHeight:"100dvh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",fontFamily:"sans-serif",fontSize:`${1.5*o}rem`},children:""});const p=(h,W)=>Mw(h||W),f=p(u.imageUrl,`/cards/${u.id}.png`),b=u.type==="FOLLOWER"?p(u.evolvedImageUrl,`/cards/${u.id}_evolved.png`):null,I=200*o,k=280*o,F=1*o,x="linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #1a1a2e 100%)",v=()=>{console.log(" GalleryCardDetailScreen handleSetHomeCard called with cardId:",t),i?(console.log(" Calling onSetHomeCard callback"),i(t),d(!0),setTimeout(()=>d(!1),1500)):console.warn(" onSetHomeCard callback is not provided")},T=e.length>1&&n;return a.jsxs("div",{style:{minHeight:"100dvh",display:"flex",flexDirection:"column",background:x,color:"white",fontFamily:"sans-serif",overflow:"auto",paddingTop:`${20*o}px`},children:[a.jsx("div",{style:{position:"absolute",top:`${15*o}px`,left:`${15*o}px`,zIndex:100},children:a.jsx("button",{onClick:s,style:{background:"rgba(255, 255, 255, 0.1)",padding:`${8*o}px ${16*o}px`,fontSize:`${.9*o}rem`,border:"1px solid rgba(255, 255, 255, 0.3)",borderRadius:`${6*o}px`,color:"white",cursor:"pointer",fontFamily:"sans-serif",transition:"all 0.2s"},onMouseOver:h=>h.currentTarget.style.background="rgba(255, 255, 255, 0.2)",onMouseOut:h=>h.currentTarget.style.background="rgba(255, 255, 255, 0.1)",children:""})}),T&&a.jsx("div",{style:{position:"absolute",left:`${20*o}px`,top:"50%",transform:"translateY(-50%)",zIndex:100},children:a.jsx("button",{onClick:()=>n("prev"),style:{width:`${60*o}px`,height:`${60*o}px`,background:"rgba(0, 0, 0, 0.6)",border:"2px solid rgba(255, 255, 255, 0.3)",borderRadius:"50%",color:"white",fontSize:`${2*o}rem`,cursor:"pointer",fontWeight:"bold",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},onMouseOver:h=>{h.currentTarget.style.background="rgba(255, 255, 255, 0.2)",h.currentTarget.style.transform="scale(1.1)"},onMouseOut:h=>{h.currentTarget.style.background="rgba(0, 0, 0, 0.6)",h.currentTarget.style.transform="scale(1)"},children:"<"})}),T&&a.jsx("div",{style:{position:"absolute",right:`${20*o}px`,top:"50%",transform:"translateY(-50%)",zIndex:100},children:a.jsx("button",{onClick:()=>n("next"),style:{width:`${60*o}px`,height:`${60*o}px`,background:"rgba(0, 0, 0, 0.6)",border:"2px solid rgba(255, 255, 255, 0.3)",borderRadius:"50%",color:"white",fontSize:`${2*o}rem`,cursor:"pointer",fontWeight:"bold",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center"},onMouseOver:h=>{h.currentTarget.style.background="rgba(255, 255, 255, 0.2)",h.currentTarget.style.transform="scale(1.1)"},onMouseOut:h=>{h.currentTarget.style.background="rgba(0, 0, 0, 0.6)",h.currentTarget.style.transform="scale(1)"},children:">"})}),a.jsxs("div",{style:{display:"flex",gap:`${2*o}rem`,padding:`${20*o}px ${30*o}px`,flex:1,justifyContent:"center",alignItems:"flex-start",maxWidth:`${1200*o}px`,width:"100%",margin:"0 auto"},children:[a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${1*o}rem`,flex:"0 0 auto",width:`${I*2+F*16}px`},children:[a.jsx("div",{style:{display:"flex",flexDirection:"row",alignItems:"flex-start",justifyContent:u.type==="SPELL"?"center":"flex-start",gap:`${F}rem`,width:"100%"},children:u.type==="FOLLOWER"?a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*o}rem`},children:[a.jsx("div",{style:{width:I,height:k,border:"2px solid rgba(255, 255, 255, 0.3)",borderRadius:`${12*o}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.5)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:f,alt:`${u.name} `,style:{width:"100%",height:"100%",objectFit:"cover"}})}),a.jsx("div",{style:{fontSize:`${.75*o}rem`,color:"#aaa",textAlign:"center"},children:""})]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*o}rem`},children:[a.jsx("div",{style:{width:I,height:k,border:"2px solid rgba(255, 215, 0, 0.5)",borderRadius:`${12*o}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(255, 215, 0, 0.3)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:b||f,alt:`${u.name} `,style:{width:"100%",height:"100%",objectFit:"cover"}})}),a.jsx("div",{style:{fontSize:`${.75*o}rem`,color:"#ffd700",textAlign:"center"},children:""})]})]}):a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*o}rem`},children:[a.jsx("div",{style:{width:I,height:k,border:"2px solid rgba(138, 43, 226, 0.5)",borderRadius:`${12*o}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(138, 43, 226, 0.3)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:f,alt:u.name,style:{width:"100%",height:"100%",objectFit:"cover"}})}),a.jsx("div",{style:{fontSize:`${.75*o}rem`,height:`${.75*o*1.5}rem`,visibility:"hidden"}})]})}),a.jsxs("div",{style:{display:"flex",gap:`${12*o}px`,flexWrap:"wrap",width:"100%",justifyContent:"center"},children:[a.jsx("button",{onClick:v,disabled:c,style:{padding:`${.9*o}rem ${1.8*o}rem`,background:c?"#10b981":"#3b82f6",color:"white",border:"none",borderRadius:`${8*o}px`,fontSize:`${1*o}rem`,fontWeight:"bold",fontFamily:"sans-serif",cursor:c?"default":"pointer",transition:"all 0.2s",boxShadow:c?"0 4px 15px rgba(16, 185, 129, 0.3)":"0 4px 15px rgba(59, 130, 246, 0.3)",flex:1,minWidth:`${150*o}px`},onMouseOver:h=>{c||(h.currentTarget.style.background="#2563eb",h.currentTarget.style.transform="translateY(-2px)",h.currentTarget.style.boxShadow="0 6px 20px rgba(59, 130, 246, 0.4)")},onMouseOut:h=>{c||(h.currentTarget.style.background="#3b82f6",h.currentTarget.style.transform="translateY(0)",h.currentTarget.style.boxShadow="0 4px 15px rgba(59, 130, 246, 0.3)")},children:c?" ":""}),u.relatedCards&&u.relatedCards.length>0&&a.jsxs("button",{onClick:()=>r(t),style:{padding:`${.9*o}rem ${1.8*o}rem`,background:"#4ade80",color:"white",border:"none",borderRadius:`${8*o}px`,fontSize:`${1*o}rem`,fontWeight:"bold",fontFamily:"sans-serif",cursor:"pointer",transition:"all 0.2s",boxShadow:"0 4px 15px rgba(74, 222, 128, 0.3)",flex:1,minWidth:`${150*o}px`},onMouseOver:h=>{h.currentTarget.style.background="#22c55e",h.currentTarget.style.transform="translateY(-2px)",h.currentTarget.style.boxShadow="0 6px 20px rgba(74, 222, 128, 0.4)"},onMouseOut:h=>{h.currentTarget.style.background="#4ade80",h.currentTarget.style.transform="translateY(0)",h.currentTarget.style.boxShadow="0 4px 15px rgba(74, 222, 128, 0.3)"},children:[" (",u.relatedCards.length,")"]})]})]}),a.jsxs("div",{style:{flex:"0 0 auto",width:`${450*o}px`,background:"rgba(0, 0, 0, 0.5)",padding:`${25*o}px`,borderRadius:`${12*o}px`,border:"1px solid rgba(255, 255, 255, 0.2)",display:"flex",flexDirection:"column",gap:`${18*o}px`,minHeight:`${450*o}px`,maxHeight:`${550*o}px`,overflowY:"auto"},children:[a.jsx("h2",{style:{fontSize:`${1.8*o}rem`,fontWeight:"bold",margin:0,color:"#fff",textAlign:"left"},children:u.name}),a.jsxs("div",{style:{display:"flex",gap:`${20*o}px`,fontSize:`${1.2*o}rem`,flexWrap:"wrap"},children:[a.jsxs("div",{style:{color:"#ffd700"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:u.cost})]}),u.type==="FOLLOWER"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{color:"#ff6b6b"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:u.attack})]}),a.jsxs("div",{style:{color:"#4ecdc4"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:u.health})]})]})]}),a.jsx("div",{style:{height:"1px",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)"}}),a.jsxs("div",{children:[a.jsx("h3",{style:{fontSize:`${1.1*o}rem`,margin:`0 0 ${8*o}px 0`,color:"#aaa"},children:""}),a.jsx("p",{style:{fontSize:`${1*o}rem`,margin:0,whiteSpace:"pre-wrap",lineHeight:1.7,color:"#fff"},children:u.description})]}),u.flavorText&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{height:"1px",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)"}}),a.jsxs("div",{children:[a.jsx("h3",{style:{fontSize:`${1.1*o}rem`,margin:`0 0 ${8*o}px 0`,color:"#aaa"},children:""}),a.jsx("p",{style:{fontSize:`${.95*o}rem`,margin:0,fontStyle:"italic",opacity:.7,lineHeight:1.7,whiteSpace:"pre-wrap",color:"#ccc"},children:u.flavorText})]})]})]})]})]})},Fw=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},Uw=1280,Bw=720,zw=({parentCardId:t,relatedCardIds:e,onBack:n})=>{const[r,s]=A.useState(1),[i,o]=A.useState(0);A.useEffect(()=>{const T=()=>{const h=window.innerWidth/Uw,W=window.innerHeight/Bw;s(Math.min(h,W))};return T(),window.addEventListener("resize",T),()=>window.removeEventListener("resize",T)},[]);const l=e[i],c=zn.find(T=>T.id===l),d=()=>{o(T=>T>0?T-1:e.length-1)},u=()=>{o(T=>T<e.length-1?T+1:0)};if(!c)return a.jsx("div",{style:{minHeight:"100dvh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",fontFamily:"Tamanegi, sans-serif",fontSize:`${1.5*r}rem`},children:""});const p=(T,h)=>Fw(T||h),f=p(c.imageUrl,`/cards/${c.id}.png`),b=c.type==="FOLLOWER"?p(c.evolvedImageUrl,`/cards/${c.id}_evolved.png`):null,I=200*r,k=280*r,F=1*r,x="linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #1a1a2e 100%)",v={fontSize:`${2*r}rem`,background:"rgba(0, 0, 0, 0.5)",padding:`${.8*r}rem ${1.2*r}rem`,borderRadius:`${8*r}px`,cursor:"pointer",border:"1px solid rgba(255, 255, 255, 0.2)",color:"white",transition:"all 0.2s",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center"};return a.jsxs("div",{style:{minHeight:"100dvh",display:"flex",flexDirection:"column",background:x,color:"white",fontFamily:"sans-serif",overflow:"auto",paddingTop:`${20*r}px`},children:[a.jsx("div",{style:{position:"absolute",top:`${15*r}px`,left:`${15*r}px`,zIndex:100},children:a.jsx("button",{onClick:n,style:{background:"rgba(255, 255, 255, 0.1)",padding:`${8*r}px ${16*r}px`,fontSize:`${.9*r}rem`,border:"1px solid rgba(255, 255, 255, 0.3)",borderRadius:`${6*r}px`,color:"white",cursor:"pointer",fontFamily:"sans-serif",transition:"all 0.2s"},onMouseOver:T=>T.currentTarget.style.background="rgba(255, 255, 255, 0.2)",onMouseOut:T=>T.currentTarget.style.background="rgba(255, 255, 255, 0.1)",children:""})}),a.jsxs("div",{style:{position:"absolute",top:`${15*r}px`,right:`${15*r}px`,zIndex:100,fontSize:`${1*r}rem`,opacity:.8,fontWeight:"bold",background:"rgba(0, 0, 0, 0.5)",padding:`${8*r}px ${16*r}px`,borderRadius:`${6*r}px`,border:"1px solid rgba(255, 255, 255, 0.2)"},children:[i+1," / ",e.length]}),a.jsx("button",{onClick:d,style:{...v,position:"absolute",left:`${15*r}px`,top:"50%",transform:"translateY(-50%)",zIndex:100},onMouseOver:T=>T.currentTarget.style.background="rgba(0, 0, 0, 0.7)",onMouseOut:T=>T.currentTarget.style.background="rgba(0, 0, 0, 0.5)",children:"<"}),a.jsx("button",{onClick:u,style:{...v,position:"absolute",right:`${15*r}px`,top:"50%",transform:"translateY(-50%)",zIndex:100},onMouseOver:T=>T.currentTarget.style.background="rgba(0, 0, 0, 0.7)",onMouseOut:T=>T.currentTarget.style.background="rgba(0, 0, 0, 0.5)",children:">"}),a.jsxs("div",{style:{display:"flex",gap:`${2*r}rem`,padding:`${20*r}px ${30*r}px`,flex:1,justifyContent:"center",alignItems:"flex-start",maxWidth:`${1200*r}px`,width:"100%",margin:"0 auto"},children:[a.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${1*r}rem`,flex:"0 0 auto",width:`${I*2+F*16}px`},children:a.jsx("div",{style:{display:"flex",flexDirection:"row",alignItems:"flex-start",justifyContent:c.type==="SPELL"?"center":"flex-start",gap:`${F}rem`,width:"100%"},children:c.type==="FOLLOWER"?a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*r}rem`},children:[a.jsx("div",{style:{width:I,height:k,border:"2px solid rgba(255, 255, 255, 0.3)",borderRadius:`${12*r}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.5)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:f,alt:`${c.name} `,style:{width:"100%",height:"100%",objectFit:"cover"}})}),a.jsx("div",{style:{fontSize:`${.75*r}rem`,color:"#aaa",textAlign:"center"},children:""})]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*r}rem`},children:[a.jsx("div",{style:{width:I,height:k,border:"2px solid rgba(255, 215, 0, 0.5)",borderRadius:`${12*r}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(255, 215, 0, 0.3)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:b||f,alt:`${c.name} `,style:{width:"100%",height:"100%",objectFit:"cover"}})}),a.jsx("div",{style:{fontSize:`${.75*r}rem`,color:"#ffd700",textAlign:"center"},children:""})]})]}):a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*r}rem`},children:[a.jsx("div",{style:{width:I,height:k,border:"2px solid rgba(138, 43, 226, 0.5)",borderRadius:`${12*r}px`,overflow:"hidden",boxShadow:"0 8px 30px rgba(138, 43, 226, 0.3)",background:"rgba(0, 0, 0, 0.3)"},children:a.jsx("img",{src:f,alt:c.name,style:{width:"100%",height:"100%",objectFit:"cover"}})}),a.jsx("div",{style:{fontSize:`${.75*r}rem`,height:`${.75*r*1.5}rem`,visibility:"hidden"}})]})})}),a.jsxs("div",{style:{flex:"0 0 auto",width:`${450*r}px`,background:"rgba(0, 0, 0, 0.5)",padding:`${25*r}px`,borderRadius:`${12*r}px`,border:"1px solid rgba(255, 255, 255, 0.2)",display:"flex",flexDirection:"column",gap:`${18*r}px`,minHeight:`${450*r}px`,maxHeight:`${550*r}px`,overflowY:"auto"},children:[a.jsx("h2",{style:{fontSize:`${1.8*r}rem`,fontWeight:"bold",margin:0,color:"#fff",textAlign:"left"},children:c.name}),a.jsxs("div",{style:{display:"flex",gap:`${20*r}px`,fontSize:`${1.2*r}rem`,flexWrap:"wrap"},children:[a.jsxs("div",{style:{color:"#ffd700"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:c.cost})]}),c.type==="FOLLOWER"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{color:"#ff6b6b"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:c.attack})]}),a.jsxs("div",{style:{color:"#4ecdc4"},children:[": ",a.jsx("span",{style:{fontWeight:"bold"},children:c.health})]})]})]}),a.jsx("div",{style:{height:"1px",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)"}}),a.jsxs("div",{children:[a.jsx("h3",{style:{fontSize:`${1.1*r}rem`,margin:`0 0 ${8*r}px 0`,color:"#aaa"},children:""}),a.jsx("p",{style:{fontSize:`${1*r}rem`,margin:0,whiteSpace:"pre-wrap",lineHeight:1.7,color:"#fff"},children:c.description})]}),c.flavorText&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{height:"1px",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)"}}),a.jsxs("div",{children:[a.jsx("h3",{style:{fontSize:`${1.1*r}rem`,margin:`0 0 ${8*r}px 0`,color:"#aaa"},children:""}),a.jsx("p",{style:{fontSize:`${.95*r}rem`,margin:0,fontStyle:"italic",opacity:.7,lineHeight:1.7,whiteSpace:"pre-wrap",color:"#ccc"},children:c.flavorText})]})]})]})]})]})},Hw=()=>{};var yv={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yb={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ge=function(t,e){if(!t)throw da(e)},da=function(t){return new Error("Firebase Database ("+yb.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vb=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},Ww=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=t[n++],o=t[n++],l=t[n++],c=((s&7)<<18|(i&63)<<12|(o&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{const i=t[n++],o=t[n++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},x0={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<t.length;s+=3){const i=t[s],o=s+1<t.length,l=o?t[s+1]:0,c=s+2<t.length,d=c?t[s+2]:0,u=i>>2,p=(i&3)<<4|l>>4;let f=(l&15)<<2|d>>6,b=d&63;c||(b=64,o||(f=64)),r.push(n[u],n[p],n[f],n[b])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(vb(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):Ww(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<t.length;){const i=n[t.charAt(s++)],l=s<t.length?n[t.charAt(s)]:0;++s;const d=s<t.length?n[t.charAt(s)]:64;++s;const p=s<t.length?n[t.charAt(s)]:64;if(++s,i==null||l==null||d==null||p==null)throw new Gw;const f=i<<2|l>>4;if(r.push(f),d!==64){const b=l<<4&240|d>>2;if(r.push(b),p!==64){const I=d<<6&192|p;r.push(I)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class Gw extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const xb=function(t){const e=vb(t);return x0.encodeByteArray(e,!0)},mu=function(t){return xb(t).replace(/\./g,"")},yu=function(t){try{return x0.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vw(t){return _b(void 0,t)}function _b(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const n=e;return new Date(n.getTime());case Object:t===void 0&&(t={});break;case Array:t=[];break;default:return e}for(const n in e)!e.hasOwnProperty(n)||!Yw(n)||(t[n]=_b(t[n],e[n]));return t}function Yw(t){return t!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kw(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xw=()=>Kw().__FIREBASE_DEFAULTS__,Jw=()=>{if(typeof process>"u"||typeof yv>"u")return;const t=yv.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},Qw=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&yu(t[1]);return e&&JSON.parse(e)},_0=()=>{try{return Hw()||Xw()||Jw()||Qw()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},bb=t=>{var e,n;return(n=(e=_0())==null?void 0:e.emulatorHosts)==null?void 0:n[t]},qw=t=>{const e=bb(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},Eb=()=>{var t;return(t=_0())==null?void 0:t.config},Sb=t=>{var e;return(e=_0())==null?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ir{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ua(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Tb(t){return(await fetch(t,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zw(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",s=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...t};return[mu(JSON.stringify(n)),mu(JSON.stringify(o)),""].join(".")}const ml={};function e5(){const t={prod:[],emulator:[]};for(const e of Object.keys(ml))ml[e]?t.emulator.push(e):t.prod.push(e);return t}function t5(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let vv=!1;function Ib(t,e){if(typeof window>"u"||typeof document>"u"||!ua(window.location.host)||ml[t]===e||ml[t]||vv)return;ml[t]=e;function n(f){return`__firebase__banner__${f}`}const r="__firebase__banner",i=e5().prod.length>0;function o(){const f=document.getElementById(r);f&&f.remove()}function l(f){f.style.display="flex",f.style.background="#7faaf0",f.style.position="fixed",f.style.bottom="5px",f.style.left="5px",f.style.padding=".5em",f.style.borderRadius="5px",f.style.alignItems="center"}function c(f,b){f.setAttribute("width","24"),f.setAttribute("id",b),f.setAttribute("height","24"),f.setAttribute("viewBox","0 0 24 24"),f.setAttribute("fill","none"),f.style.marginLeft="-6px"}function d(){const f=document.createElement("span");return f.style.cursor="pointer",f.style.marginLeft="16px",f.style.fontSize="24px",f.innerHTML=" &times;",f.onclick=()=>{vv=!0,o()},f}function u(f,b){f.setAttribute("id",b),f.innerText="Learn more",f.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",f.setAttribute("target","__blank"),f.style.paddingLeft="5px",f.style.textDecoration="underline"}function p(){const f=t5(r),b=n("text"),I=document.getElementById(b)||document.createElement("span"),k=n("learnmore"),F=document.getElementById(k)||document.createElement("a"),x=n("preprendIcon"),v=document.getElementById(x)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(f.created){const T=f.element;l(T),u(F,k);const h=d();c(v,x),T.append(v,I,F,h),document.body.appendChild(T)}i?(I.innerText="Preview backend disconnected.",v.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(v.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,I.innerText="Preview backend running in this workspace."),I.setAttribute("id",b)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",p):p()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function On(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function b0(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(On())}function n5(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function r5(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function wb(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function s5(){const t=On();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function i5(){return yb.NODE_ADMIN===!0}function o5(){try{return typeof indexedDB=="object"}catch{return!1}}function a5(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var i;e(((i=s.error)==null?void 0:i.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l5="FirebaseError";class gi extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=l5,Object.setPrototypeOf(this,gi.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,cc.prototype.create)}}class cc{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?c5(i,r):"Error",l=`${this.serviceName}: ${o} (${s}).`;return new gi(s,l,r)}}function c5(t,e){return t.replace(d5,(n,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const d5=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wl(t){return JSON.parse(t)}function Zt(t){return JSON.stringify(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cb=function(t){let e={},n={},r={},s="";try{const i=t.split(".");e=Wl(yu(i[0])||""),n=Wl(yu(i[1])||""),s=i[2],r=n.d||{},delete n.d}catch{}return{header:e,claims:n,data:r,signature:s}},u5=function(t){const e=Cb(t),n=e.claims;return!!n&&typeof n=="object"&&n.hasOwnProperty("iat")},f5=function(t){const e=Cb(t).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dr(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Bi(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}function vu(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function xu(t,e,n){const r={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(r[s]=e.call(n,t[s],s,t));return r}function zi(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const i=t[s],o=e[s];if(xv(i)&&xv(o)){if(!zi(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function xv(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fa(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function sl(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function il(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h5{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,n){n||(n=0);const r=this.W_;if(typeof e=="string")for(let p=0;p<16;p++)r[p]=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),n+=4;else for(let p=0;p<16;p++)r[p]=e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3],n+=4;for(let p=16;p<80;p++){const f=r[p-3]^r[p-8]^r[p-14]^r[p-16];r[p]=(f<<1|f>>>31)&4294967295}let s=this.chain_[0],i=this.chain_[1],o=this.chain_[2],l=this.chain_[3],c=this.chain_[4],d,u;for(let p=0;p<80;p++){p<40?p<20?(d=l^i&(o^l),u=1518500249):(d=i^o^l,u=1859775393):p<60?(d=i&o|l&(i|o),u=2400959708):(d=i^o^l,u=3395469782);const f=(s<<5|s>>>27)+d+c+u+r[p]&4294967295;c=l,l=o,o=(i<<30|i>>>2)&4294967295,i=s,s=f}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+i&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,n){if(e==null)return;n===void 0&&(n=e.length);const r=n-this.blockSize;let s=0;const i=this.buf_;let o=this.inbuf_;for(;s<n;){if(o===0)for(;s<=r;)this.compress_(e,s),s+=this.blockSize;if(typeof e=="string"){for(;s<n;)if(i[o]=e.charCodeAt(s),++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}else for(;s<n;)if(i[o]=e[s],++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=n}digest(){const e=[];let n=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=n&255,n/=256;this.compress_(this.buf_);let r=0;for(let s=0;s<5;s++)for(let i=24;i>=0;i-=8)e[r]=this.chain_[s]>>i&255,++r;return e}}function p5(t,e){const n=new g5(t,e);return n.subscribe.bind(n)}class g5{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let s;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");m5(e,["next","error","complete"])?s=e:s={next:e,error:n,complete:r},s.next===void 0&&(s.next=Rh),s.error===void 0&&(s.error=Rh),s.complete===void 0&&(s.complete=Rh);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function m5(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function Rh(){}function Zo(t,e){return`${t} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y5=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);if(s>=55296&&s<=56319){const i=s-55296;r++,ge(r<t.length,"Surrogate pair missing trail surrogate.");const o=t.charCodeAt(r)-56320;s=65536+(i<<10)+o}s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):s<65536?(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},of=function(t){let e=0;for(let n=0;n<t.length;n++){const r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,n++):e+=3}return e};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tn(t){return t&&t._delegate?t._delegate:t}class Hi{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ci="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v5{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new Ir;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:n});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(_5(e))try{this.getOrInitializeService({instanceIdentifier:Ci})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(n);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Ci){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Ci){return this.instances.has(e)}getOptions(e=Ci){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[i,o]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);r===l&&o.resolve(s)}return s}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const s of r)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:x5(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Ci){return this.component?this.component.multipleInstances?e:Ci:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function x5(t){return t===Ci?void 0:t}function _5(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b5{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new v5(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var kt;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(kt||(kt={}));const E5={debug:kt.DEBUG,verbose:kt.VERBOSE,info:kt.INFO,warn:kt.WARN,error:kt.ERROR,silent:kt.SILENT},S5=kt.INFO,T5={[kt.DEBUG]:"log",[kt.VERBOSE]:"log",[kt.INFO]:"info",[kt.WARN]:"warn",[kt.ERROR]:"error"},I5=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),s=T5[e];if(s)console[s](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class E0{constructor(e){this.name=e,this._logLevel=S5,this._logHandler=I5,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in kt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?E5[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,kt.DEBUG,...e),this._logHandler(this,kt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,kt.VERBOSE,...e),this._logHandler(this,kt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,kt.INFO,...e),this._logHandler(this,kt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,kt.WARN,...e),this._logHandler(this,kt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,kt.ERROR,...e),this._logHandler(this,kt.ERROR,...e)}}const w5=(t,e)=>e.some(n=>t instanceof n);let _v,bv;function C5(){return _v||(_v=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function k5(){return bv||(bv=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const kb=new WeakMap,Up=new WeakMap,Rb=new WeakMap,Ah=new WeakMap,S0=new WeakMap;function R5(t){const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("success",i),t.removeEventListener("error",o)},i=()=>{n(Zs(t.result)),s()},o=()=>{r(t.error),s()};t.addEventListener("success",i),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&kb.set(n,t)}).catch(()=>{}),S0.set(e,t),e}function A5(t){if(Up.has(t))return;const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",o),t.removeEventListener("abort",o)},i=()=>{n(),s()},o=()=>{r(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",i),t.addEventListener("error",o),t.addEventListener("abort",o)});Up.set(t,e)}let Bp={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return Up.get(t);if(e==="objectStoreNames")return t.objectStoreNames||Rb.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Zs(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function P5(t){Bp=t(Bp)}function O5(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(Ph(this),e,...n);return Rb.set(r,e.sort?e.sort():[e]),Zs(r)}:k5().includes(t)?function(...e){return t.apply(Ph(this),e),Zs(kb.get(this))}:function(...e){return Zs(t.apply(Ph(this),e))}}function L5(t){return typeof t=="function"?O5(t):(t instanceof IDBTransaction&&A5(t),w5(t,C5())?new Proxy(t,Bp):t)}function Zs(t){if(t instanceof IDBRequest)return R5(t);if(Ah.has(t))return Ah.get(t);const e=L5(t);return e!==t&&(Ah.set(t,e),S0.set(e,t)),e}const Ph=t=>S0.get(t);function D5(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(t,e),l=Zs(o);return r&&o.addEventListener("upgradeneeded",c=>{r(Zs(o.result),c.oldVersion,c.newVersion,Zs(o.transaction),c)}),n&&o.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),l.then(c=>{i&&c.addEventListener("close",()=>i()),s&&c.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),l}const M5=["get","getKey","getAll","getAllKeys","count"],N5=["put","add","delete","clear"],Oh=new Map;function Ev(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Oh.get(e))return Oh.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=N5.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||M5.includes(n)))return;const i=async function(o,...l){const c=this.transaction(o,s?"readwrite":"readonly");let d=c.store;return r&&(d=d.index(l.shift())),(await Promise.all([d[n](...l),s&&c.done]))[0]};return Oh.set(e,i),i}P5(t=>({...t,get:(e,n,r)=>Ev(e,n)||t.get(e,n,r),has:(e,n)=>!!Ev(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j5{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if($5(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function $5(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const zp="@firebase/app",Sv="0.14.6";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ms=new E0("@firebase/app"),F5="@firebase/app-compat",U5="@firebase/analytics-compat",B5="@firebase/analytics",z5="@firebase/app-check-compat",H5="@firebase/app-check",W5="@firebase/auth",G5="@firebase/auth-compat",V5="@firebase/database",Y5="@firebase/data-connect",K5="@firebase/database-compat",X5="@firebase/functions",J5="@firebase/functions-compat",Q5="@firebase/installations",q5="@firebase/installations-compat",Z5="@firebase/messaging",eC="@firebase/messaging-compat",tC="@firebase/performance",nC="@firebase/performance-compat",rC="@firebase/remote-config",sC="@firebase/remote-config-compat",iC="@firebase/storage",oC="@firebase/storage-compat",aC="@firebase/firestore",lC="@firebase/ai",cC="@firebase/firestore-compat",dC="firebase",uC="12.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hp="[DEFAULT]",fC={[zp]:"fire-core",[F5]:"fire-core-compat",[B5]:"fire-analytics",[U5]:"fire-analytics-compat",[H5]:"fire-app-check",[z5]:"fire-app-check-compat",[W5]:"fire-auth",[G5]:"fire-auth-compat",[V5]:"fire-rtdb",[Y5]:"fire-data-connect",[K5]:"fire-rtdb-compat",[X5]:"fire-fn",[J5]:"fire-fn-compat",[Q5]:"fire-iid",[q5]:"fire-iid-compat",[Z5]:"fire-fcm",[eC]:"fire-fcm-compat",[tC]:"fire-perf",[nC]:"fire-perf-compat",[rC]:"fire-rc",[sC]:"fire-rc-compat",[iC]:"fire-gcs",[oC]:"fire-gcs-compat",[aC]:"fire-fst",[cC]:"fire-fst-compat",[lC]:"fire-vertex","fire-js":"fire-js",[dC]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _u=new Map,hC=new Map,Wp=new Map;function Tv(t,e){try{t.container.addComponent(e)}catch(n){ms.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function ea(t){const e=t.name;if(Wp.has(e))return ms.debug(`There were multiple attempts to register component ${e}.`),!1;Wp.set(e,t);for(const n of _u.values())Tv(n,t);for(const n of hC.values())Tv(n,t);return!0}function T0(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function ur(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pC={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ei=new cc("app","Firebase",pC);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gC{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Hi("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ei.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ha=uC;function Ab(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:Hp,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw ei.create("bad-app-name",{appName:String(s)});if(n||(n=Eb()),!n)throw ei.create("no-options");const i=_u.get(s);if(i){if(zi(n,i.options)&&zi(r,i.config))return i;throw ei.create("duplicate-app",{appName:s})}const o=new b5(s);for(const c of Wp.values())o.addComponent(c);const l=new gC(n,r,o);return _u.set(s,l),l}function Pb(t=Hp){const e=_u.get(t);if(!e&&t===Hp&&Eb())return Ab();if(!e)throw ei.create("no-app",{appName:t});return e}function ti(t,e,n){let r=fC[t]??t;n&&(r+=`-${n}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const o=[`Unable to register library "${r}" with version "${e}":`];s&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),ms.warn(o.join(" "));return}ea(new Hi(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mC="firebase-heartbeat-database",yC=1,Gl="firebase-heartbeat-store";let Lh=null;function Ob(){return Lh||(Lh=D5(mC,yC,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Gl)}catch(n){console.warn(n)}}}}).catch(t=>{throw ei.create("idb-open",{originalErrorMessage:t.message})})),Lh}async function vC(t){try{const n=(await Ob()).transaction(Gl),r=await n.objectStore(Gl).get(Lb(t));return await n.done,r}catch(e){if(e instanceof gi)ms.warn(e.message);else{const n=ei.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});ms.warn(n.message)}}}async function Iv(t,e){try{const r=(await Ob()).transaction(Gl,"readwrite");await r.objectStore(Gl).put(e,Lb(t)),await r.done}catch(n){if(n instanceof gi)ms.warn(n.message);else{const r=ei.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});ms.warn(r.message)}}}function Lb(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xC=1024,_C=30;class bC{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new SC(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=wv();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)==null?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats.length>_C){const o=TC(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){ms.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=wv(),{heartbeatsToSend:r,unsentEntries:s}=EC(this._heartbeatsCache.heartbeats),i=mu(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(n){return ms.warn(n),""}}}function wv(){return new Date().toISOString().substring(0,10)}function EC(t,e=xC){const n=[];let r=t.slice();for(const s of t){const i=n.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),Cv(n)>e){i.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),Cv(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class SC{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return o5()?a5().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await vC(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Iv(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Iv(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function Cv(t){return mu(JSON.stringify({version:2,heartbeats:t})).length}function TC(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IC(t){ea(new Hi("platform-logger",e=>new j5(e),"PRIVATE")),ea(new Hi("heartbeat",e=>new bC(e),"PRIVATE")),ti(zp,Sv,t),ti(zp,Sv,"esm2020"),ti("fire-js","")}IC("");var wC="firebase",CC="12.7.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ti(wC,CC,"app");var kv={};const Rv="@firebase/database",Av="1.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Db="";function kC(t){Db=t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RC{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,n){n==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Zt(n))}get(e){const n=this.domStorage_.getItem(this.prefixedName_(e));return n==null?null:Wl(n)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AC{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,n){n==null?delete this.cache_[e]:this.cache_[e]=n}get(e){return Dr(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mb=function(t){try{if(typeof window<"u"&&typeof window[t]<"u"){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new RC(e)}}catch{}return new AC},Li=Mb("localStorage"),PC=Mb("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fo=new E0("@firebase/database"),Nb=function(){let t=1;return function(){return t++}}(),jb=function(t){const e=y5(t),n=new h5;n.update(e);const r=n.digest();return x0.encodeByteArray(r)},dc=function(...t){let e="";for(let n=0;n<t.length;n++){const r=t[n];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=dc.apply(null,r):typeof r=="object"?e+=Zt(r):e+=r,e+=" "}return e};let yl=null,Pv=!0;const OC=function(t,e){ge(!0,"Can't turn on custom loggers persistently."),Fo.logLevel=kt.VERBOSE,yl=Fo.log.bind(Fo)},an=function(...t){if(Pv===!0&&(Pv=!1,yl===null&&PC.get("logging_enabled")===!0&&OC()),yl){const e=dc.apply(null,t);yl(e)}},uc=function(t){return function(...e){an(t,...e)}},Gp=function(...t){const e="FIREBASE INTERNAL ERROR: "+dc(...t);Fo.error(e)},ys=function(...t){const e=`FIREBASE FATAL ERROR: ${dc(...t)}`;throw Fo.error(e),new Error(e)},Pn=function(...t){const e="FIREBASE WARNING: "+dc(...t);Fo.warn(e)},LC=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Pn("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},af=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},DC=function(t){if(document.readyState==="complete")t();else{let e=!1;const n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&n()}),window.attachEvent("onload",n))}},ta="[MIN_NAME]",Wi="[MAX_NAME]",Ji=function(t,e){if(t===e)return 0;if(t===ta||e===Wi)return-1;if(e===ta||t===Wi)return 1;{const n=Ov(t),r=Ov(e);return n!==null?r!==null?n-r===0?t.length-e.length:n-r:-1:r!==null?1:t<e?-1:1}},MC=function(t,e){return t===e?0:t<e?-1:1},Ka=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+Zt(e))},I0=function(t){if(typeof t!="object"||t===null)return Zt(t);const e=[];for(const r in t)e.push(r);e.sort();let n="{";for(let r=0;r<e.length;r++)r!==0&&(n+=","),n+=Zt(e[r]),n+=":",n+=I0(t[e[r]]);return n+="}",n},$b=function(t,e){const n=t.length;if(n<=e)return[t];const r=[];for(let s=0;s<n;s+=e)s+e>n?r.push(t.substring(s,n)):r.push(t.substring(s,s+e));return r};function cn(t,e){for(const n in t)t.hasOwnProperty(n)&&e(n,t[n])}const Fb=function(t){ge(!af(t),"Invalid JSON number");const e=11,n=52,r=(1<<e-1)-1;let s,i,o,l,c;t===0?(i=0,o=0,s=1/t===-1/0?1:0):(s=t<0,t=Math.abs(t),t>=Math.pow(2,1-r)?(l=Math.min(Math.floor(Math.log(t)/Math.LN2),r),i=l+r,o=Math.round(t*Math.pow(2,n-l)-Math.pow(2,n))):(i=0,o=Math.round(t/Math.pow(2,1-r-n))));const d=[];for(c=n;c;c-=1)d.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)d.push(i%2?1:0),i=Math.floor(i/2);d.push(s?1:0),d.reverse();const u=d.join("");let p="";for(c=0;c<64;c+=8){let f=parseInt(u.substr(c,8),2).toString(16);f.length===1&&(f="0"+f),p=p+f}return p.toLowerCase()},NC=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},jC=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function $C(t,e){let n="Unknown Error";t==="too_big"?n="The data requested exceeds the maximum size that can be accessed with a single request.":t==="permission_denied"?n="Client doesn't have permission to access the desired data.":t==="unavailable"&&(n="The service is unavailable");const r=new Error(t+" at "+e._path.toString()+": "+n);return r.code=t.toUpperCase(),r}const FC=new RegExp("^-?(0*)\\d{1,10}$"),UC=-2147483648,BC=2147483647,Ov=function(t){if(FC.test(t)){const e=Number(t);if(e>=UC&&e<=BC)return e}return null},pa=function(t){try{t()}catch(e){setTimeout(()=>{const n=e.stack||"";throw Pn("Exception was thrown by user callback.",n),e},Math.floor(0))}},zC=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},vl=function(t,e){const n=setTimeout(t,e);return typeof n=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(n):typeof n=="object"&&n.unref&&n.unref(),n};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HC{constructor(e,n){this.appCheckProvider=n,this.appName=e.name,ur(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=n==null?void 0:n.getImmediate({optional:!0}),this.appCheck||n==null||n.get().then(r=>this.appCheck=r)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((n,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(n,r):n(null)},0)})}addTokenChangeListener(e){var n;(n=this.appCheckProvider)==null||n.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){Pn(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WC{constructor(e,n,r){this.appName_=e,this.firebaseOptions_=n,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(n=>n&&n.code==="auth/token-not-initialized"?(an("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(n)):new Promise((n,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(n,r):n(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(n=>n.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(n=>n.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Pn(e)}}class Dd{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Dd.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w0="5",Ub="v",Bb="s",zb="r",Hb="f",Wb=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Gb="ls",Vb="p",Vp="ac",Yb="websocket",Kb="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xb{constructor(e,n,r,s,i=!1,o="",l=!1,c=!1,d=null){this.secure=n,this.namespace=r,this.webSocketOnly=s,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=l,this.isUsingEmulator=c,this.emulatorOptions=d,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Li.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Li.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",n=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${n}`}}function GC(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function Jb(t,e,n){ge(typeof e=="string","typeof type must == string"),ge(typeof n=="object","typeof params must == object");let r;if(e===Yb)r=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===Kb)r=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);GC(t)&&(n.ns=t.namespace);const s=[];return cn(n,(i,o)=>{s.push(i+"="+o)}),r+s.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VC{constructor(){this.counters_={}}incrementCounter(e,n=1){Dr(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=n}get(){return Vw(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dh={},Mh={};function C0(t){const e=t.toString();return Dh[e]||(Dh[e]=new VC),Dh[e]}function YC(t,e){const n=t.toString();return Mh[n]||(Mh[n]=e()),Mh[n]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KC{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,n){this.closeAfterResponse=e,this.onClose=n,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,n){for(this.pendingResponses[e]=n;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<r.length;++s)r[s]&&pa(()=>{this.onMessage_(r[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lv="start",XC="close",JC="pLPCommand",QC="pRTLPCB",Qb="id",qb="pw",Zb="ser",qC="cb",ZC="seg",ek="ts",tk="d",nk="dframe",eE=1870,tE=30,rk=eE-tE,sk=25e3,ik=3e4;class Po{constructor(e,n,r,s,i,o,l){this.connId=e,this.repoInfo=n,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.transportSessionId=o,this.lastSessionId=l,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=uc(e),this.stats_=C0(n),this.urlFn=c=>(this.appCheckToken&&(c[Vp]=this.appCheckToken),Jb(n,Kb,c))}open(e,n){this.curSegmentNum=0,this.onDisconnect_=n,this.myPacketOrderer=new KC(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(ik)),DC(()=>{if(this.isClosed_)return;this.scriptTagHolder=new k0((...i)=>{const[o,l,c,d,u]=i;if(this.incrementIncomingBytes_(i),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===Lv)this.id=l,this.password=c;else if(o===XC)l?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(l,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...i)=>{const[o,l]=i;this.incrementIncomingBytes_(i),this.myPacketOrderer.handleResponse(o,l)},()=>{this.onClosed_()},this.urlFn);const r={};r[Lv]="t",r[Zb]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[qC]=this.scriptTagHolder.uniqueCallbackIdentifier),r[Ub]=w0,this.transportSessionId&&(r[Bb]=this.transportSessionId),this.lastSessionId&&(r[Gb]=this.lastSessionId),this.applicationId&&(r[Vb]=this.applicationId),this.appCheckToken&&(r[Vp]=this.appCheckToken),typeof location<"u"&&location.hostname&&Wb.test(location.hostname)&&(r[zb]=Hb);const s=this.urlFn(r);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Po.forceAllow_=!0}static forceDisallow(){Po.forceDisallow_=!0}static isAvailable(){return Po.forceAllow_?!0:!Po.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!NC()&&!jC()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const n=Zt(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const r=xb(n),s=$b(r,rk);for(let i=0;i<s.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[i]),this.curSegmentNum++}addDisconnectPingFrame(e,n){this.myDisconnFrame=document.createElement("iframe");const r={};r[nk]="t",r[Qb]=e,r[qb]=n,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const n=Zt(e).length;this.bytesReceived+=n,this.stats_.incrementCounter("bytes_received",n)}}class k0{constructor(e,n,r,s){this.onDisconnect=r,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=Nb(),window[JC+this.uniqueCallbackIdentifier]=e,window[QC+this.uniqueCallbackIdentifier]=n,this.myIFrame=k0.createIFrame_();let i="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(i='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(l){an("frame writing exception"),l.stack&&an(l.stack),an(l)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||an("No IE domain setting required")}catch{const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,n){for(this.myID=e,this.myPW=n,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[Qb]=this.myID,e[qb]=this.myPW,e[Zb]=this.currentSerial;let n=this.urlFn(e),r="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+tE+r.length<=eE;){const o=this.pendingSegs.shift();r=r+"&"+ZC+s+"="+o.seg+"&"+ek+s+"="+o.ts+"&"+tk+s+"="+o.d,s++}return n=n+r,this.addLongPollTag_(n,this.currentSerial),!0}else return!1}enqueueSegment(e,n,r){this.pendingSegs.push({seg:e,ts:n,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,n){this.outstandingRequests.add(n);const r=()=>{this.outstandingRequests.delete(n),this.newRequest_()},s=setTimeout(r,Math.floor(sk)),i=()=>{clearTimeout(s),r()};this.addTag(e,i)}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const s=r.readyState;(!s||s==="loaded"||s==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),n())},r.onerror=()=>{an("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ok=16384,ak=45e3;let bu=null;typeof MozWebSocket<"u"?bu=MozWebSocket:typeof WebSocket<"u"&&(bu=WebSocket);class wr{constructor(e,n,r,s,i,o,l){this.connId=e,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=uc(this.connId),this.stats_=C0(n),this.connURL=wr.connectionURL_(n,o,l,s,r),this.nodeAdmin=n.nodeAdmin}static connectionURL_(e,n,r,s,i){const o={};return o[Ub]=w0,typeof location<"u"&&location.hostname&&Wb.test(location.hostname)&&(o[zb]=Hb),n&&(o[Bb]=n),r&&(o[Gb]=r),s&&(o[Vp]=s),i&&(o[Vb]=i),Jb(e,Yb,o)}open(e,n){this.onDisconnect=n,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Li.set("previous_websocket_failure",!0);try{let r;i5(),this.mySock=new bu(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){wr.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const n=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(n);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&bu!==null&&!wr.forceDisallow_}static previouslyFailed(){return Li.isInMemoryStorage||Li.get("previous_websocket_failure")===!0}markConnectionHealthy(){Li.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const n=this.frames.join("");this.frames=null;const r=Wl(n);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(ge(this.frames===null,"We already have a frame buffer"),e.length<=6){const n=Number(e);if(!isNaN(n))return this.handleNewFrameCount_(n),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const n=e.data;if(this.bytesReceived+=n.length,this.stats_.incrementCounter("bytes_received",n.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(n);else{const r=this.extractFrameCount_(n);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();const n=Zt(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const r=$b(n,ok);r.length>1&&this.sendString_(String(r.length));for(let s=0;s<r.length;s++)this.sendString_(r[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(ak))}sendString_(e){try{this.mySock.send(e)}catch(n){this.log_("Exception thrown from WebSocket.send():",n.message||n.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}wr.responsesRequiredToBeHealthy=2;wr.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vl{static get ALL_TRANSPORTS(){return[Po,wr]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const n=wr&&wr.isAvailable();let r=n&&!wr.previouslyFailed();if(e.webSocketOnly&&(n||Pn("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[wr];else{const s=this.transports_=[];for(const i of Vl.ALL_TRANSPORTS)i&&i.isAvailable()&&s.push(i);Vl.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Vl.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lk=6e4,ck=5e3,dk=10*1024,uk=100*1024,Nh="t",Dv="d",fk="s",Mv="r",hk="e",Nv="o",jv="a",$v="n",Fv="p",pk="h";class gk{constructor(e,n,r,s,i,o,l,c,d,u){this.id=e,this.repoInfo_=n,this.applicationId_=r,this.appCheckToken_=s,this.authToken_=i,this.onMessage_=o,this.onReady_=l,this.onDisconnect_=c,this.onKill_=d,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=uc("c:"+this.id+":"),this.transportManager_=new Vl(n),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(n,r)},Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=vl(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>uk?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>dk?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return n=>{e===this.conn_?this.onConnectionLost_(n):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return n=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(n):e===this.secondaryConn_?this.onSecondaryMessageReceived_(n):this.log_("message on old connection"))}}sendRequest(e){const n={t:"d",d:e};this.sendData_(n)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Nh in e){const n=e[Nh];n===jv?this.upgradeIfSecondaryHealthy_():n===Mv?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):n===Nv&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const n=Ka("t",e),r=Ka("d",e);if(n==="c")this.onSecondaryControl_(r);else if(n==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+n)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:Fv,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:jv,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:$v,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const n=Ka("t",e),r=Ka("d",e);n==="c"?this.onControl_(r):n==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const n=Ka(Nh,e);if(Dv in e){const r=e[Dv];if(n===pk){const s={...r};this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(n===$v){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else n===fk?this.onConnectionShutdown_(r):n===Mv?this.onReset_(r):n===hk?Gp("Server Error: "+r):n===Nv?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Gp("Unknown control packet command: "+n)}}onHandshake_(e){const n=e.ts,r=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,n),w0!==r&&Pn("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),vl(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(lk))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,n){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(n,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):vl(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(ck))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:Fv,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Li.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nE{put(e,n,r,s){}merge(e,n,r,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,n,r){}onDisconnectMerge(e,n,r){}onDisconnectCancel(e,n){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rE{constructor(e){this.allowedEvents_=e,this.listeners_={},ge(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...n){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let s=0;s<r.length;s++)r[s].callback.apply(r[s].context,n)}}on(e,n,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:n,context:r});const s=this.getInitialEvent(e);s&&n.apply(r,s)}off(e,n,r){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let i=0;i<s.length;i++)if(s[i].callback===n&&(!r||r===s[i].context)){s.splice(i,1);return}}validateEventType_(e){ge(this.allowedEvents_.find(n=>n===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eu extends rE{static getInstance(){return new Eu}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!b0()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return ge(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uv=32,Bv=768;class wt{constructor(e,n){if(n===void 0){this.pieces_=e.split("/");let r=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[r]=this.pieces_[s],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=n}toString(){let e="";for(let n=this.pieceNum_;n<this.pieces_.length;n++)this.pieces_[n]!==""&&(e+="/"+this.pieces_[n]);return e||"/"}}function _t(){return new wt("")}function ut(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function ai(t){return t.pieces_.length-t.pieceNum_}function At(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new wt(t.pieces_,e)}function R0(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function mk(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)t.pieces_[n]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}function Yl(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function sE(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new wt(e,0)}function Ht(t,e){const n=[];for(let r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);if(e instanceof wt)for(let r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);else{const r=e.split("/");for(let s=0;s<r.length;s++)r[s].length>0&&n.push(r[s])}return new wt(n,0)}function ht(t){return t.pieceNum_>=t.pieces_.length}function Rn(t,e){const n=ut(t),r=ut(e);if(n===null)return e;if(n===r)return Rn(At(t),At(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function yk(t,e){const n=Yl(t,0),r=Yl(e,0);for(let s=0;s<n.length&&s<r.length;s++){const i=Ji(n[s],r[s]);if(i!==0)return i}return n.length===r.length?0:n.length<r.length?-1:1}function A0(t,e){if(ai(t)!==ai(e))return!1;for(let n=t.pieceNum_,r=e.pieceNum_;n<=t.pieces_.length;n++,r++)if(t.pieces_[n]!==e.pieces_[r])return!1;return!0}function hr(t,e){let n=t.pieceNum_,r=e.pieceNum_;if(ai(t)>ai(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[r])return!1;++n,++r}return!0}class vk{constructor(e,n){this.errorPrefix_=n,this.parts_=Yl(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=of(this.parts_[r]);iE(this)}}function xk(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=of(e),iE(t)}function _k(t){const e=t.parts_.pop();t.byteLength_-=of(e),t.parts_.length>0&&(t.byteLength_-=1)}function iE(t){if(t.byteLength_>Bv)throw new Error(t.errorPrefix_+"has a key path longer than "+Bv+" bytes ("+t.byteLength_+").");if(t.parts_.length>Uv)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Uv+") or object contains a cycle "+ki(t))}function ki(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P0 extends rE{static getInstance(){return new P0}constructor(){super(["visible"]);let e,n;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(n="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(n="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(n="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(n="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,n&&document.addEventListener(n,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}getInitialEvent(e){return ge(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xa=1e3,bk=60*5*1e3,zv=30*1e3,Ek=1.3,Sk=3e4,Tk="server_kill",Hv=3;class ds extends nE{constructor(e,n,r,s,i,o,l,c){if(super(),this.repoInfo_=e,this.applicationId_=n,this.onDataUpdate_=r,this.onConnectStatus_=s,this.onServerInfoUpdate_=i,this.authTokenProvider_=o,this.appCheckTokenProvider_=l,this.authOverride_=c,this.id=ds.nextPersistentConnectionId_++,this.log_=uc("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Xa,this.maxReconnectDelay_=bk,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");P0.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&Eu.getInstance().on("online",this.onOnline_,this)}sendRequest(e,n,r){const s=++this.requestNumber_,i={r:s,a:e,b:n};this.log_(Zt(i)),ge(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),r&&(this.requestCBHash_[s]=r)}get(e){this.initConnection_();const n=new Ir,s={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const l=o.d;o.s==="ok"?n.resolve(l):n.reject(l)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),n.promise}listen(e,n,r,s){this.initConnection_();const i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),ge(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),ge(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");const l={onComplete:s,hashFn:n,query:e,tag:r};this.listens.get(o).set(i,l),this.connected_&&this.sendListen_(l)}sendGet_(e){const n=this.outstandingGets_[e];this.sendRequest("g",n.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(r)})}sendListen_(e){const n=e.query,r=n._path.toString(),s=n._queryIdentifier;this.log_("Listen on "+r+" for "+s);const i={p:r},o="q";e.tag&&(i.q=n._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest(o,i,l=>{const c=l.d,d=l.s;ds.warnOnListenWarnings_(c,n),(this.listens.get(r)&&this.listens.get(r).get(s))===e&&(this.log_("listen response",l),d!=="ok"&&this.removeListen_(r,s),e.onComplete&&e.onComplete(d,c))})}static warnOnListenWarnings_(e,n){if(e&&typeof e=="object"&&Dr(e,"w")){const r=Bi(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const s='".indexOn": "'+n._queryParams.getIndex().toString()+'"',i=n._path.toString();Pn(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${i} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||f5(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=zv)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,n=u5(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(n,r,s=>{const i=s.s,o=s.d||"error";this.authToken_===e&&(i==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(i,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const n=e.s,r=e.d||"error";n==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(n,r)})}unlisten(e,n){const r=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+s),ge(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,s)&&this.connected_&&this.sendUnlisten_(r,s,e._queryObject,n)}sendUnlisten_(e,n,r,s){this.log_("Unlisten on "+e+" for "+n);const i={p:e},o="n";s&&(i.q=r,i.t=s),this.sendRequest(o,i)}onDisconnectPut(e,n,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,n,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:n,onComplete:r})}onDisconnectMerge(e,n,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,n,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:n,onComplete:r})}onDisconnectCancel(e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:n})}sendOnDisconnect_(e,n,r,s){const i={p:n,d:r};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,o=>{s&&setTimeout(()=>{s(o.s,o.d)},Math.floor(0))})}put(e,n,r,s){this.putInternal("p",e,n,r,s)}merge(e,n,r,s){this.putInternal("m",e,n,r,s)}putInternal(e,n,r,s,i){this.initConnection_();const o={p:n,d:r};i!==void 0&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:s}),this.outstandingPutCount_++;const l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+n)}sendPut_(e){const n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,s=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,i=>{this.log_(n+" response",i),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(i.s,i.d)})}reportStats(e){if(this.connected_){const n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,r=>{if(r.s!=="ok"){const i=r.d;this.log_("reportStats","Error sending stats: "+i)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Zt(e));const n=e.r,r=this.requestCBHash_[n];r&&(delete this.requestCBHash_[n],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,n){this.log_("handleServerMessage",e,n),e==="d"?this.onDataUpdate_(n.p,n.d,!1,n.t):e==="m"?this.onDataUpdate_(n.p,n.d,!0,n.t):e==="c"?this.onListenRevoked_(n.p,n.q):e==="ac"?this.onAuthRevoked_(n.s,n.d):e==="apc"?this.onAppCheckRevoked_(n.s,n.d):e==="sd"?this.onSecurityDebugPacket_(n):Gp("Unrecognized action received from server: "+Zt(e)+`
Are you using the latest client?`)}onReady_(e,n){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=n,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){ge(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Xa,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Xa,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>Sk&&(this.reconnectDelay_=Xa),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let n=Math.max(0,this.reconnectDelay_-e);n=Math.random()*n,this.log_("Trying to reconnect in "+n+"ms"),this.scheduleConnect_(n),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Ek)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+ds.nextConnectionId_++,i=this.lastSessionId;let o=!1,l=null;const c=function(){l?l.close():(o=!0,r())},d=function(p){ge(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(p)};this.realtime_={close:c,sendRequest:d};const u=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[p,f]=await Promise.all([this.authTokenProvider_.getToken(u),this.appCheckTokenProvider_.getToken(u)]);o?an("getToken() completed but was canceled"):(an("getToken() completed. Creating connection."),this.authToken_=p&&p.accessToken,this.appCheckToken_=f&&f.token,l=new gk(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,r,b=>{Pn(b+" ("+this.repoInfo_.toString()+")"),this.interrupt(Tk)},i))}catch(p){this.log_("Failed to get token: "+p),o||(this.repoInfo_.nodeAdmin&&Pn(p),c())}}}interrupt(e){an("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){an("Resuming connection for reason: "+e),delete this.interruptReasons_[e],vu(this.interruptReasons_)&&(this.reconnectDelay_=Xa,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const n=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:n})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const n=this.outstandingPuts_[e];n&&"h"in n.request&&n.queued&&(n.onComplete&&n.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,n){let r;n?r=n.map(i=>I0(i)).join("$"):r="default";const s=this.removeListen_(e,r);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(e,n){const r=new wt(e).toString();let s;if(this.listens.has(r)){const i=this.listens.get(r);s=i.get(n),i.delete(n),i.size===0&&this.listens.delete(r)}else s=void 0;return s}onAuthRevoked_(e,n){an("Auth token revoked: "+e+"/"+n),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Hv&&(this.reconnectDelay_=zv,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,n){an("App check token revoked: "+e+"/"+n),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Hv&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const n of e.values())this.sendListen_(n);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let n="js";e["sdk."+n+"."+Db.replace(/\./g,"-")]=1,b0()?e["framework.cordova"]=1:wb()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Eu.getInstance().currentlyOnline();return vu(this.interruptReasons_)&&e}}ds.nextPersistentConnectionId_=0;ds.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pt{constructor(e,n){this.name=e,this.node=n}static Wrap(e,n){return new pt(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lf{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,n){const r=new pt(ta,e),s=new pt(ta,n);return this.compare(r,s)!==0}minPost(){return pt.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ud;class oE extends lf{static get __EMPTY_NODE(){return ud}static set __EMPTY_NODE(e){ud=e}compare(e,n){return Ji(e.name,n.name)}isDefinedOn(e){throw da("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,n){return!1}minPost(){return pt.MIN}maxPost(){return new pt(Wi,ud)}makePost(e,n){return ge(typeof e=="string","KeyIndex indexValue must always be a string."),new pt(e,ud)}toString(){return".key"}}const Uo=new oE;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fd{constructor(e,n,r,s,i=null){this.isReverse_=s,this.resultGenerator_=i,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=n?r(e.key,n):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),n;if(this.resultGenerator_?n=this.resultGenerator_(e.key,e.value):n={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return n}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class on{constructor(e,n,r,s,i){this.key=e,this.value=n,this.color=r??on.RED,this.left=s??Wn.EMPTY_NODE,this.right=i??Wn.EMPTY_NODE}copy(e,n,r,s,i){return new on(e??this.key,n??this.value,r??this.color,s??this.left,i??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let s=this;const i=r(e,s.key);return i<0?s=s.copy(null,null,null,s.left.insert(e,n,r),null):i===0?s=s.copy(null,n,null,null,null):s=s.copy(null,null,null,null,s.right.insert(e,n,r)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return Wn.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,n){let r,s;if(r=this,n(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,n),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),n(e,r.key)===0){if(r.right.isEmpty())return Wn.EMPTY_NODE;s=r.right.min_(),r=r.copy(s.key,s.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,n))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,on.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,on.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}on.RED=!0;on.BLACK=!1;class Ik{copy(e,n,r,s,i){return this}insert(e,n,r){return new on(e,n,null)}remove(e,n){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class Wn{constructor(e,n=Wn.EMPTY_NODE){this.comparator_=e,this.root_=n}insert(e,n){return new Wn(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,on.BLACK,null,null))}remove(e){return new Wn(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,on.BLACK,null,null))}get(e){let n,r=this.root_;for(;!r.isEmpty();){if(n=this.comparator_(e,r.key),n===0)return r.value;n<0?r=r.left:n>0&&(r=r.right)}return null}getPredecessorKey(e){let n,r=this.root_,s=null;for(;!r.isEmpty();)if(n=this.comparator_(e,r.key),n===0){if(r.left.isEmpty())return s?s.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else n<0?r=r.left:n>0&&(s=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new fd(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,n){return new fd(this.root_,e,this.comparator_,!1,n)}getReverseIteratorFrom(e,n){return new fd(this.root_,e,this.comparator_,!0,n)}getReverseIterator(e){return new fd(this.root_,null,this.comparator_,!0,e)}}Wn.EMPTY_NODE=new Ik;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wk(t,e){return Ji(t.name,e.name)}function O0(t,e){return Ji(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Yp;function Ck(t){Yp=t}const aE=function(t){return typeof t=="number"?"number:"+Fb(t):"string:"+t},lE=function(t){if(t.isLeafNode()){const e=t.val();ge(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Dr(e,".sv"),"Priority must be a string or number.")}else ge(t===Yp||t.isEmpty(),"priority of unexpected type.");ge(t===Yp||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Wv;class rn{static set __childrenNodeConstructor(e){Wv=e}static get __childrenNodeConstructor(){return Wv}constructor(e,n=rn.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=n,this.lazyHash_=null,ge(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),lE(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new rn(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:rn.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return ht(e)?this:ut(e)===".priority"?this.priorityNode_:rn.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,n){return null}updateImmediateChild(e,n){return e===".priority"?this.updatePriority(n):n.isEmpty()&&e!==".priority"?this:rn.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)}updateChild(e,n){const r=ut(e);return r===null?n:n.isEmpty()&&r!==".priority"?this:(ge(r!==".priority"||ai(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,rn.__childrenNodeConstructor.EMPTY_NODE.updateChild(At(e),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,n){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+aE(this.priorityNode_.val())+":");const n=typeof this.value_;e+=n+":",n==="number"?e+=Fb(this.value_):e+=this.value_,this.lazyHash_=jb(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===rn.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof rn.__childrenNodeConstructor?-1:(ge(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const n=typeof e.value_,r=typeof this.value_,s=rn.VALUE_TYPE_ORDER.indexOf(n),i=rn.VALUE_TYPE_ORDER.indexOf(r);return ge(s>=0,"Unknown leaf type: "+n),ge(i>=0,"Unknown leaf type: "+r),s===i?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const n=e;return this.value_===n.value_&&this.priorityNode_.equals(n.priorityNode_)}else return!1}}rn.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let cE,dE;function kk(t){cE=t}function Rk(t){dE=t}class Ak extends lf{compare(e,n){const r=e.node.getPriority(),s=n.node.getPriority(),i=r.compareTo(s);return i===0?Ji(e.name,n.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,n){return!e.getPriority().equals(n.getPriority())}minPost(){return pt.MIN}maxPost(){return new pt(Wi,new rn("[PRIORITY-POST]",dE))}makePost(e,n){const r=cE(e);return new pt(n,new rn("[PRIORITY-POST]",r))}toString(){return".priority"}}const Ut=new Ak;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pk=Math.log(2);class Ok{constructor(e){const n=i=>parseInt(Math.log(i)/Pk,10),r=i=>parseInt(Array(i+1).join("1"),2);this.count=n(e+1),this.current_=this.count-1;const s=r(this.count);this.bits_=e+1&s}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Su=function(t,e,n,r){t.sort(e);const s=function(c,d){const u=d-c;let p,f;if(u===0)return null;if(u===1)return p=t[c],f=n?n(p):p,new on(f,p.node,on.BLACK,null,null);{const b=parseInt(u/2,10)+c,I=s(c,b),k=s(b+1,d);return p=t[b],f=n?n(p):p,new on(f,p.node,on.BLACK,I,k)}},i=function(c){let d=null,u=null,p=t.length;const f=function(I,k){const F=p-I,x=p;p-=I;const v=s(F+1,x),T=t[F],h=n?n(T):T;b(new on(h,T.node,k,null,v))},b=function(I){d?(d.left=I,d=I):(u=I,d=I)};for(let I=0;I<c.count;++I){const k=c.nextBitIsOne(),F=Math.pow(2,c.count-(I+1));k?f(F,on.BLACK):(f(F,on.BLACK),f(F,on.RED))}return u},o=new Ok(t.length),l=i(o);return new Wn(r||e,l)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let jh;const mo={};class os{static get Default(){return ge(mo&&Ut,"ChildrenNode.ts has not been loaded"),jh=jh||new os({".priority":mo},{".priority":Ut}),jh}constructor(e,n){this.indexes_=e,this.indexSet_=n}get(e){const n=Bi(this.indexes_,e);if(!n)throw new Error("No index defined for "+e);return n instanceof Wn?n:null}hasIndex(e){return Dr(this.indexSet_,e.toString())}addIndex(e,n){ge(e!==Uo,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let s=!1;const i=n.getIterator(pt.Wrap);let o=i.getNext();for(;o;)s=s||e.isDefinedOn(o.node),r.push(o),o=i.getNext();let l;s?l=Su(r,e.getCompare()):l=mo;const c=e.toString(),d={...this.indexSet_};d[c]=e;const u={...this.indexes_};return u[c]=l,new os(u,d)}addToIndexes(e,n){const r=xu(this.indexes_,(s,i)=>{const o=Bi(this.indexSet_,i);if(ge(o,"Missing index implementation for "+i),s===mo)if(o.isDefinedOn(e.node)){const l=[],c=n.getIterator(pt.Wrap);let d=c.getNext();for(;d;)d.name!==e.name&&l.push(d),d=c.getNext();return l.push(e),Su(l,o.getCompare())}else return mo;else{const l=n.get(e.name);let c=s;return l&&(c=c.remove(new pt(e.name,l))),c.insert(e,e.node)}});return new os(r,this.indexSet_)}removeFromIndexes(e,n){const r=xu(this.indexes_,s=>{if(s===mo)return s;{const i=n.get(e.name);return i?s.remove(new pt(e.name,i)):s}});return new os(r,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ja;class Xe{static get EMPTY_NODE(){return Ja||(Ja=new Xe(new Wn(O0),null,os.Default))}constructor(e,n,r){this.children_=e,this.priorityNode_=n,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&lE(this.priorityNode_),this.children_.isEmpty()&&ge(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Ja}updatePriority(e){return this.children_.isEmpty()?this:new Xe(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const n=this.children_.get(e);return n===null?Ja:n}}getChild(e){const n=ut(e);return n===null?this:this.getImmediateChild(n).getChild(At(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,n){if(ge(n,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(n);{const r=new pt(e,n);let s,i;n.isEmpty()?(s=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(r,this.children_)):(s=this.children_.insert(e,n),i=this.indexMap_.addToIndexes(r,this.children_));const o=s.isEmpty()?Ja:this.priorityNode_;return new Xe(s,o,i)}}updateChild(e,n){const r=ut(e);if(r===null)return n;{ge(ut(e)!==".priority"||ai(e)===1,".priority must be the last token in a path");const s=this.getImmediateChild(r).updateChild(At(e),n);return this.updateImmediateChild(r,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const n={};let r=0,s=0,i=!0;if(this.forEachChild(Ut,(o,l)=>{n[o]=l.val(e),r++,i&&Xe.INTEGER_REGEXP_.test(o)?s=Math.max(s,Number(o)):i=!1}),!e&&i&&s<2*r){const o=[];for(const l in n)o[l]=n[l];return o}else return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+aE(this.getPriority().val())+":"),this.forEachChild(Ut,(n,r)=>{const s=r.hash();s!==""&&(e+=":"+n+":"+s)}),this.lazyHash_=e===""?"":jb(e)}return this.lazyHash_}getPredecessorChildName(e,n,r){const s=this.resolveIndex_(r);if(s){const i=s.getPredecessorKey(new pt(e,n));return i?i.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const n=this.resolveIndex_(e);if(n){const r=n.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){const n=this.getFirstChildName(e);return n?new pt(n,this.children_.get(n)):null}getLastChildName(e){const n=this.resolveIndex_(e);if(n){const r=n.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){const n=this.getLastChildName(e);return n?new pt(n,this.children_.get(n)):null}forEachChild(e,n){const r=this.resolveIndex_(e);return r?r.inorderTraversal(s=>n(s.name,s.node)):this.children_.inorderTraversal(n)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,n){const r=this.resolveIndex_(n);if(r)return r.getIteratorFrom(e,s=>s);{const s=this.children_.getIteratorFrom(e.name,pt.Wrap);let i=s.peek();for(;i!=null&&n.compare(i,e)<0;)s.getNext(),i=s.peek();return s}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,n){const r=this.resolveIndex_(n);if(r)return r.getReverseIteratorFrom(e,s=>s);{const s=this.children_.getReverseIteratorFrom(e.name,pt.Wrap);let i=s.peek();for(;i!=null&&n.compare(i,e)>0;)s.getNext(),i=s.peek();return s}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===fc?-1:0}withIndex(e){if(e===Uo||this.indexMap_.hasIndex(e))return this;{const n=this.indexMap_.addIndex(e,this.children_);return new Xe(this.children_,this.priorityNode_,n)}}isIndexed(e){return e===Uo||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority()))if(this.children_.count()===n.children_.count()){const r=this.getIterator(Ut),s=n.getIterator(Ut);let i=r.getNext(),o=s.getNext();for(;i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=r.getNext(),o=s.getNext()}return i===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===Uo?null:this.indexMap_.get(e.toString())}}Xe.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class Lk extends Xe{constructor(){super(new Wn(O0),Xe.EMPTY_NODE,os.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Xe.EMPTY_NODE}isEmpty(){return!1}}const fc=new Lk;Object.defineProperties(pt,{MIN:{value:new pt(ta,Xe.EMPTY_NODE)},MAX:{value:new pt(Wi,fc)}});oE.__EMPTY_NODE=Xe.EMPTY_NODE;rn.__childrenNodeConstructor=Xe;Ck(fc);Rk(fc);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dk=!0;function zt(t,e=null){if(t===null)return Xe.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),ge(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){const n=t;return new rn(n,zt(e))}if(!(t instanceof Array)&&Dk){const n=[];let r=!1;if(cn(t,(o,l)=>{if(o.substring(0,1)!=="."){const c=zt(l);c.isEmpty()||(r=r||!c.getPriority().isEmpty(),n.push(new pt(o,c)))}}),n.length===0)return Xe.EMPTY_NODE;const i=Su(n,wk,o=>o.name,O0);if(r){const o=Su(n,Ut.getCompare());return new Xe(i,zt(e),new os({".priority":o},{".priority":Ut}))}else return new Xe(i,zt(e),os.Default)}else{let n=Xe.EMPTY_NODE;return cn(t,(r,s)=>{if(Dr(t,r)&&r.substring(0,1)!=="."){const i=zt(s);(i.isLeafNode()||!i.isEmpty())&&(n=n.updateImmediateChild(r,i))}}),n.updatePriority(zt(e))}}kk(zt);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mk extends lf{constructor(e){super(),this.indexPath_=e,ge(!ht(e)&&ut(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,n){const r=this.extractChild(e.node),s=this.extractChild(n.node),i=r.compareTo(s);return i===0?Ji(e.name,n.name):i}makePost(e,n){const r=zt(e),s=Xe.EMPTY_NODE.updateChild(this.indexPath_,r);return new pt(n,s)}maxPost(){const e=Xe.EMPTY_NODE.updateChild(this.indexPath_,fc);return new pt(Wi,e)}toString(){return Yl(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nk extends lf{compare(e,n){const r=e.node.compareTo(n.node);return r===0?Ji(e.name,n.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,n){return!e.equals(n)}minPost(){return pt.MIN}maxPost(){return pt.MAX}makePost(e,n){const r=zt(e);return new pt(n,r)}toString(){return".value"}}const jk=new Nk;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uE(t){return{type:"value",snapshotNode:t}}function na(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function Kl(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function Xl(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}function $k(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L0{constructor(e){this.index_=e}updateChild(e,n,r,s,i,o){ge(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const l=e.getImmediateChild(n);return l.getChild(s).equals(r.getChild(s))&&l.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(n)?o.trackChildChange(Kl(n,l)):ge(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):l.isEmpty()?o.trackChildChange(na(n,r)):o.trackChildChange(Xl(n,r,l))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(n,r).withIndex(this.index_)}updateFullNode(e,n,r){return r!=null&&(e.isLeafNode()||e.forEachChild(Ut,(s,i)=>{n.hasChild(s)||r.trackChildChange(Kl(s,i))}),n.isLeafNode()||n.forEachChild(Ut,(s,i)=>{if(e.hasChild(s)){const o=e.getImmediateChild(s);o.equals(i)||r.trackChildChange(Xl(s,i,o))}else r.trackChildChange(na(s,i))})),n.withIndex(this.index_)}updatePriority(e,n){return e.isEmpty()?Xe.EMPTY_NODE:e.updatePriority(n)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jl{constructor(e){this.indexedFilter_=new L0(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Jl.getStartPost_(e),this.endPost_=Jl.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const n=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return n&&r}updateChild(e,n,r,s,i,o){return this.matches(new pt(n,r))||(r=Xe.EMPTY_NODE),this.indexedFilter_.updateChild(e,n,r,s,i,o)}updateFullNode(e,n,r){n.isLeafNode()&&(n=Xe.EMPTY_NODE);let s=n.withIndex(this.index_);s=s.updatePriority(Xe.EMPTY_NODE);const i=this;return n.forEachChild(Ut,(o,l)=>{i.matches(new pt(o,l))||(s=s.updateImmediateChild(o,Xe.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,r)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const n=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),n)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const n=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),n)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fk{constructor(e){this.withinDirectionalStart=n=>this.reverse_?this.withinEndPost(n):this.withinStartPost(n),this.withinDirectionalEnd=n=>this.reverse_?this.withinStartPost(n):this.withinEndPost(n),this.withinStartPost=n=>{const r=this.index_.compare(this.rangedFilter_.getStartPost(),n);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=n=>{const r=this.index_.compare(n,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new Jl(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,n,r,s,i,o){return this.rangedFilter_.matches(new pt(n,r))||(r=Xe.EMPTY_NODE),e.getImmediateChild(n).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,n,r,s,i,o):this.fullLimitUpdateChild_(e,n,r,i,o)}updateFullNode(e,n,r){let s;if(n.isLeafNode()||n.isEmpty())s=Xe.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<n.numChildren()&&n.isIndexed(this.index_)){s=Xe.EMPTY_NODE.withIndex(this.index_);let i;this.reverse_?i=n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):i=n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;i.hasNext()&&o<this.limit_;){const l=i.getNext();if(this.withinDirectionalStart(l))if(this.withinDirectionalEnd(l))s=s.updateImmediateChild(l.name,l.node),o++;else break;else continue}}else{s=n.withIndex(this.index_),s=s.updatePriority(Xe.EMPTY_NODE);let i;this.reverse_?i=s.getReverseIterator(this.index_):i=s.getIterator(this.index_);let o=0;for(;i.hasNext();){const l=i.getNext();o<this.limit_&&this.withinDirectionalStart(l)&&this.withinDirectionalEnd(l)?o++:s=s.updateImmediateChild(l.name,Xe.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,r)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,n,r,s,i){let o;if(this.reverse_){const p=this.index_.getCompare();o=(f,b)=>p(b,f)}else o=this.index_.getCompare();const l=e;ge(l.numChildren()===this.limit_,"");const c=new pt(n,r),d=this.reverse_?l.getFirstChild(this.index_):l.getLastChild(this.index_),u=this.rangedFilter_.matches(c);if(l.hasChild(n)){const p=l.getImmediateChild(n);let f=s.getChildAfterChild(this.index_,d,this.reverse_);for(;f!=null&&(f.name===n||l.hasChild(f.name));)f=s.getChildAfterChild(this.index_,f,this.reverse_);const b=f==null?1:o(f,c);if(u&&!r.isEmpty()&&b>=0)return i!=null&&i.trackChildChange(Xl(n,r,p)),l.updateImmediateChild(n,r);{i!=null&&i.trackChildChange(Kl(n,p));const k=l.updateImmediateChild(n,Xe.EMPTY_NODE);return f!=null&&this.rangedFilter_.matches(f)?(i!=null&&i.trackChildChange(na(f.name,f.node)),k.updateImmediateChild(f.name,f.node)):k}}else return r.isEmpty()?e:u&&o(d,c)>=0?(i!=null&&(i.trackChildChange(Kl(d.name,d.node)),i.trackChildChange(na(n,r))),l.updateImmediateChild(n,r).updateImmediateChild(d.name,Xe.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D0{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Ut}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return ge(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return ge(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:ta}hasEnd(){return this.endSet_}getIndexEndValue(){return ge(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return ge(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Wi}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return ge(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Ut}copy(){const e=new D0;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function Uk(t){return t.loadsAllData()?new L0(t.getIndex()):t.hasLimit()?new Fk(t):new Jl(t)}function Gv(t){const e={};if(t.isDefault())return e;let n;if(t.index_===Ut?n="$priority":t.index_===jk?n="$value":t.index_===Uo?n="$key":(ge(t.index_ instanceof Mk,"Unrecognized index type!"),n=t.index_.toString()),e.orderBy=Zt(n),t.startSet_){const r=t.startAfterSet_?"startAfter":"startAt";e[r]=Zt(t.indexStartValue_),t.startNameSet_&&(e[r]+=","+Zt(t.indexStartName_))}if(t.endSet_){const r=t.endBeforeSet_?"endBefore":"endAt";e[r]=Zt(t.indexEndValue_),t.endNameSet_&&(e[r]+=","+Zt(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function Vv(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;n===""&&(t.isViewFromLeft()?n="l":n="r"),e.vf=n}return t.index_!==Ut&&(e.i=t.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tu extends nE{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,n){return n!==void 0?"tag$"+n:(ge(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,n,r,s){super(),this.repoInfo_=e,this.onDataUpdate_=n,this.authTokenProvider_=r,this.appCheckTokenProvider_=s,this.log_=uc("p:rest:"),this.listens_={}}listen(e,n,r,s){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const o=Tu.getListenId_(e,r),l={};this.listens_[o]=l;const c=Gv(e._queryParams);this.restRequest_(i+".json",c,(d,u)=>{let p=u;if(d===404&&(p=null,d=null),d===null&&this.onDataUpdate_(i,p,!1,r),Bi(this.listens_,o)===l){let f;d?d===401?f="permission_denied":f="rest_error:"+d:f="ok",s(f,null)}})}unlisten(e,n){const r=Tu.getListenId_(e,n);delete this.listens_[r]}get(e){const n=Gv(e._queryParams),r=e._path.toString(),s=new Ir;return this.restRequest_(r+".json",n,(i,o)=>{let l=o;i===404&&(l=null,i=null),i===null?(this.onDataUpdate_(r,l,!1,null),s.resolve(l)):s.reject(new Error(l))}),s.promise}refreshAuthToken(e){}restRequest_(e,n={},r){return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,i])=>{s&&s.accessToken&&(n.auth=s.accessToken),i&&i.token&&(n.ac=i.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+fa(n);this.log_("Sending REST request for "+o);const l=new XMLHttpRequest;l.onreadystatechange=()=>{if(r&&l.readyState===4){this.log_("REST Response for "+o+" received. status:",l.status,"response:",l.responseText);let c=null;if(l.status>=200&&l.status<300){try{c=Wl(l.responseText)}catch{Pn("Failed to parse JSON response for "+o+": "+l.responseText)}r(null,c)}else l.status!==401&&l.status!==404&&Pn("Got unsuccessful REST response for "+o+" Status: "+l.status),r(l.status);r=null}},l.open("GET",o,!0),l.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bk{constructor(){this.rootNode_=Xe.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,n){this.rootNode_=this.rootNode_.updateChild(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Iu(){return{value:null,children:new Map}}function ga(t,e,n){if(ht(e))t.value=n,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,n);else{const r=ut(e);t.children.has(r)||t.children.set(r,Iu());const s=t.children.get(r);e=At(e),ga(s,e,n)}}function Kp(t,e){if(ht(e))return t.value=null,t.children.clear(),!0;if(t.value!==null){if(t.value.isLeafNode())return!1;{const n=t.value;return t.value=null,n.forEachChild(Ut,(r,s)=>{ga(t,new wt(r),s)}),Kp(t,e)}}else if(t.children.size>0){const n=ut(e);return e=At(e),t.children.has(n)&&Kp(t.children.get(n),e)&&t.children.delete(n),t.children.size===0}else return!0}function Xp(t,e,n){t.value!==null?n(e,t.value):zk(t,(r,s)=>{const i=new wt(e.toString()+"/"+r);Xp(s,i,n)})}function zk(t,e){t.children.forEach((n,r)=>{e(r,n)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hk{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),n={...e};return this.last_&&cn(this.last_,(r,s)=>{n[r]=n[r]-s}),this.last_=e,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yv=10*1e3,Wk=30*1e3,Gk=5*60*1e3;class Vk{constructor(e,n){this.server_=n,this.statsToReport_={},this.statsListener_=new Hk(e);const r=Yv+(Wk-Yv)*Math.random();vl(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),n={};let r=!1;cn(e,(s,i)=>{i>0&&Dr(this.statsToReport_,s)&&(n[s]=i,r=!0)}),r&&this.server_.reportStats(n),vl(this.reportStats_.bind(this),Math.floor(Math.random()*2*Gk))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Cr;(function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Cr||(Cr={}));function M0(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function N0(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function j0(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wu{constructor(e,n,r){this.path=e,this.affectedTree=n,this.revert=r,this.type=Cr.ACK_USER_WRITE,this.source=M0()}operationForChild(e){if(ht(this.path)){if(this.affectedTree.value!=null)return ge(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const n=this.affectedTree.subtree(new wt(e));return new wu(_t(),n,this.revert)}}else return ge(ut(this.path)===e,"operationForChild called for unrelated child."),new wu(At(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ql{constructor(e,n){this.source=e,this.path=n,this.type=Cr.LISTEN_COMPLETE}operationForChild(e){return ht(this.path)?new Ql(this.source,_t()):new Ql(this.source,At(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gi{constructor(e,n,r){this.source=e,this.path=n,this.snap=r,this.type=Cr.OVERWRITE}operationForChild(e){return ht(this.path)?new Gi(this.source,_t(),this.snap.getImmediateChild(e)):new Gi(this.source,At(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ra{constructor(e,n,r){this.source=e,this.path=n,this.children=r,this.type=Cr.MERGE}operationForChild(e){if(ht(this.path)){const n=this.children.subtree(new wt(e));return n.isEmpty()?null:n.value?new Gi(this.source,_t(),n.value):new ra(this.source,_t(),n)}else return ge(ut(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new ra(this.source,At(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class li{constructor(e,n,r){this.node_=e,this.fullyInitialized_=n,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(ht(e))return this.isFullyInitialized()&&!this.filtered_;const n=ut(e);return this.isCompleteForChild(n)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yk{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Kk(t,e,n,r){const s=[],i=[];return e.forEach(o=>{o.type==="child_changed"&&t.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&i.push($k(o.childName,o.snapshotNode))}),Qa(t,s,"child_removed",e,r,n),Qa(t,s,"child_added",e,r,n),Qa(t,s,"child_moved",i,r,n),Qa(t,s,"child_changed",e,r,n),Qa(t,s,"value",e,r,n),s}function Qa(t,e,n,r,s,i){const o=r.filter(l=>l.type===n);o.sort((l,c)=>Jk(t,l,c)),o.forEach(l=>{const c=Xk(t,l,i);s.forEach(d=>{d.respondsTo(l.type)&&e.push(d.createEvent(c,t.query_))})})}function Xk(t,e,n){return e.type==="value"||e.type==="child_removed"||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function Jk(t,e,n){if(e.childName==null||n.childName==null)throw da("Should only compare child_ events.");const r=new pt(e.childName,e.snapshotNode),s=new pt(n.childName,n.snapshotNode);return t.index_.compare(r,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cf(t,e){return{eventCache:t,serverCache:e}}function xl(t,e,n,r){return cf(new li(e,n,r),t.serverCache)}function fE(t,e,n,r){return cf(t.eventCache,new li(e,n,r))}function Cu(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function Vi(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let $h;const Qk=()=>($h||($h=new Wn(MC)),$h);class Lt{static fromObject(e){let n=new Lt(null);return cn(e,(r,s)=>{n=n.set(new wt(r),s)}),n}constructor(e,n=Qk()){this.value=e,this.children=n}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,n){if(this.value!=null&&n(this.value))return{path:_t(),value:this.value};if(ht(e))return null;{const r=ut(e),s=this.children.get(r);if(s!==null){const i=s.findRootMostMatchingPathAndValue(At(e),n);return i!=null?{path:Ht(new wt(r),i.path),value:i.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(ht(e))return this;{const n=ut(e),r=this.children.get(n);return r!==null?r.subtree(At(e)):new Lt(null)}}set(e,n){if(ht(e))return new Lt(n,this.children);{const r=ut(e),i=(this.children.get(r)||new Lt(null)).set(At(e),n),o=this.children.insert(r,i);return new Lt(this.value,o)}}remove(e){if(ht(e))return this.children.isEmpty()?new Lt(null):new Lt(null,this.children);{const n=ut(e),r=this.children.get(n);if(r){const s=r.remove(At(e));let i;return s.isEmpty()?i=this.children.remove(n):i=this.children.insert(n,s),this.value===null&&i.isEmpty()?new Lt(null):new Lt(this.value,i)}else return this}}get(e){if(ht(e))return this.value;{const n=ut(e),r=this.children.get(n);return r?r.get(At(e)):null}}setTree(e,n){if(ht(e))return n;{const r=ut(e),i=(this.children.get(r)||new Lt(null)).setTree(At(e),n);let o;return i.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,i),new Lt(this.value,o)}}fold(e){return this.fold_(_t(),e)}fold_(e,n){const r={};return this.children.inorderTraversal((s,i)=>{r[s]=i.fold_(Ht(e,s),n)}),n(e,this.value,r)}findOnPath(e,n){return this.findOnPath_(e,_t(),n)}findOnPath_(e,n,r){const s=this.value?r(n,this.value):!1;if(s)return s;if(ht(e))return null;{const i=ut(e),o=this.children.get(i);return o?o.findOnPath_(At(e),Ht(n,i),r):null}}foreachOnPath(e,n){return this.foreachOnPath_(e,_t(),n)}foreachOnPath_(e,n,r){if(ht(e))return this;{this.value&&r(n,this.value);const s=ut(e),i=this.children.get(s);return i?i.foreachOnPath_(At(e),Ht(n,s),r):new Lt(null)}}foreach(e){this.foreach_(_t(),e)}foreach_(e,n){this.children.inorderTraversal((r,s)=>{s.foreach_(Ht(e,r),n)}),this.value&&n(e,this.value)}foreachChild(e){this.children.inorderTraversal((n,r)=>{r.value&&e(n,r.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pr{constructor(e){this.writeTree_=e}static empty(){return new Pr(new Lt(null))}}function _l(t,e,n){if(ht(e))return new Pr(new Lt(n));{const r=t.writeTree_.findRootMostValueAndPath(e);if(r!=null){const s=r.path;let i=r.value;const o=Rn(s,e);return i=i.updateChild(o,n),new Pr(t.writeTree_.set(s,i))}else{const s=new Lt(n),i=t.writeTree_.setTree(e,s);return new Pr(i)}}}function Jp(t,e,n){let r=t;return cn(n,(s,i)=>{r=_l(r,Ht(e,s),i)}),r}function Kv(t,e){if(ht(e))return Pr.empty();{const n=t.writeTree_.setTree(e,new Lt(null));return new Pr(n)}}function Qp(t,e){return Qi(t,e)!=null}function Qi(t,e){const n=t.writeTree_.findRootMostValueAndPath(e);return n!=null?t.writeTree_.get(n.path).getChild(Rn(n.path,e)):null}function Xv(t){const e=[],n=t.writeTree_.value;return n!=null?n.isLeafNode()||n.forEachChild(Ut,(r,s)=>{e.push(new pt(r,s))}):t.writeTree_.children.inorderTraversal((r,s)=>{s.value!=null&&e.push(new pt(r,s.value))}),e}function ni(t,e){if(ht(e))return t;{const n=Qi(t,e);return n!=null?new Pr(new Lt(n)):new Pr(t.writeTree_.subtree(e))}}function qp(t){return t.writeTree_.isEmpty()}function sa(t,e){return hE(_t(),t.writeTree_,e)}function hE(t,e,n){if(e.value!=null)return n.updateChild(t,e.value);{let r=null;return e.children.inorderTraversal((s,i)=>{s===".priority"?(ge(i.value!==null,"Priority writes must always be leaf nodes"),r=i.value):n=hE(Ht(t,s),i,n)}),!n.getChild(t).isEmpty()&&r!==null&&(n=n.updateChild(Ht(t,".priority"),r)),n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function df(t,e){return yE(e,t)}function qk(t,e,n,r,s){ge(r>t.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),t.allWrites.push({path:e,snap:n,writeId:r,visible:s}),s&&(t.visibleWrites=_l(t.visibleWrites,e,n)),t.lastWriteId=r}function Zk(t,e,n,r){ge(r>t.lastWriteId,"Stacking an older merge on top of newer ones"),t.allWrites.push({path:e,children:n,writeId:r,visible:!0}),t.visibleWrites=Jp(t.visibleWrites,e,n),t.lastWriteId=r}function eR(t,e){for(let n=0;n<t.allWrites.length;n++){const r=t.allWrites[n];if(r.writeId===e)return r}return null}function tR(t,e){const n=t.allWrites.findIndex(l=>l.writeId===e);ge(n>=0,"removeWrite called with nonexistent writeId.");const r=t.allWrites[n];t.allWrites.splice(n,1);let s=r.visible,i=!1,o=t.allWrites.length-1;for(;s&&o>=0;){const l=t.allWrites[o];l.visible&&(o>=n&&nR(l,r.path)?s=!1:hr(r.path,l.path)&&(i=!0)),o--}if(s){if(i)return rR(t),!0;if(r.snap)t.visibleWrites=Kv(t.visibleWrites,r.path);else{const l=r.children;cn(l,c=>{t.visibleWrites=Kv(t.visibleWrites,Ht(r.path,c))})}return!0}else return!1}function nR(t,e){if(t.snap)return hr(t.path,e);for(const n in t.children)if(t.children.hasOwnProperty(n)&&hr(Ht(t.path,n),e))return!0;return!1}function rR(t){t.visibleWrites=pE(t.allWrites,sR,_t()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function sR(t){return t.visible}function pE(t,e,n){let r=Pr.empty();for(let s=0;s<t.length;++s){const i=t[s];if(e(i)){const o=i.path;let l;if(i.snap)hr(n,o)?(l=Rn(n,o),r=_l(r,l,i.snap)):hr(o,n)&&(l=Rn(o,n),r=_l(r,_t(),i.snap.getChild(l)));else if(i.children){if(hr(n,o))l=Rn(n,o),r=Jp(r,l,i.children);else if(hr(o,n))if(l=Rn(o,n),ht(l))r=Jp(r,_t(),i.children);else{const c=Bi(i.children,ut(l));if(c){const d=c.getChild(At(l));r=_l(r,_t(),d)}}}else throw da("WriteRecord should have .snap or .children")}}return r}function gE(t,e,n,r,s){if(!r&&!s){const i=Qi(t.visibleWrites,e);if(i!=null)return i;{const o=ni(t.visibleWrites,e);if(qp(o))return n;if(n==null&&!Qp(o,_t()))return null;{const l=n||Xe.EMPTY_NODE;return sa(o,l)}}}else{const i=ni(t.visibleWrites,e);if(!s&&qp(i))return n;if(!s&&n==null&&!Qp(i,_t()))return null;{const o=function(d){return(d.visible||s)&&(!r||!~r.indexOf(d.writeId))&&(hr(d.path,e)||hr(e,d.path))},l=pE(t.allWrites,o,e),c=n||Xe.EMPTY_NODE;return sa(l,c)}}}function iR(t,e,n){let r=Xe.EMPTY_NODE;const s=Qi(t.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(Ut,(i,o)=>{r=r.updateImmediateChild(i,o)}),r;if(n){const i=ni(t.visibleWrites,e);return n.forEachChild(Ut,(o,l)=>{const c=sa(ni(i,new wt(o)),l);r=r.updateImmediateChild(o,c)}),Xv(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{const i=ni(t.visibleWrites,e);return Xv(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function oR(t,e,n,r,s){ge(r||s,"Either existingEventSnap or existingServerSnap must exist");const i=Ht(e,n);if(Qp(t.visibleWrites,i))return null;{const o=ni(t.visibleWrites,i);return qp(o)?s.getChild(n):sa(o,s.getChild(n))}}function aR(t,e,n,r){const s=Ht(e,n),i=Qi(t.visibleWrites,s);if(i!=null)return i;if(r.isCompleteForChild(n)){const o=ni(t.visibleWrites,s);return sa(o,r.getNode().getImmediateChild(n))}else return null}function lR(t,e){return Qi(t.visibleWrites,e)}function cR(t,e,n,r,s,i,o){let l;const c=ni(t.visibleWrites,e),d=Qi(c,_t());if(d!=null)l=d;else if(n!=null)l=sa(c,n);else return[];if(l=l.withIndex(o),!l.isEmpty()&&!l.isLeafNode()){const u=[],p=o.getCompare(),f=i?l.getReverseIteratorFrom(r,o):l.getIteratorFrom(r,o);let b=f.getNext();for(;b&&u.length<s;)p(b,r)!==0&&u.push(b),b=f.getNext();return u}else return[]}function dR(){return{visibleWrites:Pr.empty(),allWrites:[],lastWriteId:-1}}function ku(t,e,n,r){return gE(t.writeTree,t.treePath,e,n,r)}function $0(t,e){return iR(t.writeTree,t.treePath,e)}function Jv(t,e,n,r){return oR(t.writeTree,t.treePath,e,n,r)}function Ru(t,e){return lR(t.writeTree,Ht(t.treePath,e))}function uR(t,e,n,r,s,i){return cR(t.writeTree,t.treePath,e,n,r,s,i)}function F0(t,e,n){return aR(t.writeTree,t.treePath,e,n)}function mE(t,e){return yE(Ht(t.treePath,e),t.writeTree)}function yE(t,e){return{treePath:t,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fR{constructor(){this.changeMap=new Map}trackChildChange(e){const n=e.type,r=e.childName;ge(n==="child_added"||n==="child_changed"||n==="child_removed","Only child changes supported for tracking"),ge(r!==".priority","Only non-priority child changes can be tracked.");const s=this.changeMap.get(r);if(s){const i=s.type;if(n==="child_added"&&i==="child_removed")this.changeMap.set(r,Xl(r,e.snapshotNode,s.snapshotNode));else if(n==="child_removed"&&i==="child_added")this.changeMap.delete(r);else if(n==="child_removed"&&i==="child_changed")this.changeMap.set(r,Kl(r,s.oldSnap));else if(n==="child_changed"&&i==="child_added")this.changeMap.set(r,na(r,e.snapshotNode));else if(n==="child_changed"&&i==="child_changed")this.changeMap.set(r,Xl(r,e.snapshotNode,s.oldSnap));else throw da("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hR{getCompleteChild(e){return null}getChildAfterChild(e,n,r){return null}}const vE=new hR;class U0{constructor(e,n,r=null){this.writes_=e,this.viewCache_=n,this.optCompleteServerCache_=r}getCompleteChild(e){const n=this.viewCache_.eventCache;if(n.isCompleteForChild(e))return n.getNode().getImmediateChild(e);{const r=this.optCompleteServerCache_!=null?new li(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return F0(this.writes_,e,r)}}getChildAfterChild(e,n,r){const s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Vi(this.viewCache_),i=uR(this.writes_,s,n,1,r,e);return i.length===0?null:i[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pR(t){return{filter:t}}function gR(t,e){ge(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),ge(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function mR(t,e,n,r,s){const i=new fR;let o,l;if(n.type===Cr.OVERWRITE){const d=n;d.source.fromUser?o=Zp(t,e,d.path,d.snap,r,s,i):(ge(d.source.fromServer,"Unknown source."),l=d.source.tagged||e.serverCache.isFiltered()&&!ht(d.path),o=Au(t,e,d.path,d.snap,r,s,l,i))}else if(n.type===Cr.MERGE){const d=n;d.source.fromUser?o=vR(t,e,d.path,d.children,r,s,i):(ge(d.source.fromServer,"Unknown source."),l=d.source.tagged||e.serverCache.isFiltered(),o=eg(t,e,d.path,d.children,r,s,l,i))}else if(n.type===Cr.ACK_USER_WRITE){const d=n;d.revert?o=bR(t,e,d.path,r,s,i):o=xR(t,e,d.path,d.affectedTree,r,s,i)}else if(n.type===Cr.LISTEN_COMPLETE)o=_R(t,e,n.path,r,i);else throw da("Unknown operation type: "+n.type);const c=i.getChanges();return yR(e,o,c),{viewCache:o,changes:c}}function yR(t,e,n){const r=e.eventCache;if(r.isFullyInitialized()){const s=r.getNode().isLeafNode()||r.getNode().isEmpty(),i=Cu(t);(n.length>0||!t.eventCache.isFullyInitialized()||s&&!r.getNode().equals(i)||!r.getNode().getPriority().equals(i.getPriority()))&&n.push(uE(Cu(e)))}}function xE(t,e,n,r,s,i){const o=e.eventCache;if(Ru(r,n)!=null)return e;{let l,c;if(ht(n))if(ge(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const d=Vi(e),u=d instanceof Xe?d:Xe.EMPTY_NODE,p=$0(r,u);l=t.filter.updateFullNode(e.eventCache.getNode(),p,i)}else{const d=ku(r,Vi(e));l=t.filter.updateFullNode(e.eventCache.getNode(),d,i)}else{const d=ut(n);if(d===".priority"){ge(ai(n)===1,"Can't have a priority with additional path components");const u=o.getNode();c=e.serverCache.getNode();const p=Jv(r,n,u,c);p!=null?l=t.filter.updatePriority(u,p):l=o.getNode()}else{const u=At(n);let p;if(o.isCompleteForChild(d)){c=e.serverCache.getNode();const f=Jv(r,n,o.getNode(),c);f!=null?p=o.getNode().getImmediateChild(d).updateChild(u,f):p=o.getNode().getImmediateChild(d)}else p=F0(r,d,e.serverCache);p!=null?l=t.filter.updateChild(o.getNode(),d,p,u,s,i):l=o.getNode()}}return xl(e,l,o.isFullyInitialized()||ht(n),t.filter.filtersNodes())}}function Au(t,e,n,r,s,i,o,l){const c=e.serverCache;let d;const u=o?t.filter:t.filter.getIndexedFilter();if(ht(n))d=u.updateFullNode(c.getNode(),r,null);else if(u.filtersNodes()&&!c.isFiltered()){const b=c.getNode().updateChild(n,r);d=u.updateFullNode(c.getNode(),b,null)}else{const b=ut(n);if(!c.isCompleteForPath(n)&&ai(n)>1)return e;const I=At(n),F=c.getNode().getImmediateChild(b).updateChild(I,r);b===".priority"?d=u.updatePriority(c.getNode(),F):d=u.updateChild(c.getNode(),b,F,I,vE,null)}const p=fE(e,d,c.isFullyInitialized()||ht(n),u.filtersNodes()),f=new U0(s,p,i);return xE(t,p,n,s,f,l)}function Zp(t,e,n,r,s,i,o){const l=e.eventCache;let c,d;const u=new U0(s,e,i);if(ht(n))d=t.filter.updateFullNode(e.eventCache.getNode(),r,o),c=xl(e,d,!0,t.filter.filtersNodes());else{const p=ut(n);if(p===".priority")d=t.filter.updatePriority(e.eventCache.getNode(),r),c=xl(e,d,l.isFullyInitialized(),l.isFiltered());else{const f=At(n),b=l.getNode().getImmediateChild(p);let I;if(ht(f))I=r;else{const k=u.getCompleteChild(p);k!=null?R0(f)===".priority"&&k.getChild(sE(f)).isEmpty()?I=k:I=k.updateChild(f,r):I=Xe.EMPTY_NODE}if(b.equals(I))c=e;else{const k=t.filter.updateChild(l.getNode(),p,I,f,u,o);c=xl(e,k,l.isFullyInitialized(),t.filter.filtersNodes())}}}return c}function Qv(t,e){return t.eventCache.isCompleteForChild(e)}function vR(t,e,n,r,s,i,o){let l=e;return r.foreach((c,d)=>{const u=Ht(n,c);Qv(e,ut(u))&&(l=Zp(t,l,u,d,s,i,o))}),r.foreach((c,d)=>{const u=Ht(n,c);Qv(e,ut(u))||(l=Zp(t,l,u,d,s,i,o))}),l}function qv(t,e,n){return n.foreach((r,s)=>{e=e.updateChild(r,s)}),e}function eg(t,e,n,r,s,i,o,l){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,d;ht(n)?d=r:d=new Lt(null).setTree(n,r);const u=e.serverCache.getNode();return d.children.inorderTraversal((p,f)=>{if(u.hasChild(p)){const b=e.serverCache.getNode().getImmediateChild(p),I=qv(t,b,f);c=Au(t,c,new wt(p),I,s,i,o,l)}}),d.children.inorderTraversal((p,f)=>{const b=!e.serverCache.isCompleteForChild(p)&&f.value===null;if(!u.hasChild(p)&&!b){const I=e.serverCache.getNode().getImmediateChild(p),k=qv(t,I,f);c=Au(t,c,new wt(p),k,s,i,o,l)}}),c}function xR(t,e,n,r,s,i,o){if(Ru(s,n)!=null)return e;const l=e.serverCache.isFiltered(),c=e.serverCache;if(r.value!=null){if(ht(n)&&c.isFullyInitialized()||c.isCompleteForPath(n))return Au(t,e,n,c.getNode().getChild(n),s,i,l,o);if(ht(n)){let d=new Lt(null);return c.getNode().forEachChild(Uo,(u,p)=>{d=d.set(new wt(u),p)}),eg(t,e,n,d,s,i,l,o)}else return e}else{let d=new Lt(null);return r.foreach((u,p)=>{const f=Ht(n,u);c.isCompleteForPath(f)&&(d=d.set(u,c.getNode().getChild(f)))}),eg(t,e,n,d,s,i,l,o)}}function _R(t,e,n,r,s){const i=e.serverCache,o=fE(e,i.getNode(),i.isFullyInitialized()||ht(n),i.isFiltered());return xE(t,o,n,r,vE,s)}function bR(t,e,n,r,s,i){let o;if(Ru(r,n)!=null)return e;{const l=new U0(r,e,s),c=e.eventCache.getNode();let d;if(ht(n)||ut(n)===".priority"){let u;if(e.serverCache.isFullyInitialized())u=ku(r,Vi(e));else{const p=e.serverCache.getNode();ge(p instanceof Xe,"serverChildren would be complete if leaf node"),u=$0(r,p)}u=u,d=t.filter.updateFullNode(c,u,i)}else{const u=ut(n);let p=F0(r,u,e.serverCache);p==null&&e.serverCache.isCompleteForChild(u)&&(p=c.getImmediateChild(u)),p!=null?d=t.filter.updateChild(c,u,p,At(n),l,i):e.eventCache.getNode().hasChild(u)?d=t.filter.updateChild(c,u,Xe.EMPTY_NODE,At(n),l,i):d=c,d.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=ku(r,Vi(e)),o.isLeafNode()&&(d=t.filter.updateFullNode(d,o,i)))}return o=e.serverCache.isFullyInitialized()||Ru(r,_t())!=null,xl(e,d,o,t.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ER{constructor(e,n){this.query_=e,this.eventRegistrations_=[];const r=this.query_._queryParams,s=new L0(r.getIndex()),i=Uk(r);this.processor_=pR(i);const o=n.serverCache,l=n.eventCache,c=s.updateFullNode(Xe.EMPTY_NODE,o.getNode(),null),d=i.updateFullNode(Xe.EMPTY_NODE,l.getNode(),null),u=new li(c,o.isFullyInitialized(),s.filtersNodes()),p=new li(d,l.isFullyInitialized(),i.filtersNodes());this.viewCache_=cf(p,u),this.eventGenerator_=new Yk(this.query_)}get query(){return this.query_}}function SR(t){return t.viewCache_.serverCache.getNode()}function TR(t){return Cu(t.viewCache_)}function IR(t,e){const n=Vi(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!ht(e)&&!n.getImmediateChild(ut(e)).isEmpty())?n.getChild(e):null}function Zv(t){return t.eventRegistrations_.length===0}function wR(t,e){t.eventRegistrations_.push(e)}function ex(t,e,n){const r=[];if(n){ge(e==null,"A cancel should cancel all event registrations.");const s=t.query._path;t.eventRegistrations_.forEach(i=>{const o=i.createCancelEvent(n,s);o&&r.push(o)})}if(e){let s=[];for(let i=0;i<t.eventRegistrations_.length;++i){const o=t.eventRegistrations_[i];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(t.eventRegistrations_.slice(i+1));break}}t.eventRegistrations_=s}else t.eventRegistrations_=[];return r}function tx(t,e,n,r){e.type===Cr.MERGE&&e.source.queryId!==null&&(ge(Vi(t.viewCache_),"We should always have a full cache before handling merges"),ge(Cu(t.viewCache_),"Missing event cache, even though we have a server cache"));const s=t.viewCache_,i=mR(t.processor_,s,e,n,r);return gR(t.processor_,i.viewCache),ge(i.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=i.viewCache,_E(t,i.changes,i.viewCache.eventCache.getNode(),null)}function CR(t,e){const n=t.viewCache_.eventCache,r=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(Ut,(i,o)=>{r.push(na(i,o))}),n.isFullyInitialized()&&r.push(uE(n.getNode())),_E(t,r,n.getNode(),e)}function _E(t,e,n,r){const s=r?[r]:t.eventRegistrations_;return Kk(t.eventGenerator_,e,n,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Pu;class bE{constructor(){this.views=new Map}}function kR(t){ge(!Pu,"__referenceConstructor has already been defined"),Pu=t}function RR(){return ge(Pu,"Reference.ts has not been loaded"),Pu}function AR(t){return t.views.size===0}function B0(t,e,n,r){const s=e.source.queryId;if(s!==null){const i=t.views.get(s);return ge(i!=null,"SyncTree gave us an op for an invalid query."),tx(i,e,n,r)}else{let i=[];for(const o of t.views.values())i=i.concat(tx(o,e,n,r));return i}}function EE(t,e,n,r,s){const i=e._queryIdentifier,o=t.views.get(i);if(!o){let l=ku(n,s?r:null),c=!1;l?c=!0:r instanceof Xe?(l=$0(n,r),c=!1):(l=Xe.EMPTY_NODE,c=!1);const d=cf(new li(l,c,!1),new li(r,s,!1));return new ER(e,d)}return o}function PR(t,e,n,r,s,i){const o=EE(t,e,r,s,i);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,o),wR(o,n),CR(o,n)}function OR(t,e,n,r){const s=e._queryIdentifier,i=[];let o=[];const l=ci(t);if(s==="default")for(const[c,d]of t.views.entries())o=o.concat(ex(d,n,r)),Zv(d)&&(t.views.delete(c),d.query._queryParams.loadsAllData()||i.push(d.query));else{const c=t.views.get(s);c&&(o=o.concat(ex(c,n,r)),Zv(c)&&(t.views.delete(s),c.query._queryParams.loadsAllData()||i.push(c.query)))}return l&&!ci(t)&&i.push(new(RR())(e._repo,e._path)),{removed:i,events:o}}function SE(t){const e=[];for(const n of t.views.values())n.query._queryParams.loadsAllData()||e.push(n);return e}function ri(t,e){let n=null;for(const r of t.views.values())n=n||IR(r,e);return n}function TE(t,e){if(e._queryParams.loadsAllData())return uf(t);{const r=e._queryIdentifier;return t.views.get(r)}}function IE(t,e){return TE(t,e)!=null}function ci(t){return uf(t)!=null}function uf(t){for(const e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ou;function LR(t){ge(!Ou,"__referenceConstructor has already been defined"),Ou=t}function DR(){return ge(Ou,"Reference.ts has not been loaded"),Ou}let MR=1;class nx{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Lt(null),this.pendingWriteTree_=dR(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function z0(t,e,n,r,s){return qk(t.pendingWriteTree_,e,n,r,s),s?ma(t,new Gi(M0(),e,n)):[]}function NR(t,e,n,r){Zk(t.pendingWriteTree_,e,n,r);const s=Lt.fromObject(n);return ma(t,new ra(M0(),e,s))}function zs(t,e,n=!1){const r=eR(t.pendingWriteTree_,e);if(tR(t.pendingWriteTree_,e)){let i=new Lt(null);return r.snap!=null?i=i.set(_t(),!0):cn(r.children,o=>{i=i.set(new wt(o),!0)}),ma(t,new wu(r.path,i,n))}else return[]}function hc(t,e,n){return ma(t,new Gi(N0(),e,n))}function jR(t,e,n){const r=Lt.fromObject(n);return ma(t,new ra(N0(),e,r))}function $R(t,e){return ma(t,new Ql(N0(),e))}function FR(t,e,n){const r=H0(t,n);if(r){const s=W0(r),i=s.path,o=s.queryId,l=Rn(i,e),c=new Ql(j0(o),l);return G0(t,i,c)}else return[]}function Lu(t,e,n,r,s=!1){const i=e._path,o=t.syncPointTree_.get(i);let l=[];if(o&&(e._queryIdentifier==="default"||IE(o,e))){const c=OR(o,e,n,r);AR(o)&&(t.syncPointTree_=t.syncPointTree_.remove(i));const d=c.removed;if(l=c.events,!s){const u=d.findIndex(f=>f._queryParams.loadsAllData())!==-1,p=t.syncPointTree_.findOnPath(i,(f,b)=>ci(b));if(u&&!p){const f=t.syncPointTree_.subtree(i);if(!f.isEmpty()){const b=zR(f);for(let I=0;I<b.length;++I){const k=b[I],F=k.query,x=RE(t,k);t.listenProvider_.startListening(bl(F),ql(t,F),x.hashFn,x.onComplete)}}}!p&&d.length>0&&!r&&(u?t.listenProvider_.stopListening(bl(e),null):d.forEach(f=>{const b=t.queryToTagMap.get(hf(f));t.listenProvider_.stopListening(bl(f),b)}))}HR(t,d)}return l}function wE(t,e,n,r){const s=H0(t,r);if(s!=null){const i=W0(s),o=i.path,l=i.queryId,c=Rn(o,e),d=new Gi(j0(l),c,n);return G0(t,o,d)}else return[]}function UR(t,e,n,r){const s=H0(t,r);if(s){const i=W0(s),o=i.path,l=i.queryId,c=Rn(o,e),d=Lt.fromObject(n),u=new ra(j0(l),c,d);return G0(t,o,u)}else return[]}function tg(t,e,n,r=!1){const s=e._path;let i=null,o=!1;t.syncPointTree_.foreachOnPath(s,(f,b)=>{const I=Rn(f,s);i=i||ri(b,I),o=o||ci(b)});let l=t.syncPointTree_.get(s);l?(o=o||ci(l),i=i||ri(l,_t())):(l=new bE,t.syncPointTree_=t.syncPointTree_.set(s,l));let c;i!=null?c=!0:(c=!1,i=Xe.EMPTY_NODE,t.syncPointTree_.subtree(s).foreachChild((b,I)=>{const k=ri(I,_t());k&&(i=i.updateImmediateChild(b,k))}));const d=IE(l,e);if(!d&&!e._queryParams.loadsAllData()){const f=hf(e);ge(!t.queryToTagMap.has(f),"View does not exist, but we have a tag");const b=WR();t.queryToTagMap.set(f,b),t.tagToQueryMap.set(b,f)}const u=df(t.pendingWriteTree_,s);let p=PR(l,e,n,u,i,c);if(!d&&!o&&!r){const f=TE(l,e);p=p.concat(GR(t,e,f))}return p}function ff(t,e,n){const s=t.pendingWriteTree_,i=t.syncPointTree_.findOnPath(e,(o,l)=>{const c=Rn(o,e),d=ri(l,c);if(d)return d});return gE(s,e,i,n,!0)}function BR(t,e){const n=e._path;let r=null;t.syncPointTree_.foreachOnPath(n,(d,u)=>{const p=Rn(d,n);r=r||ri(u,p)});let s=t.syncPointTree_.get(n);s?r=r||ri(s,_t()):(s=new bE,t.syncPointTree_=t.syncPointTree_.set(n,s));const i=r!=null,o=i?new li(r,!0,!1):null,l=df(t.pendingWriteTree_,e._path),c=EE(s,e,l,i?o.getNode():Xe.EMPTY_NODE,i);return TR(c)}function ma(t,e){return CE(e,t.syncPointTree_,null,df(t.pendingWriteTree_,_t()))}function CE(t,e,n,r){if(ht(t.path))return kE(t,e,n,r);{const s=e.get(_t());n==null&&s!=null&&(n=ri(s,_t()));let i=[];const o=ut(t.path),l=t.operationForChild(o),c=e.children.get(o);if(c&&l){const d=n?n.getImmediateChild(o):null,u=mE(r,o);i=i.concat(CE(l,c,d,u))}return s&&(i=i.concat(B0(s,t,r,n))),i}}function kE(t,e,n,r){const s=e.get(_t());n==null&&s!=null&&(n=ri(s,_t()));let i=[];return e.children.inorderTraversal((o,l)=>{const c=n?n.getImmediateChild(o):null,d=mE(r,o),u=t.operationForChild(o);u&&(i=i.concat(kE(u,l,c,d)))}),s&&(i=i.concat(B0(s,t,r,n))),i}function RE(t,e){const n=e.query,r=ql(t,n);return{hashFn:()=>(SR(e)||Xe.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return r?FR(t,n._path,r):$R(t,n._path);{const i=$C(s,n);return Lu(t,n,null,i)}}}}function ql(t,e){const n=hf(e);return t.queryToTagMap.get(n)}function hf(t){return t._path.toString()+"$"+t._queryIdentifier}function H0(t,e){return t.tagToQueryMap.get(e)}function W0(t){const e=t.indexOf("$");return ge(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new wt(t.substr(0,e))}}function G0(t,e,n){const r=t.syncPointTree_.get(e);ge(r,"Missing sync point for query tag that we're tracking");const s=df(t.pendingWriteTree_,e);return B0(r,n,s,null)}function zR(t){return t.fold((e,n,r)=>{if(n&&ci(n))return[uf(n)];{let s=[];return n&&(s=SE(n)),cn(r,(i,o)=>{s=s.concat(o)}),s}})}function bl(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(DR())(t._repo,t._path):t}function HR(t,e){for(let n=0;n<e.length;++n){const r=e[n];if(!r._queryParams.loadsAllData()){const s=hf(r),i=t.queryToTagMap.get(s);t.queryToTagMap.delete(s),t.tagToQueryMap.delete(i)}}}function WR(){return MR++}function GR(t,e,n){const r=e._path,s=ql(t,e),i=RE(t,n),o=t.listenProvider_.startListening(bl(e),s,i.hashFn,i.onComplete),l=t.syncPointTree_.subtree(r);if(s)ge(!ci(l.value),"If we're adding a query, it shouldn't be shadowed");else{const c=l.fold((d,u,p)=>{if(!ht(d)&&u&&ci(u))return[uf(u).query];{let f=[];return u&&(f=f.concat(SE(u).map(b=>b.query))),cn(p,(b,I)=>{f=f.concat(I)}),f}});for(let d=0;d<c.length;++d){const u=c[d];t.listenProvider_.stopListening(bl(u),ql(t,u))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V0{constructor(e){this.node_=e}getImmediateChild(e){const n=this.node_.getImmediateChild(e);return new V0(n)}node(){return this.node_}}class Y0{constructor(e,n){this.syncTree_=e,this.path_=n}getImmediateChild(e){const n=Ht(this.path_,e);return new Y0(this.syncTree_,n)}node(){return ff(this.syncTree_,this.path_)}}const VR=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},rx=function(t,e,n){if(!t||typeof t!="object")return t;if(ge(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return YR(t[".sv"],e,n);if(typeof t[".sv"]=="object")return KR(t[".sv"],e);ge(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},YR=function(t,e,n){switch(t){case"timestamp":return n.timestamp;default:ge(!1,"Unexpected server value: "+t)}},KR=function(t,e,n){t.hasOwnProperty("increment")||ge(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const r=t.increment;typeof r!="number"&&ge(!1,"Unexpected increment value: "+r);const s=e.node();if(ge(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return r;const o=s.getValue();return typeof o!="number"?r:o+r},AE=function(t,e,n,r){return X0(e,new Y0(n,t),r)},K0=function(t,e,n){return X0(t,new V0(e),n)};function X0(t,e,n){const r=t.getPriority().val(),s=rx(r,e.getImmediateChild(".priority"),n);let i;if(t.isLeafNode()){const o=t,l=rx(o.getValue(),e,n);return l!==o.getValue()||s!==o.getPriority().val()?new rn(l,zt(s)):t}else{const o=t;return i=o,s!==o.getPriority().val()&&(i=i.updatePriority(new rn(s))),o.forEachChild(Ut,(l,c)=>{const d=X0(c,e.getImmediateChild(l),n);d!==c&&(i=i.updateImmediateChild(l,d))}),i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J0{constructor(e="",n=null,r={children:{},childCount:0}){this.name=e,this.parent=n,this.node=r}}function pf(t,e){let n=e instanceof wt?e:new wt(e),r=t,s=ut(n);for(;s!==null;){const i=Bi(r.node.children,s)||{children:{},childCount:0};r=new J0(s,r,i),n=At(n),s=ut(n)}return r}function qi(t){return t.node.value}function Q0(t,e){t.node.value=e,ng(t)}function PE(t){return t.node.childCount>0}function XR(t){return qi(t)===void 0&&!PE(t)}function gf(t,e){cn(t.node.children,(n,r)=>{e(new J0(n,t,r))})}function OE(t,e,n,r){n&&e(t),gf(t,s=>{OE(s,e,!0)})}function JR(t,e,n){let r=t.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function pc(t){return new wt(t.parent===null?t.name:pc(t.parent)+"/"+t.name)}function ng(t){t.parent!==null&&QR(t.parent,t.name,t)}function QR(t,e,n){const r=XR(n),s=Dr(t.node.children,e);r&&s?(delete t.node.children[e],t.node.childCount--,ng(t)):!r&&!s&&(t.node.children[e]=n.node,t.node.childCount++,ng(t))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qR=/[\[\].#$\/\u0000-\u001F\u007F]/,ZR=/[\[\].#$\u0000-\u001F\u007F]/,Fh=10*1024*1024,q0=function(t){return typeof t=="string"&&t.length!==0&&!qR.test(t)},LE=function(t){return typeof t=="string"&&t.length!==0&&!ZR.test(t)},eA=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),LE(t)},Z0=function(t){return t===null||typeof t=="string"||typeof t=="number"&&!af(t)||t&&typeof t=="object"&&Dr(t,".sv")},Du=function(t,e,n,r){r&&e===void 0||gc(Zo(t,"value"),e,n)},gc=function(t,e,n){const r=n instanceof wt?new vk(n,t):n;if(e===void 0)throw new Error(t+"contains undefined "+ki(r));if(typeof e=="function")throw new Error(t+"contains a function "+ki(r)+" with contents = "+e.toString());if(af(e))throw new Error(t+"contains "+e.toString()+" "+ki(r));if(typeof e=="string"&&e.length>Fh/3&&of(e)>Fh)throw new Error(t+"contains a string greater than "+Fh+" utf8 bytes "+ki(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,i=!1;if(cn(e,(o,l)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(i=!0,!q0(o)))throw new Error(t+" contains an invalid key ("+o+") "+ki(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);xk(r,o),gc(t,l,r),_k(r)}),s&&i)throw new Error(t+' contains ".value" child '+ki(r)+" in addition to actual children.")}},tA=function(t,e){let n,r;for(n=0;n<e.length;n++){r=e[n];const i=Yl(r);for(let o=0;o<i.length;o++)if(!(i[o]===".priority"&&o===i.length-1)){if(!q0(i[o]))throw new Error(t+"contains an invalid key ("+i[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(yk);let s=null;for(n=0;n<e.length;n++){if(r=e[n],s!==null&&hr(s,r))throw new Error(t+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}},DE=function(t,e,n,r){const s=Zo(t,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");const i=[];cn(e,(o,l)=>{const c=new wt(o);if(gc(s,l,Ht(n,c)),R0(c)===".priority"&&!Z0(l))throw new Error(s+"contains an invalid value for '"+c.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");i.push(c)}),tA(s,i)},nA=function(t,e,n){if(af(e))throw new Error(Zo(t,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Z0(e))throw new Error(Zo(t,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")},ME=function(t,e,n,r){if(!LE(n))throw new Error(Zo(t,e)+'was an invalid path = "'+n+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},rA=function(t,e,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),ME(t,e,n)},Hs=function(t,e){if(ut(e)===".info")throw new Error(t+" failed = Can't modify data under /.info/")},sA=function(t,e){const n=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!q0(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||n.length!==0&&!eA(n))throw new Error(Zo(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iA{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function mf(t,e){let n=null;for(let r=0;r<e.length;r++){const s=e[r],i=s.getPath();n!==null&&!A0(i,n.path)&&(t.eventLists_.push(n),n=null),n===null&&(n={events:[],path:i}),n.events.push(s)}n&&t.eventLists_.push(n)}function NE(t,e,n){mf(t,n),jE(t,r=>A0(r,e))}function tr(t,e,n){mf(t,n),jE(t,r=>hr(r,e)||hr(e,r))}function jE(t,e){t.recursionDepth_++;let n=!0;for(let r=0;r<t.eventLists_.length;r++){const s=t.eventLists_[r];if(s){const i=s.path;e(i)?(oA(t.eventLists_[r]),t.eventLists_[r]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function oA(t){for(let e=0;e<t.events.length;e++){const n=t.events[e];if(n!==null){t.events[e]=null;const r=n.getEventRunner();yl&&an("event: "+n.toString()),pa(r)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aA="repo_interrupt",lA=25;class cA{constructor(e,n,r,s){this.repoInfo_=e,this.forceRestClient_=n,this.authTokenProvider_=r,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new iA,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Iu(),this.transactionQueueTree_=new J0,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function dA(t,e,n){if(t.stats_=C0(t.repoInfo_),t.forceRestClient_||zC())t.server_=new Tu(t.repoInfo_,(r,s,i,o)=>{sx(t,r,s,i,o)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>ix(t,!0),0);else{if(typeof n<"u"&&n!==null){if(typeof n!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Zt(n)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}t.persistentConnection_=new ds(t.repoInfo_,e,(r,s,i,o)=>{sx(t,r,s,i,o)},r=>{ix(t,r)},r=>{uA(t,r)},t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(r=>{t.server_.refreshAuthToken(r)}),t.appCheckProvider_.addTokenChangeListener(r=>{t.server_.refreshAppCheckToken(r.token)}),t.statsReporter_=YC(t.repoInfo_,()=>new Vk(t.stats_,t.server_)),t.infoData_=new Bk,t.infoSyncTree_=new nx({startListening:(r,s,i,o)=>{let l=[];const c=t.infoData_.getNode(r._path);return c.isEmpty()||(l=hc(t.infoSyncTree_,r._path,c),setTimeout(()=>{o("ok")},0)),l},stopListening:()=>{}}),em(t,"connected",!1),t.serverSyncTree_=new nx({startListening:(r,s,i,o)=>(t.server_.listen(r,i,s,(l,c)=>{const d=o(l,c);tr(t.eventQueue_,r._path,d)}),[]),stopListening:(r,s)=>{t.server_.unlisten(r,s)}})}function $E(t){const n=t.infoData_.getNode(new wt(".info/serverTimeOffset")).val()||0;return new Date().getTime()+n}function mc(t){return VR({timestamp:$E(t)})}function sx(t,e,n,r,s){t.dataUpdateCount++;const i=new wt(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let o=[];if(s)if(r){const c=xu(n,d=>zt(d));o=UR(t.serverSyncTree_,i,c,s)}else{const c=zt(n);o=wE(t.serverSyncTree_,i,c,s)}else if(r){const c=xu(n,d=>zt(d));o=jR(t.serverSyncTree_,i,c)}else{const c=zt(n);o=hc(t.serverSyncTree_,i,c)}let l=i;o.length>0&&(l=ia(t,i)),tr(t.eventQueue_,l,o)}function ix(t,e){em(t,"connected",e),e===!1&&gA(t)}function uA(t,e){cn(e,(n,r)=>{em(t,n,r)})}function em(t,e,n){const r=new wt("/.info/"+e),s=zt(n);t.infoData_.updateSnapshot(r,s);const i=hc(t.infoSyncTree_,r,s);tr(t.eventQueue_,r,i)}function yf(t){return t.nextWriteId_++}function fA(t,e,n){const r=BR(t.serverSyncTree_,e);return r!=null?Promise.resolve(r):t.server_.get(e).then(s=>{const i=zt(s).withIndex(e._queryParams.getIndex());tg(t.serverSyncTree_,e,n,!0);let o;if(e._queryParams.loadsAllData())o=hc(t.serverSyncTree_,e._path,i);else{const l=ql(t.serverSyncTree_,e);o=wE(t.serverSyncTree_,e._path,i,l)}return tr(t.eventQueue_,e._path,o),Lu(t.serverSyncTree_,e,n,null,!0),i},s=>(ya(t,"get for query "+Zt(e)+" failed: "+s),Promise.reject(new Error(s))))}function hA(t,e,n,r,s){ya(t,"set",{path:e.toString(),value:n,priority:r});const i=mc(t),o=zt(n,r),l=ff(t.serverSyncTree_,e),c=K0(o,l,i),d=yf(t),u=z0(t.serverSyncTree_,e,c,d,!0);mf(t.eventQueue_,u),t.server_.put(e.toString(),o.val(!0),(f,b)=>{const I=f==="ok";I||Pn("set at "+e+" failed: "+f);const k=zs(t.serverSyncTree_,d,!I);tr(t.eventQueue_,e,k),di(t,s,f,b)});const p=nm(t,e);ia(t,p),tr(t.eventQueue_,p,[])}function pA(t,e,n,r){ya(t,"update",{path:e.toString(),value:n});let s=!0;const i=mc(t),o={};if(cn(n,(l,c)=>{s=!1,o[l]=AE(Ht(e,l),zt(c),t.serverSyncTree_,i)}),s)an("update() called with empty data.  Don't do anything."),di(t,r,"ok",void 0);else{const l=yf(t),c=NR(t.serverSyncTree_,e,o,l);mf(t.eventQueue_,c),t.server_.merge(e.toString(),n,(d,u)=>{const p=d==="ok";p||Pn("update at "+e+" failed: "+d);const f=zs(t.serverSyncTree_,l,!p),b=f.length>0?ia(t,e):e;tr(t.eventQueue_,b,f),di(t,r,d,u)}),cn(n,d=>{const u=nm(t,Ht(e,d));ia(t,u)}),tr(t.eventQueue_,e,[])}}function gA(t){ya(t,"onDisconnectEvents");const e=mc(t),n=Iu();Xp(t.onDisconnect_,_t(),(s,i)=>{const o=AE(s,i,t.serverSyncTree_,e);ga(n,s,o)});let r=[];Xp(n,_t(),(s,i)=>{r=r.concat(hc(t.serverSyncTree_,s,i));const o=nm(t,s);ia(t,o)}),t.onDisconnect_=Iu(),tr(t.eventQueue_,_t(),r)}function mA(t,e,n){t.server_.onDisconnectCancel(e.toString(),(r,s)=>{r==="ok"&&Kp(t.onDisconnect_,e),di(t,n,r,s)})}function ox(t,e,n,r){const s=zt(n);t.server_.onDisconnectPut(e.toString(),s.val(!0),(i,o)=>{i==="ok"&&ga(t.onDisconnect_,e,s),di(t,r,i,o)})}function yA(t,e,n,r,s){const i=zt(n,r);t.server_.onDisconnectPut(e.toString(),i.val(!0),(o,l)=>{o==="ok"&&ga(t.onDisconnect_,e,i),di(t,s,o,l)})}function vA(t,e,n,r){if(vu(n)){an("onDisconnect().update() called with empty data.  Don't do anything."),di(t,r,"ok",void 0);return}t.server_.onDisconnectMerge(e.toString(),n,(s,i)=>{s==="ok"&&cn(n,(o,l)=>{const c=zt(l);ga(t.onDisconnect_,Ht(e,o),c)}),di(t,r,s,i)})}function xA(t,e,n){let r;ut(e._path)===".info"?r=tg(t.infoSyncTree_,e,n):r=tg(t.serverSyncTree_,e,n),NE(t.eventQueue_,e._path,r)}function _A(t,e,n){let r;ut(e._path)===".info"?r=Lu(t.infoSyncTree_,e,n):r=Lu(t.serverSyncTree_,e,n),NE(t.eventQueue_,e._path,r)}function bA(t){t.persistentConnection_&&t.persistentConnection_.interrupt(aA)}function ya(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),an(n,...e)}function di(t,e,n,r){e&&pa(()=>{if(n==="ok")e(null);else{const s=(n||"error").toUpperCase();let i=s;r&&(i+=": "+r);const o=new Error(i);o.code=s,e(o)}})}function EA(t,e,n,r,s,i){ya(t,"transaction on "+e);const o={path:e,update:n,onComplete:r,status:null,order:Nb(),applyLocally:i,retryCount:0,unwatcher:s,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},l=tm(t,e,void 0);o.currentInputSnapshot=l;const c=o.update(l.val());if(c===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{gc("transaction failed: Data returned ",c,o.path),o.status=0;const d=pf(t.transactionQueueTree_,e),u=qi(d)||[];u.push(o),Q0(d,u);let p;typeof c=="object"&&c!==null&&Dr(c,".priority")?(p=Bi(c,".priority"),ge(Z0(p),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):p=(ff(t.serverSyncTree_,e)||Xe.EMPTY_NODE).getPriority().val();const f=mc(t),b=zt(c,p),I=K0(b,l,f);o.currentOutputSnapshotRaw=b,o.currentOutputSnapshotResolved=I,o.currentWriteId=yf(t);const k=z0(t.serverSyncTree_,e,I,o.currentWriteId,o.applyLocally);tr(t.eventQueue_,e,k),vf(t,t.transactionQueueTree_)}}function tm(t,e,n){return ff(t.serverSyncTree_,e,n)||Xe.EMPTY_NODE}function vf(t,e=t.transactionQueueTree_){if(e||xf(t,e),qi(e)){const n=UE(t,e);ge(n.length>0,"Sending zero length transaction queue"),n.every(s=>s.status===0)&&SA(t,pc(e),n)}else PE(e)&&gf(e,n=>{vf(t,n)})}function SA(t,e,n){const r=n.map(d=>d.currentWriteId),s=tm(t,e,r);let i=s;const o=s.hash();for(let d=0;d<n.length;d++){const u=n[d];ge(u.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;const p=Rn(e,u.path);i=i.updateChild(p,u.currentOutputSnapshotRaw)}const l=i.val(!0),c=e;t.server_.put(c.toString(),l,d=>{ya(t,"transaction put response",{path:c.toString(),status:d});let u=[];if(d==="ok"){const p=[];for(let f=0;f<n.length;f++)n[f].status=2,u=u.concat(zs(t.serverSyncTree_,n[f].currentWriteId)),n[f].onComplete&&p.push(()=>n[f].onComplete(null,!0,n[f].currentOutputSnapshotResolved)),n[f].unwatcher();xf(t,pf(t.transactionQueueTree_,e)),vf(t,t.transactionQueueTree_),tr(t.eventQueue_,e,u);for(let f=0;f<p.length;f++)pa(p[f])}else{if(d==="datastale")for(let p=0;p<n.length;p++)n[p].status===3?n[p].status=4:n[p].status=0;else{Pn("transaction at "+c.toString()+" failed: "+d);for(let p=0;p<n.length;p++)n[p].status=4,n[p].abortReason=d}ia(t,e)}},o)}function ia(t,e){const n=FE(t,e),r=pc(n),s=UE(t,n);return TA(t,s,r),r}function TA(t,e,n){if(e.length===0)return;const r=[];let s=[];const o=e.filter(l=>l.status===0).map(l=>l.currentWriteId);for(let l=0;l<e.length;l++){const c=e[l],d=Rn(n,c.path);let u=!1,p;if(ge(d!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)u=!0,p=c.abortReason,s=s.concat(zs(t.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=lA)u=!0,p="maxretry",s=s.concat(zs(t.serverSyncTree_,c.currentWriteId,!0));else{const f=tm(t,c.path,o);c.currentInputSnapshot=f;const b=e[l].update(f.val());if(b!==void 0){gc("transaction failed: Data returned ",b,c.path);let I=zt(b);typeof b=="object"&&b!=null&&Dr(b,".priority")||(I=I.updatePriority(f.getPriority()));const F=c.currentWriteId,x=mc(t),v=K0(I,f,x);c.currentOutputSnapshotRaw=I,c.currentOutputSnapshotResolved=v,c.currentWriteId=yf(t),o.splice(o.indexOf(F),1),s=s.concat(z0(t.serverSyncTree_,c.path,v,c.currentWriteId,c.applyLocally)),s=s.concat(zs(t.serverSyncTree_,F,!0))}else u=!0,p="nodata",s=s.concat(zs(t.serverSyncTree_,c.currentWriteId,!0))}tr(t.eventQueue_,n,s),s=[],u&&(e[l].status=2,function(f){setTimeout(f,Math.floor(0))}(e[l].unwatcher),e[l].onComplete&&(p==="nodata"?r.push(()=>e[l].onComplete(null,!1,e[l].currentInputSnapshot)):r.push(()=>e[l].onComplete(new Error(p),!1,null))))}xf(t,t.transactionQueueTree_);for(let l=0;l<r.length;l++)pa(r[l]);vf(t,t.transactionQueueTree_)}function FE(t,e){let n,r=t.transactionQueueTree_;for(n=ut(e);n!==null&&qi(r)===void 0;)r=pf(r,n),e=At(e),n=ut(e);return r}function UE(t,e){const n=[];return BE(t,e,n),n.sort((r,s)=>r.order-s.order),n}function BE(t,e,n){const r=qi(e);if(r)for(let s=0;s<r.length;s++)n.push(r[s]);gf(e,s=>{BE(t,s,n)})}function xf(t,e){const n=qi(e);if(n){let r=0;for(let s=0;s<n.length;s++)n[s].status!==2&&(n[r]=n[s],r++);n.length=r,Q0(e,n.length>0?n:void 0)}gf(e,r=>{xf(t,r)})}function nm(t,e){const n=pc(FE(t,e)),r=pf(t.transactionQueueTree_,e);return JR(r,s=>{Uh(t,s)}),Uh(t,r),OE(r,s=>{Uh(t,s)}),n}function Uh(t,e){const n=qi(e);if(n){const r=[];let s=[],i=-1;for(let o=0;o<n.length;o++)n[o].status===3||(n[o].status===1?(ge(i===o-1,"All SENT items should be at beginning of queue."),i=o,n[o].status=3,n[o].abortReason="set"):(ge(n[o].status===0,"Unexpected transaction status in abort"),n[o].unwatcher(),s=s.concat(zs(t.serverSyncTree_,n[o].currentWriteId,!0)),n[o].onComplete&&r.push(n[o].onComplete.bind(null,new Error("set"),!1,null))));i===-1?Q0(e,void 0):n.length=i+1,tr(t.eventQueue_,pc(e),s);for(let o=0;o<r.length;o++)pa(r[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IA(t){let e="";const n=t.split("/");for(let r=0;r<n.length;r++)if(n[r].length>0){let s=n[r];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function wA(t){const e={};t.charAt(0)==="?"&&(t=t.substring(1));for(const n of t.split("&")){if(n.length===0)continue;const r=n.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):Pn(`Invalid query segment '${n}' in query '${t}'`)}return e}const ax=function(t,e){const n=CA(t),r=n.namespace;n.domain==="firebase.com"&&ys(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&n.domain!=="localhost"&&ys("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||LC();const s=n.scheme==="ws"||n.scheme==="wss";return{repoInfo:new Xb(n.host,n.secure,r,s,e,"",r!==n.subdomain),path:new wt(n.pathString)}},CA=function(t){let e="",n="",r="",s="",i="",o=!0,l="https",c=443;if(typeof t=="string"){let d=t.indexOf("//");d>=0&&(l=t.substring(0,d-1),t=t.substring(d+2));let u=t.indexOf("/");u===-1&&(u=t.length);let p=t.indexOf("?");p===-1&&(p=t.length),e=t.substring(0,Math.min(u,p)),u<p&&(s=IA(t.substring(u,p)));const f=wA(t.substring(Math.min(t.length,p)));d=e.indexOf(":"),d>=0?(o=l==="https"||l==="wss",c=parseInt(e.substring(d+1),10)):d=e.length;const b=e.slice(0,d);if(b.toLowerCase()==="localhost")n="localhost";else if(b.split(".").length<=2)n=b;else{const I=e.indexOf(".");r=e.substring(0,I).toLowerCase(),n=e.substring(I+1),i=r}"ns"in f&&(i=f.ns)}return{host:e,port:c,domain:n,subdomain:r,secure:o,scheme:l,pathString:s,namespace:i}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lx="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",kA=function(){let t=0;const e=[];return function(n){const r=n===t;t=n;let s;const i=new Array(8);for(s=7;s>=0;s--)i[s]=lx.charAt(n%64),n=Math.floor(n/64);ge(n===0,"Cannot push at time == 0");let o=i.join("");if(r){for(s=11;s>=0&&e[s]===63;s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)o+=lx.charAt(e[s]);return ge(o.length===20,"nextPushId: Length should be 20."),o}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RA{constructor(e,n,r,s){this.eventType=e,this.eventRegistration=n,this.snapshot=r,this.prevName=s}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Zt(this.snapshot.exportVal())}}class AA{constructor(e,n,r){this.eventRegistration=e,this.error=n,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zE{constructor(e,n){this.snapshotCallback=e,this.cancelCallback=n}onValue(e,n){this.snapshotCallback.call(null,e,n)}onCancel(e){return ge(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PA{constructor(e,n){this._repo=e,this._path=n}cancel(){const e=new Ir;return mA(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Hs("OnDisconnect.remove",this._path);const e=new Ir;return ox(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Hs("OnDisconnect.set",this._path),Du("OnDisconnect.set",e,this._path,!1);const n=new Ir;return ox(this._repo,this._path,e,n.wrapCallback(()=>{})),n.promise}setWithPriority(e,n){Hs("OnDisconnect.setWithPriority",this._path),Du("OnDisconnect.setWithPriority",e,this._path,!1),nA("OnDisconnect.setWithPriority",n);const r=new Ir;return yA(this._repo,this._path,e,n,r.wrapCallback(()=>{})),r.promise}update(e){Hs("OnDisconnect.update",this._path),DE("OnDisconnect.update",e,this._path);const n=new Ir;return vA(this._repo,this._path,e,n.wrapCallback(()=>{})),n.promise}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rm{constructor(e,n,r,s){this._repo=e,this._path=n,this._queryParams=r,this._orderByCalled=s}get key(){return ht(this._path)?null:R0(this._path)}get ref(){return new Vr(this._repo,this._path)}get _queryIdentifier(){const e=Vv(this._queryParams),n=I0(e);return n==="{}"?"default":n}get _queryObject(){return Vv(this._queryParams)}isEqual(e){if(e=tn(e),!(e instanceof rm))return!1;const n=this._repo===e._repo,r=A0(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return n&&r&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+mk(this._path)}}class Vr extends rm{constructor(e,n){super(e,n,new D0,!1)}get parent(){const e=sE(this._path);return e===null?null:new Vr(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class oa{constructor(e,n,r){this._node=e,this.ref=n,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const n=new wt(e),r=Zl(this.ref,e);return new oa(this._node.getChild(n),r,Ut)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,s)=>e(new oa(s,Zl(this.ref,r),Ut)))}hasChild(e){const n=new wt(e);return!this._node.getChild(n).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Ur(t,e){return t=tn(t),t._checkNotDeleted("ref"),e!==void 0?Zl(t._root,e):t._root}function Zl(t,e){return t=tn(t),ut(t._path)===null?rA("child","path",e):ME("child","path",e),new Vr(t._repo,Ht(t._path,e))}function OA(t){return t=tn(t),new PA(t._repo,t._path)}function LA(t,e){t=tn(t),Hs("push",t._path),Du("push",e,t._path,!0);const n=$E(t._repo),r=kA(n),s=Zl(t,r),i=Zl(t,r);let o;return o=Promise.resolve(i),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function hd(t){return Hs("remove",t._path),_f(t,null)}function _f(t,e){t=tn(t),Hs("set",t._path),Du("set",e,t._path,!1);const n=new Ir;return hA(t._repo,t._path,e,null,n.wrapCallback(()=>{})),n.promise}function sm(t,e){DE("update",e,t._path);const n=new Ir;return pA(t._repo,t._path,e,n.wrapCallback(()=>{})),n.promise}function bf(t){t=tn(t);const e=new zE(()=>{}),n=new Ef(e);return fA(t._repo,t,n).then(r=>new oa(r,new Vr(t._repo,t._path),t._queryParams.getIndex()))}class Ef{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,n){const r=n._queryParams.getIndex();return new RA("value",this,new oa(e.snapshotNode,new Vr(n._repo,n._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new AA(this,e,n):null}matches(e){return e instanceof Ef?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function DA(t,e,n,r,s){const i=new zE(n,void 0),o=new Ef(i);return xA(t._repo,t,o),()=>_A(t._repo,t,o)}function HE(t,e,n,r){return DA(t,"value",e)}kR(Vr);LR(Vr);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MA="FIREBASE_DATABASE_EMULATOR_HOST",rg={};let NA=!1;function jA(t,e,n,r){const s=e.lastIndexOf(":"),i=e.substring(0,s),o=ua(i);t.repoInfo_=new Xb(e,o,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0,n),r&&(t.authTokenProvider_=r)}function $A(t,e,n,r,s){let i=r||t.options.databaseURL;i===void 0&&(t.options.projectId||ys("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),an("Using default host for project ",t.options.projectId),i=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o=ax(i,s),l=o.repoInfo,c;typeof process<"u"&&kv&&(c=kv[MA]),c?(i=`http://${c}?ns=${l.namespace}`,o=ax(i,s),l=o.repoInfo):o.repoInfo.secure;const d=new WC(t.name,t.options,e);sA("Invalid Firebase Database URL",o),ht(o.path)||ys("Database URL must point to the root of a Firebase Database (not including a child path).");const u=UA(l,t,d,new HC(t,n));return new BA(u,t)}function FA(t,e){const n=rg[e];(!n||n[t.key]!==t)&&ys(`Database ${e}(${t.repoInfo_}) has already been deleted.`),bA(t),delete n[t.key]}function UA(t,e,n,r){let s=rg[e.name];s||(s={},rg[e.name]=s);let i=s[t.toURLString()];return i&&ys("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new cA(t,NA,n,r),s[t.toURLString()]=i,i}class BA{constructor(e,n){this._repoInternal=e,this.app=n,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(dA(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Vr(this._repo,_t())),this._rootInternal}_delete(){return this._rootInternal!==null&&(FA(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&ys("Cannot call "+e+" on a deleted database.")}}function zA(t=Pb(),e){const n=T0(t,"database").getImmediate({identifier:e});if(!n._instanceStarted){const r=qw("database");r&&HA(n,...r)}return n}function HA(t,e,n,r={}){t=tn(t),t._checkNotDeleted("useEmulator");const s=`${e}:${n}`,i=t._repoInternal;if(t._instanceStarted){if(s===t._repoInternal.repoInfo_.host&&zi(r,i.repoInfo_.emulatorOptions))return;ys("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&ys('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new Dd(Dd.OWNER);else if(r.mockUserToken){const l=typeof r.mockUserToken=="string"?r.mockUserToken:Zw(r.mockUserToken,t.app.options.projectId);o=new Dd(l)}ua(e)&&(Tb(e),Ib("Database",!0)),jA(i,s,r,o)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WA(t){kC(ha),ea(new Hi("database",(e,{instanceIdentifier:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return $A(r,s,i,n)},"PUBLIC").setMultipleInstances(!0)),ti(Rv,Av,t),ti(Rv,Av,"esm2020")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GA{constructor(e,n){this.committed=e,this.snapshot=n}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function VA(t,e,n){if(t=tn(t),Hs("Reference.transaction",t._path),t.key===".length"||t.key===".keys")throw"Reference.transaction failed: "+t.key+" is a read-only object.";const r=!0,s=new Ir,i=(l,c,d)=>{let u=null;l?s.reject(l):(u=new oa(d,new Vr(t._repo,t._path),Ut),s.resolve(new GA(c,u)))},o=HE(t,()=>{});return EA(t._repo,t._path,e,i,o,r),s.promise}ds.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};ds.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};WA();function WE(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const YA=WE,GE=new cc("auth","Firebase",WE());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mu=new E0("@firebase/auth");function KA(t,...e){Mu.logLevel<=kt.WARN&&Mu.warn(`Auth (${ha}): ${t}`,...e)}function Md(t,...e){Mu.logLevel<=kt.ERROR&&Mu.error(`Auth (${ha}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lr(t,...e){throw im(t,...e)}function Wr(t,...e){return im(t,...e)}function VE(t,e,n){const r={...YA(),[e]:n};return new cc("auth","Firebase",r).create(e,{appName:t.name})}function us(t){return VE(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function im(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return GE.create(t,...e)}function Ke(t,e,...n){if(!t)throw im(e,...n)}function as(t){const e="INTERNAL ASSERTION FAILED: "+t;throw Md(e),new Error(e)}function vs(t,e){t||as(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sg(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.href)||""}function XA(){return cx()==="http:"||cx()==="https:"}function cx(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JA(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(XA()||r5()||"connection"in navigator)?navigator.onLine:!0}function QA(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yc{constructor(e,n){this.shortDelay=e,this.longDelay=n,vs(n>e,"Short delay should be less than long delay!"),this.isMobile=b0()||wb()}get(){return JA()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function om(t,e){vs(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YE{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;as("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;as("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;as("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qA={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZA=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],eP=new yc(3e4,6e4);function mi(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function yi(t,e,n,r,s={}){return KE(t,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const l=fa({key:t.config.apiKey,...o}).slice(1),c=await t._getAdditionalHeaders();c["Content-Type"]="application/json",t.languageCode&&(c["X-Firebase-Locale"]=t.languageCode);const d={method:e,headers:c,...i};return n5()||(d.referrerPolicy="no-referrer"),t.emulatorConfig&&ua(t.emulatorConfig.host)&&(d.credentials="include"),YE.fetch()(await XE(t,t.config.apiHost,n,l),d)})}async function KE(t,e,n){t._canInitEmulator=!1;const r={...qA,...e};try{const s=new nP(t),i=await Promise.race([n(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw pd(t,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const l=i.ok?o.errorMessage:o.error.message,[c,d]=l.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw pd(t,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw pd(t,"email-already-in-use",o);if(c==="USER_DISABLED")throw pd(t,"user-disabled",o);const u=r[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw VE(t,u,d);Lr(t,u)}}catch(s){if(s instanceof gi)throw s;Lr(t,"network-request-failed",{message:String(s)})}}async function vc(t,e,n,r,s={}){const i=await yi(t,e,n,r,s);return"mfaPendingCredential"in i&&Lr(t,"multi-factor-auth-required",{_serverResponse:i}),i}async function XE(t,e,n,r){const s=`${e}${n}?${r}`,i=t,o=i.config.emulator?om(t.config,s):`${t.config.apiScheme}://${s}`;return ZA.includes(n)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(o).toString():o}function tP(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class nP{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(Wr(this.auth,"network-request-failed")),eP.get())})}}function pd(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=Wr(t,e,r);return s.customData._tokenResponse=n,s}function dx(t){return t!==void 0&&t.enterprise!==void 0}class rP{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return tP(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function sP(t,e){return yi(t,"GET","/v2/recaptchaConfig",mi(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iP(t,e){return yi(t,"POST","/v1/accounts:delete",e)}async function Nu(t,e){return yi(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function El(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function oP(t,e=!1){const n=tn(t),r=await n.getIdToken(e),s=am(r);Ke(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:El(Bh(s.auth_time)),issuedAtTime:El(Bh(s.iat)),expirationTime:El(Bh(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Bh(t){return Number(t)*1e3}function am(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return Md("JWT malformed, contained fewer than 3 sections"),null;try{const s=yu(n);return s?JSON.parse(s):(Md("Failed to decode base64 JWT payload"),null)}catch(s){return Md("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function ux(t){const e=am(t);return Ke(e,"internal-error"),Ke(typeof e.exp<"u","internal-error"),Ke(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ec(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof gi&&aP(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function aP({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lP{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ig{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=El(this.lastLoginAt),this.creationTime=El(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tc(t){var p;const e=t.auth,n=await t.getIdToken(),r=await ec(t,Nu(e,{idToken:n}));Ke(r==null?void 0:r.users.length,e,"internal-error");const s=r.users[0];t._notifyReloadListener(s);const i=(p=s.providerUserInfo)!=null&&p.length?JE(s.providerUserInfo):[],o=dP(t.providerData,i),l=t.isAnonymous,c=!(t.email&&s.passwordHash)&&!(o!=null&&o.length),d=l?c:!1,u={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new ig(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(t,u)}async function cP(t){const e=tn(t);await tc(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function dP(t,e){return[...t.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function JE(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uP(t,e){const n=await KE(t,{},async()=>{const r=fa({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=t.config,o=await XE(t,s,"/v1/token",`key=${i}`),l=await t._getAdditionalHeaders();l["Content-Type"]="application/x-www-form-urlencoded";const c={method:"POST",headers:l,body:r};return t.emulatorConfig&&ua(t.emulatorConfig.host)&&(c.credentials="include"),YE.fetch()(o,c)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function fP(t,e){return yi(t,"POST","/v2/accounts:revokeToken",mi(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bo{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ke(e.idToken,"internal-error"),Ke(typeof e.idToken<"u","internal-error"),Ke(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):ux(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){Ke(e.length!==0,"internal-error");const n=ux(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(Ke(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:s,expiresIn:i}=await uP(e,n);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:s,expirationTime:i}=n,o=new Bo;return r&&(Ke(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(Ke(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(Ke(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Bo,this.toJSON())}_performRefresh(){return as("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ps(t,e){Ke(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class kr{constructor({uid:e,auth:n,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new lP(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new ig(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const n=await ec(this,this.stsTokenManager.getToken(this.auth,e));return Ke(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return oP(this,e)}reload(){return cP(this)}_assign(e){this!==e&&(Ke(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new kr({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){Ke(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await tc(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(ur(this.auth.app))return Promise.reject(us(this.auth));const e=await this.getIdToken();return await ec(this,iP(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const r=n.displayName??void 0,s=n.email??void 0,i=n.phoneNumber??void 0,o=n.photoURL??void 0,l=n.tenantId??void 0,c=n._redirectEventId??void 0,d=n.createdAt??void 0,u=n.lastLoginAt??void 0,{uid:p,emailVerified:f,isAnonymous:b,providerData:I,stsTokenManager:k}=n;Ke(p&&k,e,"internal-error");const F=Bo.fromJSON(this.name,k);Ke(typeof p=="string",e,"internal-error"),Ps(r,e.name),Ps(s,e.name),Ke(typeof f=="boolean",e,"internal-error"),Ke(typeof b=="boolean",e,"internal-error"),Ps(i,e.name),Ps(o,e.name),Ps(l,e.name),Ps(c,e.name),Ps(d,e.name),Ps(u,e.name);const x=new kr({uid:p,auth:e,email:s,emailVerified:f,displayName:r,isAnonymous:b,photoURL:o,phoneNumber:i,tenantId:l,stsTokenManager:F,createdAt:d,lastLoginAt:u});return I&&Array.isArray(I)&&(x.providerData=I.map(v=>({...v}))),c&&(x._redirectEventId=c),x}static async _fromIdTokenResponse(e,n,r=!1){const s=new Bo;s.updateFromServerResponse(n);const i=new kr({uid:n.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await tc(i),i}static async _fromGetAccountInfoResponse(e,n,r){const s=n.users[0];Ke(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?JE(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),l=new Bo;l.updateFromIdToken(r);const c=new kr({uid:s.localId,auth:e,stsTokenManager:l,isAnonymous:o}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new ig(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(c,d),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fx=new Map;function ls(t){vs(t instanceof Function,"Expected a class definition");let e=fx.get(t);return e?(vs(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,fx.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QE{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}QE.type="NONE";const hx=QE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nd(t,e,n){return`firebase:${t}:${e}:${n}`}class zo{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=Nd(this.userKey,s.apiKey,i),this.fullPersistenceKey=Nd("persistence",s.apiKey,i),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await Nu(this.auth,{idToken:e}).catch(()=>{});return n?kr._fromGetAccountInfoResponse(this.auth,n,e):null}return kr._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new zo(ls(hx),e,r);const s=(await Promise.all(n.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let i=s[0]||ls(hx);const o=Nd(r,e.config.apiKey,e.name);let l=null;for(const d of n)try{const u=await d._get(o);if(u){let p;if(typeof u=="string"){const f=await Nu(e,{idToken:u}).catch(()=>{});if(!f)break;p=await kr._fromGetAccountInfoResponse(e,f,u)}else p=kr._fromJSON(e,u);d!==i&&(l=p),i=d;break}}catch{}const c=s.filter(d=>d._shouldAllowMigration);return!i._shouldAllowMigration||!c.length?new zo(i,e,r):(i=c[0],l&&await i._set(o,l.toJSON()),await Promise.all(n.map(async d=>{if(d!==i)try{await d._remove(o)}catch{}})),new zo(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function px(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(tS(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(qE(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(rS(e))return"Blackberry";if(sS(e))return"Webos";if(ZE(e))return"Safari";if((e.includes("chrome/")||eS(e))&&!e.includes("edge/"))return"Chrome";if(nS(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function qE(t=On()){return/firefox\//i.test(t)}function ZE(t=On()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function eS(t=On()){return/crios\//i.test(t)}function tS(t=On()){return/iemobile/i.test(t)}function nS(t=On()){return/android/i.test(t)}function rS(t=On()){return/blackberry/i.test(t)}function sS(t=On()){return/webos/i.test(t)}function lm(t=On()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function hP(t=On()){var e;return lm(t)&&!!((e=window.navigator)!=null&&e.standalone)}function pP(){return s5()&&document.documentMode===10}function iS(t=On()){return lm(t)||nS(t)||sS(t)||rS(t)||/windows phone/i.test(t)||tS(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oS(t,e=[]){let n;switch(t){case"Browser":n=px(On());break;case"Worker":n=`${px(On())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${ha}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gP{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=i=>new Promise((o,l)=>{try{const c=e(i);o(c)}catch(c){l(c)}});r.onAbort=n,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const s of n)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mP(t,e={}){return yi(t,"GET","/v2/passwordPolicy",mi(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yP=6;class vP{constructor(e){var r;const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??yP,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((r=e.allowedNonAlphanumericCharacters)==null?void 0:r.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),s&&(n.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xP{constructor(e,n,r,s){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new gx(this),this.idTokenSubscription=new gx(this),this.beforeStateQueue=new gP(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=GE,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=ls(n)),this._initializationPromise=this.queue(async()=>{var r,s,i;if(!this._deleted&&(this.persistenceManager=await zo.create(this,e),(r=this._resolvePersistenceManagerAvailable)==null||r.call(this),!this._deleted)){if((s=this._popupRedirectResolver)!=null&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((i=this.currentUser)==null?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await Nu(this,{idToken:e}),r=await kr._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(ur(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(l,l))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(i=this.redirectUser)==null?void 0:i._redirectEventId,l=r==null?void 0:r._redirectEventId,c=await this.tryRedirectSignIn(e);(!o||o===l)&&(c!=null&&c.user)&&(r=c.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Ke(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await tc(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=QA()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(ur(this.app))return Promise.reject(us(this));const n=e?tn(e):null;return n&&Ke(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&Ke(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return ur(this.app)?Promise.reject(us(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return ur(this.app)?Promise.reject(us(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(ls(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await mP(this),n=new vP(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new cc("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await fP(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&ls(e)||this._popupRedirectResolver;Ke(n,this,"argument-error"),this.redirectPersistenceManager=await zo.create(this,[ls(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)==null?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)==null?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((n=this.currentUser)==null?void 0:n.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,s){if(this._deleted)return()=>{};const i=typeof n=="function"?n:n.next.bind(n);let o=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ke(l,this,"internal-error"),l.then(()=>{o||i(this.currentUser)}),typeof n=="function"){const c=e.addObserver(n,r,s);return()=>{o=!0,c()}}else{const c=e.addObserver(n);return()=>{o=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ke(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=oS(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var s;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await((s=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getHeartbeatsHeader());n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var n;if(ur(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((n=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:n.getToken());return e!=null&&e.error&&KA(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function Zi(t){return tn(t)}class gx{constructor(e){this.auth=e,this.observer=null,this.addObserver=p5(n=>this.observer=n)}get next(){return Ke(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Sf={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function _P(t){Sf=t}function aS(t){return Sf.loadJS(t)}function bP(){return Sf.recaptchaEnterpriseScript}function EP(){return Sf.gapiScript}function SP(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class TP{constructor(){this.enterprise=new IP}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class IP{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const wP="recaptcha-enterprise",lS="NO_RECAPTCHA";class CP{constructor(e){this.type=wP,this.auth=Zi(e)}async verify(e="verify",n=!1){async function r(i){if(!n){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,l)=>{sP(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const d=new rP(c);return i.tenantId==null?i._agentRecaptchaConfig=d:i._tenantRecaptchaConfigs[i.tenantId]=d,o(d.siteKey)}}).catch(c=>{l(c)})})}function s(i,o,l){const c=window.grecaptcha;dx(c)?c.enterprise.ready(()=>{c.enterprise.execute(i,{action:e}).then(d=>{o(d)}).catch(()=>{o(lS)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new TP().execute("siteKey",{action:"verify"}):new Promise((i,o)=>{r(this.auth).then(l=>{if(!n&&dx(window.grecaptcha))s(l,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let c=bP();c.length!==0&&(c+=l),aS(c).then(()=>{s(l,i,o)}).catch(d=>{o(d)})}}).catch(l=>{o(l)})})}}async function mx(t,e,n,r=!1,s=!1){const i=new CP(t);let o;if(s)o=lS;else try{o=await i.verify(n)}catch{o=await i.verify(n,!0)}const l={...e};if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in l){const c=l.phoneEnrollmentInfo.phoneNumber,d=l.phoneEnrollmentInfo.recaptchaToken;Object.assign(l,{phoneEnrollmentInfo:{phoneNumber:c,recaptchaToken:d,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in l){const c=l.phoneSignInInfo.recaptchaToken;Object.assign(l,{phoneSignInInfo:{recaptchaToken:c,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return l}return r?Object.assign(l,{captchaResp:o}):Object.assign(l,{captchaResponse:o}),Object.assign(l,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(l,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),l}async function yx(t,e,n,r,s){var i;if((i=t._getRecaptchaConfig())!=null&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await mx(t,e,n,n==="getOobCode");return r(t,o)}else return r(t,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await mx(t,e,n,n==="getOobCode");return r(t,l)}else return Promise.reject(o)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kP(t,e){const n=T0(t,"auth");if(n.isInitialized()){const s=n.getImmediate(),i=n.getOptions();if(zi(i,e??{}))return s;Lr(s,"already-initialized")}return n.initialize({options:e})}function RP(t,e){const n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(ls);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function AP(t,e,n){const r=Zi(t);Ke(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,i=cS(e),{host:o,port:l}=PP(e),c=l===null?"":`:${l}`,d={url:`${i}//${o}${c}/`},u=Object.freeze({host:o,port:l,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){Ke(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),Ke(zi(d,r.config.emulator)&&zi(u,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=d,r.emulatorConfig=u,r.settings.appVerificationDisabledForTesting=!0,ua(o)?(Tb(`${i}//${o}${c}`),Ib("Auth",!0)):OP()}function cS(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function PP(t){const e=cS(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:vx(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:vx(o)}}}function vx(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function OP(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cm{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return as("not implemented")}_getIdTokenResponse(e){return as("not implemented")}_linkToIdToken(e,n){return as("not implemented")}_getReauthenticationResolver(e){return as("not implemented")}}async function LP(t,e){return yi(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function DP(t,e){return vc(t,"POST","/v1/accounts:signInWithPassword",mi(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function MP(t,e){return vc(t,"POST","/v1/accounts:signInWithEmailLink",mi(t,e))}async function NP(t,e){return vc(t,"POST","/v1/accounts:signInWithEmailLink",mi(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nc extends cm{constructor(e,n,r,s=null){super("password",r),this._email=e,this._password=n,this._tenantId=s}static _fromEmailAndPassword(e,n){return new nc(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new nc(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return yx(e,n,"signInWithPassword",DP);case"emailLink":return MP(e,{email:this._email,oobCode:this._password});default:Lr(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return yx(e,r,"signUpPassword",LP);case"emailLink":return NP(e,{idToken:n,email:this._email,oobCode:this._password});default:Lr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ho(t,e){return vc(t,"POST","/v1/accounts:signInWithIdp",mi(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jP="http://localhost";class Yi extends cm{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Yi(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):Lr("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=n;if(!r||!s)return null;const o=new Yi(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const n=this.buildRequest();return Ho(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,Ho(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,Ho(e,n)}buildRequest(){const e={requestUri:jP,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=fa(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $P(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function FP(t){const e=sl(il(t)).link,n=e?sl(il(e)).deep_link_id:null,r=sl(il(t)).deep_link_id;return(r?sl(il(r)).link:null)||r||n||e||t}class dm{constructor(e){const n=sl(il(e)),r=n.apiKey??null,s=n.oobCode??null,i=$P(n.mode??null);Ke(r&&s&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=s,this.continueUrl=n.continueUrl??null,this.languageCode=n.lang??null,this.tenantId=n.tenantId??null}static parseLink(e){const n=FP(e);try{return new dm(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eo{constructor(){this.providerId=eo.PROVIDER_ID}static credential(e,n){return nc._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=dm.parseLink(n);return Ke(r,"argument-error"),nc._fromEmailAndCode(e,r.code,r.tenantId)}}eo.PROVIDER_ID="password";eo.EMAIL_PASSWORD_SIGN_IN_METHOD="password";eo.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dS{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xc extends dS{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ns extends xc{constructor(){super("facebook.com")}static credential(e){return Yi._fromParams({providerId:Ns.PROVIDER_ID,signInMethod:Ns.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ns.credentialFromTaggedObject(e)}static credentialFromError(e){return Ns.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ns.credential(e.oauthAccessToken)}catch{return null}}}Ns.FACEBOOK_SIGN_IN_METHOD="facebook.com";Ns.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class js extends xc{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Yi._fromParams({providerId:js.PROVIDER_ID,signInMethod:js.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return js.credentialFromTaggedObject(e)}static credentialFromError(e){return js.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return js.credential(n,r)}catch{return null}}}js.GOOGLE_SIGN_IN_METHOD="google.com";js.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $s extends xc{constructor(){super("github.com")}static credential(e){return Yi._fromParams({providerId:$s.PROVIDER_ID,signInMethod:$s.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return $s.credentialFromTaggedObject(e)}static credentialFromError(e){return $s.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return $s.credential(e.oauthAccessToken)}catch{return null}}}$s.GITHUB_SIGN_IN_METHOD="github.com";$s.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fs extends xc{constructor(){super("twitter.com")}static credential(e,n){return Yi._fromParams({providerId:Fs.PROVIDER_ID,signInMethod:Fs.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return Fs.credentialFromTaggedObject(e)}static credentialFromError(e){return Fs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return Fs.credential(n,r)}catch{return null}}}Fs.TWITTER_SIGN_IN_METHOD="twitter.com";Fs.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function UP(t,e){return vc(t,"POST","/v1/accounts:signUp",mi(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ui{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,s=!1){const i=await kr._fromIdTokenResponse(e,r,s),o=xx(r);return new ui({user:i,providerId:o,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const s=xx(r);return new ui({user:e,providerId:s,_tokenResponse:r,operationType:n})}}function xx(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BP(t){var s;if(ur(t.app))return Promise.reject(us(t));const e=Zi(t);if(await e._initializationPromise,(s=e.currentUser)!=null&&s.isAnonymous)return new ui({user:e.currentUser,providerId:null,operationType:"signIn"});const n=await UP(e,{returnSecureToken:!0}),r=await ui._fromIdTokenResponse(e,"signIn",n,!0);return await e._updateCurrentUser(r.user),r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ju extends gi{constructor(e,n,r,s){super(n.code,n.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,ju.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,s){return new ju(e,n,r,s)}}function uS(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?ju._fromErrorAndOperation(t,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zP(t){return new Set(t.map(({providerId:e})=>e).filter(e=>!!e))}async function fS(t,e,n=!1){const r=await ec(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return ui._forOperation(t,"link",r)}async function HP(t,e,n){await tc(e);const r=zP(e.providerData);Ke(r.has(n)===t,e.auth,"provider-already-linked")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function WP(t,e,n=!1){const{auth:r}=t;if(ur(r.app))return Promise.reject(us(r));const s="reauthenticate";try{const i=await ec(t,uS(r,s,e,t),n);Ke(i.idToken,r,"internal-error");const o=am(i.idToken);Ke(o,r,"internal-error");const{sub:l}=o;return Ke(t.uid===l,r,"user-mismatch"),ui._forOperation(t,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Lr(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hS(t,e,n=!1){if(ur(t.app))return Promise.reject(us(t));const r="signIn",s=await uS(t,r,e),i=await ui._fromIdTokenResponse(t,r,s);return n||await t._updateCurrentUser(i.user),i}async function GP(t,e){return hS(Zi(t),e)}async function VP(t,e){const n=tn(t);return await HP(!1,n,e.providerId),fS(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YP(t){const e=Zi(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}function KP(t,e,n){return ur(t.app)?Promise.reject(us(t)):GP(tn(t),eo.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&YP(t),r})}function XP(t,e,n,r){return tn(t).onIdTokenChanged(e,n,r)}function JP(t,e,n){return tn(t).beforeAuthStateChanged(e,n)}function QP(t,e,n,r){return tn(t).onAuthStateChanged(e,n,r)}function qP(t){return tn(t).signOut()}const $u="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pS{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem($u,"1"),this.storage.removeItem($u),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZP=1e3,eO=10;class gS extends pS{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=iS(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),s=this.localCache[n];r!==s&&e(n,s,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((o,l,c)=>{this.notifyListeners(o,c)});return}const r=e.key;n?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!n&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);pP()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,eO):s()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},ZP)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}gS.type="LOCAL";const tO=gS;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mS extends pS{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}mS.type="SESSION";const yS=mS;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nO(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tf{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(s=>s.isListeningto(e));if(n)return n;const r=new Tf(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:s,data:i}=n.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const l=Array.from(o).map(async d=>d(n.origin,i)),c=await nO(l);n.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:c})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Tf.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function um(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rO{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((l,c)=>{const d=um("",20);s.port1.start();const u=setTimeout(()=>{c(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(p){const f=p;if(f.data.eventId===d)switch(f.data.status){case"ack":clearTimeout(u),i=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),l(f.data.response);break;default:clearTimeout(u),clearTimeout(i),c(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:d,data:n},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gr(){return window}function sO(t){Gr().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vS(){return typeof Gr().WorkerGlobalScope<"u"&&typeof Gr().importScripts=="function"}async function iO(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function oO(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)==null?void 0:t.controller)||null}function aO(){return vS()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xS="firebaseLocalStorageDb",lO=1,Fu="firebaseLocalStorage",_S="fbase_key";class _c{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function If(t,e){return t.transaction([Fu],e?"readwrite":"readonly").objectStore(Fu)}function cO(){const t=indexedDB.deleteDatabase(xS);return new _c(t).toPromise()}function og(){const t=indexedDB.open(xS,lO);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(Fu,{keyPath:_S})}catch(s){n(s)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(Fu)?e(r):(r.close(),await cO(),e(await og()))})})}async function _x(t,e,n){const r=If(t,!0).put({[_S]:e,value:n});return new _c(r).toPromise()}async function dO(t,e){const n=If(t,!1).get(e),r=await new _c(n).toPromise();return r===void 0?null:r.value}function bx(t,e){const n=If(t,!0).delete(e);return new _c(n).toPromise()}const uO=800,fO=3;class bS{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await og(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>fO)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return vS()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Tf._getInstance(aO()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var n,r;if(this.activeServiceWorker=await iO(),!this.activeServiceWorker)return;this.sender=new rO(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(n=e[0])!=null&&n.fulfilled&&(r=e[0])!=null&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||oO()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await og();return await _x(e,$u,"1"),await bx(e,$u),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>_x(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>dO(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>bx(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=If(s,!1).getAll();return new _c(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),n.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),n.push(s));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),uO)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}bS.type="LOCAL";const hO=bS;new yc(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pO(t,e){return e?ls(e):(Ke(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fm extends cm{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ho(e,this._buildIdpRequest())}_linkToIdToken(e,n){return Ho(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return Ho(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function gO(t){return hS(t.auth,new fm(t),t.bypassAuthState)}function mO(t){const{auth:e,user:n}=t;return Ke(n,e,"internal-error"),WP(n,new fm(t),t.bypassAuthState)}async function yO(t){const{auth:e,user:n}=t;return Ke(n,e,"internal-error"),fS(n,new fm(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ES{constructor(e,n,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:s,tenantId:i,error:o,type:l}=e;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:n,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(c))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return gO;case"linkViaPopup":case"linkViaRedirect":return yO;case"reauthViaPopup":case"reauthViaRedirect":return mO;default:Lr(this.auth,"internal-error")}}resolve(e){vs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){vs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vO=new yc(2e3,1e4);class Oo extends ES{constructor(e,n,r,s,i){super(e,n,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Oo.currentPopupAction&&Oo.currentPopupAction.cancel(),Oo.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ke(e,this.auth,"internal-error"),e}async onExecution(){vs(this.filter.length===1,"Popup operations only handle one event");const e=um();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Wr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(Wr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Oo.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if((r=(n=this.authWindow)==null?void 0:n.window)!=null&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Wr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,vO.get())};e()}}Oo.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xO="pendingRedirect",jd=new Map;class _O extends ES{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=jd.get(this.auth._key());if(!e){try{const r=await bO(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}jd.set(this.auth._key(),e)}return this.bypassAuthState||jd.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function bO(t,e){const n=TO(e),r=SO(t);if(!await r._isAvailable())return!1;const s=await r._get(n)==="true";return await r._remove(n),s}function EO(t,e){jd.set(t._key(),e)}function SO(t){return ls(t._redirectPersistence)}function TO(t){return Nd(xO,t.config.apiKey,t.name)}async function IO(t,e,n=!1){if(ur(t.app))return Promise.reject(us(t));const r=Zi(t),s=pO(r,e),o=await new _O(r,s,n).execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wO=10*60*1e3;class CO{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!kO(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!SS(e)){const s=((r=e.error.code)==null?void 0:r.split("auth/")[1])||"internal-error";n.onError(Wr(this.auth,s))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=wO&&this.cachedEventUids.clear(),this.cachedEventUids.has(Ex(e))}saveEventToCache(e){this.cachedEventUids.add(Ex(e)),this.lastProcessedEventTime=Date.now()}}function Ex(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function SS({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function kO(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return SS(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function RO(t,e={}){return yi(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AO=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,PO=/^https?/;async function OO(t){if(t.config.emulator)return;const{authorizedDomains:e}=await RO(t);for(const n of e)try{if(LO(n))return}catch{}Lr(t,"unauthorized-domain")}function LO(t){const e=sg(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const o=new URL(t);return o.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&o.hostname===r}if(!PO.test(n))return!1;if(AO.test(t))return r===t;const s=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DO=new yc(3e4,6e4);function Sx(){const t=Gr().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function MO(t){return new Promise((e,n)=>{var s,i,o;function r(){Sx(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Sx(),n(Wr(t,"network-request-failed"))},timeout:DO.get()})}if((i=(s=Gr().gapi)==null?void 0:s.iframes)!=null&&i.Iframe)e(gapi.iframes.getContext());else if((o=Gr().gapi)!=null&&o.load)r();else{const l=SP("iframefcb");return Gr()[l]=()=>{gapi.load?r():n(Wr(t,"network-request-failed"))},aS(`${EP()}?onload=${l}`).catch(c=>n(c))}}).catch(e=>{throw $d=null,e})}let $d=null;function NO(t){return $d=$d||MO(t),$d}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jO=new yc(5e3,15e3),$O="__/auth/iframe",FO="emulator/auth/iframe",UO={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},BO=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function zO(t){const e=t.config;Ke(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?om(e,FO):`https://${t.config.authDomain}/${$O}`,r={apiKey:e.apiKey,appName:t.name,v:ha},s=BO.get(t.config.apiHost);s&&(r.eid=s);const i=t._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${fa(r).slice(1)}`}async function HO(t){const e=await NO(t),n=Gr().gapi;return Ke(n,t,"internal-error"),e.open({where:document.body,url:zO(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:UO,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=Wr(t,"network-request-failed"),l=Gr().setTimeout(()=>{i(o)},jO.get());function c(){Gr().clearTimeout(l),s(r)}r.ping(c).then(c,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WO={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},GO=500,VO=600,YO="_blank",KO="http://localhost";class Tx{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function XO(t,e,n,r=GO,s=VO){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const c={...WO,width:r.toString(),height:s.toString(),top:i,left:o},d=On().toLowerCase();n&&(l=eS(d)?YO:n),qE(d)&&(e=e||KO,c.scrollbars="yes");const u=Object.entries(c).reduce((f,[b,I])=>`${f}${b}=${I},`,"");if(hP(d)&&l!=="_self")return JO(e||"",l),new Tx(null);const p=window.open(e||"",l,u);Ke(p,t,"popup-blocked");try{p.focus()}catch{}return new Tx(p)}function JO(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QO="__/auth/handler",qO="emulator/auth/handler",ZO=encodeURIComponent("fac");async function Ix(t,e,n,r,s,i){Ke(t.config.authDomain,t,"auth-domain-config-required"),Ke(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:ha,eventId:s};if(e instanceof dS){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",vu(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[u,p]of Object.entries({}))o[u]=p}if(e instanceof xc){const u=e.getScopes().filter(p=>p!=="");u.length>0&&(o.scopes=u.join(","))}t.tenantId&&(o.tid=t.tenantId);const l=o;for(const u of Object.keys(l))l[u]===void 0&&delete l[u];const c=await t._getAppCheckToken(),d=c?`#${ZO}=${encodeURIComponent(c)}`:"";return`${eL(t)}?${fa(l).slice(1)}${d}`}function eL({config:t}){return t.emulator?om(t,qO):`https://${t.authDomain}/${QO}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zh="webStorageSupport";class tL{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=yS,this._completeRedirectFn=IO,this._overrideRedirectResult=EO}async _openPopup(e,n,r,s){var o;vs((o=this.eventManagers[e._key()])==null?void 0:o.manager,"_initialize() not called before _openPopup()");const i=await Ix(e,n,r,sg(),s);return XO(e,i,um())}async _openRedirect(e,n,r,s){await this._originValidation(e);const i=await Ix(e,n,r,sg(),s);return sO(i),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:s,promise:i}=this.eventManagers[n];return s?Promise.resolve(s):(vs(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await HO(e),r=new CO(e);return n.register("authEvent",s=>(Ke(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(zh,{type:zh},s=>{var o;const i=(o=s==null?void 0:s[0])==null?void 0:o[zh];i!==void 0&&n(!!i),Lr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=OO(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return iS()||ZE()||lm()}}const nL=tL;var wx="@firebase/auth",Cx="1.12.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rL{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){Ke(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sL(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function iL(t){ea(new Hi("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:l}=r.options;Ke(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:o,authDomain:l,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:oS(t)},d=new xP(r,s,i,c);return RP(d,n),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),ea(new Hi("auth-internal",e=>{const n=Zi(e.getProvider("auth").getImmediate());return(r=>new rL(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),ti(wx,Cx,sL(t)),ti(wx,Cx,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oL=5*60,aL=Sb("authIdTokenMaxAge")||oL;let kx=null;const lL=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>aL)return;const s=n==null?void 0:n.token;kx!==s&&(kx=s,await fetch(t,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function cL(t=Pb()){const e=T0(t,"auth");if(e.isInitialized())return e.getImmediate();const n=kP(t,{popupRedirectResolver:nL,persistence:[hO,tO,yS]}),r=Sb("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=lL(i.toString());JP(n,o,()=>o(n.currentUser)),XP(n,l=>o(l))}}const s=bb("auth");return s&&AP(n,`http://${s}`),n}function dL(){var t;return((t=document.getElementsByTagName("head"))==null?void 0:t[0])??document}_P({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=s=>{const i=Wr("internal-error");i.customData=s,n(i)},r.type="text/javascript",r.charset="UTF-8",dL().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});iL("Browser");const uL={apiKey:"AIzaSyCqXssa5oOaWY3CiN7ti53Qt1F_AGpBrVE",authDomain:"tenfubu-verse.firebaseapp.com",databaseURL:"https://tenfubu-verse-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"tenfubu-verse",storageBucket:"tenfubu-verse.firebasestorage.app",messagingSenderId:"1047996014362",appId:"1:1047996014362:web:729f6b715d929087e296a3"},TS=Ab(uL),Br=zA(TS),bc=cL(TS),Wo=[{rank:"BRONZE",min:0,max:2e3,lossPoints:0},{rank:"SILVER",min:2001,max:4e3,lossPoints:20},{rank:"GOLD",min:4001,max:6e3,lossPoints:40},{rank:"PLATINUM",min:6001,max:8e3,lossPoints:60},{rank:"DIAMOND",min:8001,max:1e4,lossPoints:80},{rank:"MASTER",min:10001,max:1/0,lossPoints:100}],pr={BRONZE:"",SILVER:"",GOLD:"",PLATINUM:"",DIAMOND:"",MASTER:""},En=t=>{for(const e of Wo)if(t>=e.min&&t<=e.max)return e.rank;return"BRONZE"},Sl=t=>Wo.findIndex(e=>e.rank===t),IS=()=>({rating:0,winStreak:0,totalMatches:0,wins:0,losses:0}),gd=200,Rx=100,fL=10,hL=20,pL=(t,e,n)=>{const r=En(t),s=En(n),i=Sl(r),o=Sl(s),l=e+1,c=Math.min((l-1)*fL,Rx),d=Math.max(0,o-i),u=Math.min(d*hL,Rx),p=100+c+u,f=Math.floor(gd*p/100),b=t+f,I=En(b),k=Sl(I);return{newRating:b,ratingChange:f,newWinStreak:l,newRank:I,oldRank:r,isRankUp:k>i,isRankDown:!1,bonusBreakdown:{base:gd,winStreakBonus:Math.floor(gd*c/100),rankDiffBonus:Math.floor(gd*u/100),total:f}}},gL=t=>{const e=En(t),r=-Wo.find(c=>c.rank===e).lossPoints,s=Math.max(0,t+r),i=En(s),o=Sl(e),l=Sl(i);return{newRating:s,ratingChange:r,newWinStreak:0,newRank:i,oldRank:e,isRankUp:!1,isRankDown:l<o,bonusBreakdown:{base:r,winStreakBonus:0,rankDiffBonus:0,total:r}}},Ax=async(t,e,n)=>{const r=Ur(Br,`players/${t}`),s=await bf(r);if(s.exists()){const o=s.val();return o.userId||(await sm(r,{userId:e}),o.userId=e),o}const i={userId:e,playerName:n||"",createdAt:Date.now(),lastMatchAt:Date.now(),ratings:{}};return await _f(r,i),i},ag=async(t,e)=>{const n=Ur(Br,`players/${t}/ratings/${e}`),r=await bf(n);if(r.exists())return r.val();const s=IS();return await _f(n,s),s},wS=async t=>{const e=Ur(Br,`players/${t}/ratings`),n=await bf(e);return n.exists()?n.val():{}},mL=async(t,e,n,r)=>{const s=Ur(Br,`players/${t}/ratings/${e}`),i=Ur(Br,`players/${t}`);await VA(s,o=>{const l=o||IS();return{rating:n.newRating,winStreak:n.newWinStreak,totalMatches:l.totalMatches+1,wins:l.wins+(r?1:0),losses:l.losses+(r?0:1)}}),await sm(i,{lastMatchAt:Date.now()})},CS=async(t,e)=>{const n=Ur(Br,`players/${t}`);await sm(n,{playerName:e})},ns=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},yL=1280,vL=720,Px=ns("/leaders/azya_leader.png"),Ox=ns("/leaders/senka_leader.png"),Lx=ns("/leaders/yoRuka_leader.png"),md={BRONZE:"#cd7f32",SILVER:"#c0c0c0",GOLD:"#ffd700",PLATINUM:"#e5e4e2",DIAMOND:"#b9f2ff",MASTER:"#ff4500"},xL=({onStartConfig:t,audioSettings:e,onAudioSettingsChange:n,playerId:r,onSetHomeCard:s,homeCardId:i=null,isAnonymous:o=!0,userId:l=null,currentPlayerName:c="",onPlayerNameUpdate:d,onNavigateToRegister:u,onNavigateToLogin:p,onNavigateToProfile:f,onLogout:b})=>{const[I,k]=A.useState("title"),[F,x]=A.useState(!1);A.useEffect(()=>{console.log(" TitleScreen auth state:",{isAnonymous:o,userId:l})},[o,l]),A.useEffect(()=>{console.log(" TitleScreen homeCardId changed:",i)},[i]);const[v,T]=A.useState("home"),[h,W]=A.useState("home"),[G,ce]=A.useState(!1),[N,J]=A.useState(!1),[Q,Ie]=A.useState(""),[Je,pe]=A.useState(!1),[se,P]=A.useState("class"),[w,R]=A.useState(null),[y,g]=A.useState(null),[C,O]=A.useState([]),[M,U]=A.useState([]),[H,me]=A.useState(!1),[ve,ue]=A.useState("CPU"),[ne,re]=A.useState("NORMAL"),[He,st]=A.useState({}),[je,we]=A.useState(!1),[Re,at]=A.useState(25),[qe,Ze]=A.useState(!1),[Ue,De]=A.useState(!1),mt=A.useRef(0),Et=A.useRef(0),Mt=A.useRef(0),de=A.useRef(0),Le=A.useRef(0),Me=A.useRef(null),Be=A.useRef(null),Pt=A.useRef(Date.now()),[_s,vi]=A.useState(!1),[Yr,Nn]=A.useState(c),[bs,sr]=A.useState(""),[nn,va]=A.useState(!1),[S,Cf]=A.useState(1);A.useEffect(()=>{const D=()=>{const Fe=window.innerWidth/yL,lt=window.innerHeight/vL;Cf(Math.min(Fe,lt))};return D(),window.addEventListener("resize",D),()=>window.removeEventListener("resize",D)},[]),A.useEffect(()=>{(async()=>{if(!r){we(!1);return}we(!0);try{const Fe=await wS(r);st(Fe)}catch(Fe){console.error("Failed to fetch class ratings:",Fe)}finally{we(!1)}})()},[r]);const xa=()=>{x(!0),setTimeout(()=>{k("home"),x(!1)},600)},jn=D=>{D===v||G||(T(D),ce(!0),setTimeout(()=>{W(D),ce(!1)},150))},so=D=>{const Fe=D%360;return Fe<0?Fe+360:Fe},xi=()=>{Me.current!==null&&(cancelAnimationFrame(Me.current),Me.current=null)},Kr=()=>{Be.current!==null&&(cancelAnimationFrame(Be.current),Be.current=null),De(!1)},kf=()=>{Kr(),De(!0);const D=.2,Fe=()=>{at(lt=>so(lt+D)),Be.current=requestAnimationFrame(Fe)};Be.current=requestAnimationFrame(Fe)},_a=D=>{xi(),Kr(),Pt.current=Date.now(),Ze(!0),mt.current=D.clientX,Et.current=Re,Mt.current=Date.now(),de.current=D.clientX,Le.current=0},Rf=D=>{if(!qe)return;const Fe=Date.now(),lt=Fe-Mt.current,q=D.clientX-de.current;lt>0&&(Le.current=q/lt);const _e=D.clientX-mt.current,Xr=Et.current+_e*.5;at(so(Xr)),Mt.current=Fe,de.current=D.clientX},ba=()=>{Ze(!1),Pt.current=Date.now();let D=Le.current*.5;const Fe=.95,lt=.1,q=()=>{Math.abs(D)>lt?(at(_e=>so(_e+D)),D*=Fe,Me.current=requestAnimationFrame(q)):(Me.current=null,Pt.current=Date.now())};Math.abs(D)>lt&&q()};A.useEffect(()=>()=>{xi(),Kr()},[]),A.useEffect(()=>{if(v!=="home")return;const D=setInterval(()=>{Date.now()-Pt.current>=2e3&&!qe&&!Me.current&&!Ue&&kf()},100);return()=>clearInterval(D)},[v,qe,Ue]);const Ea=async()=>{if(sr(""),!Yr.trim()){sr("");return}if(Yr.length>20){sr("20");return}if(!l){sr("ID");return}va(!0);try{await CS(l,Yr.trim()),d==null||d(Yr.trim()),vi(!1),sr("")}catch(D){console.error("Failed to update player name:",D),sr("")}finally{va(!1)}},Sa=()=>{Nn(c),sr(""),vi(!0)},Ec=()=>{Nn(c),sr(""),vi(!1)},Sc=D=>{D.key==="Enter"&&!nn?Ea():D.key==="Escape"&&Ec()},Tc=D=>{$n(D==="casual"?"CASUAL_MATCH":"RANKED_MATCH")},Ic=()=>{pe(!0)},Ta=()=>{pe(!1),b&&b()},wc=()=>{pe(!1)},Ia=D=>{R(D);const lt=(D==="SENKA"?m0:D==="AJA"?y0:v0).filter(q=>!q.cardId.startsWith("TOKEN_")).map(q=>{var _e;return{cardId:q.cardId,cost:((_e=zn.find(Xr=>Xr.id===q.cardId))==null?void 0:_e.cost)||0}}).sort((q,_e)=>q.cost-_e.cost).map(q=>q.cardId);U(lt),P("card-list")},wa=D=>{g(D),P("card-detail")},Cc=D=>{if(!y||M.length===0)return;const Fe=M.indexOf(y);if(Fe===-1)return;let lt;D==="prev"?lt=Fe===0?M.length-1:Fe-1:lt=Fe===M.length-1?0:Fe+1,g(M[lt])},Ca=D=>{const Fe=zn.find(lt=>lt.id===D);Fe&&Fe.relatedCards&&Fe.relatedCards.length>0&&(g(D),O(Fe.relatedCards),P("related-card"))},io=()=>{g(null),P("card-list")},_i=()=>{O([]),P("card-detail")},$n=(D,Fe,lt)=>{ue(D),Fe&&Ie(Fe),lt&&re(lt),me(!0)},Kn=D=>{me(!1),t(ve,ve==="JOIN"?Q:void 0,D,ve==="CPU"?ne:void 0),J(!1)},ir=()=>{me(!1)};A.useEffect(()=>{v!=="gallery"&&(P("class"),R(null),g(null),O([]))},[v]);const or=9*S;if(I==="title")return a.jsxs("div",{className:"screen title-screen",onClick:xa,style:{height:"100dvh",width:"100vw",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative",overflow:"hidden",color:"white",cursor:"pointer"},children:[a.jsx("div",{style:{position:"absolute",inset:0,backgroundImage:`url(${ns("/title/background.png")})`,backgroundSize:"cover",backgroundPosition:"center",zIndex:0}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",zIndex:-1}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(0, 0, 0, 0.3)",zIndex:1}}),a.jsxs("div",{style:{position:"relative",zIndex:2,display:"flex",flexDirection:"column",alignItems:"center",transform:F?"translateY(-100vh)":"translateY(0)",transition:F?"transform 0.6s ease-out":"none"},children:[a.jsx("div",{style:{fontFamily:"Tamanegi, sans-serif",fontSize:`${or}rem`,color:"#fff",textShadow:"0 0 30px rgba(233, 69, 96, 0.9), 0 0 60px rgba(233, 69, 96, 0.5), 3px 3px 6px rgba(0,0,0,0.9)",letterSpacing:`${.5*S}rem`,whiteSpace:"nowrap",marginBottom:`${2*S}rem`},children:""}),a.jsx("div",{style:{fontSize:`${2*S}rem`,color:"#fff",fontWeight:"bold",letterSpacing:`${.3*S}rem`,animation:"blink 1.5s ease-in-out infinite",textShadow:"0 0 10px rgba(255, 255, 255, 0.8)"},children:"GAME START"})]}),a.jsx("p",{style:{position:"absolute",bottom:20*S,opacity:.5,fontSize:`${.8*S}rem`,zIndex:2},children:"Ver 1.04 Beta"}),a.jsx("style",{children:`
                    @keyframes blink {
                        0%, 100% { opacity: 1; }
                        50% { opacity: 0.3; }
                    }
                `})]});const ka=[{id:"solo",label:"",color:"#e94560"},{id:"room",label:"",color:"#60a5fa"},{id:"random",label:"",color:"#4ade80"},{id:"home",label:"",color:"#f59e0b"},{id:"ranking",label:"",color:"#a855f7"},{id:"gallery",label:"",color:"#ec4899"},{id:"settings",label:"",color:"#6b7280"}];return a.jsxs("div",{className:"screen home-screen",style:{height:"100dvh",width:"100vw",display:"flex",flexDirection:"column",position:"relative",overflow:"hidden",color:"white"},onMouseMove:Rf,onMouseUp:ba,onMouseLeave:ba,children:[a.jsx("div",{style:{position:"absolute",inset:0,backgroundImage:`url(${ns("/title/background.png")})`,backgroundSize:"cover",backgroundPosition:"center",zIndex:0}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",zIndex:-1}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(0, 0, 0, 0.5)",zIndex:1}}),a.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",paddingBottom:80*S,position:"relative",zIndex:2},children:[h==="home"&&(()=>{console.log(" Rendering home card, homeCardId:",i);const D=i?zn.find(q=>q.id===i):null,Fe=(D==null?void 0:D.imageUrl)||`/cards/${i}.png`,lt=(D==null?void 0:D.type)==="FOLLOWER"?(D==null?void 0:D.evolvedImageUrl)||`/cards/${i}_evolved.png`:null;return a.jsxs("div",{style:{position:"absolute",left:150*S,top:"50%",transform:"translateY(-50%)",perspective:1e3},children:[a.jsxs("div",{onMouseDown:_a,style:{width:439*S,height:615*S,transformStyle:"preserve-3d",transform:`rotateY(${Re}deg)`,transition:qe?"none":"transform 0.3s ease-out",cursor:qe?"grabbing":"grab"},children:[a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",borderRadius:12*S,background:i?`#2d3748 url(${ns(Fe)}) center/cover no-repeat`:"linear-gradient(135deg, #2d3748 0%, #1a202c 100%)",border:`3px solid ${i?"#e94560":"#4a5568"}`,boxShadow:"0 10px 30px rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center"},children:!i&&a.jsxs("span",{style:{fontSize:`${.9*S}rem`,color:"#718096",textAlign:"center",padding:20*S},children:["",a.jsx("br",{}),"",a.jsx("br",{}),""]})}),a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",transform:"rotateY(180deg)",borderRadius:12*S,background:i&&lt?`#2d3748 url(${ns(lt)}) center/cover no-repeat`:i?`#2d3748 url(${ns(Fe)}) center/cover no-repeat`:`url(${ns("/cards/sleeve_default.png")}) center/cover no-repeat`,border:`3px solid ${i?"#a855f7":"#4a5568"}`,boxShadow:"0 10px 30px rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center"},children:!i&&a.jsx("span",{style:{fontSize:`${.8*S}rem`,color:"#718096"},children:""})})]}),a.jsx("p",{style:{textAlign:"center",marginTop:10*S,fontSize:`${.75*S}rem`,color:"#888"},children:""})]})})(),h==="home"&&a.jsxs("div",{style:{position:"absolute",right:100*S,top:"50%",transform:"translateY(-50%)",display:"flex",flexDirection:"column",gap:`${2*S}rem`,width:350*S},children:[a.jsxs("div",{style:{background:"rgba(0, 0, 0, 0.6)",border:"2px solid rgba(255, 255, 255, 0.2)",borderRadius:`${12*S}px`,padding:`${20*S}px`,boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)"},children:[a.jsx("h3",{style:{margin:0,marginBottom:`${10*S}px`,fontSize:`${1.2*S}rem`,color:"#fff",borderBottom:"1px solid rgba(255, 255, 255, 0.2)",paddingBottom:`${8*S}px`},children:""}),a.jsx("div",{style:{fontSize:`${1*S}rem`,color:"#e2e8f0"},children:a.jsxs("div",{style:{marginBottom:`${8*S}px`},children:[a.jsx("span",{style:{color:"#aaa"},children:":"})," ",l||""]})})]}),a.jsxs("div",{style:{background:"rgba(0, 0, 0, 0.6)",border:"2px solid rgba(255, 255, 255, 0.2)",borderRadius:`${12*S}px`,padding:`${20*S}px`,boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)"},children:[a.jsx("h3",{style:{margin:0,marginBottom:`${15*S}px`,fontSize:`${1.2*S}rem`,color:"#fff",borderBottom:"1px solid rgba(255, 255, 255, 0.2)",paddingBottom:`${8*S}px`,textAlign:"center"},children:""}),je?a.jsx("div",{style:{textAlign:"center",color:"#aaa",fontSize:`${.9*S}rem`},children:"..."}):a.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:`${10*S}px`},children:[(()=>{const D=He.SENKA,Fe=(D==null?void 0:D.rating)??0,lt=En(Fe),q=md[lt],_e=pr[lt];return a.jsxs("div",{style:{background:"rgba(233, 69, 96, 0.1)",border:"1px solid rgba(233, 69, 96, 0.3)",borderRadius:`${8*S}px`,padding:`${10*S}px`,textAlign:"center"},children:[a.jsx("div",{style:{fontSize:`${.85*S}rem`,color:"#e94560",fontWeight:"bold",marginBottom:`${5*S}px`},children:""}),a.jsx("div",{style:{fontSize:`${.75*S}rem`,color:q,marginBottom:`${3*S}px`},children:_e}),a.jsx("div",{style:{fontSize:`${1*S}rem`,color:"#4ade80",fontWeight:"bold"},children:Fe})]})})(),(()=>{const D=He.AJA,Fe=(D==null?void 0:D.rating)??0,lt=En(Fe),q=md[lt],_e=pr[lt];return a.jsxs("div",{style:{background:"rgba(69, 162, 233, 0.1)",border:"1px solid rgba(69, 162, 233, 0.3)",borderRadius:`${8*S}px`,padding:`${10*S}px`,textAlign:"center"},children:[a.jsx("div",{style:{fontSize:`${.85*S}rem`,color:"#45a2e9",fontWeight:"bold",marginBottom:`${5*S}px`},children:""}),a.jsx("div",{style:{fontSize:`${.75*S}rem`,color:q,marginBottom:`${3*S}px`},children:_e}),a.jsx("div",{style:{fontSize:`${1*S}rem`,color:"#4ade80",fontWeight:"bold"},children:Fe})]})})(),(()=>{const D=He.YORUKA,Fe=(D==null?void 0:D.rating)??0,lt=En(Fe),q=md[lt],_e=pr[lt];return a.jsxs("div",{style:{background:"rgba(168, 85, 247, 0.1)",border:"1px solid rgba(168, 85, 247, 0.3)",borderRadius:`${8*S}px`,padding:`${10*S}px`,textAlign:"center"},children:[a.jsx("div",{style:{fontSize:`${.85*S}rem`,color:"#a855f7",fontWeight:"bold",marginBottom:`${5*S}px`},children:"Y"}),a.jsx("div",{style:{fontSize:`${.75*S}rem`,color:q,marginBottom:`${3*S}px`},children:_e}),a.jsx("div",{style:{fontSize:`${1*S}rem`,color:"#4ade80",fontWeight:"bold"},children:Fe})]})})()]})]})]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",maxWidth:600*S,opacity:G?0:1,transition:"opacity 0.3s ease-in-out"},children:[h==="home"&&a.jsx("div",{style:{textAlign:"center"}}),h==="solo"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*S}rem`,marginBottom:`${1.5*S}rem`,color:"#e94560"},children:""}),a.jsxs("div",{style:{display:"flex",gap:`${3*S}rem`,perspective:1200},children:[a.jsxs("div",{onClick:()=>$n("CPU",void 0,"EASY"),style:{width:200*S,height:280*S,background:"linear-gradient(135deg, #1a3a2a 0%, #0d2d1a 100%)",border:"3px solid #4ade80",borderRadius:16*S,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(74, 222, 128, 0.3)"},onMouseOver:D=>{D.currentTarget.style.transform="rotateY(0deg) scale(1.05)",D.currentTarget.style.boxShadow="0 15px 40px rgba(74, 222, 128, 0.5)"},onMouseOut:D=>{D.currentTarget.style.transform="rotateY(15deg)",D.currentTarget.style.boxShadow="0 10px 30px rgba(74, 222, 128, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*S}rem`,marginBottom:`${.5*S}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*S}rem`,color:"#4ade80",margin:0,marginBottom:`${.5*S}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*S}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*S}rem`},children:["",a.jsx("br",{}),"CPU"]})]}),a.jsxs("div",{onClick:()=>$n("CPU",void 0,"NORMAL"),style:{width:200*S,height:280*S,background:"linear-gradient(135deg, #1a2a3a 0%, #0d1a2a 100%)",border:"3px solid #60a5fa",borderRadius:16*S,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(0deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(96, 165, 250, 0.3)"},onMouseOver:D=>{D.currentTarget.style.transform="scale(1.05)",D.currentTarget.style.boxShadow="0 15px 40px rgba(96, 165, 250, 0.5)"},onMouseOut:D=>{D.currentTarget.style.transform="rotateY(0deg)",D.currentTarget.style.boxShadow="0 10px 30px rgba(96, 165, 250, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*S}rem`,marginBottom:`${.5*S}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*S}rem`,color:"#60a5fa",margin:0,marginBottom:`${.5*S}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*S}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*S}rem`},children:["",a.jsx("br",{}),"CPU"]})]}),a.jsxs("div",{onClick:()=>$n("CPU",void 0,"HARD"),style:{width:200*S,height:280*S,background:"linear-gradient(135deg, #3a1a1a 0%, #2d0d0d 100%)",border:"3px solid #e94560",borderRadius:16*S,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(-15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(233, 69, 96, 0.3)"},onMouseOver:D=>{D.currentTarget.style.transform="rotateY(0deg) scale(1.05)",D.currentTarget.style.boxShadow="0 15px 40px rgba(233, 69, 96, 0.5)"},onMouseOut:D=>{D.currentTarget.style.transform="rotateY(-15deg)",D.currentTarget.style.boxShadow="0 10px 30px rgba(233, 69, 96, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*S}rem`,marginBottom:`${.5*S}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*S}rem`,color:"#e94560",margin:0,marginBottom:`${.5*S}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*S}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*S}rem`},children:["",a.jsx("br",{}),"CPU"]})]})]})]}),h==="room"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*S}rem`,marginBottom:`${1.5*S}rem`,color:"#60a5fa"},children:""}),N?a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:`${1*S}rem`,alignItems:"center"},children:[a.jsx("input",{type:"text",placeholder:"ID",value:Q,onChange:D=>Ie(D.target.value),style:{padding:`${.8*S}rem`,fontSize:`${1*S}rem`,width:250*S,background:"rgba(255,255,255,0.1)",border:"2px solid #a855f7",borderRadius:8*S,color:"white",textAlign:"center",userSelect:"text"}}),a.jsxs("div",{style:{display:"flex",gap:`${.5*S}rem`},children:[a.jsx("button",{onClick:()=>J(!1),style:{padding:`${.6*S}rem ${1.5*S}rem`,fontSize:`${1*S}rem`,background:"transparent",border:"1px solid #666",borderRadius:6*S,color:"#888",cursor:"pointer"},children:""}),a.jsx("button",{onClick:()=>$n("JOIN",Q),disabled:!Q,style:{padding:`${.6*S}rem ${1.5*S}rem`,fontSize:`${1*S}rem`,background:Q?"#a855f7":"#333",border:"none",borderRadius:6*S,color:"white",cursor:Q?"pointer":"not-allowed",opacity:Q?1:.5},children:""})]})]}):a.jsxs("div",{style:{display:"flex",gap:`${3*S}rem`,perspective:1200},children:[a.jsxs("div",{onClick:()=>$n("HOST"),style:{width:200*S,height:280*S,background:"linear-gradient(135deg, #1a2a3a 0%, #0d1a2a 100%)",border:"3px solid #60a5fa",borderRadius:16*S,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(96, 165, 250, 0.3)"},onMouseOver:D=>{D.currentTarget.style.transform="rotateY(0deg) scale(1.05)",D.currentTarget.style.boxShadow="0 15px 40px rgba(96, 165, 250, 0.5)"},onMouseOut:D=>{D.currentTarget.style.transform="rotateY(15deg)",D.currentTarget.style.boxShadow="0 10px 30px rgba(96, 165, 250, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*S}rem`,marginBottom:`${.5*S}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*S}rem`,color:"#60a5fa",margin:0,marginBottom:`${.5*S}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*S}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*S}rem`},children:["ID",a.jsx("br",{}),""]})]}),a.jsxs("div",{onClick:()=>J(!0),style:{width:200*S,height:280*S,background:"linear-gradient(135deg, #2a1a3a 0%, #1a0d2a 100%)",border:"3px solid #a855f7",borderRadius:16*S,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(-15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(168, 85, 247, 0.3)"},onMouseOver:D=>{D.currentTarget.style.transform="rotateY(0deg) scale(1.05)",D.currentTarget.style.boxShadow="0 15px 40px rgba(168, 85, 247, 0.5)"},onMouseOut:D=>{D.currentTarget.style.transform="rotateY(-15deg)",D.currentTarget.style.boxShadow="0 10px 30px rgba(168, 85, 247, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*S}rem`,marginBottom:`${.5*S}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*S}rem`,color:"#a855f7",margin:0,marginBottom:`${.5*S}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*S}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*S}rem`},children:["ID",a.jsx("br",{}),""]})]})]})]}),h==="random"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*S}rem`,marginBottom:`${1.5*S}rem`,color:"#4ade80"},children:""}),a.jsxs("div",{style:{display:"flex",gap:`${3*S}rem`,perspective:1200},children:[a.jsxs("div",{onClick:()=>Tc("casual"),style:{width:200*S,height:280*S,background:"linear-gradient(135deg, #1a3a1a 0%, #0d2d0d 100%)",border:"3px solid #4ade80",borderRadius:16*S,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(74, 222, 128, 0.3)"},onMouseOver:D=>{D.currentTarget.style.transform="rotateY(0deg) scale(1.05)",D.currentTarget.style.boxShadow="0 15px 40px rgba(74, 222, 128, 0.5)"},onMouseOut:D=>{D.currentTarget.style.transform="rotateY(15deg)",D.currentTarget.style.boxShadow="0 10px 30px rgba(74, 222, 128, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*S}rem`,marginBottom:`${.5*S}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*S}rem`,color:"#4ade80",margin:0,marginBottom:`${.5*S}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*S}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*S}rem`},children:["",a.jsx("br",{}),""]})]}),a.jsxs("div",{onClick:()=>Tc("ranked"),style:{width:200*S,height:280*S,background:"linear-gradient(135deg, #3a1a1a 0%, #2d0d0d 100%)",border:"3px solid #e94560",borderRadius:16*S,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",transform:"rotateY(-15deg)",transition:"transform 0.3s ease, box-shadow 0.3s ease",boxShadow:"0 10px 30px rgba(233, 69, 96, 0.3)"},onMouseOver:D=>{D.currentTarget.style.transform="rotateY(0deg) scale(1.05)",D.currentTarget.style.boxShadow="0 15px 40px rgba(233, 69, 96, 0.5)"},onMouseOut:D=>{D.currentTarget.style.transform="rotateY(-15deg)",D.currentTarget.style.boxShadow="0 10px 30px rgba(233, 69, 96, 0.3)"},children:[a.jsx("div",{style:{fontSize:`${3*S}rem`,marginBottom:`${.5*S}rem`},children:""}),a.jsx("h3",{style:{fontSize:`${1.4*S}rem`,color:"#e94560",margin:0,marginBottom:`${.5*S}rem`},children:""}),a.jsxs("p",{style:{fontSize:`${.8*S}rem`,color:"#aaa",textAlign:"center",padding:`0 ${1*S}rem`},children:["",a.jsx("br",{}),""]})]})]})]}),h==="ranking"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*S}rem`,marginBottom:`${1*S}rem`,color:"#a855f7"},children:""}),a.jsx("p",{style:{fontSize:`${1*S}rem`,color:"#888"},children:"Coming Soon..."})]}),h==="gallery"&&a.jsxs(a.Fragment,{children:[se==="class"&&a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:`${1.8*S}rem`,marginBottom:`${1.5*S}rem`,color:"#ec4899"},children:" - "}),a.jsxs("div",{style:{display:"flex",gap:`${1.2*S}rem`,justifyContent:"center",marginBottom:`${1*S}rem`},children:[a.jsxs("div",{onClick:()=>Ia("SENKA"),style:{width:200*S,height:280*S,border:"1px solid #444",borderRadius:10*S,background:"linear-gradient(180deg, #2c0b0e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:"0 4px 20px rgba(233, 69, 96, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:D=>{D.currentTarget.style.transform="scale(1.05)",D.currentTarget.style.boxShadow="0 8px 30px rgba(233, 69, 96, 0.4)"},onMouseOut:D=>{D.currentTarget.style.transform="scale(1)",D.currentTarget.style.boxShadow="0 4px 20px rgba(233, 69, 96, 0.2)"},children:[a.jsx("img",{src:Ox,alt:"Senka",style:{width:"100%",height:"75%",objectFit:"cover"}}),a.jsx("div",{style:{padding:`${8*S}px`,display:"flex",flexDirection:"column",alignItems:"center",width:"100%",justifyContent:"center",flex:1},children:a.jsx("h3",{style:{fontSize:`${1.4*S}rem`,color:"#e94560",margin:0,fontFamily:"sans-serif"},children:""})})]}),a.jsxs("div",{onClick:()=>Ia("AJA"),style:{width:200*S,height:280*S,border:"1px solid #444",borderRadius:10*S,background:"linear-gradient(180deg, #0f1c2e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:"0 4px 20px rgba(69, 162, 233, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:D=>{D.currentTarget.style.transform="scale(1.05)",D.currentTarget.style.boxShadow="0 8px 30px rgba(69, 162, 233, 0.4)"},onMouseOut:D=>{D.currentTarget.style.transform="scale(1)",D.currentTarget.style.boxShadow="0 4px 20px rgba(69, 162, 233, 0.2)"},children:[a.jsx("img",{src:Px,alt:"Azya",style:{width:"100%",height:"75%",objectFit:"cover",objectPosition:"center top"}}),a.jsx("div",{style:{padding:`${8*S}px`,display:"flex",flexDirection:"column",alignItems:"center",width:"100%",justifyContent:"center",flex:1},children:a.jsx("h3",{style:{fontSize:`${1.4*S}rem`,color:"#45a2e9",margin:0,fontFamily:"sans-serif"},children:""})})]}),a.jsxs("div",{onClick:()=>Ia("YORUKA"),style:{width:200*S,height:280*S,border:"1px solid #444",borderRadius:10*S,background:"linear-gradient(180deg, #1a0f2e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:"0 4px 20px rgba(168, 85, 247, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:D=>{D.currentTarget.style.transform="scale(1.05)",D.currentTarget.style.boxShadow="0 8px 30px rgba(168, 85, 247, 0.4)"},onMouseOut:D=>{D.currentTarget.style.transform="scale(1)",D.currentTarget.style.boxShadow="0 4px 20px rgba(168, 85, 247, 0.2)"},children:[a.jsx("img",{src:Lx,alt:"Yoruka",style:{width:"100%",height:"75%",objectFit:"cover"}}),a.jsx("div",{style:{padding:`${8*S}px`,display:"flex",flexDirection:"column",alignItems:"center",width:"100%",justifyContent:"center",flex:1},children:a.jsx("h3",{style:{fontSize:`${1.4*S}rem`,color:"#a855f7",margin:0,fontFamily:"sans-serif"},children:"Y"})})]})]})]}),se==="card-list"&&w&&a.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"auto"},children:a.jsx(Dw,{classType:w,onSelectCard:wa})}),se==="card-detail"&&y&&a.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"auto"},children:a.jsx($w,{cardId:y,allCardIds:M,onNavigate:Cc,onOpenRelatedCard:Ca,onBack:io,onSetHomeCard:s})}),se==="related-card"&&y&&a.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"auto"},children:a.jsx(zw,{parentCardId:y,relatedCardIds:C,onBack:_i})})]}),h==="settings"&&a.jsxs("div",{style:{background:"rgba(0, 0, 0, 0.3)",borderRadius:12*S,padding:`${2*S}rem`,minWidth:400*S},children:[a.jsx("h2",{style:{fontSize:`${1.8*S}rem`,marginBottom:`${1.5*S}rem`,color:"#6b7280",textAlign:"center"},children:""}),a.jsxs("div",{style:{marginBottom:`${1.5*S}rem`},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:`${.5*S}rem`},children:[a.jsx("span",{style:{fontSize:`${1*S}rem`},children:"BGM"}),a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8*S,cursor:"pointer"},children:[a.jsx("input",{type:"checkbox",checked:e.bgmEnabled,onChange:D=>n({bgmEnabled:D.target.checked}),style:{width:18*S,height:18*S}}),a.jsx("span",{style:{color:e.bgmEnabled?"#4ade80":"#888",fontSize:`${.9*S}rem`},children:e.bgmEnabled?"ON":"OFF"})]})]}),a.jsx("input",{type:"range",min:0,max:1,step:.05,value:e.bgm,onChange:D=>n({bgm:parseFloat(D.target.value)}),disabled:!e.bgmEnabled,style:{width:"100%",opacity:e.bgmEnabled?1:.5}})]}),a.jsxs("div",{style:{marginBottom:`${1.5*S}rem`},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:`${.5*S}rem`},children:[a.jsx("span",{style:{fontSize:`${1*S}rem`},children:""}),a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8*S,cursor:"pointer"},children:[a.jsx("input",{type:"checkbox",checked:e.seEnabled,onChange:D=>n({seEnabled:D.target.checked}),style:{width:18*S,height:18*S}}),a.jsx("span",{style:{color:e.seEnabled?"#4ade80":"#888",fontSize:`${.9*S}rem`},children:e.seEnabled?"ON":"OFF"})]})]}),a.jsx("input",{type:"range",min:0,max:1,step:.05,value:e.se,onChange:D=>n({se:parseFloat(D.target.value)}),disabled:!e.seEnabled,style:{width:"100%",opacity:e.seEnabled?1:.5}})]}),a.jsxs("div",{style:{borderTop:"1px solid rgba(255, 255, 255, 0.1)",paddingTop:`${1.5*S}rem`,marginTop:`${1*S}rem`,marginBottom:`${1.5*S}rem`},children:[a.jsx("h3",{style:{fontSize:`${1.2*S}rem`,marginBottom:`${1*S}rem`,color:"#fff"},children:""}),_s?a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:`${.5*S}rem`},children:[a.jsx("input",{type:"text",value:Yr,onChange:D=>Nn(D.target.value),onKeyDown:Sc,disabled:nn,maxLength:20,autoFocus:!0,style:{width:"100%",padding:`${.6*S}rem ${1*S}rem`,fontSize:`${.9*S}rem`,borderRadius:6*S,border:bs?"2px solid #ff5050":"2px solid #a855f7",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"}}),bs&&a.jsx("div",{style:{fontSize:`${.7*S}rem`,color:"#ff5050",marginTop:`${-.2*S}rem`},children:bs}),a.jsxs("div",{style:{display:"flex",gap:`${.5*S}rem`},children:[a.jsx("button",{onClick:Ec,disabled:nn,style:{flex:1,padding:`${.5*S}rem`,fontSize:`${.8*S}rem`,background:"#555",border:"none",borderRadius:4*S,color:"white",cursor:nn?"not-allowed":"pointer",fontWeight:"bold",opacity:nn?.5:1,transition:"all 0.2s"},onMouseEnter:D=>!nn&&(D.currentTarget.style.background="#666"),onMouseLeave:D=>!nn&&(D.currentTarget.style.background="#555"),children:""}),a.jsx("button",{onClick:Ea,disabled:nn,style:{flex:1,padding:`${.5*S}rem`,fontSize:`${.8*S}rem`,background:nn?"#555":"linear-gradient(135deg, #a855f7 0%, #7c3aed 100%)",border:"none",borderRadius:4*S,color:"white",cursor:nn?"not-allowed":"pointer",fontWeight:"bold",transition:"all 0.2s"},onMouseEnter:D=>!nn&&(D.currentTarget.style.transform="scale(1.05)"),onMouseLeave:D=>!nn&&(D.currentTarget.style.transform="scale(1)"),children:nn?"...":""})]})]}):a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:`${.5*S}rem`},children:a.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:`${.6*S}rem ${1*S}rem`,background:"rgba(255, 255, 255, 0.05)",borderRadius:6*S,border:"1px solid rgba(255, 255, 255, 0.1)"},children:[a.jsx("span",{style:{fontSize:`${.9*S}rem`,color:"#fff"},children:c}),a.jsx("button",{onClick:Sa,style:{padding:`${.4*S}rem ${.8*S}rem`,fontSize:`${.75*S}rem`,background:"linear-gradient(135deg, #a855f7 0%, #7c3aed 100%)",border:"none",borderRadius:4*S,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.2s"},onMouseEnter:D=>D.currentTarget.style.transform="scale(1.05)",onMouseLeave:D=>D.currentTarget.style.transform="scale(1)",children:""})]})})]}),a.jsxs("div",{style:{borderTop:"1px solid rgba(255, 255, 255, 0.1)",paddingTop:`${1.5*S}rem`,marginTop:`${1*S}rem`},children:[a.jsx("h3",{style:{fontSize:`${1.2*S}rem`,marginBottom:`${1*S}rem`,color:"#fff"},children:""}),o?a.jsxs("div",{children:[a.jsx("p",{style:{fontSize:`${.9*S}rem`,color:"#aaa",marginBottom:`${1*S}rem`},children:""}),a.jsxs("div",{style:{display:"flex",gap:10*S,marginBottom:`${1*S}rem`},children:[a.jsx("button",{onClick:u,style:{flex:1,padding:`${.6*S}rem ${1*S}rem`,fontSize:`${.9*S}rem`,background:"linear-gradient(135deg, #4a9eff 0%, #357abd 100%)",border:"none",borderRadius:6*S,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s"},onMouseEnter:D=>D.currentTarget.style.transform="scale(1.05)",onMouseLeave:D=>D.currentTarget.style.transform="scale(1)",children:""}),a.jsx("button",{onClick:p,style:{flex:1,padding:`${.6*S}rem ${1*S}rem`,fontSize:`${.9*S}rem`,background:"#555",border:"none",borderRadius:6*S,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s"},onMouseEnter:D=>D.currentTarget.style.background="#666",onMouseLeave:D=>D.currentTarget.style.background="#555",children:""})]}),a.jsx("p",{style:{fontSize:`${.75*S}rem`,color:"#888",textAlign:"center",lineHeight:1.4},children:""})]}):a.jsxs("div",{children:[a.jsx("p",{style:{fontSize:`${.9*S}rem`,color:"#4ade80",marginBottom:`${.5*S}rem`,fontWeight:"bold"},children:""}),a.jsxs("p",{style:{fontSize:`${.85*S}rem`,color:"#fff",marginBottom:`${.3*S}rem`},children:["ID: ",a.jsx("span",{style:{color:"#4a9eff",fontWeight:"bold"},children:l||""})]}),a.jsx("button",{onClick:Ic,style:{width:"100%",padding:`${.6*S}rem ${1*S}rem`,fontSize:`${.9*S}rem`,background:"#d32f2f",border:"none",borderRadius:6*S,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s",marginTop:`${.5*S}rem`},onMouseEnter:D=>D.currentTarget.style.background="#b71c1c",onMouseLeave:D=>D.currentTarget.style.background="#d32f2f",children:""})]})]})]})]})]}),a.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:70*S,background:"rgba(0, 0, 0, 0.8)",borderTop:"2px solid rgba(255, 255, 255, 0.1)",display:"flex",justifyContent:"center",alignItems:"center",gap:`${.5*S}rem`,padding:`0 ${1*S}rem`,zIndex:3},children:ka.map(D=>a.jsx("button",{onClick:()=>jn(D.id),style:{flex:1,maxWidth:140*S,padding:`${.6*S}rem ${.5*S}rem`,fontSize:`${.85*S}rem`,background:v===D.id?D.color:"transparent",border:v===D.id?"none":`2px solid ${D.color}`,borderRadius:8*S,color:v===D.id?"white":D.color,cursor:"pointer",transition:"all 0.2s",fontWeight:v===D.id?"bold":"normal"},children:D.label},D.id))}),a.jsx("p",{style:{position:"absolute",bottom:75*S,right:20*S,opacity:.5,fontSize:`${.7*S}rem`,zIndex:2},children:"Ver 1.04 Beta"}),Je&&a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0, 0, 0, 0.7)",zIndex:100},children:a.jsxs("div",{style:{background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",borderRadius:12*S,padding:`${2*S}rem`,minWidth:300*S,border:"2px solid rgba(255, 255, 255, 0.2)",boxShadow:"0 10px 30px rgba(0, 0, 0, 0.5)"},children:[a.jsx("h3",{style:{fontSize:`${1.2*S}rem`,marginBottom:`${1*S}rem`,color:"#fff",textAlign:"center"},children:""}),a.jsxs("div",{style:{display:"flex",gap:10*S,marginTop:`${1.5*S}rem`},children:[a.jsx("button",{onClick:wc,style:{flex:1,padding:`${.6*S}rem ${1*S}rem`,fontSize:`${.9*S}rem`,background:"#555",border:"none",borderRadius:6*S,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s"},onMouseEnter:D=>D.currentTarget.style.background="#666",onMouseLeave:D=>D.currentTarget.style.background="#555",children:""}),a.jsx("button",{onClick:Ta,style:{flex:1,padding:`${.6*S}rem ${1*S}rem`,fontSize:`${.9*S}rem`,background:"#d32f2f",border:"none",borderRadius:6*S,color:"white",cursor:"pointer",fontWeight:"bold",transition:"all 0.3s"},onMouseEnter:D=>D.currentTarget.style.background="#b71c1c",onMouseLeave:D=>D.currentTarget.style.background="#d32f2f",children:""})]})]})}),H&&a.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"rgba(0, 0, 0, 0.85)",zIndex:200,padding:`${2*S}rem`},children:[a.jsx("h2",{style:{fontSize:`${2*S}rem`,marginBottom:`${2*S}rem`,color:"#fff"},children:""}),a.jsxs("div",{style:{display:"flex",gap:`${1.5*S}rem`,marginBottom:`${1*S}rem`},children:[a.jsxs("div",{onClick:()=>Kn("SENKA"),style:{width:200*S,borderRadius:12*S,overflow:"hidden",cursor:"pointer",border:"3px solid rgba(255, 255, 255, 0.3)",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:"0 4px 15px rgba(0, 0, 0, 0.5)",background:"linear-gradient(180deg, #2c0b0e 0%, #1a1a2e 100%)"},onMouseOver:D=>{D.currentTarget.style.transform="translateY(-10px) scale(1.05)",D.currentTarget.style.boxShadow="0 8px 25px rgba(255, 100, 100, 0.5)"},onMouseOut:D=>{D.currentTarget.style.transform="translateY(0) scale(1)",D.currentTarget.style.boxShadow="0 4px 15px rgba(0, 0, 0, 0.5)"},children:[a.jsx("img",{src:Ox,alt:"",style:{width:"100%",height:168*S,objectFit:"cover"}}),a.jsxs("div",{style:{padding:`${8*S}px`,textAlign:"center"},children:[a.jsx("h3",{style:{fontSize:`${1.4*S}rem`,color:"#e94560",margin:0},children:""}),a.jsx("p",{style:{color:"#aaa",margin:`${4*S}px 0`,fontSize:`${.75*S}rem`},children:" / "}),a.jsxs("p",{style:{fontSize:`${.65*S}rem`,opacity:.8,lineHeight:1.3,margin:0},children:["",a.jsx("br",{}),""]})]})]}),a.jsxs("div",{onClick:()=>Kn("AJA"),style:{width:200*S,borderRadius:12*S,overflow:"hidden",cursor:"pointer",border:"3px solid rgba(255, 255, 255, 0.3)",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:"0 4px 15px rgba(0, 0, 0, 0.5)",background:"linear-gradient(180deg, #0f1c2e 0%, #1a1a2e 100%)"},onMouseOver:D=>{D.currentTarget.style.transform="translateY(-10px) scale(1.05)",D.currentTarget.style.boxShadow="0 8px 25px rgba(100, 200, 255, 0.5)"},onMouseOut:D=>{D.currentTarget.style.transform="translateY(0) scale(1)",D.currentTarget.style.boxShadow="0 4px 15px rgba(0, 0, 0, 0.5)"},children:[a.jsx("img",{src:Px,alt:"",style:{width:"100%",height:168*S,objectFit:"cover",objectPosition:"center top"}}),a.jsxs("div",{style:{padding:`${8*S}px`,textAlign:"center"},children:[a.jsx("h3",{style:{fontSize:`${1.4*S}rem`,color:"#45a2e9",margin:0},children:""}),a.jsx("p",{style:{color:"#aaa",margin:`${4*S}px 0`,fontSize:`${.75*S}rem`},children:" / "}),a.jsxs("p",{style:{fontSize:`${.65*S}rem`,opacity:.8,lineHeight:1.3,margin:0},children:["",a.jsx("br",{}),""]})]})]}),a.jsxs("div",{onClick:()=>Kn("YORUKA"),style:{width:200*S,borderRadius:12*S,overflow:"hidden",cursor:"pointer",border:"3px solid rgba(255, 255, 255, 0.3)",transition:"transform 0.2s, box-shadow 0.2s",boxShadow:"0 4px 15px rgba(0, 0, 0, 0.5)",background:"linear-gradient(180deg, #1a0f2e 0%, #1a1a2e 100%)"},onMouseOver:D=>{D.currentTarget.style.transform="translateY(-10px) scale(1.05)",D.currentTarget.style.boxShadow="0 8px 25px rgba(200, 100, 255, 0.5)"},onMouseOut:D=>{D.currentTarget.style.transform="translateY(0) scale(1)",D.currentTarget.style.boxShadow="0 4px 15px rgba(0, 0, 0, 0.5)"},children:[a.jsx("img",{src:Lx,alt:"Y",style:{width:"100%",height:168*S,objectFit:"cover"}}),a.jsxs("div",{style:{padding:`${8*S}px`,textAlign:"center"},children:[a.jsx("h3",{style:{fontSize:`${1.4*S}rem`,color:"#a855f7",margin:0},children:"Y"}),a.jsx("p",{style:{color:"#aaa",margin:`${4*S}px 0`,fontSize:`${.75*S}rem`},children:" / "}),a.jsxs("p",{style:{fontSize:`${.65*S}rem`,opacity:.8,lineHeight:1.3,margin:0},children:["",a.jsx("br",{}),""]})]})]})]}),ve==="RANKED_MATCH"&&!je&&a.jsx("div",{style:{display:"flex",gap:`${1.5*S}rem`,marginBottom:`${2*S}rem`},children:["SENKA","AJA","YORUKA"].map(D=>{const Fe=He[D],lt=(Fe==null?void 0:Fe.rating)??0,q=En(lt),_e=md[q],Xr=pr[q];return a.jsxs("div",{style:{width:200*S,textAlign:"center",color:"#fff"},children:[a.jsx("div",{style:{fontSize:`${1*S}rem`,color:_e,fontWeight:"bold"},children:Xr}),a.jsx("div",{style:{fontSize:`${1.2*S}rem`,color:"#4ade80",fontWeight:"bold"},children:lt})]},D)})}),a.jsx("button",{onClick:ir,style:{padding:`${.8*S}rem ${2*S}rem`,fontSize:`${1*S}rem`,background:"transparent",border:"2px solid rgba(255, 255, 255, 0.3)",borderRadius:8*S,color:"white",cursor:"pointer",transition:"all 0.2s"},onMouseOver:D=>{D.currentTarget.style.background="rgba(255, 255, 255, 0.1)",D.currentTarget.style.borderColor="rgba(255, 255, 255, 0.5)"},onMouseOut:D=>{D.currentTarget.style.background="transparent",D.currentTarget.style.borderColor="rgba(255, 255, 255, 0.3)"},children:""})]})]})},hm=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},_L=hm("/leaders/azya_leader.png"),bL=hm("/leaders/senka_leader.png"),EL=hm("/leaders/yoRuka_leader.png"),SL=1280,TL=720,IL={BRONZE:"#cd7f32",SILVER:"#c0c0c0",GOLD:"#ffd700",PLATINUM:"#e5e4e2",DIAMOND:"#b9f2ff",MASTER:"#ff4500"},wL=({onSelectClass:t,onBack:e,gameMode:n="CPU",aiDifficulty:r="NORMAL",onDifficultyChange:s,playerName:i,onPlayerNameChange:o,timerEnabled:l=!0,onTimerEnabledChange:c,playerId:d})=>{const[u,p]=A.useState(1),[f,b]=A.useState({}),[I,k]=A.useState(!1);A.useEffect(()=>{const J=()=>{const Q=window.innerWidth/SL,Ie=window.innerHeight/TL;p(Math.min(Q,Ie))};return J(),window.addEventListener("resize",J),()=>window.removeEventListener("resize",J)},[]),A.useEffect(()=>{(async()=>{if(!d){k(!1);return}k(!0);try{const Q=await wS(d);b(Q)}catch(Q){console.error("Failed to fetch class ratings:",Q)}finally{k(!1)}})()},[d]);const F=200*u,x=280*u,v=2*u,T=1.4*u,h=.75*u,W=.65*u,G=1.2*u,ce=`${8*u}px ${16*u}px`,N=J=>{if(n!=="RANKED_MATCH"||!d||I)return null;const Q=f[J];if(!Q)return null;const Ie=En(Q.rating),Je=pr[Ie],pe=IL[Ie];return a.jsxs("div",{style:{marginTop:`${4*u}px`,padding:`${4*u}px ${8*u}px`,background:"rgba(0, 0, 0, 0.3)",borderRadius:4*u,display:"flex",alignItems:"center",gap:`${6*u}px`},children:[a.jsx("span",{style:{fontSize:`${.7*u}rem`,fontWeight:"bold",color:pe,fontFamily:"Tamanegi, sans-serif"},children:Je}),a.jsx("span",{style:{fontSize:`${.75*u}rem`,color:"#fff",fontFamily:"Tamanegi, sans-serif"},children:Q.rating})]})};return a.jsxs("div",{className:"screen",style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"#1a1a2e",color:"white"},children:[a.jsx("h2",{style:{fontSize:`${v}rem`,marginBottom:`${.5*u}rem`,marginTop:0},children:""}),a.jsxs("div",{style:{marginBottom:`${.8*u}rem`,display:"flex",flexDirection:"column",alignItems:"center",gap:`${.3*u}rem`},children:[a.jsx("label",{style:{fontSize:`${.9*u}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif"},children:""}),a.jsx("input",{type:"text",value:i,onChange:J=>o(J.target.value),maxLength:12,placeholder:"",style:{padding:`${6*u}px ${12*u}px`,fontSize:`${.9*u}rem`,background:"#2d3748",border:"2px solid #4a5568",borderRadius:6*u,color:"white",outline:"none",width:180*u,textAlign:"center",fontFamily:"Tamanegi, sans-serif"},onFocus:J=>J.target.style.borderColor="#63b3ed",onBlur:J=>J.target.style.borderColor="#4a5568"})]}),a.jsxs("div",{style:{display:"flex",gap:`${G}rem`,marginBottom:`${1*u}rem`},children:[a.jsxs("div",{onClick:()=>t("SENKA"),style:{width:F,height:x,border:"1px solid #444",borderRadius:10*u,background:"linear-gradient(180deg, #2c0b0e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s",boxShadow:"0 4px 20px rgba(233, 69, 96, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:J=>J.currentTarget.style.transform="scale(1.05)",onMouseOut:J=>J.currentTarget.style.transform="scale(1)",children:[a.jsx("img",{src:bL,alt:"Senka",style:{width:"100%",height:"60%",objectFit:"cover"}}),a.jsxs("div",{style:{padding:`${6*u}px`,display:"flex",flexDirection:"column",alignItems:"center"},children:[a.jsx("h3",{style:{fontSize:`${T}rem`,color:"#e94560",margin:0},children:""}),a.jsx("p",{style:{color:"#aaa",margin:`${3*u}px 0`,fontSize:`${h}rem`,fontFamily:"Tamanegi, sans-serif"},children:" / "}),a.jsxs("p",{style:{padding:`0 ${.5*u}rem`,textAlign:"center",fontSize:`${W}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",lineHeight:1.3},children:["",a.jsx("br",{}),""]}),N("SENKA")]})]}),a.jsxs("div",{onClick:()=>t("AJA"),style:{width:F,height:x,border:"1px solid #444",borderRadius:10*u,background:"linear-gradient(180deg, #0f1c2e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s",boxShadow:"0 4px 20px rgba(69, 162, 233, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:J=>J.currentTarget.style.transform="scale(1.05)",onMouseOut:J=>J.currentTarget.style.transform="scale(1)",children:[a.jsx("img",{src:_L,alt:"Azya",style:{width:"100%",height:"60%",objectFit:"cover",objectPosition:"center top"}}),a.jsxs("div",{style:{padding:`${6*u}px`,display:"flex",flexDirection:"column",alignItems:"center"},children:[a.jsx("h3",{style:{fontSize:`${T}rem`,color:"#45a2e9",margin:0},children:""}),a.jsx("p",{style:{color:"#aaa",margin:`${3*u}px 0`,fontSize:`${h}rem`,fontFamily:"Tamanegi, sans-serif"},children:" / "}),a.jsxs("p",{style:{padding:`${.5*u}rem`,textAlign:"center",fontSize:`${W}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",lineHeight:1.3},children:["",a.jsx("br",{}),""]}),N("AJA")]})]}),a.jsxs("div",{onClick:()=>t("YORUKA"),style:{width:F,height:x,border:"1px solid #444",borderRadius:10*u,background:"linear-gradient(180deg, #1a0f2e 0%, #1a1a2e 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",cursor:"pointer",transition:"transform 0.2s",boxShadow:"0 4px 20px rgba(168, 85, 247, 0.2)",overflow:"hidden",position:"relative"},onMouseOver:J=>J.currentTarget.style.transform="scale(1.05)",onMouseOut:J=>J.currentTarget.style.transform="scale(1)",children:[a.jsx("img",{src:EL,alt:"Yoruka",style:{width:"100%",height:"60%",objectFit:"cover"}}),a.jsxs("div",{style:{padding:`${6*u}px`,display:"flex",flexDirection:"column",alignItems:"center"},children:[a.jsx("h3",{style:{fontSize:`${T}rem`,color:"#a855f7",margin:0},children:"Y"}),a.jsx("p",{style:{color:"#aaa",margin:`${3*u}px 0`,fontSize:`${h}rem`,fontFamily:"Tamanegi, sans-serif"},children:" / "}),a.jsxs("p",{style:{padding:`0 ${.5*u}rem`,textAlign:"center",fontSize:`${W}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",lineHeight:1.3},children:["",a.jsx("br",{}),""]}),N("YORUKA")]})]})]}),n==="CPU"&&s&&a.jsxs("div",{style:{marginBottom:`${.6*u}rem`,display:"flex",flexDirection:"column",alignItems:"center",gap:`${.3*u}rem`},children:[a.jsx("p",{style:{fontSize:`${.85*u}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",margin:0},children:""}),a.jsx("div",{style:{display:"flex",gap:`${.6*u}rem`},children:["EASY","NORMAL","HARD"].map(J=>a.jsx("button",{onClick:()=>s(J),style:{padding:`${6*u}px ${14*u}px`,fontSize:`${.8*u}rem`,background:r===J?J==="EASY"?"#48bb78":J==="NORMAL"?"#e94560":"#9f7aea":"transparent",border:`2px solid ${J==="EASY"?"#48bb78":J==="NORMAL"?"#e94560":"#9f7aea"}`,color:"#fff",cursor:"pointer",borderRadius:4*u,fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s"},children:J==="EASY"?"":J==="NORMAL"?"":""},J))}),a.jsxs("p",{style:{fontSize:`${.65*u}rem`,opacity:.6,fontFamily:"Tamanegi, sans-serif",margin:0},children:[r==="EASY"&&"CPU",r==="NORMAL"&&"CPU",r==="HARD"&&"CPU"]})]}),c&&a.jsxs("div",{style:{marginBottom:`${.6*u}rem`,display:"flex",flexDirection:"column",alignItems:"center",gap:`${.3*u}rem`},children:[a.jsx("p",{style:{fontSize:`${.85*u}rem`,opacity:.8,fontFamily:"Tamanegi, sans-serif",margin:0},children:""}),a.jsxs("div",{style:{display:"flex",gap:`${.6*u}rem`},children:[a.jsx("button",{onClick:()=>c(!0),style:{padding:`${6*u}px ${14*u}px`,fontSize:`${.8*u}rem`,background:l?"#3182ce":"transparent",border:"2px solid #3182ce",color:"#fff",cursor:"pointer",borderRadius:4*u,fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s"},children:"ON (60)"}),a.jsx("button",{onClick:()=>c(!1),style:{padding:`${6*u}px ${14*u}px`,fontSize:`${.8*u}rem`,background:l?"transparent":"#718096",border:"2px solid #718096",color:"#fff",cursor:"pointer",borderRadius:4*u,fontFamily:"Tamanegi, sans-serif",transition:"all 0.2s"},children:"OFF"})]}),a.jsx("p",{style:{fontSize:`${.65*u}rem`,opacity:.6,fontFamily:"Tamanegi, sans-serif",margin:0},children:l?"600":""})]}),a.jsx("button",{onClick:e,style:{background:"#333",padding:ce,fontSize:`${.9*u}rem`,marginBottom:`${.5*u}rem`},children:""})]})};class CL{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(e){this.flush(),this._parts.push(e)}append(e){this._pieces.push(e)}flush(){if(this._pieces.length>0){const e=new Uint8Array(this._pieces);this._parts.push(e),this._pieces=[]}}toArrayBuffer(){const e=[];for(const n of this._parts)e.push(n);return kL(e).buffer}}function kL(t){let e=0;for(const s of t)e+=s.byteLength;const n=new Uint8Array(e);let r=0;for(const s of t){const i=new Uint8Array(s.buffer,s.byteOffset,s.byteLength);n.set(i,r),r+=s.byteLength}return n}function kS(t){return new RL(t).unpack()}function RS(t){const e=new AL,n=e.pack(t);return n instanceof Promise?n.then(()=>e.getBuffer()):e.getBuffer()}class RL{constructor(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){const e=this.unpack_uint8();if(e<128)return e;if((e^224)<32)return(e^224)-32;let n;if((n=e^160)<=15)return this.unpack_raw(n);if((n=e^176)<=15)return this.unpack_string(n);if((n=e^144)<=15)return this.unpack_array(n);if((n=e^128)<=15)return this.unpack_map(n);switch(e){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return n=this.unpack_uint16(),this.unpack_string(n);case 217:return n=this.unpack_uint32(),this.unpack_string(n);case 218:return n=this.unpack_uint16(),this.unpack_raw(n);case 219:return n=this.unpack_uint32(),this.unpack_raw(n);case 220:return n=this.unpack_uint16(),this.unpack_array(n);case 221:return n=this.unpack_uint32(),this.unpack_array(n);case 222:return n=this.unpack_uint16(),this.unpack_map(n);case 223:return n=this.unpack_uint32(),this.unpack_map(n)}}unpack_uint8(){const e=this.dataView[this.index]&255;return this.index++,e}unpack_uint16(){const e=this.read(2),n=(e[0]&255)*256+(e[1]&255);return this.index+=2,n}unpack_uint32(){const e=this.read(4),n=((e[0]*256+e[1])*256+e[2])*256+e[3];return this.index+=4,n}unpack_uint64(){const e=this.read(8),n=((((((e[0]*256+e[1])*256+e[2])*256+e[3])*256+e[4])*256+e[5])*256+e[6])*256+e[7];return this.index+=8,n}unpack_int8(){const e=this.unpack_uint8();return e<128?e:e-256}unpack_int16(){const e=this.unpack_uint16();return e<32768?e:e-65536}unpack_int32(){const e=this.unpack_uint32();return e<2**31?e:e-2**32}unpack_int64(){const e=this.unpack_uint64();return e<2**63?e:e-2**64}unpack_raw(e){if(this.length<this.index+e)throw new Error(`BinaryPackFailure: index is out of range ${this.index} ${e} ${this.length}`);const n=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,n}unpack_string(e){const n=this.read(e);let r=0,s="",i,o;for(;r<e;)i=n[r],i<160?(o=i,r++):(i^192)<32?(o=(i&31)<<6|n[r+1]&63,r+=2):(i^224)<16?(o=(i&15)<<12|(n[r+1]&63)<<6|n[r+2]&63,r+=3):(o=(i&7)<<18|(n[r+1]&63)<<12|(n[r+2]&63)<<6|n[r+3]&63,r+=4),s+=String.fromCodePoint(o);return this.index+=e,s}unpack_array(e){const n=new Array(e);for(let r=0;r<e;r++)n[r]=this.unpack();return n}unpack_map(e){const n={};for(let r=0;r<e;r++){const s=this.unpack();n[s]=this.unpack()}return n}unpack_float(){const e=this.unpack_uint32(),n=e>>31,r=(e>>23&255)-127,s=e&8388607|8388608;return(n===0?1:-1)*s*2**(r-23)}unpack_double(){const e=this.unpack_uint32(),n=this.unpack_uint32(),r=e>>31,s=(e>>20&2047)-1023,o=(e&1048575|1048576)*2**(s-20)+n*2**(s-52);return(r===0?1:-1)*o}read(e){const n=this.index;if(n+e<=this.length)return this.dataView.subarray(n,n+e);throw new Error("BinaryPackFailure: read index out of range")}}class AL{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(e){if(typeof e=="string")this.pack_string(e);else if(typeof e=="number")Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if(typeof e=="boolean")e===!0?this._bufferBuilder.append(195):e===!1&&this._bufferBuilder.append(194);else if(e===void 0)this._bufferBuilder.append(192);else if(typeof e=="object")if(e===null)this._bufferBuilder.append(192);else{const n=e.constructor;if(e instanceof Array){const r=this.pack_array(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else if(e instanceof ArrayBuffer)this.pack_bin(new Uint8Array(e));else if("BYTES_PER_ELEMENT"in e){const r=e;this.pack_bin(new Uint8Array(r.buffer,r.byteOffset,r.byteLength))}else if(e instanceof Date)this.pack_string(e.toString());else{if(e instanceof Blob)return e.arrayBuffer().then(r=>{this.pack_bin(new Uint8Array(r)),this._bufferBuilder.flush()});if(n==Object||n.toString().startsWith("class")){const r=this.pack_object(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else throw new Error(`Type "${n.toString()}" not yet supported`)}}else throw new Error(`Type "${typeof e}" not yet supported`);this._bufferBuilder.flush()}pack_bin(e){const n=e.length;if(n<=15)this.pack_uint8(160+n);else if(n<=65535)this._bufferBuilder.append(218),this.pack_uint16(n);else if(n<=4294967295)this._bufferBuilder.append(219),this.pack_uint32(n);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(e)}pack_string(e){const n=this._textEncoder.encode(e),r=n.length;if(r<=15)this.pack_uint8(176+r);else if(r<=65535)this._bufferBuilder.append(216),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(217),this.pack_uint32(r);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(n)}pack_array(e){const n=e.length;if(n<=15)this.pack_uint8(144+n);else if(n<=65535)this._bufferBuilder.append(220),this.pack_uint16(n);else if(n<=4294967295)this._bufferBuilder.append(221),this.pack_uint32(n);else throw new Error("Invalid length");const r=s=>{if(s<n){const i=this.pack(e[s]);return i instanceof Promise?i.then(()=>r(s+1)):r(s+1)}};return r(0)}pack_integer(e){if(e>=-32&&e<=127)this._bufferBuilder.append(e&255);else if(e>=0&&e<=255)this._bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&e<=127)this._bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&e<=65535)this._bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&e<=32767)this._bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&e<=4294967295)this._bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-2147483648&&e<=2147483647)this._bufferBuilder.append(210),this.pack_int32(e);else if(e>=-9223372036854776e3&&e<=9223372036854776e3)this._bufferBuilder.append(211),this.pack_int64(e);else if(e>=0&&e<=18446744073709552e3)this._bufferBuilder.append(207),this.pack_uint64(e);else throw new Error("Invalid integer")}pack_double(e){let n=0;e<0&&(n=1,e=-e);const r=Math.floor(Math.log(e)/Math.LN2),s=e/2**r-1,i=Math.floor(s*2**52),o=2**32,l=n<<31|r+1023<<20|i/o&1048575,c=i%o;this._bufferBuilder.append(203),this.pack_int32(l),this.pack_int32(c)}pack_object(e){const n=Object.keys(e),r=n.length;if(r<=15)this.pack_uint8(128+r);else if(r<=65535)this._bufferBuilder.append(222),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(223),this.pack_uint32(r);else throw new Error("Invalid length");const s=i=>{if(i<n.length){const o=n[i];if(e.hasOwnProperty(o)){this.pack(o);const l=this.pack(e[o]);if(l instanceof Promise)return l.then(()=>s(i+1))}return s(i+1)}};return s(0)}pack_uint8(e){this._bufferBuilder.append(e)}pack_uint16(e){this._bufferBuilder.append(e>>8),this._bufferBuilder.append(e&255)}pack_uint32(e){const n=e&4294967295;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255)}pack_uint64(e){const n=e/4294967296,r=e%2**32;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}pack_int8(e){this._bufferBuilder.append(e&255)}pack_int16(e){this._bufferBuilder.append((e&65280)>>8),this._bufferBuilder.append(e&255)}pack_int32(e){this._bufferBuilder.append(e>>>24&255),this._bufferBuilder.append((e&16711680)>>>16),this._bufferBuilder.append((e&65280)>>>8),this._bufferBuilder.append(e&255)}pack_int64(e){const n=Math.floor(e/4294967296),r=e%2**32;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}constructor(){this._bufferBuilder=new CL,this._textEncoder=new TextEncoder}}let AS=!0,PS=!0;function ol(t,e,n){const r=t.match(e);return r&&r.length>=n&&parseFloat(r[n],10)}function to(t,e,n){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,s=r.addEventListener;r.addEventListener=function(o,l){if(o!==e)return s.apply(this,arguments);const c=d=>{const u=n(d);u&&(l.handleEvent?l.handleEvent(u):l(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(l,c),s.apply(this,[o,c])};const i=r.removeEventListener;r.removeEventListener=function(o,l){if(o!==e||!this._eventMap||!this._eventMap[e])return i.apply(this,arguments);if(!this._eventMap[e].has(l))return i.apply(this,arguments);const c=this._eventMap[e].get(l);return this._eventMap[e].delete(l),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,i.apply(this,[o,c])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function PL(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(AS=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function OL(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(PS=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function OS(){if(typeof window=="object"){if(AS)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function pm(t,e){PS&&console.warn(t+" is deprecated, please use "+e+" instead.")}function LL(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const r=n.userAgentData.brands.find(s=>s.brand==="Chromium");if(r)return{browser:"chrome",version:parseInt(r.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(ol(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(ol(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(ol(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=ol(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function Dx(t){return Object.prototype.toString.call(t)==="[object Object]"}function LS(t){return Dx(t)?Object.keys(t).reduce(function(e,n){const r=Dx(t[n]),s=r?LS(t[n]):t[n],i=r&&!Object.keys(s).length;return s===void 0||i?e:Object.assign(e,{[n]:s})},{}):t}function lg(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?lg(t,t.get(e[r]),n):r.endsWith("Ids")&&e[r].forEach(s=>{lg(t,t.get(s),n)})}))}function Mx(t,e,n){const r=n?"outbound-rtp":"inbound-rtp",s=new Map;if(e===null)return s;const i=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&i.push(o)}),i.forEach(o=>{t.forEach(l=>{l.type===r&&l.trackId===o.id&&lg(t,l,s)})}),s}const Nx=OS;function DS(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const r=function(l){if(typeof l!="object"||l.mandatory||l.optional)return l;const c={};return Object.keys(l).forEach(d=>{if(d==="require"||d==="advanced"||d==="mediaSource")return;const u=typeof l[d]=="object"?l[d]:{ideal:l[d]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const p=function(f,b){return f?f+b.charAt(0).toUpperCase()+b.slice(1):b==="deviceId"?"sourceId":b};if(u.ideal!==void 0){c.optional=c.optional||[];let f={};typeof u.ideal=="number"?(f[p("min",d)]=u.ideal,c.optional.push(f),f={},f[p("max",d)]=u.ideal,c.optional.push(f)):(f[p("",d)]=u.ideal,c.optional.push(f))}u.exact!==void 0&&typeof u.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[p("",d)]=u.exact):["min","max"].forEach(f=>{u[f]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[p(f,d)]=u[f])})}),l.advanced&&(c.optional=(c.optional||[]).concat(l.advanced)),c},s=function(l,c){if(e.version>=61)return c(l);if(l=JSON.parse(JSON.stringify(l)),l&&typeof l.audio=="object"){const d=function(u,p,f){p in u&&!(f in u)&&(u[f]=u[p],delete u[p])};l=JSON.parse(JSON.stringify(l)),d(l.audio,"autoGainControl","googAutoGainControl"),d(l.audio,"noiseSuppression","googNoiseSuppression"),l.audio=r(l.audio)}if(l&&typeof l.video=="object"){let d=l.video.facingMode;d=d&&(typeof d=="object"?d:{ideal:d});const u=e.version<66;if(d&&(d.exact==="user"||d.exact==="environment"||d.ideal==="user"||d.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete l.video.facingMode;let p;if(d.exact==="environment"||d.ideal==="environment"?p=["back","rear"]:(d.exact==="user"||d.ideal==="user")&&(p=["front"]),p)return n.mediaDevices.enumerateDevices().then(f=>{f=f.filter(I=>I.kind==="videoinput");let b=f.find(I=>p.some(k=>I.label.toLowerCase().includes(k)));return!b&&f.length&&p.includes("back")&&(b=f[f.length-1]),b&&(l.video.deviceId=d.exact?{exact:b.deviceId}:{ideal:b.deviceId}),l.video=r(l.video),Nx("chrome: "+JSON.stringify(l)),c(l)})}l.video=r(l.video)}return Nx("chrome: "+JSON.stringify(l)),c(l)},i=function(l){return e.version>=64?l:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[l.name]||l.name,message:l.message,constraint:l.constraint||l.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(l,c,d){s(l,u=>{n.webkitGetUserMedia(u,c,p=>{d&&d(i(p))})})};if(n.getUserMedia=o.bind(n),n.mediaDevices.getUserMedia){const l=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return s(c,d=>l(d).then(u=>{if(d.audio&&!u.getAudioTracks().length||d.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(p=>{p.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(i(u))))}}}function MS(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function NS(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",s=>{let i;t.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(l=>l.track&&l.track.id===s.track.id):i={track:s.track};const o=new Event("track");o.track=s.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[r.stream],this.dispatchEvent(o)}),r.stream.getTracks().forEach(s=>{let i;t.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(l=>l.track&&l.track.id===s.id):i={track:s};const o=new Event("track");o.track=s,o.receiver=i,o.transceiver={receiver:i},o.streams=[r.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else to(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function jS(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(s,i){return{track:i,get dtmf(){return this._dtmf===void 0&&(i.kind==="audio"?this._dtmf=s.createDTMFSender(i):this._dtmf=null),this._dtmf},_pc:s}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const s=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(l,c){let d=s.apply(this,arguments);return d||(d=e(this,l),this._senders.push(d)),d};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(l){i.apply(this,arguments);const c=this._senders.indexOf(l);c!==-1&&this._senders.splice(c,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],n.apply(this,[i]),i.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach(o=>{const l=this._senders.find(c=>c.track===o);l&&this._senders.splice(this._senders.indexOf(l),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function $S(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=n.apply(this,[]);return i.forEach(o=>o._pc=this),i});const r=t.RTCPeerConnection.prototype.addTrack;r&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=r.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){const i=this;return this._pc.getStats().then(o=>Mx(o,i.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const s=n.apply(this,[]);return s.forEach(i=>i._pc=this),s}),to(t,"track",r=>(r.receiver._pc=r.srcElement,r)),t.RTCRtpReceiver.prototype.getStats=function(){const s=this;return this._pc.getStats().then(i=>Mx(i,s.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const r=arguments[0];let s,i,o;return this.getSenders().forEach(l=>{l.track===r&&(s?o=!0:s=l)}),this.getReceivers().forEach(l=>(l.track===r&&(i?o=!0:i=l),l.track===r)),o||s&&i?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function FS(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,l){if(!l)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[l.id]?this._shimmedLocalStreams[l.id].indexOf(c)===-1&&this._shimmedLocalStreams[l.id].push(c):this._shimmedLocalStreams[l.id]=[l,c],c};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(d=>{if(this.getSenders().find(p=>p.track===d))throw new DOMException("Track already exists.","InvalidAccessError")});const l=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(d=>l.indexOf(d)===-1);this._shimmedLocalStreams[o.id]=[o].concat(c)};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],r.apply(this,arguments)};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(l=>{const c=this._shimmedLocalStreams[l].indexOf(o);c!==-1&&this._shimmedLocalStreams[l].splice(c,1),this._shimmedLocalStreams[l].length===1&&delete this._shimmedLocalStreams[l]}),s.apply(this,arguments)}}function US(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return FS(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const u=n.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(p=>this._reverseStreams[p.id])};const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(p=>{if(this.getSenders().find(b=>b.track===p))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const p=new t.MediaStream(u.getTracks());this._streams[u.id]=p,this._reverseStreams[p.id]=u,u=p}r.apply(this,[u])};const s=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},t.RTCPeerConnection.prototype.addTrack=function(u,p){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const f=[].slice.call(arguments,1);if(f.length!==1||!f[0].getTracks().find(k=>k===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(k=>k.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const I=this._streams[p.id];if(I)I.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const k=new t.MediaStream([u]);this._streams[p.id]=k,this._reverseStreams[k.id]=p,this.addStream(k)}return this.getSenders().find(k=>k.track===u)};function i(d,u){let p=u.sdp;return Object.keys(d._reverseStreams||[]).forEach(f=>{const b=d._reverseStreams[f],I=d._streams[b.id];p=p.replace(new RegExp(I.id,"g"),b.id)}),new RTCSessionDescription({type:u.type,sdp:p})}function o(d,u){let p=u.sdp;return Object.keys(d._reverseStreams||[]).forEach(f=>{const b=d._reverseStreams[f],I=d._streams[b.id];p=p.replace(new RegExp(b.id,"g"),I.id)}),new RTCSessionDescription({type:u.type,sdp:p})}["createOffer","createAnswer"].forEach(function(d){const u=t.RTCPeerConnection.prototype[d],p={[d](){const f=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[I=>{const k=i(this,I);f[0].apply(null,[k])},I=>{f[1]&&f[1].apply(null,I)},arguments[2]]):u.apply(this,arguments).then(I=>i(this,I))}};t.RTCPeerConnection.prototype[d]=p[d]});const l=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?l.apply(this,arguments):(arguments[0]=o(this,arguments[0]),l.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const d=c.get.apply(this);return d.type===""?d:i(this,d)}}),t.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let f;Object.keys(this._streams).forEach(b=>{this._streams[b].getTracks().find(k=>u.track===k)&&(f=this._streams[b])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function cg(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=t.RTCPeerConnection.prototype[n],s={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=s[n]})}function BS(t,e){to(t,"negotiationneeded",n=>{const r=n.target;if(!((e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return n})}const jx=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:BS,shimAddTrackRemoveTrack:US,shimAddTrackRemoveTrackWithNative:FS,shimGetSendersWithDtmf:jS,shimGetUserMedia:DS,shimMediaStream:MS,shimOnTrack:NS,shimPeerConnection:cg,shimSenderReceiverGetStats:$S},Symbol.toStringTag,{value:"Module"}));function zS(t,e){const n=t&&t.navigator,r=t&&t.MediaStreamTrack;if(n.getUserMedia=function(s,i,o){pm("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(s).then(i,o)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const s=function(o,l,c){l in o&&!(c in o)&&(o[c]=o[l],delete o[l])},i=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),s(o.audio,"autoGainControl","mozAutoGainControl"),s(o.audio,"noiseSuppression","mozNoiseSuppression")),i(o)},r&&r.prototype.getSettings){const o=r.prototype.getSettings;r.prototype.getSettings=function(){const l=o.apply(this,arguments);return s(l,"mozAutoGainControl","autoGainControl"),s(l,"mozNoiseSuppression","noiseSuppression"),l}}if(r&&r.prototype.applyConstraints){const o=r.prototype.applyConstraints;r.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),s(l,"autoGainControl","mozAutoGainControl"),s(l,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[l])}}}}function DL(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,Promise.reject(s)}return r.video===!0?r.video={mediaSource:e}:r.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(r)})}function HS(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function dg(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const i=t.RTCPeerConnection.prototype[s],o={[s](){return arguments[0]=new(s==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[s]=o[s]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[i,o,l]=arguments;return r.apply(this,[i||null]).then(c=>{if(e.version<53&&!o)try{c.forEach(d=>{d.type=n[d.type]||d.type})}catch(d){if(d.name!=="TypeError")throw d;c.forEach((u,p)=>{c.set(p,Object.assign({},u,{type:n[u.type]||u.type}))})}return c}).then(o,l)}}function WS(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=e.apply(this,[]);return s.forEach(i=>i._pc=this),s});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=n.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function GS(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r}),to(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function VS(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){pm("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&n.getTracks().includes(r.track)&&this.removeTrack(r)})})}function YS(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function KS(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const s=r.length>0;s&&r.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=e.apply(this,arguments);if(s){const{sender:o}=i,l=o.getParameters();(!("encodings"in l)||l.encodings.length===1&&Object.keys(l.encodings[0]).length===0)&&(l.encodings=r,o.sendEncodings=r,this.setParametersPromises.push(o.setParameters(l).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return i})}function XS(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const r=e.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function JS(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function QS(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}const $x=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:KS,shimCreateAnswer:QS,shimCreateOffer:JS,shimGetDisplayMedia:DL,shimGetParameters:XS,shimGetUserMedia:zS,shimOnTrack:HS,shimPeerConnection:dg,shimRTCDataChannel:YS,shimReceiverGetStats:GS,shimRemoveStream:VS,shimSenderGetStats:WS},Symbol.toStringTag,{value:"Module"}));function qS(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(s=>e.call(this,s,r)),r.getVideoTracks().forEach(s=>e.call(this,s,r))},t.RTCPeerConnection.prototype.addTrack=function(r,...s){return s&&s.forEach(i=>{this._localStreams?this._localStreams.includes(i)||this._localStreams.push(i):this._localStreams=[i]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(n);if(r===-1)return;this._localStreams.splice(r,1);const s=n.getTracks();this.getSenders().forEach(i=>{s.includes(i.track)&&this.removeTrack(i)})})}}function ZS(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(s=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(s))return;this._remoteStreams.push(s);const i=new Event("addstream");i.stream=s,this.dispatchEvent(i)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){s.streams.forEach(i=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(i)>=0)return;r._remoteStreams.push(i);const o=new Event("addstream");o.stream=i,r.dispatchEvent(o)})}),e.apply(r,arguments)}}}function e2(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,r=e.createAnswer,s=e.setLocalDescription,i=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(d,u){const p=arguments.length>=2?arguments[2]:arguments[0],f=n.apply(this,[p]);return u?(f.then(d,u),Promise.resolve()):f},e.createAnswer=function(d,u){const p=arguments.length>=2?arguments[2]:arguments[0],f=r.apply(this,[p]);return u?(f.then(d,u),Promise.resolve()):f};let l=function(c,d,u){const p=s.apply(this,[c]);return u?(p.then(d,u),Promise.resolve()):p};e.setLocalDescription=l,l=function(c,d,u){const p=i.apply(this,[c]);return u?(p.then(d,u),Promise.resolve()):p},e.setRemoteDescription=l,l=function(c,d,u){const p=o.apply(this,[c]);return u?(p.then(d,u),Promise.resolve()):p},e.addIceCandidate=l}function t2(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,r=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=s=>r(n2(s))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(r,s,i){e.mediaDevices.getUserMedia(r).then(s,i)}).bind(e))}function n2(t){return t&&t.video!==void 0?Object.assign({},t,{video:LS(t.video)}):t}function r2(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(r,s){if(r&&r.iceServers){const i=[];for(let o=0;o<r.iceServers.length;o++){let l=r.iceServers[o];l.urls===void 0&&l.url?(pm("RTCIceServer.url","RTCIceServer.urls"),l=JSON.parse(JSON.stringify(l)),l.urls=l.url,delete l.url,i.push(l)):i.push(r.iceServers[o])}r.iceServers=i}return new e(r,s)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function s2(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function i2(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):r.offerToReceiveAudio===!0&&!s&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const i=this.getTransceivers().find(o=>o.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveVideo===!0&&!i&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function o2(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}const Fx=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:o2,shimCallbacksAPI:e2,shimConstraints:n2,shimCreateOfferLegacy:i2,shimGetUserMedia:t2,shimLocalStreamsAPI:qS,shimRTCIceServerUrls:r2,shimRemoteStreamsAPI:ZS,shimTrackEventTransceiver:s2},Symbol.toStringTag,{value:"Module"}));var a2={exports:{}};(function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},e.splitSections=function(n){return n.split(`
m=`).map((s,i)=>(i>0?"m="+s:s).trim()+`\r
`)},e.getDescription=function(n){const r=e.splitSections(n);return r&&r[0]},e.getMediaSections=function(n){const r=e.splitSections(n);return r.shift(),r},e.matchPrefix=function(n,r){return e.splitLines(n).filter(s=>s.indexOf(r)===0)},e.parseCandidate=function(n){let r;n.indexOf("a=candidate:")===0?r=n.substring(12).split(" "):r=n.substring(10).split(" ");const s={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let i=8;i<r.length;i+=2)switch(r[i]){case"raddr":s.relatedAddress=r[i+1];break;case"rport":s.relatedPort=parseInt(r[i+1],10);break;case"tcptype":s.tcpType=r[i+1];break;case"ufrag":s.ufrag=r[i+1],s.usernameFragment=r[i+1];break;default:s[r[i]]===void 0&&(s[r[i]]=r[i+1]);break}return s},e.writeCandidate=function(n){const r=[];r.push(n.foundation);const s=n.component;s==="rtp"?r.push(1):s==="rtcp"?r.push(2):r.push(s),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const i=n.type;return r.push("typ"),r.push(i),i!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let r=n.substring(9).split(" ");const s={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),s.name=r[0],s.clockRate=parseInt(r[1],10),s.channels=r.length===3?parseInt(r[2],10):1,s.numChannels=s.channels,s},e.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const s=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(s!==1?"/"+s:"")+`\r
`},e.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const r={};let s;const i=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<i.length;o++)s=i[o].trim().split("="),r[s[0].trim()]=s[1];return r},e.writeFmtp=function(n){let r="",s=n.payloadType;if(n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const i=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?i.push(o+"="+n.parameters[o]):i.push(o)}),r+="a=fmtp:"+s+" "+i.join(";")+`\r
`}return r},e.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},e.writeRtcpFb=function(n){let r="",s=n.payloadType;return n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(i=>{r+="a=rtcp-fb:"+s+" "+i.type+(i.parameter&&i.parameter.length?" "+i.parameter:"")+`\r
`}),r},e.parseSsrcMedia=function(n){const r=n.indexOf(" "),s={ssrc:parseInt(n.substring(7,r),10)},i=n.indexOf(":",r);return i>-1?(s.attribute=n.substring(r+1,i),s.value=n.substring(i+1)):s.attribute=n.substring(r+1),s},e.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(s=>parseInt(s,10))}},e.getMid=function(n){const r=e.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},e.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:e.matchPrefix(n+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,r){let s="a=setup:"+r+`\r
`;return n.fingerprints.forEach(i=>{s+="a=fingerprint:"+i.algorithm+" "+i.value+`\r
`}),s},e.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,r){return e.matchPrefix(n+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,r){const s=e.matchPrefix(n+r,"a=ice-ufrag:")[0],i=e.matchPrefix(n+r,"a=ice-pwd:")[0];return s&&i?{usernameFragment:s.substring(12),password:i.substring(10)}:null},e.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},e.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=e.splitLines(n)[0].split(" ");r.profile=i[2];for(let l=3;l<i.length;l++){const c=i[l],d=e.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(d){const u=e.parseRtpMap(d),p=e.matchPrefix(n,"a=fmtp:"+c+" ");switch(u.parameters=p.length?e.parseFmtp(p[0]):{},u.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),r.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(l=>{r.headerExtensions.push(e.parseExtmap(l))});const o=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(l=>{o.forEach(c=>{l.rtcpFeedback.find(u=>u.type===c.type&&u.parameter===c.parameter)||l.rtcpFeedback.push(c)})}),r},e.writeRtpDescription=function(n,r){let s="";s+="m="+n+" ",s+=r.codecs.length>0?"9":"0",s+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",s+=r.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,s+=`c=IN IP4 0.0.0.0\r
`,s+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(o=>{s+=e.writeRtpMap(o),s+=e.writeFmtp(o),s+=e.writeRtcpFb(o)});let i=0;return r.codecs.forEach(o=>{o.maxptime>i&&(i=o.maxptime)}),i>0&&(s+="a=maxptime:"+i+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(o=>{s+=e.writeExtmap(o)}),s},e.parseRtpEncodingParameters=function(n){const r=[],s=e.parseRtpParameters(n),i=s.fecMechanisms.indexOf("RED")!==-1,o=s.fecMechanisms.indexOf("ULPFEC")!==-1,l=e.matchPrefix(n,"a=ssrc:").map(f=>e.parseSsrcMedia(f)).filter(f=>f.attribute==="cname"),c=l.length>0&&l[0].ssrc;let d;const u=e.matchPrefix(n,"a=ssrc-group:FID").map(f=>f.substring(17).split(" ").map(I=>parseInt(I,10)));u.length>0&&u[0].length>1&&u[0][0]===c&&(d=u[0][1]),s.codecs.forEach(f=>{if(f.name.toUpperCase()==="RTX"&&f.parameters.apt){let b={ssrc:c,codecPayloadType:parseInt(f.parameters.apt,10)};c&&d&&(b.rtx={ssrc:d}),r.push(b),i&&(b=JSON.parse(JSON.stringify(b)),b.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},r.push(b))}}),r.length===0&&c&&r.push({ssrc:c});let p=e.matchPrefix(n,"b=");return p.length&&(p[0].indexOf("b=TIAS:")===0?p=parseInt(p[0].substring(7),10):p[0].indexOf("b=AS:")===0?p=parseInt(p[0].substring(5),10)*1e3*.95-50*40*8:p=void 0,r.forEach(f=>{f.maxBitrate=p})),r},e.parseRtcpParameters=function(n){const r={},s=e.matchPrefix(n,"a=ssrc:").map(l=>e.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];s&&(r.cname=s.value,r.ssrc=s.ssrc);const i=e.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=i.length>0,r.compound=i.length===0;const o=e.matchPrefix(n,"a=rtcp-mux");return r.mux=o.length>0,r},e.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},e.parseMsid=function(n){let r;const s=e.matchPrefix(n,"a=msid:");if(s.length===1)return r=s[0].substring(7).split(" "),{stream:r[0],track:r[1]};const i=e.matchPrefix(n,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(i.length>0)return r=i[0].value.split(" "),{stream:r[0],track:r[1]}},e.parseSctpDescription=function(n){const r=e.parseMLine(n),s=e.matchPrefix(n,"a=max-message-size:");let i;s.length>0&&(i=parseInt(s[0].substring(19),10)),isNaN(i)&&(i=65536);const o=e.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:r.fmt,maxMessageSize:i};const l=e.matchPrefix(n,"a=sctpmap:");if(l.length>0){const c=l[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:i}}},e.writeSctpDescription=function(n,r){let s=[];return n.protocol!=="DTLS/SCTP"?s=["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:s=["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&s.push("a=max-message-size:"+r.maxMessageSize+`\r
`),s.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,r,s){let i;const o=r!==void 0?r:2;return n?i=n:i=e.generateSessionId(),`v=0\r
o=`+(s||"thisisadapterortc")+" "+i+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,r){const s=e.splitLines(n);for(let i=0;i<s.length;i++)switch(s[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[i].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const s=e.splitLines(n)[0].substring(2).split(" ");return{kind:s[0],port:parseInt(s[1],10),protocol:s[2],fmt:s.slice(3).join(" ")}},e.parseOLine=function(n){const s=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:s[0],sessionId:s[1],sessionVersion:parseInt(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=e.splitLines(n);for(let s=0;s<r.length;s++)if(r[s].length<2||r[s].charAt(1)!=="=")return!1;return!0},t.exports=e})(a2);var l2=a2.exports;const Go=r_(l2),ML=V2({__proto__:null,default:Go},[l2]);function Fd(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const s=new e(r),i=Go.parseCandidate(r.candidate);for(const o in i)o in s||Object.defineProperty(s,o,{value:i[o]});return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new e(r)},t.RTCIceCandidate.prototype=e.prototype,to(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function ug(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||to(t,"icecandidate",e=>{if(e.candidate){const n=Go.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function Ud(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(l){if(!l||!l.sdp)return!1;const c=Go.splitSections(l.sdp);return c.shift(),c.some(d=>{const u=Go.parseMLine(d);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},r=function(l){const c=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const d=parseInt(c[1],10);return d!==d?-1:d},s=function(l){let c=65536;return e.browser==="firefox"&&(e.version<57?l===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},i=function(l,c){let d=65536;e.browser==="firefox"&&e.version===57&&(d=65535);const u=Go.matchPrefix(l.sdp,"a=max-message-size:");return u.length>0?d=parseInt(u[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(d=2147483637),d},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=r(arguments[0]),d=s(c),u=i(arguments[0],c);let p;d===0&&u===0?p=Number.POSITIVE_INFINITY:d===0||u===0?p=Math.max(d,u):p=Math.min(d,u);const f={};Object.defineProperty(f,"maxMessageSize",{get(){return p}}),this._sctp=f}return o.apply(this,arguments)}}function Bd(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(r,s){const i=r.send;r.send=function(){const l=arguments[0],c=l.length||l.size||l.byteLength;if(r.readyState==="open"&&s.sctp&&c>s.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+s.sctp.maxMessageSize+" bytes)");return i.apply(r,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const s=n.apply(this,arguments);return e(s,this),s},to(t,"datachannel",r=>(e(r.channel,r.target),r))}function fg(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=s=>{const i=s.target;if(i._lastConnectionState!==i.connectionState){i._lastConnectionState=i.connectionState;const o=new Event("connectionstatechange",s);i.dispatchEvent(o)}return s},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function hg(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(s){if(s&&s.sdp&&s.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i=s.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&s instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:s.type,sdp:i}):s.sdp=i}return n.apply(this,arguments)}}function zd(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Hd(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let s=arguments[0]||{};if(typeof s!="object"||s.type&&s.sdp)return n.apply(this,arguments);if(s={type:s.type,sdp:s.sdp},!s.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":s.type="offer";break;default:s.type="answer";break}return s.sdp||s.type!=="offer"&&s.type!=="answer"?n.apply(this,[s]):(s.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}const NL=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:hg,shimAddIceCandidateNullOrEmpty:zd,shimConnectionState:fg,shimMaxMessageSize:Ud,shimParameterlessSetLocalDescription:Hd,shimRTCIceCandidate:Fd,shimRTCIceCandidateRelayProtocol:ug,shimSendThrowTypeError:Bd},Symbol.toStringTag,{value:"Module"}));function jL({window:t}={},e={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const n=OS,r=LL(t),s={browserDetails:r,commonShim:NL,extractVersion:ol,disableLog:PL,disableWarnings:OL,sdp:ML};switch(r.browser){case"chrome":if(!jx||!cg||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),s;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),s;n("adapter.js shimming chrome."),s.browserShim=jx,zd(t,r),Hd(t),DS(t,r),MS(t),cg(t,r),NS(t),US(t,r),jS(t),$S(t),BS(t,r),Fd(t),ug(t),fg(t),Ud(t,r),Bd(t),hg(t,r);break;case"firefox":if(!$x||!dg||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),s;n("adapter.js shimming firefox."),s.browserShim=$x,zd(t,r),Hd(t),zS(t,r),dg(t,r),HS(t),VS(t),WS(t),GS(t),YS(t),KS(t),XS(t),JS(t),QS(t),Fd(t),fg(t),Ud(t,r),Bd(t);break;case"safari":if(!Fx||!e.shimSafari)return n("Safari shim is not included in this adapter release."),s;n("adapter.js shimming safari."),s.browserShim=Fx,zd(t,r),Hd(t),r2(t),i2(t),e2(t),qS(t),ZS(t),s2(t),t2(t),o2(t),Fd(t),ug(t),Ud(t,r),Bd(t),hg(t,r);break;default:n("Unsupported browser!");break}return s}const Ux=jL({window:typeof window>"u"?void 0:window});function no(t,e,n,r){Object.defineProperty(t,e,{get:n,set:r,enumerable:!0,configurable:!0})}class c2{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=e=>{const n=[],r=e.byteLength,s=Math.ceil(r/this.chunkedMTU);let i=0,o=0;for(;o<r;){const l=Math.min(r,o+this.chunkedMTU),c=e.slice(o,l),d={__peerData:this._dataCount,n:i,data:c,total:s};n.push(d),o=l,i++}return this._dataCount++,n}}}function $L(t){let e=0;for(const s of t)e+=s.byteLength;const n=new Uint8Array(e);let r=0;for(const s of t)n.set(s,r),r+=s.byteLength;return n}const Hh=Ux.default||Ux,qa=new class{isWebRTCSupported(){return typeof RTCPeerConnection<"u"}isBrowserSupported(){const t=this.getBrowser(),e=this.getVersion();return this.supportedBrowsers.includes(t)?t==="chrome"?e>=this.minChromeVersion:t==="firefox"?e>=this.minFirefoxVersion:t==="safari"?!this.isIOS&&e>=this.minSafariVersion:!1:!1}getBrowser(){return Hh.browserDetails.browser}getVersion(){return Hh.browserDetails.version||0}isUnifiedPlanSupported(){const t=this.getBrowser(),e=Hh.browserDetails.version||0;if(t==="chrome"&&e<this.minChromeVersion)return!1;if(t==="firefox"&&e>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let n,r=!1;try{n=new RTCPeerConnection,n.addTransceiver("audio"),r=!0}catch{}finally{n&&n.close()}return r}toString(){return`Supports:
    browser:${this.getBrowser()}
    version:${this.getVersion()}
    isIOS:${this.isIOS}
    isWebRTCSupported:${this.isWebRTCSupported()}
    isBrowserSupported:${this.isBrowserSupported()}
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS=typeof navigator<"u"?["iPad","iPhone","iPod"].includes(navigator.platform):!1,this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},FL=t=>!t||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(t),d2=()=>Math.random().toString(36).slice(2),Bx={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};class UL extends c2{noop(){}blobToArrayBuffer(e,n){const r=new FileReader;return r.onload=function(s){s.target&&n(s.target.result)},r.readAsArrayBuffer(e),r}binaryStringToArrayBuffer(e){const n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r)&255;return n.buffer}isSecure(){return location.protocol==="https:"}constructor(...e){super(...e),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=Bx,this.browser=qa.getBrowser(),this.browserVersion=qa.getVersion(),this.pack=RS,this.unpack=kS,this.supports=function(){const n={browser:qa.isBrowserSupported(),webRTC:qa.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!n.webRTC)return n;let r;try{r=new RTCPeerConnection(Bx),n.audioVideo=!0;let s;try{s=r.createDataChannel("_PEERJSTEST",{ordered:!0}),n.data=!0,n.reliable=!!s.ordered;try{s.binaryType="blob",n.binaryBlob=!qa.isIOS}catch{}}catch{}finally{s&&s.close()}}catch{}finally{r&&r.close()}return n}(),this.validateId=FL,this.randomToken=d2}}const Un=new UL,BL="PeerJS: ";class zL{get logLevel(){return this._logLevel}set logLevel(e){this._logLevel=e}log(...e){this._logLevel>=3&&this._print(3,...e)}warn(...e){this._logLevel>=2&&this._print(2,...e)}error(...e){this._logLevel>=1&&this._print(1,...e)}setLogFunction(e){this._print=e}_print(e,...n){const r=[BL,...n];for(const s in r)r[s]instanceof Error&&(r[s]="("+r[s].name+") "+r[s].message);e>=3?console.log(...r):e>=2?console.warn("WARNING",...r):e>=1&&console.error("ERROR",...r)}constructor(){this._logLevel=0}}var Ae=new zL,gm={},HL=Object.prototype.hasOwnProperty,Ln="~";function rc(){}Object.create&&(rc.prototype=Object.create(null),new rc().__proto__||(Ln=!1));function WL(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function u2(t,e,n,r,s){if(typeof n!="function")throw new TypeError("The listener must be a function");var i=new WL(n,r||t,s),o=Ln?Ln+e:e;return t._events[o]?t._events[o].fn?t._events[o]=[t._events[o],i]:t._events[o].push(i):(t._events[o]=i,t._eventsCount++),t}function Wd(t,e){--t._eventsCount===0?t._events=new rc:delete t._events[e]}function Tn(){this._events=new rc,this._eventsCount=0}Tn.prototype.eventNames=function(){var e=[],n,r;if(this._eventsCount===0)return e;for(r in n=this._events)HL.call(n,r)&&e.push(Ln?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(n)):e};Tn.prototype.listeners=function(e){var n=Ln?Ln+e:e,r=this._events[n];if(!r)return[];if(r.fn)return[r.fn];for(var s=0,i=r.length,o=new Array(i);s<i;s++)o[s]=r[s].fn;return o};Tn.prototype.listenerCount=function(e){var n=Ln?Ln+e:e,r=this._events[n];return r?r.fn?1:r.length:0};Tn.prototype.emit=function(e,n,r,s,i,o){var l=Ln?Ln+e:e;if(!this._events[l])return!1;var c=this._events[l],d=arguments.length,u,p;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,n),!0;case 3:return c.fn.call(c.context,n,r),!0;case 4:return c.fn.call(c.context,n,r,s),!0;case 5:return c.fn.call(c.context,n,r,s,i),!0;case 6:return c.fn.call(c.context,n,r,s,i,o),!0}for(p=1,u=new Array(d-1);p<d;p++)u[p-1]=arguments[p];c.fn.apply(c.context,u)}else{var f=c.length,b;for(p=0;p<f;p++)switch(c[p].once&&this.removeListener(e,c[p].fn,void 0,!0),d){case 1:c[p].fn.call(c[p].context);break;case 2:c[p].fn.call(c[p].context,n);break;case 3:c[p].fn.call(c[p].context,n,r);break;case 4:c[p].fn.call(c[p].context,n,r,s);break;default:if(!u)for(b=1,u=new Array(d-1);b<d;b++)u[b-1]=arguments[b];c[p].fn.apply(c[p].context,u)}}return!0};Tn.prototype.on=function(e,n,r){return u2(this,e,n,r,!1)};Tn.prototype.once=function(e,n,r){return u2(this,e,n,r,!0)};Tn.prototype.removeListener=function(e,n,r,s){var i=Ln?Ln+e:e;if(!this._events[i])return this;if(!n)return Wd(this,i),this;var o=this._events[i];if(o.fn)o.fn===n&&(!s||o.once)&&(!r||o.context===r)&&Wd(this,i);else{for(var l=0,c=[],d=o.length;l<d;l++)(o[l].fn!==n||s&&!o[l].once||r&&o[l].context!==r)&&c.push(o[l]);c.length?this._events[i]=c.length===1?c[0]:c:Wd(this,i)}return this};Tn.prototype.removeAllListeners=function(e){var n;return e?(n=Ln?Ln+e:e,this._events[n]&&Wd(this,n)):(this._events=new rc,this._eventsCount=0),this};Tn.prototype.off=Tn.prototype.removeListener;Tn.prototype.addListener=Tn.prototype.on;Tn.prefixed=Ln;Tn.EventEmitter=Tn;gm=Tn;var ro={};no(ro,"ConnectionType",()=>si);no(ro,"PeerErrorType",()=>Xt);no(ro,"BaseConnectionErrorType",()=>pg);no(ro,"DataConnectionErrorType",()=>mm);no(ro,"SerializationType",()=>wf);no(ro,"SocketEventType",()=>Ws);no(ro,"ServerMessageType",()=>_n);var si=function(t){return t.Data="data",t.Media="media",t}({}),Xt=function(t){return t.BrowserIncompatible="browser-incompatible",t.Disconnected="disconnected",t.InvalidID="invalid-id",t.InvalidKey="invalid-key",t.Network="network",t.PeerUnavailable="peer-unavailable",t.SslUnavailable="ssl-unavailable",t.ServerError="server-error",t.SocketError="socket-error",t.SocketClosed="socket-closed",t.UnavailableID="unavailable-id",t.WebRTC="webrtc",t}({}),pg=function(t){return t.NegotiationFailed="negotiation-failed",t.ConnectionClosed="connection-closed",t}({}),mm=function(t){return t.NotOpenYet="not-open-yet",t.MessageToBig="message-too-big",t}({}),wf=function(t){return t.Binary="binary",t.BinaryUTF8="binary-utf8",t.JSON="json",t.None="raw",t}({}),Ws=function(t){return t.Message="message",t.Disconnected="disconnected",t.Error="error",t.Close="close",t}({}),_n=function(t){return t.Heartbeat="HEARTBEAT",t.Candidate="CANDIDATE",t.Offer="OFFER",t.Answer="ANSWER",t.Open="OPEN",t.Error="ERROR",t.IdTaken="ID-TAKEN",t.InvalidKey="INVALID-KEY",t.Leave="LEAVE",t.Expire="EXPIRE",t}({});const f2="1.5.5";class GL extends gm.EventEmitter{constructor(e,n,r,s,i,o=5e3){super(),this.pingInterval=o,this._disconnected=!0,this._messagesQueue=[];const l=e?"wss://":"ws://";this._baseUrl=l+n+":"+r+s+"peerjs?key="+i}start(e,n){this._id=e;const r=`${this._baseUrl}&id=${e}&token=${n}`;this._socket||!this._disconnected||(this._socket=new WebSocket(r+"&version="+f2),this._disconnected=!1,this._socket.onmessage=s=>{let i;try{i=JSON.parse(s.data),Ae.log("Server message received:",i)}catch{Ae.log("Invalid server message",s.data);return}this.emit(Ws.Message,i)},this._socket.onclose=s=>{this._disconnected||(Ae.log("Socket closed.",s),this._cleanup(),this._disconnected=!0,this.emit(Ws.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),Ae.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen()){Ae.log("Cannot send heartbeat, because socket closed");return}const e=JSON.stringify({type:_n.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&this._socket.readyState===1}_sendQueuedMessages(){const e=[...this._messagesQueue];this._messagesQueue=[];for(const n of e)this.send(n)}send(e){if(this._disconnected)return;if(!this._id){this._messagesQueue.push(e);return}if(!e.type){this.emit(Ws.Error,"Invalid message");return}if(!this._wsOpen())return;const n=JSON.stringify(e);this._socket.send(n)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}class h2{constructor(e){this.connection=e}startConnection(e){const n=this._startPeerConnection();if(this.connection.peerConnection=n,this.connection.type===si.Media&&e._stream&&this._addTracksToConnection(e._stream,n),e.originator){const r=this.connection,s={ordered:!!e.reliable},i=n.createDataChannel(r.label,s);r._initializeDataChannel(i),this._makeOffer()}else this.handleSDP("OFFER",e.sdp)}_startPeerConnection(){Ae.log("Creating RTCPeerConnection.");const e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e}_setupListeners(e){const n=this.connection.peer,r=this.connection.connectionId,s=this.connection.type,i=this.connection.provider;Ae.log("Listening for ICE candidates."),e.onicecandidate=o=>{!o.candidate||!o.candidate.candidate||(Ae.log(`Received ICE candidates for ${n}:`,o.candidate),i.socket.send({type:_n.Candidate,payload:{candidate:o.candidate,type:s,connectionId:r},dst:n}))},e.oniceconnectionstatechange=()=>{switch(e.iceConnectionState){case"failed":Ae.log("iceConnectionState is failed, closing connections to "+n),this.connection.emitError(pg.NegotiationFailed,"Negotiation of connection to "+n+" failed."),this.connection.close();break;case"closed":Ae.log("iceConnectionState is closed, closing connections to "+n),this.connection.emitError(pg.ConnectionClosed,"Connection to "+n+" closed."),this.connection.close();break;case"disconnected":Ae.log("iceConnectionState changed to disconnected on the connection with "+n);break;case"completed":e.onicecandidate=()=>{};break}this.connection.emit("iceStateChanged",e.iceConnectionState)},Ae.log("Listening for data channel"),e.ondatachannel=o=>{Ae.log("Received data channel");const l=o.channel;i.getConnection(n,r)._initializeDataChannel(l)},Ae.log("Listening for remote stream"),e.ontrack=o=>{Ae.log("Received remote stream");const l=o.streams[0],c=i.getConnection(n,r);if(c.type===si.Media){const d=c;this._addStreamToMediaConnection(l,d)}}}cleanup(){Ae.log("Cleaning up PeerConnection to "+this.connection.peer);const e=this.connection.peerConnection;if(!e)return;this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=()=>{};const n=e.signalingState!=="closed";let r=!1;const s=this.connection.dataChannel;s&&(r=!!s.readyState&&s.readyState!=="closed"),(n||r)&&e.close()}async _makeOffer(){const e=this.connection.peerConnection,n=this.connection.provider;try{const r=await e.createOffer(this.connection.options.constraints);Ae.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),Ae.log("Set localDescription:",r,`for:${this.connection.peer}`);let s={sdp:r,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===si.Data){const i=this.connection;s={...s,label:i.label,reliable:i.reliable,serialization:i.serialization}}n.socket.send({type:_n.Offer,payload:s,dst:this.connection.peer})}catch(s){s!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(n.emitError(Xt.WebRTC,s),Ae.log("Failed to setLocalDescription, ",s))}}catch(r){n.emitError(Xt.WebRTC,r),Ae.log("Failed to createOffer, ",r)}}async _makeAnswer(){const e=this.connection.peerConnection,n=this.connection.provider;try{const r=await e.createAnswer();Ae.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),Ae.log("Set localDescription:",r,`for:${this.connection.peer}`),n.socket.send({type:_n.Answer,payload:{sdp:r,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(s){n.emitError(Xt.WebRTC,s),Ae.log("Failed to setLocalDescription, ",s)}}catch(r){n.emitError(Xt.WebRTC,r),Ae.log("Failed to create answer, ",r)}}async handleSDP(e,n){n=new RTCSessionDescription(n);const r=this.connection.peerConnection,s=this.connection.provider;Ae.log("Setting remote description",n);const i=this;try{await r.setRemoteDescription(n),Ae.log(`Set remoteDescription:${e} for:${this.connection.peer}`),e==="OFFER"&&await i._makeAnswer()}catch(o){s.emitError(Xt.WebRTC,o),Ae.log("Failed to setRemoteDescription, ",o)}}async handleCandidate(e){Ae.log("handleCandidate:",e);try{await this.connection.peerConnection.addIceCandidate(e),Ae.log(`Added ICE candidate for:${this.connection.peer}`)}catch(n){this.connection.provider.emitError(Xt.WebRTC,n),Ae.log("Failed to handleCandidate, ",n)}}_addTracksToConnection(e,n){if(Ae.log(`add tracks from stream ${e.id} to peer connection`),!n.addTrack)return Ae.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(r=>{n.addTrack(r,e)})}_addStreamToMediaConnection(e,n){Ae.log(`add stream ${e.id} to media connection ${n.connectionId}`),n.addStream(e)}}class p2 extends gm.EventEmitter{emitError(e,n){Ae.error("Error:",n),this.emit("error",new VL(`${e}`,n))}}class VL extends Error{constructor(e,n){typeof n=="string"?super(n):(super(),Object.assign(this,n)),this.type=e}}class g2 extends p2{get open(){return this._open}constructor(e,n,r){super(),this.peer=e,this.provider=n,this.options=r,this._open=!1,this.metadata=r.metadata}}var mg;const Il=class Il extends g2{get type(){return si.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(e,n,r){super(e,n,r),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||Il.ID_PREFIX+Un.randomToken(),this._negotiator=new h2(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{Ae.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{Ae.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(e){Ae.log("Receiving stream",e),this._remoteStream=e,super.emit("stream",e)}handleMessage(e){const n=e.type,r=e.payload;switch(e.type){case _n.Answer:this._negotiator.handleSDP(n,r.sdp),this._open=!0;break;case _n.Candidate:this._negotiator.handleCandidate(r.candidate);break;default:Ae.warn(`Unrecognized message type:${n} from peer:${this.peer}`);break}}answer(e,n={}){if(this._localStream){Ae.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=e,n&&n.sdpTransform&&(this.options.sdpTransform=n.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:e});const r=this.provider._getMessages(this.connectionId);for(const s of r)this.handleMessage(s);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit("close"))}};mg=new WeakMap,$a(Il,mg,Il.ID_PREFIX="mc_");let Uu=Il;class YL{constructor(e){this._options=e}_buildRequest(e){const n=this._options.secure?"https":"http",{host:r,port:s,path:i,key:o}=this._options,l=new URL(`${n}://${r}:${s}${i}${o}/${e}`);return l.searchParams.set("ts",`${Date.now()}${Math.random()}`),l.searchParams.set("version",f2),fetch(l.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{const e=await this._buildRequest("id");if(e.status!==200)throw new Error(`Error. Status:${e.status}`);return e.text()}catch(e){Ae.error("Error retrieving ID",e);let n="";throw this._options.path==="/"&&this._options.host!==Un.CLOUD_HOST&&(n=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+n)}}async listAllPeers(){try{const e=await this._buildRequest("peers");if(e.status!==200){if(e.status===401){let n="";throw this._options.host===Un.CLOUD_HOST?n="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":n="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+n)}throw new Error(`Error. Status:${e.status}`)}return e.json()}catch(e){throw Ae.error("Error retrieving list peers",e),new Error("Could not get list peers from the server."+e)}}}var yg,vg;const Ri=class Ri extends g2{get type(){return si.Data}constructor(e,n,r){super(e,n,r),this.connectionId=this.options.connectionId||Ri.ID_PREFIX+d2(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new h2(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{Ae.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=n=>{Ae.log(`DC#${this.connectionId} dc onmessage:`,n.data)},this.dataChannel.onclose=()=>{Ae.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(e){if(e!=null&&e.flush){this.send({__peerData:{type:"close"}});return}this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null),this.open&&(this._open=!1,super.emit("close"))}send(e,n=!1){if(!this.open){this.emitError(mm.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.");return}return this._send(e,n)}async handleMessage(e){const n=e.payload;switch(e.type){case _n.Answer:await this._negotiator.handleSDP(e.type,n.sdp);break;case _n.Candidate:await this._negotiator.handleCandidate(n.candidate);break;default:Ae.warn("Unrecognized message type:",e.type,"from peer:",this.peer);break}}};yg=new WeakMap,vg=new WeakMap,$a(Ri,yg,Ri.ID_PREFIX="dc_"),$a(Ri,vg,Ri.MAX_BUFFERED_AMOUNT=8388608);let Bu=Ri;class ym extends Bu{get bufferSize(){return this._bufferSize}_initializeDataChannel(e){super._initializeDataChannel(e),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",n=>this._handleDataMessage(n))}_bufferedSend(e){(this._buffering||!this._trySend(e))&&(this._buffer.push(e),this._bufferSize=this._buffer.length)}_trySend(e){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>Bu.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(e)}catch(n){return Ae.error(`DC#:${this.connectionId} Error when sending:`,n),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open||this._buffer.length===0)return;const e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(e){if(e!=null&&e.flush){this.send({__peerData:{type:"close"}});return}this._buffer=[],this._bufferSize=0,super.close()}constructor(...e){super(...e),this._buffer=[],this._bufferSize=0,this._buffering=!1}}class Wh extends ym{close(e){super.close(e),this._chunkedData={}}constructor(e,n,r){super(e,n,r),this.chunker=new c2,this.serialization=wf.Binary,this._chunkedData={}}_handleDataMessage({data:e}){const n=kS(e),r=n.__peerData;if(r){if(r.type==="close"){this.close();return}this._handleChunk(n);return}this.emit("data",n)}_handleChunk(e){const n=e.__peerData,r=this._chunkedData[n]||{data:[],count:0,total:e.total};if(r.data[e.n]=new Uint8Array(e.data),r.count++,this._chunkedData[n]=r,r.total===r.count){delete this._chunkedData[n];const s=$L(r.data);this._handleDataMessage({data:s})}}_send(e,n){const r=RS(e);if(r instanceof Promise)return this._send_blob(r);if(!n&&r.byteLength>this.chunker.chunkedMTU){this._sendChunks(r);return}this._bufferedSend(r)}async _send_blob(e){const n=await e;if(n.byteLength>this.chunker.chunkedMTU){this._sendChunks(n);return}this._bufferedSend(n)}_sendChunks(e){const n=this.chunker.chunk(e);Ae.log(`DC#${this.connectionId} Try to send ${n.length} chunks...`);for(const r of n)this.send(r,!0)}}class KL extends ym{_handleDataMessage({data:e}){super.emit("data",e)}_send(e,n){this._bufferedSend(e)}constructor(...e){super(...e),this.serialization=wf.None}}class XL extends ym{_handleDataMessage({data:e}){const n=this.parse(this.decoder.decode(e)),r=n.__peerData;if(r&&r.type==="close"){this.close();return}this.emit("data",n)}_send(e,n){const r=this.encoder.encode(this.stringify(e));if(r.byteLength>=Un.chunkedMTU){this.emitError(mm.MessageToBig,"Message too big for JSON channel");return}this._bufferedSend(r)}constructor(...e){super(...e),this.serialization=wf.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}var xg;const wl=class wl extends p2{get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){const e=Object.create(null);for(const[n,r]of this._connections)e[n]=r;return e}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(e,n){super(),this._serializers={raw:KL,json:XL,binary:Wh,"binary-utf8":Wh,default:Wh},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map;let r;if(e&&e.constructor==Object?n=e:e&&(r=e.toString()),n={debug:0,host:Un.CLOUD_HOST,port:Un.CLOUD_PORT,path:"/",key:wl.DEFAULT_KEY,token:Un.randomToken(),config:Un.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...n},this._options=n,this._serializers={...this._serializers,...this.options.serializers},this._options.host==="/"&&(this._options.host=window.location.hostname),this._options.path&&(this._options.path[0]!=="/"&&(this._options.path="/"+this._options.path),this._options.path[this._options.path.length-1]!=="/"&&(this._options.path+="/")),this._options.secure===void 0&&this._options.host!==Un.CLOUD_HOST?this._options.secure=Un.isSecure():this._options.host==Un.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&Ae.setLogFunction(this._options.logFunction),Ae.logLevel=this._options.debug||0,this._api=new YL(n),this._socket=this._createServerConnection(),!Un.supports.audioVideo&&!Un.supports.data){this._delayedAbort(Xt.BrowserIncompatible,"The current browser does not support WebRTC");return}if(r&&!Un.validateId(r)){this._delayedAbort(Xt.InvalidID,`ID "${r}" is invalid`);return}r?this._initialize(r):this._api.retrieveId().then(s=>this._initialize(s)).catch(s=>this._abort(Xt.ServerError,s))}_createServerConnection(){const e=new GL(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return e.on(Ws.Message,n=>{this._handleMessage(n)}),e.on(Ws.Error,n=>{this._abort(Xt.SocketError,n)}),e.on(Ws.Disconnected,()=>{this.disconnected||(this.emitError(Xt.Network,"Lost connection to server."),this.disconnect())}),e.on(Ws.Close,()=>{this.disconnected||this._abort(Xt.SocketClosed,"Underlying socket is already closed.")}),e}_initialize(e){this._id=e,this.socket.start(e,this._options.token)}_handleMessage(e){const n=e.type,r=e.payload,s=e.src;switch(n){case _n.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case _n.Error:this._abort(Xt.ServerError,r.msg);break;case _n.IdTaken:this._abort(Xt.UnavailableID,`ID "${this.id}" is taken`);break;case _n.InvalidKey:this._abort(Xt.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case _n.Leave:Ae.log(`Received leave message from ${s}`),this._cleanupPeer(s),this._connections.delete(s);break;case _n.Expire:this.emitError(Xt.PeerUnavailable,`Could not connect to peer ${s}`);break;case _n.Offer:{const i=r.connectionId;let o=this.getConnection(s,i);if(o&&(o.close(),Ae.warn(`Offer received for existing Connection ID:${i}`)),r.type===si.Media){const c=new Uu(s,this,{connectionId:i,_payload:r,metadata:r.metadata});o=c,this._addConnection(s,o),this.emit("call",c)}else if(r.type===si.Data){const c=new this._serializers[r.serialization](s,this,{connectionId:i,_payload:r,metadata:r.metadata,label:r.label,serialization:r.serialization,reliable:r.reliable});o=c,this._addConnection(s,o),this.emit("connection",c)}else{Ae.warn(`Received malformed connection type:${r.type}`);return}const l=this._getMessages(i);for(const c of l)o.handleMessage(c);break}default:{if(!r){Ae.warn(`You received a malformed message from ${s} of type ${n}`);return}const i=r.connectionId,o=this.getConnection(s,i);o&&o.peerConnection?o.handleMessage(e):i?this._storeMessage(i,e):Ae.warn("You received an unrecognized message:",e);break}}}_storeMessage(e,n){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(n)}_getMessages(e){const n=this._lostMessages.get(e);return n?(this._lostMessages.delete(e),n):[]}connect(e,n={}){if(n={serialization:"default",...n},this.disconnected){Ae.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(Xt.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}const r=new this._serializers[n.serialization](e,this,n);return this._addConnection(e,r),r}call(e,n,r={}){if(this.disconnected){Ae.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(Xt.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!n){Ae.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}const s=new Uu(e,this,{...r,_stream:n});return this._addConnection(e,s),s}_addConnection(e,n){Ae.log(`add connection ${n.type}:${n.connectionId} to peerId:${e}`),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(n)}_removeConnection(e){const n=this._connections.get(e.peer);if(n){const r=n.indexOf(e);r!==-1&&n.splice(r,1)}this._lostMessages.delete(e.connectionId)}getConnection(e,n){const r=this._connections.get(e);if(!r)return null;for(const s of r)if(s.connectionId===n)return s;return null}_delayedAbort(e,n){setTimeout(()=>{this._abort(e,n)},0)}_abort(e,n){Ae.error("Aborting!"),this.emitError(e,n),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||(Ae.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))}_cleanup(){for(const e of this._connections.keys())this._cleanupPeer(e),this._connections.delete(e);this.socket.removeAllListeners()}_cleanupPeer(e){const n=this._connections.get(e);if(n)for(const r of n)r.close()}disconnect(){if(this.disconnected)return;const e=this.id;Ae.log(`Disconnect peer with ID:${e}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit("disconnected",e)}reconnect(){if(this.disconnected&&!this.destroyed)Ae.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)Ae.error("In a hurry? We're still trying to make the initial connection!");else throw new Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`)}}listAllPeers(e=n=>{}){this._api.listAllPeers().then(n=>e(n)).catch(n=>this._abort(Xt.ServerError,n))}};xg=new WeakMap,$a(wl,xg,wl.DEFAULT_KEY="peerjs");let gg=wl;var m2=gg;class y2{constructor(){un(this,"peer",null);un(this,"conn",null);un(this,"isHost",!1);un(this,"messageCallback",null);un(this,"connectionCallback",null);un(this,"closeCallback",null)}async connect(e){return this.peer=new m2,new Promise((n,r)=>{if(!this.peer)return r("Peer not initialized");this.peer.on("open",s=>{console.log("My Peer ID is:",s),e?(this.isHost=!1,this.connectToPeer(e),n(s)):(this.isHost=!0,this.peer.on("connection",i=>{console.log("Incoming connection..."),this.setupConnection(i)}),n(s))}),this.peer.on("error",s=>{console.error(s),r(s)})})}connectToPeer(e){if(!this.peer)return;const n=this.peer.connect(e);this.setupConnection(n)}setupConnection(e){this.conn=e,e.on("open",()=>{console.log("Connection established!"),this.connectionCallback&&this.connectionCallback()}),e.on("data",n=>{this.messageCallback&&this.messageCallback(n)}),e.on("close",()=>{console.log("Connection closed"),this.closeCallback&&this.closeCallback()}),e.on("error",n=>console.error("Connection Error:",n))}onConnection(e){this.connectionCallback=e}onClose(e){this.closeCallback=e}isConnected(){return this.conn!==null&&this.conn.open}send(e){this.conn&&this.conn.open?this.conn.send(e):console.warn("Connection not open, cannot send message")}onMessage(e){this.messageCallback=e}disconnect(){var e,n;(e=this.conn)==null||e.close(),(n=this.peer)==null||n.destroy()}}const JL=({gameMode:t,targetRoomId:e,playerClass:n,onGameStart:r,onBack:s})=>{const[i,o]=A.useState(""),[l,c]=A.useState(!1),[d,u]=A.useState(!0),[p,f]=A.useState(null),[b,I]=A.useState(!1),[k,F]=A.useState(null),[x,v]=A.useState(!1),T=A.useRef(null);A.useEffect(()=>{const G=new y2;return T.current=G,(async()=>{try{const N=await G.connect(t==="JOIN"?e:void 0);o(N),u(!1),G.onMessage(J=>{console.log("[LobbyScreen] Received message:",J),J.type==="CLASS_INFO"&&(console.log("[LobbyScreen] Received opponent class:",J.playerClass),F(J.playerClass))}),G.onConnection(()=>{console.log("[LobbyScreen] Connection established!"),c(!0)})}catch(N){console.error("[LobbyScreen] Connection error:",N),f(N.toString()),u(!1)}})(),()=>{var N;(N=T.current)!=null&&N.isConnected()||G.disconnect()}},[t,e]),A.useEffect(()=>{l&&T.current&&!x&&(console.log("[LobbyScreen] Sending class info:",n),setTimeout(()=>{var G;(G=T.current)==null||G.send({type:"CLASS_INFO",playerClass:n}),v(!0)},100))},[l,n,x]),A.useEffect(()=>{if(l&&T.current&&k){const G=setTimeout(()=>{console.log("[LobbyScreen] Starting game with opponent class:",k),r(T.current,k)},500);return()=>clearTimeout(G)}},[l,r,k]);const h=async()=>{if(i)try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(i);else{const G=document.createElement("textarea");G.value=i,G.style.position="fixed",G.style.left="-999999px",G.style.top="-999999px",document.body.appendChild(G),G.focus(),G.select(),document.execCommand("copy"),document.body.removeChild(G)}I(!0),setTimeout(()=>I(!1),2e3)}catch(G){console.error("Failed to copy:",G),alert(`Room ID: ${i}

()`)}},W=()=>{T.current&&(T.current.disconnect(),T.current=null),s()};return a.jsxs("div",{className:"screen lobby-screen",style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",gap:"2rem"},children:[a.jsx("h1",{style:{fontSize:"2.5rem",marginBottom:"1rem",textShadow:"0 0 10px #e94560",fontFamily:"Tamanegi, sans-serif",letterSpacing:"2px"},children:t==="HOST"?"":"..."}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1.5rem",padding:"2rem",background:"rgba(0,0,0,0.3)",borderRadius:"10px",minWidth:"400px"},children:[p&&a.jsxs("div",{style:{color:"#ff6b6b",fontSize:"1.2rem",textAlign:"center",fontFamily:"Tamanegi, sans-serif"},children:[a.jsx("p",{children:""}),a.jsx("p",{style:{fontSize:"0.9rem",opacity:.7},children:p})]}),d&&!p&&a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1rem"},children:[a.jsx("div",{className:"loading-spinner",style:{width:"50px",height:"50px",border:"4px solid rgba(233, 69, 96, 0.3)",borderTop:"4px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),a.jsx("p",{style:{opacity:.8,fontFamily:"Tamanegi, sans-serif"},children:t==="HOST"?"...":"..."})]}),t==="HOST"&&i&&!d&&!l&&!p&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.5rem"},children:[a.jsx("p",{style:{fontSize:"1rem",opacity:.7,fontFamily:"Tamanegi, sans-serif"},children:"ID:"}),a.jsx("div",{style:{fontSize:"2rem",fontFamily:"monospace",fontWeight:"bold",padding:"0.5rem 1rem",background:"rgba(233, 69, 96, 0.2)",borderRadius:"8px",border:"1px solid #e94560",letterSpacing:"2px"},children:i})]}),a.jsx("button",{onClick:h,style:{fontSize:"1rem",padding:"0.8rem 2rem",background:b?"#48bb78":"transparent",border:"2px solid "+(b?"#48bb78":"#e94560"),color:"#fff",cursor:"pointer",transition:"all 0.3s",borderRadius:"4px",fontWeight:"bold",fontFamily:"Tamanegi, sans-serif"},children:b?" ":"ID"}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginTop:"1rem",opacity:.7},children:[a.jsx("div",{className:"loading-spinner",style:{width:"20px",height:"20px",border:"2px solid rgba(233, 69, 96, 0.3)",borderTop:"2px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),a.jsx("span",{style:{fontFamily:"Tamanegi, sans-serif"},children:"..."})]})]}),t==="JOIN"&&!d&&!l&&!p&&a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[a.jsx("div",{className:"loading-spinner",style:{width:"20px",height:"20px",border:"2px solid rgba(233, 69, 96, 0.3)",borderTop:"2px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),a.jsxs("span",{style:{fontFamily:"Tamanegi, sans-serif"},children:[" ",e," ..."]})]}),l&&a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1rem"},children:[a.jsx("p",{style:{fontSize:"1.5rem",color:"#48bb78",fontFamily:"Tamanegi, sans-serif"},children:" "}),a.jsx("p",{style:{fontFamily:"Tamanegi, sans-serif"},children:"..."})]}),a.jsxs("div",{style:{marginTop:"1rem",padding:"0.5rem 1rem",background:"rgba(255,255,255,0.1)",borderRadius:"4px",fontSize:"0.9rem",opacity:.7,fontFamily:"Tamanegi, sans-serif"},children:[": ",n==="SENKA"?"":n==="AJA"?"":"yoRuka"]})]}),a.jsx("button",{onClick:W,style:{fontSize:"1rem",padding:"0.8rem 2rem",background:"transparent",border:"1px solid #888",color:"#888",cursor:"pointer",transition:"all 0.3s",borderRadius:"4px",marginTop:"1rem",fontFamily:"Tamanegi, sans-serif"},onMouseOver:G=>{G.currentTarget.style.color="#fff",G.currentTarget.style.borderColor="#fff"},onMouseOut:G=>{G.currentTarget.style.color="#888",G.currentTarget.style.borderColor="#888"},children:" "}),a.jsx("style",{children:`
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `})]})};class QL{constructor(){un(this,"myEntryRef",null);un(this,"listenerUnsubscribe",null);un(this,"myId","");un(this,"myPeerId","");un(this,"hasMatched",!1)}async startMatchmaking(e,n,r,s,i,o,l,c){this.myPeerId=e,this.hasMatched=!1;const d=Ur(Br,`matchmaking/${s}`);try{const u=await bf(d),p=[];if(u.exists()&&u.forEach(k=>{const F=k.val(),x=Date.now()-F.timestamp<5*60*1e3;F.peerId!==e&&x&&p.push({key:k.key,data:F})}),p.length>0){const k=p.sort((F,x)=>F.data.timestamp-x.data.timestamp)[0];await hd(Ur(Br,`matchmaking/${s}/${k.key}`)),i("matched"),o({peerId:k.data.peerId,playerName:k.data.playerName,playerClass:k.data.playerClass,isHost:!1,playerId:k.data.playerId,rating:k.data.rating});return}i("searching");const f=LA(d);this.myEntryRef=f,this.myId=f.key;const b={id:this.myId,peerId:e,playerName:n,playerClass:r,matchType:s,...l!=null&&{playerId:l},...c!=null&&{rating:c},timestamp:Date.now()};await _f(f,b),OA(f).remove();const I=s;this.listenerUnsubscribe=HE(d,async k=>{if(this.hasMatched||!k.exists())return;let F=!1,x=null;if(k.forEach(v=>{const T=v.val();v.key===this.myId?F=!0:T.peerId!==this.myPeerId&&(!x||T.timestamp>x.data.timestamp)&&(x={key:v.key,data:T})}),!F&&this.myEntryRef){if(this.hasMatched)return;this.hasMatched=!0,i("matched"),this.cleanup();return}if(x!==null&&F){const v=k.child(this.myId).val(),T=x;if(v&&v.timestamp<T.data.timestamp){if(this.hasMatched)return;this.hasMatched=!0,await hd(Ur(Br,`matchmaking/${I}/${T.key}`)),await hd(Ur(Br,`matchmaking/${I}/${this.myId}`)),this.cleanup(),i("matched"),o({peerId:T.data.peerId,playerName:T.data.playerName,playerClass:T.data.playerClass,isHost:!0,playerId:T.data.playerId,rating:T.data.rating})}}})}catch(u){console.error("[Matchmaking] Error:",u),i("error"),this.cleanup()}}async cancelMatchmaking(){if(this.myEntryRef)try{await hd(this.myEntryRef)}catch(e){console.error("[Matchmaking] Error removing entry:",e)}this.cleanup()}cleanup(){this.listenerUnsubscribe&&(this.listenerUnsubscribe(),this.listenerUnsubscribe=null),this.myEntryRef=null,this.myId=""}}const yd=new QL;class zx{constructor(e,n,r=!1){un(this,"peer");un(this,"conn");un(this,"isHost",!1);un(this,"messageCallback",null);un(this,"closeCallback",null);this.peer=e,this.conn=n,this.isHost=r,n.on("data",s=>{this.messageCallback&&this.messageCallback(s)}),n.on("close",()=>{console.log("[PeerJSAdapter] Connection closed"),this.closeCallback&&this.closeCallback()}),n.on("error",s=>console.error("[PeerJSAdapter] Connection Error:",s))}async connect(e){return this.peer.id}onConnection(e){}onClose(e){this.closeCallback=e}isConnected(){return this.conn!==null&&this.conn.open}send(e){this.conn&&this.conn.open?this.conn.send(e):console.warn("[PeerJSAdapter] Connection not open, cannot send message")}onMessage(e){this.messageCallback=e}disconnect(){var e,n;(e=this.conn)==null||e.close(),(n=this.peer)==null||n.destroy()}}const qL=1280,ZL=720,Hx={BRONZE:"#cd7f32",SILVER:"#c0c0c0",GOLD:"#ffd700",PLATINUM:"#e5e4e2",DIAMOND:"#b9f2ff",MASTER:"#ff4500"},e3=({matchType:t,playerClass:e,playerName:n,playerId:r,onGameStart:s,onCancel:i})=>{const[o,l]=A.useState("idle"),[c,d]=A.useState("..."),[u,p]=A.useState(0),f=A.useRef(null),b=A.useRef(null),I=A.useRef(null),k=A.useRef(!1),F=A.useRef(!1),[x,v]=A.useState(0),[T,h]=A.useState(void 0),[W,G]=A.useState(1);A.useEffect(()=>{const J=()=>{const Q=window.innerWidth/qL,Ie=window.innerHeight/ZL;G(Math.min(Q,Ie))};return J(),window.addEventListener("resize",J),()=>window.removeEventListener("resize",J)},[]),A.useEffect(()=>{if(o!=="searching")return;const J=setInterval(()=>{p(Q=>{const Ie=Q+1;return Ie>=60&&(l("error"),d(""),yd.cancelMatchmaking(),b.current&&b.current.close(),f.current&&f.current.destroy()),Ie})},1e3);return()=>clearInterval(J)},[o]),A.useEffect(()=>{let J=!0,Q=0;return(async()=>{try{if(t==="ranked"&&r)try{Q=(await ag(r,e)).rating,v(Q)}catch(se){console.error("[Matchmaking] Failed to get rating:",se)}const Je=new m2({debug:1,config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]}});if(f.current=Je,await new Promise((se,P)=>{Je.on("open",()=>se()),Je.on("error",w=>P(w))}),!J)return;const pe=Je.id;console.log("[Matchmaking] My PeerJS ID:",pe),Je.on("connection",se=>{console.log("[Matchmaking] Incoming connection from:",se.peer),b.current=se,se.on("open",()=>{console.log("[Matchmaking] Connection opened (as HOST)"),se.on("data",P=>{if(P.type==="PLAYER_INFO"){console.log("[Matchmaking] Received player info:",P),se.send({type:"PLAYER_INFO",playerName:n,playerClass:e,playerId:t==="ranked"?r:void 0,rating:t==="ranked"?Q:void 0}),J&&t==="ranked"&&h(P.rating),F.current=!0;const w=new zx(Je,se,!0);s(w,P.playerClass,!0,P.playerId,P.rating)}})})}),yd.startMatchmaking(pe,n,e,t,se=>{if(J)switch(l(se),se){case"searching":d("...");break;case"matched":d("...");break;case"error":d("");break}},async se=>{if(J)if(console.log("[Matchmaking] Match found:",se),I.current=se,k.current=se.isHost,se.isHost)d("...");else{d("...");const P=Je.connect(se.peerId,{reliable:!0});b.current=P,P.on("open",()=>{console.log("[Matchmaking] Connection opened (as JOIN)"),P.send({type:"PLAYER_INFO",playerName:n,playerClass:e,playerId:t==="ranked"?r:void 0,rating:t==="ranked"?Q:void 0}),P.on("data",w=>{if(w.type==="PLAYER_INFO"){console.log("[Matchmaking] Received player info:",w),J&&t==="ranked"&&h(w.rating),F.current=!0;const R=new zx(Je,P,!1);s(R,w.playerClass,!1,w.playerId,w.rating)}})}),P.on("error",w=>{console.error("[Matchmaking] Connection error:",w),l("error"),d("")})}},t==="ranked"&&r?r:void 0,t==="ranked"?Q:void 0)}catch(Je){console.error("[Matchmaking] Init error:",Je),J&&(l("error"),d(""))}})(),()=>{J=!1,yd.cancelMatchmaking(),F.current||(b.current&&b.current.close(),f.current&&f.current.destroy())}},[t,e,n,r,s]);const ce=async()=>{await yd.cancelMatchmaking(),b.current&&b.current.close(),f.current&&f.current.destroy(),i()},N=J=>{const Q=Math.floor(J/60),Ie=J%60;return`${Q}:${Ie.toString().padStart(2,"0")}`};return a.jsxs("div",{className:"screen",style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white"},children:[a.jsx("div",{style:{fontSize:`${1.2*W}rem`,color:"#4ade80",marginBottom:`${1*W}rem`,fontWeight:"bold"},children:t==="casual"?"":""}),a.jsx("div",{style:{fontSize:`${2*W}rem`,fontWeight:"bold",marginBottom:`${1*W}rem`,textAlign:"center"},children:c}),o==="searching"&&a.jsxs("div",{style:{fontSize:`${1.5*W}rem`,color:"#888",marginBottom:`${2*W}rem`},children:[": ",N(u)]}),(o==="searching"||o==="matched")&&a.jsx("div",{style:{width:80*W,height:80*W,border:"4px solid rgba(255,255,255,0.2)",borderTop:"4px solid #4ade80",borderRadius:"50%",animation:"spin 1s linear infinite",marginBottom:`${2*W}rem`}}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:`${.5*W}rem`,marginBottom:`${2*W}rem`,padding:`${1*W}rem`,background:"rgba(255,255,255,0.1)",borderRadius:8*W},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:`${1*W}rem`},children:[a.jsx("div",{style:{fontSize:`${1*W}rem`},children:n||""}),a.jsx("div",{style:{fontSize:`${.9*W}rem`,color:e==="SENKA"?"#e94560":e==="AJA"?"#45a2e9":"#a855f7"},children:e==="SENKA"?"":e==="AJA"?"":"Y"})]}),t==="ranked"&&x>0&&a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:`${.5*W}rem`,fontSize:`${.85*W}rem`,color:"#aaa"},children:[a.jsx("span",{style:{fontWeight:"bold",color:Hx[En(x)],fontFamily:"Tamanegi, sans-serif"},children:pr[En(x)]}),a.jsx("span",{style:{fontFamily:"Tamanegi, sans-serif"},children:x})]}),t==="ranked"&&o==="matched"&&T!==void 0&&a.jsxs("div",{style:{marginTop:`${.5*W}rem`,padding:`${.5*W}rem ${1*W}rem`,background:"rgba(0, 0, 0, 0.3)",borderRadius:4*W,fontSize:`${.8*W}rem`,color:"#aaa"},children:[": ",a.jsx("span",{style:{fontWeight:"bold",color:Hx[En(T)],fontFamily:"Tamanegi, sans-serif"},children:pr[En(T)]})," ",T]})]}),o!=="error"&&a.jsx("button",{onClick:ce,style:{padding:`${.8*W}rem ${2*W}rem`,fontSize:`${1*W}rem`,background:"transparent",border:"2px solid #e94560",color:"#e94560",borderRadius:8*W,cursor:"pointer",transition:"all 0.2s"},onMouseOver:J=>{J.currentTarget.style.background="#e94560",J.currentTarget.style.color="white"},onMouseOut:J=>{J.currentTarget.style.background="transparent",J.currentTarget.style.color="#e94560"},children:""}),o==="error"&&a.jsx("button",{onClick:i,style:{padding:`${.8*W}rem ${2*W}rem`,fontSize:`${1*W}rem`,background:"#e94560",border:"none",color:"white",borderRadius:8*W,cursor:"pointer"},children:""}),a.jsx("style",{children:`
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `})]})},t3=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},yo=({card:t,onClick:e,style:n,isSelected:r,isPlayable:s,variant:i="normal",turnCount:o,isOnBoard:l,isSpecialSummoning:c,className:d,suppressPassives:u,isMyTurn:p,scale:f=1})=>{const b="currentAttack"in t?t.currentAttack:t.attack,I="currentHealth"in t?t.currentHealth:t.health,k="maxHealth"in t?t.maxHealth:t.health,F="canAttack"in t?t.canAttack:!1,x="turnPlayed"in t?t.turnPlayed:void 0,[v,T]=$.useState(!1);$.useEffect(()=>{if(c&&l){T(!0);const M=setTimeout(()=>T(!1),800);return()=>clearTimeout(M)}},[c,l]);const h="baseAttack"in t?t.baseAttack:void 0,W="baseHealth"in t?t.baseHealth:void 0,G=h!==void 0&&b>h,ce=W!==void 0&&(I>W||k>W),N="hasEvolved"in t?t.hasEvolved:!1,J="evolvedImageUrl"in t?t.evolvedImageUrl:void 0,Q=N&&J?J:t.imageUrl,Ie=Q?t3(Q):void 0;let Je=n==null?void 0:n.boxShadow,pe;const se=t.passiveAbilities||t.abilities||[],P=se.includes("WARD"),w=se.includes("AURA"),R=se.includes("STEALTH"),y=t.hasBarrier===!0||se.includes("BARRIER")&&t.hasBarrier!==!1;if(r)Je="0 0 15px rgba(255, 255, 255, 0.8)";else if(s)Je="0 0 10px #48bb78",pe="2px solid #48bb78";else if(F&&p){const M=se.includes("STORM"),U=se.includes("RUSH"),H=o!==void 0&&x!==void 0&&x===o;let me=!1;M||(H?me=!0:(o===void 0||x===void 0)&&(me=U)),me?Je="0 0 10px #f6e05e":Je="0 0 10px #48bb78"}const g=I<k;if(i==="art-only")return a.jsx("div",{className:"card art-only",style:{width:140,height:200,...n,borderRadius:8,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",background:"#2d3748",position:"relative",boxShadow:"0 4px 6px rgba(0,0,0,0.3)"},children:Ie?a.jsx("img",{src:Ie,alt:t.name,draggable:!1,style:{width:"100%",height:"100%",objectFit:"cover"}}):a.jsx("div",{style:{fontSize:"1.5rem",opacity:.5,color:"white",fontWeight:"bold"},children:t.type})});if(i==="mobile-hand"){const U=t.type==="SPELL"?16:6,H=28*f,me=.85*f;return a.jsxs("div",{className:`card mobile-hand ${d||""}`,style:{width:80,height:115,...n,position:"relative",cursor:e?"pointer":"default",transform:r?"translateY(-8px)":n==null?void 0:n.transform,boxShadow:Je||(n==null?void 0:n.boxShadow),border:pe||(s?"2px solid #48bb78":void 0),transition:"transform 0.2s, box-shadow 0.2s",background:"#1a202c",overflow:"hidden",borderRadius:`${U}px ${U}px 6px 6px`,backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},onClick:e,children:[a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"hidden",borderRadius:`${U}px ${U}px 6px 6px`},children:Ie?a.jsx("img",{src:Ie,alt:t.name,draggable:!1,style:{width:"100%",height:"100%",objectFit:"cover"}}):a.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"#4a5568",color:"#a0aec0",fontSize:"0.6rem"},children:t.type})}),a.jsxs("div",{style:{position:"absolute",top:3,left:4,display:"flex",flexDirection:"column",gap:2,zIndex:10},children:[a.jsx("div",{style:{width:H,height:H,borderRadius:"50%",background:"#48bb78",border:"1px solid rgba(255,255,255,0.8)",color:"white",fontSize:`${me}rem`,fontWeight:900,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.6)"},children:t.cost}),t.type==="FOLLOWER"&&a.jsxs("div",{style:{width:H,height:H,display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[a.jsx("svg",{width:H,height:H,viewBox:"0 0 24 24",fill:"none",style:{position:"absolute",filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.8))"},children:a.jsx("polygon",{points:"12,2 22,22 2,22",fill:"#4299e1",stroke:"rgba(255,255,255,0.8)",strokeWidth:"1",strokeLinejoin:"round"})}),a.jsx("span",{style:{zIndex:1,color:G?"#faf089":"white",fontWeight:"bold",fontSize:`${me}rem`,textShadow:"0 1px 2px black"},children:b})]}),t.type==="FOLLOWER"&&a.jsxs("div",{style:{width:H,height:H,display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[a.jsx("svg",{width:H,height:H,viewBox:"0 0 24 24",style:{position:"absolute",filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.8))"},children:a.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z",fill:"#c53030",stroke:"rgba(255,255,255,0.8)",strokeWidth:"1"})}),a.jsx("span",{style:{zIndex:1,color:ce?"#faf089":g?"#fc8181":"white",fontWeight:"bold",fontSize:`${me}rem`,textShadow:"0 1px 2px black"},children:I})]})]})]})}const C=t.type==="SPELL"&&!l,O=C?20:8;return a.jsxs("div",{className:`card card-container ${F?"ready":""} ${l?"on-board":""} ${d||""}`,style:{width:140,height:200,...n,position:"relative",cursor:e?"pointer":"default",transform:r?"translateY(-10px)":n==null?void 0:n.transform,boxShadow:Je||(F?"0 0 10px #f6e05e":n==null?void 0:n.boxShadow),border:pe||(s?"2px solid #48bb78":void 0),transition:"transform 0.2s, box-shadow 0.2s",display:"flex",flexDirection:"column",background:"#1a202c",overflow:"visible",animation:v?"cardSummonAppear 0.8s cubic-bezier(0.22, 1, 0.36, 1) forwards":n==null?void 0:n.animation,backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",borderRadius:C?`${O}px ${O}px 8px 8px`:"8px"},onClick:e,children:[!l&&a.jsx("div",{style:{height:20,background:"rgba(0,0,0,0.8)",color:"#e2e8f0",fontSize:t.name.length>10?"0.6rem":"0.7rem",fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",borderBottom:"1px solid rgba(255,255,255,0.2)",zIndex:2,transform:t.name.length>15?"scaleX(0.9)":"none",borderRadius:C?`${O}px ${O}px 0 0`:"8px 8px 0 0"},children:t.name}),a.jsxs("div",{style:{flex:1,position:"relative",width:"100%",background:"#2d3748",borderRadius:l?"8px":"0 0 8px 8px",minHeight:0},children:[a.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"hidden",borderRadius:l?"8px":"0 0 8px 8px",zIndex:1},children:[Ie?a.jsx("img",{src:Ie,alt:t.name,draggable:!1,style:{width:"100%",height:"100%",objectFit:"cover",display:"block"}}):a.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"#4a5568",color:"#a0aec0",fontSize:"0.8rem"},children:t.type}),a.jsx("div",{style:{position:"absolute",bottom:0,left:0,width:"100%",height:40,background:"linear-gradient(to top, rgba(0,0,0,0.8), transparent)",pointerEvents:"none",zIndex:3}})]}),!l&&a.jsx("div",{style:{position:"absolute",top:2*f,left:2*f,width:24*f,height:24*f,borderRadius:"50%",background:"#48bb78",border:`${Math.max(1,2*f)}px solid #fff`,color:"white",fontSize:`${.9*f}rem`,fontWeight:900,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 2px 4px rgba(0,0,0,0.5), inset 0 2px 5px rgba(255,255,255,0.3)",zIndex:10},children:t.cost}),t.type==="FOLLOWER"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{position:"absolute",bottom:l?2*f:40*f,left:2*f,width:32*f,height:32*f,zIndex:10,display:"flex",alignItems:"center",justifyContent:"center"},children:[a.jsxs("svg",{width:40*f,height:40*f,viewBox:"0 0 24 24",fill:"none",style:{position:"absolute",filter:"drop-shadow(0 2px 2px rgba(0,0,0,0.8))"},children:[a.jsx("defs",{children:a.jsxs("linearGradient",{id:"blueGrad",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[a.jsx("stop",{offset:"0%",stopColor:"#63b3ed"}),a.jsx("stop",{offset:"100%",stopColor:"#4299e1"})]})}),a.jsx("polygon",{points:"12,2 22,22 2,22",fill:"url(#blueGrad)",stroke:"white",strokeWidth:"1",strokeLinejoin:"round"})]}),a.jsx("span",{style:{zIndex:11,color:G?"#faf089":"white",fontWeight:"bold",fontSize:`${1.2*f}rem`,textShadow:"0 2px 2px black"},children:b})]}),a.jsxs("div",{style:{position:"absolute",bottom:2*f,right:l?2*f:"auto",left:l?"auto":2*f,width:32*f,height:32*f,zIndex:10,display:"flex",alignItems:"center",justifyContent:"center"},children:[a.jsxs("svg",{width:36*f,height:36*f,viewBox:"0 0 24 24",style:{position:"absolute",filter:"drop-shadow(0 2px 2px rgba(0,0,0,0.8))"},children:[a.jsx("defs",{children:a.jsxs("linearGradient",{id:"redGrad",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[a.jsx("stop",{offset:"0%",stopColor:"#f56565"}),a.jsx("stop",{offset:"100%",stopColor:"#c53030"})]})}),a.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z",fill:"url(#redGrad)",stroke:"white",strokeWidth:"1.5"})]}),a.jsx("span",{style:{zIndex:11,color:ce?"#faf089":g?"#fc8181":"white",fontWeight:"bold",fontSize:`${1.2*f}rem`,textShadow:"0 2px 2px black"},children:I})]})]}),l&&a.jsx("div",{style:{position:"absolute",top:-6*f,left:-6*f,right:-6*f,bottom:-6*f,zIndex:50,pointerEvents:"none",opacity:P&&!u?1:0,transition:"opacity 0.2s ease-in-out"},children:a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,animation:"wardPulseLoop 2.5s infinite ease-in-out"},children:a.jsxs("svg",{viewBox:"0 0 100 120",preserveAspectRatio:"none",style:{width:"100%",height:"100%"},children:[a.jsx("defs",{children:a.jsxs("filter",{id:"wardGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{stdDeviation:"2",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsx("path",{d:"M50 2 L96 20 V60 C96 90 50 116 50 116 C50 116 4 90 4 60 V20 Z",fill:"rgba(255, 255, 255, 0.12)",stroke:"#ECC94B",strokeWidth:"3",filter:"url(#wardGlow)"})]})})}),l&&a.jsxs("div",{style:{position:"absolute",top:-5*f,left:-5*f,right:-5*f,bottom:-5*f,zIndex:21,pointerEvents:"none",opacity:y&&!v&&!u?1:0,transition:"opacity 0.2s ease-in-out"},children:[a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,borderRadius:"50%",background:"radial-gradient(ellipse at center, rgba(99, 179, 237, 0.12) 0%, transparent 60%)",animation:"barrierGlowLoop 3s infinite ease-in-out"}}),a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,borderRadius:"50%",border:`${Math.max(1.5,2*f)}px solid rgba(99, 179, 237, 0.9)`,boxShadow:"0 0 6px rgba(66, 153, 225, 0.5), inset 0 0 8px rgba(99, 179, 237, 0.15)",animation:"barrierPulseLoop 3s infinite ease-in-out"}})]}),l&&a.jsx("div",{style:{position:"absolute",top:-6*f,left:-6*f,right:-6*f,bottom:-6*f,zIndex:22,pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center",opacity:w&&!v&&!u?1:0,transition:"opacity 0.2s ease-in-out"},children:a.jsx("div",{style:{width:"100%",height:"100%",position:"relative",animation:"auraPulseLoop 3s infinite ease-in-out"},children:a.jsxs("svg",{viewBox:"0 0 100 100",style:{width:"100%",height:"100%"},children:[a.jsx("defs",{children:a.jsxs("filter",{id:"auraGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{stdDeviation:"1.5",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsx("path",{d:"M40 5 L60 5 L60 30 L95 30 L95 45 L60 45 L60 95 L40 95 L40 45 L5 45 L5 30 L40 30 Z",fill:"rgba(255, 204, 0, 0.2)",stroke:"#f6ad55",strokeWidth:"2.5",filter:"url(#auraGlow)"})]})})}),l&&a.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:13,pointerEvents:"none",overflow:"hidden",borderRadius:"0 0 8px 8px",opacity:R&&!v&&!u?1:0,transition:"opacity 0.2s ease-in-out"},children:[a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:"120%",height:"120%",transform:"translate(-50%, -50%)",background:"radial-gradient(circle, rgba(0, 0, 0, 0.9) 0%, rgba(0, 0, 0, 0.6) 30%, rgba(0, 0, 0, 0.2) 60%, transparent 80%)",filter:"blur(10px)",animation:"stealthInkMove 3s infinite ease-in-out",mixBlendMode:"multiply"}}),a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:"100%",height:"100%",transform:"translate(-50%, -50%)",background:"radial-gradient(circle, rgba(20, 20, 30, 0.85) 0%, rgba(10, 10, 20, 0.4) 40%, transparent 70%)",filter:"blur(8px)",animation:"stealthInkPulse 1.5s infinite ease-in-out",mixBlendMode:"multiply"}}),a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:"70%",height:"70%",transform:"translate(-50%, -50%)",background:"radial-gradient(circle, rgba(255, 255, 255, 0.4) 0%, rgba(200, 200, 200, 0.25) 30%, transparent 60%)",filter:"blur(8px)",animation:"stealthMistMove 4s infinite ease-in-out",mixBlendMode:"screen"}}),a.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,boxShadow:"inset 0 0 30px rgba(0, 0, 0, 0.85), 0 0 20px rgba(0, 0, 0, 0.6)",animation:"stealthPulse 1.5s infinite ease-in-out"}})]})]}),v&&a.jsx("div",{style:{position:"absolute",inset:0,borderRadius:8,background:"radial-gradient(circle, rgba(255,255,255,0.8) 0%, transparent 70%)",mixBlendMode:"overlay",animation:"cardSummonFlash 0.8s ease-out forwards",pointerEvents:"none",zIndex:100}}),a.jsx("style",{children:`
                @keyframes cardSummonAppear {
                    0% { opacity: 0; transform: scale(1.5); filter: brightness(2) blur(4px); }
                    100% { opacity: 1; transform: scale(1); filter: brightness(1) blur(0px); }
                }
                @keyframes cardSummonFlash {
                    0% { opacity: 0.8; transform: scale(1.2); }
                    100% { opacity: 0; transform: scale(1); }
                }
                @keyframes wardPulseLoop {
                    0% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(255, 255, 255, 0.5)); }
                    50% { transform: scale(1.08); opacity: 0.5; filter: blur(3px) drop-shadow(0 0 15px rgba(255, 255, 255, 0.8)); }
                    100% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(255, 255, 255, 0.5)); }
                }
                @keyframes barrierPulseLoop {
                    0% { transform: scale(1); opacity: 1; box-shadow: 0 0 8px rgba(66, 153, 225, 0.6), inset 0 0 10px rgba(99, 179, 237, 0.2); }
                    50% { transform: scale(1.03); opacity: 0.85; box-shadow: 0 0 12px rgba(99, 179, 237, 0.8), inset 0 0 15px rgba(99, 179, 237, 0.3); }
                    100% { transform: scale(1); opacity: 1; box-shadow: 0 0 8px rgba(66, 153, 225, 0.6), inset 0 0 10px rgba(99, 179, 237, 0.2); }
                }
                @keyframes barrierGlowLoop {
                    0% { transform: scale(1); opacity: 0.6; }
                    50% { transform: scale(1.05); opacity: 0.4; }
                    100% { transform: scale(1); opacity: 0.6; }
                }
                @keyframes auraPulseLoop {
                    0% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(246, 173, 85, 0.5)); }
                    50% { transform: scale(1.12); opacity: 0.4; filter: blur(4px) drop-shadow(0 0 20px rgba(255, 204, 0, 0.8)); }
                    100% { transform: scale(1); opacity: 0.9; filter: blur(0px) drop-shadow(0 0 5px rgba(246, 173, 85, 0.5)); }
                }
                @keyframes stealthInkMove {
                    0%, 100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 0.7; }
                    25% { transform: translate(-45%, -55%) scale(1.15) rotate(3deg); opacity: 1; }
                    50% { transform: translate(-50%, -50%) scale(0.95) rotate(0deg); opacity: 0.5; }
                    75% { transform: translate(-55%, -45%) scale(1.1) rotate(-3deg); opacity: 0.9; }
                }
                @keyframes stealthInkPulse {
                    0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.8; }
                    50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.4; }
                }
                @keyframes stealthMistMove {
                    0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.5; }
                    25% { transform: translate(-48%, -52%) scale(1.1); opacity: 0.8; }
                    50% { transform: translate(-52%, -48%) scale(1.2); opacity: 0.3; }
                    75% { transform: translate(-50%, -50%) scale(0.9); opacity: 0.7; }
                }
                @keyframes stealthPulse {
                    0%, 100% { opacity: 0.6; box-shadow: inset 0 0 50px rgba(0, 0, 0, 0.9), 0 0 30px rgba(0, 0, 0, 0.7); }
                    50% { opacity: 1; box-shadow: inset 0 0 70px rgba(0, 0, 0, 1), 0 0 40px rgba(0, 0, 0, 0.9); }
                }
                /* 3D flip support - ensure all child elements inherit backface-visibility */
                .card, .card * {
                    backface-visibility: hidden !important;
                    -webkit-backface-visibility: hidden !important;
                }
            `})]})},n3=35e5;function v2(){const[t,e]=A.useState(()=>Wx());return A.useEffect(()=>{const n=()=>{e(Wx())};return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),t}function Wx(){const t=window.innerWidth*window.devicePixelRatio,e=window.innerHeight*window.devicePixelRatio,n=t*e,r=n>n3;let s="HD";return n>8e6?s="4K":n>35e5?s="1440p":n>2e6&&(s="1080p"),{isHighRes:r,isLightMode:r,pixelCount:n,resolution:s}}function r3(t){return t?{glowShadow:(e,n)=>`0 0 ${10*n}px ${e}`,blurAmount:4,enableGlowPulse:!1,dropShadow:e=>`drop-shadow(0 0 ${10*e}px rgba(255,255,255,0.6))`}:{glowShadow:(e,n)=>`
            0 0 ${15*n}px ${e},
            0 0 ${30*n}px ${e}80,
            0 0 ${60*n}px ${e}50
        `,blurAmount:8,enableGlowPulse:!0,dropShadow:e=>`drop-shadow(0 0 ${20*e}px rgba(255,255,255,0.8)) drop-shadow(0 0 ${40*e}px rgba(255,255,255,0.6))`}}const Gd=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},vd=t=>Gd(t==="YORUKA"?"/leaders/yoRuka_leader.png":t==="AJA"?"/leaders/azya_leader.png":"/leaders/senka_leader.png"),s3=Gd("/assets/VS.png"),lr=8,Gh=240,xd=t=>{switch(t){case"BRONZE":return"#cd7f32";case"SILVER":return"#c0c0c0";case"GOLD":return"#ffd700";case"PLATINUM":return"#e5e4e2";case"DIAMOND":return"#b9f2ff";case"MASTER":return"#ff1493";default:return"#ffffff"}},i3=({myPlayer:t,opponentPlayer:e,isFirstPlayer:n,onComplete:r,scale:s=1,onVsImpact:i,onCoinToss:o,onImpact:l,onOrbLand:c,onFadeInBoard:d,isMobile:u=!1,isRankedMatch:p=!1,myRank:f,opponentRank:b})=>{const[I,k]=A.useState("fade-in"),[F,x]=A.useState(!1),{isLightMode:v}=v2(),T=r3(v),[h,W]=A.useState(1),[G,ce]=A.useState(1),[N,J]=A.useState(0),[Q,Ie]=A.useState(0),[Je,pe]=A.useState(1),[se,P]=A.useState({myX:0,myY:0,opX:0,opY:0}),[w,R]=A.useState(0),[y,g]=A.useState(0),[C,O]=A.useState([]),M=A.useMemo(()=>{const je=window.innerWidth,we=window.innerHeight,Re=s,at=(u?280:340)*Re,qe=je-at,Ze=at+qe/2,Ue=Ze,De=we- -20*Re-Gh*Re/2,mt=Ze,Et=-20*Re+Gh*Re/2;return{player:{x:Ue,y:De},opponent:{x:mt,y:Et},leaderSize:Gh*Re}},[u,s]),U=A.useMemo(()=>{const je=window.innerWidth,we=window.innerHeight,Re=je*.25,at=we*.5,qe=je*.75,Ze=we*.5;return{myX:Re,myY:at,opX:qe,opY:Ze}},[]),H=v?`0 0 ${10*s}px rgba(103, 232, 249, 0.8)`:`0 0 ${15*s}px rgba(103, 232, 249, 1), 0 0 ${30*s}px rgba(34, 211, 238, 0.8), 0 0 ${60*s}px rgba(6, 182, 212, 0.5)`,me=v?`0 0 ${10*s}px rgba(249, 168, 212, 0.8)`:`0 0 ${15*s}px rgba(249, 168, 212, 1), 0 0 ${30*s}px rgba(244, 114, 182, 0.8), 0 0 ${60*s}px rgba(236, 72, 153, 0.5)`,ve=T.enableGlowPulse?"glowPulse 2s ease-in-out infinite":"none";A.useEffect(()=>{const je={"fade-in":500,"leaders-enter":1200,nameplate:800,"vs-display":1500,"coin-toss":1500,"turn-order":1e3,"leader-to-orb":800,"orb-pause":1e3,"orb-fly":900,"leader-appear":600};if(I==="complete"){d==null||d();const at=setTimeout(()=>{r()},700);return()=>clearTimeout(at)}const we={"fade-in":"leaders-enter","leaders-enter":"nameplate",nameplate:"vs-display","vs-display":"coin-toss","coin-toss":"turn-order","turn-order":"leader-to-orb","leader-to-orb":"orb-pause","orb-pause":"orb-fly","orb-fly":"leader-appear","leader-appear":"complete"},Re=setTimeout(()=>{const at=we[I];at&&k(at)},je[I]||1e3);return()=>clearTimeout(Re)},[I,r,n]),A.useEffect(()=>{if(I==="vs-display"){const je=setTimeout(()=>{x(!0),i==null||i(),setTimeout(()=>x(!1),300)},800);return()=>clearTimeout(je)}},[I,i]),A.useEffect(()=>{I==="coin-toss"&&(o==null||o())},[I,o]),A.useEffect(()=>{if(I==="leaders-enter"){const je=setTimeout(()=>{l==null||l()},1e3);return()=>clearTimeout(je)}},[I,l]),A.useEffect(()=>{I==="nameplate"&&(l==null||l())},[I,l]),A.useEffect(()=>{if(I==="leader-to-orb"){const we=Date.now();let Re;const at=()=>{const qe=Date.now()-we,Ze=Math.min(qe/800,1),Ue=1-Math.pow(1-Ze,3);W(1-Ue*.7),ce(1-Ue),J(Ue*1.5),Ie(Math.min(Ue*1.5,1)),Ze<1&&(Re=requestAnimationFrame(at))};return P(U),Re=requestAnimationFrame(at),()=>cancelAnimationFrame(Re)}},[I,U]),A.useEffect(()=>{if(I==="orb-pause"){const we=Date.now();let Re;const at=()=>{const qe=Date.now()-we,Ze=Math.min(qe/800,1);pe(1-Ze),Ze<1&&(Re=requestAnimationFrame(at))};return Re=requestAnimationFrame(at),()=>cancelAnimationFrame(Re)}},[I]),A.useEffect(()=>{if(I==="orb-fly"){const we=Date.now();let Re;const at=U.myX,qe=U.myY,Ze=U.opX,Ue=U.opY,De=M.player.x,mt=M.player.y,Et=M.opponent.x,Mt=M.opponent.y,de=()=>{const Le=Date.now()-we,Me=Math.min(Le/900,1),Be=Me*Me*Me,Pt=at-200*s,_s=(qe+mt)/2+100*s,vi=(1-Be)*(1-Be)*at+2*(1-Be)*Be*Pt+Be*Be*De,Yr=(1-Be)*(1-Be)*qe+2*(1-Be)*Be*_s+Be*Be*mt,Nn=Ze+200*s,bs=(Ue+Mt)/2-100*s,sr=(1-Be)*(1-Be)*Ze+2*(1-Be)*Be*Nn+Be*Be*Et,nn=(1-Be)*(1-Be)*Ue+2*(1-Be)*Be*bs+Be*Be*Mt;P({myX:vi,myY:Yr,opX:sr,opY:nn}),J(1.5-Be*1),Me<1&&(Re=requestAnimationFrame(de))};return Re=requestAnimationFrame(de),()=>cancelAnimationFrame(Re)}},[I,U,M,s]),A.useEffect(()=>{if(I==="leader-appear"){const we=Date.now();let Re;c==null||c(),x(!0),setTimeout(()=>x(!1),300);const at=M.player.x,qe=M.player.y,Ze=M.opponent.x,Ue=M.opponent.y,De=24,mt=[];for(let de=0;de<De;de++){const Le=de/De*360+(Math.random()-.5)*15;mt.push({id:de,x:at,y:qe,angle:Le,dist:80+Math.random()*120,size:8+Math.random()*12,delay:Math.random()*.1,color:`hsl(${200+Math.random()*40}, 80%, ${60+Math.random()*20}%)`})}for(let de=0;de<De;de++){const Le=de/De*360+(Math.random()-.5)*15;mt.push({id:De+de,x:Ze,y:Ue,angle:Le,dist:80+Math.random()*120,size:8+Math.random()*12,delay:Math.random()*.1,color:`hsl(${0+Math.random()*30}, 80%, ${55+Math.random()*20}%)`})}O(mt);const Et=setTimeout(()=>{O([])},800),Mt=()=>{const de=Date.now()-we,Le=Math.min(de/600,1),Me=1-Math.pow(1-Le,3);Ie(1-Me),R(Me),g(Me),Le<1&&(Re=requestAnimationFrame(Mt))};return Re=requestAnimationFrame(Mt),()=>{cancelAnimationFrame(Re),clearTimeout(Et)}}},[I,c,M]);const ue=["fade-in","leaders-enter","nameplate","vs-display","coin-toss","turn-order","leader-to-orb","orb-pause","orb-fly","leader-appear","complete"].indexOf(I),ne=ue>=3&&ue<=9,re=ue>=0&&ue<=7,He=`polygon(0 0, ${50+lr}% 0, ${50-lr}% 100%, 0 100%)`,st=`polygon(${50+lr}% 0, 100% 0, 100% 100%, ${50-lr}% 100%)`;return a.jsxs("div",{style:{position:"fixed",inset:0,background:ue>=7?"transparent":"#0a0a0f",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",animation:F?"screenShake 0.3s ease-in-out":void 0,pointerEvents:ue>=9?"none":"auto"},children:[a.jsx("div",{style:{position:"absolute",inset:0,background:"black",opacity:I==="fade-in"?1:0,transition:"opacity 0.5s ease-out",pointerEvents:"none",zIndex:1e4}}),re&&a.jsxs("div",{style:{opacity:Je,transition:"opacity 0.3s"},children:[ue>=0&&a.jsxs("div",{style:{position:"absolute",inset:0,clipPath:He,background:"linear-gradient(135deg, #0a1628 0%, #1a2a4a 50%, #0d1a30 100%)",transform:`translateX(${ue>=1?"0":"-100%"})`,transition:"transform 1.2s cubic-bezier(0.22, 1, 0.36, 1)",zIndex:50,overflow:"hidden"},children:[a.jsx("div",{style:{position:"fixed",top:"50%",left:"25%",transform:"translate(-50%, -50%)",opacity:G},children:a.jsx("img",{src:vd(t.class),alt:t.name,style:{height:"120vh",width:"auto",objectFit:"cover",objectPosition:t.class==="AJA"?"center top":"center",filter:"brightness(0.85) contrast(1.1)",transform:`scale(${h})`,transformOrigin:"center center"}})}),a.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(135deg, rgba(59, 130, 246, 0.3) 0%, transparent 60%)",pointerEvents:"none"}}),ue>=2&&ue<6&&a.jsxs("div",{style:{position:"absolute",bottom:"12%",left:"15%",padding:`${16*s}px ${40*s}px`,background:"rgba(0,0,0,0.85)",borderRadius:8*s,borderLeft:"4px solid #3b82f6",animation:"nameplateSlideUp 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)",whiteSpace:"nowrap",boxShadow:"0 4px 30px rgba(59, 130, 246, 0.4)"},children:[a.jsx("div",{style:{color:"white",fontSize:2.2*s+"rem",fontWeight:"bold",textShadow:"0 0 20px rgba(59, 130, 246, 0.8)"},children:t.name}),p&&f&&a.jsx("div",{style:{color:xd(f),fontSize:1.2*s+"rem",fontWeight:"bold",textShadow:`0 0 10px ${xd(f)}80`,marginTop:`${4*s}px`},children:pr[f]})]}),ue>=5&&ue<6&&a.jsx("div",{style:{position:"absolute",top:"10%",left:"15%",padding:`${12*s}px ${32*s}px`,background:n?"rgba(239, 68, 68, 0.9)":"rgba(59, 130, 246, 0.9)",borderRadius:8*s,animation:"turnOrderFadeIn 1s ease-out",boxShadow:n?"0 0 30px rgba(239, 68, 68, 0.6)":"0 0 30px rgba(59, 130, 246, 0.6)"},children:a.jsx("div",{style:{color:"white",fontSize:1.8*s+"rem",fontWeight:"bold",letterSpacing:"0.1em"},children:n?"":""})})]}),ue>=0&&a.jsxs("div",{style:{position:"absolute",inset:0,clipPath:st,background:"linear-gradient(225deg, #280a0a 0%, #4a1a1a 50%, #300d0d 100%)",transform:`translateX(${ue>=1?"0":"100%"})`,transition:"transform 1.2s cubic-bezier(0.22, 1, 0.36, 1)",zIndex:50,overflow:"hidden"},children:[a.jsx("div",{style:{position:"fixed",top:"50%",left:"75%",transform:"translate(-50%, -50%)",opacity:G},children:a.jsx("img",{src:vd(e.class),alt:e.name,style:{height:"120vh",width:"auto",objectFit:"cover",objectPosition:e.class==="AJA"?"center top":"center",filter:"brightness(0.85) contrast(1.1)",transform:`scale(${h})`,transformOrigin:"center center"}})}),a.jsx("div",{style:{position:"absolute",inset:0,background:"linear-gradient(225deg, rgba(239, 68, 68, 0.3) 0%, transparent 60%)",pointerEvents:"none"}}),ue>=2&&ue<6&&a.jsxs("div",{style:{position:"absolute",bottom:"12%",right:"15%",padding:`${16*s}px ${40*s}px`,background:"rgba(0,0,0,0.85)",borderRadius:8*s,borderRight:"4px solid #ef4444",animation:"nameplateSlideUp 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)",whiteSpace:"nowrap",boxShadow:"0 4px 30px rgba(239, 68, 68, 0.4)"},children:[a.jsx("div",{style:{color:"white",fontSize:2.2*s+"rem",fontWeight:"bold",textShadow:"0 0 20px rgba(239, 68, 68, 0.8)"},children:e.name}),p&&b&&a.jsx("div",{style:{color:xd(b),fontSize:1.2*s+"rem",fontWeight:"bold",textShadow:`0 0 10px ${xd(b)}80`,marginTop:`${4*s}px`},children:pr[b]})]}),ue>=5&&ue<6&&a.jsx("div",{style:{position:"absolute",top:"10%",right:"15%",padding:`${12*s}px ${32*s}px`,background:n?"rgba(59, 130, 246, 0.9)":"rgba(239, 68, 68, 0.9)",borderRadius:8*s,animation:"turnOrderFadeIn 1s ease-out",boxShadow:n?"0 0 30px rgba(59, 130, 246, 0.6)":"0 0 30px rgba(239, 68, 68, 0.6)"},children:a.jsx("div",{style:{color:"white",fontSize:1.8*s+"rem",fontWeight:"bold",letterSpacing:"0.1em"},children:n?"":""})})]}),ue>=1&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{position:"absolute",top:0,left:0,width:4*s,height:"100%",background:"linear-gradient(180deg, #67e8f9 0%, #22d3ee 30%, #06b6d4 50%, #22d3ee 70%, #67e8f9 100%)",boxShadow:H,zIndex:100,animation:ve}}),a.jsx("div",{style:{position:"absolute",top:0,left:0,width:`calc(${50+lr}% + ${2*s}px)`,height:4*s,background:"linear-gradient(90deg, #67e8f9 0%, #22d3ee 30%, #06b6d4 50%, #22d3ee 70%, #67e8f9 100%)",boxShadow:H,zIndex:100,animation:ve}}),a.jsx("div",{style:{position:"absolute",bottom:0,left:0,width:`calc(${50-lr}% + ${2*s}px)`,height:4*s,background:"linear-gradient(90deg, #67e8f9 0%, #22d3ee 30%, #06b6d4 50%, #22d3ee 70%, #67e8f9 100%)",boxShadow:H,zIndex:100,animation:ve}}),a.jsxs("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:100,pointerEvents:"none",overflow:"visible"},children:[a.jsxs("defs",{children:[a.jsxs("linearGradient",{id:"cyanGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[a.jsx("stop",{offset:"0%",stopColor:"#67e8f9"}),a.jsx("stop",{offset:"30%",stopColor:"#22d3ee"}),a.jsx("stop",{offset:"50%",stopColor:"#06b6d4"}),a.jsx("stop",{offset:"70%",stopColor:"#22d3ee"}),a.jsx("stop",{offset:"100%",stopColor:"#67e8f9"})]}),a.jsxs("filter",{id:"cyanGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{stdDeviation:T.blurAmount,result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),a.jsx("line",{x1:`${50+lr-.2}%`,y1:"0",x2:`${50-lr-.2}%`,y2:"100%",stroke:"url(#cyanGradient)",strokeWidth:4*s,filter:v?void 0:"url(#cyanGlow)",style:{animation:ve}})]})]}),ue>=1&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{position:"absolute",top:0,right:0,width:4*s,height:"100%",background:"linear-gradient(180deg, #f9a8d4 0%, #f472b6 30%, #ec4899 50%, #f472b6 70%, #f9a8d4 100%)",boxShadow:me,zIndex:100,animation:ve,animationDelay:"0.3s"}}),a.jsx("div",{style:{position:"absolute",top:0,right:0,width:`calc(${50-lr}% + ${2*s}px)`,height:4*s,background:"linear-gradient(90deg, #f9a8d4 0%, #f472b6 30%, #ec4899 50%, #f472b6 70%, #f9a8d4 100%)",boxShadow:me,zIndex:100,animation:ve,animationDelay:"0.3s"}}),a.jsx("div",{style:{position:"absolute",bottom:0,right:0,width:`calc(${50+lr}% + ${2*s}px)`,height:4*s,background:"linear-gradient(90deg, #f9a8d4 0%, #f472b6 30%, #ec4899 50%, #f472b6 70%, #f9a8d4 100%)",boxShadow:me,zIndex:100,animation:ve,animationDelay:"0.3s"}}),a.jsxs("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:100,pointerEvents:"none",overflow:"visible"},children:[a.jsxs("defs",{children:[a.jsxs("linearGradient",{id:"pinkGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[a.jsx("stop",{offset:"0%",stopColor:"#f9a8d4"}),a.jsx("stop",{offset:"30%",stopColor:"#f472b6"}),a.jsx("stop",{offset:"50%",stopColor:"#ec4899"}),a.jsx("stop",{offset:"70%",stopColor:"#f472b6"}),a.jsx("stop",{offset:"100%",stopColor:"#f9a8d4"})]}),a.jsxs("filter",{id:"pinkGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{stdDeviation:T.blurAmount,result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),a.jsx("line",{x1:`${50+lr+.2}%`,y1:"0",x2:`${50-lr+.2}%`,y2:"100%",stroke:"url(#pinkGradient)",strokeWidth:4*s,filter:v?void 0:"url(#pinkGlow)",style:{animation:ve,animationDelay:"0.3s"}})]})]})]}),ue>=6&&ue<=9&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{position:"fixed",left:se.myX,top:se.myY,transform:`translate(-50%, -50%) scale(${N})`,opacity:Q,width:150*s,height:150*s,borderRadius:"50%",background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(100,180,255,0.8) 40%, rgba(59,130,246,0.4) 70%, transparent 100%)",boxShadow:v?`0 0 ${30*s}px rgba(59, 130, 246, 0.8)`:`0 0 ${40*s}px rgba(255,255,255,0.9), 0 0 ${80*s}px rgba(59, 130, 246, 0.8), 0 0 ${120*s}px rgba(59, 130, 246, 0.5)`,zIndex:500,pointerEvents:"none"}}),a.jsx("div",{style:{position:"fixed",left:se.opX,top:se.opY,transform:`translate(-50%, -50%) scale(${N})`,opacity:Q,width:150*s,height:150*s,borderRadius:"50%",background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(255,150,150,0.8) 40%, rgba(239,68,68,0.4) 70%, transparent 100%)",boxShadow:v?`0 0 ${30*s}px rgba(239, 68, 68, 0.8)`:`0 0 ${40*s}px rgba(255,255,255,0.9), 0 0 ${80*s}px rgba(239, 68, 68, 0.8), 0 0 ${120*s}px rgba(239, 68, 68, 0.5)`,zIndex:500,pointerEvents:"none"}})]}),ue>=9&&a.jsxs(a.Fragment,{children:[a.jsx("div",{style:{position:"fixed",left:M.player.x,top:M.player.y,transform:`translate(-50%, -50%) scale(${w})`,opacity:y,width:M.leaderSize,height:M.leaderSize,borderRadius:"50%",overflow:"hidden",border:"4px solid #3182ce",boxShadow:"0 0 20px rgba(49, 130, 206, 0.4)",background:"#1a202c",zIndex:500,pointerEvents:"none"},children:a.jsx("img",{src:vd(t.class),alt:t.name,style:{width:"100%",height:"100%",objectFit:"cover",objectPosition:t.class==="AJA"?"center top":"center"}})}),a.jsx("div",{style:{position:"fixed",left:M.opponent.x,top:M.opponent.y,transform:`translate(-50%, -50%) scale(${w})`,opacity:y,width:M.leaderSize,height:M.leaderSize,borderRadius:"50%",overflow:"hidden",border:"4px solid #c53030",boxShadow:"0 0 20px rgba(197, 48, 48, 0.4)",background:"#1a202c",zIndex:500,pointerEvents:"none"},children:a.jsx("img",{src:vd(e.class),alt:e.name,style:{width:"100%",height:"100%",objectFit:"cover",objectPosition:e.class==="AJA"?"center top":"center"}})})]}),C.map(je=>a.jsx("div",{style:{position:"fixed",left:je.x,top:je.y,width:je.size*s,height:je.size*s,borderRadius:"50%",background:je.color,boxShadow:`0 0 ${je.size*.5*s}px ${je.color}`,pointerEvents:"none",zIndex:600,animation:`landingParticleBurst 0.6s ease-out ${je.delay}s forwards`,transform:"translate(-50%, -50%)","--particle-angle":`${je.angle}deg`,"--particle-dist":`${je.dist*s}px`}},je.id)),ne&&a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",animation:ue===3?"vsZoomIn 1.5s cubic-bezier(0.34, 1.56, 0.64, 1)":void 0,opacity:ue>=7?Math.max(0,Je):1,zIndex:200,pointerEvents:"none"},children:a.jsx("img",{src:s3,alt:"VS",style:{height:300*s,width:"auto",filter:`drop-shadow(0 0 ${20*s}px rgba(255,255,255,0.8)) drop-shadow(0 0 ${40*s}px rgba(255,255,255,0.6))`}})}),ue>=4&&ue<5&&a.jsx("div",{style:{position:"absolute",top:"20%",left:"50%",transform:"translate(-50%, -50%)",zIndex:150},children:a.jsx("div",{style:{width:100*s,height:100*s,borderRadius:"50%",background:"linear-gradient(45deg, #f6ad55 0%, #fbd38d 100%)",border:"4px solid white",display:"flex",alignItems:"center",justifyContent:"center",fontSize:2*s+"rem",fontWeight:"bold",color:"white",animation:"coinFlip 1.5s ease-in-out",boxShadow:`0 0 ${30*s}px rgba(246, 173, 85, 0.8)`},children:""})}),a.jsx("style",{children:`
                @keyframes screenShake {
                    0%, 100% { transform: translate(0, 0); }
                    10% { transform: translate(-10px, -10px); }
                    20% { transform: translate(10px, 10px); }
                    30% { transform: translate(-10px, 10px); }
                    40% { transform: translate(10px, -10px); }
                    50% { transform: translate(-10px, -10px); }
                    60% { transform: translate(10px, 10px); }
                    70% { transform: translate(-10px, 10px); }
                    80% { transform: translate(10px, -10px); }
                    90% { transform: translate(-10px, 0); }
                }

                @keyframes nameplateSlideUp {
                    0% {
                        transform: translateY(50px);
                        opacity: 0;
                    }
                    60% {
                        transform: translateY(-10px);
                    }
                    100% {
                        transform: translateY(0);
                        opacity: 1;
                    }
                }

                @keyframes vsZoomIn {
                    0% {
                        transform: translate(-50%, -50%) scale(3) translateZ(0);
                        opacity: 0;
                        filter: blur(20px);
                    }
                    50% {
                        transform: translate(-50%, -50%) scale(1.2) translateZ(0);
                        opacity: 1;
                        filter: blur(0px);
                    }
                    100% {
                        transform: translate(-50%, -50%) scale(1) translateZ(0);
                        opacity: 1;
                        filter: blur(0px);
                    }
                }

                @keyframes coinFlip {
                    0% {
                        transform: rotateY(0deg) scale(1);
                    }
                    50% {
                        transform: rotateY(1800deg) scale(1.2);
                    }
                    100% {
                        transform: rotateY(3600deg) scale(1);
                    }
                }

                @keyframes turnOrderFadeIn {
                    0% {
                        opacity: 0;
                        transform: scale(0.5);
                    }
                    50% {
                        transform: scale(1.2);
                    }
                    100% {
                        opacity: 1;
                        transform: scale(1);
                    }
                }

                @keyframes glowPulse {
                    0%, 100% {
                        opacity: 0.8;
                        filter: brightness(1);
                    }
                    50% {
                        opacity: 1;
                        filter: brightness(1.3);
                    }
                }

                @keyframes landingParticleBurst {
                    0% {
                        transform: translate(-50%, -50%) rotate(var(--particle-angle)) translateX(0);
                        opacity: 1;
                    }
                    100% {
                        transform: translate(-50%, -50%) rotate(var(--particle-angle)) translateX(var(--particle-dist));
                        opacity: 0;
                    }
                }
            `})]})},o3=({isVictory:t,loserLeaderRef:e,onComplete:n,onPhaseChange:r,onShakeIntensityChange:s,scale:i=1})=>{const[o,l]=A.useState("start"),[c,d]=A.useState(null),[u,p]=A.useState([]);A.useEffect(()=>{if(e.current){const b=e.current.getBoundingClientRect();d({x:b.left+b.width/2,y:b.top+b.height/2,size:b.width})}},[e]),A.useEffect(()=>{r==null||r(o)},[o,r]),A.useEffect(()=>{const b={start:200,zoom:600,"white-fade":800,explode:1200,"result-text":1800,"fade-out":600};if(o==="complete"){n();return}const I={start:"zoom",zoom:"white-fade","white-fade":"explode",explode:"result-text","result-text":"fade-out","fade-out":"complete"},k=setTimeout(()=>{const F=I[o];F&&l(F)},b[o]||1e3);return()=>clearTimeout(k)},[o,n]),A.useEffect(()=>{if(o==="explode"&&c){const I=Array.from({length:60},(v,T)=>{const h=T/60*360,W=(Math.random()-.5)*12,G=h+W,ce=150+Math.random()*250,N=12+Math.random()*20;return{id:T,x:c.x,y:c.y,angle:G,distance:ce,size:N,delay:Math.random()*.1,duration:.6+Math.random()*.4}});p(I),s==null||s(1);const k=1e3,F=Date.now(),x=setInterval(()=>{const T=(Date.now()-F)/k;if(T>=1)s==null||s(0),clearInterval(x);else{const h=1-Math.pow(T,2);s==null||s(h)}},16);return()=>clearInterval(x)}},[o,c,s]);const f=["start","zoom","white-fade","explode","result-text","fade-out","complete"].indexOf(o);return c?a.jsxs("div",{style:{position:"fixed",inset:0,zIndex:8e3,pointerEvents:"none",overflow:"hidden"},children:[a.jsx("div",{style:{position:"absolute",inset:0,background:"black",opacity:f>=1?f>=5?1:.5:0,transition:"opacity 0.5s ease-out"}}),f>=1&&f<4&&a.jsx("div",{style:{position:"absolute",left:c.x,top:c.y,transform:"translate(-50%, -50%)",width:c.size*1.8,height:c.size*1.8,borderRadius:"50%",background:"radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 60%)",transition:"all 0.4s ease-out"}}),f>=3&&u.map(b=>a.jsx("div",{style:{position:"absolute",left:b.x,top:b.y,width:b.size*i,height:b.size*i,borderRadius:"50%",background:"white",boxShadow:"0 0 15px white, 0 0 30px rgba(255,255,255,0.5)",transform:"translate(-50%, -50%)",animation:`particleFly-${b.id} ${b.duration}s ease-out ${b.delay}s forwards`}},b.id)),f>=3&&a.jsx("style",{children:u.map(b=>{const I=b.angle*Math.PI/180,k=Math.cos(I)*b.distance,F=Math.sin(I)*b.distance;return`
                            @keyframes particleFly-${b.id} {
                                0% {
                                    transform: translate(-50%, -50%) scale(1);
                                    opacity: 1;
                                }
                                100% {
                                    transform: translate(calc(-50% + ${k}px), calc(-50% + ${F}px)) scale(0);
                                    opacity: 0;
                                }
                            }
                        `}).join(`
`)}),f>=4&&f<6&&a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",animation:"resultTextPop 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)"},children:a.jsx("div",{style:{fontSize:`${7*i}rem`,fontWeight:900,fontFamily:"Tamanegi, sans-serif",color:t?"#ffd700":"#718096",textShadow:t?"0 0 30px rgba(255,215,0,0.8), 0 0 60px rgba(255,215,0,0.6), 0 0 90px rgba(255,215,0,0.4), 4px 4px 8px rgba(0,0,0,0.8)":"0 0 20px rgba(113,128,150,0.5), 4px 4px 8px rgba(0,0,0,0.8)",letterSpacing:"0.15em"},children:t?"":"..."})}),a.jsx("style",{children:`
                @keyframes resultTextPop {
                    0% {
                        transform: translate(-50%, -50%) scale(2.5);
                        opacity: 0;
                        filter: blur(20px);
                    }
                    60% {
                        transform: translate(-50%, -50%) scale(0.95);
                        opacity: 1;
                        filter: blur(0px);
                    }
                    100% {
                        transform: translate(-50%, -50%) scale(1);
                        opacity: 1;
                        filter: blur(0px);
                    }
                }
            `})]}):null},a3=({isMyTurn:t,turnCount:e,activePlayerId:n,onTimeUp:r,timerEnabled:s,isGameOver:i=!1,isPaused:o=!1,scale:l=1,buttonSize:c=160,timerDuration:d=60})=>{const[u,p]=A.useState(d),[f,b]=A.useState(!1),[I,k]=A.useState(!1),F=A.useRef(null),x=A.useRef(""),v=A.useRef(0),T=A.useRef(r),h=A.useRef(!1),W=A.useId().replace(/:/g,"_");A.useEffect(()=>{T.current=r},[r]);const G=`${e}-${n}`,ce=A.useCallback(()=>{p(d),b(!1),k(!1),v.current=Date.now()+d*1e3,h.current=!1},[d]);if(A.useEffect(()=>{G!==x.current&&(x.current=G,ce())},[G,ce]),A.useEffect(()=>{if(!s||!t||i||o){F.current&&(clearInterval(F.current),F.current=null);return}return v.current===0&&(v.current=Date.now()+d*1e3),F.current=window.setInterval(()=>{const g=Date.now(),C=Math.max(0,(v.current-g)/1e3);p(C);const O=Math.ceil(C);O<=15&&O>10?(b(!0),k(!1)):O<=10?(b(!0),k(!0)):(b(!1),k(!1)),C<=0&&!h.current&&(h.current=!0,F.current&&(clearInterval(F.current),F.current=null),setTimeout(()=>T.current(),0))},16),()=>{F.current&&(clearInterval(F.current),F.current=null)}},[s,t,i,o,d]),!s||o)return null;const N=u/d,J=(c/2+12)*l,Q=6*l,Ie=2*Math.PI*J,Je=-Ie*(1-N),pe=Math.ceil(u),se=I?Math.min(1,(10-pe)/10):0,P=Math.max(.05,.15-se*.1);let w="#4299e1";f&&!I?w="#f6ad55":I&&(w="#e53e3e");const R=20*l,y=J*2+Q+R*2;return a.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:y,height:y,pointerEvents:"none",zIndex:10,animation:I?`timerShake${W} ${P}s ease-in-out infinite`:void 0},children:[a.jsxs("svg",{width:y,height:y,style:{position:"absolute",top:0,left:0,overflow:"visible"},children:[a.jsx("circle",{cx:y/2,cy:y/2,r:J,fill:"none",stroke:"rgba(0,0,0,0.3)",strokeWidth:Q}),a.jsx("circle",{cx:y/2,cy:y/2,r:J,fill:"none",stroke:w,strokeWidth:Q,strokeLinecap:"round",strokeDasharray:Ie,strokeDashoffset:Je,style:{transform:"rotate(-90deg)",transformOrigin:"center"}}),f&&a.jsx("circle",{cx:y/2,cy:y/2,r:J,fill:"none",stroke:w,strokeWidth:Q*3,opacity:.4,style:{filter:`blur(${12*l}px)`,animation:I?`timerPulse${W} 0.5s ease-in-out infinite`:`timerPulse${W} 1s ease-in-out infinite`}})]}),a.jsx("style",{children:`
                @keyframes timerPulse${W} {
                    0%, 100% { opacity: 0.4; }
                    50% { opacity: 0.7; }
                }
                @keyframes timerShake${W} {
                    0%, 100% { transform: translate(-50%, -50%) translate(0, 0); }
                    25% { transform: translate(-50%, -50%) translate(${2*l}px, ${-2*l}px); }
                    50% { transform: translate(-50%, -50%) translate(${-2*l}px, ${2*l}px); }
                    75% { transform: translate(-50%, -50%) translate(${2*l}px, ${1*l}px); }
                }
            `})]})};function l3(t,e){const[n,r]=A.useState(null),[s,i]=A.useState(""),[o,l]=A.useState(!1),[c,d]=A.useState(null),[u,p]=A.useState(!1);return A.useEffect(()=>{if(t==="CPU")return;const f=new y2;return p(!0),(async()=>{try{const I=await f.connect(t==="JOIN"?e:void 0);i(I),r(f),f.onConnection(()=>{console.log("[useGameNetwork] Connection established!"),l(!0),p(!1)})}catch(I){d(I.toString()),p(!1)}})(),()=>{f.disconnect()}},[t,e]),{adapter:n,myId:s,connected:o,connecting:u,error:c,setConnected:l}}function Gx(t,e,n){return!(!t.canEvolveThisTurn||t.evolutionsUsed>=2||e<(n?5:4))}function Vx(t,e,n){return!(!t.canEvolveThisTurn||t.sep<=0||e<(n?7:6))}const ot=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},c3=ot("/leaders/azya_leader.png"),d3=ot("/leaders/senka_leader.png"),u3=ot("/leaders/yoRuka_leader.png"),f3=ot("/sleeves/azya_sleeve.png"),h3=ot("/sleeves/senka_sleeve.png"),p3=ot("/sleeves/yoruka_sleeve.png"),Tl=t=>t==="YORUKA"?u3:t==="AJA"?c3:d3,Si=t=>t==="YORUKA"?p3:t==="AJA"?f3:h3,g3=1920,x2=1080,m3=()=>{const[t,e]=A.useState({scale:1,toGameX:r=>r,toGameY:r=>r}),n=A.useCallback(()=>{const r=window.visualViewport?window.visualViewport.width:window.innerWidth,s=window.visualViewport?window.visualViewport.height:window.innerHeight;let i=Math.min(r/g3,s/x2);i*=1.5,e({scale:i,toGameX:c=>c,toGameY:c=>c})},[]);return A.useEffect(()=>{n(),window.addEventListener("resize",n),window.addEventListener("orientationchange",()=>{setTimeout(n,150)}),window.visualViewport&&window.visualViewport.addEventListener("resize",n);const r=()=>{document.visibilityState==="visible"&&setTimeout(n,100)};return document.addEventListener("visibilitychange",r),()=>{window.removeEventListener("resize",n),window.removeEventListener("orientationchange",n),window.visualViewport&&window.visualViewport.removeEventListener("resize",n),document.removeEventListener("visibilitychange",r)}},[n]),t},fn=90,Cn=120,Ti=fn+18,vo=240,y3=({x:t,y:e,onComplete:n,scale:r=1})=>{$.useEffect(()=>{const i=setTimeout(n,2e3);return()=>clearTimeout(i)},[n]);const s=$.useMemo(()=>Array(20).fill(0).map((i,o)=>({id:o,angle:Math.random()*360,dist:(30+Math.random()*60)*r,size:(10+Math.random()*15)*r,delay:Math.random()*.5})),[r]);return a.jsxs("div",{style:{position:"absolute",left:t,top:e,pointerEvents:"none",zIndex:6e3},children:[a.jsx("style",{children:`
                @keyframes healGlowFade {
                    0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; filter: blur(10px); }
                    30% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.8; filter: blur(15px); }
                    100% { transform: translate(-50%, -50%) scale(1.6); opacity: 0; filter: blur(30px); }
                }
                @keyframes healParticleRise {
                    0% { transform: translate(-50%, -50%) rotate(var(--angle)) translate(0, 0) scale(0); opacity: 0; }
                    20% { transform: translate(-50%, -50%) rotate(var(--angle)) translate(0, 0) opacity: 0.7; }
                    100% { transform: translate(-50%, -50%) rotate(var(--angle)) translate(calc(var(--dist) * 1px), 0) scale(1.5); opacity: 0; }
                }
            `}),a.jsx("div",{style:{position:"absolute",left:0,top:0,width:150*r,height:150*r,background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(200,255,240,0.5) 50%, transparent 80%)",borderRadius:"50%",transform:"translate(-50%, -50%)",animation:"healGlowFade 1.5s ease-out forwards",filter:`blur(${8*r}px)`}}),s.map(i=>a.jsx("div",{style:{position:"absolute",left:0,top:0,width:i.size,height:i.size,background:"rgba(255,250,240,0.6)",borderRadius:"50%",filter:`blur(${4*r}px)`,"--angle":`${i.angle}deg`,"--dist":i.dist,animation:`healParticleRise 1.2s ease-out ${i.delay}s forwards`,pointerEvents:"none"}},i.id))]})},v3=({x:t,y:e,atkBuff:n,hpBuff:r,onComplete:s})=>{$.useEffect(()=>{const b=setTimeout(s,1500);return()=>clearTimeout(b)},[s]);const i=n<0||r<0,o=i?"radial-gradient(circle, rgba(180,50,50,0.9) 0%, rgba(150,30,30,0.4) 50%, transparent 80%)":"radial-gradient(circle, rgba(255,230,100,0.9) 0%, rgba(255,200,50,0.4) 50%, transparent 80%)",l=i?"#ff4444":"#ffd93d",c="#ffd93d",d="rgba(255,217,61,0.8)",u=b=>b>=0?`+${b}`:`${b}`,p=80,f=110;return a.jsxs("div",{style:{position:"absolute",left:t,top:e,pointerEvents:"none",zIndex:6e3},children:[a.jsx("style",{children:`
                @keyframes buffGlow {
                    0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
                    30% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
                    100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
                }
                @keyframes buffNumberRise {
                    0% { transform: translateY(0); opacity: 0; }
                    20% { opacity: 1; }
                    100% { transform: translateY(-30px); opacity: 0; }
                }
                @keyframes buffSparkle {
                    0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
                    50% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
                    100% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
                }
            `}),a.jsx("div",{style:{position:"absolute",left:0,top:0,width:150,height:150,background:o,borderRadius:"50%",transform:"translate(-50%, -50%)",animation:"buffGlow 1.2s ease-out forwards",filter:"blur(8px)"}}),n!==0&&a.jsx("div",{style:{position:"absolute",left:-p/2+12,top:f/2-20,fontSize:"24px",fontWeight:"bold",color:c,textShadow:`0 0 10px ${d}, 2px 2px 4px rgba(0,0,0,0.8)`,fontFamily:"Tamanegi, sans-serif",animation:"buffNumberRise 1.2s ease-out forwards",textAlign:"center"},children:u(n)}),r!==0&&a.jsx("div",{style:{position:"absolute",left:p/2-28,top:f/2-20,fontSize:"24px",fontWeight:"bold",color:c,textShadow:`0 0 10px ${d}, 2px 2px 4px rgba(0,0,0,0.8)`,fontFamily:"Tamanegi, sans-serif",animation:"buffNumberRise 1.2s ease-out forwards",textAlign:"center"},children:u(r)}),[...Array(8)].map((b,I)=>a.jsx("div",{style:{position:"absolute",left:Math.cos(I*Math.PI/4)*60,top:Math.sin(I*Math.PI/4)*60,width:12,height:12,background:l,borderRadius:"50%",boxShadow:`0 0 10px ${l}, 0 0 20px ${l}`,animation:`buffSparkle 0.8s ease-out ${I*.1}s forwards`}},I))]})},x3=({x:t,y:e,onComplete:n,scale:r=1})=>($.useEffect(()=>{const s=setTimeout(n,1200);return()=>clearTimeout(s)},[n]),a.jsxs("div",{style:{position:"absolute",left:t,top:e,transform:"translate(-50%, -50%)",width:130*r,height:130*r,pointerEvents:"none",zIndex:5e3,display:"flex",alignItems:"center",justifyContent:"center"},children:[a.jsx("div",{style:{fontSize:`${80*r}px`,animation:"baneSkullAppear 1.2s ease-out forwards",textShadow:`0 0 ${20*r}px #9b59b6, 0 0 ${40*r}px #8e44ad, 0 0 ${60*r}px #6c3483`,filter:`drop-shadow(0 0 ${15*r}px #9b59b6) hue-rotate(-10deg)`},children:""}),[...Array(12)].map((s,i)=>a.jsx("div",{style:{position:"absolute",left:"50%",top:"50%",width:6*r,height:6*r,background:"radial-gradient(circle, #9b59b6, #6c3483)",borderRadius:"50%",boxShadow:`0 0 ${8*r}px #9b59b6, 0 0 ${15*r}px #8e44ad`,animation:`baneParticle 1s ease-out ${i*.08}s forwards`,transform:`rotate(${i*30}deg) translateX(0)`}},i)),a.jsx("style",{children:`
                @keyframes baneSkullAppear {
                    0% { transform: scale(0) rotate(-30deg); opacity: 0; }
                    20% { transform: scale(1.3) rotate(10deg); opacity: 1; }
                    40% { transform: scale(1) rotate(-5deg); opacity: 1; }
                    60% { transform: scale(1.1) rotate(0deg); opacity: 1; }
                    80% { transform: scale(1) rotate(0deg); opacity: 0.8; }
                    100% { transform: scale(1.5) rotate(0deg); opacity: 0; }
                }
                @keyframes baneParticle {
                    0% { transform: rotate(0deg) translateX(0); opacity: 1; }
                    100% { transform: rotate(0deg) translateX(${70*r}px); opacity: 0; }
                }
            `})]})),_3=({type:t,x:e,y:n,onComplete:r,audioSettings:s,scale:i=1})=>{const o=$.useMemo(()=>{let f=8,b=8,I=100,k=256;return t==="SHOT"&&(k=128),{cols:f,rows:b,fps:I,size:k}},[t]);if($.useEffect(()=>{const b=["LIGHTNING","THUNDER","IMPACT","SUMI","SHOT","ICE","WATER","RAY","FIRE","SLASH","BLUE_FIRE"].includes(t)?o.cols*o.rows/o.fps*1e3:t==="FIREBALL"?500:t==="HEAL"?2e3:400,I=setTimeout(r,b);return()=>clearTimeout(I)},[r,t,o]),$.useEffect(()=>{if(!s||!s.seEnabled)return;const f=(b,I=.5,k=0)=>{setTimeout(()=>{const F=new Audio(ot(`/se/${b}`));F.volume=(s.se||.5)*I,F.play().catch(x=>console.warn("SE Play prevented",x))},k)};t==="SHOT"?(f("shot.mp3",.6),f("hibi.mp3",.4,400)):t==="IMPACT"?(f("panch1.mp3",.6,100),f("panch2.mp3",.6,500)):t==="LIGHTNING"||t==="THUNDER"?f("thunder.mp3",.5):t==="FIREBALL"?f("explosion.mp3",.5):t==="FIRE"?f("fire.mp3",.5):t==="SLASH"?f("slash.mp3",.5):t==="ICE"?f("ice.mp3",.5):t==="WATER"?f("water.mp3",.5):t==="RAY"?f("ray.mp3",.6):t==="SUMI"?f("yami.mp3",.6):t==="HEAL"?f("heal.mp3",.6):t==="BLUE_FIRE"?f("fire.mp3",.5):t==="BANE"&&f("yami.mp3",.7)},[t,s]),t==="HEAL")return a.jsx(y3,{x:e,y:n,onComplete:r,scale:i});if(t==="BANE")return a.jsx(x3,{x:e,y:n,onComplete:r,scale:i});const l=100*i,c={position:"absolute",left:e,top:n,transform:"translate(-50%, -50%)",width:l,height:l,pointerEvents:"none",zIndex:5e3,display:"flex",alignItems:"center",justifyContent:"center"};if(["LIGHTNING","THUNDER","IMPACT","SUMI","SHOT","ICE","WATER","RAY","FIRE","SLASH","BLUE_FIRE"].includes(t)){let f=ot("/effects/thunder.png");t==="IMPACT"&&(f=ot("/effects/impact.png")),t==="SUMI"&&(f=ot("/effects/sumi.png")),t==="SHOT"&&(f=ot("/effects/shot.png")),t==="ICE"&&(f=ot("/effects/ice.png")),t==="WATER"&&(f=ot("/effects/water.png")),t==="RAY"&&(f=ot("/effects/ray.png")),t==="FIRE"&&(f=ot("/effects/fire.png")),t==="SLASH"&&(f=ot("/effects/slash.png")),t==="BLUE_FIRE"&&(f=ot("/effects/blue_fire.png"));const b=o.cols*o.rows,I=Math.min(160,o.size)*i;return a.jsxs("div",{style:{...c,width:I,height:I,transform:`${(c==null?void 0:c.transform)||""}`},children:[a.jsx("div",{style:{width:"100%",height:"100%",backgroundImage:`url(${f})`,backgroundSize:`${o.cols*100}% ${o.rows*100}%`,animation:`spriteAnimation ${b/o.fps}s steps(1) forwards`}}),a.jsx("style",{children:`
                    @keyframes spriteAnimation {
                        ${Array.from({length:b}).map((k,F)=>{const x=F%o.cols,v=Math.floor(F/o.cols),T=x*(100/(o.cols-1)),h=v*(100/(o.rows-1));return`${F/(b-1)*100}% { background-position: ${T}% ${h}%; }`}).join(`
`)}
                    }
                `})]})}let u="",p="";if(t==="FIREBALL")u=ot("/effects/fireball.png"),p="explode 0.5s ease-out forwards";else if(t==="BEAM")return a.jsx("div",{style:{position:"fixed",left:e,top:n,width:400,height:30,background:"linear-gradient(90deg, transparent, #faf089, #fff, #faf089, transparent)",transform:"translate(-50%, -50%) rotate(-45deg)",boxShadow:"0 0 20px #faf089",opacity:0,animation:"beamShoot 0.4s ease-out forwards",pointerEvents:"none",zIndex:5e3},children:a.jsx("style",{children:`
                    @keyframes beamShoot {
                        0% { width: 0; opacity: 1; transform: translate(-50%, -50%) rotate(-45deg) scaleX(0); }
                        20% { width: 400px; opacity: 1; transform: translate(-50%, -50%) rotate(-45deg) scaleX(1); }
                        100% { width: 400px; opacity: 0; transform: translate(-50%, -50%) rotate(-45deg) scaleX(1.2); }
                    }
                `})});return u?a.jsxs("div",{style:c,children:[a.jsx("img",{src:u,style:{width:"100%",height:"100%",objectFit:"contain",animation:p}}),a.jsx("style",{children:`
                @keyframes explode { 0% { transform: scale(0.5); opacity: 0; } 20% { opacity: 1; } 100% { transform: scale(2); opacity: 0; } }
            `})]}):null},b3=({value:t,x:e,y:n,color:r,onComplete:s,scale:i=1})=>{$.useEffect(()=>{const d=setTimeout(s,1200);return()=>clearTimeout(d)},[s]);const o=r==="#48bb78",l=r||"#e53e3e",c=o?"linear-gradient(180deg, #68d391 0%, #38a169 50%, #276749 100%)":"linear-gradient(180deg, #fc8181 0%, #e53e3e 50%, #c53030 100%)";return a.jsxs("div",{style:{position:"absolute",left:e,top:n,transform:"translate(-50%, -50%)",pointerEvents:"none",zIndex:6e3,fontSize:`${4*i}rem`,fontWeight:"900",fontFamily:'"Impact", "Arial Black", sans-serif',letterSpacing:`${-2*i}px`,background:c,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",filter:`drop-shadow(0 0 ${8*i}px ${l}) drop-shadow(0 ${2*i}px ${4*i}px rgba(0,0,0,0.8))`,animation:"floatUp 1.2s ease-out forwards"},children:[t,a.jsx("style",{children:`
                @keyframes floatUp {
                    0% { transform: translate(-50%, -50%) scale(0.3); opacity: 0; }
                    15% { transform: translate(-50%, -70%) scale(1.8); opacity: 1; }
                    30% { transform: translate(-50%, -90%) scale(1.4); opacity: 1; }
                    100% { transform: translate(-50%, -180%) scale(1); opacity: 0; }
                }
            `})]})},E3=({x:t,y:e})=>{const n=$.useMemo(()=>Array(16).fill(0).map((r,s)=>({id:s,angle:Math.random()*360,dist:60+Math.random()*120,size:4+Math.random()*8,delay:Math.random()*.3,color:Math.random()>.5?"#f6e05e":"#ffffff"})),[]);return a.jsxs("div",{style:{position:"absolute",left:t,top:e,pointerEvents:"none",zIndex:6e3},children:[a.jsx("style",{children:`
                @keyframes sparkleMove {
                    0% { transform: rotate(var(--angle)) translate(0, 0) scale(0); opacity: 0; }
                    20% { opacity: 1; transform: rotate(var(--angle)) translate(calc(var(--dist) * 0.2px), 0) scale(1.5); }
                    100% { transform: rotate(var(--angle)) translate(calc(var(--dist) * 1px), 0) scale(0); opacity: 0; }
                }
            `}),n.map(r=>a.jsx("div",{style:{position:"absolute",left:0,top:0,width:r.size,height:r.size,background:r.color,borderRadius:"50%",boxShadow:`0 0 10px ${r.color}, 0 0 20px ${r.color}`,"--angle":`${r.angle}deg`,"--dist":r.dist,animation:`sparkleMove 0.8s ease-out ${r.delay}s forwards`,pointerEvents:"none"}},r.id))]})},S3=({onClose:t})=>a.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(0,0,0,0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:t,children:a.jsxs("div",{style:{background:"linear-gradient(135deg, #1a202c 0%, #2d3748 100%)",borderRadius:16,padding:30,maxWidth:700,maxHeight:"80vh",overflowY:"auto",color:"#fff",boxShadow:"0 20px 60px rgba(0,0,0,0.5)",border:"1px solid #4a5568"},onClick:e=>e.stopPropagation(),children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[a.jsx("h2",{style:{margin:0,color:"#63b3ed"},children:""}),a.jsx("button",{onClick:t,style:{background:"transparent",border:"none",color:"#a0aec0",fontSize:"1.5rem",cursor:"pointer"},children:""})]}),a.jsxs("section",{style:{marginBottom:25},children:[a.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),a.jsxs("ul",{style:{lineHeight:1.8,paddingLeft:20,color:"#e2e8f0"},children:[a.jsx("li",{children:"0"}),a.jsx("li",{children:"1PP110"}),a.jsx("li",{children:"PP"}),a.jsx("li",{children:""}),a.jsx("li",{children:"5"}),a.jsx("li",{children:"910"})]})]}),a.jsxs("section",{style:{marginBottom:25},children:[a.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[a.jsxs("div",{children:[a.jsx("span",{style:{color:"#48bb78",fontWeight:"bold"},children:"[]"}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#ed8936",fontWeight:"bold"},children:"[]"}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#4299e1",fontWeight:"bold"},children:"[]"}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#9f7aea",fontWeight:"bold"},children:"[]"}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#f56565",fontWeight:"bold"},children:"[]"}),"12"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#38b2ac",fontWeight:"bold"},children:"[]"}),"1"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#718096",fontWeight:"bold"},children:"[]"}),"AoE"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#d69e2e",fontWeight:"bold"},children:"[]"}),"AoE"]})]})]}),a.jsxs("section",{style:{marginBottom:25},children:[a.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[a.jsxs("div",{children:[a.jsx("span",{style:{color:"#63b3ed",fontWeight:"bold"},children:""}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#f687b3",fontWeight:"bold"},children:""}),""]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#faf089",fontWeight:"bold"},children:""}),"EP"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#b794f4",fontWeight:"bold"},children:""}),"SEP"]}),a.jsxs("div",{children:[a.jsx("span",{style:{color:"#68d391",fontWeight:"bold"},children:""}),""]})]})]}),a.jsxs("section",{style:{marginBottom:25},children:[a.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),a.jsxs("ul",{style:{lineHeight:1.8,paddingLeft:20,color:"#e2e8f0"},children:[a.jsxs("li",{children:[a.jsx("span",{style:{color:"#faf089"},children:"EP"}),"54112"]}),a.jsxs("li",{children:[a.jsx("span",{style:{color:"#b794f4"},children:"SEP"}),"76112"]}),a.jsx("li",{children:"1111"}),a.jsx("li",{children:"+2/+2"}),a.jsx("li",{children:"+3/+3"})]})]}),a.jsxs("section",{children:[a.jsx("h3",{style:{color:"#f6e05e",borderBottom:"1px solid #4a5568",paddingBottom:8},children:""}),a.jsxs("ul",{style:{lineHeight:1.8,paddingLeft:20,color:"#e2e8f0"},children:[a.jsxs("li",{children:[a.jsx("span",{style:{color:"#ed8936"},children:"PP"}),""]}),a.jsx("li",{children:"151612PP +1"})]})]})]})}),T3=({logs:t,onCardNameClick:e,scale:n=1,isMobile:r=!1})=>{const s=$.useRef(null);$.useEffect(()=>{s.current&&(s.current.scrollTop=s.current.scrollHeight)},[t.length]);const i=(c,d)=>{const u={color:"#ffd700",cursor:"pointer",textDecoration:"underline",textUnderlineOffset:"2px",fontWeight:"bold"},p=h=>{h.target.style.color="#ffec8b",h.target.style.textShadow="0 0 8px rgba(255, 215, 0, 0.8)"},f=h=>{h.target.style.color="#ffd700",h.target.style.textShadow="none"},b=(h,W)=>a.jsx("span",{style:u,onMouseEnter:p,onMouseLeave:f,onClick:G=>{G.stopPropagation(),e==null||e(h)},children:h},W),I=mb(),k=h=>h?!(/[a-zA-Z0-9]/.test(h)||/[\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/.test(h)):!0,F=[];for(const h of I){let W=0;for(;;){const G=c.indexOf(h,W);if(G===-1)break;const ce=G>0?c[G-1]:void 0,N=G+h.length<c.length?c[G+h.length]:void 0,J=k(ce)&&k(N),Q=F.some(Ie=>G>=Ie.start&&G<Ie.end||G+h.length>Ie.start&&G+h.length<=Ie.end||G<=Ie.start&&G+h.length>=Ie.end);J&&!Q&&F.push({start:G,end:G+h.length,name:h}),W=G+1}}if(F.length===0)return a.jsx("span",{children:c});F.sort((h,W)=>h.start-W.start);const x=[];let v=0,T=0;for(const h of F)h.start>v&&x.push(a.jsx("span",{children:c.slice(v,h.start)},T++)),x.push(b(h.name,T++)),v=h.end;return v<c.length&&x.push(a.jsx("span",{children:c.slice(v)},T++)),a.jsx(a.Fragment,{children:x})},o=r?Math.max(100,140*n):Math.max(150,200*n),l=r?Math.max(140,180*n):Math.max(180,220*n);return a.jsxs("div",{ref:s,style:{position:"absolute",left:0,top:"45%",transform:"translateY(-50%)",width:l,height:o,overflowY:"auto",background:"linear-gradient(to right, rgba(0,0,0,0.8), rgba(0,0,0,0.0))",color:"#fff",fontSize:r?`${Math.max(.55,.65*n)}rem`:`${Math.max(.65,.75*n)}rem`,padding:r?`${6*n}px ${6*n}px ${6*n}px ${10*n}px`:`${8*n}px ${8*n}px ${8*n}px ${12*n}px`,borderLeft:r?"2px solid #63b3ed":"3px solid #63b3ed",zIndex:15,pointerEvents:"auto",scrollbarWidth:"thin"},onMouseDown:c=>c.stopPropagation(),onClick:c=>c.stopPropagation(),children:[a.jsx("div",{style:{fontWeight:"bold",marginBottom:(r?3:4)*n,color:"#a0aec0",borderBottom:"1px solid rgba(255,255,255,0.1)",paddingBottom:2,fontSize:r?`${Math.max(.5,.55*n)}rem`:`${Math.max(.55,.65*n)}rem`,textTransform:"uppercase",letterSpacing:1},children:r?"LOG":"BATTLE LOG"}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:(r?2:3)*n},children:t.map((c,d)=>a.jsx("div",{style:{opacity:.9,lineHeight:r?"1.3":"1.4",textShadow:"0 1px 2px black",animation:"fadeIn 0.3s ease-out"},children:i(c)},d))})]})},I3=({card:t,evolvedImageUrl:e,startX:n,startY:r,phase:s,onPhaseChange:i,onShake:o,useSep:l,playSE:c,scale:d,isLightMode:u=!1})=>{const[p,f]=$.useState(0),[b,I]=$.useState(0),[k,F]=$.useState(0),[x,v]=$.useState(0),[T,h]=$.useState(0),[W,G]=$.useState(.25),[ce,N]=$.useState({x:n,y:r}),[J,Q]=$.useState(!1),[Ie,Je]=$.useState([]),[pe,se]=$.useState([]),[P,w]=$.useState(!1),R=$.useRef(!1),y=$.useRef(null),g=$.useRef(i),C=$.useRef(o),O=$.useRef(c);$.useEffect(()=>{g.current=i,C.current=o,O.current=c},[i,o,c]);const M=360*d,U=480*d;$.useEffect(()=>{var re,He,st;console.log("[EvolutionAnimation] Phase:",s);let ue,ne=null;switch(s){case"ZOOM_IN":{N({x:n,y:r}),G(.25),I(0);const Ue=Date.now(),De=650,mt=.25,Et=.75,Mt=setInterval(()=>{const Me=Date.now()-Ue,Be=Math.min(Me/De,1),Pt=1-Math.pow(1-Be,2);I(-5*Pt),G(mt+(Et-mt)*Pt),Be>=1&&clearInterval(Mt)},16);ue=setTimeout(()=>{const Me=280*d,Be=window.innerWidth-Me,Pt=Me+Be*.4;N({x:Pt,y:window.innerHeight/2-30*d})},50);const de=setTimeout(()=>{const Me=new Audio(ot("/se/kirakira.mp3"));Me.volume=.35,Me.play().catch(()=>{}),y.current=Me},600),Le=setTimeout(()=>{g.current("WHITE_FADE")},700);return()=>{clearTimeout(ue),clearTimeout(Le),clearTimeout(de),clearInterval(Mt)}}case"WHITE_FADE":(re=O.current)==null||re.call(O,"magic_charge.mp3",.3);const je=Array(80).fill(0).map((Ue,De)=>{const mt=De/80*360,Et=(Math.random()-.5)*10,Mt=mt+Et,de=200+Math.random()*600,Le=Math.random()*1.8,Be=.5+(de-200)/600*.5,Pt=24+Math.random()*48;return{id:De,angle:Mt,dist:de,delay:Le,duration:Be,size:Pt}});Je(je),w(!0);let we=0;return ne=setInterval(()=>{we+=.025,v(Math.min(we,1)),h(Math.min(we*80,80)),F(we*15),we>=1.2&&(ne&&clearInterval(ne),w(!1),g.current("FLIP"))},40),()=>{ne&&clearInterval(ne)};case"FLIP":if((He=O.current)==null||He.call(O,"syakin.mp3",.8),(st=O.current)==null||st.call(O,"KO.mp3",.7),y.current){const Ue=y.current,De=300,mt=30,Et=De/mt,Mt=Ue.volume/Et;let de=0;const Le=setInterval(()=>{de++,Ue.volume=Math.max(0,Ue.volume-Mt),de>=Et&&(clearInterval(Le),Ue.pause(),y.current=null)},mt)}Je([]);const Re=Date.now(),at=400,qe=1200;return ne=setInterval(()=>{const Ue=Date.now()-Re;if(Ue<at){const De=Ue/at,mt=1-Math.pow(1-De,3),Et=10+mt*160;if(f(Et),G(.75+mt*((l?1.2:1.1)-.75)),I(-5+mt*2),v(Math.max(1-De*3,0)),Et>90&&!R.current){R.current=!0;const de=Array(120).fill(0).map((Le,Me)=>{const Be=Me/120*360,Pt=(Math.random()-.5)*8,_s=18+Math.random()*42;return{id:Me,angle:Be+Pt,dist:200+Math.random()*400,size:_s*3,delay:Math.random()*.05}});se(de)}}else{const De=Math.min((Ue-at)/qe,1),mt=De<.5?2*De*De:1-Math.pow(-2*De+2,2)/2;if(f(170+mt*10),v(0),!R.current){R.current=!0;const Et=Array(120).fill(0).map((Mt,de)=>{const Le=de/120*360,Me=(Math.random()-.5)*8,Be=18+Math.random()*42;return{id:de,angle:Le+Me,dist:200+Math.random()*400,size:Be*3,delay:Math.random()*.05}});se(Et)}De>=1&&(ne&&clearInterval(ne),g.current("REVEAL"))}},16),()=>{ne&&clearInterval(ne)};case"REVEAL":let Ze=0;return ne=setInterval(()=>{Ze+=.25,v(Math.max(1-Ze,0)),h(Math.max(60-Ze*60,0)),Ze>=1&&(ne&&clearInterval(ne),se([]),g.current("ZOOM_OUT"))},40),()=>{ne&&clearInterval(ne)};case"ZOOM_OUT":{N({x:n,y:r});const Ue=Date.now(),De=250,mt=W,Et=-3;return ne=setInterval(()=>{const Mt=Date.now()-Ue,de=Math.min(Mt/De,1),Le=1-Math.pow(1-de,3);G(mt-(mt-.25)*Le),I(Et*(1-Le)),de>=1&&(ne&&clearInterval(ne),f(180),F(0),G(.25),I(0),g.current("LAND"))},16),()=>{ne&&clearInterval(ne)}}case"LAND":return C.current(),Q(!0),ue=setTimeout(()=>{g.current("DONE")},600),()=>clearTimeout(ue)}return()=>{ue&&clearTimeout(ue),ne&&clearInterval(ne),y.current&&(y.current.pause(),y.current=null)}},[s]);const H=p+k,me=b,ve=P?{x:(Math.random()-.5)*4,y:(Math.random()-.5)*4}:{x:0,y:0};return a.jsxs("div",{style:{position:"fixed",inset:0,zIndex:1e4,background:"rgba(0,0,0,0.75)",pointerEvents:"none"},children:[a.jsx("style",{children:`
                ${Ie.map(ue=>`
                    @keyframes chargeParticleIn-${ue.id} {
                        0% { opacity: 0; transform: rotate(${ue.angle}deg) translateX(${ue.dist}px) scale(0.5); }
                        20% { opacity: 0.8; transform: rotate(${ue.angle}deg) translateX(${ue.dist*.8}px) scale(1.2); }
                        100% { opacity: 1; transform: rotate(${ue.angle}deg) translateX(0) scale(0.2); } /* Keep visible at end */
                    }
                `).join("")}
                ${pe.map(ue=>`
                    @keyframes burstParticleOut-${ue.id} {
                        0% { opacity: 1; transform: translate(-50%, -50%) rotate(${ue.angle}deg) translateX(0) scale(1.5); }
                        100% { opacity: 0; transform: translate(-50%, -50%) rotate(${ue.angle}deg) translateX(${ue.dist*1.5}px) scale(0); }
                    }
                `).join("")}
            `}),(u?Ie.filter((ue,ne)=>ne%2===0):Ie).map(ue=>a.jsx("div",{style:{position:"absolute",left:ce.x,top:ce.y,width:ue.size*d,height:ue.size*d,borderRadius:"50%",background:"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(200,230,255,0.6) 40%, transparent 70%)",boxShadow:u?"0 0 8px white":"0 0 10px white, 0 0 20px rgba(100,200,255,0.5)",filter:u?void 0:"blur(1px)",animation:`chargeParticleIn-${ue.id} ${ue.duration}s ease-in ${ue.delay}s forwards`,transform:`rotate(${ue.angle}deg) translateX(${ue.dist*d}px)`,opacity:0,pointerEvents:"none"}},`charge-${ue.id}`)),s==="WHITE_FADE"&&a.jsxs("div",{style:{position:"absolute",left:ce.x+ve.x,top:ce.y+ve.y,width:0,height:0,transformStyle:"preserve-3d"},children:[a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:500*d,height:500*d,border:"8px solid rgba(255, 255, 255, 0.6)",borderRadius:"50%",transform:"translate(-50%, -50%) rotateX(75deg)",boxShadow:u?"0 0 15px rgba(255, 255, 255, 0.6)":"0 0 30px rgba(255, 255, 255, 0.8), inset 0 0 30px rgba(255, 255, 255, 0.8)",animation:"ringSpin 2s linear infinite"}}),!u&&a.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:600*d,height:600*d,border:"6px dashed rgba(100, 200, 255, 0.7)",borderRadius:"50%",transform:"translate(-50%, -50%) rotateX(80deg) rotateY(10deg)",boxShadow:"0 0 40px rgba(100, 200, 255, 0.5)",animation:"ringSpinReverse 3s linear infinite"}}),a.jsx("style",{children:`
                        @keyframes ringSpin {
                            0% { transform: translate(-50%, -50%) rotateX(75deg) rotate(0deg); opacity: 0; scale: 0.5; }
                            20% { opacity: 1; scale: 1; }
                            100% { transform: translate(-50%, -50%) rotateX(75deg) rotate(360deg); opacity: 1; scale: 1; }
                        }
                        @keyframes ringSpinReverse {
                            0% { transform: translate(-50%, -50%) rotateX(80deg) rotateY(10deg) rotate(0deg); opacity: 0; scale: 0.6; }
                            20% { opacity: 0.8; scale: 1; }
                            100% { transform: translate(-50%, -50%) rotateX(80deg) rotateY(10deg) rotate(-360deg); opacity: 0.8; scale: 1; }
                        }
                    `})]}),(u?pe.filter((ue,ne)=>ne%2===0):pe).map(ue=>a.jsx("div",{style:{position:"absolute",left:ce.x,top:ce.y,width:ue.size*d,height:ue.size*d,borderRadius:"50%",background:l?"radial-gradient(circle, rgba(183, 148, 244, 1) 0%, rgba(159, 122, 234, 0.8) 50%, transparent 100%)":"radial-gradient(circle, rgba(255, 251, 235, 1) 0%, rgba(251, 211, 141, 0.8) 50%, transparent 100%)",boxShadow:u?l?"0 0 8px #b794f4":"0 0 8px #fbd38d":l?"0 0 10px #b794f4, 0 0 20px rgba(159,122,234,0.6)":"0 0 10px #fbd38d, 0 0 20px rgba(251,211,141,0.6)",animation:`burstParticleOut-${ue.id} 0.4s ease-out ${ue.delay}s forwards`,pointerEvents:"none"}},`burst-${ue.id}`)),a.jsxs("div",{style:{position:"absolute",left:ce.x+ve.x,top:ce.y+ve.y,transform:`translate(-50%, -50%) scale(${W}) perspective(1200px) rotateY(${H}deg) rotateZ(${me}deg)`,transition:s==="ZOOM_IN"||s==="ZOOM_OUT"?"left 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), top 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)":"none",transformStyle:"preserve-3d"},children:[!u&&a.jsx("div",{style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:M*1.3,height:U*1.2,background:l?"radial-gradient(ellipse, rgba(159, 122, 234, 0.4) 0%, transparent 70%)":"radial-gradient(ellipse, rgba(251, 211, 141, 0.4) 0%, transparent 70%)",filter:"blur(20px)",pointerEvents:"none",opacity:T>1?1:0,transition:"opacity 0.4s"}}),a.jsxs("div",{style:{width:M,height:U,borderRadius:16,overflow:"hidden",boxShadow:u?l?"0 0 20px rgba(159, 122, 234, 0.5)":"0 0 20px rgba(251, 211, 141, 0.5)":l?"0 0 40px rgba(159, 122, 234, 0.7)":"0 0 40px rgba(251, 211, 141, 0.7)",position:"relative",transformStyle:"preserve-3d"},children:[a.jsxs("div",{style:{position:"absolute",inset:0,borderRadius:16,overflow:"hidden",background:"#1a202c",zIndex:H<=90?2:1,opacity:H<=90?1:0},children:[a.jsx("img",{src:ot(t.imageUrl||""),alt:t.name,style:{width:"100%",height:"100%",objectFit:"cover",filter:`brightness(${1+x*.5}) contrast(${1-x*.2})`}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"white",opacity:x,pointerEvents:"none"}})]}),a.jsxs("div",{style:{position:"absolute",inset:0,transform:"rotateY(180deg)",borderRadius:16,overflow:"hidden",background:"#1a202c",zIndex:H>90?2:1,opacity:H>90?1:0},children:[a.jsx("img",{src:ot(e&&e!==""?e:t.imageUrl||""),alt:`${t.name} Evolved`,style:{width:"100%",height:"100%",objectFit:"cover",filter:`brightness(${1+x*.5}) contrast(${1-x*.2})`}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"white",opacity:x,pointerEvents:"none"}})]})]})]}),J&&a.jsxs("div",{style:{position:"absolute",left:n,top:r,pointerEvents:"none"},children:[a.jsx("style",{children:`
                        @keyframes landParticleMove {
                            0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                            100% { opacity: 0; transform: translate(-50%, -50%) rotate(var(--angle)) translateX(calc(var(--dist) * 1px)) scale(0); }
                        }
                    `}),Array(20).fill(0).map((ue,ne)=>{const re=ne/20*360,He=40+Math.random()*100;return a.jsx("div",{style:{position:"absolute",left:0,top:0,width:8*d,height:8*d,borderRadius:"50%",background:"white","--angle":`${re}deg`,"--dist":He,animation:"landParticleMove 0.5s ease-out forwards"}},`land-${ne}`)})]})]})},Yx=ot("/leaders/yoRuka_win.png"),Kx=ot("/leaders/yoRuka_lose.png"),w3=ot("/leaders/senka_win.png"),C3=ot("/leaders/senka_lose.png"),k3=ot("/leaders/azya_win.png"),R3=ot("/leaders/azya_lose.png"),Za=t=>({BRONZE:"#cd7f32",SILVER:"#c0c0c0",GOLD:"#ffd700",PLATINUM:"#e5e4e2",DIAMOND:"#b9f2ff",MASTER:"#ff4500"})[t],A3=({winnerId:t,playerId:e,playerClass:n,onRematch:r,onRematching:s,onLeave:i,isOnline:o,isRoomMatch:l=!0,myRematchRequested:c,opponentRematchRequested:d,battleStats:u,selectedCardInfo:p,onCardInfoClick:f,victoryReason:b="normal",isRankedMatch:I=!1,ratingResult:k})=>{const F=t===e,[x,v]=$.useState(k?k.newRating-k.ratingChange:0),T=$.useRef(null),h=1500,W=U=>{const H=Wo.find(ne=>U>=ne.min&&U<=ne.max)||Wo[0],me=H.rank==="MASTER"?2e3:H.max-H.min+1,ve=U-H.min,ue=Math.min(1,ve/me);return{rank:H.rank,progress:ue,ratingInRank:ve,rankMax:me}};$.useEffect(()=>{if(!k||!I)return;const U=k.newRating-k.ratingChange,H=k.newRating,me=ue=>{T.current||(T.current=ue);const ne=ue-T.current,re=Math.min(ne/h,1),He=1-(1-re)*(1-re),st=U+(H-U)*He;v(st),re<1&&requestAnimationFrame(me)},ve=setTimeout(()=>{T.current=null,requestAnimationFrame(me)},100);return()=>clearTimeout(ve)},[k,I,h]);const ce=(()=>{if(!F)return null;switch(b){case"disconnect":return"";case"surrender":return"";default:return null}})(),[N,J]=$.useState("bg-fade"),Q=["bg-fade","image","result-text","stats","rate","buttons","complete"].indexOf(N);$.useEffect(()=>{const U={"bg-fade":300,image:600,"result-text":400,stats:400,rate:300,buttons:0};if(N==="complete")return;const H={"bg-fade":"image",image:"result-text","result-text":"stats",stats:"rate",rate:"buttons",buttons:"complete"},me=setTimeout(()=>{const ve=H[N];ve&&J(ve)},U[N]||0);return()=>clearTimeout(me)},[N]);const Ie=()=>n==="SENKA"?F?w3:C3:n==="AJA"?F?k3:R3:F?Yx:Kx,[Je,pe]=$.useState(15),[se,P]=$.useState(!1),[w,R]=$.useState(null),y=o?c||d:c||se;$.useEffect(()=>{if(y)return;const U=setInterval(()=>{pe(H=>H<=1?(clearInterval(U),i(),0):H-1)},1e3);return()=>clearInterval(U)},[i,y]);const g=U=>{R(U),o&&!l&&s?s(U):r(U)},C=()=>{const U=!o||l?"":"";return o?c&&d?"...":c?"...":d?`${U}`:U:c?"...":U},O=()=>{const U={padding:"15px 40px",fontSize:"1.5rem",fontWeight:"bold",border:"none",borderRadius:12,cursor:c?"default":"pointer",transform:"scale(1)",transition:"transform 0.1s, background 0.2s"};return d&&!c?{...U,background:"linear-gradient(135deg, #f6e05e, #d69e2e)",color:"black",boxShadow:"0 4px 15px rgba(246, 224, 94, 0.6)",animation:"pulse 1s infinite"}:c?{...U,background:"linear-gradient(135deg, #718096, #4a5568)",color:"white",boxShadow:"none"}:{...U,background:"linear-gradient(135deg, #48bb78, #38a169)",color:"white",boxShadow:"0 4px 15px rgba(72, 187, 120, 0.4)"}},M=(U,H)=>({width:220,height:220,borderRadius:"50%",border:w===U?"5px solid #f6e05e":"4px solid rgba(255,255,255,0.4)",background:U==="AJA"?`url(${Tl(U)}) center top/cover`:`url(${Tl(U)}) center/cover`,cursor:"pointer",transform:H?"scale(1.1)":"scale(1)",transition:"all 0.2s ease",boxShadow:H?"0 0 30px rgba(246, 224, 94, 0.7)":"0 6px 15px rgba(0,0,0,0.5)"});return a.jsxs("div",{style:{position:"absolute",inset:0,zIndex:5e3,background:"rgba(0,0,0,0.85)",backdropFilter:"blur(10px)",display:"flex",flexDirection:"row",alignItems:"stretch",opacity:Q>=0?1:0,transition:"opacity 0.3s ease-out"},onClick:()=>{},children:[a.jsx("style",{children:`
                @keyframes pulse {
                    0%, 100% { transform: scale(1); }
                    50% { transform: scale(1.05); }
                }
                @keyframes float {
                    0%, 100% { transform: translateY(0); }
                    50% { transform: translateY(-10px); }
                }
                @keyframes slideUpFadeIn {
                    0% { opacity: 0; transform: translateY(30px); }
                    100% { opacity: 1; transform: translateY(0); }
                }
                @keyframes imageFadeIn {
                    0% { opacity: 0; transform: scale(0.95); }
                    100% { opacity: 0.9; transform: scale(1); }
                }
            `}),a.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:40,borderRight:"1px solid rgba(255,255,255,0.1)"},children:p?a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:16,maxWidth:320},children:[a.jsx("div",{style:{width:200,height:280,backgroundImage:`url(${ot(`/cards/${p.id}.png`)})`,backgroundSize:"cover",backgroundPosition:"center",borderRadius:12,boxShadow:"0 8px 30px rgba(0,0,0,0.6)"}}),a.jsx("div",{style:{fontFamily:"var(--font-tamanegi)",fontSize:"1.6rem",color:"white",textShadow:"0 2px 6px rgba(0,0,0,0.6)",textAlign:"center"},children:p.name}),a.jsxs("div",{style:{display:"flex",gap:20,fontSize:"1.2rem",color:"rgba(255,255,255,0.9)"},children:[a.jsxs("span",{children:[": ",p.cost]}),p.type==="FOLLOWER"&&a.jsxs(a.Fragment,{children:[a.jsxs("span",{children:[": ",p.attack]}),a.jsxs("span",{children:[": ",p.health]})]})]}),a.jsx("div",{style:{fontSize:"1rem",color:"rgba(255,255,255,0.7)",textAlign:"center",lineHeight:1.5,maxHeight:120,overflow:"auto"},children:p.description||""}),a.jsx("button",{onClick:()=>f(null),style:{padding:"8px 24px",fontSize:"1rem",background:"transparent",border:"1px solid rgba(255,255,255,0.3)",color:"white",borderRadius:8,cursor:"pointer",marginTop:10},children:""})]}):a.jsx("div",{style:{width:"100%",height:"100%",backgroundImage:`url(${Ie()})`,backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat",opacity:Q>=1?.9:0,transform:Q>=1?"scale(1)":"scale(0.95)",transition:"opacity 0.6s ease-out, transform 0.6s ease-out"}})}),a.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:40,position:"relative"},children:[a.jsx("div",{style:{fontFamily:"var(--font-tamanegi)",fontSize:"5rem",color:F?"#f6e05e":"#a0aec0",textShadow:F?"0 0 40px rgba(246, 224, 94, 0.7), 4px 4px 8px rgba(0,0,0,0.6)":"0 0 20px rgba(160, 174, 192, 0.5), 4px 4px 8px rgba(0,0,0,0.6)",marginBottom:20,opacity:Q>=2?1:0,transform:Q>=2?"translateY(0)":"translateY(30px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out",animation:Q>=2?"float 3s ease-in-out infinite":"none"},children:F?"":""}),ce&&a.jsx("div",{style:{fontSize:"1.1rem",color:"rgba(255, 255, 255, 0.8)",marginTop:-10,marginBottom:20,opacity:Q>=2?1:0,transform:Q>=2?"translateY(0)":"translateY(20px)",transition:"opacity 0.4s ease-out 0.2s, transform 0.4s ease-out 0.2s"},children:ce}),a.jsxs("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"center",gap:16,marginBottom:30,padding:"16px 24px",background:"rgba(0,0,0,0.3)",borderRadius:12,border:"1px solid rgba(255,255,255,0.1)",opacity:Q>=3?1:0,transform:Q>=3?"translateY(0)":"translateY(30px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out"},children:[a.jsxs("div",{style:{textAlign:"center",minWidth:80},children:[a.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#f6e05e"},children:u.turnCount}),a.jsx("div",{style:{fontSize:"0.9rem",color:"rgba(255,255,255,0.6)"},children:""})]}),a.jsxs("div",{style:{textAlign:"center",minWidth:80},children:[a.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#48bb78"},children:u.damageDealtToOpponent}),a.jsx("div",{style:{fontSize:"0.9rem",color:"rgba(255,255,255,0.6)"},children:""})]}),a.jsxs("div",{style:{textAlign:"center",minWidth:80},children:[a.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#e53e3e"},children:u.damageReceivedFromOpponent}),a.jsx("div",{style:{fontSize:"0.9rem",color:"rgba(255,255,255,0.6)"},children:""})]}),a.jsxs("div",{style:{textAlign:"center",minWidth:80},children:[a.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:"#63b3ed"},children:u.followersDestroyed}),a.jsx("div",{style:{fontSize:"0.9rem",color:"rgba(255,255,255,0.6)"},children:""})]})]}),I&&k&&(()=>{var me;const U=W(x),H=W(k.newRating);return a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:12,marginTop:16,opacity:Q>=4?1:0,transform:Q>=4?"translateY(0)":"translateY(20px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out",width:"90%",maxWidth:500},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,background:"rgba(0, 0, 0, 0.5)",padding:"12px 24px",borderRadius:12,border:`2px solid ${k.ratingChange>=0?"#48bb78":"#e53e3e"}`},children:[a.jsx("span",{style:{fontSize:"1.2rem",color:"rgba(255,255,255,0.8)",fontFamily:"var(--font-tamanegi)"},children:""}),a.jsxs("span",{style:{fontSize:"2rem",fontWeight:"bold",color:k.ratingChange>=0?"#48bb78":"#e53e3e",fontFamily:"var(--font-tamanegi)"},children:[k.ratingChange>=0?"+":"",k.ratingChange]})]}),k.ratingChange>0&&(k.bonusBreakdown.winStreakBonus>0||k.bonusBreakdown.rankDiffBonus>0)&&a.jsxs("div",{style:{display:"flex",gap:16,fontSize:"0.85rem",color:"rgba(255,255,255,0.6)",fontFamily:"var(--font-tamanegi)"},children:[a.jsxs("span",{children:[": +",k.bonusBreakdown.base]}),k.bonusBreakdown.winStreakBonus>0&&a.jsxs("span",{style:{color:"#f6e05e"},children:[": +",k.bonusBreakdown.winStreakBonus]}),k.bonusBreakdown.rankDiffBonus>0&&a.jsxs("span",{style:{color:"#63b3ed"},children:[": +",k.bonusBreakdown.rankDiffBonus]})]}),a.jsxs("div",{style:{width:"100%",display:"flex",flexDirection:"column",gap:8,background:"rgba(0, 0, 0, 0.5)",padding:16,borderRadius:12,border:"2px solid rgba(255, 255, 255, 0.2)"},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[a.jsx("span",{style:{fontSize:"1.4rem",fontWeight:"bold",color:Za(U.rank),fontFamily:"var(--font-tamanegi)",textShadow:`0 0 10px ${Za(U.rank)}80`},children:pr[U.rank]}),a.jsxs("span",{style:{fontSize:"1rem",color:"rgba(255,255,255,0.8)",fontFamily:"var(--font-tamanegi)"},children:[Math.floor(x)," / ",U.rank==="MASTER"?"":((me=Wo.find(ve=>ve.rank===U.rank))==null?void 0:me.max)||0]})]}),a.jsxs("div",{style:{width:"100%",height:24,background:"rgba(0, 0, 0, 0.7)",borderRadius:12,overflow:"hidden",border:"2px solid rgba(255, 255, 255, 0.3)",position:"relative"},children:[a.jsx("div",{style:{width:`${U.progress*100}%`,height:"100%",background:`linear-gradient(90deg, ${Za(U.rank)}cc, ${Za(U.rank)})`,borderRadius:10,transition:"width 0.05s linear",boxShadow:`0 0 10px ${Za(U.rank)}80`}}),a.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.75rem",fontWeight:"bold",color:"white",textShadow:"0 1px 2px rgba(0,0,0,0.8)",fontFamily:"var(--font-tamanegi)"},children:[Math.floor(U.ratingInRank)," / ",U.rankMax]})]})]}),k.isRankUp&&x>=k.newRating-10&&a.jsxs("div",{style:{fontSize:"1.4rem",fontWeight:"bold",color:"#f6e05e",textShadow:"0 0 20px rgba(246, 224, 94, 0.8)",fontFamily:"var(--font-tamanegi)",animation:"pulse 1s ease-in-out infinite"},children:[pr[H.rank],""]}),k.isRankDown&&a.jsxs("div",{style:{fontSize:"1.2rem",color:"#e53e3e",fontFamily:"var(--font-tamanegi)"},children:[pr[H.rank],""]})]})})(),a.jsx("div",{style:{position:"absolute",right:20,bottom:270,width:180,textAlign:"center",fontFamily:"var(--font-tamanegi)",fontSize:"1.4rem",color:F?"#f6e05e":"#e53e3e",textShadow:F?"0 0 20px rgba(246, 224, 94, 0.8), 2px 2px 4px rgba(0,0,0,0.8)":"0 0 20px rgba(229, 62, 62, 0.8), 2px 2px 4px rgba(0,0,0,0.8)",zIndex:10,opacity:Q>=5?1:0,transition:"opacity 0.4s ease-out"},children:F?"":""}),se&&!c?a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",animation:"fadeIn 0.3s ease-out"},children:[a.jsx("div",{style:{fontFamily:"var(--font-tamanegi)",fontSize:"1.6rem",color:"white",marginBottom:24,textShadow:"0 2px 6px rgba(0,0,0,0.6)"},children:""}),a.jsxs("div",{style:{display:"flex",gap:40,marginBottom:24},children:[a.jsx(Xx,{deckType:"SENKA",label:"",onSelect:g,getStyle:M}),a.jsx(Xx,{deckType:"AJA",label:"",onSelect:g,getStyle:M})]}),a.jsx("button",{onClick:()=>P(!1),style:{padding:"10px 36px",fontSize:"1.1rem",fontWeight:"bold",background:"transparent",border:"2px solid rgba(255,255,255,0.3)",color:"white",borderRadius:10,cursor:"pointer",marginTop:8},children:""})]}):a.jsxs("div",{style:{display:"flex",gap:20,opacity:Q>=5?1:0,transform:Q>=5?"translateY(0)":"translateY(30px)",transition:"opacity 0.4s ease-out, transform 0.4s ease-out"},children:[a.jsx("button",{onClick:()=>{c||P(!0)},disabled:c,style:O(),onMouseDown:U=>{c||(U.currentTarget.style.transform="scale(0.95)")},onMouseUp:U=>U.currentTarget.style.transform="scale(1)",children:C()}),a.jsxs("button",{onClick:i,style:{padding:"15px 40px",fontSize:"1.5rem",fontWeight:"bold",background:"transparent",border:"2px solid rgba(255,255,255,0.3)",color:"white",borderRadius:12,cursor:"pointer"},children:[" ",!y&&`(${Je})`]})]}),a.jsx("div",{onClick:()=>{se&&!c&&g("YORUKA")},style:{position:"absolute",right:20,bottom:20,width:180,height:240,backgroundImage:`url(${F?Yx:Kx})`,backgroundSize:"cover",backgroundPosition:"center",borderRadius:12,cursor:se&&!c?"pointer":"default",opacity:Q>=5?.7:0,transition:"opacity 0.4s ease",boxShadow:"0 8px 20px rgba(0,0,0,0.4)"}})]})]})},Xx=({deckType:t,label:e,onSelect:n,getStyle:r})=>{const[s,i]=$.useState(!1);return a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:12},children:[a.jsx("button",{onClick:()=>n(t),onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),style:r(t,s)}),a.jsx("span",{style:{color:"white",fontFamily:"var(--font-tamanegi)",fontSize:"1.4rem",textShadow:"0 2px 6px rgba(0,0,0,0.6)"},children:e})]})},Jx=(t,e)=>{const[n,r]=$.useState([]),s=$.useRef(!1);return $.useEffect(()=>{r(i=>{const o=[],l=new Map((t||[]).filter(c=>c).map(c=>[c.instanceId,c]));return i.forEach(c=>{var u;if(!c)return;const d=l.get(c.instanceId);d?(o.push({...d,passiveAbilities:d.passiveAbilities?[...d.passiveAbilities]:[],hasBarrier:d.hasBarrier??((u=d.passiveAbilities)==null?void 0:u.includes("BARRIER"))??!1,isDying:!1}),l.delete(c.instanceId)):o.push({...c,isDying:!0,killedByBane:c.killedByBane})}),l.forEach(c=>{var d;o.push({...c,passiveAbilities:c.passiveAbilities?[...c.passiveAbilities]:[],hasBarrier:c.hasBarrier??((d=c.passiveAbilities)==null?void 0:d.includes("BARRIER"))??!1,isDying:!1})}),o})},[t]),$.useEffect(()=>{if(n.some(o=>o.isDying)){if(e!=null&&e.current){s.current=!0;return}const o=setTimeout(()=>{r(l=>l.filter(c=>!c.isDying))},700);return()=>clearTimeout(o)}},[n,e]),$.useEffect(()=>{const o=setInterval(()=>{if(!(e!=null&&e.current)&&s.current){s.current=!1;const l=setTimeout(()=>{r(c=>c.filter(d=>!d.isDying))},300);return()=>clearTimeout(l)}},100);return()=>clearInterval(o)},[e]),n},P3=({playerClass:t,opponentType:e,gameMode:n,targetRoomId:r,onLeave:s,onRematching:i,networkAdapter:o,networkConnected:l,opponentClass:c,aiDifficulty:d="NORMAL",playerName:u,timerEnabled:p=!0,playerId:f,opponentPlayerId:b,opponentRating:I})=>{var Xm,Jm,Qm,qm,Zm,ey,ty,ny,ry;const k=n==="CPU"||!o,F=l3(k?n==="CPU"?"CPU":n:"CPU",k?r:void 0),x=o||F.adapter,v=l!==void 0?l:F.connected,T=m3(),{scale:h,toGameX:W,toGameY:G}=T,{isLightMode:ce}=v2(),[N,J]=A.useState(!1);A.useEffect(()=>{(()=>{J("ontouchstart"in window||navigator.maxTouchPoints>0)})()},[]);const Q=A.useCallback((m,_)=>({x:W(m),y:G(_)}),[W,G]),[Ie,Je]=A.useState(null),pe=$.useRef(T);A.useEffect(()=>{pe.current=T},[T]);const se=n==="CPU"||n==="HOST"||(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&(x==null?void 0:x.isHost)===!0,P=se?"p1":"p2",w=se?"p2":"p1";console.log("[GameScreen INIT]",{gameMode:n,"adapter exists":!!x,"adapter?.isHost":x==null?void 0:x.isHost,"adapter?.isHost === true":(x==null?void 0:x.isHost)===!0,isHost:se,currentPlayerId:P,connected:v,"networkAdapter provided":!!o,networkConnected:l});const R=c||(t==="YORUKA"?Math.random()<.5?"SENKA":"AJA":t==="SENKA"?"AJA":"SENKA"),y=n==="JOIN"||(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&!se,[g,C]=A.useReducer(Tw,null,()=>{const m=n==="CPU"?"CPU":"";return y?Ld(m,R,u,t):Ld(u,t,m,R)}),[O,M]=A.useState(!y),U=n==="CASUAL_MATCH"||n==="RANKED_MATCH",[H,me]=$.useState(U?!1:!y),[ve,ue]=$.useState(!1),[ne,re]=$.useState(!1),[He,st]=$.useState(!1),[je,we]=$.useState(U),[Re,at]=$.useState(!1),qe=$.useRef(!1);console.log("[GameScreen SYNC STATE]",{isCasualOrRanked:U,isJoinSide:y,gameSynced:O,waitingForIntroSync:je,opponentReadyForIntro:Re,showBattleIntro:H,"introSyncSentRef.current":qe.current});const[Ze,Ue]=$.useState(!1),[De,mt]=$.useState(null),[Et,Mt]=$.useState(0),[de,Le]=$.useState({x:0,y:0}),[Me,Be]=$.useState("IDLE"),[Pt,_s]=$.useState(null),[vi,Yr]=$.useState(!1),[Nn,bs]=$.useState(()=>n==="JOIN"||(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&!se?!1:Math.random()>.5);A.useEffect(()=>{H&&(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&console.log("[GameScreen DEBUG] BattleIntro shown with isFirstPlayer:",Nn,"currentPlayerId:",P,"adapter?.isHost:",x==null?void 0:x.isHost)},[H,n,Nn,P,x]);const[sr,nn]=$.useState(!1),[va,S]=$.useState(!1),[Cf,xa]=$.useState("normal"),[jn,so]=$.useState(t),[xi,Kr]=$.useState({turnCount:0,damageDealtToOpponent:0,damageReceivedFromOpponent:0,followersDestroyed:0,myFollowersDestroyed:0}),[kf,_a]=$.useState(null),[Rf,ba]=$.useState(null),[Ea,Sa]=$.useState(!1),[Ec,Sc]=$.useState(void 0),[Tc,Ic]=$.useState(void 0);$.useEffect(()=>{if(n!=="RANKED_MATCH"||!f){Sc(void 0),Ic(void 0);return}(async()=>{try{const _=await ag(f,jn),E=En(_.rating);if(Sc(E),I!=null){const L=En(I);Ic(L)}}catch(_){console.error("[GameScreen] Failed to fetch rank info:",_)}})()},[n,f,jn,I]),$.useEffect(()=>{if(n!=="RANKED_MATCH"||!f||!g.winnerId||Ea)return;(async()=>{try{const _=await ag(f,jn),E=g.winnerId===P;let L;E?L=pL(_.rating,_.winStreak,I??0):L=gL(_.rating),await mL(f,jn,L,E),ba(L),Sa(!0),console.log("[RatingUpdate] Rating updated:",L)}catch(_){console.error("[RatingUpdate] Failed to update rating:",_),Sa(!0)}})()},[n,f,g.winnerId,P,jn,I,Ea]),$.useEffect(()=>{g.winnerId&&!Ze&&!He&&st(!0)},[g.winnerId,Ze,He]),$.useEffect(()=>{if(Et<=0){Le({x:0,y:0});return}let m;const _=()=>{const E=Date.now()*.03,L=25*Et*h,j=Math.sin(E*7)*L+Math.sin(E*13)*L*.5,V=Math.cos(E*11)*L+Math.cos(E*17)*L*.3;Le({x:j,y:V}),m=requestAnimationFrame(_)};return m=requestAnimationFrame(_),()=>cancelAnimationFrame(m)},[Et,h]);const[Ta,wc]=$.useState([]),Ia=$.useRef(0),[wa,Cc]=$.useState(!1),[Ca,io]=$.useState(null),[_i,$n]=$.useState(null),Kn=$.useRef(null),ir=$.useRef(null),or=$.useRef(null),ka=$.useRef(g.logs.length),D=A.useRef(!1),Fe=A.useRef(!1),lt=A.useRef(null);A.useEffect(()=>{const m=n==="HOST"||(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&se,_=U?v&&x:v&&x&&Me==="DONE";if(console.log("[GameScreen INIT_GAME useEffect]",{isHostSide:m,isCasualOrRanked:U,connected:v,"adapter exists":!!x,coinTossPhase:Me,canSendInitGame:_,"initialStateSentRef.current":D.current}),m&&_&&!D.current){console.log("[GameScreen] HOST side: Sending initial game state to JOIN"),D.current=!0;const E=()=>{const L=Nn?"p1":"p2";console.log("[GameScreen] HOST side: Actually sending INIT_GAME now",{isFirstPlayer:Nn,firstPlayerId:L,currentPlayerId:P,"adapter.isHost":x.isHost,isCasualOrRanked:U});const j=U?{...g,firstPlayerId:L,activePlayerId:L}:g;U&&C({type:"SYNC_STATE",payload:j}),x.send({type:"INIT_GAME",payload:j}),(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&(console.log("[GameScreen] HOST side: Sending READY_FOR_INTRO"),x.send({type:"READY_FOR_INTRO"}),qe.current=!0)};setTimeout(E,500),(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&setTimeout(()=>{Re||(console.log("[GameScreen] HOST side: Retrying INIT_GAME (no response yet)"),E())},2500)}},[n,v,x,g,Me,se,U,Re]),A.useEffect(()=>{!U||!x||!O||qe.current||y&&(console.log("[GameScreen] JOIN side: Sending READY_FOR_INTRO after game sync"),x.send({type:"READY_FOR_INTRO"}),qe.current=!0)},[U,x,O,y]),A.useEffect(()=>{!U||!x||!je||se&&Re&&qe.current&&(console.log("[GameScreen] HOST side: Both ready, sending START_INTRO"),x.send({type:"START_INTRO"}),we(!1),me(!0))},[U,x,se,Re,je]);const q=g.players[P],_e=g.players[w];A.useEffect(()=>{var _,E;const m=g.logs.length;if(m>ka.current)for(let L=ka.current;L<m;L++){const j=g.logs[L],V=j.match(/(.+?)  (\d+) /);if(V){const B=V[1],z=parseInt(V[2],10),K=(q==null?void 0:q.name)===B?P:w,fe=Ia.current++;wc(te=>[...te,{playerId:K,amount:z,key:fe}]),setTimeout(()=>{wc(te=>te.filter(ye=>ye.key!==fe))},1500)}const ee=j.match(/(.+?) (?:)?/);if(ee){const B=ee[1],z=(_=g.players[P])==null?void 0:_.board.find(ye=>(ye==null?void 0:ye.name)===B),K=(E=g.players[w])==null?void 0:E.board.find(ye=>(ye==null?void 0:ye.name)===B),fe=z||K,te=z?P:w;if(fe){const ye=g.players[te].board.findIndex(Se=>(Se==null?void 0:Se.instanceId)===fe.instanceId),et=(te===P?Mr.current:xr.current)[ye];if(et){const Se=et.getBoundingClientRect(),Qe=Se.left+Se.width/2,tt=Se.top+Se.height/2;jc(We=>[...We,{id:Date.now()+Math.random(),value:0,x:Qe,y:tt,color:"#e53e3e"}])}}}}ka.current=m},[g.logs.length,P,w,q==null?void 0:q.name,g.players]);const[Xr,Ra]=$.useState(!1),Jr=$.useRef(!1),In=Jx(((Xm=g.players[P])==null?void 0:Xm.board)||[],Jr),mn=Jx(((Jm=g.players[w])==null?void 0:Jm.board)||[],Jr),Aa=$.useRef(In),kc=$.useRef(mn),[bi,Rc]=$.useState(null),[Af,vm]=$.useState(-1),Ac=$.useRef(null),[oo,Pa]=$.useState([]),[Z,Qr]=$.useState(null),[yt,ar]=$.useState(null),[_2,xm]=$.useState([]),b2=$.useRef(0),_m=$.useRef(0),bm=$.useRef(null),Em=$.useRef(Z);Em.current=Z,$.useEffect(()=>{const m=Z==null?void 0:Z.sourceType;if(!m||m!=="BOARD"&&m!=="EVOLVE"){xm([]);return}const _=400,E=setInterval(()=>{const L=Em.current;if(!L||L.sourceType!=="BOARD"&&L.sourceType!=="EVOLVE")return;const j=Date.now(),V=Math.PI*(3-Math.sqrt(5));_m.current+=V+(Math.random()-.5)*.3;const ee=_m.current,B=4+Math.random()*3,z={id:b2.current++,x:L.currentX,y:L.currentY,vx:Math.cos(ee)*B,vy:Math.sin(ee)*B,opacity:1,radius:3+Math.random()*2,createdAt:j};xm(K=>[...K.filter(te=>j-te.createdAt<_).map(te=>({...te,x:te.x+te.vx,y:te.y+te.vy,opacity:Math.max(0,1-(j-te.createdAt)/_)})),z])},80);return()=>clearInterval(E)},[Z==null?void 0:Z.sourceType]),$.useEffect(()=>{const m=(Z==null?void 0:Z.sourceType)==="EVOLVE";if(m&&!or.current){const _=new Audio(ot("/se/aura.mp3"));_.loop=!0,_.volume=0,_.play().catch(()=>{}),or.current=_;const E=300,L=30,j=E/L,V=.25/j;let ee=0;const B=setInterval(()=>{ee++,or.current&&(or.current.volume=Math.min(ee*V,.25)),ee>=j&&clearInterval(B)},L)}else if(!m&&or.current){const _=or.current,E=200,L=20,j=E/L,V=_.volume/j;let ee=0;const B=setInterval(()=>{ee++,_.volume=Math.max(0,_.volume-V),ee>=j&&(clearInterval(B),_.pause(),_.currentTime=0)},L);or.current=null}return()=>{!Z&&or.current&&(or.current.pause(),or.current=null)}},[Z==null?void 0:Z.sourceType]);const[Sm,Pf]=$.useState(new Set),[Tm,Pc]=$.useState(null),[Im,Oc]=$.useState(null),[E2,wm]=$.useState(null),[Ve,qr]=$.useState(null),Of=$.useCallback(m=>{const _=rs(m);_&&(g.winnerId?_a(_):qr({card:_,owner:"OPPONENT",source:"LOG"}))},[g.winnerId]),S2=$.useCallback(m=>{const _=/([^]+)/g,E=[];let L=0,j,V=0;const ee=mb();for(;(j=_.exec(m))!==null;){j.index>L&&E.push(a.jsx("span",{children:m.slice(L,j.index)},V++));const B=j[1];ee.includes(B)?E.push(a.jsxs("span",{style:{color:"#ffd700",cursor:"pointer",textDecoration:"underline",textUnderlineOffset:"2px",fontWeight:"bold"},onMouseEnter:K=>{K.target.style.color="#ffec8b",K.target.style.textShadow="0 0 8px rgba(255, 215, 0, 0.8)"},onMouseLeave:K=>{K.target.style.color="#ffd700",K.target.style.textShadow="none"},onClick:K=>{K.stopPropagation(),Of(B)},children:["",B,""]},V++)):E.push(a.jsxs("span",{children:["",B,""]},V++)),L=j.index+j[0].length}return L<m.length&&E.push(a.jsx("span",{children:m.slice(L)},V++)),E.length>0?a.jsx(a.Fragment,{children:E}):m},[Of]),[Lc,ao]=$.useState([]),Kt=(m,_,E,L)=>{if(!m)return;let j=window.innerWidth/2,V=window.innerHeight/2;const ee=_===w;if(E===void 0||E===-1){const z=ee?co:Ei;if(z.current){const K=z.current.getBoundingClientRect(),fe=Q(K.left+K.width/2,K.top+K.height/2);j=fe.x,V=fe.y}else V=ee?150:x2-250}else if(E!==void 0&&E>=0){const z=ee?xr:Mr,K=ee?kc.current:Aa.current;let fe=E;if(L){const ye=K.findIndex(Ee=>Ee&&Ee.instanceId===L);ye>=0&&(fe=ye)}const te=z.current[fe];if(te){const ye=te.getBoundingClientRect(),Ee=Q(ye.left+ye.width/2,ye.top+ye.height/2);j=Ee.x,V=Ee.y}}ao(z=>[...z,{type:m,x:j,y:V,key:Date.now()+Math.random()}])},Cm=(m,_,E,L,j)=>{let V=window.innerWidth/2,ee=window.innerHeight/2;const B=m===w,z=B?xr:Mr,K=B?kc.current:Aa.current;let fe=_;if(j){const ye=K.findIndex(Ee=>Ee&&Ee.instanceId===j);ye>=0&&(fe=ye)}const te=z.current[fe];if(te){const ye=te.getBoundingClientRect(),Ee=Q(ye.left+ye.width/2,ye.top+ye.height/2);V=Ee.x,ee=Ee.y}ao(ye=>[...ye,{type:"BUFF",x:V,y:ee,key:Date.now()+Math.random(),atkBuff:E,hpBuff:L}])},vr=(m,_,E,L)=>{Kt(m,_,E,L),n==="HOST"&&v&&x&&x.send({type:"EFFECT",payload:{effectType:m,targetPlayerId:_||"",targetIndex:E??-1,targetInstanceId:L}})},Oa=(m,_,E,L,j)=>{Cm(m,_,E,L,j),n==="HOST"&&v&&x&&x.send({type:"EFFECT",payload:{effectType:"BUFF",targetPlayerId:m,targetIndex:_,targetInstanceId:j,isBuff:!0,atkBuff:E,hpBuff:L}})},km=$.useRef([]),Rm=$.useRef([]);$.useEffect(()=>{var L,j;const m=(V,ee,B)=>{ee.forEach(z=>{if(!z)return;if(!V.find(fe=>fe&&fe.instanceId===z.instanceId)&&z.killedByBane){const fe=B===w,te=fe?xr:Mr,Ee=(fe?kc.current:Aa.current).findIndex(et=>et&&et.instanceId===z.instanceId);if(Ee>=0&&te.current[Ee]){const Se=te.current[Ee].getBoundingClientRect(),Qe=Q(Se.left+Se.width/2,Se.top+Se.height/2);ao(tt=>[...tt,{type:"BANE",x:Qe.x,y:Qe.y,key:Date.now()+Math.random()}])}}})},_=((L=g.players[P])==null?void 0:L.board)||[],E=((j=g.players[w])==null?void 0:j.board)||[];m(_,km.current,P),m(E,Rm.current,w),km.current=_.map(V=>V?{...V}:null),Rm.current=E.map(V=>V?{...V}:null)},[g.players,P,w]);const Lf=600,[Es,La]=$.useState(null),Df=$.useRef({player:0,opponent:0}),[Ot,Da]=$.useState(()=>{try{const m=localStorage.getItem("audioSettings");if(m){const _=JSON.parse(m);if(_.enabled!==void 0){const{enabled:E,...L}=_;return{...L,bgmEnabled:E,seEnabled:E}}return _}return{bgm:.3,se:.5,voice:.5,bgmEnabled:!0,seEnabled:!0}}catch{return{bgm:.3,se:.5,voice:.5,bgmEnabled:!0,seEnabled:!0}}}),St=$.useCallback((m,_=.5)=>{if(!Ot.seEnabled)return;const E=new Audio(ot(`/se/${m}`));E.volume=Ot.se*_,E.play().catch(L=>console.warn("SE Play prevented",L))},[Ot]),Dc=$.useRef(null);$.useEffect(()=>{if(Z&&yt&&!Dc.current)St("Buon.mp3",.25);else if(Z&&yt&&Dc.current){const m=Dc.current;(m.instanceId!==yt.instanceId||m.index!==yt.index||m.playerId!==yt.playerId)&&St("Buon.mp3",.25)}Dc.current=yt},[yt,Z,St]);const wn=$.useRef(null),[T2,Am]=$.useState(!1);$.useEffect(()=>{localStorage.setItem("audioSettings",JSON.stringify(Ot)),wn.current&&(wn.current.volume=Ot.bgmEnabled?Ot.bgm:0,Ot.bgmEnabled?wn.current.paused&&wn.current.play().catch(m=>console.warn("Auto-play prevented",m)):wn.current.pause())},[Ot]);const[I2,Mc]=$.useState(!1),[w2,Mf]=$.useState(!1),[C2,Nc]=$.useState(!1),k2=$.useCallback(()=>{console.log("[GameScreen] handleSurrender called"),Nc(!1),Mc(!1),n!=="CPU"&&x&&x.send({type:"SURRENDER",payload:{playerId:P}}),C({type:"CONCEDE",playerId:P})},[n,x,P]),[Zr,Nf]=$.useState(!1),jf=$.useRef(!1),[Pm,Om]=$.useState(!1),[dt,Ss]=$.useState(null),lo=$.useRef(null),co=$.useRef(null),xr=$.useRef([]),Mr=$.useRef([]),Ei=$.useRef(null),[R2,jc]=$.useState([]),$c=$.useRef({player:20,opponent:20}),Fc=$.useRef({player:0,opponent:0}),Ma=$.useRef(new Map);$.useEffect(()=>{var j,V,ee,B;if(!q||!_e)return;const m=$c.current.opponent-_e.hp;m>0&&Kr(z=>({...z,damageDealtToOpponent:z.damageDealtToOpponent+m}));const _=$c.current.player-q.hp;_>0&&Kr(z=>({...z,damageReceivedFromOpponent:z.damageReceivedFromOpponent+_}));const E=Fc.current.opponent-(((j=_e.board)==null?void 0:j.filter(z=>z).length)||0);E>0&&Kr(z=>({...z,followersDestroyed:z.followersDestroyed+E}));const L=Fc.current.player-(((V=q.board)==null?void 0:V.filter(z=>z).length)||0);L>0&&Kr(z=>({...z,myFollowersDestroyed:z.myFollowersDestroyed+L})),$c.current={player:q.hp,opponent:_e.hp},Fc.current={player:((ee=q.board)==null?void 0:ee.filter(z=>z).length)||0,opponent:((B=_e.board)==null?void 0:B.filter(z=>z).length)||0}},[q==null?void 0:q.hp,_e==null?void 0:_e.hp,(Qm=q==null?void 0:q.board)==null?void 0:Qm.length,(qm=_e==null?void 0:_e.board)==null?void 0:qm.length]);const dn=$.useRef(null),Lm="lastPlayedBgm",Dm=$.useCallback(m=>{const _={AJA:[ot("/bgm/Green Misty Mountains.mp3"),ot("/bgm/Jade Moon.mp3"),ot("/bgm/amaama.mp3"),ot("/bgm/kingetsu.mp3")],SENKA:[ot("/bgm/ouka.mp3"),ot("/bgm/Jade Moon.mp3"),ot("/bgm/amaama.mp3"),ot("/bgm/kingetsu.mp3")]},E=_[m]||_.SENKA,L=sessionStorage.getItem(Lm),j=E.length>1?E.filter(ee=>ee!==L):E,V=j[Math.floor(Math.random()*j.length)];return sessionStorage.setItem(Lm,V),encodeURI(V)},[]),[$f,Mm]=$.useState(null);$.useEffect(()=>{var m,_;if(console.log(`[PendingEffects] useEffect fired. isProcessingEffect=${Xr}, pendingEffects.length=${((m=g.pendingEffects)==null?void 0:m.length)||0}, gameMode=${n}`),n==="JOIN"){console.log("[PendingEffects] Early return: JOIN mode waits for EFFECT messages from HOST");return}if(Xr){console.log("[PendingEffects] Early return: isProcessingEffect=true");return}if(g.pendingEffects&&g.pendingEffects.length>0){const E=g.pendingEffects[0];if(console.log(`[PendingEffects] Processing effect: ${E.effect.type} from ${E.sourceCard.name}`),Ac.current===E){console.log("[PendingEffects] Early return: same effect already processed");return}if(Ac.current=E,Ra(!0),Jr.current=!0,E.effect.type==="GENERATE_CARD"&&E.effect.targetCardId){const xe=[E],X=g.pendingEffects||[];for(let Pe=1;Pe<X.length;Pe++){const Te=X[Pe];if(Te.effect.type==="GENERATE_CARD"&&Te.sourceCard.id===E.sourceCard.id&&Te.sourcePlayerId===E.sourcePlayerId)xe.push(Te);else break}const le=120,ie=20,Y=-(xe.length*le+(xe.length-1)*ie-le)/2,ae=E.sourcePlayerId===P,be=ae?window.innerWidth-200*h:200*h,Ne=ae?window.innerHeight-100*h:100*h,ke=xe.map((Pe,Te)=>({card:rs(Pe.effect.targetCardId),status:"APPEAR",targetX:be,targetY:Ne,xOffset:Y+Te*(le+ie)})).filter(Pe=>Pe.card);if(ke.length>0){Pa(ke),dn.current&&clearTimeout(dn.current),dn.current=setTimeout(()=>{Pa(Pe=>Pe.map(Te=>({...Te,status:"FLY"}))),dn.current=setTimeout(()=>{Pa([]),Ra(!1),Jr.current=!1,(n==="CPU"||n==="HOST")&&(xe.forEach(Pe=>{C({type:"RESOLVE_EFFECT",playerId:Pe.sourcePlayerId,payload:{targetId:Pe.targetId}})}),n==="HOST"&&v&&x&&setTimeout(()=>{const Pe=ct.current;x.send({type:"GAME_STATE",payload:Pe})},50)),dn.current=null},600)},800);return}}const L=E.effect.type==="DAMAGE"||E.effect.type==="AOE_DAMAGE"||E.effect.type==="RANDOM_DAMAGE"||E.effect.type==="RANDOM_DAMAGE_BY_TURN",j=E.effect.type==="DESTROY"||E.effect.type==="RANDOM_DESTROY",V=E.effect.type==="HEAL_LEADER",ee=E.effect.type==="RANDOM_SET_HP",B=E.effect.type==="SET_MAX_HP",z=E.effect.type==="RETURN_TO_HAND",K=E.effect.type==="SUMMON_CARD"||E.effect.type==="SUMMON_CARD_RUSH",fe=E.effect.type==="VISUAL_BUFF_ONLY",te=E.effect.type==="BUFF_STATS",ye=V||z||K||fe||te?600:50;if(L){let xe=E.sourceCard.attackEffectType||"SLASH";E.sourceCard.id==="c_alice"&&E.effect.targetType==="SELECT_FOLLOWER"&&(xe="WATER");const X=E.sourcePlayerId===P?w:P,le=X===P?In:mn;if(E.effect.type==="AOE_DAMAGE")g.players[X].board.forEach(oe=>{if(oe){const Y=le.findIndex(ae=>(ae==null?void 0:ae.instanceId)===oe.instanceId);Y!==-1&&vr(xe,X,Y,oe.instanceId)}});else if(E.targetIds)E.effect.type==="RANDOM_DAMAGE_BY_TURN"?E.targetIds.forEach((oe,Y)=>{setTimeout(()=>{const ae=le.findIndex(be=>(be==null?void 0:be.instanceId)===oe);ae!==-1&&vr(xe,X,ae,oe)},Y*300)}):E.targetIds.forEach(ie=>{const oe=le.findIndex(Y=>(Y==null?void 0:Y.instanceId)===ie);oe!==-1&&vr(xe,X,oe,ie)});else if(E.effect.targetType==="OPPONENT")vr(xe,X,-1),Xn();else if(E.targetId){const ie=le.findIndex(oe=>(oe==null?void 0:oe.instanceId)===E.targetId);ie!==-1&&vr(xe,X,ie,E.targetId)}}else if(j){let xe=E.sourceCard.attackEffectType||"IMPACT";const X=E.sourcePlayerId===P?w:P,le=X===P?In:mn;if(E.effect.targetType==="ALL_OTHER_FOLLOWERS"){le.forEach((Y,ae)=>{Y&&Y.instanceId!==E.sourceCard.instanceId&&vr(xe,X,ae,Y.instanceId)});const ie=E.sourcePlayerId;(ie===P?In:mn).forEach((Y,ae)=>{Y&&Y.instanceId!==E.sourceCard.instanceId&&vr(xe,ie,ae,Y.instanceId)}),Xn()}else if(E.targetIds)E.targetIds.forEach(ie=>{const oe=le.findIndex(Y=>(Y==null?void 0:Y.instanceId)===ie);oe!==-1&&vr(xe,X,oe,ie)});else if(E.targetId){const ie=le.findIndex(oe=>(oe==null?void 0:oe.instanceId)===E.targetId);ie!==-1&&vr(xe,X,ie,E.targetId)}}else if(V){const xe=E.sourcePlayerId;vr("HEAL",xe)}else if(B){const xe=E.sourcePlayerId===P?w:P;vr("RAY",xe,-1),Xn()}if(E.effect.type==="BUFF_STATS"){const xe=E.effect.value??0,X=E.effect.value2??0,le=E.sourcePlayerId;if(E.effect.targetType==="SELF"){const oe=(le===P?In:mn).findIndex(Y=>(Y==null?void 0:Y.instanceId)===E.sourceCard.instanceId);oe!==-1&&Oa(le,oe,xe,X,E.sourceCard.instanceId)}else if(E.effect.targetType==="ALL_FOLLOWERS"){const ie=le===P?In:mn,oe=g.players[le].board,Y=E.effect.conditions;oe.forEach(ae=>{var be;if(ae){if(Y!=null&&Y.tag&&!((be=ae.tags)!=null&&be.includes(Y.tag))||Y!=null&&Y.nameIn&&!Y.nameIn.includes(ae.name))return;const Ne=ie.findIndex(ke=>(ke==null?void 0:ke.instanceId)===ae.instanceId);Ne!==-1&&Oa(le,Ne,xe,X,ae.instanceId)}})}else if(E.effect.targetType==="ALL_OTHER_FOLLOWERS"){const ie=le===P?In:mn,oe=g.players[le].board,Y=E.effect.conditions;oe.forEach(ae=>{var be;if(ae&&ae.instanceId!==E.sourceCard.instanceId){if(Y!=null&&Y.tag&&!((be=ae.tags)!=null&&be.includes(Y.tag))||Y!=null&&Y.nameIn&&!Y.nameIn.includes(ae.name))return;const Ne=ie.findIndex(ke=>(ke==null?void 0:ke.instanceId)===ae.instanceId);Ne!==-1&&Oa(le,Ne,xe,X,ae.instanceId)}})}else if(E.targetId){const oe=(le===P?In:mn).findIndex(Y=>(Y==null?void 0:Y.instanceId)===E.targetId);oe!==-1&&Oa(le,oe,xe,X,E.targetId)}}if(fe){const xe=E.effect.value??0,X=E.effect.value2??0,le=E.sourcePlayerId,ie=E.sourceCard;setTimeout(()=>{const oe=le===P?In:mn;if(ie!=null&&ie.instanceId){const Y=oe.findIndex(ae=>(ae==null?void 0:ae.instanceId)===ie.instanceId);Y!==-1&&Oa(le,Y,xe,X,ie.instanceId)}},300)}dn.current&&clearTimeout(dn.current);const et=L||j||ee||B,Se=E.effect.type==="RANDOM_DAMAGE_BY_TURN",Qe=Se?((_=E.targetIds)==null?void 0:_.length)||g.turnCount:1,tt=Se?Qe*300+300:0,We=Se?tt:et?700:ye,Ge=Se?200:et?700:0;dn.current=setTimeout(()=>{(n==="CPU"||n==="HOST")&&(C({type:"RESOLVE_EFFECT",playerId:E.sourcePlayerId,payload:{targetId:E.targetId}}),n==="HOST"&&v&&x&&setTimeout(()=>{const xe=ct.current;x.send({type:"GAME_STATE",payload:xe})},50)),Ge>0?dn.current=setTimeout(()=>{Ra(!1),Jr.current=!1,dn.current=null},Ge):(Ra(!1),Jr.current=!1,dn.current=null)},We)}else Ac.current=null,dn.current&&(clearTimeout(dn.current),dn.current=null)},[g.pendingEffects,Xr,P,w,n,v,x]),$.useEffect(()=>{if(g.activePlayerId!==P)return;const m=P===g.firstPlayerId,_=g.turnCount,E=m?5:4;if(_===(m?7:6)){if(Af===_)return;Rc("SUPER_EVOLVE_READY"),vm(_),setTimeout(()=>Rc(null),2500)}else if(_===E){if(Af===_)return;Rc("EVOLVE_READY"),vm(_),setTimeout(()=>Rc(null),2500)}},[g.turnCount,g.activePlayerId,P,Af,g.firstPlayerId]);const Uc=$.useRef(g.players);$.useEffect(()=>{const m=Uc.current,_=new Set;if(Object.keys(g.players).forEach(E=>{const L=g.players[E],j=m[E];if(!j)return;const V=new Set(j.board.filter(B=>B).map(B=>B.instanceId)),ee=new Set(j.hand.filter(B=>B).map(B=>B.instanceId));L.board.forEach(B=>{if(!B)return;const z=B.instanceId;!V.has(z)&&!ee.has(z)&&_.add(z)})}),_.size>0){Pf(L=>new Set([...L,..._]));const E=setTimeout(()=>{Pf(new Set)},1e3);return()=>clearTimeout(E)}},[g.players]),$.useEffect(()=>{const m=Uc.current,_=g.players;let E=[];const L=j=>{const V=j.getBoundingClientRect();return{x:V.left+V.width/2,y:V.top+V.height/2}};Object.keys(_).forEach(j=>{const V=_[j],ee=m[j];if(ee&&V.hp<ee.hp){const B=ee.hp-V.hp,K=j===P?Ei.current:co.current;if(K){const fe=L(K);E.push({id:Date.now()+Math.random(),value:B,x:fe.x,y:fe.y,color:"#e53e3e"})}}else if(ee&&V.hp>ee.hp){const B=V.hp-ee.hp,K=j===P?Ei.current:co.current;if(K){const fe=L(K);E.push({id:Date.now()+Math.random(),value:"+"+B,x:fe.x,y:fe.y,color:"#48bb78"})}}ee==null||ee.board.forEach(B=>{if(!B)return;const z=V.board.find(K=>(K==null?void 0:K.instanceId)===B.instanceId);if(z){const K=V.board.findIndex(Ee=>(Ee==null?void 0:Ee.instanceId)===z.instanceId),ye=(j===P?Mr.current:xr.current)[K];if(ye){const Ee=L(ye);if(Ma.current.set(B.instanceId,Ee),z.currentHealth<B.currentHealth){const et=B.currentHealth-z.currentHealth;E.push({id:Date.now()+Math.random(),value:et,x:Ee.x,y:Ee.y,color:"#e53e3e"})}else if(z.currentHealth>B.currentHealth){const et=z.hasEvolved&&!B.hasEvolved,Se=z.currentAttack!==B.currentAttack||z.maxHealth!==B.maxHealth;if(!et&&!Se){const Qe=z.currentHealth-B.currentHealth;E.push({id:Date.now()+Math.random(),value:"+"+Qe,x:Ee.x,y:Ee.y,color:"#48bb78"})}}else z.currentHealth===B.currentHealth&&B.hasBarrier&&!z.hasBarrier&&E.push({id:Date.now()+Math.random(),value:0,x:Ee.x,y:Ee.y,color:"#e53e3e"})}}else{const K=V.graveyard.find(te=>te.instanceId===B.instanceId);let fe=0;if(K){const te=K.currentHealth||0;te<=0?fe=B.currentHealth-te:fe=0}else fe=B.currentHealth;if(fe>0){const te=Ma.current.get(B.instanceId);te&&(te.x!==0||te.y!==0)&&E.push({id:Date.now()+Math.random(),value:fe,x:te.x,y:te.y,color:"#e53e3e"})}Ma.current.delete(B.instanceId)}})}),E.length>0&&(jc(V=>[...V,...E]),E.some(V=>V.color!=="#48bb78")&&Xn()),Uc.current=_},[g.players,P,w]);const Ff=$.useRef(null),Xn=()=>{Ff.current||(Om(!0),Ff.current=setTimeout(()=>{Om(!1),Ff.current=null},300))},Uf=A.useCallback(m=>{jc([]),ao([]),Pa([]),Jn(null),uo(null),La(null),Pf(new Set),Ts.current=!1,Bf.current=null,Kr({turnCount:0,damageDealtToOpponent:0,damageReceivedFromOpponent:0,followersDestroyed:0,myFollowersDestroyed:0}),$c.current={player:20,opponent:20},Fc.current={player:0,opponent:0},_a(null),st(!1),Ue(!1),mt(null),nn(!1),S(!1),ba(null),Sa(!1),xa("normal");const _=m||jn;m&&so(m);let E=R;e==="CPU"&&(_==="YORUKA"?E=Math.random()<.5?"SENKA":"AJA":E=_==="SENKA"?"AJA":"SENKA");const j=Ld(u,_,e==="ONLINE"?"":"CPU",E);Uc.current=j.players,Df.current={player:j.players.p1.hand.length,opponent:j.players.p2.hand.length},Mm(null),me(n!=="JOIN");const V=n==="CASUAL_MATCH"||n==="RANKED_MATCH";bs(n==="JOIN"||V&&!se?!1:Math.random()>.5),Be("IDLE"),_s(null),Yr(!1),(n==="HOST"||V)&&(D.current=!1),C({type:"SYNC_STATE",payload:j})},[jn,R,e,n]),A2=A.useCallback(()=>{me(!1),ue(!1),re(!0),_s(Nn?"FIRST":"SECOND");const m=P,_=P==="p1"?"p2":"p1",E=g.firstPlayerId||(Nn?m:_),L=E===m?_:m;if(g.activePlayerId!==E||g.players[E].pp!==1||g.players[L].pp!==0){const V={...g,activePlayerId:E,firstPlayerId:E,players:{[E]:{...g.players[E],maxPp:1,pp:1},[L]:{...g.players[L],maxPp:0,pp:0}},logs:g.logs.length===0?[` 1 - ${g.players[E].name} `]:g.logs};C({type:"SYNC_STATE",payload:V})}Be("DONE")},[g,Nn,P]);A.useEffect(()=>{},[g.phase,Me,n,St,v]),$.useEffect(()=>{if($f===q.class&&wn.current)return;const m=Dm(q.class);console.log(`[BGM] Initializing track: ${m} for class: ${q.class}`),wn.current&&(wn.current.pause(),wn.current=null);const _=new Audio(m);_.loop=!0,_.volume=Ot.bgm,wn.current=_,Mm(q.class)},[q.class,Dm,$f]),$.useEffect(()=>()=>{wn.current&&(console.log("[GameScreen] Stopping BGM on unmount"),wn.current.pause(),wn.current=null)},[]),$.useEffect(()=>{if(!wn.current)return;const m=wn.current,_=()=>{m.paused&&Ot.bgmEnabled&&(console.log("[BGM] Attempting play on interaction..."),m.play().then(()=>{console.log("[BGM] Play success"),E()}).catch(L=>console.warn("[BGM] Play failed on interaction:",L)))},E=()=>{document.removeEventListener("click",_),document.removeEventListener("keydown",_),document.removeEventListener("touchstart",_)};return Ot.bgmEnabled?(document.addEventListener("click",_),document.addEventListener("keydown",_),document.addEventListener("touchstart",_),m.play().then(()=>{console.log("[BGM] Immediate play success"),E()}).catch(()=>console.log("[BGM] Immediate play blocked, waiting for interaction"))):(m.pause(),E()),()=>{E()}},[Ot.bgmEnabled,Ot.bgm,$f]),A.useEffect(()=>{if(!x){console.log("[GameScreen] Message handler setup skipped - no adapter yet");return}console.log("[GameScreen] Setting up message handler, adapter.isHost:",x.isHost);const m=_=>{var E,L,j,V,ee;if(console.log("[GameScreen] Received message:",_.type,_),_.type==="HANDSHAKE"){const B=(E=_.payload)==null?void 0:E.name,z=typeof B=="string"&&B.trim().slice(0,12)||"";console.log("[GameScreen] Received HANDSHAKE from opponent:",z),lt.current=z,C({type:"UPDATE_PLAYER_NAME",payload:{playerId:P==="p1"?"p2":"p1",name:z}});return}if(_.type==="INIT_GAME"){console.log("[GameScreen] JOIN side: Received initial game state from HOST"),C({type:"SYNC_STATE",payload:_.payload}),C({type:"UPDATE_PLAYER_NAME",payload:{playerId:P,name:u}});const B=P==="p1"?"p2":"p1";lt.current&&(console.log("[GameScreen] Re-applying opponent name after INIT_GAME:",lt.current),C({type:"UPDATE_PLAYER_NAME",payload:{playerId:B,name:lt.current}})),M(!0);const z=_.payload.firstPlayerId,K=z===P;console.log("[GameScreen] JOIN side: Setting isFirstPlayer",{"received firstPlayerId":z,currentPlayerId:P,"adapter?.isHost":x==null?void 0:x.isHost,"isHost (calculated)":se,isJoinSideFirst:K,comparison:`${z} === ${P} = ${K}`}),bs(K),n==="CASUAL_MATCH"||n==="RANKED_MATCH"?console.log("[GameScreen] CASUAL_MATCH JOIN side: Waiting for intro sync"):me(!0);return}if(_.type==="READY_FOR_INTRO"){console.log("[GameScreen] Received READY_FOR_INTRO from opponent"),at(!0);return}if(_.type==="START_INTRO"){console.log("[GameScreen] Received START_INTRO - starting BattleIntro now"),we(!1),me(!0);return}if(_.type==="GAME_STATE"){console.log("[GameScreen] JOIN: Received GAME_STATE sync from HOST"),C({type:"SYNC_STATE",payload:_.payload}),Ra(!1),Jr.current=!1,Ac.current=null,Pa([]),dn.current&&(clearTimeout(dn.current),dn.current=null),!ja.current&&!ho.current&&(yn.current=!1);return}if(_.type==="EFFECT"){const{effectType:B,targetPlayerId:z,targetIndex:K,targetInstanceId:fe,isBuff:te,atkBuff:ye,hpBuff:Ee}=_.payload;console.log("[GameScreen] JOIN: Received EFFECT from HOST:",B,z,K,fe),setTimeout(()=>{te&&ye!==void 0&&Ee!==void 0?Cm(z,K,ye,Ee,fe):Kt(B,z,K,fe)},50);return}if(_.type==="EVOLVE_ANIM"){const{playerId:B,followerIndex:z,useSep:K,targetId:fe,instanceId:te}=_.payload,ye=(L=g.players[B])==null?void 0:L.board[z];if(ye){const Ee=ye.evolvedImageUrl||((j=rs(ye.id))==null?void 0:j.evolvedImageUrl),et=te||ye.instanceId,Se=mn.findIndex(X=>X&&X.instanceId===et),Qe=Se>=0?xr.current[Se]:null,tt=pe.current.scale,We=window.innerHeight/2;let Ge=window.innerWidth/2,xe=We-70*tt;if(Qe){const X=Qe.getBoundingClientRect();Ge=X.left+X.width/2,xe=X.top+X.height/2}uo({card:ye,evolvedImageUrl:Ee,startX:Ge,startY:xe,phase:"ZOOM_IN",followerIndex:z,sourcePlayerId:B,useSep:K||!1,targetId:fe,isRemote:!0}),St("fon.mp3",.7)}return}if(_.type==="PLAY_CARD_ANIM"){const{playerId:B,card:z,targetBoardIndex:K}=_.payload;if(z){const fe=((V=g.players[B])==null?void 0:V.board)||[],te=typeof K=="number"?K:fe.filter(Y=>Y!==null).length,ye=pe.current.scale,Ee=window.innerWidth/2,et=window.innerHeight/2,Se=Ee,Qe=80*ye,tt=Ee,We=et-100*ye,le=-((Math.max(1,te+1)-1)*Ti*ye)/2+te*Ti*ye,ie=Ee+le,oe=et-70*ye;z.type==="SPELL"?Jn({card:z,sourceIndex:-1,startX:Se,startY:Qe,targetX:tt,targetY:We,playerClass:(_e==null?void 0:_e.class)||"SENKA",onComplete:()=>{Jn(null)}}):Jn({card:z,sourceIndex:-1,startX:Se,startY:Qe,targetX:tt,targetY:We,finalX:ie,finalY:oe,playerClass:(_e==null?void 0:_e.class)||"SENKA",onComplete:()=>{St("gan.mp3",.6),Xn(),Jn(null)}})}return}if(_.type==="REMATCH_REQUEST"){console.log("[GameScreen] Opponent requested rematch"),S(!0);return}if(_.type==="REMATCH_ACCEPT"){console.log("[GameScreen] Opponent accepted rematch - starting new game"),Uf(jn);return}if(_.type==="SURRENDER"){const B=(ee=_.payload)==null?void 0:ee.playerId;if(g.phase==="GAME_OVER"){console.warn("[GameScreen] Ignoring SURRENDER - game already over");return}if(B===P){console.warn(`[GameScreen] Security Alert: Received SURRENDER message targeting self (${P}). Ignoring.`);return}if(B!==w){console.warn(`[GameScreen] Security Alert: Invalid playerId in SURRENDER: ${B}. Expected: ${w}. Ignoring.`);return}console.log("[GameScreen] Opponent surrendered:",B),xa("surrender"),C({type:"CONCEDE",playerId:B});return}if(_.type==="STAMP"){console.log("[GameScreen] Opponent sent stamp:",_.stampId),ir.current&&(clearTimeout(ir.current),ir.current=null);const B=gv(_.stampId);B&&St(B,.6);const z={stampId:_.stampId,playerId:w,playerClass:_.playerClass||(_e==null?void 0:_e.class)||"SENKA",timestamp:Date.now()};$n(null),requestAnimationFrame(()=>{$n(z)}),ir.current=setTimeout(()=>{$n(K=>(K==null?void 0:K.timestamp)===z.timestamp?null:K),ir.current=null},3e3);return}if(_.type==="ACTION"){const B=_.payload;if(console.log("[GameScreen] Processing remote action:",B.type,"from player:",B.playerId),C({...B,isRemote:!0}),B.type==="ATTACK"){const{playerId:z,payload:K}=B,fe=g.players[z],te=fe==null?void 0:fe.board[K.attackerIndex],ye=K.targetIsLeader?-1:K.targetIndex,Ee=z==="p1"?"p2":"p1";if(te){const et=g.players[Ee],Se=K.targetIsLeader?null:et==null?void 0:et.board[K.targetIndex],Qe=Se?Se.instanceId:void 0;Kt(te.attackEffectType,Ee,ye,Qe)}}else B.type==="PLAY_CARD"||B.type==="EVOLVE"||B.type==="END_TURN"&&(console.log("[GameScreen] Remote END_TURN received, turn switching to:",B.playerId==="p1"?"p2":"p1"),fo.current=!1)}};return x.onMessage(m),n!=="CPU"&&!Fe.current&&(Fe.current=!0,x.send({type:"HANDSHAKE",payload:{name:u,class:t}}),console.log("[GameScreen] Sent HANDSHAKE:",u,t)),x.onClose(()=>{if((n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&g.phase==="GAME_OVER"){console.log("[GameScreen] Connection closed after game over (casual match) - silent disconnect");return}if(n!=="CPU"&&g.phase!=="GAME_OVER"){console.log("[GameScreen] Opponent disconnected during game - treating as surrender, player wins"),xa("disconnect");const _={...g,phase:"GAME_OVER",winnerId:P,logs:[...g.logs,""]};C({type:"SYNC_STATE",payload:_});return}alert(`
`),s()}),()=>{}},[x,g,St,Kt,n,s,P]);const Ts=$.useRef(!1),Bf=$.useRef(null),Fn=$.useRef(null),[nt,Jn]=$.useState(null),[$t,uo]=$.useState(null),yn=$.useRef(!1),Na=$.useRef(null),fo=$.useRef(!1),zf=$.useRef(Lc),Hf=$.useRef(oo),ja=$.useRef(nt),ho=$.useRef($t);A.useEffect(()=>{zf.current=Lc,Hf.current=oo,ja.current=nt,ho.current=$t},[Lc,oo,nt,$t]),A.useEffect(()=>{if(nt&&nt.card.name===""&&Ot.seEnabled){const m=new Audio(ot("/se/beam.mp3"));m.volume=Ot.se*.8,m.play().catch(_=>console.warn("SE Play prevented",_))}},[nt,Ot]),A.useEffect(()=>{Aa.current=In,kc.current=mn},[In,mn]),A.useEffect(()=>{const m=_=>{const E=_.getBoundingClientRect();return{x:E.left+E.width/2,y:E.top}};In.forEach((_,E)=>{if(_&&_.instanceId){const L=Mr.current[E];if(L){const j=m(L);(j.x!==0||j.y!==0)&&Ma.current.set(_.instanceId,j)}}}),mn.forEach((_,E)=>{if(_&&_.instanceId){const L=xr.current[E];if(L){const j=m(L);(j.x!==0||j.y!==0)&&Ma.current.set(_.instanceId,j)}}})},[In,mn]);const Bc=(m,_,E,L)=>{const j=Nr.current.board,V=L?j.findIndex(te=>te&&te.instanceId===L):m,ee=V>=0?j[V]:null;if(!ee)return;if(ee.hasEvolved){console.log("[GameScreen] Cannot evolve: card already evolved");return}const B=Mr.current[m];let z=window.innerWidth/2,K=window.innerHeight/2;if(B){const te=B.getBoundingClientRect();z=te.left+te.width/2,K=te.top+te.height/2}const fe=ee.instanceId;n!=="CPU"&&v&&x&&x.send({type:"EVOLVE_ANIM",payload:{playerId:P,followerIndex:V,useSep:_,targetId:E,instanceId:fe}}),uo({card:ee,evolvedImageUrl:ee.evolvedImageUrl,startX:z,startY:K,phase:"ZOOM_IN",followerIndex:V,useSep:_,targetId:E,sourcePlayerId:P}),St("fon.mp3",.7)},Wf=$.useRef(null),P2=$.useCallback(m=>{if(console.log("[GameScreen] handleEvolvePhaseChange:",m),m==="WHITE_FADE"&&St("fon.mp3",.7),m==="LAND"&&St("gan.mp3",.6),m==="DONE"){const _=ho.current;if(_&&!_.isRemote){const L={type:"EVOLVE",playerId:_.sourcePlayerId||P,payload:{followerIndex:_.followerIndex,useSep:_.useSep,targetId:_.targetId}};C(L),x&&n!=="CPU"&&x.send({type:"ACTION",payload:L})}uo(null)}else uo(_=>_?{..._,phase:m}:null)},[x,C,n,P,St]),Gf=(m,_,E)=>{var Ge,xe,X,le,ie,oe;const j=Nr.current.hand[m];if(!j){console.warn("[handlePlayCard] Card not found at index:",m);return}if(j.instanceId&&Na.current===j.instanceId){console.warn("[handlePlayCard] Duplicate play blocked for instanceId:",j.instanceId);return}if(yn.current){console.warn("[handlePlayCard] Card play locked, ignoring duplicate call");return}yn.current=!0,Na.current=j.instanceId||null,St("card.mp3",.5);const V=(Ge=j.triggers)==null?void 0:Ge.find(Y=>Y.trigger==="FANFARE"),ee=V==null?void 0:V.effects[0];let B=w;const z=(ee==null?void 0:ee.targetType)==="SELECT_ALLY_FOLLOWER"||(ee==null?void 0:ee.targetType)==="SELECT_OTHER_ALLY_FOLLOWER";ee&&(z||["GRANT_PASSIVE","BUFF_STATS","HEAL_FOLLOWER"].includes(ee.type))&&(B=P);const K=["SELECT_FOLLOWER","SELECT_ALLY_FOLLOWER","SELECT_OTHER_ALLY_FOLLOWER"],fe=j.type==="SPELL"&&((xe=j.triggers)==null?void 0:xe.some(Y=>Y.effects.some(ae=>ae.targetType&&K.includes(ae.targetType))))||j.type==="FOLLOWER"&&(((le=(X=j.triggerAbilities)==null?void 0:X.FANFARE)==null?void 0:le.targetType)&&K.includes(j.triggerAbilities.FANFARE.targetType)||((ie=j.triggers)==null?void 0:ie.some(Y=>Y.trigger==="FANFARE"&&Y.effects.some(ae=>ae.targetType&&K.includes(ae.targetType))))),ye=ct.current.players[B].board.some(Y=>{var ae,be;return Y&&(B===P||!((ae=Y.passiveAbilities)!=null&&ae.includes("STEALTH"))&&!((be=Y.passiveAbilities)!=null&&be.includes("AURA")))});if(console.log(`[handlePlayCard] needsTarget: ${fe}, allowedTarget: ${B}, hasValidTargets: ${ye}`),fe&&ye){Ss({type:"PLAY",sourceIndex:m,sourceInstanceId:j.instanceId,allowedTargetPlayerId:B}),Qr(null);return}const Ee=window.innerWidth/2,et=window.innerHeight/2;let Se,Qe;if(j.type==="FOLLOWER"){const ae=ct.current.players[P].board.filter(Oe=>Oe!==null),be=ae.length+1,Ne=ae.length,ke=Ti*h,Pe=(Ne-(be-1)/2)*ke,Te=(oe=lo.current)==null?void 0:oe.getBoundingClientRect();Se=(Te?Te.left+Te.width/2:window.innerWidth/2)+Pe,Qe=window.innerHeight/2+70*h}const tt=()=>{j.type!=="SPELL"&&(St("gan.mp3",.6),Xn()),Is({type:"PLAY_CARD",playerId:P,payload:{cardIndex:m,instanceId:j.instanceId}}),Jn(null),setTimeout(()=>{yn.current=!1},100)},We=j.type==="FOLLOWER"?ct.current.players[P].board.filter(Y=>Y!==null).length:void 0;n!=="CPU"&&v&&x&&x.send({type:"PLAY_CARD_ANIM",payload:{playerId:P,cardIndex:m,card:j,targetBoardIndex:We}}),Jn({card:j,sourceIndex:m,startX:_,startY:E,targetX:Ee,targetY:et,finalX:Se,finalY:Qe,playerClass:(q==null?void 0:q.class)||"SENKA",onComplete:tt}),setTimeout(()=>{Jn(Y=>(Y==null?void 0:Y.card.id)===j.id?(tt(),null):Y)},2e3)},Is=m=>{C(m),n!=="CPU"&&v&&!m.isRemote&&(x==null||x.send({type:"ACTION",payload:m}))};$.useEffect(()=>{if(!$t&&Wf.current){const m=Wf.current;Wf.current=null,console.log("[GameScreen] Dispatching pending evolve action for:",m.playerId),Is({type:"EVOLVE",playerId:m.playerId,payload:{followerIndex:m.followerIndex,useSep:m.useSep,targetId:m.targetId}})}},[$t,P,Is]);const Nr=$.useRef(q),ct=$.useRef(g);$.useEffect(()=>{Nr.current=q,ct.current=g},[q,g]);const _r=$.useRef(!1);$.useEffect(()=>{const m=Df.current,_=q.hand.length,E=_e.hand.length;if(_>m.player){const L=_-m.player;La({isPlayer:!0,count:L}),St("card.mp3",.5),setTimeout(()=>La(null),Lf)}if(E>m.opponent){const L=E-m.opponent;La({isPlayer:!1,count:L}),St("card.mp3",.5),setTimeout(()=>La(null),Lf)}Df.current={player:_,opponent:E}},[q.hand.length,_e.hand.length,Ot,St]),A.useEffect(()=>{g.activePlayerId===P&&(console.log("[GameScreen] Player turn started - resetting card play lock and ending turn state"),yn.current=!1,Na.current=null,fo.current=!1)},[g.activePlayerId,g.turnCount,P]),A.useEffect(()=>{if(n==="CPU")return;const m=setInterval(()=>{yn.current&&!ja.current&&!ho.current&&!dt&&g.activePlayerId===P&&(console.warn("[GameScreen] Safety release: Card play lock was stuck, releasing"),yn.current=!1)},3e3);return()=>clearInterval(m)},[n,dt,g.activePlayerId,P]),A.useEffect(()=>{if(n!=="CPU")return;if(g.winnerId){Ts.current=!1;return}const m=`${g.turnCount}-${g.activePlayerId}`;if(g.activePlayerId===P){Ts.current=!1;return}if(g.activePlayerId===w){if(Ts.current||Bf.current===m)return;(async()=>{var Se,Qe,tt,We,Ge,xe;Ts.current=!0,Bf.current=m;const E=async(X=300)=>{await new Promise(oe=>setTimeout(oe,X));const le=()=>{const oe=ct.current,Y=oe.pendingEffects&&oe.pendingEffects.length>0,ae=zf.current.length>0,be=Hf.current.length>0,Ne=ja.current!==null,ke=ho.current!==null;return!Y&&!ae&&!be&&!Ne&&!ke};let ie=0;for(;!le()&&ie<60;){await new Promise(Y=>setTimeout(Y,100)),ie++;const oe=ct.current;if(oe.pendingEffects&&oe.pendingEffects.length>0&&!Jr.current){console.log("[waitForIdle] Forcing RESOLVE_EFFECT for stuck pending effect");const Y=oe.pendingEffects[0];C({type:"RESOLVE_EFFECT",playerId:Y.sourcePlayerId,payload:{targetId:Y.targetId}}),await new Promise(ae=>setTimeout(ae,200))}}},L=(X,le)=>{var ie;return X?!!((ie=X.passiveAbilities)!=null&&ie.includes("IMMUNE_TO_FOLLOWER_DAMAGE")):!1},j=(X,le)=>{var ie;return!le||!X?!1:(ie=le.passiveAbilities)!=null&&ie.includes("BANE")&&!X.hasBarrier?!0:(le.currentAttack||0)>=X.currentHealth},V=(X,le)=>{var ie;return!le||!X?!1:(ie=X.passiveAbilities)!=null&&ie.includes("BANE")?!le.hasBarrier:X.currentAttack>=le.currentHealth},ee=X=>{var ae,be,Ne;let le=0;const ie=X.players[w].board.filter(ke=>ke!==null),Y=X.players[P].board.filter(ke=>ke!==null).some(ke=>{var Pe,Te;return((Pe=ke.passiveAbilities)==null?void 0:Pe.includes("WARD"))&&!((Te=ke.passiveAbilities)!=null&&Te.includes("STEALTH"))});for(const ke of ie)!ke.canAttack||!((ae=ke.passiveAbilities)!=null&&ae.includes("STORM")||ke.turnPlayed!==X.turnCount)||Y&&!((be=ke.passiveAbilities)!=null&&be.includes("STEALTH"))&&!ke.hadStealth||(le+=ke.currentAttack||0,(Ne=ke.passiveAbilities)!=null&&Ne.includes("DOUBLE_ATTACK")&&(le+=ke.currentAttack||0));return le},B=X=>{var oe,Y,ae;let le=0;const ie=X.players[P].board.filter(be=>be!==null);for(const be of ie)le+=be.currentAttack||0,(oe=be.passiveAbilities)!=null&&oe.includes("DOUBLE_ATTACK")&&(le+=be.currentAttack||0),(Y=be.passiveAbilities)!=null&&Y.includes("BANE")&&(le+=15),(ae=be.passiveAbilities)!=null&&ae.includes("STORM")&&(le+=10);return le},z=(X,le)=>{var Pe,Te,rt,Oe;let ie=X.cost*10;const oe=le.players[P].board.filter(ze=>ze!==null),Y=le.players[w].board.filter(ze=>ze!==null),ae=le.players[P].hp,be=le.players[w].hp,Ne=le.players[w].pp;if((Pe=X.passiveAbilities)!=null&&Pe.includes("STORM")){const ze=ee(le),$e=X.attack||0;ze+$e>=ae?ie+=500:ae<=10?ie+=100:ie+=30}if(oe.length>0){const ze=X.triggers||[],$e=B(le);for(const Ct of ze)if(Ct.trigger==="FANFARE")for(const Ye of Ct.effects||[]){if(Ye.type==="DESTROY"&&(ie+=60+($e>10?30:0)),Ye.type==="RANDOM_DESTROY"){const it=Ye.value||1;ie+=40*it+($e>10?20:0)}["DAMAGE","SELECT_DAMAGE"].includes(Ye.type)&&(ie+=35),Ye.type==="AOE_DAMAGE"&&(ie+=25*Math.min(oe.length,3))}}be<=10&&((Te=X.passiveAbilities)!=null&&Te.includes("WARD")&&(ie+=80),ie+=20),X.cost===Ne?ie+=15:Ne-X.cost<=1&&(ie+=10);const ke=X.triggers||[];for(const ze of ke)if(ze.trigger==="FANFARE")for(const $e of ze.effects||[])$e.type==="DRAW"&&(ie+=20*($e.value||1)),($e.type==="SUMMON_CARD"||$e.type==="SUMMON_CARD_RUSH")&&(ie+=30),$e.type==="GENERATE_CARD"&&(ie+=15),$e.type==="HEAL"&&(ie+=be<15?25:10);return X.type==="FOLLOWER"&&((X.attack||0)+(X.health||0)>=X.cost*2.5&&(ie+=15),(rt=X.passiveAbilities)!=null&&rt.includes("WARD")&&oe.length>0&&(ie+=25),(Oe=X.passiveAbilities)!=null&&Oe.includes("BANE")&&(ie+=20)),X.type==="FOLLOWER"&&Y.length>=5&&(ie-=200),ie},K=(X,le,ie,oe)=>{let Y=0;const ae=ie.players[P].board.filter(Te=>Te!==null),be=ie.players[w].board.filter(Te=>Te!==null),Ne=X.triggers||[],ke=oe?"SUPER_EVOLVE":"EVOLVE";let Pe=!1;for(const Te of Ne)if(Te.trigger===ke){Pe=!0;for(const rt of Te.effects||[]){if(["DESTROY","RANDOM_DESTROY","DAMAGE","SELECT_DAMAGE","AOE_DAMAGE"].includes(rt.type)&&(Y+=ae.length>0?80:5),["SUMMON_CARD","SUMMON_CARD_RUSH"].includes(rt.type)&&(Y+=60),rt.type==="BUFF_STATS"){const Oe=rt.targetType||"SELF";Oe==="ALL_OTHER_FOLLOWERS"||Oe==="ALL_FOLLOWERS"?Y+=25*Math.max(1,be.length-1):Y+=30}rt.type==="DRAW"&&(Y+=35),rt.type==="GENERATE_CARD"&&(Y+=25)}}return X.canAttack?(Y+=30,Y+=(X.currentAttack||0)*5):Y+=(X.currentAttack||0)*2,X.cost>=6&&Pe&&(Y+=20),!Pe&&X.cost<=3&&(Y-=30),Y},fe=(X,le)=>{const oe=X.players[w].board.filter(Oe=>Oe!==null),Y=X.players[P].board.filter(Oe=>Oe!==null),ae=X.players[P].hp,be=X.players[w].hp,Ne=X.turnCount,ke=oe.filter(Oe=>Oe&&!Oe.hasEvolved);if(ke.length===0)return!1;const Pe=ke.map((Oe,ze)=>({c:Oe,i:ze,score:K(Oe,ze,X,le)})),Te=Math.max(...Pe.map(Oe=>Oe.score));if(ae<=12&&oe.some(Oe=>Oe&&Oe.canAttack)||be<=10)return!0;const rt=B(X);return rt>=8&&ke.some(ze=>{const $e=ze.triggers||[];for(const Ct of $e)if(Ct.trigger===(le?"SUPER_EVOLVE":"EVOLVE")){for(const Ye of Ct.effects||[])if(["DESTROY","RANDOM_DESTROY","DAMAGE","AOE_DAMAGE"].includes(Ye.type))return!0}return!1})&&Y.length>0||Te>=80||le&&Te>=50?!0:Ne<=5&&be>=15&&rt<8?Te>=100:Te<30?!1:Te>=50},te=(X,le,ie)=>{var Ne,ke,Pe,Te,rt;const oe=((Ne=X.passiveAbilities)==null?void 0:Ne.includes("STORM"))||X.turnPlayed!==ie.turnCount,Y=le.map((Oe,ze)=>({c:Oe,i:ze})).filter(({c:Oe})=>{var ze,$e;return Oe!==null&&!((ze=Oe.passiveAbilities)!=null&&ze.includes("STEALTH"))&&!(($e=Oe.passiveAbilities)!=null&&$e.includes("AURA"))});if(!(((ke=X.passiveAbilities)==null?void 0:ke.includes("STEALTH"))||X.hadStealth)){const Oe=Y.find(({c:ze})=>{var $e;return($e=ze.passiveAbilities)==null?void 0:$e.includes("WARD")});if(Oe)return L(Oe.c)?{index:-1,isLeader:!1}:{index:Oe.i,isLeader:!1}}let be={index:-1,isLeader:oe,score:oe?0:-1e3};for(const{c:Oe,i:ze}of Y){if(L(Oe))continue;let $e=0;const Ct=X.isEvolved,Ye=(Pe=Oe.passiveAbilities)==null?void 0:Pe.includes("BANE"),it=j(X,Oe);V(X,Oe)?($e+=50,$e+=(Oe.currentAttack||0)*5,it?Ye&&Ct?$e-=60:Ye&&($e-=30):$e+=30,Ye&&!it&&($e+=40),(Te=Oe.passiveAbilities)!=null&&Te.includes("STORM")&&($e+=30),(rt=Oe.passiveAbilities)!=null&&rt.includes("DOUBLE_ATTACK")&&($e+=35)):!it&&X.currentAttack>=Oe.currentHealth/2?$e+=10:it&&($e-=50,Ct&&($e-=40),(Oe.currentAttack||0)>=5&&($e+=10)),$e>be.score&&(be={index:ze,isLeader:!1,score:$e})}return oe&&(be.index===-1||be.score<=0)?{index:-1,isLeader:!0}:be},ye=d==="EASY"?1200:d==="HARD"?400:800;if(await new Promise(X=>setTimeout(X,ye)),!Ts.current)return;let Ee=0;const et=d==="EASY"?1:d==="HARD"?5:3;for(;Ee<et;){const X=ct.current,le=X.players[w].hand,ie=X.players[w].pp,Y=X.players[w].board.filter(Ye=>Ye!==null).length>=5;let ae=le.map((Ye,it)=>({...Ye,originalIndex:it})).filter(Ye=>Ye.cost<=ie).filter(Ye=>!(Ye.type==="FOLLOWER"&&Y));if(ae.length===0||(d==="HARD"?ae=ae.sort((Ye,it)=>z(it,X)-z(Ye,X)):ae=ae.sort((Ye,it)=>it.cost-Ye.cost),d==="EASY"&&Math.random()<.3&&Ee>0))break;const be=ae[0];let Ne;const Pe=X.players[P].board.filter(Ye=>{var it,bt;return Ye&&!((it=Ye.passiveAbilities)!=null&&it.includes("STEALTH"))&&!((bt=Ye.passiveAbilities)!=null&&bt.includes("AURA"))});Pe.length>0&&(d==="HARD"?Ne=[...Pe].sort((it,bt)=>{var Tt,Rt;let ft=(it.currentAttack||0)+(it.currentHealth||0),xt=(bt.currentAttack||0)+(bt.currentHealth||0);return(Tt=it.passiveAbilities)!=null&&Tt.includes("BANE")&&(ft+=10),(Rt=bt.passiveAbilities)!=null&&Rt.includes("BANE")&&(xt+=10),xt-ft})[0].instanceId:Ne=Pe[0].instanceId);const Te=window.innerWidth-20*h-80*h/2,rt=20*h+110*h/2,Oe=window.innerWidth/2,ze=window.innerHeight/2;let $e,Ct;if(be.type==="FOLLOWER"){const it=ct.current.players[w].board.filter(Vc=>Vc!==null),bt=it.length+1,ft=it.length,xt=Ti*h,Tt=(ft-(bt-1)/2)*xt,Rt=(Se=lo.current)==null?void 0:Se.getBoundingClientRect();$e=(Rt?Rt.left+Rt.width/2:window.innerWidth/2)+Tt,Ct=window.innerHeight/2-70*h}Jn({card:be,sourceIndex:-1,startX:Te,startY:rt,targetX:Oe,targetY:ze,finalX:$e,finalY:Ct,playerClass:(_e==null?void 0:_e.class)||"SENKA",onComplete:()=>{if(be.type!=="SPELL"&&(St("gan.mp3",.6),Xn()),C({type:"PLAY_CARD",playerId:w,payload:{cardIndex:be.originalIndex,targetId:Ne,instanceId:be.instanceId}}),be.id==="c_amandava"&&ct.current.players[P].board.forEach((it,bt)=>{if(it){const ft=it.instanceId;setTimeout(()=>{Kt("SHOT",P,bt,ft)},200)}}),be.id==="c_azya"){if(setTimeout(()=>{Kt("THUNDER",P,-1)},200),Ne){const it=ct.current.players[P].board.findIndex(bt=>(bt==null?void 0:bt.instanceId)===Ne);it!==-1&&setTimeout(()=>{Kt("ICE",P,it,Ne)},400)}setTimeout(()=>{const Ye=ct.current.players[P].board,it=Ye.filter(bt=>bt!==null);if(it.length>0){const bt=it[Math.floor(Math.random()*it.length)],ft=Ye.findIndex(xt=>(xt==null?void 0:xt.instanceId)===(bt==null?void 0:bt.instanceId));ft!==-1&&Kt("WATER",P,ft,bt==null?void 0:bt.instanceId)}},600)}Jn(null)}}),await E(600),Ee++}{const X=ct.current,le=X.players[w],ie=w===X.firstPlayerId,oe=X.turnCount,Y=Vx(le,oe,ie);if((Gx(le,oe,ie)||Y)&&le.board.length>0){const be=le.board.map((Ne,ke)=>({c:Ne,i:ke})).filter(({c:Ne})=>Ne&&Ne.type==="FOLLOWER"&&!Ne.hasEvolved);if(be.length>0){let Ne;const ke=Y;if(d==="HARD"&&(fe(X,ke)||console.log("[AI HARD] Skipping evolution - saving EP for better opportunity")),d==="HARD"&&!fe(X,ke))Ne=null;else if(d==="EASY")Ne=be[Math.floor(Math.random()*be.length)];else{const Te=be.map(({c:rt,i:Oe})=>({c:rt,i:Oe,score:K(rt,Oe,X,ke)}));Te.sort((rt,Oe)=>Oe.score-rt.score),d==="HARD"&&Te[0].score<5?(console.log("[AI HARD] Evolution target score too low:",Te[0].score),Ne=null):Ne=Te[0]}if(Ne){let Te;const Oe=X.players[P].board.filter($e=>{var Ct,Ye;return $e!==null&&!((Ct=$e.passiveAbilities)!=null&&Ct.includes("STEALTH"))&&!((Ye=$e.passiveAbilities)!=null&&Ye.includes("AURA"))});Oe.length>0&&(d==="HARD"?Te=[...Oe].sort((Ct,Ye)=>{var ft,xt,Tt,Rt;let it=(Ct.currentAttack||0)*2+(Ct.currentHealth||0),bt=(Ye.currentAttack||0)*2+(Ye.currentHealth||0);return(ft=Ct.passiveAbilities)!=null&&ft.includes("BANE")&&(it+=10),(xt=Ye.passiveAbilities)!=null&&xt.includes("BANE")&&(bt+=10),(Tt=Ct.passiveAbilities)!=null&&Tt.includes("DOUBLE_ATTACK")&&(it+=5),(Rt=Ye.passiveAbilities)!=null&&Rt.includes("DOUBLE_ATTACK")&&(bt+=5),bt-it})[0].instanceId:Te=Oe[0].instanceId);const ze=(Qe=xr.current[Ne.i])==null?void 0:Qe.getBoundingClientRect();ze?(uo({card:Ne.c,evolvedImageUrl:Ne.c.evolvedImageUrl,startX:ze.left+ze.width/2,startY:ze.top+ze.height/2,useSep:ke,phase:"ZOOM_IN",followerIndex:Ne.i,sourcePlayerId:w,targetId:Te}),await E(800)):(Is({type:"EVOLVE",playerId:w,payload:{followerIndex:Ne.i,useSep:ke,targetId:Te}}),await E(400))}}}}{let X=!0,le=0;const ie=oe=>{if(d!=="HARD")return!1;const Y=oe.players[P].hp;return ee(oe)>=Y};for(;X&&le<15;){if(ct.current.winnerId){X=!1;break}le++;const oe=ct.current,Y=oe.players[w].board,ae=oe.players[P].board,be=ie(oe);let Ne=!1;for(let ke=0;ke<Y.length;ke++){const Pe=Y[ke];if(!Pe||!Pe.canAttack)continue;let Te=-1,rt=!0;const Oe=((tt=Pe.passiveAbilities)==null?void 0:tt.includes("STEALTH"))||Pe.hadStealth,ze=Oe?-1:ae.findIndex(ft=>{var xt,Tt;return ft&&((xt=ft.passiveAbilities)==null?void 0:xt.includes("WARD"))&&!((Tt=ft.passiveAbilities)!=null&&Tt.includes("STEALTH"))&&!L(ft)});if(be&&ze===-1)if(((We=Pe.passiveAbilities)==null?void 0:We.includes("STORM"))||Pe.turnPlayed!==oe.turnCount)Te=-1,rt=!0;else{const Tt=ae.map((Rt,Rs)=>({c:Rt,idx:Rs})).filter(({c:Rt})=>{var Rs,Vc;return Rt&&!((Rs=Rt.passiveAbilities)!=null&&Rs.includes("STEALTH"))&&!((Vc=Rt.passiveAbilities)!=null&&Vc.includes("AURA"))&&!L(Rt)});if(Tt.length>0)Te=Tt[0].idx,rt=!1;else continue}else if(ze!==-1)Te=ze,rt=!1;else if(d==="EASY"){const ft=ae.map((Tt,Rt)=>({c:Tt,idx:Rt})).filter(({c:Tt})=>{var Rt,Rs;return Tt&&!((Rt=Tt.passiveAbilities)!=null&&Rt.includes("STEALTH"))&&!((Rs=Tt.passiveAbilities)!=null&&Rs.includes("AURA"))&&!L(Tt)}),xt=((Ge=Pe.passiveAbilities)==null?void 0:Ge.includes("STORM"))||Pe.turnPlayed!==oe.turnCount;if(!xt&&ft.length>0)Te=ft[Math.floor(Math.random()*ft.length)].idx,rt=!1;else{if(!xt&&ft.length===0)continue;xt&&ft.length>0&&Math.random()<.5&&(Te=ft[Math.floor(Math.random()*ft.length)].idx,rt=!1)}}else{const ft=te(Pe,ae,oe);if(Te=ft.index,rt=ft.isLeader,Te===-1&&!rt)continue}const $e=(xe=Pe.passiveAbilities)==null?void 0:xe.includes("STORM"),Ct=Pe.turnPlayed===oe.turnCount;if(!$e&&Ct&&rt){const ft=ae.map((xt,Tt)=>({c:xt,idx:Tt})).filter(({c:xt})=>{var Tt,Rt;return xt&&!((Tt=xt.passiveAbilities)!=null&&Tt.includes("STEALTH"))&&!((Rt=xt.passiveAbilities)!=null&&Rt.includes("AURA"))&&!L(xt)});if(ft.length>0){const xt=Oe?null:ft.find(({c:Tt})=>{var Rt;return(Rt=Tt.passiveAbilities)==null?void 0:Rt.includes("WARD")});xt?Te=xt.idx:Te=ft[0].idx,rt=!1}else continue}const Ye=rt?null:ae[Te],it=Ye?Ye.instanceId:void 0,bt=Pe.instanceId;if(bt&&(Pc(bt),setTimeout(()=>Pc(null),300)),Kt(Pe.attackEffectType||"SLASH",P,rt?-1:Te,it),!rt&&Te>=0){const ft=ae[Te];if(ft&&(ft.currentAttack||0)>0){const xt=ft.instanceId;setTimeout(()=>{xt&&(Oc(xt),setTimeout(()=>Oc(null),300)),Kt(ft.attackEffectType||"SLASH",w,ke,bt)},200)}}Ne=!0,await E(1e3),C({type:"ATTACK",playerId:w,payload:{attackerIndex:ke,targetIndex:Te,targetIsLeader:rt}}),await E(1e3);break}Ne||(X=!1)}}if(await E(300),ct.current.winnerId){Ts.current=!1;return}C({type:"END_TURN",playerId:w}),Ts.current=!1})()}},[g.activePlayerId,g.turnCount,n,g.phase,d,g.winnerId]);const Nm=(m,_)=>{if(Fn.current||nt||oo.length>0)return;const E=q.hand[_];m.stopPropagation();const L="touches"in m?m.touches[0].clientX:m.clientX,j="touches"in m?m.touches[0].clientY:m.clientY,V=m.currentTarget.getBoundingClientRect();if(!Zr){Nf(!0),qr({card:E,owner:"PLAYER",source:"HAND"}),jf.current=!0;return}if(qr({card:E,owner:"PLAYER",source:"HAND"}),g.activePlayerId!==P)return;if(yn.current){console.warn("[handleHandMouseDown] Card play in progress, blocking drag start");return}const ee=ct.current;if(ee.winnerId){console.log("UI: Card play drag blocked - game has ended");return}if(ee.pendingEffects&&ee.pendingEffects.length>0){console.log("UI: Card play drag blocked - pendingEffects still processing");return}const B={sourceType:"HAND",sourceIndex:_,sourceInstanceId:E.instanceId,startX:V.left+V.width/2,startY:V.top+V.height/2,currentX:L,currentY:j,offsetX:0,offsetY:0,canDrag:!0};Qr(B),Fn.current=B},jm=(m,_,E)=>{m.stopPropagation();const L="touches"in m?m.touches[0].clientX:m.clientX,j="touches"in m?m.touches[0].clientY:m.clientY,V=ct.current;if(V.winnerId){console.log("UI: Attack drag blocked - game has ended");return}const ee=V.players[P].board,B=E?ee.findIndex(K=>K&&K.instanceId===E):_,z=B>=0?ee[B]:null;if(dt&&dt.allowedTargetPlayerId===P&&z){Vf("FOLLOWER",B,P,E);return}if(z&&qr({card:z,owner:"PLAYER",source:"BOARD"}),V.pendingEffects&&V.pendingEffects.length>0){console.log("UI: Attack drag blocked - pendingEffects still processing");return}if(V.activePlayerId===P&&(z!=null&&z.canAttack)){const K=m.currentTarget.getBoundingClientRect(),fe={x:K.left+K.width/2,y:K.top+K.height/2},te={sourceType:"BOARD",sourceIndex:B,sourceInstanceId:z.instanceId,startX:fe.x,startY:fe.y,currentX:L,currentY:j,offsetX:0,offsetY:0};Qr(te),Fn.current=te}},zc=(m,_=!1)=>{if(g.activePlayerId!==P)return;m.stopPropagation();const E="touches"in m?m.touches[0].clientX:m.clientX,L="touches"in m?m.touches[0].clientY:m.clientY,j=ct.current;if(j.winnerId){console.log("UI: Evolve drag blocked - game has ended");return}if(j.pendingEffects&&j.pendingEffects.length>0){console.log("UI: Evolve drag blocked - pendingEffects still processing");return}const V=P===g.firstPlayerId;if(_){if(!Vx(q,g.turnCount,V))return}else if(!Gx(q,g.turnCount,V))return;const ee=m.currentTarget.getBoundingClientRect(),B=ee.left+ee.width/2,z=ee.top+ee.height/2,K={sourceType:"EVOLVE",sourceIndex:0,startX:B,startY:z,currentX:E,currentY:L,offsetX:0,offsetY:0,useSep:_};Qr(K),Fn.current=K},$m=A.useCallback(m=>{ir.current&&(clearTimeout(ir.current),ir.current=null);const _={stampId:m,playerId:P,playerClass:jn,timestamp:Date.now()},E=gv(m);E&&St(E,.6),$n(null),requestAnimationFrame(()=>{$n(_)}),e==="ONLINE"&&x&&x.send({type:"STAMP",stampId:m,playerClass:jn}),ir.current=setTimeout(()=>{$n(L=>(L==null?void 0:L.timestamp)===_.timestamp?null:L),ir.current=null},3e3)},[P,jn,e,x]),O2=A.useCallback(m=>{if(m.stopPropagation(),m.preventDefault(),Ei.current){const _=Ei.current.getBoundingClientRect();Kn.current={x:_.left+_.width/2,y:_.top+_.height/2}}else Kn.current={x:m.clientX,y:m.clientY};Cc(!0),io(null)},[]),Fm=$.useRef(null);$.useEffect(()=>{Fm.current=Ca},[Ca]),A.useEffect(()=>{if(!wa)return;const m=E=>{if(!Kn.current)return;const L=E.clientX-Kn.current.x,j=E.clientY-Kn.current.y,V=Math.sqrt(L*L+j*j),ee=Math.atan2(j,L)*(180/Math.PI);if(V>=200&&V<=320&&j<0){const fe=180- -ee,te=Math.floor(fe/22.5),Ee=Math.max(0,Math.min(7,te))+1;io(Ee)}else io(null)},_=()=>{const E=Fm.current;E&&$m(E),Cc(!1),io(null),Kn.current=null};return window.addEventListener("mousemove",m),window.addEventListener("mouseup",_),()=>{window.removeEventListener("mousemove",m),window.removeEventListener("mouseup",_)}},[wa,$m]),A.useEffect(()=>{const m=(L,j,V=!1)=>{var z,K,fe,te;if(!Fn.current)return;const{canDrag:ee,sourceType:B}=Fn.current;if(!(B==="HAND"&&!ee)&&(Fn.current={...Fn.current,currentX:L,currentY:j},Qr(ye=>ye?{...ye,currentX:L,currentY:j}:null),V&&(B==="BOARD"||B==="EVOLVE"))){const ye=co.current;if(ye){const Se=ye.getBoundingClientRect();if(L>=Se.left&&L<=Se.right&&j>=Se.top&&j<=Se.bottom){ar({type:"LEADER",index:0,playerId:w});return}}const Ee=ct.current,et=((z=Ee.players[w])==null?void 0:z.board)||[];for(let Se=0;Se<xr.current.length;Se++){const Qe=xr.current[Se];if(Qe&&et[Se]){const tt=Qe.getBoundingClientRect();if(L>=tt.left&&L<=tt.right&&j>=tt.top&&j<=tt.bottom){ar({type:"FOLLOWER",index:Se,playerId:w,instanceId:(K=et[Se])==null?void 0:K.instanceId});return}}}if(B==="EVOLVE"){const Se=((fe=Ee.players[P])==null?void 0:fe.board)||[];for(let Qe=0;Qe<Mr.current.length;Qe++){const tt=Mr.current[Qe];if(tt&&Se[Qe]){const We=tt.getBoundingClientRect();if(L>=We.left&&L<=We.right&&j>=We.top&&j<=We.bottom){ar({type:"FOLLOWER",index:Qe,playerId:P,instanceId:(te=Se[Qe])==null?void 0:te.instanceId});return}}}}ar(null)}},_=L=>{m(L.clientX,L.clientY)},E=L=>{L.touches.length>0&&(Fn.current&&L.preventDefault(),m(L.touches[0].clientX,L.touches[0].clientY,!0))};return window.addEventListener("mousemove",_),window.addEventListener("touchmove",E,{passive:!1}),()=>{window.removeEventListener("mousemove",_),window.removeEventListener("touchmove",E)}},[]);const Um=$.useRef(null),L2=$.useRef(null);A.useEffect(()=>{Um.current=yt,L2.current=yt},[yt]),A.useEffect(()=>{const m=()=>{var j,V,ee,B,z,K,fe,te,ye,Ee,et,Se,Qe;const E=Fn.current,L=Um.current;if(ct.current.winnerId){console.log("[handleGlobalMouseUp] Game has ended, cancelling all actions"),Qr(null),Fn.current=null,ar(null);return}if(E){if(E.sourceType==="HAND"){if(yn.current){console.warn("[handleGlobalMouseUp] Card play in progress, cancelling drag"),Fn.current=null,Qr(null);return}const tt=Math.sqrt(Math.pow(E.startX-E.currentX,2)+Math.pow(E.startY-E.currentY,2)),We=E.currentY<window.innerHeight-200*h;if(E.canDrag&&tt>30&&We){const Ge=Nr.current.hand[E.sourceIndex];if(Nr.current.pp>=Ge.cost){const xe=((V=(j=Ge.triggerAbilities)==null?void 0:j.FANFARE)==null?void 0:V.targetType)==="SELECT_FOLLOWER"||((ee=Ge.triggers)==null?void 0:ee.some(oe=>oe.trigger==="FANFARE"&&oe.effects.some(Y=>Y.targetType==="SELECT_FOLLOWER"))),X=((z=(B=Ge.triggerAbilities)==null?void 0:B.FANFARE)==null?void 0:z.targetType)==="SELECT_ALLY_FOLLOWER"||((K=Ge.triggers)==null?void 0:K.some(oe=>oe.trigger==="FANFARE"&&oe.effects.some(Y=>Y.targetType==="SELECT_ALLY_FOLLOWER"))),le=((te=(fe=Ge.triggerAbilities)==null?void 0:fe.FANFARE)==null?void 0:te.targetType)==="SELECT_OTHER_ALLY_FOLLOWER"||((ye=Ge.triggers)==null?void 0:ye.some(oe=>oe.trigger==="FANFARE"&&oe.effects.some(Y=>Y.targetType==="SELECT_OTHER_ALLY_FOLLOWER")));if(xe||X||le){const oe=X||le?P:w;ct.current.players[oe].board.some(be=>{var Ne,ke;return!(!be||oe!==P&&((Ne=be.passiveAbilities)!=null&&Ne.includes("STEALTH")||(ke=be.passiveAbilities)!=null&&ke.includes("AURA")))})?(yn.current=!0,Na.current=Ge.instanceId||null,Ss({type:"PLAY",sourceIndex:E.sourceIndex,sourceInstanceId:Ge.instanceId,allowedTargetPlayerId:oe}),_r.current=!0,setTimeout(()=>{_r.current=!1},100)):(console.log("[handleGlobalMouseUp] No valid targets, skipping target selection"),Gf(E.sourceIndex,E.startX,E.startY),qr(null),_r.current=!0,setTimeout(()=>{_r.current=!1},100))}else Gf(E.sourceIndex,E.startX,E.startY),qr(null),_r.current=!0,setTimeout(()=>{_r.current=!1},100);Fn.current=null,Qr(null);return}}else E.canDrag||Nf(!0)}else if(E.sourceType==="BOARD"){if(L&&L.playerId===w){const We=ct.current.players[w],Ge=We.board.filter(Y=>{var ae,be;return Y&&((ae=Y.passiveAbilities)==null?void 0:ae.includes("WARD"))&&!((be=Y.passiveAbilities)!=null&&be.includes("STEALTH"))});let xe=!1;const X=Y=>Y?We.board.findIndex(ae=>ae&&ae.instanceId===Y):-1,le=L.type==="LEADER"?-1:X(L.instanceId),ie=Nr.current.board[E.sourceIndex],oe=((Ee=ie==null?void 0:ie.passiveAbilities)==null?void 0:Ee.includes("STEALTH"))||(ie==null?void 0:ie.hadStealth);if(Ge.length>0&&!oe){if(L.type==="LEADER")xe=!0;else if(L.type==="FOLLOWER"&&le>=0){const Y=We.board[le];Y&&!((et=Y.passiveAbilities)!=null&&et.includes("WARD"))&&(xe=!0)}}if(xe)console.log("UI: Attack blocked by WARD");else{const Y=Nr.current.board.findIndex(rt=>rt&&rt.instanceId===E.sourceInstanceId),ae=Y>=0?Nr.current.board[Y]:null,be=(Se=ae==null?void 0:ae.passiveAbilities)==null?void 0:Se.includes("RUSH"),Ne=(Qe=ae==null?void 0:ae.passiveAbilities)==null?void 0:Qe.includes("STORM"),ke=(ae==null?void 0:ae.turnPlayed)===ct.current.turnCount,Pe=L.type==="LEADER",Te=le;if(Pe&&be&&!Ne&&ke)console.log("UI: Attack blocked by RUSH rule (Cannot attack leader)");else{if(Y<0||!ae){console.log("UI: Attack blocked - invalid attacker");return}const rt=ct.current;if(rt.pendingEffects&&rt.pendingEffects.length>0){console.log("UI: Attack blocked - pendingEffects still processing");return}const Oe=L.instanceId,ze=E.sourceInstanceId,$e=!Pe&&Te>=0?We.board[Te]:null;Is({type:"ATTACK",playerId:P,payload:{attackerIndex:Y,targetIndex:Pe?-1:Te,targetIsLeader:Pe}}),ze&&(Pc(ze),setTimeout(()=>Pc(null),300));const Ye=(ae==null?void 0:ae.attackEffectType)||"SLASH";if(Kt(Ye,w,Pe?-1:Te,Oe),Xn(),!Pe&&$e&&($e.currentAttack||0)>0){const it=$e.instanceId;setTimeout(()=>{it&&(Oc(it),setTimeout(()=>Oc(null),300)),Kt($e.attackEffectType||"SLASH",P,Y,ze)},200)}}}}}else if(E.sourceType==="EVOLVE"&&L&&L.type==="FOLLOWER"&&L.playerId===P){const tt=L.index,Ge=Aa.current[tt],xe=(Ge==null?void 0:Ge.instanceId)||L.instanceId,X=Nr.current.board,le=xe?X.findIndex(ze=>ze&&ze.instanceId===xe):tt,ie=le>=0?X[le]:null;if(!ie)return;if(ie.hasEvolved){console.log("[GameScreen] Cannot evolve: card already evolved (drag drop)");return}const Y=E.useSep?["SUPER_EVOLVE","EVOLVE"]:["EVOLVE"],be=(()=>{var $e,Ct;const ze=(Ct=($e=ie==null?void 0:ie.triggerAbilities)==null?void 0:$e.EVOLVE)==null?void 0:Ct.targetType;if(ze)return ze;for(const Ye of(ie==null?void 0:ie.triggers)||[])if(Y.includes(Ye.trigger)){for(const it of Ye.effects)if(it.targetType&&["SELECT_FOLLOWER","SELECT_ALLY_FOLLOWER","SELECT_OTHER_ALLY_FOLLOWER"].includes(it.targetType))return it.targetType}return null})(),Ne=!!be,ke=be==="SELECT_ALLY_FOLLOWER"||be==="SELECT_OTHER_ALLY_FOLLOWER",Pe=be==="SELECT_OTHER_ALLY_FOLLOWER",Te=ke?P:w,Oe=ct.current.players[Te].board.some(ze=>{var $e,Ct;return!(!ze||ke&&Pe&&ze.instanceId===xe||!ke&&(($e=ze.passiveAbilities)!=null&&$e.includes("STEALTH")||(Ct=ze.passiveAbilities)!=null&&Ct.includes("AURA")))});Ne&&Oe?(Ss({type:"EVOLVE",sourceIndex:le,sourceInstanceId:xe,sourceVisualIndex:tt,useSep:E.useSep,allowedTargetPlayerId:Te,excludeInstanceId:Pe?xe:void 0}),_r.current=!0,setTimeout(()=>{_r.current=!1},100)):(Bc(tt,E.useSep,void 0,xe),_r.current=!0,setTimeout(()=>{_r.current=!1},100))}}E&&E.sourceType==="HAND"&&E.canDrag&&(wm(E.sourceIndex),setTimeout(()=>wm(null),300)),Qr(null),Fn.current=null,ar(null)},_=()=>{m()};return window.addEventListener("mouseup",m),window.addEventListener("touchend",_),()=>{window.removeEventListener("mouseup",m),window.removeEventListener("touchend",_)}},[w,P,Zr,h]);const D2=()=>{if(!_r.current){if(dt){dt.type==="PLAY"&&(yn.current=!1),Ss(null);return}if(Zr){if(jf.current){jf.current=!1;return}Nf(!1),qr(null),Je(null)}}},ws=()=>{if(!Z||Z.sourceType!=="BOARD"&&Z.sourceType!=="EVOLVE")return"";const m=Z.currentX-Z.startX,_=Z.currentY-Z.startY,E=Math.sqrt(m*m+_*_);if(E<10)return"";const L=(Z.startX+Z.currentX)/2,j=(Z.startY+Z.currentY)/2,V=Math.min(200,E*.3),ee=Math.abs(m),B=Math.min(150,ee*.4),z=V+B,fe=-(m/(E+1))*z*.5,te=-z*.8,ye=L+fe,Ee=j+te;return`M${Z.startX},${Z.startY} Q${ye},${Ee} ${Z.currentX},${Z.currentY}`},Vf=(m,_,E,L)=>{var ee;if(!dt)return;if(dt.allowedTargetPlayerId&&dt.allowedTargetPlayerId!==E){console.log("Invalid target side");return}if(dt.excludeInstanceId&&L===dt.excludeInstanceId){console.log("Cannot target self (SELECT_OTHER_ALLY_FOLLOWER)"),Xn();return}let j,V=_;if(m==="FOLLOWER"){if(L&&(V=g.players[E].board.findIndex(z=>z&&z.instanceId===L),V<0))return;const B=g.players[E].board[V];if(!B)return;if(j=B.instanceId,E!==P){const z=B.passiveAbilities||[];if(z.includes("STEALTH")){console.log("Cannot target unit with STEALTH"),St("cancel"),Xn();return}if(z.includes("AURA")){console.log("Cannot target unit with AURA"),St("cancel"),Xn();return}}}else return;if(dt.type==="PLAY"){const B=Nr.current;let z=dt.sourceIndex,K=B.hand[z];if(dt.sourceInstanceId){const We=B.hand.findIndex(Ge=>Ge.instanceId===dt.sourceInstanceId);if(We>=0)z=We,K=B.hand[We],console.log(`[handleTargetClick] Using sourceInstanceId ${dt.sourceInstanceId}, found at index ${We} (was ${dt.sourceIndex})`);else{console.error("[handleTargetClick] Card not found with instanceId:",dt.sourceInstanceId),Ss(null);return}}if(!K){console.error("[handleTargetClick] Card not found at index:",z),Ss(null),yn.current=!1;return}yn.current=!0,Na.current=K.instanceId||null,K.id==="c_y"&&(Kt("SUMI","p2",V,j),ct.current.players[w].board.forEach((Ge,xe)=>{if(Ge){const X=Ge.instanceId;setTimeout(()=>{Kt("SUMI",w,xe,X)},300)}})),K.id==="s_resignation_proxy"&&(Kt("SUMI",E,V,j),setTimeout(()=>{const We=ct.current.players[P].board,Ge=[];if(We.forEach((xe,X)=>{xe&&Ge.push({index:X,instanceId:xe.instanceId})}),Ge.length>0){const xe=Ge[Math.floor(Math.random()*Ge.length)];Kt("SUMI",P,xe.index,xe.instanceId)}},500)),K.id==="c_azya"&&(Kt("THUNDER",w,-1),setTimeout(()=>{Kt("ICE",E,V,j)},300),setTimeout(()=>{const We=ct.current.players[w].board,Ge=We.filter(xe=>xe!==null);if(Ge.length>0){const xe=Ge[Math.floor(Math.random()*Ge.length)],X=We.findIndex(le=>(le==null?void 0:le.instanceId)===(xe==null?void 0:xe.instanceId));X!==-1&&Kt("WATER",w,X,xe==null?void 0:xe.instanceId)}},600));const fe=window.innerWidth/2,te=window.innerHeight-200*h/2,ye=window.innerWidth/2,Ee=window.innerHeight/2,et=()=>{K.type==="SPELL"||Xn(),Is({type:"PLAY_CARD",playerId:P,payload:{cardIndex:z,targetId:j,instanceId:K.instanceId}}),K.id==="c_amandava"&&ct.current.players[w].board.forEach((xe,X)=>{if(xe){const le=xe.instanceId;setTimeout(()=>{Kt("SHOT",w,X,le)},200)}}),Jn(null),setTimeout(()=>{yn.current=!1},100)};let Se,Qe;if(K.type==="FOLLOWER"){const Ge=ct.current.players[P].board.filter(ae=>ae!==null),xe=Ge.length+1,X=Ge.length,le=Ti*h,ie=(X-(xe-1)/2)*le,oe=(ee=lo.current)==null?void 0:ee.getBoundingClientRect();Se=(oe?oe.left+oe.width/2:window.innerWidth/2)+ie,Qe=window.innerHeight/2+70*h}const tt=K.type==="FOLLOWER"?ct.current.players[P].board.filter(We=>We!==null).length:void 0;n!=="CPU"&&v&&x&&x.send({type:"PLAY_CARD_ANIM",payload:{playerId:P,cardIndex:z,card:K,targetBoardIndex:tt}}),Jn({card:K,sourceIndex:dt.sourceIndex??-1,startX:fe,startY:te,targetX:ye,targetY:Ee,finalX:Se,finalY:Qe,playerClass:(q==null?void 0:q.class)||"SENKA",onComplete:et}),setTimeout(()=>{Jn(We=>(We==null?void 0:We.card.id)===K.id?(et(),null):We)},2e3)}else if(dt.type==="EVOLVE"){const B=dt.sourceVisualIndex??dt.sourceIndex;Bc(B,!!dt.useSep,j,dt.sourceInstanceId)}Ss(null)},Bm=()=>{if(!Ve||Ve.owner!=="PLAYER")return;if(yn.current){console.warn("[handleUseButtonClick] Card play in progress, ignoring");return}const m=q.hand.findIndex(L=>L.id===Ve.card.id);if(m===-1)return;const _=window.innerWidth/2,E=window.innerHeight-200*h/2;Gf(m,_,E),qr(null)},[po,Yf]=$.useState(!1),[Hc,Kf]=$.useState(!1),[Qt,Xf]=$.useState(null),M2=$.useRef(0);$.useEffect(()=>{if(!(Qt!=null&&Qt.active))return;const m=Date.now(),_=800,E=()=>{const L=Date.now()-m;if(L>=_){Xf(null);return}const j=L/_;Xf(V=>V?{...V,ringRadius:20+j*100,particles:V.particles.map(ee=>({...ee,x:ee.x+ee.vx,y:ee.y+ee.vy,opacity:1-j}))}:null),requestAnimationFrame(E)};requestAnimationFrame(E)},[Qt==null?void 0:Qt.active]);const zm=(m,_)=>{const E=[];for(let L=0;L<20;L++){const j=Math.random()*Math.PI*2,V=2+Math.random()*3;E.push({id:M2.current++,x:m,y:_,vx:Math.cos(j)*V,vy:Math.sin(j)*V,opacity:1,createdAt:Date.now()})}Xf({active:!0,x:m,y:_,ringRadius:20,particles:E})},Jf=async()=>{if(g.winnerId){console.log("[handleEndTurn] Game is over, ignoring");return}if(g.activePlayerId!==P){console.log("[handleEndTurn] Not my turn, ignoring");return}if(fo.current){console.log("[handleEndTurn] Already ending turn, ignoring");return}fo.current=!0,Yf(!0);const m=ct.current.turnCount,_=ct.current.activePlayerId;if(!await(async()=>{const j=()=>{const K=ct.current,fe=K.pendingEffects&&K.pendingEffects.length>0,te=zf.current.length>0,ye=Hf.current.length>0,Ee=ja.current!==null,et=ho.current!==null,Se=Jr.current,Qe=yn.current;return!fe&&!te&&!ye&&!Ee&&!et&&!Se&&!Qe};let B=0,z=0;for(;B<3e3;){if(ct.current.turnCount!==m||ct.current.activePlayerId!==_)return console.log("[handleEndTurn] Turn changed during wait, aborting local END_TURN"),!1;if(j()){if(z++,z>=2)break}else z=0;await new Promise(K=>setTimeout(K,50)),B+=50}return B>=3e3&&console.warn("[handleEndTurn] Timeout waiting for processing to complete - forcing end turn"),!0})()||ct.current.turnCount!==m||ct.current.activePlayerId!==_||ct.current.activePlayerId!==P){console.log("[handleEndTurn] Turn state changed, aborting END_TURN dispatch"),fo.current=!1,Yf(!1);return}console.log("[handleEndTurn] Dispatching END_TURN"),Is({type:"END_TURN",playerId:P}),fo.current=!1,Yf(!1)},N2=A.useCallback(()=>{St("sisiodosi.mp3",.6);const m=bm.current;if(m){const _=m.getBoundingClientRect();zm(_.left+_.width/2,_.top+_.height/2)}Jf()},[St,Jf]),Hm=2-((q==null?void 0:q.evolutionsUsed)||0),Qf=P===g.firstPlayerId,Wm=(m,_)=>_?Math.ceil(g.turnCount/2):Math.floor(g.turnCount/2),Gm=Wm(P,Qf),j2=Qf?3:2,$2=Qf?4:3,Wc=Gm>=j2,Gc=Gm>=$2,Cs=(q==null?void 0:q.canEvolveThisTurn)&&Hm>0&&g.activePlayerId===P&&Wc,ks=(q==null?void 0:q.canEvolveThisTurn)&&q.sep>0&&g.activePlayerId===P&&Gc,qf=w===g.firstPlayerId,Vm=Wm(w,qf),F2=qf?3:2,U2=qf?4:3,Zf=Vm>=F2,eh=Vm>=U2,th=((Zm=q==null?void 0:q.board)==null?void 0:Zm.some(m=>{var _;return(_=m==null?void 0:m.passiveAbilities)==null?void 0:_.includes("LEADER_DAMAGE_CAP")}))??!1,nh=((ey=_e==null?void 0:_e.board)==null?void 0:ey.some(m=>{var _;return(_=m==null?void 0:m.passiveAbilities)==null?void 0:_.includes("LEADER_DAMAGE_CAP")}))??!1,B2=(q==null?void 0:q.leaderDamageShield)??!1,z2=(_e==null?void 0:_e.leaderDamageShield)??!1,Ym=th||B2,Km=nh||z2;return A.useLayoutEffect(()=>{window.scrollTo(0,0),lo.current&&(lo.current.scrollTop=0);const m=()=>{window.scrollTo(0,0)};return window.addEventListener("scroll",m,{passive:!1}),()=>{window.removeEventListener("scroll",m)}},[]),n==="JOIN"&&!O||U&&y&&!O?a.jsxs("div",{style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",gap:"1rem"},children:[a.jsx("div",{style:{width:"50px",height:"50px",border:"4px solid rgba(233, 69, 96, 0.3)",borderTop:"4px solid #e94560",borderRadius:"50%",animation:"spin 1s linear infinite"}}),a.jsx("p",{children:"..."}),a.jsx("button",{onClick:s,style:{marginTop:"1rem",padding:"0.5rem 1rem",background:"transparent",border:"1px solid #888",color:"#888",cursor:"pointer",borderRadius:"4px"},children:""}),a.jsx("style",{children:`
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                `})]}):U&&je&&O?a.jsxs("div",{style:{height:"100dvh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",color:"white",gap:"1rem"},children:[a.jsx("div",{style:{fontSize:"2rem",fontWeight:"bold",color:"#4ade80",textShadow:"0 0 10px rgba(74, 222, 128, 0.5)",marginBottom:"0.5rem"},children:""}),a.jsx("div",{style:{width:"50px",height:"50px",border:"4px solid rgba(74, 222, 128, 0.3)",borderTop:"4px solid #4ade80",borderRadius:"50%",animation:"spin 1s linear infinite"}}),a.jsx("p",{style:{color:"#a0aec0"},children:"..."}),a.jsx("style",{children:`
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                `})]}):a.jsxs("div",{className:"game-screen-wrapper",style:{width:"100vw",height:"100dvh",overflow:"hidden",background:"#000",position:"relative"},children:[H&&a.jsx(i3,{myPlayer:q,opponentPlayer:_e,isFirstPlayer:Nn,onComplete:A2,scale:h,onVsImpact:()=>St("vs.mp3",.7),onCoinToss:()=>St("coin.mp3",.7),onImpact:()=>St("gan.mp3",.7),onOrbLand:()=>St("gan.mp3",.8),onFadeInBoard:()=>ue(!0),isMobile:N,isRankedMatch:n==="RANKED_MATCH",myRank:Ec,opponentRank:Tc}),a.jsxs("div",{className:"game-screen",style:{width:"100%",height:"100%",transform:Et>0?`translate(${de.x}px, ${de.y}px)`:"none",display:"flex",overflow:"hidden",background:"radial-gradient(circle at center, #1a202c 0%, #000 100%)",fontFamily:"'Helvetica Neue', sans-serif",userSelect:"none",color:"#fff",position:"absolute",top:0,left:0,opacity:H&&!ve?0:1,transition:"opacity 0.5s ease-in"},onClick:D2,children:[a.jsx("style",{children:`
                    html, body {
                        margin: 0; padding: 0; height: 100%; background: #000;
                        overflow: hidden !important;
                        position: fixed !important;
                        width: 100% !important;
                        top: 0 !important;
                        left: 0 !important;
                    }
                    * { box-sizing: border-box; }
                    .shake-target { animation: shake 0.3s cubic-bezier(.36,.07,.19,.97) both; }
                    @keyframes shake {
                        10%, 90% { transform: translate3d(-1px, 0, 0); }
                        20%, 80% { transform: translate3d(2px, 0, 0); }
                        30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
                        40%, 60% { transform: translate3d(4px, 0, 0); }
                    }
                    @keyframes attackRotate {
                        0% { transform: rotateY(0deg); }
                        100% { transform: rotateY(360deg); }
                    }
                    .attack-rotating {
                        animation: attackRotate 0.2s linear forwards !important;
                        transform-style: preserve-3d;
                    }
                    @keyframes cardDie {
                        0% { transform: scale(1); filter: brightness(1) drop-shadow(0 0 0 white); opacity: 1; }
                        40% { transform: scale(1.15); filter: brightness(3) drop-shadow(0 0 20px white); opacity: 0.9; }
                        100% { transform: scale(0.4) rotate(8deg); filter: brightness(5) drop-shadow(0 0 40px white); opacity: 0; }
                    }
                    .card-dying { animation: cardDie 0.7s forwards; }
                    /* Necromance effect animations */
                    @keyframes necromanceFloat {
                        0% { transform: translateX(-50%) translateY(0) scale(1); opacity: 1; }
                        50% { transform: translateX(-50%) translateY(-20px) scale(1.2); opacity: 1; }
                        100% { transform: translateX(-50%) translateY(-40px) scale(0.8); opacity: 0; }
                    }
                    @keyframes necromanceFloatOpponent {
                        0% { transform: translateX(-50%) translateY(0) scale(1); opacity: 1; }
                        50% { transform: translateX(-50%) translateY(15px) scale(1.2); opacity: 1; }
                        100% { transform: translateX(-50%) translateY(30px) scale(0.8); opacity: 0; }
                    }
                    @keyframes necroPulse {
                        0%, 100% { box-shadow: 0 0 10px #d946ef, 0 0 20px #a855f7, inset 0 0 15px rgba(217, 70, 239, 0.3); }
                        50% { box-shadow: 0 0 25px #d946ef, 0 0 40px #a855f7, 0 0 60px #7c3aed, inset 0 0 25px rgba(217, 70, 239, 0.5); }
                    }
                    @keyframes leaderDamageCapPulse {
                        0%, 100% {
                            box-shadow: 0 0 20px rgba(103, 232, 249, 0.4), 0 0 40px rgba(103, 232, 249, 0.2);
                            border-color: #67e8f9;
                        }
                        50% {
                            box-shadow: 0 0 35px rgba(103, 232, 249, 0.7), 0 0 55px rgba(103, 232, 249, 0.4);
                            border-color: #a5f3fc;
                        }
                    }
                    @keyframes leaderDamageCapOverlay {
                        0%, 100% { opacity: 0.15; }
                        50% { opacity: 0.45; }
                    }
                    /* EP/SEP pulse animations for usable state - box-shadow only, no transform override */
                    @keyframes epPulse {
                        0%, 100% {
                            box-shadow: 0 0 12px #ffd700, 0 0 25px rgba(255,215,0,0.6);
                        }
                        50% {
                            box-shadow: 0 0 20px #ffd700, 0 0 40px rgba(255,215,0,0.8), 0 0 55px rgba(255,180,0,0.5);
                        }
                    }
                    @keyframes sepPulse {
                        0%, 100% {
                            box-shadow: 0 0 12px #b794f4, 0 0 25px rgba(159,122,234,0.6);
                        }
                        50% {
                            box-shadow: 0 0 20px #b794f4, 0 0 40px rgba(159,122,234,0.8), 0 0 55px rgba(180,0,255,0.5);
                        }
                    }
                `}),dt&&a.jsx("div",{style:{position:"absolute",top:"15%",left:"50%",transform:"translate(-50%, -50%)",background:"rgba(0, 0, 0, 0.7)",color:"#fff",padding:"10px 20px",borderRadius:20,pointerEvents:"none",zIndex:1e3,fontWeight:"bold",border:dt.allowedTargetPlayerId===P?"2px solid #48bb78":"2px solid #f56565"},children:dt.allowedTargetPlayerId===P?"":""}),w2&&a.jsx(S3,{onClose:()=>Mf(!1)}),I2&&a.jsx("div",{style:{position:"absolute",inset:0,zIndex:4e3,background:"rgba(0,0,0,0.8)",backdropFilter:"blur(5px)",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>Mc(!1),children:a.jsxs("div",{style:{background:"#2d3748",padding:40,borderRadius:16,display:"flex",flexDirection:"column",gap:20,minWidth:300,border:"1px solid rgba(255,255,255,0.1)"},onClick:m=>m.stopPropagation(),children:[a.jsx("h2",{style:{margin:0,textAlign:"center",borderBottom:"1px solid #4a5568",paddingBottom:10,color:"#fff"},children:""}),T2?a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:15},children:[a.jsx("h3",{style:{margin:0,color:"#cbd5e0"},children:""}),a.jsxs("label",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",color:"white"},children:["BGM",a.jsx("input",{type:"checkbox",checked:Ot.bgmEnabled,onChange:m=>Da(_=>({..._,bgmEnabled:m.target.checked})),style:{width:20,height:20}})]}),a.jsxs("label",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",color:"white"},children:["SE",a.jsx("input",{type:"checkbox",checked:Ot.seEnabled,onChange:m=>Da(_=>({..._,seEnabled:m.target.checked})),style:{width:20,height:20}})]}),a.jsxs("div",{children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",color:"#a0aec0",marginBottom:5},children:[a.jsx("span",{children:"BGM"}),a.jsxs("span",{children:[Math.round(Ot.bgm*100),"%"]})]}),a.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:Ot.bgm,onChange:m=>Da(_=>({..._,bgm:parseFloat(m.target.value)})),style:{width:"100%"}})]}),a.jsxs("div",{children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",color:"#a0aec0",marginBottom:5},children:[a.jsx("span",{children:"SE"}),a.jsxs("span",{children:[Math.round(Ot.se*100),"%"]})]}),a.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:Ot.se,onChange:m=>Da(_=>({..._,se:parseFloat(m.target.value)})),style:{width:"100%"}})]}),a.jsxs("div",{children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",color:"#a0aec0",marginBottom:5},children:[a.jsx("span",{children:""}),a.jsxs("span",{children:[Math.round(Ot.voice*100),"%"]})]}),a.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:Ot.voice,onChange:m=>Da(_=>({..._,voice:parseFloat(m.target.value)})),style:{width:"100%"}})]}),a.jsx("button",{onClick:()=>Am(!1),style:{padding:10,background:"#4a5568",border:"none",color:"white",borderRadius:8,cursor:"pointer",marginTop:10},children:""})]}):a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:()=>Mc(!1),style:{padding:15,background:"#4a5568",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.2rem"},children:""}),a.jsx("button",{onClick:()=>Am(!0),style:{padding:15,background:"#2b6cb0",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.2rem"},children:""}),a.jsx("button",{onClick:()=>Nc(!0),style:{padding:15,background:"#e53e3e",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.2rem"},children:""})]})]})}),C2&&a.jsx("div",{style:{position:"absolute",inset:0,zIndex:4100,background:"rgba(0,0,0,0.85)",backdropFilter:"blur(5px)",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>Nc(!1),children:a.jsxs("div",{style:{background:"#2d3748",padding:40,borderRadius:16,display:"flex",flexDirection:"column",gap:20,minWidth:320,border:"2px solid #e53e3e",boxShadow:"0 0 30px rgba(229, 62, 62, 0.3)"},onClick:m=>m.stopPropagation(),children:[a.jsx("h2",{style:{margin:0,textAlign:"center",color:"#fff",fontSize:"1.5rem"},children:""}),a.jsx("p",{style:{margin:0,textAlign:"center",color:"#a0aec0",fontSize:"1rem"},children:""}),a.jsxs("div",{style:{display:"flex",gap:15,marginTop:10},children:[a.jsx("button",{onClick:()=>Nc(!1),style:{flex:1,padding:15,background:"#4a5568",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.1rem"},children:""}),a.jsx("button",{onClick:k2,style:{flex:1,padding:15,background:"#e53e3e",border:"none",color:"white",borderRadius:8,cursor:"pointer",fontSize:"1.1rem"},children:""})]})]})}),a.jsxs("div",{className:Pm?"shake-target":"",style:{width:(N?280:340)*h,borderRight:"1px solid rgba(255,255,255,0.1)",background:"rgba(0,0,0,0.3)",padding:N?`${10*h}px ${12*h}px`:`${20*h}px ${20*h}px ${20*h}px`,display:"flex",flexDirection:"column",zIndex:20,flexShrink:0},onClick:m=>m.stopPropagation(),children:[a.jsx("div",{style:{marginBottom:(N?6:12)*h},children:a.jsxs("button",{onClick:()=>Mc(!0),style:{background:"transparent",border:"none",cursor:"pointer",padding:N?3:5},children:[a.jsx("div",{style:{width:(N?22:30)*h,height:(N?2:3)*h,background:"#cbd5e0",marginBottom:(N?4:6)*h}}),a.jsx("div",{style:{width:(N?22:30)*h,height:(N?2:3)*h,background:"#cbd5e0",marginBottom:(N?4:6)*h}}),a.jsx("div",{style:{width:(N?22:30)*h,height:(N?2:3)*h,background:"#cbd5e0"}})]})}),a.jsx("h3",{style:{color:"#a0aec0",borderBottom:"1px solid #4a5568",paddingBottom:(N?4:8)*h,marginTop:0,marginBottom:0,flexShrink:0,fontSize:N?`${.85*h}rem`:void 0},children:""}),Ve?a.jsx("div",{style:{marginTop:(N?4:10)*h,display:"flex",flexDirection:"column",flex:1,overflow:"hidden",minHeight:0},children:a.jsxs("div",{style:{flex:1,overflow:"auto",minHeight:0,display:"flex",flexDirection:"column"},children:[a.jsxs("div",{style:{flexShrink:0},children:[a.jsx("div",{style:{width:"100%",aspectRatio:"1/1",marginBottom:(N?6:12)*h,display:"flex",alignItems:"center",justifyContent:"center",...N?{maxHeight:"28vh"}:{}},children:a.jsx(yo,{card:Ve.card,style:{width:"100%",height:"100%",...N?{maxHeight:"28vh"}:{}},variant:"art-only"})}),a.jsx("div",{style:{fontSize:N?`${(Ve.card.name.length>12?.9:Ve.card.name.length>8?1:1.1)*h}rem`:`${Ve.card.name.length>12?1.1:Ve.card.name.length>8?1.2:1.4}rem`,fontWeight:"bold",marginBottom:(N?4:6)*h,textAlign:"center"},children:Ve.card.name}),a.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:(N?10:15)*h,marginBottom:(N?6:10)*h},children:[a.jsx("div",{style:{width:24*h,height:24*h,borderRadius:"50%",background:"radial-gradient(circle at 30% 30%, #68d391, #276749)",border:"1px solid #fff",display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${.85*h}rem`,fontWeight:900,color:"white",textShadow:"0 1px 2px rgba(0,0,0,0.5)",boxShadow:"0 2px 4px rgba(0,0,0,0.3)"},children:Ve.card.cost}),Ve.card.type==="FOLLOWER"&&a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:3*h},children:[a.jsx("svg",{width:18*h,height:18*h,viewBox:"0 0 24 24",fill:"none",children:a.jsx("polygon",{points:"12,2 22,22 2,22",fill:"#63b3ed",stroke:"none"})}),a.jsx("span",{style:{fontSize:`${.95*h}rem`,fontWeight:"bold",color:"#4299e1"},children:"currentAttack"in Ve.card?Ve.card.currentAttack:Ve.card.attack})]}),Ve.card.type==="FOLLOWER"&&a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:3*h},children:[a.jsx("svg",{width:18*h,height:18*h,viewBox:"0 0 24 24",fill:"#f56565",children:a.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})}),a.jsx("span",{style:{fontSize:`${.95*h}rem`,fontWeight:"bold",color:"#f56565"},children:"currentHealth"in Ve.card?Ve.card.currentHealth:Ve.card.health})]})]}),a.jsx("div",{style:{fontSize:`${((((ty=Ve.card.description)==null?void 0:ty.length)||0)>150?.7:(((ny=Ve.card.description)==null?void 0:ny.length)||0)>100?.8:.9)*h}rem`,color:"#cbd5e0",lineHeight:"1.4",whiteSpace:"pre-wrap",borderTop:"1px solid #4a5568",paddingTop:4*h},children:S2(Ve.card.description)})]}),Ve.card.flavorText&&a.jsx("div",{style:{marginTop:"auto",paddingTop:8*h,paddingBottom:4*h,flexShrink:0},children:a.jsx("div",{style:{fontSize:`${((((ry=Ve.card.flavorText)==null?void 0:ry.length)||0)>100?.6:.7)*h}rem`,color:"rgba(160, 174, 192, 0.6)",lineHeight:"1.3",fontStyle:"italic",whiteSpace:"pre-wrap",textAlign:"right"},children:Ve.card.flavorText})})]})}):a.jsx("div",{style:{marginTop:10*h,color:"#718096",fontStyle:"italic",flex:1,fontSize:`${.7*h}rem`},children:""})]}),a.jsxs("div",{ref:lo,className:Pm?"shake-target":"",style:{flex:1,height:"100%",position:"relative",background:"rgba(0,0,0,0.1)",overflow:"hidden"},children:[a.jsxs("div",{ref:co,onMouseEnter:()=>ar({type:"LEADER",playerId:w}),onMouseLeave:()=>ar(null),onClick:m=>{m.stopPropagation(),dt&&Vf("LEADER",-1,w)},style:{position:"absolute",top:-20*h,left:"50%",transform:"translateX(-50%)",width:vo*h,height:vo*h,borderRadius:"50%",zIndex:100,cursor:"default"},children:[a.jsx("div",{style:{position:"absolute",inset:0,borderRadius:"50%",background:_e.class==="AJA"?`url(${Tl(_e.class)}) center top/cover`:`url(${Tl(_e.class)}) center/cover`,border:nh?"4px solid #67e8f9":(yt==null?void 0:yt.type)==="LEADER"&&yt.playerId===w&&!dt?"4px solid #f56565":"4px solid #4a5568",boxShadow:nh?"0 0 20px rgba(103, 232, 249, 0.4), 0 0 40px rgba(103, 232, 249, 0.2)":"0 0 20px rgba(0,0,0,0.5)",transition:"border-color 0.3s, box-shadow 0.3s, filter 0.5s, opacity 0.5s",animation:Km?"leaderDamageCapPulse 2s ease-in-out infinite":"none",...g.winnerId===P&&(De||Ze)?{filter:De==="white-fade"?"brightness(2) saturate(0.3)":De==="explode"||De==="result-text"||De==="fade-out"||Ze?"brightness(3) saturate(0) blur(10px)":"none",opacity:De==="explode"||De==="result-text"||De==="fade-out"||Ze?0:1}:{}},children:Km&&a.jsx("div",{style:{position:"absolute",inset:0,borderRadius:"50%",background:"radial-gradient(circle, rgba(103, 232, 249, 0.5) 0%, rgba(103, 232, 249, 0.2) 70%, rgba(103, 232, 249, 0.1) 100%)",pointerEvents:"none",animation:"leaderDamageCapOverlay 2s ease-in-out infinite",zIndex:1}})}),a.jsx("div",{style:{position:"absolute",bottom:0,left:"50%",transform:`translateX(-50%) translateX(${-140*h}px)`,width:55*h,height:55*h,background:"radial-gradient(circle at 30% 30%, #feb2b2, #c53030)",borderRadius:"50%",border:`${Math.max(2,3*h)}px solid #fff`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${1.2*h}rem`,fontWeight:900,color:"white",textShadow:"0 2px 2px rgba(0,0,0,0.5)",zIndex:10,boxShadow:"0 4px 6px rgba(0,0,0,0.4)",opacity:ne?1:0,transition:"opacity 0.3s ease-in"},children:_e.hp}),a.jsx("div",{style:{position:"absolute",bottom:10*h,left:"50%",transform:`translateX(-50%) translateX(${-80*h}px)`,width:45*h,height:45*h,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,opacity:ne?Zf?1:.5:0,filter:Zf?"none":"grayscale(0.8)",transition:"opacity 0.3s ease-in"},children:a.jsx("div",{style:{display:"flex",gap:3*h},children:Array(2).fill(0).map((m,_)=>{const E=_<2-_e.evolutionsUsed;return a.jsx("div",{style:{width:12*h,height:12*h,borderRadius:"50%",background:E?"#ecc94b":"#2d3748",boxShadow:E&&Zf?"0 0 8px #ecc94b, 0 0 15px #ecc94b":"none",border:"2px solid rgba(0,0,0,0.5)"}},_)})})}),a.jsx("div",{style:{position:"absolute",bottom:10*h,left:"50%",transform:`translateX(-50%) translateX(${80*h}px)`,width:45*h,height:45*h,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,opacity:ne?eh?1:.5:0,filter:eh?"none":"grayscale(0.8)",transition:"opacity 0.3s ease-in"},children:a.jsx("div",{style:{display:"flex",gap:3*h},children:Array(2).fill(0).map((m,_)=>{const E=_<_e.sep;return a.jsx("div",{style:{width:12*h,height:12*h,borderRadius:"50%",background:E?"#9f7aea":"#2d3748",boxShadow:E&&eh?"0 0 8px #9f7aea, 0 0 15px #9f7aea":"none",border:"2px solid rgba(0,0,0,0.5)"}},_)})})}),a.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:vo*h*.75,height:vo*h*.75,pointerEvents:"none",zIndex:20,opacity:(yt==null?void 0:yt.type)==="LEADER"&&yt.playerId===w&&Z?1:0,transition:"opacity 0.1s ease-out"},children:[a.jsxs("svg",{width:"100%",height:"100%",viewBox:"0 0 100 100",children:[a.jsx("defs",{children:a.jsxs("filter",{id:"leaderCyanMarkerGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"4",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsxs("g",{style:{transformOrigin:"50% 50%",animation:"leaderMarkerSpin 2s linear infinite"},children:[a.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"rgba(100, 200, 255, 0.9)",strokeWidth:"3",strokeDasharray:"15 8",filter:"url(#leaderCyanMarkerGlow)"}),a.jsx("polygon",{points:"50,5 44,18 56,18",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"}),a.jsx("polygon",{points:"95,50 82,44 82,56",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"}),a.jsx("polygon",{points:"50,95 56,82 44,82",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"}),a.jsx("polygon",{points:"5,50 18,56 18,44",fill:"rgba(150, 220, 255, 1)",filter:"url(#leaderCyanMarkerGlow)"})]})]}),a.jsx("style",{children:`
                                @keyframes leaderMarkerSpin {
                                    0% { transform: rotate(0deg); }
                                    100% { transform: rotate(360deg); }
                                }
                            `})]})]}),a.jsxs("div",{style:{position:"absolute",top:20*h,left:20*h,width:60*h,height:85*h,zIndex:50},children:[[...Array(Math.min(5,Math.ceil(_e.deck.length/5)))].map((m,_)=>a.jsx("div",{style:{position:"absolute",inset:0,transform:`translate(${_*2*h}px, ${-_*2*h}px)`,borderRadius:6,border:"1px solid #718096",overflow:"hidden"},children:a.jsx("img",{src:Si((_e==null?void 0:_e.class)||"SENKA"),alt:"Deck",style:{width:"100%",height:"100%",objectFit:"cover"},onError:E=>{E.target.style.display="none",E.target.parentElement.style.background="linear-gradient(45deg, #2d3748, #1a202c)"}})},_)),a.jsx("div",{style:{position:"absolute",bottom:-20*h,width:"100%",textAlign:"center",fontWeight:"bold",color:"#a0aec0",fontSize:"0.9rem"},children:_e.deck.length})]}),a.jsxs("div",{style:{position:"absolute",top:20*h,right:20*h,display:"flex",alignItems:"center",gap:8,zIndex:50,pointerEvents:"none"},children:[a.jsxs("div",{style:{position:"relative",width:24,height:30},children:[a.jsx("div",{style:{position:"absolute",inset:0,background:"#4a192c",borderRadius:2,border:"1px solid #742a3a",transform:"rotate(-15deg) translate(-3px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#3d1525",borderRadius:2,border:"1px solid #742a3a",transform:"rotate(-5deg) translate(-1px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#2d1a20",borderRadius:2,border:"1px solid #8b3a4a",transform:"rotate(5deg)"}})]}),a.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(74, 25, 44, 0.8), rgba(45, 26, 32, 0.9))",padding:"3px 8px",borderRadius:5,color:"#f0b8c4",fontSize:"0.64rem",fontWeight:"bold",border:"1px solid rgba(116, 42, 58, 0.5)",boxShadow:"0 2px 4px rgba(0,0,0,0.4)"},children:[" ",_e.hand.length]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:5,marginLeft:6},children:[a.jsx("div",{style:{fontSize:"0.9rem",filter:"drop-shadow(0 0 2px rgba(128, 90, 213, 0.6)) grayscale(30%)"},children:""}),a.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(128, 90, 213, 0.7), rgba(76, 29, 149, 0.8))",padding:"3px 8px",borderRadius:5,color:"#c4b5fd",fontSize:"0.64rem",fontWeight:"bold",border:"1px solid rgba(167, 139, 250, 0.4)",boxShadow:"0 2px 4px rgba(0,0,0,0.4)",position:"relative"},children:[" ",_e.graveyard.length,Ta.filter(m=>m.playerId===w).map(m=>a.jsxs("div",{style:{position:"absolute",bottom:-25,left:"50%",transform:"translateX(-50%)",color:"#d946ef",fontSize:"1.2rem",fontWeight:"bold",textShadow:"0 0 8px #d946ef, 0 0 15px #a855f7, 0 0 25px #7c3aed",animation:"necromanceFloatOpponent 1.5s ease-out forwards",pointerEvents:"none",whiteSpace:"nowrap"},children:["-",m.amount]},m.key))]})]})]}),a.jsx("div",{style:{position:"absolute",top:`calc(50% - ${Cn*h/2}px - ${70*h}px)`,left:"0",width:"100%",height:Cn*h,pointerEvents:"none",zIndex:10},children:a.jsx("div",{style:{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center"},children:mn.map((m,_)=>{const E=mn.length,L=(_-(E-1)/2)*Ti*h;return a.jsxs("div",{ref:j=>xr.current[_]=j,onMouseEnter:()=>{Z&&ar({type:"FOLLOWER",index:_,playerId:w,instanceId:m==null?void 0:m.instanceId})},onMouseLeave:()=>{Z&&ar(null)},onClick:j=>{if(j.stopPropagation(),dt){if(!m)return;Vf("FOLLOWER",_,w,m==null?void 0:m.instanceId)}else m&&qr({card:m,owner:"OPPONENT",source:"BOARD"})},style:{position:"absolute",left:"50%",top:0,transform:`translateX(calc(-50% + ${L}px))`,transition:"transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1), left 0.4s ease",border:dt&&m&&dt.allowedTargetPlayerId===w?"2px solid #f56565":"none",boxShadow:dt&&m&&dt.allowedTargetPlayerId===w?"0 0 15px #f56565":"none",borderRadius:8,cursor:dt?"crosshair":"default",width:fn*h,height:Cn*h,pointerEvents:"auto",opacity:$t&&$t.sourcePlayerId===w&&$t.followerIndex===_?0:m!=null&&m.isDying?.8:1,transitionProperty:$t&&$t.sourcePlayerId===w&&$t.followerIndex===_?"none":"transform, left, opacity"},children:[a.jsx("div",{style:{width:"100%",height:"100%",perspective:"800px"},children:a.jsxs("div",{className:Tm===(m==null?void 0:m.instanceId)||Im===(m==null?void 0:m.instanceId)?"attack-rotating":"",style:{width:"100%",height:"100%",position:"relative",transformStyle:"preserve-3d"},children:[a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},children:m?a.jsx(yo,{card:m,turnCount:g.turnCount,className:m.isDying?"card-dying":"",scale:h,style:{width:fn*h,height:Cn*h,opacity:1,filter:m.isDying?"grayscale(0.5) brightness(2)":"none",boxShadow:(yt==null?void 0:yt.type)==="FOLLOWER"&&yt.index===_&&(Z==null?void 0:Z.sourceType)==="BOARD"?"0 0 20px #f56565":(Z==null?void 0:Z.sourceType)==="BOARD"?"0 0 20px #f6e05e":void 0},isOnBoard:!0,isSpecialSummoning:Sm.has(m.instanceId)}):a.jsx("div",{style:{width:fn*h,height:Cn*h,border:"1px dashed rgba(255,255,255,0.1)",borderRadius:8}})}),m&&a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",transform:"rotateY(180deg)",borderRadius:12,overflow:"hidden"},children:a.jsx("img",{src:Si((_e==null?void 0:_e.class)||"SENKA"),alt:"Card Sleeve",style:{width:"100%",height:"100%",objectFit:"cover"}})})]})}),m&&(Z==null?void 0:Z.sourceType)==="BOARD"&&a.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",width:"100%",height:"100%",transform:"translate(-50%, -50%)",pointerEvents:"none",zIndex:20,opacity:(yt==null?void 0:yt.type)==="FOLLOWER"&&yt.index===_&&yt.playerId===w?1:0,transition:"opacity 0.1s ease-out"},children:[a.jsxs("svg",{viewBox:"0 0 100 100",style:{width:"100%",height:"100%",filter:"drop-shadow(0 0 12px rgba(100, 200, 255, 0.9))"},children:[a.jsx("defs",{children:a.jsxs("filter",{id:"cyanMarkerGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"4",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsxs("g",{style:{transformOrigin:"50px 50px",animation:"attackMarkerSpin 1.5s linear infinite reverse"},children:[a.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:"rgba(100, 200, 255, 0.95)",strokeWidth:"4",strokeDasharray:"12 6",filter:"url(#cyanMarkerGlow)"}),a.jsx("polygon",{points:"50,10 45,20 55,20",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"}),a.jsx("polygon",{points:"90,50 80,45 80,55",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"}),a.jsx("polygon",{points:"50,90 55,80 45,80",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"}),a.jsx("polygon",{points:"10,50 20,55 20,45",fill:"rgba(150, 220, 255, 1)",filter:"url(#cyanMarkerGlow)"})]})]}),a.jsx("style",{children:`
                                                    @keyframes attackMarkerSpin {
                                                        0% { transform: rotate(0deg); }
                                                        100% { transform: rotate(360deg); }
                                                    }
                                                `})]})]},(m==null?void 0:m.instanceId)||`empty-opp-${_}`)})})}),a.jsx("div",{style:{position:"absolute",bottom:`calc(50% - ${Cn*h/2}px - ${70*h}px)`,left:"0",width:"100%",height:Cn*h,pointerEvents:"none",zIndex:10},children:a.jsx("div",{style:{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center"},children:In.map((m,_)=>{const E=In.length,L=(_-(E-1)/2)*Ti*h;return a.jsxs("div",{ref:j=>Mr.current[_]=j,onMouseDown:j=>jm(j,_,m==null?void 0:m.instanceId),onTouchStart:j=>jm(j,_,m==null?void 0:m.instanceId),onClick:j=>j.stopPropagation(),onMouseEnter:()=>{Z&&ar({type:"FOLLOWER",index:_,playerId:P,instanceId:m==null?void 0:m.instanceId})},onMouseLeave:()=>{Z&&ar(null)},style:{position:"absolute",left:"50%",top:0,"--offsetX":`calc(-50% + ${L}px)`,transform:`translateX(calc(-50% + ${L}px)) ${(Z==null?void 0:Z.sourceType)==="BOARD"&&Z.sourceInstanceId===(m==null?void 0:m.instanceId)?"translateY(-20px) scale(1.1)":""}`,transition:"transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1), left 0.4s ease",cursor:"pointer",pointerEvents:"auto",width:fn*h,height:Cn*h,border:dt&&m&&dt.allowedTargetPlayerId===P?"2px solid #48bb78":"none",boxShadow:dt&&m&&dt.allowedTargetPlayerId===P?"0 0 15px #48bb78":"none",borderRadius:8,zIndex:(Z==null?void 0:Z.sourceType)==="BOARD"&&Z.sourceInstanceId===(m==null?void 0:m.instanceId)?10:1,opacity:$t&&$t.sourcePlayerId===P&&$t.followerIndex===_?0:m!=null&&m.isDying?.8:1,transitionProperty:$t&&$t.sourcePlayerId===P&&$t.followerIndex===_?"none":"transform, left, opacity"},children:[a.jsx("div",{style:{width:"100%",height:"100%",perspective:"800px"},children:a.jsxs("div",{className:Tm===(m==null?void 0:m.instanceId)||Im===(m==null?void 0:m.instanceId)?"attack-rotating":"",style:{width:"100%",height:"100%",position:"relative",transformStyle:"preserve-3d"},children:[a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},children:m?a.jsx(yo,{card:m,turnCount:g.turnCount,className:m.isDying?"card-dying":"",scale:h,style:{width:fn*h,height:Cn*h,opacity:1,filter:m.isDying?"grayscale(0.5) brightness(2)":"none",boxShadow:(Z==null?void 0:Z.sourceType)==="BOARD"&&Z.sourceInstanceId===(m==null?void 0:m.instanceId)&&(yt==null?void 0:yt.type)==="FOLLOWER"?"0 0 30px #f56565":(Z==null?void 0:Z.sourceType)==="BOARD"&&Z.sourceInstanceId===(m==null?void 0:m.instanceId)?"0 20px 30px rgba(0,0,0,0.6)":void 0,pointerEvents:(Z==null?void 0:Z.sourceType)==="BOARD"&&Z.sourceInstanceId===(m==null?void 0:m.instanceId)?"none":"auto"},isSelected:(Ve==null?void 0:Ve.card)===m,isOnBoard:!0,isSpecialSummoning:Sm.has(m.instanceId),isMyTurn:g.activePlayerId===P}):a.jsx("div",{style:{width:fn*h,height:Cn*h,border:"1px dashed rgba(255,255,255,0.2)",borderRadius:8}})}),m&&a.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",transform:"rotateY(180deg)",borderRadius:12,overflow:"hidden"},children:a.jsx("img",{src:Si((q==null?void 0:q.class)||"SENKA"),alt:"Card Sleeve",style:{width:"100%",height:"100%",objectFit:"cover"}})})]})}),m&&(Z==null?void 0:Z.sourceType)==="EVOLVE"&&!m.hasEvolved&&a.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",width:"120%",height:"120%",transform:"translate(-50%, -50%)",pointerEvents:"none",border:Z.useSep?"2px dashed rgba(183, 148, 244, 0.9)":"2px dashed rgba(255, 230, 100, 0.9)",borderRadius:"50%",boxShadow:Z.useSep?"0 0 15px rgba(159, 122, 234, 0.8)":"0 0 15px rgba(255, 200, 50, 0.8)",animation:"evolveMarkerSpin 1.5s linear infinite",zIndex:20,opacity:(yt==null?void 0:yt.type)==="FOLLOWER"&&yt.index===_&&yt.playerId===P?1:0,transition:"opacity 0.1s ease-out"},children:[a.jsxs("svg",{viewBox:"0 0 100 100",style:{width:"100%",height:"100%",filter:"drop-shadow(0 0 8px currentColor)"},children:[a.jsx("defs",{children:a.jsxs("filter",{id:Z.useSep?"purpleMarkerGlow":"yellowMarkerGlow",x:"-30%",y:"-30%",width:"160%",height:"160%",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"3",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:Z.useSep?"#b794f4":"#f6e05e",strokeWidth:"4",strokeDasharray:"15 8",filter:`url(#${Z.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`,opacity:"0.95"}),a.jsx("polygon",{points:"50,5 45,15 55,15",fill:Z.useSep?"#b794f4":"#f6e05e",filter:`url(#${Z.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`}),a.jsx("polygon",{points:"95,50 85,45 85,55",fill:Z.useSep?"#b794f4":"#f6e05e",filter:`url(#${Z.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`}),a.jsx("polygon",{points:"50,95 55,85 45,85",fill:Z.useSep?"#b794f4":"#f6e05e",filter:`url(#${Z.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`}),a.jsx("polygon",{points:"5,50 15,55 15,45",fill:Z.useSep?"#b794f4":"#f6e05e",filter:`url(#${Z.useSep?"purpleMarkerGlow":"yellowMarkerGlow"})`})]}),a.jsx("style",{children:`
                                                @keyframes evolveMarkerSpin {
                                                    0% { transform: translate(-50%, -50%) rotate(0deg); }
                                                    100% { transform: translate(-50%, -50%) rotate(360deg); }
                                                }
                                            `})]})]},(m==null?void 0:m.instanceId)||`empty-plr-${_}`)})})}),a.jsxs("div",{style:{position:"absolute",right:30*h,top:"50%",transform:"translateY(-50%)",display:"flex",flexDirection:"column",alignItems:"center",gap:30*h,zIndex:50},children:[a.jsx("div",{style:{textAlign:"center"},children:a.jsxs("div",{style:{fontSize:`${1.2*h}rem`,fontWeight:700,color:"#a0aec0",fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif'},children:["Turn ",g.turnCount]})}),a.jsxs("div",{style:{textAlign:"center"},children:[a.jsxs("div",{style:{fontSize:`${1.8*h}rem`,fontWeight:900,color:"#f6e05e",fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif'},children:[_e.pp,"/",_e.maxPp]}),a.jsx("div",{style:{display:"flex",gap:4*h,justifyContent:"center"},children:Array(Math.min(10,_e.maxPp)).fill(0).map((m,_)=>a.jsx("div",{style:{width:10*h,height:10*h,borderRadius:"50%",background:_<_e.pp?"#f6e05e":"#2d3748"}},_))})]}),a.jsxs("div",{style:{position:"relative",width:160*h,height:160*h},children:[a.jsx(a3,{isMyTurn:g.activePlayerId===P,turnCount:g.turnCount,activePlayerId:g.activePlayerId,onTimeUp:N2,timerEnabled:p,isGameOver:!!g.winnerId,isPaused:H,scale:h,buttonSize:160,timerDuration:60}),a.jsxs("button",{ref:bm,disabled:g.activePlayerId!==P||po,onMouseDown:m=>{m.stopPropagation(),g.activePlayerId===P&&!po&&Kf(!0)},onMouseUp:m=>{var _;if(m.stopPropagation(),Hc&&g.activePlayerId===P&&!po){Kf(!1),St("sisiodosi.mp3",.6);const E=(_=m.target.closest("button"))==null?void 0:_.getBoundingClientRect();E&&zm(E.left+E.width/2,E.top+E.height/2),Jf()}},onMouseLeave:()=>{Kf(!1)},style:{width:160*h,height:160*h,borderRadius:"50%",border:"4px solid rgba(255,255,255,0.2)",background:po?"linear-gradient(135deg, #805ad5, #6b46c1)":Hc?"linear-gradient(135deg, #5a9bd5, #4a7fb0)":g.activePlayerId===P?"linear-gradient(135deg, #3182ce, #2b6cb0)":"#2d3748",color:"white",fontWeight:900,fontSize:`${2*h}rem`,fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif',boxShadow:g.activePlayerId===P?Hc?"0 0 20px rgba(66, 153, 225, 0.5)":"0 0 40px rgba(66, 153, 225, 0.8)":"none",opacity:Hc?.8:1,cursor:g.activePlayerId===P&&!po?"pointer":"default",transition:"all 0.1s",position:"relative",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",lineHeight:1.2},children:[a.jsx("img",{src:ot("/assets/tenfubu_mark.png"),alt:"",style:{position:"absolute",width:"80%",height:"80%",objectFit:"contain",opacity:.25,pointerEvents:"none"}}),po?a.jsx("span",{style:{position:"relative",zIndex:1,whiteSpace:"nowrap"},children:"..."}):a.jsxs(a.Fragment,{children:[a.jsx("span",{style:{position:"relative",zIndex:1,whiteSpace:"nowrap"},children:""}),a.jsx("span",{style:{position:"relative",zIndex:1,whiteSpace:"nowrap"},children:""})]})]})]}),a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("div",{style:{fontSize:`${2.4*h}rem`,fontWeight:900,color:"#f6e05e",fontFamily:'"", "Yu Mincho", " ProN", "Hiragino Mincho ProN", serif'},children:q.extraPpActive?a.jsxs("span",{children:[Math.max(0,q.pp-1),"/",q.maxPp," ",a.jsx("span",{style:{color:"#ed8936"},children:"+1"})]}):a.jsxs("span",{children:[q.pp,"/",q.maxPp]})}),a.jsx("div",{style:{display:"flex",gap:3*h,justifyContent:"center"},children:Array(10).fill(0).map((m,_)=>{const E=_<q.pp,L=_<q.maxPp;let j;return E?j="#f6e05e":L?j="#744210":j="#2d3748",a.jsx("div",{style:{width:11*h,height:11*h,borderRadius:"50%",background:j}},_)})})]}),(()=>{const m=P!==g.firstPlayerId,_=g.activePlayerId===P,E=g.turnCount,L=E<=5&&!q.extraPpUsedEarly,j=E>=6&&!q.extraPpUsedLate,V=m&&_&&!q.extraPpActive&&(L||j),ee=q.extraPpActive;if(!m)return null;const B=E<=5&&q.extraPpUsedEarly||E>=6&&q.extraPpUsedLate,z=!V&&!ee;return a.jsxs("button",{disabled:z,onClick:K=>{K.stopPropagation(),z||Is({type:"TOGGLE_EXTRA_PP",playerId:P})},style:{width:160*h,height:45*h,borderRadius:12*h,border:ee?"3px solid #ed8936":"3px solid rgba(255,255,255,0.2)",background:ee?"linear-gradient(135deg, #ed8936, #dd6b20)":V?"linear-gradient(135deg, #744210, #5a3510)":"#2d3748",color:ee?"white":V?"#f6e05e":"#718096",fontWeight:700,fontSize:"1rem",boxShadow:ee?"0 0 20px rgba(237, 137, 54, 0.6)":"none",cursor:z?"default":"pointer",transition:"all 0.3s",display:"flex",alignItems:"center",justifyContent:"center",gap:6*h,opacity:B&&!ee?.5:1},children:[a.jsx("span",{children:"PP"}),a.jsx("span",{style:{fontSize:"1.3rem"},children:"+1"}),ee&&a.jsx("span",{style:{fontSize:"0.8rem"},children:"ON"}),B&&!ee&&a.jsx("span",{style:{fontSize:"0.7rem",marginLeft:2},children:""})]})})()]}),N?a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:m=>{m.stopPropagation(),Mf(!0)},style:{position:"absolute",left:15*h,top:120*h,width:64*h,height:64*h,minWidth:64*h,maxWidth:64*h,minHeight:64*h,maxHeight:64*h,borderRadius:"50%",background:"linear-gradient(135deg, #4a5568 0%, #2d3748 100%)",border:"3px solid #63b3ed",color:"#63b3ed",fontSize:`${1.8*h}rem`,fontWeight:"bold",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,padding:0,zIndex:16,boxShadow:"0 2px 8px rgba(0,0,0,0.4)",transition:"all 0.2s ease"},onMouseEnter:m=>{m.currentTarget.style.transform="scale(1.1)",m.currentTarget.style.boxShadow="0 0 15px rgba(99, 179, 237, 0.5)"},onMouseLeave:m=>{m.currentTarget.style.transform="scale(1)",m.currentTarget.style.boxShadow="0 2px 8px rgba(0,0,0,0.4)"},children:"?"}),a.jsx(T3,{logs:g.logs||[],onCardNameClick:Of,scale:h,isMobile:N})]}):a.jsxs("div",{style:{position:"absolute",left:15,top:"50%",transform:"translateY(-50%)",display:"flex",flexDirection:"column",alignItems:"flex-start",gap:8,zIndex:16,pointerEvents:"none"},children:[a.jsx("button",{onClick:m=>{m.stopPropagation(),Mf(!0)},style:{width:36,height:36,borderRadius:"50%",background:"linear-gradient(135deg, #4a5568 0%, #2d3748 100%)",border:"2px solid #63b3ed",color:"#63b3ed",fontSize:"1.2rem",fontWeight:"bold",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",padding:0,boxShadow:"0 4px 12px rgba(0,0,0,0.4)",transition:"all 0.2s ease",pointerEvents:"auto"},onMouseEnter:m=>{m.currentTarget.style.transform="scale(1.1)",m.currentTarget.style.boxShadow="0 0 15px rgba(99, 179, 237, 0.5)"},onMouseLeave:m=>{m.currentTarget.style.transform="scale(1)",m.currentTarget.style.boxShadow="0 4px 12px rgba(0,0,0,0.4)"},children:"?"}),a.jsxs("div",{style:{width:Math.max(180,220*h),height:Math.max(200,280*h),overflowY:"auto",background:"linear-gradient(to right, rgba(0,0,0,0.8), rgba(0,0,0,0.0))",color:"#fff",fontSize:`${Math.max(.65,.75*h)}rem`,padding:`${8*h}px ${8*h}px ${8*h}px ${12*h}px`,borderLeft:"3px solid #63b3ed",pointerEvents:"auto",scrollbarWidth:"thin"},onMouseDown:m=>m.stopPropagation(),onClick:m=>m.stopPropagation(),ref:m=>{m&&(m.scrollTop=m.scrollHeight)},children:[a.jsx("div",{style:{fontWeight:"bold",marginBottom:4*h,color:"#a0aec0",borderBottom:"1px solid rgba(255,255,255,0.1)",paddingBottom:2,fontSize:`${Math.max(.55,.65*h)}rem`,textTransform:"uppercase",letterSpacing:1},children:"BATTLE LOG"}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:3*h},children:(g.logs||[]).map((m,_)=>a.jsx("div",{style:{opacity:.9,lineHeight:"1.4",textShadow:"0 1px 2px black",animation:"fadeIn 0.3s ease-out"},children:m},_))})]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,pointerEvents:"none"},children:[a.jsxs("div",{style:{position:"relative",width:32,height:40},children:[a.jsx("div",{style:{position:"absolute",inset:0,background:"#4a5568",borderRadius:4,border:"1px solid #718096",transform:"rotate(-15deg) translate(-5px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#2d3748",borderRadius:4,border:"1px solid #718096",transform:"rotate(-5deg) translate(-2px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#1a202c",borderRadius:4,border:"1px solid #cbd5e0",transform:"rotate(5deg)"}})]}),a.jsxs("div",{style:{background:"rgba(0,0,0,0.7)",padding:"4px 12px",borderRadius:8,color:"#e2e8f0",fontSize:"0.9rem",fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5)"},children:[" ",q.hand.length]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,marginLeft:6},children:[a.jsx("div",{style:{fontSize:"1.2rem",filter:"drop-shadow(0 0 3px rgba(128, 90, 213, 0.8))"},children:""}),a.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(128, 90, 213, 0.8), rgba(76, 29, 149, 0.9))",padding:"4px 12px",borderRadius:8,color:"#e2e8f0",fontSize:"0.9rem",fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5), inset 0 1px rgba(255,255,255,0.1)",border:"1px solid rgba(167, 139, 250, 0.5)",position:"relative"},children:[" ",q.graveyard.length,Ta.filter(m=>m.playerId===P).map(m=>a.jsxs("div",{style:{position:"absolute",top:-30,left:"50%",transform:"translateX(-50%)",color:"#d946ef",fontSize:"1.5rem",fontWeight:"bold",textShadow:"0 0 10px #d946ef, 0 0 20px #a855f7, 0 0 30px #7c3aed",animation:"necromanceFloat 1.5s ease-out forwards",pointerEvents:"none",whiteSpace:"nowrap"},children:["-",m.amount]},m.key))]})]})]}),Ve&&Ve.owner==="PLAYER"&&Ve.source==="HAND"&&Zr&&(()=>{const E=((N?Math.max(140,180*h):Math.max(180,220*h))-6)/2,L=q.pp>=Ve.card.cost;return a.jsxs("button",{disabled:!L,onClick:j=>{j.stopPropagation(),Bm()},className:L?"play-button-active":"",style:{width:E,background:L?"linear-gradient(to bottom, #48bb78, #38a169)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:"8px 4px",borderRadius:12,fontSize:"0.85rem",fontWeight:"bold",cursor:L?"pointer":"not-allowed",boxShadow:L?"0 0 15px rgba(72, 187, 120, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease",pointerEvents:"auto"},onMouseDown:j=>j.stopPropagation(),children:["",a.jsxs("div",{style:{fontSize:"0.6rem",opacity:.8,marginTop:2},children:["pp ",Ve.card.cost]})]})})(),Ve&&Ve.owner==="PLAYER"&&Ve.source==="BOARD"&&(()=>{const m=N?Math.max(140,180*h):Math.max(180,220*h),_=6,E=(m-_)/2,L=Ve.card,j=L==null?void 0:L.hasEvolved,V=!j&&Cs,ee=!j&&ks,B=L==null?void 0:L.instanceId,z=q.board.findIndex(te=>te&&te.instanceId===B),K=q.board.slice(0,z+1).filter(te=>te).length-1,fe=te=>{if(z<0)return;const ye=q.board[z];if(!ye)return;const Ee=te?["SUPER_EVOLVE","EVOLVE"]:["EVOLVE"],Se=(()=>{var ie,oe;const le=(oe=(ie=ye.triggerAbilities)==null?void 0:ie.EVOLVE)==null?void 0:oe.targetType;if(le)return le;for(const Y of ye.triggers||[])if(Ee.includes(Y.trigger)){for(const ae of Y.effects)if(ae.targetType&&["SELECT_FOLLOWER","SELECT_ALLY_FOLLOWER","SELECT_OTHER_ALLY_FOLLOWER"].includes(ae.targetType))return ae.targetType}return null})(),Qe=!!Se,tt=Se==="SELECT_ALLY_FOLLOWER"||Se==="SELECT_OTHER_ALLY_FOLLOWER",We=Se==="SELECT_OTHER_ALLY_FOLLOWER",Ge=tt?P:w,X=g.players[Ge].board.some(le=>{var ie,oe;return!(!le||tt&&We&&le.instanceId===B||!tt&&((ie=le.passiveAbilities)!=null&&ie.includes("STEALTH")||(oe=le.passiveAbilities)!=null&&oe.includes("AURA")))});if(Qe&&X){Ss({type:"EVOLVE",sourceIndex:z,sourceInstanceId:B,sourceVisualIndex:K>=0?K:z,useSep:te,allowedTargetPlayerId:Ge,excludeInstanceId:We?B:void 0});return}Bc(K>=0?K:z,te,void 0,B)};return a.jsxs("div",{style:{display:"flex",gap:_,pointerEvents:"auto"},onMouseDown:te=>te.stopPropagation(),children:[a.jsxs("button",{disabled:!V,onClick:te=>{te.stopPropagation(),fe(!1)},style:{width:E,background:V?"linear-gradient(to bottom, #faf089, #d69e2e)":"#718096",color:V?"#1a202c":"white",border:"2px solid rgba(255,255,255,0.2)",padding:"8px 4px",borderRadius:12,fontSize:"0.85rem",fontWeight:"bold",cursor:V?"pointer":"not-allowed",boxShadow:V?"0 0 15px rgba(250, 240, 137, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:V?"0 1px 1px rgba(255,255,255,0.3)":"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",a.jsx("div",{style:{fontSize:"0.6rem",opacity:.8,marginTop:2},children:"EP"})]}),a.jsxs("button",{disabled:!ee,onClick:te=>{te.stopPropagation(),fe(!0)},style:{width:E,background:ee?"linear-gradient(to bottom, #b794f4, #805ad5)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:"8px 4px",borderRadius:12,fontSize:"0.85rem",fontWeight:"bold",cursor:ee?"pointer":"not-allowed",boxShadow:ee?"0 0 15px rgba(183, 148, 244, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",a.jsx("div",{style:{fontSize:"0.6rem",opacity:.8,marginTop:2},children:"SEP"})]})]})})(),!(Ve&&Ve.owner==="PLAYER"&&(Ve.source==="HAND"||Ve.source==="BOARD"))&&(()=>{const m=N?Math.max(140,180*h):Math.max(180,220*h);return a.jsx("div",{style:{width:m,height:52,visibility:"hidden",pointerEvents:"none"}})})()]}),(Me==="TOSSING"||Me==="RESULT")&&a.jsxs("div",{style:{position:"absolute",inset:0,zIndex:4e3,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.85)",pointerEvents:"none"},children:[a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("div",{style:{width:120*h,height:120*h,margin:`0 auto ${30*h}px`,borderRadius:"50%",background:Me==="RESULT"?Pt==="FIRST"?"linear-gradient(135deg, #ffd700, #ff8c00)":"linear-gradient(135deg, #c0c0c0, #808080)":"linear-gradient(135deg, #ffd700, #ff8c00)",boxShadow:Me==="RESULT"?`0 0 ${40*h}px ${Pt==="FIRST"?"#ffd700":"#c0c0c0"}, 0 0 ${80*h}px ${Pt==="FIRST"?"rgba(255,215,0,0.5)":"rgba(192,192,192,0.5)"}`:`0 0 ${30*h}px #ffd700`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"3rem",fontWeight:900,color:"#1a202c",textShadow:"0 2px 2px rgba(0,0,0,0.5)",animation:Me==="TOSSING"?"coinFlip 0.3s ease-in-out infinite":"coinLand 0.5s ease-out",border:"4px solid rgba(255,255,255,0.3)"},children:Me==="RESULT"?Pt==="FIRST"?"":"":"?"}),a.jsxs("div",{style:{fontSize:Me==="RESULT"?"2.5rem":"1.8rem",fontWeight:900,color:Pt==="FIRST"?"#ffd700":Pt==="SECOND"?"#c0c0c0":"white",textShadow:"0 0 20px currentColor, 0 2px 4px black",animation:Me==="RESULT"?"textPop 0.5s ease-out":"none"},children:[Me==="TOSSING"&&"...",Me==="RESULT"&&(Pt==="FIRST"?"":"")]}),Me==="RESULT"&&a.jsx("div",{style:{fontSize:"1rem",color:"#a0aec0",marginTop:10*h,animation:"fadeIn 0.5s ease-out 0.3s both"},children:Pt==="FIRST"?"":""})]}),a.jsx("style",{children:`
                            @keyframes coinFlip {
                                0%, 100% { transform: rotateY(0deg) scale(1); }
                                50% { transform: rotateY(180deg) scale(1.1); }
                            }
                            @keyframes coinLand {
                                0% { transform: rotateY(720deg) scale(0.5); }
                                70% { transform: rotateY(0deg) scale(1.2); }
                                100% { transform: rotateY(0deg) scale(1); }
                            }
                            @keyframes textPop {
                                0% { transform: scale(0.5); opacity: 0; }
                                70% { transform: scale(1.2); }
                                100% { transform: scale(1); opacity: 1; }
                            }
                        `})]}),vi&&a.jsxs("div",{style:{position:"absolute",inset:0,zIndex:3e3,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.7)",pointerEvents:"none",animation:"fadeIn 0.2s ease-out"},children:[a.jsx("div",{style:{fontSize:`${3.5*h}rem`,fontWeight:900,fontFamily:"Tamanegi, sans-serif",background:"linear-gradient(135deg, #ffd700, #ff6b6b, #ffd700)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",textShadow:"none",filter:`drop-shadow(0 0 ${15*h}px rgba(255,215,0,0.8)) drop-shadow(0 0 ${30*h}px rgba(255,107,107,0.5))`,animation:"gameStartPop 0.8s ease-out",letterSpacing:"0.2em"},children:" "}),a.jsx("style",{children:`
                            @keyframes gameStartPop {
                                0% { transform: scale(0.3) rotate(-10deg); opacity: 0; }
                                50% { transform: scale(1.2) rotate(5deg); opacity: 1; }
                                70% { transform: scale(0.95) rotate(-2deg); }
                                100% { transform: scale(1) rotate(0deg); opacity: 1; }
                            }
                        `})]}),a.jsxs("div",{ref:Ei,style:{position:"absolute",bottom:-20*h,left:"50%",transform:"translateX(-50%)",width:vo*h,height:vo*h,borderRadius:"50%",zIndex:200},children:[a.jsxs("div",{onMouseDown:O2,style:{width:"100%",height:"100%",borderRadius:"50%",overflow:"hidden",border:th?"4px solid #67e8f9":"4px solid #3182ce",boxShadow:th?"0 0 20px rgba(103, 232, 249, 0.4), 0 0 40px rgba(103, 232, 249, 0.2)":"0 0 20px rgba(49, 130, 206, 0.4)",background:"#1a202c",cursor:"grab",transition:"border-color 0.3s, box-shadow 0.3s, filter 0.5s, opacity 0.5s",animation:Ym?"leaderDamageCapPulse 2s ease-in-out infinite":"none",position:"relative",...g.winnerId&&g.winnerId!==P&&(De||Ze)?{filter:De==="white-fade"?"brightness(2) saturate(0.3)":De==="explode"||De==="result-text"||De==="fade-out"||Ze?"brightness(3) saturate(0) blur(10px)":"none",opacity:De==="explode"||De==="result-text"||De==="fade-out"||Ze?0:1}:{}},children:[a.jsx("img",{src:Tl(q.class),style:q.class==="AJA"?{width:"100%",height:"100%",objectFit:"cover",objectPosition:"center top",pointerEvents:"none"}:{width:"100%",height:"100%",objectFit:"cover",pointerEvents:"none"}}),Ym&&a.jsx("div",{style:{position:"absolute",inset:0,borderRadius:"50%",background:"radial-gradient(circle, rgba(103, 232, 249, 0.5) 0%, rgba(103, 232, 249, 0.2) 70%, rgba(103, 232, 249, 0.1) 100%)",pointerEvents:"none",animation:"leaderDamageCapOverlay 2s ease-in-out infinite",zIndex:1}})]}),a.jsx("div",{style:{position:"absolute",top:0,left:"50%",transform:`translateX(-50%) translateX(${-140*h}px)`,width:55*h,height:55*h,background:"radial-gradient(circle at 30% 30%, #feb2b2, #c53030)",borderRadius:"50%",border:`${Math.max(2,3*h)}px solid #fff`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${1.2*h}rem`,fontWeight:900,color:"white",textShadow:"0 2px 2px rgba(0,0,0,0.5)",boxShadow:"0 4px 6px rgba(0,0,0,0.4)",zIndex:10,opacity:ne?1:0,transition:"opacity 0.3s ease-in"},children:q.hp}),a.jsx("div",{onMouseDown:m=>zc(m,!1),onTouchStart:m=>zc(m,!1),style:{position:"absolute",top:10*h,left:"50%",transform:`translateX(-50%) translateX(${-80*h}px)`,width:45*h,height:45*h,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:Cs?"rgba(255,235,100,0.2)":"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",cursor:Cs?"grab":"default",zIndex:10,opacity:ne?Wc?1:.5:0,filter:Wc?"none":"grayscale(0.8)",transition:"opacity 0.3s ease-in, filter 0.3s, background 0.3s",boxShadow:Cs?"0 0 12px #ffd700, 0 0 25px rgba(255,215,0,0.5)":"none",animation:Cs?"epPulse 1.5s ease-in-out infinite":"none"},children:a.jsx("div",{style:{display:"flex",gap:3*h},children:Array(2).fill(0).map((m,_)=>{const E=_<Hm;let L="none";return E&&Wc&&(L=Cs?"0 0 10px #fff59d, 0 0 20px #ffd700, 0 0 30px #ecc94b":"0 0 8px #ecc94b, 0 0 15px #ecc94b"),a.jsx("div",{style:{width:12*h,height:12*h,borderRadius:"50%",background:E?Cs?"#fff59d":"#ecc94b":"#2d3748",boxShadow:L,border:"2px solid rgba(0,0,0,0.5)",transition:"box-shadow 0.3s, background 0.3s"}},_)})})}),a.jsx("div",{onMouseDown:m=>zc(m,!0),onTouchStart:m=>zc(m,!0),style:{position:"absolute",top:10*h,left:"50%",transform:`translateX(-50%) translateX(${80*h}px)`,width:45*h,height:45*h,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.2)",background:ks?"rgba(200,160,255,0.2)":"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,cursor:ks?"grab":"default",opacity:ne?Gc?1:.5:0,filter:Gc?"none":"grayscale(0.8)",transition:"opacity 0.3s ease-in, filter 0.3s, background 0.3s",boxShadow:ks?"0 0 12px #b794f4, 0 0 25px rgba(159,122,234,0.5)":"none",animation:ks?"sepPulse 1.5s ease-in-out infinite":"none"},children:a.jsx("div",{style:{display:"flex",gap:3*h},children:Array(2).fill(0).map((m,_)=>{const E=_<q.sep;let L="none";return E&&Gc&&(L=ks?"0 0 10px #d6bcfa, 0 0 20px #b794f4, 0 0 30px #9f7aea":"0 0 8px #9f7aea, 0 0 15px #9f7aea"),a.jsx("div",{style:{width:12*h,height:12*h,borderRadius:"50%",background:E?ks?"#d6bcfa":"#9f7aea":"#2d3748",boxShadow:L,border:"2px solid rgba(0,0,0,0.5)",transition:"box-shadow 0.3s, background 0.3s"}},_)})})})]}),a.jsxs("div",{style:{position:"absolute",bottom:10*h,right:15*h,width:60*h,height:85*h,zIndex:50},children:[[...Array(Math.min(5,Math.ceil(q.deck.length/5)))].map((m,_)=>a.jsx("div",{style:{position:"absolute",inset:0,transform:`translate(${_*2*h}px, ${-_*2*h}px)`,borderRadius:6,border:"1px solid #718096",boxShadow:"1px 1px 3px rgba(0,0,0,0.5)",overflow:"hidden"},children:a.jsx("img",{src:Si((q==null?void 0:q.class)||"SENKA"),alt:"Deck",style:{width:"100%",height:"100%",objectFit:"cover"},onError:E=>{E.target.style.display="none",E.target.parentElement.style.background="linear-gradient(45deg, #2d3748, #1a202c)"}})},_)),a.jsx("div",{style:{position:"absolute",top:-20*h,width:"100%",textAlign:"center",color:"#a0aec0",fontSize:"0.9rem",fontWeight:"bold",textShadow:"0 1px 2px black"},children:q.deck.length})]}),a.jsx("div",{style:{position:"absolute",bottom:0,left:0,width:"100%",height:200*h,display:"flex",justifyContent:"center",alignItems:"flex-end",pointerEvents:"none",zIndex:500},children:q.hand.map((m,_)=>{if(nt!==null&&nt.sourceIndex===_)return null;const L=q.hand.length;let j=0,V=0,ee=0;if(Zr){const z=100*h,K=window.innerWidth-40*h,fe=(L-1)*z+fn*h;let te=z;fe>K&&(te=(K-fn*h)/Math.max(1,L-1)),j=(_-(L-1)/2)*te,V=Ie===_?-8*h:0,ee=0}else{const z=45*h,K=160*h,fe=fn*h/2,te=window.innerWidth/2-K-fe,ye=window.innerWidth-340*h-K,Ee=(L-1)*z+fn*h;let et=z;Ee>ye&&(et=(ye-fn*h)/Math.max(1,L-1)),j=te-(L-1-_)*et,V=0,ee=(_-(L-1)/2)*3}const B=q.pp>=m.cost&&g.activePlayerId===P;return a.jsx("div",{onMouseDown:z=>{Nm(z,_),Zr&&Je(_===Ie?null:_)},onTouchStart:z=>{Nm(z,_),Zr&&Je(_===Ie?null:_)},style:{position:"absolute",left:"50%",bottom:5*h,transform:`translateX(calc(-50% + ${j}px)) translateY(${V}px) rotate(${ee}deg) ${(Z==null?void 0:Z.sourceType)==="HAND"&&Z.sourceIndex===_?"scale(1.05) translateY(-10px)":Zr?"translateY(-3px)":""}`,transition:E2===_?"all 0.3s ease-in":(Z==null?void 0:Z.sourceType)==="HAND"&&Z.sourceIndex===_?"none":"all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1)",zIndex:(Z==null?void 0:Z.sourceType)==="HAND"&&Z.sourceIndex===_?1e3:_+100,width:(N?80:fn)*h,height:(N?115:Cn)*h,pointerEvents:"auto",cursor:B?"grab":"not-allowed"},onClick:z=>z.stopPropagation(),children:a.jsx(yo,{card:m,turnCount:g.turnCount,isMyTurn:g.activePlayerId===P,isPlayable:B,scale:h,variant:N?"mobile-hand":"normal",style:{width:N?80*h:fn*h,height:N?115*h:Cn*h,boxShadow:(Z==null?void 0:Z.sourceType)==="HAND"&&Z.sourceIndex===_?"0 0 40px rgba(49, 130, 206, 0.8)":B?"0 0 15px rgba(40, 180, 100, 0.6)":"none"}})},m.instanceId)})}),N&&a.jsxs("div",{style:{position:"absolute",bottom:200*h,left:15*h,display:"flex",alignItems:"center",gap:10*h,zIndex:601,pointerEvents:"none"},children:[a.jsxs("div",{style:{position:"relative",width:50*h,height:62*h},children:[a.jsx("div",{style:{position:"absolute",inset:0,background:"#4a5568",borderRadius:6*h,border:"1px solid #718096",transform:"rotate(-15deg) translate(-5px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#2d3748",borderRadius:6*h,border:"1px solid #718096",transform:"rotate(-5deg) translate(-2px, 0)"}}),a.jsx("div",{style:{position:"absolute",inset:0,background:"#1a202c",borderRadius:6*h,border:"1px solid #cbd5e0",transform:"rotate(5deg)"}})]}),a.jsxs("div",{style:{background:"rgba(0,0,0,0.7)",padding:`${6*h}px ${16*h}px`,borderRadius:10*h,color:"#e2e8f0",fontSize:`${1.32*h}rem`,fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5)"},children:[" ",q.hand.length]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6*h,marginLeft:10*h},children:[a.jsx("div",{style:{fontSize:`${1.87*h}rem`,filter:"drop-shadow(0 0 3px rgba(128, 90, 213, 0.8))"},children:""}),a.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(128, 90, 213, 0.8), rgba(76, 29, 149, 0.9))",padding:`${6*h}px ${16*h}px`,borderRadius:10*h,color:"#e2e8f0",fontSize:`${1.32*h}rem`,fontWeight:"bold",boxShadow:"0 2px 5px rgba(0,0,0,0.5), inset 0 1px rgba(255,255,255,0.1)",border:"1px solid rgba(167, 139, 250, 0.5)",position:"relative"},children:[" ",q.graveyard.length,Ta.filter(m=>m.playerId===P).map(m=>a.jsxs("div",{style:{position:"absolute",top:-30,left:"50%",transform:"translateX(-50%)",color:"#d946ef",fontSize:"1.5rem",fontWeight:"bold",textShadow:"0 0 10px #d946ef, 0 0 20px #a855f7, 0 0 30px #7c3aed",animation:"necromanceFloat 1.5s ease-out forwards",pointerEvents:"none",whiteSpace:"nowrap"},children:["-",m.amount]},m.key))]})]})]}),N&&Ve&&Ve.owner==="PLAYER"&&Ve.source==="HAND"&&Zr&&(()=>{const m=Math.max(140,180*h),_=4*h,E=(m-_)/2,L=q.pp>=Ve.card.cost;return a.jsxs("div",{style:{position:"absolute",left:15*h,bottom:135*h,zIndex:600,pointerEvents:"auto"},children:[a.jsxs("button",{disabled:!L,onClick:j=>{j.stopPropagation(),Bm()},className:L?"play-button-active":"",style:{width:E,background:L?"linear-gradient(to bottom, #48bb78, #38a169)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:`${5*h}px ${3*h}px`,borderRadius:10*h,fontSize:`${.7*h}rem`,fontWeight:"bold",cursor:L?"pointer":"not-allowed",boxShadow:L?"0 0 12px rgba(72, 187, 120, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},onMouseDown:j=>j.stopPropagation(),children:["",a.jsxs("div",{style:{fontSize:`${.5*h}rem`,opacity:.8,marginTop:1},children:["pp ",Ve.card.cost]})]}),a.jsx("style",{children:`
                                @keyframes playGlowPulse {
                                    0% { box-shadow: 0 0 10px rgba(72, 187, 120, 0.4); }
                                    50% { box-shadow: 0 0 25px rgba(72, 187, 120, 0.8); }
                                    100% { box-shadow: 0 0 10px rgba(72, 187, 120, 0.4); }
                                }
                                .play-button-active {
                                    animation: playGlowPulse 2s infinite ease-in-out;
                                }
                            `})]})})(),N&&Ve&&Ve.owner==="PLAYER"&&Ve.source==="BOARD"&&(()=>{const m=Math.max(140,180*h),_=4*h,E=(m-_)/2,L=Ve.card,j=L==null?void 0:L.hasEvolved,V=!j&&Cs,ee=!j&&ks,B=L==null?void 0:L.instanceId,z=q.board.findIndex(te=>te&&te.instanceId===B),K=q.board.slice(0,z+1).filter(te=>te).length-1,fe=te=>{z<0||Bc(K>=0?K:z,te,void 0,B)};return a.jsxs("div",{style:{position:"absolute",left:15*h,bottom:135*h,zIndex:600,pointerEvents:"auto",display:"flex",gap:_},onMouseDown:te=>te.stopPropagation(),children:[a.jsxs("button",{disabled:!V,onClick:te=>{te.stopPropagation(),fe(!1)},style:{width:E,background:V?"linear-gradient(to bottom, #faf089, #d69e2e)":"#718096",color:V?"#1a202c":"white",border:"2px solid rgba(255,255,255,0.2)",padding:`${5*h}px ${3*h}px`,borderRadius:10*h,fontSize:`${.7*h}rem`,fontWeight:"bold",cursor:V?"pointer":"not-allowed",boxShadow:V?"0 0 12px rgba(250, 240, 137, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:V?"0 1px 1px rgba(255,255,255,0.3)":"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",a.jsx("div",{style:{fontSize:`${.5*h}rem`,opacity:.8,marginTop:1},children:"EP"})]}),a.jsxs("button",{disabled:!ee,onClick:te=>{te.stopPropagation(),fe(!0)},style:{width:E,background:ee?"linear-gradient(to bottom, #b794f4, #805ad5)":"#718096",color:"white",border:"2px solid rgba(255,255,255,0.2)",padding:`${5*h}px ${3*h}px`,borderRadius:10*h,fontSize:`${.7*h}rem`,fontWeight:"bold",cursor:ee?"pointer":"not-allowed",boxShadow:ee?"0 0 12px rgba(183, 148, 244, 0.6)":"0 4px 10px rgba(0,0,0,0.5)",textShadow:"0 1px 2px rgba(0,0,0,0.5)",transition:"all 0.3s ease"},children:["",a.jsx("div",{style:{fontSize:`${.5*h}rem`,opacity:.8,marginTop:1},children:"SEP"})]})]})})(),Es&&Array.from({length:Es.count},(m,_)=>{const ee=-(Es.count*80+(Es.count-1)*20-80)/2+_*100,B=Es.isPlayer?Si((q==null?void 0:q.class)||"SENKA"):Si((_e==null?void 0:_e.class)||"SENKA");return a.jsx("div",{style:{position:"absolute",left:Es.isPlayer?"calc(100% - 90px)":90,top:Es.isPlayer?"calc(100% - 105px)":105,width:80,height:110,borderRadius:8,border:"2px solid white",overflow:"hidden",transform:`translateX(${ee}px)`,animation:`drawCard${Es.isPlayer?"Player":"Opponent"} ${Lf}ms cubic-bezier(0.2, 0.8, 0.2, 1) forwards`,zIndex:9e3+_,boxShadow:"0 0 10px rgba(255,255,255,0.5)"},children:a.jsx("img",{src:B,alt:"Card Back",style:{width:"100%",height:"100%",objectFit:"cover"},onError:z=>{z.target.style.display="none",z.target.parentElement.style.background="repeating-linear-gradient(45deg, #2d3748, #2d3748 10px, #1a202c 10px, #1a202c 20px)"}})},_)}),a.jsx("style",{children:`
                        @keyframes drawCardPlayer {
                            0% { opacity: 1; }
                            100% { transform: translate(-50vw, -100px) scale(0.5) rotate(-10deg); opacity: 0; }
                        }
                        @keyframes drawCardOpponent {
                            0% { opacity: 1; }
                            100% { transform: translate(50vw, 200px) scale(0.5) rotate(10deg); opacity: 0; }
                        }
                    `})]}),R2.map(m=>a.jsx(b3,{value:m.value,x:m.x,y:m.y,color:m.color,scale:h,onComplete:()=>jc(_=>_.filter(E=>E.id!==m.id))},m.id)),wa&&Kn.current&&(()=>{const m=Kn.current.x,_=Kn.current.y,E=200,L=320,V=180/8,ee=(B,z,K,fe)=>{const te=B*Math.PI/180,ye=z*Math.PI/180,Ee=Math.cos(te)*fe,et=-Math.sin(te)*fe,Se=Math.cos(ye)*fe,Qe=-Math.sin(ye)*fe,tt=Math.cos(ye)*K,We=-Math.sin(ye)*K,Ge=Math.cos(te)*K,xe=-Math.sin(te)*K;return`M ${Ee} ${et} A ${fe} ${fe} 0 0 0 ${Se} ${Qe} L ${tt} ${We} A ${K} ${K} 0 0 1 ${Ge} ${xe} Z`};return a.jsxs("div",{style:{position:"fixed",left:m,top:_,zIndex:2e3,pointerEvents:"none",animation:"stampUIFadeIn 0.15s ease-out"},children:[a.jsx("svg",{width:L*2+20,height:L+20,style:{position:"absolute",left:-330,top:-330,overflow:"visible"},children:a.jsx("g",{transform:`translate(${L+10}, ${L+10})`,children:p0.map((B,z)=>{const K=180-z*V,fe=K-V,te=Ca===B.id,Ee=(K+fe)/2*Math.PI/180,et=(E+L)/2,Se=Math.cos(Ee)*et,Qe=-Math.sin(Ee)*et,tt=85;return a.jsxs("g",{children:[a.jsx("path",{d:ee(K,fe,E,L),fill:te?"rgba(255, 215, 0, 0.4)":"rgba(0, 0, 0, 0.7)",stroke:te?"#ffd700":"rgba(255, 255, 255, 0.3)",strokeWidth:te?3:1,style:{transition:"all 0.1s ease-out"}}),a.jsx("defs",{children:a.jsx("clipPath",{id:`stampClip-${B.id}`,children:a.jsx("circle",{cx:Se,cy:Qe,r:tt/2})})}),a.jsx("image",{href:ot(pv(B.id,jn)),x:Se-tt/2,y:Qe-tt/2,width:tt,height:tt,clipPath:`url(#stampClip-${B.id})`,style:{transform:te?"scale(1.15)":"scale(1)",transformOrigin:`${Se}px ${Qe}px`,transition:"transform 0.1s ease-out"}}),a.jsx("circle",{cx:Se,cy:Qe,r:tt/2,fill:"none",stroke:te?"#ffd700":"rgba(255, 255, 255, 0.5)",strokeWidth:te?2:1})]},B.id)})})}),a.jsx("style",{children:`
                                @keyframes stampUIFadeIn {
                                    from { opacity: 0; transform: scale(0.8); }
                                    to { opacity: 1; transform: scale(1); }
                                }
                            `})]})})(),_i&&a.jsxs("div",{style:{position:"fixed",left:"50%",top:"40%",transform:"translate(-50%, -50%)",zIndex:2500,pointerEvents:"none",animation:"stampDisplay 3s ease-out forwards"},children:[a.jsx("div",{style:{width:250,height:250,borderRadius:20,overflow:"hidden",boxShadow:"0 0 40px rgba(0,0,0,0.5), 0 0 60px rgba(255,255,255,0.2)",border:"4px solid rgba(255,255,255,0.3)"},children:a.jsx("img",{src:ot(pv(_i.stampId,_i.playerClass)),alt:"",style:{width:"100%",height:"100%",objectFit:"cover"}})}),_i.playerId!==P&&a.jsx("div",{style:{position:"absolute",bottom:-30,left:"50%",transform:"translateX(-50%)",background:"rgba(0,0,0,0.7)",padding:"5px 15px",borderRadius:15,color:"#fff",fontSize:"0.9rem",whiteSpace:"nowrap"},children:""}),a.jsx("style",{children:`
                            @keyframes stampDisplay {
                                0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
                                10% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
                                20% { transform: translate(-50%, -50%) scale(1); }
                                80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                                100% { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
                            }
                        `})]},_i.timestamp),a.jsx("svg",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:1e3},children:Z&&(Z.sourceType==="BOARD"||Z.sourceType==="EVOLVE")&&a.jsxs(a.Fragment,{children:[a.jsxs("defs",{children:[a.jsxs("filter",{id:"cyanGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{stdDeviation:"10",result:"blur1"}),a.jsx("feFlood",{floodColor:"rgba(100, 200, 255, 0.7)",result:"color1"}),a.jsx("feComposite",{in:"color1",in2:"blur1",operator:"in",result:"glow1"}),a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"5",result:"blur2"}),a.jsx("feFlood",{floodColor:"rgba(150, 220, 255, 0.5)",result:"color2"}),a.jsx("feComposite",{in:"color2",in2:"blur2",operator:"in",result:"glow2"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"glow1"}),a.jsx("feMergeNode",{in:"glow2"})]})]}),a.jsxs("filter",{id:"yellowGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{stdDeviation:"10",result:"blur1"}),a.jsx("feFlood",{floodColor:"rgba(255, 255, 50, 0.7)",result:"color1"}),a.jsx("feComposite",{in:"color1",in2:"blur1",operator:"in",result:"glow1"}),a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"5",result:"blur2"}),a.jsx("feFlood",{floodColor:"rgba(255, 240, 100, 0.5)",result:"color2"}),a.jsx("feComposite",{in:"color2",in2:"blur2",operator:"in",result:"glow2"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"glow1"}),a.jsx("feMergeNode",{in:"glow2"})]})]}),a.jsxs("filter",{id:"softWhiteGlow",x:"-300%",y:"-300%",width:"700%",height:"700%",children:[a.jsx("feGaussianBlur",{stdDeviation:"20",result:"blur"}),a.jsx("feFlood",{floodColor:"rgba(255, 255, 255, 0.9)",result:"color"}),a.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"glow"}),a.jsx("feMergeNode",{in:"glow"}),a.jsx("feMergeNode",{in:"glow"})]})]}),a.jsxs("filter",{id:"innerCoreGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{stdDeviation:"4",result:"blur"}),a.jsx("feFlood",{floodColor:"rgba(255, 255, 255, 0.8)",result:"color"}),a.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),a.jsx("feMerge",{children:a.jsx("feMergeNode",{in:"glow"})})]}),a.jsxs("filter",{id:"coloredBallGlow",x:"-150%",y:"-150%",width:"400%",height:"400%",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"6",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"blur"})]})]}),a.jsxs("filter",{id:"particleGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"2",result:"blur"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"blur"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),a.jsxs("filter",{id:"purpleGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{stdDeviation:"10",result:"blur1"}),a.jsx("feFlood",{floodColor:"rgba(183, 148, 244, 0.7)",result:"color1"}),a.jsx("feComposite",{in:"color1",in2:"blur1",operator:"in",result:"glow1"}),a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"5",result:"blur2"}),a.jsx("feFlood",{floodColor:"rgba(200, 170, 255, 0.5)",result:"color2"}),a.jsx("feComposite",{in:"color2",in2:"blur2",operator:"in",result:"glow2"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"glow1"}),a.jsx("feMergeNode",{in:"glow2"})]})]})]}),Z.sourceType==="BOARD"&&a.jsxs(a.Fragment,{children:[a.jsx("path",{d:ws(),fill:"none",stroke:"rgba(100, 200, 255, 0.3)",strokeWidth:"20",strokeLinecap:"butt",filter:"url(#cyanGlow)"}),a.jsx("path",{d:ws(),fill:"none",stroke:"rgba(150, 220, 255, 0.5)",strokeWidth:"10",strokeLinecap:"butt"}),a.jsx("path",{d:ws(),fill:"none",stroke:"rgba(200, 240, 255, 0.9)",strokeWidth:"4",strokeLinecap:"butt"}),a.jsx("path",{d:ws(),fill:"none",stroke:"rgba(255, 255, 255, 1)",strokeWidth:"2",strokeLinecap:"butt"})]}),Z.sourceType==="EVOLVE"&&a.jsxs(a.Fragment,{children:[a.jsx("path",{d:ws(),fill:"none",stroke:Z.useSep?"rgba(159, 122, 234, 0.3)":"rgba(236, 201, 75, 0.3)",strokeWidth:"20",strokeLinecap:"butt",filter:Z.useSep?"url(#purpleGlow)":"url(#yellowGlow)"}),a.jsx("path",{d:ws(),fill:"none",stroke:Z.useSep?"rgba(183, 148, 244, 0.5)":"rgba(246, 224, 94, 0.5)",strokeWidth:"10",strokeLinecap:"butt"}),a.jsx("path",{d:ws(),fill:"none",stroke:Z.useSep?"rgba(214, 188, 250, 0.9)":"rgba(250, 240, 137, 0.9)",strokeWidth:"4",strokeLinecap:"butt"}),a.jsx("path",{d:ws(),fill:"none",stroke:"rgba(255, 255, 255, 1)",strokeWidth:"2",strokeLinecap:"butt"})]}),(Z.sourceType==="BOARD"||Z.sourceType==="EVOLVE")&&a.jsxs(a.Fragment,{children:[a.jsx("circle",{cx:Z.startX,cy:Z.startY,r:"15",fill:"rgba(255, 255, 255, 0.3)",filter:"url(#softWhiteGlow)"}),a.jsx("circle",{cx:Z.startX,cy:Z.startY,r:"8",fill:"rgba(255, 255, 255, 0.4)",filter:"url(#softWhiteGlow)"})]}),(Z.sourceType==="BOARD"||Z.sourceType==="EVOLVE")&&a.jsxs(a.Fragment,{children:[a.jsx("circle",{cx:Z.currentX,cy:Z.currentY,r:"18",fill:"rgba(255, 255, 255, 0.25)",filter:"url(#softWhiteGlow)"}),a.jsx("circle",{cx:Z.currentX,cy:Z.currentY,r:"8",fill:"rgba(255, 255, 255, 0.35)",filter:"url(#softWhiteGlow)"}),a.jsx("circle",{cx:Z.currentX,cy:Z.currentY,r:"3",fill:"rgba(255, 255, 255, 0.7)",filter:"url(#innerCoreGlow)"})]}),_2.map(m=>{const _=Z.sourceType==="EVOLVE"?Z.useSep?`rgba(230, 220, 255, ${m.opacity})`:`rgba(255, 255, 230, ${m.opacity})`:`rgba(220, 245, 255, ${m.opacity})`;return a.jsx("circle",{cx:m.x,cy:m.y,r:m.radius,fill:_,filter:"url(#particleGlow)"},m.id)})]})}),Qt&&a.jsxs("svg",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100dvh",pointerEvents:"none",zIndex:99999},children:[a.jsx("defs",{children:a.jsxs("filter",{id:"endTurnGlow",x:"-100%",y:"-100%",width:"300%",height:"300%",children:[a.jsx("feGaussianBlur",{stdDeviation:"6",result:"blur"}),a.jsx("feFlood",{floodColor:"rgba(100, 200, 255, 0.8)",result:"color"}),a.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),a.jsxs("feMerge",{children:[a.jsx("feMergeNode",{in:"glow"}),a.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),a.jsx("circle",{cx:Qt.x,cy:Qt.y,r:Qt.ringRadius,fill:"none",stroke:`rgba(100, 200, 255, ${Math.max(0,1-Qt.ringRadius/120)*.8})`,strokeWidth:"4",filter:"url(#endTurnGlow)"}),a.jsx("circle",{cx:Qt.x,cy:Qt.y,r:Qt.ringRadius*.8,fill:"none",stroke:`rgba(255, 255, 255, ${Math.max(0,1-Qt.ringRadius/120)*.6})`,strokeWidth:"2"}),a.jsx("circle",{cx:Qt.x,cy:Qt.y,r:20,fill:`rgba(255, 255, 255, ${Math.max(0,1-Qt.ringRadius/120)*.9})`}),Qt.particles.map(m=>a.jsx("circle",{cx:m.x,cy:m.y,r:4,fill:`rgba(255, 255, 255, ${m.opacity*.8})`},m.id))]}),nt&&a.jsxs("div",{style:{position:"absolute",inset:0,zIndex:9999,pointerEvents:"auto",background:"rgba(0,0,0,0.5)",perspective:"1200px"},children:[a.jsx("style",{children:`
                                @keyframes playCardSequence {
                                    ${nt.finalX!==void 0?`
                                    /* Phase 1: Start at hand position (0%) */
                                    0% {
                                        transform: translate(${nt.startX-nt.targetX}px, ${nt.startY-nt.targetY}px) translate(-50%, -50%) scale(1.0) rotateY(0deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Phase 1b: Mid-rotation during move (12.5%) - CRITICAL: explicit 180deg to force rotation direction */
                                    12.5% {
                                        transform: translate(${(nt.startX-nt.targetX)*.5}px, ${(nt.startY-nt.targetY)*.5}px) translate(-50%, -50%) scale(1.5) rotateY(180deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Phase 2: Arrive at center with rotation complete (25%) */
                                    25% {
                                        transform: translate(-50%, -50%) scale(1.8) rotateY(360deg);
                                        opacity: 1;
                                        animation-timing-function: ease-out;
                                    }
                                    /* Phase 3: Hold at center (25%-80%) */
                                    80% {
                                        transform: translate(-50%, -50%) scale(2.4) rotateY(360deg);
                                        opacity: 1;
                                    }
                                    /* Phase 4: Move to board position (80%-100%) */
                                    100% {
                                        transform: translate(calc(-50% + ${nt.finalX-nt.targetX}px), calc(-50% + ${nt.finalY-nt.targetY}px)) scale(1.0) rotateY(360deg);
                                        opacity: 1;
                                    }
                                    `:`
                                    /* Spell: Move to center while rotating, then fade */
                                    0% {
                                        transform: translate(${nt.startX-nt.targetX}px, ${nt.startY-nt.targetY}px) translate(-50%, -50%) scale(1.0) rotateY(0deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Mid-rotation during move (15%) - CRITICAL: explicit 180deg */
                                    15% {
                                        transform: translate(${(nt.startX-nt.targetX)*.5}px, ${(nt.startY-nt.targetY)*.5}px) translate(-50%, -50%) scale(1.7) rotateY(180deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    30% {
                                        transform: translate(-50%, -50%) scale(2.2) rotateY(360deg);
                                        opacity: 1;
                                        animation-timing-function: ease-out;
                                    }
                                    80% {
                                        transform: translate(-50%, -50%) scale(2.4) rotateY(360deg);
                                        opacity: 1;
                                    }
                                    100% {
                                        transform: translate(-50%, -50%) scale(3.0) rotateY(360deg);
                                        opacity: 0;
                                    }
                                    `}
                                }
                                @keyframes playSpellSequence {
                                    /* Move from hand to center while rotating (0-30%) */
                                    0% {
                                        transform: translate(${nt.startX-nt.targetX}px, ${nt.startY-nt.targetY}px) translate(-50%, -50%) scale(1.0) rotateY(0deg);
                                        opacity: 1;
                                        animation-timing-function: linear;
                                    }
                                    /* Mid-rotation during move (15%) - CRITICAL: explicit 180deg to force rotation direction */
                                    15% {
                                        transform: translate(${(nt.startX-nt.targetX)*.5}px, ${(nt.startY-nt.targetY)*.5}px) translate(-50%, -50%) scale(1.7) rotateY(180deg);
                                        opacity: 1;
                                        filter: brightness(1);
                                        animation-timing-function: linear;
                                    }
                                    /* Arrive at center with rotation complete (30%) */
                                    30% {
                                        transform: translate(-50%, -50%) scale(2.2) rotateY(360deg);
                                        opacity: 1;
                                        filter: brightness(1);
                                        animation-timing-function: ease-out;
                                    }
                                    /* Hold at center (30%-75%) */
                                    75% {
                                        transform: translate(-50%, -50%) scale(2.4) rotateY(360deg);
                                        opacity: 1;
                                        filter: brightness(1.2);
                                    }
                                    /* Fade out (75%-100%) */
                                    100% {
                                        transform: translate(-50%, -50%) scale(3.0) rotateY(360deg);
                                        opacity: 0;
                                        filter: brightness(3);
                                    }
                                }
                                .play-card-flipper {
                                    transform-style: preserve-3d !important;
                                }
                                .play-card-front, .play-card-back {
                                    backface-visibility: hidden !important;
                                    -webkit-backface-visibility: hidden !important;
                                    position: absolute;
                                    width: 100%;
                                    height: 100%;
                                }
                                .play-card-back {
                                    transform: rotateY(180deg) translateZ(1px);
                                }
                            `}),a.jsxs("div",{className:"play-card-flipper",onAnimationEnd:nt.onComplete,style:{position:"absolute",left:nt.targetX,top:nt.targetY,width:fn*h,height:Cn*h,transformStyle:"preserve-3d",animation:nt.card.type==="SPELL"?"playSpellSequence 1s forwards":"playCardSequence 0.8s forwards"},children:[a.jsx("div",{className:"play-card-front",children:a.jsx(yo,{card:nt.card,isOnBoard:!0,suppressPassives:!0,scale:h,style:{width:fn*h,height:Cn*h,boxShadow:"0 0 50px rgba(255,215,0,0.8)"}})}),a.jsx("div",{className:"play-card-back",style:{borderRadius:12,boxShadow:"0 0 50px rgba(255,215,0,0.8)",overflow:"hidden"},children:a.jsx("img",{src:Si(nt.playerClass),alt:"Card Sleeve",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:12},onError:m=>{const _=m.target;_.style.display="none",_.parentElement&&(_.parentElement.style.background="linear-gradient(135deg, #1e3a5f 0%, #0d1b2a 50%, #1e3a5f 100%)")}})}),nt.card.type==="SPELL"&&a.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none"},children:a.jsx(E3,{x:0,y:0})})]})]}),oo.length>0&&oo.map((m,_)=>a.jsx("div",{style:{position:"absolute",left:m.status==="FLY"&&m.targetX!==void 0?m.targetX:window.innerWidth/2+m.xOffset,top:m.status==="FLY"&&m.targetY!==void 0?m.targetY:window.innerHeight/2,transform:m.status==="APPEAR"?"translate(-50%, -50%) scale(1.2)":"translate(-50%, -50%) scale(0.2)",zIndex:7e3+_,pointerEvents:"none",transition:m.status==="FLY"?"all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)":"none",opacity:m.status==="FLY"?.3:1,animation:m.status==="APPEAR"?"cardAppear 0.8s ease-out":void 0},children:a.jsx(yo,{card:m.card,scale:h,style:{width:fn*h,height:Cn*h}})},_)),a.jsx("style",{children:`
                    @keyframes cardAppear {
                        0% { transform: translate(-50%, -50%) scale(0) rotate(-10deg); opacity: 0; }
                        50% { transform: translate(-50%, -50%) scale(1.3) rotate(5deg); opacity: 1; }
                        100% { transform: translate(-50%, -50%) scale(1.2) rotate(0deg); opacity: 1; }
                    }
                `}),Lc.map(m=>m.type==="BUFF"?a.jsx(v3,{x:m.x,y:m.y,atkBuff:m.atkBuff??0,hpBuff:m.hpBuff??0,onComplete:()=>ao(_=>_.filter(E=>E.key!==m.key))},m.key):a.jsx(_3,{type:m.type,x:m.x,y:m.y,onComplete:()=>ao(_=>_.filter(E=>E.key!==m.key)),audioSettings:Ot,scale:h},m.key)),$t&&a.jsx(I3,{card:$t.card,evolvedImageUrl:$t.evolvedImageUrl,startX:$t.startX,startY:$t.startY,phase:$t.phase,onPhaseChange:P2,onShake:Xn,useSep:$t.useSep,playSE:St,scale:h,isLightMode:ce}),bi&&a.jsxs("div",{style:{position:"fixed",top:"45%",left:`${340*h}px`,width:`calc(100% - ${340*h}px)`,display:"flex",justifyContent:"center",alignItems:"center",transform:"translateY(-50%)",zIndex:9e3,pointerEvents:"none",animation:"notificationFade 2.5s forwards"},children:[a.jsx("div",{style:{padding:`${20*h}px ${90*h}px`,background:"rgba(0, 0, 0, 0.75)",backdropFilter:"blur(16px)",borderTop:`${3*h}px solid ${bi==="EVOLVE_READY"?"rgba(255, 215, 0, 0.7)":"rgba(180, 0, 255, 0.7)"}`,borderBottom:`${3*h}px solid ${bi==="EVOLVE_READY"?"rgba(255, 215, 0, 0.7)":"rgba(180, 0, 255, 0.7)"}`,boxShadow:bi==="EVOLVE_READY"?`0 0 ${50*h}px rgba(255, 180, 0, 0.5), inset 0 0 ${30*h}px rgba(255, 215, 0, 0.2)`:`0 0 ${50*h}px rgba(180, 0, 255, 0.5), inset 0 0 ${30*h}px rgba(180, 0, 255, 0.2)`,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",borderRadius:`${4*h}px`},children:a.jsx("span",{style:{fontSize:`${5*h}rem`,fontWeight:"900",fontFamily:'"YuMincho", "Hiragino Mincho ProN", "MS Mincho", serif',color:"#fff",letterSpacing:`${.8*h}rem`,whiteSpace:"nowrap",textShadow:bi==="EVOLVE_READY"?`0 0 ${15*h}px rgba(255, 215, 0, 1), 0 0 ${30*h}px rgba(255, 180, 0, 0.8), ${2*h}px ${2*h}px ${4*h}px rgba(0,0,0,0.9)`:`0 0 ${15*h}px rgba(180, 0, 255, 1), 0 0 ${30*h}px rgba(140, 0, 255, 0.8), ${2*h}px ${2*h}px ${4*h}px rgba(0,0,0,0.9)`,WebkitTextStroke:bi==="EVOLVE_READY"?`${1.5*h}px #ffd700`:`${1.5*h}px #b400ff`},children:bi==="EVOLVE_READY"?"":""})}),a.jsx("style",{children:`
                            @keyframes notificationFade {
                                0% { opacity: 0; transform: translateY(-40%) scale(0.8); filter: blur(15px); }
                                10% { opacity: 1; transform: translateY(-50%) scale(1); filter: blur(0px); }
                                90% { opacity: 1; transform: translateY(-50%) scale(1); filter: blur(0px); }
                                100% { opacity: 0; transform: translateY(-60%) scale(1.15); filter: blur(20px); }
                            }
                        `})]}),He&&g.winnerId&&a.jsx(o3,{isVictory:g.winnerId===P,loserLeaderRef:g.winnerId===P?co:Ei,onComplete:()=>{st(!1),Ue(!0),mt(null),Mt(0),(n==="CASUAL_MATCH"||n==="RANKED_MATCH")&&x&&(console.log("[GameScreen] Disconnecting after game over (casual match)"),x.disconnect())},onPhaseChange:mt,onShakeIntensityChange:Mt,scale:h}),g.winnerId&&Ze&&a.jsx(A3,{winnerId:g.winnerId,playerId:P,playerClass:(q==null?void 0:q.class)||"SENKA",isOnline:e==="ONLINE",isRoomMatch:n==="HOST"||n==="JOIN",myRematchRequested:sr,opponentRematchRequested:va,battleStats:{turnCount:g.turnCount,damageDealtToOpponent:xi.damageDealtToOpponent,damageReceivedFromOpponent:xi.damageReceivedFromOpponent,followersDestroyed:xi.followersDestroyed,myFollowersDestroyed:xi.myFollowersDestroyed},selectedCardInfo:kf,onCardInfoClick:_a,victoryReason:Cf,isRankedMatch:n==="RANKED_MATCH",ratingResult:Rf,onRematching:i,onRematch:m=>{e==="ONLINE"?(nn(!0),va?(x==null||x.send({type:"REMATCH_ACCEPT"}),Uf(m)):(x==null||x.send({type:"REMATCH_REQUEST"}),so(m))):Uf(m)},onLeave:s})]})]})},O3=async()=>(await BP(bc)).user,L3=async(t,e)=>(await KP(bc,t,e)).user,D3=async(t,e)=>{const n=bc.currentUser;if(!n)throw new Error("No user logged in");const r=eo.credential(t,e);return(await VP(n,r)).user},M3=async()=>{await qP(bc)},N3=t=>QP(bc,t),Qx=1280,qx=720,j3=({onRegisterSuccess:t,onBack:e})=>{const[n,r]=A.useState(""),[s,i]=A.useState(""),[o,l]=A.useState(""),[c,d]=A.useState(""),[u,p]=A.useState(!1),[f,b]=A.useState(1);A.useEffect(()=>{const v=()=>{const T=window.innerWidth/Qx,h=window.innerHeight/qx;b(Math.min(T,h))};return v(),window.addEventListener("resize",v),()=>window.removeEventListener("resize",v)},[]);const I=v=>/^[a-zA-Z0-9_]{3,20}$/.test(v),k=v=>`${v}@tenfubu-game.local`,F=async()=>{if(d(""),!n||!s||!o){d("");return}if(!I(n)){d("ID3-20");return}if(s.length<6){d("6");return}if(s!==o){d("");return}p(!0);try{const v=k(n);await D3(v,s),t()}catch(v){console.error("Registration error:",v),console.error("Error code:",v==null?void 0:v.code),console.error("Error message:",v==null?void 0:v.message);const T=(v==null?void 0:v.code)||"";d(T==="auth/email-already-in-use"?"ID":T==="auth/invalid-email"?"ID":T==="auth/weak-password"?"6":T==="auth/requires-recent-login"?"":T==="auth/provider-already-linked"?"ID":T==="auth/credential-already-in-use"?"ID":` (${T||"unknown error"})`)}finally{p(!1)}},x=v=>{v.key==="Enter"&&!u&&F()};return a.jsx("div",{style:{width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",overflow:"hidden"},children:a.jsxs("div",{style:{width:Qx*f,height:qx*f,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative"},children:[a.jsx("h1",{style:{fontSize:48*f,fontWeight:"bold",color:"#fff",marginBottom:40*f,textShadow:"0 4px 8px rgba(0,0,0,0.5)"},children:""}),a.jsxs("div",{style:{width:400*f,display:"flex",flexDirection:"column",gap:20*f},children:[a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*f,color:"#fff",marginBottom:8*f,fontWeight:"bold"},children:"ID"}),a.jsx("input",{type:"text",value:n,onChange:v=>r(v.target.value),onKeyPress:x,placeholder:"player123",disabled:u,style:{width:"100%",padding:`${12*f}px ${16*f}px`,fontSize:16*f,borderRadius:8*f,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:v=>v.currentTarget.style.borderColor="#4a9eff",onBlur:v=>v.currentTarget.style.borderColor="#444"}),a.jsx("p",{style:{fontSize:12*f,color:"#888",marginTop:4*f,marginBottom:0},children:"3-20"})]}),a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*f,color:"#fff",marginBottom:8*f,fontWeight:"bold"},children:"6"}),a.jsx("input",{type:"password",value:s,onChange:v=>i(v.target.value),onKeyPress:x,placeholder:"",disabled:u,style:{width:"100%",padding:`${12*f}px ${16*f}px`,fontSize:16*f,borderRadius:8*f,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:v=>v.currentTarget.style.borderColor="#4a9eff",onBlur:v=>v.currentTarget.style.borderColor="#444"})]}),a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*f,color:"#fff",marginBottom:8*f,fontWeight:"bold"},children:""}),a.jsx("input",{type:"password",value:o,onChange:v=>l(v.target.value),onKeyPress:x,placeholder:"",disabled:u,style:{width:"100%",padding:`${12*f}px ${16*f}px`,fontSize:16*f,borderRadius:8*f,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:v=>v.currentTarget.style.borderColor="#4a9eff",onBlur:v=>v.currentTarget.style.borderColor="#444"})]}),c&&a.jsx("div",{style:{padding:`${12*f}px ${16*f}px`,borderRadius:8*f,background:"rgba(255, 80, 80, 0.2)",border:"2px solid #ff5050",color:"#ff5050",fontSize:14*f,textAlign:"center"},children:c}),a.jsxs("div",{style:{display:"flex",gap:16*f,marginTop:20*f},children:[a.jsx("button",{onClick:e,disabled:u,style:{flex:1,padding:`${16*f}px ${32*f}px`,fontSize:18*f,fontWeight:"bold",borderRadius:8*f,border:"none",background:"#555",color:"#fff",cursor:u?"not-allowed":"pointer",transition:"all 0.3s",opacity:u?.5:1},onMouseEnter:v=>!u&&(v.currentTarget.style.background="#666"),onMouseLeave:v=>!u&&(v.currentTarget.style.background="#555"),children:""}),a.jsx("button",{onClick:F,disabled:u,style:{flex:1,padding:`${16*f}px ${32*f}px`,fontSize:18*f,fontWeight:"bold",borderRadius:8*f,border:"none",background:u?"#555":"linear-gradient(135deg, #4a9eff 0%, #357abd 100%)",color:"#fff",cursor:u?"not-allowed":"pointer",transition:"all 0.3s",boxShadow:u?"none":"0 4px 8px rgba(0,0,0,0.3)"},onMouseEnter:v=>!u&&(v.currentTarget.style.transform="scale(1.05)"),onMouseLeave:v=>!u&&(v.currentTarget.style.transform="scale(1)"),children:u?"...":""})]}),a.jsxs("div",{style:{marginTop:20*f,padding:`${12*f}px ${16*f}px`,borderRadius:8*f,background:"rgba(74, 158, 255, 0.1)",border:"1px solid rgba(74, 158, 255, 0.3)",fontSize:13*f,color:"#aaa",textAlign:"center",lineHeight:1.6},children:["ID",a.jsx("br",{}),""]})]})]})})},Zx=1280,e_=720,$3=({onLoginSuccess:t,onBack:e})=>{const[n,r]=A.useState(""),[s,i]=A.useState(""),[o,l]=A.useState(""),[c,d]=A.useState(!1),[u,p]=A.useState(1);A.useEffect(()=>{const k=()=>{const F=window.innerWidth/Zx,x=window.innerHeight/e_;p(Math.min(F,x))};return k(),window.addEventListener("resize",k),()=>window.removeEventListener("resize",k)},[]);const f=k=>`${k}@tenfubu-game.local`,b=async()=>{if(l(""),!n||!s){l("ID");return}d(!0);try{const k=f(n);await L3(k,s),t()}catch(k){const F=(k==null?void 0:k.code)||"";l(F==="auth/user-not-found"?"":F==="auth/wrong-password"?"":F==="auth/invalid-email"?"ID":F==="auth/invalid-credential"?"ID":"")}finally{d(!1)}},I=k=>{k.key==="Enter"&&!c&&b()};return a.jsx("div",{style:{width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",overflow:"hidden"},children:a.jsxs("div",{style:{width:Zx*u,height:e_*u,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative"},children:[a.jsx("h1",{style:{fontSize:48*u,fontWeight:"bold",color:"#fff",marginBottom:40*u,textShadow:"0 4px 8px rgba(0,0,0,0.5)"},children:""}),a.jsxs("div",{style:{width:400*u,display:"flex",flexDirection:"column",gap:20*u},children:[a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*u,color:"#fff",marginBottom:8*u,fontWeight:"bold"},children:"ID"}),a.jsx("input",{type:"text",value:n,onChange:k=>r(k.target.value),onKeyPress:I,placeholder:"player123",disabled:c,style:{width:"100%",padding:`${12*u}px ${16*u}px`,fontSize:16*u,borderRadius:8*u,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:k=>k.currentTarget.style.borderColor="#4a9eff",onBlur:k=>k.currentTarget.style.borderColor="#444"})]}),a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*u,color:"#fff",marginBottom:8*u,fontWeight:"bold"},children:""}),a.jsx("input",{type:"password",value:s,onChange:k=>i(k.target.value),onKeyPress:I,placeholder:"",disabled:c,style:{width:"100%",padding:`${12*u}px ${16*u}px`,fontSize:16*u,borderRadius:8*u,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:k=>k.currentTarget.style.borderColor="#4a9eff",onBlur:k=>k.currentTarget.style.borderColor="#444"})]}),o&&a.jsx("div",{style:{padding:`${12*u}px ${16*u}px`,borderRadius:8*u,background:"rgba(255, 80, 80, 0.2)",border:"2px solid #ff5050",color:"#ff5050",fontSize:14*u,textAlign:"center"},children:o}),a.jsxs("div",{style:{display:"flex",gap:16*u,marginTop:20*u},children:[a.jsx("button",{onClick:e,disabled:c,style:{flex:1,padding:`${16*u}px ${32*u}px`,fontSize:18*u,fontWeight:"bold",borderRadius:8*u,border:"none",background:"#555",color:"#fff",cursor:c?"not-allowed":"pointer",transition:"all 0.3s",opacity:c?.5:1},onMouseEnter:k=>!c&&(k.currentTarget.style.background="#666"),onMouseLeave:k=>!c&&(k.currentTarget.style.background="#555"),children:""}),a.jsx("button",{onClick:b,disabled:c,style:{flex:1,padding:`${16*u}px ${32*u}px`,fontSize:18*u,fontWeight:"bold",borderRadius:8*u,border:"none",background:c?"#555":"linear-gradient(135deg, #4a9eff 0%, #357abd 100%)",color:"#fff",cursor:c?"not-allowed":"pointer",transition:"all 0.3s",boxShadow:c?"none":"0 4px 8px rgba(0,0,0,0.3)"},onMouseEnter:k=>!c&&(k.currentTarget.style.transform="scale(1.05)"),onMouseLeave:k=>!c&&(k.currentTarget.style.transform="scale(1)"),children:c?"...":""})]}),a.jsx("div",{style:{marginTop:20*u,padding:`${12*u}px ${16*u}px`,borderRadius:8*u,background:"rgba(255, 200, 80, 0.1)",border:"1px solid rgba(255, 200, 80, 0.3)",fontSize:13*u,color:"#ffcc80",textAlign:"center",lineHeight:1.6},children:" "})]})]})})},t_=1280,n_=720,F3=({playerId:t,currentPlayerName:e,onUpdateSuccess:n,onBack:r})=>{const[s,i]=A.useState(e),[o,l]=A.useState(""),[c,d]=A.useState(!1),[u,p]=A.useState(!1),[f,b]=A.useState(1);A.useEffect(()=>{const F=()=>{const x=window.innerWidth/t_,v=window.innerHeight/n_;b(Math.min(x,v))};return F(),window.addEventListener("resize",F),()=>window.removeEventListener("resize",F)},[]);const I=async()=>{if(l(""),p(!1),!s.trim()){l("");return}if(s.length>20){l("20");return}if(!t){l("ID");return}d(!0);try{await CS(t,s.trim()),p(!0),setTimeout(()=>{n(s.trim())},1e3)}catch(F){console.error("Failed to update player name:",F),l("")}finally{d(!1)}},k=F=>{F.key==="Enter"&&!c&&I()};return a.jsx("div",{style:{width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",overflow:"hidden"},children:a.jsxs("div",{style:{width:t_*f,height:n_*f,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative"},children:[a.jsx("h1",{style:{fontSize:48*f,fontWeight:"bold",color:"#fff",marginBottom:40*f,textShadow:"0 4px 8px rgba(0,0,0,0.5)"},children:""}),a.jsxs("div",{style:{width:400*f,display:"flex",flexDirection:"column",gap:20*f},children:[a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:16*f,color:"#fff",marginBottom:8*f,fontWeight:"bold"},children:""}),a.jsx("input",{type:"text",value:s,onChange:F=>i(F.target.value),onKeyPress:k,placeholder:"",disabled:c,maxLength:20,style:{width:"100%",padding:`${12*f}px ${16*f}px`,fontSize:16*f,borderRadius:8*f,border:"2px solid #444",background:"#2a2a3e",color:"#fff",outline:"none",transition:"border-color 0.3s",boxSizing:"border-box"},onFocus:F=>F.currentTarget.style.borderColor="#4a9eff",onBlur:F=>F.currentTarget.style.borderColor="#444"}),a.jsx("p",{style:{fontSize:12*f,color:"#888",marginTop:4*f,marginBottom:0},children:"20"})]}),o&&a.jsx("div",{style:{padding:`${12*f}px ${16*f}px`,borderRadius:8*f,background:"rgba(255, 80, 80, 0.2)",border:"2px solid #ff5050",color:"#ff5050",fontSize:14*f,textAlign:"center"},children:o}),u&&a.jsx("div",{style:{padding:`${12*f}px ${16*f}px`,borderRadius:8*f,background:"rgba(80, 255, 120, 0.2)",border:"2px solid #50ff78",color:"#50ff78",fontSize:14*f,textAlign:"center"},children:" "}),a.jsxs("div",{style:{display:"flex",gap:16*f,marginTop:20*f},children:[a.jsx("button",{onClick:r,disabled:c,style:{flex:1,padding:`${16*f}px ${32*f}px`,fontSize:18*f,fontWeight:"bold",borderRadius:8*f,border:"none",background:"#555",color:"#fff",cursor:c?"not-allowed":"pointer",transition:"all 0.3s",opacity:c?.5:1},onMouseEnter:F=>!c&&(F.currentTarget.style.background="#666"),onMouseLeave:F=>!c&&(F.currentTarget.style.background="#555"),children:""}),a.jsx("button",{onClick:I,disabled:c,style:{flex:1,padding:`${16*f}px ${32*f}px`,fontSize:18*f,fontWeight:"bold",borderRadius:8*f,border:"none",background:c?"#555":"linear-gradient(135deg, #4a9eff 0%, #357abd 100%)",color:"#fff",cursor:c?"not-allowed":"pointer",transition:"all 0.3s",boxShadow:c?"none":"0 4px 8px rgba(0,0,0,0.3)"},onMouseEnter:F=>!c&&(F.currentTarget.style.transform="scale(1.05)"),onMouseLeave:F=>!c&&(F.currentTarget.style.transform="scale(1)"),children:c?"...":""})]})]})]})})},U3=t=>{const e="/tenfubu-verse/",n=t.startsWith("/")?t.slice(1):t;return`${e}${n}`},B3=U3("/bgm/tenfubu.mp3"),_d={bgm:.3,se:.5,voice:.5,bgmEnabled:!0,seEnabled:!0},z3=()=>{try{const t=localStorage.getItem("audioSettings");if(t){const e=JSON.parse(t);if(e.enabled!==void 0){const{enabled:n,...r}=e;return{..._d,...r,bgmEnabled:n,seEnabled:n}}return{..._d,...e}}return _d}catch{return _d}},H3=()=>{const[t,e]=A.useState(!1);return A.useEffect(()=>{const n=()=>{const r="ontouchstart"in window||navigator.maxTouchPoints>0,s=window.innerHeight>window.innerWidth;e(r&&s)};return n(),window.addEventListener("resize",n),window.addEventListener("orientationchange",n),()=>{window.removeEventListener("resize",n),window.removeEventListener("orientationchange",n)}},[]),t};function W3(){const[t,e]=A.useState("TITLE"),[n,r]=A.useState("SENKA"),[s,i]=A.useState("CPU"),[o,l]=A.useState(""),[c,d]=A.useState(void 0),[u,p]=A.useState("NORMAL"),[f,b]=A.useState(null),[I,k]=A.useState(!0),[F,x]=A.useState(null),[v,T]=A.useState(null),[h,W]=A.useState(!0),[G,ce]=A.useState(()=>{const de=localStorage.getItem("timerEnabled");return de!==null?JSON.parse(de):!0}),[N,J]=A.useState(()=>localStorage.getItem("playerName")||""),[Q,Ie]=A.useState(void 0),[Je,pe]=A.useState(void 0),se=H3(),P=A.useRef(null),[w,R]=A.useState(!1),[y,g]=A.useState(z3),[C,O]=A.useState(()=>localStorage.getItem("homeCardId")),M=de=>de&&de.endsWith("@tenfubu-game.local")?de.replace("@tenfubu-game.local",""):null;A.useEffect(()=>{const de=N3(async Le=>{if(console.log(" Auth state changed:",{uid:Le==null?void 0:Le.uid,email:Le==null?void 0:Le.email,isAnonymous:Le==null?void 0:Le.isAnonymous}),Le){b(Le.uid),k(Le.isAnonymous),x(Le.email),T(M(Le.email));const Me=M(Le.email);console.log(" State updated:",{playerId:Le.uid,isAnonymous:Le.isAnonymous,userId:Me});try{await Ax(Le.uid,Me||"anonymous",N||"")}catch(Be){console.error("Failed to create player data:",Be)}}else try{const Me=await O3();b(Me.uid),k(!0),x(null),T(null),await Ax(Me.uid,"anonymous",N||"")}catch(Me){console.error("Failed to sign in:",Me)}W(!1)});return()=>de()},[]),A.useEffect(()=>{localStorage.setItem("audioSettings",JSON.stringify(y))},[y]);const U=A.useCallback(de=>{g(Le=>({...Le,...de}))},[]),H=A.useCallback((de,Le)=>{P.current=de,R(!0),Le&&d(Le),e("GAME")},[]),me=A.useCallback((de,Le,Me,Be,Pt)=>{P.current=de,R(!0),d(Le),Ie(Be),pe(Pt),e("GAME")},[]),ve=A.useCallback(de=>{P.current&&(P.current.disconnect(),P.current=null),R(!1),d(void 0),Ie(void 0),pe(void 0),r(de),e("MATCHMAKING")},[]),ue=A.useRef(null),ne=A.useRef(!1);A.useEffect(()=>{const de=new Audio(B3);return de.loop=!0,de.volume=y.bgmEnabled?y.bgm:0,ue.current=de,ne.current=!0,()=>{de.pause(),de.src=""}},[]),A.useEffect(()=>{const de=ue.current;!de||!ne.current||(de.volume=y.bgmEnabled?y.bgm:0,y.bgmEnabled?de.paused&&(t==="TITLE"||t==="CLASS_SELECT")&&de.play().catch(()=>{}):de.pause())},[y.bgm,y.bgmEnabled,t]),A.useEffect(()=>{const de=ue.current;de&&(t==="TITLE"||t==="CLASS_SELECT"||t==="LOBBY"?de.paused&&y.bgmEnabled&&de.play().catch(()=>{}):(de.pause(),de.currentTime=0))},[t,y.bgmEnabled]),A.useEffect(()=>{const de=()=>{const Le=ue.current;Le&&Le.paused&&y.bgmEnabled&&(t==="TITLE"||t==="CLASS_SELECT"||t==="LOBBY")&&Le.play().catch(()=>{})};return document.addEventListener("click",de),()=>document.removeEventListener("click",de)},[t,y.bgmEnabled]);const re=A.useCallback((de,Le,Me,Be)=>{i(de),Le&&l(Le),Be&&p(Be),Me?(r(Me),e(de==="CPU"?"GAME":de==="CASUAL_MATCH"||de==="RANKED_MATCH"?"MATCHMAKING":"LOBBY")):e("CLASS_SELECT")},[]),He=A.useCallback(de=>{r(de),e(s==="CPU"?"GAME":s==="CASUAL_MATCH"||s==="RANKED_MATCH"?"MATCHMAKING":"LOBBY")},[s]),st=A.useCallback(()=>{P.current&&(P.current.disconnect(),P.current=null),R(!1),e("TITLE"),l(""),i("CPU"),d(void 0),Ie(void 0),pe(void 0)},[]),je=A.useCallback(de=>{console.log(" App handleSetHomeCard called with cardId:",de),O(de),localStorage.setItem("homeCardId",de),console.log(" localStorage updated:",localStorage.getItem("homeCardId"))},[]),we=A.useCallback(()=>{e("REGISTER")},[]),Re=A.useCallback(()=>{e("LOGIN")},[]),at=A.useCallback(()=>{e("TITLE")},[]),qe=A.useCallback(()=>{e("TITLE")},[]),Ze=A.useCallback(async()=>{try{await M3(),e("TITLE")}catch(de){console.error("Failed to logout:",de)}},[]),Ue=A.useCallback(()=>{e("TITLE")},[]),De=A.useCallback(()=>{e("TITLE")},[]),mt=A.useCallback(()=>{e("PROFILE")},[]),Et=A.useCallback(de=>{J(de),localStorage.setItem("playerName",de),e("TITLE")},[]),Mt=A.useCallback(()=>{e("TITLE")},[]);return h?a.jsx("div",{style:{width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",color:"white",fontSize:"1.5rem",fontWeight:"bold"},children:"Loading..."}):a.jsxs("div",{className:"app-container",style:{userSelect:"none"},children:[se&&a.jsxs("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100dvh",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:99999,color:"white",textAlign:"center",padding:20},children:[a.jsx("div",{style:{fontSize:"4rem",marginBottom:20,animation:"rotatePhone 2s ease-in-out infinite"},children:""}),a.jsx("h2",{style:{fontSize:"1.5rem",fontWeight:"bold",marginBottom:10,textShadow:"0 2px 4px rgba(0,0,0,0.5)"},children:""}),a.jsx("p",{style:{fontSize:"1rem",opacity:.8,maxWidth:280},children:""}),a.jsx("style",{children:`
                        @keyframes rotatePhone {
                            0%, 100% { transform: rotate(0deg); }
                            25% { transform: rotate(-30deg); }
                            75% { transform: rotate(30deg); }
                        }
                    `})]}),t==="TITLE"&&a.jsx(xL,{onStartConfig:re,audioSettings:y,onAudioSettingsChange:U,playerId:f,onSetHomeCard:je,homeCardId:C,isAnonymous:I,userId:v,currentPlayerName:N,onPlayerNameUpdate:de=>J(de),onNavigateToRegister:we,onNavigateToLogin:Re,onNavigateToProfile:mt,onLogout:Ze}),t==="CLASS_SELECT"&&a.jsx(wL,{onSelectClass:He,onBack:st,gameMode:s,aiDifficulty:u,onDifficultyChange:p,playerName:N,onPlayerNameChange:de=>{J(de),localStorage.setItem("playerName",de)},timerEnabled:G,onTimerEnabledChange:de=>{ce(de),localStorage.setItem("timerEnabled",JSON.stringify(de))},playerId:f}),t==="LOBBY"&&a.jsx(JL,{gameMode:s,targetRoomId:o,playerClass:n,onGameStart:H,onBack:st}),t==="MATCHMAKING"&&a.jsx(e3,{matchType:s==="CASUAL_MATCH"?"casual":"ranked",playerClass:n,playerName:N||"",playerId:f,onGameStart:me,onCancel:st}),t==="GAME"&&a.jsx(P3,{playerClass:n,opponentType:s==="CPU"?"CPU":"ONLINE",gameMode:s,targetRoomId:o,onLeave:st,onRematching:ve,networkAdapter:P.current,networkConnected:w,opponentClass:c,aiDifficulty:u,playerName:N||"",timerEnabled:s==="CASUAL_MATCH"||s==="RANKED_MATCH"?!0:G,playerId:f,opponentPlayerId:Q,opponentRating:Je}),t==="REGISTER"&&a.jsx(j3,{onRegisterSuccess:at,onBack:Ue}),t==="LOGIN"&&a.jsx($3,{onLoginSuccess:qe,onBack:De}),t==="PROFILE"&&a.jsx(F3,{playerId:f,currentPlayerName:N,onUpdateSuccess:Et,onBack:Mt})]})}Vh.createRoot(document.getElementById("root")).render(a.jsx(W3,{}));
